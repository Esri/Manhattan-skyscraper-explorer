import{am as f,c2 as g,an as G,aA as M}from"./index-f3c752ba.js";import{a as L}from"./lazyLayerLoader-707a4481.js";import{selectLayerClassPath as A}from"./portalLayers-60ead176.js";import"./layersLoader-2d216120.js";import"./fetchService-05aafaea.js";import"./jsonContext-cb5280e7.js";function v(e){return p(e,"notes")}function b(e){return p(e,"markup")}function w(e){return p(e,"route")}function p(e,r){return!(!e.layerType||e.layerType!=="ArcGISFeatureLayer")&&e.featureCollectionType===r}async function h(e,r,i){if(!r)return;const y=[];for(const a of r){const t=B(a,i);a.layerType==="GroupLayer"?y.push(R(t,a,i)):y.push(t)}const n=await f(y);for(const a of n)a.value&&e.add(a.value)}const W={ArcGISDimensionLayer:"DimensionLayer",ArcGISFeatureLayer:"FeatureLayer",ArcGISImageServiceLayer:"ImageryLayer",ArcGISMapServiceLayer:"MapImageLayer",PointCloudLayer:"PointCloudLayer",ArcGISSceneServiceLayer:"SceneLayer",IntegratedMeshLayer:"IntegratedMeshLayer",OGCFeatureLayer:"OGCFeatureLayer",BuildingSceneLayer:"BuildingSceneLayer",ArcGISTiledElevationServiceLayer:"ElevationLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",ArcGISTiledMapServiceLayer:"TileLayer",GroupLayer:"GroupLayer",GeoJSON:"GeoJSONLayer",WebTiledLayer:"WebTileLayer",CSV:"CSVLayer",VectorTileLayer:"VectorTileLayer",WFS:"WFSLayer",WMS:"WMSLayer",DefaultTileLayer:"TileLayer",KML:"KMLLayer",RasterDataLayer:"UnsupportedLayer",Voxel:"VoxelLayer",LineOfSightLayer:"LineOfSightLayer"},C={ArcGISTiledElevationServiceLayer:"ElevationLayer",DefaultTileLayer:"ElevationLayer",RasterDataElevationLayer:"UnsupportedLayer"},F={ArcGISTiledMapServiceLayer:"TileLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",OpenStreetMap:"OpenStreetMapLayer",WebTiledLayer:"WebTileLayer",VectorTileLayer:"VectorTileLayer",ArcGISImageServiceLayer:"UnsupportedLayer",WMS:"UnsupportedLayer",ArcGISMapServiceLayer:"UnsupportedLayer",ArcGISSceneServiceLayer:"SceneLayer",DefaultTileLayer:"TileLayer"},u={ArcGISAnnotationLayer:"UnsupportedLayer",ArcGISDimensionLayer:"UnsupportedLayer",ArcGISFeatureLayer:"FeatureLayer",ArcGISImageServiceLayer:"ImageryLayer",ArcGISImageServiceVectorLayer:"ImageryLayer",ArcGISMapServiceLayer:"MapImageLayer",ArcGISStreamLayer:"StreamLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",ArcGISTiledMapServiceLayer:"TileLayer",BingMapsAerial:"BingMapsLayer",BingMapsRoad:"BingMapsLayer",BingMapsHybrid:"BingMapsLayer",CSV:"CSVLayer",DefaultTileLayer:"TileLayer",GeoRSS:"GeoRSSLayer",GeoJSON:"GeoJSONLayer",GroupLayer:"GroupLayer",KML:"KMLLayer",MediaLayer:"MediaLayer",OGCFeatureLayer:"OGCFeatureLayer",OrientedImageryLayer:"OrientedImageryLayer",SubtypeGroupLayer:"SubtypeGroupLayer",VectorTileLayer:"VectorTileLayer",WFS:"WFSLayer",WMS:"WMSLayer",WebTiledLayer:"WebTileLayer"},d={ArcGISFeatureLayer:"FeatureLayer"},I={ArcGISImageServiceLayer:"ImageryLayer",ArcGISImageServiceVectorLayer:"ImageryLayer",ArcGISMapServiceLayer:"MapImageLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",ArcGISTiledMapServiceLayer:"TileLayer",OpenStreetMap:"OpenStreetMapLayer",VectorTileLayer:"VectorTileLayer",WebTiledLayer:"WebTileLayer",BingMapsAerial:"BingMapsLayer",BingMapsRoad:"BingMapsLayer",BingMapsHybrid:"BingMapsLayer",WMS:"WMSLayer",DefaultTileLayer:"TileLayer"},O={...u,LinkChartLayer:"LinkChartLayer"},V={...d},k={...I};async function B(e,r){return D(await U(e,r),e,r)}async function D(e,r,i){const y=new e;return y.read(r,i.context),y.type==="group"&&T(r)&&await E(y,r,i.context),await g(y,i.context),y}async function U(e,r){const i=r.context,y=x(i);let n=e.layerType||e.type;!n&&r&&r.defaultLayerType&&(n=r.defaultLayerType);const a=y[n];let t=a?L[a]:L.UnknownLayer;if(m(e)){const o=i?.portal;if(e.itemId){const c=new G({id:e.itemId,portal:o});await c.load();const l=(await A(c)).className||"UnknownLayer";t=L[l]}}else n==="ArcGISFeatureLayer"?v(e)||b(e)?t=L.MapNotesLayer:w(e)?t=L.RouteLayer:T(e)&&(t=L.GroupLayer):e.wmtsInfo&&e.wmtsInfo.url&&e.wmtsInfo.layerIdentifier?t=L.WMTSLayer:n==="WFS"&&e.wfsInfo?.version!=="2.0.0"&&(t=L.UnsupportedLayer);return t()}function T(e){return e.layerType!=="ArcGISFeatureLayer"||m(e)?!1:(e.featureCollection?.layers?.length??0)>1}function m(e){return e.type==="Feature Collection"}function x(e){let r;switch(e.origin){case"web-scene":switch(e.layerContainerType){case"basemap":r=F;break;case"ground":r=C;break;default:r=W}break;case"link-chart":switch(e.layerContainerType){case"basemap":r=k;break;case"tables":r=V;break;default:r=O}break;default:switch(e.layerContainerType){case"basemap":r=I;break;case"tables":r=d;break;default:r=u}}return r}async function R(e,r,i){const y=new M,n=h(y,Array.isArray(r.layers)?r.layers:[],i);try{const a=await e;try{if(await n,a.type==="group")return a.layers.addMany(y),a}catch(t){a.destroy();for(const o of y)o.destroy();throw t}}catch(a){throw a}}async function E(e,r,i){const y=L.FeatureLayer,n=await y(),a=r.featureCollection,t=a?.showLegend,o=a?.layers?.map((c,l)=>{const s=new n;s.read(c,i);const S={...i,ignoreDefaults:!0};return s.read({id:`${e.id}-sublayer-${l}`,visibility:r.visibleLayers?.includes(l)??!0},S),t!=null&&s.read({showLegend:t},S),s});e.layers.addMany(o??[])}export{h as populateOperationalLayers};
