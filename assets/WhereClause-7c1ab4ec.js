import{dJ as _o,gk as Lo,bs as Se}from"./index-2d893400.js";import{i as Re}from"./executionError-e8d36121.js";function Mo(l,s){const o=De[l.toLowerCase()];if(o==null)throw new Error("Function Not Recognised");if(s.length<o.minParams||s.length>o.maxParams)throw new Error(`Invalid Parameter count for call to ${l.toUpperCase()}`);return o.evaluate(s)}function Ro(l,s){const o=De[l.toLowerCase()];return o!=null&&s>=o.minParams&&s<=o.maxParams}const De={min:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.min.apply(Math,l[0])},max:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.max.apply(Math,l[0])},avg:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Oe(l[0])},sum:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Do(l[0])},stddev:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.sqrt(Ee(l[0]))},count:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:l[0].length},var:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Ee(l[0])}};function Oe(l){let s=0;for(let o=0;o<l.length;o++)s+=l[o];return s/l.length}function Do(l){let s=0;for(let o=0;o<l.length;o++)s+=l[o];return s}function Ee(l){const s=Oe(l),o=l.length;let f=0;for(const i of l)f+=(i-s)**2;return o>1?f/(o-1):0}var C;(function(l){l.InvalidFunctionParameters="InvalidFunctionParameters",l.UnsupportedSqlFunction="UnsupportedSqlFunction",l.UnsupportedOperator="UnsupportedOperator",l.UnsupportedSyntax="UnsupportedSyntax",l.UnsupportedIsRhs="UnsupportedIsRhs",l.UnsupportedIsLhs="UnsupportedIsLhs",l.InvalidDataType="InvalidDataType",l.CannotCastValue="CannotCastValue",l.MissingStatisticParameters="MissingStatisticParameters"})(C||(C={}));const Oo={[C.MissingStatisticParameters]:"Statistic does not have 1 or 0 Parameters",[C.InvalidFunctionParameters]:"Invalid parameters for call to {function}",[C.UnsupportedIsLhs]:"Unsupported left hand expression in is statement",[C.UnsupportedIsRhs]:"Unsupported right hand expression in is statement",[C.UnsupportedOperator]:"Unsupported operator - {operator}",[C.UnsupportedSyntax]:"Unsupported syntax - {node}",[C.UnsupportedSqlFunction]:"Sql function not found = {function}",[C.InvalidDataType]:"Invalid sql data type",[C.CannotCastValue]:"Cannot cast value to the required data type"};let j=class $e extends Error{constructor(s,o){super(Re(Oo[s],o)),this.declaredRootClass="esri.arcade.featureset.support.sqlerror",Error.captureStackTrace&&Error.captureStackTrace(this,$e)}};var M;(function(l){l.NeverReach="NeverReach",l.NotImplemented="NotImplemented",l.Cancelled="Cancelled",l.InvalidStatResponse="InvalidStatResponse",l.InvalidRequest="InvalidRequest",l.RequestFailed="RequestFailed",l.MissingFeatures="MissingFeatures",l.AggregationFieldNotFound="AggregationFieldNotFound",l.DataElementsNotFound="DataElementsNotFound"})(M||(M={}));const $o={[M.Cancelled]:"Cancelled",[M.InvalidStatResponse]:"Invalid statistics response from service",[M.InvalidRequest]:"Invalid request",[M.RequestFailed]:"Request failed - {reason}",[M.MissingFeatures]:"Missing features",[M.AggregationFieldNotFound]:"Aggregation field not found",[M.DataElementsNotFound]:"Data elements not found on service",[M.NeverReach]:"Encountered unreachable logic",[M.NotImplemented]:"Not implemented"};let Xo=class Je extends Error{constructor(s,o){super(Re($o[s],o)),this.declaredRootClass="esri.arcade.featureset.support.featureseterror",Error.captureStackTrace&&Error.captureStackTrace(this,Je)}},k=class D{constructor(){this.op="+",this.day=0,this.second=0,this.hour=0,this.month=0,this.year=0,this.minute=0,this.millis=0}static _fixDefaults(s){if(s.precision!==null||s.secondary!==null)throw new Error("Primary and Secondary SqlInterval qualifiers not supported")}static _parseSecondsComponent(s,o){if(o.includes(".")){const f=o.split(".");s.second=parseFloat(f[0]),s.millis=parseInt(f[1],10)}else s.second=parseFloat(o)}static createFromMilliseconds(s){const o=new D;return o.second=s/1e3,o}static createFromValueAndQualifer(s,o,f){let i=null;const d=new D;if(d.op=f==="-"?"-":"+",o.type==="interval-period"){D._fixDefaults(o);const m=new RegExp("^[0-9]{1,}$");if(o.period==="year"||o.period==="month")throw new Error("Year-Month Intervals not supported");if(o.period==="second"){if(!/^[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/.test(s))throw new Error("Illegal Interval");D._parseSecondsComponent(d,s)}else{if(!m.test(s))throw new Error("Illegal Interval");d[o.period]=parseFloat(s)}}else{if(D._fixDefaults(o.start),D._fixDefaults(o.end),o.start.period==="year"||o.start.period==="month")throw new Error("Year-Month Intervals not supported");if(o.end.period==="year"||o.end.period==="month")throw new Error("Year-Month Intervals not supported");switch(o.start.period){case"day":switch(o.end.period){case"hour":if(i=new RegExp("^[0-9]{1,} [0-9]{1,}$"),!i.test(s))throw new Error("Illegal Interval");d[o.start.period]=parseFloat(s.split(" ")[0]),d[o.end.period]=parseFloat(s.split(" ")[1]);break;case"minute":if(i=new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$"),!i.test(s))throw new Error("Illegal Interval");{d[o.start.period]=parseFloat(s.split(" ")[0]);const m=s.split(" ")[1].split(":");d.hour=parseFloat(m[0]),d.minute=parseFloat(m[1])}break;case"second":if(i=new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!i.test(s))throw new Error("Illegal Interval");{d[o.start.period]=parseFloat(s.split(" ")[0]);const m=s.split(" ")[1].split(":");d.hour=parseFloat(m[0]),d.minute=parseFloat(m[1]),D._parseSecondsComponent(d,m[2])}break;default:throw new Error("Invalid Interval.")}break;case"hour":switch(o.end.period){case"minute":if(i=new RegExp("^[0-9]{1,}:[0-9]{1,}$"),!i.test(s))throw new Error("Illegal Interval");d.hour=parseFloat(s.split(":")[0]),d.minute=parseFloat(s.split(":")[1]);break;case"second":if(i=new RegExp("^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!i.test(s))throw new Error("Illegal Interval");{const m=s.split(":");d.hour=parseFloat(m[0]),d.minute=parseFloat(m[1]),D._parseSecondsComponent(d,m[2])}break;default:throw new Error("Invalid Interval.")}break;case"minute":if(o.end.period!=="second")throw new Error("Invalid Interval.");if(i=new RegExp("^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!i.test(s))throw new Error("Illegal Interval");{const m=s.split(":");d.minute=parseFloat(m[0]),D._parseSecondsComponent(d,m[1])}break;default:throw new Error("Invalid Interval.")}}return d}valueInMilliseconds(){return(this.op==="-"?-1:1)*(this.millis+1e3*this.second+60*this.minute*1e3+60*this.hour*60*1e3+24*this.day*60*60*1e3+this.month*(365/12)*24*60*60*1e3+365*this.year*24*60*60*1e3)}};function _t(l,s){const o=Ue[l.toLowerCase()];if(o==null)throw new Error("Function Not Recognised");if(s.length<o.minParams||s.length>o.maxParams)throw new Error(`Invalid Parameter count for call to ${l.toUpperCase()}`);return o.evaluate(s)}function Jo(l,s){const o=Ue[l.toLowerCase()];return o!=null&&s>=o.minParams&&s<=o.maxParams}function Uo(l){return typeof l=="string"||l instanceof String}function ko(l){return l instanceof Date}function Ce(l){const s=new Date(l.getTime());return s.setHours(0,0,0,0),s}function Fe(l,s){if(ko(l))return s?Ce(l):l;if(Uo(l)){const o=Lo.fromSQL(l);if(o.isValid)return s?Ce(o.toJSDate()):o.toJSDate()}throw new j(C.CannotCastValue)}const Ue={extract:{minParams:2,maxParams:2,evaluate:([l,s])=>{if(s==null)return null;if(s instanceof Date)switch(l.toUpperCase()){case"SECOND":return s.getSeconds();case"MINUTE":return s.getMinutes();case"HOUR":return s.getHours();case"DAY":return s.getDate();case"MONTH":return s.getMonth()+1;case"YEAR":return s.getFullYear()}throw new Error("Invalid Parameter for call to EXTRACT")}},substring:{minParams:2,maxParams:3,evaluate:l=>{if(l.length===2){const[s,o]=l;return s==null||o==null?null:s.toString().substring(o-1)}if(l.length===3){const[s,o,f]=l;return s==null||o==null||f==null?null:f<=0?"":s.toString().substring(o-1,o+f-1)}}},position:{minParams:2,maxParams:2,evaluate:([l,s])=>l==null||s==null?null:s.indexOf(l)+1},trim:{minParams:2,maxParams:3,evaluate:l=>{const s=l.length===3,o=s?l[1]:" ",f=s?l[2]:l[1];if(o==null||f==null)return null;const i=`(${_o(o)})`;switch(l[0]){case"BOTH":return f.replaceAll(new RegExp(`^${i}*|${i}*$`,"g"),"");case"LEADING":return f.replaceAll(new RegExp(`^${i}*`,"g"),"");case"TRAILING":return f.replaceAll(new RegExp(`${i}*$`,"g"),"")}throw new Error("Invalid Parameter for call to TRIM")}},abs:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.abs(l[0])},ceiling:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.ceil(l[0])},floor:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.floor(l[0])},log:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.log(l[0])},log10:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.log(l[0])*Math.LOG10E},sin:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.sin(l[0])},cos:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.cos(l[0])},tan:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.tan(l[0])},asin:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.asin(l[0])},acos:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.acos(l[0])},atan:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.atan(l[0])},sign:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:l[0]>0?1:l[1]<0?-1:0},power:{minParams:2,maxParams:2,evaluate:l=>l[0]==null||l[1]==null?null:l[0]**l[1]},mod:{minParams:2,maxParams:2,evaluate:l=>l[0]==null||l[1]==null?null:l[0]%l[1]},round:{minParams:1,maxParams:2,evaluate:l=>{const s=l[0],o=l.length===2?10**l[1]:1;return s==null?null:Math.round(s*o)/o}},truncate:{minParams:1,maxParams:2,evaluate:l=>l[0]==null?null:l.length===1?parseInt(l[0].toFixed(0),10):parseFloat(l[0].toFixed(l[1]))},char_length:{minParams:1,maxParams:1,evaluate:l=>typeof l[0]=="string"||l[0]instanceof String?l[0].length:0},concat:{minParams:1,maxParams:1/0,evaluate:l=>{let s="";for(let o=0;o<l.length;o++){if(l[o]==null)return null;s+=l[o].toString()}return s}},lower:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:l[0].toString().toLowerCase()},upper:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:l[0].toString().toUpperCase()},coalesce:{minParams:1,maxParams:1/0,evaluate:l=>{for(const s of l)if(s!==null)return s;return null}},cosh:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.cosh(l[0])},sinh:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.sinh(l[0])},tanh:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.tanh(l[0])},nullif:{minParams:2,maxParams:2,evaluate:l=>{const s=l[0],o=l[1];return(s instanceof Date?s.valueOf():s)===(o instanceof Date?o.valueOf():o)?null:s}},cast:{minParams:2,maxParams:2,evaluate:l=>{const s=l[0],o=l[1];if(s===null)return null;switch(o.type){case"integer":{const f=parseInt(s,10);if(isNaN(f))throw new j(C.CannotCastValue);return f}case"smallint":{const f=parseInt(s,10);if(isNaN(f))throw new j(C.CannotCastValue);if(f>32767||f<-32767)throw new j(C.CannotCastValue);return f}case"float":case"real":{const f=parseFloat(s);if(isNaN(f))throw new j(C.CannotCastValue);return f}case"date":return Fe(s,!0);case"timestamp":return Fe(s,!1);case"varchar":{const f=s.toString();if(f.length>o.size)throw new j(C.CannotCastValue);return f}default:throw new j(C.InvalidDataType)}}}};var Pe,_e,St={exports:{}};St.exports,_e=function(){function l(i,d){function m(){this.constructor=i}m.prototype=d.prototype,i.prototype=new m}function s(i,d,m,e){var N=Error.call(this,i);return Object.setPrototypeOf&&Object.setPrototypeOf(N,s.prototype),N.expected=d,N.found=m,N.location=e,N.name="SyntaxError",N}function o(i,d,m){return m=m||" ",i.length>d?i:(d-=i.length,i+(m+=m.repeat(d)).slice(0,d))}function f(i,d){var m,e={},N=(d=d!==void 0?d:{}).grammarSource,b={start:Yt},_=Yt,q="!",O="=",T=">=",S=">",L="<=",E="<>",Ge="<",Mt="!=",pt="+",dt="-",Rt="||",We="*",Ye="/",Ke="@",Dt="'",Ot="N'",X="''",Qe=".",Ze="null",Xe="true",tn="false",en="in",nn="is",rn="like",an="escape",sn="not",un="and",on="or",ln="between",cn="from",fn="for",pn="substring",dn="extract",vn="trim",hn="position",mn="timestamp",gn="date",yn="leading",wn="trailing",Nn="both",In="cast",bn="as",Tn="integer",xn="smallint",An="float",Sn="real",En="varchar",Cn="to",Fn="interval",Pn="year",_n="month",Ln="day",Mn="hour",Rn="minute",Dn="second",On="case",$n="end",Jn="when",Un="then",kn="else",qn=",",Vn="(",Hn=")",$t="`",Bn=/^[A-Za-z_\x80-\uFFFF]/,jn=/^[A-Za-z0-9_]/,zn=/^[A-Za-z0-9_.\x80-\uFFFF]/,Jt=/^[^']/,Gn=/^[0-9]/,Wn=/^[eE]/,Yn=/^[+\-]/,Kn=/^[ \t\n\r]/,Ut=/^[^`]/,Qn=g("!",!1),kt=g("=",!1),Zn=g(">=",!1),Xn=g(">",!1),tr=g("<=",!1),er=g("<>",!1),nr=g("<",!1),rr=g("!=",!1),vt=g("+",!1),ht=g("-",!1),ar=g("||",!1),sr=g("*",!1),ur=g("/",!1),or=$([["A","Z"],["a","z"],"_",["","￿"]],!1,!1),ir=$([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),lr=$([["A","Z"],["a","z"],["0","9"],"_",".",["","￿"]],!1,!1),cr=g("@",!1),qt=g("'",!1),fr=g("N'",!1),Vt=g("''",!1),Ht=$(["'"],!0,!1),pr=g(".",!1),dr=$([["0","9"]],!1,!1),vr=$(["e","E"],!1,!1),hr=$(["+","-"],!1,!1),mr=g("NULL",!0),gr=g("TRUE",!0),yr=g("FALSE",!0),wr=g("IN",!0),Nr=g("IS",!0),Ir=g("LIKE",!0),br=g("ESCAPE",!0),Tr=g("NOT",!0),xr=g("AND",!0),Ar=g("OR",!0),Sr=g("BETWEEN",!0),Er=g("FROM",!0),Cr=g("FOR",!0),Fr=g("SUBSTRING",!0),Pr=g("EXTRACT",!0),_r=g("TRIM",!0),Lr=g("POSITION",!0),Mr=g("TIMESTAMP",!0),Rr=g("DATE",!0),Dr=g("LEADING",!0),Or=g("TRAILING",!0),$r=g("BOTH",!0),Jr=g("CAST",!0),Ur=g("AS",!0),kr=g("INTEGER",!0),qr=g("SMALLINT",!0),Vr=g("FLOAT",!0),Hr=g("REAL",!0),Br=g("VARCHAR",!0),jr=g("TO",!0),zr=g("INTERVAL",!0),Gr=g("YEAR",!0),Wr=g("MONTH",!0),Yr=g("DAY",!0),Kr=g("HOUR",!0),Qr=g("MINUTE",!0),Zr=g("SECOND",!0),Xr=g("CASE",!0),ta=g("END",!0),ea=g("WHEN",!0),na=g("THEN",!0),ra=g("ELSE",!0),aa=g(",",!1),sa=g("(",!1),ua=g(")",!1),oa=$([" ","	",`
`,"\r"],!1,!1),Bt=g("`",!1),jt=$(["`"],!0,!1),ia=function(t){return t},la=function(t,r){var a={type:"expression-list"},u=Po(t,r);return a.value=u,a},ca=function(t,r){return Q(t,r)},fa=function(t,r){return Q(t,r)},pa=function(t){return Co("NOT",t)},da=function(t,r){return r==""||r==null||r==null?t:r.type=="arithmetic"?Q(t,r.tail):Ae(r.op,t,r.right,r.escape)},va=function(t){return{type:"arithmetic",tail:t}},ha=function(t,r){return{op:t+"NOT",right:r}},ma=function(t,r){return{op:t,right:r}},ga=function(t,r,a){return{op:"NOT"+t,right:{type:"expression-list",value:[r,a]}}},ya=function(t,r,a){return{op:t,right:{type:"expression-list",value:[r,a]}}},wa=function(t){return t[0]+" "+t[2]},Na=function(t){return t[0]+" "+t[2]},Ia=function(t,r,a){return{op:t,right:r,escape:a.value}},ba=function(t,r){return{op:t,right:r,escape:""}},Ta=function(t,r){return{op:t,right:r}},xa=function(t){return{op:t,right:{type:"expression-list",value:[]}}},Aa=function(t,r){return{op:t,right:r}},Sa=function(t,r){return Q(t,r)},Ea=function(t,r){return Q(t,r)},Ca=function(t){return t.paren=!0,t},Fa=function(t){return/^CURRENT_DATE$/i.test(t)?{type:"current-time",mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(t)?{type:"current-time",mode:"timestamp"}:{type:"column-reference",table:"",column:t}},Pa=function(t){return t},_a=function(t,r){return t+r.join("")},La=function(t,r){return t+r.join("")},Ma=function(t){return{type:"parameter",value:t[1]}},Ra=function(t,r){return{type:"function",name:"extract",args:{type:"expression-list",value:[{type:"string",value:t},r]}}},Da=function(t,r,a){return{type:"function",name:"substring",args:{type:"expression-list",value:a?[t,r,a[2]]:[t,r]}}},Oa=function(t,r){return{type:"function",name:"cast",args:{type:"expression-list",value:[t,r]}}},$a=function(){return{type:"data-type",value:{type:"integer"}}},Ja=function(){return{type:"data-type",value:{type:"smallint"}}},Ua=function(){return{type:"data-type",value:{type:"float"}}},ka=function(){return{type:"data-type",value:{type:"real"}}},qa=function(){return{type:"data-type",value:{type:"date"}}},Va=function(){return{type:"data-type",value:{type:"timestamp"}}},Ha=function(t){return{type:"data-type",value:{type:"varchar",size:parseInt(t)}}},Ba=function(t,r,a){return{type:"function",name:"trim",args:{type:"expression-list",value:[{type:"string",value:t??"BOTH"},r,a]}}},ja=function(t,r){return{type:"function",name:"trim",args:{type:"expression-list",value:[{type:"string",value:t??"BOTH"},r]}}},za=function(t,r){return{type:"function",name:"position",args:{type:"expression-list",value:[t,r]}}},Ga=function(t,r){return{type:"function",name:t,args:r||{type:"expression-list",value:[]}}},Wa=function(t){return{type:"timestamp",value:t.value}},Ya=function(t,r,a){return{type:"interval",value:r,qualifier:a,op:t}},Ka=function(t,r){return{type:"interval",value:t,qualifier:r,op:""}},Qa=function(t,r){return{type:"interval-qualifier",start:t,end:r}},Za=function(t,r){return{type:"interval-period",period:t.value,precision:r,secondary:null}},Xa=function(t){return{type:"interval-period",period:t.value,precision:null,secondary:null}},ts=function(t){return{type:"interval-period",period:t.value,precision:null,secondary:null}},es=function(t,r){return{type:"interval-period",period:"second",precision:t,secondary:r}},ns=function(t){return{type:"interval-period",period:"second",precision:t,secondary:null}},rs=function(){return{type:"interval-period",period:"second",precision:null,secondary:null}},as=function(t,r){return{type:"interval-period",period:t.value,precision:r,secondary:null}},ss=function(t){return{type:"interval-period",period:t.value,precision:null,secondary:null}},us=function(t,r){return{type:"interval-period",period:"second",precision:t,secondary:r}},os=function(t){return{type:"interval-period",period:"second",precision:t,secondary:null}},is=function(){return{type:"interval-period",period:"second",precision:null,secondary:null}},ls=function(){return{type:"string",value:"day"}},cs=function(){return{type:"string",value:"hour"}},fs=function(){return{type:"string",value:"minute"}},ps=function(){return{type:"string",value:"month"}},ds=function(){return{type:"string",value:"year"}},vs=function(t){return parseFloat(t)},hs=function(t){return parseFloat(t)},ms=function(t){return{type:"date",value:t.value}},gs=function(){return{type:"null",value:null}},ys=function(){return{type:"boolean",value:!0}},ws=function(){return{type:"boolean",value:!1}},zt=function(){return"'"},Ns=function(t){return{type:"string",value:t.join("")}},Is=function(t,r){return{type:"case-expression",format:"simple",operand:t,clauses:r,else:null}},bs=function(t,r,a){return{type:"case-expression",format:"simple",operand:t,clauses:r,else:a.value}},Ts=function(t){return{type:"case-expression",format:"searched",clauses:t,else:null}},xs=function(t,r){return{type:"case-expression",format:"searched",clauses:t,else:r.value}},As=function(t,r){return{type:"when-clause",operand:t,value:r}},Ss=function(t,r){return{type:"when-clause",operand:t,value:r}},Es=function(t){return{type:"else-clause",value:t}},Cs=function(t){return{type:"number",value:t}},Fs=function(t,r,a){return parseFloat(t+r+a)},Ps=function(t,r){return parseFloat(t+r)},_s=function(t,r){return parseFloat(t+r)},Ls=function(t){return parseFloat(t)},Ms=function(t,r){return t[0]+r},Rs=function(t){return"."+(t??"")},Ds=function(t,r){return t+r},Os=function(t){return t.join("")},$s=function(t,r){return"e"+(r===null?"":r)},Js=function(){return"IN"},Us=function(){return"IS"},ks=function(){return"LIKE"},qs=function(){return"ESCAPE"},Vs=function(){return"NOT"},Hs=function(){return"AND"},Bs=function(){return"OR"},js=function(){return"BETWEEN"},zs=function(){return"FROM"},Gs=function(){return"FOR"},Ws=function(){return"SUBSTRING"},Ys=function(){return"EXTRACT"},Ks=function(){return"TRIM"},Qs=function(){return"POSITION"},Zs=function(){return"TIMESTAMP"},Xs=function(){return"DATE"},tu=function(){return"LEADING"},eu=function(){return"TRAILING"},nu=function(){return"BOTH"},ru=function(){return"CAST"},au=function(){return"AS"},su=function(){return"INTEGER"},uu=function(){return"SMALLINT"},ou=function(){return"FLOAT"},iu=function(){return"REAL"},lu=function(){return"VARCHAR"},cu=function(){return"TO"},fu=function(){return"INTERVAL"},pu=function(){return"YEAR"},du=function(){return"MONTH"},vu=function(){return"DAY"},hu=function(){return"HOUR"},mu=function(){return"MINUTE"},gu=function(){return"SECOND"},yu=function(){return"CASE"},wu=function(){return"END"},Nu=function(){return"WHEN"},Iu=function(){return"THEN"},bu=function(){return"ELSE"},Tu=function(t){return t},xu=function(t){return t.join("")},n=0,tt=[{line:1,column:1}],R=0,mt=[],c=0;if("startRule"in d){if(!(d.startRule in b))throw new Error(`Can't start parsing from rule "`+d.startRule+'".');_=b[d.startRule]}function g(t,r){return{type:"literal",text:t,ignoreCase:r}}function $(t,r,a){return{type:"class",parts:t,inverted:r,ignoreCase:a}}function Au(){return{type:"end"}}function Gt(t){var r,a=tt[t];if(a)return a;for(r=t-1;!tt[r];)r--;for(a={line:(a=tt[r]).line,column:a.column};r<t;)i.charCodeAt(r)===10?(a.line++,a.column=1):a.column++,r++;return tt[t]=a,a}function Wt(t,r,a){var u=Gt(t),h=Gt(r),w={source:N,start:{offset:t,line:u.line,column:u.column},end:{offset:r,line:h.line,column:h.column}};return a&&N&&typeof N.offset=="function"&&(w.start=N.offset(w.start),w.end=N.offset(w.end)),w}function v(t){n<R||(n>R&&(R=n,mt=[]),mt.push(t))}function Su(t,r,a){return new s(s.buildMessage(t,r),t,r,a)}function Yt(){var t,r;return t=n,p(),(r=A())!==e?(p(),t=ia(r)):(n=t,t=e),t}function Kt(){var t,r,a,u,h,w,I,x;if(t=n,(r=A())!==e){for(a=[],u=n,h=p(),(w=ct())!==e?(I=p(),(x=A())!==e?u=h=[h,w,I,x]:(n=u,u=e)):(n=u,u=e);u!==e;)a.push(u),u=n,h=p(),(w=ct())!==e?(I=p(),(x=A())!==e?u=h=[h,w,I,x]:(n=u,u=e)):(n=u,u=e);t=la(r,a)}else n=t,t=e;return t}function A(){var t,r,a,u,h,w,I,x;if(t=n,(r=gt())!==e){for(a=[],u=n,h=p(),(w=fe())!==e?(I=p(),(x=gt())!==e?u=h=[h,w,I,x]:(n=u,u=e)):(n=u,u=e);u!==e;)a.push(u),u=n,h=p(),(w=fe())!==e?(I=p(),(x=gt())!==e?u=h=[h,w,I,x]:(n=u,u=e)):(n=u,u=e);t=ca(r,a)}else n=t,t=e;return t}function gt(){var t,r,a,u,h,w,I,x;if(t=n,(r=et())!==e){for(a=[],u=n,h=p(),(w=ot())!==e?(I=p(),(x=et())!==e?u=h=[h,w,I,x]:(n=u,u=e)):(n=u,u=e);u!==e;)a.push(u),u=n,h=p(),(w=ot())!==e?(I=p(),(x=et())!==e?u=h=[h,w,I,x]:(n=u,u=e)):(n=u,u=e);t=fa(r,a)}else n=t,t=e;return t}function et(){var t,r,a,u,h;return t=n,(r=K())===e&&(r=n,i.charCodeAt(n)===33?(a=q,n++):(a=e,c===0&&v(Qn)),a!==e?(u=n,c++,i.charCodeAt(n)===61?(h=O,n++):(h=e,c===0&&v(kt)),c--,h===e?u=void 0:(n=u,u=e),u!==e?r=a=[a,u]:(n=r,r=e)):(n=r,r=e)),r!==e?(a=p(),(u=et())!==e?t=pa(u):(n=t,t=e)):(n=t,t=e),t===e&&(t=Eu()),t}function Eu(){var t,r,a;return t=n,(r=J())!==e?(p(),(a=Cu())===e&&(a=null),t=da(r,a)):(n=t,t=e),t}function Cu(){var t;return(t=Fu())===e&&(t=Mu())===e&&(t=_u())===e&&(t=Pu())===e&&(t=Lu()),t}function Fu(){var t,r,a,u,h,w;if(t=[],r=n,a=p(),(u=Qt())!==e?(h=p(),(w=J())!==e?r=a=[a,u,h,w]:(n=r,r=e)):(n=r,r=e),r!==e)for(;r!==e;)t.push(r),r=n,a=p(),(u=Qt())!==e?(h=p(),(w=J())!==e?r=a=[a,u,h,w]:(n=r,r=e)):(n=r,r=e);else t=e;return t!==e&&(t=va(t)),t}function Qt(){var t;return i.substr(n,2)===T?(t=T,n+=2):(t=e,c===0&&v(Zn)),t===e&&(i.charCodeAt(n)===62?(t=S,n++):(t=e,c===0&&v(Xn)),t===e&&(i.substr(n,2)===L?(t=L,n+=2):(t=e,c===0&&v(tr)),t===e&&(i.substr(n,2)===E?(t=E,n+=2):(t=e,c===0&&v(er)),t===e&&(i.charCodeAt(n)===60?(t=Ge,n++):(t=e,c===0&&v(nr)),t===e&&(i.charCodeAt(n)===61?(t=O,n++):(t=e,c===0&&v(kt)),t===e&&(i.substr(n,2)===Mt?(t=Mt,n+=2):(t=e,c===0&&v(rr)))))))),t}function Pu(){var t,r,a,u;return t=n,(r=le())!==e?(p(),(a=K())!==e?(p(),(u=J())!==e?t=ha(r,u):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t===e&&(t=n,(r=le())!==e?(p(),(a=J())!==e?t=ma(r,a):(n=t,t=e)):(n=t,t=e)),t}function _u(){var t,r,a,u,h,w;return t=n,(r=K())!==e?(p(),(a=pe())!==e?(p(),(u=J())!==e?(p(),(h=ot())!==e?(p(),(w=J())!==e?t=ga(a,u,w):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t===e&&(t=n,(r=pe())!==e?(p(),(a=J())!==e?(p(),(u=ot())!==e?(p(),(h=J())!==e?t=ya(r,a,h):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)),t}function Zt(){var t,r,a,u,h;return t=n,r=n,(a=K())!==e?(u=p(),(h=ce())!==e?r=a=[a,u,h]:(n=r,r=e)):(n=r,r=e),r!==e&&(r=wa(r)),(t=r)===e&&(t=ce()),t}function yt(){var t,r,a,u,h;return t=n,r=n,(a=K())!==e?(u=p(),(h=xt())!==e?r=a=[a,u,h]:(n=r,r=e)):(n=r,r=e),r!==e&&(r=Na(r)),(t=r)===e&&(t=xt()),t}function Lu(){var t,r,a,u;return t=n,(r=Zt())!==e?(p(),(a=W())!==e?(p(),lo()!==e?(p(),(u=Tt())!==e?t=Ia(r,a,u):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t===e&&(t=n,(r=Zt())!==e?(p(),(a=W())!==e?t=ba(r,a):(n=t,t=e)):(n=t,t=e)),t}function Mu(){var t,r,a,u;return t=n,(r=yt())!==e?(p(),(a=F())!==e?(p(),(u=Kt())!==e?(p(),P()!==e?t=Ta(r,u):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t===e&&(t=n,(r=yt())!==e?(p(),(a=F())!==e?(p(),(u=P())!==e?t=xa(r):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t===e&&(t=n,(r=yt())!==e?(p(),(a=bt())!==e?t=Aa(r,a):(n=t,t=e)):(n=t,t=e))),t}function J(){var t,r,a,u,h,w,I,x;if(t=n,(r=wt())!==e){for(a=[],u=n,h=p(),(w=Xt())!==e?(I=p(),(x=wt())!==e?u=h=[h,w,I,x]:(n=u,u=e)):(n=u,u=e);u!==e;)a.push(u),u=n,h=p(),(w=Xt())!==e?(I=p(),(x=wt())!==e?u=h=[h,w,I,x]:(n=u,u=e)):(n=u,u=e);t=Sa(r,a)}else n=t,t=e;return t}function Xt(){var t;return i.charCodeAt(n)===43?(t=pt,n++):(t=e,c===0&&v(vt)),t===e&&(i.charCodeAt(n)===45?(t=dt,n++):(t=e,c===0&&v(ht)),t===e&&(i.substr(n,2)===Rt?(t=Rt,n+=2):(t=e,c===0&&v(ar)))),t}function wt(){var t,r,a,u,h,w,I,x;if(t=n,(r=Nt())!==e){for(a=[],u=n,h=p(),(w=te())!==e?(I=p(),(x=Nt())!==e?u=h=[h,w,I,x]:(n=u,u=e)):(n=u,u=e);u!==e;)a.push(u),u=n,h=p(),(w=te())!==e?(I=p(),(x=Nt())!==e?u=h=[h,w,I,x]:(n=u,u=e)):(n=u,u=e);t=Ea(r,a)}else n=t,t=e;return t}function te(){var t;return i.charCodeAt(n)===42?(t=We,n++):(t=e,c===0&&v(sr)),t===e&&(i.charCodeAt(n)===47?(t=Ye,n++):(t=e,c===0&&v(ur))),t}function Nt(){var t,r;return(t=ju())===e&&(t=$u())===e&&(t=Ju())===e&&(t=qu())===e&&(t=Vu())===e&&(t=Uu())===e&&(t=Hu())===e&&(t=to())===e&&(t=Ru())===e&&(t=bt())===e&&(t=n,F()!==e?(p(),(r=A())!==e?(p(),P()!==e?t=Ca(r):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)),t}function Ru(){var t;return(t=Du())!==e&&(t=Fa(t)),t}function Du(){var t;return(t=Ou())!==e&&(t=Pa(t)),t}function Ou(){var t,r,a,u;if(t=n,(r=It())!==e){for(a=[],u=ne();u!==e;)a.push(u),u=ne();t=_a(r,a)}else n=t,t=e;return t}function ee(){var t,r,a,u;if(t=n,(r=It())!==e){for(a=[],u=y();u!==e;)a.push(u),u=y();t=La(r,a)}else n=t,t=e;return t}function It(){var t;return Bn.test(i.charAt(n))?(t=i.charAt(n),n++):(t=e,c===0&&v(or)),t}function y(){var t;return jn.test(i.charAt(n))?(t=i.charAt(n),n++):(t=e,c===0&&v(ir)),t}function ne(){var t;return zn.test(i.charAt(n))?(t=i.charAt(n),n++):(t=e,c===0&&v(lr)),t}function bt(){var t,r,a;return t=n,i.charCodeAt(n)===64?(r=Ke,n++):(r=e,c===0&&v(cr)),r!==e&&(a=ee())!==e?t=r=[r,a]:(n=t,t=e),t!==e&&(t=Ma(t)),t}function $u(){var t,r,a;return t=n,po()!==e?(p(),F()!==e?(p(),(r=Bu())!==e?(p(),At()!==e?(p(),(a=A())!==e?(p(),P()!==e?t=Ra(r,a):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t}function Ju(){var t,r,a,u,h,w,I;return t=n,fo()!==e?(p(),F()!==e?(p(),(r=A())!==e?(p(),At()!==e?(p(),(a=A())!==e?(p(),u=n,(h=co())!==e?(w=p(),(I=A())!==e?u=h=[h,w,I,p()]:(n=u,u=e)):(n=u,u=e),u===e&&(u=null),(h=P())!==e?t=Da(r,a,u):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t}function Uu(){var t,r,a;return t=n,yo()!==e?(p(),F()!==e?(p(),(r=A())!==e?(p(),wo()!==e?(p(),(a=ku())!==e?(p(),P()!==e?t=Oa(r,a):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t}function ku(){var t,r,a;return t=n,(r=No())!==e&&(r=$a()),(t=r)===e&&(t=n,(r=Io())!==e&&(r=Ja()),(t=r)===e&&(t=n,(r=bo())!==e&&(r=Ua()),(t=r)===e&&(t=n,(r=To())!==e&&(r=ka()),(t=r)===e&&(t=n,(r=he())!==e&&(r=qa()),(t=r)===e&&(t=n,(r=ve())!==e&&(r=Va()),(t=r)===e&&(t=n,(r=xo())!==e?(p(),F()!==e?(p(),(a=V())!==e?(p(),P()!==e?t=Ha(a):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e))))))),t}function qu(){var t,r,a,u;return t=n,de()!==e?(p(),F()!==e?(p(),(r=re())===e&&(r=null),p(),(a=A())!==e?(p(),At()!==e?(p(),(u=A())!==e?(p(),P()!==e?t=Ba(r,a,u):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t===e&&(t=n,de()!==e?(p(),F()!==e?(p(),(r=re())===e&&(r=null),p(),(a=A())!==e?(p(),P()!==e?t=ja(r,a):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)),t}function re(){var t;return(t=ho())===e&&(t=mo())===e&&(t=go()),t}function Vu(){var t,r,a;return t=n,vo()!==e?(p(),F()!==e?(p(),(r=A())!==e?(p(),xt()!==e?(p(),(a=A())!==e?(p(),P()!==e?t=za(r,a):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t}function Hu(){var t,r,a;return t=n,(r=Eo())!==e?(p(),F()!==e?(p(),(a=Kt())===e&&(a=null),p(),P()!==e?t=Ga(r,a):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t}function Bu(){var t;return(t=ge())===e&&(t=ye())===e&&(t=we())===e&&(t=Ne())===e&&(t=Ie())===e&&(t=H()),t}function ju(){var t;return(t=Tt())===e&&(t=ro())===e&&(t=Xu())===e&&(t=Zu())===e&&(t=Qu())===e&&(t=zu())===e&&(t=Gu()),t}function zu(){var t,r;return t=n,ve()!==e?(p(),(r=W())!==e?t=Wa(r):(n=t,t=e)):(n=t,t=e),t}function Gu(){var t,r,a,u;return t=n,me()!==e?(p(),i.charCodeAt(n)===45?(r=dt,n++):(r=e,c===0&&v(ht)),r===e&&(i.charCodeAt(n)===43?(r=pt,n++):(r=e,c===0&&v(vt))),r!==e?(p(),(a=W())!==e?(p(),(u=ae())!==e?t=Ya(r,a,u):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t===e&&(t=n,me()!==e?(p(),(r=W())!==e?(p(),(a=ae())!==e?t=Ka(r,a):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)),t}function ae(){var t,r,a;return t=n,(r=Wu())!==e?(p(),Ao()!==e?(p(),(a=Yu())!==e?t=Qa(r,a):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t===e&&(t=Ku()),t}function Wu(){var t,r,a;return t=n,(r=Y())!==e?(p(),F()!==e?(p(),(a=rt())!==e?(p(),P()!==e?t=Za(r,a):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t===e&&(t=n,(r=Y())!==e&&(r=Xa(r)),t=r),t}function Yu(){var t,r,a,u;return t=n,(r=Y())!==e&&(r=ts(r)),(t=r)===e&&(t=n,(r=H())!==e?(p(),F()!==e?(p(),(a=rt())!==e?(p(),ct()!==e?(p(),(u=nt())!==e?(p(),P()!==e?t=es(a,u):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t===e&&(t=n,(r=H())!==e?(p(),F()!==e?(p(),(a=rt())!==e?(p(),P()!==e?t=ns(a):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t===e&&(t=n,(r=H())!==e&&(r=rs()),t=r))),t}function Ku(){var t,r,a,u;return t=n,(r=Y())!==e?(p(),F()!==e?(p(),(a=nt())!==e?(p(),P()!==e?t=as(r,a):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t===e&&(t=n,(r=Y())!==e&&(r=ss(r)),(t=r)===e&&(t=n,(r=H())!==e?(p(),F()!==e?(p(),(a=rt())!==e?(p(),ct()!==e?(p(),(u=nt())!==e?(p(),P()!==e?t=us(a,u):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t===e&&(t=n,(r=H())!==e?(p(),F()!==e?(p(),(a=nt())!==e?(p(),P()!==e?t=os(a):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t===e&&(t=n,(r=H())!==e&&(r=is()),t=r)))),t}function Y(){var t,r;return t=n,(r=we())!==e&&(r=ls()),(t=r)===e&&(t=n,(r=Ne())!==e&&(r=cs()),(t=r)===e&&(t=n,(r=Ie())!==e&&(r=fs()),(t=r)===e&&(t=n,(r=ye())!==e&&(r=ps()),(t=r)===e&&(t=n,(r=ge())!==e&&(r=ds()),t=r)))),t}function nt(){var t;return(t=V())!==e&&(t=vs(t)),t}function rt(){var t;return(t=V())!==e&&(t=hs(t)),t}function Qu(){var t,r;return t=n,he()!==e?(p(),(r=W())!==e?t=ms(r):(n=t,t=e)):(n=t,t=e),t}function Zu(){var t;return(t=uo())!==e&&(t=gs()),t}function Xu(){var t,r;return t=n,(r=oo())!==e&&(r=ys()),(t=r)===e&&(t=n,(r=io())!==e&&(r=ws()),t=r),t}function W(){var t;return(t=Tt())===e&&(t=bt()),t}function Tt(){var t,r,a,u,h;if(t=n,i.charCodeAt(n)===39?(r=Dt,n++):(r=e,c===0&&v(qt)),r===e&&(i.substr(n,2)===Ot?(r=Ot,n+=2):(r=e,c===0&&v(fr))),r!==e){for(a=[],u=n,i.substr(n,2)===X?(h=X,n+=2):(h=e,c===0&&v(Vt)),h!==e&&(h=zt()),(u=h)===e&&(Jt.test(i.charAt(n))?(u=i.charAt(n),n++):(u=e,c===0&&v(Ht)));u!==e;)a.push(u),u=n,i.substr(n,2)===X?(h=X,n+=2):(h=e,c===0&&v(Vt)),h!==e&&(h=zt()),(u=h)===e&&(Jt.test(i.charAt(n))?(u=i.charAt(n),n++):(u=e,c===0&&v(Ht)));i.charCodeAt(n)===39?(u=Dt,n++):(u=e,c===0&&v(qt)),u!==e?t=Ns(a):(n=t,t=e)}else n=t,t=e;return t}function to(){var t;return(t=eo())===e&&(t=no()),t}function eo(){var t,r,a,u,h;if(t=n,it()!==e)if(p(),(r=A())!==e){for(p(),a=[],u=st();u!==e;)a.push(u),u=st();u=p(),(h=lt())!==e?t=Is(r,a):(n=t,t=e)}else n=t,t=e;else n=t,t=e;if(t===e)if(t=n,it()!==e)if(p(),(r=A())!==e){for(p(),a=[],u=st();u!==e;)a.push(u),u=st();u=p(),(h=se())!==e?(p(),lt()!==e?t=bs(r,a,h):(n=t,t=e)):(n=t,t=e)}else n=t,t=e;else n=t,t=e;return t}function no(){var t,r,a,u;if(t=n,it()!==e){for(p(),r=[],a=at();a!==e;)r.push(a),a=at();a=p(),(u=lt())!==e?t=Ts(r):(n=t,t=e)}else n=t,t=e;if(t===e)if(t=n,it()!==e){for(p(),r=[],a=at();a!==e;)r.push(a),a=at();a=p(),(u=se())!==e?(p(),lt()!==e?t=xs(r,u):(n=t,t=e)):(n=t,t=e)}else n=t,t=e;return t}function at(){var t,r,a;return t=n,be()!==e?(p(),(r=A())!==e?(p(),Te()!==e?(p(),(a=A())!==e?t=As(r,a):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t}function st(){var t,r,a;return t=n,be()!==e?(p(),(r=A())!==e?(p(),Te()!==e?(p(),(a=A())!==e?t=Ss(r,a):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t}function se(){var t,r;return t=n,So()!==e?(p(),(r=A())!==e?t=Es(r):(n=t,t=e)):(n=t,t=e),t}function ro(){var t,r,a,u;return t=n,(r=ao())!==e?(a=n,c++,u=It(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=Cs(r):(n=t,t=e)):(n=t,t=e),t}function ao(){var t,r,a,u;return t=n,(r=ut())!==e&&(a=ue())!==e&&(u=oe())!==e?t=Fs(r,a,u):(n=t,t=e),t===e&&(t=n,(r=ut())!==e&&(a=ue())!==e?t=Ps(r,a):(n=t,t=e),t===e&&(t=n,(r=ut())!==e&&(a=oe())!==e?t=_s(r,a):(n=t,t=e),t===e&&(t=n,(r=ut())!==e&&(r=Ls(r)),t=r))),t}function ut(){var t,r,a;return(t=V())===e&&(t=n,i.charCodeAt(n)===45?(r=dt,n++):(r=e,c===0&&v(ht)),r===e&&(i.charCodeAt(n)===43?(r=pt,n++):(r=e,c===0&&v(vt))),r!==e&&(a=V())!==e?t=Ms(r,a):(n=t,t=e)),t}function ue(){var t,r,a;return t=n,i.charCodeAt(n)===46?(r=Qe,n++):(r=e,c===0&&v(pr)),r!==e?((a=V())===e&&(a=null),t=Rs(a)):(n=t,t=e),t}function oe(){var t,r,a;return t=n,(r=so())!==e&&(a=V())!==e?t=Ds(r,a):(n=t,t=e),t}function V(){var t,r;if(t=[],(r=ie())!==e)for(;r!==e;)t.push(r),r=ie();else t=e;return t!==e&&(t=Os(t)),t}function ie(){var t;return Gn.test(i.charAt(n))?(t=i.charAt(n),n++):(t=e,c===0&&v(dr)),t}function so(){var t,r,a;return t=n,Wn.test(i.charAt(n))?(r=i.charAt(n),n++):(r=e,c===0&&v(vr)),r!==e?(Yn.test(i.charAt(n))?(a=i.charAt(n),n++):(a=e,c===0&&v(hr)),a===e&&(a=null),t=$s(r,a)):(n=t,t=e),t}function uo(){var t,r,a,u;return t=n,i.substr(n,4).toLowerCase()===Ze?(r=i.substr(n,4),n+=4):(r=e,c===0&&v(mr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=r=[r,a]:(n=t,t=e)):(n=t,t=e),t}function oo(){var t,r,a,u;return t=n,i.substr(n,4).toLowerCase()===Xe?(r=i.substr(n,4),n+=4):(r=e,c===0&&v(gr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=r=[r,a]:(n=t,t=e)):(n=t,t=e),t}function io(){var t,r,a,u;return t=n,i.substr(n,5).toLowerCase()===tn?(r=i.substr(n,5),n+=5):(r=e,c===0&&v(yr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=r=[r,a]:(n=t,t=e)):(n=t,t=e),t}function xt(){var t,r,a,u;return t=n,i.substr(n,2).toLowerCase()===en?(r=i.substr(n,2),n+=2):(r=e,c===0&&v(wr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=Js():(n=t,t=e)):(n=t,t=e),t}function le(){var t,r,a,u;return t=n,i.substr(n,2).toLowerCase()===nn?(r=i.substr(n,2),n+=2):(r=e,c===0&&v(Nr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=Us():(n=t,t=e)):(n=t,t=e),t}function ce(){var t,r,a,u;return t=n,i.substr(n,4).toLowerCase()===rn?(r=i.substr(n,4),n+=4):(r=e,c===0&&v(Ir)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=ks():(n=t,t=e)):(n=t,t=e),t}function lo(){var t,r,a,u;return t=n,i.substr(n,6).toLowerCase()===an?(r=i.substr(n,6),n+=6):(r=e,c===0&&v(br)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=qs():(n=t,t=e)):(n=t,t=e),t}function K(){var t,r,a,u;return t=n,i.substr(n,3).toLowerCase()===sn?(r=i.substr(n,3),n+=3):(r=e,c===0&&v(Tr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=Vs():(n=t,t=e)):(n=t,t=e),t}function ot(){var t,r,a,u;return t=n,i.substr(n,3).toLowerCase()===un?(r=i.substr(n,3),n+=3):(r=e,c===0&&v(xr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=Hs():(n=t,t=e)):(n=t,t=e),t}function fe(){var t,r,a,u;return t=n,i.substr(n,2).toLowerCase()===on?(r=i.substr(n,2),n+=2):(r=e,c===0&&v(Ar)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=Bs():(n=t,t=e)):(n=t,t=e),t}function pe(){var t,r,a,u;return t=n,i.substr(n,7).toLowerCase()===ln?(r=i.substr(n,7),n+=7):(r=e,c===0&&v(Sr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=js():(n=t,t=e)):(n=t,t=e),t}function At(){var t,r,a,u;return t=n,i.substr(n,4).toLowerCase()===cn?(r=i.substr(n,4),n+=4):(r=e,c===0&&v(Er)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=zs():(n=t,t=e)):(n=t,t=e),t}function co(){var t,r,a,u;return t=n,i.substr(n,3).toLowerCase()===fn?(r=i.substr(n,3),n+=3):(r=e,c===0&&v(Cr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=Gs():(n=t,t=e)):(n=t,t=e),t}function fo(){var t,r,a,u;return t=n,i.substr(n,9).toLowerCase()===pn?(r=i.substr(n,9),n+=9):(r=e,c===0&&v(Fr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=Ws():(n=t,t=e)):(n=t,t=e),t}function po(){var t,r,a,u;return t=n,i.substr(n,7).toLowerCase()===dn?(r=i.substr(n,7),n+=7):(r=e,c===0&&v(Pr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=Ys():(n=t,t=e)):(n=t,t=e),t}function de(){var t,r,a,u;return t=n,i.substr(n,4).toLowerCase()===vn?(r=i.substr(n,4),n+=4):(r=e,c===0&&v(_r)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=Ks():(n=t,t=e)):(n=t,t=e),t}function vo(){var t,r,a,u;return t=n,i.substr(n,8).toLowerCase()===hn?(r=i.substr(n,8),n+=8):(r=e,c===0&&v(Lr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=Qs():(n=t,t=e)):(n=t,t=e),t}function ve(){var t,r,a,u;return t=n,i.substr(n,9).toLowerCase()===mn?(r=i.substr(n,9),n+=9):(r=e,c===0&&v(Mr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=Zs():(n=t,t=e)):(n=t,t=e),t}function he(){var t,r,a,u;return t=n,i.substr(n,4).toLowerCase()===gn?(r=i.substr(n,4),n+=4):(r=e,c===0&&v(Rr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=Xs():(n=t,t=e)):(n=t,t=e),t}function ho(){var t,r,a,u;return t=n,i.substr(n,7).toLowerCase()===yn?(r=i.substr(n,7),n+=7):(r=e,c===0&&v(Dr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=tu():(n=t,t=e)):(n=t,t=e),t}function mo(){var t,r,a,u;return t=n,i.substr(n,8).toLowerCase()===wn?(r=i.substr(n,8),n+=8):(r=e,c===0&&v(Or)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=eu():(n=t,t=e)):(n=t,t=e),t}function go(){var t,r,a,u;return t=n,i.substr(n,4).toLowerCase()===Nn?(r=i.substr(n,4),n+=4):(r=e,c===0&&v($r)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=nu():(n=t,t=e)):(n=t,t=e),t}function yo(){var t,r,a,u;return t=n,i.substr(n,4).toLowerCase()===In?(r=i.substr(n,4),n+=4):(r=e,c===0&&v(Jr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=ru():(n=t,t=e)):(n=t,t=e),t}function wo(){var t,r,a,u;return t=n,i.substr(n,2).toLowerCase()===bn?(r=i.substr(n,2),n+=2):(r=e,c===0&&v(Ur)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=au():(n=t,t=e)):(n=t,t=e),t}function No(){var t,r,a,u;return t=n,i.substr(n,7).toLowerCase()===Tn?(r=i.substr(n,7),n+=7):(r=e,c===0&&v(kr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=su():(n=t,t=e)):(n=t,t=e),t}function Io(){var t,r,a,u;return t=n,i.substr(n,8).toLowerCase()===xn?(r=i.substr(n,8),n+=8):(r=e,c===0&&v(qr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=uu():(n=t,t=e)):(n=t,t=e),t}function bo(){var t,r,a,u;return t=n,i.substr(n,5).toLowerCase()===An?(r=i.substr(n,5),n+=5):(r=e,c===0&&v(Vr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=ou():(n=t,t=e)):(n=t,t=e),t}function To(){var t,r,a,u;return t=n,i.substr(n,4).toLowerCase()===Sn?(r=i.substr(n,4),n+=4):(r=e,c===0&&v(Hr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=iu():(n=t,t=e)):(n=t,t=e),t}function xo(){var t,r,a,u;return t=n,i.substr(n,7).toLowerCase()===En?(r=i.substr(n,7),n+=7):(r=e,c===0&&v(Br)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=lu():(n=t,t=e)):(n=t,t=e),t}function Ao(){var t,r,a,u;return t=n,i.substr(n,2).toLowerCase()===Cn?(r=i.substr(n,2),n+=2):(r=e,c===0&&v(jr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=cu():(n=t,t=e)):(n=t,t=e),t}function me(){var t,r,a,u;return t=n,i.substr(n,8).toLowerCase()===Fn?(r=i.substr(n,8),n+=8):(r=e,c===0&&v(zr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=fu():(n=t,t=e)):(n=t,t=e),t}function ge(){var t,r,a,u;return t=n,i.substr(n,4).toLowerCase()===Pn?(r=i.substr(n,4),n+=4):(r=e,c===0&&v(Gr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=pu():(n=t,t=e)):(n=t,t=e),t}function ye(){var t,r,a,u;return t=n,i.substr(n,5).toLowerCase()===_n?(r=i.substr(n,5),n+=5):(r=e,c===0&&v(Wr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=du():(n=t,t=e)):(n=t,t=e),t}function we(){var t,r,a,u;return t=n,i.substr(n,3).toLowerCase()===Ln?(r=i.substr(n,3),n+=3):(r=e,c===0&&v(Yr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=vu():(n=t,t=e)):(n=t,t=e),t}function Ne(){var t,r,a,u;return t=n,i.substr(n,4).toLowerCase()===Mn?(r=i.substr(n,4),n+=4):(r=e,c===0&&v(Kr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=hu():(n=t,t=e)):(n=t,t=e),t}function Ie(){var t,r,a,u;return t=n,i.substr(n,6).toLowerCase()===Rn?(r=i.substr(n,6),n+=6):(r=e,c===0&&v(Qr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=mu():(n=t,t=e)):(n=t,t=e),t}function H(){var t,r,a,u;return t=n,i.substr(n,6).toLowerCase()===Dn?(r=i.substr(n,6),n+=6):(r=e,c===0&&v(Zr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=gu():(n=t,t=e)):(n=t,t=e),t}function it(){var t,r,a,u;return t=n,i.substr(n,4).toLowerCase()===On?(r=i.substr(n,4),n+=4):(r=e,c===0&&v(Xr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=yu():(n=t,t=e)):(n=t,t=e),t}function lt(){var t,r,a,u;return t=n,i.substr(n,3).toLowerCase()===$n?(r=i.substr(n,3),n+=3):(r=e,c===0&&v(ta)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=wu():(n=t,t=e)):(n=t,t=e),t}function be(){var t,r,a,u;return t=n,i.substr(n,4).toLowerCase()===Jn?(r=i.substr(n,4),n+=4):(r=e,c===0&&v(ea)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=Nu():(n=t,t=e)):(n=t,t=e),t}function Te(){var t,r,a,u;return t=n,i.substr(n,4).toLowerCase()===Un?(r=i.substr(n,4),n+=4):(r=e,c===0&&v(na)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=Iu():(n=t,t=e)):(n=t,t=e),t}function So(){var t,r,a,u;return t=n,i.substr(n,4).toLowerCase()===kn?(r=i.substr(n,4),n+=4):(r=e,c===0&&v(ra)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=bu():(n=t,t=e)):(n=t,t=e),t}function ct(){var t;return i.charCodeAt(n)===44?(t=qn,n++):(t=e,c===0&&v(aa)),t}function F(){var t;return i.charCodeAt(n)===40?(t=Vn,n++):(t=e,c===0&&v(sa)),t}function P(){var t;return i.charCodeAt(n)===41?(t=Hn,n++):(t=e,c===0&&v(ua)),t}function p(){var t,r;for(t=[],r=xe();r!==e;)t.push(r),r=xe();return t}function xe(){var t;return Kn.test(i.charAt(n))?(t=i.charAt(n),n++):(t=e,c===0&&v(oa)),t}function Eo(){var t,r,a,u;if(t=n,(r=ee())!==e&&(r=Tu(r)),(t=r)===e)if(t=n,i.charCodeAt(n)===96?(r=$t,n++):(r=e,c===0&&v(Bt)),r!==e){if(a=[],Ut.test(i.charAt(n))?(u=i.charAt(n),n++):(u=e,c===0&&v(jt)),u!==e)for(;u!==e;)a.push(u),Ut.test(i.charAt(n))?(u=i.charAt(n),n++):(u=e,c===0&&v(jt));else a=e;a!==e?(i.charCodeAt(n)===96?(u=$t,n++):(u=e,c===0&&v(Bt)),u!==e?t=xu(a):(n=t,t=e)):(n=t,t=e)}else n=t,t=e;return t}function Co(t,r){return{type:"unary-expression",operator:t,expr:r}}function Ae(t,r,a,u){var h={type:"binary-expression",operator:t,left:r,right:a};return u!==void 0&&(h.escape=u),h}function Fo(t,r){for(var a=[t],u=0;u<r.length;u++)a.push(r[u][3]);return a}function Po(t,r,a){return Fo(t,r)}function Q(t,r){for(var a=t,u=0;u<r.length;u++)a=Ae(r[u][1],a,r[u][3]);return a}if((m=_())!==e&&n===i.length)return m;throw m!==e&&n<i.length&&v(Au()),Su(mt,R<i.length?i.charAt(R):null,R<i.length?Wt(R,R+1):Wt(R,R))}return l(s,Error),s.prototype.format=function(i){var d="Error: "+this.message;if(this.location){var m,e=null;for(m=0;m<i.length;m++)if(i[m].source===this.location.source){e=i[m].text.split(/\r\n|\n|\r/g);break}var N=this.location.start,b=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(N):N,_=this.location.source+":"+b.line+":"+b.column;if(e){var q=this.location.end,O=o("",b.line.toString().length," "),T=e[N.line-1],S=(N.line===q.line?q.column:T.length+1)-N.column||1;d+=`
 --> `+_+`
`+O+` |
`+b.line+" | "+T+`
`+O+" | "+o("",N.column-1," ")+o("",S,"^")}else d+=`
 at `+_}return d},s.buildMessage=function(i,d){var m={literal:function(T){return'"'+N(T.text)+'"'},class:function(T){var S=T.parts.map(function(L){return Array.isArray(L)?b(L[0])+"-"+b(L[1]):b(L)});return"["+(T.inverted?"^":"")+S.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(T){return T.description}};function e(T){return T.charCodeAt(0).toString(16).toUpperCase()}function N(T){return T.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(S){return"\\x0"+e(S)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(S){return"\\x"+e(S)})}function b(T){return T.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(S){return"\\x0"+e(S)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(S){return"\\x"+e(S)})}function _(T){return m[T.type](T)}function q(T){var S,L,E=T.map(_);if(E.sort(),E.length>0){for(S=1,L=1;S<E.length;S++)E[S-1]!==E[S]&&(E[L]=E[S],L++);E.length=L}switch(E.length){case 1:return E[0];case 2:return E[0]+" or "+E[1];default:return E.slice(0,-1).join(", ")+", or "+E[E.length-1]}}function O(T){return T?'"'+N(T)+'"':"end of input"}return"Expected "+q(i)+" but "+O(d)+" found."},{SyntaxError:s,parse:f}},(Pe=St).exports&&(Pe.exports=_e());var qo=St.exports;let Vo=class{static parse(s){return qo.parse(s)}};const ke=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,Ho=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)$/,Bo=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)(\+|\-)(\d{1,2}):(\d{1,2})$/,jo=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})(\+|\-)(\d{1,2}):(\d{1,2})$/,zo=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/,Go=new Set(["current_timestamp","current_date","current_time"]);function B(l,s){return(l+="").length>=s?l:new Array(s-l.length+1).join("0")+l}function Z(l,s,o="0",f="0",i="0",d="0",m="",e="0",N="0"){if(m==="+"||m==="-"){const b=`${B(parseInt(l,10),4)}-${B(parseInt(s,10),2)}-${B(parseInt(o,10),2)}`;let _="";parseFloat(d)<10&&(_="0");const q=`${B(parseInt(f,10),2)}:${B(parseInt(i,10),2)}:${_+parseFloat(d).toString()}`,O=`${m}${B(parseInt(e,10),2)}:${B(parseInt(N,10),2)}`;return new Date(b+"T"+q+O)}return new Date(parseInt(l,10),parseInt(s,10)-1,parseInt(o,10),parseInt(f,10),parseInt(i,10),parseFloat(d))}class Wo{static makeBool(s){return qe(s)}static featureValue(s,o,f,i){return ze(s,o,f,i)}static equalsNull(s){return s===null}static applyLike(s,o,f){return Pt(s,o,f)}static ensureArray(s){return Ct(s)}static applyIn(s,o){return Ft(s,o)}static currentDate(){const s=new Date;return s.setHours(0,0,0,0),s}static makeSqlInterval(s,o,f){return k.createFromValueAndQualifer(s,o,f)}static convertInterval(s){return s instanceof k?s.valueInMilliseconds():s}static currentTimestamp(){return new Date}static compare(s,o,f){return Be(s,o,f)}static calculate(s,o,f){return je(s,o,f)}static makeComparable(s){return U(s)}static evaluateFunction(s,o){return _t(s,o)}static lookup(s,o){const f=o[s];return f===void 0?null:f}static between(s,o){return s==null||o[0]==null||o[1]==null?null:s>=o[0]&&s<=o[1]}static notbetween(s,o){return s==null||o[0]==null||o[1]==null?null:s<o[0]||s>o[1]}static ternaryNot(s){return ft(s)}static ternaryAnd(s,o){return Ve(s,o)}static ternaryOr(s,o){return He(s,o)}}class Lt{constructor(s,o){this.fieldsIndex=o,this._datefields={},this.parameters={},this._hasDateFunctions=void 0,this.parseTree=Vo.parse(s);const{isStandardized:f,isAggregate:i,referencedFieldNames:d}=this._extractExpressionInfo(o);this._referencedFieldNames=d,this.isStandardized=f,this.isAggregate=i}static create(s,o){return new Lt(s,o)}get fieldNames(){return this._referencedFieldNames}testSet(s,o=z){const f={};for(const i of this.fieldNames)f[i]=s.map(d=>o.getAttribute(d,i));return!!this._evaluateNode(this.parseTree,{attributes:f},z)}calculateValue(s,o=z){const f=this._evaluateNode(this.parseTree,s,o);return f instanceof k?f.valueInMilliseconds()/864e5:f}calculateValueCompiled(s,o=z){return this.parseTree._compiledVersion!=null?this.parseTree._compiledVersion(s,this.parameters,o,this._datefields):Se("esri-csp-restrictions")?this.calculateValue(s,o):(this._compileMe(),this.parseTree._compiledVersion(s,this.parameters,o,this._datefields))}testFeature(s,o=z){return!!this._evaluateNode(this.parseTree,s,o)}testFeatureCompiled(s,o=z){return this.parseTree._compiledVersion!=null?!!this.parseTree._compiledVersion(s,this.parameters,o,this._datefields):Se("esri-csp-restrictions")?this.testFeature(s,o):(this._compileMe(),!!this.parseTree._compiledVersion(s,this.parameters,o,this._datefields))}get hasDateFunctions(){return this._hasDateFunctions!=null||(this._hasDateFunctions=!1,this._visitAll(this.parseTree,s=>{s.type==="current-time"?this._hasDateFunctions=!0:s.type==="function"&&(this._hasDateFunctions=this._hasDateFunctions||Go.has(s.name.toLowerCase()))})),this._hasDateFunctions}getFunctions(){const s=new Set;return this._visitAll(this.parseTree,o=>{o.type==="function"&&s.add(o.name.toLowerCase())}),Array.from(s)}getExpressions(){const s=new Map;return this._visitAll(this.parseTree,o=>{if(o.type==="function"){const f=o.name.toLowerCase(),i=o.args.value[0];if(i.type==="column-reference"){const d=i.column,m=`${f}-${d}`;s.has(m)||s.set(m,{aggregateType:f,field:d})}}}),[...s.values()]}getVariables(){const s=new Set;return this._visitAll(this.parseTree,o=>{o.type==="parameter"&&s.add(o.value.toLowerCase())}),Array.from(s)}_compileMe(){const s="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=new Function("feature","lookups","attributeAdapter","datefields",s).bind(Wo)}_extractExpressionInfo(s){const o=[],f=new Set;let i=!0,d=!0;return this._visitAll(this.parseTree,m=>{switch(m.type){case"column-reference":{const e=s?.get(m.column);let N,b;e?N=b=e.name??"":(b=m.column,N=b.toLowerCase()),e&&e.name&&(e.type==="date"||e.type==="esriFieldTypeDate")&&(this._datefields[e.name]=1),f.has(N)||(f.add(N),o.push(b)),m.column=b;break}case"function":{const{name:e,args:N}=m,b=N.value.length;i&&(i=Jo(e,b)),d&&(d=Ro(e,b));break}}}),{referencedFieldNames:Array.from(o),isStandardized:i,isAggregate:d}}_visitAll(s,o){if(s!=null)switch(o(s),s.type){case"when-clause":this._visitAll(s.operand,o),this._visitAll(s.value,o);break;case"case-expression":for(const f of s.clauses)this._visitAll(f,o);s.format==="simple"&&this._visitAll(s.operand,o),s.else!==null&&this._visitAll(s.else,o);break;case"expression-list":for(const f of s.value)this._visitAll(f,o);break;case"unary-expression":this._visitAll(s.expr,o);break;case"binary-expression":this._visitAll(s.left,o),this._visitAll(s.right,o);break;case"function":this._visitAll(s.args,o)}}evaluateNodeToJavaScript(s){switch(s.type){case"interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(s.value)+", "+JSON.stringify(s.qualifier)+","+JSON.stringify(s.op)+")";case"case-expression":{let o="";if(s.format==="simple"){const f="this.makeComparable("+this.evaluateNodeToJavaScript(s.operand)+")";o="( ";for(let i=0;i<s.clauses.length;i++)o+=" ("+f+" === this.makeComparable("+this.evaluateNodeToJavaScript(s.clauses[i].operand)+")) ? ("+this.evaluateNodeToJavaScript(s.clauses[i].value)+") : ";s.else!==null?o+=this.evaluateNodeToJavaScript(s.else):o+="null",o+=" )"}else{o="( ";for(let f=0;f<s.clauses.length;f++)o+=" this.makeBool("+this.evaluateNodeToJavaScript(s.clauses[f].operand)+")===true ? ("+this.evaluateNodeToJavaScript(s.clauses[f].value)+") : ";s.else!==null?o+=this.evaluateNodeToJavaScript(s.else):o+="null",o+=" )"}return o}case"parameter":return"this.lookup("+JSON.stringify(s.value.toLowerCase())+",lookups)";case"expression-list":{let o="[";for(const f of s.value)o!=="["&&(o+=","),o+=this.evaluateNodeToJavaScript(f);return o+="]",o}case"unary-expression":return"this.ternaryNot("+this.evaluateNodeToJavaScript(s.expr)+")";case"binary-expression":switch(s.operator){case"AND":return"this.ternaryAnd("+this.evaluateNodeToJavaScript(s.left)+","+this.evaluateNodeToJavaScript(s.right)+" )";case"OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(s.left)+","+this.evaluateNodeToJavaScript(s.right)+" )";case"IS":if(s.right.type!=="null")throw new Error("Unsupported RHS for IS");return"this.equalsNull("+this.evaluateNodeToJavaScript(s.left)+")";case"ISNOT":if(s.right.type!=="null")throw new Error("Unsupported RHS for IS");return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(s.left)+")))";case"IN":return"this.applyIn("+this.evaluateNodeToJavaScript(s.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(s.right)+"))";case"NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(s.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(s.right)+")))";case"BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(s.left)+","+this.evaluateNodeToJavaScript(s.right)+")";case"NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(s.left)+","+this.evaluateNodeToJavaScript(s.right)+")";case"LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(s.left)+","+this.evaluateNodeToJavaScript(s.right)+","+JSON.stringify(s.escape)+")";case"NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(s.left)+","+this.evaluateNodeToJavaScript(s.right)+","+JSON.stringify(s.escape)+"))";case"<>":case"<":case">":case">=":case"<=":case"=":return"this.compare("+JSON.stringify(s.operator)+","+this.evaluateNodeToJavaScript(s.left)+","+this.evaluateNodeToJavaScript(s.right)+")";case"*":case"-":case"+":case"/":case"||":return"this.calculate("+JSON.stringify(s.operator)+","+this.evaluateNodeToJavaScript(s.left)+","+this.evaluateNodeToJavaScript(s.right)+")"}throw new Error("Not Supported Operator "+s.operator);case"null":case"boolean":case"string":case"number":return JSON.stringify(s.value);case"date":return"(new Date("+Le(s.value).getTime().toString()+"))";case"timestamp":return"(new Date("+Et(s.value).getTime().toString()+"))";case"current-time":return s.mode==="date"?"this.currentDate()":"this.currentTimestamp()";case"column-reference":return"this.featureValue(feature,"+JSON.stringify(s.column)+",datefields,attributeAdapter)";case"function":return"this.evaluateFunction("+JSON.stringify(s.name)+","+this.evaluateNodeToJavaScript(s.args)+")"}throw new Error("Unsupported sql syntax "+s.type)}_evaluateNode(s,o,f){switch(s.type){case"interval":{const i=this._evaluateNode(s.value,o,f);return k.createFromValueAndQualifer(i,s.qualifier,s.op)}case"case-expression":if(s.format==="simple"){const i=U(this._evaluateNode(s.operand,o,f));for(let d=0;d<s.clauses.length;d++)if(i===U(this._evaluateNode(s.clauses[d].operand,o,f)))return this._evaluateNode(s.clauses[d].value,o,f);if(s.else!==null)return this._evaluateNode(s.else,o,f)}else{for(let i=0;i<s.clauses.length;i++)if(qe(this._evaluateNode(s.clauses[i].operand,o,f)))return this._evaluateNode(s.clauses[i].value,o,f);if(s.else!==null)return this._evaluateNode(s.else,o,f)}return null;case"parameter":return this.parameters[s.value.toLowerCase()];case"expression-list":{const i=[];for(const d of s.value)i.push(this._evaluateNode(d,o,f));return i}case"unary-expression":return ft(this._evaluateNode(s.expr,o,f));case"binary-expression":switch(s.operator){case"AND":return Ve(this._evaluateNode(s.left,o,f),this._evaluateNode(s.right,o,f));case"OR":return He(this._evaluateNode(s.left,o,f),this._evaluateNode(s.right,o,f));case"IS":if(s.right.type!=="null")throw new Error("Unsupported RHS for IS");return this._evaluateNode(s.left,o,f)===null;case"ISNOT":if(s.right.type!=="null")throw new Error("Unsupported RHS for IS");return this._evaluateNode(s.left,o,f)!==null;case"IN":{const i=Ct(this._evaluateNode(s.right,o,f));return Ft(this._evaluateNode(s.left,o,f),i)}case"NOT IN":{const i=Ct(this._evaluateNode(s.right,o,f));return ft(Ft(this._evaluateNode(s.left,o,f),i))}case"BETWEEN":{const i=this._evaluateNode(s.left,o,f),d=this._evaluateNode(s.right,o,f);return i==null||d[0]==null||d[1]==null?null:i>=U(d[0])&&i<=U(d[1])}case"NOTBETWEEN":{const i=this._evaluateNode(s.left,o,f),d=this._evaluateNode(s.right,o,f);return i==null||d[0]==null||d[1]==null?null:i<U(d[0])||i>U(d[1])}case"LIKE":return Pt(this._evaluateNode(s.left,o,f),this._evaluateNode(s.right,o,f),s.escape);case"NOT LIKE":return ft(Pt(this._evaluateNode(s.left,o,f),this._evaluateNode(s.right,o,f),s.escape));case"<>":case"<":case">":case">=":case"<=":case"=":return Be(s.operator,this._evaluateNode(s.left,o,f),this._evaluateNode(s.right,o,f));case"-":case"+":case"*":case"/":case"||":return je(s.operator,this._evaluateNode(s.left,o,f),this._evaluateNode(s.right,o,f))}case"null":case"boolean":case"string":case"number":return s.value;case"date":return Le(s.value);case"timestamp":return Et(s.value);case"current-time":{const i=new Date;return s.mode==="date"&&i.setHours(0,0,0,0),i}case"column-reference":return ze(o,s.column,this._datefields,f);case"data-type":return s.value;case"function":{const i=this._evaluateNode(s.args,o,f);return this.isAggregate?Mo(s.name,i):_t(s.name,i)}}throw new Error("Unsupported sql syntax "+s.type)}}function Et(l){let s=Ho.exec(l);if(s!==null){const[,o,f,i,d,m,e]=s;return Z(o,f,i,d,m,e)}if(s=Bo.exec(l),s!==null){const[,o,f,i,d,m,e,N,b,_]=s;return Z(o,f,i,d,m,e,N,b,_)}if(s=jo.exec(l),s!==null){const[,o,f,i,d,m,e,N,b]=s;return Z(o,f,i,d,m,"0",e,N,b)}if(s=zo.exec(l),s!==null){const[,o,f,i,d,m]=s;return Z(o,f,i,d,m)}if(s=ke.exec(l),s!==null){const[,o,f,i]=s;return Z(o,f,i)}throw new Error("SQL Invalid Timestamp")}function Le(l){const s=ke.exec(l);if(s===null)try{return Et(l)}catch{throw new Error("SQL Invalid Date")}const[,o,f,i]=s;return new Date(parseInt(o,10),parseInt(f,10)-1,parseInt(i,10))}function qe(l){return l===!0}function Ct(l){return Array.isArray(l)?l:[l]}function ft(l){return l!==null?l!==!0:null}function Ve(l,s){return l!=null&&s!=null?l===!0&&s===!0:l!==!1&&s!==!1&&null}function He(l,s){return l!=null&&s!=null?l===!0||s===!0:l===!0||s===!0||null}function Ft(l,s){if(l==null)return null;let o=!1;for(const f of s)if(f==null)o=null;else if(l===f){o=!0;break}return o}const Me="-[]/{}()*+?.\\^$|";var G;function Yo(l,s){const o=s;let f="",i=G.Normal;for(let d=0;d<l.length;d++){const m=l.charAt(d);switch(i){case G.Normal:m===o?i=G.Escaped:Me.includes(m)?f+="\\"+m:f+=m==="%"?".*":m==="_"?".":m;break;case G.Escaped:Me.includes(m)?f+="\\"+m:f+=m,i=G.Normal}}return new RegExp("^"+f+"$","m")}function Pt(l,s,o){return l==null?null:Yo(s,o).test(l)}function U(l){return l instanceof Date?l.valueOf():l}function Be(l,s,o){if(s==null||o==null)return null;const f=U(s),i=U(o);switch(l){case"<>":return f!==i;case"=":return f===i;case">":return f>i;case"<":return f<i;case">=":return f>=i;case"<=":return f<=i}}function je(l,s,o){if(l==="||")return _t("concat",[s,o]);if(s instanceof k)if(o instanceof Date)switch(l){case"+":return new Date(s.valueInMilliseconds()+o.getTime());case"-":return s.valueInMilliseconds()-o.getTime();case"*":return s.valueInMilliseconds()*o.getTime();case"/":return s.valueInMilliseconds()/o.getTime()}else if(o instanceof k)switch(l){case"+":return k.createFromMilliseconds(s.valueInMilliseconds()+o.valueInMilliseconds());case"-":return k.createFromMilliseconds(s.valueInMilliseconds()-o.valueInMilliseconds());case"*":return s.valueInMilliseconds()*o.valueInMilliseconds();case"/":return s.valueInMilliseconds()/o.valueInMilliseconds()}else s=s.valueInMilliseconds();else if(o instanceof k)if(s instanceof Date)switch(l){case"+":return new Date(o.valueInMilliseconds()+s.getTime());case"-":return new Date(s.getTime()-o.valueInMilliseconds());case"*":return s.getTime()*o.valueInMilliseconds();case"/":return s.getTime()/o.valueInMilliseconds()}else o=o.valueInMilliseconds();else if(s instanceof Date&&typeof o=="number")switch(o=24*o*60*60*1e3,s=s.getTime(),l){case"+":return new Date(s+o);case"-":return new Date(s-o);case"*":return new Date(s*o);case"/":return new Date(s/o)}else if(o instanceof Date&&typeof s=="number")switch(s=24*s*60*60*1e3,o=o.getTime(),l){case"+":return new Date(s+o);case"-":return new Date(s-o);case"*":return new Date(s*o);case"/":return new Date(s/o)}switch(l){case"+":return s+o;case"-":return s-o;case"*":return s*o;case"/":return s/o}}function Ko(l){return l&&typeof l.attributes=="object"}function ze(l,s,o,f){const i=f.getAttribute(l,s);return i!=null&&o[s]===1?new Date(i):i}(function(l){l[l.Normal=0]="Normal",l[l.Escaped=1]="Escaped"})(G||(G={}));const z={getAttribute:(l,s)=>(Ko(l)?l.attributes:l)[s]},ei=Object.freeze(Object.defineProperty({__proto__:null,WhereClause:Lt,defaultAttributeAdapter:z},Symbol.toStringTag,{value:"Module"}));export{ei as W,Lt as f,M as n,Xo as o,j as s,C as t};
