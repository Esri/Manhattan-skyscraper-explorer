import{g7 as D,bl as $,g8 as z,g9 as C,b_ as v,ga as q,gb as F,gc as G,gd as O}from"./index-112c244d.js";import{u as E}from"./elevationInfoUtils-92bce67b.js";async function B(o,d,l,m,r){const{elevationProvider:g,renderCoordsHelper:c,spatialReference:b}=o,{elevationInfo:h}=d,y=z(h,!0),I=await C(y,b,r);v(r);const i=[],p=new Set,u=new Set;for(const{objectId:e,points:t}of m){const n=l(e);if(n==null){for(const s of t)i.push(s.z??0);p.add(e);continue}n.isDraped&&u.add(e);const a=n.graphic.geometry;w.setFromElevationInfo(E(a,h)),w.updateFeatureExpressionInfoContext(I,n.graphic,d),f.spatialReference=o.spatialReference;for(const{x:s,y:j,z:x}of t)f.x=s,f.y=j,f.z=x??0,q(f,g,w,c,R),i.push(R.z)}return{elevations:i,drapedObjectIds:u,failedObjectIds:p}}const w=new F,f=D(0,0,0,$.WGS84),R=new G;async function H(o,d,l){if(o==null||d.candidates.length===0)return S;const m=o.graphics3DGraphicsByObjectID??o.graphics3DGraphics,r=[],g=[],{renderer:c}=o,b=c!=null&&"arcadeRequired"in c&&c.arcadeRequired?O():null,h=async(e,{graphic:t,graphics3DSymbol:n})=>{const a=await b,s=await o.getRenderingInfoAsync(t,c,a,{signal:l});return s==null?[]:n.queryForSnapping(e,I,s,l)},{candidates:y,spatialReference:I}=d;for(let e=0;e<y.length;++e){const t=y[e],{objectId:n}=t,a=typeof n=="number"?m?.get(n):void 0;if(a==null)continue;const{graphics3DSymbol:s}=a;s.symbologySnappingSupported&&(r.push(h(t,a)),g.push(e))}if(r.length===0)return S;const i=await Promise.all(r);v(l);const p=[],u=[];for(let e=0;e<i.length;++e){const t=i[e],n=g[e];for(const a of t)p.push(a),u.push(n)}return{candidates:p,sourceCandidateIndices:u}}const S={candidates:[],sourceCandidateIndices:[]};export{B as f,H as r};
