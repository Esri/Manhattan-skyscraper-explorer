(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function r(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=r(s);fetch(s.href,n)}})();function R6(t){return t&&(typeof t.on=="function"||typeof t.addEventListener=="function")}function aP(t,e,r){if(!R6(t))throw new TypeError("target is not a Evented or EventTarget object");if("on"in t)return t.on(e,r);if(Array.isArray(e)){const i=e.slice();for(const s of i)t.addEventListener(s,r);return{remove(){for(const s of i)t.removeEventListener(s,r)}}}return t.addEventListener(e,r),{remove(){t.removeEventListener(e,r)}}}function yge(t,e,r){if(!R6(t))throw new TypeError("target is not a Evented or EventTarget object");if("once"in t)return t.once(e,r);const i=aP(t,e,s=>{i.remove(),r.call(t,s)});return{remove(){i.remove()}}}const wDe={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};function RD({key:t}){return wDe[t]||t}function cE(t){return nl(()=>t.forEach(e=>e!=null&&e.remove()))}function nl(t){return{remove:()=>{t&&(t(),t=void 0)}}}function WDt(t){return nl(t!=null?()=>t.destroy():void 0)}function Cc(t,e){return t!=null?e(t):null}function _c(t,e){return M6(t,e),t}function M6(t,e){if(t==null)throw new Error(e??"value is None")}function Ne(t){return t?.destroy(),null}function je(t){return t?.dispose(),null}function Fi(t){return t?.remove(),null}function zl(t){return t?.abort(),null}function Gi(t){return t?.release(),null}function xDe(t,e,r){return t!=null&&e!=null?r!=null?r(t,e):t.equals(e):t===e}function pC(t){return null}function XDt(t,e){const r=new Array;for(const i of t)r.push(i!=null?e(i):null);return r}function YDt(t,e){for(const r of t)Cc(r,e)}function ZDt(t){return t}function TDe(t){return{setTimeout:(e,r)=>{const i=t.setTimeout(e,r);return{remove:()=>t.clearTimeout(i)}}}}const lP=TDe(globalThis);let tR=class L1{constructor(e=1){this._seed=e}set seed(e){this._seed=e??Math.random()*L1._m}getInt(){return this._seed=(L1._a*this._seed+L1._c)%L1._m,this._seed}getFloat(){return this.getInt()/(L1._m-1)}getIntRange(e,r){return Math.round(this.getFloatRange(e,r))}getFloatRange(e,r){const i=r-e;return e+this.getInt()/L1._m*i}};tR._m=2147483647,tR._a=48271,tR._c=0;const P6=1.5,SDe=1/P6,EDe=.5;function I6(t,e){return e?t.filter((r,i,s)=>s.findIndex(e.bind(null,r))===i):t.filter((r,i,s)=>s.indexOf(r)===i)}function u0(t,e,r){if(t==null&&e==null)return!0;if(t==null||e==null||t.length!==e.length)return!1;if(r){for(let i=0;i<t.length;i++)if(!r(t[i],e[i]))return!1}else for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function SY(t,e){let r=t.length!==e.length;r&&(t.length=e.length);for(let i=0;i<e.length;++i)t[i]!==e[i]&&(t[i]=e[i],r=!0);return r}function CDe(t,e,r){let i,s;return r?(i=e.filter(n=>!t.some(o=>r(o,n))),s=t.filter(n=>!e.some(o=>r(o,n)))):(i=e.filter(n=>!t.includes(n)),s=t.filter(n=>!e.includes(n))),{added:i,removed:s}}function ADe(t){return t&&typeof t.length=="number"}function ODe(t,e){const r=t.length;if(r===0)return[];const i=[];for(let s=0;s<r;s+=e)i.push(t.slice(s,s+e));return i}const RDe=!!Array.prototype.fill;function JDt(t,e){if(RDe)return new Array(t).fill(e);const r=new Array(t);for(let i=0;i<t;i++)r[i]=e;return r}function MDe(t,e){e===void 0&&(e=t,t=0);const r=new Array(e-t);for(let i=t;i<e;i++)r[i-t]=i;return r}function _ge(t,e,r){const i=t.length;let s=0,n=i-1;for(;s<n;){const a=s+Math.floor((n-s)/2);e>t[a]?s=a+1:n=a}const o=t[s];return r?e>=t[i-1]?-1:o===e?s:s-1:o===e?s:-1}let vge=class{constructor(){this.last=0}};const bge=new vge;function k7(t,e,r,i){i=i||bge;const s=Math.max(0,i.last-10);for(let o=s;o<r;++o)if(t[o]===e)return i.last=o,o;const n=Math.min(s,r);for(let o=0;o<n;++o)if(t[o]===e)return i.last=o,o;return-1}function JR(t,e,r,i){const s=r??t.length,n=k7(t,e,s,i);if(n!==-1)return t[n]=t[s-1],r==null&&t.pop(),e}const cd=new Set;function PDe(t,e,r=t.length,i=e.length,s,n){if(i===0||r===0)return r;cd.clear();for(let a=0;a<i;++a)cd.add(e[a]);s=s||bge;const o=Math.max(0,s.last-10);for(let a=o;a<r;++a)if(cd.has(t[a])&&(n&&n.push(t[a]),cd.delete(t[a]),t[a]=t[r-1],--r,--a,cd.size===0||r===0))return cd.clear(),r;for(let a=0;a<o;++a)if(cd.has(t[a])&&(n&&n.push(t[a]),cd.delete(t[a]),t[a]=t[r-1],--r,--a,cd.size===0||r===0))return cd.clear(),r;return cd.clear(),r}function IDe(t,e){let r=0;for(let i=0;i<t.length;++i){const s=t[i];e(s,i)&&(t[r]=s,r++)}t.length=r}function $De(t){return t?(jte.seed=t,()=>jte.getFloat()):Math.random}function KDt(t,e){const r=$De(e);for(let i=t.length-1;i>0;i--){const s=Math.floor(r()*(i+1)),n=t[i];t[i]=t[s],t[s]=n}return t}const jte=new tR;function EY(t,e){const r=t.indexOf(e);return r!==-1?(t.splice(r,1),e):null}function eNt(t,e){const r=new Map,i=t.length;for(let s=0;s<i;s++){const n=t[s],o=e(n,s,t),a=r.get(o);a?a.push(n):r.set(o,[n])}return r}function Qf(t,e){return t!=null}const LDe=[];let P_;function ae(t){return typeof P_[t]=="function"?P_[t]=P_[t](globalThis):P_[t]}P_=globalThis.dojoConfig?.has||globalThis.esriConfig?.has?{...globalThis.dojoConfig?.has,...globalThis.esriConfig?.has}:{},ae.add=(t,e,r,i)=>((i||P_[t]===void 0)&&(P_[t]=e),r&&ae(t)),ae.cache=P_,ae.add("esri-deprecation-warnings",!0),ae.add("esri-force-fullscreen-debug",!1),(()=>{ae.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const t=typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;if(ae.add("host-browser",t),ae.add("host-node",typeof globalThis.process=="object"&&globalThis.process.versions?.node&&globalThis.process.versions.v8),ae.add("dom",t),ae("host-browser")){const e=navigator,r=e.userAgent,i=e.appVersion,s=parseFloat(i);if(ae.add("wp",parseFloat(r.split("Windows Phone")[1])||void 0),ae.add("msapp",parseFloat(r.split("MSAppHost/")[1])||void 0),ae.add("khtml",i.includes("Konqueror")?s:void 0),ae.add("edge",parseFloat(r.split("Edge/")[1])||void 0),ae.add("opr",parseFloat(r.split("OPR/")[1])||void 0),ae.add("webkit",!ae("wp")&&!ae("edge")&&parseFloat(r.split("WebKit/")[1])||void 0),ae.add("chrome",!ae("edge")&&!ae("opr")&&parseFloat(r.split("Chrome/")[1])||void 0),ae.add("android",!ae("wp")&&parseFloat(r.split("Android ")[1])||void 0),ae.add("safari",!i.includes("Safari")||ae("wp")||ae("chrome")||ae("android")||ae("edge")||ae("opr")?void 0:parseFloat(i.split("Version/")[1])),ae.add("mac",i.includes("Macintosh")),!ae("wp")&&/(iPhone|iPod|iPad)/.test(r)){const n=RegExp.$1.replace(/P/,"p"),o=/OS ([\d_]+)/.test(r)?RegExp.$1:"1",a=parseFloat(o.replace(/_/,".").replaceAll("_",""));ae.add(n,a),ae.add("ios",a)}ae("webkit")||(!r.includes("Gecko")||ae("wp")||ae("khtml")||ae("edge")||ae.add("mozilla",s),ae("mozilla")&&ae.add("ff",parseFloat(r.split("Firefox/")[1]||r.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const t=navigator.userAgent,e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(t),r=/iPhone/i.test(t);e&&ae.add("esri-mobile",e),r&&ae.add("esri-iPhone",r),ae.add("esri-geolocation",!!navigator.geolocation)}ae.add("esri-wasm","WebAssembly"in globalThis),ae.add("esri-shared-array-buffer",()=>{const t="SharedArrayBuffer"in globalThis,e=globalThis.crossOriginIsolated===!1;return t&&!e}),ae.add("wasm-simd",()=>{const t=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(t))}),ae.add("esri-atomics","Atomics"in globalThis),ae.add("esri-workers","Worker"in globalThis),ae.add("web-feat:cache","caches"in globalThis),ae.add("esri-workers-arraybuffer-transfer",!ae("safari")||Number(ae("safari"))>=12),ae.add("workers-pool-size",8),ae.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),ae.add("featurelayer-simplify-payload-size-factors",[1,1,4]),ae.add("featurelayer-animation-enabled",!0),ae.add("featurelayer-snapshot-enabled",!0),ae.add("featurelayer-snapshot-point-min-threshold",8e4),ae.add("featurelayer-snapshot-point-max-threshold",4e5),ae.add("featurelayer-snapshot-point-coverage",.1),ae.add("featurelayer-advanced-symbols",!1),ae.add("featurelayer-pbf",!0),ae.add("featurelayer-pbf-statistics",!1),ae.add("feature-layers-workers",!0),ae.add("feature-polyline-generalization-factor",1),ae.add("mapview-transitions-duration",200),ae.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),ae.add("mapserver-pbf-version-support",10.81),ae.add("mapservice-popup-identify-max-tolerance",20),ae.add("heatmap-allow-raster-fallback",!1),ae.add("heatmap-force-raster",!1),ae("host-webworker")||ae("host-browser")&&(ae.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),ae.add("esri-image-decode",()=>{if("decode"in new Image){const t=new Image;return t.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void t.decode().then(()=>{ae.add("esri-image-decode",!0,!0,!0)}).catch(()=>{ae.add("esri-image-decode",!1,!0,!0)})}return!1}),ae.add("esri-url-encodes-apostrophe",()=>{const t=window.document.createElement("a");return t.href="?'",t.href.includes("?%27")}))})();function gA(t){return t instanceof ArrayBuffer}function CY(t){return t?.constructor?.name==="Int8Array"}function I_(t){return t?.constructor?.name==="Uint8Array"}function wge(t){return t?.constructor?.name==="Uint8ClampedArray"}function $6(t){return t?.constructor?.name==="Int16Array"}function L6(t){return t?.constructor?.name==="Uint16Array"}function D6(t){return t?.constructor?.name==="Int32Array"}function N6(t){return t?.constructor?.name==="Uint32Array"}function fC(t){return t?.constructor?.name==="Float32Array"}function mC(t){return t?.constructor?.name==="Float64Array"}function Cp(t){return!("buffer"in t)}function $_(t){return t!=null?Cp(t)?8*t.length+12:t.byteLength+xge:0}const xge=145,Pu=1024;function DDe(t){return mC(t)||fC(t)||D6(t)||$6(t)||CY(t)}function NDe(t){return mC(t)||fC(t)}function FDe(t){return mC(t)?179769e303:fC(t)?3402823e32:N6(t)?4294967295:L6(t)?65535:I_(t)||wge(t)?255:D6(t)?2147483647:$6(t)?32767:CY(t)?127:256}function Tge(t,e){let r;if(e)for(r in t)t.hasOwnProperty(r)&&(t[r]===void 0?delete t[r]:t[r]instanceof Object&&Tge(t[r],!0));else for(r in t)t.hasOwnProperty(r)&&t[r]===void 0&&delete t[r];return t}function ee(t){if(!t||typeof t!="object"||typeof t=="function")return t;const e=Cge(t);if(e!=null)return e;if(D4(t))return t.clone();if(Sge(t))return t.map(ee);if(Ege(t))return t.clone();const r={};for(const i of Object.getOwnPropertyNames(t))r[i]=ee(t[i]);return r}function z7(t){if(!t||typeof t!="object"||typeof t=="function"||"HTMLElement"in globalThis&&t instanceof HTMLElement)return t;const e=Cge(t);if(e!=null)return e;if(Sge(t)){let r=!0;const i=t.map(s=>{const n=z7(s);return s!=null&&n==null&&(r=!1),n});return r?i:null}if(D4(t))return t.clone();if(t instanceof File||t instanceof Blob)return t;if(!Ege(t)){const r=new(Object.getPrototypeOf(t)).constructor;for(const i of Object.getOwnPropertyNames(t)){const s=t[i],n=z7(s);if(s!=null&&n==null)return null;r[i]=n}return r}return null}function D4(t){return typeof t.clone=="function"}function Sge(t){return typeof t.map=="function"&&typeof t.forEach=="function"}function Ege(t){return typeof t.notifyChange=="function"&&typeof t.watch=="function"}function Hte(t){if(Object.prototype.toString.call(t)!=="[object Object]")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}function Cge(t){if(CY(t)||I_(t)||wge(t)||$6(t)||L6(t)||D6(t)||N6(t)||fC(t)||mC(t))return t.slice();if(t instanceof Date)return new Date(t.getTime());if(t instanceof ArrayBuffer)return t.slice(0,t.byteLength);if(t instanceof Map){const e=new Map;for(const[r,i]of t)e.set(r,ee(i));return e}if(t instanceof Set){const e=new Set;for(const r of t)e.add(ee(r));return e}return null}function AY(t,e){return t===e||typeof t=="number"&&isNaN(t)&&typeof e=="number"&&isNaN(e)||typeof(t||{}).getTime=="function"&&typeof(e||{}).getTime=="function"&&t.getTime()===e.getTime()||!1}function Age(t,e){return t===e||(t==null||typeof t=="string"?t===e:typeof t=="number"?t===e||typeof e=="number"&&isNaN(t)&&isNaN(e):t instanceof Date?e instanceof Date&&t.getTime()===e.getTime():Array.isArray(t)?Array.isArray(e)&&u0(t,e):t instanceof Set?e instanceof Set&&kDe(t,e):t instanceof Map?e instanceof Map&&zDe(t,e):!!Hte(t)&&Hte(e)&&UDe(t,e))}function UDe(t,e){if(t===null||e===null)return!1;const r=Object.keys(t);if(e===null||Object.keys(e).length!==r.length)return!1;for(const i of r)if(t[i]!==e[i]||!Object.prototype.hasOwnProperty.call(e,i))return!1;return!0}function kDe(t,e){if(t.size!==e.size)return!1;for(const r of t)if(!e.has(r))return!1;return!0}function zDe(t,e){if(t.size!==e.size)return!1;for(const[r,i]of t){const s=e.get(r);if(s!==i||s===void 0&&!e.has(r))return!1}return!0}function Oge(t,e,r=!1){return Mge(t,e,r)}function cP(t,e){if(e!=null)return e[t]||Rge(t.split("."),!1,e)}function ol(t,e,r){const i=t.split("."),s=i.pop(),n=Rge(i,!0,r);n&&s&&(n[s]=e)}function Rge(t,e,r){let i=r;for(const s of t){if(i==null)return;if(!(s in i)){if(!e)return;i[s]={}}i=i[s]}return i}function Mge(t,e,r){return e?Object.keys(e).reduce((i,s)=>{let n=i[s],o=e[s];return n===o?i:n===void 0?(i[s]=ee(o),i):(Array.isArray(o)||Array.isArray(i)?(n=n?Array.isArray(n)?i[s]=n.concat():i[s]=[n]:i[s]=[],o&&(Array.isArray(o)||(o=[o]),r?o.forEach(a=>{n.includes(a)||n.push(a)}):i[s]=o.concat())):o&&typeof o=="object"?i[s]=Mge(n,o,r):i.hasOwnProperty(s)&&!e.hasOwnProperty(s)||(i[s]=o),i)},t||{}):t}const Gr={analysisTheme:{accentColor:[255,127,0],textColor:"white"},apiKey:void 0,applicationName:"",applicationUrl:globalThis.location?.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",userPrivilegesApplied:!1,portalUrl:"https://www.arcgis.com",routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(Oge(Gr,globalThis.esriConfig,!0),delete Gr.has),!Gr.assetsPath){{const t="4.27";Gr.assetsPath=`https://js.arcgis.com/${t}/@arcgis/core/assets`}Gr.defaultAssetsPath=Gr.assetsPath}const VDe=/\{([^\}]+)\}/g;function qte(t){return t??""}function F6(t,e){return t.replaceAll(VDe,typeof e=="object"?(r,i)=>qte(cP(i,e)):(r,i)=>qte(e(i)))}function BDe(t,e){return t.replaceAll(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,r=>e&&e.includes(r)?r:`\\${r}`)}function OY(t){let e=0;for(let r=0;r<t.length;r++)e=(e<<5)-e+t.charCodeAt(r),e|=0;return e}function tNt(t){return new DOMParser().parseFromString(t||"","text/html").body.innerText||""}function rNt(t,e){return new RegExp(`{${e}}`,"ig").test(t)}const Wte={info:0,warn:1,error:2,none:3};let K=class Fa{constructor(e){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},e.level!=null&&(this.level=e.level),e.writer!=null&&(this.writer=e.writer),this._module=e.module,Fa._loggers.set(this.module,this);const r=this.module.lastIndexOf(".");r!==-1&&(this._parent=Fa.getLogger(this.module.slice(0,r)))}get module(){return this._module}get parent(){return this._parent}error(...e){this._log("error","always",...e)}warn(...e){this._log("warn","always",...e)}info(...e){this._log("info","always",...e)}errorOnce(...e){this._log("error","once",...e)}warnOnce(...e){this._log("warn","once",...e)}infoOnce(...e){this._log("info","once",...e)}errorOncePerTick(...e){this._log("error","oncePerTick",...e)}warnOncePerTick(...e){this._log("warn","oncePerTick",...e)}infoOncePerTick(...e){this._log("info","oncePerTick",...e)}get test(){const e=this;return{loggedMessages:e._loggedMessages,clearLoggedWarnings:()=>e._loggedMessages.warn.clear()}}static get test(){return{resetLoggers(e=new Map){const r=Fa._loggers;return Fa._loggers=e,r},set throttlingDisabled(e){Fa._throttlingDisabled=e}}}static getLogger(e){return e=typeof e!="string"?e.declaredClass:e,Fa._loggers.get(e)||new Fa({module:e})}_log(e,r,...i){if(this._matchLevel(e)){if(r!=="always"&&!Fa._throttlingDisabled){const s=this._argsToKey(i),n=this._loggedMessages[e].get(s);if(r==="once"&&n!=null||r==="oncePerTick"&&n&&n>=Fa._tickCounter)return;this._loggedMessages[e].set(s,Fa._tickCounter),Fa._scheduleTickCounterIncrement()}for(const s of Gr.log.interceptors)if(s(e,this.module,...i))return;this._inheritedWriter()(e,this.module,...i)}}_parentWithMember(e,r){let i=this;for(;i!=null;){const s=i[e];if(s!=null)return s;i=i.parent}return r}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(e,r,...i){console[e](`[${r}]`,...i)}_matchLevel(e){const r=Gr.log.level||"warn";return Wte[this._parentWithMember("level",r)]<=Wte[e]}_argsToKey(...e){return OY(JSON.stringify(e,(i,s)=>typeof s!="object"||Array.isArray(s)?s:"[Object]"))}static _scheduleTickCounterIncrement(){Fa._tickCounterScheduled||(Fa._tickCounterScheduled=!0,Promise.resolve().then(()=>{Fa._tickCounter++,Fa._tickCounterScheduled=!1}))}};K._loggers=new Map,K._tickCounter=0,K._tickCounterScheduled=!1,K._throttlingDisabled=!1;function GDe(t,e){return t.replaceAll(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,(r,i)=>i===""?"$":(cP(i,e)??"").toString())}let Pge=class{constructor(e,r,i){this.name=e,this.details=i,this.message=(r&&GDe(r,i))??""}toString(){return"["+this.name+"]: "+this.message}},U=class Ige extends Pge{constructor(e,r,i){super(e,r,i)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(e,r)=>{if(r&&typeof r=="object"&&typeof r.toJSON=="function")return r;try{return ee(r)}catch{return"[object]"}}))}}catch(e){throw K.getLogger("esri.core.Error").error(e),e}return{name:this.name,message:this.message,details:this.details}}static fromJSON(e){return new Ige(e.name,e.message,e.details)}};U.prototype.type="error";function zr(t="Aborted"){return new U("AbortError",t)}function Yt(t,e="Aborted"){if(Mn(t))throw zr(e)}function U6(t){return t!=null?"aborted"in t?t:t.signal:t}function Mn(t){const e=U6(t);return e!=null&&e.aborted}function zo(t){if(ds(t))throw t}function Xte(t){if(!ds(t))throw t}function ya(t,e){const r=U6(t);if(r!=null){if(!r.aborted)return yge(r,"abort",()=>e());e()}}function RY(t,e){const r=U6(t);if(r!=null)return Yt(r),yge(r,"abort",()=>e(zr()))}function $ge(t,e){return U6(e)==null?t:new Promise((r,i)=>{let s=ya(e,()=>i(zr()));const n=()=>s=Fi(s);t.then(n,n),t.then(r,i)})}function ds(t){return t?.name==="AbortError"}async function V7(t){try{return await t}catch(e){if(!ds(e))throw e;return}}async function sNt(t,e=K.getLogger("esri")){try{return await t}catch(r){ds(r)||e.error(r)}}async function Ac(t){if(!t)return;if(typeof t.forEach!="function"){const r=Object.keys(t),i=r.map(o=>t[o]),s=await Ac(i),n={};return r.map((o,a)=>n[o]=s[a]),n}const e=t;return Promise.allSettled(e).then(r=>Array.from(e,(i,s)=>{const n=r[s];return n.status==="fulfilled"?{promise:i,value:n.value}:{promise:i,error:n.reason}}))}async function B7(t){return(await Ac(t)).filter(e=>!!e.value).map(e=>e.value)}function uE(t,e=void 0,r){const i=new AbortController;return ya(r,()=>i.abort()),new Promise((s,n)=>{let o=setTimeout(()=>{o=0,s(e)},t);ya(i,()=>{o&&(clearTimeout(o),n(zr()))})})}function ku(t){return t&&typeof t.then=="function"}function G7(t){return ku(t)?t:Promise.resolve(t)}function MY(t,e=-1){let r,i,s,n,o=null;const a=(...l)=>{if(r){i=l,n&&n.reject(zr()),n=Eo();const f=n.promise;if(o){const m=o;o=null,m.abort()}return f}if(s=n||Eo(),n=null,e>0){const f=new AbortController;r=G7(t(...l,f.signal));const m=r;uE(e).then(()=>{r===m&&(n?f.abort():o=f)})}else r=1,r=G7(t(...l));const c=()=>{const f=i;i=s=r=o=null,f!=null&&a(...f)},h=r,d=s;return h.then(c,c),h.then(d.resolve,d.reject),d.promise};return a}function Eo(){let t,e;const r=new Promise((s,n)=>{t=s,e=n}),i=s=>{t(s)};return i.resolve=s=>t(s),i.reject=s=>e(s),i.timeout=(s,n)=>lP.setTimeout(()=>i.reject(n),s),i.promise=r,i}function nNt(t,e){return t.then(e,e)}async function Yte(t){await Promise.resolve(),Yt(t)}function jDe(t){return t&&t.release&&typeof t.release=="function"}function HDe(t){return t&&t.acquire&&typeof t.acquire=="function"}let qo=class j7{constructor(e,r,i,s=1,n=0){if(this._ctor=e,this._acquireFunction=r,this._releaseFunction=i,this.allocationSize=s,this._pool=new Array(n),this._initialSize=n,this._ctor)for(let o=0;o<n;o++)this._pool[o]=new this._ctor;this.allocationSize=Math.max(s,1)}destroy(){this.prune(0)}acquire(...e){let r;if(j7.test.disabled)r=new this._ctor;else{if(this._pool.length===0){const i=this.allocationSize;for(let s=0;s<i;s++)this._pool[s]=new this._ctor}r=this._pool.pop()}return this._acquireFunction?this._acquireFunction(r,...e):HDe(r)&&r.acquire(...e),r}release(e){e&&!j7.test.disabled&&(this._releaseFunction?this._releaseFunction(e):jDe(e)&&e.release(),this._pool.push(e))}prune(e=this._initialSize){if(!(e>=this._pool.length)){for(let r=e;r<this._pool.length;++r){const i=this._pool[r];this._dispose(i)}this._pool.length=e}}_dispose(e){e.dispose&&typeof e.dispose=="function"&&e.dispose()}};qo.test={disabled:!1};function qDe(t){t.length=0}let xc=class{constructor(e=50,r=50){this._pool=new qo(Array,void 0,qDe,r,e)}acquire(){return this._pool.acquire()}release(e){this._pool.release(e)}prune(){this._pool.prune(0)}static acquire(){return _U.acquire()}static release(e){return _U.release(e)}static prune(){_U.prune()}};const _U=new xc(100);let Lge=class extends qo{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=pC(this._set)}acquire(...e){const r=super.acquire(...e);return this._set.delete(r),r}release(e){e&&!this._set.has(e)&&(super.release(e),this._set.add(e))}_dispose(e){this._set.delete(e),super._dispose(e)}};const pI=[];function hE(t){pI.push(t),pI.length===1&&queueMicrotask(()=>{const e=pI.slice();pI.length=0;for(const r of e)r()})}let Gg=class{constructor(e,r=30){this.name=e,this._counter=0,this._samples=new Array(r)}record(e){e!=null&&(this._samples[++this._counter%this._samples.length]=e)}get median(){return this._samples.slice().sort((e,r)=>e-r)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((e,r)=>e+r,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}};var H7;(function(t){const e=(n,o,a,l)=>{let c=o,h=o;const d=a>>>1,f=n[c-1];for(;h<=d;){h=c<<1,h<a&&l(n[h-1],n[h])<0&&++h;const m=n[h-1];if(l(m,f)<=0)break;n[c-1]=m,c=h}n[c-1]=f},r=(n,o)=>n<o?-1:n>o?1:0;function i(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=r);for(let h=a>>>1;h>o;h--)e(n,h,a,l);const c=o+1;for(let h=a-1;h>o;h--){const d=n[o];n[o]=n[h],n[h]=d,e(n,c,h,l)}}function*s(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=r);for(let h=a>>>1;h>o;h--)e(n,h,a,l),yield;const c=o+1;for(let h=a-1;h>o;h--){const d=n[o];n[o]=n[h],n[h]=d,e(n,c,h,l),yield}}t.sort=i,t.iterableSort=s})(H7||(H7={}));const Zte=H7,WDe=1.5,XDe=1.1;let Vt=class{constructor(e){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new vge,e&&(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator&&(this._allocator=e.allocator),e.deallocator!==void 0&&(this._deallocator=e.deallocator),e.shrink&&(this._shrink=()=>Jte(this)))}toArray(){return this.data.slice(0,this.length)}filter(e){const r=new Array;for(let i=0;i<this._length;i++){const s=this.data[i];e(s)&&r.push(s)}return r}at(e){if((e=Math.trunc(e)||0)<0&&(e+=this._length),!(e<0||e>=this._length))return this.data[e]}includes(e,r){const i=this.data.indexOf(e,r);return i!==-1&&i<this.length}get length(){return this._length}set length(e){if(e>this._length){if(this._allocator){for(;this._length<e;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=e}else{if(this._deallocator)for(let r=e;r<this._length;++r)this.data[r]=this._deallocator(this.data[r]);this._length=e,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(e){this.data[this._length++]=e}pushArray(e,r=e.length){for(let i=0;i<r;i++)this.data[this._length++]=e[i]}fill(e,r){for(let i=0;i<r;i++)this.data[this._length++]=e}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const e=this.data[this._length];return++this._length,e}unshift(e){this.data.unshift(e),this._length++,Jte(this)}pop(){if(this.length===0)return;const e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}remove(e){const r=k7(this.data,e,this.length,this._hint);if(r!==-1)return this.data.splice(r,1),this.length=this.length-1,e}removeUnordered(e){return this.removeUnorderedIndex(k7(this.data,e,this.length,this._hint))}removeUnorderedIndex(e){if(!(e>=this.length||e<0))return this.swapElements(e,this.length-1),this.pop()}removeUnorderedMany(e,r=e.length,i){this.length=PDe(this.data,e,this.length,r,this._hint,i),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(e,r){if(e>=this.length||r>=this.length||e===r)return;const i=this.data[e];this.data[e]=this.data[r],this.data[r]=i}sort(e){Zte.sort(this.data,0,this.length,e)}iterableSort(e){return Zte.iterableSort(this.data,0,this.length,e)}some(e,r){for(let i=0;i<this.length;++i)if(e.call(r,this.data[i],i,this.data))return!0;return!1}find(e,r){for(let i=0;i<this.length;++i){const s=this.data[i];if(e.call(r,s,i))return s}}filterInPlace(e,r){let i=0;for(let s=0;s<this._length;++s){const n=this.data[s];e.call(r,n,s,this.data)&&(this.data[s]=this.data[i],this.data[i]=n,i++)}if(this._deallocator)for(let s=i;s<this._length;s++)this.data[s]=this._deallocator(this.data[s]);return this._length=i,this._shrink(),this}forAll(e,r){const i=this.length,s=this.data;for(let n=0;n<i;++n)e.call(r,s[n],n,s)}forEach(e,r){for(let i=0;i<this.length;++i)e.call(r,this.data[i],i,this.data)}map(e,r){const i=new Array(this.length);for(let s=0;s<this.length;++s)i[s]=e.call(r,this.data[s],s,this.data);return i}reduce(e,r){let i=r;for(let s=0;s<this.length;++s)i=e(i,this.data[s],s,this.data);return i}has(e){const r=this.length,i=this.data;for(let s=0;s<r;++s)if(i[s]===e)return!0;return!1}};function Jte(t){t.data.length>WDe*t.length&&(t.data.length=Math.floor(t.length*XDe))}function uNt(t){return t}function Dge(t){return 1e3*t}function PY(t){return .001*t}function YDe(){return performance.now()}let ZDe=class{constructor(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1}},JDe=class{constructor(e){this.callback=e,this.isActive=!0}remove(){this.isActive=!1}},q7=0,W7=0;const QC={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},X7=["prepare","preRender","render","postRender","update","finish"],Y7=[],Rw=new Vt;let QDe=class{constructor(e){this._task=e}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}};const N4={frameTasks:Rw,willDispatch:!1,clearFrameTasks:KDe,dispatch:Uge,executeFrameTasks:tNe};function gC(t){const e=new JDe(t);return Y7.push(e),N4.willDispatch||(N4.willDispatch=!0,hE(Uge)),e}function dE(t){const e=new ZDe(t);return Rw.push(e),F4==null&&(q7=performance.now(),F4=requestAnimationFrame(Nge)),new QDe(e)}let F4=null;function KDe(t=!1){Rw.forAll(e=>{e.removed=!0}),t&&Fge()}function eNe(t){W7=Math.max(0,t)}function Nge(){const t=performance.now();F4=null,F4=Rw.length>0?requestAnimationFrame(Nge):null,N4.executeFrameTasks(t)}function tNe(t){const e=t-q7;q7=t;const r=W7>0?W7:1e3/60,i=Math.max(0,e-r);QC.time=t,QC.frameDuration=r-i;for(let s=0;s<X7.length;s++){const n=performance.now(),o=X7[s];Rw.forAll(a=>{a.paused||a.removed||(s===0&&a.ticks++,a.phases[o]&&(QC.elapsedFrameTime=performance.now()-t,QC.deltaTime=a.ticks===0?0:e,a.phases[o]?.call(a,QC)))}),rNe[s].record(performance.now()-n)}Fge(),iNe.record(performance.now()-t)}const fI=new Vt;function Fge(){Rw.forAll(t=>{t.removed&&fI.push(t)}),Rw.removeUnorderedMany(fI.data,fI.length),fI.clear()}function Uge(){for(;Y7.length;){const t=Y7.shift();t.isActive&&t.callback()}N4.willDispatch=!1}function fNt(t=1,e){const r=Eo(),i=()=>{Mn(e)?r.reject(zr()):t===0?r():(--t,hE(()=>i()))};return i(),r.promise}const rNe=X7.map(t=>new Gg(t)),iNe=new Gg("total");function MD(t,e){for(const r of t.entries())if(e(r[0]))return!0;return!1}let sNe=0;const nNe=0;function Ic(){return++sNe}function ba(t){return t.__accessor__??null}function oNe(t,e){return t!=null&&t.metadatas&&t.metadatas[e]!=null}function PD(t,e,r){return r?U4(t,e,{policy:r,path:""}):U4(t,e,null)}function U4(t,e,r){return e?Object.keys(e).reduce((i,s)=>{const n=s;let o=null,a="merge";if(r&&(o=r.path?`${r.path}.${s}`:s,a=r.policy(o)),a==="replace"||a==="replace-arrays"&&Array.isArray(i[n]))return i[n]=e[n],i;if(i[n]===void 0)return i[n]=ee(e[n]),i;let l=i[n],c=e[n];if(l===c)return i;if(Array.isArray(c)||Array.isArray(i))l=l?Array.isArray(l)?i[n]=l.concat():i[n]=[l]:i[n]=[],c&&(Array.isArray(c)||(c=[c]),c.forEach(h=>{l.includes(h)||l.push(h)}));else if(c&&typeof c=="object")if(r){const h=r.path;r.path=o,i[n]=U4(l,c,r),r.path=h}else i[n]=U4(l,c,null);else i.hasOwnProperty(s)&&!e.hasOwnProperty(s)||(i[n]=c);return i},t||{}):t}function kge(t){return Array.isArray(t)?t:t.split(".")}function Qte(t){return t.includes(",")?t.split(",").map(e=>e.trim()):[t.trim()]}function aNe(t){if(Array.isArray(t)){const e=[];for(const r of t)e.push(...Qte(r));return e}return Qte(t)}function zge(t,e,r,i){const s=aNe(e);if(s.length!==1){const n=s.map(o=>i(t,o,r));return cE(n)}return i(t,s[0],r)}function IY(t){let e=!1;return()=>{e||(e=!0,t())}}function Vge(t,e){const r=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const s=parseInt(r,10);if(!isNaN(s))return Array.isArray(e)?e[s]:e.at(s)}const i=ba(e);return oNe(i,r)?i.get(r):e[r]}function Bge(t,e,r){if(t==null)return t;const i=Vge(e[r],t);return!i&&r<e.length-1?void 0:r===e.length-1?i:Bge(i,e,r+1)}function uP(t,e,r=0){return typeof e!="string"||e.includes(".")?Bge(t,kge(e),r):Vge(e,t)}function k4(t,e){return uP(t,e)}function Kte(t,e){return uP(e,t)!==void 0}var Ri;(function(t){t[t.Dirty=1]="Dirty",t[t.Overriden=2]="Overriden",t[t.Computing=4]="Computing",t[t.NonNullable=8]="NonNullable",t[t.HasDefaultValue=16]="HasDefaultValue",t[t.DepTrackingInitialized=32]="DepTrackingInitialized",t[t.AutoTracked=64]="AutoTracked",t[t.ExplicitlyTracking=128]="ExplicitlyTracking"})(Ri||(Ri={}));const z4={onObservableAccessed:()=>{},onTrackingEnd:()=>{}},yA=[];let rR=z4;function qt(t){rR.onObservableAccessed(t)}let ID=!1,$D=!1;function h0(t,e,r){if(ID)return $Y(t,e,r);Gge(t);const i=e.call(r);return jge(),i}function lNe(t,e){return h0(z4,t,e)}function $Y(t,e,r){const i=ID;ID=!0,Gge(t);let s=null;try{s=e.call(r)}catch(n){$D&&K.getLogger("esri.core.accessorSupport.tracking").error(n)}return jge(),ID=i,s}function Gge(t){rR=t,yA.push(t)}function jge(){const t=yA.length;if(t>1){const e=yA.pop();rR=yA[t-2],e.onTrackingEnd()}else if(t===1){const e=yA.pop();rR=z4,e.onTrackingEnd()}else rR=z4}function Hge(t,e){const r=e.observerObject;if(r.flags&Ri.DepTrackingInitialized)return;const i=$D;$D=!1,r.flags&Ri.AutoTracked?$Y(e,e.metadata.get,t):qge(t,e),$D=i}const cNe=[];function qge(t,e){const r=e.observerObject;r.flags&Ri.ExplicitlyTracking||(r.flags|=Ri.ExplicitlyTracking,$Y(e,()=>{const i=e.metadata.dependsOn||cNe;for(const s of i)if(typeof s!="string"||s.includes(".")){const n=kge(s);for(let o=0,a=t;o<n.length&&a!=null&&typeof a=="object";++o)a=ere(a,n[o],o!==n.length-1)}else ere(t,s,!1)}),r.flags&=~Ri.ExplicitlyTracking)}function ere(t,e,r){const i=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const n=parseInt(i,10);if(!isNaN(n))return Array.isArray(t)?t[n]:t.at(n)}const s=ba(t);if(s){const n=s.propertiesByName.get(i);n&&(qt(n.observerObject),Hge(t,n))}return r?t[i]:void 0}let k6=class{constructor(e){this._accessed=[],this._handles=[],this._observerObject=new uNe(e),tre.register(this,new WeakRef(this._observerObject),this)}destroy(){tre.unregister(this._observerObject),this._accessed.length=0,this._observerObject?.destroy(),this.clear()}onObservableAccessed(e){const r=this._accessed;r.includes(e)||r.push(e)}onTrackingEnd(){const e=this._handles,r=this._accessed,i=this._observerObject;for(let s=0;s<r.length;++s)e.push(r[s].observe(i));r.length=0}clear(){const e=this._handles;for(let r=0;r<e.length;++r)e[r].remove();e.length=0}},uNe=class{constructor(e){this._notify=e,this._invalidCount=0,this.destroyed=!1}onInvalidated(){this._invalidCount++}onCommitted(){if(this.destroyed)return;const e=this._invalidCount;if(e===1)return this._invalidCount=0,void this._notify();this._invalidCount=e>0?e-1:0}destroy(){this.destroyed=!0,this._notify=hNe}};const tre=new FinalizationRegistry(t=>{t.deref()?.destroy()});function hNe(){}let ES=!1;const V4=[];function Wge(t,e){let r=new k6(n),i=null,s=!1;function n(){if(!r||s)return;if(ES)return void Zge(n);const a=i;r.clear(),ES=!0,s=!0,i=h0(r,t),s=!1,ES=!1,e(i,a),Jge()}function o(){r&&(r.destroy(),r=null,i=null)}return s=!0,i=h0(r,t),s=!1,{remove:o}}function Xge(t,e){let r=new k6(s),i=null;function s(){e(i,o)}function n(){r&&(r.destroy(),r=null),i=null}function o(){return r?(r.clear(),i=h0(r,t),i):null}return o(),{remove:n}}function Yge(t){let e=new k6(i),r=!1;function i(){e&&!r&&(ES?Zge(i):(e.clear(),ES=!0,r=!0,h0(e,t),r=!1,ES=!1,Jge()))}function s(){e&&(e.destroy(),e=null)}return r=!0,h0(e,t),r=!1,{remove:s}}function Zge(t){V4.includes(t)||V4.unshift(t)}function Jge(){for(;V4.length;)V4.pop()()}var iR;(function(t){t[t.Untracked=0]="Untracked",t[t.Tracked=1]="Tracked"})(iR||(iR={}));let QR=class{constructor(){this.uid=Ic(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(e,r,i,s,n){return this.pool.acquire(iR.Untracked,e,r,i,s,n,AY)}static acquireTracked(e,r,i,s){return this.pool.acquire(iR.Tracked,e,r,i,null,null,s)}notify(e,r){this.type===iR.Untracked?this.callback.call(this.target,e,r,this.path,this.target):this.callback.call(null,e,r,void 0,void 0)}acquire(e,r,i,s,n,o,a){this.uid=Ic(),this.removed=!1,this.type=e,this.oldValue=r,this.callback=i,this.getValue=s,this.target=n,this.path=o,this.equals=a}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=Ic(),this.removed=!0}};QR.pool=new Lge(QR);const LD=new xc,Jg=new Set;let B4;function G4(t){Jg.delete(t),Jg.add(t),B4||(B4=gC(fNe))}function dNe(t){if(t.removed)return;const e=t.oldValue,r=t.getValue();t.equals(e,r)||(t.oldValue=r,t.notify(r,e))}function pNe(t){for(const e of Jg.values())e.target===t&&(e.removed=!0)}function fNe(){let t=10;for(;B4&&t--;){B4=null;const e=mNe(),r=LD.acquire();for(const i of e){const s=i.uid;dNe(i),s===i.uid&&i.removed&&r.push(i)}for(const i of Jg)i.removed&&(r.push(i),Jg.delete(i));for(const i of r)QR.pool.release(i);LD.release(r),LD.release(e),Z7.forEach(i=>i())}}function mNe(){const t=LD.acquire();t.length=Jg.size;let e=0;for(const r of Jg)t[e]=r,++e;return Jg.clear(),t}const Z7=new Set;function Qge(t){return Z7.add(t),{remove(){Z7.delete(t)}}}function gNe(t,e,r){let i=zge(t,e,r,(s,n,o)=>{let a,l,c=Xge(()=>uP(s,n),(h,d)=>{s.__accessor__.destroyed||a&&a.uid!==l?i.remove():(a||(a=QR.acquireUntracked(h,o,d,s,n),l=a.uid),G4(a))});return{remove:IY(()=>{c.remove(),a&&(a.uid!==l||a.removed||(a.removed=!0,G4(a)),a=null),i=c=null})}});return i}function yNe(t,e,r){const i=zge(t,e,r,(s,n,o)=>{let a=!1;return Wge(()=>uP(s,n),(l,c)=>{s.__accessor__.destroyed?i.remove():a||(a=!0,AY(c,l)||o.call(s,l,c,n,s),a=!1)})});return i}function _Ne(t,e,r,i=!1){return!t.__accessor__||t.__accessor__.destroyed?{remove(){}}:i?yNe(t,e,r):gNe(t,e,r)}function vNe(t,e,r){let i,s,n=Xge(t,(o,a)=>{i&&i.uid!==s?n.remove():(i||(i=QR.acquireTracked(o,e,a,r),s=i.uid),G4(i))});return{remove:IY(()=>{n.remove(),i&&(i.uid!==s||i.removed||(i.removed=!0,G4(i)),i=null),n=null})}}function bNe(t,e,r){let i=!1;return Wge(t,(s,n)=>{i||(i=!0,r(n,s)||e(s,n),i=!1)})}function wNe(t,e,r=!1,i=Age){return r?bNe(t,e,i):vNe(t,e,i)}function rre(t){return MD(Jg,e=>e.oldValue===t)}function le(t,e,r={}){return LY(t,e,r,Kge)}function Iu(t,e,r={}){return LY(t,e,r,e0e)}function LY(t,e,r={},i){let s=null;const n=r.once?(o,a)=>{i(o)&&(Fi(s),e(o,a))}:(o,a)=>{i(o)&&e(o,a)};if(s=wNe(t,n,r.sync,r.equals),r.initial){const o=t();n(o,o)}return s}function _a(t,e,r,i={}){let s=null,n=null,o=null;function a(){s&&n&&(n.remove(),i.onListenerRemove?.(s),s=null,n=null)}function l(h){i.once&&i.once&&Fi(o),r(h)}const c=le(t,(h,d)=>{a(),R6(h)&&(s=h,n=aP(h,e,l),i.onListenerAdd?.(h))},{sync:i.sync,initial:!0});return o=nl(()=>{c.remove(),a()}),o}function d0(t,e){return xNe(t,e0e,e)}function xNe(t,e,r){if(Mn(r))return Promise.reject(zr());const i=t();if(e?.(i))return Promise.resolve(i);let s=null;function n(){s=Fi(s)}return new Promise((o,a)=>{s=cE([ya(r,()=>{n(),a(zr())}),LY(t,l=>{n(),o(l)},{sync:!1,once:!0},e??Kge)])})}function Kge(t){return!0}function e0e(t){return!!t}const Wr={sync:!0},Pr={initial:!0},Ls={sync:!0,initial:!0};function u(t,e,r,i){var s,n=arguments.length,o=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(o=(n<3?s(o):n>3?s(e,r,o):s(e,r))||o);return n>3&&o&&Object.defineProperty(e,r,o),o}function _Nt(t,e,r,i){function s(n){return n instanceof r?n:new r(function(o){o(n)})}return new(r||(r=Promise))(function(n,o){function a(h){try{c(i.next(h))}catch(d){o(d)}}function l(h){try{c(i.throw(h))}catch(d){o(d)}}function c(h){h.done?n(h.value):s(h.value).then(a,l)}c((i=i.apply(t,e||[])).next())})}const TNe="modulepreload",SNe=function(t,e){return new URL(t,e).href},ire={},he=function(e,r,i){if(!r||r.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(r.map(n=>{if(n=SNe(n,i),n in ire)return;ire[n]=!0;const o=n.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!i)for(let h=s.length-1;h>=0;h--){const d=s[h];if(d.href===n&&(!o||d.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${n}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":TNe,o||(c.as="script",c.crossOrigin=""),c.href=n,document.head.appendChild(c),o)return new Promise((h,d)=>{c.addEventListener("load",h),c.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>e())};function vNt(t){const e=[];return function*(){yield*e;for(const r of t)e.push(r),yield r}}function ENe(t,e){for(const r of t)if(r!=null&&e(r))return r}function J7(t){return t!=null&&typeof t[Symbol.iterator]=="function"}let $i=class Q7{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(r=>{e+=r.length}),e}add(e,r){if(J7(e)){const i=this._getOrCreateGroup(r);for(const s of e)this._isHandle(s)&&i.push(s)}else this._isHandle(e)&&this._getOrCreateGroup(r).push(e);return this}forEach(e,r){if(typeof e=="function")this._groups.forEach(i=>i.forEach(e));else{const i=this._getGroup(e);i&&r&&i.forEach(r)}}has(e){return this._groups.has(this._ensureGroupKey(e))}remove(e){if(typeof e!="string"&&J7(e)){for(const r of e)this.remove(r);return this}return this.has(e)?(this._removeAllFromGroup(this._getGroup(e)),this._groups.delete(this._ensureGroupKey(e)),this):this}removeAll(){return this._groups.forEach(e=>this._removeAllFromGroup(e)),this._groups.clear(),this}_isHandle(e){return e&&(!!e.remove||e instanceof Q7)}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const r=[];return this._groups.set(this._ensureGroupKey(e),r),r}_getGroup(e){return this._groups.get(this._ensureGroupKey(e))}_ensureGroupKey(e){return e||"_default_"}_removeAllFromGroup(e){for(const r of e)r instanceof Q7?r.removeAll():r.remove()}};const t0e=Symbol("Accessor-beforeDestroy");function hP(t){let e=t.constructor.__accessorMetadata__;const r=Object.prototype.hasOwnProperty.call(t.constructor,"__accessorMetadata__");if(e){if(!r){e=Object.create(e);for(const i in e)e[i]=ee(e[i]);Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0})}}else e={},Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0});return t.constructor.__accessorMetadata__}function dP(t,e){const r=hP(t);let i=r[e];return i||(i=r[e]={}),i}function CNe(t,e){return PD(t,e,ONe)}const ANe=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function ONe(t){return ANe.test(t)?"replace":"merge"}var zg;(function(t){t[t.INITIALIZING=0]="INITIALIZING",t[t.CONSTRUCTING=1]="CONSTRUCTING",t[t.CONSTRUCTED=2]="CONSTRUCTED"})(zg||(zg={}));let RNe=class{constructor(e,r){this._observers=e,this._observer=r}remove(){EY(this._observers,this._observer)}},r0e=class{constructor(){this._observers=null,this.destroyed=!1}observe(e){if(this.destroyed||e.destroyed)return MNe;this._observers==null&&(this._observers=[]);const r=this._observers;let i=!1,s=!1;const n=r.length;for(let o=0;o<n;++o){const a=r[o];if(a.destroyed)s=!0;else if(a===e){i=!0;break}}return i||(r.push(e),s&&this._removeDestroyedObservers()),new RNe(r,e)}_removeDestroyedObservers(){const e=this._observers;if(!e||e.length===0)return;const r=e.length;let i=0;for(let s=0;s<r;++s){for(;s+i<r&&e[s+i].destroyed;)++i;if(i>0){if(!(s+i<r))break;e[s]=e[s+i]}}e.length=r-i}destroy(){if(this.destroyed)return;this.destroyed=!0;const e=this._observers;if(e!=null){for(const r of e)r.onCommitted();this._observers=null}}};const MNe=nl();var mr;(function(t){t[t.DEFAULTS=0]="DEFAULTS",t[t.COMPUTED=1]="COMPUTED",t[t.SERVICE=2]="SERVICE",t[t.PORTAL_ITEM=3]="PORTAL_ITEM",t[t.WEB_SCENE=4]="WEB_SCENE",t[t.WEB_MAP=5]="WEB_MAP",t[t.LINK_CHART=6]="LINK_CHART",t[t.USER=7]="USER"})(mr||(mr={}));const K7=mr.USER+1;function jg(t){switch(t){case"defaults":return mr.DEFAULTS;case"service":return mr.SERVICE;case"portal-item":return mr.PORTAL_ITEM;case"web-scene":return mr.WEB_SCENE;case"web-map":return mr.WEB_MAP;case"link-chart":return mr.LINK_CHART;case"user":return mr.USER;default:return null}}function j4(t){switch(t){case mr.DEFAULTS:return"defaults";case mr.SERVICE:return"service";case mr.PORTAL_ITEM:return"portal-item";case mr.WEB_SCENE:return"web-scene";case mr.WEB_MAP:return"web-map";case mr.LINK_CHART:return"link-chart";case mr.USER:return"user"}return void 0}function PNe(t){return j4(t)}let sre=class{constructor(e,r){this.propertyName=e,this.metadata=r,this.observerObject=new INe,this._accessed=null,this._handles=null,this.observerObject.flags=Ri.Dirty|(r.nonNullable?Ri.NonNullable:0)|(r.hasOwnProperty("value")?Ri.HasDefaultValue:0)|(r.get===void 0?Ri.DepTrackingInitialized:0)|(r.dependsOn===void 0?Ri.AutoTracked:0)}destroy(){this.observerObject.destroy(),this._accessed=null,this._clearObservationHandles()}getComputed(e){const r=this.observerObject;qt(r);const i=e.store,s=this.propertyName,n=r.flags,o=i.get(s);if(n&Ri.Computing||~n&Ri.Dirty&&i.has(s))return o;r.flags|=Ri.Computing;const a=e.host;let l;n&Ri.AutoTracked?l=h0(this,this.metadata.get,a):(qge(a,this),l=this.metadata.get.call(a)),i.set(s,l,mr.COMPUTED);const c=i.get(s);return c===o?r.flags&=~Ri.Dirty:lNe(this.commit,this),r.flags&=~Ri.Computing,c}onObservableAccessed(e){if(e===this.observerObject)return;let r=this._accessed;if(r==null)r=[],this._accessed=r;else if(r.includes(e))return;r.push(e)}onTrackingEnd(){this._clearObservationHandles();const e=this.observerObject;e.flags|=Ri.DepTrackingInitialized;const r=this._accessed;if(r==null||r.length===0)return;let i=this._handles;i==null&&(i=[],this._handles=i);for(let s=0;s<r.length;++s)i.push(r[s].observe(e));r.length=0}notifyChange(){const e=this.observerObject;e.onInvalidated(),e.onCommitted()}invalidate(){this.observerObject.onInvalidated()}commit(){const e=this.observerObject;e.flags&=~Ri.Dirty,e.onCommitted()}_clearObservationHandles(){const e=this._handles;if(e!==null){for(let r=0;r<e.length;++r)e[r].remove();e.length=0}}},INe=class extends r0e{constructor(){super(...arguments),this.flags=0}onInvalidated(){~this.flags&Ri.Overriden&&(this.flags|=Ri.Dirty);const e=this._observers;if(e&&e.length>0)for(const r of e)r.onInvalidated()}onCommitted(){const e=this._observers;if(e&&e.length>0){const r=e.slice();for(const i of r)i.onCommitted()}}destroy(){this.flags&Ri.Dirty&&this.onCommitted(),super.destroy()}},$Ne=class i0e{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const r=new i0e;return this._values.forEach((i,s)=>{e&&e.has(s)||r.set(s,ee(i))}),r}get(e){return this._values.get(e)}originOf(){return mr.USER}keys(){return[...this._values.keys()]}set(e,r){this._values.set(e,r)}delete(e){this._values.delete(e)}has(e){return this._values.has(e)}forEach(e){this._values.forEach(e)}};function mI(t,e,r){return t!==void 0}function nre(t,e,r,i){return t!==void 0&&(!(r==null&&t.observerObject.flags&Ri.NonNullable)||(i.lifecycle,zg.INITIALIZING,!1))}function LNe(t){return t&&typeof t.destroy=="function"}K.getLogger("esri.core.accessorSupport.Properties");let DNe=class{constructor(e){this.host=e,this.propertiesByName=new Map,this.ctorArgs=null,this.destroyed=!1,this.lifecycle=zg.INITIALIZING,this.store=new $Ne,this._origin=mr.USER;const r=this.host.constructor.__accessorMetadata__;for(const i in r){const s=new sre(i,r[i]);this.propertiesByName.set(i,s)}this.metadatas=r}initialize(){this.lifecycle=zg.CONSTRUCTING}constructed(){this.lifecycle=zg.CONSTRUCTED}destroy(){this.destroyed=!0;for(const[e,r]of this.propertiesByName){if(r.metadata.autoDestroy){const i=this.internalGet(e);i&&LNe(i)&&(i.destroy(),~r.observerObject.flags&Ri.NonNullable&&this._internalSet(r,null))}r.destroy()}}get initialized(){return this.lifecycle!==zg.INITIALIZING}get(e){const r=this.propertiesByName.get(e);if(r.metadata.get)return r.getComputed(this);qt(r.observerObject);const i=this.store;return i.has(e)?i.get(e):r.metadata.value}originOf(e){const r=this.store.originOf(e);if(r===void 0){const i=this.propertiesByName.get(e);if(i!==void 0&&i.observerObject.flags&Ri.HasDefaultValue)return"defaults"}return j4(r)}has(e){return!!this.propertiesByName.has(e)&&this.store.has(e)}keys(){return[...this.propertiesByName.keys()]}internalGet(e){const r=this.propertiesByName.get(e);if(mI(r))return this.store.has(e)?this.store.get(e):r.metadata.value}internalSet(e,r){const i=this.propertiesByName.get(e);mI(i)&&this._internalSet(i,r)}getDependsInfo(e,r,i){const s=this.propertiesByName.get(r);if(!mI(s))return"";const n=new Set,o=h0({onObservableAccessed:l=>n.add(l),onTrackingEnd:()=>{}},()=>s.metadata.get?.call(e));let a=`${i}${e.declaredClass.split(".").pop()}.${r}: ${o}
`;if(n.size===0)return a;i+="  ";for(const l of n)l instanceof sre&&(a+=`${i}${l.propertyName}: undefined
`);return a}setAtOrigin(e,r,i){const s=this.propertiesByName.get(e);if(mI(s))return this._setAtOrigin(s,r,i)}isOverridden(e){const r=this.propertiesByName.get(e);return r!==void 0&&!!(r.observerObject.flags&Ri.Overriden)}clearOverride(e){const r=this.propertiesByName.get(e),i=r?.observerObject;i&&i.flags&Ri.Overriden&&(i.flags&=~Ri.Overriden,r.notifyChange())}override(e,r){const i=this.propertiesByName.get(e);if(!nre(i,e,r,this))return;const s=i.metadata.cast;if(s){const n=this._cast(s,r),{valid:o,value:a}=n;if(vU.release(n),!o)return;r=a}i.observerObject.flags|=Ri.Overriden,this._internalSet(i,r)}set(e,r){const i=this.propertiesByName.get(e);if(!nre(i,e,r,this))return;const s=i.metadata.cast;if(s){const o=this._cast(s,r),{valid:a,value:l}=o;if(vU.release(o),!a)return;r=l}const n=i.metadata.set;n?n.call(this.host,r):this._internalSet(i,r)}setDefaultOrigin(e){this._origin=jg(e)}getDefaultOrigin(){return j4(this._origin)}notifyChange(e){const r=this.propertiesByName.get(e);r!==void 0&&r.notifyChange()}invalidate(e){const r=this.propertiesByName.get(e);r!==void 0&&r.invalidate()}commit(e){const r=this.propertiesByName.get(e);r!==void 0&&r.commit()}_internalSet(e,r){const i=this.lifecycle!==zg.INITIALIZING?this._origin:mr.DEFAULTS;this._setAtOrigin(e,r,i)}_setAtOrigin(e,r,i){const s=this.store,n=e.propertyName;s.has(n,i)&&AY(r,s.get(n))&&~e.observerObject.flags&Ri.Overriden&&i===s.originOf(n)||(e.invalidate(),s.set(n,r,i),e.commit(),Hge(this.host,e))}_cast(e,r){const i=vU.acquire();return i.valid=!0,i.value=r,e&&(i.value=e.call(this.host,r,i)),i}},NNe=class{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}};const vU=new qo(NNe);function H4(t,e,r){if(t&&e)if(typeof e=="object")for(const i of Object.getOwnPropertyNames(e))H4(t,i,e[i]);else{if(e.includes(".")){const s=e.split("."),n=s.splice(s.length-1,1)[0];return void H4(k4(t,s),n,r)}const i=t.__accessor__;i!=null&&FNe(e,i),t[e]=r}}function FNe(t,e){if(ae("esri-unknown-property-errors")&&!UNe(t,e))throw new U("set:unknown-property",kNe(t,e))}function UNe(t,e){return e.metadatas[t]!=null}function kNe(t,e){return"setting unknown property '"+t+"' on instance of "+e.host.declaredClass}let zNe;function VNe(){return zNe}function Bo(t,e){for(const[r,i]of t)if(e(i,r))return!0;return!1}function CNt(t,e){for(const[r,i]of t)if(e(i,r))return i;return null}function s0e(t,e,r){const i=t.get(e);if(i!==void 0)return i;const s=r();return t.set(e,s),s}const CS=K.getLogger("esri.core.accessorSupport.ensureTypes");function BNe(t){return t==null?t:new Date(t)}function GNe(t){return t==null?t:!!t}function pP(t){return t==null?t:t.toString()}function Eh(t){return t==null?t:(t=parseFloat(t),isNaN(t)?0:t)}function DY(t){return t==null?t:Math.round(parseFloat(t))}function n0e(t){return t&&t.constructor&&t.constructor.__accessorMetadata__!==void 0}function q4(t,e){return e!=null&&t&&!(e instanceof t)}function o0e(t){return t&&"isCollection"in t}function ore(t){return t&&t.Type?typeof t.Type=="function"?t.Type:t.Type.base:null}function jNe(t,e){if(!e||!e.constructor||!o0e(e.constructor))return eB(t,e)?e:new t(e);const r=ore(t.prototype.itemType),i=ore(e.constructor.prototype.itemType);return r?i?r===i?e:r.prototype.isPrototypeOf(i.prototype)?new t(e):(eB(t,e),e):new t(e):e}function eB(t,e){return!!n0e(e)&&(CS.error("Accessor#set","Assigning an instance of '"+(e.declaredClass||"unknown")+"' which is not a subclass of '"+z6(t)+"'"),!0)}function Mw(t,e){return e==null?e:o0e(t)?jNe(t,e):q4(t,e)?eB(t,e)?e:new t(e):e}function z6(t){return t&&t.prototype&&t.prototype.declaredClass||"unknown"}const HNe=new WeakMap;function qNe(t){switch(t){case Number:return Eh;case Ki:return DY;case Boolean:return GNe;case String:return pP;case Date:return BNe;default:return s0e(HNe,t,()=>Mw.bind(null,t))}}function ws(t,e){const r=qNe(t);return arguments.length===1?r:r(e)}function KR(t,e,r){return arguments.length===1?KR.bind(null,t):e&&(Array.isArray(e)?e.map(i=>t(i,r)):[t(e,r)])}function WNe(t,e){return arguments.length===1?KR(r=>ws(t,r)):KR(r=>ws(t,r),e)}function a0e(t,e,r){return e!==0&&Array.isArray(r)?r.map(i=>a0e(t,e-1,i)):t(r)}function W4(t,e,r){if(arguments.length===2)return n=>W4(t,e,n);if(!r)return r;r=a0e(t,e,r);let i=e,s=r;for(;i>0&&Array.isArray(s);)i--,s=s[0];if(s!==void 0)for(let n=0;n<i;n++)r=[r];return r}function XNe(t,e,r){return arguments.length===2?W4(i=>ws(t,i),e):W4(i=>ws(t,i),e,r)}function l0e(t){return!!Array.isArray(t)&&!t.some(e=>{const r=typeof e;return!(r==="string"||r==="number"||r==="function"&&t.length>1)})}function tB(t,e){if(arguments.length===2)return tB(t).call(null,e);const r=new Set,i=t.filter(a=>typeof a!="function"),s=t.filter(a=>typeof a=="function");for(const a of t)typeof a!="string"&&typeof a!="number"||r.add(a);let n=null,o=null;return(a,l)=>{if(a==null)return a;const c=typeof a,h=c==="string"||c==="number";return h&&(r.has(a)||s.some(d=>c==="string"&&d===String||c==="number"&&d===Number))||c==="object"&&s.some(d=>!q4(a,d))?a:(h&&i.length?(n||(n=i.map(d=>typeof d=="string"?`'${d}'`:`${d}`).join(", ")),CS.error("Accessor#set",`'${a}' is not a valid value for this property, only the following values are valid: ${n}`)):typeof a=="object"&&s.length?(o||(o=s.map(d=>z6(d)).join(", ")),CS.error("Accessor#set",`'${a}' is not a valid value for this property, value must be one of ${o}`)):CS.error("Accessor#set",`'${a}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function Ap(t,e){if(arguments.length===2)return Ap(t).call(null,e);const r={},i=[],s=[];for(const l in t.typeMap){const c=t.typeMap[l];r[l]=ws(c),i.push(z6(c)),s.push(l)}const n=()=>`'${i.join("', '")}'`,o=()=>`'${s.join("', '")}'`,a=typeof t.key=="string"?l=>l[t.key]:t.key;return l=>{if(t.base&&!q4(t.base,l)||l==null)return l;const c=a(l)||t.defaultKeyValue,h=r[c];if(!h)return CS.error("Accessor#set",`Invalid property value, value needs to be one of ${n()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!q4(t.typeMap[c],l))return l;if(typeof t.key=="string"&&!n0e(l)){const d={};for(const f in l)f!==t.key&&(d[f]=l[f]);return h(d)}return h(l)}}let Ki=class{};const ONt={native:t=>({type:"native",value:t}),array:t=>({type:"array",value:t}),oneOf:t=>({type:"one-of",values:t})};function YNe(t){if(!t||!("type"in t))return!1;switch(t.type){case"native":case"array":case"one-of":return!0}return!1}function c0e(t){switch(t.type){case"native":return ws(t.value);case"array":return KR(c0e(t.value));case"one-of":return ZNe(t);default:return null}}function ZNe(t){let e=null;return(r,i)=>iB(r,t)?r:(e==null&&(e=rB(t)),CS.error("Accessor#set",`Invalid property value, value needs to be of type ${e}`),i&&(i.valid=!1),null)}function rB(t){switch(t.type){case"native":switch(t.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case Ki:return"integer";case Date:return"date";default:return z6(t.value)}case"array":return`array of ${rB(t.value)}`;case"one-of":{const e=t.values.map(r=>rB(r));return`one of ${e.slice(0,e.length-1)} or ${e[e.length-1]}`}}return"unknown"}function iB(t,e){if(t==null)return!0;switch(e.type){case"native":switch(e.value){case Number:case Ki:return typeof t=="number";case Boolean:return typeof t=="boolean";case String:return typeof t=="string"}return t instanceof e.value;case"array":return!!Array.isArray(t)&&!t.some(r=>!iB(r,e.value));case"one-of":return e.values.some(r=>iB(t,r))}}function p(t={}){return(e,r)=>{if(e===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${e.name}.${r}. Accessor does not support static properties.`);const i=Object.getOwnPropertyDescriptor(e,r),s=dP(e,r);i&&(i.get||i.set?(s.get=i.get||s.get,s.set=i.set||s.set):"value"in i&&("value"in t&&K.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${r}" on "${e.constructor.name}" already defined in the metadata`,t),s.value=t.value=i.value)),t.readOnly!=null&&(s.readOnly=t.readOnly);const n=t.aliasOf;if(n){const l=typeof n=="string"?n:n.source,c=typeof n=="string"?null:n.overridable===!0;let h;s.dependsOn=[l],s.get=function(){let d=k4(this,l);if(typeof d=="function"){h||(h=l.split(".").slice(0,-1).join("."));const f=k4(this,h);f&&(d=d.bind(f))}return d},s.readOnly||(s.set=c?function(d){this._override(r,d)}:function(d){H4(this,l,d)})}const o=t.type,a=t.types;s.cast||(o?s.cast=JNe(o):a&&(Array.isArray(a)?s.cast=KR(Ap(a[0])):s.cast=Ap(a))),CNe(s,t),t.range&&(s.cast=QNe(s.cast,t.range))}}function NY(t,e,r){const i=dP(t,r);i.json||(i.json={});let s=i.json;return e!==void 0&&(s.origins||(s.origins={}),s.origins[e]||(s.origins[e]={}),s=s.origins[e]),s}function JNe(t){let e=0,r=t;if(YNe(t))return c0e(t);for(;Array.isArray(r)&&r.length===1&&typeof r[0]!="string"&&typeof r[0]!="number";)r=r[0],e++;const i=r;if(l0e(i))return e===0?tB(i):W4(tB(i),e);if(e===1)return WNe(i);if(e>1)return XNe(i,e);const s=t;return s.from?s.from:ws(s)}function QNe(t,e){return r=>{let i=+t(r);return e.step!=null&&(i=Math.round(i/e.step)*e.step),e.min!=null&&(i=Math.max(e.min,i)),e.max!=null&&(i=Math.min(e.max,i)),i}}function KNe(t){if(t.json&&t.json.origins){const e=t.json.origins,r={"web-document":["web-scene","web-map"]};for(const i in r)if(e[i]){const s=e[i];r[i].forEach(n=>{e[n]=s}),delete e[i]}}}let jh=class extends Pge{constructor(e,r,i){super(e,r,i)}};jh.prototype.type="warning";function u0e(t){return!!t&&t.prototype&&t.prototype.declaredClass&&t.prototype.declaredClass.indexOf("esri.core.Collection")===0}const sB=K.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function are(t,e,r){t&&(!r&&!e.read||e.read?.reader||e.read?.enabled===!1||r4e(t)&&ol("read.reader",yC(t),e))}function yC(t){const e=t.ndimArray??0;if(e>1)return t4e(t);if(e===1)return lre(t);if("type"in t&&d0e(t.type)){const r=t.type.prototype?.itemType?.Type,i=lre(typeof r=="function"?{type:r}:{types:r});return(s,n,o)=>{const a=i(s,n,o);return a&&new t.type(a)}}return FY(t)}function FY(t){return"type"in t?e4e(t.type):i4e(t.types)}function e4e(t){return t.prototype.read?(e,r,i)=>{if(e==null)return e;const s=typeof e;if(s!=="object")return void sB.error(`Expected JSON value of type 'object' to deserialize type '${t.prototype.declaredClass}', but got '${s}'`);const n=new t;return n.read(e,i),n}:t.fromJSON}function h0e(t,e,r,i){return i!==0&&Array.isArray(e)?e.map(s=>h0e(t,s,r,i-1)):t(e,void 0,r)}function t4e(t){const e=FY(t),r=h0e.bind(null,e),i=t.ndimArray??0;return(s,n,o)=>{if(s==null)return s;s=r(s,o,i);let a=i,l=s;for(;a>0&&Array.isArray(l);)a--,l=l[0];if(l!==void 0)for(let c=0;c<a;c++)s=[s];return s}}function lre(t){const e=FY(t);return(r,i,s)=>{if(r==null)return r;if(Array.isArray(r)){const o=[];for(const a of r){const l=e(a,void 0,s);l!==void 0&&o.push(l)}return o}const n=e(r,void 0,s);return n!==void 0?[n]:void 0}}function d0e(t){if(!u0e(t))return!1;const e=t.prototype.itemType;return!(!e||!e.Type)&&(typeof e.Type=="function"?UY(e.Type):p0e(e.Type))}function r4e(t){return"types"in t?p0e(t.types):UY(t.type)}function UY(t){return!Array.isArray(t)&&!!t&&t.prototype&&("read"in t.prototype||"fromJSON"in t||d0e(t))}function p0e(t){for(const e in t.typeMap)if(!UY(t.typeMap[e]))return!1;return!0}function i4e(t){let e=null;const r=t.errorContext??"type";return(i,s,n)=>{if(i==null)return i;const o=typeof i;if(o!=="object")return void sB.error(`Expected JSON value of type 'object' to deserialize, but got '${o}'`);e||(e=s4e(t));const a=t.key;if(typeof a!="string")return;const l=i[a],c=l?e[l]:t.defaultKeyValue?t.typeMap[t.defaultKeyValue]:void 0;if(!c){const d=`Type '${l||"unknown"}' is not supported`;return n&&n.messages&&i&&n.messages.push(new jh(`${r}:unsupported`,d,{definition:i,context:n})),void sB.error(d)}const h=new c;return h.read(i,n),h}}function s4e(t){const e={};for(const r in t.typeMap){const i=t.typeMap[r],s=hP(i.prototype);if(typeof t.key=="function")continue;const n=s[t.key];if(!n)continue;n.json?.type&&Array.isArray(n.json.type)&&n.json.type.length===1&&typeof n.json.type[0]=="string"&&(e[n.json.type[0]]=i);const o=n.json?.write;if(!o||!o.writer){e[r]=i;continue}const a=o.target,l=typeof a=="string"?a:t.key,c={};o.writer(r,c,l),c[l]&&(e[c[l]]=i)}return e}function n4e(t){if(t.json||(t.json={}),ure(t.json),hre(t.json),cre(t.json),t.json.origins)for(const e in t.json.origins)ure(t.json.origins[e]),hre(t.json.origins[e]),cre(t.json.origins[e]);return!0}function cre(t){t.name&&(t.read&&typeof t.read=="object"?t.read.source===void 0&&(t.read.source=t.name):t.read={source:t.name},t.write&&typeof t.write=="object"?t.write.target===void 0&&(t.write.target=t.name):t.write={target:t.name})}function ure(t){typeof t.read=="boolean"?t.read={enabled:t.read}:typeof t.read=="function"?t.read={enabled:!0,reader:t.read}:t.read&&typeof t.read=="object"&&t.read.enabled===void 0&&(t.read.enabled=!0)}function hre(t){typeof t.write=="boolean"?t.write={enabled:t.write}:typeof t.write=="function"?t.write={enabled:!0,writer:t.write}:t.write&&typeof t.write=="object"&&t.write.enabled===void 0&&(t.write.enabled=!0)}function dre(t,e){if(!e.write||e.write.writer||e.write.enabled===!1&&!e.write.overridePolicy)return;const r=t?.ndimArray??0;t&&(r===1||"type"in t&&u0e(t.type))?e.write.writer=l4e:r>1?e.write.writer=c4e(r):e.types?Array.isArray(e.types)?e.write.writer=a4e(e.types[0]):e.write.writer=o4e(e.types):e.write.writer=eM}function o4e(t){return(e,r,i,s)=>e?f0e(e,t,s)?eM(e,r,i,s):void 0:eM(e,r,i,s)}function f0e(t,e,r){for(const i in e.typeMap)if(t instanceof e.typeMap[i])return!0;if(r?.messages){const i=e.errorContext??"type",s=`Values of type '${(typeof e.key!="function"?t[e.key]:t.declaredClass)??"Unknown"}' cannot be written`;r&&r.messages&&t&&r.messages.push(new U(`${i}:unsupported`,s,{definition:t,context:r})),K.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(s)}return!1}function a4e(t){return(e,r,i,s)=>!e||!Array.isArray(e)?eM(e,r,i,s):eM(e.filter(n=>f0e(n,t,s)),r,i,s)}function eM(t,e,r,i){ol(r,X4(t,i),e)}function X4(t,e){return t&&typeof t.write=="function"?t.write({},e):t&&typeof t.toJSON=="function"?t.toJSON():typeof t=="number"?Y4(t):t}function Y4(t){return t===-1/0?-Number.MAX_VALUE:t===1/0?Number.MAX_VALUE:isNaN(t)?null:t}function l4e(t,e,r,i){let s;t===null?s=null:t&&typeof t.map=="function"?(s=t.map(n=>X4(n,i)),typeof s.toArray=="function"&&(s=s.toArray())):s=[X4(t,i)],ol(r,s,e)}function m0e(t,e,r){return r!==0&&Array.isArray(t)?t.map(i=>m0e(i,e,r-1)):X4(t,e)}function c4e(t){return(e,r,i,s)=>{let n;if(e===null)n=null;else{n=m0e(e,s,t);let o=t,a=n;for(;o>0&&Array.isArray(a);)o--,a=a[0];if(a!==void 0)for(let l=0;l<o;l++)n=[n]}ol(i,n,r)}}function u4e(t,e){return kY(t,"any",e?.origin)}function nB(t,e){return kY(t,"read",e?.origin)}function g0e(t,e){return kY(t,"write",e?.origin)}function kY(t,e,r){let i=t?.json;if(i?.origins&&r){let s;s=r==="link-chart"?i.origins[r]&&(e==="any"||e in i.origins[r])?i.origins[r]:i.origins["web-map"]:i.origins[r],s&&(e==="any"||e in s)&&(i=s)}return i}function h4e(t){const e=d4e(t);if(t.json.origins)for(const r in t.json.origins){const i=t.json.origins[r],s=i.types?p4e(i):e;are(s,i,!1),i.types&&!i.write&&t.json.write&&t.json.write.enabled&&(i.write={...t.json.write}),dre(s,i)}are(e,t.json,!0),dre(e,t.json)}function d4e(t){return t.json.types?oB(t.json):t.type?y0e(t):oB(t)}function p4e(t){return t.type?y0e(t):oB(t)}function y0e(t){if(!t.type)return;let e=0,r=t.type;for(;Array.isArray(r)&&!l0e(r);)r=r[0],e++;return{type:r,ndimArray:e}}function oB(t){if(!t.types)return;let e=0,r=t.types;for(;Array.isArray(r);)r=r[0],e++;return{types:r,ndimArray:e}}function f4e(t){n4e(t)&&(KNe(t),h4e(t))}const bU=new Set,wU=new Set;function P(t){return e=>{e.prototype.declaredClass=t,g4e(e);const r=[],i=[];let s=e.prototype;for(;s;)s.hasOwnProperty("initialize")&&!bU.has(s.initialize)&&(bU.add(s.initialize),r.push(s.initialize)),s.hasOwnProperty("destroy")&&!wU.has(s.destroy)&&(wU.add(s.destroy),i.push(s.destroy)),s=Object.getPrototypeOf(s);bU.clear(),wU.clear();class n extends e{constructor(...a){if(super(...a),this.constructor===n&&typeof this.postscript=="function"){if(r.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=r.length-1;l>=0;l--)r[l].call(this)}}),i.length){let l=!1;const c=this[t0e];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0,c.call(this);for(let h=0;h<i.length;h++)i[h].call(this)}}})}this.postscript(...a)}}}return n.__accessorMetadata__=hP(e.prototype),n.prototype.declaredClass=t,n}}function m4e(t,e){return e.get==null?function(){const r=this.__accessor__,i=r.propertiesByName.get(t);if(i===void 0)return;qt(i.observerObject);const s=r.store;return s.has(t)?s.get(t):i.metadata.value}:function(){const r=this.__accessor__,i=r.propertiesByName.get(t);if(i!==void 0)return i.getComputed(r)}}function g4e(t){const e=t.prototype,r=hP(e),i={};for(const s of Object.getOwnPropertyNames(r)){const n=r[s];f4e(n),i[s]={enumerable:!0,configurable:!0,get:m4e(s,n),set(o){const a=this.__accessor__;if(a!==void 0){if(!Object.isFrozen(this)){if(a.initialized&&n.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${s}' of ${this.declaredClass}`);if(a.lifecycle===zg.CONSTRUCTED&&n.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${s}' of ${this.declaredClass}`);a.set(s,o)}}else Object.defineProperty(this,s,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(t.prototype,i)}var _0e,v0e;function y4e(t){if(t==null)return{value:t};if(Array.isArray(t))return{type:[t[0]],value:null};switch(typeof t){case"object":return t.constructor?.__accessorMetadata__||t instanceof Date?{type:t.constructor,value:t}:t;case"boolean":return{type:Boolean,value:t};case"string":return{type:String,value:t};case"number":return{type:Number,value:t};case"function":return{type:t,value:null};default:return}}const Py=Symbol("Accessor-Handles"),aB=Symbol("Accessor-Initialized");let Te=class b0e{static createSubclass(e={}){if(Array.isArray(e))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:r,declaredClass:i,constructor:s}=e;delete e.declaredClass,delete e.properties,delete e.constructor;const n=this;class o extends n{constructor(...l){super(...l),this.inherited=null,s&&s.apply(this,l)}}hP(o.prototype);for(const a in e){const l=e[a];o.prototype[a]=typeof l=="function"?function(...c){const h=this.inherited;let d;this.inherited=function(...f){if(n.prototype[a])return n.prototype[a].apply(this,f)};try{d=l.apply(this,c)}catch(f){throw this.inherited=h,f}return this.inherited=h,d}:e[a]}for(const a in r){const l=y4e(r[a]);p(l)(o.prototype,a)}return P(i)(o)}constructor(...e){if(this[_0e]=null,this[v0e]=!1,this.constructor===b0e)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");const r=new DNe(this);Object.defineProperty(this,"__accessor__",{enumerable:!1,value:r}),e.length>0&&this.normalizeCtorArgs&&(r.ctorArgs=this.normalizeCtorArgs.apply(this,e)),pre.register(this,r.propertiesByName,this)}postscript(e){const r=this.__accessor__,i=r.ctorArgs||e;r.initialize(),i&&(this.set(i),r.ctorArgs=null),r.constructed(),this.initialize(),this[aB]=!0}initialize(){}[t0e](){this[Py]=Ne(this[Py])}destroy(){this.destroyed||(pre.unregister(this),pNe(this),this.__accessor__.destroy(),VNe()?.onInstanceDestroy(this))}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[aB]}get destroyed(){return this.__accessor__&&this.__accessor__.destroyed||!1}commitProperty(e){this.get(e)}get(e){return k4(this,e)}hasOwnProperty(e){return this.__accessor__?this.__accessor__.has(e):Object.prototype.hasOwnProperty.call(this,e)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(e,r){return H4(this,e,r),this}watch(e,r,i){return _Ne(this,e,r,i)}own(e){this.addHandles(e)}addHandles(e,r){if(this.destroyed){const s=Array.isArray(e)?e:[e];for(const n of s)n.remove();return}let i=this[Py];i==null&&(i=this[Py]=new $i),i.add(e,r)}removeHandles(e){const r=this[Py];r?.remove(e)}removeAllHandles(){const e=this[Py];e?.removeAll()}hasHandles(e){const r=this[Py];return r!=null&&r.has(e)}_override(e,r){r===void 0?this.__accessor__.clearOverride(e):this.__accessor__.override(e,r)}_clearOverride(e){return this.__accessor__.clearOverride(e)}_overrideIfSome(e,r){r==null?this.__accessor__.clearOverride(e):this.__accessor__.override(e,r)}_isOverridden(e){return this.__accessor__.isOverridden(e)}notifyChange(e){this.__accessor__.notifyChange(e)}_get(e){return this.__accessor__.internalGet(e)}_set(e,r){return this.__accessor__.internalSet(e,r),this}};_0e=Py,v0e=aB;const pre=new FinalizationRegistry(t=>{for(const e of t.values())e.destroy()});let DD=class w0e{constructor(){this._emitter=new w0e.EventEmitter(this)}emit(e,r){return this._emitter.emit(e,r)}on(e,r){return this._emitter.on(e,r)}once(e,r){return this._emitter.once(e,r)}hasEventListener(e){return this._emitter.hasEventListener(e)}};(function(t){class e{constructor(s=null){this._target=s,this._listenersMap=null}clear(){this._listenersMap?.clear(),this._listenersMap=null}destroy(){this.clear()}emit(s,n){const o=this._listenersMap&&this._listenersMap.get(s);if(!o)return!1;const a=this._target||this;return[...o].forEach(l=>{l.call(a,n)}),o.length>0}on(s,n){if(Array.isArray(s)){const a=s.map(l=>this.on(l,n));return cE(a)}if(s.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap||(this._listenersMap=new Map);const o=this._listenersMap.get(s)||[];return o.push(n),this._listenersMap.set(s,o),{remove:()=>{const a=this._listenersMap&&this._listenersMap.get(s)||[],l=a.indexOf(n);l>=0&&a.splice(l,1)}}}once(s,n){const o=this.on(s,a=>{o.remove(),n.call(null,a)});return o}hasEventListener(s){const n=this._listenersMap&&this._listenersMap.get(s);return n!=null&&n.length>0}}t.EventEmitter=e,t.EventedMixin=i=>{let s=class extends i{constructor(){super(...arguments),this._emitter=new e}destroy(){this._emitter.clear()}emit(n,o){return this._emitter.emit(n,o)}on(n,o){return this._emitter.on(n,o)}once(n,o){return this._emitter.once(n,o)}hasEventListener(n){return this._emitter.hasEventListener(n)}};return s=u([P("esri.core.Evented")],s),s};let r=class extends Te{constructor(){super(...arguments),this._emitter=new DD.EventEmitter(this)}destroy(){this._emitter.clear()}emit(i,s){return this._emitter.emit(i,s)}on(i,s){return this._emitter.on(i,s)}once(i,s){return this._emitter.once(i,s)}hasEventListener(i){return this._emitter.hasEventListener(i)}};r=u([P("esri.core.Evented")],r),t.EventedAccessor=r})(DD||(DD={}));const Ts=DD;var ni;(function(t){t[t.ADD=1]="ADD",t[t.REMOVE=2]="REMOVE",t[t.MOVE=4]="MOVE"})(ni||(ni={}));function zY(t){return(e,r)=>{e[r]=t}}let V6=class extends r0e{notify(){const e=this._observers;if(e&&e.length>0){const r=e.slice();for(const i of r)i.onInvalidated(),i.onCommitted()}}};var Fg;let _4e=class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}};const Bu=new qo(_4e,void 0,t=>{t.item=null,t.target=null,t.defaultPrevented=!1,t.cancellable=!1}),v4e=()=>{};function xU(t){return t?t instanceof Db?t.toArray():t.length?Array.prototype.slice.apply(t):[]:[]}function TU(t){if(t&&t.length)return t[0]}function b4e(t,e,r,i){const s=Math.min(t.length-r,e.length-i);let n=0;for(;n<s&&t[r+n]===e[i+n];)n++;return n}function x0e(t,e,r,i){e&&e.forEach((s,n,o)=>{t.push(s),x0e(t,r.call(i,s,n,o),r,i)})}const Y0=new Set,Z0=new Set,J0=new Set,SU=new Map;let w4e=0,Db=Fg=class extends Ts.EventedAccessor{static isCollection(t){return t!=null&&t instanceof Fg}constructor(t){super(t),this._chgListeners=[],this._notifications=null,this._timer=null,this._observable=new V6,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:w4e++})}normalizeCtorArgs(t){return t?Array.isArray(t)||t instanceof Fg?{items:t}:t:{}}destroy(){this._removeAllRaw()}*[Symbol.iterator](){yield*this.items}get items(){return qt(this._observable),this._items}set items(t){this._emitBeforeChanges(ni.ADD)||(this._splice(0,this.length,xU(t)),this._emitAfterChanges(ni.ADD))}hasEventListener(t){return t==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(t)}on(t,e){if(t==="change"){const r=this._chgListeners,i={removed:!1,callback:e};return r.push(i),this._notifications&&this._notifications.push({listeners:r.slice(),items:this._items.slice(),changes:[]}),{remove(){this.remove=v4e,i.removed=!0,r.splice(r.indexOf(i),1)}}}return this._emitter.on(t,e)}once(t,e){const r=this.on(t,e);return{remove(){r.remove()}}}add(t,e){if(qt(this._observable),this._emitBeforeChanges(ni.ADD))return this;const r=this.getNextIndex(e??null);return this._splice(r,0,[t]),this._emitAfterChanges(ni.ADD),this}addMany(t,e=this._items.length){if(qt(this._observable),!t||!t.length)return this;if(this._emitBeforeChanges(ni.ADD))return this;const r=this.getNextIndex(e);return this._splice(r,0,xU(t)),this._emitAfterChanges(ni.ADD),this}at(t){if(qt(this._observable),(t=Math.trunc(t)||0)<0&&(t+=this.length),!(t<0||t>=this.length))return this._items[t]}removeAll(){if(qt(this._observable),!this.length||this._emitBeforeChanges(ni.REMOVE))return[];const t=this._removeAllRaw();return this._emitAfterChanges(ni.REMOVE),t}_removeAllRaw(){return this.length===0?[]:this._splice(0,this.length)||[]}clone(){return qt(this._observable),this._createNewInstance({items:this._items.map(ee)})}concat(...t){qt(this._observable);const e=t.map(xU);return this._createNewInstance({items:this._items.concat(...e)})}drain(t,e){if(qt(this._observable),!this.length||this._emitBeforeChanges(ni.REMOVE))return;const r=this._splice(0,this.length),i=r.length;for(let s=0;s<i;s++)t.call(e,r[s],s,r);this._emitAfterChanges(ni.REMOVE)}every(t,e){return qt(this._observable),this._items.every(t,e)}filter(t,e){let r;return qt(this._observable),r=arguments.length===2?this._items.filter(t,e):this._items.filter(t),this._createNewInstance({items:r})}find(t,e){return qt(this._observable),this._items.find(t,e)}findIndex(t,e){return qt(this._observable),this._items.findIndex(t,e)}flatten(t,e){qt(this._observable);const r=[];return x0e(r,this,t,e),new Fg(r)}forEach(t,e){return qt(this._observable),this._items.forEach(t,e)}getItemAt(t){return qt(this._observable),this._items[t]}getNextIndex(t){qt(this._observable);const e=this.length;return(t=t??e)<0?t=0:t>e&&(t=e),t}includes(t,e=0){return qt(this._observable),this._items.includes(t,e)}indexOf(t,e=0){return qt(this._observable),this._items.indexOf(t,e)}join(t=","){return qt(this._observable),this._items.join(t)}lastIndexOf(t,e=this.length-1){return qt(this._observable),this._items.lastIndexOf(t,e)}map(t,e){qt(this._observable);const r=this._items.map(t,e);return new Fg({items:r})}reorder(t,e=this.length-1){qt(this._observable);const r=this.indexOf(t);if(r!==-1){if(e<0?e=0:e>=this.length&&(e=this.length-1),r!==e){if(this._emitBeforeChanges(ni.MOVE))return t;this._splice(r,1),this._splice(e,0,[t]),this._emitAfterChanges(ni.MOVE)}return t}}pop(){if(qt(this._observable),!this.length||this._emitBeforeChanges(ni.REMOVE))return;const t=TU(this._splice(this.length-1,1));return this._emitAfterChanges(ni.REMOVE),t}push(...t){return qt(this._observable),this._emitBeforeChanges(ni.ADD)||(this._splice(this.length,0,t),this._emitAfterChanges(ni.ADD)),this.length}reduce(t,e){qt(this._observable);const r=this._items;return arguments.length===2?r.reduce(t,e):r.reduce(t)}reduceRight(t,e){qt(this._observable);const r=this._items;return arguments.length===2?r.reduceRight(t,e):r.reduceRight(t)}remove(t){return qt(this._observable),this.removeAt(this.indexOf(t))}removeAt(t){if(qt(this._observable),t<0||t>=this.length||this._emitBeforeChanges(ni.REMOVE))return;const e=TU(this._splice(t,1));return this._emitAfterChanges(ni.REMOVE),e}removeMany(t){if(qt(this._observable),!t||!t.length||this._emitBeforeChanges(ni.REMOVE))return[];const e=t instanceof Fg?t.toArray():t,r=this._items,i=[],s=e.length;for(let n=0;n<s;n++){const o=e[n],a=r.indexOf(o);if(a>-1){const l=1+b4e(e,r,n+1,a+1),c=this._splice(a,l);c&&c.length>0&&i.push.apply(i,c),n+=l-1}}return this._emitAfterChanges(ni.REMOVE),i}reverse(){if(qt(this._observable),this._emitBeforeChanges(ni.MOVE))return this;const t=this._splice(0,this.length);return t&&(t.reverse(),this._splice(0,0,t)),this._emitAfterChanges(ni.MOVE),this}shift(){if(qt(this._observable),!this.length||this._emitBeforeChanges(ni.REMOVE))return;const t=TU(this._splice(0,1));return this._emitAfterChanges(ni.REMOVE),t}slice(t=0,e=this.length){return qt(this._observable),this._createNewInstance({items:this._items.slice(t,e)})}some(t,e){return qt(this._observable),this._items.some(t,e)}sort(t){if(qt(this._observable),!this.length||this._emitBeforeChanges(ni.MOVE))return this;const e=this._splice(0,this.length);return arguments.length?e.sort(t):e.sort(),this._splice(0,0,e),this._emitAfterChanges(ni.MOVE),this}splice(t,e,...r){qt(this._observable);const i=(e?ni.REMOVE:0)|(r.length?ni.ADD:0);if(this._emitBeforeChanges(i))return[];const s=this._splice(t,e,r)||[];return this._emitAfterChanges(i),s}toArray(){return qt(this._observable),this._items.slice()}toJSON(){return qt(this._observable),this.toArray()}toLocaleString(){return qt(this._observable),this._items.toLocaleString()}toString(){return qt(this._observable),this._items.toString()}unshift(...t){return qt(this._observable),!t.length||this._emitBeforeChanges(ni.ADD)||(this._splice(0,0,t),this._emitAfterChanges(ni.ADD)),this.length}_createNewInstance(t){return new this.constructor(t)}_splice(t,e,r){const i=this._items,s=this.itemType;let n,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=gC(()=>this._dispatchChange())),e){if(o=i.splice(t,e),this.hasEventListener("before-remove")){const a=Bu.acquire();a.target=this,a.cancellable=!0;for(let l=0,c=o.length;l<c;l++)n=o[l],a.reset(n),this.emit("before-remove",a),a.defaultPrevented&&(o.splice(l,1),i.splice(t,0,n),t+=1,l-=1,c-=1);Bu.release(a)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const a=Bu.acquire();a.target=this,a.cancellable=!1;const l=o.length;for(let c=0;c<l;c++)a.reset(o[c]),this.emit("after-remove",a);Bu.release(a)}}if(r&&r.length){if(s){const h=[];for(const d of r){const f=s.ensureType(d);f==null&&d!=null||h.push(f)}r=h}const a=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=t===this.length;if(a||l){const h=Bu.acquire();h.target=this,h.cancellable=!0;const d=Bu.acquire();d.target=this,d.cancellable=!1;for(const f of r)a?(h.reset(f),this.emit("before-add",h),h.defaultPrevented||(c?i.push(f):i.splice(t++,0,f),this._set("length",i.length),l&&(d.reset(f),this.emit("after-add",d)))):(c?i.push(f):i.splice(t++,0,f),this._set("length",i.length),d.reset(f),this.emit("after-add",d));Bu.release(d),Bu.release(h)}else{if(c)for(const h of r)i.push(h);else i.splice(t,0,...r);this._set("length",i.length)}}return(r&&r.length||o&&o.length)&&this._notifyChangeEvent(r,o),o}_emitBeforeChanges(t){let e=!1;if(this.hasEventListener("before-changes")){const r=Bu.acquire();r.target=this,r.cancellable=!0,r.type=t,this.emit("before-changes",r),e=r.defaultPrevented,Bu.release(r)}return e}_emitAfterChanges(t){if(this.hasEventListener("after-changes")){const e=Bu.acquire();e.target=this,e.cancellable=!1,e.type=t,this.emit("after-changes",e),Bu.release(e)}this._observable.notify()}_notifyChangeEvent(t,e){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:t,removed:e})}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),!this._notifications)return;const t=this._notifications;this._notifications=null;for(const e of t){const r=e.changes;Y0.clear(),Z0.clear(),J0.clear();for(const{added:l,removed:c}of r){if(l)if(J0.size===0&&Z0.size===0)for(const h of l)Y0.add(h);else for(const h of l)Z0.has(h)?(J0.add(h),Z0.delete(h)):J0.has(h)||Y0.add(h);if(c)if(J0.size===0&&Y0.size===0)for(const h of c)Z0.add(h);else for(const h of c)Y0.has(h)?Y0.delete(h):(J0.delete(h),Z0.add(h))}const i=xc.acquire();Y0.forEach(l=>{i.push(l)});const s=xc.acquire();Z0.forEach(l=>{s.push(l)});const n=this._items,o=e.items,a=xc.acquire();if(J0.forEach(l=>{o.indexOf(l)!==n.indexOf(l)&&a.push(l)}),e.listeners&&(i.length||s.length||a.length)){const l={target:this,added:i,removed:s,moved:a},c=e.listeners.length;for(let h=0;h<c;h++){const d=e.listeners[h];d.removed||d.callback.call(this,l)}}xc.release(i),xc.release(s),xc.release(a)}Y0.clear(),Z0.clear(),J0.clear()}};Db.ofType=t=>{if(!t)return Fg;if(SU.has(t))return SU.get(t);let e=null;if(typeof t=="function")e=t.prototype.declaredClass;else if(t.base)e=t.base.prototype.declaredClass;else for(const i in t.typeMap){const s=t.typeMap[i].prototype.declaredClass;e?e+=` | ${s}`:e=s}let r=class extends Fg{};return u([zY({Type:t,ensureType:typeof t=="function"?ws(t):Ap(t)})],r.prototype,"itemType",void 0),r=u([P(`esri.core.Collection<${e}>`)],r),SU.set(t,r),r},u([p()],Db.prototype,"length",void 0),u([p()],Db.prototype,"items",null),Db=Fg=u([P("esri.core.Collection")],Db);const Pt=Db;function Pw(t,e,r=Pt){return e||(e=new r),e===t||(e.removeAll(),x4e(t)?e.addMany(t):t&&e.add(t)),e}function T0e(t){return t}function x4e(t){return t&&(Array.isArray(t)||"items"in t&&Array.isArray(t.items))}const fre=new Set;function T4e(t,e,r=!1){r&&fre.has(e)||(r&&fre.add(e),t.warn(` DEPRECATED - ${e}`))}function cp(t,e,r={}){if(ae("esri-deprecation-warnings")){const{moduleName:i}=r;Z4(t,`Property: ${(i?i+"::":"")+e}`,r)}}function Z4(t,e,r={}){if(ae("esri-deprecation-warnings")){const{replacement:i,version:s,see:n,warnOnce:o}=r;let a=e;i&&(a+=`
	 Replacement: ${i}`),s&&(a+=`
	 Version: ${s}`),n&&(a+=`
	 See ${n} for more details.`),T4e(t,a,o)}}let S4e=class S0e{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const r=new S0e;return this._values.forEach((i,s)=>{e&&e.has(s)||r.set(s,ee(i.value),i.origin)}),r}get(e,r){r=this._normalizeOrigin(r);const i=this._values.get(e);return r==null||i?.origin===r?i?.value:void 0}originOf(e){return this._values.get(e)?.origin??mr.USER}keys(e){e=this._normalizeOrigin(e);const r=[...this._values.keys()];return e==null?r:r.filter(i=>this._values.get(i)?.origin===e)}set(e,r,i){if((i=this._normalizeOrigin(i))===mr.DEFAULTS){const s=this._values.get(e);if(s&&s.origin!=null&&s.origin>i)return}this._values.set(e,new E4e(r,i))}delete(e,r){(r=this._normalizeOrigin(r))!=null&&this._values.get(e)?.origin!==r||this._values.delete(e)}has(e,r){return(r=this._normalizeOrigin(r))!=null?this._values.get(e)?.origin===r:this._values.has(e)}forEach(e){this._values.forEach(({value:r},i)=>e(r,i))}_normalizeOrigin(e){if(e!=null)return e===mr.DEFAULTS?e:mr.USER}},E4e=class{constructor(e,r){this.value=e,this.origin=r}};function E0e(t,e,r){e.keys().forEach(s=>{r.set(s,e.get(s),mr.DEFAULTS)});const i=t.metadatas;Object.keys(i).forEach(s=>{t.internalGet(s)&&r.set(s,t.internalGet(s),mr.DEFAULTS)})}function C4e(t,e,r){if(!t||!t.read||t.read.enabled===!1||!t.read.source)return!1;const i=t.read.source;if(typeof i=="string"){if(i===e||i.includes(".")&&i.indexOf(e)===0&&Kte(i,r))return!0}else for(const s of i)if(s===e||s.includes(".")&&s.indexOf(e)===0&&Kte(s,r))return!0;return!1}function A4e(t){return t&&(!t.read||t.read.enabled!==!1&&!t.read.source)}function O4e(t,e,r,i,s){let n=nB(e[r],s);A4e(n)&&(t[r]=!0);for(const o of Object.getOwnPropertyNames(e))n=nB(e[o],s),C4e(n,r,i)&&(t[o]=!0)}function R4e(t,e,r,i){const s=r.metadatas,n=u4e(s[e],i),o=n?.default;if(o===void 0)return;const a=typeof o=="function"?o.call(t,e,i):o;a!==void 0&&r.set(e,a)}const C0e={origin:"service"};function A0e(t,e,r=C0e){if(!e||typeof e!="object")return;const i=ba(t),s=i.metadatas,n={};for(const o of Object.getOwnPropertyNames(e))O4e(n,s,o,e,r);i.setDefaultOrigin(r.origin);for(const o of Object.getOwnPropertyNames(n)){const a=nB(s[o],r).read,l=a&&a.source;let c;c=l&&typeof l=="string"?uP(e,l):e[o],a&&a.reader&&(c=a.reader.call(t,c,e,r)),c!==void 0&&i.set(o,c)}if(!r||!r.ignoreDefaults){i.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(s))n[o]||R4e(t,o,i,r)}i.setDefaultOrigin("user")}function M4e(t,e,r,i=C0e){const s={...i,messages:[]};r(s),s.messages?.forEach(n=>{n.type!=="warning"||t.loaded?i&&i.messages&&i.messages.push(n):t.loadWarnings.push(n)})}function P4e(t,e,r,i,s){const n={};return e.write?.writer?.call(t,i,n,r,s),n}function O0e(t,e,r,i,s,n){if(!i||!i.write)return!1;const o=t.get(r);if(!s&&i.write.overridePolicy){const a=i.write.overridePolicy.call(t,o,r,n??void 0);a!==void 0&&(s=a)}if(s||(s=i.write),!s||s.enabled===!1)return!1;if((o===null&&!s.allowNull&&!s.writerEnsuresNonNull||o===void 0)&&s.isRequired){const a=new U("web-document-write:property-required",`Missing value for required property '${r}' on '${t.declaredClass}'`,{propertyName:r,target:t});return a&&n&&n.messages?n.messages.push(a):a&&!n&&K.getLogger("esri.core.accessorSupport.write").error(a.name,a.message),!1}return!(o===void 0||o===null&&!s.allowNull&&!s.writerEnsuresNonNull||!s.alwaysWriteDefaults&&(!e.store.multipleOriginsSupported||e.store.originOf(r)===mr.DEFAULTS)&&I4e(t,r,n,i,o)||!s.ignoreOrigin&&n&&n.origin&&e.store.multipleOriginsSupported&&e.store.originOf(r)<jg(n.origin))}function I4e(t,e,r,i,s){const n=i.default;if(n===void 0)return!1;if(i.defaultEquals!=null)return i.defaultEquals(s);if(typeof n=="function"){if(Array.isArray(s)){const o=n.call(t,e,r??void 0);return u0(o,s)}return!1}return n===s}function $4e(t,e,r,i){const s=ba(t),n=s.metadatas,o=g0e(n[e],i);return!!o&&O0e(t,s,e,o,r,i)}function R0e(t,e,r){if(t&&typeof t.toJSON=="function"&&(!t.toJSON.isDefaultToJSON||!t.write))return PD(e,t.toJSON(r));const i=ba(t),s=i.metadatas;for(const n in s){const o=g0e(s[n],r);if(!O0e(t,i,n,o,void 0,r))continue;const a=t.get(n),l=P4e(t,o,o.write&&typeof o.write.target=="string"?o.write.target:n,a,r);Object.keys(l).length>0&&(e=PD(e,l),r?.resources?.pendingOperations?.length&&r.resources.pendingOperations.push(Promise.all(r.resources.pendingOperations).then(()=>PD(e,l,()=>"replace-arrays"))),r&&r.writtenProperties&&r.writtenProperties.push({target:t,propName:n,oldOrigin:PNe(i.store.originOf(n)),newOrigin:r.origin}))}return e}const _C=t=>{let e=class extends t{constructor(...r){super(...r);const i=ba(this),s=i.store,n=new S4e;i.store=n,E0e(i,s,n)}read(r,i){A0e(this,r,i)}write(r,i){return R0e(this,r??{},i)}toJSON(r){return this.write({},r)}static fromJSON(r,i){return L4e.call(this,r,i)}};return e=u([P("esri.core.JSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function L4e(t,e){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const r=new this;return r.read(t,e),r}let ue=class extends _C(Te){};ue=u([P("esri.core.JSONSupport")],ue);var h_;(function(t){t[t.PENDING=0]="PENDING",t[t.RESOLVED=1]="RESOLVED",t[t.REJECTED=2]="REJECTED"})(h_||(h_={}));let D4e=class{constructor(){this._resolver=Eo(),this._status=h_.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=h_.RESOLVED,this._cleanUp()},()=>{this._status=h_.REJECTED,this._cleanUp()}),this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(e){this._resolvingPromises.push(e),this._tryResolve()}isResolved(){return this._status===h_.RESOLVED}isRejected(){return this._status===h_.REJECTED}isFulfilled(){return this._status!==h_.PENDING}abort(){this._resolver.reject(zr())}_cleanUp(){this._allPromise=null,this._resolvingPromises=null}_tryResolve(){if(this.isFulfilled())return;const e=Eo(),r=[...this._resolvingPromises,e.promise],i=this._allPromise=Promise.all(r);i.then(()=>{this.isFulfilled()||this._allPromise!==i||this._resolver.resolve()},s=>{this.isFulfilled()||this._allPromise!==i||ds(s)||this._resolver.reject(s)}),e.resolve()}};const B6=t=>{let e=class extends t{constructor(...r){super(...r),this._promiseProps=new D4e,this.addResolvingPromise(Promise.resolve())}destroy(){this._promiseProps?.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(r,i){return this._promiseProps.promise.then(()=>this).then(r,i)}catch(r){return this.when(null,r)}addResolvingPromise(r){r&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in r?r.when():r)}};return e=u([P("esri.core.Promise")],e),e};let J4=class extends B6(Te){};J4=u([P("esri.core.Promise")],J4);const N4e="not-loaded",F4e="loading",U4e="failed",mre="loaded",M0e=t=>{let e=class extends t{constructor(...r){super(...r),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(i=>{const s=this.load.bind(this);this.load=n=>{const o=new Promise((a,l)=>{const c=RY(n,l);this.destroyed&&l(new U("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this.when(a,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===N4e){this._set("loadStatus",F4e);const a=this._loadController=new AbortController;s({signal:a.signal}),ya(a.signal,()=>{this._promiseProps.abort()})}return i(),o}})),this.when(()=>{this._set("loadStatus",mre),this._loadController=null},i=>{this._set("loadStatus",U4e),this._set("loadError",i),this._loadController=null})}destroy(){this._loadController=zl(this._loadController),this._set("loadError",null),this._set("loadWarnings",[])}get loaded(){return this.loadStatus===mre}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){return this.isFulfilled()||(this._set("loadError",new U("load:cancelled","Cancelled")),this._loadController?.abort()),this}};return u([p({readOnly:!0})],e.prototype,"loaded",null),u([p({readOnly:!0})],e.prototype,"loadError",void 0),u([p({clonable:!1})],e.prototype,"loadStatus",void 0),u([p({type:[jh],readOnly:!0})],e.prototype,"loadWarnings",null),e=u([P("esri.core.Loadable")],e),e};let _A=class extends M0e(J4){};_A=u([P("esri.core.Loadable")],_A),function(t){function e(r){return!(!r||!r.load)}t.LoadableMixin=M0e,t.isLoadable=e}(_A||(_A={}));const p0=_A;function G6(t,e,r){return Ac(t.map((i,s)=>e.apply(r,[i,s])))}async function k4e(t,e,r){return(await Ac(t.map((i,s)=>e.apply(r,[i,s])))).map(i=>i.value)}function VY(t){return{ok:!0,value:t}}function BY(t){return{ok:!1,error:t}}function z4e(t){return t!=null&&t.ok===!0?t.value:null}function V4e(t){return t!=null&&t.ok===!1?t.error:null}async function $u(t){if(t==null)return{ok:!1,error:new Error("no promise provided")};try{return VY(await t)}catch(e){return BY(e)}}async function FNt(t){try{return VY(await t)}catch(e){return zo(e),BY(e)}}function UNt(t){if(t.ok===!0)return t.value;throw t.error}function vC(t,e){return new Iy(t,e)}let Iy=class extends Te{get value(){return z4e(this._result)}get error(){return V4e(this._result)}get finished(){return this._result!=null}constructor(e,r){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=zl(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:i}=this._abortController;this.promise=e(i),this.promise.then(s=>{this._result=VY(s),this._cleanup()},s=>{this._result=BY(s),this._cleanup()}),this._abortHandle=ya(r,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=Fi(this._abortHandle),this._abortController=null}};u([p()],Iy.prototype,"value",null),u([p()],Iy.prototype,"error",null),u([p()],Iy.prototype,"finished",null),u([p()],Iy.prototype,"promise",void 0),u([p()],Iy.prototype,"_result",void 0),Iy=u([P("esri.core.asyncUtils.ReactiveTask")],Iy);async function P0e(t,e){return await t.load(),B4e(t,e)}async function B4e(t,e){const r=[],i=(...n)=>{for(const o of n)o!=null&&(Array.isArray(o)?i(...o):Pt.isCollection(o)?o.forEach(a=>i(a)):p0.isLoadable(o)&&r.push(o))};e(i);let s=null;if(await k4e(r,async n=>{const o=await $u(G4e(n)?n.loadAll():n.load());o.ok!==!1||s||(s=o)}),s)throw s.error;return t}function G4e(t){return"loadAll"in t&&typeof t.loadAll=="function"}const j4e=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,H4e={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function gre(t){const e=t?.match(j4e);if(!e)return null;const[,r,i,s]=e;if(!r)return null;let n=null,o=null,a=null;const{devext:l,qaext:c,www:h}=H4e;if(i)if(n=r,s)switch(s.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qa":({customBaseUrl:o,portalHostname:a}=c);break;default:return null}else({customBaseUrl:o,portalHostname:a}=h);else switch(r.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qaext":({customBaseUrl:o,portalHostname:a}=c);break;case"www":({customBaseUrl:o,portalHostname:a}=h);break;default:return null}return{customBaseUrl:o,isPortal:!1,portalHostname:a,urlKey:n}}function q4e(t){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(t)}function W4e(t){const e=atob(t),r=new Uint8Array(e.length);for(let i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return r.buffer}const X4e=K.getLogger("esri.core.urlUtils"),bC=Gr.request,yre="esri/config: esriConfig.request.proxyUrl is not set.",I0e=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,$0e=/^\s*http:/i,Y4e=/^\s*https:/i,Z4e=/^\s*file:/i,J4e=/:\d+$/,Q4e=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,K4e=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),e5e=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");let AS=class{constructor(e=""){this.uri=e,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let r=this.uri.match(K4e);this.scheme=r[2]||(r[1]?"":null),this.authority=r[4]||(r[3]?"":null),this.path=r[5],this.query=r[7]||(r[6]?"":null),this.fragment=r[9]||(r[8]?"":null),this.authority!=null&&(r=this.authority.match(e5e),this.user=r[3]||null,this.password=r[4]||null,this.host=r[6]||r[7],this.port=r[9]||null)}toString(){return this.uri}};const gI={},t5e=new AS(Gr.applicationUrl);let el=t5e;const r5e=i5e();let GY=r5e;const jY=()=>el,VNt=()=>GY;function i5e(){const t=el.path,e=t.substring(0,t.lastIndexOf(t.split("/")[t.split("/").length-1]));return`${`${el.scheme}://${el.host}${el.port!=null?`:${el.port}`:""}`}${e}`}function Co(t){if(!t)return null;const e={path:null,query:null},r=new AS(t),i=t.indexOf("?");return r.query===null?e.path=t:(e.path=t.substring(0,i),e.query=HY(r.query)),r.fragment&&(e.hash=r.fragment,r.query===null&&(e.path=e.path.substring(0,e.path.length-(r.fragment.length+1)))),e}function HY(t){const e=t.split("&"),r={};for(const i of e){if(!i)continue;const s=i.indexOf("=");let n,o;s<0?(n=decodeURIComponent(i),o=""):(n=decodeURIComponent(i.slice(0,s)),o=decodeURIComponent(i.slice(s+1)));let a=r[n];typeof a=="string"&&(a=r[n]=[a]),Array.isArray(a)?a.push(o):r[n]=o}return r}function _re(t){return t&&typeof t=="object"&&"toJSON"in t&&typeof t.toJSON=="function"}function tM(t,e){return t?e&&typeof e=="function"?Object.keys(t).map(r=>encodeURIComponent(r)+"="+encodeURIComponent(e(r,t[r]))).join("&"):Object.keys(t).map(r=>{const i=t[r];if(i==null)return"";const s=encodeURIComponent(r)+"=",n=e&&e[r];return n?s+encodeURIComponent(n(i)):Array.isArray(i)?i.map(o=>_re(o)?s+encodeURIComponent(JSON.stringify(o)):s+encodeURIComponent(o)).join("&"):_re(i)?s+encodeURIComponent(JSON.stringify(i)):s+encodeURIComponent(i)}).filter(r=>r).join("&"):""}function s5e(t=!1){let e,r=bC.proxyUrl;if(typeof t=="string"){e=u5e(t);const i=j6(t);i&&(r=i.proxyUrl)}else e=!!t;if(!r)throw X4e.warn(yre),new U("urlutils:proxy-not-set",yre);return e&&lB()&&(r=JY(r)),Co(r)}function BNt(t){const e=j6(t);let r,i;if(e){const s=qY(e.proxyUrl);r=s.path,i=s.query?HY(s.query):null}if(r){const s=Co(t);t=r+"?"+s.path;const n=tM({...i,...s.query});n&&(t=`${t}?${n}`)}return t}const KC={path:"",query:""};function qY(t){const e=t.indexOf("?");return e!==-1?(KC.path=t.slice(0,e),KC.query=t.slice(e+1)):(KC.path=t,KC.query=null),KC}function L0e(t){return t=(t=K4(t=m5e(t=qY(t).path),!0)).toLowerCase()}function n5e(t){const e={proxyUrl:t.proxyUrl,urlPrefix:L0e(t.urlPrefix)},r=bC.proxyRules,i=e.urlPrefix;let s=r.length;for(let n=0;n<r.length;n++){const o=r[n].urlPrefix;if(i.indexOf(o)===0){if(i.length===o.length)return-1;s=n;break}o.indexOf(i)===0&&(s=n+1)}return r.splice(s,0,e),s}function j6(t){const e=bC.proxyRules,r=L0e(t);for(let i=0;i<e.length;i++)if(r.indexOf(e[i].urlPrefix)===0)return e[i]}function o5e(t,e){if(!t||!e)return!1;t=Q4(t),e=Q4(e);const r=gre(t),i=gre(e);return r!=null&&i!=null?r.portalHostname===i.portalHostname:r==null&&i==null&&pE(t,e,!0)}function D0e(t,e){return t=Q4(t),e=Q4(e),K4(t)===K4(e)}function Q4(t){const e=(t=_p(t)).indexOf("/sharing");return e>0?t.substring(0,e):t.replace(/\/+$/,"")}function N0e(t){const e=i=>i==null||i instanceof RegExp&&i.test(t)||typeof i=="string"&&t.startsWith(i),r=bC.interceptors;if(r){for(const i of r)if(Array.isArray(i.urls)){if(i.urls.some(e))return i}else if(e(i.urls))return i}return null}function pE(t,e,r=!1){if(!t||!e)return!1;const i=uB(t),s=uB(e);return!(!r&&i.scheme!==s.scheme)&&i.host!=null&&s.host!=null&&i.host.toLowerCase()===s.host.toLowerCase()&&i.port===s.port}function WY(t){if(typeof t=="string"){if(!$c(t))return!0;t=uB(t)}if(pE(t,el))return!0;const e=bC.trustedServers||[];for(let r=0;r<e.length;r++){const i=a5e(e[r]);for(let s=0;s<i.length;s++)if(pE(t,i[s]))return!0}return!1}function a5e(t){return gI[t]||(ZY(t)||pm(t)?gI[t]=[new AS(_u(t))]:gI[t]=[new AS(`http://${t}`),new AS(`https://${t}`)]),gI[t]}function _u(t,e=GY,r){return pm(t)?r&&r.preserveProtocolRelative?t:el.scheme==="http"&&el.authority===vp(t).slice(2)?`http:${t}`:`https:${t}`:ZY(t)?t:Fc(t[0]==="/"?f5e(e):e,t)}function XY(t,e=GY,r){if(t==null||!$c(t))return t;const i=_p(t),s=i.toLowerCase(),n=_p(e).toLowerCase().replace(/\/+$/,""),o=r?_p(r).toLowerCase().replace(/\/+$/,""):null;if(o&&n.indexOf(o)!==0)return t;const a=(d,f,m)=>(m=d.indexOf(f,m))===-1?d.length:m;let l=a(s,"/",s.indexOf("//")+2),c=-1;for(;s.slice(0,l+1)===n.slice(0,l)+"/"&&(c=l+1,l!==s.length);)l=a(s,"/",l+1);if(c===-1||o&&c<o.length)return t;t=i.slice(c);const h=n.slice(c-1).replaceAll(/[^/]+/g,"").length;if(h>0)for(let d=0;d<h;d++)t=`../${t}`;else t=`./${t}`;return t}function _p(t){return t=_5e(t=y5e(t=g5e(t=_u(t=t.trim()))))}function Fc(...t){const e=t.filter(Qf);if(!e||!e.length)return;const r=[];if($c(e[0])){const s=e[0],n=s.indexOf("//");n!==-1&&(r.push(s.slice(0,n+1)),d5e(e[0])&&(r[0]+="/"),e[0]=s.slice(n+2))}else e[0][0]==="/"&&r.push("");const i=e.reduce((s,n)=>n?s.concat(n.split("/")):s,[]);for(let s=0;s<i.length;s++){const n=i[s];n===".."&&r.length>0&&r[r.length-1]!==".."?r.pop():(!n&&s===i.length-1||n&&(n!=="."||r.length===0))&&r.push(n)}return r.join("/")}function vp(t,e=!1){if(t==null||sv(t)||Am(t))return null;let r=t.indexOf("://");if(r===-1&&pm(t))r=2;else{if(r===-1)return null;r+=3}const i=t.indexOf("/",r);return i!==-1&&(t=t.slice(0,i)),e&&(t=K4(t,!0)),t}function $c(t){return pm(t)||ZY(t)}function sv(t){return t!=null&&t.slice(0,5)==="blob:"}function Am(t){return t!=null&&t.slice(0,5)==="data:"}function YY(t){const e=Iw(t);return e&&e.isBase64?W4e(e.data):null}function GNt(t){return btoa(String.fromCharCode.apply(null,t)).replaceAll("+","-").replaceAll("/","_").replace(/=+$/,"")}const l5e=/^data:(.*?)(;base64)?,(.*)$/;function Iw(t){const e=t.match(l5e);if(!e)return null;const[,r,i,s]=e;return{mediaType:r,isBase64:!!i,data:s}}function F0e(t){return t.isBase64?`data:${t.mediaType};base64,${t.data}`:`data:${t.mediaType},${t.data}`}function jNt(t){const e=YY(t);if(!e)return null;const r=Iw(t);return new Blob([e],{type:r.mediaType})}function HNt(t,e){c5e(t,e)}function c5e(t,e){if(!t)return!1;const r=document.createElement("a");if(!("download"in r))return!1;const i=URL.createObjectURL(t);return r.download=e,r.href=i,r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i),!0}function pm(t){return t!=null&&t[0]==="/"&&t[1]==="/"}function ZY(t){return t!=null&&I0e.test(t)}function u5e(t){return t!=null&&Y4e.test(t)||el.scheme==="https"&&pm(t)}function h5e(t){return t!=null&&$0e.test(t)||el.scheme==="http"&&pm(t)}function d5e(t){return t!=null&&Z4e.test(t)}function JY(t){return pm(t)?`https:${t}`:t.replace($0e,"https:")}function p5e(){return el.scheme==="http"}function lB(){return el.scheme==="https"}function K4(t,e=!1){return pm(t)?t.slice(2):(t=t.replace(I0e,""),e&&t.length>1&&t[0]==="/"&&t[1]==="/"&&(t=t.slice(2)),t)}function f5e(t){const e=t.indexOf("//"),r=t.indexOf("/",e+2);return r===-1?t:t.slice(0,r)}function QY(t){let e=0;if($c(t)){const i=t.indexOf("//");i!==-1&&(e=i+2)}const r=t.lastIndexOf("/");return r<e?t:t.slice(0,r+1)}function qNt(t,e){if(!t)return"";const r=Co(t).path.replace(/\/+$/,""),i=r.substring(r.lastIndexOf("/")+1);if(!e?.length)return i;const s=new RegExp(`.(${e.join("|")})$`,"ig");return i.replace(s,"")}function m5e(t){return t&&t[t.length-1]==="/"?t:`${t}/`}function U0e(t){return t.replace(/\/+$/,"")}function g5e(t){if(/^https?:\/\//i.test(t)){const e=qY(t);t=(t=e.path.replaceAll(/\/{2,}/g,"/")).replace("/","//"),e.query&&(t+=`?${e.query}`)}return t}function y5e(t){return t.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function _5e(t){const e=bC.httpsDomains;if(!h5e(t))return t;const r=t.indexOf("/",7);let i;if(i=r===-1?t:t.slice(0,r),i=i.toLowerCase().slice(7),J4e.test(i)){if(!i.endsWith(":80"))return t;i=i.slice(0,-3),t=t.replace(":80","")}return p5e()&&i===el.authority&&!Q4e.test(t)||(lB()&&i===el.authority||e&&e.some(s=>i===s||i.endsWith(`.${s}`))||lB()&&!j6(t))&&(t=JY(t)),t}function cB(t,e,r){if(!(e&&r&&t&&$c(t)))return t;const i=t.indexOf("//"),s=t.indexOf("/",i+2),n=t.indexOf(":",i+2),o=Math.min(s<0?t.length:s,n<0?t.length:n);return t.slice(i+2,o).toLowerCase()!==e.toLowerCase()?t:`${t.slice(0,i+2)}${r}${t.slice(o)}`}function uB(t){return typeof t=="string"?new AS(_u(t)):(t.scheme||(t.scheme=el.scheme),t)}function k0e(t){return v5e.test(t)}function z0e(t,e){const r=Co(t),i=Object.keys(r.query||{});return i.length>0&&e&&e.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${i.join(", ")}.`),r.path}function V0e(t,e,r){const i=Co(t),s=i.query||{};return s[e]=String(r),`${i.path}?${tM(s)}`}function EU(t,e){const r=Co(t),i=r.query||{};for(const n in e)i[n]=e[n];const s=tM(i);return s?`${r.path}?${s}`:r.path}function KY(t){if(t==null)return null;const e=t.match(B0e);return e?e[2]:null}function vre(t){if(t==null)return null;const e=t.match(B0e);return e?{path:e[1],extension:e[2]}:{path:t,extension:null}}async function WNt(t){return typeof t=="string"?Iw(t)??{data:t}:new Promise((e,r)=>{const i=new FileReader;i.readAsDataURL(t),i.onload=()=>e(Iw(i.result)),i.onerror=s=>r(s)})}const B0e=/([^.]*)\.([^\/]*)$/,v5e=/(^data:image\/svg|\.svg$)/i;function Be(t,e,r){let i,s;return e===void 0?(s=t,i=[void 0]):typeof e!="string"?(s=t,i=[void 0],r=e):(s=e,i=Array.isArray(t)?t:[t]),(n,o)=>{const a=n.constructor.prototype;for(const l of i){const c=NY(n,l,s);c.write&&typeof c.write=="object"||(c.write={}),r&&(c.write.target=r),c.write.writer=a[o]}}}let $r=class{constructor(e,r={ignoreUnknown:!1,useNumericKeys:!1}){this._jsonToAPI=e,this._options=r,this.apiValues=[],this.jsonValues=[],this._apiToJSON=this._invertMap(e),this.apiValues=this._getKeysSorted(this._apiToJSON),this.jsonValues=this._getKeysSorted(this._jsonToAPI),this.read=i=>this.fromJSON(i),this.write=(i,s,n)=>{const o=this.toJSON(i);o!==void 0&&ol(n,o,s)},this.write.isJSONMapWriter=!0}toJSON(e){if(e==null)return null;if(this._apiToJSON.hasOwnProperty(e)){const r=this._apiToJSON[e];return this._options.useNumericKeys?+r:r}return this._options.ignoreUnknown?void 0:e}fromJSON(e){return e!=null&&this._jsonToAPI.hasOwnProperty(e)?this._jsonToAPI[e]:this._options.ignoreUnknown?void 0:e}_invertMap(e){const r={};for(const i in e)r[e[i]]=i;return r}_getKeysSorted(e){const r=[];for(const i in e)r.push(i);return r.sort(),r}};function ll(){return function(t,e){return new $r(t,{ignoreUnknown:!0,...e})}}let eZ=class{constructor(e,r,i,s){this.semiMajorAxis=e,this.flattening=r,this.outerAtmosphereRimWidth=i;const n=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*n,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=s||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}};const nr=new eZ(6378137,1/298.257223563,3e5,.006694379990137799),Kf=new eZ(3396190,1/169.8944472236118,23e4),f0=new eZ(1737400,0,0);var $h;(function(t){t[t.CGCS2000=4490]="CGCS2000",t[t.GCSMARS2000=104971]="GCSMARS2000",t[t.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",t[t.GCSMOON2000=104903]="GCSMOON2000"})($h||($h={}));let y;const $={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5041:0,5042:0,5048:0,5167:0,5168:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,9793:0,9794:0,9869:0,9874:0,9875:0,9880:0,9943:0,9945:0,9947:0,9967:0,9972:0,9977:0,20042:0,20050:1,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22239:0,22240:0,22332:0,22337:0,22338:0,22391:0,22392:0,22639:0,22700:0,22739:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102731:0,102732:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2};for(y=2e3;y<=2045;y++)$[y]=0;for(y=2056;y<=2065;y++)$[y]=0;for(y=2067;y<=2135;y++)$[y]=0;for(y=2137;y<=2154;y++)$[y]=0;for(y=2161;y<=2170;y++)$[y]=0;for(y=2172;y<=2193;y++)$[y]=0;for(y=2195;y<=2198;y++)$[y]=0;for(y=2200;y<=2203;y++)$[y]=0;for(y=2205;y<=2217;y++)$[y]=0;for(y=2222;y<=2224;y++)$[y]=1;for(y=2225;y<=2250;y++)$[y]=2;for(y=2251;y<=2253;y++)$[y]=1;for(y=2257;y<=2264;y++)$[y]=2;for(y=2274;y<=2279;y++)$[y]=2;for(y=2280;y<=2282;y++)$[y]=1;for(y=2283;y<=2289;y++)$[y]=2;for(y=2290;y<=2292;y++)$[y]=0;for(y=2308;y<=2313;y++)$[y]=0;for(y=2315;y<=2491;y++)$[y]=0;for(y=2494;y<=2866;y++)$[y]=0;for(y=2867;y<=2869;y++)$[y]=1;for(y=2870;y<=2888;y++)$[y]=2;for(y=2891;y<=2895;y++)$[y]=2;for(y=2896;y<=2898;y++)$[y]=1;for(y=2902;y<=2908;y++)$[y]=2;for(y=2915;y<=2920;y++)$[y]=2;for(y=2921;y<=2923;y++)$[y]=1;for(y=2924;y<=2930;y++)$[y]=2;for(y=2931;y<=2962;y++)$[y]=0;for(y=2964;y<=2968;y++)$[y]=2;for(y=2969;y<=2973;y++)$[y]=0;for(y=2975;y<=2991;y++)$[y]=0;for(y=2995;y<=3051;y++)$[y]=0;for(y=3054;y<=3079;y++)$[y]=0;for(y=3081;y<=3088;y++)$[y]=0;for(y=3092;y<=3101;y++)$[y]=0;for(y=3106;y<=3138;y++)$[y]=0;for(y=3146;y<=3151;y++)$[y]=0;for(y=3153;y<=3166;y++)$[y]=0;for(y=3168;y<=3172;y++)$[y]=0;for(y=3174;y<=3203;y++)$[y]=0;for(y=3294;y<=3358;y++)$[y]=0;for(y=3367;y<=3403;y++)$[y]=0;for(y=3408;y<=3416;y++)$[y]=0;for(y=3417;y<=3438;y++)$[y]=2;for(y=3441;y<=3446;y++)$[y]=2;for(y=3447;y<=3450;y++)$[y]=0;for(y=3451;y<=3459;y++)$[y]=2;for(y=3460;y<=3478;y++)$[y]=0;for(y=3554;y<=3559;y++)$[y]=0;for(y=3560;y<=3570;y++)$[y]=2;for(y=3571;y<=3581;y++)$[y]=0;for(y=3594;y<=3597;y++)$[y]=0;for(y=3601;y<=3604;y++)$[y]=0;for(y=3637;y<=3639;y++)$[y]=0;for(y=3665;y<=3667;y++)$[y]=0;for(y=3693;y<=3695;y++)$[y]=0;for(y=3701;y<=3727;y++)$[y]=0;for(y=3728;y<=3739;y++)$[y]=2;for(y=3740;y<=3751;y++)$[y]=0;for(y=3753;y<=3760;y++)$[y]=2;for(y=3761;y<=3773;y++)$[y]=0;for(y=3775;y<=3777;y++)$[y]=0;for(y=3779;y<=3781;y++)$[y]=0;for(y=3783;y<=3785;y++)$[y]=0;for(y=3788;y<=3791;y++)$[y]=0;for(y=3797;y<=3802;y++)$[y]=0;for(y=3814;y<=3816;y++)$[y]=0;for(y=3825;y<=3829;y++)$[y]=0;for(y=3832;y<=3841;y++)$[y]=0;for(y=3844;y<=3852;y++)$[y]=0;for(y=3873;y<=3885;y++)$[y]=0;for(y=3890;y<=3893;y++)$[y]=0;for(y=3907;y<=3912;y++)$[y]=0;for(y=3942;y<=3950;y++)$[y]=0;for(y=3968;y<=3970;y++)$[y]=0;for(y=3973;y<=3976;y++)$[y]=0;for(y=3986;y<=3989;y++)$[y]=0;for(y=3994;y<=3997;y++)$[y]=0;for(y=4048;y<=4051;y++)$[y]=0;for(y=4056;y<=4063;y++)$[y]=0;for(y=4093;y<=4096;y++)$[y]=0;for(y=4390;y<=4398;y++)$[y]=0;for(y=4399;y<=4413;y++)$[y]=2;for(y=4418;y<=4433;y++)$[y]=2;for(y=4455;y<=4457;y++)$[y]=2;for(y=4484;y<=4489;y++)$[y]=0;for(y=4491;y<=4554;y++)$[y]=0;for(y=4568;y<=4589;y++)$[y]=0;for(y=4652;y<=4656;y++)$[y]=0;for(y=4766;y<=4800;y++)$[y]=0;for(y=5014;y<=5016;y++)$[y]=0;for(y=5069;y<=5072;y++)$[y]=0;for(y=5105;y<=5130;y++)$[y]=0;for(y=5173;y<=5188;y++)$[y]=0;for(y=5253;y<=5259;y++)$[y]=0;for(y=5269;y<=5275;y++)$[y]=0;for(y=5292;y<=5311;y++)$[y]=0;for(y=5329;y<=5331;y++)$[y]=0;for(y=5343;y<=5349;y++)$[y]=0;for(y=5355;y<=5357;y++)$[y]=0;for(y=5387;y<=5389;y++)$[y]=0;for(y=5459;y<=5463;y++)$[y]=0;for(y=5479;y<=5482;y++)$[y]=0;for(y=5518;y<=5520;y++)$[y]=0;for(y=5530;y<=5539;y++)$[y]=0;for(y=5550;y<=5552;y++)$[y]=0;for(y=5562;y<=5583;y++)$[y]=0;for(y=5623;y<=5625;y++)$[y]=2;for(y=5631;y<=5639;y++)$[y]=0;for(y=5649;y<=5653;y++)$[y]=0;for(y=5663;y<=5680;y++)$[y]=0;for(y=5682;y<=5685;y++)$[y]=0;for(y=5875;y<=5877;y++)$[y]=0;for(y=5896;y<=5899;y++)$[y]=0;for(y=5921;y<=5940;y++)$[y]=0;for(y=6050;y<=6125;y++)$[y]=0;for(y=6244;y<=6275;y++)$[y]=0;for(y=6328;y<=6348;y++)$[y]=0;for(y=6350;y<=6356;y++)$[y]=0;for(y=6366;y<=6372;y++)$[y]=0;for(y=6381;y<=6387;y++)$[y]=0;for(y=6393;y<=6404;y++)$[y]=0;for(y=6480;y<=6483;y++)$[y]=0;for(y=6511;y<=6514;y++)$[y]=0;for(y=6579;y<=6581;y++)$[y]=0;for(y=6619;y<=6624;y++)$[y]=0;for(y=6625;y<=6627;y++)$[y]=2;for(y=6628;y<=6632;y++)$[y]=0;for(y=6634;y<=6637;y++)$[y]=0;for(y=6669;y<=6692;y++)$[y]=0;for(y=6707;y<=6709;y++)$[y]=0;for(y=6720;y<=6723;y++)$[y]=0;for(y=6732;y<=6738;y++)$[y]=0;for(y=6931;y<=6933;y++)$[y]=0;for(y=6956;y<=6959;y++)$[y]=0;for(y=7005;y<=7007;y++)$[y]=0;for(y=7057;y<=7070;y++)$[y]=2;for(y=7074;y<=7082;y++)$[y]=0;for(y=7109;y<=7118;y++)$[y]=0;for(y=7119;y<=7127;y++)$[y]=1;for(y=7374;y<=7376;y++)$[y]=0;for(y=7528;y<=7586;y++)$[y]=0;for(y=7587;y<=7645;y++)$[y]=2;for(y=7692;y<=7696;y++)$[y]=0;for(y=7755;y<=7787;y++)$[y]=0;for(y=7791;y<=7795;y++)$[y]=0;for(y=7799;y<=7801;y++)$[y]=0;for(y=7803;y<=7805;y++)$[y]=0;for(y=7825;y<=7831;y++)$[y]=0;for(y=7845;y<=7859;y++)$[y]=0;for(y=8013;y<=8032;y++)$[y]=0;for(y=8065;y<=8068;y++)$[y]=1;for(y=8518;y<=8529;y++)$[y]=2;for(y=8533;y<=8536;y++)$[y]=2;for(y=8538;y<=8540;y++)$[y]=2;for(y=8677;y<=8679;y++)$[y]=0;for(y=8836;y<=8840;y++)$[y]=0;for(y=8857;y<=8859;y++)$[y]=0;for(y=8908;y<=8910;y++)$[y]=0;for(y=9154;y<=9159;y++)$[y]=0;for(y=9205;y<=9218;y++)$[y]=0;for(y=9271;y<=9273;y++)$[y]=0;for(y=9295;y<=9297;y++)$[y]=0;for(y=9356;y<=9360;y++)$[y]=0;for(y=9404;y<=9407;y++)$[y]=0;for(y=9476;y<=9482;y++)$[y]=0;for(y=9487;y<=9494;y++)$[y]=0;for(y=9697;y<=9699;y++)$[y]=0;for(y=9821;y<=9865;y++)$[y]=0;for(y=20002;y<=20032;y++)$[y]=0;for(y=20047;y<=20049;y++)$[y]=0;for(y=20062;y<=20092;y++)$[y]=0;for(y=20135;y<=20138;y++)$[y]=0;for(y=20248;y<=20258;y++)$[y]=0;for(y=20348;y<=20358;y++)$[y]=0;for(y=20436;y<=20440;y++)$[y]=0;for(y=20822;y<=20824;y++)$[y]=0;for(y=20904;y<=20932;y++)$[y]=0;for(y=20934;y<=20936;y++)$[y]=0;for(y=21004;y<=21032;y++)$[y]=0;for(y=21035;y<=21037;y++)$[y]=0;for(y=21095;y<=21097;y++)$[y]=0;for(y=21148;y<=21150;y++)$[y]=0;for(y=21207;y<=21264;y++)$[y]=0;for(y=21307;y<=21364;y++)$[y]=0;for(y=21413;y<=21423;y++)$[y]=0;for(y=21453;y<=21463;y++)$[y]=0;for(y=21473;y<=21483;y++)$[y]=0;for(y=21780;y<=21782;y++)$[y]=0;for(y=21891;y<=21894;y++)$[y]=0;for(y=21896;y<=21899;y++)$[y]=0;for(y=22171;y<=22177;y++)$[y]=0;for(y=22181;y<=22187;y++)$[y]=0;for(y=22191;y<=22197;y++)$[y]=0;for(y=22207;y<=22222;y++)$[y]=0;for(y=22234;y<=22236;y++)$[y]=0;for(y=22243;y<=22250;y++)$[y]=0;for(y=22262;y<=22265;y++)$[y]=0;for(y=22307;y<=22322;y++)$[y]=0;for(y=22348;y<=22357;y++)$[y]=0;for(y=22407;y<=22422;y++)$[y]=0;for(y=22462;y<=22465;y++)$[y]=0;for(y=22521;y<=22525;y++)$[y]=0;for(y=22607;y<=22622;y++)$[y]=0;for(y=22641;y<=22646;y++)$[y]=0;for(y=22648;y<=22657;y++)$[y]=0;for(y=22707;y<=22722;y++)$[y]=0;for(y=22762;y<=22765;y++)$[y]=0;for(y=22991;y<=22994;y++)$[y]=0;for(y=23028;y<=23038;y++)$[y]=0;for(y=23830;y<=23853;y++)$[y]=0;for(y=23866;y<=23872;y++)$[y]=0;for(y=23877;y<=23884;y++)$[y]=0;for(y=23886;y<=23894;y++)$[y]=0;for(y=23946;y<=23948;y++)$[y]=0;for(y=24311;y<=24313;y++)$[y]=0;for(y=24342;y<=24347;y++)$[y]=0;for(y=24370;y<=24374;y++)$[y]=10;for(y=24375;y<=24381;y++)$[y]=0;for(y=24718;y<=24721;y++)$[y]=0;for(y=24817;y<=24821;y++)$[y]=0;for(y=24877;y<=24882;y++)$[y]=0;for(y=24891;y<=24893;y++)$[y]=0;for(y=25391;y<=25395;y++)$[y]=0;for(y=25828;y<=25838;y++)$[y]=0;for(y=26191;y<=26195;y++)$[y]=0;for(y=26391;y<=26393;y++)$[y]=0;for(y=26701;y<=26722;y++)$[y]=0;for(y=26729;y<=26799;y++)$[y]=2;for(y=26801;y<=26803;y++)$[y]=2;for(y=26811;y<=26813;y++)$[y]=2;for(y=26847;y<=26870;y++)$[y]=2;for(y=26891;y<=26899;y++)$[y]=0;for(y=26901;y<=26923;y++)$[y]=0;for(y=26929;y<=26946;y++)$[y]=0;for(y=26948;y<=26998;y++)$[y]=0;for(y=27037;y<=27040;y++)$[y]=0;for(y=27205;y<=27232;y++)$[y]=0;for(y=27258;y<=27260;y++)$[y]=0;for(y=27391;y<=27398;y++)$[y]=0;for(y=27561;y<=27564;y++)$[y]=0;for(y=27571;y<=27574;y++)$[y]=0;for(y=27581;y<=27584;y++)$[y]=0;for(y=27591;y<=27594;y++)$[y]=0;for(y=28191;y<=28193;y++)$[y]=0;for(y=28348;y<=28358;y++)$[y]=0;for(y=28402;y<=28432;y++)$[y]=0;for(y=28462;y<=28492;y++)$[y]=0;for(y=29118;y<=29122;y++)$[y]=0;for(y=29168;y<=29172;y++)$[y]=0;for(y=29177;y<=29185;y++)$[y]=0;for(y=29187;y<=29195;y++)$[y]=0;for(y=29900;y<=29903;y++)$[y]=0;for(y=30161;y<=30179;y++)$[y]=0;for(y=30491;y<=30494;y++)$[y]=0;for(y=30729;y<=30732;y++)$[y]=0;for(y=31251;y<=31259;y++)$[y]=0;for(y=31265;y<=31268;y++)$[y]=0;for(y=31275;y<=31279;y++)$[y]=0;for(y=31281;y<=31297;y++)$[y]=0;for(y=31461;y<=31469;y++)$[y]=0;for(y=31491;y<=31495;y++)$[y]=0;for(y=31917;y<=31922;y++)$[y]=0;for(y=31965;y<=32e3;y++)$[y]=0;for(y=32001;y<=32003;y++)$[y]=2;for(y=32005;y<=32031;y++)$[y]=2;for(y=32033;y<=32060;y++)$[y]=2;for(y=32064;y<=32067;y++)$[y]=2;for(y=32074;y<=32077;y++)$[y]=2;for(y=32081;y<=32086;y++)$[y]=0;for(y=32107;y<=32130;y++)$[y]=0;for(y=32133;y<=32159;y++)$[y]=0;for(y=32164;y<=32167;y++)$[y]=2;for(y=32180;y<=32199;y++)$[y]=0;for(y=32201;y<=32260;y++)$[y]=0;for(y=32301;y<=32360;y++)$[y]=0;for(y=32601;y<=32662;y++)$[y]=0;for(y=32664;y<=32667;y++)$[y]=2;for(y=32701;y<=32761;y++)$[y]=0;for(y=53001;y<=53004;y++)$[y]=0;for(y=53008;y<=53019;y++)$[y]=0;for(y=53021;y<=53032;y++)$[y]=0;for(y=53034;y<=53037;y++)$[y]=0;for(y=53042;y<=53046;y++)$[y]=0;for(y=53074;y<=53080;y++)$[y]=0;for(y=54001;y<=54004;y++)$[y]=0;for(y=54008;y<=54019;y++)$[y]=0;for(y=54021;y<=54032;y++)$[y]=0;for(y=54034;y<=54037;y++)$[y]=0;for(y=54042;y<=54046;y++)$[y]=0;for(y=54048;y<=54053;y++)$[y]=0;for(y=54074;y<=54080;y++)$[y]=0;for(y=54098;y<=54101;y++)$[y]=0;for(y=102001;y<=102040;y++)$[y]=0;for(y=102042;y<=102063;y++)$[y]=0;for(y=102065;y<=102067;y++)$[y]=0;for(y=102070;y<=102117;y++)$[y]=0;for(y=102122;y<=102216;y++)$[y]=0;for(y=102221;y<=102377;y++)$[y]=0;for(y=102382;y<=102388;y++)$[y]=0;for(y=102389;y<=102398;y++)$[y]=2;for(y=102399;y<=102444;y++)$[y]=0;for(y=102445;y<=102447;y++)$[y]=2;for(y=102448;y<=102458;y++)$[y]=0;for(y=102459;y<=102468;y++)$[y]=2;for(y=102469;y<=102499;y++)$[y]=0;for(y=102500;y<=102519;y++)$[y]=1;for(y=102520;y<=102524;y++)$[y]=0;for(y=102525;y<=102529;y++)$[y]=2;for(y=102530;y<=102588;y++)$[y]=0;for(y=102590;y<=102598;y++)$[y]=0;for(y=102601;y<=102603;y++)$[y]=0;for(y=102605;y<=102628;y++)$[y]=0;for(y=102629;y<=102646;y++)$[y]=2;for(y=102648;y<=102700;y++)$[y]=2;for(y=102701;y<=102703;y++)$[y]=0;for(y=102707;y<=102730;y++)$[y]=2;for(y=102733;y<=102758;y++)$[y]=2;for(y=102767;y<=102900;y++)$[y]=0;for(y=102901;y<=102933;y++)$[y]=2;for(y=102934;y<=102950;y++)$[y]=13;for(y=102951;y<=102955;y++)$[y]=0;for(y=102961;y<=102963;y++)$[y]=0;for(y=102965;y<=102969;y++)$[y]=0;for(y=102971;y<=102973;y++)$[y]=0;for(y=102975;y<=102989;y++)$[y]=0;for(y=102990;y<=102992;y++)$[y]=1;for(y=102997;y<=103002;y++)$[y]=0;for(y=103003;y<=103008;y++)$[y]=2;for(y=103009;y<=103011;y++)$[y]=0;for(y=103012;y<=103014;y++)$[y]=2;for(y=103019;y<=103021;y++)$[y]=0;for(y=103022;y<=103024;y++)$[y]=2;for(y=103029;y<=103031;y++)$[y]=0;for(y=103032;y<=103034;y++)$[y]=2;for(y=103065;y<=103068;y++)$[y]=0;for(y=103074;y<=103076;y++)$[y]=0;for(y=103077;y<=103079;y++)$[y]=1;for(y=103080;y<=103082;y++)$[y]=0;for(y=103083;y<=103085;y++)$[y]=2;for(y=103090;y<=103093;y++)$[y]=0;for(y=103097;y<=103099;y++)$[y]=0;for(y=103100;y<=103102;y++)$[y]=2;for(y=103107;y<=103109;y++)$[y]=0;for(y=103110;y<=103112;y++)$[y]=2;for(y=103113;y<=103116;y++)$[y]=0;for(y=103117;y<=103120;y++)$[y]=2;for(y=103153;y<=103157;y++)$[y]=0;for(y=103158;y<=103162;y++)$[y]=2;for(y=103163;y<=103165;y++)$[y]=0;for(y=103166;y<=103168;y++)$[y]=1;for(y=103169;y<=103171;y++)$[y]=2;for(y=103186;y<=103188;y++)$[y]=0;for(y=103189;y<=103191;y++)$[y]=2;for(y=103192;y<=103195;y++)$[y]=0;for(y=103196;y<=103199;y++)$[y]=2;for(y=103200;y<=103224;y++)$[y]=0;for(y=103225;y<=103227;y++)$[y]=1;for(y=103232;y<=103237;y++)$[y]=0;for(y=103238;y<=103243;y++)$[y]=2;for(y=103244;y<=103246;y++)$[y]=0;for(y=103247;y<=103249;y++)$[y]=2;for(y=103254;y<=103256;y++)$[y]=0;for(y=103257;y<=103259;y++)$[y]=2;for(y=103264;y<=103266;y++)$[y]=0;for(y=103267;y<=103269;y++)$[y]=2;for(y=103300;y<=103375;y++)$[y]=0;for(y=103381;y<=103383;y++)$[y]=0;for(y=103384;y<=103386;y++)$[y]=1;for(y=103387;y<=103389;y++)$[y]=0;for(y=103390;y<=103392;y++)$[y]=2;for(y=103397;y<=103399;y++)$[y]=0;for(y=103400;y<=103471;y++)$[y]=2;for(y=103476;y<=103478;y++)$[y]=0;for(y=103479;y<=103481;y++)$[y]=2;for(y=103486;y<=103488;y++)$[y]=0;for(y=103489;y<=103491;y++)$[y]=2;for(y=103492;y<=103495;y++)$[y]=0;for(y=103496;y<=103499;y++)$[y]=2;for(y=103528;y<=103543;y++)$[y]=0;for(y=103544;y<=103548;y++)$[y]=2;for(y=103549;y<=103551;y++)$[y]=0;for(y=103552;y<=103554;y++)$[y]=1;for(y=103555;y<=103557;y++)$[y]=2;for(y=103558;y<=103560;y++)$[y]=0;for(y=103571;y<=103573;y++)$[y]=0;for(y=103574;y<=103576;y++)$[y]=2;for(y=103577;y<=103580;y++)$[y]=0;for(y=103581;y<=103583;y++)$[y]=2;for(y=103595;y<=103694;y++)$[y]=0;for(y=103696;y<=103699;y++)$[y]=0;for(y=103700;y<=103793;y++)$[y]=2;for(y=103794;y<=103890;y++)$[y]=0;for(y=103891;y<=103896;y++)$[y]=2;for(y=103900;y<=103971;y++)$[y]=2;for(y=103972;y<=103977;y++)$[y]=0;for(y=112e3;y<=112101;y++)$[y]=0;const b5e={102113:!0,102100:!0,3857:!0,3785:!0},w5e={4326:!0,3785:!0,3857:!0,102113:!0,102100:!0,104905:!0,104971:!0},bre='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',yI=[-20037508342788905e-9,20037508342788905e-9],_I=[-20037508342787e-6,20037508342787e-6],G0e={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:yI,origin:_I,dx:1e-5},102100:{wkTemplate:bre,valid:yI,origin:_I,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:yI,origin:_I,dx:1e-5},3857:{wkTemplate:bre,valid:yI,origin:_I,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function Ln(t,e){return t===e||t!=null&&e!=null&&(t.wkid!=null||e.wkid!=null?t.wkid===e.wkid||$w(t)&&$w(e)||e.latestWkid!=null&&t.wkid===e.latestWkid||t.latestWkid!=null&&e.wkid===t.latestWkid:!(!t.wkt||!e.wkt)&&t.wkt.toUpperCase()===e.wkt.toUpperCase())}function cw(t){return fa(t)&&t.wkid&&G0e[t.wkid]||null}function j0e(t){return!!fa(t)&&(t.wkid?$[t.wkid]==null:!!t.wkt&&!!/^\s*GEOGCS/i.test(t.wkt))}function rM(t){return!(Om(t)||Rm(t))}function iM(t){return fa(t)&&t.wkid===4326}function H0e(t){return fa(t)&&t.wkid===$h.CGCS2000}function $w(t){return fa(t)&&t.wkid!=null&&b5e[t.wkid]===!0}function sM(t){return fa(t)&&t.wkid===32662}function tZ(t){return t===$h.GCSMARS2000||t===$h.GCSMARS2000_SPHERE}function Om(t){return fa(t)&&t.wkid!=null&&tZ(t.wkid)}function rZ(t){return t===$h.GCSMOON2000}function Rm(t){return fa(t)&&t.wkid!=null&&rZ(t.wkid)}function x5e(t){return fa(t)&&t.wkid!=null&&w5e[t.wkid]===!0}function fa(t){return t!=null&&(t.wkid!=null&&t.wkid>=2e3||t.wkt!=null)}const T5e={wkid:4326,wkt:F6(G0e[4326].wkTemplate,{Central_Meridian:"0.0"})},S5e={wkid:102100,latestWkid:3857},E5e={wkid:32662};function iZ(t){return{wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${t.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`}}const q0e=iZ(nr),sZ=iZ(Kf),nZ=iZ(f0),W0e={wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${nr.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`};function Vr(t){return t!=null&&(Om(t)||Ln(t,sZ))?Kf:t!=null&&(Rm(t)||Ln(t,nZ))?f0:nr}function ZNt(t){return tZ(t)?Kf:rZ(t)?f0:nr}const oZ=39.37,C5e=nr.radius*Math.PI/200,X0e=/UNIT\[([^\]]+)\]\]$/i,uw=$,Y0e=/UNIT\[([^\]]+)\]/i,A5e=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),O5e=ll()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),Bp=t=>t*t,Q0=t=>t*t*t,nM={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:Bp(.001)},"square-centimeters":{inBaseUnits:Bp(.01)},"square-decimeters":{inBaseUnits:Bp(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:Bp(1e3)},"square-inches":{inBaseUnits:Bp(.0254)},"square-feet":{inBaseUnits:Bp(.3048)},"square-yards":{inBaseUnits:Bp(.9144)},"square-miles":{inBaseUnits:Bp(1609.344)},"square-us-feet":{inBaseUnits:Bp(1200/3937)},acres:{inBaseUnits:.0015625*Bp(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*Q0(.001)},"cubic-centimeters":{inBaseUnits:1e3*Q0(.01)},"cubic-decimeters":{inBaseUnits:1e3*Q0(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*Q0(1e3)},"cubic-inches":{inBaseUnits:1e3*Q0(.0254)},"cubic-feet":{inBaseUnits:1e3*Q0(.3048)},"cubic-yards":{inBaseUnits:1e3*Q0(.9144)},"cubic-miles":{inBaseUnits:1e3*Q0(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},R5e=(()=>{const t={};for(const e in nM)for(const r in nM[e].units)t[r]=e;return t})();function M5e(t,e,r){return t*nM[r].units[e].inBaseUnits}function P5e(t,e,r){return t/nM[r].units[e].inBaseUnits}const I5e=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"];function hB(t){const e=R5e[t];if(!e)throw new Error("unknown type");return e}function wre(t,e=null){return e=e||hB(t),nM[e].baseUnit===t}function Uo(t,e,r){if(e===r)return t;const i=hB(e);if(i!==hB(r))throw new Error("incompatible units");const s=wre(e,i)?t:M5e(t,e,i);return wre(r,i)?s:P5e(s,r,i)}function JNt(t,e,r){switch(r){case"metric":return $5e(t,e);case"imperial":return D5e(t,e);default:return r}}function QNt(t,e,r){switch(r){case"metric":return L5e(t,e);case"imperial":return N5e(t,e);default:return r}}function $5e(t,e){const r=Uo(t,e,"meters");return Math.abs(r)<3e3?"meters":"kilometers"}function L5e(t,e){const r=Uo(t,e,"meters");return Math.abs(r)<1e5?"meters":"kilometers"}function D5e(t,e){const r=Uo(t,e,"feet");return Math.abs(r)<1e3?"feet":"miles"}function N5e(t,e){const r=Uo(t,e,"feet");return Math.abs(r)<1e5?"feet":"miles"}function KNt(t,e){const r=Uo(t,e,"square-meters");return Math.abs(r)<3e6?"square-meters":"square-kilometers"}function e4t(t,e){const r=Uo(t,e,"square-feet");return Math.abs(r)<1e6?"square-feet":"square-miles"}function F5e(t,e,r){return Uo(t,e,"meters")/(r*Math.PI/180)}function Z0e(t){return O5e.fromJSON(t.toLowerCase())||null}function oM(t){if(t!=null&&!rM(t))return 1;const e=Ta(t);return e>1e5?1:e}function U5e(t){return Ta(t)>=Vr(t).metersPerDegree?"meters":H6(t)}function Ta(t,e=nr.metersPerDegree){return k5e(t,!0)??e}function k5e(t,e=!1){const r=t!=null?t.wkid:null,i=t!=null?t.wkt:null;let s=null;if(r){if(tZ(r))return Kf.metersPerDegree;if(rZ(r))return f0.metersPerDegree;s=uw.values[uw[r]],!s&&e&&A5e.has(r)&&(s=C5e)}else i&&(K0e(i)?s=Tre(X0e.exec(i),s):Q0e(i)&&(s=Tre(Y0e.exec(i),s)));return s}function xre(t){return t.isGeographic?1:Ta(t)}function Tre(t,e){return t&&t[1]?J0e(t[1]):e}function J0e(t){return parseFloat(t.split(",")[1])}function H6(t){const e=t!=null?t.wkid:null,r=t!=null?t.wkt:null;let i=null;if(e)i=uw.units[uw[e]];else if(r){const s=K0e(r)?X0e:Q0e(r)?Y0e:null;if(s){const n=s.exec(r);n&&n[1]&&(i=V5e(n[1]))}}return i!=null?Z0e(i):null}function t4t(t){const e=H6(t);return e!=null&&I5e.includes(e)?e:null}function Q0e(t){return/^GEOCCS/i.test(t)}function K0e(t){return/^PROJCS/i.test(t)}const z5e=1e-7;function V5e(t){const e=/[\\"\\']{1}([^\\"\\']+)/.exec(t);let r=e&&e[1];if(!r||!uw.units.includes(r)){const i=J0e(t);r=null;const s=uw.values;for(let n=0;n<s.length;++n)if(Math.abs(i-s[n])<z5e){r=uw.units[n];break}}return r}function r4t(t){const e=H6(t);if(e==null)return null;switch(e){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}const B5e={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},G5e={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},j5e={esriDUDecimalDegrees:"degrees",esriDURadians:"radians"},H5e=ll()(B5e),q5e=ll()(G5e),i4t=ll()(j5e);var cf;let wi=cf=class extends ue{static fromJSON(t){if(!t)return null;if(t.wkid){if(t.wkid===102100)return cf.WebMercator;if(t.wkid===4326)return cf.WGS84}const e=new cf;return e.read(t),e}constructor(t){super(t),this.latestWkid=null,this.wkid=null,this.wkt=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}normalizeCtorArgs(t){return t&&typeof t=="object"?t:{[typeof t=="string"?"wkt":"wkid"]:t}}get isWGS84(){return iM(this)}get isWebMercator(){return $w(this)}get isGeographic(){return j0e(this)}get isWrappable(){return x5e(this)}get metersPerUnit(){return Ta(this)}get unit(){return H6(this)||(this.isGeographic?"degrees":null)}writeWkt(t,e){this.wkid||(e.wkt=t)}clone(){if(this===cf.WGS84)return cf.WGS84;if(this===cf.WebMercator)return cf.WebMercator;const t=new cf;return this.wkid!=null?(t.wkid=this.wkid,this.latestWkid!=null&&(t.latestWkid=this.latestWkid),this.vcsWkid!=null&&(t.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(t.latestVcsWkid=this.latestVcsWkid)):this.wkt!=null&&(t.wkt=this.wkt),this.imageCoordinateSystem&&(t.imageCoordinateSystem=ee(this.imageCoordinateSystem)),t}equals(t){if(t==null)return!1;if(this.imageCoordinateSystem||t.imageCoordinateSystem){if(this.imageCoordinateSystem==null||t.imageCoordinateSystem==null)return!1;const{id:e,referenceServiceName:r}=t.imageCoordinateSystem,{geodataXform:i}=t.imageCoordinateSystem,s=this.imageCoordinateSystem;return e==null||i?JSON.stringify(s)===JSON.stringify(t.imageCoordinateSystem):r?s.id===e&&s.referenceServiceName===r:s.id===e}return Ln(this,t)}toJSON(t){return this.write(void 0,t)}};wi.GCS_NAD_1927=null,wi.WGS84=null,wi.WebMercator=null,wi.PlateCarree=null,u([p({readOnly:!0})],wi.prototype,"isWGS84",null),u([p({readOnly:!0})],wi.prototype,"isWebMercator",null),u([p({readOnly:!0})],wi.prototype,"isGeographic",null),u([p({readOnly:!0})],wi.prototype,"isWrappable",null),u([p({type:Ki,json:{write:!0}})],wi.prototype,"latestWkid",void 0),u([p({readOnly:!0})],wi.prototype,"metersPerUnit",null),u([p({readOnly:!0})],wi.prototype,"unit",null),u([p({type:Ki,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt==null}}}}}}})],wi.prototype,"wkid",void 0),u([p({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid==null}}}}}}})],wi.prototype,"wkt",void 0),u([Be("wkt"),Be("web-scene","wkt")],wi.prototype,"writeWkt",null),u([p({type:Ki,json:{write:!0}})],wi.prototype,"vcsWkid",void 0),u([p({type:Ki,json:{write:!0}})],wi.prototype,"latestVcsWkid",void 0),u([p()],wi.prototype,"imageCoordinateSystem",void 0),wi=cf=u([P("esri.geometry.SpatialReference")],wi),wi.prototype.toJSON.isDefaultToJSON=!0,wi.GCS_NAD_1927=new wi({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),wi.WGS84=new wi(T5e),wi.WebMercator=new wi(S5e),wi.PlateCarree=new wi(E5e),Object.freeze&&(Object.freeze(wi.GCS_NAD_1927),Object.freeze(wi.WGS84),Object.freeze(wi.WebMercator));const qe=wi,eye="20230626",tye="b81703b48e0b92e492f4cc6b739af02a9af50038",W5e="4.27";let aZ=W5e;aZ="4.27.6";const X5e={async request(t,e){const{default:r}=await he(()=>Promise.resolve().then(()=>aye),void 0,import.meta.url),i=t.options,s=i.responseType;i.signal=e?.signal,i.responseType=s==="native"||s==="native-request-init"?"native-request-init":s&&["blob","json","text"].includes(s)&&N0e(t.url)?.after?s:"array-buffer";const n=await r(t.url,i),o={data:n.data,httpStatus:n.httpStatus,ssl:n.ssl};switch(n.requestOptions?.responseType){case"native-request-init":return delete o.data.signal,o;case"blob":o.data=await o.data.arrayBuffer();break;case"json":o.data=new TextEncoder().encode(JSON.stringify(o.data)).buffer;break;case"text":o.data=new TextEncoder().encode(o.data).buffer}return{result:o,transferList:[o.data]}}};let Ii;function s4t(t){Ii=t}function n4t(t){const e=Ii?.findCredential(t);return e?.token?V0e(t,"token",e.token):t}ae("host-webworker");const Y5e=["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"];function rye(t){const e=vp(t,!0);return!!e&&e.endsWith(".arcgis.com")&&!Y5e.includes(e)&&!t.endsWith("/sharing/rest/generateToken")}function iye(t,e,r=!1,i){return new Promise((s,n)=>{if(Mn(i))return void n(Sre());let o=()=>{c(),n(new Error(`Unable to load ${e}`))},a=()=>{const h=t;c(),s(h)},l=()=>{if(!t)return;const h=t;c(),h.src="",n(Sre())};const c=()=>{ae("esri-image-decode")||(t.removeEventListener("error",o),t.removeEventListener("load",a)),o=null,a=null,t=null,i?.removeEventListener("abort",l),l=null,r&&URL.revokeObjectURL(e)};i?.addEventListener("abort",l),ae("esri-image-decode")?t.decode().then(a,o):(t.addEventListener("error",o),t.addEventListener("load",a))})}function Sre(){try{return new DOMException("Aborted","AbortError")}catch{const t=new Error;return t.name="AbortError",t}}const sye="Timeout exceeded";function Z5e(){return new Error(sye)}function o4t(t){return typeof t=="object"&&!!t&&"message"in t&&t.message===sye}function J5e(t){Gr.request.crossOriginNoCorsDomains||(Gr.request.crossOriginNoCorsDomains={});const e=Gr.request.crossOriginNoCorsDomains;for(let r of t)r=r.toLowerCase(),/^https?:\/\//.test(r)?e[vp(r)??""]=0:(e[vp("http://"+r)??""]=0,e[vp("https://"+r)??""]=0)}function Q5e(t){const e=Gr.request.crossOriginNoCorsDomains;if(e){let r=vp(t);if(r)return r=r.toLowerCase(),!pE(r,jY())&&e[r]<Date.now()-36e5}return!1}async function K5e(t){const e=Gr.request.crossOriginNoCorsDomains,r=vp(t);e&&r&&(e[r.toLowerCase()]=Date.now());const i=Co(t);t=i.path,i.query?.f==="json"&&(t+="?f=json");try{await fetch(t,{mode:"no-cors",credentials:"include"})}catch{}}async function ur(t,e){t instanceof URL&&(t=t.toString()),e?.query instanceof URLSearchParams&&(e.query=HY(e.query.toString().replaceAll("+"," ")));const r=Am(t),i=sv(t);i||r||(t=_p(t));const s={url:t,requestOptions:{...e}};let n=N0e(t);if(n){const c=await aFe(n,s);if(c!=null)return{data:c,getHeader:lZ,httpStatus:200,requestOptions:s.requestOptions,url:s.url};n.after||n.error||(n=null)}if(t=s.url,(e=s.requestOptions).responseType==="image"&&(ae("host-webworker")||ae("host-node")))throw em("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),s);if(e.method==="head"){if(e.body)throw em("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),s);if(r||i)throw em("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),s)}if(await sFe(),e5)return e5.execute(t,e);const o=new AbortController;ya(e,()=>o.abort());const a={controller:o,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:n,params:s,redoRequest:!1,useIdentity:Jd.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},l=await cFe(a);return n?.after?.(l),l}let e5;const Jd=Gr.request,nye="FormData"in globalThis,eFe=[499,498,403,401],tFe=["COM_0056","COM_0057","SB_0008"],rFe=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],lZ=()=>null,t5=Symbol();function iFe(t){const e=vp(t);e&&!ur._corsServers.includes(e)&&ur._corsServers.push(e)}function Ere(t){const e=vp(t);return!e||e.endsWith(".arcgis.com")||ur._corsServers.includes(e)||WY(e)}function em(t,e,r,i){let s="Error";const n={url:r.url,requestOptions:r.requestOptions,getHeader:lZ,ssl:!1};if(e instanceof U)return e.details?(e.details=ee(e.details),e.details.url=r.url,e.details.requestOptions=r.requestOptions):e.details=n,e;if(e){const o=i&&(c=>i.headers.get(c)),a=i?.status,l=e.message;l&&(s=l),o&&(n.getHeader=o),n.httpStatus=(e.httpCode!=null?e.httpCode:e.code)||a||0,n.subCode=e.subcode,n.messageCode=e.messageCode,typeof e.details=="string"?n.messages=[e.details]:n.messages=e.details,n.raw=t5 in e?e[t5]:e}return ds(e)?zr():new U(t,s,n)}async function sFe(){ae("host-webworker")?e5||(e5=await he(()=>import("./request-f907b001.js"),[],import.meta.url)):ur._abortableFetch||(ur._abortableFetch=globalThis.fetch.bind(globalThis))}async function dB(){Ii||await he(()=>import("./IdentityManager-eb89b7e2.js"),["./IdentityManager-eb89b7e2.js","./widget-789b9870.js"],import.meta.url)}async function nFe(t){const e=t.params.url,r=t.params.requestOptions,i=t.controller.signal,s=r.body;let n=null,o=null;if(nye&&"HTMLFormElement"in globalThis&&(s instanceof FormData?n=s:s instanceof HTMLFormElement&&(n=new FormData(s))),typeof s=="string"&&(o=s),t.fetchOptions={cache:r.cacheBust&&!("polyfill"in ur._abortableFetch)?"no-cache":"default",credentials:"same-origin",headers:r.headers||{},method:r.method==="head"?"HEAD":"GET",mode:"cors",priority:Jd.priority,redirect:"follow",signal:i},(n||o)&&(t.fetchOptions.body=n||o),r.authMode==="anonymous"&&(t.useIdentity=!1),t.hasToken=!!(/token=/i.test(e)||r.query?.token||n?.get("token")),!t.hasToken&&Gr.apiKey&&rye(e)&&(r.query||(r.query={}),r.query.token=Gr.apiKey,t.hasToken=!0),t.useIdentity&&!t.hasToken&&!t.credentialToken&&!oye(e)&&!Mn(i)){let a;r.authMode==="immediate"?(await dB(),a=await Ii.getCredential(e,{signal:i}),t.credential=a):r.authMode==="no-prompt"?(await dB(),a=await Ii.getCredential(e,{prompt:!1,signal:i}).catch(()=>{}),t.credential=a):Ii&&(a=Ii.findCredential(e)),a&&(t.credentialToken=a.token,t.useSSL=!!a.ssl)}}function oye(t){return rFe.some(e=>e.test(t))}async function oFe(t){let e=t.params.url;const r=t.params.requestOptions,i=t.fetchOptions??{},s=sv(e)||Am(e),n=r.responseType||"json",o=s?0:r.timeout!=null?r.timeout:Jd.timeout;let a=!1;if(!s){t.useSSL&&(e=JY(e)),r.cacheBust&&i.cache==="default"&&(e=V0e(e,"request.preventCache",Date.now()));let f={...r.query};t.credentialToken&&(f.token=t.credentialToken);let m=tM(f);ae("esri-url-encodes-apostrophe")&&(m=m.replaceAll("'","%27"));const g=e.length+1+m.length;let _;a=r.method==="delete"||r.method==="post"||r.method==="put"||!!r.body||g>Jd.maxUrlLength;const v=r.useProxy||!!j6(e);if(v){const b=s5e(e);_=b.path,!a&&_.length+1+g>Jd.maxUrlLength&&(a=!0),b.query&&(f={...b.query,...f})}if(i.method==="HEAD"&&(a||v)){if(a)throw g>Jd.maxUrlLength?em("request:invalid-parameters",new Error("URL exceeds maximum length"),t.params):em("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),t.params);if(v)throw em("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),t.params)}a?(i.method=r.method==="delete"?"DELETE":r.method==="put"?"PUT":"POST",r.body?e=EU(e,f):(i.body=tM(f),i.headers||(i.headers={}),i.headers["Content-Type"]="application/x-www-form-urlencoded")):e=EU(e,f),v&&(t.useProxy=!0,e=`${_}?${e}`),f.token&&nye&&i.body instanceof FormData&&!q4e(e)&&i.body.set("token",f.token),r.hasOwnProperty("withCredentials")?t.withCredentials=r.withCredentials:pE(e,jY())||(WY(e)||Ii&&Ii.findServerInfo(e)?.webTierAuth)&&(t.withCredentials=!0),t.withCredentials&&(i.credentials="include",Q5e(e)&&await K5e(a?EU(e,f):e))}let l,c,h=0,d=!1;o>0&&(h=setTimeout(()=>{d=!0,t.controller.abort()},o));try{if(r.responseType==="native-request-init")c=i,c.url=e;else if(r.responseType!=="image"||i.cache!=="default"||i.method!=="GET"||a||lFe(r.headers)||!s&&!t.useProxy&&Jd.proxyUrl&&!Ere(e)){if(l=await ur._abortableFetch(e,i),t.useProxy||iFe(e),r.responseType==="native")c=l;else if(i.method!=="HEAD")if(l.ok){switch(n){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(h&&(clearTimeout(h),h=0),n==="json"||n==="xml"||n==="document")if(c)switch(n){case"json":c=JSON.parse(c);break;case"xml":c=Cre(c,"application/xml");break;case"document":c=Cre(c,"text/html")}else c=null;if(c){if(n==="array-buffer"||n==="blob"){const f=l.headers.get("Content-Type");if(f&&/application\/json|text\/plain/i.test(f)&&c[n==="blob"?"size":"byteLength"]<=750)try{const m=await new Response(c).json();m.error&&(c=m)}catch{}}n==="image"&&c instanceof Blob&&(c=await Are(URL.createObjectURL(c),t,!0))}}else{c=await l.text();try{c=JSON.parse(c)}catch{}}}else c=await Are(e,t)}catch(f){if(f.name==="AbortError")throw d?Z5e():zr("Request canceled");if(!(!l&&f instanceof TypeError&&Jd.proxyUrl)||r.body||r.method==="delete"||r.method==="head"||r.method==="post"||r.method==="put"||t.useProxy||Ere(e))throw f;t.redoRequest=!0,n5e({proxyUrl:Jd.proxyUrl,urlPrefix:vp(e)??""})}finally{h&&clearTimeout(h)}return[l,c]}async function aFe(t,e){if(t.responseData!=null)return t.responseData;if(t.headers&&(e.requestOptions.headers={...e.requestOptions.headers,...t.headers}),t.query&&(e.requestOptions.query={...e.requestOptions.query,...t.query}),t.before){let r,i;try{i=await t.before(e)}catch(s){r=em("request:interceptor",s,e)}if((i instanceof Error||i instanceof U)&&(r=em("request:interceptor",i,e)),r)throw t.error&&t.error(r),r;return i}}function lFe(t){if(t){for(const e of Object.getOwnPropertyNames(t))if(t[e])return!0}return!1}function Cre(t,e){let r;try{r=new DOMParser().parseFromString(t,e)}catch{}if(!r||r.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return r}async function cFe(t){let e,r;await nFe(t);try{do[e,r]=await oFe(t);while(!await uFe(t,e,r))}catch(n){const o=em("request:server",n,t.params,e);throw o.details.ssl=t.useSSL,t.interceptor?.error&&t.interceptor.error(o),o}const i=t.params.url;if(r&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(i)){if(!t.hasToken&&!t.credentialToken&&r.user?.username&&!WY(i)){const n=vp(i,!0);n&&Jd.trustedServers.push(n)}Array.isArray(r.authorizedCrossOriginNoCorsDomains)&&J5e(r.authorizedCrossOriginNoCorsDomains)}const s=t.credential;if(s&&Ii){let o=Ii.findServerInfo(s.server)?.owningSystemUrl;if(o){o=o.replace(/\/?$/,"/sharing");const a=Ii.findCredential(o,s.userId);a&&Ii._getIdenticalSvcIdx(o,a)===-1&&a.resources.unshift(o)}}return{data:r,getHeader:e?n=>e?.headers.get(n):lZ,httpStatus:e?.status??200,requestOptions:t.params.requestOptions,ssl:t.useSSL,url:t.params.url}}async function uFe(t,e,r){if(t.redoRequest)return t.redoRequest=!1,!1;const i=t.params.requestOptions;if(!e||i.responseType==="native"||i.responseType==="native-request-init")return!0;let s,n;if(r&&(r.error?s=r.error:r.status==="error"&&Array.isArray(r.messages)&&(s={...r},s[t5]=r,s.details=r.messages)),!s&&!e.ok)throw s=new Error(`Unable to load ${e.url} status: ${e.status}`),s[t5]=r,s;let o,a=null;s&&(n=Number(s.code),a=s.hasOwnProperty("subcode")?Number(s.subcode):null,o=s.messageCode,o=o?.toUpperCase());const l=i.authMode;if(n===403&&(a===4||s.message?.toLowerCase().includes("ssl")&&!s.message.toLowerCase().includes("permission"))){if(!t.useSSL)return t.useSSL=!0,!1}else if(!t.hasToken&&t.useIdentity&&(l!=="no-prompt"||n===498)&&n!==void 0&&eFe.includes(n)&&!oye(t.params.url)&&(n!==403||o&&!tFe.includes(o)&&(a==null||a===2&&t.credentialToken))){await dB();try{const c=await Ii.getCredential(t.params.url,{error:em("request:server",s,t.params),prompt:l!=="no-prompt",signal:t.controller.signal,token:t.credentialToken});return t.credential=c,t.credentialToken=c.token,t.useSSL=t.useSSL||c.ssl,!1}catch(c){if(l==="no-prompt")return t.credential=void 0,t.credentialToken=void 0,!1;s=c}}if(s)throw s;return!0}function Are(t,e,r=!1){const i=e.controller.signal,s=new Image;return e.withCredentials?s.crossOrigin="use-credentials":s.crossOrigin="anonymous",s.alt="",s.fetchPriority=Jd.priority,s.src=t,iye(s,t,r,i)}ur._abortableFetch=null,ur._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"];const aye=Object.freeze(Object.defineProperty({__proto__:null,default:ur},Symbol.toStringTag,{value:"Module"}));function Oe(t,e,r){let i,s;return e===void 0||Array.isArray(e)?(s=t,r=e,i=[void 0]):(s=e,i=Array.isArray(t)?t:[t]),(n,o)=>{const a=n.constructor.prototype;i.forEach(l=>{const c=NY(n,l,s);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=a[o],r&&(c.read.source=(c.read.source||[]).concat(r))})}}let uf=class extends ue{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=qe.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,r){if(e instanceof qe)return e;if(e!=null){const i=new qe;return i.read(e,r),i}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,r){this.cache[e]=r}};u([p()],uf.prototype,"type",void 0),u([p({readOnly:!0})],uf.prototype,"cache",null),u([p({readOnly:!0})],uf.prototype,"extent",null),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],uf.prototype,"hasM",void 0),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],uf.prototype,"hasZ",void 0),u([p({type:qe,json:{write:!0},value:qe.WGS84})],uf.prototype,"spatialReference",void 0),u([Oe("spatialReference")],uf.prototype,"readSpatialReference",null),uf=u([P("esri.geometry.Geometry")],uf);const Av=uf,hFe=Object.prototype.toString;function dFe(t){const e="__accessorMetadata__"in t?ws(t):t;return function(...r){if(r.push(e),typeof r[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return pFe.apply(this,r)}}function pFe(t,e,r,i){dP(t,e).cast=i}function fFe(t){return(e,r)=>{dP(e,t).cast=e[r]}}function wr(...t){if(t.length!==3||typeof t[1]!="string")return t.length===1&&hFe.call(t[0])==="[object Function]"?dFe(t[0]):t.length===1&&typeof t[0]=="string"?fFe(t[0]):void 0}function mFe(t,e){const r=t.x-e.x,i=t.y-e.y,s=t.hasZ&&e.hasZ?t.z-e.z:0;return Math.sqrt(r*r+i*i+s*s)}const gFe=57.29577951308232,yFe=.017453292519943;function Ore(t){return t*gFe}function Rre(t){return t*yFe}function Mre(t){return t/nr.radius}function r5(t){return Math.PI/2-2*Math.atan(Math.exp(-t/nr.radius))}function pB(t){return t.wkid!=null||t.wkt!=null}const CU=[0,0];function i5(t,e,r,i,s){const n=t,o=s;if(o.spatialReference=r,"x"in n&&"x"in o)[o.x,o.y]=e(n.x,n.y,CU,i);else if("xmin"in n&&"xmin"in o)[o.xmin,o.ymin]=e(n.xmin,n.ymin,CU,i),[o.xmax,o.ymax]=e(n.xmax,n.ymax,CU,i);else if("paths"in n&&"paths"in o||"rings"in n&&"rings"in o){const a="paths"in n?n.paths:n.rings,l=[];let c;for(let h=0;h<a.length;h++){const d=a[h];c=[],l.push(c);for(let f=0;f<d.length;f++)c.push(e(d[f][0],d[f][1],[0,0],i)),d[f].length>2&&c[f].push(d[f][2]),d[f].length>3&&c[f].push(d[f][3])}"paths"in o?o.paths=l:o.rings=l}else if("points"in n&&"points"in o){const a=n.points,l=[];for(let c=0;c<a.length;c++)l[c]=e(a[c][0],a[c][1],[0,0],i),a[c].length>2&&l[c].push(a[c][2]),a[c].length>3&&l[c].push(a[c][3]);o.points=l}return s}function Z_(t,e){const r=t&&(pB(t)?t:t.spatialReference),i=e&&(pB(e)?e:e.spatialReference);return!(t&&"type"in t&&t.type==="mesh"||e&&"type"in e&&e.type==="mesh"||!r||!i)&&(!!Ln(i,r)||$w(i)&&iM(r)||$w(r)&&iM(i))}function bx(t,e){if(t==null)return null;const r=t.spatialReference,i=e&&(pB(e)?e:e.spatialReference);return Z_(r,i)?Ln(r,i)?ee(t):$w(i)?i5(t,nS,qe.WebMercator,!1,ee(t)):iM(i)?i5(t,sR,qe.WGS84,!1,ee(t)):null:null}function nS(t,e,r=[0,0]){e>89.99999?e=89.99999:e<-89.99999&&(e=-89.99999);const i=Rre(e);return r[0]=Rre(t)*nr.radius,r[1]=nr.halfSemiMajorAxis*Math.log((1+Math.sin(i))/(1-Math.sin(i))),r}function sR(t,e,r=[0,0],i=!1){const s=Ore(t/nr.radius);return r[0]=i?s:s-360*Math.floor((s+180)/360),r[1]=Ore(Math.PI/2-2*Math.atan(Math.exp(-e/nr.radius))),r}function OS(t,e=!1,r=ee(t)){return i5(t,nS,qe.WebMercator,e,r)}function vA(t,e=!1,r=ee(t)){return i5(t,sR,qe.WGS84,e,r)}var ND;const e3=[0,0];function Pre(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let bl=ND=class extends Av{static copy(t,e){e._set("x",t._get("x")),e._set("y",t._get("y")),e._set("z",t._get("z")),e._set("m",t._get("m"));const r=t._get("spatialReference");e._set("spatialReference",Object.isFrozen(r)?r:r.clone())}constructor(...t){super(...t),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}normalizeCtorArgs(t,e,r,i,s){let n;if(Array.isArray(t))n=t,s=e,t=n[0],e=n[1],r=n[2],i=n[3];else if(t&&typeof t=="object"){if(n=t,t=n.x!=null?n.x:n.longitude,e=n.y!=null?n.y:n.latitude,r=n.z,i=n.m,(s=n.spatialReference)&&s.declaredClass!=="esri.geometry.SpatialReference"&&(s=new qe(s)),n.longitude!=null||n.latitude!=null){if(n.longitude==null)K.getLogger(this).warn(".longitude=","Latitude was defined without longitude");else if(n.latitude==null)K.getLogger(this).warn(".latitude=","Longitude was defined without latitude");else if(!n.declaredClass&&s&&s.isWebMercator){const a=nS(n.longitude,n.latitude,e3);t=a[0],e=a[1]}}}else Pre(r)?(s=r,r=null):Pre(i)&&(s=i,i=null);const o={x:t,y:e};return o.x==null&&o.y!=null?K.getLogger(this).warn(".y=","Y coordinate was defined without an X coordinate"):o.y==null&&o.x!=null&&K.getLogger(this).warn(".x=","X coordinate was defined without a Y coordinate"),s!=null&&(o.spatialReference=s),r!=null&&(o.z=r),i!=null&&(o.m=i),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(t){t!==(this._get("m")!==void 0)&&(this._set("m",t?0:void 0),this._set("hasM",t))}get hasZ(){return this.z!==void 0}set hasZ(t){t!==(this._get("z")!==void 0)&&(this._set("z",t?0:void 0),this._set("hasZ",t))}get latitude(){const{spatialReference:t,x:e,y:r}=this;if(t){if(t.isWebMercator)return sR(e,r,e3)[1];if(t.isGeographic)return r}return null}set latitude(t){const{spatialReference:e,x:r}=this;t!=null&&e&&(e.isWebMercator?this._set("y",nS(r,t,e3)[1]):e.isGeographic&&this._set("y",t),this._set("latitude",t))}get longitude(){const{x:t,y:e,spatialReference:r}=this;if(r){if(r.isWebMercator)return sR(t,e,e3)[0];if(r.isGeographic)return t}return null}set longitude(t){const{y:e,spatialReference:r}=this;t!=null&&r&&(r.isWebMercator?this._set("x",nS(t,e,e3)[0]):r.isGeographic&&this._set("x",t),this._set("longitude",t))}writeX(t,e,r){e[r]=isNaN(t)?"NaN":t}readX(t){return typeof t=="string"?NaN:t}clone(){const t=new ND;return t.x=this.x,t.y=this.y,t.z=this.z,t.m=this.m,t.spatialReference=this.spatialReference,t}copy(t){return ND.copy(t,this),this}equals(t){if(t==null)return!1;const{x:e,y:r,z:i,m:s,spatialReference:n}=this,{z:o,m:a}=t;let{x:l,y:c,spatialReference:h}=t;if(!n.equals(h))if(n.isWebMercator&&h.isWGS84)[l,c]=nS(l,c),h=n;else{if(!n.isWGS84||!h.isWebMercator)return!1;[l,c]=sR(l,c),h=n}return e===l&&r===c&&i===o&&s===a&&n.wkid===h.wkid}offset(t,e,r){return this.x+=t,this.y+=e,r!=null&&(this.z=(this.z??0)+r),this}normalize(){if(!this.spatialReference)return this;const t=cw(this.spatialReference);if(!t)return this;let e=this.x;const[r,i]=t.valid,s=2*i;let n;return e>i?(n=Math.ceil(Math.abs(e-i)/s),e-=n*s):e<r&&(n=Math.ceil(Math.abs(e-r)/s),e+=n*s),this._set("x",e),this}distance(t){return mFe(this,t)}toArray(){const t=this.hasZ,e=this.hasM;return t&&e?[this.x,this.y,this.z,this.m]:t?[this.x,this.y,this.z]:e?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(t){return this.write({},t)}};u([p({readOnly:!0})],bl.prototype,"cache",null),u([p({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],bl.prototype,"hasM",null),u([p({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],bl.prototype,"hasZ",null),u([p({type:Number})],bl.prototype,"latitude",null),u([p({type:Number})],bl.prototype,"longitude",null),u([p({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),wr(t=>isNaN(t)?t:Eh(t))],bl.prototype,"x",void 0),u([Be("x")],bl.prototype,"writeX",null),u([Oe("x")],bl.prototype,"readX",null),u([p({type:Number,json:{write:!0}})],bl.prototype,"y",void 0),u([p({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],bl.prototype,"z",void 0),u([p({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],bl.prototype,"m",void 0),bl=ND=u([P("esri.geometry.Point")],bl),bl.prototype.toJSON.isDefaultToJSON=!0;const tt=bl,AU=[0,0];function cZ(t,e){return e!=null&&Wa(t,e.x,e.y,e.z)}function l4t(t,e){if(!e.points||e.points.length)return!1;for(const r of e.points)if(!fE(t,r))return!1;return!0}function _Fe(t,e){const{xmin:r,ymin:i,zmin:s,xmax:n,ymax:o,zmax:a}=e;return t.hasZ&&e.hasZ?Wa(t,r,i,s)&&Wa(t,r,o,s)&&Wa(t,n,o,s)&&Wa(t,n,i,s)&&Wa(t,r,i,a)&&Wa(t,r,o,a)&&Wa(t,n,o,a)&&Wa(t,n,i,a):Wa(t,r,i)&&Wa(t,r,o)&&Wa(t,n,o)&&Wa(t,n,i)}function fE(t,e){return Wa(t,e[0],e[1])}function vFe(t,e){return Wa(t,e[0],e[1],e[2])}function Wa(t,e,r,i){return e>=t.xmin&&e<=t.xmax&&r>=t.ymin&&r<=t.ymax&&(i==null||!t.hasZ||i>=t.zmin&&i<=t.zmax)}function bFe(t,e){return AU[1]=e.y,AU[0]=e.x,wFe(t,AU)}function wFe(t,e){return lye(t.rings,e)}function lye(t,e){if(!t)return!1;if(xFe(t))return Ire(!1,t,e);let r=!1;for(let i=0,s=t.length;i<s;i++)r=Ire(r,t[i],e);return r}function xFe(t){return!Array.isArray(t[0][0])}function Ire(t,e,r){const[i,s]=r;let n=t,o=0;for(let a=0,l=e.length;a<l;a++){o++,o===l&&(o=0);const[c,h]=e[a],[d,f]=e[o];(h<s&&f>=s||f<s&&h>=s)&&c+(s-h)/(f-h)*(d-c)<i&&(n=!n)}return n}function TFe(t,e){return cZ(t,e)}function SFe(t,e){const r=t.hasZ&&e.hasZ;let i,s,n;if(t.xmin<=e.xmin){if(i=e.xmin,t.xmax<i)return!1}else if(i=t.xmin,e.xmax<i)return!1;if(t.ymin<=e.ymin){if(s=e.ymin,t.ymax<s)return!1}else if(s=t.ymin,e.ymax<s)return!1;if(r&&e.hasZ){if(t.zmin<=e.zmin){if(n=e.zmin,t.zmax<n)return!1}else if(n=t.zmin,e.zmax<n)return!1}return!0}function EFe(t,e){const{points:r,hasZ:i}=e,s=i?vFe:fE;for(const n of r)if(s(t,n))return!0;return!1}const Lw=[0,0],Dw=[0,0],Nw=[0,0],Fw=[0,0],CFe=[Lw,Dw,Nw,Fw],cye=[[Nw,Lw],[Lw,Dw],[Dw,Fw],[Fw,Nw]];function AFe(t,e){return OFe(t,e.rings)}function OFe(t,e){Lw[0]=t.xmin,Lw[1]=t.ymax,Dw[0]=t.xmax,Dw[1]=t.ymax,Nw[0]=t.xmin,Nw[1]=t.ymin,Fw[0]=t.xmax,Fw[1]=t.ymin;for(const r of CFe)if(lye(e,r))return!0;for(const r of e){if(!r.length)continue;let i=r[0];if(fE(t,i))return!0;for(let s=1;s<r.length;s++){const n=r[s];if(fE(t,n)||uye(i,n,cye))return!0;i=n}}return!1}function RFe(t,e){Lw[0]=t.xmin,Lw[1]=t.ymax,Dw[0]=t.xmax,Dw[1]=t.ymax,Nw[0]=t.xmin,Nw[1]=t.ymin,Fw[0]=t.xmax,Fw[1]=t.ymin;const r=e.paths;for(const i of r){if(!r.length)continue;let s=i[0];if(fE(t,s))return!0;for(let n=1;n<i.length;n++){const o=i[n];if(fE(t,o)||uye(s,o,cye))return!0;s=o}}return!1}const Po=[0,0];function MFe(t){for(let e=0;e<t.length;e++){const r=t[e];for(let s=0;s<r.length-1;s++){const n=r[s],o=r[s+1];for(let a=e+1;a<t.length;a++)for(let l=0;l<t[a].length-1;l++){const c=t[a][l],h=t[a][l+1];if(fB(n,o,c,h,Po)&&!(Po[0]===n[0]&&Po[1]===n[1]||Po[0]===c[0]&&Po[1]===c[1]||Po[0]===o[0]&&Po[1]===o[1]||Po[0]===h[0]&&Po[1]===h[1]))return!0}}const i=r.length;if(!(i<=4))for(let s=0;s<i-3;s++){let n=i-1;s===0&&(n=i-2);const o=r[s],a=r[s+1];for(let l=s+2;l<n;l++){const c=r[l],h=r[l+1];if(fB(o,a,c,h,Po)&&!(Po[0]===o[0]&&Po[1]===o[1]||Po[0]===c[0]&&Po[1]===c[1]||Po[0]===a[0]&&Po[1]===a[1]||Po[0]===h[0]&&Po[1]===h[1]))return!0}}}return!1}function uye(t,e,r){for(let i=0;i<r.length;i++)if(fB(t,e,r[i][0],r[i][1]))return!0;return!1}function fB(t,e,r,i,s){const[n,o]=t,[a,l]=e,[c,h]=r,[d,f]=i,m=d-c,g=n-c,_=a-n,v=f-h,b=o-h,T=l-o,x=v*_-m*T;if(x===0)return!1;const S=(m*b-v*g)/x,E=(_*b-T*g)/x;return S>=0&&S<=1&&E>=0&&E<=1&&(s&&(s[0]=n+S*(a-n),s[1]=o+S*(l-o)),!0)}function PFe(t){switch(t){case"esriGeometryEnvelope":case"extent":return SFe;case"esriGeometryMultipoint":case"multipoint":return EFe;case"esriGeometryPoint":case"point":return TFe;case"esriGeometryPolygon":case"polygon":return AFe;case"esriGeometryPolyline":case"polyline":return RFe}}var eh;function IFe(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}function K0(t,e,r){return e==null?r:r==null?e:t(e,r)}let lo=eh=class extends Av{constructor(...t){super(...t),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(t,e,r,i,s){return IFe(t)?{spatialReference:t,xmin:0,ymin:0,xmax:0,ymax:0}:typeof t=="object"?(t.spatialReference=t.spatialReference==null?qe.WGS84:t.spatialReference,t):{xmin:t,ymin:e,xmax:r,ymax:i,spatialReference:s??qe.WGS84}}static fromBounds(t,e){return new eh({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}static fromPoint(t){return new eh({xmin:t.x,ymin:t.y,zmin:t.z,xmax:t.x,ymax:t.y,zmax:t.z,spatialReference:t.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const t=new tt({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(t.z=.5*(this.zmin+this.zmax)),this.hasM&&(t.m=.5*(this.mmin+this.mmax)),t}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(t){const e=this.center;return t.z!=null&&this.hasZ?this.offset(t.x-e.x,t.y-e.y,t.z-e.z):this.offset(t.x-e.x,t.y-e.y)}clone(){const t=new eh;return t.xmin=this.xmin,t.ymin=this.ymin,t.xmax=this.xmax,t.ymax=this.ymax,t.spatialReference=this.spatialReference,this.zmin!=null&&(t.zmin=this.zmin,t.zmax=this.zmax),this.mmin!=null&&(t.mmin=this.mmin,t.mmax=this.mmax),t}contains(t){if(!t)return!1;const e=this.spatialReference,r=t.spatialReference;return e&&r&&!e.equals(r)&&Z_(e,r)&&(t=e.isWebMercator?OS(t):vA(t,!0)),t.type==="point"?cZ(this,t):t.type==="extent"&&_Fe(this,t)}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,r=t.spatialReference;return e&&r&&!e.equals(r)&&Z_(e,r)&&(t=e.isWebMercator?OS(t):vA(t,!0)),this.xmin===t.xmin&&this.ymin===t.ymin&&this.zmin===t.zmin&&this.mmin===t.mmin&&this.xmax===t.xmax&&this.ymax===t.ymax&&this.zmax===t.zmax&&this.mmax===t.mmax}expand(t){const e=.5*(1-t),r=this.width*e,i=this.height*e;if(this.xmin+=r,this.ymin+=i,this.xmax-=r,this.ymax-=i,this.hasZ){const s=(this.zmax-this.zmin)*e;this.zmin+=s,this.zmax-=s}if(this.hasM){const s=(this.mmax-this.mmin)*e;this.mmin+=s,this.mmax-=s}return this}intersects(t){if(t==null)return!1;t.type==="mesh"&&(t=t.extent);const e=this.spatialReference,r=t.spatialReference;return e&&r&&!Ln(e,r)&&Z_(e,r)&&(t=e.isWebMercator?OS(t):vA(t,!0)),PFe(t.type)(this,t)}normalize(){const t=this._normalize(!1,!0);return Array.isArray(t)?t:[t]}offset(t,e,r){return this.xmin+=t,this.ymin+=e,this.xmax+=t,this.ymax+=e,r!=null&&(this.zmin+=r,this.zmax+=r),this}shiftCentralMeridian(){return this._normalize(!0)}union(t){return this===t||(this.xmin=Math.min(this.xmin,t.xmin),this.ymin=Math.min(this.ymin,t.ymin),this.xmax=Math.max(this.xmax,t.xmax),this.ymax=Math.max(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=K0(Math.min,this.zmin,t.zmin),this.zmax=K0(Math.max,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=K0(Math.min,this.mmin,t.mmin),this.mmax=K0(Math.max,this.mmax,t.mmax))),this}intersection(t){return this===t?this:t!=null&&this.intersects(t)?(this.xmin=Math.max(this.xmin,t.xmin),this.ymin=Math.max(this.ymin,t.ymin),this.xmax=Math.min(this.xmax,t.xmax),this.ymax=Math.min(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=K0(Math.max,this.zmin,t.zmin),this.zmax=K0(Math.min,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=K0(Math.max,this.mmin,t.mmin),this.mmax=K0(Math.min,this.mmax,t.mmax)),this):null}toJSON(t){return this.write({},t)}_shiftCM(t=cw(this.spatialReference)){if(!t||!this.spatialReference)return this;const e=this.spatialReference,r=this._getCM(t);if(r){const i=e.isWebMercator?vA(r):r;this.xmin-=r.x,this.xmax-=r.x,e.isWebMercator||(i.x=this._normalizeX(i.x,t).x),this.spatialReference=new qe(F6((e.isWGS84?t.altTemplate:null)??t.wkTemplate,{Central_Meridian:i.x}))}return this}_getCM(t){let e=null;const[r,i]=t.valid,s=this.xmin,n=this.xmax;return s>=r&&s<=i&&n>=r&&n<=i||(e=this.center),e}_normalize(t,e,r){const i=this.spatialReference;if(!i)return this;const s=r??cw(i);if(s==null)return this;const n=this._getParts(s).map(l=>l.extent);if(n.length<2)return n[0]||this;if(n.length>2)return t?this._shiftCM(s):this.set({xmin:s.valid[0],xmax:s.valid[1]});if(t)return this._shiftCM(s);if(e)return n;let o=!0,a=!0;return n.forEach(l=>{l.hasZ||(o=!1),l.hasM||(a=!1)}),{rings:n.map(l=>{const c=[[l.xmin,l.ymin],[l.xmin,l.ymax],[l.xmax,l.ymax],[l.xmax,l.ymin],[l.xmin,l.ymin]];if(o){const h=(l.zmax-l.zmin)/2;for(let d=0;d<c.length;d++)c[d].push(h)}if(a){const h=(l.mmax-l.mmin)/2;for(let d=0;d<c.length;d++)c[d].push(h)}return c}),hasZ:o,hasM:a,spatialReference:i}}_getParts(t){let e=this.cache._parts;if(!e){e=[];const{ymin:s,ymax:n,spatialReference:o}=this,a=this.width,l=this.xmin,c=this.xmax;let h;t=t||cw(o);const[d,f]=t.valid;h=this._normalizeX(this.xmin,t);const m=h.x,g=h.frameId;h=this._normalizeX(this.xmax,t);const _=h.x,v=h.frameId,b=m===_&&a>0;if(a>2*f){const T=new eh(l<c?m:_,s,f,n,o),x=new eh(d,s,l<c?_:m,n,o),S=new eh(0,s,f,n,o),E=new eh(d,s,0,n,o),A=[],R=[];T.contains(S)&&A.push(g),T.contains(E)&&R.push(g),x.contains(S)&&A.push(v),x.contains(E)&&R.push(v);for(let M=g+1;M<v;M++)A.push(M),R.push(M);e.push({extent:T,frameIds:[g]},{extent:x,frameIds:[v]},{extent:S,frameIds:A},{extent:E,frameIds:R})}else m>_||b?e.push({extent:new eh(m,s,f,n,o),frameIds:[g]},{extent:new eh(d,s,_,n,o),frameIds:[v]}):e.push({extent:new eh(m,s,_,n,o),frameIds:[g]});this.cache._parts=e}const r=this.hasZ,i=this.hasM;if(r||i){const s={};r&&(s.zmin=this.zmin,s.zmax=this.zmax),i&&(s.mmin=this.mmin,s.mmax=this.mmax);for(let n=0;n<e.length;n++)e[n].extent.set(s)}return e}_normalizeX(t,e){const[r,i]=e.valid,s=2*i;let n,o=0;return t>i?(n=Math.ceil(Math.abs(t-i)/s),t-=n*s,o=n):t<r&&(n=Math.ceil(Math.abs(t-r)/s),t+=n*s,o=-n),{x:t,frameId:o}}};u([p({readOnly:!0})],lo.prototype,"cache",null),u([p({readOnly:!0})],lo.prototype,"center",null),u([p({readOnly:!0})],lo.prototype,"extent",null),u([p({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],lo.prototype,"hasM",null),u([p({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],lo.prototype,"hasZ",null),u([p({readOnly:!0})],lo.prototype,"height",null),u([p({readOnly:!0})],lo.prototype,"width",null),u([p({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],lo.prototype,"xmin",void 0),u([p({type:Number,json:{write:!0}})],lo.prototype,"ymin",void 0),u([p({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],lo.prototype,"mmin",void 0),u([p({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],lo.prototype,"zmin",void 0),u([p({type:Number,json:{write:!0}})],lo.prototype,"xmax",void 0),u([p({type:Number,json:{write:!0}})],lo.prototype,"ymax",void 0),u([p({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],lo.prototype,"mmax",void 0),u([p({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],lo.prototype,"zmax",void 0),lo=eh=u([P("esri.geometry.Extent")],lo),lo.prototype.toJSON.isDefaultToJSON=!0;const cr=lo;let nR;const $Fe=globalThis.esriConfig?.locale??globalThis.dojoConfig?.locale;function hye(){return $Fe??globalThis.navigator?.language??"en"}function bp(){return nR===void 0&&(nR=hye()),nR}const oR=[];function uZ(t){return oR.push(t),{remove(){oR.splice(oR.indexOf(t),1)}}}const mB=[];function hZ(t){return mB.push(t),{remove(){oR.splice(mB.indexOf(t),1)}}}function LFe(){const t=hye();nR!==t&&(nR=t,[...mB].forEach(e=>{e.call(null,t)}),[...oR].forEach(e=>{e.call(null,t)}))}globalThis.addEventListener?.("languagechange",LFe);let vI;function DFe(t){return vI&&!vI.destroyed||(vI=t()),vI}var gB;const NFe=new $r({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let th=gB=class extends Te{constructor(t){super(t),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(t){t!=="asc"&&t!=="desc"||this._set("sortOrder",t)}clone(){return new gB({categories:this.categories?ee(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(t,e){let r=[];this.categories&&(r=this.categories.map(o=>Array.isArray(o)?JSON.stringify(o):o));let i="";if(this.extent){const o=bx(this.extent,qe.WGS84);o!=null&&(i=`${o.xmin},${o.ymin},${o.xmax},${o.ymax}`)}let s=this.query;!this.disableExtraQuery&&t.extraQuery&&(s="("+s+")"+t.extraQuery);const n={categories:r,bbox:i,q:s,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(n.sortField=this.sortField.split(",").map(o=>NFe.toJSON(o.trim())).join(","),n.sortOrder=this.sortOrder),{query:{...e,...n}}}};u([p()],th.prototype,"categories",void 0),u([p()],th.prototype,"disableExtraQuery",void 0),u([p({type:cr})],th.prototype,"extent",void 0),u([p()],th.prototype,"filter",void 0),u([p()],th.prototype,"num",void 0),u([p()],th.prototype,"query",void 0),u([p()],th.prototype,"sortField",void 0),u([p()],th.prototype,"sortOrder",null),u([p()],th.prototype,"start",void 0),th=gB=u([P("esri.portal.PortalQueryParams")],th);const Ff=th;let D1=class extends Te{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};u([p()],D1.prototype,"nextQueryParams",void 0),u([p()],D1.prototype,"queryParams",void 0),u([p()],D1.prototype,"results",void 0),u([p()],D1.prototype,"total",void 0),D1=u([P("esri.portal.PortalQueryResult")],D1);const FFe=D1;let og=class extends ue{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new U("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};u([p({type:Date})],og.prototype,"created",void 0),u([p()],og.prototype,"id",void 0),u([p()],og.prototype,"portal",void 0),u([p()],og.prototype,"title",void 0),u([p({readOnly:!0})],og.prototype,"url",null),u([p()],og.prototype,"username",void 0),og=u([P("esri.portal.PortalFolder")],og);const UFe=og;let co=class extends ue{constructor(e){super(e),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.tags=null,this.title=null}get thumbnailUrl(){const e=this.url,r=this.thumbnail;return e&&r&&this.portal?this.portal?.normalizeUrl(`${e}/info/${r}?f=json`):null}get url(){const e=this.get("portal.restUrl");return e?e+"/community/groups/"+this.id:null}fetchCategorySchema(e){return _c(this.portal).request(this.url+"/categorySchema",e).then(r=>{const i=r.categorySchema||[];return i.some(s=>s.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",e):i})}fetchMembers(e){return _c(this.portal).request(this.url+"/users",e)}getThumbnailUrl(e){let r=this.thumbnailUrl;return r&&e&&(r+=`&w=${e}`),r}toJSON(){throw new U("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}queryItems(e,r){let i=ws(Ff,e);const s=_c(this.portal);return parseFloat(s.currentVersion)>5?(i=i||new Ff,s.queryPortal(`/content/groups/${this.id}/search`,i,"PortalItem",r)):(i=i?i.clone():new Ff,i.query="group:"+this.id+(i.query?" "+i.query:""),s.queryItems(i,r))}_fetchCategorySchemaSet(e,r){const i=_c(this.portal);return i.fetchSelf(i.authMode,!0,r).then(s=>{const n=s.contentCategorySetsGroupQuery;if(n){const o=new Ff;return o.disableExtraQuery=!0,o.num=1,o.query=n,i.queryGroups(o,r)}throw new U("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(s=>{if(s.total){const n=s.results[0],o=new Ff;return o.num=1,o.query=`typekeywords:"${e}"`,n.queryItems(o,r)}throw new U("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(s=>s.total?s.results[0].fetchData("json",r).then(n=>{const o=n&&n.categorySchema;return o&&o.length?o:[]}):[])}};u([p()],co.prototype,"access",void 0),u([p({type:Date})],co.prototype,"created",void 0),u([p()],co.prototype,"description",void 0),u([p()],co.prototype,"id",void 0),u([p()],co.prototype,"isInvitationOnly",void 0),u([p({type:Date})],co.prototype,"modified",void 0),u([p()],co.prototype,"owner",void 0),u([p()],co.prototype,"portal",void 0),u([p()],co.prototype,"snippet",void 0),u([p()],co.prototype,"sortField",void 0),u([p()],co.prototype,"sortOrder",void 0),u([p()],co.prototype,"tags",void 0),u([p()],co.prototype,"thumbnail",void 0),u([p({readOnly:!0})],co.prototype,"thumbnailUrl",null),u([p()],co.prototype,"title",void 0),u([p({readOnly:!0})],co.prototype,"url",null),co=u([P("esri.portal.PortalGroup")],co);const yB=co,kFe=Object.freeze(Object.defineProperty({__proto__:null,default:yB},Symbol.toStringTag,{value:"Module"}));var _B;let fs=_B=class extends ue{constructor(...t){super(...t),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e?this.portal.normalizeUrl(`${t}/info/${e}?f=json`):null}get userContentUrl(){const t=this.get("portal.restUrl");return t?`${t}/content/users/${this.username}`:null}get url(){const t=this.get("portal.restUrl");return t?`${t}/community/users/${this.username}`:null}addItem(t){const e=t&&t.item,r=t&&t.data,i=t&&t.folder,s={method:"post"};e&&(s.query=e.createPostQuery(),r!=null&&(typeof r=="string"?s.query.text=r:typeof r=="object"&&(s.query.text=JSON.stringify(r))));let n=this.userContentUrl;return i&&(n+="/"+(typeof i=="string"?i:i.id)),this.portal.request(n+"/addItem",s).then(o=>(e.id=o.id,e.portal=this.portal,e.loaded?e.reload():e.load()))}deleteItem(t){let e=this.userContentUrl;return t.ownerFolder&&(e+="/"+t.ownerFolder),this.portal.request(e+`/items/${t.id}/delete`,{method:"post"}).then(()=>{t.id=null,t.portal=null})}deleteItems(t){const e=this.userContentUrl+"/deleteItems",r=t.map(i=>i.id);if(r.length){const i={method:"post",query:{items:r.join(",")}};return this.portal.request(e,i).then(()=>{t.forEach(s=>{s.id=null,s.portal=null})})}return Promise.resolve(void 0)}fetchFolders(){const t={query:{num:1}};return this.portal.request(this.userContentUrl??"",t).then(e=>{let r;return r=e&&e.folders?e.folders.map(i=>{const s=UFe.fromJSON(i);return s.portal=this.portal,s}):[],r})}fetchGroups(){return this.portal.request(this.url??"").then(t=>{let e;return e=t&&t.groups?t.groups.map(r=>{const i=yB.fromJSON(r);return i.portal=this.portal,i}):[],e})}fetchItems(t){const e=t??{};let r,i=this.userContentUrl??"";return e.folder&&(i+="/"+e.folder.id),he(()=>Promise.resolve().then(()=>dye),void 0,import.meta.url).then(({default:s})=>{r=s;const n={folders:!1,num:e.num||10,start:e.start||1,sortField:e.sortField||"created",sortOrder:e.sortOrder||"asc"};return this.portal.request(i,{query:n})}).then(s=>{let n;return s&&s.items?(n=s.items.map(o=>{const a=r.fromJSON(o);return a.portal=this.portal,a}),Promise.all(n.map(o=>o.load())).catch(o=>o).then(()=>({items:n,nextStart:s.nextStart,total:s.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal.request(this.url+"/tags").then(t=>t.tags)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}queryFavorites(t){return this.favGroupId?(this._favGroup||(this._favGroup=new yB({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(t)):Promise.reject(new U("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new U("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new _B;return e.sourceJSON=t,e.read(t),e}};u([p()],fs.prototype,"access",void 0),u([p({type:Date})],fs.prototype,"created",void 0),u([p()],fs.prototype,"culture",void 0),u([p()],fs.prototype,"description",void 0),u([p()],fs.prototype,"email",void 0),u([p()],fs.prototype,"favGroupId",void 0),u([p()],fs.prototype,"fullName",void 0),u([p({type:Date})],fs.prototype,"modified",void 0),u([p()],fs.prototype,"orgId",void 0),u([p()],fs.prototype,"portal",void 0),u([p()],fs.prototype,"preferredView",void 0),u([p()],fs.prototype,"privileges",void 0),u([p()],fs.prototype,"region",void 0),u([p()],fs.prototype,"role",void 0),u([p()],fs.prototype,"roleId",void 0),u([p()],fs.prototype,"sourceJSON",void 0),u([p()],fs.prototype,"thumbnail",void 0),u([p({readOnly:!0})],fs.prototype,"thumbnailUrl",null),u([p()],fs.prototype,"units",void 0),u([p({readOnly:!0})],fs.prototype,"userContentUrl",null),u([p({readOnly:!0})],fs.prototype,"url",null),u([p()],fs.prototype,"username",void 0),u([p()],fs.prototype,"userType",void 0),fs=_B=u([P("esri.portal.PortalUser")],fs);const dZ=fs,zFe=Object.freeze(Object.defineProperty({__proto__:null,default:dZ},Symbol.toStringTag,{value:"Module"}));var ag;let bI;const $re={PortalGroup:()=>he(()=>Promise.resolve().then(()=>kFe),void 0,import.meta.url),PortalItem:()=>he(()=>Promise.resolve().then(()=>dye),void 0,import.meta.url),PortalUser:()=>he(()=>Promise.resolve().then(()=>zFe),void 0,import.meta.url)};let Ue=ag=class extends _C(p0){constructor(t){super(t),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.basemapGalleryGroupQuery3D=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=Gr.portalUrl,this.urlKey=null,this.user=null,this.use3dBasemaps=!0,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(t){return typeof t=="string"?{url:t}:t}destroy(){Lre.unregister(this),this.defaultBasemap=Ne(this.defaultBasemap),this.defaultDevBasemap=Ne(this.defaultDevBasemap),this.defaultVectorBasemap=Ne(this.defaultVectorBasemap),this._esriIdCredentialCreateHandle=Fi(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(t){if(t)for(const e of t)Gr.request.trustedServers.includes(e)||Gr.request.trustedServers.push(e);return t}readDefaultBasemap(t){return this._readBasemap(t)}readDefaultDevBasemap(t){return this._readBasemap(t)}readDefaultVectorBasemap(t){return this._readBasemap(t)}get extraQuery(){const t=!(this.user&&this.user.orgId)||this.canSearchPublic;return this.id&&!t?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let t=this.url;if(t){const e=t.indexOf("/sharing");t=e>0?t.substring(0,e):this.url.replace(/\/+$/,""),t+="/sharing/rest"}return t}get thumbnailUrl(){const t=this.restUrl,e=this.thumbnail;return t&&e?this._normalizeSSL(t+"/portals/self/resources/"+e):null}readUrlKey(t){return t&&t.toLowerCase()}readUser(t){let e=null;return t&&(e=dZ.fromJSON(t),e.portal=this),e}load(t){const e=he(()=>Promise.resolve().then(()=>p6e),void 0,import.meta.url).then(({default:r})=>{Yt(t),bI=r}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,t)).then(r=>{if(Ii){const i=Ii;this.credential=i.findCredential(this.restUrl),this.credential||this.authMode!==ag.AUTH_MODE_AUTO||(this._esriIdCredentialCreateHandle?.remove(),this._esriIdCredentialCreateHandle=i.on("credential-create",VFe(new WeakRef(this))),Lre.register(this,this._esriIdCredentialCreateHandle,this))}this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(e),Promise.resolve(this)}async createElevationLayers(){await this.load();const t=this._getHelperService("defaultElevationLayers"),e=(await he(()=>import("./ElevationLayer-0902b0f4.js"),["./ElevationLayer-0902b0f4.js","./ArcGISCachedService-3fd67c19.js","./TileInfoTilemapCache-b4d9b863.js","./TilemapCache-c4e9fe9a.js"],import.meta.url)).default;return t?t.map(r=>new e({id:r.id,url:r.url})):[]}async fetchBasemaps(t,e){const r=await this._fetchBasemaps(t,e);if(e?.include3d===!0&&this.use3dBasemaps!==!1){const i=await this._fetchBasemaps3D(t,e);r.unshift(...i)}return r}fetchCategorySchema(t){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",t).then(e=>e.categorySchema):Mn(t)?Promise.reject(zr()):Promise.resolve([])}fetchFeaturedGroups(t){const e=this.featuredGroups,r=new Ff;if(r.num=100,r.sortField="title",e&&e.length){const i=[];for(const s of e)i.push(`(title:"${s.title}" AND owner:${s.owner})`);return r.query=i.join(" OR "),this.queryGroups(r,t).then(s=>s.results)}return Mn(t)?Promise.reject(zr()):Promise.resolve([])}fetchRegions(t){const e=this.user?.culture||this.culture||bp();return this.request(this.restUrl+"/portals/regions",{...t,query:{culture:e}})}fetchSettings(t){const e=this.user?.culture||this.culture||bp();return this.request(this.restUrl+"/portals/self/settings",{...t,query:{culture:e}})}static getDefault(){return DFe(()=>new ag)}queryGroups(t,e){return this.queryPortal("/community/groups",t,"PortalGroup",e)}queryItems(t,e){return this.queryPortal("/search",t,"PortalItem",e)}queryUsers(t,e){return t.sortField||(t.sortField="username"),this.queryPortal("/community/users",t,"PortalUser",e)}fetchSelf(t=this.authMode,e=!1,r){const i=this.restUrl+"/portals/self",s={authMode:t,query:{culture:bp().toLowerCase()},...r};return s.authMode==="auto"&&(s.authMode="no-prompt"),e&&(s.query.default=!0),this.request(i,s)}queryPortal(t,e,r,i){const s=ws(Ff,e),n=o=>this.request(this.restUrl+t,{...s.toRequestOptions(this),...i}).then(a=>{const l=s.clone();return l.start=a.nextStart,new FFe({nextQueryParams:l,queryParams:s,total:a.total,results:ag._resultsToTypedArray(o,{portal:this},a,i)})}).then(a=>Promise.all(a.results.map(l=>typeof l.when=="function"?l.when():a)).then(()=>a,l=>(zo(l),a)));return r&&$re[r]?$re[r]().then(({default:o})=>(Yt(i),n(o))):n()}signIn(){if(this.authMode===ag.AUTH_MODE_ANONYMOUS)return Promise.reject(new U("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const t=e=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(e||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=e,this.fetchSelf("immediate"))):this.user&&this.credential===e?null:(this.credential=e,this.fetchSelf("immediate"))).then(r=>{r&&(this.sourceJSON=r,this.read(r))});return Ii?Ii.getCredential(this.restUrl).then(e=>t(e)):t(this.credential)}normalizeUrl(t){const e=this.credential&&this.credential.token;return this._normalizeSSL(e?t+(t.includes("?")?"&":"?")+"token="+e:t)}requestToTypedArray(t,e,r){return this.request(t,e).then(i=>{const s=ag._resultsToTypedArray(r,{portal:this},i);return Promise.all(s.map(n=>typeof n.when=="function"?n.when():i)).then(()=>s,()=>s)})}request(t,e={}){const r={f:"json",...e.query},{authMode:i=this.authMode===ag.AUTH_MODE_ANONYMOUS?"anonymous":"auto",body:s=null,cacheBust:n=!1,method:o="auto",responseType:a="json",signal:l}=e,c={authMode:i,body:s,cacheBust:n,method:o,query:r,responseType:a,timeout:0,signal:l};return ur(this._normalizeSSL(t),c).then(h=>h.data)}toJSON(){throw new U("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new ag({sourceJSON:t})}_getHelperService(t){const e=this.helperServices&&this.helperServices[t];if(!e)throw new U("portal:service-not-found",`The \`helperServices\` do not include an entry named "${t}"`);return e}async _fetchBasemaps(t,e){const r=new Ff;r.query=t||(Gr.apiKey&&rye(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),r.disableExtraQuery=!0;const i=await this.queryGroups(r,e);if(!i.total)return[];const s=i.results[0];r.num=100,r.query='type:"Web Map" -type:"Web Application"',r.sortField=s.sortField||"name",r.sortOrder=s.sortOrder||"desc";const n=await s.queryItems(r,e);return n.total?n.results.filter(o=>o.type==="Web Map").map(o=>new bI({portalItem:o})):[]}async _fetchBasemaps3D(t,e){const r=t||this.basemapGalleryGroupQuery3D;if(!r)return[];const i=new Ff({query:r,disableExtraQuery:!0}),s=await this.queryGroups(i,e);if(!s.total)return[];const n=s.results[0];i.num=100,i.query='type:"Web Scene"',i.sortField=n.sortField||"name",i.sortOrder=n.sortOrder||"desc";const o=await n.queryItems(i,e);return o.total?o.results.filter(a=>a.type==="Web Scene").map(a=>new bI({portalItem:a})):[]}_normalizeSSL(t){return t.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(t){if(t){const e=bI.fromJSON(t);return e.portalItem={portal:this},e}return null}static _resultsToTypedArray(t,e,r,i){let s=[];if(r){const n=i!=null?i.signal:null;s=r.listings||r.notifications||r.userInvitations||r.tags||r.items||r.groups||r.comments||r.provisions||r.results||r.relatedItems||r,(t||e)&&(s=s.map(o=>{const a=Object.assign(t?t.fromJSON(o):o,e);return typeof a.load=="function"&&a.load(n),a}))}else s=[];return s}};Ue.AUTH_MODE_ANONYMOUS="anonymous",Ue.AUTH_MODE_AUTO="auto",Ue.AUTH_MODE_IMMEDIATE="immediate",u([p()],Ue.prototype,"access",void 0),u([p()],Ue.prototype,"allSSL",void 0),u([p()],Ue.prototype,"authMode",void 0),u([p()],Ue.prototype,"authorizedCrossOriginDomains",void 0),u([Oe("authorizedCrossOriginDomains")],Ue.prototype,"readAuthorizedCrossOriginDomains",null),u([p()],Ue.prototype,"basemapGalleryGroupQuery",void 0),u([p({json:{name:"3DBasemapGalleryGroupQuery"}})],Ue.prototype,"basemapGalleryGroupQuery3D",void 0),u([p()],Ue.prototype,"bingKey",void 0),u([p()],Ue.prototype,"canListApps",void 0),u([p()],Ue.prototype,"canListData",void 0),u([p()],Ue.prototype,"canListPreProvisionedItems",void 0),u([p()],Ue.prototype,"canProvisionDirectPurchase",void 0),u([p()],Ue.prototype,"canSearchPublic",void 0),u([p()],Ue.prototype,"canShareBingPublic",void 0),u([p()],Ue.prototype,"canSharePublic",void 0),u([p()],Ue.prototype,"canSignInArcGIS",void 0),u([p()],Ue.prototype,"canSignInIDP",void 0),u([p()],Ue.prototype,"colorSetsGroupQuery",void 0),u([p()],Ue.prototype,"commentsEnabled",void 0),u([p({type:Date})],Ue.prototype,"created",void 0),u([p()],Ue.prototype,"credential",void 0),u([p()],Ue.prototype,"culture",void 0),u([p()],Ue.prototype,"currentVersion",void 0),u([p()],Ue.prototype,"customBaseUrl",void 0),u([p()],Ue.prototype,"defaultBasemap",void 0),u([Oe("defaultBasemap")],Ue.prototype,"readDefaultBasemap",null),u([p()],Ue.prototype,"defaultDevBasemap",void 0),u([Oe("defaultDevBasemap")],Ue.prototype,"readDefaultDevBasemap",null),u([p({type:cr})],Ue.prototype,"defaultExtent",void 0),u([p()],Ue.prototype,"defaultVectorBasemap",void 0),u([Oe("defaultVectorBasemap")],Ue.prototype,"readDefaultVectorBasemap",null),u([p()],Ue.prototype,"description",void 0),u([p()],Ue.prototype,"devBasemapGalleryGroupQuery",void 0),u([p()],Ue.prototype,"eueiEnabled",void 0),u([p({readOnly:!0})],Ue.prototype,"extraQuery",null),u([p()],Ue.prototype,"featuredGroups",void 0),u([p()],Ue.prototype,"featuredItemsGroupQuery",void 0),u([p()],Ue.prototype,"galleryTemplatesGroupQuery",void 0),u([p()],Ue.prototype,"livingAtlasGroupQuery",void 0),u([p()],Ue.prototype,"hasCategorySchema",void 0),u([p()],Ue.prototype,"helpBase",void 0),u([p()],Ue.prototype,"helperServices",void 0),u([p()],Ue.prototype,"helpMap",void 0),u([p()],Ue.prototype,"homePageFeaturedContent",void 0),u([p()],Ue.prototype,"homePageFeaturedContentCount",void 0),u([p()],Ue.prototype,"httpPort",void 0),u([p()],Ue.prototype,"httpsPort",void 0),u([p()],Ue.prototype,"id",void 0),u([p()],Ue.prototype,"ipCntryCode",void 0),u([p({readOnly:!0})],Ue.prototype,"isOrganization",null),u([p()],Ue.prototype,"isPortal",void 0),u([p()],Ue.prototype,"isReadOnly",void 0),u([p({readOnly:!0})],Ue.prototype,"itemPageUrl",null),u([p()],Ue.prototype,"layerTemplatesGroupQuery",void 0),u([p()],Ue.prototype,"maxTokenExpirationMinutes",void 0),u([p({type:Date})],Ue.prototype,"modified",void 0),u([p()],Ue.prototype,"name",void 0),u([p()],Ue.prototype,"portalHostname",void 0),u([p()],Ue.prototype,"portalMode",void 0),u([p()],Ue.prototype,"portalProperties",void 0),u([p()],Ue.prototype,"region",void 0),u([p({readOnly:!0})],Ue.prototype,"restUrl",null),u([p()],Ue.prototype,"rotatorPanels",void 0),u([p()],Ue.prototype,"showHomePageDescription",void 0),u([p()],Ue.prototype,"sourceJSON",void 0),u([p()],Ue.prototype,"staticImagesUrl",void 0),u([p({json:{name:"2DStylesGroupQuery"}})],Ue.prototype,"stylesGroupQuery2d",void 0),u([p({json:{name:"stylesGroupQuery"}})],Ue.prototype,"stylesGroupQuery3d",void 0),u([p()],Ue.prototype,"supportsHostedServices",void 0),u([p()],Ue.prototype,"symbolSetsGroupQuery",void 0),u([p()],Ue.prototype,"templatesGroupQuery",void 0),u([p()],Ue.prototype,"thumbnail",void 0),u([p({readOnly:!0})],Ue.prototype,"thumbnailUrl",null),u([p()],Ue.prototype,"units",void 0),u([p()],Ue.prototype,"url",void 0),u([p()],Ue.prototype,"urlKey",void 0),u([Oe("urlKey")],Ue.prototype,"readUrlKey",null),u([p()],Ue.prototype,"user",void 0),u([Oe("user")],Ue.prototype,"readUser",null),u([p()],Ue.prototype,"use3dBasemaps",void 0),u([p()],Ue.prototype,"useStandardizedQuery",void 0),u([p()],Ue.prototype,"useVectorBasemaps",void 0),u([p()],Ue.prototype,"vectorBasemapGalleryGroupQuery",void 0),Ue=ag=u([P("esri.portal.Portal")],Ue);const en=Ue,Lre=new FinalizationRegistry(t=>{t.remove()});function VFe(t){const e=Ii;return()=>{const r=t.deref();r&&e.findCredential(r.restUrl)&&r.signIn().catch(()=>{})}}const BFe=K.getLogger("esri.assets");function GFe(t,e){return ur(jr(t),e)}function jr(t){if(!Gr.assetsPath)throw BFe.errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new U("assets:path-not-set","config.assetsPath is not set");return Fc(Gr.assetsPath,t)}let lg=class extends Te{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e&&e.portalItem&&e.path?{...e,path:this._normalizePath(e.path,e.portalItem)}:e}set path(e){e!=null&&$c(e)?K.getLogger(this).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return this._normalizePath(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get cdnUrl(){return this.portalItem&&this.path?`${this.portalItem.itemCdnUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",r){const i=this.cdnUrl;if(i==null)throw new U("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(i,{responseType:e,query:{token:this.portalItem.apiKey},signal:r?.signal})}async update(e,r){const{addOrUpdateResource:i}=await he(()=>Promise.resolve().then(()=>VO),void 0,import.meta.url);return i(this,"update",e,r)}hasPath(){return this.path!=null}_normalizePath(e,r){return e==null?e:(e=e.replace(/^\/+/,""),r!=null&&$c(e)&&(e=XY(e,r.itemUrl)),e?.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};u([p()],lg.prototype,"portalItem",void 0),u([p({type:String,value:null})],lg.prototype,"path",null),u([wr("path")],lg.prototype,"_castPath",null),u([p({type:String,readOnly:!0})],lg.prototype,"url",null),u([p({type:String,readOnly:!0})],lg.prototype,"cdnUrl",null),u([p({type:String,readOnly:!0})],lg.prototype,"itemRelativeUrl",null),lg=u([P("esri.portal.PortalItemResource")],lg);const jFe=lg;let bA=class extends Te{constructor(e){super(e),this.created=null,this.rating=null}};u([p()],bA.prototype,"created",void 0),u([p()],bA.prototype,"rating",void 0),bA=u([P("esri.portal.PortalRating")],bA);const OU=bA;var N1;const HFe=new Set(["Map Service","Feature Service","Feature Collection","Scene Service","Image Service","Stream Service","Vector Tile Service","GeoJson","CSV","KML","WFS","WMTS","WMS","Feed"]),qFe=new Set(["KML","GeoJson","CSV"]);let ar=N1=class extends _C(p0){static from(t){return Mw(N1,t)}constructor(t){super(t),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const t=this.type,e=this.typeKeywords||[];let r=t;return t==="Feature Service"||t==="Feature Collection"?r=e.includes("Table")?"Table":e.includes("Route Layer")?"Route Layer":e.includes("Markup")?"Markup":"Feature Layer":t==="Image Service"?r=e.includes("Elevation 3D Layer")?"Elevation Layer":e.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":t==="Scene Service"?r="Scene Layer":t==="Video Service"?r="Video Layer":t==="Scene Package"?r="Scene Layer Package":t==="Stream Service"?r="Feature Layer":t==="Geoprocessing Service"?r=e.includes("Web Tool")?"Tool":"Geoprocessing Service":t==="Geocoding Service"?r="Locator":t==="Geoenrichment Service"?r="GeoEnrichment Service":t==="Microsoft Powerpoint"?r="Microsoft PowerPoint":t==="GeoJson"?r="GeoJSON":t==="Globe Service"?r="Globe Layer":t==="Vector Tile Service"?r="Tile Layer":t==="netCDF"?r="NetCDF":t==="Map Service"?r=e.includes("Spatiotemporal")||!e.includes("Hosted Service")&&!e.includes("Tiled")||e.includes("Relational")?"Map Image Layer":"Tile Layer":t&&t.toLowerCase().includes("add in")?r=t.replaceAll(/(add in)/gi,"Add-In"):t==="datastore catalog service"?r="Big Data File Share":t==="Compact Tile Package"?r="Tile Package (tpkx)":t==="OGCFeatureServer"?r="OGC Feature Layer":t==="web mapping application"&&e.includes("configurableApp")?r="Instant App":t==="Insights Page"?r="Insights Report":t==="Excalibur Imagery Project"&&(r="Excalibur Project"),r}readExtent(t){return t&&t.length?new cr(t[0][0],t[0][1],t[1][0],t[1][1]):null}get iconUrl(){const t=this.type&&this.type.toLowerCase()||"",e=this.typeKeywords||[],r="esri/images/portal/",i="16";let s,n=!1,o=!1,a=!1,l=!1,c=!1,h=!1;return t.indexOf("service")>0||t==="feature collection"||t==="kml"||t==="wms"||t==="wmts"||t==="wfs"?(n=e.includes("Hosted Service"),t==="feature service"||t==="feature collection"||t==="kml"||t==="wfs"?(o=e.includes("Table"),a=e.includes("Route Layer"),l=e.includes("Markup"),c=e.includes("Spatiotemporal"),h=e.includes("UtilityNetwork"),s=c&&o?"spatiotemporaltable":o?"table":a?"routelayer":l?"markup":c?"spatiotemporal":n?"featureshosted":h?"utilitynetwork":"features"):s=t==="map service"||t==="wms"||t==="wmts"?n||e.includes("Tiled")||t==="wmts"?"maptiles":"mapimages":t==="scene service"?e.includes("Line")?"sceneweblayerline":e.includes("3DObject")?"sceneweblayermultipatch":e.includes("Point")?"sceneweblayerpoint":e.includes("IntegratedMesh")?"sceneweblayermesh":e.includes("PointCloud")?"sceneweblayerpointcloud":e.includes("Polygon")?"sceneweblayerpolygon":e.includes("Building")?"sceneweblayerbuilding":e.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":t==="image service"?e.includes("Elevation 3D Layer")?"elevationlayer":e.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":t==="stream service"?"streamlayer":t==="video service"?e.includes("Live Stream")?"livestreamvideolayer":"videolayer":t==="vector tile service"?"vectortile":t==="datastore catalog service"?"datastorecollection":t==="geocoding service"?"geocodeservice":t==="geoprocessing service"?e.includes("Web Tool")?"tool":"layers":t==="geodata service"?"geodataservice":"layers"):s=t==="web map"||t==="cityengine web scene"?"maps":t==="web scene"?e.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":t==="web mapping application"&&e.includes("configurableApp")?"instantapps":t==="web mapping application"||t==="mobile application"||t==="application"||t==="operation view"||t==="desktop application"?"apps":t==="map document"||t==="map package"||t==="published map"||t==="scene document"||t==="globe document"||t==="basemap package"||t==="mobile basemap package"||t==="mobile map package"||t==="project package"||t==="project template"||t==="pro map"||t==="layout"||t==="layer"&&e.includes("ArcGIS Pro")||t==="explorer map"&&e.indexOf("Explorer Document")?"mapsgray":t==="service definition"||t==="csv"||t==="shapefile"||t==="cad drawing"||t==="geojson"||t==="netcdf"||t==="administrative report"?"datafiles":t==="explorer add in"||t==="desktop add in"||t==="windows viewer add in"||t==="windows viewer configuration"?"appsgray":t==="360 vr experience"?"360vr":t==="arcgis pro add in"||t==="arcgis pro configuration"?"addindesktop":t==="rule package"||t==="file geodatabase"||t==="sqlite geodatabase"||t==="csv collection"||t==="kml collection"||t==="windows mobile package"||t==="map template"||t==="desktop application template"||t==="gml"||t==="arcpad package"||t==="code sample"||t==="form"||t==="document link"||t==="earth configuration"||t==="operations dashboard add in"||t==="rules package"||t==="image"||t==="workflow manager package"||t==="explorer map"&&e.includes("Explorer Mapping Application")||e.includes("Document")?"datafilesgray":t==="network analysis service"||t==="geoprocessing service"||t==="geodata service"||t==="geometry service"||t==="geoprocessing package"||t==="locator package"||t==="geoprocessing sample"||t==="workflow manager service"?"toolsgray":t==="layer"||t==="layer package"||t==="explorer layer"?"layersgray":t==="scene package"?"scenepackage":t==="mobile scene package"?"mobilescenepackage":t==="tile package"||t==="compact tile package"?"tilepackage":t==="task file"?"taskfile":t==="report template"?"report-template":t==="statistical data collection"?"statisticaldatacollection":t==="insights workbook"?"workbook":t==="insights model"?"insightsmodel":t==="insights page"?"insightspage":t==="insights theme"?"insightstheme":t==="hub initiative"?"hubinitiative":t==="hubpage"?"hubpage":t==="hub event"?"hubevent":t==="hub site application"?"hubsite":t==="hub project"?"hubproject":t==="relational database connection"?"relationaldatabaseconnection":t==="big data file share"?"datastorecollection":t==="image collection"?"imagecollection":t==="style"?"style":t==="desktop style"?"desktopstyle":t==="dashboard"?"dashboard":t==="raster function template"?"rasterprocessingtemplate":t==="vector tile package"?"vectortilepackage":t==="ortho mapping project"?"orthomappingproject":t==="ortho mapping template"?"orthomappingtemplate":t==="solution"?"solutions":t==="geopackage"?"geopackage":t==="deep learning package"?"deeplearningpackage":t==="real time analytic"?"realtimeanalytics":t==="big data analytic"?"bigdataanalytics":t==="feed"?"feed":t==="excalibur imagery project"?"excaliburimageryproject":t==="notebook"?"notebook":t==="storymap"?"storymap":t==="survey123 add in"?"survey123addin":t==="mission"?"mission":t==="mission report"?"missionreport":t==="quickcapture project"?"quickcaptureproject":t==="pro report"?"proreport":t==="pro report template"?"proreporttemplate":t==="urban model"?"urbanmodel":t==="web experience"?"experiencebuilder":t==="web experience template"?"webexperiencetemplate":t==="experience builder widget"?"experiencebuilderwidget":t==="experience builder widget package"?"experiencebuilderwidgetpackage":t==="workflow"?"workflow":t==="insights script"?"insightsscript":t==="kernel gateway connection"?"kernelgatewayconnection":t==="hub initiative template"?"hubinitiativetemplate":t==="storymap theme"?"storymaptheme":t==="knowledge graph"?"knowledgegraph":t==="native application"?"nativeapp":t==="native application installer"?"nativeappinstaller":t==="link chart"?"linkchart":t==="investigation"?"investigation":t==="ogcfeatureserver"?"features":t==="pro project"?"proproject":t==="insights workbook package"?"insightsworkbookpackage":t==="apache parquet"?"apacheparquet":t==="notebook code snippets"||t==="notebook code snippet library"?"notebookcodesnippets":t==="suitability model"?"suitabilitymodel":t==="esri classifier definition"?"classifierdefinition":t==="esri classification schema"?"classificationschema":t==="insights data engineering workbook"?"dataengineeringworkbook":t==="insights data engineering model"?"dataengineeringmodel":t==="deep learning studio project"?"deeplearningproject":t==="discussion"?"discussion":t==="allsource project"?"allsourceproject":t==="api key"?"apikey":t==="data pipeline"?"datapipelines":"maps",s?jr(r+s+i+".png"):null}get isLayer(){return this.type!=null&&HFe.has(this.type)}get itemCdnUrl(){let t=this.itemUrl;return t&&Ii&&!Ii.findCredential(t)&&(t=Ii._normalizeAGOLorgDomain(t),t=t.replace(/^https?:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com"),t=t.replace(/^https?:\/\/devext\.arcgis\.com/,"https://cdndev.arcgis.com"),t=t.replace(/^https?:\/\/qaext\.arcgis\.com/,"https://cdnqa.arcgis.com")),t}get itemPageUrl(){const t=this.portal?.itemPageUrl;return t&&this.id?`${t}?id=${this.id}`:null}get itemUrl(){const t=this.portal?.restUrl;return t&&this.id?`${t}/content/items/${this.id}`:null}get thumbnailUrl(){const t=this.itemUrl,e=this.thumbnail;return t&&e?this.portal?.normalizeUrl(`${t}/info/${e}?f=json`)??null:null}get userItemUrl(){const t=this.get("portal.restUrl");if(!t)return null;const e=this.owner||this.get("portal.user.username");return e?`${t}/content/users/${this.ownerFolder?`${e}/${this.ownerFolder}`:e}/items/${this.id}`:null}load(t){const e=this.portal??(this.portal=en.getDefault()),r=e.load(t).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?e.request(this.itemUrl,{signal:t!=null?t.signal:null,query:{token:this.apiKey}}):{}).then(i=>{this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(r),Promise.resolve(this)}async addRating(t){const e={method:"post",query:{}};return t instanceof OU&&(t=t.rating),t==null||isNaN(t)||typeof t!="number"||(e.query.rating=t),this.portal?(await this.portal.request(this.itemUrl+"/addRating",e),new OU({rating:t,created:new Date})):null}clone(){const t={access:this.access,accessInformation:this.accessInformation,applicationProxies:ee(this.applicationProxies),avgRating:this.avgRating,categories:ee(this.categories),created:ee(this.created),culture:this.culture,description:this.description,extent:ee(this.extent),groupCategories:ee(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:ee(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:ee(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:ee(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:ee(this.typeKeywords),url:this.url};this.loaded&&(t.loadStatus="loaded");const e=new N1({sourceJSON:this.sourceJSON}).set(t);return e._set("isOrgItem",this.isOrgItem),e}createPostQuery(){const t=this.toJSON();for(const r of["tags","typeKeywords","categories"])t[r]=t[r]?.join(", ");const{extent:e}=t;return e&&(t.extent=JSON.stringify(e)),t}async deleteRating(){await _c(this.portal).request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(t="json",e){return _c(this.portal).request(this.itemUrl+"/data",{responseType:t,...e,query:{token:this.apiKey}})}async fetchRating(t){const e=await _c(this.portal).request(this.itemUrl+"/rating",{query:{token:this.apiKey},...t});return e.rating!=null?(e.created=new Date(e.created),new OU(e)):null}fetchRelatedItems(t,e){return _c(this.portal).requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...t,token:this.apiKey},...e},N1)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}reload(){return _c(this.portal).request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then(t=>(this.sourceJSON=t,this.read(t),this))}update(t){return this.id?this.load().then(()=>_c(this.portal).signIn()).then(()=>{const e=t&&t.data,r={method:"post"};r.query=this.createPostQuery();for(const i in r.query)r.query[i]===null&&(r.query[i]="");return r.query.clearEmptyFields=!0,e!=null&&(typeof e=="string"?r.query.text=e:typeof e=="object"&&(r.query.text=JSON.stringify(e))),this.portal.request(`${this.userItemUrl}/update`,r).then(()=>this.reload())}):Promise.reject(new U("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(t){if(!this.id)throw new U("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:e,itemUrl:r}=this;await _c(e).signIn();const{copyResources:i,folder:s,tags:n,title:o}=t||{},a={method:"post",query:{copyPrivateResources:i==="all",folder:typeof s=="string"?s:s?.id,includeResources:!!i,tags:n?.join(","),title:o}},{itemId:l}=await e.request(`${r}/copy`,a);return new N1({id:l,portal:e})}updateThumbnail(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t.thumbnail,r=t.filename,i={method:"post"};if(typeof e=="string")Am(e)?i.query={data:e}:i.query={url:_u(e)},r!=null&&(i.query.filename=r);else{const s=new FormData;r!=null?s.append("file",e,r):s.append("file",e),i.body=s}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,i).then(()=>this.reload())}):Promise.reject(new U("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(t={},e){const{fetchResources:r}=await he(()=>Promise.resolve().then(()=>VO),void 0,import.meta.url);return r(this,t,e)}async addResource(t,e,r){const{addOrUpdateResource:i}=await he(()=>Promise.resolve().then(()=>VO),void 0,import.meta.url);return t.portalItem=this,i(t,"add",e,r)}async removeResource(t,e){const{removeResource:r}=await he(()=>Promise.resolve().then(()=>VO),void 0,import.meta.url);if(t.portalItem&&t.portalItem.itemUrl!==this.itemUrl)throw new U("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return r(this,t,e)}async removeAllResources(t){const{removeAllResources:e}=await he(()=>Promise.resolve().then(()=>VO),void 0,import.meta.url);return e(this,t)}resourceFromPath(t){return new jFe({portalItem:this,path:t})}toJSON(){const t=this.extent,e={accessInformation:this.accessInformation,categories:ee(this.categories),created:this.created&&this.created.getTime(),description:this.description,extent:t&&[[t.xmin,t.ymin],[t.xmax,t.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:this.modified&&this.modified.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:ee(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:ee(this.typeKeywords),url:this.url};return Tge(e)}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new N1({sourceJSON:t})}_getPostQuery(){const t=this.toJSON();for(const e in t)e==="tags"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="typeKeywords"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="extent"&&t[e]&&(t[e]=JSON.stringify(t[e]));return t}};u([p({type:["private","shared","org","public"]})],ar.prototype,"access",void 0),u([p()],ar.prototype,"accessInformation",void 0),u([p({type:String})],ar.prototype,"apiKey",void 0),u([p({json:{read:{source:"appProxies"}}})],ar.prototype,"applicationProxies",void 0),u([p()],ar.prototype,"avgRating",void 0),u([p()],ar.prototype,"categories",void 0),u([p({type:Date})],ar.prototype,"created",void 0),u([p()],ar.prototype,"culture",void 0),u([p()],ar.prototype,"description",void 0),u([p({readOnly:!0})],ar.prototype,"displayName",null),u([p({type:cr})],ar.prototype,"extent",void 0),u([Oe("extent")],ar.prototype,"readExtent",null),u([p()],ar.prototype,"groupCategories",void 0),u([p({readOnly:!0})],ar.prototype,"iconUrl",null),u([p()],ar.prototype,"id",void 0),u([p({readOnly:!0})],ar.prototype,"isLayer",null),u([p({type:Boolean,readOnly:!0})],ar.prototype,"isOrgItem",void 0),u([p()],ar.prototype,"itemControl",void 0),u([p({readOnly:!0})],ar.prototype,"itemPageUrl",null),u([p({readOnly:!0})],ar.prototype,"itemUrl",null),u([p()],ar.prototype,"licenseInfo",void 0),u([p({type:Date})],ar.prototype,"modified",void 0),u([p()],ar.prototype,"name",void 0),u([p()],ar.prototype,"numComments",void 0),u([p()],ar.prototype,"numRatings",void 0),u([p()],ar.prototype,"numViews",void 0),u([p()],ar.prototype,"owner",void 0),u([p()],ar.prototype,"ownerFolder",void 0),u([p({type:en})],ar.prototype,"portal",void 0),u([p()],ar.prototype,"screenshots",void 0),u([p()],ar.prototype,"size",void 0),u([p()],ar.prototype,"snippet",void 0),u([p()],ar.prototype,"sourceJSON",void 0),u([p({type:String})],ar.prototype,"sourceUrl",void 0),u([p({type:String})],ar.prototype,"spatialReference",void 0),u([p()],ar.prototype,"tags",void 0),u([p()],ar.prototype,"thumbnail",void 0),u([p({readOnly:!0})],ar.prototype,"thumbnailUrl",null),u([p()],ar.prototype,"title",void 0),u([p()],ar.prototype,"type",void 0),u([p()],ar.prototype,"typeKeywords",void 0),u([p({type:String,json:{read(t,e){if(qFe.has(e.type)){const r=this.portal?.restUrl;t||(t=r&&this.id?`${r}/content/items/${this.id}/data`:null)}return t}}})],ar.prototype,"url",void 0),u([p({readOnly:!0})],ar.prototype,"userItemUrl",null),ar=N1=u([P("esri.portal.PortalItem")],ar);const hw=ar,dye=Object.freeze(Object.defineProperty({__proto__:null,default:hw},Symbol.toStringTag,{value:"Module"})),Dre=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,WFe={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function Nre(t){return t in WFe}const wA=[],RS=new Map;function Fre(t){for(const e of RS.keys())pye(t.pattern,e)&&RS.delete(e)}function XFe(t){return wA.includes(t)||(Fre(t),wA.unshift(t)),{remove(){const e=wA.indexOf(t);e>-1&&(wA.splice(e,1),Fre(t))}}}async function pZ(t){const e=bp();RS.has(t)||RS.set(t,ZFe(t,e));const r=RS.get(t);return r&&await JFe.add(r),r}function YFe(t){if(!Dre.test(t))return null;const e=Dre.exec(t);if(e===null)return null;const[,r,i]=e,s=r+(i?"-"+i.toUpperCase():"");return Nre(s)?s:Nre(r)?r:null}async function ZFe(t,e){const r=[];for(const i of wA)if(pye(i.pattern,t))try{return await i.fetchMessageBundle(t,e)}catch(s){r.push(s)}throw r.length?new U("intl:message-bundle-error",`Errors occurred while loading "${t}"`,{errors:r}):new U("intl:no-message-bundle-loader",`No loader found for message bundle "${t}"`)}function pye(t,e){return typeof t=="string"?e.startsWith(t):t.test(e)}hZ(()=>{RS.clear()});const JFe=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(t){return this._increase(),t.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=Eo())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}};async function QFe(t){if(!t)return;const e=t.includes("-vector")?t.slice(0,t.indexOf("-vector")):t,r=await pZ("esri/t9n/basemaps");return r[t]||r[e]}const vB={streets:{id:"streets",classic:!0,deprecated:!0,get thumbnailUrl(){return jr("esri/images/basemap/streets.jpg")},baseMapLayers:[{id:"streets-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Street Map",showLegend:!1,visibility:!0,opacity:1}]},satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return jr("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return jr("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return jr("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},topo:{id:"topo",classic:!0,deprecated:!0,get thumbnailUrl(){return jr("esri/images/basemap/topo.jpg")},baseMapLayers:[{id:"topo-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Topo Map",showLegend:!1,visibility:!0,opacity:1}]},gray:{id:"gray",classic:!0,deprecated:!0,get thumbnailUrl(){return jr("esri/images/basemap/gray.jpg")},baseMapLayers:[{id:"gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"dark-gray":{id:"dark-gray",classic:!0,deprecated:!0,get thumbnailUrl(){return jr("esri/images/basemap/dark-gray.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"dark-gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return jr("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"national-geographic":{id:"national-geographic",classic:!0,deprecated:!0,get thumbnailUrl(){return jr("esri/images/basemap/national-geographic.jpg")},baseMapLayers:[{id:"national-geographic-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer",title:"NatGeo World Map",showLegend:!1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return jr("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return jr("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return jr("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return jr("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return jr("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return jr("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return jr("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return jr("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"arcgis-imagery":{get thumbnailUrl(){return jr("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return jr("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return jr("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return jr("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return jr("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return jr("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return jr("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return jr("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return jr("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return jr("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}};function f4t(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="feature"}function aR(t){const e=t?.type;return e==="base-tile"||e==="tile"||e==="elevation"||e==="imagery-tile"||e==="base-elevation"||e==="open-street-map"||e==="wcs"||e==="web-tile"||e==="wmts"||e==="vector-tile"}function mE(t){return t!=null&&"type"in t&&t.type==="group"}const m4t={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function fye(t){const e=t?.type;return e==="building-scene"||e==="integrated-mesh"||e==="point-cloud"||e==="scene"}function Ure(t){return t?.type==="voxel"}function kre(t){return t?.type==="imagery-tile"}function mye(t){return t!=null&&t.parent!=null&&"declaredClass"in t.parent&&t.parent.declaredClass==="esri.Basemap"&&t.parent.baseLayers.includes(t)}function fZ(t){return t?.type==="feature"&&!t.url&&t.source?.type==="memory"}function g4t(t){return t?.type==="feature"&&t.source?.type==="feature-layer"}function KFe(t){if(t.activeLayer){const e=t.activeLayer.tileMatrixSet;if(e)return e;const r=t.activeLayer.tileMatrixSets;if(r)return r}return null}async function gye(t,e){const r=Ii?.findServerInfo(t);if(r?.currentVersion!=null)return r.owningSystemUrl||null;const i=t.toLowerCase().indexOf("/rest/services");if(i===-1)return null;const s=`${t.substring(0,i)}/rest/info`,n=e!=null?e.signal:null,{data:o}=await ur(s,{query:{f:"json"},responseType:"json",signal:n});return o?.owningSystemUrl||null}function e6e(t){if(!("capabilities"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function t6e(t){return e6e(t)?"effectiveCapabilities"in t?t.effectiveCapabilities:t.capabilities:null}function r6e(t){if(!("editingEnabled"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}function i6e(t){return!!r6e(t)&&("effectiveEditingEnabled"in t?t.effectiveEditingEnabled:t.editingEnabled)}const s6e=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),n6e=new Set(["csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","map-image","map-notes","media","ogc-feature","route","stream","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function o6e(t){return t.layerContainerType==="basemap"?s6e:t.layerContainerType==="operational-layers"?n6e:null}function a6e(t,e){if(e.restrictedWebMapWriting){const r=o6e(e);return r==null||r.has(t.type)&&!fZ(t)}return!0}function l6e(t,e){if(e)if(fZ(t)){const r=cP("featureCollection.layers",e),i=r&&r[0]&&r[0].layerDefinition;i&&zre(t,i)}else t.type!=="group"&&zre(t,e)}function zre(t,e){"maxScale"in t&&(e.maxScale=Y4(t.maxScale)??void 0),"minScale"in t&&(e.minScale=Y4(t.minScale)??void 0)}function c6e(t,e){if(l6e(t,e),e&&("blendMode"in t&&(e.blendMode=t.blendMode,e.blendMode==="normal"&&delete e.blendMode),e.opacity=Y4(t.opacity)??void 0,e.title=t.title||"Layer",e.visibility=t.visible,"legendEnabled"in t&&t.type!=="wmts"))if(fZ(t)){const r=e.featureCollection;r&&(r.showLegend=t.legendEnabled)}else e.showLegend=t.legendEnabled}function Vre(t,e,r){if(!("write"in t)||!t.write)return r&&r.messages&&r.messages.push(new U("layer:unsupported",`Layers (${t.title}, ${t.id}) of type '${t.declaredClass}' cannot be persisted`,{layer:t})),null;if(a6e(t,r)){const i={};return t.write(i,r)?i:null}return e!=null&&c6e(t,e=ee(e)),e}var FD;let u6e=0;const yye="esri.Basemap";let rh=FD=class extends _C(p0){constructor(t){super(t),this.id=null,this.portalItem=null,this.spatialReference=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+u6e++,this.baseLayers=new Pt,this.referenceLayers=new Pt;const e=i=>{i.parent&&i.parent!==this&&"remove"in i.parent&&i.parent.remove(i),i.parent=this,i.type==="elevation"&&K.getLogger(this).error(`Layer '${i.title}, id:${i.id}' of type '${i.type}' is not supported as a basemap layer and will therefore be ignored.`)},r=i=>{i.parent=null};this.addHandles([this.baseLayers.on("after-add",i=>e(i.item)),this.referenceLayers.on("after-add",i=>e(i.item)),this.baseLayers.on("after-remove",i=>r(i.item)),this.referenceLayers.on("after-remove",i=>r(i.item))])}initialize(){this.when().catch(t=>{K.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.baseLayers.removeAll();for(const r of t)r.destroy();const e=this.referenceLayers.removeAll();for(const r of e)r.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),this.portalItem?.destroy(),this.portalItem=null}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set baseLayers(t){this._set("baseLayers",Pw(t,this._get("baseLayers")))}_writeBaseLayers(t,e,r){const i=[];t&&(r={...r,layerContainerType:"basemap"},this.baseLayers.forEach(s=>{const n=Vre(s,r.webmap?r.webmap.getLayerJSONFromResourceInfo(s):null,r);n!=null&&i.push(n)}),this.referenceLayers.forEach(s=>{const n=Vre(s,r.webmap?r.webmap.getLayerJSONFromResourceInfo(s):null,r);n!=null&&(s.type!=="scene"&&(n.isReference=!0),i.push(n))})),e.baseMapLayers=i}set referenceLayers(t){this._set("referenceLayers",Pw(t,this._get("referenceLayers")))}writeTitle(t,e){e.title=t||"Basemap"}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return P0e(this,t=>{t(this.baseLayers,this.referenceLayers)})}clone(){const t={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map(e=>D4(e)?e.clone():e),referenceLayers:this.referenceLayers.map(e=>D4(e)?e.clone():e)};return this.loaded&&(t.loadStatus="loaded"),new FD({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}write(t,e){return t=t||{},e&&e.origin||(e={origin:"web-map",...e}),super.write(t,e),!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(t.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(r=>{const i=ee(r);return i.url&&pm(i.url)&&(i.url=`https:${i.url}`),i.templateUrl&&pm(i.templateUrl)&&(i.templateUrl=`https:${i.templateUrl}`),i})),t}async _loadFromSource(t){const{resourceInfo:e,portalItem:r}=this;Yt(t);const i=[];if(e){const s=e.context?e.context.url:null;if(i.push(this._loadLayersFromJSON(e.data,s,t)),e.data.id&&!e.data.title){const n=e.data.id;i.push(QFe(n).then(o=>{o&&this.read({title:o},e.context)}))}}else r&&i.push(this._loadFromItem(r,t));await Promise.all(i)}async _loadLayersFromJSON(t,e,r){const i=this.resourceInfo&&this.resourceInfo.context,s=this.portalItem&&this.portalItem.portal||i&&i.portal||null,n=d6e[i?.origin||""]??"web-map",{populateOperationalLayers:o}=await he(()=>import("./layersCreator-69626637.js"),["./layersCreator-69626637.js","./lazyLayerLoader-8f831dc7.js","./portalLayers-7c874b5a.js","./layersLoader-76363640.js","./fetchService-21f7bf3b.js","./jsonContext-bd549146.js"],import.meta.url),a=[];if(Yt(r),t.baseMapLayers&&Array.isArray(t.baseMapLayers)){const l={context:{origin:n,url:e,portal:s,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},c=f=>n==="web-scene"&&f.layerType==="ArcGISSceneServiceLayer"||f.isReference,h=o(this.baseLayers,t.baseMapLayers.filter(f=>!c(f)),l);a.push(h);const d=o(this.referenceLayers,t.baseMapLayers.filter(c),l);a.push(d)}await Ac(a)}async _loadFromItem(t,e){const r=await t.load(e),i=await r.fetchData("json",e),s=Co(t.itemUrl??"");return this._set("resourceInfo",{data:i.baseMap??{},context:{origin:h6e[t.type||""]??"web-map",portal:t.portal||en.getDefault(),url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:i.spatialReference},this.resourceInfo.context),this.read({title:t.title,thumbnailUrl:t.thumbnailUrl},{origin:"portal-item",portal:t.portal||en.getDefault(),url:s}),this._loadLayersFromJSON(this.resourceInfo.data,s,e)}static fromId(t){const e=vB[t];if(!e)return null;if(e.deprecated){let r=null;t==="dark-gray"?r="dark-gray-vector":t==="gray"?r="gray-vector":t==="streets"?r="streets-vector":t==="topo"&&(r="topo-vector"),Z4(K.getLogger(yye),`The ${t} basemap has entered mature support and is no longer being updated.`,{replacement:r,see:"https://arcg.is/1iq8aD",warnOnce:!0})}return FD.fromJSON(e)}};u([p({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(t,e,r,i){this._writeBaseLayers(t,e,i)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:Pt}},writer(t,e,r,i){this._writeBaseLayers(t,e,i)}}}}}})],rh.prototype,"baseLayers",null),u([p({type:String,json:{origins:{"web-scene":{write:!0}}}})],rh.prototype,"id",void 0),u([p({type:hw})],rh.prototype,"portalItem",void 0),u([p()],rh.prototype,"referenceLayers",null),u([p({readOnly:!0})],rh.prototype,"resourceInfo",void 0),u([p({type:qe})],rh.prototype,"spatialReference",void 0),u([p()],rh.prototype,"thumbnailUrl",void 0),u([p({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],rh.prototype,"title",void 0),u([Be("title")],rh.prototype,"writeTitle",null),rh=FD=u([P(yye)],rh);const h6e={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},d6e={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"},s5=rh,p6e=Object.freeze(Object.defineProperty({__proto__:null,default:s5},Symbol.toStringTag,{value:"Module"})),n5={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function _ye(t){return!!n5[t]||!!n5[t.toLowerCase()]}function mZ(t){return n5[t]??n5[t.toLowerCase()]}function f6e(t){return[...mZ(t)]}function RU(t,e,r){r<0&&++r,r>1&&--r;const i=6*r;return i<1?t+(e-t)*i:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}function vye(t,e,r,i=1){const s=(t%360+360)%360/360,n=r<=.5?r*(e+1):r+e-r*e,o=2*r-n;return[Math.round(255*RU(o,n,s+1/3)),Math.round(255*RU(o,n,s)),Math.round(255*RU(o,n,s-1/3)),i]}function m6e(t){const e=t.length>5,r=e?8:4,i=(1<<r)-1,s=e?1:17,n=e?t.length===9:t.length===5;let o=+("0x"+t.substr(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return n&&(l=o&i,o>>=r,a[3]=s*l/255),l=o&i,o>>=r,a[2]=s*l,l=o&i,o>>=r,a[1]=s*l,l=o&i,o>>=r,a[0]=s*l,a}function O(){return[0,0,0]}function ks(t){return[t[0],t[1],t[2]]}function Pe(t,e,r){return[t,e,r]}function Qa(t){const e=O(),r=Math.min(3,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function gZ(t,e){return new Float64Array(t,e,3)}function bye(){return O()}function wye(){return Pe(1,1,1)}function xye(){return Pe(1,0,0)}function Tye(){return Pe(0,1,0)}function yZ(){return Pe(0,0,1)}const sl=bye(),Hg=wye(),Sye=xye(),Eye=Tye(),_Z=yZ();Object.freeze(Object.defineProperty({__proto__:null,ONES:Hg,UNIT_X:Sye,UNIT_Y:Eye,UNIT_Z:_Z,ZEROS:sl,clone:ks,create:O,createView:gZ,fromArray:Qa,fromValues:Pe,ones:wye,unitX:xye,unitY:Tye,unitZ:yZ,zeros:bye},Symbol.toStringTag,{value:"Module"}));let vZ=1e-6;function cl(){return vZ}function g6e(t){vZ=t}const fP=Math.random,y6e=Math.PI/180,_6e=180/Math.PI;function q6(t){return t*y6e}function v6e(t){return t*_6e}function b6e(t,e){return Math.abs(t-e)<=vZ*Math.max(1,Math.abs(t),Math.abs(e))}Object.freeze(Object.defineProperty({__proto__:null,RANDOM:fP,equals:b6e,getEpsilon:cl,setEpsilon:g6e,toDegree:v6e,toRadian:q6},Symbol.toStringTag,{value:"Module"}));function Re(t){const e=t[0],r=t[1],i=t[2];return Math.sqrt(e*e+r*r+i*i)}function ie(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function ne(t,e,r,i){return t[0]=e,t[1]=r,t[2]=i,t}function de(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function fe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function W6(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function o5(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function w6e(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function Cye(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function a5(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t}function Aye(t,e){return t[0]=Math.sign(e[0]),t[1]=Math.sign(e[1]),t[2]=Math.sign(e[2]),t}function bZ(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function x6e(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function T6e(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function se(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function Kb(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t}function mi(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2];return Math.sqrt(r*r+i*i+s*s)}function xo(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2];return r*r+i*i+s*s}function da(t){const e=t[0],r=t[1],i=t[2];return e*e+r*r+i*i}function va(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function S6e(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function _e(t,e){const r=e[0],i=e[1],s=e[2];let n=r*r+i*i+s*s;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n),t}function ye(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function pt(t,e,r){const i=e[0],s=e[1],n=e[2],o=r[0],a=r[1],l=r[2];return t[0]=s*l-n*a,t[1]=n*o-i*l,t[2]=i*a-s*o,t}function qr(t,e,r,i){const s=e[0],n=e[1],o=e[2];return t[0]=s+i*(r[0]-s),t[1]=n+i*(r[1]-n),t[2]=o+i*(r[2]-o),t}function E6e(t,e,r,i,s,n){const o=n*n,a=o*(2*n-3)+1,l=o*(n-2)+n,c=o*(n-1),h=o*(3-2*n);return t[0]=e[0]*a+r[0]*l+i[0]*c+s[0]*h,t[1]=e[1]*a+r[1]*l+i[1]*c+s[1]*h,t[2]=e[2]*a+r[2]*l+i[2]*c+s[2]*h,t}function C6e(t,e,r,i,s,n){const o=1-n,a=o*o,l=n*n,c=a*o,h=3*n*a,d=3*l*o,f=l*n;return t[0]=e[0]*c+r[0]*h+i[0]*d+s[0]*f,t[1]=e[1]*c+r[1]*h+i[1]*d+s[1]*f,t[2]=e[2]*c+r[2]*h+i[2]*d+s[2]*f,t}function A6e(t,e){e=e||1;const r=fP,i=2*r()*Math.PI,s=2*r()-1,n=Math.sqrt(1-s*s)*e;return t[0]=Math.cos(i)*n,t[1]=Math.sin(i)*n,t[2]=s*e,t}function ze(t,e,r){const i=e[0],s=e[1],n=e[2];return t[0]=r[0]*i+r[4]*s+r[8]*n+r[12],t[1]=r[1]*i+r[5]*s+r[9]*n+r[13],t[2]=r[2]*i+r[6]*s+r[10]*n+r[14],t}function Oc(t,e,r){const i=e[0],s=e[1],n=e[2];return t[0]=i*r[0]+s*r[3]+n*r[6],t[1]=i*r[1]+s*r[4]+n*r[7],t[2]=i*r[2]+s*r[5]+n*r[8],t}function Lc(t,e,r){const i=r[0],s=r[1],n=r[2],o=r[3],a=e[0],l=e[1],c=e[2];let h=s*c-n*l,d=n*a-i*c,f=i*l-s*a,m=s*f-n*d,g=n*h-i*f,_=i*d-s*h;const v=2*o;return h*=v,d*=v,f*=v,m*=2,g*=2,_*=2,t[0]=a+h+m,t[1]=l+d+g,t[2]=c+f+_,t}function O6e(t,e,r,i){const s=[],n=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],n[0]=s[0],n[1]=s[1]*Math.cos(i)-s[2]*Math.sin(i),n[2]=s[1]*Math.sin(i)+s[2]*Math.cos(i),t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t}function R6e(t,e,r,i){const s=[],n=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],n[0]=s[2]*Math.sin(i)+s[0]*Math.cos(i),n[1]=s[1],n[2]=s[2]*Math.cos(i)-s[0]*Math.sin(i),t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t}function M6e(t,e,r,i){const s=[],n=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],n[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),n[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),n[2]=s[2],t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t}function Oye(t,e){ie(wI,t),ie(xI,e),_e(wI,wI),_e(xI,xI);const r=ye(wI,xI);return r>1?0:r<-1?Math.PI:Math.acos(r)}const wI=O(),xI=O();function P6e(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function ma(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function nv(t,e){if(t===e)return!0;const r=t[0],i=t[1],s=t[2],n=e[0],o=e[1],a=e[2],l=cl();return Math.abs(r-n)<=l*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-o)<=l*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(s-a)<=l*Math.max(1,Math.abs(s),Math.abs(a))}function O0(t,e,r){const i=r[0]-e[0],s=r[1]-e[1],n=r[2]-e[2];let o=i*i+s*s+n*n;return o>0?(o=1/Math.sqrt(o),t[0]=i*o,t[1]=s*o,t[2]=n*o,t):(t[0]=0,t[1]=0,t[2]=0,t)}const Pn=fe,I6e=W6,$6e=o5,mP=mi,X6=xo,mc=Re,bB=da,Bre=Object.freeze(Object.defineProperty({__proto__:null,abs:a5,add:de,angle:Oye,bezier:C6e,ceil:w6e,copy:ie,cross:pt,direction:O0,dist:mP,distance:mi,div:$6e,divide:o5,dot:ye,equals:nv,exactEquals:ma,floor:Cye,hermite:E6e,inverse:S6e,len:mc,length:Re,lerp:qr,max:x6e,min:bZ,mul:I6e,multiply:W6,negate:va,normalize:_e,random:A6e,rotateX:O6e,rotateY:R6e,rotateZ:M6e,round:T6e,scale:se,scaleAndAdd:Kb,set:ne,sign:Aye,sqrDist:X6,sqrLen:bB,squaredDistance:xo,squaredLength:da,str:P6e,sub:Pn,subtract:fe,transformMat3:Oc,transformMat4:ze,transformQuat:Lc},Symbol.toStringTag,{value:"Module"}));function Nh(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Ti(t,e,r,i,s){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t}function wZ(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function Rye(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function Mye(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function Pye(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function L6e(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function D6e(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function N6e(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}function F6e(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}function U6e(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function Uw(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function k6e(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t}function Iye(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2],n=e[3]-t[3];return Math.sqrt(r*r+i*i+s*s+n*n)}function l5(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2],n=e[3]-t[3];return r*r+i*i+s*s+n*n}function xZ(t){const e=t[0],r=t[1],i=t[2],s=t[3];return Math.sqrt(e*e+r*r+i*i+s*s)}function TZ(t){const e=t[0],r=t[1],i=t[2],s=t[3];return e*e+r*r+i*i+s*s}function z6e(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function V6e(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function $ye(t,e){const r=e[0],i=e[1],s=e[2],n=e[3];let o=r*r+i*i+s*s+n*n;return o>0&&(o=1/Math.sqrt(o),t[0]=r*o,t[1]=i*o,t[2]=s*o,t[3]=n*o),t}function Lye(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function Y6(t,e,r,i){const s=e[0],n=e[1],o=e[2],a=e[3];return t[0]=s+i*(r[0]-s),t[1]=n+i*(r[1]-n),t[2]=o+i*(r[2]-o),t[3]=a+i*(r[3]-a),t}function B6e(t,e){const r=fP;let i,s,n,o,a,l;e=e||1;do i=2*r()-1,s=2*r()-1,a=i*i+s*s;while(a>=1);do n=2*r()-1,o=2*r()-1,l=n*n+o*o;while(l>=1);const c=Math.sqrt((1-a)/l);return t[0]=e*i,t[1]=e*s,t[2]=e*n*c,t[3]=e*o*c,t}function xu(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3];return t[0]=r[0]*i+r[4]*s+r[8]*n+r[12]*o,t[1]=r[1]*i+r[5]*s+r[9]*n+r[13]*o,t[2]=r[2]*i+r[6]*s+r[10]*n+r[14]*o,t[3]=r[3]*i+r[7]*s+r[11]*n+r[15]*o,t}function G6e(t,e,r){const i=e[0],s=e[1],n=e[2],o=r[0],a=r[1],l=r[2],c=r[3],h=c*i+a*n-l*s,d=c*s+l*i-o*n,f=c*n+o*s-a*i,m=-o*i-a*s-l*n;return t[0]=h*c+m*-o+d*-l-f*-a,t[1]=d*c+m*-a+f*-o-h*-l,t[2]=f*c+m*-l+h*-a-d*-o,t[3]=e[3],t}function j6e(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function MS(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function c5(t,e){const r=t[0],i=t[1],s=t[2],n=t[3],o=e[0],a=e[1],l=e[2],c=e[3],h=cl();return Math.abs(r-o)<=h*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=h*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(s-l)<=h*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=h*Math.max(1,Math.abs(n),Math.abs(c))}const H6e=Rye,q6e=Mye,W6e=Pye,X6e=Iye,Y6e=l5,Z6e=xZ,J6e=TZ,Dye=Object.freeze(Object.defineProperty({__proto__:null,add:wZ,ceil:L6e,copy:Nh,dist:X6e,distance:Iye,div:W6e,divide:Pye,dot:Lye,equals:c5,exactEquals:MS,floor:D6e,inverse:V6e,len:Z6e,length:xZ,lerp:Y6,max:F6e,min:N6e,mul:q6e,multiply:Mye,negate:z6e,normalize:$ye,random:B6e,round:U6e,scale:Uw,scaleAndAdd:k6e,set:Ti,sqrDist:Y6e,sqrLen:J6e,squaredDistance:l5,squaredLength:TZ,str:j6e,sub:H6e,subtract:Rye,transformMat4:xu,transformQuat:G6e},Symbol.toStringTag,{value:"Module"})),Gre=new Float32Array(1);function Q6e(t){--t;for(let e=1;e<32;e<<=1)t|=t>>e;return t+1}function ve(t,e,r){return Math.min(Math.max(t,e),r)}function kw(t){return(t&t-1)==0}function y4t(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function _4t(t){return 10**Math.ceil(Math.LOG10E*Math.log(t))}function St(t,e,r){return t+(e-t)*r}function Ft(t){return t*Math.PI/180}function al(t){return 180*t/Math.PI}function wB(t,e=1e-6){return(t<0?-1:1)/Math.max(Math.abs(t),e)}function Dn(t){return Math.acos(ve(t,-1,1))}function Hh(t){return Math.asin(ve(t,-1,1))}function PS(t,e,r=1e-6){return t===e?!0:!Number.isFinite(t)||!Number.isFinite(e)?!1:(t>e?t-e:e-t)<=r}const u5=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));function xB(t){return u5.setFloat64(0,t),u5.getBigInt64(0)}function K6e(t){return u5.setBigInt64(0,t),u5.getFloat64(0)}const UD=BigInt("1000000"),e8e=Nye(1);function Nye(t){const e=xB(t=Math.abs(t)),r=K6e(e<=UD?UD:e-UD);return Math.abs(t-r)}function v4t(t,e,r=e8e){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;if(r!=null&&Nye(Math.min(Math.abs(t),Math.abs(e)))<r)return Math.abs(t-e)<=r;const i=xB(t),s=xB(e);return i<0!=s<0?!1:!((i<s?s-i:i-s)>UD)}function t8e(t,e,r=1e-6){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;const i=Math.abs(t-e),s=Math.abs(t),n=Math.abs(e);if(t===0||e===0||s<1e-12&&n<1e-12){if(i>.01*r)return!1}else if(i/(s+n)>r)return!1;return!0}function r8e(t){return Fye(Math.max(-TB,Math.min(t,TB)))}function Fye(t){return Gre[0]=t,Gre[0]}function aM(t,e,r){const i=ve((r-t)/(e-t),0,1);return i*i*(3-2*i)}function jre(t,e){const r=Re(t),i=Hh(t[2]/r),s=Math.atan2(t[1]/r,t[0]/r);return ne(e,r,i,s),e}function b4t(t,e,r){return Ti(t,e[0],e[1],e[2],e[3]*r)}function w4t(t){const e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[3]*t[3]+t[4]*t[4]+t[5]*t[5],i=t[6]*t[6]+t[7]*t[7]+t[8]*t[8];return!(PS(e,1)&&PS(r,1)&&PS(i,1))}const TB=Fye(34028234663852886e22);function TI(t){return ve(DY(t),0,255)}function SI(t,e,r){return t=Number(t),isNaN(t)?r:t<e?e:t>r?r:t}let kD=class ia{static blendColors(e,r,i,s=new ia){return s.r=Math.round(e.r+(r.r-e.r)*i),s.g=Math.round(e.g+(r.g-e.g)*i),s.b=Math.round(e.b+(r.b-e.b)*i),s.a=e.a+(r.a-e.a)*i,s._sanitize()}static fromRgb(e,r){const i=e.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(i){const s=i[2].split(/\s*,\s*/),n=i[1];if(n==="rgb"&&s.length===3||n==="rgba"&&s.length===4){const o=s[0];if(o.charAt(o.length-1)==="%"){const a=s.map(l=>2.56*parseFloat(l));return s.length===4&&(a[3]=parseFloat(s[3])),ia.fromArray(a,r)}return ia.fromArray(s.map(a=>parseFloat(a)),r)}if(n==="hsl"&&s.length===3||n==="hsla"&&s.length===4)return ia.fromArray(vye(parseFloat(s[0]),parseFloat(s[1])/100,parseFloat(s[2])/100,parseFloat(s[3])),r)}return null}static fromHex(e,r=new ia){if(e.length!==4&&e.length!==7||e[0]!=="#")return null;const i=e.length===4?4:8,s=(1<<i)-1;let n=+("0x"+e.substr(1));return isNaN(n)?null:(["b","g","r"].forEach(o=>{const a=n&s;n>>=i,r[o]=i===4?17*a:a}),r.a=1,r)}static fromArray(e,r=new ia){return r._set(Number(e[0]),Number(e[1]),Number(e[2]),Number(e[3])),isNaN(r.a)&&(r.a=1),r._sanitize()}static fromString(e,r){const i=_ye(e)?mZ(e):null;return i&&ia.fromArray(i,r)||ia.fromRgb(e,r)||ia.fromHex(e,r)}static fromJSON(e){return e&&new ia([e[0],e[1],e[2],e[3]/255])}static toUnitRGB(e){return e!=null?[e.r/255,e.g/255,e.b/255]:null}static toUnitRGBA(e){return e!=null?[e.r/255,e.g/255,e.b/255,e.a!=null?e.a:1]:null}constructor(e){this.r=255,this.g=255,this.b=255,this.a=1,e&&this.setColor(e)}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(e){return typeof e=="string"?ia.fromString(e,this):Array.isArray(e)?ia.fromArray(e,this):(this._set(e.r??0,e.g??0,e.b??0,e.a??1),e instanceof ia||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(){const e=this.r.toString(16),r=this.g.toString(16),i=this.b.toString(16);return`#${e.length<2?"0"+e:e}${r.length<2?"0"+r:r}${i.length<2?"0"+i:i}`}toCss(e=!1){const r=this.r+", "+this.g+", "+this.b;return e?`rgba(${r}, ${this.a})`:`rgb(${r})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(e=ia.AlphaMode.ALWAYS){const r=TI(this.r),i=TI(this.g),s=TI(this.b);return e===ia.AlphaMode.ALWAYS||this.a!==1?[r,i,s,TI(255*this.a)]:[r,i,s]}clone(){return new ia(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(e){return e!=null&&e.r===this.r&&e.g===this.g&&e.b===this.b&&e.a===this.a}_sanitize(){return this.r=Math.round(SI(this.r,0,255)),this.g=Math.round(SI(this.g,0,255)),this.b=Math.round(SI(this.b,0,255)),this.a=SI(this.a,0,1),this}_set(e,r,i,s){this.r=e,this.g=r,this.b=i,this.a=s}};kD.prototype.declaredClass="esri.Color",function(t){var e;(e=t.AlphaMode||(t.AlphaMode={}))[e.ALWAYS=0]="ALWAYS",e[e.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(kD||(kD={}));const ke=kD;function x4t(t){}function i8e(t){return()=>t}function nt(t,e={}){const r=t instanceof $r?t:new $r(t,e),i={type:e?.ignoreUnknown??1?r.apiValues:String,json:{type:r.jsonValues,read:!e?.readOnly&&{reader:r.read},write:{writer:r.write}}};return e?.readOnly!==void 0&&(i.readOnly=!!e.readOnly),e?.default!==void 0&&(i.json.default=e.default),e?.name!==void 0&&(i.json.name=e.name),e?.nonNullable!==void 0&&(i.nonNullable=e.nonNullable),p(i)}var SB;let zD=SB=class extends ue{constructor(t){super(t),this.type="none"}clone(){return new SB({type:this.type})}};u([nt({none:"none",stayAbove:"stay-above"})],zD.prototype,"type",void 0),zD=SB=u([P("esri.ground.NavigationConstraint")],zD);function Z6(t){const e=DY(100*(1-t));return Math.max(0,Math.min(e,100))}function gE(t){const e=1-t/100;return Math.max(0,Math.min(e,1))}var EB;let cg=EB=class extends _C(p0){constructor(t){super(t),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new Pt;const e=i=>{i.parent&&i.parent!==this&&"remove"in i.parent&&i.parent.remove(i),i.parent=this,i.type!=="elevation"&&i.type!=="base-elevation"&&K.getLogger(this).error(`Layer '${i.title}, id:${i.id}' of type '${i.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},r=i=>{i.parent=null};this.addHandles([this.layers.on("after-add",i=>e(i.item)),this.layers.on("after-remove",i=>r(i.item))])}initialize(){this.when().catch(t=>{ds(t)||K.getLogger(this).error("#load()","Failed to load ground",t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.layers.removeAll();for(const e of t)e.destroy();this.layers.destroy()}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set layers(t){this._set("layers",Pw(t,this._get("layers")))}writeLayers(t,e,r,i){const s=[];t&&(i={...i,layerContainerType:"ground"},t.forEach(n=>{if("write"in n){const o={};i8e(n)().write(o,i)&&s.push(o)}else i&&i.messages&&i.messages.push(new U("layer:unsupported",`Layers (${n.title}, ${n.id}) of type '${n.declaredClass}' cannot be persisted in the ground`,{layer:n}))})),e.layers=s}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return P0e(this,t=>{t(this.layers)})}async queryElevation(t,e){await this.load({signal:e?.signal});const{ElevationQuery:r}=await he(()=>import("./ElevationQuery-255b0dcc.js"),[],import.meta.url);Yt(e);const i=new r,s=this.layers.filter(Hre).toArray();return i.queryAll(s,t,e)}async createElevationSampler(t,e){await this.load({signal:e?.signal});const{ElevationQuery:r}=await he(()=>import("./ElevationQuery-255b0dcc.js"),[],import.meta.url);Yt(e);const i=new r,s=this.layers.filter(Hre).toArray();return i.createSamplerAll(s,t,e)}clone(){const t={opacity:this.opacity,surfaceColor:ee(this.surfaceColor),navigationConstraint:ee(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(t.loadStatus="loaded"),new EB({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}_loadFromSource(t){const e=this.resourceInfo;return e?this._loadLayersFromJSON(e.data,e.context,t):Promise.resolve()}_loadLayersFromJSON(t,e,r){const i=e&&e.origin||"web-scene",s=e&&e.portal||null,n=e&&e.url||null;return he(()=>import("./layersCreator-69626637.js"),["./layersCreator-69626637.js","./lazyLayerLoader-8f831dc7.js","./portalLayers-7c874b5a.js","./layersLoader-76363640.js","./fetchService-21f7bf3b.js","./jsonContext-bd549146.js"],import.meta.url).then(({populateOperationalLayers:o})=>{Yt(r);const a=[];if(t.layers&&Array.isArray(t.layers)){const l={context:{origin:i,url:n,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,t.layers,l))}return Ac(a)}).then(()=>{})}};function s8e(t){return t&&"createElevationSampler"in t}function Hre(t){return t.type==="elevation"||s8e(t)}u([p({json:{read:!1}})],cg.prototype,"layers",null),u([Be("layers")],cg.prototype,"writeLayers",null),u([p({readOnly:!0})],cg.prototype,"resourceInfo",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:Ki,read:{reader:gE,source:"transparency"},write:{writer:(t,e)=>{e.transparency=Z6(t)},target:"transparency"}}})],cg.prototype,"opacity",void 0),u([p({type:ke,json:{type:[Ki],write:(t,e)=>{e.surfaceColor=t.toJSON().slice(0,3)}}})],cg.prototype,"surfaceColor",void 0),u([p({type:zD,json:{write:!0}})],cg.prototype,"navigationConstraint",void 0),cg=EB=u([P("esri.Ground")],cg);const h5=cg;let n2=class extends Pt{constructor(e){super(e),this.getCollections=null}initialize(){this.own(Yge(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const e=this.getCollections!=null?this.getCollections():null;if(e==null)return void this.removeAll();let r=0;for(const i of e)i!=null&&(r=this._processCollection(r,i));this.splice(r,this.length)}_createNewInstance(e){return new Pt(e)}_processCollection(e,r){if(!r)return e;const i=this.itemFilterFunction??(s=>!!s);for(const s of r)if(s){if(i(s)){const n=this.indexOf(s,e);n>=0?n!==e&&this.reorder(s,e):this.add(s,e),++e}if(this.getChildrenFunction){const n=this.getChildrenFunction(s);if(Array.isArray(n))for(const o of n)e=this._processCollection(e,o);else e=this._processCollection(e,n)}}return e}};u([p()],n2.prototype,"getCollections",void 0),u([p()],n2.prototype,"getChildrenFunction",void 0),u([p()],n2.prototype,"itemFilterFunction",void 0),n2=u([P("esri.core.CollectionFlattener")],n2);const lM=n2,n8e=[["binary","application/octet-stream","bin",""]];function o8e(t,e){return EZ(c8e(t,e))}function a8e(t,e){return EZ(u8e(t,e))}function S4t(t,e){return Uye(l8e(t,e))}function SZ(t){return[...n8e,...t]}function l8e(t,e){return SZ(e).find(r=>EZ(r)===t)}function c8e(t,e){return SZ(e).find(r=>Uye(r)===t)}function u8e(t,e){const r=t.toLowerCase();return SZ(e).find(i=>h8e(i).some(s=>r.endsWith(s)))}function EZ(t){return t?.[0]}function Uye(t){return t?.[1]}function h8e(t){return t?.[2].split(",")??[]}function E4t(t){return t.tables?.find(e=>e.role==="assetMaps")}function d8e(t){return!(!(t&&typeof t=="object"&&"loaded"in t&&t.loaded&&t6e(t)?.operations?.supportsEditing&&"type"in t)||"editingEnabled"in t&&!i6e(t)||t.type==="scene"&&!p8e(t))}function p8e(t){const e=t.infoFor3D;if(!e)return!0;const{supportedFormats:r,queryFormats:i}=e,s=o8e("model/gltf-binary",r)??a8e("glb",r);return s!=null&&i.includes(s)}const qre=K.getLogger("esri.support.basemapUtils");function f8e(){return{}}function m8e(t){for(const e in t){const r=t[e];r?.destroyed===!1&&r.destroy(),delete t[e]}}function g8e(t,e){let r;if(typeof t=="string"){if(!(t in vB)){const i=Object.entries(vB).filter(([s,n])=>Gr.apiKey&&!n.classic||!Gr.apiKey&&n.classic&&!n.deprecated).map(([s])=>`"${s}"`).join(", ");return qre.warn(`Unable to find basemap definition for: ${t}. Try one of these: ${i}`),null}e&&(r=e[t]),r||(r=s5.fromId(t),e&&(e[t]=r))}else r=ws(s5,t);return r?.destroyed&&(qre.warn("The provided basemap is already destroyed",{basemap:r}),r=null),r}function C4t(t,e){return t.basemap?.referenceLayers?.some(r=>r.uid===e)||t.basemap?.baseLayers?.some(r=>r.uid===e)}function y8e(t){return new lM({getCollections:()=>[t.tables,t.layers],getChildrenFunction:e=>{const r=[];return"tables"in e&&r.push(e.tables),"layers"in e&&r.push(e.layers),r},itemFilterFunction:e=>{const r=e.parent;return!!r&&"tables"in r&&r.tables.includes(e)}})}function MU(t){for(const e of t.values())e?.destroy();t.clear()}const Wre={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function _8e(t){let e=null;if(typeof t=="string")if(t in Wre){const r=Wre[t];e=new h5({resourceInfo:{data:{layers:[r]}}})}else K.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${t}. Try "world-elevation"`);else e=ws(h5,t);return e}function yE(t,e,r=!1){let{hasM:i,hasZ:s}=t;Array.isArray(e)?e.length!==4||i||s?e.length===3&&r&&!i?(s=!0,i=!1):e.length===3&&i&&s&&(i=!1,s=!1):(i=!0,s=!0):(s=!s&&e.hasZ&&(!i||e.hasM),i=!i&&e.hasM&&(!s||e.hasZ)),t.hasZ=s,t.hasM=i}var CB;function Xre(t){return(e,r)=>e==null?r:r==null?e:t(e,r)}function v8e(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let $y=CB=class extends Av{constructor(...t){super(...t),this.points=[],this.type="multipoint"}normalizeCtorArgs(t,e){if(!t&&!e)return{};const r={};Array.isArray(t)?(r.points=t,r.spatialReference=e):v8e(t)?r.spatialReference=t:(t.points&&(r.points=t.points),t.spatialReference&&(r.spatialReference=t.spatialReference),t.hasZ&&(r.hasZ=t.hasZ),t.hasM&&(r.hasM=t.hasM));const i=r.points&&r.points[0];return i&&(r.hasZ===void 0&&r.hasM===void 0?(r.hasZ=i.length>2,r.hasM=!1):r.hasZ===void 0?r.hasZ=i.length>3:r.hasM===void 0&&(r.hasM=i.length>3)),r}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const t=this.points;if(!t.length)return null;const e=new cr,r=this.hasZ,i=this.hasM,s=r?3:2,n=t[0],o=Xre(Math.min),a=Xre(Math.max);let l,c,h,d,[f,m]=n,[g,_]=n;for(let v=0,b=t.length;v<b;v++){const T=t[v],[x,S]=T;if(f=o(f,x),m=o(m,S),g=a(g,x),_=a(_,S),r&&T.length>2){const E=T[2];l=o(l,E),h=a(h,E)}if(i&&T.length>s){const E=T[s];c=o(c,E),d=a(d,E)}}return e.xmin=f,e.ymin=m,e.xmax=g,e.ymax=_,e.spatialReference=this.spatialReference,r?(e.zmin=l,e.zmax=h):(e.zmin=void 0,e.zmax=void 0),i?(e.mmin=c,e.mmax=d):(e.mmin=void 0,e.mmax=void 0),e}writePoints(t,e){e.points=ee(this.points)}addPoint(t){return yE(this,t),Array.isArray(t)?this.points.push(t):this.points.push(t.toArray()),this.notifyChange("points"),this}clone(){const t={points:ee(this.points),spatialReference:this.spatialReference};return this.hasZ&&(t.hasZ=!0),this.hasM&&(t.hasM=!0),new CB(t)}getPoint(t){if(!this._validateInputs(t))return null;const e=this.points[t],r={x:e[0],y:e[1],spatialReference:this.spatialReference};let i=2;return this.hasZ&&(r.z=e[2],i=3),this.hasM&&(r.m=e[i]),new tt(r)}removePoint(t){if(!this._validateInputs(t))return null;const e=new tt(this.points.splice(t,1)[0],this.spatialReference);return this.notifyChange("points"),e}setPoint(t,e){return this._validateInputs(t)?(yE(this,e),Array.isArray(e)||(e=e.toArray()),this.points[t]=e,this.notifyChange("points"),this):this}toJSON(t){return this.write({},t)}_validateInputs(t){return t!=null&&t>=0&&t<this.points.length}};u([p({readOnly:!0})],$y.prototype,"cache",null),u([p()],$y.prototype,"extent",null),u([p({type:[[Number]],json:{write:{isRequired:!0}}})],$y.prototype,"points",void 0),u([Be("points")],$y.prototype,"writePoints",null),$y=CB=u([P("esri.geometry.Multipoint")],$y),$y.prototype.toJSON.isDefaultToJSON=!0;const gP=$y;function A4t(t){const e=[];for(t.reset();t.nextPath();){const r=[];for(;t.nextPoint();)r.push([t.x,t.y]);e.push(r)}return t.reset(),e}function b8e(t){const e=[];for(;t.nextPoint();)e.push([t.x,t.y]);return t.seekPathStart(),e}function J6(t,e){const r=e[0]-t[0],i=e[1]-t[1];if(t.length>2&&e.length>2){const s=t[2]-e[2];return Math.sqrt(r*r+i*i+s*s)}return Math.sqrt(r*r+i*i)}function kye(t,e,r){const i=t[0]+r*(e[0]-t[0]),s=t[1]+r*(e[1]-t[1]);return t.length>2&&e.length>2?[i,s,t[2]+r*(e[2]-t[2])]:[i,s]}function O4t(t,e,r,i){const[s,n]=e,[o,a]=r[i],[l,c]=r[i+1],h=l-o,d=c-a,f=h*h+d*d,m=(s-o)*h+(n-a)*d,g=Math.min(1,Math.max(0,m/f));return t[0]=o+h*g,t[1]=a+d*g,t}function R4t(t,e,r){let i,s,n,o,a=!1,l=1/0;for(r.reset();r.nextPath();)if(r.nextPoint())for(i=r.x,s=r.y;r.nextPoint();)n=r.x,o=r.y,s>e!=o>e&&t<(n-i)*(e-s)/(o-s)+i&&(a=!a),l=Math.min(l,w8e(t,e,i,s,n,o)),i=n,s=o;return l===0?0:(a?1:-1)*Math.sqrt(l)}function w8e(t,e,r,i,s,n){let o=r,a=i,l=s-o,c=n-a;if(l!==0||c!==0){const h=((t-o)*l+(e-a)*c)/(l*l+c*c);h>1?(o=s,a=n):h>0&&(o+=l*h,a+=c*h)}return l=t-o,c=e-a,l*l+c*c}function zye(t,e){return kye(t,e,.5)}function Vye(t){const e=t.length;let r=0;for(let i=0;i<e-1;++i)r+=J6(t[i],t[i+1]);return r}function Bye(t,e){if(e<=0)return t[0];const r=t.length;let i=0;for(let s=0;s<r-1;++s){const n=J6(t[s],t[s+1]);if(e-i<n){const o=(e-i)/n;return kye(t[s],t[s+1],o)}i+=n}return t[r-1]}function Gye(t,e,r){const i=t.length;let s=0,n=0,o=0;for(let a=0;a<i;a++){const l=t[a],c=t[(a+1)%i];let h=2;s+=l[0]*c[1]-c[0]*l[1],l.length>2&&c.length>2&&r&&(n+=l[0]*c[2]-c[0]*l[2],h=3),l.length>h&&c.length>h&&e&&(o+=l[0]*c[h]-c[0]*l[h])}return s<=0&&n<=0&&o<=0}function x8e(t){const e=t.length;return e>2&&u0(t[0],t[e-1])}function M4t(t){if("rings"in t)for(const e of t.rings)x8e(e)||e.push(e[0].slice())}function P4t(t){if(!t||t.length<3)return 0;let e=0;const r=t.length-1;for(let i=0;i<r;i++)e+=(t[i][0]-t[i+1][0])*(t[i][1]+t[i+1][1]);return e+=(t[r][0]-t[0][0])*(t[r][1]+t[0][1]),-.5*e}function jye(t){if(!t||t.numPoints<3)return 0;let e,r,i=0;if(t.seekPathStart(),!t.nextPoint())return 0;e=t.x,r=t.y;const s=e,n=r;for(;t.nextPoint();)i+=(e-t.x)*(r+t.y),e=t.x,r=t.y;return i+=(e-s)*(r+n),-.5*i}function I4t(t){return t?t.hasZ?[t.xmax-t.xmin/2,t.ymax-t.ymin/2,t.zmax-t.zmin/2]:[t.xmax-t.xmin/2,t.ymax-t.ymin/2]:null}function T8e(t){return t?Hye(t.rings,t.hasZ??!1):null}function Hye(t,e){if(!t||!t.length)return null;const r=[],i=[],s=e?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let n=0,o=t.length;n<o;n++){const a=qye(t[n],e,s);a&&i.push(a)}if(i.sort((n,o)=>{let a=n[2]-o[2];return a===0&&e&&(a=n[4]-o[4]),a}),i.length&&(r[0]=i[0][0],r[1]=i[0][1],e&&(r[2]=i[0][3]),(r[0]<s[0]||r[0]>s[1]||r[1]<s[2]||r[1]>s[3]||e&&(r[2]<s[4]||r[2]>s[5]))&&(r.length=0)),!r.length){const n=t[0]&&t[0].length?S8e(t[0],e):null;if(!n)return null;r[0]=n[0],r[1]=n[1],e&&n.length>2&&(r[2]=n[2])}return r}function qye(t,e,r){let i=0,s=0,n=0,o=0,a=0;const l=t.length?t[0][0]:0,c=t.length?t[0][1]:0,h=t.length&&e?t[0][2]:0;for(let f=0;f<t.length;f++){const m=t[f],g=t[(f+1)%t.length],[_,v,b]=m,T=_-l,x=v-c,[S,E,A]=g,R=S-l,M=E-c,D=T*M-R*x;if(o+=D,i+=(T+R)*D,s+=(x+M)*D,e&&m.length>2&&g.length>2){const k=b-h,L=A-h,N=T*L-R*k;n+=(k+L)*N,a+=N}_<r[0]&&(r[0]=_),_>r[1]&&(r[1]=_),v<r[2]&&(r[2]=v),v>r[3]&&(r[3]=v),e&&(b<r[4]&&(r[4]=b),b>r[5]&&(r[5]=b))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const d=[i/(6*o)+l,s/(6*o)+c,o];return e&&(r[4]===r[5]||a===0?(d[3]=(r[4]+r[5])/2,d[4]=0):(d[3]=n/(6*a)+h,d[4]=a)),d}function S8e(t,e){const r=e?[0,0,0]:[0,0],i=e?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;for(let l=0,c=t.length;l<c-1;l++){const h=t[l],d=t[l+1];if(h&&d){r[0]=h[0],r[1]=h[1],i[0]=d[0],i[1]=d[1],e&&h.length>2&&d.length>2&&(r[2]=h[2],i[2]=d[2]);const f=J6(r,i);if(f){s+=f;const m=zye(h,d);n+=f*m[0],o+=f*m[1],e&&m.length>2&&(a+=f*m[2])}}}return s>0?e?[n/s,o/s,a/s]:[n/s,o/s]:t.length?t[0]:null}function E8e(t){const{hasZ:e,numPaths:r}=t;if(r===0)return null;const i=[],s=[],n=e?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(t.reset();t.nextPath();){const o=qye(b8e(t),t.hasZ,n);o&&s.push(o)}if(s.sort((o,a)=>{let l=o[2]-a[2];return l===0&&e&&(l=o[4]-a[4]),l}),s.length&&(i[0]=s[0][0],i[1]=s[0][1],e&&(i[2]=s[0][3]),(i[0]<n[0]||i[0]>n[1]||i[1]<n[2]||i[1]>n[3]||e&&(i[2]<n[4]||i[2]>n[5]))&&(i.length=0)),!i.length){t.reset(),t.nextPath();const o=t.numPoints?C8e(t):null;if(!o)return null;i[0]=o[0],i[1]=o[1],e&&o.length>2&&(i[2]=o[2])}return i}function C8e(t){const{hasZ:e}=t,r=e?[0,0,0]:[0,0],i=e?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;if(t.nextPoint()){let l=t.x,c=t.y,h=t.z;for(;t.nextPoint();){const d=t.x,f=t.y,m=t.z;r[0]=l,r[1]=c,i[0]=d,i[1]=f,e&&(r[2]=h,i[2]=m);const g=J6(r,i);if(g){s+=g;const _=zye(r,i);n+=g*_[0],o+=g*_[1],e&&_.length>2&&(a+=g*_[2])}l=d,c=f,h=m}}return s>0?e?[n/s,o/s,a/s]:[n/s,o/s]:t.numPoints?(t.seekPathStart(),t.nextPoint(),[t.x,t.y]):null}const A8e=1e-6;function $4t(t){let e=0;for(t.reset();t.nextPath();)e+=jye(t);if(e<A8e){const s=E8e(t);return s?[s[0],s[1]]:null}const r=[0,0];if(t.reset(),!t.nextPath()||!t.nextPoint())return null;const i=[t.x,t.y];for(t.reset();t.nextPath();)R8e(r,i,t);return r[0]*=1/e,r[1]*=1/e,r[0]+=i[0],r[1]+=i[1],r}const O8e=1/3;function R8e(t,e,r){if(!t||!r||r.numPoints<3)return null;r.nextPoint();const i=r.x,s=r.y;r.nextPoint();let n,o=r.x-i,a=r.y-s,l=0,c=0;for(;r.nextPoint();)l=r.x-i,c=r.y-s,n=.5*O8e*(l*a-c*o),t[0]+=n*(o+l),t[1]+=n*(a+c),o=l,a=c;const h=jye(r),d=[i,s];return d[0]-=e[0],d[1]-=e[1],d[0]*=h,d[1]*=h,t[0]+=d[0],t[1]+=d[1],t}function zt(t=$8e){return[t[0],t[1],t[2],t[3]]}function L4t(t){return[t[0],t[1],t[2],t[3]]}function m0(t,e){return t!==e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),t}function CZ(t,e,r,i,s=zt()){return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function Wye(t,e=zt()){return e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax,e}function Q6(t,e){return new cr({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}function IS(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function J_(t,e,r){if(e!=null)if("length"in e)RB(e)?(r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.max(t[2],e[2]),r[3]=Math.max(t[3],e[3])):e.length!==2&&e.length!==3||(r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.max(t[2],e[0]),r[3]=Math.max(t[3],e[1]));else switch(e.type){case"extent":r[0]=Math.min(t[0],e.xmin),r[1]=Math.min(t[1],e.ymin),r[2]=Math.max(t[2],e.xmax),r[3]=Math.max(t[3],e.ymax);break;case"point":r[0]=Math.min(t[0],e.x),r[1]=Math.min(t[1],e.y),r[2]=Math.max(t[2],e.x),r[3]=Math.max(t[3],e.y)}else m0(r,t)}function PU(t,e,r=t){const i=e.length;let s=t[0],n=t[1],o=t[2],a=t[3];for(let l=0;l<i;l++){const c=e[l];s=Math.min(s,c[0]),n=Math.min(n,c[1]),o=Math.max(o,c[0]),a=Math.max(a,c[1])}return r[0]=s,r[1]=n,r[2]=o,r[3]=a,r}function AB(t){for(let e=0;e<4;e++)if(!isFinite(t[e]))return!1;return!0}function vu(t){return t==null||t[0]>=t[2]?0:t[2]-t[0]}function Op(t){return t[1]>=t[3]?0:t[3]-t[1]}function Xye(t){return vu(t)*Op(t)}function AZ(t,e=[0,0]){return e[0]=(t[0]+t[2])/2,e[1]=(t[1]+t[3])/2,e}function Yye(t,e){return K6(t,e[0],e[1])}function Yre(t,e){const r=e[3],i=.5*(t[0]+t[2]),s=Math.abs(e[0]-i),n=.5*(t[2]-t[0]);if(s>r+n)return!1;const o=.5*(t[1]+t[3]),a=.5*(t[3]-t[1]),l=Math.abs(e[1]-o);if(l>r+a)return!1;if(s<n||l<a)return!0;const c=s-n,h=l-a;return c*c+h*h<=r*r}function D4t(t,e,r){const i=t[0],s=t[1],n=t[2],o=t[3],{x:a,y:l}=e,{x:c,y:h}=r,d=(v,b)=>(h-l)*v+(a-c)*b+(c*l-a*h)<0,f=d(i,o),m=d(n,o),g=d(n,s),_=d(i,s);return!(f===m&&m===g&&g===_&&_===f||a<i&&c<i||a>n&&c>n||l>o&&h>o||l<s&&h<s)}function N4t(t,e){return K6(t,e.x,e.y)}function K6(t,e,r){return e>=t[0]&&r>=t[1]&&e<=t[2]&&r<=t[3]}function M8e(t,e,r){return e[0]>=t[0]-r&&e[1]>=t[1]-r&&e[0]<=t[2]+r&&e[1]<=t[3]+r}function yP(t,e){return Math.max(e[0],t[0])<=Math.min(e[2],t[2])&&Math.max(e[1],t[1])<=Math.min(e[3],t[3])}function Zre(t,e){return e[0]>=t[0]&&e[2]<=t[2]&&e[1]>=t[1]&&e[3]<=t[3]}function OB(t,e,r){if(e==null)return m0(r,t);const i=e[0],s=e[1],n=e[2],o=e[3];return r[0]=ve(t[0],i,n),r[1]=ve(t[1],s,o),r[2]=ve(t[2],i,n),r[3]=ve(t[3],s,o),r}function P8e(t,e){const r=(t[0]+t[2])/2,i=(t[1]+t[3])/2,s=Math.max(Math.abs(e[0]-r)-vu(t)/2,0),n=Math.max(Math.abs(e[1]-i)-Op(t)/2,0);return Math.sqrt(s*s+n*n)}function d5(t,e,r,i=t){return i[0]=t[0]+e,i[1]=t[1]+r,i[2]=t[2]+e,i[3]=t[3]+r,i}function Uc(t){return t?m0(t,MB):zt(MB)}function RB(t){return t!=null&&t.length===4}function I8e(t){return!(vu(t)!==0&&isFinite(t[0])||Op(t)!==0&&isFinite(t[1]))}function dw(t,e){return RB(t)&&RB(e)?t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]:t===e}const F4t=[-1/0,-1/0,1/0,1/0],MB=[1/0,1/0,-1/0,-1/0],$8e=[0,0,0,0];function Zye(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function Jye(t){return t.points!==void 0}function Qye(t){return t.x!==void 0&&t.y!==void 0}function Kye(t){return t.paths!==void 0}function e_e(t){return t.rings!==void 0}function t_e(t){function e(r,i){return r==null?i:i==null?r:t(r,i)}return e}const L_=t_e(Math.min),D_=t_e(Math.max);function U4t(t,e){return Kye(e)?_E(t,e.paths,!1,!1):e_e(e)?_E(t,e.rings,!1,!1):Jye(e)?OZ(t,e.points,!1,!1,!1,!1):Zye(e)?r_e(t,e):(Qye(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.x,t[3]=e.y),t)}function k4t(t){let e,r,i,s;for(t.reset(),e=i=1/0,r=s=-1/0;t.nextPath();){const n=L8e(t);e=Math.min(n[0],e),i=Math.min(n[1],i),r=Math.max(n[2],r),s=Math.max(n[3],s)}return zt([e,i,r,s])}function L8e(t){let e,r,i,s;for(e=i=1/0,r=s=-1/0;t.nextPoint();)e=Math.min(t.x,e),i=Math.min(t.y,i),r=Math.max(t.x,r),s=Math.max(t.y,s);return zt([e,i,r,s])}function z4t(t,e){return Kye(e)?_E(t,e.paths,!0,!1):e_e(e)?_E(t,e.rings,!0,!1):Jye(e)?OZ(t,e.points,!0,!1,!0,!1):Zye(e)?r_e(t,e,!0,!1,!0,!1):(Qye(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.x,t[4]=e.y,t[5]=e.z),t)}function _E(t,e,r,i){const s=r?3:2;if(!e.length||!e[0].length)return null;let n,o,a,l,[c,h]=e[0][0],[d,f]=e[0][0];for(let m=0;m<e.length;m++){const g=e[m];for(let _=0;_<g.length;_++){const v=g[_],[b,T]=v;if(c=L_(c,b),h=L_(h,T),d=D_(d,b),f=D_(f,T),r&&v.length>2){const x=v[2];n=L_(n,x),o=D_(o,x)}if(i&&v.length>s){const x=v[s];a=L_(n,x),l=D_(o,x)}}}return r?i?(t[0]=c,t[1]=h,t[2]=n,t[3]=a,t[4]=d,t[5]=f,t[6]=o,t[7]=l,t.length=8,t):(t[0]=c,t[1]=h,t[2]=n,t[3]=d,t[4]=f,t[5]=o,t.length=6,t):i?(t[0]=c,t[1]=h,t[2]=a,t[3]=d,t[4]=f,t[5]=l,t.length=6,t):(t[0]=c,t[1]=h,t[2]=d,t[3]=f,t.length=4,t)}function r_e(t,e,r,i,s,n){const o=e.xmin,a=e.xmax,l=e.ymin,c=e.ymax;let h=e.zmin,d=e.zmax,f=e.mmin,m=e.mmax;return s?(h=h||0,d=d||0,n?(f=f||0,m=m||0,t[0]=o,t[1]=l,t[2]=h,t[3]=f,t[4]=a,t[5]=c,t[6]=d,t[7]=m,t):(t[0]=o,t[1]=l,t[2]=h,t[3]=a,t[4]=c,t[5]=d,t)):n?(f=f||0,m=m||0,t[0]=o,t[1]=l,t[2]=f,t[3]=a,t[4]=c,t[5]=m,t):(t[0]=o,t[1]=l,t[2]=a,t[3]=c,t)}function OZ(t,e,r,i,s,n){const o=r?3:2,a=i&&n,l=r&&s;if(!e.length||!e[0].length)return null;let c,h,d,f,[m,g]=e[0],[_,v]=e[0];for(let b=0;b<e.length;b++){const T=e[b],[x,S]=T;if(m=L_(m,x),g=L_(g,S),_=D_(_,x),v=D_(v,S),l&&T.length>2){const E=T[2];c=L_(c,E),h=D_(h,E)}if(a&&T.length>o){const E=T[o];d=L_(c,E),f=D_(h,E)}}return s?(c=c||0,h=h||0,n?(d=d||0,f=f||0,t[0]=m,t[1]=g,t[2]=c,t[3]=d,t[4]=_,t[5]=v,t[6]=h,t[7]=f,t):(t[0]=m,t[1]=g,t[2]=c,t[3]=_,t[4]=v,t[5]=h,t)):n?(d=d||0,f=f||0,t[0]=m,t[1]=g,t[2]=d,t[3]=_,t[4]=v,t[5]=f,t):(t[0]=m,t[1]=g,t[2]=_,t[3]=v,t)}function D8e(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function N8e(t){return t.points!==void 0}function F8e(t){return t.x!==void 0&&t.y!==void 0}function U8e(t){return t.paths!==void 0}function k8e(t){return t.rings!==void 0}const RZ=[];function i_e(t,e,r,i){return{xmin:t,ymin:e,xmax:r,ymax:i}}function s_e(t,e,r,i,s,n){return{xmin:t,ymin:e,zmin:r,xmax:i,ymax:s,zmax:n}}function n_e(t,e,r,i,s,n){return{xmin:t,ymin:e,mmin:r,xmax:i,ymax:s,mmax:n}}function o_e(t,e,r,i,s,n,o,a){return{xmin:t,ymin:e,zmin:r,mmin:i,xmax:s,ymax:n,zmax:o,mmax:a}}function MZ(t,e=!1,r=!1){return e?r?o_e(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]):s_e(t[0],t[1],t[2],t[3],t[4],t[5]):r?n_e(t[0],t[1],t[2],t[3],t[4],t[5]):i_e(t[0],t[1],t[2],t[3])}function V4t(t){return t?D8e(t)?t:F8e(t)?V8e(t):k8e(t)?a_e(t):U8e(t)?l_e(t):N8e(t)?z8e(t):null:null}function z8e(t){const{hasZ:e,hasM:r,points:i}=t;return MZ(OZ(RZ,i,e??!1,r??!1),e,r)}function V8e(t){const{x:e,y:r,z:i,m:s}=t,n=s!=null;return i!=null?n?o_e(e,r,i,s,e,r,i,s):s_e(e,r,i,e,r,i):n?n_e(e,r,s,e,r,s):i_e(e,r,e,r)}function a_e(t){const{hasZ:e,hasM:r,rings:i}=t,s=_E(RZ,i,e??!1,r??!1);return s?MZ(s,e,r):null}function l_e(t){const{hasZ:e,hasM:r,paths:i}=t,s=_E(RZ,i,e??!1,r??!1);return s?MZ(s,e,r):null}var VD;function Jre(t){return!Array.isArray(t[0])}let hf=VD=class extends Av{static fromExtent(t){const e=t.clone().normalize(),r=t.spatialReference;let i=!1,s=!1;for(const o of e)o.hasZ&&(i=!0),o.hasM&&(s=!0);const n={rings:e.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(i&&o.hasZ){const l=o.zmin+.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(s&&o.hasM){const l=o.mmin+.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a}),spatialReference:r};return i&&(n.hasZ=!0),s&&(n.hasM=!0),new VD(n)}constructor(...t){super(...t),this.rings=[],this.type="polygon"}normalizeCtorArgs(t,e){let r,i,s=null,n=null;return t&&!Array.isArray(t)?(s=t.rings??null,e||(t.spatialReference?e=t.spatialReference:t.rings||(e=t)),r=t.hasZ,i=t.hasM):s=t,s=s||[],e=e||qe.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(r===void 0&&i===void 0?(r=n.length>2,i=n.length>3):r===void 0?r=i?n.length>3:n.length>2:i===void 0&&(i=r?n.length>3:n.length>2)),{rings:s,spatialReference:e,hasZ:r,hasM:i}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const t=T8e(this);if(!t||isNaN(t[0])||isNaN(t[1])||this.hasZ&&isNaN(t[2]))return null;const e=new tt;return e.x=t[0],e.y=t[1],e.spatialReference=this.spatialReference,this.hasZ&&(e.z=t[2]),e}get extent(){const{spatialReference:t}=this,e=a_e(this);if(!e)return null;const r=new cr(e);return r.spatialReference=t,r}get isSelfIntersecting(){return MFe(this.rings)}writeRings(t,e){e.rings=ee(this.rings)}addRing(t){if(!t)return;const e=this.rings,r=e.length;if(Jre(t)){const i=[];for(let s=0,n=t.length;s<n;s++)i[s]=t[s].toArray();e[r]=i}else e[r]=t.concat();return this.notifyChange("rings"),this}clone(){const t=new VD;return t.spatialReference=this.spatialReference,t.rings=ee(this.rings),t.hasZ=this.hasZ,t.hasM=this.hasM,t}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,r=t.spatialReference;if(e!=null!=(r!=null)||e!=null&&r!=null&&!e.equals(r)||this.rings.length!==t.rings.length)return!1;const i=([s,n,o,a],[l,c,h,d])=>s===l&&n===c&&(o==null&&h==null||o===h)&&(a==null&&d==null||a===d);for(let s=0;s<this.rings.length;s++){const n=this.rings[s],o=t.rings[s];if(!u0(n,o,i))return!1}return!0}contains(t){if(!t)return!1;const e=bx(t,this.spatialReference);return bFe(this,e??t)}isClockwise(t){let e;return e=Jre(t)?t.map(r=>this.hasZ?this.hasM?[r.x,r.y,r.z,r.m]:[r.x,r.y,r.z]:[r.x,r.y]):t,Gye(e,this.hasM,this.hasZ)}getPoint(t,e){if(!this._validateInputs(t,e))return null;const r=this.rings[t][e],i=this.hasZ,s=this.hasM;return i&&!s?new tt(r[0],r[1],r[2],void 0,this.spatialReference):s&&!i?new tt(r[0],r[1],void 0,r[2],this.spatialReference):i&&s?new tt(r[0],r[1],r[2],r[3],this.spatialReference):new tt(r[0],r[1],this.spatialReference)}insertPoint(t,e,r){return this._validateInputs(t,e,!0)?(yE(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[t].splice(e,0,r),this.notifyChange("rings"),this):this}removePoint(t,e){if(!this._validateInputs(t,e))return null;const r=new tt(this.rings[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("rings"),r}removeRing(t){if(!this._validateInputs(t,null))return null;const e=this.rings.splice(t,1)[0],r=this.spatialReference,i=e.map(s=>new tt(s,r));return this.notifyChange("rings"),i}setPoint(t,e,r){return this._validateInputs(t,e)?(yE(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[t][e]=r,this.notifyChange("rings"),this):this}_validateInputs(t,e,r=!1){if(t==null||t<0||t>=this.rings.length)return!1;if(e!=null){const i=this.rings[t];if(r&&(e<0||e>i.length)||!r&&(e<0||e>=i.length))return!1}return!0}toJSON(t){return this.write({},t)}};u([p({readOnly:!0})],hf.prototype,"cache",null),u([p({readOnly:!0})],hf.prototype,"centroid",null),u([p({readOnly:!0})],hf.prototype,"extent",null),u([p({readOnly:!0})],hf.prototype,"isSelfIntersecting",null),u([p({type:[[[Number]]],json:{write:{isRequired:!0}}})],hf.prototype,"rings",void 0),u([Be("rings")],hf.prototype,"writeRings",null),hf=VD=u([P("esri.geometry.Polygon")],hf),hf.prototype.toJSON.isDefaultToJSON=!0;const Su=hf;var PB;function B8e(t){return!Array.isArray(t[0])}let Ly=PB=class extends Av{constructor(...t){super(...t),this.paths=[],this.type="polyline"}normalizeCtorArgs(t,e){let r,i,s=null,n=null;return t&&!Array.isArray(t)?(s=t.paths??null,e||(t.spatialReference?e=t.spatialReference:t.paths||(e=t)),r=t.hasZ,i=t.hasM):s=t,s=s||[],e=e||qe.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(r===void 0&&i===void 0?(r=n.length>2,i=!1):r===void 0?r=!i&&n.length>3:i===void 0&&(i=!r&&n.length>3)),{paths:s,spatialReference:e,hasZ:r,hasM:i}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:t}=this,e=l_e(this);if(!e)return null;const r=new cr(e);return r.spatialReference=t,r}writePaths(t,e){e.paths=ee(this.paths)}addPath(t){if(!t)return;const e=this.paths,r=e.length;if(B8e(t)){const i=[];for(let s=0,n=t.length;s<n;s++)i[s]=t[s].toArray();e[r]=i}else e[r]=t.concat();return this.notifyChange("paths"),this}clone(){const t=new PB;return t.spatialReference=this.spatialReference,t.paths=ee(this.paths),t.hasZ=this.hasZ,t.hasM=this.hasM,t}getPoint(t,e){if(!this._validateInputs(t,e))return null;const r=this.paths[t][e],i=this.hasZ,s=this.hasM;return i&&!s?new tt(r[0],r[1],r[2],void 0,this.spatialReference):s&&!i?new tt(r[0],r[1],void 0,r[2],this.spatialReference):i&&s?new tt(r[0],r[1],r[2],r[3],this.spatialReference):new tt(r[0],r[1],this.spatialReference)}insertPoint(t,e,r){return this._validateInputs(t,e,!0)?(yE(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[t].splice(e,0,r),this.notifyChange("paths"),this):this}removePath(t){if(!this._validateInputs(t,null))return null;const e=this.paths.splice(t,1)[0],r=this.spatialReference,i=e.map(s=>new tt(s,r));return this.notifyChange("paths"),i}removePoint(t,e){if(!this._validateInputs(t,e))return null;const r=new tt(this.paths[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("paths"),r}setPoint(t,e,r){return this._validateInputs(t,e)?(yE(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[t][e]=r,this.notifyChange("paths"),this):this}_validateInputs(t,e,r=!1){if(t==null||t<0||t>=this.paths.length)return!1;if(e!=null){const i=this.paths[t];if(r&&(e<0||e>i.length)||!r&&(e<0||e>=i.length))return!1}return!0}toJSON(t){return this.write({},t)}};u([p({readOnly:!0})],Ly.prototype,"cache",null),u([p({readOnly:!0})],Ly.prototype,"extent",null),u([p({type:[[[Number]]],json:{write:{isRequired:!0}}})],Ly.prototype,"paths",void 0),u([Be("paths")],Ly.prototype,"writePaths",null),Ly=PB=u([P("esri.geometry.Polyline")],Ly),Ly.prototype.toJSON.isDefaultToJSON=!0;const e8=Ly,c_e=ll()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),Qre=ll()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function u_e(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function PZ(t){return t.points!==void 0}function IZ(t){return t.x!==void 0&&t.y!==void 0}function $Z(t){return t.paths!==void 0}function $S(t){return t.rings!==void 0}function ov(t){return t==null?null:t instanceof Av?t:IZ(t)?tt.fromJSON(t):$Z(t)?e8.fromJSON(t):$S(t)?Su.fromJSON(t):PZ(t)?gP.fromJSON(t):u_e(t)?cr.fromJSON(t):null}function LZ(t){return t?IZ(t)?"esriGeometryPoint":$Z(t)?"esriGeometryPolyline":$S(t)?"esriGeometryPolygon":u_e(t)?"esriGeometryEnvelope":PZ(t)?"esriGeometryMultipoint":null:null}const G8e={esriGeometryPoint:tt,esriGeometryPolyline:e8,esriGeometryPolygon:Su,esriGeometryEnvelope:cr,esriGeometryMultipoint:gP};function j8e(t){return t&&G8e[t]||null}const wx={base:Av,key:"type",typeMap:{extent:cr,multipoint:gP,point:tt,polyline:e8,polygon:Su}};Ap(wx);let h_e=0;const t8=t=>{let e=class extends t{constructor(...r){super(...r),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+h_e++})}};return e=u([P("esri.core.Identifiable")],e),e},B4t=t=>{let e=class extends t{constructor(...r){super(...r),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:h_e++})}};return e=u([P("esri.core.NumericIdentifiable")],e),e};let Kre=class extends t8(class{}){};Kre=u([P("esri.core.Identifiable")],Kre);async function H8e(t){const e="portalItem"in t?t:{portalItem:t},{fromItem:r}=await he(()=>import("./portalLayers-7c874b5a.js"),["./portalLayers-7c874b5a.js","./lazyLayerLoader-8f831dc7.js","./layersLoader-76363640.js","./fetchService-21f7bf3b.js","./jsonContext-bd549146.js"],import.meta.url);try{return await r(e)}catch(i){const s=e&&e.portalItem,n=s&&s.id||"unset",o=s&&s.portal&&s.portal.url||Gr.portalUrl;throw K.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+o+"', id: '"+n+"')",i),i}}let q8e=0,uo=class extends Ts.EventedMixin(t8(p0)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new cr(-180,-90,180,90,qe.WGS84),this.id=Date.now().toString(16)+"-layer-"+q8e++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=qe.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static async fromArcGISServerUrl(e){const r=typeof e=="string"?{url:e}:e;return(await he(()=>import("./arcgisLayers-17fc4145.js"),["./arcgisLayers-17fc4145.js","./fetchService-21f7bf3b.js","./lazyLayerLoader-8f831dc7.js"],import.meta.url)).fromUrl(r)}static fromPortalItem(e){return H8e(e)}initialize(){this.when().catch(e=>{ds(e)||K.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})})}destroy(){if(this.parent){const e=this,r=this.parent;"layers"in r&&r.layers.includes(e)?r.layers.remove(e):"tables"in r&&r.tables.includes(e)?r.tables.remove(e):"baseLayers"in r&&r.baseLayers.includes(e)?r.baseLayers.remove(e):"baseLayers"in r&&r.referenceLayers.includes(e)&&r.referenceLayers.remove(e)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){return Co(this.url)}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await ur(e,{query:{f:"json"},responseType:"json"})).data;throw new U("layer:no-attribution-data","Layer does not have attribution data")}};u([p({type:String})],uo.prototype,"attributionDataUrl",void 0),u([p({type:cr})],uo.prototype,"fullExtent",void 0),u([p({readOnly:!0})],uo.prototype,"hasAttributionData",null),u([p({type:String,clonable:!1})],uo.prototype,"id",void 0),u([p({type:Boolean,nonNullable:!0})],uo.prototype,"legendEnabled",void 0),u([p({type:["show","hide","hide-children"]})],uo.prototype,"listMode",void 0),u([p({type:Number,range:{min:0,max:1},nonNullable:!0})],uo.prototype,"opacity",void 0),u([p({clonable:!1})],uo.prototype,"parent",void 0),u([p({readOnly:!0})],uo.prototype,"parsedUrl",null),u([p({type:Boolean})],uo.prototype,"popupEnabled",void 0),u([p({type:Boolean})],uo.prototype,"attributionVisible",void 0),u([p({type:qe})],uo.prototype,"spatialReference",void 0),u([p({type:String})],uo.prototype,"title",void 0),u([p({readOnly:!0,json:{read:!1}})],uo.prototype,"type",void 0),u([p()],uo.prototype,"url",void 0),u([p({type:Boolean,nonNullable:!0})],uo.prototype,"visible",void 0),uo=u([P("esri.layers.Layer")],uo);const DZ=uo;function IB(t,e,r){let i,s;if(t)for(let n=0,o=t.length;n<o;n++){if(i=t.at(n),i?.[e]===r)return i;if(i?.type==="group"&&(s=IB(i.layers,e,r),s))return s}}const W8e=t=>{let e=class extends t{constructor(...r){super(...r),this.layers=new Pt;const i=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},s=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||K.getLogger(this).error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},n=o=>{o.parent=null,this.layerRemoved(o)};this.addHandles([this.layers.on("before-add",o=>i(o.item)),this.layers.on("after-add",o=>s(o.item)),this.layers.on("after-remove",o=>n(o.item))])}destroy(){const r=this.layers.toArray();for(const i of r)i.destroy();this.layers.destroy()}set layers(r){this._set("layers",Pw(r,this._get("layers")))}add(r,i){const s=this.layers;if(i=s.getNextIndex(i),r instanceof DZ){const n=r;n.parent===this?this.reorder(n,i):s.add(n,i)}else ku(r)?r.then(n=>{this.destroyed||this.add(n,i)}):K.getLogger(this).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(r,i){const s=this.layers;let n=s.getNextIndex(i);r.slice().forEach(o=>{o.parent!==this?(s.add(o,n),n+=1):this.reorder(o,n)})}findLayerById(r){return IB(this.layers,"id",r)}findLayerByUid(r){return IB(this.layers,"uid",r)}remove(r){return this.layers.remove(r)}removeMany(r){return this.layers.removeMany(r)}removeAll(){return this.layers.removeAll()}reorder(r,i){return this.layers.reorder(r,i)}layerAdded(r){}layerRemoved(r){}};return u([p()],e.prototype,"layers",null),e=u([P("esri.support.LayersMixin")],e),e};function $B(t,e,r){if(t)for(let i=0,s=t.length;i<s;i++){const n=t.at(i);if(n[e]===r)return n;if(n?.type==="group"){const o=$B(n.tables,e,r);if(o)return o}}}const X8e=t=>{let e=class extends t{constructor(...r){super(...r),this.tables=new Pt,this.addHandles([this.tables.on("after-add",i=>{const s=i.item;s.parent&&s.parent!==this&&"tables"in s.parent&&s.parent.tables.remove(s),s.parent=this,s.type!=="feature"&&K.getLogger(this).error(`Layer 'title:${s.title}, id:${s.id}' of type '${s.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",i=>{i.item.parent=null})])}destroy(){const r=this.tables.removeAll();for(const i of r)i.destroy();this.tables.destroy()}set tables(r){this._set("tables",Pw(r,this._get("tables")))}findTableById(r){return $B(this.tables,"id",r)}findTableByUid(r){return $B(this.tables,"uid",r)}};return u([p()],e.prototype,"tables",null),e=u([P("esri.support.TablesMixin")],e),e};let df=class extends X8e(W8e(Ts.EventedMixin(Te))){constructor(e){super(e),this.allLayers=new lM({getCollections:()=>[this.basemap?.baseLayers,this.ground?.layers,this.layers,this.basemap?.referenceLayers],getChildrenFunction:r=>"layers"in r?r.layers:null}),this.allTables=y8e(this),this.basemap=null,this.editableLayers=new lM({getCollections:()=>[this.allLayers],itemFilterFunction:d8e}),this.ground=new h5,this._basemapCache=f8e()}destroy(){this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.ground?.destroy(),this.basemap?.destroy(),m8e(this._basemapCache),this._basemapCache=null}castBasemap(e){return g8e(e,this._basemapCache)}castGround(e){return _8e(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(r=>r.id===e)}findTableById(e){return this.allTables.find(r=>r.id===e)}};u([p({readOnly:!0,dependsOn:[]})],df.prototype,"allLayers",void 0),u([p({readOnly:!0})],df.prototype,"allTables",void 0),u([p({type:s5})],df.prototype,"basemap",void 0),u([wr("basemap")],df.prototype,"castBasemap",null),u([p({readOnly:!0})],df.prototype,"editableLayers",void 0),u([p({type:h5,nonNullable:!0})],df.prototype,"ground",void 0),u([wr("ground")],df.prototype,"castGround",null),df=u([P("esri.Map")],df);const d_e=df,Hi=t=>{let e=class extends t{clone(){const r=_c(ba(this),"unable to clone instance of non-accessor class"),i=r.metadatas,s=r.store,n={},o=new Map;for(const l in i){const c=i[l],h=s?.originOf(l),d=c.clonable;if(c.readOnly||d===!1||h!==mr.USER&&h!==mr.DEFAULTS&&h!==mr.WEB_MAP&&h!==mr.WEB_SCENE)continue;const f=this[l];let m=null;m=typeof d=="function"?d(f):d==="reference"?f:z7(f),f!=null&&m==null||(h===mr.DEFAULTS?o.set(l,m):n[l]=m)}const a=new(Object.getPrototypeOf(this)).constructor(n);if(o.size){const l=ba(a)?.store;if(l)for(const[c,h]of o)l.set(c,h,mr.DEFAULTS)}return a}};return e=u([P("esri.core.Clonable")],e),e};let eie=class extends Hi(Te){};eie=u([P("esri.core.Clonable")],eie);let av=class{constructor(e,r){this.min=e,this.max=r,this.range=r-e}ndiff(e,r=0){return Math.ceil((e-r)/this.range)*this.range+r}_normalize(e,r,i,s=0,n=!1){return(i-=s)<e?i+=this.ndiff(e-i):i>r&&(i-=this.ndiff(i-r)),n&&i===r&&(i=e),i+s}normalize(e,r=0,i=!1){return this._normalize(this.min,this.max,e,r,i)}clamp(e,r=0){return ve(e-r,this.min,this.max)+r}monotonic(e,r,i){return e<r?r:r+this.ndiff(e-r,i)}minimalMonotonic(e,r,i){return this._normalize(e,e+this.range,r,i)}center(e,r,i){return r=this.monotonic(e,r,i),this.normalize((e+r)/2,i)}diff(e,r,i){return this.monotonic(e,r,i)-e}shortestSignedDiff(e,r){e=this.normalize(e);const i=(r=this.normalize(r))-e,s=r<e?this.minimalMonotonic(e,r)-e:r-this.minimalMonotonic(r,e);return Math.abs(i)<Math.abs(s)?i:s}contains(e,r,i){return r=this.minimalMonotonic(e,r),(i=this.minimalMonotonic(e,i))>e&&i<r}};function NZ(t){for(const e in t){const r=t[e];r instanceof Function&&(t[e]=r.bind(t))}return t}const Y8e=NZ(new av(0,2*Math.PI)),lv=NZ(new av(-Math.PI,Math.PI)),FZ=NZ(new av(0,360));let ug=class extends Hi(ue){constructor(...e){super(...e),this.position=new tt([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(e,r,i,s){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const n={position:e};return r!=null&&(n.heading=r),i!=null&&(n.tilt=i),s!=null&&(n.fov=s),n}return e}writePosition(e,r,i,s){const n=e.clone();n.x=Eh(e.x||0),n.y=Eh(e.y||0),n.z=e.hasZ?Eh(e.z||0):e.z,r[i]=n.write({},s)}readPosition(e,r){const i=new tt;return i.read(e,r),i.x=Eh(i.x||0),i.y=Eh(i.y||0),i.z=i.hasZ?Eh(i.z||0):i.z,i}equals(e){return e!=null&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}};u([p({type:tt,json:{write:{isRequired:!0}}})],ug.prototype,"position",void 0),u([Be("position")],ug.prototype,"writePosition",null),u([Oe("position")],ug.prototype,"readPosition",null),u([p({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),wr(t=>FZ.normalize(Eh(t)))],ug.prototype,"heading",void 0),u([p({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),wr(t=>ve(Eh(t),-180,180))],ug.prototype,"tilt",void 0),u([p({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],ug.prototype,"fov",void 0),ug=u([P("esri.Camera")],ug);const qh=ug;var vE;function Z8e(t,e){switch(t.type){case"range":{const r="range"in t?t.range[0]:t.minValue,i="range"in t?t.range[1]:t.maxValue;if(r!=null&&+e<r||i!=null&&+e>i)return vE.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(t.codedValues==null||t.codedValues.every(r=>r==null||r.code!==e))return vE.INVALID_CODED_VALUE}return null}(function(t){t.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",t.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(vE||(vE={}));const J8e=K.getLogger("esri.support.arcadeOnDemand");let IU;function cv(){return IU||(IU=(async()=>{const t=await he(()=>import("./arcadeUtils-895c3ed3.js").then(e=>e.az),["./arcadeUtils-895c3ed3.js","./arcadeTimeUtils-38be4e14.js","./executionError-e8d36121.js","./number-5af42c3b.js","./hash-6f442295.js"],import.meta.url);return{arcade:t.arcade,arcadeUtils:t,Dictionary:t.Dictionary,Feature:t.arcadeFeature}})()),IU}const Q8e=(t,e,r)=>UZ.create(t,e,r,null,["$feature"],[]),K8e=(t,e,r)=>UZ.create(t,e,r,null,["$feature","$view"],[]),e9e=(t,e,r,i)=>UZ.create(t,e,r,i,["$feature","$view"],[]);let UZ=class p_e{constructor(e,r,i,s,n,o,a){this.services=null,this.script=e,this.evaluate=s;const l=Array.isArray(o)?o:o.fields;this.fields=l,this._syntaxTree=i,this._arcade=r,this._arcadeFeature=n,this._spatialReference=a,this._referencesGeometry=r.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(e,r,i,s,n,o){const{arcade:a,Feature:l,Dictionary:c}=await cv(),h=qe.fromJSON(r);let d;try{d=a.parseScript(e,o)}catch(M){return J8e.error(new U("arcade-bad-expression","Failed to parse arcade script",{script:e,error:M})),null}const f=n.reduce((M,D)=>({...M,[D]:null}),{});let m=null;s!=null&&(m=new c(s),m.immutable=!0,f.$config=null);const g=a.scriptUsesGeometryEngine(d),_=g&&a.enableGeometrySupport(),v=a.scriptUsesFeatureSet(d)&&a.enableFeatureSetSupport(),b=a.scriptIsAsync(d),T=b&&a.enableAsyncSupport(),x={vars:f,spatialReference:h,useAsync:!!T};await Promise.all([_,v,T]);const S=new Set;await a.loadDependentModules(S,d,null,b,g);const E=new c;E.immutable=!1,E.setField("scale",0);const A=a.compileScript(d,x),R=(M,D)=>("$view"in M&&M.$view&&(E.setField("scale",typeof M.$view=="object"&&"scale"in M.$view?M.$view.scale:void 0),M.$view=E),m&&(M.$config=m),A({vars:M,spatialReference:h,services:D}));return new p_e(e,a,d,R,new l,i,h)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}};const t9e=/^([0-9_])/,r9e=/[^a-z0-9_\u0080-\uffff]+/gi;function i9e(t){return t==null?null:t.trim().replaceAll(r9e,"_").replace(t9e,"F$1")||null}const s9e=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],n9e=["field","normalizationField"];function p5(t,e){if(t!=null&&e!=null){for(const r of Array.isArray(t)?t:[t])if(tie(s9e,r,e),"visualVariables"in r&&r.visualVariables)for(const i of r.visualVariables)tie(n9e,i,e)}}function tie(t,e,r){if(t)for(const i of t){const s=cP(i,e),n=s&&typeof s!="function"&&r.get(s);n&&ol(i,n.name,e)}}function f_e(t,e){if(t!=null&&e?.fields?.length)if("startField"in t){const r=e.get(t.startField),i=e.get(t.endField);t.startField=r?.name??null,t.endField=i?.name??null}else{const r=e.get(t.startTimeField),i=e.get(t.endTimeField);t.startTimeField=r?.name??null,t.endTimeField=i?.name??null}}const $U=new Set;function r8(t,e){return t&&e?($U.clear(),cM($U,t,e),Array.from($U).sort()):[]}function cM(t,e,r){if(r)if(e?.fields?.length)if(r.includes("*"))for(const{name:i}of e.fields)t.add(i);else for(const i of r)Eu(t,e,i);else{if(r.includes("*"))return t.clear(),void t.add("*");for(const i of r)i!=null&&t.add(i)}}function Eu(t,e,r){if(typeof r=="string")if(e){const i=e.get(r);i&&t.add(i.name)}else t.add(r)}function o9e(t,e){return e==null||t==null?[]:e.includes("*")?(t.fields??[]).map(r=>r.name):e}async function Vl(t,e,r){if(!r)return;const{arcadeUtils:i}=await cv(),s=i.extractFieldNames(r,e?.fields?.map(n=>n.name));for(const n of s)Eu(t,e,n)}async function m_e(t,e,r){if(r&&r!=="1=1"){const{WhereClause:i}=await he(()=>import("./WhereClause-fb3d85c4.js").then(n=>n.W),["./WhereClause-fb3d85c4.js","./executionError-e8d36121.js"],import.meta.url),s=i.create(r,e);if(!s.isStandardized)throw new U("fieldUtils:collectFilterFields","Where clause is not standardized",{where:r});cM(t,e,s.fieldNames)}}function a9e({displayField:t,fields:e}){return t||(e&&e.length?LU(e,"name-or-title")||LU(e,"unique-identifier")||LU(e,"type-or-category")||l9e(e):null)}function l9e(t){for(const e of t){if(!e||!e.name)continue;const r=e.name.toLowerCase();if(r.includes("name")||r.includes("title"))return e.name}return null}function LU(t,e){for(const r of t)if(r&&r.valueType&&r.valueType===e)return r.name;return null}async function Y4t(t,e){if(!e)return;const r=e.elevationInfo?.featureExpressionInfo;return r?r.collectRequiredFields(t,e.fieldsIndex):void 0}function c9e(t,e,r){r.onStatisticExpression?Vl(t,e,r.onStatisticExpression.expression):t.add(r.onStatisticField)}async function Z4t(t,e,r){if(!e||!r||!("fields"in r))return;const i=[],s=r.popupTemplate;i.push(u9e(t,e,s)),r.fields&&i.push(...r.fields.map(async n=>c9e(t,e.fieldsIndex,n))),await Promise.all(i)}async function u9e(t,e,r){const i=[];r?.expressionInfos&&i.push(...r.expressionInfos.map(n=>Vl(t,e.fieldsIndex,n.expression)));const s=r?.content;if(Array.isArray(s))for(const n of s)n.type==="expression"&&n.expressionInfo&&i.push(Vl(t,e.fieldsIndex,n.expressionInfo.expression));await Promise.all(i)}async function J4t(t,e,r){e&&(e.timeInfo&&r!=null&&r.timeExtent&&cM(t,e.fieldsIndex,[e.timeInfo.startField,e.timeInfo.endField]),e.floorInfo&&cM(t,e.fieldsIndex,[e.floorInfo.floorField]),r!=null&&r.where!=null&&await m_e(t,e.fieldsIndex,r.where))}async function Q4t(t,e,r){e&&r&&await Promise.all(r.map(i=>h9e(t,e,i)))}async function h9e(t,e,r){e&&r&&(r.valueExpression?await Vl(t,e.fieldsIndex,r.valueExpression):r.field&&Eu(t,e.fieldsIndex,r.field))}function d9e(t){return t?r8(t.fieldsIndex,g_e(t)):[]}function p9e(t){if(!t)return[];const e=t.geometryFieldsInfo;return e?r8(t.fieldsIndex,[e.shapeAreaField,e.shapeLengthField]):[]}const f9e=["oid","global-id","guid"],m9e=["oid","global-id"],g9e=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i];function y9e(t){const e=new Set;y_e(t).forEach(i=>e.add(i)),p9e(t).forEach(i=>e.add(i.toLowerCase()));const r=t&&"infoFor3D"in t?t.infoFor3D:void 0;return r&&(Object.values(r.assetMapFieldRoles).forEach(i=>e.add(i.toLowerCase())),Object.values(r.transformFieldRoles).forEach(i=>e.add(i.toLowerCase()))),Array.from(e)}function g_e(t){if(!t)return[];const e="editFieldsInfo"in t&&t.editFieldsInfo;if(!e)return[];const{creationDateField:r,creatorField:i,editDateField:s,editorField:n}=e;return[r,i,s,n].filter(Boolean)}function y_e(t){return g_e(t).map(e=>e.toLowerCase())}function _9e(t,e){return t.editable&&!f9e.includes(t.type)&&!y_e(e).includes(t.name?.toLowerCase()??"")}function v9e(t,e){const r=t.name?.toLowerCase()??"";return!(e?.objectIdField!=null&&r===e.objectIdField.toLowerCase()||e?.globalIdField!=null&&r===e.globalIdField.toLowerCase()||y9e(e).includes(r)||m9e.includes(t.type)||g9e.some(i=>i.test(r)))}async function K4t(t,e){const{labelingInfo:r,fieldsIndex:i}=e;r&&r.length&&await Promise.all(r.map(s=>b9e(t,i,s)))}async function b9e(t,e,r){if(!r)return;const i=r.getLabelExpression(),s=r.where;if(i.type==="arcade")await Vl(t,e,i.expression);else{const n=i.expression.match(/{[^}]*}/g);n&&n.forEach(o=>{Eu(t,e,o.slice(1,-1))})}await m_e(t,e,s)}function w9e(t){const e=t.defaultValue;return e!==void 0&&b_e(t,e)?e:t.nullable?null:void 0}function __e(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function x9e(t){return t===null||__e(t)}const kZ="isInteger"in Number?Number.isInteger:t=>typeof t=="number"&&isFinite(t)&&Math.floor(t)===t;function T9e(t){return t===null||kZ(t)}function v_e(t){return t!=null&&typeof t=="string"}function S9e(t){return t===null||v_e(t)}function E9e(){return!0}function b_e(t,e){let r;switch(t.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":r=t.nullable?T9e:kZ;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":r=t.nullable?x9e:__e;break;case"string":case"esriFieldTypeString":r=t.nullable?S9e:v_e;break;default:r=E9e}return arguments.length===1?r:r(e)}const C9e=["integer","small-integer","single","double"],A9e=new Set([...C9e,"esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]),O9e=["date","date-only","time-only","timestamp-offset"],R9e=new Set([...O9e,"esriFieldTypeDate","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]);function zZ(t){return t!=null&&A9e.has(t.type)}function e5t(t){return t!=null&&(t.type==="string"||t.type==="esriFieldTypeString")}function t5t(t){return t!=null&&R9e.has(t.type)}var f5,m5;function r5t(t){return t==null||typeof t=="number"&&isNaN(t)?null:t}function i5t(t,e){return t==null||t.nullable&&e===null?null:zZ(t)&&!M9e(t.type,Number(e))?f5.OUT_OF_RANGE:b_e(t,e)?t.domain?Z8e(t.domain,e):null:m5.INVALID_TYPE}function M9e(t,e){const r=typeof t=="string"?w_e(t):t;if(!r)return!1;const i=r.min,s=r.max;return r.isInteger?kZ(e)&&e>=i&&e<=s:e>=i&&e<=s}function w_e(t){switch(t){case"esriFieldTypeSmallInteger":case"small-integer":return P9e;case"esriFieldTypeInteger":case"integer":return I9e;case"esriFieldTypeBigInteger":case"big-integer":return $9e;case"esriFieldTypeSingle":case"single":return L9e;case"esriFieldTypeDouble":case"double":return D9e}}(function(t){t.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(f5||(f5={})),function(t){t.INVALID_TYPE="type-validation-error::invalid-type"}(m5||(m5={}));const P9e={min:-32768,max:32767,isInteger:!0},I9e={min:-2147483648,max:2147483647,isInteger:!0},$9e={min:-Number.MAX_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,isInteger:!0},L9e={min:-34e37,max:12e37,isInteger:!1},D9e={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};function s5t(t,e,r){switch(t){case vE.INVALID_CODED_VALUE:return`Value ${r} is not in the coded domain - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case vE.VALUE_OUT_OF_RANGE:return`Value ${r} is out of the range of valid values - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case m5.INVALID_TYPE:return`Value ${r} is not a valid value for the field type - field: ${e.name}, type: ${e.type}, nullable: ${e.nullable}`;case f5.OUT_OF_RANGE:{const{min:i,max:s}=w_e(e.type);return`Value ${r} is out of range for the number type - field: ${e.name}, type: ${e.type}, value range is ${i} to ${s}`}}}function n5t(t,e){return!N9e(t,e,null)}function N9e(t,e,r){if(!e||!e.attributes||!t){if(r!=null)for(const n of t??[])r.add(n);return!0}const i=e.attributes;let s=!1;for(const n of t)if(!(n in i)){if(s=!0,r==null)break;r.add(n)}return s}function F9e(t){return!!t&&["raster.itempixelvalue","raster.servicepixelvalue"].some(e=>t.toLowerCase().startsWith(e))}let BD=class extends ue{constructor(e){super(e),this.type=null}};u([p({type:["attachments","custom","fields","media","text","expression","relationship"],readOnly:!0,json:{read:!1,write:!0}})],BD.prototype,"type",void 0),BD=u([P("esri.popup.content.Content")],BD);const Ov=BD;var LB;let F1=LB=class extends Ov{constructor(t){super(t),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new LB({description:this.description,displayType:this.displayType,title:this.title})}};u([p({type:String,json:{write:!0}})],F1.prototype,"description",void 0),u([p({type:["auto","preview","list"],json:{write:!0}})],F1.prototype,"displayType",void 0),u([p({type:String,json:{write:!0}})],F1.prototype,"title",void 0),u([p({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],F1.prototype,"type",void 0),F1=LB=u([P("esri.popup.content.AttachmentsContent")],F1);const uM=F1;var DB;let U1=DB=class extends Ov{constructor(t){super(t),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new DB({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?ee(this.outFields):null})}};u([p()],U1.prototype,"creator",void 0),u([p()],U1.prototype,"destroyer",void 0),u([p()],U1.prototype,"outFields",void 0),u([p({type:["custom"],readOnly:!0})],U1.prototype,"type",void 0),U1=DB=u([P("esri.popup.content.CustomContent")],U1);const U9e=U1;var NB;let o2=NB=class extends ue{constructor(t){super(t),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new NB({title:this.title,expression:this.expression})}};u([p({type:String,json:{write:!0}})],o2.prototype,"title",void 0),u([p({type:String,json:{write:!0}})],o2.prototype,"expression",void 0),u([p({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],o2.prototype,"returnType",void 0),o2=NB=u([P("esri.popup.ElementExpressionInfo")],o2);const k9e=o2;var FB;let xA=FB=class extends Ov{constructor(t){super(t),this.expressionInfo=null,this.type="expression"}clone(){return new FB({expressionInfo:this.expressionInfo?.clone()})}};u([p({type:k9e,json:{write:!0}})],xA.prototype,"expressionInfo",void 0),u([p({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],xA.prototype,"type",void 0),xA=FB=u([P("esri.popup.content.ExpressionContent")],xA);const VZ=xA;class xx extends Error{}class z9e extends xx{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class V9e extends xx{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class B9e extends xx{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class TA extends xx{}class x_e extends xx{constructor(e){super(`Invalid unit ${e}`)}}class Ch extends xx{}class ey extends xx{constructor(){super("Zone is an abstract class")}}const Ze="numeric",Rp="short",Cu="long",g5={year:Ze,month:Ze,day:Ze},T_e={year:Ze,month:Rp,day:Ze},G9e={year:Ze,month:Rp,day:Ze,weekday:Rp},S_e={year:Ze,month:Cu,day:Ze},E_e={year:Ze,month:Cu,day:Ze,weekday:Cu},C_e={hour:Ze,minute:Ze},A_e={hour:Ze,minute:Ze,second:Ze},O_e={hour:Ze,minute:Ze,second:Ze,timeZoneName:Rp},R_e={hour:Ze,minute:Ze,second:Ze,timeZoneName:Cu},M_e={hour:Ze,minute:Ze,hourCycle:"h23"},P_e={hour:Ze,minute:Ze,second:Ze,hourCycle:"h23"},I_e={hour:Ze,minute:Ze,second:Ze,hourCycle:"h23",timeZoneName:Rp},$_e={hour:Ze,minute:Ze,second:Ze,hourCycle:"h23",timeZoneName:Cu},L_e={year:Ze,month:Ze,day:Ze,hour:Ze,minute:Ze},D_e={year:Ze,month:Ze,day:Ze,hour:Ze,minute:Ze,second:Ze},N_e={year:Ze,month:Rp,day:Ze,hour:Ze,minute:Ze},F_e={year:Ze,month:Rp,day:Ze,hour:Ze,minute:Ze,second:Ze},j9e={year:Ze,month:Rp,day:Ze,weekday:Rp,hour:Ze,minute:Ze},U_e={year:Ze,month:Cu,day:Ze,hour:Ze,minute:Ze,timeZoneName:Rp},k_e={year:Ze,month:Cu,day:Ze,hour:Ze,minute:Ze,second:Ze,timeZoneName:Rp},z_e={year:Ze,month:Cu,day:Ze,weekday:Cu,hour:Ze,minute:Ze,timeZoneName:Cu},V_e={year:Ze,month:Cu,day:Ze,weekday:Cu,hour:Ze,minute:Ze,second:Ze,timeZoneName:Cu};class _P{get type(){throw new ey}get name(){throw new ey}get ianaName(){return this.name}get isUniversal(){throw new ey}offsetName(e,r){throw new ey}formatOffset(e,r){throw new ey}offset(e){throw new ey}equals(e){throw new ey}get isValid(){throw new ey}}let DU=null;class i8 extends _P{static get instance(){return DU===null&&(DU=new i8),DU}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:r,locale:i}){return G_e(e,r,i)}formatOffset(e,r){return cR(this.offset(e),r)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}}let GD={};function H9e(t){return GD[t]||(GD[t]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),GD[t]}const q9e={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function W9e(t,e){const r=t.format(e).replace(/\u200E/g,""),i=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(r),[,s,n,o,a,l,c,h]=i;return[o,s,n,a,l,c,h]}function X9e(t,e){const r=t.formatToParts(e),i=[];for(let s=0;s<r.length;s++){const{type:n,value:o}=r[s],a=q9e[n];n==="era"?i[a]=o:oi(a)||(i[a]=parseInt(o,10))}return i}let EI={};class g0 extends _P{static create(e){return EI[e]||(EI[e]=new g0(e)),EI[e]}static resetCache(){EI={},GD={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=g0.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:r,locale:i}){return G_e(e,r,i,this.name)}formatOffset(e,r){return cR(this.offset(e),r)}offset(e){const r=new Date(e);if(isNaN(r))return NaN;const i=H9e(this.name);let[s,n,o,a,l,c,h]=i.formatToParts?X9e(i,r):W9e(i,r);a==="BC"&&(s=-Math.abs(s)+1);const f=jZ({year:s,month:n,day:o,hour:l===24?0:l,minute:c,second:h,millisecond:0});let m=+r;const g=m%1e3;return m-=g>=0?g:1e3+g,(f-m)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}}let rie={};function Y9e(t,e={}){const r=JSON.stringify([t,e]);let i=rie[r];return i||(i=new Intl.ListFormat(t,e),rie[r]=i),i}let UB={};function kB(t,e={}){const r=JSON.stringify([t,e]);let i=UB[r];return i||(i=new Intl.DateTimeFormat(t,e),UB[r]=i),i}let zB={};function Z9e(t,e={}){const r=JSON.stringify([t,e]);let i=zB[r];return i||(i=new Intl.NumberFormat(t,e),zB[r]=i),i}let VB={};function J9e(t,e={}){const{base:r,...i}=e,s=JSON.stringify([t,i]);let n=VB[s];return n||(n=new Intl.RelativeTimeFormat(t,e),VB[s]=n),n}let SA=null;function Q9e(){return SA||(SA=new Intl.DateTimeFormat().resolvedOptions().locale,SA)}function K9e(t){const e=t.indexOf("-x-");e!==-1&&(t=t.substring(0,e));const r=t.indexOf("-u-");if(r===-1)return[t];{let i,s;try{i=kB(t).resolvedOptions(),s=t}catch{const l=t.substring(0,r);i=kB(l).resolvedOptions(),s=l}const{numberingSystem:n,calendar:o}=i;return[s,n,o]}}function eUe(t,e,r){return(r||e)&&(t.includes("-u-")||(t+="-u"),r&&(t+=`-ca-${r}`),e&&(t+=`-nu-${e}`)),t}function tUe(t){const e=[];for(let r=1;r<=12;r++){const i=br.utc(2016,r,1);e.push(t(i))}return e}function rUe(t){const e=[];for(let r=1;r<=7;r++){const i=br.utc(2016,11,13+r);e.push(t(i))}return e}function CI(t,e,r,i,s){const n=t.listingMode(r);return n==="error"?null:n==="en"?i(e):s(e)}function iUe(t){return t.numberingSystem&&t.numberingSystem!=="latn"?!1:t.numberingSystem==="latn"||!t.locale||t.locale.startsWith("en")||new Intl.DateTimeFormat(t.intl).resolvedOptions().numberingSystem==="latn"}class sUe{constructor(e,r,i){this.padTo=i.padTo||0,this.floor=i.floor||!1;const{padTo:s,floor:n,...o}=i;if(!r||Object.keys(o).length>0){const a={useGrouping:!1,...i};i.padTo>0&&(a.minimumIntegerDigits=i.padTo),this.inf=Z9e(e,a)}}format(e){if(this.inf){const r=this.floor?Math.floor(e):e;return this.inf.format(r)}else{const r=this.floor?Math.floor(e):GZ(e,3);return Qn(r,this.padTo)}}}class nUe{constructor(e,r,i){this.opts=i,this.originalZone=void 0;let s;if(this.opts.timeZone)this.dt=e;else if(e.zone.type==="fixed"){const o=-1*(e.offset/60),a=o>=0?`Etc/GMT+${o}`:`Etc/GMT${o}`;e.offset!==0&&g0.create(a).valid?(s=a,this.dt=e):(s="UTC",this.dt=e.offset===0?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else e.zone.type==="system"?this.dt=e:e.zone.type==="iana"?(this.dt=e,s=e.zone.name):(s="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const n={...this.opts};n.timeZone=n.timeZone||s,this.dtf=kB(r,n)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(r=>{if(r.type==="timeZoneName"){const i=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...r,value:i}}else return r}):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class oUe{constructor(e,r,i){this.opts={style:"long",...i},!r&&B_e()&&(this.rtf=J9e(e,i))}format(e,r){return this.rtf?this.rtf.format(e,r):TUe(r,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,r){return this.rtf?this.rtf.formatToParts(e,r):[]}}class Is{static fromOpts(e){return Is.create(e.locale,e.numberingSystem,e.outputCalendar,e.defaultToEN)}static create(e,r,i,s=!1){const n=e||Zn.defaultLocale,o=n||(s?"en-US":Q9e()),a=r||Zn.defaultNumberingSystem,l=i||Zn.defaultOutputCalendar;return new Is(o,a,l,n)}static resetCache(){SA=null,UB={},zB={},VB={}}static fromObject({locale:e,numberingSystem:r,outputCalendar:i}={}){return Is.create(e,r,i)}constructor(e,r,i,s){const[n,o,a]=K9e(e);this.locale=n,this.numberingSystem=r||o||null,this.outputCalendar=i||a||null,this.intl=eUe(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=s,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=iUe(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),r=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&r?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:Is.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,r=!1,i=!0){return CI(this,e,i,q_e,()=>{const s=r?{month:e,day:"numeric"}:{month:e},n=r?"format":"standalone";return this.monthsCache[n][e]||(this.monthsCache[n][e]=tUe(o=>this.extract(o,s,"month"))),this.monthsCache[n][e]})}weekdays(e,r=!1,i=!0){return CI(this,e,i,Y_e,()=>{const s=r?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},n=r?"format":"standalone";return this.weekdaysCache[n][e]||(this.weekdaysCache[n][e]=rUe(o=>this.extract(o,s,"weekday"))),this.weekdaysCache[n][e]})}meridiems(e=!0){return CI(this,void 0,e,()=>Z_e,()=>{if(!this.meridiemCache){const r={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[br.utc(2016,11,13,9),br.utc(2016,11,13,19)].map(i=>this.extract(i,r,"dayperiod"))}return this.meridiemCache})}eras(e,r=!0){return CI(this,e,r,J_e,()=>{const i={era:e};return this.eraCache[e]||(this.eraCache[e]=[br.utc(-40,1,1),br.utc(2017,1,1)].map(s=>this.extract(s,i,"era"))),this.eraCache[e]})}extract(e,r,i){const s=this.dtFormatter(e,r),n=s.formatToParts(),o=n.find(a=>a.type.toLowerCase()===i);return o?o.value:null}numberFormatter(e={}){return new sUe(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,r={}){return new nUe(e,this.intl,r)}relFormatter(e={}){return new oUe(this.intl,this.isEnglish(),e)}listFormatter(e={}){return Y9e(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}}let NU=null;class il extends _P{static get utcInstance(){return NU===null&&(NU=new il(0)),NU}static instance(e){return e===0?il.utcInstance:new il(e)}static parseSpecifier(e){if(e){const r=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(r)return new il(n8(r[1],r[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${cR(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${cR(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,r){return cR(this.fixed,r)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}}class aUe extends _P{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function x_(t,e){if(oi(t)||t===null)return e;if(t instanceof _P)return t;if(lUe(t)){const r=t.toLowerCase();return r==="default"?e:r==="local"||r==="system"?i8.instance:r==="utc"||r==="gmt"?il.utcInstance:il.parseSpecifier(r)||g0.create(t)}else return pw(t)?il.instance(t):typeof t=="object"&&t.offset&&typeof t.offset=="number"?t:new aUe(t)}let iie=()=>Date.now(),sie="system",nie=null,oie=null,aie=null,lie=60,cie;class Zn{static get now(){return iie}static set now(e){iie=e}static set defaultZone(e){sie=e}static get defaultZone(){return x_(sie,i8.instance)}static get defaultLocale(){return nie}static set defaultLocale(e){nie=e}static get defaultNumberingSystem(){return oie}static set defaultNumberingSystem(e){oie=e}static get defaultOutputCalendar(){return aie}static set defaultOutputCalendar(e){aie=e}static get twoDigitCutoffYear(){return lie}static set twoDigitCutoffYear(e){lie=e%100}static get throwOnInvalid(){return cie}static set throwOnInvalid(e){cie=e}static resetCaches(){Is.resetCache(),g0.resetCache()}}function oi(t){return typeof t>"u"}function pw(t){return typeof t=="number"}function s8(t){return typeof t=="number"&&t%1===0}function lUe(t){return typeof t=="string"}function cUe(t){return Object.prototype.toString.call(t)==="[object Date]"}function B_e(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function uUe(t){return Array.isArray(t)?t:[t]}function uie(t,e,r){if(t.length!==0)return t.reduce((i,s)=>{const n=[e(s),s];return i&&r(i[0],n[0])===i[0]?i:n},null)[1]}function hUe(t,e){return e.reduce((r,i)=>(r[i]=t[i],r),{})}function bE(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function qg(t,e,r){return s8(t)&&t>=e&&t<=r}function dUe(t,e){return t-e*Math.floor(t/e)}function Qn(t,e=2){const r=t<0;let i;return r?i="-"+(""+-t).padStart(e,"0"):i=(""+t).padStart(e,"0"),i}function d_(t){if(!(oi(t)||t===null||t===""))return parseInt(t,10)}function Jv(t){if(!(oi(t)||t===null||t===""))return parseFloat(t)}function BZ(t){if(!(oi(t)||t===null||t==="")){const e=parseFloat("0."+t)*1e3;return Math.floor(e)}}function GZ(t,e,r=!1){const i=10**e;return(r?Math.trunc:Math.round)(t*i)/i}function vP(t){return t%4===0&&(t%100!==0||t%400===0)}function lR(t){return vP(t)?366:365}function y5(t,e){const r=dUe(e-1,12)+1,i=t+(e-r)/12;return r===2?vP(i)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][r-1]}function jZ(t){let e=Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond);return t.year<100&&t.year>=0&&(e=new Date(e),e.setUTCFullYear(t.year,t.month-1,t.day)),+e}function _5(t){const e=(t+Math.floor(t/4)-Math.floor(t/100)+Math.floor(t/400))%7,r=t-1,i=(r+Math.floor(r/4)-Math.floor(r/100)+Math.floor(r/400))%7;return e===4||i===3?53:52}function BB(t){return t>99?t:t>Zn.twoDigitCutoffYear?1900+t:2e3+t}function G_e(t,e,r,i=null){const s=new Date(t),n={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};i&&(n.timeZone=i);const o={timeZoneName:e,...n},a=new Intl.DateTimeFormat(r,o).formatToParts(s).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function n8(t,e){let r=parseInt(t,10);Number.isNaN(r)&&(r=0);const i=parseInt(e,10)||0,s=r<0||Object.is(r,-0)?-i:i;return r*60+s}function j_e(t){const e=Number(t);if(typeof t=="boolean"||t===""||Number.isNaN(e))throw new Ch(`Invalid unit value ${t}`);return e}function v5(t,e){const r={};for(const i in t)if(bE(t,i)){const s=t[i];if(s==null)continue;r[e(i)]=j_e(s)}return r}function cR(t,e){const r=Math.trunc(Math.abs(t/60)),i=Math.trunc(Math.abs(t%60)),s=t>=0?"+":"-";switch(e){case"short":return`${s}${Qn(r,2)}:${Qn(i,2)}`;case"narrow":return`${s}${r}${i>0?`:${i}`:""}`;case"techie":return`${s}${Qn(r,2)}${Qn(i,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function o8(t){return hUe(t,["hour","minute","second","millisecond"])}const pUe=["January","February","March","April","May","June","July","August","September","October","November","December"],H_e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],fUe=["J","F","M","A","M","J","J","A","S","O","N","D"];function q_e(t){switch(t){case"narrow":return[...fUe];case"short":return[...H_e];case"long":return[...pUe];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const W_e=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],X_e=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],mUe=["M","T","W","T","F","S","S"];function Y_e(t){switch(t){case"narrow":return[...mUe];case"short":return[...X_e];case"long":return[...W_e];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const Z_e=["AM","PM"],gUe=["Before Christ","Anno Domini"],yUe=["BC","AD"],_Ue=["B","A"];function J_e(t){switch(t){case"narrow":return[..._Ue];case"short":return[...yUe];case"long":return[...gUe];default:return null}}function vUe(t){return Z_e[t.hour<12?0:1]}function bUe(t,e){return Y_e(e)[t.weekday-1]}function wUe(t,e){return q_e(e)[t.month-1]}function xUe(t,e){return J_e(e)[t.year<0?0:1]}function TUe(t,e,r="always",i=!1){const s={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},n=["hours","minutes","seconds"].indexOf(t)===-1;if(r==="auto"&&n){const d=t==="days";switch(e){case 1:return d?"tomorrow":`next ${s[t][0]}`;case-1:return d?"yesterday":`last ${s[t][0]}`;case 0:return d?"today":`this ${s[t][0]}`}}const o=Object.is(e,-0)||e<0,a=Math.abs(e),l=a===1,c=s[t],h=i?l?c[1]:c[2]||c[1]:l?s[t][0]:t;return o?`${a} ${h} ago`:`in ${a} ${h}`}function hie(t,e){let r="";for(const i of t)i.literal?r+=i.val:r+=e(i.val);return r}const SUe={D:g5,DD:T_e,DDD:S_e,DDDD:E_e,t:C_e,tt:A_e,ttt:O_e,tttt:R_e,T:M_e,TT:P_e,TTT:I_e,TTTT:$_e,f:L_e,ff:N_e,fff:U_e,ffff:z_e,F:D_e,FF:F_e,FFF:k_e,FFFF:V_e};class tl{static create(e,r={}){return new tl(e,r)}static parseFormat(e){let r=null,i="",s=!1;const n=[];for(let o=0;o<e.length;o++){const a=e.charAt(o);a==="'"?(i.length>0&&n.push({literal:s||/^\s+$/.test(i),val:i}),r=null,i="",s=!s):s||a===r?i+=a:(i.length>0&&n.push({literal:/^\s+$/.test(i),val:i}),i=a,r=a)}return i.length>0&&n.push({literal:s||/^\s+$/.test(i),val:i}),n}static macroTokenToFormatOpts(e){return SUe[e]}constructor(e,r){this.opts=r,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,r){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...r}).format()}formatDateTime(e,r={}){return this.loc.dtFormatter(e,{...this.opts,...r}).format()}formatDateTimeParts(e,r={}){return this.loc.dtFormatter(e,{...this.opts,...r}).formatToParts()}formatInterval(e,r={}){return this.loc.dtFormatter(e.start,{...this.opts,...r}).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,r={}){return this.loc.dtFormatter(e,{...this.opts,...r}).resolvedOptions()}num(e,r=0){if(this.opts.forceSimple)return Qn(e,r);const i={...this.opts};return r>0&&(i.padTo=r),this.loc.numberFormatter(i).format(e)}formatDateTimeFromString(e,r){const i=this.loc.listingMode()==="en",s=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",n=(m,g)=>this.loc.extract(e,m,g),o=m=>e.isOffsetFixed&&e.offset===0&&m.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,m.format):"",a=()=>i?vUe(e):n({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(m,g)=>i?wUe(e,m):n(g?{month:m}:{month:m,day:"numeric"},"month"),c=(m,g)=>i?bUe(e,m):n(g?{weekday:m}:{weekday:m,month:"long",day:"numeric"},"weekday"),h=m=>{const g=tl.macroTokenToFormatOpts(m);return g?this.formatWithSystemDefault(e,g):m},d=m=>i?xUe(e,m):n({era:m},"era"),f=m=>{switch(m){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return o({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return o({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return a();case"d":return s?n({day:"numeric"},"day"):this.num(e.day);case"dd":return s?n({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return s?n({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return s?n({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return s?n({month:"numeric"},"month"):this.num(e.month);case"MM":return s?n({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return s?n({year:"numeric"},"year"):this.num(e.year);case"yy":return s?n({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return s?n({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return s?n({year:"numeric"},"year"):this.num(e.year,6);case"G":return d("short");case"GG":return d("long");case"GGGGG":return d("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return h(m)}};return hie(tl.parseFormat(r),f)}formatDurationFromString(e,r){const i=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},s=l=>c=>{const h=i(c);return h?this.num(l.get(h),c.length):c},n=tl.parseFormat(r),o=n.reduce((l,{literal:c,val:h})=>c?l:l.concat(h),[]),a=e.shiftTo(...o.map(i).filter(l=>l));return hie(n,s(a))}}class up{constructor(e,r){this.reason=e,this.explanation=r}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const Q_e=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function wC(...t){const e=t.reduce((r,i)=>r+i.source,"");return RegExp(`^${e}$`)}function xC(...t){return e=>t.reduce(([r,i,s],n)=>{const[o,a,l]=n(e,s);return[{...r,...o},a||i,l]},[{},null,1]).slice(0,2)}function TC(t,...e){if(t==null)return[null,null];for(const[r,i]of e){const s=r.exec(t);if(s)return i(s)}return[null,null]}function K_e(...t){return(e,r)=>{const i={};let s;for(s=0;s<t.length;s++)i[t[s]]=d_(e[r+s]);return[i,null,r+s]}}const eve=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,EUe=`(?:${eve.source}?(?:\\[(${Q_e.source})\\])?)?`,HZ=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,tve=RegExp(`${HZ.source}${EUe}`),qZ=RegExp(`(?:T${tve.source})?`),CUe=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,AUe=/(\d{4})-?W(\d\d)(?:-?(\d))?/,OUe=/(\d{4})-?(\d{3})/,RUe=K_e("weekYear","weekNumber","weekDay"),MUe=K_e("year","ordinal"),PUe=/(\d{4})-(\d\d)-(\d\d)/,rve=RegExp(`${HZ.source} ?(?:${eve.source}|(${Q_e.source}))?`),IUe=RegExp(`(?: ${rve.source})?`);function LS(t,e,r){const i=t[e];return oi(i)?r:d_(i)}function $Ue(t,e){return[{year:LS(t,e),month:LS(t,e+1,1),day:LS(t,e+2,1)},null,e+3]}function SC(t,e){return[{hours:LS(t,e,0),minutes:LS(t,e+1,0),seconds:LS(t,e+2,0),milliseconds:BZ(t[e+3])},null,e+4]}function bP(t,e){const r=!t[e]&&!t[e+1],i=n8(t[e+1],t[e+2]),s=r?null:il.instance(i);return[{},s,e+3]}function wP(t,e){const r=t[e]?g0.create(t[e]):null;return[{},r,e+1]}const LUe=RegExp(`^T?${HZ.source}$`),DUe=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function NUe(t){const[e,r,i,s,n,o,a,l,c]=t,h=e[0]==="-",d=l&&l[0]==="-",f=(m,g=!1)=>m!==void 0&&(g||m&&h)?-m:m;return[{years:f(Jv(r)),months:f(Jv(i)),weeks:f(Jv(s)),days:f(Jv(n)),hours:f(Jv(o)),minutes:f(Jv(a)),seconds:f(Jv(l),l==="-0"),milliseconds:f(BZ(c),d)}]}const FUe={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function WZ(t,e,r,i,s,n,o){const a={year:e.length===2?BB(d_(e)):d_(e),month:H_e.indexOf(r)+1,day:d_(i),hour:d_(s),minute:d_(n)};return o&&(a.second=d_(o)),t&&(a.weekday=t.length>3?W_e.indexOf(t)+1:X_e.indexOf(t)+1),a}const UUe=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function kUe(t){const[,e,r,i,s,n,o,a,l,c,h,d]=t,f=WZ(e,s,i,r,n,o,a);let m;return l?m=FUe[l]:c?m=0:m=n8(h,d),[f,new il(m)]}function zUe(t){return t.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const VUe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,BUe=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,GUe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function die(t){const[,e,r,i,s,n,o,a]=t;return[WZ(e,s,i,r,n,o,a),il.utcInstance]}function jUe(t){const[,e,r,i,s,n,o,a]=t;return[WZ(e,a,r,i,s,n,o),il.utcInstance]}const HUe=wC(CUe,qZ),qUe=wC(AUe,qZ),WUe=wC(OUe,qZ),XUe=wC(tve),ive=xC($Ue,SC,bP,wP),YUe=xC(RUe,SC,bP,wP),ZUe=xC(MUe,SC,bP,wP),JUe=xC(SC,bP,wP);function QUe(t){return TC(t,[HUe,ive],[qUe,YUe],[WUe,ZUe],[XUe,JUe])}function KUe(t){return TC(zUe(t),[UUe,kUe])}function eke(t){return TC(t,[VUe,die],[BUe,die],[GUe,jUe])}function tke(t){return TC(t,[DUe,NUe])}const rke=xC(SC);function ike(t){return TC(t,[LUe,rke])}const ske=wC(PUe,IUe),nke=wC(rve),oke=xC(SC,bP,wP);function ake(t){return TC(t,[ske,ive],[nke,oke])}const lke="Invalid Duration",sve={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},cke={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...sve},Gu=146097/400,Hx=146097/4800,uke={years:{quarters:4,months:12,weeks:Gu/7,days:Gu,hours:Gu*24,minutes:Gu*24*60,seconds:Gu*24*60*60,milliseconds:Gu*24*60*60*1e3},quarters:{months:3,weeks:Gu/28,days:Gu/4,hours:Gu*24/4,minutes:Gu*24*60/4,seconds:Gu*24*60*60/4,milliseconds:Gu*24*60*60*1e3/4},months:{weeks:Hx/7,days:Hx,hours:Hx*24,minutes:Hx*24*60,seconds:Hx*24*60*60,milliseconds:Hx*24*60*60*1e3},...sve},k1=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],hke=k1.slice(0).reverse();function ty(t,e,r=!1){const i={values:r?e.values:{...t.values,...e.values||{}},loc:t.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||t.conversionAccuracy,matrix:e.matrix||t.matrix};return new di(i)}function dke(t){return t<0?Math.floor(t):Math.ceil(t)}function nve(t,e,r,i,s){const n=t[s][r],o=e[r]/n,a=Math.sign(o)===Math.sign(i[s]),l=!a&&i[s]!==0&&Math.abs(o)<=1?dke(o):Math.trunc(o);i[s]+=l,e[r]-=l*n}function pke(t,e){hke.reduce((r,i)=>oi(e[i])?r:(r&&nve(t,e,r,e,i),i),null)}function fke(t){const e={};for(const[r,i]of Object.entries(t))i!==0&&(e[r]=i);return e}class di{constructor(e){const r=e.conversionAccuracy==="longterm"||!1;let i=r?uke:cke;e.matrix&&(i=e.matrix),this.values=e.values,this.loc=e.loc||Is.create(),this.conversionAccuracy=r?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=i,this.isLuxonDuration=!0}static fromMillis(e,r){return di.fromObject({milliseconds:e},r)}static fromObject(e,r={}){if(e==null||typeof e!="object")throw new Ch(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new di({values:v5(e,di.normalizeUnit),loc:Is.fromObject(r),conversionAccuracy:r.conversionAccuracy,matrix:r.matrix})}static fromDurationLike(e){if(pw(e))return di.fromMillis(e);if(di.isDuration(e))return e;if(typeof e=="object")return di.fromObject(e);throw new Ch(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,r){const[i]=tke(e);return i?di.fromObject(i,r):di.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,r){const[i]=ike(e);return i?di.fromObject(i,r):di.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,r=null){if(!e)throw new Ch("need to specify a reason the Duration is invalid");const i=e instanceof up?e:new up(e,r);if(Zn.throwOnInvalid)throw new B9e(i);return new di({invalid:i})}static normalizeUnit(e){const r={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!r)throw new x_e(e);return r}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,r={}){const i={...r,floor:r.round!==!1&&r.floor!==!1};return this.isValid?tl.create(this.loc,i).formatDurationFromString(this,e):lke}toHuman(e={}){const r=k1.map(i=>{const s=this.values[i];return oi(s)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:i.slice(0,-1)}).format(s)}).filter(i=>i);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(r)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=GZ(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const r=this.toMillis();if(r<0||r>=864e5)return null;e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e};const i=this.shiftTo("hours","minutes","seconds","milliseconds");let s=e.format==="basic"?"hhmm":"hh:mm";(!e.suppressSeconds||i.seconds!==0||i.milliseconds!==0)&&(s+=e.format==="basic"?"ss":":ss",(!e.suppressMilliseconds||i.milliseconds!==0)&&(s+=".SSS"));let n=i.toFormat(s);return e.includePrefix&&(n="T"+n),n}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.as("milliseconds")}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const r=di.fromDurationLike(e),i={};for(const s of k1)(bE(r.values,s)||bE(this.values,s))&&(i[s]=r.get(s)+this.get(s));return ty(this,{values:i},!0)}minus(e){if(!this.isValid)return this;const r=di.fromDurationLike(e);return this.plus(r.negate())}mapUnits(e){if(!this.isValid)return this;const r={};for(const i of Object.keys(this.values))r[i]=j_e(e(this.values[i],i));return ty(this,{values:r},!0)}get(e){return this[di.normalizeUnit(e)]}set(e){if(!this.isValid)return this;const r={...this.values,...v5(e,di.normalizeUnit)};return ty(this,{values:r})}reconfigure({locale:e,numberingSystem:r,conversionAccuracy:i,matrix:s}={}){const o={loc:this.loc.clone({locale:e,numberingSystem:r}),matrix:s,conversionAccuracy:i};return ty(this,o)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return pke(this.matrix,e),ty(this,{values:e},!0)}rescale(){if(!this.isValid)return this;const e=fke(this.normalize().shiftToAll().toObject());return ty(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(o=>di.normalizeUnit(o));const r={},i={},s=this.toObject();let n;for(const o of k1)if(e.indexOf(o)>=0){n=o;let a=0;for(const c in i)a+=this.matrix[c][o]*i[c],i[c]=0;pw(s[o])&&(a+=s[o]);const l=Math.trunc(a);r[o]=l,i[o]=(a*1e3-l*1e3)/1e3;for(const c in s)k1.indexOf(c)>k1.indexOf(o)&&nve(this.matrix,s,c,r,o)}else pw(s[o])&&(i[o]=s[o]);for(const o in i)i[o]!==0&&(r[n]+=o===n?i[o]:i[o]/this.matrix[n][o]);return ty(this,{values:r},!0).normalize()}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const r of Object.keys(this.values))e[r]=this.values[r]===0?0:-this.values[r];return ty(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function r(i,s){return i===void 0||i===0?s===void 0||s===0:i===s}for(const i of k1)if(!r(this.values[i],e.values[i]))return!1;return!0}}const qx="Invalid Interval";function mke(t,e){return!t||!t.isValid?nn.invalid("missing or invalid start"):!e||!e.isValid?nn.invalid("missing or invalid end"):e<t?nn.invalid("end before start",`The end of an interval must be after its start, but you had start=${t.toISO()} and end=${e.toISO()}`):null}class nn{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,r=null){if(!e)throw new Ch("need to specify a reason the Interval is invalid");const i=e instanceof up?e:new up(e,r);if(Zn.throwOnInvalid)throw new V9e(i);return new nn({invalid:i})}static fromDateTimes(e,r){const i=i3(e),s=i3(r),n=mke(i,s);return n??new nn({start:i,end:s})}static after(e,r){const i=di.fromDurationLike(r),s=i3(e);return nn.fromDateTimes(s,s.plus(i))}static before(e,r){const i=di.fromDurationLike(r),s=i3(e);return nn.fromDateTimes(s.minus(i),s)}static fromISO(e,r){const[i,s]=(e||"").split("/",2);if(i&&s){let n,o;try{n=br.fromISO(i,r),o=n.isValid}catch{o=!1}let a,l;try{a=br.fromISO(s,r),l=a.isValid}catch{l=!1}if(o&&l)return nn.fromDateTimes(n,a);if(o){const c=di.fromISO(s,r);if(c.isValid)return nn.after(n,c)}else if(l){const c=di.fromISO(i,r);if(c.isValid)return nn.before(a,c)}}return nn.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds"){if(!this.isValid)return NaN;const r=this.start.startOf(e),i=this.end.startOf(e);return Math.floor(i.diff(r,e).get(e))+(i.valueOf()!==this.end.valueOf())}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:r}={}){return this.isValid?nn.fromDateTimes(e||this.s,r||this.e):this}splitAt(...e){if(!this.isValid)return[];const r=e.map(i3).filter(o=>this.contains(o)).sort(),i=[];let{s}=this,n=0;for(;s<this.e;){const o=r[n]||this.e,a=+o>+this.e?this.e:o;i.push(nn.fromDateTimes(s,a)),s=a,n+=1}return i}splitBy(e){const r=di.fromDurationLike(e);if(!this.isValid||!r.isValid||r.as("milliseconds")===0)return[];let{s:i}=this,s=1,n;const o=[];for(;i<this.e;){const a=this.start.plus(r.mapUnits(l=>l*s));n=+a>+this.e?this.e:a,o.push(nn.fromDateTimes(i,n)),i=n,s+=1}return o}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const r=this.s>e.s?this.s:e.s,i=this.e<e.e?this.e:e.e;return r>=i?null:nn.fromDateTimes(r,i)}union(e){if(!this.isValid)return this;const r=this.s<e.s?this.s:e.s,i=this.e>e.e?this.e:e.e;return nn.fromDateTimes(r,i)}static merge(e){const[r,i]=e.sort((s,n)=>s.s-n.s).reduce(([s,n],o)=>n?n.overlaps(o)||n.abutsStart(o)?[s,n.union(o)]:[s.concat([n]),o]:[s,o],[[],null]);return i&&r.push(i),r}static xor(e){let r=null,i=0;const s=[],n=e.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),o=Array.prototype.concat(...n),a=o.sort((l,c)=>l.time-c.time);for(const l of a)i+=l.type==="s"?1:-1,i===1?r=l.time:(r&&+r!=+l.time&&s.push(nn.fromDateTimes(r,l.time)),r=null);return nn.merge(s)}difference(...e){return nn.xor([this].concat(e)).map(r=>this.intersection(r)).filter(r=>r&&!r.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()}  ${this.e.toISO()})`:qx}toLocaleString(e=g5,r={}){return this.isValid?tl.create(this.s.loc.clone(r),e).formatInterval(this):qx}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:qx}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:qx}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:qx}toFormat(e,{separator:r="  "}={}){return this.isValid?`${this.s.toFormat(e)}${r}${this.e.toFormat(e)}`:qx}toDuration(e,r){return this.isValid?this.e.diff(this.s,e,r):di.invalid(this.invalidReason)}mapEndpoints(e){return nn.fromDateTimes(e(this.s),e(this.e))}}class AI{static hasDST(e=Zn.defaultZone){const r=br.now().setZone(e).set({month:12});return!e.isUniversal&&r.offset!==r.set({month:6}).offset}static isValidIANAZone(e){return g0.isValidZone(e)}static normalizeZone(e){return x_(e,Zn.defaultZone)}static months(e="long",{locale:r=null,numberingSystem:i=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||Is.create(r,i,n)).months(e)}static monthsFormat(e="long",{locale:r=null,numberingSystem:i=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||Is.create(r,i,n)).months(e,!0)}static weekdays(e="long",{locale:r=null,numberingSystem:i=null,locObj:s=null}={}){return(s||Is.create(r,i,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:r=null,numberingSystem:i=null,locObj:s=null}={}){return(s||Is.create(r,i,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return Is.create(e).meridiems()}static eras(e="short",{locale:r=null}={}){return Is.create(r,null,"gregory").eras(e)}static features(){return{relative:B_e()}}}function pie(t,e){const r=s=>s.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),i=r(e)-r(t);return Math.floor(di.fromMillis(i).as("days"))}function gke(t,e,r){const i=[["years",(l,c)=>c.year-l.year],["quarters",(l,c)=>c.quarter-l.quarter+(c.year-l.year)*4],["months",(l,c)=>c.month-l.month+(c.year-l.year)*12],["weeks",(l,c)=>{const h=pie(l,c);return(h-h%7)/7}],["days",pie]],s={},n=t;let o,a;for(const[l,c]of i)r.indexOf(l)>=0&&(o=l,s[l]=c(t,e),a=n.plus(s),a>e?(s[l]--,t=n.plus(s)):t=a);return[t,s,a,o]}function yke(t,e,r,i){let[s,n,o,a]=gke(t,e,r);const l=e-s,c=r.filter(d=>["hours","minutes","seconds","milliseconds"].indexOf(d)>=0);c.length===0&&(o<e&&(o=s.plus({[a]:1})),o!==s&&(n[a]=(n[a]||0)+l/(o-s)));const h=di.fromObject(n,i);return c.length>0?di.fromMillis(l,i).shiftTo(...c).plus(h):h}const XZ={arab:"[-]",arabext:"[-]",bali:"[-]",beng:"[-]",deva:"[-]",fullwide:"[-]",gujr:"[-]",hanidec:"[|||||||||]",khmr:"[-]",knda:"[-]",laoo:"[-]",limb:"[-]",mlym:"[-]",mong:"[-]",mymr:"[-]",orya:"[-]",tamldec:"[-]",telu:"[-]",thai:"[-]",tibt:"[-]",latn:"\\d"},fie={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},_ke=XZ.hanidec.replace(/[\[|\]]/g,"").split("");function vke(t){let e=parseInt(t,10);if(isNaN(e)){e="";for(let r=0;r<t.length;r++){const i=t.charCodeAt(r);if(t[r].search(XZ.hanidec)!==-1)e+=_ke.indexOf(t[r]);else for(const s in fie){const[n,o]=fie[s];i>=n&&i<=o&&(e+=i-n)}}return parseInt(e,10)}else return e}function ud({numberingSystem:t},e=""){return new RegExp(`${XZ[t||"latn"]}${e}`)}const bke="missing Intl.DateTimeFormat.formatToParts support";function Ai(t,e=r=>r){return{regex:t,deser:([r])=>e(vke(r))}}const wke=String.fromCharCode(160),ove=`[ ${wke}]`,ave=new RegExp(ove,"g");function xke(t){return t.replace(/\./g,"\\.?").replace(ave,ove)}function mie(t){return t.replace(/\./g,"").replace(ave," ").toLowerCase()}function hd(t,e){return t===null?null:{regex:RegExp(t.map(xke).join("|")),deser:([r])=>t.findIndex(i=>mie(r)===mie(i))+e}}function gie(t,e){return{regex:t,deser:([,r,i])=>n8(r,i),groups:e}}function OI(t){return{regex:t,deser:([e])=>e}}function Tke(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function Ske(t,e){const r=ud(e),i=ud(e,"{2}"),s=ud(e,"{3}"),n=ud(e,"{4}"),o=ud(e,"{6}"),a=ud(e,"{1,2}"),l=ud(e,"{1,3}"),c=ud(e,"{1,6}"),h=ud(e,"{1,9}"),d=ud(e,"{2,4}"),f=ud(e,"{4,6}"),m=v=>({regex:RegExp(Tke(v.val)),deser:([b])=>b,literal:!0}),_=(v=>{if(t.literal)return m(v);switch(v.val){case"G":return hd(e.eras("short",!1),0);case"GG":return hd(e.eras("long",!1),0);case"y":return Ai(c);case"yy":return Ai(d,BB);case"yyyy":return Ai(n);case"yyyyy":return Ai(f);case"yyyyyy":return Ai(o);case"M":return Ai(a);case"MM":return Ai(i);case"MMM":return hd(e.months("short",!0,!1),1);case"MMMM":return hd(e.months("long",!0,!1),1);case"L":return Ai(a);case"LL":return Ai(i);case"LLL":return hd(e.months("short",!1,!1),1);case"LLLL":return hd(e.months("long",!1,!1),1);case"d":return Ai(a);case"dd":return Ai(i);case"o":return Ai(l);case"ooo":return Ai(s);case"HH":return Ai(i);case"H":return Ai(a);case"hh":return Ai(i);case"h":return Ai(a);case"mm":return Ai(i);case"m":return Ai(a);case"q":return Ai(a);case"qq":return Ai(i);case"s":return Ai(a);case"ss":return Ai(i);case"S":return Ai(l);case"SSS":return Ai(s);case"u":return OI(h);case"uu":return OI(a);case"uuu":return Ai(r);case"a":return hd(e.meridiems(),0);case"kkkk":return Ai(n);case"kk":return Ai(d,BB);case"W":return Ai(a);case"WW":return Ai(i);case"E":case"c":return Ai(r);case"EEE":return hd(e.weekdays("short",!1,!1),1);case"EEEE":return hd(e.weekdays("long",!1,!1),1);case"ccc":return hd(e.weekdays("short",!0,!1),1);case"cccc":return hd(e.weekdays("long",!0,!1),1);case"Z":case"ZZ":return gie(new RegExp(`([+-]${a.source})(?::(${i.source}))?`),2);case"ZZZ":return gie(new RegExp(`([+-]${a.source})(${i.source})?`),2);case"z":return OI(/[a-z_+-/]{1,256}?/i);case" ":return OI(/[^\S\n\r]/);default:return m(v)}})(t)||{invalidReason:bke};return _.token=t,_}const Eke={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function Cke(t,e){const{type:r,value:i}=t;if(r==="literal"){const o=/^\s+$/.test(i);return{literal:!o,val:o?" ":i}}const s=e[r];let n=Eke[r];if(typeof n=="object"&&(n=n[s]),n)return{literal:!1,val:n}}function Ake(t){return[`^${t.map(r=>r.regex).reduce((r,i)=>`${r}(${i.source})`,"")}$`,t]}function Oke(t,e,r){const i=t.match(e);if(i){const s={};let n=1;for(const o in r)if(bE(r,o)){const a=r[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(s[a.token.val[0]]=a.deser(i.slice(n,n+l))),n+=l}return[i,s]}else return[i,{}]}function Rke(t){const e=n=>{switch(n){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let r=null,i;return oi(t.z)||(r=g0.create(t.z)),oi(t.Z)||(r||(r=new il(t.Z)),i=t.Z),oi(t.q)||(t.M=(t.q-1)*3+1),oi(t.h)||(t.h<12&&t.a===1?t.h+=12:t.h===12&&t.a===0&&(t.h=0)),t.G===0&&t.y&&(t.y=-t.y),oi(t.u)||(t.S=BZ(t.u)),[Object.keys(t).reduce((n,o)=>{const a=e(o);return a&&(n[a]=t[o]),n},{}),r,i]}let FU=null;function Mke(){return FU||(FU=br.fromMillis(1555555555555)),FU}function Pke(t,e){if(t.literal)return t;const r=tl.macroTokenToFormatOpts(t.val),i=uve(r,e);return i==null||i.includes(void 0)?t:i}function lve(t,e){return Array.prototype.concat(...t.map(r=>Pke(r,e)))}function cve(t,e,r){const i=lve(tl.parseFormat(r),t),s=i.map(o=>Ske(o,t)),n=s.find(o=>o.invalidReason);if(n)return{input:e,tokens:i,invalidReason:n.invalidReason};{const[o,a]=Ake(s),l=RegExp(o,"i"),[c,h]=Oke(e,l,a),[d,f,m]=h?Rke(h):[null,null,void 0];if(bE(h,"a")&&bE(h,"H"))throw new TA("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:i,regex:l,rawMatches:c,matches:h,result:d,zone:f,specificOffset:m}}}function Ike(t,e,r){const{result:i,zone:s,specificOffset:n,invalidReason:o}=cve(t,e,r);return[i,s,n,o]}function uve(t,e){return t?tl.create(e,t).formatDateTimeParts(Mke()).map(s=>Cke(s,t)):null}const hve=[0,31,59,90,120,151,181,212,243,273,304,334],dve=[0,31,60,91,121,152,182,213,244,274,305,335];function Fh(t,e){return new up("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${t}, which is invalid`)}function pve(t,e,r){const i=new Date(Date.UTC(t,e-1,r));t<100&&t>=0&&i.setUTCFullYear(i.getUTCFullYear()-1900);const s=i.getUTCDay();return s===0?7:s}function fve(t,e,r){return r+(vP(t)?dve:hve)[e-1]}function mve(t,e){const r=vP(t)?dve:hve,i=r.findIndex(n=>n<e),s=e-r[i];return{month:i+1,day:s}}function GB(t){const{year:e,month:r,day:i}=t,s=fve(e,r,i),n=pve(e,r,i);let o=Math.floor((s-n+10)/7),a;return o<1?(a=e-1,o=_5(a)):o>_5(e)?(a=e+1,o=1):a=e,{weekYear:a,weekNumber:o,weekday:n,...o8(t)}}function yie(t){const{weekYear:e,weekNumber:r,weekday:i}=t,s=pve(e,1,4),n=lR(e);let o=r*7+i-s-3,a;o<1?(a=e-1,o+=lR(a)):o>n?(a=e+1,o-=lR(e)):a=e;const{month:l,day:c}=mve(a,o);return{year:a,month:l,day:c,...o8(t)}}function UU(t){const{year:e,month:r,day:i}=t,s=fve(e,r,i);return{year:e,ordinal:s,...o8(t)}}function _ie(t){const{year:e,ordinal:r}=t,{month:i,day:s}=mve(e,r);return{year:e,month:i,day:s,...o8(t)}}function $ke(t){const e=s8(t.weekYear),r=qg(t.weekNumber,1,_5(t.weekYear)),i=qg(t.weekday,1,7);return e?r?i?!1:Fh("weekday",t.weekday):Fh("week",t.week):Fh("weekYear",t.weekYear)}function Lke(t){const e=s8(t.year),r=qg(t.ordinal,1,lR(t.year));return e?r?!1:Fh("ordinal",t.ordinal):Fh("year",t.year)}function gve(t){const e=s8(t.year),r=qg(t.month,1,12),i=qg(t.day,1,y5(t.year,t.month));return e?r?i?!1:Fh("day",t.day):Fh("month",t.month):Fh("year",t.year)}function yve(t){const{hour:e,minute:r,second:i,millisecond:s}=t,n=qg(e,0,23)||e===24&&r===0&&i===0&&s===0,o=qg(r,0,59),a=qg(i,0,59),l=qg(s,0,999);return n?o?a?l?!1:Fh("millisecond",s):Fh("second",i):Fh("minute",r):Fh("hour",e)}const kU="Invalid DateTime",vie=864e13;function RI(t){return new up("unsupported zone",`the zone "${t.name}" is not supported`)}function zU(t){return t.weekData===null&&(t.weekData=GB(t.c)),t.weekData}function t3(t,e){const r={ts:t.ts,zone:t.zone,c:t.c,o:t.o,loc:t.loc,invalid:t.invalid};return new br({...r,...e,old:r})}function _ve(t,e,r){let i=t-e*60*1e3;const s=r.offset(i);if(e===s)return[i,e];i-=(s-e)*60*1e3;const n=r.offset(i);return s===n?[i,s]:[t-Math.min(s,n)*60*1e3,Math.max(s,n)]}function bie(t,e){t+=e*60*1e3;const r=new Date(t);return{year:r.getUTCFullYear(),month:r.getUTCMonth()+1,day:r.getUTCDate(),hour:r.getUTCHours(),minute:r.getUTCMinutes(),second:r.getUTCSeconds(),millisecond:r.getUTCMilliseconds()}}function jD(t,e,r){return _ve(jZ(t),e,r)}function wie(t,e){const r=t.o,i=t.c.year+Math.trunc(e.years),s=t.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,n={...t.c,year:i,month:s,day:Math.min(t.c.day,y5(i,s))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},o=di.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),a=jZ(n);let[l,c]=_ve(a,r,t.zone);return o!==0&&(l+=o,c=t.zone.offset(l)),{ts:l,o:c}}function r3(t,e,r,i,s,n){const{setZone:o,zone:a}=r;if(t&&Object.keys(t).length!==0||e){const l=e||a,c=br.fromObject(t,{...r,zone:l,specificOffset:n});return o?c:c.setZone(a)}else return br.invalid(new up("unparsable",`the input "${s}" can't be parsed as ${i}`))}function MI(t,e,r=!0){return t.isValid?tl.create(Is.create("en-US"),{allowZ:r,forceSimple:!0}).formatDateTimeFromString(t,e):null}function VU(t,e){const r=t.c.year>9999||t.c.year<0;let i="";return r&&t.c.year>=0&&(i+="+"),i+=Qn(t.c.year,r?6:4),e?(i+="-",i+=Qn(t.c.month),i+="-",i+=Qn(t.c.day)):(i+=Qn(t.c.month),i+=Qn(t.c.day)),i}function xie(t,e,r,i,s,n){let o=Qn(t.c.hour);return e?(o+=":",o+=Qn(t.c.minute),(t.c.second!==0||!r)&&(o+=":")):o+=Qn(t.c.minute),(t.c.second!==0||!r)&&(o+=Qn(t.c.second),(t.c.millisecond!==0||!i)&&(o+=".",o+=Qn(t.c.millisecond,3))),s&&(t.isOffsetFixed&&t.offset===0&&!n?o+="Z":t.o<0?(o+="-",o+=Qn(Math.trunc(-t.o/60)),o+=":",o+=Qn(Math.trunc(-t.o%60))):(o+="+",o+=Qn(Math.trunc(t.o/60)),o+=":",o+=Qn(Math.trunc(t.o%60)))),n&&(o+="["+t.zone.ianaName+"]"),o}const vve={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},Dke={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},Nke={ordinal:1,hour:0,minute:0,second:0,millisecond:0},bve=["year","month","day","hour","minute","second","millisecond"],Fke=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],Uke=["year","ordinal","hour","minute","second","millisecond"];function Tie(t){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[t.toLowerCase()];if(!e)throw new x_e(t);return e}function Sie(t,e){const r=x_(e.zone,Zn.defaultZone),i=Is.fromObject(e),s=Zn.now();let n,o;if(oi(t.year))n=s;else{for(const c of bve)oi(t[c])&&(t[c]=vve[c]);const a=gve(t)||yve(t);if(a)return br.invalid(a);const l=r.offset(s);[n,o]=jD(t,l,r)}return new br({ts:n,zone:r,loc:i,o})}function Eie(t,e,r){const i=oi(r.round)?!0:r.round,s=(o,a)=>(o=GZ(o,i||r.calendary?0:2,!0),e.loc.clone(r).relFormatter(r).format(o,a)),n=o=>r.calendary?e.hasSame(t,o)?0:e.startOf(o).diff(t.startOf(o),o).get(o):e.diff(t,o).get(o);if(r.unit)return s(n(r.unit),r.unit);for(const o of r.units){const a=n(o);if(Math.abs(a)>=1)return s(a,o)}return s(t>e?-0:0,r.units[r.units.length-1])}function Cie(t){let e={},r;return t.length>0&&typeof t[t.length-1]=="object"?(e=t[t.length-1],r=Array.from(t).slice(0,t.length-1)):r=Array.from(t),[e,r]}class br{constructor(e){const r=e.zone||Zn.defaultZone;let i=e.invalid||(Number.isNaN(e.ts)?new up("invalid input"):null)||(r.isValid?null:RI(r));this.ts=oi(e.ts)?Zn.now():e.ts;let s=null,n=null;if(!i)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(r))[s,n]=[e.old.c,e.old.o];else{const a=r.offset(this.ts);s=bie(this.ts,a),i=Number.isNaN(s.year)?new up("invalid input"):null,s=i?null:s,n=i?null:a}this._zone=r,this.loc=e.loc||Is.create(),this.invalid=i,this.weekData=null,this.c=s,this.o=n,this.isLuxonDateTime=!0}static now(){return new br({})}static local(){const[e,r]=Cie(arguments),[i,s,n,o,a,l,c]=r;return Sie({year:i,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},e)}static utc(){const[e,r]=Cie(arguments),[i,s,n,o,a,l,c]=r;return e.zone=il.utcInstance,Sie({year:i,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},e)}static fromJSDate(e,r={}){const i=cUe(e)?e.valueOf():NaN;if(Number.isNaN(i))return br.invalid("invalid input");const s=x_(r.zone,Zn.defaultZone);return s.isValid?new br({ts:i,zone:s,loc:Is.fromObject(r)}):br.invalid(RI(s))}static fromMillis(e,r={}){if(pw(e))return e<-vie||e>vie?br.invalid("Timestamp out of range"):new br({ts:e,zone:x_(r.zone,Zn.defaultZone),loc:Is.fromObject(r)});throw new Ch(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,r={}){if(pw(e))return new br({ts:e*1e3,zone:x_(r.zone,Zn.defaultZone),loc:Is.fromObject(r)});throw new Ch("fromSeconds requires a numerical input")}static fromObject(e,r={}){e=e||{};const i=x_(r.zone,Zn.defaultZone);if(!i.isValid)return br.invalid(RI(i));const s=Zn.now(),n=oi(r.specificOffset)?i.offset(s):r.specificOffset,o=v5(e,Tie),a=!oi(o.ordinal),l=!oi(o.year),c=!oi(o.month)||!oi(o.day),h=l||c,d=o.weekYear||o.weekNumber,f=Is.fromObject(r);if((h||a)&&d)throw new TA("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(c&&a)throw new TA("Can't mix ordinal dates with month/day");const m=d||o.weekday&&!h;let g,_,v=bie(s,n);m?(g=Fke,_=Dke,v=GB(v)):a?(g=Uke,_=Nke,v=UU(v)):(g=bve,_=vve);let b=!1;for(const M of g){const D=o[M];oi(D)?b?o[M]=_[M]:o[M]=v[M]:b=!0}const T=m?$ke(o):a?Lke(o):gve(o),x=T||yve(o);if(x)return br.invalid(x);const S=m?yie(o):a?_ie(o):o,[E,A]=jD(S,n,i),R=new br({ts:E,zone:i,o:A,loc:f});return o.weekday&&h&&e.weekday!==R.weekday?br.invalid("mismatched weekday",`you can't specify both a weekday of ${o.weekday} and a date of ${R.toISO()}`):R}static fromISO(e,r={}){const[i,s]=QUe(e);return r3(i,s,r,"ISO 8601",e)}static fromRFC2822(e,r={}){const[i,s]=KUe(e);return r3(i,s,r,"RFC 2822",e)}static fromHTTP(e,r={}){const[i,s]=eke(e);return r3(i,s,r,"HTTP",r)}static fromFormat(e,r,i={}){if(oi(e)||oi(r))throw new Ch("fromFormat requires an input string and a format");const{locale:s=null,numberingSystem:n=null}=i,o=Is.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0}),[a,l,c,h]=Ike(o,e,r);return h?br.invalid(h):r3(a,l,i,`format ${r}`,e,c)}static fromString(e,r,i={}){return br.fromFormat(e,r,i)}static fromSQL(e,r={}){const[i,s]=ake(e);return r3(i,s,r,"SQL",e)}static invalid(e,r=null){if(!e)throw new Ch("need to specify a reason the DateTime is invalid");const i=e instanceof up?e:new up(e,r);if(Zn.throwOnInvalid)throw new z9e(i);return new br({invalid:i})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,r={}){const i=uve(e,Is.fromObject(r));return i?i.map(s=>s?s.val:null).join(""):null}static expandFormat(e,r={}){return lve(tl.parseFormat(e),Is.fromObject(r)).map(s=>s.val).join("")}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?zU(this).weekYear:NaN}get weekNumber(){return this.isValid?zU(this).weekNumber:NaN}get weekday(){return this.isValid?zU(this).weekday:NaN}get ordinal(){return this.isValid?UU(this.c).ordinal:NaN}get monthShort(){return this.isValid?AI.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?AI.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?AI.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?AI.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}get isInLeapYear(){return vP(this.year)}get daysInMonth(){return y5(this.year,this.month)}get daysInYear(){return this.isValid?lR(this.year):NaN}get weeksInWeekYear(){return this.isValid?_5(this.weekYear):NaN}resolvedLocaleOptions(e={}){const{locale:r,numberingSystem:i,calendar:s}=tl.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:r,numberingSystem:i,outputCalendar:s}}toUTC(e=0,r={}){return this.setZone(il.instance(e),r)}toLocal(){return this.setZone(Zn.defaultZone)}setZone(e,{keepLocalTime:r=!1,keepCalendarTime:i=!1}={}){if(e=x_(e,Zn.defaultZone),e.equals(this.zone))return this;if(e.isValid){let s=this.ts;if(r||i){const n=e.offset(this.ts),o=this.toObject();[s]=jD(o,n,e)}return t3(this,{ts:s,zone:e})}else return br.invalid(RI(e))}reconfigure({locale:e,numberingSystem:r,outputCalendar:i}={}){const s=this.loc.clone({locale:e,numberingSystem:r,outputCalendar:i});return t3(this,{loc:s})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const r=v5(e,Tie),i=!oi(r.weekYear)||!oi(r.weekNumber)||!oi(r.weekday),s=!oi(r.ordinal),n=!oi(r.year),o=!oi(r.month)||!oi(r.day),a=n||o,l=r.weekYear||r.weekNumber;if((a||s)&&l)throw new TA("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(o&&s)throw new TA("Can't mix ordinal dates with month/day");let c;i?c=yie({...GB(this.c),...r}):oi(r.ordinal)?(c={...this.toObject(),...r},oi(r.day)&&(c.day=Math.min(y5(c.year,c.month),c.day))):c=_ie({...UU(this.c),...r});const[h,d]=jD(c,this.o,this.zone);return t3(this,{ts:h,o:d})}plus(e){if(!this.isValid)return this;const r=di.fromDurationLike(e);return t3(this,wie(this,r))}minus(e){if(!this.isValid)return this;const r=di.fromDurationLike(e).negate();return t3(this,wie(this,r))}startOf(e){if(!this.isValid)return this;const r={},i=di.normalizeUnit(e);switch(i){case"years":r.month=1;case"quarters":case"months":r.day=1;case"weeks":case"days":r.hour=0;case"hours":r.minute=0;case"minutes":r.second=0;case"seconds":r.millisecond=0;break}if(i==="weeks"&&(r.weekday=1),i==="quarters"){const s=Math.ceil(this.month/3);r.month=(s-1)*3+1}return this.set(r)}endOf(e){return this.isValid?this.plus({[e]:1}).startOf(e).minus(1):this}toFormat(e,r={}){return this.isValid?tl.create(this.loc.redefaultToEN(r)).formatDateTimeFromString(this,e):kU}toLocaleString(e=g5,r={}){return this.isValid?tl.create(this.loc.clone(r),e).formatDateTime(this):kU}toLocaleParts(e={}){return this.isValid?tl.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:r=!1,suppressMilliseconds:i=!1,includeOffset:s=!0,extendedZone:n=!1}={}){if(!this.isValid)return null;const o=e==="extended";let a=VU(this,o);return a+="T",a+=xie(this,o,r,i,s,n),a}toISODate({format:e="extended"}={}){return this.isValid?VU(this,e==="extended"):null}toISOWeekDate(){return MI(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:r=!1,includeOffset:i=!0,includePrefix:s=!1,extendedZone:n=!1,format:o="extended"}={}){return this.isValid?(s?"T":"")+xie(this,o==="extended",r,e,i,n):null}toRFC2822(){return MI(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return MI(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?VU(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:r=!1,includeOffsetSpace:i=!0}={}){let s="HH:mm:ss.SSS";return(r||e)&&(i&&(s+=" "),r?s+="z":e&&(s+="ZZ")),MI(this,s,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():kU}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const r={...this.c};return e.includeConfig&&(r.outputCalendar=this.outputCalendar,r.numberingSystem=this.loc.numberingSystem,r.locale=this.loc.locale),r}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,r="milliseconds",i={}){if(!this.isValid||!e.isValid)return di.invalid("created by diffing an invalid DateTime");const s={locale:this.locale,numberingSystem:this.numberingSystem,...i},n=uUe(r).map(di.normalizeUnit),o=e.valueOf()>this.valueOf(),a=o?this:e,l=o?e:this,c=yke(a,l,n,s);return o?c.negate():c}diffNow(e="milliseconds",r={}){return this.diff(br.now(),e,r)}until(e){return this.isValid?nn.fromDateTimes(this,e):this}hasSame(e,r){if(!this.isValid)return!1;const i=e.valueOf(),s=this.setZone(e.zone,{keepLocalTime:!0});return s.startOf(r)<=i&&i<=s.endOf(r)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const r=e.base||br.fromObject({},{zone:this.zone}),i=e.padding?this<r?-e.padding:e.padding:0;let s=["years","months","days","hours","minutes","seconds"],n=e.unit;return Array.isArray(e.unit)&&(s=e.unit,n=void 0),Eie(r,this.plus(i),{...e,numeric:"always",units:s,unit:n})}toRelativeCalendar(e={}){return this.isValid?Eie(e.base||br.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(br.isDateTime))throw new Ch("min requires all arguments be DateTimes");return uie(e,r=>r.valueOf(),Math.min)}static max(...e){if(!e.every(br.isDateTime))throw new Ch("max requires all arguments be DateTimes");return uie(e,r=>r.valueOf(),Math.max)}static fromFormatExplain(e,r,i={}){const{locale:s=null,numberingSystem:n=null}=i,o=Is.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0});return cve(o,e,r)}static fromStringExplain(e,r,i={}){return br.fromFormatExplain(e,r,i)}static get DATE_SHORT(){return g5}static get DATE_MED(){return T_e}static get DATE_MED_WITH_WEEKDAY(){return G9e}static get DATE_FULL(){return S_e}static get DATE_HUGE(){return E_e}static get TIME_SIMPLE(){return C_e}static get TIME_WITH_SECONDS(){return A_e}static get TIME_WITH_SHORT_OFFSET(){return O_e}static get TIME_WITH_LONG_OFFSET(){return R_e}static get TIME_24_SIMPLE(){return M_e}static get TIME_24_WITH_SECONDS(){return P_e}static get TIME_24_WITH_SHORT_OFFSET(){return I_e}static get TIME_24_WITH_LONG_OFFSET(){return $_e}static get DATETIME_SHORT(){return L_e}static get DATETIME_SHORT_WITH_SECONDS(){return D_e}static get DATETIME_MED(){return N_e}static get DATETIME_MED_WITH_SECONDS(){return F_e}static get DATETIME_MED_WITH_WEEKDAY(){return j9e}static get DATETIME_FULL(){return U_e}static get DATETIME_FULL_WITH_SECONDS(){return k_e}static get DATETIME_HUGE(){return z_e}static get DATETIME_HUGE_WITH_SECONDS(){return V_e}}function i3(t){if(br.isDateTime(t))return t;if(t&&t.valueOf&&pw(t.valueOf()))return br.fromJSDate(t);if(t&&typeof t=="object")return br.fromObject(t);throw new Ch(`Unknown datetime argument: ${t}, of type ${typeof t}`)}const kke={year:void 0,month:void 0,day:void 0,weekday:void 0},zke={hour:void 0,minute:void 0,second:void 0},Vke={timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone},YZ={timeZone:"Etc/UTC"},Gp={year:"numeric",month:"numeric",day:"numeric"},s3={year:"numeric",month:"long",day:"numeric"},n3={year:"numeric",month:"short",day:"numeric"},o3={year:"numeric",month:"long",weekday:"long",day:"numeric"},ih={hour:"numeric",minute:"numeric"},dd={...ih,second:"numeric"},EC={"short-date":Gp,"short-date-short-time":{...Gp,...ih},"short-date-short-time-24":{...Gp,...ih,hour12:!1},"short-date-long-time":{...Gp,...dd},"short-date-long-time-24":{...Gp,...dd,hour12:!1},"short-date-le":Gp,"short-date-le-short-time":{...Gp,...ih},"short-date-le-short-time-24":{...Gp,...ih,hour12:!1},"short-date-le-long-time":{...Gp,...dd},"short-date-le-long-time-24":{...Gp,...dd,hour12:!1},"long-month-day-year":s3,"long-month-day-year-short-time":{...s3,...ih},"long-month-day-year-short-time-24":{...s3,...ih,hour12:!1},"long-month-day-year-long-time":{...s3,...dd},"long-month-day-year-long-time-24":{...s3,...dd,hour12:!1},"day-short-month-year":n3,"day-short-month-year-short-time":{...n3,...ih},"day-short-month-year-short-time-24":{...n3,...ih,hour12:!1},"day-short-month-year-long-time":{...n3,...dd},"day-short-month-year-long-time-24":{...n3,...dd,hour12:!1},"long-date":o3,"long-date-short-time":{...o3,...ih},"long-date-short-time-24":{...o3,...ih,hour12:!1},"long-date-long-time":{...o3,...dd},"long-date-long-time-24":{...o3,...dd,hour12:!1},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":ih,"long-time":dd},Bke=ll()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"}),wve={ar:"ar-u-nu-latn-ca-gregory"};let jB=new WeakMap,xve=EC["short-date-short-time"];function Gke(t){const e=t||xve;let r=jB.get(e);if(!r){const i=bp(),s=wve[i]||i;r=new Intl.DateTimeFormat(s,e),jB.set(e,r)}return r}function EA(t){return EC[t]}function y0(t,e){return Gke(e).format(t)}function jke(t,e=EC["short-date"]){return y0(new Date(t),{...e,...YZ,...zke})}function Hke(t,e=EC["short-time"]){return y0(new Date(`1970-01-01T${t}Z`),{...e,...YZ,...kke})}function qke(t,e=EC["short-date-short-time"]){const r=br.fromISO(t,{setZone:!0}),i=bp(),s=wve[i]??i;return r.toLocaleString({...Vke,...e},{locale:s})}hZ(()=>{jB=new WeakMap,xve=EC["short-date-short-time"]});const Wke={ar:"ar-u-nu-latn"};let HD=new WeakMap,Tve={};function Xke(t){const e=t||Tve;if(!HD.has(e)){const r=bp(),i=Wke[bp()]||r;HD.set(e,new Intl.NumberFormat(i,t))}return HD.get(e)}function Yke(t={}){const e={};return t.digitSeparator!=null&&(e.useGrouping=t.digitSeparator),t.places!=null&&(e.minimumFractionDigits=e.maximumFractionDigits=t.places),e}function wE(t,e){return Object.is(t,-0)&&(t=0),Xke(e).format(t)}hZ(()=>{HD=new WeakMap,Tve={}});let a2=class extends Hi(ue){constructor(e){super(e),this.dateFormat=null,this.digitSeparator=!1,this.places=null}formatNumber(e){return wE(e,Yke(this))}formatDate(e,r=!1){return this.dateFormat?y0(e,{...EA(this.dateFormat),...r&&YZ}):this.formatNumber(e)}formatDateOnly(e){const r=(this.dateFormat&&EA(this.dateFormat))??void 0;return jke(e,r)}formatTimeOnly(e){const r=(this.dateFormat&&EA(this.dateFormat))??void 0;return Hke(e,r)}formatTimestamp(e){const r=(this.dateFormat&&EA(this.dateFormat))??void 0;return qke(e,r)}formatRasterPixelValue(e){return e.includes("-")?e:e.trim().includes(",")?this._formatDelimitedString(e,",",", "):e.trim().includes(";")?this._formatDelimitedString(e,";","; "):e.trim().includes(" ")?this._formatDelimitedString(e," "," "):this.formatNumber(Number(e))}_formatDelimitedString(e,r,i){return e&&r&&i?e.trim().split(r).map(s=>this.formatNumber(Number(s))).join(i):e}};u([nt(Bke)],a2.prototype,"dateFormat",void 0),u([p({type:Boolean,json:{write:!0}})],a2.prototype,"digitSeparator",void 0),u([p({type:Ki,json:{write:!0}})],a2.prototype,"places",void 0),a2=u([P("esri.popup.support.FieldInfoFormat")],a2);const CA=a2;var HB;let Sd=HB=class extends ue{constructor(t){super(t),this.fieldName=null,this.format=null,this.isEditable=!0,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new HB({fieldName:this.fieldName,format:this.format?ee(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};u([p({type:String,json:{write:!0}})],Sd.prototype,"fieldName",void 0),u([p({type:CA,json:{write:!0}})],Sd.prototype,"format",void 0),u([p({type:Boolean,json:{write:{alwaysWriteDefaults:!0},default:!0}})],Sd.prototype,"isEditable",void 0),u([p({type:String,json:{write:!0}})],Sd.prototype,"label",void 0),u([nt(new $r({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],Sd.prototype,"stringFieldOption",void 0),u([p({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],Sd.prototype,"statisticType",void 0),u([p({type:String,json:{write:!0}})],Sd.prototype,"tooltip",void 0),u([p({type:Boolean,json:{write:!0}})],Sd.prototype,"visible",void 0),Sd=HB=u([P("esri.popup.FieldInfo")],Sd);const ZZ=Sd;var qB;let hg=qB=class extends Ov{constructor(t){super(t),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(t,e){e.fieldInfos=t&&t.map(r=>r.toJSON())}clone(){return new qB(ee({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};u([p({type:Object,json:{write:!0}})],hg.prototype,"attributes",void 0),u([p({type:String,json:{write:!0}})],hg.prototype,"description",void 0),u([p({type:[ZZ]})],hg.prototype,"fieldInfos",void 0),u([Be("fieldInfos")],hg.prototype,"writeFieldInfos",null),u([p({type:String,json:{write:!0}})],hg.prototype,"title",void 0),u([p({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],hg.prototype,"type",void 0),hg=qB=u([P("esri.popup.content.FieldsContent")],hg);const hM=hg;let z1=class extends ue{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};u([p({type:String,json:{write:!0}})],z1.prototype,"altText",void 0),u([p({type:String,json:{write:!0}})],z1.prototype,"caption",void 0),u([p({type:String,json:{write:!0}})],z1.prototype,"title",void 0),u([p({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],z1.prototype,"type",void 0),z1=u([P("esri.popup.content.mixins.MediaInfo")],z1);const JZ=z1;var WB;let l2=WB=class extends Te{constructor(t){super(t),this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new WB({fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};u([p()],l2.prototype,"fieldName",void 0),u([p()],l2.prototype,"tooltip",void 0),u([p()],l2.prototype,"value",void 0),l2=WB=u([P("esri.popup.content.support.ChartMediaInfoValueSeries")],l2);const Zke=l2;var XB;let V1=XB=class extends ue{constructor(t){super(t),this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new XB({fields:ee(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};u([p({type:[String],json:{write:!0}})],V1.prototype,"fields",void 0),u([p({type:String,json:{write:!0}})],V1.prototype,"normalizeField",void 0),u([p({type:[Zke],json:{read:!1}})],V1.prototype,"series",void 0),u([p({type:String,json:{write:!0}})],V1.prototype,"tooltipField",void 0),V1=XB=u([P("esri.popup.content.support.ChartMediaInfoValue")],V1);const Jke=V1;let AA=class extends JZ{constructor(e){super(e),this.type=null,this.value=null}};u([p({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],AA.prototype,"type",void 0),u([p({type:Jke,json:{write:!0}})],AA.prototype,"value",void 0),AA=u([P("esri.popup.content.mixins.ChartMediaInfo")],AA);const a8=AA,l8=ll()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var YB;let qD=YB=class extends a8{constructor(t){super(t),this.type="bar-chart"}clone(){return new YB({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([p({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:l8.write}})],qD.prototype,"type",void 0),qD=YB=u([P("esri.popup.content.BarChartMediaInfo")],qD);const Sve=qD;var ZB;let WD=ZB=class extends a8{constructor(t){super(t),this.type="column-chart"}clone(){return new ZB({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([p({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:l8.write}})],WD.prototype,"type",void 0),WD=ZB=u([P("esri.popup.content.ColumnChartMediaInfo")],WD);const Eve=WD;var JB;let OA=JB=class extends ue{constructor(t){super(t),this.linkURL=null,this.sourceURL=null}clone(){return new JB({linkURL:this.linkURL,sourceURL:this.sourceURL})}};u([p({type:String,json:{write:!0}})],OA.prototype,"linkURL",void 0),u([p({type:String,json:{write:!0}})],OA.prototype,"sourceURL",void 0),OA=JB=u([P("esri.popup.content.support.ImageMediaInfoValue")],OA);const Qke=OA;var QB;let c2=QB=class extends JZ{constructor(t){super(t),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new QB({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};u([p({type:Number,json:{write:!0}})],c2.prototype,"refreshInterval",void 0),u([p({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],c2.prototype,"type",void 0),u([p({type:Qke,json:{write:!0}})],c2.prototype,"value",void 0),c2=QB=u([P("esri.popup.content.ImageMediaInfo")],c2);const Cve=c2;var KB;let XD=KB=class extends a8{constructor(t){super(t),this.type="line-chart"}clone(){return new KB({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([p({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:l8.write}})],XD.prototype,"type",void 0),XD=KB=u([P("esri.popup.content.LineChartMediaInfo")],XD);const Ave=XD;var eG;let YD=eG=class extends a8{constructor(t){super(t),this.type="pie-chart"}clone(){return new eG({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([p({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:l8.write}})],YD.prototype,"type",void 0),YD=eG=u([P("esri.popup.content.PieChartMediaInfo")],YD);const Ove=YD,Rve={base:JZ,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":Sve,"column-chart":Eve,"line-chart":Ave,"pie-chart":Ove,image:Cve}};var tG;let Ed=tG=class extends Ov{constructor(t){super(t),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(t){return t&&t.map(e=>e.type==="image"?Cve.fromJSON(e):e.type==="barchart"?Sve.fromJSON(e):e.type==="columnchart"?Eve.fromJSON(e):e.type==="linechart"?Ave.fromJSON(e):e.type==="piechart"?Ove.fromJSON(e):void 0).filter(Boolean)}writeMediaInfos(t,e){e.mediaInfos=t&&t.map(r=>r.toJSON())}clone(){return new tG(ee({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};u([p()],Ed.prototype,"activeMediaInfoIndex",void 0),u([p({type:Object,json:{write:!0}})],Ed.prototype,"attributes",void 0),u([p({type:String,json:{write:!0}})],Ed.prototype,"description",void 0),u([p({types:[Rve]})],Ed.prototype,"mediaInfos",void 0),u([Oe("mediaInfos")],Ed.prototype,"readMediaInfos",null),u([Be("mediaInfos")],Ed.prototype,"writeMediaInfos",null),u([p({type:String,json:{write:!0}})],Ed.prototype,"title",void 0),u([p({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],Ed.prototype,"type",void 0),Ed=tG=u([P("esri.popup.content.MediaContent")],Ed);const b5=Ed;var rG;let RA=rG=class extends ue{constructor(t){super(t),this.field=null,this.order=null}clone(){return new rG({field:this.field,order:this.order})}};u([p({type:String,json:{write:!0}})],RA.prototype,"field",void 0),u([p({type:["asc","desc"],json:{write:!0}})],RA.prototype,"order",void 0),RA=rG=u([P("esri.popup.support.RelatedRecordsInfoFieldOrder")],RA);const QZ=RA;let pf=class extends Hi(Ov){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};u([p({type:String,json:{write:!0}})],pf.prototype,"description",void 0),u([p({type:Number,json:{type:Ki,write:!0}})],pf.prototype,"displayCount",void 0),u([p({type:["list"],json:{write:!0}})],pf.prototype,"displayType",void 0),u([p({type:[QZ],json:{write:!0}})],pf.prototype,"orderByFields",void 0),u([p({type:Number,json:{type:Ki,write:!0}})],pf.prototype,"relationshipId",void 0),u([p({type:String,json:{write:!0}})],pf.prototype,"title",void 0),u([p({type:["relationship"],readOnly:!0,json:{read:!1,write:!0}})],pf.prototype,"type",void 0),pf=u([P("esri.popup.content.RelationshipContent")],pf);const w5=pf;var iG;let MA=iG=class extends Ov{constructor(t){super(t),this.text=null,this.type="text"}clone(){return new iG({text:this.text})}};u([p({type:String,json:{write:!0}})],MA.prototype,"text",void 0),u([p({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],MA.prototype,"type",void 0),MA=iG=u([P("esri.popup.content.TextContent")],MA);const x5=MA,Kke={base:null,key:"type",typeMap:{attachment:uM,media:b5,text:x5,expression:VZ,field:hM,relationship:w5}};var sG;let B1=sG=class extends ue{constructor(t){super(t),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new sG({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([p({type:String,json:{write:!0}})],B1.prototype,"name",void 0),u([p({type:String,json:{write:!0}})],B1.prototype,"title",void 0),u([p({type:String,json:{write:!0}})],B1.prototype,"expression",void 0),u([p({type:["string","number"],json:{write:!0}})],B1.prototype,"returnType",void 0),B1=sG=u([P("esri.popup.ExpressionInfo")],B1);const eze=B1;var nG;let PA=nG=class extends ue{constructor(t){super(t),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new nG({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};u([p({type:Boolean,json:{write:!0}})],PA.prototype,"returnTopmostRaster",void 0),u([p({type:Boolean,json:{write:!0}})],PA.prototype,"showNoDataRecords",void 0),PA=nG=u([P("esri.popup.LayerOptions")],PA);const tze=PA;var oG;let IA=oG=class extends ue{constructor(t){super(t),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new oG({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?ee(this.orderByFields):null})}};u([p({type:Boolean,json:{write:!0}})],IA.prototype,"showRelatedRecords",void 0),u([p({type:[QZ],json:{write:!0}})],IA.prototype,"orderByFields",void 0),IA=oG=u([P("esri.popup.RelatedRecordsInfo")],IA);const rze=IA;var aG;let sh=aG=class extends t8(Te){constructor(t){super(t),this.active=!1,this.className=null,this.disabled=!1,this.icon=null,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new aG({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};u([p()],sh.prototype,"active",void 0),u([p()],sh.prototype,"className",void 0),u([p()],sh.prototype,"disabled",void 0),u([p()],sh.prototype,"icon",void 0),u([p()],sh.prototype,"id",void 0),u([p()],sh.prototype,"indicator",void 0),u([p()],sh.prototype,"title",void 0),u([p()],sh.prototype,"type",void 0),u([p()],sh.prototype,"visible",void 0),sh=aG=u([P("esri.support.actions.ActionBase")],sh);const KZ=sh;var lG;let ZD=lG=class extends KZ{constructor(t){super(t),this.image=null,this.type="button"}clone(){return new lG({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};u([p()],ZD.prototype,"image",void 0),ZD=lG=u([P("esri.support.Action.ActionButton")],ZD);const cG=ZD;var uG;let $A=uG=class extends KZ{constructor(t){super(t),this.image=null,this.type="toggle",this.value=!1}clone(){return new uG({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};u([p()],$A.prototype,"image",void 0),u([p()],$A.prototype,"value",void 0),$A=uG=u([P("esri.support.Action.ActionToggle")],$A);const ize=$A,sze="esri.PopupTemplate",nze=K.getLogger(sze),a3="relationships/",Aie="expression/",oze=Pt.ofType({key:"type",defaultKeyValue:"button",base:KZ,typeMap:{button:cG,toggle:ize}}),aze={base:Ov,key:"type",typeMap:{media:b5,custom:U9e,text:x5,attachments:uM,fields:hM,expression:VZ,relationship:w5}},lze=["attachments","fields","media","text","expression","relationship"];let ho=class extends Hi(ue){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map(r=>Ap(aze,r)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||ku(e)?e:(nze.error("content error","unsupported content value",{value:e}),null)}readContent(e,r){const{popupElements:i}=r;return Array.isArray(i)&&i.length>0?this._readPopupInfoElements(r.description,r.mediaInfos,i):this._readPopupInfo(r)}writeContent(e,r,i,s){typeof e!="string"?Array.isArray(e)&&(r.popupElements=e.filter(n=>lze.includes(n.type)).map(n=>n&&n.toJSON(s)),r.popupElements.forEach(n=>{n.type==="attachments"?this._writeAttachmentContent(r):n.type==="media"?this._writeMediaContent(n,r):n.type==="text"?this._writeTextContent(n,r):n.type==="relationship"&&this._writeRelationshipContent(n,r)})):r.description=e}writeFieldInfos(e,r,i,s){const{content:n}=this,o=Array.isArray(n)?n:null;if(e){const a=o?o.filter(c=>c.type==="fields"):[],l=a.length&&a.every(c=>c.fieldInfos?.length);r.fieldInfos=e.filter(Boolean).map(c=>{const h=c.toJSON(s);return l&&(h.visible=!1),h})}if(o)for(const a of o)a.type==="fields"&&this._writeFieldsContent(a,r)}writeLayerOptions(e,r,i,s){r[i]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(s)}writeTitle(e,r){r.title=e||""}async collectRequiredFields(e,r){const i=this.expressionInfos||[];await this._collectExpressionInfoFields(e,r,[...i,...this._getContentExpressionInfos(this.content,i)]),cM(e,r,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const r=new Set;return await this.collectRequiredFields(r,e),[...r].sort()}_writeFieldsContent(e,r){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const i=ee(e.fieldInfos);Array.isArray(r.fieldInfos)?i.forEach(s=>{const n=r.fieldInfos.find(o=>o.fieldName.toLowerCase()===s.fieldName.toLowerCase());n?n.visible=!0:r.fieldInfos.push(s)}):r.fieldInfos=i}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,r){const i=e.orderByFields?.map(n=>this._toFieldOrderJSON(n,e.relationshipId))||[],s=[...r.relatedRecordsInfo?.orderByFields||[],...i];r.relatedRecordsInfo={showRelatedRecords:!0,...s?.length&&{orderByFields:s}}}_writeTextContent(e,r){!r.description&&e.text&&(r.description=e.text)}_writeMediaContent(e,r){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const i=ee(e.mediaInfos);Array.isArray(r.mediaInfos)?r.mediaInfos=[...r.mediaInfos,...i]:r.mediaInfos=i}_readPopupInfoElements(e,r,i){const s={description:!1,mediaInfos:!1};return i.map(n=>n.type==="media"?(n.mediaInfos||!r||s.mediaInfos||(n.mediaInfos=r,s.mediaInfos=!0),b5.fromJSON(n)):n.type==="text"?(n.text||!e||s.description||(n.text=e,s.description=!0),x5.fromJSON(n)):n.type==="attachments"?uM.fromJSON(n):n.type==="fields"?hM.fromJSON(n):n.type==="expression"?VZ.fromJSON(n):n.type==="relationship"?w5.fromJSON(n):void 0).filter(Boolean)}_toRelationshipContent(e){const{field:r,order:i}=e;if(!r?.startsWith(a3))return null;const s=r.replace(a3,"").split("/");if(s.length!==2)return null;const n=parseInt(s[0],10),o=s[1];return typeof n=="number"&&o?w5.fromJSON({relationshipId:n,orderByFields:[{field:o,order:i}]}):null}_toFieldOrderJSON(e,r){const{order:i,field:s}=e;return{field:`${a3}${r}/${s}`,order:i}}_readPopupInfo({description:e,mediaInfos:r,showAttachments:i,relatedRecordsInfo:s={showRelatedRecords:!1}}){const n=[];e?n.push(new x5({text:e})):n.push(new hM),Array.isArray(r)&&r.length&&n.push(b5.fromJSON({mediaInfos:r})),i&&n.push(uM.fromJSON({displayType:"auto"}));const{showRelatedRecords:o,orderByFields:a}=s;return o&&a?.length&&a.forEach(l=>{const c=this._toRelationshipContent(l);c&&n.push(c)}),n.length?n:e}_getContentElementFields(e){const r=e?.type;if(r==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(r==="custom")return e.outFields||[];if(r==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos??this.fieldInfos)];if(r==="media"){const i=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...i.reduce((s,n)=>[...s,...this._getMediaInfoFields(n)],[])]}return r==="text"?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:r,title:i,value:s}=e,n=s||{},{fields:o,normalizeField:a,tooltipField:l,sourceURL:c,linkURL:h}=n,d=[...this._extractFieldNames(i),...this._extractFieldNames(r),...this._extractFieldNames(c),...this._extractFieldNames(h),...o??[]];return a&&d.push(a),l&&d.push(l),d}_getContentExpressionInfos(e,r){return Array.isArray(e)?e.reduce((i,s)=>[...i,...s.type==="expression"&&s.expressionInfo?[s.expressionInfo]:[]],r):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((r,i)=>[...r,...this._getContentElementFields(i)],[]):[]}async _collectExpressionInfoFields(e,r,i){i&&await Promise.all(i.map(s=>Vl(e,r,s.expression)))}_getFieldInfoFields(e){return e?e.filter(r=>r.visible===void 0||!!r.visible).map(r=>r.fieldName).filter(r=>!r.startsWith(a3)&&!r.startsWith(Aie)):[]}_getActionsFields(e){return e?e.toArray().reduce((r,i)=>[...r,...this._getActionFields(i)],[]):[]}_getActionFields(e){const{className:r,title:i,type:s}=e,n=s==="button"||s==="toggle"?e.image:"";return[...this._extractFieldNames(i),...this._extractFieldNames(r),...this._extractFieldNames(n)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){if(!e||typeof e!="string")return[];const r=/{[^}]*}/g,i=e.match(r);if(!i)return[];const s=/\{(\w+):.+\}/,n=i.filter(o=>!(o.indexOf(`{${a3}`)===0||o.indexOf(`{${Aie}`)===0)).map(o=>o.replace(s,"{$1}"));return n?n.map(o=>o.slice(1,-1)):[]}};u([p({type:oze})],ho.prototype,"actions",void 0),u([p()],ho.prototype,"content",void 0),u([wr("content")],ho.prototype,"castContent",null),u([Oe("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],ho.prototype,"readContent",null),u([Be("content",{popupElements:{type:Pt.ofType(Kke)},showAttachments:{type:Boolean},mediaInfos:{type:Pt.ofType(Rve)},description:{type:String},relatedRecordsInfo:{type:rze}})],ho.prototype,"writeContent",null),u([p({type:[eze],json:{write:!0}})],ho.prototype,"expressionInfos",void 0),u([p({type:[ZZ]})],ho.prototype,"fieldInfos",void 0),u([Be("fieldInfos")],ho.prototype,"writeFieldInfos",null),u([p({type:tze})],ho.prototype,"layerOptions",void 0),u([Be("layerOptions")],ho.prototype,"writeLayerOptions",null),u([p({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],ho.prototype,"lastEditInfoEnabled",void 0),u([p()],ho.prototype,"outFields",void 0),u([p()],ho.prototype,"overwriteActions",void 0),u([p()],ho.prototype,"returnGeometry",void 0),u([p({json:{type:String}})],ho.prototype,"title",void 0),u([Be("title")],ho.prototype,"writeTitle",null),ho=u([P("esri.PopupTemplate")],ho);const Rv=ho,Oie=new $r({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let cze=0,u2=class extends ue{constructor(e){super(e),this.id="sym"+cze++,this.type=null,this.color=new ke([0,0,0,1])}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,r){}hash(){return JSON.stringify(this.toJSON())}clone(){}};u([p({type:Oie.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:Oie.write}}})],u2.prototype,"type",void 0),u([p({type:ke,json:{write:{allowNull:!0}}})],u2.prototype,"color",void 0),u([Oe("color")],u2.prototype,"readColor",null),u2=u([P("esri.symbols.Symbol")],u2);const Vc=u2;var hG;let Dy=hG=class extends Vc{constructor(t){super(t),this.data=null,this.type="cim"}readData(t,e){return e}writeData(t,e){Object.assign(e,t)}async collectRequiredFields(t,e){if(this.data?.type==="CIMSymbolReference"){const r=this.data.primitiveOverrides;if(r){const i=r.map(s=>{const n=s.valueExpressionInfo;return Vl(t,e,n.expression)});await Promise.all(i)}}}clone(){return new hG({data:ee(this.data)})}hash(){return OY(JSON.stringify(this.data)).toString()}};u([p({json:{write:!1}})],Dy.prototype,"color",void 0),u([p({json:{write:!0}})],Dy.prototype,"data",void 0),u([Oe("data",["symbol"])],Dy.prototype,"readData",null),u([Be("data",{})],Dy.prototype,"writeData",null),u([nt({CIMSymbolReference:"cim"},{readOnly:!0})],Dy.prototype,"type",void 0),Dy=hG=u([P("esri.symbols.CIMSymbol")],Dy);const CC=Dy;let h2=class extends ue{constructor(e){super(e),this.enabled=!0,this.type=null,this.ignoreDrivers=!1}writeEnabled(e,r,i){e||(r[i]=e)}};u([p({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],h2.prototype,"enabled",void 0),u([Be("enabled")],h2.prototype,"writeEnabled",null),u([p({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],h2.prototype,"type",void 0),h2=u([P("esri.symbols.Symbol3DLayer")],h2);const Mm=h2,uze=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,hze="screenUtils.toPt: input not recognized!",Mve=96;function wo(t){return t?t/72*Mve:0}function Wh(t){return t?72*t/Mve:0}function ei(t){if(typeof t=="string"){const e=t.match(uze);if(e){const r=Number(e[1]),i=e[3]&&e[3].toLowerCase(),s=t.charAt(0)==="-",n=i==="px"?Wh(r):r;return s?-n:n}return console.warn(hze),null}return t}function Xh(t=0,e=0){return{x:t,y:e}}function Qi(t=0,e=0){return[t,e]}function Pve(t=0,e=0){return[t,e]}function Wo(t=0,e=0,r=0){return[t,e,r]}function f5t(t){return t}function m5t(t){return t}function g5t(t){return t}function Uf(t,e){return e?(e[0]=t.x,e[1]=t.y,e.length>2&&(e[2]=0),e):[t.x,t.y]}function dze(t,e){const r=e.transparency!=null?gE(e.transparency):1,i=e.color;return i&&Array.isArray(i)?new ke([i[0]||0,i[1]||0,i[2]||0,r]):null}function pze(t,e){e.color=t.toJSON().slice(0,3);const r=Z6(t.a);r!==0&&(e.transparency=r)}const R0={type:ke,json:{type:[Ki],default:null,read:{source:["color","transparency"],reader:dze},write:{target:{color:{type:[Ki]},transparency:{type:Ki}},writer:pze}}},fm={type:Number,cast:ei,json:{write:!0}};let G1=class extends ue{constructor(e){super(e),this.color=new ke([0,0,0,1]),this.extensionLength=0,this.size=Wh(1)}clone(){}cloneProperties(){return{color:ee(this.color),size:this.size,extensionLength:this.extensionLength}}};u([p({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],G1.prototype,"type",void 0),u([p(R0)],G1.prototype,"color",void 0),u([p({...fm,json:{write:{overridePolicy:t=>({enabled:!!t})}}})],G1.prototype,"extensionLength",void 0),u([p(fm)],G1.prototype,"size",void 0),G1=u([P("esri.symbols.edges.Edges3D")],G1);const eJ=G1;var dG;let JD=dG=class extends eJ{constructor(t){super(t),this.type="sketch"}clone(){return new dG(this.cloneProperties())}};u([nt({sketch:"sketch"},{readOnly:!0})],JD.prototype,"type",void 0),JD=dG=u([P("esri.symbols.edges.SketchEdges3D")],JD);const fze=JD;var pG;let QD=pG=class extends eJ{constructor(t){super(t),this.type="solid"}clone(){return new pG(this.cloneProperties())}};u([nt({solid:"solid"},{readOnly:!0})],QD.prototype,"type",void 0),QD=pG=u([P("esri.symbols.support.SolidEdges3D")],QD);const Ive=QD,$ve={types:{key:"type",base:eJ,typeMap:{solid:Ive,sketch:fze}},json:{write:!0}};var fG;let Au=fG=class extends ue{constructor(t){super(t),this.color=null}clone(){const t={color:this.color!=null?this.color.clone():null};return new fG(t)}};u([p(R0)],Au.prototype,"color",void 0),Au=fG=u([P("esri.symbols.support.Symbol3DMaterial")],Au);var mG;let Ny=mG=class extends Mm{constructor(t){super(t),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new mG({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};u([nt({Extrude:"extrude"},{readOnly:!0})],Ny.prototype,"type",void 0),u([p({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],Ny.prototype,"size",void 0),u([p({type:Au,json:{write:!0}})],Ny.prototype,"material",void 0),u([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Ny.prototype,"castShadows",void 0),u([p($ve)],Ny.prototype,"edges",void 0),Ny=mG=u([P("esri.symbols.ExtrudeSymbol3DLayer")],Ny);const Lve=Ny;let LA=class extends Vc{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};u([nt({esriSLS:"simple-line"},{readOnly:!0})],LA.prototype,"type",void 0),u([p({type:Number,cast:ei,json:{write:!0}})],LA.prototype,"width",void 0),LA=u([P("esri.symbols.LineSymbol")],LA);const mze=LA,gze=["begin","end","begin-end"],Dve=["arrow","circle","square","diamond","cross","x"];var gG;let ff=gG=class extends ue{constructor(t){super(t),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(t,e,r,i){e[r]=i?.origin==="web-map"?"arrow":t}set color(t){this._set("color",t)}readColor(t){return t&&t[0]!=null?[t[0],t[1],t[2],t[3]/255]:t}writeColor(t,e,r,i){i?.origin==="web-map"||(e[r]=t)}clone(){return new gG({color:ee(this.color),placement:this.placement,style:this.style})}hash(){return`${this.placement}.${this.color?.hash()}.${this.style}`}};u([p({type:["begin","end","begin-end"],json:{write:!0}})],ff.prototype,"placement",void 0),u([nt({"line-marker":"line-marker"},{readOnly:!0}),p({json:{origins:{"web-map":{write:!1}}}})],ff.prototype,"type",void 0),u([p({type:Dve})],ff.prototype,"style",void 0),u([Be("style")],ff.prototype,"writeStyle",null),u([p({type:ke,value:null,json:{write:{allowNull:!0}}})],ff.prototype,"color",null),u([Oe("color")],ff.prototype,"readColor",null),u([Be("color")],ff.prototype,"writeColor",null),ff=gG=u([P("esri.symbols.LineSymbolMarker")],ff);const yze=ff;var yG;const BU=new $r({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let dg=yG=class extends mze{constructor(...t){super(...t),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(t,e,r,i,s,n){if(t&&typeof t!="string")return t;const o={};return t!=null&&(o.style=t),e!=null&&(o.color=e),r!=null&&(o.width=ei(r)),i!=null&&(o.cap=i),s!=null&&(o.join=s),n!=null&&(o.miterLimit=ei(n)),o}clone(){return new yG({color:ee(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:this.marker?.clone()})}hash(){return`${super.hash()}.${this.color?.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${this.marker?.hash()}`}};u([nt({esriSLS:"simple-line"},{readOnly:!0})],dg.prototype,"type",void 0),u([p({type:BU.apiValues,json:{read:BU.read,write:BU.write}})],dg.prototype,"style",void 0),u([p({type:["butt","round","square"],json:{write:{overridePolicy:(t,e,r)=>({enabled:t!=="round"&&(r==null||r.origin==null)})}}})],dg.prototype,"cap",void 0),u([p({type:["miter","round","bevel"],json:{write:{overridePolicy:(t,e,r)=>({enabled:t!=="round"&&(r==null||r.origin==null)})}}})],dg.prototype,"join",void 0),u([p({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":yze}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],dg.prototype,"marker",void 0),u([p({type:Number,json:{read:!1,write:!1}})],dg.prototype,"miterLimit",void 0),dg=yG=u([P("esri.symbols.SimpleLineSymbol")],dg);const zu=dg;let DA=class extends Vc{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};u([p({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":zu}},json:{default:null,write:!0}})],DA.prototype,"outline",void 0),u([p({type:["simple-fill","picture-fill"],readOnly:!0})],DA.prototype,"type",void 0),DA=u([P("esri.symbols.FillSymbol")],DA);const Nve=DA;let KD=class extends ue{constructor(e){super(e)}clone(){}};u([p({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],KD.prototype,"type",void 0),KD=u([P("esri.symbols.patterns.LinePattern3D")],KD);const Fve=KD,_ze=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var _G;const vze=ll()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let NA=_G=class extends Fve{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new _G(t)}};u([p({type:["style"]})],NA.prototype,"type",void 0),u([nt(vze),p({type:_ze})],NA.prototype,"style",void 0),NA=_G=u([P("esri.symbols.patterns.LineStylePattern3D")],NA);const tJ=NA;let eN=class extends ue{constructor(e){super(e)}clone(){}};u([p({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],eN.prototype,"type",void 0),eN=u([P("esri.symbols.patterns.Pattern3D")],eN);const Uve=eN,bze=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var vG;let FA=vG=class extends Uve{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new vG(t)}};u([p({type:["style"]})],FA.prototype,"type",void 0),u([p({type:bze,json:{read:!0,write:!0}})],FA.prototype,"style",void 0),FA=vG=u([P("esri.symbols.patterns.StylePattern3D")],FA);const kve=FA,wze={types:{key:"type",base:Uve,typeMap:{style:kve}},json:{write:!0}},zve={types:{key:"type",base:Fve,typeMap:{style:tJ}},json:{write:!0}},uR=new ke("white");new ke("black");const xze=new ke([255,255,255,0]);function Tze(t){return t.r===0&&t.g===0&&t.b===0}var bG;let hR=bG=class extends Au{constructor(t){super(t),this.colorMixMode=null}clone(){const t={color:this.color!=null?this.color.clone():null,colorMixMode:this.colorMixMode};return new bG(t)}};u([nt({multiply:"multiply",replace:"replace",tint:"tint"})],hR.prototype,"colorMixMode",void 0),hR=bG=u([P("esri.symbols.support.Symbol3DFillMaterial")],hR);function gn(t=Hve){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function zw(t,e,r,i,s,n,o=gn()){return o[0]=t,o[1]=e,o[2]=r,o[3]=i,o[4]=s,o[5]=n,o}function x5t(t,e){const r=isFinite(t[2])||isFinite(t[5]);return new cr(r?{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],zmin:t[2],zmax:t[5],spatialReference:e}:{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],spatialReference:e})}function xE(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[3]),t[4]=Math.max(t[4],e[4]),t[5]=Math.max(t[5],e[5])}function Sze(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[3]=Math.max(t[3],e[2]),t[4]=Math.max(t[4],e[3])}function mm(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[0]),t[4]=Math.max(t[4],e[1]),t[5]=Math.max(t[5],e[2])}function Tu(t,e,r=0,i=e.length/3){let s=t[0],n=t[1],o=t[2],a=t[3],l=t[4],c=t[5];for(let h=0;h<i;h++)s=Math.min(s,e[r+3*h]),n=Math.min(n,e[r+3*h+1]),o=Math.min(o,e[r+3*h+2]),a=Math.max(a,e[r+3*h]),l=Math.max(l,e[r+3*h+1]),c=Math.max(c,e[r+3*h+2]);t[0]=s,t[1]=n,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function GU(t,e,r){const i=e.length;let s=t[0],n=t[1],o=t[2],a=t[3],l=t[4],c=t[5];if(r)for(let h=0;h<i;h++){const d=e[h];s=Math.min(s,d[0]),n=Math.min(n,d[1]),o=Math.min(o,d[2]),a=Math.max(a,d[0]),l=Math.max(l,d[1]),c=Math.max(c,d[2])}else for(let h=0;h<i;h++){const d=e[h];s=Math.min(s,d[0]),n=Math.min(n,d[1]),a=Math.max(a,d[0]),l=Math.max(l,d[1])}t[0]=s,t[1]=n,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function Eze(t){for(let e=0;e<6;e++)if(!isFinite(t[e]))return!1;return!0}function Tx(t){return t[0]>=t[3]?0:t[3]-t[0]}function Sx(t){return t[1]>=t[4]?0:t[4]-t[1]}function Mv(t){return t[2]>=t[5]?0:t[5]-t[2]}function Vve(t){const e=Tx(t),r=Mv(t),i=Sx(t);return Math.sqrt(e*e+r*r+i*i)}function hp(t,e=[0,0,0]){return e[0]=t[0]+Tx(t)/2,e[1]=t[1]+Sx(t)/2,e[2]=t[2]+Mv(t)/2,e}function PI(t,e=[0,0,0]){return e[0]=Tx(t),e[1]=Sx(t),e[2]=Mv(t),e}function rJ(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[0]<=t[3]&&e[1]<=t[4]&&e[2]<=t[5]}function T5t(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[3]<=t[3]&&e[4]<=t[4]&&e[5]<=t[5]}function Cze(t,e){return Math.max(e[0],t[0])<=Math.min(e[3],t[3])&&Math.max(e[1],t[1])<=Math.min(e[4],t[4])&&Math.max(e[2],t[2])<=Math.min(e[5],t[5])}function dp(t,e){return e==null||Cze(t,e)}function Bve(t,e,r,i,s=t){return s[0]=t[0]+e,s[1]=t[1]+r,s[2]=t[2]+i,s[3]=t[3]+e,s[4]=t[4]+r,s[5]=t[5]+i,s}function S5t(t,e,r=t){const i=t[0]+Tx(t)/2,s=t[1]+Sx(t)/2,n=t[2]+Mv(t)/2;return r[0]=i+(t[0]-i)*e,r[1]=s+(t[1]-s)*e,r[2]=n+(t[2]-n)*e,r[3]=i+(t[3]-i)*e,r[4]=s+(t[4]-s)*e,r[5]=n+(t[5]-n)*e,r}function Gve(t,e,r=t){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r!==t&&(r[3]=t[3],r[4]=t[4],r[5]=t[5]),r}function jve(t,e,r=t){return r[3]=e[0],r[4]=e[1],r[5]=e[2],r!==t&&(r[0]=t[0],r[1]=t[1],r[2]=t[2]),t}function c8(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Ei(t){return t?c8(t,Rie):gn(Rie)}function iJ(t,e){return e||(e=zt()),e[0]=t[0],e[1]=t[1],e[2]=t[3],e[3]=t[4],e}function E5t(t,e){return t[0]=e[0],t[1]=e[1],t[2]=Number.NEGATIVE_INFINITY,t[3]=e[2],t[4]=e[3],t[5]=Number.POSITIVE_INFINITY,t}function Aze(t,e,r,i,s){return t[0]=e,t[1]=r,t[2]=Number.NEGATIVE_INFINITY,t[3]=i,t[4]=s,t[5]=Number.POSITIVE_INFINITY,t}function wG(t){return t.length===6}function sJ(t){return Tx(t)===0&&Sx(t)===0&&Mv(t)===0}function C5t(t,e,r){if(t==null||e==null)return t===e;if(!wG(t)||!wG(e))return!1;if(r){for(let i=0;i<t.length;i++)if(!r(t[i],e[i]))return!1}else for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function Oze(t,e,r,i,s,n){return zw(t,e,r,i,s,n,Rze)}const A5t=[-1/0,-1/0,-1/0,1/0,1/0,1/0],Rie=[1/0,1/0,1/0,-1/0,-1/0,-1/0],Hve=[0,0,0,0,0,0],Rze=gn();function jU(t,{isPrimitive:e,width:r,depth:i,height:s}){const n=e?10:1;if(r==null&&s==null&&i==null)return[n*t[0],n*t[1],n*t[2]];const o=Pe(r,i,s);let a;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/t[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=t[l]*a);return o}const Mze=zw(-.5,-.5,-.5,.5,.5,.5),Pze=zw(-.5,-.5,0,.5,.5,1),Ize=zw(-.5,-.5,0,.5,.5,.5);function $ze(t){switch(t){case"sphere":case"cube":case"diamond":return Mze;case"cylinder":case"cone":case"inverted-cone":return Pze;case"tetrahedron":return Ize;default:return}}const nJ=["butt","square","round"],Lze=[...nJ,"none"],qve=["miter","bevel","round"];var xG;let j1=xG=class extends ue{constructor(t){super(t),this.color=new ke([0,0,0,1]),this.size=Wh(1),this.pattern=null,this.patternCap="butt"}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size,pattern:this.pattern!=null?this.pattern.clone():null,patternCap:this.patternCap};return new xG(t)}};u([p(R0)],j1.prototype,"color",void 0),u([p(fm)],j1.prototype,"size",void 0),u([p(zve)],j1.prototype,"pattern",void 0),u([p({type:nJ,json:{default:"butt",write:{overridePolicy(){return{enabled:this.pattern!=null}}}}})],j1.prototype,"patternCap",void 0),j1=xG=u([P("esri.symbols.support.Symbol3DOutline")],j1);var tN;let pg=tN=class extends Mm{constructor(t){super(t),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const t={edges:this.edges!=null?this.edges.clone():null,enabled:this.enabled,material:this.material!=null?this.material.clone():null,pattern:this.pattern!=null?this.pattern.clone():null,castShadows:this.castShadows,outline:this.outline!=null?this.outline.clone():null};return new tN(t)}static fromSimpleFillSymbol(t){const e=t.outline&&t.outline.style&&t.outline.style!=="inside-frame"&&t.outline.style!=="solid"?new tJ({style:t.outline.style}):null,r={size:t.outline?.width??0,color:(t.outline?.color??uR).clone(),pattern:e};return e&&t.outline?.cap&&(r.patternCap=t.outline.cap),new tN({material:new hR({color:(t.color??xze).clone()}),pattern:t.style&&t.style!=="solid"?new kve({style:t.style}):null,outline:r})}};u([nt({Fill:"fill"},{readOnly:!0})],pg.prototype,"type",void 0),u([p({type:hR,json:{write:!0}})],pg.prototype,"material",void 0),u([p(wze)],pg.prototype,"pattern",void 0),u([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],pg.prototype,"castShadows",void 0),u([p({type:j1,json:{write:!0}})],pg.prototype,"outline",void 0),u([p($ve)],pg.prototype,"edges",void 0),pg=tN=u([P("esri.symbols.FillSymbol3DLayer")],pg);const Vw=pg,Dze=["none","underline","line-through"],Nze=["normal","italic","oblique"],Fze=["normal","lighter","bold","bolder"],Wve={type:Number,cast:t=>{const e=Eh(t);return e===0?1:ve(e,.1,4)},nonNullable:!0},Uze=["left","right","center"],kze=["baseline","top","middle","bottom"],Xve={type:Uze,nonNullable:!0},Yve={type:kze,nonNullable:!0},O5t=8;var TG;let fg=TG=class extends ue{constructor(t){super(t),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(t){return ei(t)}clone(){return new TG({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};u([p({type:Dze,json:{default:"none",write:!0}})],fg.prototype,"decoration",void 0),u([p({type:String,json:{write:!0}})],fg.prototype,"family",void 0),u([p({type:Number,json:{write:{overridePolicy:(t,e,r)=>({enabled:!r||!r.textSymbol3D})}}})],fg.prototype,"size",void 0),u([wr("size")],fg.prototype,"castSize",null),u([p({type:Nze,json:{default:"normal",write:!0}})],fg.prototype,"style",void 0),u([p({type:Fze,json:{default:"normal",write:!0}})],fg.prototype,"weight",void 0),fg=TG=u([P("esri.symbols.Font")],fg);const u8=fg;function _0(t,e){const r=e&&e.url&&e.url.path;if(t&&r&&(t=_u(t,r,{preserveProtocolRelative:!0}),e.portalItem&&e.readResourcePaths)){const i=XY(t,e.portalItem.itemUrl);i!=null&&zze.test(i)&&e.readResourcePaths.push(e.portalItem.resourceFromPath(i).path)}return SG(t,e&&e.portal)}function v0(t,e,r=TE.YES){if(t==null)return t;!$c(t)&&e&&e.blockedRelativeUrls&&e.blockedRelativeUrls.push(t);let i=_u(t);if(e){const s=e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.rootPath||e.url&&e.url.path;if(s){const n=SG(s,e.portal),o=SG(i,e.portal);i=XY(o,n,n),i!=null&&i!==o&&i!==t&&e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.writtenUrls.push(i)}}return i=Kve(i,e?.portal),$c(i)&&(i=_p(i)),e?.resources&&e?.portalItem&&!$c(i)&&!Am(i)&&r===TE.YES&&e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(i),compress:!1}),i}function h8(t,e,r){return _0(t,r)}function uv(t,e,r,i){const s=v0(t,i);s!==void 0&&(e[r]=s)}const Zve=/\/items\/([^\/]+)\/resources\/(.*)/,zze=/^\.\/resources\//;function Jve(t){return(t?.match(Zve)??null)?.[1]??null}function Qve(t){const e=t?.match(Zve)??null;if(e==null)return null;const r=e[2],i=r.lastIndexOf("/");if(i===-1){const{path:o,extension:a}=vre(r);return{prefix:null,filename:o,extension:a}}const{path:s,extension:n}=vre(r.slice(i+1));return{prefix:r.slice(0,i),filename:s,extension:n}}function Kve(t,e){return e&&!e.isPortal&&e.urlKey&&e.customBaseUrl?cB(t,`${e.urlKey}.${e.customBaseUrl}`,e.portalHostname):t}function SG(t,e){if(!e||e.isPortal||!e.urlKey||!e.customBaseUrl)return t;const r=`${e.urlKey}.${e.customBaseUrl}`,i=jY();return pE(i,`${i.scheme}://${r}`)?cB(t,e.portalHostname,r):cB(t,r,e.portalHostname)}var TE;(function(t){t[t.YES=0]="YES",t[t.NO=1]="NO"})(TE||(TE={}));const Vze=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return TE},ensureMainOnlineDomain:Kve,fromJSON:_0,itemIdFromResourceUrl:Jve,prefixAndFilenameFromResourceUrl:Qve,read:h8,toJSON:v0,write:uv},Symbol.toStringTag,{value:"Module"}));var EG;const Bze=ll()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let H1=EG=class extends ue{constructor(t){super(t)}readHref(t,e,r){return t?_0(t,r):e.dataURI}writeHref(t,e,r,i){t&&(Am(t)?e.dataURI=t:(e.href=v0(t,i),$c(e.href)&&(e.href=_p(e.href))))}clone(){return new EG({href:this.href,primitive:this.primitive})}};u([p({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],H1.prototype,"href",void 0),u([Oe("href")],H1.prototype,"readHref",null),u([Be("href",{href:{type:String},dataURI:{type:String}})],H1.prototype,"writeHref",null),u([nt(Bze)],H1.prototype,"primitive",void 0),H1=EG=u([P("esri.symbols.support.IconSymbol3DLayerResource")],H1);const Gze="circle";var CG;let oS=CG=class extends Te{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new CG({x:this.x,y:this.y})}};u([p({type:Number})],oS.prototype,"x",void 0),u([p({type:Number})],oS.prototype,"y",void 0),oS=CG=u([P("esri.symbols.support.Symbol3DAnchorPosition2D")],oS);var AG;let UA=AG=class extends ue{constructor(t){super(t),this.color=new ke([0,0,0,1]),this.size=Wh(1)}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size};return new AG(t)}};u([p(R0)],UA.prototype,"color",void 0),u([p(fm)],UA.prototype,"size",void 0),UA=AG=u([P("esri.symbols.support.Symbol3DIconOutline")],UA);var d2;const e1e="esri.symbols.IconSymbol3DLayer";let mf=d2=class extends Mm{constructor(t){super(t),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null}clone(){return new d2({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:this.material!=null?this.material.clone():null,outline:this.outline!=null?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(t){const e=t.color||uR,r=Mie(t),i=t.outline&&t.outline.width>0?{size:t.outline.width,color:(t.outline.color||uR).clone()}:null;return new d2({size:t.size,resource:{primitive:Hze(t.style)},material:{color:e},outline:i,anchor:r?"relative":void 0,anchorPosition:r})}static fromPictureMarkerSymbol(t){const e=!t.color||Tze(t.color)?uR:t.color,r=Mie(t);return new d2({size:t.width<=t.height?t.height:t.width,resource:{href:t.url},material:{color:e.clone()},anchor:r?"relative":void 0,anchorPosition:r})}static fromCIMSymbol(t){return new d2({resource:{href:F0e({mediaType:"application/json",data:JSON.stringify(t.data)})}})}};function Mie(t){const e="width"in t?t.width:t.size,r="height"in t?t.height:t.size,i=Pie(t.xoffset),s=Pie(t.yoffset);return(i||s)&&e&&r?{x:-i/e,y:s/r}:null}function Pie(t){return isFinite(t)?t:0}u([p({type:Au,json:{write:!0}})],mf.prototype,"material",void 0),u([p({type:H1,json:{write:!0}})],mf.prototype,"resource",void 0),u([nt({Icon:"icon"},{readOnly:!0})],mf.prototype,"type",void 0),u([p(fm)],mf.prototype,"size",void 0),u([nt({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),p({json:{default:"center"}})],mf.prototype,"anchor",void 0),u([p({type:oS,json:{type:[Number],read:{reader:t=>new oS({x:t[0],y:t[1]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],mf.prototype,"anchorPosition",void 0),u([p({type:UA,json:{write:!0}})],mf.prototype,"outline",void 0),mf=d2=u([P(e1e)],mf);const jze={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function Hze(t){return jze[t]||(K.getLogger(e1e).warn(`${t} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const Hf=mf;let q1=class extends Hi(ue){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return e!=null&&e.placement===this.placement&&e.style===this.style&&(this.color==null&&e.color==null||this.color!=null&&e.color!=null&&this.color.toJSON()===e.color.toJSON())}};u([p({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],q1.prototype,"type",void 0),u([p({type:gze,json:{default:"begin-end",write:!0}})],q1.prototype,"placement",void 0),u([p({type:Dve,json:{default:"arrow",write:!0}})],q1.prototype,"style",void 0),u([p({type:ke,json:{type:[Ki],default:null,write:!0}})],q1.prototype,"color",void 0),q1=u([P("esri.symbols.LineStyleMarker3D")],q1);const OG=q1;var rN;let gf=rN=class extends Mm{constructor(t){super(t),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=Wh(1),this.pattern=null,this.marker=null}clone(){const t={enabled:this.enabled,material:this.material!=null?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:this.pattern!=null?this.pattern.clone():null,marker:this.marker!=null?this.marker.clone():null};return new rN(t)}static fromSimpleLineSymbol(t){const e={enabled:!0,size:t.width??Wh(1),cap:t.cap||"butt",join:t.join||"miter",pattern:t.style&&t.style!=="inside-frame"?new tJ({style:t.style}):null,material:new Au({color:(t.color||uR).clone()}),marker:t.marker?new OG({placement:t.marker.placement,style:t.marker.style,color:t.marker.color?.clone()??null}):null};return new rN(e)}};u([p({type:Au,json:{write:!0}})],gf.prototype,"material",void 0),u([nt({Line:"line"},{readOnly:!0})],gf.prototype,"type",void 0),u([p({type:qve,json:{write:!0,default:"miter"}})],gf.prototype,"join",void 0),u([p({type:nJ,json:{write:!0,default:"butt"}})],gf.prototype,"cap",void 0),u([p(fm)],gf.prototype,"size",void 0),u([p(zve)],gf.prototype,"pattern",void 0),u([p({types:{key:"type",base:OG,typeMap:{style:OG}},json:{write:!0}})],gf.prototype,"marker",void 0),gf=rN=u([P("esri.symbols.LineSymbol3DLayer")],gf);const xP=gf;var RG;const qze=ll()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let kA=RG=class extends ue{clone(){return new RG({href:this.href,primitive:this.primitive})}};u([p({type:String,json:{read:h8,write:uv}})],kA.prototype,"href",void 0),u([nt(qze)],kA.prototype,"primitive",void 0),kA=RG=u([P("esri.symbols.support.ObjectSymbol3DLayerResource")],kA);const t1e="sphere";var MG;let Nb=MG=class extends Te{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new MG({x:this.x,y:this.y,z:this.z})}};u([p({type:Number})],Nb.prototype,"x",void 0),u([p({type:Number})],Nb.prototype,"y",void 0),u([p({type:Number})],Nb.prototype,"z",void 0),Nb=MG=u([P("esri.symbols.support.Symbol3DAnchorPosition3D")],Nb);var PG;let Ua=PG=class extends Mm{constructor(t){super(t),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new PG({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,resource:this.resource&&this.resource.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};u([p({type:Au,json:{write:!0}})],Ua.prototype,"material",void 0),u([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Ua.prototype,"castShadows",void 0),u([p({type:kA,json:{write:!0}})],Ua.prototype,"resource",void 0),u([nt({Object:"object"},{readOnly:!0})],Ua.prototype,"type",void 0),u([p({type:Number,json:{write:!0}})],Ua.prototype,"width",void 0),u([p({type:Number,json:{write:!0}})],Ua.prototype,"height",void 0),u([p({type:Number,json:{write:!0}})],Ua.prototype,"depth",void 0),u([nt({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),p({json:{default:"origin"}})],Ua.prototype,"anchor",void 0),u([p({type:Nb,json:{type:[Number],read:{reader:t=>new Nb({x:t[0],y:t[1],z:t[2]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y,t.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Ua.prototype,"anchorPosition",void 0),u([p({type:Number,json:{write:!0}})],Ua.prototype,"heading",void 0),u([p({type:Number,json:{write:!0}})],Ua.prototype,"tilt",void 0),u([p({type:Number,json:{write:!0}})],Ua.prototype,"roll",void 0),u([p({readOnly:!0})],Ua.prototype,"isPrimitive",null),Ua=PG=u([P("esri.symbols.ObjectSymbol3DLayer")],Ua);const oJ=Ua;var IG;let wl=IG=class extends Mm{constructor(t){super(t),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(t,e){return t??(e.height==null&&e.size!=null?e.size:void 0)}readHeight(t,e){return t??(e.width==null&&e.size!=null?e.size:void 0)}clone(){return new IG({enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};u([p({type:Au,json:{write:!0}})],wl.prototype,"material",void 0),u([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],wl.prototype,"castShadows",void 0),u([nt({Path:"path"},{readOnly:!0})],wl.prototype,"type",void 0),u([p({type:["circle","quad"],json:{write:!0,default:"circle"}})],wl.prototype,"profile",void 0),u([p({type:qve,json:{write:!0,default:"miter"}})],wl.prototype,"join",void 0),u([p({type:Lze,json:{write:!0,default:"butt"}})],wl.prototype,"cap",void 0),u([p({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],wl.prototype,"width",void 0),u([Oe("width",["width","size","height"])],wl.prototype,"readWidth",null),u([p({type:Number,json:{write:!0}})],wl.prototype,"height",void 0),u([Oe("height",["height","size","width"])],wl.prototype,"readHeight",null),u([p({type:["center","bottom","top"],json:{write:!0,default:"center"}})],wl.prototype,"anchor",void 0),u([p({type:["heading","all"],json:{write:!0,default:"all"}})],wl.prototype,"profileRotation",void 0),wl=IG=u([P("esri.symbols.PathSymbol3DLayer")],wl);const aJ=wl;var $G;let aS=$G=class extends ue{constructor(){super(...arguments),this.color=new ke([0,0,0,1]),this.size=0}clone(){const t={color:ee(this.color),size:this.size};return new $G(t)}};u([p(R0)],aS.prototype,"color",void 0),u([p(fm)],aS.prototype,"size",void 0),aS=$G=u([P("esri.symbols.support.Symbol3DHalo")],aS);let dR=class extends Hi(ue){constructor(e){super(e),this.color=null}};u([p(R0)],dR.prototype,"color",void 0),dR=u([P("esri.symbols.support.Symbol3DTextBackground")],dR);var iN;let ic=iN=class extends Mm{constructor(t){super(t),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(t){t!=null&&this._userSize!=null&&(t.size=this._userSize),this._set("font",t)}writeFont(t,e,r,i){const s={...i,textSymbol3D:!0};e.font=t.write({},s),delete e.font.size}get size(){return this._userSize!=null?this._userSize:this.font!=null&&this.font.size!=null?this.font.size:9}set size(t){this._userSize=t,this.font!=null&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const t=new iN({enabled:this.enabled,font:this.font&&ee(this.font),halo:this.halo&&ee(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:this.material!=null?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:ee(this.background)});return t._userSize=this._userSize,t}static fromTextSymbol(t){return new iN({font:t.font!=null?t.font.clone():new u8,halo:Wze(t.haloColor,t.haloSize),horizontalAlignment:t.horizontalAlignment,lineHeight:t.lineHeight,material:t.color?new Au({color:t.color.clone()}):null,text:t.text,verticalAlignment:t.verticalAlignment,background:t.backgroundColor?new dR({color:t.backgroundColor.clone()}):null})}};function Wze(t,e){return t&&e!=null&&e>0?new aS({color:ee(t),size:e}):null}u([p({type:u8,json:{write:!0}})],ic.prototype,"font",null),u([Be("font")],ic.prototype,"writeFont",null),u([p({type:aS,json:{write:!0}})],ic.prototype,"halo",void 0),u([p({...Xve,json:{default:"center",write:!0}})],ic.prototype,"horizontalAlignment",void 0),u([p({...Wve,json:{default:1,write:!0}})],ic.prototype,"lineHeight",void 0),u([p({type:Au,json:{write:!0}})],ic.prototype,"material",void 0),u([p({type:dR,json:{write:!0}})],ic.prototype,"background",void 0),u([p(fm)],ic.prototype,"size",null),u([p({type:String,json:{write:!0}})],ic.prototype,"text",void 0),u([nt({Text:"text"},{readOnly:!0})],ic.prototype,"type",void 0),u([p({...Yve,json:{default:"baseline",write:!0}})],ic.prototype,"verticalAlignment",void 0),ic=iN=u([P("esri.symbols.TextSymbol3DLayer")],ic);const Pv=ic;var LG;let Fy=LG=class extends Mm{constructor(t){super(t),this.color=DG.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new LG({color:ee(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};u([p({type:ke,nonNullable:!0,json:{type:[Ki],write:(t,e,r)=>e[r]=t.toArray(ke.AlphaMode.UNLESS_OPAQUE),default:()=>DG.clone(),defaultEquals:t=>t.toCss(!0)===DG.toCss(!0)}})],Fy.prototype,"color",void 0),u([nt({Water:"water"},{readOnly:!0})],Fy.prototype,"type",void 0),u([p({type:["small","medium","large"],json:{write:!0,default:"medium"}})],Fy.prototype,"waterbodySize",void 0),u([p({type:Number,json:{write:!0,default:null}})],Fy.prototype,"waveDirection",void 0),u([p({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],Fy.prototype,"waveStrength",void 0),Fy=LG=u([P("esri.symbols.WaterSymbol3DLayer")],Fy);const DG=new ke([0,119,190]),r1e=Fy;var NG;let W1=NG=class extends Te{constructor(t){super(t),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new NG({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};u([p({type:String})],W1.prototype,"name",void 0),u([p({type:String})],W1.prototype,"styleUrl",void 0),u([p({type:String})],W1.prototype,"styleName",void 0),u([p({type:en})],W1.prototype,"portal",void 0),W1=NG=u([P("esri.symbols.support.StyleOrigin")],W1);const dM=W1;var FG;let fw=FG=class extends Te{constructor(){super(...arguments),this.url=""}clone(){return new FG({url:this.url})}};u([p({type:String})],fw.prototype,"url",void 0),fw=FG=u([P("esri.symbols.support.Thumbnail")],fw);const i1e={icon:Hf,object:oJ,line:xP,path:aJ,fill:Vw,extrude:Lve,text:Pv,water:r1e},Xze=Pt.ofType({base:Mm,key:"type",typeMap:i1e,errorContext:"symbol-layer"});let yf=class extends Vc{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const r=this.__accessor__&&this.__accessor__.metadatas&&this.__accessor__.metadatas.symbolLayers,i=r&&r.type||Pt;this._set("symbolLayers",new i)}get color(){return null}set color(e){this.constructed&&K.getLogger(this).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){Pw(e,this._get("symbolLayers"))}readStyleOrigin(e,r,i){if(e.styleUrl&&e.name){const s=_0(e.styleUrl,i);return new dM({styleUrl:s,name:e.name})}if(e.styleName&&e.name)return new dM({portal:i&&i.portal||en.getDefault(),styleName:e.styleName,name:e.name});i&&i.messages&&i.messages.push(new jh("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:i,definition:e}))}writeStyleOrigin(e,r,i,s){if(e.styleUrl&&e.name){let n=v0(e.styleUrl,s);$c(n)&&(n=_p(n)),r.styleOrigin={styleUrl:n,name:e.name}}else e.styleName&&e.name&&(e.portal&&s&&s.portal&&!D0e(e.portal.restUrl,s.portal.restUrl)?s&&s.messages&&s.messages.push(new jh("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):r.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof Mm||e&&i1e[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};u([p({json:{read:!1,write:!1}})],yf.prototype,"color",null),u([p({type:Xze,nonNullable:!0,json:{write:!0}}),wr(T0e)],yf.prototype,"symbolLayers",null),u([p({type:dM})],yf.prototype,"styleOrigin",void 0),u([Oe("styleOrigin")],yf.prototype,"readStyleOrigin",null),u([Be("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],yf.prototype,"writeStyleOrigin",null),u([p({type:fw,json:{read:!1}})],yf.prototype,"thumbnail",void 0),u([p({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],yf.prototype,"type",void 0),yf=u([P("esri.symbols.Symbol3D")],yf);const AC=yf;let zA=class extends ue{constructor(e){super(e),this.visible=!0}clone(){}};u([p({type:["line"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],zA.prototype,"type",void 0),u([p({readOnly:!0})],zA.prototype,"visible",void 0),zA=u([P("esri.symbols.callouts.Callout3D")],zA);const s1e=zA;var UG;let sN=UG=class extends ue{constructor(){super(...arguments),this.color=new ke("white")}clone(){return new UG({color:ee(this.color)})}};u([p(R0)],sN.prototype,"color",void 0),sN=UG=u([P("esri.symbols.callouts.LineCallout3DBorder")],sN);const n1e=sN;Object.freeze(Object.defineProperty({__proto__:null,default:n1e},Symbol.toStringTag,{value:"Module"}));var kG;let Uy=kG=class extends s1e{constructor(t){super(t),this.type="line",this.color=new ke([0,0,0,1]),this.size=Wh(1),this.border=null}get visible(){return this.size>0&&this.color!=null&&this.color.a>0}clone(){return new kG({color:ee(this.color),size:this.size,border:ee(this.border)})}};u([nt({line:"line"},{readOnly:!0})],Uy.prototype,"type",void 0),u([p(R0)],Uy.prototype,"color",void 0),u([p(fm)],Uy.prototype,"size",void 0),u([p({type:n1e,json:{write:!0}})],Uy.prototype,"border",void 0),u([p({readOnly:!0})],Uy.prototype,"visible",null),Uy=kG=u([P("esri.symbols.callouts.LineCallout3D")],Uy);const Yze=Uy;function lJ(t){if(!t)return!1;const e=t.verticalOffset;return!!e&&!(e.screenLength<=0||e.maxWorldLength!=null&&e.maxWorldLength<=0)}function o1e(t){if(!t||!t.supportsCallout||!t.supportsCallout())return!1;const e=t.callout;return!!e&&!!e.visible&&!!lJ(t)}function cJ(t){return t.type==="point-3d"||t.type==="label-3d"}function a1e(t){return t.horizontalAlignment==="center"}const l1e={types:{key:"type",base:s1e,typeMap:{line:Yze}},json:{write:!0}};var zG;let p2=zG=class extends ue{constructor(t){super(t),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new zG({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};u([p(fm)],p2.prototype,"screenLength",void 0),u([p({type:Number,nonNullable:!0,json:{write:!0,default:0}})],p2.prototype,"minWorldLength",void 0),u([p({type:Number,json:{write:!0}})],p2.prototype,"maxWorldLength",void 0),p2=zG=u([P("esri.symbols.support.Symbol3DVerticalOffset")],p2);const c1e=p2;var nN;const u1e=Pt.ofType({base:null,key:"type",typeMap:{text:Pv}});let ky=nN=class extends AC{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new u1e,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return o1e(this)}hasVisibleVerticalOffset(){return lJ(this)}clone(){return new nN({styleOrigin:ee(this.styleOrigin),symbolLayers:ee(this.symbolLayers),thumbnail:ee(this.thumbnail),callout:ee(this.callout),verticalOffset:ee(this.verticalOffset)})}static fromTextSymbol(t){return new nN({symbolLayers:[Pv.fromTextSymbol(t)]})}};u([p({type:c1e,json:{write:!0}})],ky.prototype,"verticalOffset",void 0),u([p(l1e)],ky.prototype,"callout",void 0),u([p({json:{read:!1,write:!1}})],ky.prototype,"styleOrigin",void 0),u([p({type:u1e})],ky.prototype,"symbolLayers",void 0),u([nt({LabelSymbol3D:"label-3d"},{readOnly:!0})],ky.prototype,"type",void 0),ky=nN=u([P("esri.symbols.LabelSymbol3D")],ky);const TP=ky;var oN;const h1e=Pt.ofType({base:null,key:"type",typeMap:{line:xP,path:aJ}}),Zze=Pt.ofType({base:null,key:"type",typeMap:{line:xP,path:aJ}});let VA=oN=class extends AC{constructor(t){super(t),this.symbolLayers=new h1e,this.type="line-3d"}clone(){return new oN({styleOrigin:ee(this.styleOrigin),symbolLayers:ee(this.symbolLayers),thumbnail:ee(this.thumbnail)})}static fromSimpleLineSymbol(t){return new oN({symbolLayers:[xP.fromSimpleLineSymbol(t)]})}};u([p({type:h1e,json:{type:Zze}})],VA.prototype,"symbolLayers",void 0),u([nt({LineSymbol3D:"line-3d"},{readOnly:!0})],VA.prototype,"type",void 0),VA=oN=u([P("esri.symbols.LineSymbol3D")],VA);const d8=VA;let zy=class extends Vc{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};u([p({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],zy.prototype,"angle",void 0),u([p({type:["simple-marker","picture-marker"],readOnly:!0})],zy.prototype,"type",void 0),u([p({type:Number,cast:ei,json:{write:!0}})],zy.prototype,"xoffset",void 0),u([p({type:Number,cast:ei,json:{write:!0}})],zy.prototype,"yoffset",void 0),u([p({type:Number,cast:t=>t==="auto"?t:ei(t),json:{write:!0}})],zy.prototype,"size",void 0),zy=u([P("esri.symbols.MarkerSymbol")],zy);const d1e=zy;var aN;const p1e=Pt.ofType({base:null,key:"type",typeMap:{fill:Vw}});let BA=aN=class extends AC{constructor(t){super(t),this.symbolLayers=new p1e,this.type="mesh-3d"}clone(){return new aN({styleOrigin:ee(this.styleOrigin),symbolLayers:ee(this.symbolLayers),thumbnail:ee(this.thumbnail)})}static fromSimpleFillSymbol(t){return new aN({symbolLayers:[Vw.fromSimpleFillSymbol(t)]})}};u([p({type:p1e})],BA.prototype,"symbolLayers",void 0),u([nt({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],BA.prototype,"type",void 0),BA=aN=u([P("esri.symbols.MeshSymbol3D")],BA);const SE=BA;function Jze(t,e,r){return e.imageData?F0e({mediaType:e.contentType||"image/png",isBase64:!0,data:e.imageData}):f1e(e.url,r)}function f1e(t,e){return Kze(e)&&!$c(t)&&e?.layer?.parsedUrl?Fc(e.layer.parsedUrl.path,"images",t):_0(t,e)}function Qze(t,e,r,i){if(Am(t)){const s=Iw(t);if(!s)return;e.contentType=s.mediaType,e.imageData=s.data,r&&r.imageData===e.imageData&&r.url&&uv(r.url,e,"url",i)}else uv(t,e,"url",i)}const m1e={json:{read:{source:["imageData","url"],reader:Jze},write:{writer(t,e,r,i){Qze(t,e,this.source,i)}}}},g1e={readOnly:!0,json:{read:{source:["imageData","url"],reader(t,e,r){const i={};return e.imageData&&(i.imageData=e.imageData),e.contentType&&(i.contentType=e.contentType),e.url&&(i.url=f1e(e.url,r)),i}}}};function Kze(t){return!(t==null||t.origin!=="service"&&t.origin!=="portal-item"||t.layer?.type!=="feature"&&t.layer?.type!=="stream")}var VG;let nh=VG=class extends Nve{constructor(...t){super(...t),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(t,e,r,i){if(t&&typeof t!="string"&&t.imageData==null)return t;const s={};return t&&(s.url=t),e&&(s.outline=e),r!=null&&(s.width=ei(r)),i!=null&&(s.height=ei(i)),s}clone(){const t=new VG({color:ee(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return t._set("source",ee(this.source)),t}hash(){return`${super.hash()}.${this.color?.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};u([nt({esriPFS:"picture-fill"},{readOnly:!0})],nh.prototype,"type",void 0),u([p(m1e)],nh.prototype,"url",void 0),u([p({type:Number,json:{write:!0}})],nh.prototype,"xscale",void 0),u([p({type:Number,json:{write:!0}})],nh.prototype,"yscale",void 0),u([p({type:Number,cast:ei,json:{write:!0}})],nh.prototype,"width",void 0),u([p({type:Number,cast:ei,json:{write:!0}})],nh.prototype,"height",void 0),u([p({type:Number,cast:ei,json:{write:!0}})],nh.prototype,"xoffset",void 0),u([p({type:Number,cast:ei,json:{write:!0}})],nh.prototype,"yoffset",void 0),u([p(g1e)],nh.prototype,"source",void 0),nh=VG=u([P("esri.symbols.PictureFillSymbol")],nh);const y1e=nh;var BG;let Cd=BG=class extends d1e{constructor(...t){super(...t),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string"&&t.imageData==null)return t;const i={};return t&&(i.url=t),e!=null&&(i.width=ei(e)),r!=null&&(i.height=ei(r)),i}readHeight(t,e){return e.size||t}readWidth(t,e){return e.size||t}clone(){const t=new BG({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return t._set("source",ee(this.source)),t}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};u([p({json:{write:!1}})],Cd.prototype,"color",void 0),u([nt({esriPMS:"picture-marker"},{readOnly:!0})],Cd.prototype,"type",void 0),u([p(m1e)],Cd.prototype,"url",void 0),u([p(g1e)],Cd.prototype,"source",void 0),u([p({type:Number,cast:ei,json:{write:!0}})],Cd.prototype,"height",void 0),u([Oe("height",["height","size"])],Cd.prototype,"readHeight",null),u([p({type:Number,cast:ei,json:{write:!0}})],Cd.prototype,"width",void 0),u([p({json:{write:!1}})],Cd.prototype,"size",void 0),Cd=BG=u([P("esri.symbols.PictureMarkerSymbol")],Cd);const SP=Cd;var X1;const _1e=Pt.ofType({base:null,key:"type",typeMap:{icon:Hf,object:oJ,text:Pv}});let Y1=X1=class extends AC{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.symbolLayers=new _1e,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const t of this.symbolLayers.items)switch(t.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return o1e(this)}hasVisibleVerticalOffset(){return lJ(this)}clone(){return new X1({verticalOffset:ee(this.verticalOffset),callout:ee(this.callout),styleOrigin:ee(this.styleOrigin),symbolLayers:ee(this.symbolLayers),thumbnail:ee(this.thumbnail)})}static fromSimpleMarkerSymbol(t){return new X1({symbolLayers:[Hf.fromSimpleMarkerSymbol(t)]})}static fromPictureMarkerSymbol(t){return new X1({symbolLayers:[Hf.fromPictureMarkerSymbol(t)]})}static fromCIMSymbol(t){if(t.data?.symbol?.type!=="CIMPointSymbol")return null;const r=t.data.symbol;return new X1(r?.callout?{symbolLayers:[Hf.fromCIMSymbol(t)],callout:{type:"line",size:.5,color:[0,0,0]},verticalOffset:{screenLength:40}}:{symbolLayers:[Hf.fromCIMSymbol(t)]})}static fromTextSymbol(t){return new X1({symbolLayers:[Pv.fromTextSymbol(t)]})}};u([p({type:c1e,json:{write:!0}})],Y1.prototype,"verticalOffset",void 0),u([p(l1e)],Y1.prototype,"callout",void 0),u([p({type:_1e,json:{origins:{"web-scene":{write:!0}}}})],Y1.prototype,"symbolLayers",void 0),u([nt({PointSymbol3D:"point-3d"},{readOnly:!0})],Y1.prototype,"type",void 0),Y1=X1=u([P("esri.symbols.PointSymbol3D")],Y1);const qf=Y1;var GA;const v1e=Pt.ofType({base:null,key:"type",typeMap:{extrude:Lve,fill:Vw,icon:Hf,line:xP,object:oJ,text:Pv,water:r1e}});let jA=GA=class extends AC{constructor(t){super(t),this.symbolLayers=new v1e,this.type="polygon-3d"}clone(){return new GA({styleOrigin:ee(this.styleOrigin),symbolLayers:ee(this.symbolLayers),thumbnail:ee(this.thumbnail)})}static fromJSON(t){const e=new GA;if(e.read(t),e.symbolLayers.length===2&&e.symbolLayers.at(0).type==="fill"&&e.symbolLayers.at(1).type==="line"){const r=e.symbolLayers.at(0),i=e.symbolLayers.at(1);!i.enabled||t.symbolLayers&&t.symbolLayers[1]&&t.symbolLayers[1].enable===!1||(r.outline={size:i.size,color:i.material!=null?i.material.color:null}),e.symbolLayers.removeAt(1)}return e}static fromSimpleFillSymbol(t){return new GA({symbolLayers:[Vw.fromSimpleFillSymbol(t)]})}};u([p({type:v1e,json:{write:!0}})],jA.prototype,"symbolLayers",void 0),u([nt({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],jA.prototype,"type",void 0),jA=GA=u([P("esri.symbols.PolygonSymbol3D")],jA);const EP=jA;var GG;const HU=new $r({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let Z1=GG=class extends Nve{constructor(...t){super(...t),this.color=new ke([0,0,0,.25]),this.outline=new zu,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string")return t;const i={};return t&&(i.style=t),e&&(i.outline=e),r&&(i.color=r),i}clone(){return new GG({color:ee(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};u([p()],Z1.prototype,"color",void 0),u([p()],Z1.prototype,"outline",void 0),u([nt({esriSFS:"simple-fill"},{readOnly:!0})],Z1.prototype,"type",void 0),u([p({type:HU.apiValues,json:{read:HU.read,write:HU.write}})],Z1.prototype,"style",void 0),Z1=GG=u([P("esri.symbols.SimpleFillSymbol")],Z1);const Iv=Z1;var jG;const qU=new $r({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let _f=jG=class extends d1e{constructor(...t){super(...t),this.color=new ke([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new zu}normalizeCtorArgs(t,e,r,i){if(t&&typeof t!="string")return t;const s={};return t&&(s.style=t),e!=null&&(s.size=ei(e)),r&&(s.outline=r),i&&(s.color=i),s}writeColor(t,e){t&&this.style!=="x"&&this.style!=="cross"&&(e.color=t.toJSON()),t===null&&(e.color=null)}set path(t){this.style="path",this._set("path",t)}clone(){return new jG({angle:this.angle,color:ee(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${this.outline?.hash()}`}};u([p()],_f.prototype,"color",void 0),u([Be("color")],_f.prototype,"writeColor",null),u([nt({esriSMS:"simple-marker"},{readOnly:!0})],_f.prototype,"type",void 0),u([p()],_f.prototype,"size",void 0),u([p({type:qU.apiValues,json:{read:qU.read,write:qU.write}})],_f.prototype,"style",void 0),u([p({type:String,json:{write:!0}})],_f.prototype,"path",null),u([p({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":zu}},json:{default:null,write:!0}})],_f.prototype,"outline",void 0),_f=jG=u([P("esri.symbols.SimpleMarkerSymbol")],_f);const $v=_f;var HG;let Cs=HG=class extends Vc{constructor(...t){super(...t),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new u8,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string")return t;const i={};return t&&(i.text=t),e&&(i.font=e),r&&(i.color=r),i}writeLineWidth(t,e,r,i){i&&typeof i!="string"?i.origin:e[r]=t}castLineWidth(t){return ei(t)}writeLineHeight(t,e,r,i){i&&typeof i!="string"?i.origin:e[r]=t}clone(){return new HG({angle:this.angle,backgroundColor:ee(this.backgroundColor),borderLineColor:ee(this.borderLineColor),borderLineSize:this.borderLineSize,color:ee(this.color),font:this.font&&this.font.clone(),haloColor:ee(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${this.backgroundColor&&this.backgroundColor.hash()}.${this.borderLineColor}.${this.borderLineSize}.${this.color?.hash()}.${this.font&&this.font.hash()}.${this.haloColor&&this.haloColor.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};u([p({type:ke,json:{write:!0}})],Cs.prototype,"backgroundColor",void 0),u([p({type:ke,json:{write:!0}})],Cs.prototype,"borderLineColor",void 0),u([p({type:Number,json:{write:!0},cast:ei})],Cs.prototype,"borderLineSize",void 0),u([p({type:u8,json:{write:!0}})],Cs.prototype,"font",void 0),u([p({...Xve,json:{write:!0}})],Cs.prototype,"horizontalAlignment",void 0),u([p({type:Boolean,json:{write:!0}})],Cs.prototype,"kerning",void 0),u([p({type:ke,json:{write:!0}})],Cs.prototype,"haloColor",void 0),u([p({type:Number,cast:ei,json:{write:!0}})],Cs.prototype,"haloSize",void 0),u([p({type:Boolean,json:{write:!0}})],Cs.prototype,"rightToLeft",void 0),u([p({type:Boolean,json:{write:!0}})],Cs.prototype,"rotated",void 0),u([p({type:String,json:{write:!0}})],Cs.prototype,"text",void 0),u([nt({esriTS:"text"},{readOnly:!0})],Cs.prototype,"type",void 0),u([p({...Yve,json:{write:!0}})],Cs.prototype,"verticalAlignment",void 0),u([p({type:Number,cast:ei,json:{write:!0}})],Cs.prototype,"xoffset",void 0),u([p({type:Number,cast:ei,json:{write:!0}})],Cs.prototype,"yoffset",void 0),u([p({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],Cs.prototype,"angle",void 0),u([p({type:Number,json:{write:!0}})],Cs.prototype,"width",void 0),u([p({type:Number})],Cs.prototype,"lineWidth",void 0),u([Be("lineWidth")],Cs.prototype,"writeLineWidth",null),u([wr("lineWidth")],Cs.prototype,"castLineWidth",null),u([p(Wve)],Cs.prototype,"lineHeight",void 0),u([Be("lineHeight")],Cs.prototype,"writeLineHeight",null),Cs=HG=u([P("esri.symbols.TextSymbol")],Cs);const Ex=Cs;var qG;let Ad=qG=class extends Vc{constructor(t){super(t),this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const t=this.portal!=null?this.portal:en.getDefault(),e=t.user?t.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${e}:${t.url}`}read(t,e){this.portal=e?.portal,super.read(t,e)}clone(){return new qG({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(t){return this._fetchSymbol("webRef",t)}fetchCIMSymbol(t){return this._fetchSymbol("cimRef",t)}async _fetchSymbol(t,e){const r=e!=null?e.cache:null,i=r?this._fetchCacheKey:null;if(r!=null){const a=i&&r.get(i);if(a)return a.clone()}const{resolveWebStyleSymbol:s}=await he(()=>Promise.resolve().then(()=>Nht),void 0,import.meta.url);Yt(e);const n=s(this,{portal:this.portal},t,e);n.catch(a=>{K.getLogger(this).error("#fetchSymbol()","Failed to create symbol from style",a)});const o=await n;return t==="webRef"&&o.type==="point-3d"||t==="cimRef"&&o.type==="cim"?(r?.set(i,o.clone()),o):null}};u([p({json:{write:!1}})],Ad.prototype,"color",void 0),u([p({type:String,json:{write:!0}})],Ad.prototype,"styleName",void 0),u([p({type:en,json:{write:!1}})],Ad.prototype,"portal",void 0),u([p({type:String,json:{read:h8,write:uv}})],Ad.prototype,"styleUrl",void 0),u([p({type:fw,json:{read:!1}})],Ad.prototype,"thumbnail",void 0),u([p({type:String,json:{write:!0}})],Ad.prototype,"name",void 0),u([nt({styleSymbolReference:"web-style"},{readOnly:!0})],Ad.prototype,"type",void 0),u([p()],Ad.prototype,"_fetchCacheKey",null),Ad=qG=u([P("esri.symbols.WebStyleSymbol")],Ad);const Cx=Ad;function p8(t){if(!t)return!1;switch(t.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function Bw(t){if(!t)return!1;switch(t.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const mw={base:Vc,key:"type",typeMap:{"simple-fill":Iv,"picture-fill":y1e,"picture-marker":SP,"simple-line":zu,"simple-marker":$v,text:Ex,"label-3d":TP,"line-3d":d8,"mesh-3d":SE,"point-3d":qf,"polygon-3d":EP,"web-style":Cx,cim:CC},errorContext:"symbol"},eVe={base:Vc,key:"type",typeMap:{"picture-marker":SP,"simple-marker":$v,text:Ex,"web-style":Cx,cim:CC},errorContext:"symbol"},tVe=yC({types:mw}),b1e={base:Vc,key:"type",typeMap:{"simple-fill":Iv,"picture-fill":y1e,"picture-marker":SP,"simple-line":zu,"simple-marker":$v,text:Ex,"line-3d":d8,"mesh-3d":SE,"point-3d":qf,"polygon-3d":EP,"web-style":Cx,cim:CC},errorContext:"symbol"},rVe={base:Vc,key:"type",typeMap:{text:Ex,"label-3d":TP},errorContext:"symbol"},Iie={base:Vc,key:"type",typeMap:{"line-3d":d8,"mesh-3d":SE,"point-3d":qf,"polygon-3d":EP,"web-style":Cx,cim:CC},errorContext:"symbol"},iVe={base:Vc,key:"type",typeMap:{"label-3d":TP},errorContext:"symbol"},w1e=Ap(mw);var WG;function sVe(t){if(!t)return null;const e={};for(const r in t){const i=ov(t[r]);i&&(e[r]=i)}return Object.keys(e).length!==0?e:null}function nVe(t){if(t==null)return null;const e={};for(const r in t){const i=t[r];i&&(e[r]=i.toJSON())}return Object.keys(e).length!==0?e:null}let sc=WG=class extends Hi(ue){constructor(...t){super(...t),this.isAggregate=!1,this.layer=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:Ic(),configurable:!0})}normalizeCtorArgs(t,e,r,i){return t&&!t.declaredClass?t:{geometry:t,symbol:e,attributes:r,popupTemplate:i}}set aggregateGeometries(t){const e=this._get("aggregateGeometries");JSON.stringify(e)!==JSON.stringify(t)&&this._set("aggregateGeometries",t)}set attributes(t){const e=this._get("attributes");e!==t&&(this._set("attributes",t),this._notifyLayer("attributes",e,t))}set geometry(t){const e=this._get("geometry");e!==t&&(this._set("geometry",t),this._notifyLayer("geometry",e,t))}set symbol(t){const e=this._get("symbol");e!==t&&(this._set("symbol",t),this._notifyLayer("symbol",e,t))}set visible(t){const e=this._get("visible");e!==t&&(this._set("visible",t),this._notifyLayer("visible",e,t))}cloneShallow(){return new WG({aggregateGeometries:this.aggregateGeometries,attributes:this.attributes,geometry:this.geometry,isAggregate:this.isAggregate,layer:this.layer,popupTemplate:this.popupTemplate,sourceLayer:this.sourceLayer,symbol:this.symbol,visible:this.visible})}getEffectivePopupTemplate(t=!1){if(this.popupTemplate)return this.popupTemplate;for(const e of[this.sourceLayer,this.layer])if(e){if("popupTemplate"in e&&e.popupTemplate)return e.popupTemplate;if(t&&"defaultPopupTemplate"in e&&e.defaultPopupTemplate!=null)return e.defaultPopupTemplate}return null}getAttribute(t){return this.attributes?.[t]}setAttribute(t,e){if(this.attributes){const r=this.getAttribute(t);this.attributes[t]=e,this._notifyLayer("attributes",r,e,t)}else this.attributes={[t]:e},this._notifyLayer("attributes",void 0,e,t)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{aggregateGeometries:nVe(this.aggregateGeometries),geometry:this.geometry!=null?this.geometry.toJSON():null,symbol:this.symbol!=null?this.symbol.toJSON():null,attributes:{...this.attributes},popupTemplate:this.popupTemplate&&this.popupTemplate.toJSON()}}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}notifyMeshTransformChanged(t={}){const{geometry:e}=this;if(e?.type==="mesh"){const r={origin:e.origin,transform:e.transform};this._notifyLayer("origin-transform",r,r,t.action)}}_notifyLayer(t,e,r,i){if(!this.layer||!("graphicChanged"in this.layer))return;const s={graphic:this,property:t,oldValue:e,newValue:r};t==="origin-transform"&&(s.action=i),t==="attributes"&&(s.attributeName=i),this.layer.graphicChanged(s)}};u([p({value:null,json:{read:sVe}})],sc.prototype,"aggregateGeometries",null),u([p({value:null})],sc.prototype,"attributes",null),u([p({value:null,types:wx,json:{read:ov}})],sc.prototype,"geometry",null),u([p({type:Boolean})],sc.prototype,"isAggregate",void 0),u([p({clonable:"reference"})],sc.prototype,"layer",void 0),u([p({type:Rv})],sc.prototype,"popupTemplate",void 0),u([p({clonable:"reference"})],sc.prototype,"sourceLayer",void 0),u([p({value:null,types:mw})],sc.prototype,"symbol",null),u([p({type:Boolean,value:!0})],sc.prototype,"visible",null),sc=WG=u([P("esri.Graphic")],sc),function(t){t.generateUID=Ic}(sc||(sc={}));const Bl=sc;var XG;let Vy=XG=class extends ue{constructor(t){super(t),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(t){return(t%=360)<0&&(t+=360),t}clone(){return new XG({rotation:this.rotation,scale:this.scale,targetGeometry:this.targetGeometry!=null?this.targetGeometry.clone():null,camera:this.camera!=null?this.camera.clone():null})}};function WU(){return{enabled:!this.camera}}u([p({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:WU}}}}})],Vy.prototype,"rotation",void 0),u([wr("rotation")],Vy.prototype,"castRotation",null),u([p({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:WU}}}}})],Vy.prototype,"scale",void 0),u([p({types:wx,json:{read:ov,write:!0,origins:{"web-scene":{read:ov,write:{overridePolicy:WU}}}}})],Vy.prototype,"targetGeometry",void 0),u([p({type:qh,json:{write:!0}})],Vy.prototype,"camera",void 0),Vy=XG=u([P("esri.Viewpoint")],Vy);const Mp=Vy;function f8(t){return typeof t=="string"?document.getElementById(t):t??null}function x1e(t){for(;t.hasChildNodes();)t.removeChild(t.firstChild)}function $ie(t,e){const r=e.parentNode;r&&r.insertBefore(t,e)}function Lie(t,e){for(;;){const r=t.firstChild;if(!r)break;e.appendChild(r)}}let YG=class{constructor(e=r=>r.values().next().value){this._peeker=e,this._observable=new V6,this._items=new Set}get length(){return qt(this._observable),this._items.size}clear(){this.length!==0&&(this._items.clear(),this._observable.notify())}last(){if(this.length===0)return;let e;for(e of this._items);return e}peek(){if(this.length!==0)return this._peeker(this._items)}push(e){this.contains(e)||(this._items.add(e),this._observable.notify())}contains(e){return qt(this._observable),this._items.has(e)}pop(){if(this.length===0)return;const e=this.peek();return this._items.delete(e),this._observable.notify(),e}popLast(){if(this.length===0)return;const e=this.last();return this._items.delete(e),this._observable.notify(),e}remove(e){this.contains(e)&&(this._items.delete(e),this._observable.notify())}filter(e){const r=this.length;return this._items.forEach(i=>{e(i)||this._items.delete(i)}),r!==this._items.size&&this._observable.notify(),this}*[Symbol.iterator](){qt(this._observable),yield*this._items}};const oVe={statsWorker:()=>he(()=>import("./statsWorker-6cbaf28c.js"),["./statsWorker-6cbaf28c.js","./utils-86593ea2.js","./generateRendererUtils-455ff246.js"],import.meta.url),geometryEngineWorker:()=>he(()=>import("./geometryEngineWorker-7630f5db.js"),["./geometryEngineWorker-7630f5db.js","./geometryEngineJSON-cc9c6b0f.js","./geometryEngineBase-eaaafef1.js","./json-48e3ea08.js"],import.meta.url),CSVSourceWorker:()=>he(()=>import("./CSVSourceWorker-a2c17407.js"),["./CSVSourceWorker-a2c17407.js","./json-48e3ea08.js","./FeatureStore-9e22cc1d.js","./BoundsStore-8a888707.js","./PooledRBush-f65c099f.js","./quickselect-89073317.js","./optimizedFeatureQueryEngineAdapter-a3b2ad14.js","./centroid-3dcadaf5.js","./QueryEngine-9560ee9b.js","./normalizeUtils-ca47990d.js","./normalizeUtilsCommon-448ddeb2.js","./WhereClause-fb3d85c4.js","./executionError-e8d36121.js","./QueryEngineCapabilities-42e44ded.js","./utils-86593ea2.js","./generateRendererUtils-455ff246.js","./number-5af42c3b.js","./clientSideDefaults-02120944.js"],import.meta.url),EdgeProcessingWorker:()=>he(()=>import("./EdgeProcessingWorker-a317e84d.js"),[],import.meta.url),ElevationSamplerWorker:()=>he(()=>import("./ElevationSamplerWorker-a9efde98.js"),["./ElevationSamplerWorker-a9efde98.js","./PooledRBush-f65c099f.js","./quickselect-89073317.js","./georeference-9b495fe0.js","./MeshGeoreferencedRelativeVertexSpace-0d2c6219.js","./MeshLocalVertexSpace-243c3bcc.js"],import.meta.url),FeatureServiceSnappingSourceWorker:()=>he(()=>import("./FeatureServiceSnappingSourceWorker-6158c6f6.js"),["./FeatureServiceSnappingSourceWorker-6158c6f6.js","./FeatureStore-9e22cc1d.js","./BoundsStore-8a888707.js","./PooledRBush-f65c099f.js","./quickselect-89073317.js","./optimizedFeatureQueryEngineAdapter-a3b2ad14.js","./centroid-3dcadaf5.js","./QueryEngine-9560ee9b.js","./normalizeUtils-ca47990d.js","./normalizeUtilsCommon-448ddeb2.js","./WhereClause-fb3d85c4.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-86593ea2.js","./generateRendererUtils-455ff246.js","./symbologySnappingCandidates-654b9f37.js","./pbfQueryUtils-4859e776.js","./pbf-482f6762.js","./query-f938b96a.js"],import.meta.url),GeoJSONSourceWorker:()=>he(()=>import("./GeoJSONSourceWorker-09a5df51.js"),["./GeoJSONSourceWorker-09a5df51.js","./FeatureStore-9e22cc1d.js","./BoundsStore-8a888707.js","./PooledRBush-f65c099f.js","./quickselect-89073317.js","./optimizedFeatureQueryEngineAdapter-a3b2ad14.js","./centroid-3dcadaf5.js","./QueryEngine-9560ee9b.js","./normalizeUtils-ca47990d.js","./normalizeUtilsCommon-448ddeb2.js","./WhereClause-fb3d85c4.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-86593ea2.js","./generateRendererUtils-455ff246.js","./geojson-75118ab4.js","./clientSideDefaults-02120944.js","./sourceUtils-1c4c58c9.js"],import.meta.url),LercWorker:()=>he(()=>import("./LercWorker-34518f4f.js"),[],import.meta.url),MemorySourceWorker:()=>he(()=>import("./MemorySourceWorker-639b70d8.js"),["./MemorySourceWorker-639b70d8.js","./objectIdUtils-967fafff.js","./FeatureStore-9e22cc1d.js","./BoundsStore-8a888707.js","./PooledRBush-f65c099f.js","./quickselect-89073317.js","./optimizedFeatureQueryEngineAdapter-a3b2ad14.js","./centroid-3dcadaf5.js","./QueryEngine-9560ee9b.js","./normalizeUtils-ca47990d.js","./normalizeUtilsCommon-448ddeb2.js","./WhereClause-fb3d85c4.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-86593ea2.js","./generateRendererUtils-455ff246.js","./clientSideDefaults-02120944.js","./sourceUtils-1c4c58c9.js"],import.meta.url),PBFDecoderWorker:()=>he(()=>import("./PBFDecoderWorker-c0313a1a.js"),["./PBFDecoderWorker-c0313a1a.js","./pbfQueryUtils-4859e776.js","./pbf-482f6762.js"],import.meta.url),Pipeline:()=>he(()=>import("./Pipeline-cd350817.js").then(t=>t.P),["./Pipeline-cd350817.js","./QueryEngine-9560ee9b.js","./normalizeUtils-ca47990d.js","./normalizeUtilsCommon-448ddeb2.js","./WhereClause-fb3d85c4.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-86593ea2.js","./generateRendererUtils-455ff246.js","./StreamFeatureManager-d534361d.js","./quickselect-89073317.js","./arcadeTimeUtils-38be4e14.js","./centroid-3dcadaf5.js","./ogcFeatureUtils-08ff9d9e.js","./geojson-75118ab4.js","./clientSideDefaults-02120944.js","./query-f938b96a.js","./pbfQueryUtils-4859e776.js","./pbf-482f6762.js","./createConnection-8b92b0e5.js","./definitions-c3d21a38.js","./TileInfoView-ef81f3ea.js","./number-e491b09e.js","./geohashUtils-77d8429b.js"],import.meta.url),PointCloudWorker:()=>he(()=>import("./PointCloudWorker-9d095ae4.js"),["./PointCloudWorker-9d095ae4.js","./PointCloudWorkerUtil-274050f3.js","./PointCloudUniqueValueRenderer-4fd58f2f.js"],import.meta.url),RasterWorker:()=>he(()=>import("./RasterWorker-c15297ba.js"),["./RasterWorker-c15297ba.js","./dataUtils-f6aa043f.js","./colorUtils-c0f43caf.js","./utils-8f74c8d1.js","./rasterProjectionHelper-ff62d9df.js"],import.meta.url),SceneLayerSnappingSourceWorker:()=>he(()=>import("./SceneLayerSnappingSourceWorker-dadf04d2.js"),[],import.meta.url),SceneLayerWorker:()=>he(()=>import("./SceneLayerWorker-f0abbfb0.js").then(t=>t.a),["./SceneLayerWorker-f0abbfb0.js","./MeshGeoreferencedRelativeVertexSpace-0d2c6219.js","./MeshLocalVertexSpace-243c3bcc.js","./I3SNode-b8898742.js"],import.meta.url),WFSSourceWorker:()=>he(()=>import("./WFSSourceWorker-1e308d29.js"),["./WFSSourceWorker-1e308d29.js","./FeatureStore-9e22cc1d.js","./BoundsStore-8a888707.js","./PooledRBush-f65c099f.js","./quickselect-89073317.js","./optimizedFeatureQueryEngineAdapter-a3b2ad14.js","./centroid-3dcadaf5.js","./QueryEngine-9560ee9b.js","./normalizeUtils-ca47990d.js","./normalizeUtilsCommon-448ddeb2.js","./WhereClause-fb3d85c4.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-86593ea2.js","./generateRendererUtils-455ff246.js","./geojson-75118ab4.js","./sourceUtils-1c4c58c9.js","./wfsUtils-e0f6672d.js","./xmlUtils-444cb4c0.js"],import.meta.url),WorkerTileHandler:()=>he(()=>import("./WorkerTileHandler-d6e487c9.js"),["./WorkerTileHandler-d6e487c9.js","./TileClipper-ae6eca9e.js","./StyleRepository-0a7b0dfa.js","./colorUtils-c0f43caf.js","./definitions-c3d21a38.js","./Rect-98da58d6.js","./pbf-482f6762.js","./TurboLine-9f81275c.js","./BidiEngine-9a40f2f4.js"],import.meta.url)};var Vo;(function(t){t[t.HANDSHAKE=0]="HANDSHAKE",t[t.OPEN=1]="OPEN",t[t.OPENED=2]="OPENED",t[t.RESPONSE=3]="RESPONSE",t[t.INVOKE=4]="INVOKE",t[t.ABORT=5]="ABORT",t[t.CLOSE=6]="CLOSE",t[t.OPEN_PORT=7]="OPEN_PORT",t[t.ON=8]="ON"})(Vo||(Vo={}));let aVe=0;function T1e(){return aVe++}function lVe(t){return t&&typeof t=="object"&&("result"in t||"transferList"in t)}function pM(t){return t?typeof t=="string"?JSON.stringify({name:"message",message:t}):t.toJSON?JSON.stringify(t):JSON.stringify({name:t.name,message:t.message,details:t.details||{stack:t.stack}}):null}function uJ(t,e,r,i){if(e.type===Vo.OPEN_PORT)return void t.postMessage(e,[e.port]);if(e.type!==Vo.INVOKE&&e.type!==Vo.RESPONSE)return void t.postMessage(e);let s;if(lVe(r)?(s=Die(r.transferList),e.data=r.result):(s=Die(i),e.data=r),s){if(ae("ff")){for(const n of s)if("byteLength"in n&&n.byteLength>267386880){const o="Worker call with large ArrayBuffer would crash Firefox";switch(e.type){case Vo.INVOKE:throw o;case Vo.RESPONSE:return void uJ(t,{type:Vo.RESPONSE,jobId:e.jobId,error:pM(o)})}}}t.postMessage(e,s)}else t.postMessage(e)}function fM(t){if(!t)return null;const e=t.data;return e?typeof e=="string"?JSON.parse(e):e:null}function Die(t){if(!t||!t.length)return null;if(ae("esri-workers-arraybuffer-transfer"))return t;const e=t.filter(r=>!cVe(r));return e.length?e:null}function cVe(t){return t instanceof ArrayBuffer||t?.constructor?.name==="ArrayBuffer"}const{CLOSE:Nie,ABORT:Fie,INVOKE:Uie,RESPONSE:l3,OPEN_PORT:kie,ON:uVe}=Vo,hVe=2;let dVe=class{constructor(e){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=e,this._timer=null,this._process=this._process.bind(this)}push(e){e.type===Vo.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}},hv=class f2{static connect(e){const r=new MessageChannel;let i;i=typeof e=="function"?new e:"default"in e&&typeof e.default=="function"?new e.default:e;const s=new f2(r.port1,{channel:r,client:i},()=>null);return typeof i=="object"&&"remoteClient"in i&&(i.remoteClient=s),f2.clients.set(s,i),r.port2}static loadWorker(e){const r=oVe[e];return r?r():Promise.resolve(null)}constructor(e,r,i){this._port=e,this._getNextJob=i,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new dVe(s=>this._onInvokeMessage(s)),this._client=r.client,this._onMessage=this._onMessage.bind(this),this._channel=r.channel,this._schedule=r.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:Nie}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,r,i){const s=i?.signal,n=i?.transferList;if(!this._port)return Promise.reject(new U("worker:port-closed",`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:r}));const o=T1e();return new Promise((a,l)=>{if(Mn(s))return this._processWork(),void l(zr());const c=ya(s,()=>{const d=this._outJobs.get(o);d&&(this._outJobs.delete(o),this._processWork(),Fi(d.abortHandle),this._post({type:Fie,jobId:o}),l(zr()))}),h={resolve:a,reject:l,abortHandle:c,debugInfo:e};this._outJobs.set(o,h),this._post({type:Uie,jobId:o,methodName:e,abortable:s!=null},r,n)})}on(e,r){const i=new MessageChannel;function s(n){r(n.data)}return this._port.postMessage({type:Vo.ON,eventType:e,port:i.port2},[i.port2]),i.port1.addEventListener("message",s),i.port1.start(),{remove(){i.port1.postMessage({type:Vo.CLOSE}),i.port1.close(),i.port1.removeEventListener("message",s)}}}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:kie,port:e.port2}),e.port1}_processWork(){if(this._outJobs.size>=hVe)return;const e=this._getNextJob();if(!e)return;const{methodName:r,data:i,invokeOptions:s,resolver:n}=e;this.invoke(r,i,s).then(o=>n.resolve(o)).catch(o=>n.reject(o))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(e=>{Fi(e.abortHandle),e.reject(zr(`Worker closing, aborting job calling '${e.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=null,this._client=null,this._schedule=null}_onMessage(e){this._schedule!=null?this._schedule(()=>this._processMessage(e)):this._processMessage(e)}_processMessage(e){const r=fM(e);if(r)switch(r.type){case l3:this._onResponseMessage(r);break;case Uie:this._invokeQueue.push(r);break;case Fie:this._onAbortMessage(r);break;case Nie:this._onCloseMessage();break;case kie:this._onOpenPortMessage(r);break;case uVe:this._onOnMessage(r)}}_onAbortMessage(e){const r=this._inJobs,i=e.jobId,s=r.get(i);this._invokeQueue.push(e),s&&(s.controller&&s.controller.abort(),r.delete(i))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&f2.clients.get(this)===e&&e.destroy(),f2.clients.delete(this),e?.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:r,jobId:i,data:s,abortable:n}=e,o=n?new AbortController:null,a=this._inJobs;let l,c=this._client,h=c[r];try{if(!h&&r&&r.includes(".")){const d=r.split(".");for(let f=0;f<d.length-1;f++)c=c[d[f]],h=c[d[f+1]]}if(typeof h!="function")throw new TypeError(`${r} is not a function`);l=h.call(c,s,{client:this,signal:o?o.signal:null})}catch(d){return void this._post({type:l3,jobId:i,error:pM(d)})}ku(l)?(a.set(i,{controller:o,promise:l}),l.then(d=>{a.has(i)&&(a.delete(i),this._post({type:l3,jobId:i},d))},d=>{a.has(i)&&(a.delete(i),ds(d)||this._post({type:l3,jobId:i,error:pM(d||{message:`Error encountered at method ${r}`})}))})):this._post({type:l3,jobId:i},l)}_onOpenPortMessage(e){new f2(e.port,{client:this._client},()=>null)}_onOnMessage(e){const{port:r}=e,i=this._client.on(e.eventType,n=>{r.postMessage(n)}),s=aP(e.port,"message",n=>{fM(n)?.type===Vo.CLOSE&&(s.remove(),i.remove(),r.close())})}_onResponseMessage(e){const{jobId:r,error:i,data:s}=e,n=this._outJobs;if(!n.has(r))return;const o=n.get(r);n.delete(r),this._processWork(),Fi(o.abortHandle),i?o.reject(U.fromJSON(JSON.parse(i))):o.resolve(s)}_post(e,r,i){return uJ(this._port,e,r,i)}};hv.kernelInfo={buildDate:eye,fullVersion:aZ,revision:tye},hv.clients=new Map;let pVe=class{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new YG}destroy(){this.close()}get closed(){return!this._clients||!this._clients.length}open(e,r){return new Promise((i,s)=>{let n=!0;const o=a=>{Yt(r.signal),n&&(n=!1,a())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let a=0;a<e.length;++a){const l=e[a];ku(l)?this._clientPromises[a]=l.then(c=>(this._clients[a]=new hv(c,r,()=>this._ongoingJobsQueue.pop()??null),o(i),this._clients[a]),()=>(o(s),null)):(this._clients[a]=new hv(l,r,()=>this._ongoingJobsQueue.pop()??null),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(i))}})}broadcast(e,r,i){const s=new Array(this._clientPromises.length);for(let n=0;n<this._clientPromises.length;++n){const o=this._clientPromises[n];s[n]=o.then(a=>a?.invoke(e,r,i))}return s}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.resolver.reject(zr(`Worker closing, aborting job calling '${e.methodName}'`));for(const r of this._clientPromises)r.then(i=>i?.close());this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0}invoke(e,r,i){let s;Array.isArray(i)?(K.getLogger("esri.core.workers.Connection").warn("invoke()","The transferList parameter is deprecated, use the options object instead"),s={transferList:i}):s=i;const n=Eo();this._ongoingJobsQueue.push({methodName:e,data:r,invokeOptions:s,resolver:n});for(let o=0;o<this._clientPromises.length;o++){const a=this._clients[o];a?a.jobAdded():this._clientPromises[o].then(l=>l?.jobAdded())}return n.promise}on(e,r){return Promise.all(this._clientPromises).then(()=>cE(this._clients.map(i=>i.on(e,r))))}openPorts(){return new Promise(e=>{const r=new Array(this._clientPromises.length);let i=r.length;for(let s=0;s<this._clientPromises.length;++s)this._clientPromises[s].then(n=>{n&&(r[s]=n.openPort()),--i==0&&e(r)})})}get test(){return{numClients:this._clients.length}}};const S1e=K.getLogger("esri.intl.substitute");function E1e(t,e,r={}){const{format:i={}}=r;return F6(t,s=>fVe(s,e,i))}function fVe(t,e,r){let i,s;const n=t.indexOf(":");if(n===-1?i=t.trim():(i=t.slice(0,n).trim(),s=t.slice(n+1).trim()),!i)return"";const o=cP(i,e);if(o==null)return"";const a=(s?r?.[s]:null)??r?.[i];return a?mVe(o,a):s?gVe(o,s):hJ(o)}function mVe(t,e){switch(e.type){case"date":return y0(t,e.intlOptions);case"number":return wE(t,e.intlOptions);default:return S1e.warn("missing format descriptor for key {key}"),hJ(t)}}function gVe(t,e){switch(e.toLowerCase()){case"dateformat":return y0(t);case"numberformat":return wE(t);default:return S1e.warn(`inline format is unsupported since 4.12: ${e}`),/^(dateformat|datestring)/i.test(e)?y0(t):/^numberformat/i.test(e)?wE(t):hJ(t)}}function hJ(t){switch(typeof t){case"string":return t;case"number":return wE(t);case"boolean":return""+t;default:return t instanceof Date?y0(t):""}}async function yVe(t,e,r,i){const s=e.exec(r);if(!s)throw new U("esri-intl:invalid-bundle",`Bundle id "${r}" is not compatible with the pattern "${e}"`);const n=s[1]?`${s[1]}/`:"",o=s[2],a=YFe(i),l=`${n}${o}.json`,c=a?`${n}${o}_${a}.json`:l;let h;try{h=await zie(t(c))}catch(d){if(c===l)throw new U("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:d});try{h=await zie(t(l))}catch(f){throw new U("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:f})}}return h}async function zie(t){if(Vie.fetchBundleAsset!=null)return Vie.fetchBundleAsset(t);const e=await ur(t,{responseType:"text"});return JSON.parse(e.data)}let _Ve=class{constructor({base:e="",pattern:r,location:i=new URL(window.location.href)}){let s;s=typeof i=="string"?n=>new URL(n,new URL(i,window.location.href)).href:i instanceof URL?n=>new URL(n,i).href:i,this.pattern=typeof r=="string"?new RegExp(`^${r}`):r,this.getAssetUrl=s,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)/)?(.*)$`)}fetchMessageBundle(e,r){return yVe(this.getAssetUrl,this.matcher,e,r)}};function vVe(t){return new _Ve(t)}const Vie={};XFe(vVe({pattern:"esri/",location:jr}));const bVe={};function wVe(t){const e={async:t.async,isDebug:t.isDebug,locale:t.locale,baseUrl:t.baseUrl,has:{...t.has},map:{...t.map},packages:t.packages&&t.packages.concat()||[],paths:{...t.paths}};return t.hasOwnProperty("async")||(e.async=!0),t.hasOwnProperty("isDebug")||(e.isDebug=!1),t.baseUrl||(e.baseUrl=bVe.baseUrl),e}let xVe=class{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(r=>{this[r]=(...i)=>e[r](...i)})}},lN=class{constructor(){this._dispatcher=new xVe,this._workerPostMessage({type:Vo.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){hE(()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))})}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,r,i){this._dispatcher.addEventListener(e,r,i)}removeEventListener(e,r,i){this._dispatcher.removeEventListener(e,r,i)}_workerPostMessage(e){hE(()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))})}async _workerMessageHandler(e){const r=fM(e);if(r&&r.type===Vo.OPEN){const{modulePath:i,jobId:s}=r;let n=await hv.loadWorker(i);n||(n=await he(()=>import(i),[],import.meta.url));const o=hv.connect(n);this._workerPostMessage({type:Vo.OPENED,jobId:s,data:o})}}};const ZG=K.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:TVe}=Vo,SVe='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,s)=>{if(t){if(t.aborted)return s(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:ABORT,jobId:n}),s(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:s}),self.postMessage({type:INVOKE,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,fullVersion:r}=configuration.kernelInfo,{revision:t,fullVersion:n,version:s}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS Maps SDK for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\\nModules version: ${r}\\nAssets version: ${n??s}\\nAssets path: ${esriConfig.assetsPath}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case OPEN:let n;function t(e){const o=n.connect(e);self.postMessage({type:OPENED,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case RESPONSE:if(outgoing.has(r)){const s=outgoing.get(r);outgoing.delete(r),o.error?s.reject(JSON.parse(o.error)):s.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let II,$I;const Bie="Failed to create Worker. Fallback to execute module in main thread";async function EVe(){if(!ae("esri-workers")||(ae("mozilla"),0))return Gie(new lN);if(!II&&!$I)try{const e=SVe.split('"{CONFIGURATION}"').join(`'${CVe()}'`);II=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){$I=e||{}}let t;if(II)try{t=new Worker(II,{name:"esri-worker-"+AVe++})}catch{ZG.warn(Bie,$I),t=new lN}else ZG.warn(Bie,$I),t=new lN;return Gie(t)}async function Gie(t){return new Promise(e=>{function r(s){const n=fM(s);n&&n.type===TVe&&(t.removeEventListener("message",r),t.removeEventListener("error",i),e(t))}function i(s){s.preventDefault(),t.removeEventListener("message",r),t.removeEventListener("error",i),ZG.warn("Failed to create Worker. Fallback to execute module in main thread",s),(t=new lN).addEventListener("message",r),t.addEventListener("error",i)}t.addEventListener("message",r),t.addEventListener("error",i)})}function CVe(){let t;if(Gr.default!=null){const s={...Gr};delete s.default,t=JSON.parse(JSON.stringify(s))}else t=JSON.parse(JSON.stringify(Gr));t.assetsPath=_u(t.assetsPath),t.defaultAssetsPath=t.defaultAssetsPath?_u(t.defaultAssetsPath):void 0,t.request.interceptors=[],t.log.interceptors=[],t.locale=bp(),t.has={"esri-csp-restrictions":ae("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":ae("esri-2d-update-debug"),"esri-2d-log-updating":ae("esri-2d-log-updating"),"featurelayer-pbf":ae("featurelayer-pbf"),"featurelayer-simplify-thresholds":ae("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":ae("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":ae("featurelayer-simplify-mobile-factor"),"esri-atomics":ae("esri-atomics"),"esri-shared-array-buffer":ae("esri-shared-array-buffer"),"esri-tiles-debug":ae("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":ae("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":ae("feature-polyline-generalization-factor"),"host-webworker":1,"polylabel-placement-enabled":ae("polylabel-placement-enabled")},t.workers.loaderUrl&&(t.workers.loaderUrl=_u(t.workers.loaderUrl)),t.workers.workerPath?t.workers.workerPath=_u(t.workers.workerPath):t.workers.workerPath=_u(jr("esri/core/workers/RemoteClient.js")),t.workers.useDynamicImport=!1;const e=Gr.workers.loaderConfig,r=wVe({baseUrl:e?.baseUrl,locale:bp(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...e?.has},map:{...e?.map},paths:{...e?.paths},packages:e?.packages||[]});return JSON.stringify({esriConfig:t,loaderConfig:r,kernelInfo:{buildDate:eye,fullVersion:aZ,revision:tye}})}let AVe=0;const{ABORT:jie,INVOKE:OVe,OPEN:RVe,OPENED:MVe,RESPONSE:c3}=Vo;let PVe=class C1e{static async create(e){const r=await EVe();return new C1e(r,e)}constructor(e,r){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=r,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",i=>{i.preventDefault(),K.getLogger("esri.core.workers.WorkerOwner").error(i)})}terminate(){this.worker.terminate()}async open(e,r={}){const{signal:i}=r,s=T1e();return new Promise((n,o)=>{const a={resolve:n,reject:o,abortHandle:RY(i,()=>{this._outJobs.delete(s),this._post({type:jie,jobId:s})})};this._outJobs.set(s,a),this._post({type:RVe,jobId:s,modulePath:e})})}_onMessage(e){const r=fM(e);if(r)switch(r.type){case MVe:this._onOpenedMessage(r);break;case c3:this._onResponseMessage(r);break;case jie:this._onAbortMessage(r);break;case OVe:this._onInvokeMessage(r)}}_onAbortMessage(e){const r=this._inJobs,i=e.jobId,s=r.get(i);s&&(s.controller&&s.controller.abort(),r.delete(i))}_onInvokeMessage(e){const{methodName:r,jobId:i,data:s,abortable:n}=e,o=n?new AbortController:null,a=this._inJobs,l=X5e[r];let c;try{if(typeof l!="function")throw new TypeError(`${r} is not a function`);c=l.call(null,s,{signal:o?o.signal:null})}catch(h){return void this._post({type:c3,jobId:i,error:pM(h)})}ku(c)?(a.set(i,{controller:o,promise:c}),c.then(h=>{a.has(i)&&(a.delete(i),this._post({type:c3,jobId:i},h))},h=>{a.has(i)&&(a.delete(i),h||(h={message:"Error encountered at method"+r}),ds(h)||this._post({type:c3,jobId:i,error:pM(h||{message:`Error encountered at method ${r}`})}))})):this._post({type:c3,jobId:i},c)}_onOpenedMessage(e){const{jobId:r,data:i}=e,s=this._outJobs.get(r);s&&(this._outJobs.delete(r),Fi(s.abortHandle),s.resolve(i))}_onResponseMessage(e){const{jobId:r,error:i,data:s}=e,n=this._outJobs.get(r);n&&(this._outJobs.delete(r),Fi(n.abortHandle),i?n.reject(U.fromJSON(JSON.parse(i))):n.resolve(s))}_post(e,r,i){return uJ(this.worker,e,r,i)}};const Hie=ae("host-browser")?Math.min(navigator.hardwareConcurrency-1,ae("workers-pool-size")):0;let ew=ae("esri-mobile")?Math.min(Hie,3):Hie;ew||(ew=ae("safari")&&ae("mac")?7:2);let qie=0;const cN=[];function IVe(){O1e()}async function LI(t,e){const r=new pVe;return await r.open(t,e),r}async function A1e(t,e={}){if(typeof t!="string")throw new U("workers:undefined-module","modulePath is missing");let r=e.strategy||"distributed";if(ae("host-webworker")&&!ae("esri-workers")&&(r="local"),r==="local"){let i=await hv.loadWorker(t);i||(i=await he(()=>import(t),[],import.meta.url)),Yt(e.signal);const s=e.client||i;return LI([hv.connect(i)],{...e,client:s})}if(await O1e(),Yt(e.signal),r==="dedicated"){const i=qie++%ew;return LI([await cN[i].open(t,e)],e)}if(e.maxNumWorkers&&e.maxNumWorkers>0){const i=Math.min(e.maxNumWorkers,ew);if(i<ew){const s=new Array(i);for(let n=0;n<i;++n){const o=qie++%ew;s[n]=cN[o].open(t,e)}return LI(s,e)}}return LI(cN.map(i=>i.open(t,e)),e)}let DI=null;async function O1e(){if(DI)return DI;new AbortController;const t=[];for(let e=0;e<ew;e++){const r=PVe.create(e).then(i=>(cN[e]=i,i));t.push(r)}return DI=Promise.all(t),DI}let tm=class extends Te{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._handles=new $i,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll(),this._handles.destroy()}add(e,r,i={}){return this._installWatch(e,r,i,le)}addWhen(e,r,i={}){return this._installWatch(e,r,i,Iu)}addOnCollectionChange(e,r,{initial:i=!1,final:s=!1}={}){const n=++this._handleId;return this._handles.add([_a(e,"after-changes",this._createSyncUpdatingCallback(),Wr),_a(e,"change",r,{onListenerAdd:i?o=>r({added:o.toArray(),removed:[]}):void 0,onListenerRemove:s?o=>r({added:[],removed:o.toArray()}):void 0})],n),nl(()=>this._handles.remove(n))}addPromise(e){if(e==null)return e;const r=++this._handleId;this._handles.add({remove:()=>{this._pendingPromises.delete(e)&&(this._pendingPromises.size!==0||this._handles.has(NI)||this._set("updating",!1))}},r),this._pendingPromises.add(e),this._set("updating",!0);const i=()=>this._handles.remove(r);return e.then(i,i),e}removeAll(){this._pendingPromises.clear(),this._handles.removeAll(),this._set("updating",!1)}_installWatch(e,r,i={},s){const n=++this._handleId;i.sync||this._installSyncUpdatingWatch(e,n);const o=s(e,r,i);return this._handles.add(o,n),nl(()=>this._handles.remove(n))}_installSyncUpdatingWatch(e,r){const i=this._createSyncUpdatingCallback(),s=le(e,i,{sync:!0,equals:()=>!1});return this._handles.add(s,r),s}_createSyncUpdatingCallback(){return()=>{this._handles.remove(NI),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this._handles.add(gC(()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this._handles.remove(NI))}),NI)}}};u([p({readOnly:!0})],tm.prototype,"updating",void 0),tm=u([P("esri.core.support.WatchUpdatingTracking")],tm);const NI=-42,m8=t=>{let e=class extends t{constructor(){super(...arguments),this._handles=new $i,this._updatingHandles=new tm}destroy(){this.destroyed||(this._handles.destroy(),this._updatingHandles.destroy())}get handles(){return this._handles}get updatingHandles(){return this._updatingHandles}};return u([p({readOnly:!0})],e.prototype,"handles",null),u([p({readOnly:!0})],e.prototype,"updatingHandles",null),e=u([P("esri.core.HandleOwner")],e),e};let mM=class extends m8(Te){};mM=u([P("esri.core.HandleOwner")],mM);let pR=class extends m8(Pt){constructor(e){super(e),this.handles.add([this.on("before-add",r=>{r.item==null&&r.preventDefault()}),this.on("after-add",r=>this._own(r.item)),this.on("after-remove",r=>this._release(r.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(Pt.ofType(this.itemType.Type))(e):new Pt(e)}};function JG(t,e){return{type:t,cast:T0e,set(r){const i=Pw(r,this._get(e),t);i.owner=this,this._set(e,i)}}}u([p()],pR.prototype,"owner",null),pR=u([P("esri.core.support.OwningCollection")],pR);var HA;const T5=ll()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),R1e=T5.jsonValues.slice();JR(R1e,"orthometric");const fR=ll()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let Od=HA=class extends ue{constructor(t){super(t),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(t,e,r){return T5.write(t,e,r)}readHeightModel(t,e,r){return T5.read(t)||(r&&r.messages&&r.messages.push($Ve(t,{context:r})),null)}readHeightUnit(t,e,r){return fR.read(t)||(r&&r.messages&&r.messages.push(Wie(t,{context:r})),null)}readHeightUnitService(t,e,r){return Z0e(t)||fR.read(t)||(r&&r.messages&&r.messages.push(Wie(t,{context:r})),null)}readVertCRS(t,e){return e.vertCRS||e.ellipsoid||e.geoid}clone(){return new HA({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(t){return!!t&&(this===t||this.heightModel===t.heightModel&&this.heightUnit===t.heightUnit&&this.vertCRS===t.vertCRS)}static deriveUnitFromSR(t,e){const r=U5e(e);return new HA({heightModel:t.heightModel,heightUnit:r,vertCRS:t.vertCRS})}write(t,e){return e={origin:"web-scene",...e},super.write(t,e)}static fromJSON(t){if(!t)return null;const e=new HA;return e.read(t,{origin:"web-scene"}),e}};function Wie(t,e){return new jh("height-unit:unsupported",`Height unit of value '${t}' is not supported`,e)}function $Ve(t,e){return new jh("height-model:unsupported",`Height model of value '${t}' is not supported`,e)}u([p({type:T5.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:R1e,default:"ellipsoidal"}}}})],Od.prototype,"heightModel",void 0),u([Be("web-scene","heightModel")],Od.prototype,"writeHeightModel",null),u([Oe(["web-scene","service"],"heightModel")],Od.prototype,"readHeightModel",null),u([p({type:fR.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:fR.jsonValues,write:fR.write}}}})],Od.prototype,"heightUnit",void 0),u([Oe("web-scene","heightUnit")],Od.prototype,"readHeightUnit",null),u([Oe("service","heightUnit")],Od.prototype,"readHeightUnitService",null),u([p({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],Od.prototype,"vertCRS",void 0),u([Oe("service","vertCRS",["vertCRS","ellipsoid","geoid"])],Od.prototype,"readVertCRS",null),Od=HA=u([P("esri.geometry.HeightModelInfo")],Od);const Ax=Od;function zs(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Pm(t,e,r,i,s,n,o,a,l,c,h,d,f,m,g,_,v){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t[4]=n,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t[9]=h,t[10]=d,t[11]=f,t[12]=m,t[13]=g,t[14]=_,t[15]=v,t}function Yh(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function kc(t,e){if(t===e){const r=e[1],i=e[2],s=e[3],n=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=n,t[11]=e[14],t[12]=s,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function OC(t,e){return $n(t,e)||Yh(t),t}function $n(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],d=e[9],f=e[10],m=e[11],g=e[12],_=e[13],v=e[14],b=e[15],T=r*a-i*o,x=r*l-s*o,S=r*c-n*o,E=i*l-s*a,A=i*c-n*a,R=s*c-n*l,M=h*_-d*g,D=h*v-f*g,k=h*b-m*g,L=d*v-f*_,N=d*b-m*_,q=f*b-m*v;let X=T*q-x*N+S*L+E*k-A*D+R*M;return X?(X=1/X,t[0]=(a*q-l*N+c*L)*X,t[1]=(s*N-i*q-n*L)*X,t[2]=(_*R-v*A+b*E)*X,t[3]=(f*A-d*R-m*E)*X,t[4]=(l*k-o*q-c*D)*X,t[5]=(r*q-s*k+n*D)*X,t[6]=(v*S-g*R-b*x)*X,t[7]=(h*R-f*S+m*x)*X,t[8]=(o*N-a*k+c*M)*X,t[9]=(i*k-r*N-n*M)*X,t[10]=(g*A-_*S+b*T)*X,t[11]=(d*S-h*A-m*T)*X,t[12]=(a*D-o*L-l*M)*X,t[13]=(r*L-i*D+s*M)*X,t[14]=(_*x-g*E-v*T)*X,t[15]=(h*E-d*x+f*T)*X,t):null}function LVe(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],d=e[9],f=e[10],m=e[11],g=e[12],_=e[13],v=e[14],b=e[15];return t[0]=a*(f*b-m*v)-d*(l*b-c*v)+_*(l*m-c*f),t[1]=-(i*(f*b-m*v)-d*(s*b-n*v)+_*(s*m-n*f)),t[2]=i*(l*b-c*v)-a*(s*b-n*v)+_*(s*c-n*l),t[3]=-(i*(l*m-c*f)-a*(s*m-n*f)+d*(s*c-n*l)),t[4]=-(o*(f*b-m*v)-h*(l*b-c*v)+g*(l*m-c*f)),t[5]=r*(f*b-m*v)-h*(s*b-n*v)+g*(s*m-n*f),t[6]=-(r*(l*b-c*v)-o*(s*b-n*v)+g*(s*c-n*l)),t[7]=r*(l*m-c*f)-o*(s*m-n*f)+h*(s*c-n*l),t[8]=o*(d*b-m*_)-h*(a*b-c*_)+g*(a*m-c*d),t[9]=-(r*(d*b-m*_)-h*(i*b-n*_)+g*(i*m-n*d)),t[10]=r*(a*b-c*_)-o*(i*b-n*_)+g*(i*c-n*a),t[11]=-(r*(a*m-c*d)-o*(i*m-n*d)+h*(i*c-n*a)),t[12]=-(o*(d*v-f*_)-h*(a*v-l*_)+g*(a*f-l*d)),t[13]=r*(d*v-f*_)-h*(i*v-s*_)+g*(i*f-s*d),t[14]=-(r*(a*v-l*_)-o*(i*v-s*_)+g*(i*l-s*a)),t[15]=r*(a*f-l*d)-o*(i*f-s*d)+h*(i*l-s*a),t}function DVe(t){const e=t[0],r=t[1],i=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=t[9],d=t[10],f=t[11],m=t[12],g=t[13],_=t[14],v=t[15];return(e*o-r*n)*(d*v-f*_)-(e*a-i*n)*(h*v-f*g)+(e*l-s*n)*(h*_-d*g)+(r*a-i*o)*(c*v-f*m)-(r*l-s*o)*(c*_-d*m)+(i*l-s*a)*(c*g-h*m)}function ai(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=e[8],f=e[9],m=e[10],g=e[11],_=e[12],v=e[13],b=e[14],T=e[15];let x=r[0],S=r[1],E=r[2],A=r[3];return t[0]=x*i+S*a+E*d+A*_,t[1]=x*s+S*l+E*f+A*v,t[2]=x*n+S*c+E*m+A*b,t[3]=x*o+S*h+E*g+A*T,x=r[4],S=r[5],E=r[6],A=r[7],t[4]=x*i+S*a+E*d+A*_,t[5]=x*s+S*l+E*f+A*v,t[6]=x*n+S*c+E*m+A*b,t[7]=x*o+S*h+E*g+A*T,x=r[8],S=r[9],E=r[10],A=r[11],t[8]=x*i+S*a+E*d+A*_,t[9]=x*s+S*l+E*f+A*v,t[10]=x*n+S*c+E*m+A*b,t[11]=x*o+S*h+E*g+A*T,x=r[12],S=r[13],E=r[14],A=r[15],t[12]=x*i+S*a+E*d+A*_,t[13]=x*s+S*l+E*f+A*v,t[14]=x*n+S*c+E*m+A*b,t[15]=x*o+S*h+E*g+A*T,t}function Gl(t,e,r){const i=r[0],s=r[1],n=r[2];if(e===t)t[12]=e[0]*i+e[4]*s+e[8]*n+e[12],t[13]=e[1]*i+e[5]*s+e[9]*n+e[13],t[14]=e[2]*i+e[6]*s+e[10]*n+e[14],t[15]=e[3]*i+e[7]*s+e[11]*n+e[15];else{const o=e[0],a=e[1],l=e[2],c=e[3],h=e[4],d=e[5],f=e[6],m=e[7],g=e[8],_=e[9],v=e[10],b=e[11];t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=h,t[5]=d,t[6]=f,t[7]=m,t[8]=g,t[9]=_,t[10]=v,t[11]=b,t[12]=o*i+h*s+g*n+e[12],t[13]=a*i+d*s+_*n+e[13],t[14]=l*i+f*s+v*n+e[14],t[15]=c*i+m*s+b*n+e[15]}return t}function g8(t,e,r){const i=r[0],s=r[1],n=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Rc(t,e,r,i){let s,n,o,a,l,c,h,d,f,m,g,_,v,b,T,x,S,E,A,R,M,D,k,L,N=i[0],q=i[1],X=i[2],G=Math.sqrt(N*N+q*q+X*X);return G<cl()?null:(G=1/G,N*=G,q*=G,X*=G,s=Math.sin(r),n=Math.cos(r),o=1-n,a=e[0],l=e[1],c=e[2],h=e[3],d=e[4],f=e[5],m=e[6],g=e[7],_=e[8],v=e[9],b=e[10],T=e[11],x=N*N*o+n,S=q*N*o+X*s,E=X*N*o-q*s,A=N*q*o-X*s,R=q*q*o+n,M=X*q*o+N*s,D=N*X*o+q*s,k=q*X*o-N*s,L=X*X*o+n,t[0]=a*x+d*S+_*E,t[1]=l*x+f*S+v*E,t[2]=c*x+m*S+b*E,t[3]=h*x+g*S+T*E,t[4]=a*A+d*R+_*M,t[5]=l*A+f*R+v*M,t[6]=c*A+m*R+b*M,t[7]=h*A+g*R+T*M,t[8]=a*D+d*k+_*L,t[9]=l*D+f*k+v*L,t[10]=c*D+m*k+b*L,t[11]=h*D+g*k+T*L,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function EE(t,e,r){const i=Math.sin(r),s=Math.cos(r),n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=e[9],d=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=n*s+c*i,t[5]=o*s+h*i,t[6]=a*s+d*i,t[7]=l*s+f*i,t[8]=c*s-n*i,t[9]=h*s-o*i,t[10]=d*s-a*i,t[11]=f*s-l*i,t}function y8(t,e,r){const i=Math.sin(r),s=Math.cos(r),n=e[0],o=e[1],a=e[2],l=e[3],c=e[8],h=e[9],d=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s-c*i,t[1]=o*s-h*i,t[2]=a*s-d*i,t[3]=l*s-f*i,t[8]=n*i+c*s,t[9]=o*i+h*s,t[10]=a*i+d*s,t[11]=l*i+f*s,t}function CE(t,e,r){const i=Math.sin(r),s=Math.cos(r),n=e[0],o=e[1],a=e[2],l=e[3],c=e[4],h=e[5],d=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s+c*i,t[1]=o*s+h*i,t[2]=a*s+d*i,t[3]=l*s+f*i,t[4]=c*s-n*i,t[5]=h*s-o*i,t[6]=d*s-a*i,t[7]=f*s-l*i,t}function CP(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function NVe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Lu(t,e,r){if(e===0)return Yh(t);let i,s,n,o=r[0],a=r[1],l=r[2],c=Math.sqrt(o*o+a*a+l*l);return c<cl()?null:(c=1/c,o*=c,a*=c,l*=c,i=Math.sin(e),s=Math.cos(e),n=1-s,t[0]=o*o*n+s,t[1]=a*o*n+l*i,t[2]=l*o*n-a*i,t[3]=0,t[4]=o*a*n-l*i,t[5]=a*a*n+s,t[6]=l*a*n+o*i,t[7]=0,t[8]=o*l*n+a*i,t[9]=a*l*n-o*i,t[10]=l*l*n+s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function M1e(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function FVe(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function P1e(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function I1e(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=i+i,l=s+s,c=n+n,h=i*a,d=i*l,f=i*c,m=s*l,g=s*c,_=n*c,v=o*a,b=o*l,T=o*c;return t[0]=1-(m+_),t[1]=d+T,t[2]=f-b,t[3]=0,t[4]=d-T,t[5]=1-(h+_),t[6]=g+v,t[7]=0,t[8]=f+b,t[9]=g-v,t[10]=1-(h+m),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function UVe(t,e){const r=kVe,i=-e[0],s=-e[1],n=-e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=i*i+s*s+n*n+o*o;return d>0?(r[0]=2*(a*o+h*i+l*n-c*s)/d,r[1]=2*(l*o+h*s+c*i-a*n)/d,r[2]=2*(c*o+h*n+a*s-l*i)/d):(r[0]=2*(a*o+h*i+l*n-c*s),r[1]=2*(l*o+h*s+c*i-a*n),r[2]=2*(c*o+h*n+a*s-l*i)),I1e(t,e,r),t}const kVe=O();function QG(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function $1e(t,e){const r=e[0],i=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],h=e[10];return t[0]=Math.sqrt(r*r+i*i+s*s),t[1]=Math.sqrt(n*n+o*o+a*a),t[2]=Math.sqrt(l*l+c*c+h*h),t}function zVe(t,e){const r=e[0]+e[5]+e[10];let i=0;return r>0?(i=2*Math.sqrt(r+1),t[3]=.25*i,t[0]=(e[6]-e[9])/i,t[1]=(e[8]-e[2])/i,t[2]=(e[1]-e[4])/i):e[0]>e[5]&&e[0]>e[10]?(i=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/i,t[0]=.25*i,t[1]=(e[1]+e[4])/i,t[2]=(e[8]+e[2])/i):e[5]>e[10]?(i=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/i,t[0]=(e[1]+e[4])/i,t[1]=.25*i,t[2]=(e[6]+e[9])/i):(i=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/i,t[0]=(e[8]+e[2])/i,t[1]=(e[6]+e[9])/i,t[2]=.25*i),t}function VVe(t,e,r,i){const s=e[0],n=e[1],o=e[2],a=e[3],l=s+s,c=n+n,h=o+o,d=s*l,f=s*c,m=s*h,g=n*c,_=n*h,v=o*h,b=a*l,T=a*c,x=a*h,S=i[0],E=i[1],A=i[2];return t[0]=(1-(g+v))*S,t[1]=(f+x)*S,t[2]=(m-T)*S,t[3]=0,t[4]=(f-x)*E,t[5]=(1-(d+v))*E,t[6]=(_+b)*E,t[7]=0,t[8]=(m+T)*A,t[9]=(_-b)*A,t[10]=(1-(d+g))*A,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function BVe(t,e,r,i,s){const n=e[0],o=e[1],a=e[2],l=e[3],c=n+n,h=o+o,d=a+a,f=n*c,m=n*h,g=n*d,_=o*h,v=o*d,b=a*d,T=l*c,x=l*h,S=l*d,E=i[0],A=i[1],R=i[2],M=s[0],D=s[1],k=s[2],L=(1-(_+b))*E,N=(m+S)*E,q=(g-x)*E,X=(m-S)*A,G=(1-(f+b))*A,J=(v+T)*A,I=(g+x)*R,z=(v-T)*R,V=(1-(f+_))*R;return t[0]=L,t[1]=N,t[2]=q,t[3]=0,t[4]=X,t[5]=G,t[6]=J,t[7]=0,t[8]=I,t[9]=z,t[10]=V,t[11]=0,t[12]=r[0]+M-(L*M+X*D+I*k),t[13]=r[1]+D-(N*M+G*D+z*k),t[14]=r[2]+k-(q*M+J*D+V*k),t[15]=1,t}function GVe(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=r+r,a=i+i,l=s+s,c=r*o,h=i*o,d=i*a,f=s*o,m=s*a,g=s*l,_=n*o,v=n*a,b=n*l;return t[0]=1-d-g,t[1]=h+b,t[2]=f-v,t[3]=0,t[4]=h-b,t[5]=1-c-g,t[6]=m+_,t[7]=0,t[8]=f+v,t[9]=m-_,t[10]=1-c-d,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function L1e(t,e,r,i,s,n,o){const a=1/(r-e),l=1/(s-i),c=1/(n-o);return t[0]=2*n*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*n*l,t[6]=0,t[7]=0,t[8]=(r+e)*a,t[9]=(s+i)*l,t[10]=(o+n)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*n*2*c,t[15]=0,t}function jVe(t,e,r,i,s){const n=1/Math.tan(e/2);let o;return t[0]=n/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(o=1/(i-s),t[10]=(s+i)*o,t[14]=2*s*i*o):(t[10]=-1,t[14]=-2*i),t}function HVe(t,e,r,i){const s=Math.tan(e.upDegrees*Math.PI/180),n=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(s+n);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(o-a)*l*.5,t[9]=(s-n)*c*.5,t[10]=i/(r-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*r/(r-i),t[15]=0,t}function D1e(t,e,r,i,s,n,o){const a=1/(e-r),l=1/(i-s),c=1/(n-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+r)*a,t[13]=(s+i)*l,t[14]=(o+n)*c,t[15]=1,t}function _8(t,e,r,i){const s=e[0],n=e[1],o=e[2];let a=s-r[0],l=n-r[1],c=o-r[2];const h=cl();if(Math.abs(a)<h&&Math.abs(l)<h&&Math.abs(c)<h)return void Yh(t);let d=1/Math.sqrt(a*a+l*l+c*c);a*=d,l*=d,c*=d;const f=i[0],m=i[1],g=i[2];let _=m*c-g*l,v=g*a-f*c,b=f*l-m*a;d=Math.sqrt(_*_+v*v+b*b),d?(d=1/d,_*=d,v*=d,b*=d):(_=0,v=0,b=0);let T=l*b-c*v,x=c*_-a*b,S=a*v-l*_;d=Math.sqrt(T*T+x*x+S*S),d?(d=1/d,T*=d,x*=d,S*=d):(T=0,x=0,S=0),t[0]=_,t[1]=T,t[2]=a,t[3]=0,t[4]=v,t[5]=x,t[6]=l,t[7]=0,t[8]=b,t[9]=S,t[10]=c,t[11]=0,t[12]=-(_*s+v*n+b*o),t[13]=-(T*s+x*n+S*o),t[14]=-(a*s+l*n+c*o),t[15]=1}function N1e(t,e,r,i){const s=e[0],n=e[1],o=e[2],a=i[0],l=i[1],c=i[2];let h=s-r[0],d=n-r[1],f=o-r[2],m=h*h+d*d+f*f;m>0&&(m=1/Math.sqrt(m),h*=m,d*=m,f*=m);let g=l*f-c*d,_=c*h-a*f,v=a*d-l*h;return m=g*g+_*_+v*v,m>0&&(m=1/Math.sqrt(m),g*=m,_*=m,v*=m),t[0]=g,t[1]=_,t[2]=v,t[3]=0,t[4]=d*v-f*_,t[5]=f*g-h*v,t[6]=h*_-d*g,t[7]=0,t[8]=h,t[9]=d,t[10]=f,t[11]=0,t[12]=s,t[13]=n,t[14]=o,t[15]=1,t}function qVe(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function WVe(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2+t[9]**2+t[10]**2+t[11]**2+t[12]**2+t[13]**2+t[14]**2+t[15]**2)}function XVe(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function F1e(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function YVe(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function ZVe(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t[9]=e[9]+r[9]*i,t[10]=e[10]+r[10]*i,t[11]=e[11]+r[11]*i,t[12]=e[12]+r[12]*i,t[13]=e[13]+r[13]*i,t[14]=e[14]+r[14]*i,t[15]=e[15]+r[15]*i,t}function U1e(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function dJ(t,e){if(t===e)return!0;const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],d=t[9],f=t[10],m=t[11],g=t[12],_=t[13],v=t[14],b=t[15],T=e[0],x=e[1],S=e[2],E=e[3],A=e[4],R=e[5],M=e[6],D=e[7],k=e[8],L=e[9],N=e[10],q=e[11],X=e[12],G=e[13],J=e[14],I=e[15],z=cl();return Math.abs(r-T)<=z*Math.max(1,Math.abs(r),Math.abs(T))&&Math.abs(i-x)<=z*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(s-S)<=z*Math.max(1,Math.abs(s),Math.abs(S))&&Math.abs(n-E)<=z*Math.max(1,Math.abs(n),Math.abs(E))&&Math.abs(o-A)<=z*Math.max(1,Math.abs(o),Math.abs(A))&&Math.abs(a-R)<=z*Math.max(1,Math.abs(a),Math.abs(R))&&Math.abs(l-M)<=z*Math.max(1,Math.abs(l),Math.abs(M))&&Math.abs(c-D)<=z*Math.max(1,Math.abs(c),Math.abs(D))&&Math.abs(h-k)<=z*Math.max(1,Math.abs(h),Math.abs(k))&&Math.abs(d-L)<=z*Math.max(1,Math.abs(d),Math.abs(L))&&Math.abs(f-N)<=z*Math.max(1,Math.abs(f),Math.abs(N))&&Math.abs(m-q)<=z*Math.max(1,Math.abs(m),Math.abs(q))&&Math.abs(g-X)<=z*Math.max(1,Math.abs(g),Math.abs(X))&&Math.abs(_-G)<=z*Math.max(1,Math.abs(_),Math.abs(G))&&Math.abs(v-J)<=z*Math.max(1,Math.abs(v),Math.abs(J))&&Math.abs(b-I)<=z*Math.max(1,Math.abs(b),Math.abs(I))}function pJ(t){const e=cl(),r=t[0],i=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],h=t[10];return Math.abs(1-(r*r+n*n+l*l))<=e&&Math.abs(1-(i*i+o*o+c*c))<=e&&Math.abs(1-(s*s+a*a+h*h))<=e}function v8(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[8]===0&&t[9]===0&&t[10]===1}const JVe=ai,QVe=F1e;Object.freeze(Object.defineProperty({__proto__:null,add:XVe,adjoint:LVe,copy:zs,determinant:DVe,equals:dJ,exactEquals:U1e,frob:WVe,fromQuat:GVe,fromQuat2:UVe,fromRotation:Lu,fromRotationTranslation:I1e,fromRotationTranslationScale:VVe,fromRotationTranslationScaleOrigin:BVe,fromScaling:NVe,fromTranslation:CP,fromXRotation:M1e,fromYRotation:FVe,fromZRotation:P1e,frustum:L1e,getRotation:zVe,getScaling:$1e,getTranslation:QG,hasIdentityRotation:v8,identity:Yh,invert:$n,invertOrIdentity:OC,isOrthoNormal:pJ,lookAt:_8,mul:JVe,multiply:ai,multiplyScalar:YVe,multiplyScalarAndAdd:ZVe,ortho:D1e,perspective:jVe,perspectiveFromFieldOfView:HVe,rotate:Rc,rotateX:EE,rotateY:y8,rotateZ:CE,scale:g8,set:Pm,str:qVe,sub:QVe,subtract:F1e,targetTo:N1e,translate:Gl,transpose:kc},Symbol.toStringTag,{value:"Module"}));let XU,re=null;function k1e(){return!!re}function KVe(){return!!ae("esri-wasm")}function z1e(){return XU||(XU=he(()=>import("./pe-wasm-767425cf.js"),[],import.meta.url).then(t=>t.p).then(({default:t})=>t({locateFile:e=>jr(`esri/geometry/support/${e}`)})).then(t=>{B1e(t)}),XU)}var KG,Ms,ej;(function(t){function e(n,o,a){re.ensureCache.prepare();const l=Fb(a),c=a===l,h=re.ensureFloat64(l),d=re._pe_geog_to_proj(re.getPointer(n),o,h);return d&&T_(a,o,h,c),d}function r(n,o,a,l){switch(l){case Ms.PE_TRANSFORM_P_TO_G:return i(n,o,a);case Ms.PE_TRANSFORM_G_TO_P:return e(n,o,a)}return 0}function i(n,o,a){return s(n,o,a,0)}function s(n,o,a,l){re.ensureCache.prepare();const c=Fb(a),h=a===c,d=re.ensureFloat64(c),f=re._pe_proj_to_geog_center(re.getPointer(n),o,d,l);return f&&T_(a,o,d,h),f}t.geogToProj=e,t.projGeog=r,t.projToGeog=i,t.projToGeogCenter=s})(KG||(KG={})),function(t){function e(){t.PE_BUFFER_MAX=re.PeDefs.prototype.PE_BUFFER_MAX,t.PE_NAME_MAX=re.PeDefs.prototype.PE_NAME_MAX,t.PE_MGRS_MAX=re.PeDefs.prototype.PE_MGRS_MAX,t.PE_USNG_MAX=re.PeDefs.prototype.PE_USNG_MAX,t.PE_DD_MAX=re.PeDefs.prototype.PE_DD_MAX,t.PE_DDM_MAX=re.PeDefs.prototype.PE_DDM_MAX,t.PE_DMS_MAX=re.PeDefs.prototype.PE_DMS_MAX,t.PE_UTM_MAX=re.PeDefs.prototype.PE_UTM_MAX,t.PE_PARM_MAX=re.PeDefs.prototype.PE_PARM_MAX,t.PE_TYPE_NONE=re.PeDefs.prototype.PE_TYPE_NONE,t.PE_TYPE_GEOGCS=re.PeDefs.prototype.PE_TYPE_GEOGCS,t.PE_TYPE_PROJCS=re.PeDefs.prototype.PE_TYPE_PROJCS,t.PE_TYPE_GEOGTRAN=re.PeDefs.prototype.PE_TYPE_GEOGTRAN,t.PE_TYPE_COORDSYS=re.PeDefs.prototype.PE_TYPE_COORDSYS,t.PE_TYPE_UNIT=re.PeDefs.prototype.PE_TYPE_UNIT,t.PE_TYPE_LINUNIT=re.PeDefs.prototype.PE_TYPE_LINUNIT,t.PE_STR_OPTS_NONE=re.PeDefs.prototype.PE_STR_OPTS_NONE,t.PE_STR_AUTH_NONE=re.PeDefs.prototype.PE_STR_AUTH_NONE,t.PE_STR_AUTH_TOP=re.PeDefs.prototype.PE_STR_AUTH_TOP,t.PE_STR_NAME_CANON=re.PeDefs.prototype.PE_STR_NAME_CANON,t.PE_PARM_X0=re.PeDefs.prototype.PE_PARM_X0,t.PE_PARM_ND=re.PeDefs.prototype.PE_PARM_ND,t.PE_TRANSFORM_1_TO_2=re.PeDefs.prototype.PE_TRANSFORM_1_TO_2,t.PE_TRANSFORM_2_TO_1=re.PeDefs.prototype.PE_TRANSFORM_2_TO_1,t.PE_TRANSFORM_P_TO_G=re.PeDefs.prototype.PE_TRANSFORM_P_TO_G,t.PE_TRANSFORM_G_TO_P=re.PeDefs.prototype.PE_TRANSFORM_G_TO_P,t.PE_HORIZON_RECT=re.PeDefs.prototype.PE_HORIZON_RECT,t.PE_HORIZON_POLY=re.PeDefs.prototype.PE_HORIZON_POLY,t.PE_HORIZON_LINE=re.PeDefs.prototype.PE_HORIZON_LINE,t.PE_HORIZON_DELTA=re.PeDefs.prototype.PE_HORIZON_DELTA}t.init=e}(Ms||(Ms={})),function(t){const e={},r={},i=m=>{if(m){const g=m.getType();switch(g){case Ms.PE_TYPE_GEOGCS:m=re.castObject(m,re.PeGeogcs);break;case Ms.PE_TYPE_PROJCS:m=re.castObject(m,re.PeProjcs);break;case Ms.PE_TYPE_GEOGTRAN:m=re.castObject(m,re.PeGeogtran);break;default:g&Ms.PE_TYPE_UNIT&&(m=re.castObject(m,re.PeUnit))}}return m};function s(){re.PeFactory.prototype.initialize(null)}function n(m){return o(Ms.PE_TYPE_COORDSYS,m)}function o(m,g){let _=null,v=e[m];if(v||(v={},e[m]=v),v.hasOwnProperty(String(g)))_=v[g];else{const b=re.PeFactory.prototype.factoryByType(m,g);re.compare(b,re.NULL)||(_=b,v[g]=_)}return _=i(_),_}function a(m,g){let _=null,v=r[m];if(v||(v={},r[m]=v),v.hasOwnProperty(g))_=v[g];else{const b=re.PeFactory.prototype.fromString(m,g);re.compare(b,re.NULL)||(_=b,v[g]=_)}return _=i(_),_}function l(m){return o(Ms.PE_TYPE_GEOGCS,m)}function c(m){return o(Ms.PE_TYPE_GEOGTRAN,m)}function h(m){return re.PeFactory.prototype.getCode(m)}function d(m){return o(Ms.PE_TYPE_PROJCS,m)}function f(m){return o(Ms.PE_TYPE_UNIT,m)}t.initialize=s,t.coordsys=n,t.factoryByType=o,t.fromString=a,t.geogcs=l,t.geogtran=c,t.getCode=h,t.projcs=d,t.unit=f}(ej||(ej={}));let V1e=null;var S5,tj,rj,ij,E5,sj,C5,A5,nj;function B1e(t){function e(n,o,a){n[o]=a(n[o])}re=t,Ms.init(),S5.init(),E5.init(),C5.init(),A5.init(),V1e=class extends re.PeGCSExtent{destroy(){re.destroy(this)}};const r=[re.PeDatum,re.PeGeogcs,re.PeGeogtran,re.PeObject,re.PeParameter,re.PePrimem,re.PeProjcs,re.PeSpheroid,re.PeUnit];for(const n of r)e(n.prototype,"getName",o=>function(){return o.call(this,new Array(Ms.PE_NAME_MAX))});for(const n of[re.PeGeogtran,re.PeProjcs])e(n.prototype,"getParameters",o=>function(){const a=new Array(Ms.PE_PARM_MAX);let l=o.call(this);for(let c=0;c<a.length;c++){const h=re.getValue(l,"*");a[c]=h?re.wrapPointer(h,re.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return a});e(re.PeHorizon.prototype,"getCoord",n=>function(){const o=this.getSize();if(!o)return null;const a=[];return T_(a,o,n.call(this)),a}),e(re.PeGTlistExtendedEntry.prototype,"getEntries",n=>{const o=re._pe_getPeGTlistExtendedGTsSize();return function(){let a=null;const l=n.call(this);if(!re.compare(l,re.NULL)){a=[l];const c=this.getSteps();if(c>1){const h=re.getPointer(l);for(let d=1;d<c;d++)a.push(re.wrapPointer(h+o*d,re.PeGTlistExtendedGTs))}}return a}});const i=re._pe_getPeHorizonSize(),s=n=>function(){let o=this._cache;if(o||(o=new Map,this._cache=o),o.has(n))return o.get(n);let a=null;const l=n.call(this);if(!re.compare(l,re.NULL)){a=[l];const c=l.getNump();if(c>1){const h=re.getPointer(l);for(let d=1;d<c;d++)a.push(re.wrapPointer(h+i*d,re.PeHorizon))}}return o.set(n,a),a};e(re.PeProjcs.prototype,"horizonGcsGenerate",s),e(re.PeProjcs.prototype,"horizonPcsGenerate",s),re.PeObject.prototype.toString=function(n=Ms.PE_STR_OPTS_NONE){re.ensureCache.prepare();const o=re.getPointer(this),a=re.ensureInt8(new Array(Ms.PE_BUFFER_MAX));return re.UTF8ToString(re._pe_object_to_string_ext(o,n,a))}}function km(t){if(!t)return;const e=re.getClass(t);if(!e)return;const r=re.getCache(e);if(!r)return;const i=re.getPointer(t);i&&delete r[i]}function FI(t,e){const r=[],i=new Array(e);for(let s=0;s<t;s++)r.push(re.ensureInt8(i));return r}function Fb(t){let e;return Array.isArray(t[0])?(e=[],t.forEach(r=>{e.push(r[0],r[1])})):e=t,e}function T_(t,e,r,i=!1){if(i)for(let s=0;s<2*e;s++)t[s]=re.getValue(r+s*Float64Array.BYTES_PER_ELEMENT,"double");else{const s=t.length===0;for(let n=0;n<e;n++)s&&(t[n]=new Array(2)),t[n][0]=re.getValue(r,"double"),t[n][1]=re.getValue(r+Float64Array.BYTES_PER_ELEMENT,"double"),r+=2*Float64Array.BYTES_PER_ELEMENT}}(function(t){let e;function r(){t.PE_GTLIST_OPTS_COMMON=re.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,e=re._pe_getPeGTlistExtendedEntrySize()}function i(s,n,o,a,l,c){let h=null;const d=new re.PeInteger(c);try{const f=re.PeGTlistExtended.prototype.getGTlist(s,n,o,a,l,d);if((c=d.val)&&(h=[f],c>1)){const m=re.getPointer(f);for(let g=1;g<c;g++)h.push(re.wrapPointer(m+e*g,re.PeGTlistExtendedEntry))}}finally{re.destroy(d)}return h}t.init=r,t.getGTlist=i})(S5||(S5={})),function(t){function e(r){if(r&&r.length){for(const i of r)km(i),i.getEntries().forEach(s=>{km(s);const n=s.getGeogtran();km(n),n.getParameters().forEach(km),[n.getGeogcs1(),n.getGeogcs2()].forEach(o=>{km(o);const a=o.getDatum();km(a),km(a.getSpheroid()),km(o.getPrimem()),km(o.getUnit())})});re.PeGTlistExtendedEntry.prototype.Delete(r[0])}}t.destroy=e}(tj||(tj={})),function(t){function e(r,i,s,n,o){re.ensureCache.prepare();const a=Fb(s),l=s===a,c=re.ensureFloat64(a);let h=0;n&&(h=re.ensureFloat64(n));const d=re._pe_geog_to_geog(re.getPointer(r),i,c,h,o);return d&&T_(s,i,c,l),d}t.geogToGeog=e}(rj||(rj={})),function(t){const e=(c,h,d,f,m,g)=>{let _,v;switch(re.ensureCache.prepare(),c){case"dd":_=re._pe_geog_to_dd,v=Ms.PE_DD_MAX;break;case"ddm":_=re._pe_geog_to_ddm,v=Ms.PE_DDM_MAX;break;case"dms":_=re._pe_geog_to_dms,v=Ms.PE_DMS_MAX}let b=0;h&&(b=re.getPointer(h));const T=Fb(f),x=re.ensureFloat64(T),S=FI(d,v),E=_(b,d,x,m,re.ensureInt32(S));if(E)for(let A=0;A<d;A++)g[A]=re.UTF8ToString(S[A]);return E},r=(c,h,d,f,m)=>{let g;switch(re.ensureCache.prepare(),c){case"dd":g=re._pe_dd_to_geog;break;case"ddm":g=re._pe_ddm_to_geog;break;case"dms":g=re._pe_dms_to_geog}let _=0;h&&(_=re.getPointer(h));const v=f.map(S=>re.ensureString(S)),b=re.ensureInt32(v),T=re.ensureFloat64(new Array(2*d)),x=g(_,d,b,T);return x&&T_(m,d,T),x};function i(c,h,d,f,m){return e("dms",c,h,d,f,m)}function s(c,h,d,f){return r("dms",c,h,d,f)}function n(c,h,d,f,m){return e("ddm",c,h,d,f,m)}function o(c,h,d,f){return r("ddm",c,h,d,f)}function a(c,h,d,f,m){return e("dd",c,h,d,f,m)}function l(c,h,d,f){return r("dd",c,h,d,f)}t.geogToDms=i,t.dmsToGeog=s,t.geogToDdm=n,t.ddmToGeog=o,t.geogToDd=a,t.ddToGeog=l}(ij||(ij={})),function(t){function e(){t.PE_MGRS_STYLE_NEW=re.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,t.PE_MGRS_STYLE_OLD=re.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,t.PE_MGRS_STYLE_AUTO=re.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,t.PE_MGRS_180_ZONE_1_PLUS=re.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,t.PE_MGRS_ADD_SPACES=re.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function r(s,n,o,a,l,c,h){re.ensureCache.prepare();let d=0;s&&(d=re.getPointer(s));const f=Fb(o),m=re.ensureFloat64(f),g=FI(n,Ms.PE_MGRS_MAX),_=re.ensureInt32(g),v=re._pe_geog_to_mgrs_extended(d,n,m,a,l,c,_);if(v)for(let b=0;b<n;b++)h[b]=re.UTF8ToString(g[b]);return v}function i(s,n,o,a,l){re.ensureCache.prepare();let c=0;s&&(c=re.getPointer(s));const h=o.map(g=>re.ensureString(g)),d=re.ensureInt32(h),f=re.ensureFloat64(new Array(2*n)),m=re._pe_mgrs_to_geog_extended(c,n,d,a,f);return m&&T_(l,n,f),m}t.init=e,t.geogToMgrsExtended=r,t.mgrsToGeogExtended=i}(E5||(E5={})),function(t){function e(i,s,n,o,a,l,c){re.ensureCache.prepare();let h=0;i&&(h=re.getPointer(i));const d=Fb(n),f=re.ensureFloat64(d),m=FI(s,Ms.PE_MGRS_MAX),g=re.ensureInt32(m),_=re._pe_geog_to_usng(h,s,f,o,a,l,g);if(_)for(let v=0;v<s;v++)c[v]=re.UTF8ToString(m[v]);return _}function r(i,s,n,o){re.ensureCache.prepare();let a=0;i&&(a=re.getPointer(i));const l=n.map(f=>re.ensureString(f)),c=re.ensureInt32(l),h=re.ensureFloat64(new Array(2*s)),d=re._pe_usng_to_geog(a,s,c,h);return d&&T_(o,s,h),d}t.geogToUsng=e,t.usngToGeog=r}(sj||(sj={})),function(t){function e(){t.PE_UTM_OPTS_NONE=re.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,t.PE_UTM_OPTS_ADD_SPACES=re.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,t.PE_UTM_OPTS_NS=re.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function r(s,n,o,a,l){re.ensureCache.prepare();let c=0;s&&(c=re.getPointer(s));const h=Fb(o),d=re.ensureFloat64(h),f=FI(n,Ms.PE_UTM_MAX),m=re.ensureInt32(f),g=re._pe_geog_to_utm(c,n,d,a,m);if(g)for(let _=0;_<n;_++)l[_]=re.UTF8ToString(f[_]);return g}function i(s,n,o,a,l){re.ensureCache.prepare();let c=0;s&&(c=re.getPointer(s));const h=o.map(g=>re.ensureString(g)),d=re.ensureInt32(h),f=re.ensureFloat64(new Array(2*n)),m=re._pe_utm_to_geog(c,n,d,a,f);return m&&T_(l,n,f),m}t.init=e,t.geogToUtm=r,t.utmToGeog=i}(C5||(C5={})),function(t){const e=new Map;function r(){t.PE_PCSINFO_OPTION_NONE=re.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,t.PE_PCSINFO_OPTION_DOMAIN=re.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,t.PE_POLE_OUTSIDE_BOUNDARY=re.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,t.PE_POLE_POINT=re.PePCSInfo.prototype.PE_POLE_POINT}function i(s,n=t.PE_PCSINFO_OPTION_DOMAIN){let o=null,a=null;return e.has(s)&&(a=e.get(s),a[n]&&(o=a[n])),o||(o=re.PePCSInfo.prototype.generate(s,n),a||(a=[],e.set(s,a)),a[n]=o),o}t.init=r,t.generate=i}(A5||(A5={})),function(t){function e(){return re.PeVersion.prototype.version_string()}t.versionString=e}(nj||(nj={}));const e7e=Object.freeze(Object.defineProperty({__proto__:null,get PeCSTransformations(){return KG},get PeDefs(){return Ms},get PeFactory(){return ej},get PeGCSExtent(){return V1e},get PeGTTransformations(){return rj},get PeGTlistExtended(){return S5},get PeGTlistExtendedEntry(){return tj},get PeNotationDms(){return ij},get PeNotationMgrs(){return E5},get PeNotationUsng(){return sj},get PeNotationUtm(){return C5},get PePCSInfo(){return A5},get PeVersion(){return nj},_init:B1e,get _pe(){return re},isLoaded:k1e,isSupported:KVe,load:z1e},Symbol.toStringTag,{value:"Module"})),G5t=Math.PI/180,j5t=/SPHEROID\[([^\]]+)]/i,ry=nr.radius,pd=nr.eccentricitySquared,t7e={a1:ry*pd,a2:ry*pd*ry*pd,a3:ry*pd*pd/2,a4:ry*pd*ry*pd*2.5,a5:ry*pd+ry*pd*pd/2,a6:1-pd},H5t={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:nr.radius,f:nr.flattening},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:f0.radius,f:f0.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:Kf.radius,f:Kf.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:Kf.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};let UI=0,YU=class oj{static fromGE(e){const r=new oj;return r._wkt=e.wkt,r._wkid=e.wkid,r._isInverse=e.isInverse,r}constructor(e){this.uid=UI++,e?(this._wkt=e.wkt!=null?e.wkt:null,this._wkid=e.wkid!=null?e.wkid:-1,this._isInverse=e.isInverse!=null&&e.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}get wkt(){return this._wkt}set wkt(e){this._wkt=e,this.uid=UI++}get wkid(){return this._wkid}set wkid(e){this._wkid=e,this.uid=UI++}get isInverse(){return this._isInverse}set isInverse(e){this._isInverse=e,this.uid=UI++}getInverse(){const e=new oj;return e._wkt=this.wkt,e._wkid=this._wkid,e._isInverse=!this.isInverse,e}},O5=class qA{static cacheKey(e,r){return[e.wkid!==void 0&&e.wkid!==null?e.wkid.toString():"-1",e.wkt!==void 0&&e.wkt!==null?e.wkt.toString():"",r.wkid!==void 0&&r.wkid!==null?r.wkid.toString():"-1",r.wkt!==void 0&&r.wkt!==null?r.wkt.toString():""].join(",")}static fromGE(e){const r=new qA;let i="";for(const s of e.steps){const n=YU.fromGE(s);r.steps.push(n),i+=n.uid.toString()+","}return r._cachedProjection={},r._gtlistentry=null,r._chain=i,r}constructor(e){if(this.steps=[],this._cachedProjection={},this._chain="",this._gtlistentry=null,e&&e.steps)for(const r of e.steps)r instanceof YU?this.steps.push(r):this.steps.push(new YU({wkid:r.wkid,wkt:r.wkt,isInverse:r.isInverse}))}getInverse(){const e=new qA;e.steps=[];for(let r=this.steps.length-1;r>=0;r--){const i=this.steps[r];e.steps.push(i.getInverse())}return e}getGTListEntry(){let e="";for(const r of this.steps)e+=r.uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=e),this._gtlistentry}assignCachedGe(e,r,i){this._cachedProjection[qA.cacheKey(e,r)]=i}getCachedGeTransformation(e,r){let i="";for(const n of this.steps)i+=n.uid.toString()+",";i!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=i);const s=this._cachedProjection[qA.cacheKey(e,r)];return s===void 0?null:s}};function G1e(t,e,r){if(e==null||r==null||r.vcsWkid||Ln(e,r))return null;const i=oM(e)/oM(r);if(i===1)return null;switch(t){case"point":case"esriGeometryPoint":return s=>r7e(s,i);case"polyline":case"esriGeometryPolyline":return s=>s7e(s,i);case"polygon":case"esriGeometryPolygon":return s=>i7e(s,i);case"multipoint":case"esriGeometryMultipoint":return s=>n7e(s,i);case"extent":case"esriGeometryEnvelope":return s=>o7e(s,i);default:return null}}function r7e(t,e){t&&t.z!=null&&(t.z*=e)}function i7e(t,e){if(t)for(const r of t.rings)for(const i of r)i.length>2&&(i[2]*=e)}function s7e(t,e){if(t)for(const r of t.paths)for(const i of r)i.length>2&&(i[2]*=e)}function n7e(t,e){if(t)for(const r of t.points)r.length>2&&(r[2]*=e)}function o7e(t,e){t&&t.zmin!=null&&t.zmax!=null&&(t.zmin*=e,t.zmax*=e)}let wp=null,dv=null,mR=null,uN={};const j1e=new V6;function b8(){return!!wp&&k1e()}function gM(t){return mR==null&&(mR=Promise.all([z1e(),he(()=>import("./geometryEngineBase-eaaafef1.js"),[],import.meta.url).then(e=>e.g),he(()=>import("./hydrated-613da623.js"),[],import.meta.url)])),mR.then(([,e,{hydratedAdapter:r}])=>{Yt(t),dv=r,wp=e.default,wp._enableProjection(e7e),j1e.notify()})}function Ox(t,e,r=null,i=null){return Array.isArray(t)?t.length===0?[]:aj(dv,t,t[0].spatialReference,e,r,i):aj(dv,[t],t.spatialReference,e,r,i)[0]}function aj(t,e,r,i,s=null,n=null){if(r==null||i==null)return e;if(gm(r,i,s))return e.map(o=>fJ(o,r,i));if(s==null){const o=O5.cacheKey(r,i);uN[o]!==void 0?s=uN[o]:((s=q1e(r,i,void 0))==null&&(s=new O5),uN[o]=s)}if(wp==null||t==null)throw new w8;return n!=null?wp._project(t,e,r,i,s,n):wp._project(t,e,r,i,s)}function a7e(t,e){const r=H1e([t],e);return r.pending!=null?{pending:r.pending,geometry:null}:r.geometries!=null?{pending:null,geometry:r.geometries[0]}:{pending:null,geometry:null}}function H1e(t,e){if(!b8()){for(const r of t)if(r!=null&&!Ln(r.spatialReference,e)&&fa(r.spatialReference)&&fa(e)&&!gm(r.spatialReference,e))return qt(j1e),{pending:gM(),geometries:null}}return{pending:null,geometries:t.map(r=>r==null?null:Ln(r.spatialReference,e)?r:fa(r.spatialReference)&&fa(e)?W1e(r,e):null)}}function q1e(t,e,r=null){if(t==null||e==null)return null;if(wp==null||dv==null)throw new w8;const i=wp._getTransformation(dv,t,e,r,r?.spatialReference);return i!==null?O5.fromGE(i):null}function l7e(t,e,r=null){if(wp==null||dv==null)throw new w8;const i=wp._getTransformationBySuitability(dv,t,e,r,r?.spatialReference);if(i!==null){const s=[];for(const n of i)s.push(O5.fromGE(n));return s}return[]}class w8 extends U{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}var W;function c7e(){wp=null,dv=null,mR=null,uN={}}(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",t[t.WGS84=2]="WGS84",t[t.WEB_MERCATOR=3]="WEB_MERCATOR",t[t.WGS84_ECEF=4]="WGS84_ECEF",t[t.CGCS2000=5]="CGCS2000",t[t.WGS84_COMPARABLE_LON_LAT=6]="WGS84_COMPARABLE_LON_LAT",t[t.SPHERICAL_MARS_PCPF=7]="SPHERICAL_MARS_PCPF",t[t.GCSMARS2000=8]="GCSMARS2000",t[t.SPHERICAL_MOON_PCPF=9]="SPHERICAL_MOON_PCPF",t[t.GCSMOON2000=10]="GCSMOON2000",t[t.LON_LAT=11]="LON_LAT",t[t.PLATE_CARREE=12]="PLATE_CARREE"})(W||(W={}));const u7e={get loadPromise(){return mR}};function W1e(t,e){try{const r=Ox(t,e);if(r==null)return null;"xmin"in t&&"xmin"in r&&(r.zmin=t.zmin,r.zmax=t.zmax);const i=G1e(r.type,t.spatialReference,e);return i?.(r),r}catch(r){if(!(r instanceof w8))throw r;return null}}function gm(t,e,r){return!r&&(!!Ln(t,e)||fa(t)&&fa(e)&&!!_J(t,e,bJ))}async function X1e(t,e,r,i){if(b8())return Yte(i);if(Array.isArray(t)){for(const{source:s,dest:n,geographicTransformation:o}of t)if(!gm(s,n,o))return gM(i)}else if(!gm(t,e,r))return gM(i);return Yte(i)}function h7e(t,e){switch(_J(t,e,bJ)){case Oi:return"copy3";case F_:return"wgs84ToSphericalECEF";case Gw:return"wgs84ToWebMercator";case N_:return"wgs84ToPlateCarree";case k_:return"wgs84ToWGS84ECEF";case gw:return"webMercatorToWGS84";case obe:return"webMercatorToSphericalECEF";case abe:return"webMercatorToWGS84ECEF";case lbe:return"webMercatorToPlateCarree";case z_:return"wgs84ECEFToWGS84";case dbe:return"wgs84ECEFToSphericalECEF";case pbe:return"wgs84ECEFToWebMercator";case U_:return"sphericalECEFToWGS84";case ube:return"sphericalECEFToWebMercator";case dj:return"sphericalMarsPCPFToMars2000";case hj:return"sphericalMoonPCPFToMoon2000";case hbe:return"sphericalECEFToWGS84ECEF";case uj:return"mars2000ToSphericalPCPF";case cj:return"moon2000ToSphericalPCPF";default:return null}}function fJ(t,e,r){return t?"x"in t?Z1e(t,e,new tt,r,0):"xmin"in t?tbe(t,e,new cr,r,0):"rings"in t?ebe(t,e,new Su,r,0):"paths"in t?Q1e(t,e,new e8,r,0):"points"in t?J1e(t,e,new gP,r,0):null:null}function Y1e(t,e,r=e.spatialReference,i=0){return r!=null&&t.spatialReference!=null&&Z1e(t,t.spatialReference,e,r,i)!=null}function Z1e(t,e,r,i,s){Br[0]=t.x,Br[1]=t.y;const n=t.z;return Br[2]=n!==void 0?n:s,ci(Br,e,0,Br,i,0,1)?(r.x=Br[0],r.y=Br[1],r.spatialReference=i,n===void 0?(r.z=void 0,r.hasZ=!1):(r.z=Br[2],r.hasZ=!0),t.m===void 0?(r.m=void 0,r.hasM=!1):(r.m=t.m,r.hasM=!0),r):null}function d7e(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&J1e(t,t.spatialReference,e,r,i)!=null}function J1e(t,e,r,i,s){const{points:n,hasZ:o,hasM:a}=t,l=[],c=n.length,h=[];for(const d of n)h.push(d[0],d[1],o?d[2]:s);if(!ci(h,e,0,h,i,0,c))return null;for(let d=0;d<c;++d){const f=3*d,m=h[f],g=h[f+1];o&&a?l.push([m,g,h[f+2],n[d][3]]):o?l.push([m,g,h[f+2]]):a?l.push([m,g,n[d][2]]):l.push([m,g])}return r.points=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r}function p7e(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&Q1e(t,t.spatialReference,e,r,i)!=null}function Q1e(t,e,r,i,s){const{paths:n,hasZ:o,hasM:a}=t,l=[];return sbe(n,o??!1,a??!1,e,l,i,s)?(r.paths=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r):null}function f7e({hasZ:t,spatialReference:e,paths:r},i,s=0){const n=ym(e,RC),o=Uh[n][W.WGS84_COMPARABLE_LON_LAT];if(o==null)return!1;const a=t?l=>l:l=>ne(Br,l[0],l[1],s);for(const l of r){const c=[];for(const h of l){const d=[0,0,s];o(a(h),0,d,0),c.push(d)}i.push(c)}return!0}function m7e({hasZ:t,spatialReference:e,rings:r},i,s=0){const n=ym(e,RC),o=Uh[n][W.WGS84_COMPARABLE_LON_LAT];if(o==null)return!1;const a=t?l=>l:l=>ne(Br,l[0],l[1],s);for(const l of r){const c=[];for(const h of l){const d=[0,0,s];o(a(h),0,d,0),c.push(d)}i.push(c)}return!0}function K1e(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&ebe(t,t.spatialReference,e,r,i)!=null}function ebe(t,e,r,i,s){const{rings:n,hasZ:o,hasM:a}=t,l=[];return sbe(n,o??!1,a??!1,e,l,i,s)?(r.rings=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r):null}function g7e(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&tbe(t,t.spatialReference,e,r,i)!=null}function tbe(t,e,r,i,s){const{xmin:n,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:h}=t;return lj(n,o,c?t.zmin:s,e,Br,i)?(r.xmin=Br[0],r.ymin=Br[1],c&&(r.zmin=Br[2]),lj(a,l,c?t.zmax:s,e,Br,i)?(r.xmax=Br[0],r.ymax=Br[1],c&&(r.zmax=Br[2]),h&&(r.mmin=t.mmin,r.mmax=t.mmax),r.spatialReference=i,r):null):null}function b0(t,e,r){if(e==null||r==null)return null;const i=new tt({spatialReference:r});return ci(t,e,0,Br,r,0,1)?(i.x=Br[0],i.y=Br[1],i.z=Br[2],i):null}function mJ(t,e,r){return ci(t,e,0,Br,r.spatialReference,0,1)?(r.x=Br[0],r.y=Br[1],r.z=Br[2],r):null}function Ao(t,e,r,i=0){Br[0]=t.x,Br[1]=t.y;const s=t.z;return Br[2]=s!==void 0?s:i,ci(Br,t.spatialReference,0,e,r,0,1)}function lj(t,e,r,i,s,n){return os[0]=t,os[1]=e,os[2]=r,ci(os,i,0,s,n,0,1)}function Qs(t,e,r,i){return!(e==null||i==null||t.length<2)&&(t.length===2&&(os[0]=t[0],os[1]=t[1],os[2]=0,t=os),ci(t,e,0,r,i,0,1))}function rbe(t,e){Br[0]=t.x,Br[1]=t.y;const r=t.z;return Br[2]=r!==void 0?r:0,ibe(Br,t.spatialReference,e)}function ibe(t,e,r){return y7e(t,e,r)}function y7e(t,e,r){if(e==null)return!1;const i=ym(e,RC),s=Uh[i][W.WGS84_COMPARABLE_LON_LAT];return s!=null&&(s(t,0,os,0),r!==os&&(r[0]=os[0],r[1]=os[1],r.length>2&&(r[2]=os[2])),!0)}function ci(t,e,r,i,s,n,o=1){const a=_J(e,s,bJ);if(a==null)return!1;if(a===Oi){if(t===i&&r===n)return!0;const c=r+3*o;for(let h=r,d=n;h<c;h++,d++)i[d]=t[h];return!0}const l=r+3*o;for(let c=r,h=n;c<l;c+=3,h+=3)a(t,c,i,h);return!0}function _7e(t,e,r,i,s){ie(Br,t),de(kI,t,e),Qs(Br,r,Br,s),Qs(kI,r,kI,s),fe(i,kI,Br),_e(i,i)}function sbe(t,e,r,i,s,n,o=0){const a=new Array;for(const c of t)for(const h of c)a.push(h[0],h[1],e?h[2]:o);if(!ci(a,i,0,a,n,0,a.length/3))return!1;let l=0;s.length=0;for(const c of t){const h=new Array;for(const d of c)e&&r?h.push([a[l++],a[l++],a[l++],d[3]]):e?h.push([a[l++],a[l++],a[l++]]):r?(h.push([a[l++],a[l++],d[2]]),l++):(h.push([a[l++],a[l++]]),l++);s.push(h)}return!0}function v7e(t,e,r,i){if(e==null||i==null)return!1;const s=fbe(e,i,A7e);if(s.projector===Oi)return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],!0;if(s.projector==null)return!1;const{source:n,dest:o}=s;if(o.spatialReferenceId===W.WEB_MERCATOR){const a=Uh[n.spatialReferenceId][W.WGS84];return a!=null&&(a(t,0,Yd,0),Gw(Yd,0,r,0),r[3]=Xie(Yd[1],t[2],t[3],nr.radius),!0)}if(n.spatialReferenceId!==W.WGS84&&n.spatialReferenceId!==W.CGCS2000||o.spatialReferenceId!==W.PLATE_CARREE){s.projector(t,0,r,0);const a=n.metersPerUnit??1,l=o.metersPerUnit??1;r[3]=t[3]*a/l}else{const a=Uh[n.spatialReferenceId][W.SPHERICAL_ECEF],l=Uh[W.SPHERICAL_ECEF][W.PLATE_CARREE];let c=t[3];a!=null&&l!=null&&(c=Xie(t[1],t[2],t[3],nr.radius)),s.projector(t,0,r,0),r[3]=c}return!0}function Xie(t,e,r,i){const s=i+e;if(s<i/2||r>s)return Number.MAX_VALUE;const n=Math.abs(pp*t)+Math.asin(r/s);return n>=Math.PI/2?Number.MAX_VALUE:r/Math.cos(n)}function AP(t,e,r,i){return t!=null&&(Ln(e,i)?(m0(r,t),!0):(os[0]=t[0],os[1]=t[1],os[2]=0,!!ci(os,e,0,os,i,0,1)&&(r[0]=os[0],r[1]=os[1],os[0]=t[2],os[1]=t[3],os[2]=0,!!ci(os,e,0,os,i,0,1)&&(r[2]=os[0],r[3]=os[1],!0))))}function b7e(t,e,r,i){if(e==null||i==null)return!1;const s=ym(e,RC),n=ym(i,mbe);if(s===n&&s!==W.UNKNOWN||Ln(e,i))return r[0]=1,r[1]=1,r[2]=1,!0;if(s===W.SPHERICAL_ECEF){const o=Re(t),a=o/Math.sqrt(t[0]*t[0]+t[1]*t[1]),l=o/nr.radius;if(n===W.WEB_MERCATOR)return r[0]=a*l,r[1]=a*l,r[2]=1,!0;if(n===W.WGS84||n===W.CGCS2000){const c=gR;return r[0]=c*a*l,r[1]=c*l,r[2]=1,!0}}else if(s===W.PLATE_CARREE){if(n===W.WGS84||n===W.CGCS2000)return r[0]=gR,r[1]=gR,r[2]=1,!0;if(n===W.WEB_MERCATOR){const o=t[1]/nr.radius;return r[0]=1,r[1]=1/Math.cos(o),r[2]=1,!0}}return!1}function Fl(t,e,r,i){if(t==null||i==null)return!1;const s=ym(t,RC),n=ym(i,mbe);if(s===n&&!Yie(n)&&(s!==W.UNKNOWN||Ln(t,i)))return CP(r,e),!0;if(Yie(n)){const o=Uh[s][W.LON_LAT],a=Uh[W.LON_LAT][n];return o!=null&&a!=null&&(o(e,0,Yd,0),a(Yd,0,iy,0),gJ(pp*Yd[0],pp*Yd[1],r),r[12]=iy[0],r[13]=iy[1],r[14]=iy[2],!0)}if((n===W.WEB_MERCATOR||n===W.PLATE_CARREE)&&(s===W.WGS84||s===W.CGCS2000&&n===W.PLATE_CARREE||s===W.SPHERICAL_ECEF||s===W.WEB_MERCATOR)){const o=Uh[s][W.LON_LAT],a=Uh[W.LON_LAT][n];return o!=null&&a!=null&&(o(e,0,Yd,0),a(Yd,0,iy,0),s===W.SPHERICAL_ECEF?nbe(pp*Yd[0],pp*Yd[1],r):Yh(r),r[12]=iy[0],r[13]=iy[1],r[14]=iy[2],!0)}return!1}function Yie(t){return t===W.SPHERICAL_ECEF||t===W.SPHERICAL_MARS_PCPF||t===W.SPHERICAL_MOON_PCPF}function gJ(t,e,r){const i=Math.sin(t),s=Math.cos(t),n=Math.sin(e),o=Math.cos(e),a=r;return a[0]=-i,a[4]=-n*s,a[8]=o*s,a[12]=0,a[1]=s,a[5]=-n*i,a[9]=o*i,a[13]=0,a[2]=0,a[6]=o,a[10]=n,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function nbe(t,e,r){return gJ(t,e,r),kc(r,r),r}function ym(t,e){return t?e.spatialReference===t?e.spatialReferenceId:(e.spatialReference=t,"metersPerUnit"in e&&(e.metersPerUnit=Ta(t,1)),t.wkt===q0e.wkt?e.spatialReferenceId=W.SPHERICAL_ECEF:iM(t)?e.spatialReferenceId=W.WGS84:$w(t)?e.spatialReferenceId=W.WEB_MERCATOR:sM(t)?e.spatialReferenceId=W.PLATE_CARREE:t.wkt===W0e.wkt?e.spatialReferenceId=W.WGS84_ECEF:t.wkid===$h.CGCS2000?e.spatialReferenceId=W.CGCS2000:t.wkt===sZ.wkt?e.spatialReferenceId=W.SPHERICAL_MARS_PCPF:t.wkt===nZ.wkt?e.spatialReferenceId=W.SPHERICAL_MOON_PCPF:Om(t)?e.spatialReferenceId=W.GCSMARS2000:Rm(t)?e.spatialReferenceId=W.GCSMOON2000:e.spatialReferenceId=W.UNKNOWN):W.UNKNOWN}function Oi(t,e,r,i){t!==r&&(r[i++]=t[e++],r[i++]=t[e++],r[i]=t[e])}function gw(t,e,r,i){r[i++]=AE*(t[e++]/nr.radius),r[i++]=AE*(Math.PI/2-2*Math.atan(Math.exp(-t[e++]/nr.radius))),r[i]=t[e]}function obe(t,e,r,i){gw(t,e,r,i),F_(r,i,r,i)}function abe(t,e,r,i){gw(t,e,r,i),k_(r,i,r,i)}function x8(t,e,r,i,s){const n=.4999999*Math.PI,o=ve(pp*t[e+1],-n,n),a=Math.sin(o);r[i++]=pp*t[e]*s.radius,r[i++]=s.halfSemiMajorAxis*Math.log((1+a)/(1-a)),r[i]=t[e+2]}function Gw(t,e,r,i){x8(t,e,r,i,nr)}const Zie=nr.radius*Math.PI/180,gR=180/(nr.radius*Math.PI);function N_(t,e,r,i){r[i]=t[e]*Zie,r[i+1]=t[e+1]*Zie,r[i+2]=t[e+2]}function tw(t,e,r,i){r[i]=t[e]*gR,r[i+1]=t[e+1]*gR,r[i+2]=t[e+2]}function lbe(t,e,r,i){gw(t,e,r,i),N_(r,i,r,i)}function w7e(t,e,r,i){z_(t,e,r,i),N_(r,i,r,i)}function x7e(t,e,r,i){U_(t,e,r,i),N_(r,i,r,i)}function T7e(t,e,r,i){tw(t,e,r,i),F_(r,i,r,i)}function S7e(t,e,r,i){tw(t,e,r,i),Gw(r,i,r,i)}function E7e(t,e,r,i){tw(t,e,r,i),k_(r,i,r,i)}function pv(t){if(t==null)return!1;const e=ym(t,RC);return!!Uh[e][W.WGS84_COMPARABLE_LON_LAT]}function cbe(t,e,r,i){const s=Math.cos(r);t[0]=Math.cos(e)*s*i,t[1]=Math.sin(e)*s*i,t[2]=Math.sin(r)*i}function yJ(t,e,r,i,s){const n=s+t[e+2],o=pp*t[e+1],a=pp*t[e],l=Math.cos(o);r[i++]=Math.cos(a)*l*n,r[i++]=Math.sin(a)*l*n,r[i]=Math.sin(o)*n}function cj(t,e,r,i){yJ(t,e,r,i,f0.radius)}function uj(t,e,r,i){yJ(t,e,r,i,Kf.radius)}function F_(t,e,r,i){yJ(t,e,r,i,nr.radius)}function T8(t,e,r,i,s){const n=t[e],o=t[e+1],a=t[e+2],l=Math.sqrt(n*n+o*o+a*a),c=Hh(a/(l===0?1:l)),h=Math.atan2(o,n);r[i++]=AE*h,r[i++]=AE*c,r[i]=l-s}function hj(t,e,r,i){T8(t,e,r,i,f0.radius)}function dj(t,e,r,i){T8(t,e,r,i,Kf.radius)}function U_(t,e,r,i){T8(t,e,r,i,nr.radius)}function ube(t,e,r,i){U_(t,e,r,i),Gw(r,i,r,i)}function hbe(t,e,r,i){U_(t,e,r,i),k_(r,i,r,i)}function C7e(t,e,r,i,s){const n=pp*t[e],o=pp*t[e+1],a=t[e+2],l=Math.sin(o),c=Math.cos(o),h=s.radius/Math.sqrt(1-s.eccentricitySquared*l*l);r[i++]=(h+a)*c*Math.cos(n),r[i++]=(h+a)*c*Math.sin(n),r[i++]=(h*(1-s.eccentricitySquared)+a)*l}function k_(t,e,r,i){C7e(t,e,r,i,nr)}function z_(t,e,r,i){const s=t7e,n=t[e],o=t[e+1],a=t[e+2];let l,c,h,d,f,m,g,_,v,b,T,x,S,E,A,R,M,D,k,L,N;l=Math.abs(a),c=n*n+o*o,h=Math.sqrt(c),d=c+a*a,f=Math.sqrt(d),L=Math.atan2(o,n),m=a*a/d,g=c/d,E=s.a2/f,A=s.a3-s.a4/f,g>.3?(_=l/f*(1+g*(s.a1+E+m*A)/f),k=Math.asin(_),b=_*_,v=Math.sqrt(1-b)):(v=h/f*(1-m*(s.a5-E-g*A)/f),k=Math.acos(v),b=1-v*v,_=Math.sqrt(b)),T=1-nr.eccentricitySquared*b,x=nr.radius/Math.sqrt(T),S=s.a6*x,E=h-x*v,A=l-S*_,M=v*E+_*A,R=v*A-_*E,D=R/(S/T+M),k+=D,N=M+R*D/2,a<0&&(k=-k),r[i++]=AE*L,r[i++]=AE*k,r[i]=N}function dbe(t,e,r,i){z_(t,e,r,i),F_(r,i,r,i)}function pbe(t,e,r,i){z_(t,e,r,i),Gw(r,i,r,i)}const Uh={[W.WGS84]:{[W.CGCS2000]:null,[W.GCSMARS2000]:null,[W.GCSMOON2000]:null,[W.LON_LAT]:Oi,[W.WGS84_COMPARABLE_LON_LAT]:Oi,[W.SPHERICAL_ECEF]:F_,[W.SPHERICAL_MARS_PCPF]:null,[W.SPHERICAL_MOON_PCPF]:null,[W.UNKNOWN]:null,[W.WEB_MERCATOR]:Gw,[W.PLATE_CARREE]:N_,[W.WGS84]:Oi,[W.WGS84_ECEF]:k_},[W.CGCS2000]:{[W.CGCS2000]:Oi,[W.GCSMARS2000]:null,[W.GCSMOON2000]:null,[W.LON_LAT]:Oi,[W.WGS84_COMPARABLE_LON_LAT]:Oi,[W.SPHERICAL_ECEF]:F_,[W.SPHERICAL_MARS_PCPF]:null,[W.SPHERICAL_MOON_PCPF]:null,[W.UNKNOWN]:null,[W.WEB_MERCATOR]:null,[W.PLATE_CARREE]:N_,[W.WGS84]:null,[W.WGS84_ECEF]:k_},[W.GCSMARS2000]:{[W.CGCS2000]:null,[W.GCSMARS2000]:Oi,[W.GCSMOON2000]:null,[W.LON_LAT]:Oi,[W.WGS84_COMPARABLE_LON_LAT]:null,[W.SPHERICAL_ECEF]:null,[W.SPHERICAL_MARS_PCPF]:uj,[W.SPHERICAL_MOON_PCPF]:null,[W.UNKNOWN]:null,[W.WEB_MERCATOR]:null,[W.PLATE_CARREE]:null,[W.WGS84]:null,[W.WGS84_ECEF]:null},[W.GCSMOON2000]:{[W.CGCS2000]:null,[W.GCSMARS2000]:null,[W.GCSMOON2000]:Oi,[W.LON_LAT]:Oi,[W.WGS84_COMPARABLE_LON_LAT]:null,[W.SPHERICAL_ECEF]:null,[W.SPHERICAL_MARS_PCPF]:null,[W.SPHERICAL_MOON_PCPF]:cj,[W.UNKNOWN]:null,[W.WEB_MERCATOR]:null,[W.PLATE_CARREE]:null,[W.WGS84]:null,[W.WGS84_ECEF]:null},[W.WEB_MERCATOR]:{[W.CGCS2000]:null,[W.GCSMARS2000]:null,[W.GCSMOON2000]:null,[W.LON_LAT]:gw,[W.WGS84_COMPARABLE_LON_LAT]:gw,[W.SPHERICAL_ECEF]:obe,[W.SPHERICAL_MARS_PCPF]:null,[W.SPHERICAL_MOON_PCPF]:null,[W.UNKNOWN]:null,[W.WEB_MERCATOR]:Oi,[W.PLATE_CARREE]:lbe,[W.WGS84]:gw,[W.WGS84_ECEF]:abe},[W.WGS84_ECEF]:{[W.CGCS2000]:z_,[W.GCSMARS2000]:null,[W.GCSMOON2000]:null,[W.LON_LAT]:z_,[W.WGS84_COMPARABLE_LON_LAT]:z_,[W.SPHERICAL_ECEF]:dbe,[W.SPHERICAL_MARS_PCPF]:null,[W.SPHERICAL_MOON_PCPF]:null,[W.UNKNOWN]:null,[W.WEB_MERCATOR]:pbe,[W.PLATE_CARREE]:w7e,[W.WGS84]:z_,[W.WGS84_ECEF]:Oi},[W.SPHERICAL_ECEF]:{[W.CGCS2000]:U_,[W.GCSMARS2000]:null,[W.GCSMOON2000]:null,[W.LON_LAT]:U_,[W.WGS84_COMPARABLE_LON_LAT]:U_,[W.SPHERICAL_ECEF]:Oi,[W.SPHERICAL_MARS_PCPF]:null,[W.SPHERICAL_MOON_PCPF]:null,[W.UNKNOWN]:null,[W.WEB_MERCATOR]:ube,[W.PLATE_CARREE]:x7e,[W.WGS84]:U_,[W.WGS84_ECEF]:hbe},[W.SPHERICAL_MARS_PCPF]:{[W.CGCS2000]:null,[W.GCSMARS2000]:dj,[W.GCSMOON2000]:null,[W.LON_LAT]:dj,[W.WGS84_COMPARABLE_LON_LAT]:null,[W.SPHERICAL_ECEF]:null,[W.SPHERICAL_MARS_PCPF]:Oi,[W.SPHERICAL_MOON_PCPF]:null,[W.UNKNOWN]:null,[W.WEB_MERCATOR]:null,[W.PLATE_CARREE]:null,[W.WGS84]:null,[W.WGS84_ECEF]:null},[W.SPHERICAL_MOON_PCPF]:{[W.CGCS2000]:null,[W.GCSMARS2000]:null,[W.GCSMOON2000]:hj,[W.LON_LAT]:hj,[W.WGS84_COMPARABLE_LON_LAT]:null,[W.SPHERICAL_ECEF]:null,[W.SPHERICAL_MARS_PCPF]:null,[W.SPHERICAL_MOON_PCPF]:Oi,[W.UNKNOWN]:null,[W.WEB_MERCATOR]:null,[W.PLATE_CARREE]:null,[W.WGS84]:null,[W.WGS84_ECEF]:null},[W.UNKNOWN]:{[W.CGCS2000]:null,[W.GCSMARS2000]:null,[W.GCSMOON2000]:null,[W.LON_LAT]:null,[W.WGS84_COMPARABLE_LON_LAT]:null,[W.SPHERICAL_ECEF]:null,[W.SPHERICAL_MARS_PCPF]:null,[W.SPHERICAL_MOON_PCPF]:null,[W.UNKNOWN]:Oi,[W.WEB_MERCATOR]:null,[W.PLATE_CARREE]:null,[W.WGS84]:null,[W.WGS84_ECEF]:null},[W.LON_LAT]:{[W.CGCS2000]:Oi,[W.GCSMARS2000]:Oi,[W.GCSMOON2000]:Oi,[W.LON_LAT]:Oi,[W.WGS84_COMPARABLE_LON_LAT]:Oi,[W.SPHERICAL_ECEF]:F_,[W.SPHERICAL_MARS_PCPF]:uj,[W.SPHERICAL_MOON_PCPF]:cj,[W.UNKNOWN]:null,[W.WEB_MERCATOR]:Gw,[W.PLATE_CARREE]:N_,[W.WGS84]:Oi,[W.WGS84_ECEF]:k_},[W.WGS84_COMPARABLE_LON_LAT]:{[W.CGCS2000]:null,[W.GCSMARS2000]:null,[W.GCSMOON2000]:null,[W.LON_LAT]:Oi,[W.WGS84_COMPARABLE_LON_LAT]:Oi,[W.SPHERICAL_ECEF]:F_,[W.SPHERICAL_MARS_PCPF]:null,[W.SPHERICAL_MOON_PCPF]:null,[W.UNKNOWN]:null,[W.WEB_MERCATOR]:null,[W.PLATE_CARREE]:N_,[W.WGS84]:Oi,[W.WGS84_ECEF]:k_},[W.PLATE_CARREE]:{[W.CGCS2000]:tw,[W.GCSMARS2000]:null,[W.GCSMOON2000]:null,[W.LON_LAT]:tw,[W.WGS84_COMPARABLE_LON_LAT]:tw,[W.SPHERICAL_ECEF]:T7e,[W.SPHERICAL_MARS_PCPF]:null,[W.SPHERICAL_MOON_PCPF]:null,[W.UNKNOWN]:null,[W.WEB_MERCATOR]:S7e,[W.PLATE_CARREE]:Oi,[W.WGS84]:tw,[W.WGS84_ECEF]:E7e}};function _J(t,e,r=vJ()){return t==null||e==null?null:fbe(t,e,r).projector}function fbe(t,e,r){if(t==null||e==null||r.source.spatialReference===t&&r.dest.spatialReference===e)return r;const i=ym(t,r.source),s=ym(e,r.dest);return i===W.UNKNOWN&&s===W.UNKNOWN?Ln(t,e)?r.projector=Oi:r.projector=null:r.projector=Uh[i][s],r}function vJ(){return{source:{spatialReference:null,spatialReferenceId:W.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:W.UNKNOWN,metersPerUnit:1},projector:Oi}}const RC={spatialReference:null,spatialReferenceId:W.UNKNOWN},mbe={spatialReference:null,spatialReferenceId:W.UNKNOWN},bJ=vJ(),A7e=vJ(),pp=Ft(1),AE=al(1),os=O(),Yd=O(),iy=O(),Br=O(),kI=O(),q5t=Object.freeze(Object.defineProperty({__proto__:null,canProjectToWGS84ComparableLonLat:pv,canProjectWithoutEngine:gm,computeENUToSphericalPCPFLocalRotation:gJ,computeSphericalPCPFToENULocalRotation:nbe,computeTranslationToOriginAndRotation:Fl,getProjectorName:h7e,getTransformation:q1e,getTransformations:l7e,initializeProjection:X1e,isLoaded:b8,load:gM,localLinearScaleFactors:b7e,lonLatToSphericalPCPF:cbe,lonLatToWebMercatorComparable:x8,project:Ox,projectBoundingRect:AP,projectBoundingSphere:v7e,projectBuffer:ci,projectDirection:_7e,projectExtent:g7e,projectMany:aj,projectMultipoint:d7e,projectOrLoad:a7e,projectOrLoadMany:H1e,projectPoint:Y1e,projectPointToVector:Ao,projectPointToWGS84ComparableLonLat:rbe,projectPolygon:K1e,projectPolygonToWGS84ComparableLonLat:m7e,projectPolyline:p7e,projectPolylineToWGS84ComparableLonLat:f7e,projectVectorToDehydratedPoint:mJ,projectVectorToPoint:b0,projectVectorToVector:Qs,projectVectorToWGS84ComparableLonLat:ibe,projectWithoutEngine:fJ,projectXYZToVector:lj,sphericalPCPFtoLonLatElevation:T8,test:u7e,tryProjectWithZConversion:W1e,unload:c7e},Symbol.toStringTag,{value:"Module"}));let M0=class{constructor(e){this._allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&hE(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*Jie);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,Jie));e++)this._items.push(this._allocator())}};const Jie=1024;function xe(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function OE(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}function wJ(t,e,r,i,s,n,o,a,l,c,h,d,f,m,g,_){return[t,e,r,i,s,n,o,a,l,c,h,d,f,m,g,_]}function gbe(t,e){return new Float64Array(t,e,16)}const pn=xe();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:pn,clone:OE,create:xe,createView:gbe,fromValues:wJ},Symbol.toStringTag,{value:"Module"}));var Mc;(function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"})(Mc||(Mc={}));var R5;(function(t){t[t.KILOBYTES=1024]="KILOBYTES",t[t.MEGABYTES=1048576]="MEGABYTES",t[t.GIGABYTES=1073741824]="GIGABYTES"})(R5||(R5={}));function ki(){return[1,0,0,0,1,0,0,0,1]}function ybe(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]}function O7e(t,e,r,i,s,n,o,a,l){return[t,e,r,i,s,n,o,a,l]}function _be(t,e){return new Float64Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:ybe,create:ki,createView:_be,fromValues:O7e},Symbol.toStringTag,{value:"Module"}));function rd(){return[0,0,0,1]}function R7e(t){return[t[0],t[1],t[2],t[3]]}function M7e(t,e,r,i){return[t,e,r,i]}function vbe(t,e){return new Float64Array(t,e,4)}const P7e=rd();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:P7e,clone:R7e,create:rd,createView:vbe,fromValues:M7e},Symbol.toStringTag,{value:"Module"}));function He(){return[0,0]}function WA(t){return[t[0],t[1]]}function fr(t,e){return[t,e]}function bbe(t){const e=He(),r=Math.min(2,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function wbe(t,e){return new Float64Array(t,e,2)}function xbe(){return He()}function Tbe(){return fr(1,1)}function Sbe(){return fr(1,0)}function Ebe(){return fr(0,1)}const Pp=xbe(),I7e=Tbe(),Cbe=Sbe(),$7e=Ebe();Object.freeze(Object.defineProperty({__proto__:null,ONES:I7e,UNIT_X:Cbe,UNIT_Y:$7e,ZEROS:Pp,clone:WA,create:He,createView:wbe,fromArray:bbe,fromValues:fr,ones:Tbe,unitX:Sbe,unitY:Ebe,zeros:xbe},Symbol.toStringTag,{value:"Module"}));function Wt(){return[0,0,0,0]}function OP(t){return[t[0],t[1],t[2],t[3]]}function Nt(t,e,r,i){return[t,e,r,i]}function xJ(t){const e=Wt(),r=Math.min(4,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function Abe(t,e){return new Float64Array(t,e,4)}function Obe(){return Wt()}function Rbe(){return Nt(1,1,1,1)}function Mbe(){return Nt(1,0,0,0)}function Pbe(){return Nt(0,1,0,0)}function Ibe(){return Nt(0,0,1,0)}function $be(){return Nt(0,0,0,1)}const rm=Obe(),Lh=Rbe(),L7e=Mbe(),D7e=Pbe(),N7e=Ibe(),F7e=$be();Object.freeze(Object.defineProperty({__proto__:null,ONES:Lh,UNIT_W:F7e,UNIT_X:L7e,UNIT_Y:D7e,UNIT_Z:N7e,ZEROS:rm,clone:OP,create:Wt,createView:Abe,fromArray:xJ,fromValues:Nt,ones:Rbe,unitW:$be,unitX:Mbe,unitY:Pbe,unitZ:Ibe,zeros:Obe},Symbol.toStringTag,{value:"Module"}));let MC=class J1{constructor(e,r,i){this._itemByteSize=e,this._itemCreate=r,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(i/this._itemByteSize)}get(){this._itemsPtr===0&&hE(()=>this._reset());const e=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=e;){const r=new ArrayBuffer(this._itemsPerBuffer*this._itemByteSize);for(let i=0;i<this._itemsPerBuffer;++i)this._items.push(this._itemCreate(r,i*this._itemByteSize));this._buffers.push(r)}return this._items[this._itemsPtr++]}_reset(){const e=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>e;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(e=Wx){return new J1(16,wbe,e)}static createVec3f64(e=Wx){return new J1(24,gZ,e)}static createVec4f64(e=Wx){return new J1(32,Abe,e)}static createMat3f64(e=Wx){return new J1(72,_be,e)}static createMat4f64(e=Wx){return new J1(128,gbe,e)}static createQuatf64(e=Wx){return new J1(32,vbe,e)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this._itemByteSize}}};const Wx=4*R5.KILOBYTES,X5t=MC.createVec2f64(),Ge=MC.createVec3f64(),TJ=MC.createVec4f64();MC.createMat3f64();const SJ=MC.createMat4f64(),Y5t=MC.createQuatf64();function Dp(t){return t?{origin:ks(t.origin),vector:ks(t.vector)}:{origin:O(),vector:O()}}function U7e(t,e){const r=z7e.get();return r.origin=t,r.vector=e,r}function Z5t(t,e=Dp()){return k7e(t.origin,t.vector,e)}function k7e(t,e,r=Dp()){return ie(r.origin,t),ie(r.vector,e),r}function yw(t,e,r=Dp()){return ie(r.origin,t),fe(r.vector,e,t),r}function EJ(t,e){const r=fe(Ge.get(),e,t.origin),i=ye(t.vector,r),s=ye(t.vector,t.vector),n=ve(i/s,0,1),o=fe(Ge.get(),se(Ge.get(),t.vector,n),r);return ye(o,o)}function J5t(t,e,r){return pj(t,e,0,1,r)}function Q5t(t,e,r){return de(r,t.origin,se(r,t.vector,e))}function pj(t,e,r,i,s){const{vector:n,origin:o}=t,a=fe(Ge.get(),e,o),l=ye(n,a)/da(n);return se(s,n,ve(l,r,i)),de(s,s,t.origin)}function K5t(t,e){if(Dbe(t,U7e(e.origin,e.direction),!1,M5)){const{tA:r,pB:i,distance2:s}=M5;if(r>=0&&r<=1)return s;if(r<0)return xo(t.origin,i);if(r>1)return xo(de(Ge.get(),t.origin,t.vector),i)}return null}function Lbe(t,e,r){return!!Dbe(t,e,!0,M5)&&(ie(r,M5.pA),!0)}function Dbe(t,e,r,i){const n=t.origin,o=de(Ge.get(),n,t.vector),a=e.origin,l=de(Ge.get(),a,e.vector),c=Ge.get(),h=Ge.get();if(c[0]=n[0]-a[0],c[1]=n[1]-a[1],c[2]=n[2]-a[2],h[0]=l[0]-a[0],h[1]=l[1]-a[1],h[2]=l[2]-a[2],Math.abs(h[0])<1e-6&&Math.abs(h[1])<1e-6&&Math.abs(h[2])<1e-6)return!1;const d=Ge.get();if(d[0]=o[0]-n[0],d[1]=o[1]-n[1],d[2]=o[2]-n[2],Math.abs(d[0])<1e-6&&Math.abs(d[1])<1e-6&&Math.abs(d[2])<1e-6)return!1;const f=c[0]*h[0]+c[1]*h[1]+c[2]*h[2],m=h[0]*d[0]+h[1]*d[1]+h[2]*d[2],g=c[0]*d[0]+c[1]*d[1]+c[2]*d[2],_=h[0]*h[0]+h[1]*h[1]+h[2]*h[2],v=(d[0]*d[0]+d[1]*d[1]+d[2]*d[2])*_-m*m;if(Math.abs(v)<1e-6)return!1;let b=(f*m-g*_)/v,T=(f+m*b)/_;r&&(b=ve(b,0,1),T=ve(T,0,1));const x=Ge.get(),S=Ge.get();return x[0]=n[0]+b*d[0],x[1]=n[1]+b*d[1],x[2]=n[2]+b*d[2],S[0]=a[0]+T*h[0],S[1]=a[1]+T*h[1],S[2]=a[2]+T*h[2],i.tA=b,i.tB=T,i.pA=x,i.pB=S,i.distance2=xo(x,S),!0}const M5={tA:0,tB:0,pA:O(),pB:O(),distance2:0},z7e=new M0(()=>Dp());function eo(t){return t?Qie(ks(t.origin),ks(t.direction)):Qie(O(),O())}function Qie(t,e){return{origin:t,direction:e}}function eFt(t,e){return u0(t.origin,e.origin)&&u0(t.direction,e.direction)}function Du(t,e){const r=j7e.get();return r.origin=t,r.direction=e,r}function P5(t,e=eo()){return Nbe(t.origin,t.direction,e)}function V7e(t,e,r=eo()){return ie(r.origin,t),fe(r.direction,e,t),r}function Nbe(t,e,r=eo()){return ie(r.origin,t),ie(r.direction,e),r}function B7e(t,e){const r=pt(Ge.get(),_e(Ge.get(),t.direction),fe(Ge.get(),e,t.origin));return ye(r,r)}function G7e(t,e,r){const i=ye(t.direction,fe(r,e,t.origin));return de(r,t.origin,se(r,t.direction,i)),r}const j7e=new M0(()=>eo());function yR(t,e){return ye(t,e)/Re(t)}function S8(t,e){const r=ye(t,e)/(Re(t)*Re(e));return-Dn(r)}function Fbe(t,e,r){_e(zI,t),_e(ZU,e);const i=ye(zI,ZU),s=Dn(i),n=pt(zI,zI,ZU);return ye(n,r)<0?2*Math.PI-s:s}const zI=O(),ZU=O(),Ube=xs();function xs(){return Wt()}function RE(t,e=xs()){return Nh(e,t)}function kbe(t,e){return Nt(t[0],t[1],t[2],e)}function H7e(t){return t}function q7e(t){t[0]=t[1]=t[2]=t[3]=0}function E8(t,e){return t[0]=t[1]=t[2]=0,t[3]=e,t}function Qg(t){return t[3]}function W7e(t){return t}function zbe(t,e,r,i){return Nt(t,e,r,i)}function X7e(t,e,r){return t!==r&&ie(r,t),r[3]=t[3]+e,r}function Y7e(t,e,r){return K.getLogger("esri.geometry.support.sphere").error("sphere.setExtent is not yet supported"),t===r?r:RE(t,r)}function Lv(t,e,r){if(e==null)return!1;const{origin:i,direction:s}=e,n=Z7e;n[0]=i[0]-t[0],n[1]=i[1]-t[1],n[2]=i[2]-t[2];const o=s[0]*s[0]+s[1]*s[1]+s[2]*s[2];if(o===0)return!1;const a=2*(s[0]*n[0]+s[1]*n[1]+s[2]*n[2]),l=a*a-4*o*(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]-t[3]*t[3]);if(l<0)return!1;const c=Math.sqrt(l);let h=(-a-c)/(2*o);const d=(-a+c)/(2*o);return(h<0||d<h&&d>0)&&(h=d),!(h<0)&&(r&&(r[0]=i[0]+s[0]*h,r[1]=i[1]+s[1]*h,r[2]=i[2]+s[2]*h),!0)}const Z7e=O();function fj(t,e){return Lv(t,e,null)}function J7e(t,e,r){if(Lv(t,e,r))return r;const i=PC(t,e,Ge.get());return de(r,e.origin,se(Ge.get(),e.direction,mi(e.origin,i)/Re(e.direction))),r}function PC(t,e,r){const i=Ge.get(),s=SJ.get();pt(i,e.origin,e.direction);const n=Qg(t);pt(r,i,e.origin),se(r,r,1/Re(r)*n);const o=Gbe(t,e.origin),a=S8(e.origin,r);return Lu(s,a+o,i),ze(r,r,s),r}function Q7e(t,e,r){return Lv(t,e,r)?r:(G7e(e,t,r),Vbe(t,r,r))}function Vbe(t,e,r){const i=fe(Ge.get(),e,t),s=se(Ge.get(),i,t[3]/Re(i));return de(r,s,t)}function Bbe(t,e){const r=fe(Ge.get(),e,t),i=da(r),s=t[3]*t[3];return Math.sqrt(Math.abs(i-s))}function Gbe(t,e){const r=fe(Ge.get(),e,t),i=Re(r),s=Qg(t),n=s+Math.abs(s-i);return Dn(s/n)}const JU=O();function jbe(t,e,r,i){const s=fe(JU,e,t);switch(r){case Mc.X:{const n=jre(s,JU)[2];return ne(i,-Math.sin(n),Math.cos(n),0)}case Mc.Y:{const n=jre(s,JU),o=n[1],a=n[2],l=Math.sin(o);return ne(i,-l*Math.cos(a),-l*Math.sin(a),Math.cos(o))}case Mc.Z:return _e(i,s);default:return}}function Hbe(t,e){const r=fe(mj,e,t);return Re(r)-t[3]}function K7e(t,e,r,i){const s=Hbe(t,e),n=jbe(t,e,Mc.Z,mj),o=se(mj,n,r-s);return de(i,e,o)}function eBe(t,e){const r=xo(t,e),i=Qg(t);return r<=i*i}function tBe(t,e,r=xs()){const i=mi(t,e),s=t[3],n=e[3];return i+n<s?(Nh(r,t),r):i+s<n?(Nh(r,e),r):(qr(r,t,e,(i+n-s)/(2*i)),r[3]=(i+s+n)/2,r)}const mj=O(),C8=xs(),rBe=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:Ube,altitudeAt:Hbe,angleToSilhouette:Gbe,axisAt:jbe,clear:q7e,closestPoint:Q7e,closestPointOnSilhouette:PC,containsPoint:eBe,copy:RE,create:xs,distanceToSilhouette:Bbe,elevate:X7e,fromCenterAndRadius:kbe,fromRadius:E8,fromValues:zbe,getCenter:W7e,getRadius:Qg,intersectRay:Lv,intersectRayClosestSilhouette:J7e,intersectsRay:fj,projectPoint:Vbe,setAltitudeAt:K7e,setExtent:Y7e,tmpSphere:C8,union:tBe,wrap:H7e},Symbol.toStringTag,{value:"Module"}));function ME(t){const e=t[0]*t[0]+t[4]*t[4]+t[8]*t[8],r=t[1]*t[1]+t[5]*t[5]+t[9]*t[9],i=t[2]*t[2]+t[6]*t[6]+t[10]*t[10];return Math.sqrt(Math.max(e,r,i))}function iBe(t,e){const r=Math.sqrt(e[0]*e[0]+e[4]*e[4]+e[8]*e[8]),i=Math.sqrt(e[1]*e[1]+e[5]*e[5]+e[9]*e[9]),s=Math.sqrt(e[2]*e[2]+e[6]*e[6]+e[10]*e[10]);return ne(t,r,i,s),t}function tFt(t,e,r){r=r||t;const i=ye(t,e);ne(r,t[0]-i*e[0],t[1]-i*e[1],t[2]-i*e[2]),_e(r,r)}function rFt(t,e,r){Math.abs(t[0])>Math.abs(t[1])?ne(e,0,1,0):ne(e,1,0,0),pt(r,t,e),_e(e,e),pt(e,r,t),_e(r,r)}function VI(t,e,r,i,s,n){const o=t+(e-t)*s;return o+(r+(i-r)*s-o)*n}function sBe(t,e,r,i=O()){const s=Re(t),n=Re(e),o=ye(t,e)/(s*n);if(o<.9999999999999999){const a=Math.acos(o),l=((1-r)*s+r*n)/Math.sin(a),c=l/s*Math.sin((1-r)*a),h=l/n*Math.sin(r*a);return se(rw,t,c),se(iw,e,h),de(i,rw,iw)}return qr(i,t,e,r)}function iFt(t,e,r,i=O(),s=O()){const n=Re(t),o=Re(e),a=ye(t,e)/(n*o);if(a<.9999999999999999){const l=Math.acos(a),c=Math.sin(l),h=Math.sin(r*l),d=Math.sin((1-r)*l),f=(1-r)*n+r*o;{const m=f/c,g=m/o*h;se(rw,t,m/n*d),se(iw,e,g),de(i,rw,iw)}{const m=1/n*(-Math.cos((1-r)*l)*l*f+d*(-n+o));se(rw,t,m);const g=1/o*(Math.cos(r*l)*l*f+h*(-n+o));se(iw,e,g),de(s,rw,iw),se(s,s,1/c)}return s}return qr(i,t,e,r),fe(s,e,t),_e(s,s),s}function hN(t,e,r){t=_e(rw,t),e=_e(iw,e);const i=Dn(ye(t,e));if(r){const s=pt(nBe,t,e);if(ye(s,r)<0)return-i}return i}function dN(t){const e=t.length;return r=>{if(r<=t[0][0])return t[0][1];if(r>=t[e-1][0])return t[e-1][1];let i=1;for(;r>t[i][0];)i++;const s=t[i-1][0],n=t[i][0],o=(n-r)/(n-s);return o*t[i-1][1]+(1-o)*t[i][1]}}function sFt(t,e,r,i){fe(Kie,e,t),fe(ese,r,t),pt(i,Kie,ese),_e(i,i),i[3]=-ye(t,i)}const Kie=O(),ese=O(),nBe=O(),rw=O(),iw=O();function Fr(t=XA){return[t[0],t[1],t[2],t[3]]}function oBe(t=XA[0],e=XA[1],r=XA[2],i=XA[3]){return CJ(t,e,r,i,TJ.get())}function A8(t,e){return CJ(e[0],e[1],e[2],e[3],t)}function CJ(t,e,r,i,s=Fr()){return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function qbe(t,e,r){return ie(r,t),r[3]=e,r}function RP(t,e,r){const i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=Math.abs(i-1)>1e-5&&i>1e-12?1/Math.sqrt(i):1;return r[0]=e[0]*s,r[1]=e[1]*s,r[2]=e[2]*s,r[3]=-(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]),r}function ua(t,e,r,i=Fr()){const s=r[0]-e[0],n=r[1]-e[1],o=r[2]-e[2],a=t[0]-e[0],l=t[1]-e[1],c=t[2]-e[2],h=n*c-o*l,d=o*a-s*c,f=s*l-n*a,m=h*h+d*d+f*f,g=Math.abs(m-1)>1e-5&&m>1e-12?1/Math.sqrt(m):1;return i[0]=h*g,i[1]=d*g,i[2]=f*g,i[3]=-(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]),i}function Wbe(t,e,r,i,s){const n=t.length/3;if(n<3)return!1;ne(u3,t[3*r],t[3*r+1],t[3*r+2]);let o=i,a=!1;for(;o<n-1&&!a;){const l=3*o;ne(Xx,t[l],t[l+1],t[l+2]),o++,a=!ma(u3,Xx)}if(!a)return!1;for(o=Math.max(o,s),a=!1;o<n&&!a;){const l=3*o;ne(Ub,t[l],t[l+1],t[l+2]),o++,fe(BI,u3,Xx),_e(BI,BI),fe(GI,Xx,Ub),_e(GI,GI),a=!ma(u3,Ub)&&!ma(Xx,Ub)&&Math.abs(ye(BI,GI))<aBe}return a?(ua(u3,Xx,Ub,e),!0):(r!==0||i!==1||s!==2)&&Wbe(t,e,0,1,2)}const aBe=.99619469809,u3=O(),Xx=O(),Ub=O(),BI=O(),GI=O();function gj(t,e,r){return e!==t&&A8(t,e),t[3]=-ye(t,r),t}function yj(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function yM(t,e,r,i){return pt(Ub,e,t),RP(r,Ub,i)}function nFt(t,e,r,i){return O8(t,e,fe(Ge.get(),r,e),pBe,i)}function Rx(t,e,r){return e!=null&&O8(t,e.origin,e.direction,fBe,r)}function lBe(t,e,r){return O8(t,e.origin,e.vector,im.NONE,r)}function cBe(t,e,r){return O8(t,e.origin,e.vector,im.CLAMP,r)}function Xbe(t,e){return fi(t,e)>=0}function uBe(t,e){const r=ye(t,e.ray.direction),i=-fi(t,e.ray.origin);if(i<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return i>0;if((i<0||r<0)&&!(i<0&&r<0))return!0;const s=i/r;return r>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1}function hBe(t,e){const r=ye(t,e.ray.direction),i=-fi(t,e.ray.origin);if(r>-1e-6&&r<1e-6)return i>0;const s=i/r;return r>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1}function dBe(t,e,r){const i=se(Ge.get(),t,-t[3]),s=_j(t,fe(Ge.get(),e,i),Ge.get());return de(r,s,i),r}function _j(t,e,r){const i=se(Ge.get(),t,ye(t,e));return fe(r,e,i),r}function fi(t,e){return ye(t,e)+t[3]}function O8(t,e,r,i,s){const n=ye(t,r);if(n===0)return!1;let o=-(ye(t,e)+t[3])/n;return i&im.CLAMP&&(o=ve(o,0,1)),!(!(i&im.INFINITE_MIN)&&o<0||!(i&im.INFINITE_MAX)&&o>1)&&(de(s,e,se(s,r,o)),!0)}function oFt(t){return t}const XA=[0,0,1,0];var im;(function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.INFINITE_MIN=4]="INFINITE_MIN",t[t.INFINITE_MAX=8]="INFINITE_MAX"})(im||(im={}));const pBe=im.INFINITE_MIN|im.INFINITE_MAX,fBe=im.INFINITE_MAX,QU=K.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");let mBe=class{constructor(){this.plane=Fr(),this.origin=O(),this.basis1=O(),this.basis2=O()}};const Ybe=mBe;function P0(t=owe){return{plane:Fr(t.plane),origin:ks(t.origin),basis1:ks(t.basis1),basis2:ks(t.basis2)}}function gBe(t,e,r){const i=OBe.get();return i.origin=t,i.basis1=e,i.basis2=r,i.plane=oBe(0,0,0,0),R8(i),i}function Mx(t,e=P0()){return AJ(t.origin,t.basis1,t.basis2,e)}function yBe(t,e){ie(e.origin,t.origin),ie(e.basis1,t.basis1),ie(e.basis2,t.basis2),A8(e.plane,t.plane)}function AJ(t,e,r,i=P0()){return ie(i.origin,t),ie(i.basis1,e),ie(i.basis2,r),R8(i),CBe(i,"fromValues()"),i}function R8(t){yM(t.basis2,t.basis1,t.origin,t.plane)}function Zbe(t,e,r){t!==r&&Mx(t,r);const i=se(Ge.get(),w0(t),e);return de(r.origin,r.origin,i),r.plane[3]-=e,r}function _Be(t,e,r){return Jbe(e,r),Zbe(r,PJ(t,t.origin),r),r}function Jbe(t,e=P0()){const r=(t[2]-t[0])/2,i=(t[3]-t[1])/2;return ne(e.origin,t[0]+r,t[1]+i,0),ne(e.basis1,r,0,0),ne(e.basis2,0,i,0),CJ(0,0,1,0,e.plane),e}function OJ(t,e,r){return!!Rx(t.plane,e,r)&&swe(t,r)}function vBe(t,e,r){if(OJ(t,e,r))return r;const i=Qbe(t,e,Ge.get());return de(r,e.origin,se(Ge.get(),e.direction,mi(e.origin,i)/Re(e.direction))),r}function Qbe(t,e,r){const i=I5.get();nwe(t,e,i,I5.get());let s=Number.POSITIVE_INFINITY;for(const n of $J){const o=IJ(t,n,M8.get()),a=Ge.get();if(lBe(i,o,a)){const l=O0(Ge.get(),e.origin,a),c=Math.abs(Dn(ye(e.direction,l)));c<s&&(s=c,ie(r,a))}}return s===Number.POSITIVE_INFINITY?Kbe(t,e,r):r}function Kbe(t,e,r){if(OJ(t,e,r))return r;const i=I5.get(),s=I5.get();nwe(t,e,i,s);let n=Number.POSITIVE_INFINITY;for(const o of $J){const a=IJ(t,o,M8.get()),l=Ge.get();if(cBe(i,a,l)){const c=B7e(e,l);if(!Xbe(s,l))continue;c<n&&(n=c,ie(r,l))}}return RJ(t,e.origin)<n&&ewe(t,e.origin,r),r}function ewe(t,e,r){const i=dBe(t.plane,e,Ge.get()),s=pj(tse(t,t.basis1),i,-1,1,Ge.get()),n=pj(tse(t,t.basis2),i,-1,1,Ge.get());return fe(r,de(Ge.get(),s,n),t.origin),r}function twe(t,e,r){const{origin:i,basis1:s,basis2:n}=t,o=fe(Ge.get(),e,i),a=yR(s,o),l=yR(n,o),c=yR(w0(t),o);return ne(r,a,l,c)}function RJ(t,e){const r=twe(t,e,Ge.get()),{basis1:i,basis2:s}=t,n=Re(i),o=Re(s),a=Math.max(Math.abs(r[0])-n,0),l=Math.max(Math.abs(r[1])-o,0),c=r[2];return a*a+l*l+c*c}function bBe(t,e){return Math.sqrt(RJ(t,e))}function wBe(t,e){let r=Number.NEGATIVE_INFINITY;for(const i of $J){const s=IJ(t,i,M8.get()),n=EJ(s,e);n>r&&(r=n)}return Math.sqrt(r)}function MJ(t,e){return Xbe(t.plane,e)&&swe(t,e)}function xBe(t,e,r,i){return EBe(t,r,i)}function PJ(t,e){const r=-t.plane[3];return yR(w0(t),e)-r}function TBe(t,e,r,i){const s=PJ(t,e),n=se(ABe,w0(t),r-s);return de(i,e,n),i}function rwe(t,e){return ma(t.basis1,e.basis1)&&ma(t.basis2,e.basis2)&&ma(t.origin,e.origin)}function iwe(t,e,r){return t!==r&&Mx(t,r),$n(Yx,e),kc(Yx,Yx),ze(r.basis1,t.basis1,Yx),ze(r.basis2,t.basis2,Yx),ze(r.plane,t.plane,Yx),ze(r.origin,t.origin,e),gj(r.plane,r.plane,r.origin),r}function SBe(t,e,r,i){return t!==i&&Mx(t,i),Lu(KU,e,r),ze(i.basis1,t.basis1,KU),ze(i.basis2,t.basis2,KU),R8(i),i}function w0(t){return t.plane}function EBe(t,e,r){switch(e){case Mc.X:ie(r,t.basis1),_e(r,r);break;case Mc.Y:ie(r,t.basis2),_e(r,r);break;case Mc.Z:ie(r,w0(t))}return r}function swe(t,e){const r=fe(Ge.get(),e,t.origin),i=da(t.basis1),s=da(t.basis2),n=ye(t.basis1,r),o=ye(t.basis2,r);return-n-i<0&&n-i<0&&-o-s<0&&o-s<0}function tse(t,e){const r=M8.get();return ie(r.origin,t.origin),ie(r.vector,e),r}function IJ(t,e,r){const{basis1:i,basis2:s,origin:n}=t,o=se(Ge.get(),i,e.origin[0]),a=se(Ge.get(),s,e.origin[1]);de(r.origin,o,a),de(r.origin,r.origin,n);const l=se(Ge.get(),i,e.direction[0]),c=se(Ge.get(),s,e.direction[1]);return se(r.vector,de(l,l,c),2),r}function CBe(t,e){Math.abs(ye(t.basis1,t.basis2)/(Re(t.basis1)*Re(t.basis2)))>1e-6&&QU.warn(e,"Provided basis vectors are not perpendicular"),Math.abs(ye(t.basis1,w0(t)))>1e-6&&QU.warn(e,"Basis vectors and plane normal are not perpendicular"),Math.abs(-ye(w0(t),t.origin)-t.plane[3])>1e-6&&QU.warn(e,"Plane offset is not consistent with plane origin")}function nwe(t,e,r,i){const s=w0(t);yM(s,e.direction,e.origin,r),yM(r,s,e.origin,i)}const owe={plane:Fr(),origin:Pe(0,0,0),basis1:Pe(1,0,0),basis2:Pe(0,1,0)},I5=new M0(Fr),M8=new M0(Dp),ABe=O(),OBe=new M0(()=>P0()),$J=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],Yx=xe(),KU=xe(),RBe=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:Ybe,UP:owe,altitudeAt:PJ,axisAt:xBe,closestPoint:Kbe,closestPointOnSilhouette:Qbe,copy:Mx,copyWithoutVerify:yBe,create:P0,distance:bBe,distance2:RJ,distanceToSilhouette:wBe,elevate:Zbe,equals:rwe,extrusionContainsPoint:MJ,fromAABoundingRect:Jbe,fromValues:AJ,intersectRay:OJ,intersectRayClosestSilhouette:vBe,normal:w0,projectPoint:ewe,projectPointLocal:twe,rotate:SBe,setAltitudeAt:TBe,setExtent:_Be,transform:iwe,updateUnboundedPlane:R8,wrap:gBe},Symbol.toStringTag,{value:"Module"})),MBe=new qe(q0e),rse=new qe(sZ),ise=new qe(nZ),lFt=new qe(W0e);function _m(t){return t&&(Om(t)||Ln(t,rse))?rse:t&&(Rm(t)||Ln(t,ise))?ise:MBe}function PBe(t){const{value:e,operations:r}=t;return{operations:r,value:r.create(e)}}function IBe(t,e,r){return t.operations.setExtent(t.value,e,r.value),r}function $Be(t){return{operations:t,value:t.create()}}function awe(t,e,r=$Be(t)){return r.operations=t,t.copy(e,r.value),r}function LBe(t){return awe(rBe,zbe(0,0,0,Vr(t).radius))}const sse=2**50;function DBe(){return awe(RBe,AJ([0,0,0],[sse,0,0],[0,sse,0]))}function NBe(t,e,r){return t.operations.axisAt(t.value,e,Mc.Z,r)}function FBe(t,e,r,i){return t.operations.axisAt(t.value,e,r,i)}function UBe(t,e,r){return t.operations.intersectRay(t.value,e,r)}function kBe(t,e,r){return t.operations.intersectRayClosestSilhouette(t.value,e,r)}function zBe(t,e){return t.operations.altitudeAt(t.value,e)}function lwe(t,e,r,i){return t.operations.setAltitudeAt(t.value,e,r,i)}function VBe(t,e,r,i){return e!==i&&zs(i,e),ne(Zx,i[12],i[13],i[14]),lwe(t,Zx,r,Zx),i[12]=Zx[0],i[13]=Zx[1],i[14]=Zx[2],i}function ek(t,e,r){return t.operations.elevate(t.value,e,r.value)}const Zx=O();function nse(t,e,r,i,s){return s[0]=ye(t,e),s[1]=ye(t,r),s[2]=ye(t,i),s}function vj(t,e,r,i,s){ie(r,t),ie(jI,e),_e(jI,jI),pt(i,jI,r),pt(s,i,r)}function BBe(t,e){return t?_m(e):e.isGeographic?qe.PlateCarree:e}const jI=O(),LJ=96;function cFt(t,e){const r=e||t.extent,i=t.width,s=Ta(r&&r.spatialReference);return r&&i?r.width/i*s*oZ*LJ:0}function cwe(t,e){return t/(Ta(e)*oZ*LJ)}function GBe(t){return t/(oZ*LJ)}function jBe(t,e){const r=t.extent,i=t.width-(t.padding?t.padding.left+t.padding.right:0),s=cwe(e,r.spatialReference);return r.clone().expand(s*i/r.width)}const HBe="OBJECTID";let PE=class extends pR{constructor(e){super(e),this.handles.add(this.on("before-add",r=>{r.item!=null&&r.item.parent===this.owner&&(K.getLogger(this).warn("Analysis inside the collection must be unique. Not adding this element again."),r.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};PE=u([P("esri.support.AnalysesCollection")],PE);const pN={widthBreakpoint:{getValue(t){const e=t.viewSize[0],r=t.breakpoints,i=this.values;return e<=r.xsmall?i.xsmall:e<=r.small?i.small:e<=r.medium?i.medium:e<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(t){const e=t.viewSize[1],r=t.breakpoints,i=this.values;return e<=r.xsmall?i.xsmall:e<=r.small?i.small:e<=r.medium?i.medium:e<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(t){const e=t.viewSize,r=e[0],i=e[1],s=this.values;return i>=r?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},tk={xsmall:544,small:768,medium:992,large:1200};function qBe(t){const e=t;return e&&e.xsmall<e.small&&e.small<e.medium&&e.medium<e.large}function rk(t,e){return e?pN[t].valueToClassName[e].split(" "):[]}const WBe=t=>{let e=class extends t{constructor(...r){super(...r),this._breakpointsHandles=new $i,this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=tk}initialize(){this._breakpointsHandles.add(le(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),Pr))}destroy(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=Ne(this._breakpointsHandles))}set breakpoints(r){if(r===this._get("breakpoints"))return;const i=qBe(r);if(!i){const s=JSON.stringify(tk,null,2);console.warn("provided breakpoints are not valid, using defaults:"+s)}r=i?r:tk,this._set("breakpoints",{...r})}_updateClassNames(){if(!this.container)return;const r=xc.acquire(),i=xc.acquire();let s,n=!1;for(s in pN){const o=this[s],a=pN[s].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(n=!0,this[s]=a,rk(s,o).forEach(l=>i.push(l)),rk(s,a).forEach(l=>r.push(l)))}n&&(this._applyClassNameChanges(r,i),xc.release(r),xc.release(i))}_applyClassNameChanges(r,i){const s=this.container;s&&(i.forEach(n=>s.classList.remove(n)),r.forEach(n=>s.classList.add(n)))}_removeActiveClassNames(){const r=this.container;if(!r)return;let i;for(i in pN)rk(i,this[i]).forEach(s=>r.classList.remove(s))}};return u([p()],e.prototype,"breakpoints",null),u([p()],e.prototype,"orientation",void 0),u([p()],e.prototype,"widthBreakpoint",void 0),u([p()],e.prototype,"heightBreakpoint",void 0),e=u([P("esri.views.BreakpointsOwner")],e),e};/*!
 * @esri/arcgis-html-sanitizer - v3.0.1 - Tue Nov 15 2022 09:46:54 GMT-0800 (Pacific Standard Time)
 * Copyright (c) 2022 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2018 Zongmin Lei() <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 */var XBe=function(t){if(typeof t!="object"||t===null||Object.prototype.toString.call(t)!=="[object Object]")return!1;var e=Object.getPrototypeOf(t);if(e===null)return!0;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},kb={exports:{}},tn={},_M={exports:{}},Px={};function uwe(){var t={};return t["align-content"]=!1,t["align-items"]=!1,t["align-self"]=!1,t["alignment-adjust"]=!1,t["alignment-baseline"]=!1,t.all=!1,t["anchor-point"]=!1,t.animation=!1,t["animation-delay"]=!1,t["animation-direction"]=!1,t["animation-duration"]=!1,t["animation-fill-mode"]=!1,t["animation-iteration-count"]=!1,t["animation-name"]=!1,t["animation-play-state"]=!1,t["animation-timing-function"]=!1,t.azimuth=!1,t["backface-visibility"]=!1,t.background=!0,t["background-attachment"]=!0,t["background-clip"]=!0,t["background-color"]=!0,t["background-image"]=!0,t["background-origin"]=!0,t["background-position"]=!0,t["background-repeat"]=!0,t["background-size"]=!0,t["baseline-shift"]=!1,t.binding=!1,t.bleed=!1,t["bookmark-label"]=!1,t["bookmark-level"]=!1,t["bookmark-state"]=!1,t.border=!0,t["border-bottom"]=!0,t["border-bottom-color"]=!0,t["border-bottom-left-radius"]=!0,t["border-bottom-right-radius"]=!0,t["border-bottom-style"]=!0,t["border-bottom-width"]=!0,t["border-collapse"]=!0,t["border-color"]=!0,t["border-image"]=!0,t["border-image-outset"]=!0,t["border-image-repeat"]=!0,t["border-image-slice"]=!0,t["border-image-source"]=!0,t["border-image-width"]=!0,t["border-left"]=!0,t["border-left-color"]=!0,t["border-left-style"]=!0,t["border-left-width"]=!0,t["border-radius"]=!0,t["border-right"]=!0,t["border-right-color"]=!0,t["border-right-style"]=!0,t["border-right-width"]=!0,t["border-spacing"]=!0,t["border-style"]=!0,t["border-top"]=!0,t["border-top-color"]=!0,t["border-top-left-radius"]=!0,t["border-top-right-radius"]=!0,t["border-top-style"]=!0,t["border-top-width"]=!0,t["border-width"]=!0,t.bottom=!1,t["box-decoration-break"]=!0,t["box-shadow"]=!0,t["box-sizing"]=!0,t["box-snap"]=!0,t["box-suppress"]=!0,t["break-after"]=!0,t["break-before"]=!0,t["break-inside"]=!0,t["caption-side"]=!1,t.chains=!1,t.clear=!0,t.clip=!1,t["clip-path"]=!1,t["clip-rule"]=!1,t.color=!0,t["color-interpolation-filters"]=!0,t["column-count"]=!1,t["column-fill"]=!1,t["column-gap"]=!1,t["column-rule"]=!1,t["column-rule-color"]=!1,t["column-rule-style"]=!1,t["column-rule-width"]=!1,t["column-span"]=!1,t["column-width"]=!1,t.columns=!1,t.contain=!1,t.content=!1,t["counter-increment"]=!1,t["counter-reset"]=!1,t["counter-set"]=!1,t.crop=!1,t.cue=!1,t["cue-after"]=!1,t["cue-before"]=!1,t.cursor=!1,t.direction=!1,t.display=!0,t["display-inside"]=!0,t["display-list"]=!0,t["display-outside"]=!0,t["dominant-baseline"]=!1,t.elevation=!1,t["empty-cells"]=!1,t.filter=!1,t.flex=!1,t["flex-basis"]=!1,t["flex-direction"]=!1,t["flex-flow"]=!1,t["flex-grow"]=!1,t["flex-shrink"]=!1,t["flex-wrap"]=!1,t.float=!1,t["float-offset"]=!1,t["flood-color"]=!1,t["flood-opacity"]=!1,t["flow-from"]=!1,t["flow-into"]=!1,t.font=!0,t["font-family"]=!0,t["font-feature-settings"]=!0,t["font-kerning"]=!0,t["font-language-override"]=!0,t["font-size"]=!0,t["font-size-adjust"]=!0,t["font-stretch"]=!0,t["font-style"]=!0,t["font-synthesis"]=!0,t["font-variant"]=!0,t["font-variant-alternates"]=!0,t["font-variant-caps"]=!0,t["font-variant-east-asian"]=!0,t["font-variant-ligatures"]=!0,t["font-variant-numeric"]=!0,t["font-variant-position"]=!0,t["font-weight"]=!0,t.grid=!1,t["grid-area"]=!1,t["grid-auto-columns"]=!1,t["grid-auto-flow"]=!1,t["grid-auto-rows"]=!1,t["grid-column"]=!1,t["grid-column-end"]=!1,t["grid-column-start"]=!1,t["grid-row"]=!1,t["grid-row-end"]=!1,t["grid-row-start"]=!1,t["grid-template"]=!1,t["grid-template-areas"]=!1,t["grid-template-columns"]=!1,t["grid-template-rows"]=!1,t["hanging-punctuation"]=!1,t.height=!0,t.hyphens=!1,t.icon=!1,t["image-orientation"]=!1,t["image-resolution"]=!1,t["ime-mode"]=!1,t["initial-letters"]=!1,t["inline-box-align"]=!1,t["justify-content"]=!1,t["justify-items"]=!1,t["justify-self"]=!1,t.left=!1,t["letter-spacing"]=!0,t["lighting-color"]=!0,t["line-box-contain"]=!1,t["line-break"]=!1,t["line-grid"]=!1,t["line-height"]=!1,t["line-snap"]=!1,t["line-stacking"]=!1,t["line-stacking-ruby"]=!1,t["line-stacking-shift"]=!1,t["line-stacking-strategy"]=!1,t["list-style"]=!0,t["list-style-image"]=!0,t["list-style-position"]=!0,t["list-style-type"]=!0,t.margin=!0,t["margin-bottom"]=!0,t["margin-left"]=!0,t["margin-right"]=!0,t["margin-top"]=!0,t["marker-offset"]=!1,t["marker-side"]=!1,t.marks=!1,t.mask=!1,t["mask-box"]=!1,t["mask-box-outset"]=!1,t["mask-box-repeat"]=!1,t["mask-box-slice"]=!1,t["mask-box-source"]=!1,t["mask-box-width"]=!1,t["mask-clip"]=!1,t["mask-image"]=!1,t["mask-origin"]=!1,t["mask-position"]=!1,t["mask-repeat"]=!1,t["mask-size"]=!1,t["mask-source-type"]=!1,t["mask-type"]=!1,t["max-height"]=!0,t["max-lines"]=!1,t["max-width"]=!0,t["min-height"]=!0,t["min-width"]=!0,t["move-to"]=!1,t["nav-down"]=!1,t["nav-index"]=!1,t["nav-left"]=!1,t["nav-right"]=!1,t["nav-up"]=!1,t["object-fit"]=!1,t["object-position"]=!1,t.opacity=!1,t.order=!1,t.orphans=!1,t.outline=!1,t["outline-color"]=!1,t["outline-offset"]=!1,t["outline-style"]=!1,t["outline-width"]=!1,t.overflow=!1,t["overflow-wrap"]=!1,t["overflow-x"]=!1,t["overflow-y"]=!1,t.padding=!0,t["padding-bottom"]=!0,t["padding-left"]=!0,t["padding-right"]=!0,t["padding-top"]=!0,t.page=!1,t["page-break-after"]=!1,t["page-break-before"]=!1,t["page-break-inside"]=!1,t["page-policy"]=!1,t.pause=!1,t["pause-after"]=!1,t["pause-before"]=!1,t.perspective=!1,t["perspective-origin"]=!1,t.pitch=!1,t["pitch-range"]=!1,t["play-during"]=!1,t.position=!1,t["presentation-level"]=!1,t.quotes=!1,t["region-fragment"]=!1,t.resize=!1,t.rest=!1,t["rest-after"]=!1,t["rest-before"]=!1,t.richness=!1,t.right=!1,t.rotation=!1,t["rotation-point"]=!1,t["ruby-align"]=!1,t["ruby-merge"]=!1,t["ruby-position"]=!1,t["shape-image-threshold"]=!1,t["shape-outside"]=!1,t["shape-margin"]=!1,t.size=!1,t.speak=!1,t["speak-as"]=!1,t["speak-header"]=!1,t["speak-numeral"]=!1,t["speak-punctuation"]=!1,t["speech-rate"]=!1,t.stress=!1,t["string-set"]=!1,t["tab-size"]=!1,t["table-layout"]=!1,t["text-align"]=!0,t["text-align-last"]=!0,t["text-combine-upright"]=!0,t["text-decoration"]=!0,t["text-decoration-color"]=!0,t["text-decoration-line"]=!0,t["text-decoration-skip"]=!0,t["text-decoration-style"]=!0,t["text-emphasis"]=!0,t["text-emphasis-color"]=!0,t["text-emphasis-position"]=!0,t["text-emphasis-style"]=!0,t["text-height"]=!0,t["text-indent"]=!0,t["text-justify"]=!0,t["text-orientation"]=!0,t["text-overflow"]=!0,t["text-shadow"]=!0,t["text-space-collapse"]=!0,t["text-transform"]=!0,t["text-underline-position"]=!0,t["text-wrap"]=!0,t.top=!1,t.transform=!1,t["transform-origin"]=!1,t["transform-style"]=!1,t.transition=!1,t["transition-delay"]=!1,t["transition-duration"]=!1,t["transition-property"]=!1,t["transition-timing-function"]=!1,t["unicode-bidi"]=!1,t["vertical-align"]=!1,t.visibility=!1,t["voice-balance"]=!1,t["voice-duration"]=!1,t["voice-family"]=!1,t["voice-pitch"]=!1,t["voice-range"]=!1,t["voice-rate"]=!1,t["voice-stress"]=!1,t["voice-volume"]=!1,t.volume=!1,t["white-space"]=!1,t.widows=!1,t.width=!0,t["will-change"]=!1,t["word-break"]=!0,t["word-spacing"]=!0,t["word-wrap"]=!0,t["wrap-flow"]=!1,t["wrap-through"]=!1,t["writing-mode"]=!1,t["z-index"]=!1,t}function YBe(t,e,r){}function ZBe(t,e,r){}var JBe=/javascript\s*\:/img;function QBe(t,e){return JBe.test(e)?"":e}Px.whiteList=uwe();Px.getDefaultWhiteList=uwe;Px.onAttr=YBe;Px.onIgnoreAttr=ZBe;Px.safeAttrValue=QBe;var KBe={indexOf:function(t,e){var r,i;if(Array.prototype.indexOf)return t.indexOf(e);for(r=0,i=t.length;r<i;r++)if(t[r]===e)return r;return-1},forEach:function(t,e,r){var i,s;if(Array.prototype.forEach)return t.forEach(e,r);for(i=0,s=t.length;i<s;i++)e.call(r,t[i],i,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(t){return String.prototype.trimRight?t.trimRight():t.replace(/(\s*$)/g,"")}},h3=KBe;function eGe(t,e){t=h3.trimRight(t),t[t.length-1]!==";"&&(t+=";");var r=t.length,i=!1,s=0,n=0,o="";function a(){if(!i){var h=h3.trim(t.slice(s,n)),d=h.indexOf(":");if(d!==-1){var f=h3.trim(h.slice(0,d)),m=h3.trim(h.slice(d+1));if(f){var g=e(s,o.length,f,m,h);g&&(o+=g+"; ")}}}s=n+1}for(;n<r;n++){var l=t[n];if(l==="/"&&t[n+1]==="*"){var c=t.indexOf("*/",n+2);if(c===-1)break;n=c+1,s=n+1,i=!1}else l==="("?i=!0:l===")"?i=!1:l===";"?i||a():l===`
`&&a()}return h3.trim(o)}var tGe=eGe,HI=Px,rGe=tGe;function ose(t){return t==null}function iGe(t){var e={};for(var r in t)e[r]=t[r];return e}function hwe(t){t=iGe(t||{}),t.whiteList=t.whiteList||HI.whiteList,t.onAttr=t.onAttr||HI.onAttr,t.onIgnoreAttr=t.onIgnoreAttr||HI.onIgnoreAttr,t.safeAttrValue=t.safeAttrValue||HI.safeAttrValue,this.options=t}hwe.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,r=e.options,i=r.whiteList,s=r.onAttr,n=r.onIgnoreAttr,o=r.safeAttrValue,a=rGe(t,function(l,c,h,d,f){var m=i[h],g=!1;if(m===!0?g=m:typeof m=="function"?g=m(d):m instanceof RegExp&&(g=m.test(d)),g!==!0&&(g=!1),d=o(h,d),!!d){var _={position:c,sourcePosition:l,source:f,isWhite:g};if(g){var v=s(h,d,_);return ose(v)?h+":"+d:v}else{var v=n(h,d,_);if(!ose(v))return v}}});return a};var sGe=hwe;(function(t,e){var r=Px,i=sGe;function s(o,a){var l=new i(a);return l.process(o)}e=t.exports=s,e.FilterCSS=i;for(var n in r)e[n]=r[n]})(_M,_M.exports);var DJ={indexOf:function(t,e){var r,i;if(Array.prototype.indexOf)return t.indexOf(e);for(r=0,i=t.length;r<i;r++)if(t[r]===e)return r;return-1},forEach:function(t,e,r){var i,s;if(Array.prototype.forEach)return t.forEach(e,r);for(i=0,s=t.length;i<s;i++)e.call(r,t[i],i,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(t){var e=/\s|\n|\t/,r=e.exec(t);return r?r.index:-1}},nGe=_M.exports.FilterCSS,oGe=_M.exports.getDefaultWhiteList,$5=DJ;function dwe(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var pwe=new nGe;function aGe(t,e,r){}function lGe(t,e,r){}function cGe(t,e,r){}function uGe(t,e,r){}function fwe(t){return t.replace(dGe,"&lt;").replace(pGe,"&gt;")}function hGe(t,e,r,i){if(r=bwe(r),e==="href"||e==="src"){if(r=$5.trim(r),r==="#")return"#";if(!(r.substr(0,7)==="http://"||r.substr(0,8)==="https://"||r.substr(0,7)==="mailto:"||r.substr(0,4)==="tel:"||r.substr(0,11)==="data:image/"||r.substr(0,6)==="ftp://"||r.substr(0,2)==="./"||r.substr(0,3)==="../"||r[0]==="#"||r[0]==="/"))return""}else if(e==="background"){if(qI.lastIndex=0,qI.test(r))return""}else if(e==="style"){if(ase.lastIndex=0,ase.test(r)||(lse.lastIndex=0,lse.test(r)&&(qI.lastIndex=0,qI.test(r))))return"";i!==!1&&(i=i||pwe,r=i.process(r))}return r=wwe(r),r}var dGe=/</g,pGe=/>/g,fGe=/"/g,mGe=/&quot;/g,gGe=/&#([a-zA-Z0-9]*);?/gim,yGe=/&colon;?/gim,_Ge=/&newline;?/gim,qI=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,ase=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,lse=/u\s*r\s*l\s*\(.*/gi;function mwe(t){return t.replace(fGe,"&quot;")}function gwe(t){return t.replace(mGe,'"')}function ywe(t){return t.replace(gGe,function(r,i){return i[0]==="x"||i[0]==="X"?String.fromCharCode(parseInt(i.substr(1),16)):String.fromCharCode(parseInt(i,10))})}function _we(t){return t.replace(yGe,":").replace(_Ge," ")}function vwe(t){for(var e="",r=0,i=t.length;r<i;r++)e+=t.charCodeAt(r)<32?" ":t.charAt(r);return $5.trim(e)}function bwe(t){return t=gwe(t),t=ywe(t),t=_we(t),t=vwe(t),t}function wwe(t){return t=mwe(t),t=fwe(t),t}function vGe(){return""}function bGe(t,e){typeof e!="function"&&(e=function(){});var r=!Array.isArray(t);function i(o){return r?!0:$5.indexOf(t,o)!==-1}var s=[],n=!1;return{onIgnoreTag:function(o,a,l){if(i(o))if(l.isClosing){var c="[/removed]",h=l.position+c.length;return s.push([n!==!1?n:l.position,h]),n=!1,c}else return n||(n=l.position),"[removed]";else return e(o,a,l)},remove:function(o){var a="",l=0;return $5.forEach(s,function(c){a+=o.slice(l,c[0]),l=c[1]}),a+=o.slice(l),a}}}function wGe(t){for(var e="",r=0;r<t.length;){var i=t.indexOf("<!--",r);if(i===-1){e+=t.slice(r);break}e+=t.slice(r,i);var s=t.indexOf("-->",i);if(s===-1)break;r=s+3}return e}function xGe(t){var e=t.split("");return e=e.filter(function(r){var i=r.charCodeAt(0);return i===127?!1:i<=31?i===10||i===13:!0}),e.join("")}tn.whiteList=dwe();tn.getDefaultWhiteList=dwe;tn.onTag=aGe;tn.onIgnoreTag=lGe;tn.onTagAttr=cGe;tn.onIgnoreTagAttr=uGe;tn.safeAttrValue=hGe;tn.escapeHtml=fwe;tn.escapeQuote=mwe;tn.unescapeQuote=gwe;tn.escapeHtmlEntities=ywe;tn.escapeDangerHtml5Entities=_we;tn.clearNonPrintableCharacter=vwe;tn.friendlyAttrValue=bwe;tn.escapeAttrValue=wwe;tn.onIgnoreTagStripAll=vGe;tn.StripTagBody=bGe;tn.stripCommentTag=wGe;tn.stripBlankChar=xGe;tn.cssFilter=pwe;tn.getDefaultCSSWhiteList=oGe;var P8={},p_=DJ;function TGe(t){var e=p_.spaceIndex(t),r;return e===-1?r=t.slice(1,-1):r=t.slice(1,e+1),r=p_.trim(r).toLowerCase(),r.slice(0,1)==="/"&&(r=r.slice(1)),r.slice(-1)==="/"&&(r=r.slice(0,-1)),r}function SGe(t){return t.slice(0,2)==="</"}function EGe(t,e,r){var i="",s=0,n=!1,o=!1,a=0,l=t.length,c="",h="";e:for(a=0;a<l;a++){var d=t.charAt(a);if(n===!1){if(d==="<"){n=a;continue}}else if(o===!1){if(d==="<"){i+=r(t.slice(s,a)),n=a,s=a;continue}if(d===">"){i+=r(t.slice(s,n)),h=t.slice(n,a+1),c=TGe(h),i+=e(n,i.length,c,h,SGe(h)),s=a+1,n=!1;continue}if(d==='"'||d==="'")for(var f=1,m=t.charAt(a-f);m.trim()===""||m==="=";){if(m==="="){o=d;continue e}m=t.charAt(a-++f)}}else if(d===o){o=!1;continue}}return s<t.length&&(i+=r(t.substr(s))),i}var CGe=/[^a-zA-Z0-9\\_:.-]/gim;function AGe(t,e){var r=0,i=0,s=[],n=!1,o=t.length;function a(f,m){if(f=p_.trim(f),f=f.replace(CGe,"").toLowerCase(),!(f.length<1)){var g=e(f,m||"");g&&s.push(g)}}for(var l=0;l<o;l++){var c=t.charAt(l),h,d;if(n===!1&&c==="="){n=t.slice(r,l),r=l+1,i=t.charAt(r)==='"'||t.charAt(r)==="'"?r:RGe(t,l+1);continue}if(n!==!1&&l===i){if(d=t.indexOf(c,l+1),d===-1)break;h=p_.trim(t.slice(i+1,d)),a(n,h),n=!1,l=d,r=l+1;continue}if(/\s|\n|\t/.test(c))if(t=t.replace(/\s|\n|\t/g," "),n===!1)if(d=OGe(t,l),d===-1){h=p_.trim(t.slice(r,l)),a(h),n=!1,r=l+1;continue}else{l=d-1;continue}else if(d=MGe(t,l-1),d===-1){h=p_.trim(t.slice(r,l)),h=cse(h),a(n,h),n=!1,r=l+1;continue}else continue}return r<t.length&&(n===!1?a(t.slice(r)):a(n,cse(p_.trim(t.slice(r))))),p_.trim(s.join(" "))}function OGe(t,e){for(;e<t.length;e++){var r=t[e];if(r!==" ")return r==="="?e:-1}}function RGe(t,e){for(;e<t.length;e++){var r=t[e];if(r!==" ")return r==="'"||r==='"'?e:-1}}function MGe(t,e){for(;e>0;e--){var r=t[e];if(r!==" ")return r==="="?e:-1}}function PGe(t){return t[0]==='"'&&t[t.length-1]==='"'||t[0]==="'"&&t[t.length-1]==="'"}function cse(t){return PGe(t)?t.substr(1,t.length-2):t}P8.parseTag=EGe;P8.parseAttr=AGe;var IGe=_M.exports.FilterCSS,Zd=tn,xwe=P8,$Ge=xwe.parseTag,LGe=xwe.parseAttr,fN=DJ;function WI(t){return t==null}function DGe(t){var e=fN.spaceIndex(t);if(e===-1)return{html:"",closing:t[t.length-2]==="/"};t=fN.trim(t.slice(e+1,-1));var r=t[t.length-1]==="/";return r&&(t=fN.trim(t.slice(0,-1))),{html:t,closing:r}}function NGe(t){var e={};for(var r in t)e[r]=t[r];return e}function FGe(t){var e={};for(var r in t)Array.isArray(t[r])?e[r.toLowerCase()]=t[r].map(function(i){return i.toLowerCase()}):e[r.toLowerCase()]=t[r];return e}function Twe(t){t=NGe(t||{}),t.stripIgnoreTag&&(t.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),t.onIgnoreTag=Zd.onIgnoreTagStripAll),t.whiteList||t.allowList?t.whiteList=FGe(t.whiteList||t.allowList):t.whiteList=Zd.whiteList,t.onTag=t.onTag||Zd.onTag,t.onTagAttr=t.onTagAttr||Zd.onTagAttr,t.onIgnoreTag=t.onIgnoreTag||Zd.onIgnoreTag,t.onIgnoreTagAttr=t.onIgnoreTagAttr||Zd.onIgnoreTagAttr,t.safeAttrValue=t.safeAttrValue||Zd.safeAttrValue,t.escapeHtml=t.escapeHtml||Zd.escapeHtml,this.options=t,t.css===!1?this.cssFilter=!1:(t.css=t.css||{},this.cssFilter=new IGe(t.css))}Twe.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,r=e.options,i=r.whiteList,s=r.onTag,n=r.onIgnoreTag,o=r.onTagAttr,a=r.onIgnoreTagAttr,l=r.safeAttrValue,c=r.escapeHtml,h=e.cssFilter;r.stripBlankChar&&(t=Zd.stripBlankChar(t)),r.allowCommentTag||(t=Zd.stripCommentTag(t));var d=!1;r.stripIgnoreTagBody&&(d=Zd.StripTagBody(r.stripIgnoreTagBody,n),n=d.onIgnoreTag);var f=$Ge(t,function(m,g,_,v,b){var T={sourcePosition:m,position:g,isClosing:b,isWhite:Object.prototype.hasOwnProperty.call(i,_)},x=s(_,v,T);if(!WI(x))return x;if(T.isWhite){if(T.isClosing)return"</"+_+">";var S=DGe(v),E=i[_],A=LGe(S.html,function(R,M){var D=fN.indexOf(E,R)!==-1,k=o(_,R,M,D);return WI(k)?D?(M=l(_,R,M,h),M?R+'="'+M+'"':R):(k=a(_,R,M,D),WI(k)?void 0:k):k});return v="<"+_,A&&(v+=" "+A),S.closing&&(v+=" /"),v+=">",v}else return x=n(_,v,T),WI(x)?c(v):x},c);return d&&(f=d.remove(f)),f};var UGe=Twe;(function(t,e){var r=tn,i=P8,s=UGe;function n(a,l){var c=new s(l);return c.process(a)}e=t.exports=n,e.filterXSS=n,e.FilterXSS=s,function(){for(var a in r)e[a]=r[a];for(var l in i)e[l]=i[l]}();function o(){return typeof self<"u"&&typeof DedicatedWorkerGlobalScope<"u"&&self instanceof DedicatedWorkerGlobalScope}o()&&(self.filterXSS=t.exports)})(kb,kb.exports);var kGe=function(){function t(e,r){var i=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(n,o,a,l){return n==="a"&&o==="href"||(n==="img"||n==="source")&&o==="src"?i.sanitizeUrl(a):kb.exports.safeAttrValue(n,o,a,l)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"};var s;e&&!r?s=e:e&&r?(s=Object.create(this.arcgisFilterOptions),Object.keys(e).forEach(function(n){n==="whiteList"?s.whiteList=i._extendObjectOfArrays([i.arcgisWhiteList,e.whiteList||{}]):s[n]=e[n]})):(s=Object.create(this.arcgisFilterOptions),s.whiteList=this.arcgisWhiteList),this.xssFilterOptions=s,this._xssFilter=new kb.exports.FilterXSS(s)}return t.prototype.sanitize=function(e,r){switch(r===void 0&&(r={}),typeof e){case"number":return isNaN(e)||!isFinite(e)?null:e;case"boolean":return e;case"string":return this._xssFilter.process(e);case"object":return this._iterateOverObject(e,r);default:return r.allowUndefined&&typeof e>"u"?void 0:null}},t.prototype.sanitizeUrl=function(e,r){var i=(r??{}).isProtocolRequired,s=i===void 0?!0:i,n=this._trim(e.substring(0,e.indexOf(":"))),o=e==="/",a=/^#/.test(e),l=n&&this.allowedProtocols.indexOf(n.toLowerCase())>-1;return o||a||l?kb.exports.escapeAttrValue(e):!n&&!s?kb.exports.escapeAttrValue("https://".concat(e)):""},t.prototype.sanitizeHTMLAttribute=function(e,r,i,s){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(e,r,i,s):kb.exports.safeAttrValue(e,r,i,s)},t.prototype.validate=function(e,r){r===void 0&&(r={});var i=this.sanitize(e,r);return{isValid:e===i,sanitized:i}},t.prototype.encodeHTML=function(e){var r=this;return String(e).replace(/[&<>"'\/]/g,function(i){return r._entityMap[i]})},t.prototype.encodeAttrValue=function(e){var r=/^[a-zA-Z0-9]$/;return String(e).replace(/[\x00-\xFF]/g,function(i,s){return r.test(i)?i:"&#x".concat(Number(e.charCodeAt(s)).toString(16),";")})},t.prototype._extendObjectOfArrays=function(e){var r={};return e.forEach(function(i){Object.keys(i).forEach(function(s){Array.isArray(i[s])&&Array.isArray(r[s])?r[s]=r[s].concat(i[s]):r[s]=i[s]})}),r},t.prototype._iterateOverObject=function(e,r){var i=this;r===void 0&&(r={});try{var s=!1,n=void 0;if(Array.isArray(e))n=e.reduce(function(a,l){var c=i.validate(l,r);return c.isValid?a.concat([l]):(s=!0,a.concat([c.sanitized]))},[]);else if(XBe(e)){var o=Object.keys(e);n=o.reduce(function(a,l){var c=e[l],h=i.validate(c,r);return h.isValid?a[l]=c:(s=!0,a[l]=h.sanitized),a},{})}else return r.allowUndefined&&typeof e>"u"?void 0:null;return s?n:e}catch{return null}},t.prototype._trim=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},t}();const I8=new Map;function Swe(){I8.clear()}function zGe(t){return I8.get(t)}function VGe(t,e){I8.set(t,e)}function ik(t){I8.delete(t)}var jw,IE,BGe=function(t){if("WebkitTransition"in t.style)jw="webkitTransitionEnd",IE="webkitAnimationEnd";else{if(!("transition"in t.style))throw new Error("Your browser is not supported!");jw="transitionend",IE="animationend"}},Ewe=function(t){jw||BGe(t)},GGe=function(t,e){return e===void 0&&(e=t+"-active"),function(r){Ewe(r);var i=!1,s=function(n){i||(i=!0,r.removeEventListener(jw,s),r.removeEventListener(IE,s),r.classList.remove(t),r.classList.remove(e))};r.classList.add(t),r.addEventListener(jw,s),r.addEventListener(IE,s),requestAnimationFrame(function(){r.classList.add(e)})}},jGe=function(t,e){return e===void 0&&(e=t+"-active"),function(r,i){Ewe(r);var s=!1,n=function(o){s||(s=!0,r.removeEventListener(jw,n),r.removeEventListener(IE,n),i())};r.classList.add(t),r.addEventListener(jw,n),r.addEventListener(IE,n),requestAnimationFrame(function(){r.classList.add(e)})}};const HGe=K.getLogger("esri.widgets.support.widgetUtils");function qGe(t){const e=xc.acquire();for(let i=0;i<arguments.length;i++){const s=arguments[i],n=typeof s;if(n==="string")e.push(s);else if(Array.isArray(s))e.push.apply(e,s);else if(n==="object")for(const o in s)s[o]&&e.push(o)}const r=e.join(" ");return xc.release(e),r}(()=>{const t=new Map,e=new ResizeObserver(i=>{Swe();for(const s of i)t.get(s.target)?.(s)}),r=(i,s,n)=>(t.has(i)&&HGe.error("Already observing element",i),t.set(i,s),e.observe(i,n),nl(()=>{e.unobserve(i),t.delete(i)}));return(i,s,n)=>{let o=null;return le(()=>typeof i=="function"?i():i,a=>{o?.remove(),a&&(o=r(a,s,n))},Ls)}})();function WGe(t){const e=t?.closest("[dir]");return e!==null&&e instanceof HTMLElement&&e.dir==="rtl"||document.dir==="rtl"}function hFt(t){const e="data-node-ref";this[t.getAttribute(e)]=null}function XI(t){const e="data-node-ref";this[t.getAttribute(e)]=t}function dFt(t,e){return(t==="enter"?GGe:jGe)(e)}const XGe=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],YGe=XGe.reduce((t,e)=>(t[e]=[],t),{}),ZGe=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],Cwe=new kGe({whiteList:YGe,onTagAttr:(t,e,r)=>{const i=`${e}="${r}"`;if(ZGe.includes(e))return i},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function JGe(t,e){const r=t.getBoundingClientRect(),i=e.getBoundingClientRect(),s=r.top+r.height,n=i.top+i.height,o=r.top,a=i.top;(s>n||o<a)&&t.scrollIntoView({block:"end"})}function Awe(t){return t==="Enter"||t===" "}const Owe="http://www.w3.org/",$8=`${Owe}2000/svg`,Rwe=`${Owe}1999/xlink`;let use=[],NJ=(t,e)=>{let r={};return Object.keys(t).forEach(i=>{r[i]=t[i]}),e&&Object.keys(e).forEach(i=>{r[i]=e[i]}),r},FJ=(t,e)=>t.vnodeSelector===e.vnodeSelector&&(t.properties&&e.properties?t.properties.key===e.properties.key&&t.properties.bind===e.properties.bind:!t.properties&&!e.properties),Mwe=t=>{if(typeof t!="string")throw new Error("Style values must be strings")},QGe=(t,e,r)=>{if(e.vnodeSelector!==""){for(let i=r;i<t.length;i++)if(FJ(t[i],e))return i}return-1},sk=(t,e,r,i)=>{let s=t[e];if(s.vnodeSelector==="")return;let n=s.properties;if(!(n&&(n.key===void 0?n.bind:n.key))){for(let o=0;o<t.length;o++)if(o!==e){let a=t[o];if(FJ(a,s))throw new Error(`${r.vnodeSelector} had a ${s.vnodeSelector} child ${i==="added"?i:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},KGe=t=>{if(t.properties){let e=t.properties.enterAnimation;e&&e(t.domNode,t.properties)}},bj=[],wj=!1,Pwe=t=>{(t.children||[]).forEach(Pwe),t.properties&&t.properties.afterRemoved&&t.properties.afterRemoved.apply(t.properties.bind||t.properties,[t.domNode])},hse=()=>{wj=!1,bj.forEach(Pwe),bj.length=0},dse=t=>{bj.push(t),wj||(wj=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(hse,{timeout:16}):setTimeout(hse,16))},pse=t=>{let e=t.domNode;if(t.properties){let r=t.properties.exitAnimation;if(r)return e.style.pointerEvents="none",void r(e,()=>{e.parentNode&&(e.parentNode.removeChild(e),dse(t))},t.properties)}e.parentNode&&(e.parentNode.removeChild(e),dse(t))},eje=(t,e,r)=>{if(!e)return;let i=r.eventHandlerInterceptor,s=Object.keys(e),n=s.length;for(let o=0;o<n;o++){let a=s[o],l=e[a];if(a==="className")throw new Error('Property "className" is not supported, use "class".');if(a==="class")xj(t,l,!0);else if(a==="classes"){let c=Object.keys(l),h=c.length;for(let d=0;d<h;d++){let f=c[d];l[f]&&t.classList.add(f)}}else if(a==="styles"){let c=Object.keys(l),h=c.length;for(let d=0;d<h;d++){let f=c[d],m=l[f];m&&(Mwe(m),r.styleApplyer(t,f,m))}}else if(a!=="key"&&l!=null){let c=typeof l;c==="function"?(a.lastIndexOf("on",0)===0&&(i&&(l=i(a,l,t,e)),a==="oninput"&&function(){let h=l;l=function(d){h.apply(this,[d]),d.target["oninput-value"]=d.target.value}}()),t[a]=l):r.namespace===$8?a==="href"?t.setAttributeNS(Rwe,a,l):t.setAttribute(a,l):c==="string"&&a!=="value"?a==="innerHTML"?t[a]=Cwe.sanitize(l):Iwe(t)&&a in t?t[a]=l:t.setAttribute(a,l):t[a]=l}}};function Iwe(t){if(!(t instanceof Element&&t.tagName.includes("-")))return!1;const e=window.customElements.get(t.tagName.toLowerCase());return!!e&&t instanceof e}let L5,tje=(t,e,r)=>{if(e)for(let i of e)lS(i,t,void 0,r)},$we=(t,e,r)=>{tje(t,e.children,r),e.text&&(t.textContent=e.text),eje(t,e.properties,r),e.properties&&e.properties.afterCreate&&e.properties.afterCreate.apply(e.properties.bind||e.properties,[t,r,e.vnodeSelector,e.properties,e.children])},lS=(t,e,r,i)=>{let s,n=0,o=t.vnodeSelector,a=e.ownerDocument;if(o==="")s=t.domNode=a.createTextNode(t.text),r!==void 0?e.insertBefore(s,r):e.appendChild(s);else{for(let l=0;l<=o.length;++l){let c=o.charAt(l);if(l===o.length||c==="."||c==="#"){let h=o.charAt(n-1),d=o.slice(n,l);h==="."?s.classList.add(d):h==="#"?s.id=d:(d==="svg"&&(i=NJ(i,{namespace:$8})),i.namespace!==void 0?s=t.domNode=a.createElementNS(i.namespace,d):(s=t.domNode=t.domNode||a.createElement(d),d==="input"&&t.properties&&t.properties.type!==void 0&&s.setAttribute("type",t.properties.type)),r!==void 0?e.insertBefore(s,r):s.parentNode!==e&&e.appendChild(s)),n=l+1}}$we(s,t,i)}},xj=(t,e,r)=>{e&&e.split(" ").forEach(i=>{i&&t.classList.toggle(i,r)})},rje=(t,e,r,i)=>{if(!r)return;let s=!1,n=Object.keys(r),o=n.length;for(let a=0;a<o;a++){let l=n[a],c=r[l],h=e[l];if(l==="class")h!==c&&(xj(t,h,!1),xj(t,c,!0));else if(l==="classes"){let d=t.classList,f=Object.keys(c),m=f.length;for(let g=0;g<m;g++){let _=f[g],v=!!c[_];v!==!!h[_]&&(s=!0,v?d.add(_):d.remove(_))}}else if(l==="styles"){let d=Object.keys(c),f=d.length;for(let m=0;m<f;m++){let g=d[m],_=c[g];_!==h[g]&&(s=!0,_?(Mwe(_),i.styleApplyer(t,g,_)):i.styleApplyer(t,g,""))}}else if(c||typeof h!="string"||(c=""),l==="value"){let d=t[l];d!==c&&(t["oninput-value"]?d===t["oninput-value"]:c!==h)&&(t[l]=c,t["oninput-value"]=void 0),c!==h&&(s=!0)}else if(c!==h){let d=typeof c;d==="function"&&i.eventHandlerInterceptor||(i.namespace===$8?l==="href"?t.setAttributeNS(Rwe,l,c):t.setAttribute(l,c):d==="string"?l==="innerHTML"?t[l]=Cwe.sanitize(c):l==="role"&&c===""?t.removeAttribute(l):Iwe(t)&&l in t?t[l]=c:t.setAttribute(l,c):t[l]!==c&&(t[l]=c),s=!0)}}return s},ije=(t,e,r,i,s)=>{if(r===i)return!1;i=i||use;let n,o=(r=r||use).length,a=i.length,l=0,c=0,h=!1;for(;c<a;){let d=l<o?r[l]:void 0,f=i[c];if(d!==void 0&&FJ(d,f))h=L5(d,f,s)||h,l++;else{let m=QGe(r,f,l+1);if(m>=0){for(n=l;n<m;n++)pse(r[n]),sk(r,n,t,"removed");h=L5(r[m],f,s)||h,l=m+1}else lS(f,e,l<o?r[l].domNode:void 0,s),KGe(f),sk(i,c,t,"added")}c++}if(o>l)for(n=l;n<o;n++)pse(r[n]),sk(r,n,t,"removed");return h};L5=(t,e,r)=>{let i=t.domNode,s=!1;if(t===e)return!1;let n=!1;if(e.vnodeSelector===""){if(e.text!==t.text){let o=i.ownerDocument.createTextNode(e.text);return i.parentNode.replaceChild(o,i),e.domNode=o,s=!0,s}e.domNode=i}else e.vnodeSelector.lastIndexOf("svg",0)===0&&(r=NJ(r,{namespace:$8})),t.text!==e.text&&(n=!0,e.text===void 0?i.removeChild(i.firstChild):i.textContent=e.text),e.domNode=i,n=ije(e,i,t.children,e.children,r)||n,n=rje(i,t.properties,e.properties,r)||n,e.properties&&e.properties.afterUpdate&&e.properties.afterUpdate.apply(e.properties.bind||e.properties,[i,r,e.vnodeSelector,e.properties,e.children]);return n&&e.properties&&e.properties.updateAnimation&&e.properties.updateAnimation(i,e.properties,t.properties),s};let d3=(t,e)=>({getLastRender:()=>t,update:r=>{if(t.vnodeSelector!==r.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let i=t;t=r,L5(i,r,e)},domNode:t.domNode});const sje={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,r)=>{e.charAt(0)==="-"?t.style.setProperty(e,r):t.style[e]=r}};let m2=t=>NJ(sje,t),V_={create:(t,e)=>(e=m2(e),lS(t,document.createElement("div"),void 0,e),d3(t,e)),append:(t,e,r)=>(r=m2(r),lS(e,t,void 0,r),d3(e,r)),insertBefore:(t,e,r)=>(r=m2(r),lS(e,t.parentNode,t,r),d3(e,r)),merge:(t,e,r)=>(r=m2(r),e.domNode=t,$we(t,e,r),d3(e,r)),replace:(t,e,r)=>(r=m2(r),lS(e,t.parentNode,t,r),t.parentNode.removeChild(t),d3(e,r))},Lwe,nje=(t,e)=>{let r=[];for(;t&&t!==e;)r.push(t),t=t.parentNode;return r};Lwe=Array.prototype.find?(t,e)=>t.find(e):(t,e)=>t.filter(e)[0];let oje=(t,e)=>{let r=t;return e.forEach(i=>{r=r&&r.children?Lwe(r.children,s=>s.domNode===i):void 0}),r},aje=(t,e,r)=>{let i=function(s){r("domEvent",s);let n=e(),o=nje(s.currentTarget,n.domNode);o.reverse();let a,l=oje(n.getLastRender(),o);return t.scheduleRender(),l&&(a=l.properties[`on${s.type}`].apply(l.properties.bind||this,arguments)),r("domEventProcessed",s),a};return(s,n,o,a)=>i},fse=t=>{let e,r,i=m2(t),s=i.performanceLogger,n=!0,o=!1,a=[],l=[],c=(d,f,m)=>{let g,_=()=>g;i.eventHandlerInterceptor=aje(e,_,s),g=d(f,m(),i),a.push(g),l.push(m)},h=()=>{if(r=void 0,n){n=!1,s("renderStart",void 0);for(let d=0;d<a.length;d++){let f=l[d]();s("rendered",void 0),a[d].update(f),s("patched",void 0)}s("renderDone",void 0),n=!0}};return e={renderNow:h,scheduleRender:()=>{r||o||(r=requestAnimationFrame(h))},stop:()=>{r&&(cancelAnimationFrame(r),r=void 0),o=!0},resume:()=>{o=!1,n=!0,e.scheduleRender()},append:(d,f)=>{c(V_.append,d,f)},insertBefore:(d,f)=>{c(V_.insertBefore,d,f)},merge:(d,f)=>{c(V_.merge,d,f)},replace:(d,f)=>{c(V_.replace,d,f)},detach:d=>{for(let f=0;f<l.length;f++)if(l[f]===d)return l.splice(f,1),a.splice(f,1)[0];throw new Error("renderFunction was not found")}},e},By=class extends Te{constructor(){super(...arguments),this.items=new Pt,this._watchUpdatingTracking=new tm,this._callbacks=new Map,this._projector=fse(),this._hiddenProjector=fse()}get needsRender(){return this.items.length>0}get updating(){return this._watchUpdatingTracking?.updating??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,r=>{for(const i of r.added){const s=()=>i.render();this._callbacks.set(i,s),this._projector.append(this.surface,s)}for(const i of r.removed){const s=this._projector.detach(this._callbacks.get(i));this.surface.removeChild(s.domNode),this._callbacks.delete(i)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const r=this._hiddenSurface,i=this._hiddenProjector;let s;const n=()=>(s=e.render(),s);i.append(r,n),i.renderNow();const o={left:0,top:0,right:0,bottom:0};if(s&&s.domNode){const a=s.domNode.getBoundingClientRect();o.left=a.left,o.top=a.top,o.right=a.right,o.bottom=a.bottom}for(i.detach(n);r.firstChild;)r.removeChild(r.firstChild);return o}overlaps(e,r){const i=this.computeBoundingRect(e),s=this.computeBoundingRect(r);return Math.max(i.left,s.left)<=Math.min(i.right,s.right)&&Math.max(i.top,s.top)<=Math.min(i.bottom,s.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e){if(!this.items.some(i=>i.visible))return;const r=e.getContext("2d");r.save(),r.font=this._fontString(),this.items.forEach(i=>{r.save(),i.renderCanvas(r),r.restore()}),r.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};u([p({readOnly:!0})],By.prototype,"surface",void 0),u([p({readOnly:!0})],By.prototype,"items",void 0),u([p({readOnly:!0})],By.prototype,"needsRender",null),u([p({readOnly:!0})],By.prototype,"_watchUpdatingTracking",void 0),u([p({readOnly:!0})],By.prototype,"updating",null),By=u([P("esri.views.overlay.ViewOverlay")],By);const mse=By,nk=[0,0];function lje(t){const e=(t.ownerDocument||window.document).defaultView,r=t.getBoundingClientRect();return nk[0]=r.left+(e?.pageXOffset??0),nk[1]=r.top+(e?.pageYOffset??0),nk}function gse(t){t&&(x1e(t),t.parentNode&&t.parentNode.removeChild(t))}function cje(t){const e=document.createElement("div");return t.appendChild(e),e}const p3=16,YI=750,uje=512,hje=2,dje=t=>{let e=class extends t{constructor(...r){super(...r),this._freqInfo={freq:p3,time:YI},this._overlayRenderTaskHandle=null,this.height=0,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([le(()=>this.cursor,i=>{const{surface:s}=this;s&&s.setAttribute("data-cursor",i)}),le(()=>this.navigating,i=>{const{surface:s}=this;s&&s.setAttribute("data-navigating",i.toString())})])}initialize(){this.addHandles([le(()=>this.ui,(r,i)=>this._handleUIChange(r,i),Pr),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui=Ne(this.ui),this.container=null)}get container(){return this._get("container")??null}set container(r){const i=this._get("container"),s=f8(r);if(s||typeof r!="string"||K.getLogger(this).error("#container",`element with id '${r}' not found`),i===s)return;if(this._stopMeasuring(),i&&(i.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(gse(this.root),this._set("root",null)),this.userContent&&(Lie(this.userContent,i),gse(this.userContent),this._set("userContent",null))),!s)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);s.classList.add("esri-view");const n=document.createElement("div");n.className="esri-view-user-storage",Lie(s,n),s.appendChild(n),this._set("userContent",n);const o=document.createElement("div");o.className="esri-view-root",s.insertBefore(o,s.firstChild),this._set("root",o);const a=document.createElement("div");a.className="esri-view-surface",a.setAttribute("role","application"),a.tabIndex=0,o.appendChild(a),this._set("surface",a);const l=new mse;o.appendChild(l.surface),this._set("overlay",l),this.addHandles(le(()=>l.needsRender,c=>{c&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=dE({render:()=>this.overlay?.render()}):this._overlayRenderTaskHandle=Fi(this._overlayRenderTaskHandle)})),this.forceDOMReadyCycle(),this._set("container",s),this._startMeasuring()}get focused(){const r=document.activeElement===this.surface;return document.hasFocus()&&r}get size(){return[this.width,this.height]}blur(){this.surface?.blur()}focus(){this.surface?.focus()}pageToContainer(r,i,s){const n=this.position;return r-=n?n[0]:0,i-=n?n[1]:0,s?(s[0]=r,s[1]=i):s=[r,i],s}containerToPage(r,i,s){const n=this.position;return r+=n?n[0]:0,i+=n?n[1]:0,s?(s[0]=r,s[1]=i):s=[r,i],s}_handleUIChange(r,i){this.removeHandles("ui"),i&&i!==r&&i.destroy(),r&&(r.view=this,this.addHandles(le(()=>this.root,s=>{r.container=s?cje(s):null},Pr),"ui")),this._set("ui",r)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const r=this._freqInfo;r.freq=p3,r.time=YI,this.addHandles([(()=>{const i=()=>{r.freq=p3,r.time=YI};return window.addEventListener("resize",i),{remove(){window.removeEventListener("resize",i)}}})(),dE({prepare:i=>{const s=this._measure(),n=this._freqInfo;if(n.time+=i.deltaTime,s&&(n.freq=p3,this._get("resizing")||this._set("resizing",!0)),n.time<n.freq)return;n.time=0;const o=this._position();n.freq=o||s?p3:Math.min(YI,n.freq*hje),!s&&n.freq>=uje&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const r=this.container,i=r?r.clientWidth:0,s=r?r.clientHeight:0;if(i===0||s===0)return this.suspended||this._set("suspended",!0),!1;const n=this.width,o=this.height;return i===n&&s===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",i),this._set("height",s),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:n,oldHeight:o,width:i,height:s}),!0)}_position(){const r=this.container,i=this.position,s=r&&lje(r);return!!s&&(!i||s[0]!==i[0]||s[1]!==i[1])&&(this._set("position",[s[0],s[1]]),!0)}forceDOMReadyCycle(){}};return u([p()],e.prototype,"container",null),u([p({readOnly:!0})],e.prototype,"focused",null),u([p({readOnly:!0})],e.prototype,"height",void 0),u([p({type:mse})],e.prototype,"overlay",void 0),u([p({readOnly:!0})],e.prototype,"position",void 0),u([p({readOnly:!0})],e.prototype,"resizing",void 0),u([p({readOnly:!0})],e.prototype,"root",void 0),u([p({value:null,readOnly:!0})],e.prototype,"size",null),u([p({readOnly:!0})],e.prototype,"surface",void 0),u([p({readOnly:!0})],e.prototype,"suspended",void 0),u([p()],e.prototype,"ui",void 0),u([p({readOnly:!0})],e.prototype,"userContent",void 0),u([p({readOnly:!0})],e.prototype,"width",void 0),u([p()],e.prototype,"widthBreakpoint",void 0),e=u([P("esri.views.DOMContainer")],e),e},UJ=K.getLogger("esri.layers.support.ElevationSampler");let Dwe=class{queryElevation(e){return Nwe(e.clone(),this)}on(){return yje}projectIfRequired(e,r){return Fwe(e,r)}},pje=class extends Dwe{get spatialReference(){return this.extent.spatialReference}constructor(e,r,i){super(),this.tile=e,this.noDataValue=i;const s=e.tile.extent;this.extent=Q6(s,r.spatialReference),this.extent.zmin=e.zmin,this.extent.zmax=e.zmax,this._aaExtent=s;const n=Ta(r.spatialReference),o=r.lodAt(e.tile.level).resolution*n;this.demResolution={min:o,max:o}}contains(e){const r=this.projectIfRequired(e,this.spatialReference);return r!=null&&this.containsAt(r.x,r.y)}containsAt(e,r){return K6(this._aaExtent,e,r)}elevationAt(e,r){if(!this.containsAt(e,r)){const i=this.extent,s=`${i.xmin}, ${i.ymin}, ${i.xmax}, ${i.ymax}`;return UJ.warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler extent (${s})`),this.noDataValue}return this.tile.sample(e,r)??this.noDataValue}},gFt=class extends Dwe{get spatialReference(){return this.extent.spatialReference}constructor(e,r,i){let s;super(),typeof r=="number"?(this.noDataValue=r,s=null):(s=r,this.noDataValue=i),this.samplers=s?e.map(o=>new pje(o,s,this.noDataValue)):e;const n=this.samplers[0];if(n){this.extent=n.extent.clone();const{min:o,max:a}=n.demResolution;this.demResolution={min:o,max:a};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=Q6(zt(),s.spatialReference),this.demResolution={min:0,max:0}}elevationAt(e,r){for(const i of this.samplers)if(i.containsAt(e,r))return i.elevationAt(e,r);return UJ.warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler`),this.noDataValue}};function Nwe(t,e){const r=Fwe(t,e.spatialReference);if(!r)return null;switch(t.type){case"point":fje(t,r,e);break;case"polyline":mje(t,r,e);break;case"multipoint":gje(t,r,e)}return t}function Fwe(t,e){if(t==null)return null;const r=t.spatialReference;if(r.equals(e))return t;const i=bx(t,e);return i||UJ.error(`Cannot project geometry spatial reference (wkid:${r.wkid}) to elevation sampler spatial reference (wkid:${e.wkid})`),i}function fje(t,e,r){t.z=r.elevationAt(e.x,e.y)}function mje(t,e,r){kf.spatialReference=e.spatialReference;const i=t.hasM&&!t.hasZ;for(let s=0;s<t.paths.length;s++){const n=t.paths[s],o=e.paths[s];for(let a=0;a<n.length;a++){const l=n[a],c=o[a];kf.x=c[0],kf.y=c[1],i&&(l[3]=l[2]),l[2]=r.elevationAt(kf.x,kf.y)}}t.hasZ=!0}function gje(t,e,r){kf.spatialReference=e.spatialReference;const i=t.hasM&&!t.hasZ;for(let s=0;s<t.points.length;s++){const n=t.points[s],o=e.points[s];kf.x=o[0],kf.y=o[1],i&&(n[3]=n[2]),n[2]=r.elevationAt(kf.x,kf.y)}t.hasZ=!0}const kf=new tt,yje={remove(){}};var Tj;let vf=Tj=class extends ue{constructor(t){super(t),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new Tj({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};u([p({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],vf.prototype,"cols",void 0),u([p({type:Ki,json:{write:!0}})],vf.prototype,"level",void 0),u([p({type:String,json:{write:!0}})],vf.prototype,"levelValue",void 0),u([p({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],vf.prototype,"origin",void 0),u([p({type:Number,json:{write:!0}})],vf.prototype,"resolution",void 0),u([p({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],vf.prototype,"rows",void 0),u([p({type:Number,json:{write:!0}})],vf.prototype,"scale",void 0),vf=Tj=u([P("esri.layers.support.LOD")],vf);const ip=vf;let _je=class{constructor(e,r,i,s,n=void 0){this.id=e,this.level=r,this.row=i,this.col=s,this.extent=n}};var Gy;const yse=new $r({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let sa=Gy=class extends ue{static create(t={}){const{resolutionFactor:e=1,scales:r,size:i=256,spatialReference:s=qe.WebMercator,numLODs:n=24}=t;if(!fa(s)){const d=[];if(r)for(let f=0;f<r.length;f++){const m=r[f];d.push(new ip({level:f,scale:m,resolution:m}))}else{let f=5e-4;for(let m=n-1;m>=0;m--)d.unshift(new ip({level:m,scale:f,resolution:f})),f*=2}return new Gy({dpi:96,lods:d,origin:new tt(0,0,s),size:[i,i],spatialReference:s})}const o=cw(s),a=t.origin?new tt({x:t.origin.x,y:t.origin.y,spatialReference:s}):new tt(o?{x:o.origin[0],y:o.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),l=96,c=1/(Ta(s)*39.37*l),h=[];if(r)for(let d=0;d<r.length;d++){const f=r[d],m=f*c;h.push(new ip({level:d,scale:f,resolution:m}))}else{let d=j0e(s)?512/i*5916575275917094e-7:256/i*591657527591555e-6;const f=Math.ceil(n/e);h.push(new ip({level:0,scale:d,resolution:d*c}));for(let m=1;m<f;m++){const g=d/2**e,_=g*c;h.push(new ip({level:m,scale:g,resolution:_})),d=g}}return new Gy({dpi:l,lods:h,origin:a,size:[i,i],spatialReference:s})}constructor(t){super(t),this.dpi=96,this.format=null,this.origin=null,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:t,origin:e}=this;if(t&&e){const r=cw(t);return t.isWrappable&&!!r&&Math.abs(r.origin[0]-e.x)<=r.dx}return!1}readOrigin(t,e){return tt.fromJSON({spatialReference:e.spatialReference,...t})}set lods(t){let e=0,r=0;const i=[],s=this._levelToLOD={};t&&(e=-1/0,r=1/0,t.forEach(n=>{i.push(n.scale),e=n.scale>e?n.scale:e,r=n.scale<r?n.scale:r,s[n.level]=n})),this._set("scales",i),this._set("lods",t),this._initializeUpsampleLevels()}readSize(t,e){return[e.cols,e.rows]}writeSize(t,e){e.cols=t[0],e.rows=t[1]}zoomToScale(t){const e=this.scales;if(t<=0)return e[0];if(t>=e.length-1)return e[e.length-1];const r=Math.floor(t),i=r+1;return e[r]/(e[r]/e[i])**(t-r)}scaleToZoom(t){const e=this.scales,r=e.length-1;let i=0;for(;i<r;i++){const s=e[i],n=e[i+1];if(s<=t)return i;if(n===t)return i+1;if(s>t&&n<t)return i+Math.log(s/t)/Math.log(s/n)}return i}snapScale(t,e=.95){const r=this.scaleToZoom(t);return r%Math.floor(r)>=e?this.zoomToScale(Math.ceil(r)):this.zoomToScale(Math.floor(r))}tileAt(t,e,r,i){const s=this.lodAt(t);if(!s)return null;let n,o;if(typeof e=="number")n=e,o=r;else if(Ln(e.spatialReference,this.spatialReference))n=e.x,o=e.y,i=r;else{const c=bx(e,this.spatialReference);if(c==null)return null;n=c.x,o=c.y,i=r}const a=s.resolution*this.size[0],l=s.resolution*this.size[1];return i||(i=new _je(null,0,0,0,zt())),i.level=t,i.row=Math.floor((this.origin.y-o)/l+.001),i.col=Math.floor((n-this.origin.x)/a+.001),this.updateTileInfo(i),i}updateTileInfo(t,e=Gy.ExtrapolateOptions.NONE){let r=this.lodAt(t.level);if(!r&&e===Gy.ExtrapolateOptions.POWER_OF_TWO){const o=this.lods[this.lods.length-1];o.level<t.level&&(r=o)}if(!r)return;const i=t.level-r.level,s=r.resolution*this.size[0]/2**i,n=r.resolution*this.size[1]/2**i;t.id=`${t.level}/${t.row}/${t.col}`,t.extent||(t.extent=zt()),t.extent[0]=this.origin.x+t.col*s,t.extent[1]=this.origin.y-(t.row+1)*n,t.extent[2]=t.extent[0]+s,t.extent[3]=t.extent[1]+n}upsampleTile(t){const e=this._upsampleLevels[t.level];return!(!e||e.parentLevel===-1)&&(t.level=e.parentLevel,t.row=Math.floor(t.row/e.factor+.001),t.col=Math.floor(t.col/e.factor+.001),this.updateTileInfo(t),!0)}getTileBounds(t,e){const r=this.lodAt(e.level);if(r==null)return null;const{resolution:i}=r,s=i*this.size[0],n=i*this.size[1];return t[0]=this.origin.x+e.col*s,t[1]=this.origin.y-(e.row+1)*n,t[2]=t[0]+s,t[3]=t[1]+n,t}lodAt(t){return this._levelToLOD?.[t]??null}clone(){return Gy.fromJSON(this.write({}))}getOrCreateCompatible(t,e){if(this.size[0]===256&&this.size[1]===256)return t===256?this:null;const r=[],i=this.lods.length;for(let s=0;s<i;s++){const n=this.lods[s],o=n.resolution*e;r.push(new ip({level:n.level,scale:n.scale,resolution:o}))}return new Gy({size:[t,t],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:r})}_initializeUpsampleLevels(){const t=this.lods;this._upsampleLevels=[];let e=null;for(let r=0;r<t.length;r++){const i=t[r];this._upsampleLevels[i.level]={parentLevel:e?e.level:-1,factor:e?e.resolution/i.resolution:0},e=i}}};u([p({type:Number,json:{write:!0}})],sa.prototype,"compressionQuality",void 0),u([p({type:Number,json:{write:!0}})],sa.prototype,"dpi",void 0),u([p({type:String,json:{read:yse.read,write:yse.write,origins:{"web-scene":{read:!1,write:!1}}}})],sa.prototype,"format",void 0),u([p({readOnly:!0})],sa.prototype,"isWrappable",null),u([p({type:tt,json:{write:!0}})],sa.prototype,"origin",void 0),u([Oe("origin")],sa.prototype,"readOrigin",null),u([p({type:[ip],value:null,json:{write:!0}})],sa.prototype,"lods",null),u([p({readOnly:!0})],sa.prototype,"scales",void 0),u([p({cast:t=>Array.isArray(t)?t:typeof t=="number"?[t,t]:[256,256]})],sa.prototype,"size",void 0),u([Oe("size",["rows","cols"])],sa.prototype,"readSize",null),u([Be("size",{cols:{type:Ki},rows:{type:Ki}})],sa.prototype,"writeSize",null),u([p({type:qe,json:{write:!0}})],sa.prototype,"spatialReference",void 0),sa=Gy=u([P("esri.layers.support.TileInfo")],sa),function(t){var e;(e=t.ExtrapolateOptions||(t.ExtrapolateOptions={}))[e.NONE=0]="NONE",e[e.POWER_OF_TWO=1]="POWER_OF_TWO"}(sa||(sa={}));const mN=sa,vje=12;let Tc=class xl{constructor(e){const r=xl.checkUnsupported(e);if(r!=null)throw r;const i=e;this.spatialReference=i.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=pv(this.spatialReference)||Om(this.spatialReference)||Rm(this.spatialReference),this.origin=[i.origin.x,i.origin.y],this.pixelSize=i.size[0],this.dpi=i.dpi;const s=i.lods.reduce((c,h,d)=>(h.level<c.min&&(c.min=h.level,c.minIndex=d),c.max=Math.max(c.max,h.level),c),{min:1/0,minIndex:0,max:-1/0}),n=i.lods[s.minIndex],o=2**n.level;let a=n.resolution*o,l=n.scale*o;this.levels=new Array(s.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:l,tileSize:[a*i.size[0],a*i.size[1]]},a/=2,l/=2}clone(){return new xl(this.toTileInfo())}toTileInfo(){return new mN({dpi:this.dpi,origin:new tt({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((e,r)=>new ip({level:r,scale:e.scale,resolution:e.resolution}))})}getExtent(e,r,i,s){const n=this.levels[e],o=n.tileSize[0],a=n.tileSize[1];s[0]=this.origin[0]+i*o,s[2]=this.origin[0]+(i+1)*o,s[3]=this.origin[1]-r*a,s[1]=this.origin[1]-(r+1)*a}convertExtentToRadians(e,r){this._isWebMercator?(r[0]=Mre(e[0]),r[1]=r5(e[1]),r[2]=Mre(e[2]),r[3]=r5(e[3])):this._isGCS&&(r[0]=Ft(e[0]),r[1]=Ft(e[1]),r[2]=Ft(e[2]),r[3]=Ft(e[3]))}getExtentGeometry(e,r,i,s=new cr){return this.getExtent(e,r,i,jp),s.spatialReference=this.spatialReference,s.xmin=jp[0],s.ymin=jp[1],s.xmax=jp[2],s.ymax=jp[3],s.zmin=void 0,s.zmax=void 0,s}ensureMaxLod(e){if(e==null)return!1;let r=!1;for(;this.levels.length<=e;){const i=this.levels[this.levels.length-1],s=i.resolution/2;this.levels.push({resolution:s,scale:i.scale/2,tileSize:[s*this.pixelSize,s*this.pixelSize]}),r=!0}return r}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const r=this.levels[0].scale;return e>=r?0:Math.log(r/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e){if(!(e instanceof xl)){if(xl.checkUnsupported(e))return!1;e=new xl(e)}if(!e.spatialReference.equals(this.spatialReference)||e.pixelSize!==this.pixelSize)return!1;const r=Math.min(this.levels.length,e.levels.length)-1,i=this.levels[r].resolution;let s=.5*i;return!PS(e.origin[0],this.origin[0],s)||!PS(e.origin[1],this.origin[1],s)?!1:(s=.5*i/2**r/this.pixelSize*vje,PS(i,e.levels[r].resolution,s))}rootTilesInExtent(e,r=null,i=1/0){const s=new Array,n=this.levels[0].tileSize;if(e==null||n[0]===0||n[1]===0)return s;xl.computeRowColExtent(e,n,this.origin,jp);let o=jp[1],a=jp[3],l=jp[0],c=jp[2];const h=c-l,d=a-o;if(h*d>i){const f=Math.floor(Math.sqrt(i));d>f&&(o=o+Math.floor(.5*d)-Math.floor(.5*f),a=o+f),h>f&&(l=l+Math.floor(.5*h)-Math.floor(.5*f),c=l+f)}for(let f=o;f<a;f++)for(let m=l;m<c;m++)s.push([0,f,m]);return r!=null&&(r[0]=this.origin[0]+l*n[0],r[1]=this.origin[1]-a*n[1],r[2]=this.origin[0]+c*n[0],r[3]=this.origin[1]-o*n[1]),s}static computeRowColExtent(e,r,i,s){const n=.001*(e[2]-e[0]+(e[3]-e[1]));s[0]=Math.max(0,Math.floor((e[0]+n-i[0])/r[0])),s[2]=Math.max(0,Math.ceil((e[2]-n-i[0])/r[0])),s[1]=Math.max(0,Math.floor((i[1]-e[3]+n)/r[1])),s[3]=Math.max(0,Math.ceil((i[1]-e[1]-n)/r[1]))}static isPowerOfTwo(e){const r=e.lods,i=r[0].resolution*2**r[0].level;return!r.some(s=>!t8e(s.resolution,i/2**s.level))}static hasGapInLevels(e){const r=e.lods.map(i=>i.level);r.sort((i,s)=>i-s);for(let i=1;i<r.length;i++)if(r[i]!==r[0]+i)return!0;return!1}static tileSizeSupported(e){const r=e.size[1];return r===e.size[0]&&(r&r-1)==0&&r>=128&&r<=512}static hasOriginPerLODs(e){const r=e.origin;return e.lods.some(i=>i.origin!=null&&(i.origin[0]!==r.x||i.origin[1]!==r.y))}static getMissingTileInfoError(){return new U("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(e){return e==null?kJ():e.lods.length<1?new U("tilingscheme:generic","Tiling scheme must have at least one level"):xl.isPowerOfTwo(e)?xl.hasGapInLevels(e)?new U("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):xl.tileSizeSupported(e)?xl.hasOriginPerLODs(e)?new U("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new U("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new U("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,r){const i=e[2]-e[0],s=e[3]-e[1],n=Ta(r),o=1.2*Math.max(i,s),a=256,l=96,c=.0254,h=new xl(new mN({size:[a,a],origin:new tt({x:e[0]-.5*(o-i),y:e[3]+.5*(o-s)}),lods:[new ip({level:0,resolution:o/a,scale:1/(a/l*c/(o*n))})],spatialReference:r}));return h.ensureMaxLod(20),h}static makeWebMercatorAuxiliarySphere(e){const r=new xl(xl.WebMercatorAuxiliarySphereTileInfo);return r.ensureMaxLod(e),r}static makeGCSWithTileSize(e,r=256,i=16){const s=256/r,n=new xl(new mN({size:[r,r],origin:new tt({x:-180,y:90,spatialReference:e}),spatialReference:e,lods:[new ip({level:0,resolution:.703125*s,scale:295497598570834e-6*s})]}));return n.ensureMaxLod(i),n}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}};function kJ(){return new U("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}Tc.WebMercatorAuxiliarySphereTileInfo=new mN({size:[256,256],origin:new tt({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:qe.WebMercator}),spatialReference:qe.WebMercator,lods:[new ip({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),Tc.WebMercatorAuxiliarySphere=Tc.makeWebMercatorAuxiliarySphere(19);const jp=zt(),cS=64,YA=512,bje=2.5,vM=r8e(TB/10),Uwe=2,kwe=zt();Tc.WebMercatorAuxiliarySphere.getExtent(0,0,0,kwe);const wje=zt([-180,-90,180,90]),xje="Cannot extend surface to encompass all layers because it would result in too many root tiles.",Tje="Surface extent is too large for tile resolution at level 0.",Sje=3;let Eje=Sje;function Sj(t){return t<4?3:Eje}let jy=class extends Ts.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=vM}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if(e==null||e.extent==null||e.spatialReference==null)return null;const r=Q6(e.extent,e.spatialReference);return r.zmin=e.visibleElevationBounds.min,r.zmax=e.visibleElevationBounds.max,r}get spatialReference(){return this.view.basemapTerrain?.spatialReference??qe.WGS84}elevationAt(e,r){if(this.extent==null||!Wa(this.extent,e,r)){const i=this.extent!=null?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return K.getLogger(this).warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler extent (${i})`),this.noDataValue}return this.view.elevationProvider?.getElevation(e,r,0,this.spatialReference,"ground")??this.noDataValue}queryElevation(e){return Nwe(e.clone(),this)}};u([p({readOnly:!0})],jy.prototype,"demResolution",void 0),u([p({readOnly:!0})],jy.prototype,"extent",null),u([p({readOnly:!0})],jy.prototype,"noDataValue",void 0),u([p()],jy.prototype,"spatialReference",null),u([p({constructOnly:!0})],jy.prototype,"view",void 0),jy=u([P("esri.views.support.GroundViewElevationSampler")],jy);const Cje=jy;let Hy=class extends Te{constructor(e){super(e),this.view=null,this.layerViews=new Pt}initialize(){this.addHandles(Iu(()=>this.view?.map?.ground,e=>e.load())),this.addHandles(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this.removeAllHandles(),this._set("view",null);for(const e of this.layerViews)e.destroy();this.layerViews.length=0}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new Cje({view:this.view}):null:null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.removeHandles("updating"),this.addHandles(this.layerViews.map(e=>le(()=>e.updating,()=>this._updateUpdating(),Wr)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};u([p({readOnly:!0})],Hy.prototype,"elevationSampler",null),u([p({type:Boolean,readOnly:!0})],Hy.prototype,"updating",null),u([p({constructOnly:!0})],Hy.prototype,"view",void 0),u([p({type:Pt,readOnly:!0})],Hy.prototype,"layerViews",void 0),u([p({readOnly:!0})],Hy.prototype,"suspended",null),Hy=u([P("esri.views.GroundView")],Hy);const Aje=Hy;let x0=class{constructor(e,r){this._owner=r,this._properties={},this._afterDispatchHandle=null;for(const i in e){const s=e[i],n=new Lge(s,void 0,void 0,2,2);this._properties[i]={pool:n,acquired:[]}}this._afterDispatchHandle=Qge(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const e in this._properties){const r=this._properties[e];for(const i of r.acquired)rre(i)||r.pool.release(i);r.pool.destroy(),r.pool=null,r.acquired=null}this._properties=null,this._owner=null}get(e){const r=this._owner._get(e),i=this._properties[e];let s=i.pool.acquire();for(i.acquired.push(s);s===r;)i.acquired.push(s),s=i.pool.acquire();return s}_release(){for(const e in this._properties){const r=this._properties[e];let i=0;for(const s of r.acquired)rre(s)?r.acquired[i++]=s:r.pool.release(s);r.acquired.length=i}}};const Oje=ae("mac")?"Meta":"Ctrl",L8={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let t=48;t<58;t++)L8[t]=String.fromCharCode(t);for(let t=1;t<25;t++)L8[111+t]=`F${t}`;for(let t=65;t<91;t++)L8[t]=[String.fromCharCode(t+32),String.fromCharCode(t)];function Rje(t){if(t.key!==void 0)return RD(t);const e=L8[t.keyCode];return Array.isArray(e)?t.shiftKey?e[1]:e[0]:e}function Mje(t){switch(t){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}let Pje=class{constructor(e,r=[]){this.eventType=e,this.keyModifiers=r}matches(e){if(e.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const r=e.modifiers;for(const i of this.keyModifiers)if(!r.has(i))return!1;return!0}};const _se=K.getLogger("esri.views.input.InputHandler");let Ro=class{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const r=this._incoming[e];for(const i of r)this._incomingEventMatches.push(i.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(e=>e.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager?_se.error("This InputHandler has already been registered with an InputManager"):(e.setEventCallback(r=>this._handleEvent(r)),e.setUninstallCallback(()=>this._onUninstall()),this._manager=e)}onUninstall(){}registerIncoming(e,r,i){let s;typeof r=="function"?(i=r,s=[]):s=r||[];const n=typeof e=="string"?new Pje(e,s):e,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=h=>{const d=this._incoming[h.match.eventType];if(d){const f=d.indexOf(h);d.splice(f,1),o(),this._manager&&this._manager.updateDependencies()}},l=new Ije(n,i,{onPause:a,onRemove:a,onResume:h=>{const d=this._incoming[h.match.eventType];d&&!d.includes(h)&&(d.push(h),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[n.eventType];return c||(c=[],this._incoming[n.eventType]=c),c.push(l),o(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(e){if(this._outgoing[e])throw new Error("There is already a callback registered for this outgoing InputEvent: "+e);const r=new $je(e,{onEmit:(i,s,n,o)=>{this._manager?.emit(i.eventType,s,n,o)},onRemove:i=>{delete this._outgoing[i.eventType],this._manager?.updateDependencies()}});return this._outgoing[e]=r,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),r}startCapturingPointer(e){this._manager?.setPointerCapture(e,!0)}stopCapturingPointer(e){this._manager?.setPointerCapture(e,!1)}refreshHasPendingInputs(){this._manager?.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):_se.error("This InputHandler is not registered with an InputManager")}_handleEvent(e){const r=this._incoming[e.type];if(r){for(const i of r)if(i.match.matches(e)&&(i.callback?.(e),e.shouldStopPropagation()))break}}},Ije=class{constructor(e,r,i){this.match=e,this._callback=r,this._handler=i}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}},$je=class{constructor(e,r){this.eventType=e,this._removed=!1,this._handler=r}emit(e,r,i){this._removed||this._handler.onEmit(this,e,r,i)}remove(){this._removed=!0,this._handler.onRemove(this)}},Lje=class extends Ro{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",r=>{this._update(r.data)})}_update(e){const r=e.native.pointerType==="touch"?"touch":"mouse",{x:i,y:s}=e;r===this._value&&this._x===i&&this._y===s||(this._value=r,this._x=i,this._y=s,this._onChange(r,i,s))}},Dje=class{constructor(e,r){this._observable=new V6,this._value=e,this._equalityFunction=r}get value(){return qt(this._observable),this._value}set value(e){this._equalityFunction(e,this._value)||(this._value=e,this._observable.notify())}mutate(e){e(this._value),this._observable.notify()}};function bM(t,e=Age){return new Dje(t,e)}let Nje=class extends Ro{get multiTouchActive(){return this._multiTouchActive.value}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=bM(!1),this._onPointerAdd=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.add(e.native.pointerId),this._update())},this._onPointerRemove=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.delete(e.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.value=this._activeTouchPointerIds.size>1}},oh=class extends Te{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=Oje,this._latestPointerType="mouse",this._propertiesPool=new x0({latestPointerLocation:kje},this),this.latestPointerLocation=null,this._paused=!1,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const r of e)this.uninstallHandlers(r);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}get updating(){return this.hasPendingInputs||this._paused}installHandlers(e,r,i=Q_.INTERNAL){if(this._nameToGroup[e])return void K.getLogger(this).error("There is already an InputHandler group registered under the name `"+e+"`");if(r.length===0)return void K.getLogger(this).error("Can't register a group of zero handlers");const s={name:e,handlers:r.map(n=>({handler:n,active:!0,removed:!1,priorityIndex:0,groupPriority:i,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=s;for(let n=s.handlers.length-1;n>=0;n--){const o=s.handlers[n];this._handlers.push(o),o.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(a,l,c,h,d)=>{this._emitInputEvent(o.priorityIndex+1,a,l,c,d,h)},setPointerCapture:(a,l)=>{this._setPointerCapture(s,o,a,l)},setEventCallback:a=>{o.eventCallback=a},setUninstallCallback:a=>{o.uninstallCallback=a},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const r=this._nameToGroup[e];r?(r.handlers.forEach(i=>{i.removed=!0,i.uninstallCallback?.()}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):K.getLogger(this).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,r=new Set;this._handlersPriority=[];for(let i=this._handlers.length-1;i>=0;i--){const s=this._handlers[i];s.priorityIndex=i,this._handlersPriority.push(s)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let i=this._handlersPriority.length-1;i>=0;i--){const s=this._handlersPriority[i];s.priorityIndex=i;let n=s.handler.hasSideEffects;if(!n){for(const o of s.handler.outgoingEventTypes)if(e.has(o)){n=!0;break}}if(n)for(const o of s.handler.incomingEventMatches){e.add(o.eventType);for(const a of o.keyModifiers)Mje(a)||r.add(a)}s.active=n}this._sourceEvents=e,this._keyModifiers=r,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,r,i){this._latestPointerType=e;const s=this._get("latestPointerLocation");if(s==null||s.x!==r||s.y!==i){const n=this._propertiesPool.get("latestPointerLocation");n.x=r,n.y=i,this._set("latestPointerLocation",n)}}_onEventReceived(e,r){if(e==="pointer-capture-lost"){const n=r;this._pointerCaptures.delete(n.native.pointerId)}this._updateKeyModifiers(e,r);const i=this.test.timestamp!=null?this.test.timestamp:r.native?r.native.timestamp:void 0,s=r.native?r.native.cancelable:void 0;this._emitInputEventFromSource(e,r,i,s)}_updateKeyModifiers(e,r){if(!r)return;let i=!1;const s=()=>{if(!i){const a=new Set;this._activeKeyModifiers.forEach(l=>{a.add(l)}),this._activeKeyModifiers=a,i=!0}},n=(a,l)=>{l&&!this._activeKeyModifiers.has(a)?(s(),this._activeKeyModifiers.add(a)):!l&&this._activeKeyModifiers.has(a)&&(s(),this._activeKeyModifiers.delete(a))};if(e==="key-down"||e==="key-up"){const a=r.key;this._keyModifiers.has(a)&&n(a,e==="key-down")}const o=r.native;n("Alt",!(!o||!o.altKey)),n("Ctrl",!(!o||!o.ctrlKey)),n("Shift",!(!o||!o.shiftKey)),n("Meta",!(!o||!o.metaKey)),n("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new Lje((e,r,i)=>this._setLatestPointer(e,r,i)),this._multiTouchHandler=new Nje,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],Q_.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,Q_.INTERNAL)}_setPointerCapture(e,r,i,s){const n=e.name+"-"+r.priorityIndex,o=this._pointerCaptures.get(i.pointerId)||new Set;this._pointerCaptures.set(i.pointerId,o),s?(o.add(n),o.size===1&&this.eventSource&&this.eventSource.setPointerCapture(i,!0)):o.has(n)&&(o.delete(n),o.size===0&&(this._pointerCaptures.delete(i.pointerId),this.eventSource&&this.eventSource.setPointerCapture(i,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,r,i,s){this._emitInputEvent(0,e,r,i,s)}_emitInputEvent(e,r,i,s,n,o){const a=s!==void 0?s:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),l=n!==void 0&&n,c={event:new Fje(r,i,a,o||this._activeKeyModifiers,l),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(c):this._doNewPropagation(c)}_doNewPropagation(e){this._currentPropagation={events:new YG,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){this._paused=!1;const e=this._currentPropagation;if(e){for(;e.events.length>0;){const{event:r,priorityIndex:i}=e.events.pop(),s=r.data&&r.data.eventId;if(!(s!=null&&this._stoppedPropagationEventIds.has(s)))for(e.currentHandler=this._handlersPriority[i];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!r.shouldStopPropagation()&&e.currentHandler.eventCallback?.(r),r.shouldStopPropagation()){s!=null&&this._stoppedPropagationEventIds.add(s);break}if(r.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:r,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const r=new YG;r.push(e);const i=this._currentPropagation;if(i){for(;i.events.length;)r.push(i.events.pop());i.events=r,i.currentHandler=null,this._paused=!0}}_compareHandlerPriority(e,r){if(e.handler.hasSideEffects!==r.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==r.groupPriority)return e.groupPriority>r.groupPriority?-1:1;for(const i of e.handler.incomingEventMatches)for(const s of r.handler.incomingEventMatches){if(i.eventType!==s.eventType)continue;const n=i.keyModifiers.filter(o=>s.keyModifiers.includes(o));if(n.length===i.keyModifiers.length!=(n.length===s.keyModifiers.length))return i.keyModifiers.length>s.keyModifiers.length?-1:1}return e.priorityIndex>r.priorityIndex?-1:1}_sortHandlersPriority(e){const r=[];for(const i of e){let s=0;for(;s<r.length&&this._compareHandlerPriority(i,r[s])>=0;)s++;r.splice(s,0,i)}return r}get debug(){const e=r=>{const i=this._setPointerCapture;this._setPointerCapture=()=>{},r(),this._setPointerCapture=i};return{injectEvent:(r,i)=>{e(()=>{this._onEventReceived(r,i)})},disablePointerCapture:e}}};u([p({readOnly:!0})],oh.prototype,"hasPendingInputs",null),u([p({constructOnly:!0})],oh.prototype,"eventSource",void 0),u([p({constructOnly:!0})],oh.prototype,"recognizers",void 0),u([p()],oh.prototype,"_latestPointerType",void 0),u([p()],oh.prototype,"latestPointerType",null),u([p()],oh.prototype,"multiTouchActive",null),u([p({readOnly:!0})],oh.prototype,"latestPointerLocation",void 0),u([p()],oh.prototype,"_paused",void 0),u([p({readOnly:!0})],oh.prototype,"updating",null),oh=u([P("esri.views.input.InputManager")],oh);let Fje=class{constructor(e,r,i,s,n){this.type=e,this.data=r,this.timestamp=i,this.modifiers=s,this.cancelable=n,this._propagationState=f_.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=f_.STOPPED}shouldStopPropagation(){return(this._propagationState&f_.STOPPED)!=0}async(e){this._propagationState|=f_.PAUSED;const r=(i,s)=>{this._propagationState&=~f_.PAUSED;const n=this._resumeCallback;if(this._resumeCallback=null,n&&n(),s)throw i;return i};return(typeof e=="function"?e():e).then(i=>r(i,!1),i=>r(i,!0))}shouldPausePropagation(e){return!!(this._propagationState&f_.PAUSED)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}};var f_;(function(t){t[t.NONE=0]="NONE",t[t.STOPPED=1]="STOPPED",t[t.PAUSED=2]="PAUSED"})(f_||(f_={}));const Q_={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};let Uje=class{};const kje=Uje;function Hp(t){return t!=null&&"open"in t&&"declaredClass"in t}function vse(t){return t!=null&&"declaredClass"in t&&"dockOptions"in t}const zje=t=>{let e=class extends t{constructor(){super(...arguments),this._popupSetupTask=null,this.popup={},this.popupEnabled=!0}initialize(){this.addHandles([le(()=>[this.ui,this.popup],([r,i],s)=>{const n="popup",o="manual";if(s){const[a,l]=s;a&&Hp(l)&&(l.view=null,vse(l)&&a.remove(l,n))}r&&Hp(i)&&(i.view=this,vse(i)&&r.add(i,{key:n,position:o,internal:!0}))},Pr),this.on("click",r=>{this.popup&&this.popupEnabled&&(r.pointerType!=="mouse"||r.button===0)&&(!Hp(this.popup)&&"autoOpenEnabled"in this.popup&&this.popup.autoOpenEnabled===!1||(Hp(this.popup)?this.popup.viewModel.handleViewClick(r):r.async(async()=>{await this.setupPopup(),Hp(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(r)})))},Q_.WIDGET)]),d0(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{he(()=>import("./Popup-6858ecde.js").then(r=>r.a0),["./Popup-6858ecde.js","./unitFormatUtils-7dfe0559.js","./AttachmentInfo-87f1be8b.js","./widget-789b9870.js","./executeQueryJSON-6cf505f3.js","./query-f938b96a.js","./normalizeUtils-ca47990d.js","./normalizeUtilsCommon-448ddeb2.js","./pbfQueryUtils-4859e776.js","./pbf-482f6762.js"],import.meta.url)})}destroy(){this.destroyed||this.closePopup()}async openPopup(r){Hp(this.popup)&&this.popup.open(r);try{if(await this.setupPopup(),!this.popup)return void K.getLogger(this).error(new U("view:null-popup","Popup is null and can't be opened"));this.popup.open(r)}catch{}}closePopup(){this._popupSetupTask?.abort(),Hp(this.popup)&&this.popup.close()}async fetchPopupFeatures(r,i){await this.when();const{location:s,queryArea:n,layerViewsAndGraphics:o,clientOnlyGraphics:a}=await this._prepareFetchPopupFeatures(r,i),l=Promise.resolve(a),c=this._queryLayerPopupFeatures(n,o,i),h=c.map(d=>d.promise);return{location:s,clientOnlyGraphics:a,allGraphicsPromise:B7([l,...h]).then(d=>Array.from(new Set(d.flat()))),promisesPerLayerView:c}}async setupPopup(){if(this._popupSetupTask?.abort(),this.popup&&!Hp(this.popup))return this._popupSetupTask=vC(async r=>{const{default:i}=await he(()=>import("./Popup-6858ecde.js").then(n=>n.a0),["./Popup-6858ecde.js","./unitFormatUtils-7dfe0559.js","./AttachmentInfo-87f1be8b.js","./widget-789b9870.js","./executeQueryJSON-6cf505f3.js","./query-f938b96a.js","./normalizeUtils-ca47990d.js","./normalizeUtilsCommon-448ddeb2.js","./pbfQueryUtils-4859e776.js","./pbf-482f6762.js"],import.meta.url);if(Yt(r),!this.popup||Hp(this.popup))return;const s=this.popup;delete s.open,delete s.close,this.popup=new i(s)}),this._popupSetupTask.promise}_queryLayerPopupFeatures(r,i,s){return i.map(({layerView:n,graphics:o})=>{const a={clientGraphics:o,event:s?.event,signal:s?.signal,defaultPopupTemplateEnabled:s!=null&&!!s.defaultPopupTemplateEnabled},l=n.fetchPopupFeatures(r,a);return{layerView:n,promise:l}})}_isValidPopupGraphic(r,i){return r&&!!r.getEffectivePopupTemplate(i!=null&&i.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(r,i){const{clientGraphics:s,queryArea:n,location:o}=await this._popupHitTestGraphics(r,i),a=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:l,clientOnlyGraphics:c}=this._graphicsPerFetchPopupLayerView(s,a);return{clientOnlyGraphics:c,layerViewsAndGraphics:l,queryArea:n,location:o}}async _popupHitTestGraphics(r,i){const s=await this.popupHitTest(r),n=s.results,o=s.mapPoint,a=n.filter(c=>c.type==="graphic"&&this._isValidPopupGraphic(c.graphic,i)),l=a.length?a[0].mapPoint:null;return{clientGraphics:a.map(c=>c.graphic),queryArea:o,location:o||l}}_getFetchPopupLayerViews(){const r=[];return this.allLayerViews.forEach(i=>{this._isValidPopupLayerView(i)&&r.push(i)}),this.graphicsView!=null&&this._isValidPopupLayerView(this.graphicsView)&&r.push(this.graphicsView),r.reverse()}_isValidPopupLayerView(r){return r!=null&&(!("layer"in r)||!r.suspended)&&"fetchPopupFeatures"in r}_graphicsPerFetchPopupLayerView(r,i){const s=[],n=new Map,o=i.map(a=>{const l=[];return"layer"in a?n.set(a.layer,l):n.set(a.graphics,l),{layerView:a,graphics:l}});for(const a of r){const l=n.get(a.layer)||n.get(a.sourceLayer)||null;l?l.push(a):s.push(a)}return{layerViewsAndGraphics:o,clientOnlyGraphics:s}}};return u([p({cast(r){return!r||Hp(r)||typeof r=="object"&&(r.open=i=>(Z4(K.getLogger(this),"view.popup is no longer created by default. view.popup.open() will stop working when the popup isn't created",{replacement:"Use view.openPopup() instead.",version:"4.27"}),this.openPopup(i)),r.close=()=>(Z4(K.getLogger(this),"view.popup is no longer created by default. view.popup.close() will stop working when the popup isn't created",{replacement:"Use view.closePopup() instead.",version:"4.27"}),this.closePopup())),r}})],e.prototype,"popup",void 0),u([p()],e.prototype,"popupEnabled",void 0),e=u([P("esri.views.PopupView")],e),e},bse={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8},Vje={milliseconds:{getter:"getMilliseconds",setter:"setMilliseconds",multiplier:1},seconds:{getter:"getSeconds",setter:"setSeconds",multiplier:1},minutes:{getter:"getMinutes",setter:"setMinutes",multiplier:1},hours:{getter:"getHours",setter:"setHours",multiplier:1},days:{getter:"getDate",setter:"setDate",multiplier:1},weeks:{getter:"getDate",setter:"setDate",multiplier:7},months:{getter:"getMonth",setter:"setMonth",multiplier:1},years:{getter:"getFullYear",setter:"setFullYear",multiplier:1},decades:{getter:"getFullYear",setter:"setFullYear",multiplier:10},centuries:{getter:"getFullYear",setter:"setFullYear",multiplier:100}};function Bje(t,e){const r=new Date(t,e+1,1);return r.setDate(0),r.getDate()}function _w(t,e,r){const i=new Date(t.getTime());if(e&&r){const s=Vje[r],{getter:n,setter:o,multiplier:a}=s;if(r==="months"){const l=Bje(i.getFullYear(),i.getMonth()+e);i.getDate()>l&&i.setDate(l)}i[o](i[n]()+e*a)}return i}function wse(t,e){switch(e){case"milliseconds":return new Date(t.getTime());case"seconds":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds());case"minutes":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes());case"hours":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours());case"days":return new Date(t.getFullYear(),t.getMonth(),t.getDate());case"weeks":return new Date(t.getFullYear(),t.getMonth(),t.getDate()-t.getDay());case"months":return new Date(t.getFullYear(),t.getMonth(),1);case"years":return new Date(t.getFullYear(),0,1);case"decades":return new Date(t.getFullYear()-t.getFullYear()%10,0,1);case"centuries":return new Date(t.getFullYear()-t.getFullYear()%100,0,1);default:return new Date}}function Gje(t,e,r){return t===0?0:t*bse[e]/bse[r]}var Rd;let au=Rd=class extends ue{static get allTime(){return xse}static get empty(){return jje}constructor(t){super(t),this.end=null,this.start=null}readEnd(t,e){return e.end!=null?new Date(e.end):null}writeEnd(t,e){e.end=t?t.getTime():null}get isAllTime(){return this.equals(Rd.allTime)}get isEmpty(){return this.equals(Rd.empty)}readStart(t,e){return e.start!=null?new Date(e.start):null}writeStart(t,e){e.start=t?t.getTime():null}clone(){return new Rd({end:this.end,start:this.start})}equals(t){if(!t)return!1;const e=this.start!=null?this.start.getTime():this.start,r=this.end!=null?this.end.getTime():this.end,i=t.start!=null?t.start.getTime():t.start,s=t.end!=null?t.end.getTime():t.end;return e===i&&r===s}expandTo(t){if(this.isEmpty||this.isAllTime)return this.clone();const e=Cc(this.start,i=>wse(i,t)),r=Cc(this.end,i=>{const s=wse(i,t);return i.getTime()===s.getTime()?s:_w(s,1,t)});return new Rd({start:e,end:r})}intersection(t){if(!t)return this.clone();if(this.isEmpty||t.isEmpty)return Rd.empty;if(this.isAllTime)return t.clone();if(t.isAllTime)return this.clone();const e=this.start?.getTime()??-1/0,r=this.end?.getTime()??1/0,i=t.start?.getTime()??-1/0,s=t.end?.getTime()??1/0;let n,o;if(i>=e&&i<=r?n=i:e>=i&&e<=s&&(n=e),r>=i&&r<=s?o=r:s>=e&&s<=r&&(o=s),n!=null&&o!=null&&!isNaN(n)&&!isNaN(o)){const a=new Rd;return a.start=n===-1/0?null:new Date(n),a.end=o===1/0?null:new Date(o),a}return Rd.empty}offset(t,e){if(this.isEmpty||this.isAllTime)return this.clone();const r=new Rd,{start:i,end:s}=this;return i!=null&&(r.start=_w(i,t,e)),s!=null&&(r.end=_w(s,t,e)),r}union(t){if(!t||t.isEmpty)return this.clone();if(this.isEmpty)return t.clone();if(this.isAllTime||t.isAllTime)return xse.clone();const e=this.start!=null&&t.start!=null?new Date(Math.min(this.start.getTime(),t.start.getTime())):null,r=this.end!=null&&t.end!=null?new Date(Math.max(this.end.getTime(),t.end.getTime())):null;return new Rd({start:e,end:r})}};u([p({type:Date,json:{write:{allowNull:!0}}})],au.prototype,"end",void 0),u([Oe("end")],au.prototype,"readEnd",null),u([Be("end")],au.prototype,"writeEnd",null),u([p({readOnly:!0,json:{read:!1}})],au.prototype,"isAllTime",null),u([p({readOnly:!0,json:{read:!1}})],au.prototype,"isEmpty",null),u([p({type:Date,json:{write:{allowNull:!0}}})],au.prototype,"start",void 0),u([Oe("start")],au.prototype,"readStart",null),u([Be("start")],au.prototype,"writeStart",null),au=Rd=u([P("esri.TimeExtent")],au);const xse=new au,jje=new au({start:void 0,end:void 0}),Im=au;let _R=class extends pR{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};u([zY({Type:Bl,ensureType:ws(Bl)})],_R.prototype,"itemType",void 0),_R=u([P("esri.support.GraphicsCollection")],_R);const Tse=new Map([["AUS Central Standard Time","Australia/Darwin"],["AUS Eastern Standard Time","Australia/Sydney"],["Afghanistan Standard Time","Asia/Kabul"],["Alaskan Standard Time","America/Anchorage"],["Aleutian Standard Time","America/Adak"],["Altai Standard Time","Asia/Barnaul"],["Arab Standard Time","Asia/Riyadh"],["Arabian Standard Time","Asia/Dubai"],["Arabic Standard Time","Asia/Baghdad"],["Argentina Standard Time","America/Buenos_Aires"],["Astrakhan Standard Time","Europe/Astrakhan"],["Atlantic Standard Time","America/Halifax"],["Aus Central W. Standard Time","Australia/Eucla"],["Azerbaijan Standard Time","Asia/Baku"],["Azores Standard Time","Atlantic/Azores"],["Bahia Standard Time","America/Bahia"],["Bangladesh Standard Time","Asia/Dhaka"],["Belarus Standard Time","Europe/Minsk"],["Bougainville Standard Time","Pacific/Bougainville"],["Canada Central Standard Time","America/Regina"],["Cape Verde Standard Time","Atlantic/Cape_Verde"],["Caucasus Standard Time","Asia/Yerevan"],["Cen. Australia Standard Time","Australia/Adelaide"],["Central America Standard Time","America/Guatemala"],["Central Asia Standard Time","Asia/Almaty"],["Central Brazilian Standard Time","America/Cuiaba"],["Central Europe Standard Time","Europe/Budapest"],["Central European Standard Time","Europe/Warsaw"],["Central Pacific Standard Time","Pacific/Guadalcanal"],["Central Standard Time","America/Chicago"],["Central Standard Time (Mexico)","America/Mexico_City"],["Chatham Islands Standard Time","Pacific/Chatham"],["China Standard Time","Asia/Shanghai"],["Cuba Standard Time","America/Havana"],["Dateline Standard Time","Etc/GMT+12"],["E. Africa Standard Time","Africa/Nairobi"],["E. Australia Standard Time","Australia/Brisbane"],["E. Europe Standard Time","Europe/Chisinau"],["E. South America Standard Time","America/Sao_Paulo"],["Easter Island Standard Time","Pacific/Easter"],["Eastern Standard Time","America/New_York"],["Eastern Standard Time (Mexico)","America/Cancun"],["Egypt Standard Time","Africa/Cairo"],["Ekaterinburg Standard Time","Asia/Yekaterinburg"],["FLE Standard Time","Europe/Kiev"],["Fiji Standard Time","Pacific/Fiji"],["GMT Standard Time","Europe/London"],["GTB Standard Time","Europe/Bucharest"],["Georgian Standard Time","Asia/Tbilisi"],["Greenland Standard Time","America/Godthab"],["Greenwich Standard Time","Atlantic/Reykjavik"],["Haiti Standard Time","America/Port-au-Prince"],["Hawaiian Standard Time","Pacific/Honolulu"],["India Standard Time","Asia/Calcutta"],["Iran Standard Time","Asia/Tehran"],["Israel Standard Time","Asia/Jerusalem"],["Jordan Standard Time","Asia/Amman"],["Kaliningrad Standard Time","Europe/Kaliningrad"],["Korea Standard Time","Asia/Seoul"],["Libya Standard Time","Africa/Tripoli"],["Line Islands Standard Time","Pacific/Kiritimati"],["Lord Howe Standard Time","Australia/Lord_Howe"],["Magadan Standard Time","Asia/Magadan"],["Magallanes Standard Time","America/Punta_Arenas"],["Marquesas Standard Time","Pacific/Marquesas"],["Mauritius Standard Time","Indian/Mauritius"],["Middle East Standard Time","Asia/Beirut"],["Montevideo Standard Time","America/Montevideo"],["Morocco Standard Time","Africa/Casablanca"],["Mountain Standard Time","America/Denver"],["Mountain Standard Time (Mexico)","America/Mazatlan"],["Myanmar Standard Time","Asia/Rangoon"],["N. Central Asia Standard Time","Asia/Novosibirsk"],["Namibia Standard Time","Africa/Windhoek"],["Nepal Standard Time","Asia/Katmandu"],["New Zealand Standard Time","Pacific/Auckland"],["Newfoundland Standard Time","America/St_Johns"],["Norfolk Standard Time","Pacific/Norfolk"],["North Asia East Standard Time","Asia/Irkutsk"],["North Asia Standard Time","Asia/Krasnoyarsk"],["North Korea Standard Time","Asia/Pyongyang"],["Omsk Standard Time","Asia/Omsk"],["Pacific SA Standard Time","America/Santiago"],["Pacific Standard Time","America/Los_Angeles"],["Pacific Standard Time (Mexico)","America/Tijuana"],["Pakistan Standard Time","Asia/Karachi"],["Paraguay Standard Time","America/Asuncion"],["Qyzylorda Standard Time","Asia/Qyzylorda"],["Romance Standard Time","Europe/Paris"],["Russia Time Zone 10","Asia/Srednekolymsk"],["Russia Time Zone 11","Asia/Kamchatka"],["Russia Time Zone 3","Europe/Samara"],["Russian Standard Time","Europe/Moscow"],["SA Eastern Standard Time","America/Cayenne"],["SA Pacific Standard Time","America/Bogota"],["SA Western Standard Time","America/La_Paz"],["SE Asia Standard Time","Asia/Bangkok"],["Saint Pierre Standard Time","America/Miquelon"],["Sakhalin Standard Time","Asia/Sakhalin"],["Samoa Standard Time","Pacific/Apia"],["Sao Tome Standard Time","Africa/Sao_Tome"],["Saratov Standard Time","Europe/Saratov"],["Singapore Standard Time","Asia/Singapore"],["South Africa Standard Time","Africa/Johannesburg"],["South Sudan Standard Time","Africa/Juba"],["Sri Lanka Standard Time","Asia/Colombo"],["Sudan Standard Time","Africa/Khartoum"],["Syria Standard Time","Asia/Damascus"],["Taipei Standard Time","Asia/Taipei"],["Tasmania Standard Time","Australia/Hobart"],["Tocantins Standard Time","America/Araguaina"],["Tokyo Standard Time","Asia/Tokyo"],["Tomsk Standard Time","Asia/Tomsk"],["Tonga Standard Time","Pacific/Tongatapu"],["Transbaikal Standard Time","Asia/Chita"],["Turkey Standard Time","Europe/Istanbul"],["Turks And Caicos Standard Time","America/Grand_Turk"],["US Eastern Standard Time","America/Indianapolis"],["US Mountain Standard Time","America/Phoenix"],["UTC","Etc/GMT"],["UTC+01","Etc/GMT-1"],["UTC+02","Etc/GMT-2"],["UTC+03","Etc/GMT-3"],["UTC+04","Etc/GMT-4"],["UTC+05","Etc/GMT-5"],["UTC+06","Etc/GMT-6"],["UTC+07","Etc/GMT-7"],["UTC+08","Etc/GMT-8"],["UTC+09","Etc/GMT-9"],["UTC+10","Etc/GMT-10"],["UTC+11","Etc/GMT-11"],["UTC+12","Etc/GMT-12"],["UTC+13","Etc/GMT-13"],["UTC+14","Etc/GMT-14"],["UTC-01","Etc/GMT+1"],["UTC-02","Etc/GMT+2"],["UTC-03","Etc/GMT+3"],["UTC-04","Etc/GMT+4"],["UTC-05","Etc/GMT+5"],["UTC-06","Etc/GMT+6"],["UTC-07","Etc/GMT+7"],["UTC-08","Etc/GMT+8"],["UTC-09","Etc/GMT+9"],["UTC-10","Etc/GMT+10"],["UTC-11","Etc/GMT+11"],["UTC-12","Etc/GMT+12"],["Ulaanbaatar Standard Time","Asia/Ulaanbaatar"],["Venezuela Standard Time","America/Caracas"],["Vladivostok Standard Time","Asia/Vladivostok"],["Volgograd Standard Time","Europe/Volgograd"],["W. Australia Standard Time","Australia/Perth"],["W. Central Africa Standard Time","Africa/Lagos"],["W. Europe Standard Time","Europe/Berlin"],["W. Mongolia Standard Time","Asia/Hovd"],["West Asia Standard Time","Asia/Tashkent"],["West Bank Standard Time","Asia/Hebron"],["West Pacific Standard Time","Pacific/Port_Moresby"],["Yakutsk Standard Time","Asia/Yakutsk"],["Yukon Standard Time","America/Whitehorse"]]);function Hje(t,e="system"){if(!t||!Tse.has(t.timeZone))return e;const r=Tse.get(t.timeZone);return Wje(t.timeZone)||t.respectsDaylightSaving?r:qje(r)}function qje(t){const e=br.local().setZone(t),r=Math.min(e.set({month:1,day:1}).offset,e.set({month:5}).offset);return r===0?"Etc/UTC":`Etc/GMT${il.instance(-r).formatOffset(0,"narrow")}`}function Wje(t){return t.startsWith("UTC")}let qy=class extends Hi(ue){constructor(e){super(e),this.legacy=null,this.timeZone="system"}readLegacy(e,r){const{timeZone:i,respectsDaylightSaving:s}=r;return{timeZone:i,respectsDaylightSaving:s}}readTimeZone(e,r){return"timeZoneIANA"in r?r.timeZoneIANA:Hje(r)}writeTimeZone(e,r){r.timeZoneIANA=e}equals(e){return e!=null&&this.timeZone!=null&&e.timeZone!=null&&this.timeZone===e.timeZone}};u([p()],qy.prototype,"legacy",void 0),u([Oe("legacy",["timeZone"])],qy.prototype,"readLegacy",null),u([p({type:String,nonNullable:!0})],qy.prototype,"timeZone",void 0),u([Oe("timeZone",["timeZone","timeZoneIANA","respectsDaylightSaving"])],qy.prototype,"readTimeZone",null),u([Be("timeZone")],qy.prototype,"writeTimeZone",null),qy=u([P("esri.time.TimeReference")],qy);const $E=qy;let Wy=class extends Te{constructor(e){super(e),this.view=null,this.baseLayerViews=new Pt,this.referenceLayerViews=new Pt,this._loadingHandle=le(()=>this.view?.map?.basemap,r=>{r&&r.load().catch(()=>{})},Pr)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null);for(const e of this.baseLayerViews)e.destroy();this.baseLayerViews.length=0;for(const e of this.referenceLayerViews)e.destroy();this.referenceLayerViews.length=0}get suspended(){return!this.view||this.view.suspended}get updating(){if(this.view&&this.view.suspended)return!1;const e=this.view?.map?.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(r=>r.updating)||this.referenceLayerViews.some(r=>r.updating))}};u([p({constructOnly:!0})],Wy.prototype,"view",void 0),u([p({readOnly:!0})],Wy.prototype,"baseLayerViews",void 0),u([p({readOnly:!0})],Wy.prototype,"referenceLayerViews",void 0),u([p({readOnly:!0})],Wy.prototype,"suspended",null),u([p({type:Boolean,readOnly:!0})],Wy.prototype,"updating",null),Wy=u([P("esri.views.BasemapView")],Wy);function Xje(t){return"tryRecycleWith"in t}let Yje=class{constructor(e,r,i){this.layer=e,this.view=r,this.layerViewImporter=i,this._controller=new AbortController,this._deferred=Eo(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,ya(this._controller.signal,()=>{const s=new U("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(s)})}tryRecycle(e){if(!this.done||!this.layerView||!Xje(this.layerView))return null;const r=this.layer.type,i=this._controller.signal;for(let s=0;s<e.length;s++){const n=e[s];if(n.type!==r)continue;const o=this.layerView.tryRecycleWith(n,{signal:i});if(o){e.splice(s,1),this.layer=n;const a=this.layerView,l=a.view;return this.promise=Promise.race([o.then(()=>(Yt(this._controller.signal),n.emit("layerview-destroy",{view:l,layerView:a}),l.emit("layerview-destroy",{view:l,layerView:a}),n.emit("layerview-create",{view:l,layerView:a}),l.emit("layerview-create",{view:l,layerView:a}),a)),new Promise((c,h)=>ya(this._controller.signal,()=>h(zr())))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:e}=this;if(e){const{layer:r,view:i}=this;r.emit("layerview-destroy",{view:i,layerView:e}),i.emit("layerview-destroy",{layer:r,layerView:e})}this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null,this._map=null}async start(){if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:r,view:i}=this;this._map=i.map;try{let s,n;if(await r.load({signal:e}),"prefetchResources"in r&&await r.prefetchResources?.({signal:e}),Jje(r))s=await r.createLayerView(i,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(r))throw new U("layer:view-not-supported","No layerview implementation was found");const l=await this.layerViewImporter.importLayerView(r);Yt(e),s="default"in l?new l.default({layer:r,view:i}):new l({layer:r,view:i})}const o=()=>{n=Fi(n),s.destroyed||s.destroy(),s.layer=null,s.parent=null,s.view=null,this.done=!0};n=ya(e,o),Yt(e);try{await s.when()}catch(l){throw o(),l}if(!this._map?.allLayers?.includes(r))return o(),void this._deferred.reject(new U("view:no-layerview-for-layer","The layer has been removed from the map",{layer:r}));this.layerView=s,r.emit("layerview-create",{view:i,layerView:s}),i.emit("layerview-create",{layer:r,layerView:s}),this.done=!0,this._deferred.resolve(s)}catch(s){r.emit("layerview-create-error",{view:i,error:s}),i.emit("layerview-create-error",{layer:r,error:s}),this.done=!0,this._deferred.reject(new U("layerview:create-error","layerview creation failed",{layer:r,error:s}))}}},ah=class extends Te{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new tm,this.supportsGround=!0,this._preloadLayerViewModules=()=>{const r=this.view.map?.allLayers;if(r)for(const i of r)this.layerViewImporter.hasLayerViewModule(i)&&this.layerViewImporter.importLayerView(i)},this._reschedule=()=>this.destroyed?Promise.reject():(this._workPromise==null&&(this._workPromise=Eo(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(gC(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{if(this.destroyed)return;const r=this.view.map;if(this._map!==r&&(this.clear(),this._map=r),this._workPromise==null)return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const i=new Set,s=[],n=this.view.ready,o=l=>{if(l!=null){for(const c of l)if(c){i.add(c);const h=this._layerLayerViewInfoMap.get(c);h&&n?h.start():h||this._recyclingInfoMap.has(c)||s.push(c),"layers"in c&&c.layers&&o(c.layers)}}};for(const l of this._rootCollectionNames)o(this.get(l));for(const[l,c]of this._layerLayerViewInfoMap)if(!i.has(l)){this._layerLayerViewInfoMap.delete(c.layer);const h=c.tryRecycle(s);h?(this.notifyChange("updating"),this._recyclingInfoMap.set(c.layer,c),h.then(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(c.layer),this._layerLayerViewInfoMap.set(c.layer,c),this._reschedule()}).catch(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(c.layer),c.destroy(),this._reschedule()})):c.destroy()}for(const[l,c]of this._recyclingInfoMap)i.has(l)||(this.notifyChange("updating"),this._recyclingInfoMap.delete(c.layer),c.destroy());for(const l of s)this._createLayerView(l);this._refreshCollections();const a=[r?.ground?.layers,r?.basemap?.baseLayers,r?.basemap?.referenceLayers,r?.layers].filter(l=>!!l);i.forEach(l=>"layers"in l&&a.push(l.layers)),this.addHandles(a.map(l=>this._watchUpdatingTracking.addOnCollectionChange(()=>l,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.own([_a(()=>this.view?.map?.allLayers,"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),le(()=>{const e=this.view,r=e?.map;return[r?.basemap,r?.ground,r?.layers,e?.ready]},()=>this._reschedule(),Ls)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),MU(this._recyclingInfoMap),MU(this._layerLayerViewInfoMap),this._watchUpdatingTracking.destroy(),this._map=null,this._workPromise!=null&&(this._workPromise.reject(zr()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return this._workPromise!=null||this._watchUpdatingTracking.updating||Bo(this._layerLayerViewInfoMap,e=>!e.done)||this._recyclingInfoMap.size>0}get updatingRemaining(){let e=0;for(const r of this._layerLayerViewInfoMap.values())r.done||++e;return e}clear(){this.destroyed||(MU(this._layerLayerViewInfoMap),this._refreshCollections())}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new U("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,r]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(e),this.get(r),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,r,i){if(!e||!r)return void(r&&r.removeAll());let s=0;for(const n of e){const o=this._layerLayerViewInfoMap.get(n);if(!o||!o.layerView)continue;const a=o.layerView;a.layer=n,a.parent=i,r.at(s)!==a&&r.splice(s,0,a),n.layers&&this._populateLayerViewsOwners(n.layers,a.layerViews,a),s+=1}s<r.length&&r.splice(s,r.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const r=new Yje(e,this.view,this.layerViewImporter);r.promise.then(()=>this._refreshCollections(),i=>{i&&(ds(i)||i.name==="cancelled:layerview-create")||K.getLogger(this).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:i}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,r),this.view.ready&&r.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};u([p()],ah.prototype,"_workPromise",void 0),u([p({readOnly:!0})],ah.prototype,"_watchUpdatingTracking",void 0),u([p({readOnly:!0})],ah.prototype,"_layersToLayerViews",null),u([p({readOnly:!0})],ah.prototype,"_rootCollectionNames",null),u([p()],ah.prototype,"layerViewImporter",void 0),u([p()],ah.prototype,"supportsGround",void 0),u([p({readOnly:!0})],ah.prototype,"updating",null),u([p({readOnly:!0})],ah.prototype,"updatingRemaining",null),u([p({constructOnly:!0})],ah.prototype,"view",void 0),ah=u([P("esri.views.LayerViewManager")],ah);const Zje=ah;function Jje(t){return"createLayerView"in t&&t.createLayerView!=null}let Kc=class extends Te{constructor(e){super(e),this.factor=1.5,this.offset=Xh(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};u([p({type:Number})],Kc.prototype,"factor",void 0),u([p({nonNullable:!0})],Kc.prototype,"offset",void 0),u([p()],Kc.prototype,"position",void 0),u([p({type:Number,range:{min:0}})],Kc.prototype,"size",void 0),u([p()],Kc.prototype,"maskUrl",void 0),u([p()],Kc.prototype,"maskEnabled",void 0),u([p()],Kc.prototype,"overlayUrl",void 0),u([p()],Kc.prototype,"overlayEnabled",void 0),u([p({readOnly:!0})],Kc.prototype,"version",null),u([p({type:Boolean})],Kc.prototype,"visible",void 0),Kc=u([P("esri.views.Magnifier")],Kc);const zwe=Kc;let Qje=class{constructor(){this._tasks=new Array,this._running=bM(!1)}get length(){return this._tasks.length}get running(){return this._running.value}destroy(){this.cancelAll()}runTask(e){for(;!e.done&&this._process(e);)e.madeProgress()}push(e,r,i){return this._running.value=!0,new Promise((s,n)=>this._tasks.push(new Sse(s,n,e,r,i)))}unshift(e,r,i){return this._running.value=!0,new Promise((s,n)=>this._tasks.unshift(new Sse(s,n,e,r,i)))}_process(e){if(this._tasks.length===0)return!1;const r=this._tasks.shift();try{const i=Mn(r.signal);if(i&&!r.abortCallback)r.reject(zr());else{const s=i?r.abortCallback?.(zr()):r.callback(e);ku(s)?s.then(r.resolve,r.reject):r.resolve(s)}}catch(i){r.reject(i)}return this._running.value=this._tasks.length>0,!0}cancelAll(){const e=zr();for(const r of this._tasks)if(r.abortCallback){const i=r.abortCallback(e);r.resolve(i)}else r.reject(e);this._tasks.length=0,this._running.value=!1}},Sse=class{constructor(e,r,i,s=void 0,n=void 0){this.resolve=e,this.reject=r,this.callback=i,this.signal=s,this.abortCallback=n}},ZA=class extends Te{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};u([p()],ZA.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),u([p()],ZA.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),ZA=u([P("esri.views.support.DebugFlags")],ZA);const Kje=new ZA;var Ur;(function(t){t[t.ANIMATING=0]="ANIMATING",t[t.INTERACTING=1]="INTERACTING",t[t.IDLE=2]="IDLE"})(Ur||(Ur={}));function eHe(){return new D5.Scheduler}var Zo,vt;(function(t){t[t.YIELD=1]="YIELD"})(Zo||(Zo={})),function(t){t.RESOURCE_CONTROLLER_IMMEDIATE="immediate",t.RESOURCE_CONTROLLER="schedule",t.SLIDE="slide",t.STREAM_DATA_LOADER="stream loader",t.ELEVATION_QUERY="elevation query",t.TERRAIN_SURFACE="terrain",t.SURFACE_GEOMETRY_UPDATES="surface geometry updates",t.LOD_RENDERER="LoD renderer",t.GRAPHICS_CORE="Graphics3D",t.I3S_CONTROLLER="I3S",t.POINT_CLOUD_LAYER="point cloud",t.FEATURE_TILE_FETCHER="feature fetcher",t.OVERLAY="overlay",t.STAGE="stage",t.GRAPHICS_DECONFLICTOR="graphics deconflictor",t.FILTER_VISIBILITY="Graphics3D filter visibility",t.SCALE_VISIBILITY="Graphics3D scale visibility",t.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",t.POINT_OF_INTEREST_FREQUENT="POI frequent",t.POINT_OF_INTEREST_INFREQUENT="POI infrequent",t.LABELER="labeler",t.FEATURE_QUERY_ENGINE="feature query",t.FEATURE_TILE_TREE="feature tile tree",t.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",t.ELEVATION_ALIGNMENT="elevation alignment",t.TEXT_TEXTURE_ATLAS="text texture atlas",t.TEXTURE_UNLOAD="texture unload",t.LINE_OF_SIGHT_TOOL="line of sight tool",t.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",t.ELEVATION_PROFILE="elevation profile",t.SNAPPING="snapping",t.SHADOW_ACCUMULATOR="shadow accumulator",t.CLOUDS_GENERATOR="clouds generator",t[t.NONE=0]="NONE",t[t.TEST_PRIO=1]="TEST_PRIO"}(vt||(vt={}));const Lf=0,Ese=new Map([[vt.RESOURCE_CONTROLLER_IMMEDIATE,Lf],[vt.RESOURCE_CONTROLLER,4],[vt.SLIDE,Lf],[vt.STREAM_DATA_LOADER,Lf],[vt.ELEVATION_QUERY,Lf],[vt.TERRAIN_SURFACE,1],[vt.SURFACE_GEOMETRY_UPDATES,1],[vt.LOD_RENDERER,2],[vt.GRAPHICS_CORE,2],[vt.I3S_CONTROLLER,2],[vt.POINT_CLOUD_LAYER,2],[vt.FEATURE_TILE_FETCHER,2],[vt.OVERLAY,4],[vt.STAGE,4],[vt.GRAPHICS_DECONFLICTOR,4],[vt.FILTER_VISIBILITY,4],[vt.SCALE_VISIBILITY,4],[vt.FRUSTUM_VISIBILITY,4],[vt.CLOUDS_GENERATOR,4],[vt.POINT_OF_INTEREST_FREQUENT,6],[vt.POINT_OF_INTEREST_INFREQUENT,30],[vt.LABELER,8],[vt.FEATURE_QUERY_ENGINE,8],[vt.FEATURE_TILE_TREE,16],[vt.FEATURE_TILE_TREE_ACTIVE,Lf],[vt.ELEVATION_ALIGNMENT,12],[vt.TEXT_TEXTURE_ATLAS,12],[vt.TEXTURE_UNLOAD,12],[vt.LINE_OF_SIGHT_TOOL,16],[vt.LINE_OF_SIGHT_TOOL_INTERACTIVE,Lf],[vt.SNAPPING,Lf],[vt.SHADOW_ACCUMULATOR,30]]);function Cse(t){return Ese.has(t)?Ese.get(t):typeof t=="number"?t:1}const Ase=6.5,Ose=1,tHe=30,Rse=1e3/30,Mse=100,Pse=.9;var D5,Qv;(function(t){class e{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(n=>n.needsUpdate)}constructor(){this._updating=bM(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new Gg("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new i,this._state=Ur.INTERACTING,this._tasks=new Vt,this._runQueue=new Vt,this._load=0,this._idleStateCallbacks=new Vt,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=le(()=>Kje.SCHEDULER_LOG_SLOW_TASKS,o=>this._debug=o,Pr);for(const o of Object.keys(vt))this.performanceInfo.tasks.set(vt[o],new Gg(vt[o]));const n=this;this._test={FRAME_SAFETY_BUDGET:Ase,INTERACTING_BUDGET:Rse,IDLE_BUDGET:Mse,get availableBudget(){return n._budget.budget},usedBudget:0,getBudget:()=>n._budget,setBudget:o=>n._budget=o,updateTask:o=>this._updateTask(o),getState:o=>this._getState(o),getRuntime:o=>this._getRuntime(o),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(n=>n.remove()),this._tasks.clear(),Fi(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(n){this._updatingChanged(),n&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())}))}registerTask(n,o){const a=Cse(n),l=new r(this,n,o,a);return this._tasks.push(l),this._updatingChanged(),this.performanceInfo.tasks.has(n)||this.performanceInfo.tasks.set(n,new Gg(n)),l}registerIdleStateCallbacks(n,o){const a={idleBegin:n,idleEnd:o};this._idleStateCallbacks.push(a),this.state===Ur.IDLE&&this._idleUpdatesStartFired&&a.idleBegin();const l=this;return{remove:()=>this._removeIdleStateCallbacks(a),set idleBegin(c){l._idleUpdatesStartFired&&(a.idleEnd(),l._state===Ur.IDLE&&c()),a.idleBegin=c},set idleEnd(c){a.idleEnd=c}}}get load(){return this._load}set state(n){this._state!==n&&(this._state=n,this.state!==Ur.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(o=>o.idleEnd())))}get state(){return this._state}updateBudget(n){this._test.usedBudget=0,++this._frameNumber;let o=Ase,a=n.frameDuration,l=Ose;switch(this.state){case Ur.IDLE:o=0,a=Math.max(Mse,n.frameDuration),l=tHe;break;case Ur.INTERACTING:a=Math.max(Rse,n.frameDuration);case Ur.ANIMATING:}return a=a-n.elapsedFrameTime-o,this.state!==Ur.IDLE&&a<Ose&&!this._forceTask?(this._forceTask=!0,!1):(a=Math.max(a,l),this._budget.reset(a,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case Ur.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(n=>n.idleBegin())),this._runIdle();break;case Ur.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(n){this._idleUpdatesStartFired&&n.idleEnd(),this._idleStateCallbacks.removeUnordered(n)}removeTask(n){this._tasks.removeUnordered(n),this._runQueue.removeUnordered(n),this._updatingChanged()}_updateTask(n){this._tasks.forAll(o=>{o.name===n&&o.setPriority(n)})}_getState(n){if(this._runQueue.some(a=>a.name===n))return Qv.SCHEDULED;let o=Qv.IDLE;return this._tasks.forAll(a=>{a.name===n&&a.needsUpdate&&(a.schedulePriority<=1?o=Qv.READY:o!==Qv.READY&&(o=Qv.WAITING))}),o}_getRuntime(n){let o=0;return this._tasks.forAll(a=>{a.name===n&&(o+=a.runtime)}),o}_resetRuntimes(){this._tasks.forAll(n=>n.runtime=0)}_getRunning(){const n=new Map;if(this._tasks.forAll(a=>{a.needsUpdate&&n.set(a.name,(n.get(a.name)||0)+1)}),n.size===0)return null;let o="";return n.forEach((a,l)=>{o+=a>1?` ${a}x ${l}`:` ${l}`}),o}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const n=this._tasks.reduce((o,a)=>a.needsUpdate?++o:o,0);this._load=this._load*Pse+n*(1-Pse)}_schedule(){for(this._runQueue.filterInPlace(n=>!!n.needsUpdate||(n.schedulePriority=n.basePriority,!1)),this._tasks.forAll(n=>{n.basePriority===Lf&&n.needsUpdate&&!this._runQueue.includes(n)&&n.blockFrame!==this._frameNumber&&this._runQueue.unshift(n)});this._runQueue.length===0;){let n=!1,o=0;if(this._tasks.forAll(a=>{a.needsUpdate&&a.schedulePriority!==0&&a.basePriority!==Lf&&a.blockFrame!==this._frameNumber&&(n=!0,o=Math.max(o,a.basePriority),a.schedulePriority===1?(a.schedulePriority=0,this._runQueue.push(a)):--a.schedulePriority)}),!n)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const n=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const o=this._budget.now(),a=this._runQueue.pop();this._budget.resetProgress();try{a.task.runTask(this._budget)===Zo.YIELD&&(a.blockFrame=this._frameNumber)}catch(c){K.getLogger("esri.views.support.Scheduler").error(`Exception in task "${a.name}"`,c)}!this._budget.hasProgressed&&a.blockFrame!==this._frameNumber&&a.needsUpdate&&(a.name,vt.I3S_CONTROLLER,a.blockFrame=this._frameNumber),a.schedulePriority=a.basePriority;const l=this._budget.now()-o;if(a.runtime+=l,this._frameTaskTimes.set(a.priority,this._frameTaskTimes.get(a.priority)+l),this._debug&&l>2*this._budget.budget&&console.log("Task",a.name,"used",l,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-n)}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-n)}_startFrameTaskTimes(){for(const n of Object.keys(vt))this._frameTaskTimes.set(vt[n],0)}_recordFrameTaskTimes(n){this._frameTaskTimes.forEach((o,a)=>this.performanceInfo.tasks.get(a).record(o)),this.performanceInfo.total.record(n)}get test(){return this._test}}t.Scheduler=e;class r{get task(){return this._task.value}get updating(){return this._queue.running}constructor(n,o,a,l){this._scheduler=n,this.name=o,this._basePriority=l,this.blockFrame=0,this.runtime=0,this._queue=new Qje,this._handles=new $i,this.schedulePriority=this._basePriority,this._task=bM(a??this._queue),this._handles.add(Iu(()=>this.task.running,c=>n.taskRunningChanged(c)))}remove(){this.processQueue(rl),this._scheduler.removeTask(this),this.schedule=LE.schedule,this.reschedule=LE.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(n){this.name=n;const o=Cse(n);this._basePriority!==Lf&&this.schedulePriority===0||(this.schedulePriority=o),this._basePriority=o}get priority(){return this.name}set priority(n){this.setPriority(n)}get needsUpdate(){return this.updating||this.task.running}schedule(n,o,a){return this._queue.push(n,o,a)}reschedule(n,o,a){return this._queue.unshift(n,o,a)}processQueue(n){this._queue.runTask(n)}}class i{constructor(){this._begin=typeof performance<"u"?performance.now():0,this._budget=0,this._state=Ur.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(n){return!this.done&&(n()===!0&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(n){this._enabled=n}reset(n,o){this._begin=this.now(),this._budget=n,this._state=o,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}t.Budget=i})(D5||(D5={})),function(t){t.SCHEDULED="s",t.READY="r",t.WAITING="w",t.IDLE="i"}(Qv||(Qv={}));const rl=(()=>{const t=new D5.Budget;return t.enabled=!1,t})();let rHe=class{remove(){}processQueue(){}schedule(e,r,i){try{if(Mn(r)){const s=zr();return i?Promise.resolve(i(s)):Promise.reject(s)}return G7(e(rl))}catch(s){return Promise.reject(s)}}reschedule(e,r,i){return this.schedule(e,r,i)}};const LE=new rHe;let uS=class extends Te{constructor(e,r){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=r?.registerTask(vt.TEXTURE_UNLOAD)??LE}normalizeCtorArgs(){return{}}destroy(){super.destroy(),this._frameTask?.remove(),this._textureRequests?.forEach(e=>this._releaseTextureRequest(e)),this._textureRequests?.clear()}get updating(){return this._frameTask.updating}fromData(e,r,i){const s=this.makeUid(e);let n=this._textureRequests.get(s);if(!n){const o=new Vwe(i);o.texture=r(),this._stage?.add(o.texture),this._stage?.loadImmediate(o.texture),this._textureRequests.set(s,o),n=o}return n.referenceCount++,{uid:s,texture:n.texture,release:()=>this._release(s)}}_release(e){const r=this._textureRequests.get(e);r?(r.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),r.referenceCount--,r.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(e){if(!this._textureRequests)return;const r=this._textureRequests.get(e);!r||r.referenceCount>0||(this._releaseTextureRequest(r),this._textureRequests.delete(e))}_releaseTextureRequest(e){e.onRemove&&e.onRemove(),e.texture?this._stage?.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,r=null){return r!=null?`${e}.${r}px`:e}};u([p()],uS.prototype,"_frameTask",void 0),u([p()],uS.prototype,"updating",null),uS=u([P("esri.views.3d.support.TextureCollection")],uS);let Vwe=class{constructor(e){this.onRemove=e,this.referenceCount=0}};var Ise;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right"})(Ise||(Ise={}));const Bwe=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],Gwe={};function jwe(t){return!!Gwe[t]}function iHe(t){for(const e of t)if(!jwe(e))return!1;return!0}Bwe.forEach(t=>{Gwe[t]=!0});let sHe=class{constructor(e){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this._handlers.forEach(({handler:r,priority:i},s)=>this.inputManager?.installHandlers(s,[r],i))}disconnect(){this.inputManager&&this._handlers.forEach((e,r)=>this.inputManager?.uninstallHandlers(r)),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(e,r,i,s){const n=Array.isArray(e)?e:e.split(",");if(!iHe(n))return n.some(jwe)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(r)?a=r:(o=r,a=[]),typeof i=="function"?o=i:s=i,s=s??Q_.DEFAULT;const l=this._createUniqueGroupName(),c=new nHe(this.view,n,a,o);this._handlers.set(l,{handler:c,priority:s});for(const h of n){const d=this._handlerCounts.get(h)||0;this._handlerCounts.set(h,d+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],s),{remove:()=>this._removeHandler(l,n)}}hasHandler(e){return!!this._handlerCounts.get(e)}_removeHandler(e,r){if(this._handlers.has(e)){this._handlers.delete(e);for(const i of r){const s=this._handlerCounts.get(i);s===void 0?console.error("Trying to remove handler for event that has no handlers registered: ",i):s===1?this._handlerCounts.delete(i):this._handlerCounts.set(i,s-1)}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},nHe=class extends Ro{constructor(e,r,i,s){super(!0),this._latestDragStart=void 0,this.view=e;for(const n of r)switch(n){case"click":this.registerIncoming("click",i,o=>s(this._wrapClick(o)));break;case"double-click":this.registerIncoming("double-click",i,o=>s(this._wrapDoubleClick(o)));break;case"immediate-click":this.registerIncoming("immediate-click",i,o=>s(this._wrapImmediateClick(o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",i,o=>s(this._wrapImmediateDoubleClick(o)));break;case"hold":this.registerIncoming("hold",i,o=>s(this._wrapHold(o)));break;case"drag":this.registerIncoming("drag",i,o=>{const a=this._wrapDrag(o);a&&s(a)});break;case"key-down":this.registerIncoming("key-down",i,o=>s(this._wrapKeyDown(o)));break;case"key-up":this.registerIncoming("key-up",i,o=>s(this._wrapKeyUp(o)));break;case"pointer-down":this.registerIncoming("pointer-down",i,o=>s(this._wrapPointer(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",i,o=>s(this._wrapPointer(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",i,o=>s(this._wrapPointer(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",i,o=>s(this._wrapPointerDrag(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",i,o=>s(this._wrapMouseWheel(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",i,o=>s(this._wrapPointer(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",i,o=>s(this._wrapPointer(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",i,o=>{s(this._wrapGamepad(o))});break;case"focus":this.registerIncoming("focus",i,o=>{s(this._wrapFocus(o))});break;case"blur":this.registerIncoming("blur",i,o=>{s(this._wrapBlur(o))})}}_wrapFocus(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:r=>e.async(r),preventDefault:()=>e.preventDefault()}}_wrapBlur(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:r=>e.async(r),preventDefault:()=>e.preventDefault()}}_wrapClick(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:h}=e;return{type:"click",pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:h,screenPoint:Xh(n,o),mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:d=>e.async(d),preventDefault:()=>e.preventDefault()}}_wrapDoubleClick(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:h}=e;return{type:"double-click",pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:h,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:d=>e.async(d),preventDefault:()=>e.preventDefault()}}_wrapImmediateClick(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:h,timestamp:d}=e;return{type:"immediate-click",pointerId:c,pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:d,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}_wrapImmediateDoubleClick(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:h,timestamp:d}=e;return{type:"immediate-double-click",pointerId:c,pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:d,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}_wrapHold(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a}=e.data,{cancelable:l,timestamp:c}=e;return{type:"hold",pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:c,mapPoint:this._getMapPoint(n,o),cancelable:l,stopPropagation:()=>e.stopPropagation(),async:h=>e.async(h),preventDefault:()=>e.preventDefault()}}_getMapPoint(e,r){return this.view.toMap(Xh(e,r),{exclude:[]})}_wrapDrag(e){const r=e.data,{x:i,y:s}=r.center,{action:n,pointerType:o,button:a}=r;if(n==="start"&&(this._latestDragStart=r),!this._latestDragStart)return;const l=r.pointer.native,c=r.buttons,{cancelable:h,timestamp:d}=e,f={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return n==="end"&&(this._latestDragStart=void 0),{type:"drag",action:n,x:i,y:s,origin:f,pointerType:o,button:a,buttons:c,radius:r.radius,angle:al(r.angle),native:l,timestamp:d,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}_wrapKeyDown(e){const{key:r,repeat:i,native:s}=e.data,{cancelable:n,timestamp:o}=e;return{type:"key-down",key:r,repeat:i,native:s,timestamp:o,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:a=>e.async(a),preventDefault:()=>e.preventDefault()}}_wrapKeyUp(e){const{key:r,native:i}=e.data,{cancelable:s,timestamp:n}=e;return{type:"key-up",key:r,native:i,timestamp:n,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:o=>e.async(o),preventDefault:()=>e.preventDefault()}}_wrapPointer(e,r){const{x:i,y:s,button:n,buttons:o,native:a,eventId:l}=e.data,c=a.pointerId,h=a.pointerType,{cancelable:d,timestamp:f}=e;return{type:r,x:i,y:s,pointerId:c,pointerType:h,button:n,buttons:o,native:a,timestamp:f,eventId:l,cancelable:d,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}_wrapPointerDrag(e){const{x:r,y:i,buttons:s,native:n,eventId:o}=e.data.currentEvent,{button:a}=e.data.startEvent,l=e.data.startEvent.native.pointerId,c=e.data.startEvent.native.pointerType,h=e.data.action,d={x:e.data.startEvent.x,y:e.data.startEvent.y},{cancelable:f,timestamp:m}=e;return{type:"pointer-drag",x:r,y:i,pointerId:l,pointerType:c,button:a,buttons:s,action:h,origin:d,native:n,timestamp:m,eventId:o,cancelable:f,stopPropagation:()=>e.stopPropagation(),async:g=>e.async(g),preventDefault:()=>e.preventDefault()}}_wrapMouseWheel(e){const{cancelable:r,data:i,timestamp:s}=e,{x:n,y:o,deltaY:a,native:l}=i;return{type:"mouse-wheel",x:n,y:o,deltaY:a,native:l,timestamp:s,cancelable:r,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}_wrapGamepad(e){const{action:r,state:i,device:s}=e.data,{cancelable:n,timestamp:o}=e,{buttons:a,axes:l}=i;return{type:"gamepad",device:s,timestamp:o,action:r,buttons:a,axes:l,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}};var wM,$se,Lse;(function(t){t[t.USER=0]="USER",t[t.MANAGER=1]="MANAGER"})(wM||(wM={})),function(t){t[t.None=0]="None",t[t.Unfocused=1]="Unfocused",t[t.Focused=2]="Focused",t[t.Unselected=4]="Unselected",t[t.Selected=8]="Selected",t[t.All=15]="All"}($se||($se={})),function(t){t[t.None=0]="None",t[t.Custom1=16]="Custom1",t[t.Custom2=32]="Custom2",t[t.Custom3=64]="Custom3",t[t.Custom4=128]="Custom4",t[t.Custom5=256]="Custom5",t[t.Custom6=512]="Custom6",t[t.Custom7=1024]="Custom7",t[t.Custom8=2048]="Custom8",t[t.Custom9=4096]="Custom9",t[t.Custom10=8192]="Custom10",t[t.Custom11=16384]="Custom11",t[t.Custom12=32768]="Custom12",t[t.All=65520]="All"}(Lse||(Lse={}));function oHe(t){return[t.on("before-add",e=>{const r=e.item;if(r==null||t.includes(r))return K.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void e.preventDefault();r.onAdd()}),t.on("after-remove",e=>{const r=e.item;r.active&&(r.view.activeTool=null),r.destroy()})]}function Ej(t){return t.visible&&t.getEditableFlag!=null&&t.getEditableFlag(wM.USER)&&t.getEditableFlag(wM.MANAGER)}function bf(t){return Xh(t.x,t.y)}function qFt(t){return Qi(t.x,t.y)}function Hwe(t,e){const r=(t instanceof HTMLElement?t:t.surface)?.getBoundingClientRect();return r?Xh(e.clientX-r.left,e.clientY-r.top):Xh(0,0)}function Dse(t,e){return e instanceof Event?Hwe(t,e):bf(e)}function Nse(t){if(t instanceof Event)return!0;if(typeof t=="object"&&"type"in t)switch(t.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}let aHe=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}hasFocusedManipulators(){return this._grabbedManipulators.size>0||this._draggedManipulators.size>0}handleInputEvent(e,r){const i=()=>e.stopPropagation();switch(e.type){case"pointer-move":Fse(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(i(),e.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!Use(e))break;const s=bf(e),n=this._intersect(s,e.pointerType,r.forEachTool);if(n==null)break;const o=n.manipulator,a=n.tool;o==null||a==null||!o.interactive||o.grabbable&&o.grabbableForEvent(e)||!o.grabbing||o.dragging||this._ungrabManipulatorBeforeDragging(o,e,r),o!=null&&a!=null&&o.interactive&&o.grabbable&&o.grabbableForEvent(e)&&!o.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:o,tool:a,start:s,pointerType:e.pointerType}),this._grabbedManipulators.size===1&&r.activeTool==null&&(this._revertToNullActiveTool=!0,r.setActiveTool(n.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:s}),i());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,r);break;case"pointer-drag":{if(!Use(e))break;const s=this._grabbedManipulators.get(e.pointerId),n=Cc(s,({manipulator:h})=>h),o=Cc(s,({tool:h})=>h);if(n==null||o==null)break;const a=bf(e);a.x=ve(a.x,0,r.view.width),a.y=ve(a.y,0,r.view.height);const l=s.start,c=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":e.action!=="update"&&this._grabbedManipulators.size!==1||(n.dragging=!0,c?n.events.emit("drag",{action:"update",start:l,screenPoint:a}):n.events.emit("drag",{action:"start",start:l,screenPoint:a,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:o,manipulator:n,start:l}));break;case"end":n.dragging=!1,c&&n.events.emit("drag",{action:"end",start:l,screenPoint:a}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,r)}i();break}case"immediate-click":{const s=bf(e),n=this._intersect(s,e.pointerType,r.forEachTool);if(lHe(e)||r.forEachTool(c=>{if((n==null||n.tool!==c||c.automaticManipulatorSelection)&&c.manipulators){let h=!1;c.manipulators.forEach(({manipulator:d})=>{d.selected&&(d.selected=!1,h=!0)}),h&&c.onManipulatorSelectionChanged&&c.onManipulatorSelectionChanged()}}),n==null)break;const{manipulator:o,tool:a}=n;if(!o.interactive)break;o.selectable&&a.automaticManipulatorSelection&&(o.selected=!o.selected,a.onManipulatorSelectionChanged&&a.onManipulatorSelectionChanged());const l=e.native.shiftKey;o.events.emit("immediate-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:l,stopPropagation:i});break}case"click":{const s=bf(e),n=this._intersect(s,e.pointerType,r.forEachTool),o=n!=null?n.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit(e.type,{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a}),i();break}case"double-click":{const s=bf(e),n=this._intersect(s,e.pointerType,r.forEachTool),o=n!=null?n.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:i});break}case"immediate-double-click":{const s=bf(e),n=this._intersect(s,e.pointerType,r.forEachTool),o=n!=null?n.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:i});break}}this._onFocusChange(r.forEachTool)}_ungrabManipulatorBeforeDragging(e,r,i){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:r.pointerType,screenPoint:bf(r)}),this._grabbedManipulators.forEach(({manipulator:s},n)=>{s===e&&this._grabbedManipulators.delete(n)}),this._afterManipulatorUngrab(i.setActiveTool)}_handlePointerEnd(e,r){const i=Cc(this._grabbedManipulators.get(e.pointerId),({manipulator:s})=>s);i!=null&&i.grabbing&&(i.grabbing=!1,i.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:bf(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorUngrab(r.setActiveTool))}_cursorFromMap(e){let r=null;return Bo(e,({manipulator:i})=>!(i==null||!i.interactive)&&(i.grabbing&&i.grabCursor?(r=i.grabCursor,!0):!!i.cursor&&(r=i.cursor,!0))),r}_onFocusChange(e){this._updateCursor(),this._updateFocusedManipulatorTools(e)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const r=new Set,i=new Set;this._grabbedManipulators.forEach(({tool:s})=>{r.add(s)}),this._hoveredManipulators.forEach(({tool:s})=>{i.add(s)}),e(s=>{s.hasGrabbedManipulators=r.has(s),s.hasHoveredManipulators=i.has(s);const n=this._grabbedManipulators.values(),o=ENe(n,({tool:a})=>a===s);s.firstGrabbedManipulator=o!=null?o.manipulator:null})}clearPointers(e,{forEachTool:r,setActiveTool:i},s=!0,n){const o=(a,l)=>a===e&&(n==null||n===l);this._grabbedManipulators.forEach(({tool:a,manipulator:l,pointerType:c},h)=>{o(a,l)&&(this._grabbedManipulators.delete(h),l.grabbing=!1,l.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:c}))}),this._draggedManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._draggedManipulators.delete(c),l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}),s&&this._hoveredManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._hoveredManipulators.delete(c),l.hovering=!1)}),this._afterManipulatorUngrab(i),this._onFocusChange(r)}_intersect(e,r,i){let s=null;return i(n=>{if(n.manipulators==null||!Ej(n))return!1;const o=n.manipulators.intersect(e,r);return o!=null&&(s={tool:n,manipulator:o},!0)}),s}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach((r,i)=>{this._updateHoveredStateForPointerAtScreenPosition(Xh(r.x,r.y),i,r.pointerType,e)})}handleHoverEvent(e,r){e.type!=="pointer-up"&&e.type!=="immediate-click"&&e.type!=="pointer-move"||!Fse(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(bf(e),e.pointerId,e.pointerType,r)}_updateHoveredStateForPointerAtScreenPosition(e,r,i,s){let n=this._intersect(e,i,s);const o=Cc(this._hoveredManipulators.get(r),({manipulator:a})=>a);n==null||n.manipulator.interactive||(n=null),n!=null&&o===n.manipulator||(o!=null&&(o.hovering=!1),n!=null?(n.manipulator.hovering=!0,this._hoveredManipulators.set(r,n)):this._hoveredManipulators.delete(r),this._onFocusChange(s))}_afterManipulatorUngrab(e){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}};function Fse(t){return t==="mouse"}function Use(t){return t.pointerType!=="mouse"||t.button===0}function lHe(t){return!!t.native.shiftKey}const kse="attached",ok="tools",cHe=1e3;let Md=class extends mM{constructor(e){super(e),this._clock=lP,this._manipulatorState=new aHe,this.tools=new Pt,this.cursor=null,this._interacting=!1,this._interactingTimeout=null,this._forEachTool=r=>{for(const i of this.tools.items)if(r(i))return}}initialize(){this.handles.add([this.view.on(Bwe,e=>{this._handleInputEvent(e)},Q_.TOOL),...oHe(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.detach(),this.handles.removeAll()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(e!=null&&!this.view.ready)return void K.getLogger(this).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const r=this.activeTool;this._set("activeTool",e),r?.deactivate(),e?.activate(),this._removeIncompleteTools(e);for(const i of this.tools){this._updateToolEditableFlag(i);const s=Ej(i);this.activeTool!=null&&s||this._manipulatorState.clearPointers(i,this._manipulatorStateEventArgs,!s)}this._updateCursor()}get updating(){return this.updatingHandles.updating||this.tools.some(e=>e.updating)||(this.textures?.updating??!1)}get interacting(){return this._interacting}_clearInteractingTimeout(){this._interactingTimeout=Fi(this._interactingTimeout)}_startInteractingTimeout(){this._clearInteractingTimeout(),this._interactingTimeout=this._clock.setTimeout(()=>this._interacting=!1,cHe)}attach(){this.view.type==="3d"?(this._set("textures",new uS(this.view._stage,this.view.resourceController.scheduler)),this.handles.add([le(()=>{const{state:e}=this.view;return"camera"in e&&e.camera},()=>this._forEachManipulator(e=>e.onViewChange())),this.view.elevationProvider?.on("elevation-change",e=>this._forEachManipulator(r=>r.onElevationChange(e))),nl(()=>this._set("textures",Ne(this.textures)))],kse)):this.handles.add(le(()=>this.view.extent,()=>this._forEachManipulator(e=>e.onViewChange())))}detach(){this.activeTool=null,this.tools.removeAll(),this.handles.remove(kse),this._clearInteractingTimeout(),this._interacting=!1}_forEachManipulator(e){this._forEachTool(r=>{r.manipulators&&r.manipulators.forEach(({manipulator:i})=>e(i,r))})}_handleInputEvent(e){let r=!1;const i={...e,stopPropagation:()=>{r=!0,e.stopPropagation()}};this.activeTool!=null?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(i):this._forEachTool(s=>{!r&&s.visible&&s.handleInputEvent(i)}),!r&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(i,this._manipulatorStateEventArgs),r||this.activeTool==null||this.activeTool.handleInputEventAfter(i),this._manipulatorState.handleHoverEvent(i,this._forEachTool),this._updateCursor(),e.type==="pointer-move"&&(this._manipulatorState.hasFocusedManipulators()||this.activeTool)&&(this._interacting=!0,this._startInteractingTimeout())}_refreshToolWatchers(){this.handles.remove(ok),this._forEachTool(e=>{if(e instanceof Te){const r=le(()=>[e.cursor,e.visible,e.editable],()=>{Ej(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.handles.add(r,ok)}e.manipulators&&this.handles.add([e.manipulators.on("after-remove",r=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,r.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],ok)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){e.setEditableFlag?.(wM.MANAGER,this.activeTool==null||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;e==null&&this._forEachTool(r=>!(r.cursor==null||!r.visible)&&(e=r.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(r=>(e==null||r!==e)&&!r.created&&r.removeIncompleteOnCancel).forEach(r=>{this.tools.remove(r)})}get test(){return{setClock:e=>this._clock=e}}};u([p({constructOnly:!0,nonNullable:!0})],Md.prototype,"view",void 0),u([p({readOnly:!0,nonNullable:!0})],Md.prototype,"textures",void 0),u([p({value:null})],Md.prototype,"activeTool",null),u([p({readOnly:!0,type:Pt})],Md.prototype,"tools",void 0),u([p({readOnly:!0})],Md.prototype,"cursor",void 0),u([p({readOnly:!0})],Md.prototype,"updating",null),u([p()],Md.prototype,"_interacting",void 0),u([p({readOnly:!0})],Md.prototype,"interacting",null),Md=u([P("esri.views.ToolViewManager")],Md);let g2=class extends Te{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":uHe.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return hHe[this.deviceType]}};u([p({nonNullable:!0,readOnly:!0})],g2.prototype,"nativeIndex",void 0),u([p({type:String,readOnly:!0})],g2.prototype,"deviceType",null),u([p({type:Number,readOnly:!0})],g2.prototype,"axisThreshold",null),g2=u([P("esri.views.input.gamepad.GamepadInputDevice")],g2);const uHe=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),hHe={standard:.15,spacemouse:.025,unknown:0},zJ=g2;let JA=class extends Te{constructor(...e){super(...e),this.devices=new Pt,this.enabledFocusMode="document"}};u([p({type:Pt.ofType(zJ),readOnly:!0})],JA.prototype,"devices",void 0),u([p({type:["document","view","none"]})],JA.prototype,"enabledFocusMode",void 0),JA=u([P("esri.views.input.gamepad.GamepadSettings")],JA);const dHe=JA;let gN=class extends Te{constructor(){super(...arguments),this.gamepad=new dHe}};u([p({readOnly:!0})],gN.prototype,"gamepad",void 0),gN=u([P("esri.views.input.Input")],gN);const pHe=gN;let Xy=class extends Te{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};u([p({type:Boolean,nonNullable:!0})],Xy.prototype,"enabled",void 0),u([p({type:zJ})],Xy.prototype,"device",void 0),u([p({type:["pan","zoom"],nonNullable:!0})],Xy.prototype,"mode",void 0),u([p({type:["forward-down","forward-up"],nonNullable:!0})],Xy.prototype,"tiltDirection",void 0),u([p({type:Number,nonNullable:!0})],Xy.prototype,"velocityFactor",void 0),Xy=u([P("esri.views.navigation.gamepad.GamepadSettings")],Xy);const qwe=Xy;let Q1=class extends Te{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new qwe,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};u([p({type:Boolean})],Q1.prototype,"browserTouchPanEnabled",void 0),u([p({type:qwe,nonNullable:!0})],Q1.prototype,"gamepad",void 0),u([p({type:Boolean})],Q1.prototype,"momentumEnabled",void 0),u([p({type:Boolean})],Q1.prototype,"mouseWheelZoomEnabled",void 0),Q1=u([P("esri.views.navigation.Navigation")],Q1);const Wwe=Q1,Xwe={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},Ywe=Object.values(Xwe),Zwe=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${Ywe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),fHe=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${Ywe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),mHe=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function e6t(t){return!!Zwe.test(t)}function Ix(t){if(t==null)return null;const e=Co(t),r=e.path.match(Zwe)||e.path.match(fHe);if(!r)return null;const[,i,s,n,o]=r,a=s.indexOf("/");return{title:D8(a!==-1?s.slice(a+1):s),serverType:Xwe[n.toLowerCase()],sublayer:o!=null&&o!==""?parseInt(o,10):null,url:{path:i}}}function gHe(t){const e=Co(t).path.match(mHe);return e?{serviceUrl:e[1],sublayerId:Number(e[2])}:null}function D8(t){return(t=t.replaceAll(/\s*[/_]+\s*/g," "))[0].toUpperCase()+t.slice(1)}function Jwe(t,e){const r=[];if(t){const i=Ix(t);i!=null&&i.title&&r.push(i.title)}if(e){const i=D8(e);r.push(i)}if(r.length===2){if(r[0].toLowerCase().includes(r[1].toLowerCase()))return r[0];if(r[1].toLowerCase().includes(r[0].toLowerCase()))return r[1]}return r.join(" - ")}function VJ(t){if(!t)return!1;const e=".arcgis.com/",r="//services",i="//tiles",s="//features",n=(t=t.toLowerCase()).includes(e),o=t.includes(r)||t.includes(i)||t.includes(s);return n&&o}function yHe(t,e){return t&&U0e(z0e(t,e))}function Qwe(t){let{url:e}=t;if(!e)return{url:e};e=z0e(e,t.logger);const r=Co(e),i=Ix(r.path);let s;if(i!=null)i.sublayer!=null&&t.layer.layerId==null&&(s=i.sublayer),e=i.url.path;else if(t.nonStandardUrlAllowed){const n=gHe(r.path);n!=null&&(e=n.serviceUrl,s=n.sublayerId)}return{url:U0e(e),layerId:s}}function Kwe(t,e,r,i,s){uv(e,i,"url",s),i.url&&t.layerId!=null&&(i.url=Fc(i.url,r,t.layerId.toString()))}function t6t(t){if(!t)return!1;const e=t.toLowerCase(),r=e.includes("/services/"),i=e.includes("/mapserver/wmsserver"),s=e.includes("/imageserver/wmsserver"),n=e.includes("/wmsserver");return r&&(i||s||n)}function r6t(t,e,r){const i=exe(t),s=e,n=_He(i,s,r);if(i){const o=Ax.deriveUnitFromSR(i,t.spatialReference).heightUnit;if(!r&&o!==i.heightUnit){const a=new U("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o});return new U("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:i,error:a})}}if(!vHe(t)||n===gc.Unsupported)return new U("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:i});switch(n){case gc.Units:{const o=i?.heightUnit||"unknown",a=s?.heightUnit||"unknown",l=new U("layerview:incompatible-height-unit",`The vertical units of the layer (${o}) must match the vertical units of the scene (${a})`,{layerUnit:o,sceneUnit:a});return new U("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:s,error:l})}case gc.HeightModel:{const o=i?.heightModel||"unknown",a=s?.heightModel||"unknown",l=new U("layerview:incompatible-height-model",`The height model of the layer (${o}) must match the height model of the scene (${a})`,{layerHeightModel:o,sceneHeightModel:a});return new U("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:s,error:l})}case gc.CRS:{const o=i?.vertCRS||"unknown",a=s?.vertCRS||"unknown",l=new U("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${o}) must match the vertical datum of the scene (${a})`,{layerDatum:o,sceneDatum:a});return new U("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:s,error:l})}}return null}function _He(t,e,r){if(!zse(t)||!zse(e))return gc.Unsupported;if(t==null||e==null)return gc.Ok;if(!r&&t.heightUnit!==e.heightUnit)return gc.Units;if(t.heightModel!==e.heightModel)return gc.HeightModel;switch(t.heightModel){case"gravity-related-height":return gc.Ok;case"ellipsoidal":return t.vertCRS===e.vertCRS?gc.Ok:gc.CRS;default:return gc.Unsupported}}var gc;function zse(t){return t==null||t.heightModel!=null&&t.heightUnit!=null}function vHe(t){return"heightModelInfo"in t&&t.heightModelInfo!=null||t.spatialReference!=null||!ixe(t)}function exe(t){const e=t.url?Ix(t.url):void 0;return!(t.spatialReference?.vcsWkid==null&&e!=null&&e.serverType==="ImageServer")&&txe(t)&&t.heightModelInfo?t.heightModelInfo:ixe(t)?Ax.deriveUnitFromSR(wHe,t.spatialReference):null}function txe(t){return"heightModelInfo"in t}function rxe(t){if(t.type==="unknown"||!("capabilities"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function ixe(t){return rxe(t)?!!(t.capabilities&&t.capabilities.data&&t.capabilities.data.supportsZ):sxe(t)}function bHe(t){return t.layers!=null||sxe(t)||rxe(t)||txe(t)}function sxe(t){switch(t.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(t){t[t.Ok=0]="Ok",t[t.Units=1]="Units",t[t.HeightModel=2]="HeightModel",t[t.CRS=3]="CRS",t[t.Unsupported=4]="Unsupported"})(gc||(gc={}));const wHe=new Ax({heightModel:"gravity-related-height"});var Ve;function Vse(t){return t==="global"?Ve.Global:Ve.Local}function ak(t){return t===Ve.Global?"global":"local"}(function(t){t[t.Global=1]="Global",t[t.Local=2]="Local"})(Ve||(Ve={}));let Cj,lk=null;async function xHe(t){lk||(lk=he(()=>Promise.resolve().then(()=>Hft),void 0,import.meta.url).then(e=>Cj=e)),await lk,Yt(t)}async function nxe(t,e,r,i){if(!t)return null;const s=t.spatialReference;return b8()||gm(s,e)?Ox(t,e):Cj?Cj.projectGeometry(t,e,r,i):(await Promise.race([xHe(i),gM(i)]),nxe(t,e,r,i))}let Vi=class extends Te{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=zl(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return this.userSpatialReference!=null?this.userSpatialReference:this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return this.userSpatialReference==null||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){const e=this.map?.(),r=[];return this.priorityCollection!=null&&r.push(this.priorityCollection),r.push({parent:e?.basemap,layers:e?.basemap?.baseLayers},{layers:e?.layers},{parent:e?.ground,layers:e?.ground?.layers},{parent:e?.basemap,layers:e?.basemap?.referenceLayers}),r}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};const{layers:e,updating:r}=this._allLayers;let i=null;for(const n of e){const o=this._getSupportedSpatialReferences(n);if(o.length>0){const a=this._narrowDownSpatialReferenceCandidates(i,o);a!=null&&(i=a)}if(i!=null&&i.length===1)break}if(r&&(i==null||i.length!==1))return{updating:!0};const s=this._pickSpatialReferenceCandidate(i);return{spatialReference:s!=null?s.spatialReference:null,viewingMode:s!=null?s.viewingMode:null,updating:!1}}get _tileInfoTask(){if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:r}=this._collectLayers([{parent:this.map?.()?.basemap,layers:this.map?.()?.basemap?.baseLayers},{layers:this.map?.()?.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const i=e[0].tileInfo;return{tileInfo:i&&i.spatialReference.equals(this.spatialReference)?i:null,updating:!1}}return{updating:r}}get _heightModelInfoTask(){if(!this.required.heightModelInfo||this.suspended&&this._get("_heightModelInfoTask")?.heightModelInfo)return this._get("_heightModelInfoTask")??{updating:!1};const{layers:e,updating:r}=this._allLayers;for(const i of e)if(bHe(i)){const s=exe(i);if(s)return{heightModelInfo:s,vcsWkid:i.spatialReference?.vcsWkid,latestVcsWkid:i.spatialReference?.latestVcsWkid,updating:!1}}return{updating:r}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,r=e.updating,i=[];for(const s of e.layers){const n="fullExtents"in s&&s.fullExtents||(s.fullExtent!=null?[s.fullExtent]:[]),o=this.requiresExtentInSpatialReference?null:n[0],a=n.find(l=>l.spatialReference.equals(this.spatialReference))??o;if(a)return{candidates:[{extent:a,layer:s}],updating:!1};if(this._getSupportedSpatialReferences(s).length>0)for(const l of n)i.push({extent:l,layer:s})}return{candidates:i,updating:r}}get _extentTask(){const{candidates:e,updating:r}=this._extentCandidatesTask;if(r)return{updating:r};if(e==null||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const i=this._pickExtentCandidate(e),s=this.spatialReference;return i.extent.equals(this._projectExtentTask.input)&&s.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:this._projectExtentTask.task!=null&&!this._projectExtentTask.task.finished}:(this._projectExtentTask.task!=null&&(this._projectExtentTask.task=zl(this._projectExtentTask.task)),this._projectExtentTask={input:i.extent.clone(),output:null,spatialReference:s.clone(),task:vC(async n=>{try{const o=await nxe(i.extent,s,"portalItem"in i.layer?i.layer.portalItem:void 0,n);this._projectExtentTask={...this._projectExtentTask,task:null,output:o}}catch{if(Mn(n))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,r){if(e==null)return r;const i=[],s=(n,o)=>n!=null?o!=null?n===o&&n:n:o;for(const n of e)for(const o of r){if(!n.spatialReference.equals(o.spatialReference))continue;const a=s(n.viewingMode,o.viewingMode);if(a!==!1){i.push({spatialReference:n.spatialReference,viewingMode:a});break}}return i.length>0?i:null}_pickSpatialReferenceCandidate(e){const r=this.defaultSpatialReference;return e==null||e.length<1?r!=null?{spatialReference:r,viewingMode:null}:null:(r!=null&&e.length>1&&e.some(({spatialReference:i})=>i.equals(r))&&(e=e.filter(({spatialReference:i})=>i.equals(r))),e.length>1&&e.some(({viewingMode:i})=>i!==Ve.Local)&&(e=e.filter(({viewingMode:i})=>i!==Ve.Local)),e[0])}_getSupportedSpatialReferences(e){const r="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(r.length===0)return[];const i=[];for(const s of r){const n=this.getSpatialReferenceSupport({spatialReference:s,layer:e});if(n!=null){const o=n.constraints!=null?n.constraints:[{spatialReference:s,viewingMode:null}];for(const{spatialReference:a,viewingMode:l}of o)this.requiresExtentInSpatialReference&&this.userSpatialReference!=null&&!a.equals(this.userSpatialReference)||i.push({spatialReference:a,viewingMode:l})}}return i}_pickExtentCandidate(e){const r=this.spatialReference;return e.find(({extent:i})=>r.equals(i.spatialReference))||e[0]}_collectLayers(e){if(this._loadMaybe(this.map?.())!=="loaded")return{layers:[],updating:!0};const r=new THe;for(const i of e)if(this._collectCollection(i,r),r.preloading===this.sourcePreloadCount)break;return{layers:r.layers,updating:r.updating}}_collectCollection(e,r){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return r.updating=!0,void++r.preloading;case"failed":return}for(const i of e.layers){switch(this._loadMaybe(i)){case"failed":continue;case"loading":r.updating=!0,++r.preloading;break;case"loaded":r.updating||r.layers.push(i),"layers"in i&&this._collectCollection({layers:i.layers},r)}if(r.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(r=>{ds(r)||console.log(r)}),"loading"):e.loadStatus:"loaded"}};u([p()],Vi.prototype,"required",void 0),u([p({constructOnly:!0})],Vi.prototype,"map",void 0),u([p({constructOnly:!0})],Vi.prototype,"getSpatialReferenceSupport",void 0),u([p()],Vi.prototype,"defaultSpatialReference",void 0),u([p()],Vi.prototype,"userSpatialReference",void 0),u([p()],Vi.prototype,"sourcePreloadCount",void 0),u([p()],Vi.prototype,"priorityCollection",void 0),u([p()],Vi.prototype,"requiresExtentInSpatialReference",void 0),u([p()],Vi.prototype,"suspended",void 0),u([p({readOnly:!0})],Vi.prototype,"ready",null),u([p({readOnly:!0})],Vi.prototype,"heightModelInfoReady",null),u([p({readOnly:!0})],Vi.prototype,"spatialReference",null),u([p({readOnly:!0})],Vi.prototype,"extent",null),u([p({readOnly:!0})],Vi.prototype,"heightModelInfo",null),u([p({readOnly:!0})],Vi.prototype,"vcsWkid",null),u([p({readOnly:!0})],Vi.prototype,"latestVcsWkid",null),u([p({readOnly:!0})],Vi.prototype,"viewingMode",null),u([p({readOnly:!0})],Vi.prototype,"tileInfo",null),u([p({readOnly:!0})],Vi.prototype,"mapCollections",null),u([p({readOnly:!0})],Vi.prototype,"_allLayers",null),u([p({readOnly:!0})],Vi.prototype,"_spatialReferenceTask",null),u([p({readOnly:!0})],Vi.prototype,"_tileInfoTask",null),u([p({readOnly:!0})],Vi.prototype,"_heightModelInfoTask",null),u([p({readOnly:!0})],Vi.prototype,"_extentCandidatesTask",null),u([p()],Vi.prototype,"_extentTask",null),u([p()],Vi.prototype,"_projectExtentTask",void 0),Vi=u([P("esri.views.support.DefaultsFromMap")],Vi);let THe=class{constructor(){this.layers=new Array,this.preloading=-1,this.updating=!1}};var QA;let It=QA=class extends m8(Ts.EventedMixin(B6(Te))){constructor(t){super(t),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new lM({getCollections:()=>[this.basemapView?.baseLayerViews,this.groundView?.layerViews,this.layerViews,this.basemapView?.referenceLayerViews],getChildrenFunction:EHe}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new _R,this.analyses=new PE,this.typeSpecificPreconditionsReady=!0,this.layerViews=new Pt,this.magnifier=new zwe,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.timeReference=new $E,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new pHe,this.navigation=new Wwe,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new sHe(this),this.persistableViewModels=new Pt,this._isValid=!1,this._readyCycleForced=!1,this._currentSpatialReference=null,this.handles.add(le(()=>this.preconditionsReady,e=>{e?(this._currentSpatialReference=this.spatialReference,QA.views.add(this)):(this._currentSpatialReference=null,QA.views.remove(this)),this.notifyChange("spatialReference"),!e&&this.ready?(this.toolViewManager?.detach(),this.analysisViewManager!=null&&this.analysisViewManager.detach(),this.layerViewManager?.clear(),this._teardown()):e&&!this.ready&&(this._startup(),this.analysisViewManager!=null&&this.analysisViewManager.attach(),this.toolViewManager.attach())},Wr))}initialize(){this.addResolvingPromise(this.validate().then(()=>(this._isValid=!0,d0(()=>this.ready)))),this.basemapView=new Wy({view:this}),this.layerViewManager=new Zje({view:this,layerViewImporter:{importLayerView:t=>this.importLayerView(t),hasLayerViewModule:t=>this.hasLayerViewModule(t)},supportsGround:this.supportsGround}),this.toolViewManager=new Md({view:this}),this._setupSpatialReferenceLogger(),this.handles.add([le(()=>this.initialExtentRequired,t=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:t},{sync:!0,initial:!0}),le(()=>this.ready,t=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=t,this.defaultsFromMap.userSpatialReference=t?this.spatialReference:this._userSpatialReference)},{sync:!0}),le(()=>this._userSpatialReference,t=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=t)},{sync:!0,initial:!0})])}_setupSpatialReferenceLogger(){let t=null;this.handles.add([le(()=>this.defaultsFromMap?.ready,e=>{const r=this.map?.allLayers.length>0;if(e&&!this.spatialReference&&r){if(t!=null)return;const i=nl(()=>t=zl(t));t=vC(async s=>{try{await uE(this.spatialReferenceWarningDelay,null,s)}catch{return}finally{t=null}K.getLogger(this).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.handles.add(i,"spatial-reference-logger-task")}else this.handles.remove("spatial-reference-logger-task")},{sync:!0})])}destroy(){this.destroyed||(QA.views.remove(this),this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=Ne(this.graphics),this.analyses=Ne(this.analyses),this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),Ne(this.analysisViewManager),this.toolViewManager=Ne(this.toolViewManager),this.layerViewManager=Ne(this.layerViewManager),this.basemapView=Ne(this.basemapView),this.groundView?.destroy(),this.layerViews?.forEach(t=>t.destroy()),this.layerViews.length=0,this.invalidate(),this._emitter.clear(),this.handles.removeAll(),this.map=Ne(this.map))}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return K.getLogger(this).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){return this.toolViewManager?.activeTool}set activeTool(t){this.toolViewManager&&(this.toolViewManager.activeTool=t)}get animation(){return this._get("animation")}set animation(t){this._set("animation",t)}get center(){return null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new Vi({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:t=>this.getSpatialReferenceSupport(t),...this._defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(t){this._set("extent",t)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||p0.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._currentSpatialReference&&!this.defaultsFromMap?.ready||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(t){t!==this._get("map")&&(t?.destroyed&&(K.getLogger(this).warn("#map","The provided map is already destroyed",{map:t}),t=null),p0.isLoadable(t)&&t.load().catch(()=>{}),this.constructed&&!this.destroyed&&(this.forceReadyCycle(),this._currentSpatialReference=null),this._set("map",t))}get spatialReference(){let t=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return t&&this.defaultsFromMap?.required?.heightModelInfo&&(t=t.clone(),t.vcsWkid=this.defaultsFromMap.vcsWkid,t.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),t}set spatialReference(t){const e=!Ln(t,this._get("spatialReference"));this._set("_userSpatialReference",t),e&&(this._set("spatialReference",t),this._spatialReferenceChanged(t))}_spatialReferenceChanged(t){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get tools(){return this.toolViewManager?.tools}get initialExtent(){return this.defaultsFromMap?.extent}get cursor(){const t=this.toolViewManager?this.toolViewManager.cursor:null;return t??(this._cursor||"default")}set cursor(t){this._cursor=t,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(t){return this.layerViewManager?.whenLayerView(t)??Promise.reject()}getDefaultSpatialReference(){return this.defaultsFromMap?.spatialReference}getDefaultHeightModelInfo(){return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??this.defaultsFromMap?.heightModelInfo??null}importLayerView(t){throw new U("importLayerView() not implemented")}hasLayerViewModule(t){return!1}async validate(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(t){return this.getSpatialReferenceSupport({spatialReference:t})!=null}when(t,e){return this.isResolved()&&!this.ready&&K.getLogger(this).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(t,e)}forceReadyCycle(){this.ready&&(Iu(()=>this.destroyed||this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(t){this.toolViewManager.tools.add(t),this.activeTool=t}tryFatalErrorRecovery(){this.fatalError=null}};It.views=new Pt,u([p()],It.prototype,"_userSpatialReference",void 0),u([p()],It.prototype,"activeTool",null),u([p({readOnly:!0})],It.prototype,"allLayerViews",void 0),u([p()],It.prototype,"groundView",void 0),u([p()],It.prototype,"animation",null),u([p()],It.prototype,"basemapView",void 0),u([p()],It.prototype,"center",null),u([p({readOnly:!0})],It.prototype,"_defaultsFromMapSettings",null),u([p()],It.prototype,"defaultsFromMap",null),u([p()],It.prototype,"fatalError",void 0),u([p({type:cr})],It.prototype,"extent",null),u([p(JG(_R,"graphics"))],It.prototype,"graphics",void 0),u([p(JG(PE,"analyses"))],It.prototype,"analyses",void 0),u([p({readOnly:!0,type:Ax})],It.prototype,"heightModelInfo",null),u([p({readOnly:!0})],It.prototype,"interacting",null),u([p({readOnly:!0})],It.prototype,"navigating",null),u([p({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],It.prototype,"preconditionsReady",null),u([p({readOnly:!0})],It.prototype,"typeSpecificPreconditionsReady",void 0),u([p({type:Pt,readOnly:!0})],It.prototype,"layerViews",void 0),u([p()],It.prototype,"resolution",null),u([p({type:zwe})],It.prototype,"magnifier",void 0),u([p({value:null,type:d_e})],It.prototype,"map",null),u([p()],It.prototype,"padding",void 0),u([p({readOnly:!0})],It.prototype,"ready",void 0),u([p({type:qe})],It.prototype,"spatialReference",null),u([p()],It.prototype,"spatialReferenceWarningDelay",void 0),u([p()],It.prototype,"stationary",null),u([p({readOnly:!0})],It.prototype,"supportsGround",void 0),u([p({type:Im})],It.prototype,"timeExtent",void 0),u([p({type:$E,nonNullable:!0})],It.prototype,"timeReference",void 0),u([p()],It.prototype,"tools",null),u([p()],It.prototype,"toolViewManager",void 0),u([p({readOnly:!0})],It.prototype,"type",void 0),u([p({type:Number})],It.prototype,"scale",void 0),u([p({readOnly:!0})],It.prototype,"updating",void 0),u([p({readOnly:!0})],It.prototype,"initialExtentRequired",void 0),u([p({readOnly:!0})],It.prototype,"initialExtent",null),u([p()],It.prototype,"cursor",null),u([p({readOnly:!0})],It.prototype,"input",void 0),u([p({type:Wwe,nonNullable:!0})],It.prototype,"navigation",void 0),u([p()],It.prototype,"layerViewManager",void 0),u([p()],It.prototype,"analysisViewManager",void 0),u([p()],It.prototype,"width",void 0),u([p()],It.prototype,"height",void 0),u([p({readOnly:!0})],It.prototype,"resizing",void 0),u([p({value:null,readOnly:!0})],It.prototype,"size",null),u([p({readOnly:!0})],It.prototype,"suspended",void 0),u([p({readOnly:!0})],It.prototype,"viewEvents",void 0),u([p({readOnly:!0})],It.prototype,"persistableViewModels",void 0),u([p()],It.prototype,"_isValid",void 0),u([p()],It.prototype,"_readyCycleForced",void 0),u([p()],It.prototype,"_currentSpatialReference",void 0),It=QA=u([P("esri.views.View")],It);const SHe=It;function EHe(t){return t.layerViews}let Yy=class extends J4{constructor(e){super(e),this.state="running",this.target=null,this._resolver=null}initialize(){this._resolver=Eo(),this.addResolvingPromise(this._resolver.promise)}get done(){return this.state==="finished"||this.state==="stopped"}stop(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),this._resolver?.reject(new U("ViewAnimation stopped")))}finish(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),this._resolver?.resolve())}update(e,r){r||(r=ku(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",r)}};u([p({readOnly:!0})],Yy.prototype,"done",null),u([p({readOnly:!0,type:String})],Yy.prototype,"state",void 0),u([p()],Yy.prototype,"target",void 0),Yy=u([P("esri.views.ViewAnimation")],Yy),function(t){t.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(Yy||(Yy={}));const DE=Yy,f3=()=>he(()=>import("./TileLayerView3D-b281058c.js"),["./TileLayerView3D-b281058c.js","./LayerView3D-10a2ef73.js","./TiledLayerView3D-57972ae6.js","./LayerView-ec7266a0.js","./RefreshableLayerView-a3a03c2d.js","./MapServiceLayerViewHelper-67163187.js","./floorFilterUtils-73949d2d.js","./normalizeUtils-ca47990d.js","./normalizeUtilsCommon-448ddeb2.js","./sublayerUtils-06c5a733.js","./drapedUtils-2e9fefe5.js"],import.meta.url),Bse=()=>he(()=>import("./ElevationLayerView3D-70aa604a.js"),["./ElevationLayerView3D-70aa604a.js","./LayerView3D-10a2ef73.js","./TiledLayerView3D-57972ae6.js","./LayerView-ec7266a0.js"],import.meta.url),Gse={"base-dynamic":()=>he(()=>import("./BaseDynamicLayerView3D-b5fcb602.js"),["./BaseDynamicLayerView3D-b5fcb602.js","./DynamicLayerView3D-6d83bbe6.js","./LayerView3D-10a2ef73.js","./projectExtentUtils-4e67eae2.js","./ImageMaterial-f381f1e6.js","./LayerView-ec7266a0.js","./RefreshableLayerView-a3a03c2d.js"],import.meta.url),"base-elevation":Bse,"base-tile":f3,"bing-maps":f3,"building-scene":()=>he(()=>import("./BuildingSceneLayerView3D-da0b06e6.js"),["./BuildingSceneLayerView3D-da0b06e6.js","./BuildingGroupSublayer-743ed90e.js","./BuildingComponentSublayer-29ebb457.js","./WhereClause-fb3d85c4.js","./executionError-e8d36121.js","./I3SMeshView3D-e17144a9.js","./I3SOverrides-8589fc40.js","./I3SNode-b8898742.js","./meshFeatureSet-9d8f7444.js","./MeshGeoreferencedRelativeVertexSpace-0d2c6219.js","./MeshLocalVertexSpace-243c3bcc.js","./georeference-9b495fe0.js","./External-17ec106a.js","./FeatureLayerView3D-70619285.js","./FeatureLayerViewBase3D-91156a31.js","./FeatureLikeLayerView3D-9cb1cee8.js","./dehydratedFeatureComparison-9908f9d9.js","./queryForSymbologySnapping-3f152c5f.js","./elevationInfoUtils-92bce67b.js","./hash-6f442295.js","./Graphics3DObjectStates-119da5ff.js","./optimizedFeatureQueryEngineAdapter-a3b2ad14.js","./centroid-3dcadaf5.js","./PooledRBush-f65c099f.js","./quickselect-89073317.js","./floorFilterUtils-73949d2d.js","./QueryEngine-9560ee9b.js","./normalizeUtils-ca47990d.js","./normalizeUtilsCommon-448ddeb2.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-86593ea2.js","./generateRendererUtils-455ff246.js","./FeatureStore-9e22cc1d.js","./BoundsStore-8a888707.js","./projectExtentUtils-4e67eae2.js","./LayerView3D-10a2ef73.js","./query-f938b96a.js","./pbfQueryUtils-4859e776.js","./pbf-482f6762.js","./EventedSet-b5ac1dc6.js","./LayerView-ec7266a0.js","./RefreshableLayerView-a3a03c2d.js","./SceneModification-4a6d4ad5.js","./SceneLayerWorker-f0abbfb0.js","./I3SQueryFeatureStore-36c26d35.js","./DefinitionExpressionSceneLayerView-d2d16da1.js"],import.meta.url),csv:()=>he(()=>import("./CSVLayerView3D-e07e35ff.js"),["./CSVLayerView3D-e07e35ff.js","./FeatureLayerViewBase3D-91156a31.js","./FeatureLikeLayerView3D-9cb1cee8.js","./dehydratedFeatureComparison-9908f9d9.js","./queryForSymbologySnapping-3f152c5f.js","./elevationInfoUtils-92bce67b.js","./hash-6f442295.js","./Graphics3DObjectStates-119da5ff.js","./optimizedFeatureQueryEngineAdapter-a3b2ad14.js","./centroid-3dcadaf5.js","./PooledRBush-f65c099f.js","./quickselect-89073317.js","./floorFilterUtils-73949d2d.js","./QueryEngine-9560ee9b.js","./normalizeUtils-ca47990d.js","./normalizeUtilsCommon-448ddeb2.js","./WhereClause-fb3d85c4.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-86593ea2.js","./generateRendererUtils-455ff246.js","./FeatureStore-9e22cc1d.js","./BoundsStore-8a888707.js","./projectExtentUtils-4e67eae2.js","./LayerView3D-10a2ef73.js","./query-f938b96a.js","./pbfQueryUtils-4859e776.js","./pbf-482f6762.js","./EventedSet-b5ac1dc6.js","./LayerView-ec7266a0.js","./RefreshableLayerView-a3a03c2d.js"],import.meta.url),dimension:()=>he(()=>import("./DimensionLayerView3D-d808c43e.js"),["./DimensionLayerView3D-d808c43e.js","./LayerView3D-10a2ef73.js","./LayerView-ec7266a0.js"],import.meta.url),elevation:Bse,feature:()=>he(()=>import("./FeatureLayerView3D-70619285.js"),["./FeatureLayerView3D-70619285.js","./FeatureLayerViewBase3D-91156a31.js","./FeatureLikeLayerView3D-9cb1cee8.js","./dehydratedFeatureComparison-9908f9d9.js","./queryForSymbologySnapping-3f152c5f.js","./elevationInfoUtils-92bce67b.js","./hash-6f442295.js","./Graphics3DObjectStates-119da5ff.js","./optimizedFeatureQueryEngineAdapter-a3b2ad14.js","./centroid-3dcadaf5.js","./PooledRBush-f65c099f.js","./quickselect-89073317.js","./floorFilterUtils-73949d2d.js","./QueryEngine-9560ee9b.js","./normalizeUtils-ca47990d.js","./normalizeUtilsCommon-448ddeb2.js","./WhereClause-fb3d85c4.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-86593ea2.js","./generateRendererUtils-455ff246.js","./FeatureStore-9e22cc1d.js","./BoundsStore-8a888707.js","./projectExtentUtils-4e67eae2.js","./LayerView3D-10a2ef73.js","./query-f938b96a.js","./pbfQueryUtils-4859e776.js","./pbf-482f6762.js","./EventedSet-b5ac1dc6.js","./LayerView-ec7266a0.js","./RefreshableLayerView-a3a03c2d.js"],import.meta.url),geojson:()=>he(()=>import("./GeoJSONLayerView3D-3fd3cfa1.js"),["./GeoJSONLayerView3D-3fd3cfa1.js","./FeatureLayerViewBase3D-91156a31.js","./FeatureLikeLayerView3D-9cb1cee8.js","./dehydratedFeatureComparison-9908f9d9.js","./queryForSymbologySnapping-3f152c5f.js","./elevationInfoUtils-92bce67b.js","./hash-6f442295.js","./Graphics3DObjectStates-119da5ff.js","./optimizedFeatureQueryEngineAdapter-a3b2ad14.js","./centroid-3dcadaf5.js","./PooledRBush-f65c099f.js","./quickselect-89073317.js","./floorFilterUtils-73949d2d.js","./QueryEngine-9560ee9b.js","./normalizeUtils-ca47990d.js","./normalizeUtilsCommon-448ddeb2.js","./WhereClause-fb3d85c4.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-86593ea2.js","./generateRendererUtils-455ff246.js","./FeatureStore-9e22cc1d.js","./BoundsStore-8a888707.js","./projectExtentUtils-4e67eae2.js","./LayerView3D-10a2ef73.js","./query-f938b96a.js","./pbfQueryUtils-4859e776.js","./pbf-482f6762.js","./EventedSet-b5ac1dc6.js","./LayerView-ec7266a0.js","./RefreshableLayerView-a3a03c2d.js"],import.meta.url),graphics:()=>he(()=>import("./GraphicsLayerView3D-89a54810.js"),["./GraphicsLayerView3D-89a54810.js","./LayerView3D-10a2ef73.js","./queryForSymbologySnapping-3f152c5f.js","./elevationInfoUtils-92bce67b.js","./GraphicsProcessor-5f16deec.js","./Graphics3DObjectStates-119da5ff.js","./optimizedFeatureQueryEngineAdapter-a3b2ad14.js","./centroid-3dcadaf5.js","./PooledRBush-f65c099f.js","./quickselect-89073317.js","./projectExtentUtils-4e67eae2.js","./LayerView-ec7266a0.js"],import.meta.url),group:()=>he(()=>import("./GroupLayerView-09debde7.js"),["./GroupLayerView-09debde7.js","./LayerView-ec7266a0.js"],import.meta.url),imagery:()=>he(()=>import("./ImageryLayerView3D-90bd62f1.js"),["./ImageryLayerView3D-90bd62f1.js","./DynamicLayerView3D-6d83bbe6.js","./LayerView3D-10a2ef73.js","./projectExtentUtils-4e67eae2.js","./ImageMaterial-f381f1e6.js","./LayerView-ec7266a0.js","./RefreshableLayerView-a3a03c2d.js"],import.meta.url),"integrated-mesh":()=>he(()=>import("./IntegratedMeshLayerView3D-258e4317.js"),["./IntegratedMeshLayerView3D-258e4317.js","./I3SMeshView3D-e17144a9.js","./I3SOverrides-8589fc40.js","./I3SNode-b8898742.js","./meshFeatureSet-9d8f7444.js","./MeshGeoreferencedRelativeVertexSpace-0d2c6219.js","./MeshLocalVertexSpace-243c3bcc.js","./georeference-9b495fe0.js","./External-17ec106a.js","./FeatureLayerView3D-70619285.js","./FeatureLayerViewBase3D-91156a31.js","./FeatureLikeLayerView3D-9cb1cee8.js","./dehydratedFeatureComparison-9908f9d9.js","./queryForSymbologySnapping-3f152c5f.js","./elevationInfoUtils-92bce67b.js","./hash-6f442295.js","./Graphics3DObjectStates-119da5ff.js","./optimizedFeatureQueryEngineAdapter-a3b2ad14.js","./centroid-3dcadaf5.js","./PooledRBush-f65c099f.js","./quickselect-89073317.js","./floorFilterUtils-73949d2d.js","./QueryEngine-9560ee9b.js","./normalizeUtils-ca47990d.js","./normalizeUtilsCommon-448ddeb2.js","./WhereClause-fb3d85c4.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-86593ea2.js","./generateRendererUtils-455ff246.js","./FeatureStore-9e22cc1d.js","./BoundsStore-8a888707.js","./projectExtentUtils-4e67eae2.js","./LayerView3D-10a2ef73.js","./query-f938b96a.js","./pbfQueryUtils-4859e776.js","./pbf-482f6762.js","./EventedSet-b5ac1dc6.js","./LayerView-ec7266a0.js","./RefreshableLayerView-a3a03c2d.js","./SceneModification-4a6d4ad5.js","./SceneLayerWorker-f0abbfb0.js"],import.meta.url),"line-of-sight":()=>he(()=>import("./LineOfSightLayerView3D-6cfe2c78.js"),["./LineOfSightLayerView3D-6cfe2c78.js","./LayerView3D-10a2ef73.js","./LayerView-ec7266a0.js"],import.meta.url),"map-image":()=>he(()=>import("./MapImageLayerView3D-6945e18d.js"),["./MapImageLayerView3D-6945e18d.js","./DynamicLayerView3D-6d83bbe6.js","./LayerView3D-10a2ef73.js","./projectExtentUtils-4e67eae2.js","./ImageMaterial-f381f1e6.js","./LayerView-ec7266a0.js","./RefreshableLayerView-a3a03c2d.js","./ExportImageParameters-6851dcda.js","./floorFilterUtils-73949d2d.js","./sublayerUtils-06c5a733.js","./MapServiceLayerViewHelper-67163187.js","./normalizeUtils-ca47990d.js","./normalizeUtilsCommon-448ddeb2.js","./drapedUtils-2e9fefe5.js"],import.meta.url),media:()=>he(()=>import("./MediaLayerView3D-f7f96ecb.js"),["./MediaLayerView3D-f7f96ecb.js","./MediaElementView-03016e93.js","./normalizeUtilsSync-a418a23d.js","./normalizeUtilsCommon-448ddeb2.js","./LayerView3D-10a2ef73.js","./ImageMaterial-f381f1e6.js","./LayerView-ec7266a0.js"],import.meta.url),"ogc-feature":()=>he(()=>import("./OGCFeatureLayerView3D-aceb309b.js"),["./OGCFeatureLayerView3D-aceb309b.js","./FeatureLayerViewBase3D-91156a31.js","./FeatureLikeLayerView3D-9cb1cee8.js","./dehydratedFeatureComparison-9908f9d9.js","./queryForSymbologySnapping-3f152c5f.js","./elevationInfoUtils-92bce67b.js","./hash-6f442295.js","./Graphics3DObjectStates-119da5ff.js","./optimizedFeatureQueryEngineAdapter-a3b2ad14.js","./centroid-3dcadaf5.js","./PooledRBush-f65c099f.js","./quickselect-89073317.js","./floorFilterUtils-73949d2d.js","./QueryEngine-9560ee9b.js","./normalizeUtils-ca47990d.js","./normalizeUtilsCommon-448ddeb2.js","./WhereClause-fb3d85c4.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-86593ea2.js","./generateRendererUtils-455ff246.js","./FeatureStore-9e22cc1d.js","./BoundsStore-8a888707.js","./projectExtentUtils-4e67eae2.js","./LayerView3D-10a2ef73.js","./query-f938b96a.js","./pbfQueryUtils-4859e776.js","./pbf-482f6762.js","./EventedSet-b5ac1dc6.js","./LayerView-ec7266a0.js","./RefreshableLayerView-a3a03c2d.js"],import.meta.url),"open-street-map":f3,"oriented-imagery":()=>he(()=>import("./FeatureLayerView3D-70619285.js"),["./FeatureLayerView3D-70619285.js","./FeatureLayerViewBase3D-91156a31.js","./FeatureLikeLayerView3D-9cb1cee8.js","./dehydratedFeatureComparison-9908f9d9.js","./queryForSymbologySnapping-3f152c5f.js","./elevationInfoUtils-92bce67b.js","./hash-6f442295.js","./Graphics3DObjectStates-119da5ff.js","./optimizedFeatureQueryEngineAdapter-a3b2ad14.js","./centroid-3dcadaf5.js","./PooledRBush-f65c099f.js","./quickselect-89073317.js","./floorFilterUtils-73949d2d.js","./QueryEngine-9560ee9b.js","./normalizeUtils-ca47990d.js","./normalizeUtilsCommon-448ddeb2.js","./WhereClause-fb3d85c4.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-86593ea2.js","./generateRendererUtils-455ff246.js","./FeatureStore-9e22cc1d.js","./BoundsStore-8a888707.js","./projectExtentUtils-4e67eae2.js","./LayerView3D-10a2ef73.js","./query-f938b96a.js","./pbfQueryUtils-4859e776.js","./pbf-482f6762.js","./EventedSet-b5ac1dc6.js","./LayerView-ec7266a0.js","./RefreshableLayerView-a3a03c2d.js"],import.meta.url),"point-cloud":()=>he(()=>import("./PointCloudLayerView3D-ba375f07.js").then(t=>t.P),["./PointCloudLayerView3D-ba375f07.js","./LayerView3D-10a2ef73.js","./PointCloudWorkerUtil-274050f3.js","./PointCloudUniqueValueRenderer-4fd58f2f.js","./PopupSceneLayerView-3c5ceeb8.js","./LayerView-ec7266a0.js"],import.meta.url),voxel:()=>he(()=>import("./VoxelLayerView3D-049c0797.js"),["./VoxelLayerView3D-049c0797.js","./LayerView3D-10a2ef73.js","./PopupSceneLayerView-3c5ceeb8.js","./LayerView-ec7266a0.js"],import.meta.url),route:()=>he(()=>import("./RouteLayerView3D-4b542bc3.js"),["./RouteLayerView3D-4b542bc3.js","./Stop-c1fb94f9.js","./LayerView3D-10a2ef73.js","./GraphicsProcessor-5f16deec.js","./Graphics3DObjectStates-119da5ff.js","./optimizedFeatureQueryEngineAdapter-a3b2ad14.js","./centroid-3dcadaf5.js","./PooledRBush-f65c099f.js","./quickselect-89073317.js","./projectExtentUtils-4e67eae2.js","./EventedSet-b5ac1dc6.js","./LayerView-ec7266a0.js"],import.meta.url),scene:t=>t.profile==null||t.profile==="mesh-pyramids"?he(()=>import("./SceneLayerView3D-7f6f788e.js"),["./SceneLayerView3D-7f6f788e.js","./I3SOverrides-8589fc40.js","./I3SNode-b8898742.js","./meshFeatureSet-9d8f7444.js","./MeshGeoreferencedRelativeVertexSpace-0d2c6219.js","./MeshLocalVertexSpace-243c3bcc.js","./georeference-9b495fe0.js","./External-17ec106a.js","./FeatureLayerView3D-70619285.js","./FeatureLayerViewBase3D-91156a31.js","./FeatureLikeLayerView3D-9cb1cee8.js","./dehydratedFeatureComparison-9908f9d9.js","./queryForSymbologySnapping-3f152c5f.js","./elevationInfoUtils-92bce67b.js","./hash-6f442295.js","./Graphics3DObjectStates-119da5ff.js","./optimizedFeatureQueryEngineAdapter-a3b2ad14.js","./centroid-3dcadaf5.js","./PooledRBush-f65c099f.js","./quickselect-89073317.js","./floorFilterUtils-73949d2d.js","./QueryEngine-9560ee9b.js","./normalizeUtils-ca47990d.js","./normalizeUtilsCommon-448ddeb2.js","./WhereClause-fb3d85c4.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-86593ea2.js","./generateRendererUtils-455ff246.js","./FeatureStore-9e22cc1d.js","./BoundsStore-8a888707.js","./projectExtentUtils-4e67eae2.js","./LayerView3D-10a2ef73.js","./query-f938b96a.js","./pbfQueryUtils-4859e776.js","./pbf-482f6762.js","./EventedSet-b5ac1dc6.js","./LayerView-ec7266a0.js","./RefreshableLayerView-a3a03c2d.js","./I3SMeshView3D-e17144a9.js","./SceneModification-4a6d4ad5.js","./SceneLayerWorker-f0abbfb0.js","./SceneLayerView-fea46149.js","./DefinitionExpressionSceneLayerView-d2d16da1.js","./I3SQueryFeatureStore-36c26d35.js","./PopupSceneLayerView-3c5ceeb8.js"],import.meta.url):he(()=>import("./SceneLayerGraphicsView3D-fdcece3a.js"),["./SceneLayerGraphicsView3D-fdcece3a.js","./I3SOverrides-8589fc40.js","./I3SNode-b8898742.js","./meshFeatureSet-9d8f7444.js","./MeshGeoreferencedRelativeVertexSpace-0d2c6219.js","./MeshLocalVertexSpace-243c3bcc.js","./georeference-9b495fe0.js","./External-17ec106a.js","./FeatureLayerView3D-70619285.js","./FeatureLayerViewBase3D-91156a31.js","./FeatureLikeLayerView3D-9cb1cee8.js","./dehydratedFeatureComparison-9908f9d9.js","./queryForSymbologySnapping-3f152c5f.js","./elevationInfoUtils-92bce67b.js","./hash-6f442295.js","./Graphics3DObjectStates-119da5ff.js","./optimizedFeatureQueryEngineAdapter-a3b2ad14.js","./centroid-3dcadaf5.js","./PooledRBush-f65c099f.js","./quickselect-89073317.js","./floorFilterUtils-73949d2d.js","./QueryEngine-9560ee9b.js","./normalizeUtils-ca47990d.js","./normalizeUtilsCommon-448ddeb2.js","./WhereClause-fb3d85c4.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-86593ea2.js","./generateRendererUtils-455ff246.js","./FeatureStore-9e22cc1d.js","./BoundsStore-8a888707.js","./projectExtentUtils-4e67eae2.js","./LayerView3D-10a2ef73.js","./query-f938b96a.js","./pbfQueryUtils-4859e776.js","./pbf-482f6762.js","./EventedSet-b5ac1dc6.js","./LayerView-ec7266a0.js","./RefreshableLayerView-a3a03c2d.js","./SceneLayerView-fea46149.js","./DefinitionExpressionSceneLayerView-d2d16da1.js","./PopupSceneLayerView-3c5ceeb8.js"],import.meta.url),stream:()=>he(()=>import("./StreamLayerView3D-e77506b8.js"),["./StreamLayerView3D-e77506b8.js","./StreamFeatureManager-d534361d.js","./createConnection-8b92b0e5.js","./query-f938b96a.js","./normalizeUtils-ca47990d.js","./normalizeUtilsCommon-448ddeb2.js","./pbfQueryUtils-4859e776.js","./pbf-482f6762.js","./EventedSet-b5ac1dc6.js","./FeatureLikeLayerView3D-9cb1cee8.js","./dehydratedFeatureComparison-9908f9d9.js","./queryForSymbologySnapping-3f152c5f.js","./elevationInfoUtils-92bce67b.js","./hash-6f442295.js","./Graphics3DObjectStates-119da5ff.js","./optimizedFeatureQueryEngineAdapter-a3b2ad14.js","./centroid-3dcadaf5.js","./PooledRBush-f65c099f.js","./quickselect-89073317.js","./floorFilterUtils-73949d2d.js","./QueryEngine-9560ee9b.js","./WhereClause-fb3d85c4.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-86593ea2.js","./generateRendererUtils-455ff246.js","./FeatureStore-9e22cc1d.js","./BoundsStore-8a888707.js","./projectExtentUtils-4e67eae2.js","./LayerView3D-10a2ef73.js","./LayerView-ec7266a0.js"],import.meta.url),tile:f3,"imagery-tile":()=>he(()=>import("./ImageryTileLayerView3D-d6046e9b.js"),["./ImageryTileLayerView3D-d6046e9b.js","./LayerView3D-10a2ef73.js","./TiledLayerView3D-57972ae6.js","./rasterProjectionHelper-ff62d9df.js","./LayerView-ec7266a0.js","./RefreshableLayerView-a3a03c2d.js","./drapedUtils-2e9fefe5.js"],import.meta.url),"vector-tile":()=>he(()=>import("./VectorTileLayerView3D-0ec9524d.js"),["./VectorTileLayerView3D-0ec9524d.js","./Rect-98da58d6.js","./pbf-482f6762.js","./rasterizingUtils-be9923b0.js","./TileInfoView-ef81f3ea.js","./definitions-c3d21a38.js","./number-e491b09e.js","./GeometryUtils-0258f920.js","./StyleRepository-0a7b0dfa.js","./colorUtils-c0f43caf.js","./TileClipper-ae6eca9e.js","./LayerView3D-10a2ef73.js","./TiledLayerView3D-57972ae6.js","./LayerView-ec7266a0.js"],import.meta.url),wcs:()=>he(()=>import("./ImageryTileLayerView3D-d6046e9b.js"),["./ImageryTileLayerView3D-d6046e9b.js","./LayerView3D-10a2ef73.js","./TiledLayerView3D-57972ae6.js","./rasterProjectionHelper-ff62d9df.js","./LayerView-ec7266a0.js","./RefreshableLayerView-a3a03c2d.js","./drapedUtils-2e9fefe5.js"],import.meta.url),"web-tile":f3,wfs:()=>he(()=>import("./WFSLayerView3D-385112c8.js"),["./WFSLayerView3D-385112c8.js","./FeatureLayerViewBase3D-91156a31.js","./FeatureLikeLayerView3D-9cb1cee8.js","./dehydratedFeatureComparison-9908f9d9.js","./queryForSymbologySnapping-3f152c5f.js","./elevationInfoUtils-92bce67b.js","./hash-6f442295.js","./Graphics3DObjectStates-119da5ff.js","./optimizedFeatureQueryEngineAdapter-a3b2ad14.js","./centroid-3dcadaf5.js","./PooledRBush-f65c099f.js","./quickselect-89073317.js","./floorFilterUtils-73949d2d.js","./QueryEngine-9560ee9b.js","./normalizeUtils-ca47990d.js","./normalizeUtilsCommon-448ddeb2.js","./WhereClause-fb3d85c4.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-86593ea2.js","./generateRendererUtils-455ff246.js","./FeatureStore-9e22cc1d.js","./BoundsStore-8a888707.js","./projectExtentUtils-4e67eae2.js","./LayerView3D-10a2ef73.js","./query-f938b96a.js","./pbfQueryUtils-4859e776.js","./pbf-482f6762.js","./EventedSet-b5ac1dc6.js","./LayerView-ec7266a0.js","./RefreshableLayerView-a3a03c2d.js"],import.meta.url),wms:()=>he(()=>import("./WMSLayerView3D-cada2f1d.js"),["./WMSLayerView3D-cada2f1d.js","./DynamicLayerView3D-6d83bbe6.js","./LayerView3D-10a2ef73.js","./projectExtentUtils-4e67eae2.js","./ImageMaterial-f381f1e6.js","./LayerView-ec7266a0.js","./RefreshableLayerView-a3a03c2d.js","./ExportWMSImageParameters-4631554c.js"],import.meta.url),wmts:()=>he(()=>import("./WMTSLayerView3D-834f279a.js"),["./WMTSLayerView3D-834f279a.js","./LayerView3D-10a2ef73.js","./TiledLayerView3D-57972ae6.js","./LayerView-ec7266a0.js","./RefreshableLayerView-a3a03c2d.js"],import.meta.url),"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null,video:null};function CHe(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",r=e.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new U(`${r}:view-not-supported`,`${e} is not supported in 3D`)}const jse={hasLayerViewModule:t=>Gse[t.type]!=null,importLayerView:t=>{const e=Gse[t.type];if(e==null)throw CHe(t);return e(t)}},Hse="analyses-owner-handles";var hS,zb;(function(t){t[t.PENDING=0]="PENDING",t[t.CREATED=1]="CREATED"})(hS||(hS={})),function(t){t[t.ADDED=0]="ADDED",t[t.REMOVED=1]="REMOVED"}(zb||(zb={}));let K1=class extends mM{constructor(e){super(e),this._allAnalysisViews=new Pt,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=qse(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(zr("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(zr()),this._attachedToViewResolver=qse()}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const r=this._items.get(e);if(r==null||r.state.list===zb.REMOVED)throw new U("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return r.createAnalysisViewTask.promise}_connectOwners(){this.handles.add(this._connectAnalysesCollection(this.view.analyses),Hse)}_disconnectOwners(){this.handles.remove(Hse),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const s of e)this._addAnalysis(s);const r=e.on("after-add",s=>this._addAnalysis(s.item)),i=e.on("after-remove",s=>this._removeAnalysis(s.item));return{remove:()=>{r.remove(),i.remove();for(const s of e)this._removeAnalysis(s)}}}_addAnalysis(e){const r=this._items.get(e);if(r==null){const i={state:{view:hS.PENDING,list:zb.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,i),i.createAnalysisViewTask=vC(s=>this._createAnalysisViewPromise(i,s))}else r.state.list=zb.ADDED}_removeAnalysis(e){const r=this._items.get(e);r!=null?(r.state.list=zb.REMOVED,this._scheduleUpdate()):K.getLogger(this).error("Trying to remove analysis which was not added")}_scheduleUpdate(){this._scheduledUpdateHandle==null&&(this._scheduledUpdateHandle=gC(()=>this._update()))}_update(){this._scheduledUpdateHandle=Fi(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===zb.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case hS.PENDING:e.createAnalysisViewTask=zl(e.createAnalysisViewTask);break;case hS.CREATED:e.view!=null&&(this._allAnalysisViews.remove(e.view),e.view=Ne(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,r){const i=e.analysis,s=i.type,n=this._analysisModules[s];if(this._creatingViewCount+=1,n.module==null)try{n.module=await this._loadAnalysisModule(s)}catch(a){throw this._creatingViewCount-=1,a}if(Mn(r))throw this._creatingViewCount-=1,zr("AnalysisView creation aborted");const o=new n.module.default({analysis:i,view:this.view});try{await o.when()}catch(a){throw this._creatingViewCount-=1,a}if(Mn(r))throw this._creatingViewCount-=1,o.destroy(),zr("AnalysisView creation aborted");return e.view=o,e.state.view=hS.CREATED,this._allAnalysisViews.add(o),this._creatingViewCount-=1,o}_loadAnalysisModule(e){switch(e){case"area-measurement":return he(()=>import("./AreaMeasurementAnalysisView3D-be0d4d7a.js").then(r=>r.A),["./AreaMeasurementAnalysisView3D-be0d4d7a.js","./UnitNormalizer-e86420c5.js","./Segment-67ac1711.js","./unitFormatUtils-7dfe0559.js","./LineVisualElement-ba997fc6.js","./elevationInfoUtils-92bce67b.js","./geometryEngine-cbc6d5c4.js","./geometryEngineBase-eaaafef1.js","./hydrated-613da623.js","./EditGeometryOperations-304f923b.js"],import.meta.url);case"dimension":return he(()=>import("./DimensionAnalysisView3D-c04330bf.js").then(r=>r.D),["./DimensionAnalysisView3D-c04330bf.js","./LineVisualElement-ba997fc6.js","./LengthDimension-49a4cbc2.js","./Segment-67ac1711.js","./unitFormatUtils-7dfe0559.js","./elevationInfoUtils-92bce67b.js","./analysisViewUtils-ee698129.js","./ImageMaterial-f381f1e6.js","./Factory-ce49f342.js","./RightAngleQuadVisualElement-fb8e074d.js","./VisualElementResources-37c38039.js","./PointVisualElement-04ad3e7c.js","./EditGeometryOperations-304f923b.js","./dehydratedFeatureComparison-9908f9d9.js"],import.meta.url);case"direct-line-measurement":return he(()=>import("./DirectLineMeasurementAnalysisView3D-77b7ed22.js").then(r=>r.D),["./DirectLineMeasurementAnalysisView3D-77b7ed22.js","./UnitNormalizer-e86420c5.js","./Segment-67ac1711.js","./unitFormatUtils-7dfe0559.js","./LineVisualElement-ba997fc6.js","./elevationInfoUtils-92bce67b.js","./geometryEngine-cbc6d5c4.js","./geometryEngineBase-eaaafef1.js","./hydrated-613da623.js","./RightAngleQuadVisualElement-fb8e074d.js","./VisualElementResources-37c38039.js"],import.meta.url);case"line-of-sight":return he(()=>import("./LineOfSightAnalysisView3D-ad94c8ee.js"),["./LineOfSightAnalysisView3D-ad94c8ee.js","./LineVisualElement-ba997fc6.js","./LineOfSightAnalysisTarget-19f41b15.js","./elevationInfoUtils-92bce67b.js","./analysisViewUtils-ee698129.js","./ImageMaterial-f381f1e6.js","./PointVisualElement-04ad3e7c.js","./VisualElementResources-37c38039.js"],import.meta.url);case"slice":return he(()=>import("./SliceAnalysisView3D-a6088b18.js").then(r=>r.S),["./SliceAnalysisView3D-a6088b18.js","./LineVisualElement-ba997fc6.js","./BuildingComponentSublayer-29ebb457.js","./analysisViewUtils-ee698129.js","./ImageMaterial-f381f1e6.js","./Factory-ce49f342.js"],import.meta.url)}}};function qse(){const t=Eo();return t.promise.catch(()=>{}),t}u([p()],K1.prototype,"updating",null),u([p({constructOnly:!0})],K1.prototype,"view",void 0),u([p()],K1.prototype,"_allAnalysisViews",void 0),u([p()],K1.prototype,"_creatingViewCount",void 0),K1=u([P("esri.views.3d.analysis.AnalysisViewManager3D")],K1);const AHe=K1;let mg=class extends Te{constructor(e){super(e),this.collision=new KA,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===Ve.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==Ve.Local?this._set("altitude",e):K.getLogger(this).warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?ve(e,this.altitude.min,this.altitude.max):e}clampTilt(e,r){if(!this.tilt)return r;const i=this.tilt(e);return ve(r,i.min,i.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===Ve.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(r,i=ck)=>(i.min=ko.min,i.max=e,i)}_createDefaultTiltLocal(){const e=this.collision.enabled?dN([[4e3,ko.max],[1e4,Ft(88)],[6e6,Ft(88)]]):()=>ko.max;return(r,i=ck)=>(i.min=ko.min,i.max=e(r),i)}_createDefaultTiltGlobal(){const e=this.collision.enabled?dN([[4e3,ko.max],[5e4,Ft(88)],[6e6,Ft(88)],[2e7,ko.min]]):dN([[3e5,ko.max],[3e6,Ft(88)],[6e6,Ft(88)],[2e7,ko.min]]);return(r,i=ck)=>(i.min=ko.min,i.max=e(r),i)}};function OHe(t){return{min:-2e5,max:4*t.radius}}u([p()],mg.prototype,"altitude",null),u([p({readOnly:!0})],mg.prototype,"collision",void 0),u([p()],mg.prototype,"distance",void 0),u([p({readOnly:!0})],mg.prototype,"minimumPoiDistance",void 0),u([p()],mg.prototype,"tilt",void 0),u([p({constructOnly:!0})],mg.prototype,"mode",void 0),mg=u([P("esri.views.3d.state.Constraints")],mg);const Wse=OHe(nr),ko={min:Ft(.5),max:Ft(179.5)},ck={min:0,max:0};let KA=class extends Te{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};u([p({type:Boolean})],KA.prototype,"enabled",void 0),u([p({type:Number})],KA.prototype,"elevationMargin",void 0),KA=u([P("esri.views.3d.state.Constraints.CollisionConstraint")],KA);let dS=class extends Te{constructor(){super(...arguments),this.min=Wse.min,this.max=Wse.max}};u([p({type:Number})],dS.prototype,"min",void 0),u([p({type:Number})],dS.prototype,"max",void 0),dS=u([P("esri.views.3d.constraints.AltitudeConstraint")],dS);let Ig=class extends Te{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,r){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==r&&this._set("far",r))}};u([p({type:Number,value:1e-8})],Ig.prototype,"near",null),u([wr("near")],Ig.prototype,"castNear",null),u([p({type:Number,value:1e-8})],Ig.prototype,"far",null),u([wr("far")],Ig.prototype,"castFar",null),u([p({type:["auto","manual"]})],Ig.prototype,"mode",void 0),Ig=u([P("esri.views.3d.constraints.ClipDistanceConstraint")],Ig);const Aj={min:al(ko.min),max:al(ko.max)};let Vb=class extends Te{constructor(){super(...arguments),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return ve(e,Aj.min,Aj.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};u([p({type:["auto","manual"]})],Vb.prototype,"mode",void 0),u([p({type:Number,value:Aj.max})],Vb.prototype,"max",null),u([wr("max")],Vb.prototype,"castMax",null),Vb=u([P("esri.views.3d.constraints.TiltConstraint")],Vb);let Bb=class extends Te{constructor(){super(...arguments),this.tilt=new Vb,this.altitude=new dS,this.clipDistance=new Ig}};u([p({type:Vb})],Bb.prototype,"tilt",void 0),u([p({type:dS})],Bb.prototype,"altitude",void 0),u([p({type:Ig})],Bb.prototype,"clipDistance",void 0),Bb=u([P("esri.views.3d.constraints.Constraints")],Bb);var Oj;let lh=Oj=class extends ue{constructor(t){super(t),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(t,e){return e.datetime!=null&&new Date(e.datetime)||null}writeDate(t,e,r){e[r]=t.getTime()}readDirectShadowsEnabled(t,e){return!!e.directShadows}writedirectShadowsEnabled(t,e,r){t&&(e[r]=t)}writeDisplayUTCOffset(t,e){t!=null&&(e.displayUTCOffset=t)}clone(){return new Oj(this.cloneConstructProperties())}cloneConstructProperties(){const t={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(t.date=new Date(this.date.getTime())),t}};u([p({readOnly:!0,type:["sun"],json:{write:!0}})],lh.prototype,"type",void 0),u([p({type:Date,json:{type:Number,write:{target:"datetime"}}})],lh.prototype,"date",void 0),u([Oe("date",["datetime"])],lh.prototype,"readDate",null),u([Be("date")],lh.prototype,"writeDate",null),u([p({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],lh.prototype,"directShadowsEnabled",void 0),u([Oe("directShadowsEnabled",["directShadows"])],lh.prototype,"readDirectShadowsEnabled",null),u([Be("directShadowsEnabled")],lh.prototype,"writedirectShadowsEnabled",null),u([p({type:Number,json:{write:!0}})],lh.prototype,"displayUTCOffset",void 0),u([Be("displayUTCOffset")],lh.prototype,"writeDisplayUTCOffset",null),lh=Oj=u([P("esri.webscene.SunLighting")],lh);const xM=lh;var y2;const oxe="esri.views.3d.environment.SunLighting",ZI=K.getLogger(oxe);let wf=y2=class extends Ts.EventedMixin(xM){constructor(t){super(t),this.cameraTrackingEnabled=!0,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const e=new Date().getFullYear(),r=new Date("March 15, "+e+" 12:00:00 UTC");this._set("defaultDate",r),this._set("date",r)}get ambientOcclusionEnabled(){return cp(ZI,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(t){cp(ZI,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._set("ambientOcclusionEnabled",t)}get waterReflectionEnabled(){return cp(ZI,"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"}),this._get("waterReflectionEnabled")??!1}set waterReflectionEnabled(t){cp(ZI,"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"}),this._set("waterReflectionEnabled",t)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(t){return new y2(t.cloneConstructProperties())}set defaultDate(t){const e=this._get("date")===this._get("defaultDate");t=new Date(t.getTime()),this._set("defaultDate",t),e&&this._set("date",t)}set date(t){t!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(t.getTime())))}autoUpdate(t,e){const r=y2.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=e.hours,this.positionTimezoneInfo.minutes=e.minutes,this.positionTimezoneInfo.seconds=e.seconds;let i=null;t!=null&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(t.getTime())?(i=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(i=this.date&&this.date.getTime(),this._set("date",new Date(t.getTime()))));const s=y2.calculateTimezoneOffset(this.positionTimezoneInfo);if(r!==s&&(JI.target=this,JI.timezoneOffset=s,this.emit("timezone-will-change",JI),JI.target=null),t!=null)return isNaN(t.getTime())||i!==t.getTime()}clone(){const t=this._get("date")===this._get("defaultDate"),e=new y2({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled});return t&&e._set("date",e._get("defaultDate")),e.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,e.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,e.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,e.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,e}cloneWithWebsceneLighting(t){const e=this.clone();return t.date!=null&&(e.date=t.date),e.directShadowsEnabled=t.directShadowsEnabled,e.displayUTCOffset=t.displayUTCOffset,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};u([p({type:Boolean})],wf.prototype,"cameraTrackingEnabled",void 0),u([p({type:Boolean})],wf.prototype,"ambientOcclusionEnabled",null),u([p({type:Boolean})],wf.prototype,"waterReflectionEnabled",null),u([p({type:Date})],wf.prototype,"defaultDate",null),u([p({type:Date})],wf.prototype,"date",null),wf=y2=u([P(oxe)],wf),function(t){function e({hours:r,minutes:i,seconds:s}){return Math.round(r+i/60+s/3600)}t.calculateTimezoneOffset=e}(wf||(wf={}));const JI={target:null,timezoneOffset:0},Zy=wf;var Rj;let eO=Rj=class extends ue{constructor(t){super(t),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new Rj(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};u([p({readOnly:!0,type:["virtual"],json:{write:!0}})],eO.prototype,"type",void 0),u([p({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],eO.prototype,"directShadowsEnabled",void 0),eO=Rj=u([P("esri.webscene.VirtualLighting")],eO);const N8=eO;var yN;const axe="esri.views.3d.environment.VirtualLighting",QI=K.getLogger(axe);let _2=yN=class extends Ts.EventedMixin(N8){constructor(t){super(t),this.cameraTrackingEnabled=!0}get ambientOcclusionEnabled(){return cp(QI,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(t){cp(QI,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._set("ambientOcclusionEnabled",t)}get waterReflectionEnabled(){return cp(QI,"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"}),this._get("waterReflectionEnabled")??!1}set waterReflectionEnabled(t){cp(QI,"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"}),this._set("waterReflectionEnabled",t)}clone(){return new yN({...this.cloneConstructProperties(),cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(t){return new yN(t.cloneConstructProperties())}cloneWithWebsceneLighting(t){const e=this.clone();return e.directShadowsEnabled=t.directShadowsEnabled,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};u([p({type:Boolean})],_2.prototype,"ambientOcclusionEnabled",null),u([p({type:Boolean})],_2.prototype,"waterReflectionEnabled",null),u([p({type:Boolean})],_2.prototype,"cameraTrackingEnabled",void 0),_2=yN=u([P(axe)],_2);const tO=_2,RHe={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:Zy,virtual:tO}};var Mj;let vR=Mj=class extends Te{set quality(t){["low","high"].includes(t)&&this._set("quality",t)}clone(){return new Mj({quality:this.quality})}};u([p({type:["low","high"],value:"low"})],vR.prototype,"quality",null),vR=Mj=u([P("esri.views.3d.environment.SceneViewAtmosphere")],vR);var Pj;let rO=Pj=class extends ue{constructor(t){super(t),this.type="sunny",this.cloudCover=.5}clone(){return new Pj({cloudCover:this.cloudCover})}};u([nt({sunny:"sunny"})],rO.prototype,"type",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],rO.prototype,"cloudCover",void 0),rO=Pj=u([P("esri.views.3d.environment.SunnyWeather")],rO);const Ij=rO;var $j;let iO=$j=class extends ue{constructor(t){super(t),this.type="cloudy",this.cloudCover=.5}clone(){return new $j({cloudCover:this.cloudCover})}};u([nt({cloudy:"cloudy"})],iO.prototype,"type",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],iO.prototype,"cloudCover",void 0),iO=$j=u([P("esri.views.3d.environment.CloudyWeather")],iO);const MHe=iO;var Lj;let sO=Lj=class extends ue{constructor(t){super(t),this.type="foggy",this.fogStrength=.5}clone(){return new Lj({fogStrength:this.fogStrength})}};u([nt({foggy:"foggy"})],sO.prototype,"type",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],sO.prototype,"fogStrength",void 0),sO=Lj=u([P("esri.views.3d.environment.FoggyWeather")],sO);const PHe=sO;var Dj;let v2=Dj=class extends ue{constructor(t){super(t),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new Dj({cloudCover:this.cloudCover,precipitation:this.precipitation})}};u([nt({rainy:"rainy"})],v2.prototype,"type",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],v2.prototype,"cloudCover",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],v2.prototype,"precipitation",void 0),v2=Dj=u([P("esri.views.3d.environment.RainyWeather")],v2);const IHe=v2;var Nj;let eb=Nj=class extends ue{constructor(t){super(t),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new Nj({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};u([nt({snowy:"snowy"})],eb.prototype,"type",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],eb.prototype,"cloudCover",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],eb.prototype,"precipitation",void 0),u([p({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],eb.prototype,"snowCover",void 0),eb=Nj=u([P("esri.views.3d.environment.SnowyWeather")],eb);const $He=eb,lxe={key:"type",base:Ij,typeMap:{sunny:Ij,cloudy:MHe,rainy:IHe,snowy:$He,foggy:PHe}},LHe=Object.keys(lxe.typeMap);function DHe(t,e){return!!LHe.includes(t)||(e.error(`"${t}" is not a valid weather type`),!1)}const Df=1e4,NHe={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:xM,virtual:N8}};let _N=class extends ue{constructor(e){super(e)}clone(){}};u([p({readOnly:!0,json:{read:!1}})],_N.prototype,"type",void 0),_N=u([P("esri.webscene.background.Background")],_N);const cxe=_N;var Fj;const FHe={...R0,nonNullable:!0};let nO=Fj=class extends cxe{constructor(t){super(t),this.type="color",this.color=new ke([0,0,0,1])}clone(){return new Fj(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};u([nt({color:"color"},{readOnly:!0})],nO.prototype,"type",void 0),u([p(FHe)],nO.prototype,"color",void 0),nO=Fj=u([P("esri.webscene.background.ColorBackground")],nO);const uxe=nO,Xse={base:cxe,key:"type",typeMap:{color:uxe}};function UHe(t){return(e,r,i)=>{if(!e)return e;for(const s in t.typeMap)if(e.type===s){const n=new t.typeMap[s];return n.read(e,i),n}}}const kHe={types:Xse,json:{read:UHe(Xse),write:{overridePolicy:(t,e,r)=>({enabled:!r||!r.isPresentation})}}};var Uj;const hxe="esri.webscene.Environment",zHe=K.getLogger(hxe),Yse=(t,e,r)=>({enabled:!r||!r.isPresentation});let Jy=Uj=class extends ue{constructor(t){super(t),this.lighting=new xM,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(t){DHe(t?.type,zHe)&&this._set("weather",t)}clone(){return new Uj(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?N8.prototype.clone.call(this.lighting):xM.prototype.clone.call(this.lighting),background:ee(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};u([p({types:NHe,nonNullable:!0,json:{write:!0}})],Jy.prototype,"lighting",void 0),u([p(kHe)],Jy.prototype,"background",void 0),u([p({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:Yse}}})],Jy.prototype,"atmosphereEnabled",void 0),u([p({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:Yse}}})],Jy.prototype,"starsEnabled",void 0),u([p({types:lxe,nonNullable:!0,json:{write:!0},value:new Ij})],Jy.prototype,"weather",null),Jy=Uj=u([P(hxe)],Jy);const dxe=Jy;var oO;let b2=oO=class extends dxe{constructor(t){super(t),this.atmosphere=new vR,this.lighting=new Zy,this.cachedCameraTrackingEnabled=null}static fromWebsceneEnvironment(t){const e=t.cloneConstructProperties();return new oO({...e,lighting:e.lighting?e.lighting.type==="virtual"?tO.fromWebsceneLighting(e.lighting):Zy.fromWebsceneLighting(e.lighting):void 0})}castLighting(t){return this._convertLighting(t)}applyLighting(t){this.lighting=this._convertLighting(t)}_convertLighting(t){return t?t instanceof Zy||t instanceof tO?t:t instanceof xM?this.lighting&&this.lighting.type!=="virtual"?this.lighting.cloneWithWebsceneLighting(t):new Zy({...t.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):t instanceof N8?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t):new tO({...t.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):Ap(RHe,t):new Zy}clone(){return new oO({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:ee(this.background)})}cloneWithWebsceneEnvironment(t){return new oO({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:ee(this.background),...t.cloneConstructProperties(),lighting:this._getLighting(t)})}_getLighting(t){switch(t.lighting.type){case"sun":return this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(t.lighting):Zy.fromWebsceneLighting(t.lighting);case"virtual":return this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t.lighting):tO.fromWebsceneLighting(t.lighting);default:return t.lighting,Zy.fromWebsceneLighting(t.lighting)}}};u([p({type:vR,json:{read:!1},nonNullable:!0})],b2.prototype,"atmosphere",void 0),u([p({nonNullable:!0})],b2.prototype,"lighting",void 0),u([wr("lighting")],b2.prototype,"castLighting",null),b2=oO=u([P("esri.views.3d.environment.SceneViewEnvironment")],b2);const w2=b2;var aa;(function(t){t[t.Realistic=0]="Realistic",t[t.Local=1]="Local",t[t.Mars=2]="Mars",t[t.None=3]="None"})(aa||(aa={}));function yn(t,e){return t[0]=e[0],t[1]=e[1],t}function or(t,e,r){return t[0]=e,t[1]=r,t}function Qd(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function zf(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function BJ(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function pxe(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function VHe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function BHe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function GHe(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t}function jHe(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t}function HHe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function Sc(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function qHe(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t}function Hw(t,e){const r=e[0]-t[0],i=e[1]-t[1];return Math.sqrt(r*r+i*i)}function N5(t,e){const r=e[0]-t[0],i=e[1]-t[1];return r*r+i*i}function GJ(t){const e=t[0],r=t[1];return Math.sqrt(e*e+r*r)}function fxe(t){const e=t[0],r=t[1];return e*e+r*r}function jJ(t,e){return t[0]=-e[0],t[1]=-e[1],t}function mxe(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function TM(t,e){const r=e[0],i=e[1];let s=r*r+i*i;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s),t}function on(t,e){return t[0]*e[0]+t[1]*e[1]}function WHe(t,e,r){const i=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=i,t}function Ah(t,e,r,i){const s=e[0],n=e[1];return t[0]=s+i*(r[0]-s),t[1]=n+i*(r[1]-n),t}function XHe(t,e){e=e||1;const r=2*fP()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t}function gxe(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[2]*s,t[1]=r[1]*i+r[3]*s,t}function tb(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[2]*s+r[4],t[1]=r[1]*i+r[3]*s+r[5],t}function YHe(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[3]*s+r[6],t[1]=r[1]*i+r[4]*s+r[7],t}function ZHe(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[4]*s+r[12],t[1]=r[1]*i+r[5]*s+r[13],t}function JHe(t,e,r,i){const s=e[0]-r[0],n=e[1]-r[1],o=Math.sin(i),a=Math.cos(i);return t[0]=s*a-n*o+r[0],t[1]=s*o+n*a+r[1],t}function QHe(t,e){const r=t[0],i=t[1],s=e[0],n=e[1];let o=r*r+i*i;o>0&&(o=1/Math.sqrt(o));let a=s*s+n*n;a>0&&(a=1/Math.sqrt(a));const l=(r*s+i*n)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function KHe(t){return"vec2("+t[0]+", "+t[1]+")"}function yxe(t,e){return t[0]===e[0]&&t[1]===e[1]}function _xe(t,e){const r=t[0],i=t[1],s=e[0],n=e[1],o=cl();return Math.abs(r-s)<=o*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-n)<=o*Math.max(1,Math.abs(i),Math.abs(n))}function eqe(t,e,r,i,s){let n=e[0]-r[0],o=e[1]-r[1];const a=(i[0]*n+i[1]*o)*(s-1);return n=i[0]*a,o=i[1]*a,t[0]=e[0]+n,t[1]=e[1]+o,t}const tqe=GJ,vxe=zf,rqe=BJ,iqe=pxe,bxe=Hw,sqe=N5,nqe=fxe;Object.freeze(Object.defineProperty({__proto__:null,add:Qd,angle:QHe,ceil:VHe,copy:yn,cross:WHe,dist:bxe,distance:Hw,div:iqe,divide:pxe,dot:on,equals:_xe,exactEquals:yxe,floor:BHe,inverse:mxe,len:tqe,length:GJ,lerp:Ah,max:jHe,min:GHe,mul:rqe,multiply:BJ,negate:jJ,normalize:TM,projectAndScale:eqe,random:XHe,rotate:JHe,round:HHe,scale:Sc,scaleAndAdd:qHe,set:or,sqrDist:sqe,sqrLen:nqe,squaredDistance:N5,squaredLength:fxe,str:KHe,sub:vxe,subtract:zf,transformMat2:gxe,transformMat2d:tb,transformMat3:YHe,transformMat4:ZHe},Symbol.toStringTag,{value:"Module"}));function HJ(t){return ve((t-1e5)/(1e6-1e5),0,1)}const kj=1e4,oqe=.085,m_=1e5;let aqe=class{};const ii=aqe;function w(t,...e){let r="";for(let i=0;i<e.length;i++)r+=t[i]+e[i];return r+=t[t.length-1],r}(function(t){function e(i){return Math.round(i).toString()}function r(i){return i.toPrecision(8)}t.int=e,t.float=r})(w||(w={}));var C;(function(t){t.POSITION="position",t.NORMAL="normal",t.NORMALCOMPRESSED="normalCompressed",t.UV0="uv0",t.AUXPOS1="auxpos1",t.AUXPOS2="auxpos2",t.COLOR="color",t.SYMBOLCOLOR="symbolColor",t.SIZE="size",t.TANGENT="tangent",t.OFFSET="offset",t.SUBDIVISIONFACTOR="subdivisionFactor",t.COLORFEATUREATTRIBUTE="colorFeatureAttribute",t.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",t.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",t.DISTANCETOSTART="distanceToStart",t.UVMAPSPACE="uvMapSpace",t.BOUNDINGRECT="boundingRect",t.UVREGION="uvRegion",t.PROFILERIGHT="profileRight",t.PROFILEUP="profileUp",t.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",t.FEATUREVALUE="featureValue",t.MODELORIGINHI="modelOriginHi",t.MODELORIGINLO="modelOriginLo",t.MODEL="model",t.MODELNORMAL="modelNormal",t.INSTANCECOLOR="instanceColor",t.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",t.LOCALTRANSFORM="localTransform",t.GLOBALTRANSFORM="globalTransform",t.BOUNDINGSPHERE="boundingSphere",t.MODELORIGIN="modelOrigin",t.MODELSCALEFACTORS="modelScaleFactors",t.FEATUREATTRIBUTE="featureAttribute",t.STATE="state",t.LODLEVEL="lodLevel",t.POSITION0="position0",t.POSITION1="position1",t.NORMALA="normalA",t.NORMALB="normalB",t.COMPONENTINDEX="componentIndex",t.VARIANTOFFSET="variantOffset",t.VARIANTSTROKE="variantStroke",t.VARIANTEXTENSION="variantExtension",t.U8PADDING="u8padding",t.U16PADDING="u16padding",t.SIDENESS="sideness",t.START="start",t.END="end",t.UP="up",t.EXTRUDE="extrude",t.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",t.INSTANCEOBJECTANDLAYERIDCOLOR="instanceObjectAndLayerIdColor"})(C||(C={}));var Fs;function sm(t,e){switch(e.textureCoordinateType){case Fs.Default:return t.attributes.add(C.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(w`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case Fs.Compressed:return t.attributes.add(C.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(w`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case Fs.Atlas:return t.attributes.add(C.UV0,"vec2"),t.varyings.add("vuv0","vec2"),t.attributes.add(C.UVREGION,"vec4"),t.varyings.add("vuvRegion","vec4"),void t.vertex.code.add(w`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:e.textureCoordinateType;case Fs.None:return void t.vertex.code.add(w`void forwardTextureCoordinates() {}`);case Fs.COUNT:return}}(function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Atlas=2]="Atlas",t[t.Compressed=3]="Compressed",t[t.COUNT=4]="COUNT"})(Fs||(Fs={}));function Bc(t){t.code.add(w`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}function Nu(t){t.include(Bc),t.code.add(w`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture(depthTex, uv)), nearFar);
}`)}function F8(t){t.fragment.code.add(w`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var ti;(function(t){t[t.Pass=0]="Pass",t[t.Draw=1]="Draw"})(ti||(ti={}));let ps=class{constructor(e,r,i,s,n=null){this.name=e,this.type=r,this.arraySize=n,this.bind={[ti.Pass]:null,[ti.Draw]:null},i!=null&&s!=null&&(this.bind[i]=s)}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}},kt=class extends ps{constructor(e,r){super(e,"vec3",ti.Pass,(i,s,n)=>i.setUniform3fv(e,r(s,n)))}};function I0(t){t.uniforms.add(new kt("mainLightDirection",(e,r)=>r.lighting.mainLight.direction))}function $m(t){t.uniforms.add(new kt("mainLightIntensity",(e,r)=>r.lighting.mainLight.intensity))}function F5(t){I0(t.fragment),$m(t.fragment),t.fragment.code.add(w`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)}let Ar=class extends ps{constructor(e,r){super(e,"vec2",ti.Pass,(i,s,n)=>i.setUniform2fv(e,r(s,n)))}},sr=class extends ps{constructor(e,r){super(e,"vec4",ti.Pass,(i,s,n)=>i.setUniform4fv(e,r(s,n)))}},Ie=class extends ps{constructor(e,r){super(e,"float",ti.Pass,(i,s,n)=>i.setUniform1f(e,r(s,n)))}},Ui=class extends ps{constructor(e,r){super(e,"mat4",ti.Pass,(i,s,n)=>i.setUniformMatrix4fv(e,r(s,n)))}};const Ra=Wt();let lqe=class{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}};function ot(t,e){if(!t){e=e||"Assertion";const r=new Error(e).stack;throw new lqe(`${e} at ${r}`)}}function Jx(t,e){t||(e=e||"",console.warn("Verify failed: "+e+`
`+new Error("verify").stack))}function Zse(t,e,r,i){let s,n=(r[0]-t[0])/e[0],o=(i[0]-t[0])/e[0];n>o&&(s=n,n=o,o=s);let a=(r[1]-t[1])/e[1],l=(i[1]-t[1])/e[1];if(a>l&&(s=a,a=l,l=s),n>l||a>o)return!1;a>n&&(n=a),l<o&&(o=l);let c=(r[2]-t[2])/e[2],h=(i[2]-t[2])/e[2];return c>h&&(s=c,c=h,h=s),!(n>h||c>o)&&(h<o&&(o=h),!(o<0))}function KI(t,e,r,i,s,n=He()){const o=(i[s]-r[s])*(e[0]-t[0])-(i[0]-r[0])*(e[s]-t[s]),a=(i[0]-r[0])*(t[s]-r[s])-(i[s]-r[s])*(t[0]-r[0]);if(o===0)return!1;const l=a/o;return n[0]=t[0]+l*(e[0]-t[0]),n[1]=t[s]+l*(e[s]-t[s]),!0}function Jse(t,e,r,i,s){Ra[0]=t[0],Ra[1]=t[1],Ra[2]=t[2],Ra[3]=1,xu(Ra,Ra,e),s.length>2&&(s[2]=-Ra[2]),xu(Ra,Ra,r),ot(Ra[3]!==0),s[0]=Ra[0]/Ra[3],s[1]=Ra[1]/Ra[3],s[2]=Ra[2]/Ra[3],s[0]=(.5*s[0]+.5)*i[2]+i[0],s[1]=(.5*s[1]+.5)*i[3]+i[1]}function cqe(t,e){return Math.log(t)/Math.log(e)}function uqe(t,e,r,i){t[12]=e,t[13]=r,t[14]=i}function wxe(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[7]===0&&t[8]===0&&t[9]===0&&t[10]===1&&t[11]===0&&t[15]===1}const xxe=K.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");let Txe=class{constructor(){this._includedModules=new Map}include(e,r){if(this._includedModules.has(e)){const i=this._includedModules.get(e);if(i!==r){xxe.error("Trying to include shader module multiple times with different sets of options.");const s=new Set;for(const n of Object.keys(i))i[n]!==e[n]&&s.add(n);for(const n of Object.keys(e))i[n]!==e[n]&&s.add(n);s.forEach(n=>console.error(`  ${n}: current ${i[n]} new ${e[n]}`))}}else this._includedModules.set(e,r),e(this.builder,r)}},Sr=class extends Txe{constructor(){super(...arguments),this.vertex=new Qse,this.fragment=new Qse,this.attributes=new pqe,this.varyings=new fqe,this.extensions=new zj,this.constants=new Sxe}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e){const r=this.extensions.generateSource(e),i=this.attributes.generateSource(e),s=this.varyings.generateSource(e),n=e==="vertex"?this.vertex:this.fragment,o=n.uniforms.generateSource(),a=n.code.generateSource(),l=e==="vertex"?gqe:mqe,c=this.constants.generateSource().concat(n.constants.generateSource());return`#version 300 es
${r.join(`
`)}

${l}

${c.join(`
`)}

${o.join(`
`)}

${i.join(`
`)}

${s.join(`
`)}

${a.join(`
`)}`}generateBind(e,r){const i=new Map;this.vertex.uniforms.entries.forEach(o=>{const a=o.bind[e];a!=null&&i.set(o.name,a)}),this.fragment.uniforms.entries.forEach(o=>{const a=o.bind[e];a!=null&&i.set(o.name,a)});const s=Array.from(i.values()),n=s.length;return(o,a,l)=>{for(let c=0;c<n;++c)s[c](r,o,a,l)}}},hqe=class{constructor(){this._entries=new Map}add(...e){for(const r of e)this._add(r)}get(e){return this._entries.get(e)}_add(e){if(e!=null){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new U(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}else xxe.error(`Trying to add null Uniform from ${new Error().stack}.`)}generateSource(){return Array.from(this._entries.values()).map(e=>e.arraySize!=null?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`)}get entries(){return Array.from(this._entries.values())}},dqe=class{constructor(){this._entries=new Array}add(e){this._entries.push(e)}generateSource(){return this._entries}},Qse=class extends Txe{constructor(){super(...arguments),this.uniforms=new hqe,this.code=new dqe,this.constants=new Sxe}get builder(){return this}},pqe=class{constructor(){this._entries=new Array}add(e,r){this._entries.push([e,r])}generateSource(e){return e==="fragment"?[]:this._entries.map(r=>`in ${r[1]} ${r[0]};`)}},fqe=class{constructor(){this._entries=new Map}add(e,r){this._entries.has(e)&&ot(this._entries.get(e)===r),this._entries.set(e,r)}generateSource(e){const r=new Array;return this._entries.forEach((i,s)=>r.push(e==="vertex"?`out ${i} ${s};`:`in ${i} ${s};`)),r}},zj=class Vj{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const r=e==="vertex"?Vj.ALLOWLIST_VERTEX:Vj.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(i=>r.includes(i)).map(i=>`#extension ${i} : enable`)}};zj.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],zj.ALLOWLIST_VERTEX=[];let Sxe=class rn{constructor(){this._entries=new Set}add(e,r,i){let s="ERROR_CONSTRUCTOR_STRING";switch(r){case"float":s=rn._numberToFloatStr(i);break;case"int":s=rn._numberToIntStr(i);break;case"bool":s=i.toString();break;case"vec2":s=`vec2(${rn._numberToFloatStr(i[0])},                            ${rn._numberToFloatStr(i[1])})`;break;case"vec3":s=`vec3(${rn._numberToFloatStr(i[0])},                            ${rn._numberToFloatStr(i[1])},                            ${rn._numberToFloatStr(i[2])})`;break;case"vec4":s=`vec4(${rn._numberToFloatStr(i[0])},                            ${rn._numberToFloatStr(i[1])},                            ${rn._numberToFloatStr(i[2])},                            ${rn._numberToFloatStr(i[3])})`;break;case"ivec2":s=`ivec2(${rn._numberToIntStr(i[0])},                             ${rn._numberToIntStr(i[1])})`;break;case"ivec3":s=`ivec3(${rn._numberToIntStr(i[0])},                             ${rn._numberToIntStr(i[1])},                             ${rn._numberToIntStr(i[2])})`;break;case"ivec4":s=`ivec4(${rn._numberToIntStr(i[0])},                             ${rn._numberToIntStr(i[1])},                             ${rn._numberToIntStr(i[2])},                             ${rn._numberToIntStr(i[3])})`;break;case"mat2":case"mat3":case"mat4":s=`${r}(${Array.prototype.map.call(i,n=>rn._numberToFloatStr(n)).join(", ")})`}return this._entries.add(`const ${r} ${e} = ${s};`),this}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}};const mqe=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif

out vec4 fragColor;`,gqe=`precision highp float;
precision highp sampler2D;`;let rt=class extends ps{constructor(e,r){super(e,"sampler2D",ti.Pass,(i,s,n)=>i.bindTexture(e,r(s,n)))}};const bR=Pe(parseFloat(5802e-9.toFixed(6)),parseFloat(13558e-9.toFixed(6)),parseFloat(331e-7.toFixed(6))),uk=3,hk=Pe(uk*parseFloat(65e-8.toFixed(6)),uk*parseFloat(1881e-9.toFixed(6)),uk*parseFloat(85e-9.toFixed(6))),yqe=3996e-9,_qe=Pe(parseFloat(Number(bR[0]+hk[0]).toFixed(6)),parseFloat(Number(bR[1]+hk[1]).toFixed(6)),parseFloat(Number(bR[2]+hk[2]).toFixed(6)));function vqe(t){const e=new Sr;e.attributes.add(C.POSITION,"vec2"),e.include(sm,{textureCoordinateType:Fs.Default}),e.varyings.add("worldRay","vec3"),e.varyings.add("eyeDir","vec3");const{vertex:r,fragment:i}=e;return r.uniforms.add(new Ui("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new Ui("inverseViewMatrix",(s,n)=>OC(bqe,n.camera.viewMatrix))),r.code.add(w`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),i.uniforms.add(new kt("backgroundColor",s=>s.backgroundColor),new Ar("radii",s=>s.radii),new kt("cameraPosition",(s,n)=>n.camera.eye),new sr("heightParameters",s=>s.heightParameters),new Ie("innerFadeDistance",s=>s.innerFadeDistance),new Ie("altitudeFade",s=>s.altitudeFade),new rt("depthTexture",s=>s.depthTexture),new Ie("hazeStrength",s=>s.hazeStrength)),i.constants.add("betaRayleigh","vec3",bR),i.constants.add("betaCombined","vec3",_qe),i.constants.add("betaMie","float",yqe),i.constants.add("scaleHeight","float",oqe*m_),I0(i),e.include(F8),t.haze&&(i.include(Nu),i.uniforms.add(new Ar("nearFar",(s,n)=>n.camera.nearFar))),i.code.add(w`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),i.code.add(w`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),i.code.add(w`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),i.code.add(w`
    const int STEPS = 6;

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${t.haze?w`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${t.haze?"":w`mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * `} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${t.haze?"":w`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${t.haze?w`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:w`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    ${t.haze?"":w`
            vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
              vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
              if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
                return fragColor;
              }

              float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
              vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
              float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
              if (relDist > 1.0) {
                return surfaceColor;
              }

              return mix(fragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
            }

            float getGlow(float dist, float radius, float intensity) {
              return pow(radius / max(dist, 1e-6), intensity);
            }

            vec3 getSun(vec3 cameraPos, vec3 rayDir, vec3 lightDir){

              // Get the amount of atmosphere between camera and the Sun along the view ray
              float scaleFract = (length(cameraPos) - radii[0]) / scaleHeight;
              float sunOpticalDepth = getOpticalDepth(cameraPos, rayDir, max(scaleFract, 0.0));

              // Find the amount of light that remains after travelling through the atmosphere from the Sun along the view ray
              // This will make the colour of the Sun reddish on the horizon and white from space
              vec3 sunTransmittance = exp(-(mix(betaCombined, betaRayleigh, 0.5)) * max(0.0, sunOpticalDepth));

              // Alignment of light direction and view ray
              float mu = clamp(dot(rayDir, lightDir), 0.0, 1.0);
              // Draw the Sun as a bright disc
              float sunDisc = 256.0 * smoothstep(0.0, 128.0, clamp(getGlow(1.0 - mu, 3e-5, 3.0), 0.0, 128.0));

              return normalize(sunTransmittance) * sunDisc;
            }`}

    ${t.haze&&t.reduced?w`
        float getDepth(vec2 uv){
          return linearDepthFromTexture(depthTexture, uv, nearFar);
        }

        float textureBilinear(vec2 uv) {
          // Information about the high-resolution depth texture
          vec2 depthTextureSize = vec2(textureSize(depthTexture, 0));
          vec2 texelSize = 1.0 / depthTextureSize;

          // The uv inside the upper right pixel - of the tile of 4 pixels -
          // that the atmosphere uv maps to in the depth texture
          vec2 depthUV = (uv * depthTextureSize) - vec2(0.5);

          // Relative distance of the uv coordinates inside the depth texture pixel
          vec2 f = fract(depthUV);

          // Snap to the centre of the depth texture pixel
          vec2 snapUV = (floor(depthUV) + vec2(0.5)) / depthTextureSize;

          // Read the depth texture pixel and its three neighbours
          float d0 = getDepth(snapUV);
          float d1 = getDepth(snapUV + vec2(texelSize.x, 0.0));
          float d2 = getDepth(snapUV + vec2(0.0, texelSize.y));
          float d3 = getDepth(snapUV + texelSize);

          // Return the bilinearly interpolated value of the neighbouring pixels based
          // on the sample position in the depth texture pixel
          return mix(mix(d0, d1, f.x), mix(d2, d3, f.x), f.y);
        }
        `:""}

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${t.haze?w`
          vec4 depthSample = texture(depthTexture, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;

              ${t.reduced?w`cameraSpaceRay *= -textureBilinear(vuv0);`:w`cameraSpaceRay *= -linearDepthFromTexture(depthTexture, vuv0, nearFar);`}

            terrainDepth = max(0.0, length(cameraSpaceRay));
          }else{
            discard;
          }
          `:w`${t.reduced?"":w`
                float depthSample = texture(depthTexture, vuv0).r;
                if (depthSample != 1.0) {
                  fragColor = vec4(0);
                  return;
                }`}`}

      ${t.haze?w`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            // Alpha is ignored for haze blending
            float alpha = 1.0;
            `:w`
            vec3 col = linearizeGamma(backgroundColor);
            col += getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            col += getSun(cameraPosition, rayDir, mainLightDirection);
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
      ${t.haze?"":w`fragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, fragColor);`}
    }
  `),e}const bqe=xe(),wqe=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:bR,build:vqe},Symbol.toStringTag,{value:"Module"}));let Or=class{constructor(e,r){this._module=e,this._loadModule=r}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}};var Si,At,Se,vm,Tt,fp,NE,st,ri,bs,Rt,Dt,cs,Ct,Ke,qs,Zs,Cr,gu,yo;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(Si||(Si={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(At||(At={})),function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(Se||(Se={})),function(t){t[t.ADD=32774]="ADD",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.SUBTRACT=32778]="SUBTRACT",t[t.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(vm||(vm={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"}(Tt||(Tt={})),function(t){t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(fp||(fp={})),function(t){t[t.CW=2304]="CW",t[t.CCW=2305]="CCW"}(NE||(NE={})),function(t){t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT"}(st||(st={})),function(t){t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS"}(ri||(ri={})),function(t){t[t.ZERO=0]="ZERO",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP"}(bs||(bs={})),function(t){t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(Rt||(Rt={})),function(t){t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(Dt||(Dt={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(cs||(cs={})),function(t){t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.RED=6403]="RED",t[t.RG=33319]="RG",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER"}(Ct||(Ct={})),function(t){t[t.RGBA4=32854]="RGBA4",t[t.R16F=33325]="R16F",t[t.RG16F=33327]="RG16F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.R32F=33326]="R32F",t[t.RG32F=33328]="RG32F",t[t.RGBA32F=34836]="RGBA32F",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB5_A1=32855]="RGB5_A1",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.RGB16F=34843]="RGB16F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.RGB565=36194]="RGB565",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2=32857]="RGB10_A2",t[t.RGB10_A2UI=36975]="RGB10_A2UI"}(Ke||(Ke={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.INT=5124]="INT",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(qs||(qs={})),function(t){t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(Zs||(Zs={})),function(t){t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.STATIC_READ=35045]="STATIC_READ",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.STREAM_COPY=35042]="STREAM_COPY"}(Cr||(Cr={})),function(t){t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER"}(gu||(gu={})),function(t){t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(yo||(yo={}));const dk=33984;var In,lu;(function(t){t[t.Texture=0]="Texture",t[t.BufferObject=1]="BufferObject",t[t.VertexArrayObject=2]="VertexArrayObject",t[t.Shader=3]="Shader",t[t.Program=4]="Program",t[t.FramebufferObject=5]="FramebufferObject",t[t.Renderbuffer=6]="Renderbuffer",t[t.Sync=7]="Sync",t[t.COUNT=8]="COUNT"})(In||(In={})),function(t){t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(lu||(lu={}));const Kse=33306;var gs,ene,tne,rne,U5,Bj,ine;(function(t){t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(gs||(gs={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT=5124]="INT",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(ene||(ene={})),function(t){t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS"}(tne||(tne={})),function(t){t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED"}(rne||(rne={})),function(t){t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED"}(U5||(U5={})),function(t){t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(Bj||(Bj={})),function(t){t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(ine||(ine={}));let Lr=class{constructor(e,r,i){this.release=i,this.initializeConfiguration(e,r),this._configuration=r.snapshot(),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}destroy(){this._program=je(this._program),this._pipeline=this._configuration=null}reload(e){je(this._program),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.compiled}get key(){return this._configuration.key}get configuration(){return this._configuration}bindPipelineState(e,r=null,i){e.setPipelineState(this.getPipelineState(r,i))}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}get primitiveType(){return At.TRIANGLES}getPipelineState(e,r){return this._pipeline}initializeConfiguration(e,r){}};const Tr=new Map([[C.POSITION,0],[C.NORMAL,1],[C.NORMALCOMPRESSED,1],[C.UV0,2],[C.COLOR,3],[C.COLORFEATUREATTRIBUTE,3],[C.SIZE,4],[C.TANGENT,4],[C.AUXPOS1,5],[C.SYMBOLCOLOR,5],[C.AUXPOS2,6],[C.FEATUREATTRIBUTE,6],[C.INSTANCEFEATUREATTRIBUTE,6],[C.INSTANCECOLOR,7],[C.OBJECTANDLAYERIDCOLOR,7],[C.INSTANCEOBJECTANDLAYERIDCOLOR,7],[C.MODEL,8],[C.MODELNORMAL,12],[C.MODELORIGINHI,11],[C.MODELORIGINLO,15]]),xqe=K.getLogger("esri.views.webgl.checkWebGLError");function Tqe(t,e){switch(e){case t.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case t.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case t.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case t.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case t.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case t.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const Exe=!!ae("enable-feature:webgl-debug");function vh(){return Exe}function Gj(){return Exe}function S_(t){if(vh()){const e=t.getError();if(e){const r=Tqe(t,e),i=new Error().stack;xqe.error(new U("webgl-error","WebGL error occured",{message:r,stack:i}))}}}let Rr=class{constructor(e,r,i){this._context=e,this._locations=i,this._textures=new Map,this._freeTextureUnits=new Vt({deallocator:null}),this._glProgram=e.programCache.acquire(r.generate("vertex"),r.generate("fragment"),i),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=r.generateBind(ti.Pass,this),this.bindDraw=r.generateBind(ti.Draw,this),this._fragmentUniforms=vh()?r.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get compiled(){return this._glProgram.compiled}setUniform1b(e,r){this._glProgram.setUniform1i(e,r?1:0)}setUniform1i(e,r){this._glProgram.setUniform1i(e,r)}setUniform1f(e,r){this._glProgram.setUniform1f(e,r)}setUniform2fv(e,r){this._glProgram.setUniform2fv(e,r)}setUniform3fv(e,r){this._glProgram.setUniform3fv(e,r)}setUniform4fv(e,r){this._glProgram.setUniform4fv(e,r)}setUniformMatrix3fv(e,r){this._glProgram.setUniformMatrix3fv(e,r)}setUniformMatrix4fv(e,r){this._glProgram.setUniformMatrix4fv(e,r)}setUniform1fv(e,r){this._glProgram.setUniform1fv(e,r)}setUniform1iv(e,r){this._glProgram.setUniform1iv(e,r)}setUniform2iv(e,r){this._glProgram.setUniform3iv(e,r)}setUniform3iv(e,r){this._glProgram.setUniform3iv(e,r)}setUniform4iv(e,r){this._glProgram.setUniform4iv(e,r)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,r){if(r==null||r.glName==null){const s=this._textures.get(e);return s&&(this._context.bindTexture(null,s.unit),this._freeTextureUnit(s),this._textures.delete(e)),null}let i=this._textures.get(e);return i==null?(i=this._allocTextureUnit(r),this._textures.set(e,i)):i.texture=r,this._context.useProgram(this),this.setUniform1i(e,i.unit),this._context.bindTexture(r,i.unit),i.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((e,r)=>{this._context.bindTexture(e.texture,e.unit),this.setUniform1i(r,e.unit)}),this._fragmentUniforms!=null&&this._fragmentUniforms.forEach(e=>{e.type!=="sampler2D"&&e.type!=="samplerCube"||this._textures.has(e.name)||console.error(`Texture sampler ${e.name} has no bound texture`)})}_allocTextureUnit(e){return{texture:e,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}};var gi,qw,_s,Kg,Ul,T0,FE,Kr,Ww,e0;(function(t){t[t.None=0]="None",t[t.Front=1]="Front",t[t.Back=2]="Back",t[t.COUNT=3]="COUNT"})(gi||(gi={})),function(t){t[t.Less=0]="Less",t[t.Lequal=1]="Lequal",t[t.COUNT=2]="COUNT"}(qw||(qw={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.UPDATE=1]="UPDATE"}(_s||(_s={})),function(t){t[t.NOT_LOADED=0]="NOT_LOADED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"}(Kg||(Kg={})),function(t){t[t.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",t[t.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(Ul||(Ul={})),function(t){t[t.Highlight=0]="Highlight",t[t.MaskOccludee=1]="MaskOccludee",t[t.COUNT=2]="COUNT"}(T0||(T0={})),function(t){t[t.CHANGED=0]="CHANGED",t[t.UNCHANGED=1]="UNCHANGED"}(FE||(FE={})),function(t){t[t.Blend=0]="Blend",t[t.Opaque=1]="Opaque",t[t.Mask=2]="Mask",t[t.MaskBlend=3]="MaskBlend",t[t.COUNT=4]="COUNT"}(Kr||(Kr={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(Ww||(Ww={})),function(t){t.DDS_ENCODING="image/vnd-ms.dds",t.KTX2_ENCODING="image/ktx2",t.BASIS_ENCODING="image/x.basis"}(e0||(e0={}));function zc(t,e,r=vm.ADD,i=[0,0,0,0]){return{srcRgb:t,srcAlpha:t,dstRgb:e,dstAlpha:e,opRgb:r,opAlpha:r,color:{r:i[0],g:i[1],b:i[2],a:i[3]}}}function Oo(t,e,r,i,s=vm.ADD,n=vm.ADD,o=[0,0,0,0]){return{srcRgb:t,srcAlpha:e,dstRgb:r,dstAlpha:i,opRgb:s,opAlpha:n,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const qJ={face:fp.BACK,mode:NE.CCW},Cxe={face:fp.FRONT,mode:NE.CCW},U8=t=>t===gi.Back?qJ:t===gi.Front?Cxe:null,jl={zNear:0,zFar:1},Bt={r:!0,g:!0,b:!0,a:!0};function Sqe(t){return Iqe.intern(t)}function Eqe(t){return $qe.intern(t)}function Cqe(t){return Lqe.intern(t)}function Aqe(t){return Dqe.intern(t)}function Oqe(t){return Nqe.intern(t)}function Rqe(t){return Fqe.intern(t)}function Mqe(t){return Uqe.intern(t)}function Pqe(t){return kqe.intern(t)}function Mt(t){return zqe.intern(t)}let $0=class{constructor(e,r){this._makeKey=e,this._makeRef=r,this._interns=new Map}intern(e){if(!e)return null;const r=this._makeKey(e),i=this._interns;return i.has(r)||i.set(r,this._makeRef(e)),i.get(r)??null}};function L0(t){return"["+t.join(",")+"]"}const Iqe=new $0(Axe,t=>({__tag:"Blending",...t}));function Axe(t){return t?L0([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}const $qe=new $0(Oxe,t=>({__tag:"Culling",...t}));function Oxe(t){return t?L0([t.face,t.mode]):null}const Lqe=new $0(Rxe,t=>({__tag:"PolygonOffset",...t}));function Rxe(t){return t?L0([t.factor,t.units]):null}const Dqe=new $0(Mxe,t=>({__tag:"DepthTest",...t}));function Mxe(t){return t?L0([t.func]):null}const Nqe=new $0(Pxe,t=>({__tag:"StencilTest",...t}));function Pxe(t){return t?L0([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}const Fqe=new $0(Ixe,t=>({__tag:"DepthWrite",...t}));function Ixe(t){return t?L0([t.zNear,t.zFar]):null}const Uqe=new $0($xe,t=>({__tag:"ColorWrite",...t}));function $xe(t){return t?L0([t.r,t.g,t.b,t.a]):null}const kqe=new $0(Lxe,t=>({__tag:"StencilWrite",...t}));function Lxe(t){return t?L0([t.mask]):null}const zqe=new $0(Vqe,t=>({blending:Sqe(t.blending),culling:Eqe(t.culling),polygonOffset:Cqe(t.polygonOffset),depthTest:Aqe(t.depthTest),stencilTest:Oqe(t.stencilTest),depthWrite:Rqe(t.depthWrite),colorWrite:Mqe(t.colorWrite),stencilWrite:Pqe(t.stencilWrite)}));function Vqe(t){return t?L0([Axe(t.blending),Oxe(t.culling),Rxe(t.polygonOffset),Mxe(t.depthTest),Pxe(t.stencilTest),Ixe(t.depthWrite),$xe(t.colorWrite),Lxe(t.stencilWrite)]):null}let Bqe=class{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setSubState(e,r,i,s){return(i||e!==r)&&(s(e),this._pipelineInvalid=!0),e}},Gqe=class extends ii{constructor(){super(...arguments),this.heightParameters=Wt(),this.radii=He(),this.innerFadeDistance=0,this.altitudeFade=0,this.hazeStrength=1,this.renderScale=He(),this.backgroundColor=O()}},aO=class Dxe extends Lr{initializeProgram(e){return new Rr(e.rctx,Dxe.shader.get().build(this.configuration),Tr)}initializePipeline(){return this.configuration.reduced?Mt({blending:zc(Se.ONE,Se.ZERO),depthTest:{func:ri.ALWAYS},colorWrite:Bt}):this.configuration.haze?Mt({blending:Oo(Se.ONE,Se.ZERO,Se.ONE_MINUS_SRC_COLOR,Se.ONE),colorWrite:Bt}):Mt({blending:zc(Se.SRC_ALPHA,Se.ONE_MINUS_SRC_ALPHA),depthTest:{func:ri.LEQUAL},colorWrite:Bt})}};aO.shader=new Or(wqe,()=>he(()=>import("./ChapmanAtmosphere.glsl-7fcbd6ef.js"),[],import.meta.url));let Sa=class extends ii{constructor(){super(),this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const e=this._parameterNames,r={key:this.key};for(const i of e)r[i]=this[i];return r}};function B(t={}){return(e,r)=>{if(e._parameterNames=e._parameterNames??[],e._parameterNames.push(r),t.constValue!=null)Object.defineProperty(e,r,{get:()=>t.constValue});else{const i=e._parameterNames.length-1,s=t.count||2,n=Math.ceil(Math.log2(s)),o=e._parameterBits??[0];let a=0;for(;o[a]+n>16;)a++,a>=o.length&&o.push(0);e._parameterBits=o;const l=o[a],c=(1<<n)-1<<l;o[a]+=n,Object.defineProperty(e,r,{get(){return this[i]},set(h){if(this[i]!==h&&(this[i]=h,this._keyDirty=!0,this._parameterBits[a]=this._parameterBits[a]&~c|+h<<l&c,typeof h!="number"&&typeof h!="boolean"))throw new Error("Configuration value for "+r+" must be boolean or number, got "+typeof h)}})}}}let k5=class extends Sa{constructor(){super(...arguments),this.haze=!1,this.reduced=!1}};u([B()],k5.prototype,"haze",void 0),u([B()],k5.prototype,"reduced",void 0);let To=class{constructor(e,r,i,s,n,o=!1,a=0){this.name=e,this.count=r,this.type=i,this.offset=s,this.stride=n,this.normalized=o,this.divisor=a}};new To(C.POSITION,3,st.FLOAT,0,12);new To(C.POSITION,3,st.FLOAT,0,20),new To(C.UV0,2,st.FLOAT,12,20);new To(C.POSITION,3,st.FLOAT,0,32),new To(C.NORMAL,3,st.FLOAT,12,32),new To(C.UV0,2,st.FLOAT,24,32);new To(C.POSITION,3,st.FLOAT,0,16),new To(C.COLOR,4,st.UNSIGNED_BYTE,12,16);const WJ=[new To(C.POSITION,2,st.FLOAT,0,8)],MP=[new To(C.POSITION,2,st.FLOAT,0,16),new To(C.UV0,2,st.FLOAT,8,16)];function sne(t){const e=t.gl;switch(e.getError()){case e.NO_ERROR:return null;case e.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case e.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case e.INVALID_OPERATION:return"The specified command is not allowed for the current state";case e.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case e.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case e.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function Go(t,e){return t.vertexBuffers[e].byteLength/jqe(t.layout[e])}function jqe(t){return t[0].stride}function XJ(t,e,r,i,s=0){const n=t.gl,o=t.capabilities.instancing;t.bindBuffer(r);for(const a of i){const l=e.get(a.name);l===void 0&&console.error(`There is no location for vertex attribute '${a.name}' defined.`);const c=s*a.stride;if(a.count<=4)n.vertexAttribPointer(l,a.count,a.type,a.normalized,a.stride,a.offset+c),n.enableVertexAttribArray(l),a.divisor>0&&o&&o.vertexAttribDivisor(l,a.divisor);else if(a.count===9)for(let h=0;h<3;h++)n.vertexAttribPointer(l+h,3,a.type,a.normalized,a.stride,a.offset+12*h+c),n.enableVertexAttribArray(l+h),a.divisor>0&&o&&o.vertexAttribDivisor(l+h,a.divisor);else if(a.count===16)for(let h=0;h<4;h++)n.vertexAttribPointer(l+h,4,a.type,a.normalized,a.stride,a.offset+16*h+c),n.enableVertexAttribArray(l+h),a.divisor>0&&o&&o.vertexAttribDivisor(l+h,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count)}}function YJ(t,e,r,i){const s=t.gl,n=t.capabilities.instancing;t.bindBuffer(r);for(const o of i){const a=e.get(o.name);if(o.count<=4)s.disableVertexAttribArray(a),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a,0);else if(o.count===9)for(let l=0;l<3;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else if(o.count===16)for(let l=0;l<4;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else console.error("Unsupported vertex attribute element count: "+o.count)}t.unbindBuffer(Tt.ARRAY_BUFFER)}function ZJ(t){switch(t){case Ct.ALPHA:case Ct.LUMINANCE:case Ct.RED:case Ct.RED_INTEGER:case Ke.R8:case Ke.R8I:case Ke.R8UI:case Ke.R8_SNORM:case Zs.STENCIL_INDEX8:return 1;case Ct.LUMINANCE_ALPHA:case Ct.RG:case Ct.RG_INTEGER:case Ke.RGBA4:case Ke.R16F:case Ke.R16I:case Ke.R16UI:case Ke.RG8:case Ke.RG8I:case Ke.RG8UI:case Ke.RG8_SNORM:case Ke.RGB565:case Ke.RGB5_A1:case Zs.DEPTH_COMPONENT16:return 2;case Ct.DEPTH_COMPONENT:case Ct.RGB:case Ct.RGB_INTEGER:case Ke.RGB8:case Ke.RGB8I:case Ke.RGB8UI:case Ke.RGB8_SNORM:case Ke.SRGB8:case Zs.DEPTH_COMPONENT24:return 3;case Ct.DEPTH_STENCIL:case Ct.DEPTH24_STENCIL8:case Ct.RGBA:case Ct.RGBA_INTEGER:case Ke.RGBA8:case Ke.R32F:case Ke.R11F_G11F_B10F:case Ke.RG16F:case Ke.R32I:case Ke.R32UI:case Ke.RG16I:case Ke.RG16UI:case Ke.RGBA8I:case Ke.RGBA8UI:case Ke.RGBA8_SNORM:case Ke.SRGB8_ALPHA8:case Ke.RGB9_E5:case Ke.RGB10_A2UI:case Ke.RGB10_A2:case Zs.DEPTH_STENCIL:case Zs.DEPTH_COMPONENT32F:case Zs.DEPTH24_STENCIL8:return 4;case Zs.DEPTH32F_STENCIL8:return 5;case Ke.RGB16F:case Ke.RGB16I:case Ke.RGB16UI:return 6;case Ke.RG32F:case Ke.RG32I:case Ke.RG32UI:case Ke.RGBA16F:case Ke.RGBA16I:case Ke.RGBA16UI:return 8;case Ke.RGB32F:case Ke.RGB32I:case Ke.RGB32UI:return 12;case Ke.RGBA32F:case Ke.RGBA32I:case Ke.RGBA32UI:return 16;case gs.COMPRESSED_RGB_S3TC_DXT1_EXT:case gs.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case gs.COMPRESSED_RGBA_S3TC_DXT3_EXT:case gs.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case gs.COMPRESSED_R11_EAC:case gs.COMPRESSED_SIGNED_R11_EAC:case gs.COMPRESSED_RGB8_ETC2:case gs.COMPRESSED_SRGB8_ETC2:case gs.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case gs.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case gs.COMPRESSED_RG11_EAC:case gs.COMPRESSED_SIGNED_RG11_EAC:case gs.COMPRESSED_RGBA8_ETC2_EAC:case gs.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}const Qx=K.getLogger("esri.views.webgl.VertexArrayObject");let Zh=class{constructor(e,r,i,s,n=null){this._context=e,this._locations=r,this._layout=i,this._buffers=s,this._indexBuffer=n,this._glName=null,this._initialized=!1,e.instanceCounter.increment(In.VertexArrayObject,this)}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Object.keys(this._buffers).reduce((e,r)=>e+this._buffers[r].byteLength,this._indexBuffer!=null?this._indexBuffer.byteLength:0)}get layout(){return this._layout}get locations(){return this._locations}get memoryEstimate(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*xge}dispose(){if(this._context){this._context.getBoundVAO()===this&&this._context.bindVAO(null);for(const e in this._buffers)this._buffers[e]?.dispose(),delete this._buffers[e];this._indexBuffer=je(this._indexBuffer),this.disposeVAOOnly()}else(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&Qx.warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&((this._context?.capabilities?.vao).deleteVertexArray(this._glName),this._glName=null),this._context.instanceCounter.decrement(In.VertexArrayObject,this),this._context=pC(this._context)}initialize(){if(this._initialized)return;const e=this._context.capabilities.vao;if(e){const r=e.createVertexArray();e.bindVertexArray(r),this._bindLayout(),e.bindVertexArray(null),this._glName=r}this._initialized=!0}bind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:e,_layout:r,_indexBuffer:i}=this;e||Qx.error("Vertex buffer dictionary is empty!");const s=this._context.gl;for(const n in e){const o=e[n];o||Qx.error("Vertex buffer is uninitialized!");const a=r[n];a||Qx.error("Vertex element descriptor is empty!"),XJ(this._context,this._locations,o,a)}i!=null&&(this._context.capabilities.vao?s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,i.glName):this._context.bindBuffer(i))}unbind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:e,_layout:r}=this;e||Qx.error("Vertex buffer dictionary is empty!");for(const i in e){const s=e[i];s||Qx.error("Vertex buffer is uninitialized!");const n=r[i];YJ(this._context,this._locations,s,n)}this._indexBuffer!=null&&this._context.unbindBuffer(this._indexBuffer.bufferType)}},Np=class extends Zh{};var lr;function jj(t,e,r={}){const i=e===lr.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];for(const s of i){const n=t.getContext(s,r);if(n)return n}return null}function Hqe(t,e,r={}){const i=Nxe(t);for(const s of i){const n=jj(e,s,r);if(n)return n}return null}function Nxe(t){if(t==="3d")return[lr.WEBGL2];const e=ae("esri-force-webgl");return e===lr.WEBGL1||e===lr.WEBGL2?[e]:ae("mac")&&ae("chrome")?[lr.WEBGL1,lr.WEBGL2]:[lr.WEBGL2,lr.WEBGL1]}(function(t){t[t.WEBGL1=1]="WEBGL1",t[t.WEBGL2=2]="WEBGL2"})(lr||(lr={}));const qp=K.getLogger("esri.views.webgl.BufferObject");let kr=class x2{static createIndex(e,r,i){return new x2(e,Tt.ELEMENT_ARRAY_BUFFER,r,i)}static createVertex(e,r,i){return new x2(e,Tt.ARRAY_BUFFER,r,i)}static createUniform(e,r,i){if(e.type!==lr.WEBGL2)throw new Error("Uniform buffers are supported in WebGL2 only!");return new x2(e,Tt.UNIFORM_BUFFER,r,i)}static createPixelPack(e,r=Cr.STREAM_READ,i){if(e.type!==lr.WEBGL2)throw new Error("Pixel pack buffers are supported in WebGL2 only!");const s=new x2(e,Tt.PIXEL_PACK_BUFFER,r);return i&&s.setSize(i),s}static createPixelUnpack(e,r=Cr.STREAM_DRAW,i){if(e.type!==lr.WEBGL2)throw new Error("Pixel unpack buffers are supported in WebGL2 only!");return new x2(e,Tt.PIXEL_UNPACK_BUFFER,r,i)}constructor(e,r,i,s){this._context=e,this.bufferType=r,this.usage=i,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(In.BufferObject,this),this._glName=this._context.gl.createBuffer(),S_(this._context.gl),s&&this.setData(s)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteLength(){return this.bufferType===Tt.ELEMENT_ARRAY_BUFFER?this._indexType===st.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===Tt.ELEMENT_ARRAY_BUFFER||this.bufferType===Tt.ARRAY_BUFFER}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(In.BufferObject,this),this._context=pC(this._context)):this._glName&&qp.warn("Leaked WebGL buffer object")}setSize(e,r=null){if(e<=0&&qp.error("Buffer size needs to be positive!"),this.bufferType===Tt.ELEMENT_ARRAY_BUFFER&&r!=null)switch(this._indexType=r,r){case st.UNSIGNED_SHORT:e*=2;break;case st.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let r=e.byteLength;this.bufferType===Tt.ELEMENT_ARRAY_BUFFER&&(L6(e)&&(r/=2,this._indexType=st.UNSIGNED_SHORT),N6(e)&&(r/=4,this._indexType=st.UNSIGNED_INT)),this._setBufferData(r,e)}_setBufferData(e,r=null){this._size=e;const i=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const s=this._context.gl;r!=null?s.bufferData(this.bufferType,r,this.usage):s.bufferData(this.bufferType,e,this.usage),S_(s),this._isVAOAware&&this._context.bindVAO(i)}setSubData(e,r,i,s){if(!e)return;(r<0||r*e.BYTES_PER_ELEMENT>=this.byteLength)&&qp.error("offset is out of range!"),i>=s&&qp.error("end must be bigger than start!"),(r+(s-i))*e.BYTES_PER_ELEMENT>this.byteLength&&qp.error("An attempt to write beyond the end of the buffer!");const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const o=this._context.gl;if(this._context.type===lr.WEBGL2)o.bufferSubData(this.bufferType,r*e.BYTES_PER_ELEMENT,e,i,s-i);else{const a=i===0&&s===e.length?e:e.subarray(i,s);o.bufferSubData(this.bufferType,r*e.BYTES_PER_ELEMENT,a)}S_(o),this._isVAOAware&&this._context.bindVAO(n)}getSubData(e,r=0,i,s){if(this._context.type!==lr.WEBGL2)return void qp.error("Get buffer subdata is supported in WebGL2 only!");if(i<0||s<0)return void qp.error("Problem getting subdata: offset and length were less than zero!");const n=qqe(e)?e.BYTES_PER_ELEMENT:1;if(n*((i??0)+(s??0))>e.byteLength)return void qp.error("Problem getting subdata: offset and length exceeded destination size!");r+n*(s??0)>this.byteLength&&qp.warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this._context.bindBuffer(this,Tt.COPY_READ_BUFFER),o.getBufferSubData(Tt.COPY_READ_BUFFER,r,e,i,s),this._context.unbindBuffer(Tt.COPY_READ_BUFFER)}async getSubDataAsync(e,r=0,i,s){this._context.type===lr.WEBGL2?(await this._context.clientWaitAsync(),this.getSubData(e,r,i,s)):qp.error("Get buffer subdata is supported in WebGL2 only!")}};function qqe(t){return ADe(t)}var fv;(function(t){t[t.Texture=0]="Texture",t[t.RenderBuffer=1]="RenderBuffer"})(fv||(fv={}));let xr=class{constructor(e=0,r=e){this.width=e,this.height=r,this.target=cs.TEXTURE_2D,this.pixelFormat=Ct.RGBA,this.dataType=qs.UNSIGNED_BYTE,this.samplingMode=Rt.LINEAR,this.wrapMode=Dt.REPEAT,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.depth=1,this.isImmutable=!1}};function Wqe(t){return t.width<=0||t.height<=0||t.internalFormat==null?0:t.width*t.height*(t.hasMipmap?4/3:1)*ZJ(t.internalFormat)}let Xqe=class Fxe extends xr{constructor(e,r){switch(super(),this.context=e,Object.assign(this,r),this.internalFormat){case Ke.R16F:case Ke.R16I:case Ke.R16UI:case Ke.R32F:case Ke.R32I:case Ke.R32UI:case Ke.R8_SNORM:case Ke.R8:case Ke.R8I:case Ke.R8UI:this.pixelFormat=Ct.RED}}static validate(e,r){return new Fxe(e,r)}};const nne=4;let Ot=class{constructor(e,r=null,i=null){if(this.type=fv.Texture,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,"context"in e)this._descriptor=e,i=r;else{const s=Xqe.validate(e,r);if(!s)throw new U("Texture descriptor invalid");this._descriptor=s}if(this._descriptor.context.instanceCounter.increment(In.Texture,this),this._descriptor.context.type!==lr.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),rb(this._descriptor.target)))throw new U("3D and array textures are not supported in WebGL1");this._descriptor.target===cs.TEXTURE_CUBE_MAP?this._setDataCubeMap(i):this.setData(i)}get glName(){return this._glName}get descriptor(){return this._descriptor}get gpuMemoryUsage(){return Kqe.delete(this),Wqe(this._descriptor)}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null,this._descriptor.context.instanceCounter.decrement(In.Texture,this))}release(){this.dispose()}resize(e,r){const i=this._descriptor;if(i.width!==e||i.height!==r){if(this._wasImmutablyAllocated)throw new U("Immutable textures can't be resized!");i.width=e,i.height=r,this._descriptor.target===cs.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(e=null){for(let r=cs.TEXTURE_CUBE_MAP_POSITIVE_X;r<=cs.TEXTURE_CUBE_MAP_NEGATIVE_Z;r++)this._setData(e,r)}setData(e){this._setData(e)}_setData(e,r){if(!this._descriptor.context||!this._descriptor.context.gl)return;const i=this._descriptor.context.gl;S_(i),this._glName||(this._glName=i.createTexture()),e===void 0&&(e=null);const s=this._descriptor,n=r??s.target,o=rb(n);e===null&&(s.width=s.width||nne,s.height=s.height||nne,o&&(s.depth=s.depth??1));const a=this._descriptor.context.bindTexture(this,Ot.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(Ot.TEXTURE_UNIT_FOR_UPDATES),pk(this._descriptor.context,s),this._configurePixelStorage(),S_(i);const l=this._deriveInternalFormat();if(fk(e)){let c=e.width,h=e.height;const d=1;e instanceof HTMLVideoElement&&(c=e.videoWidth,h=e.videoHeight),s.width&&s.height,o&&s.depth,s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(n,l,s.hasMipmap,c,h,d),this._texImage(n,0,l,c,h,d,e),S_(i),s.hasMipmap&&this.generateMipmap(),s.width||(s.width=c),s.height||(s.height=h),o&&!s.depth&&(s.depth=d)}else{const{width:c,height:h,depth:d}=s;if(c==null||h==null)throw new U("Width and height must be specified!");if(o&&d==null)throw new U("Depth must be specified!");if(s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(n,l,s.hasMipmap,c,h,d),vN(e)){const f=e.levels,m=lne(n,c,h,d),g=Math.min(m-1,f.length-1);this._descriptor.context.gl2!=null?i.texParameteri(s.target,this._descriptor.context.gl2.TEXTURE_MAX_LEVEL,g):s.hasMipmap=s.hasMipmap&&m===f.length;const _=l;if(!Jqe(_))throw new U("Attempting to use compressed data with an uncompressed format!");this._forEachMipmapLevel((v,b,T,x)=>{const S=f[Math.min(v,f.length-1)];this._compressedTexImage(n,v,_,b,T,x,S)},g)}else this._texImage(n,0,l,c,h,d,e),S_(i),s.hasMipmap&&this.generateMipmap()}one(i,this._descriptor),ane(i,this._descriptor),Yqe(this._descriptor.context,this._descriptor),S_(i),this._descriptor.context.bindTexture(a,Ot.TEXTURE_UNIT_FOR_UPDATES)}updateData(e,r,i,s,n,o,a=0){o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const l=this._descriptor.context.gl,c=this._descriptor.context.gl2,h=this._descriptor,d=this._deriveInternalFormat(),{pixelFormat:f,dataType:m,target:g,isImmutable:_}=h;if(_&&!this._wasImmutablyAllocated)throw new U("Cannot update immutable texture before allocation!");const v=this._descriptor.context.bindTexture(this,Ot.TEXTURE_UNIT_FOR_UPDATES,!0);if((r<0||i<0||s>h.width||n>h.height||r+s>h.width||i+n>h.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),a){if(!c)return void console.error("Webgl2 must be enabled to use dataRowOffset!");l.pixelStorei(c.UNPACK_SKIP_ROWS,a)}if(fk(o)?c?c.texSubImage2D(g,e,r,i,s,n,f,m,o):l.texSubImage2D(g,e,r,i,f,m,o):vN(o)?l.compressedTexSubImage2D(g,e,r,i,s,n,d,o.levels[e]):l.texSubImage2D(g,e,r,i,s,n,f,m,o),a){if(!c)return void console.error("Webgl2 must be enabled to use dataRowOffset!");l.pixelStorei(c.UNPACK_SKIP_ROWS,0)}this._descriptor.context.bindTexture(v,Ot.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(e,r,i,s,n,o,a,l){l||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._descriptor.context.gl2;if(c==null)throw new U("3D textures are not supported in WebGL1");const h=this._descriptor,d=this._deriveInternalFormat(),{pixelFormat:f,dataType:m,isImmutable:g,target:_}=h;if(g&&!this._wasImmutablyAllocated)throw new U("Cannot update immutable texture before allocation!");rb(_)||console.warn("Attempting to set 3D texture data on a non-3D texture");const v=this._descriptor.context.bindTexture(this,Ot.TEXTURE_UNIT_FOR_UPDATES);if(this._descriptor.context.setActiveTexture(Ot.TEXTURE_UNIT_FOR_UPDATES),(r<0||i<0||s<0||n>h.width||o>h.height||a>h.depth||r+n>h.width||i+o>h.height||s+a>h.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),vN(l))l=l.levels[e],c.compressedTexSubImage3D(_,e,r,i,s,n,o,a,d,l);else{const b=l;c.texSubImage3D(_,e,r,i,s,n,o,a,f,m,b)}this._descriptor.context.bindTexture(v,Ot.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;if(!e.hasMipmap){if(this._wasImmutablyAllocated)throw new U("Cannot add mipmaps to immutable texture after allocation");e.hasMipmap=!0,this._samplingModeDirty=!0,pk(this._descriptor.context,e)}e.samplingMode===Rt.LINEAR?(this._samplingModeDirty=!0,e.samplingMode=Rt.LINEAR_MIPMAP_NEAREST):e.samplingMode===Rt.NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=Rt.NEAREST_MIPMAP_NEAREST);const r=this._descriptor.context.bindTexture(this,Ot.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(Ot.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(e.target),this._descriptor.context.bindTexture(r,Ot.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,pk(this._descriptor.context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._descriptor.context.gl,r=this._descriptor;this._samplingModeDirty&&(one(e,r),this._samplingModeDirty=!1),this._wrapModeDirty&&(ane(e,r),this._wrapModeDirty=!1)}_deriveInternalFormat(){if(this._descriptor.context.type===lr.WEBGL1)return this._descriptor.internalFormat=this._descriptor.pixelFormat;if(this._descriptor.internalFormat!=null)return this._descriptor.internalFormat===Ct.DEPTH_STENCIL&&(this._descriptor.internalFormat=Ct.DEPTH24_STENCIL8),this._descriptor.internalFormat;switch(this._descriptor.dataType){case qs.FLOAT:switch(this._descriptor.pixelFormat){case Ct.RGBA:return this._descriptor.internalFormat=Ke.RGBA32F;case Ct.RGB:return this._descriptor.internalFormat=Ke.RGB32F;default:throw new U("Unable to derive format")}case qs.UNSIGNED_BYTE:switch(this._descriptor.pixelFormat){case Ct.RGBA:return this._descriptor.internalFormat=Ke.RGBA8;case Ct.RGB:return this._descriptor.internalFormat=Ke.RGB8}}return this._descriptor.internalFormat=this._descriptor.pixelFormat===Ct.DEPTH_STENCIL?Ct.DEPTH24_STENCIL8:this._descriptor.pixelFormat}_configurePixelStorage(){const e=this._descriptor.context.gl,{unpackAlignment:r,flipped:i,preMultiplyAlpha:s}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,r),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,i?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s?1:0)}_texStorage(e,r,i,s,n,o){const a=this._descriptor.context.gl2;if(a==null)throw new U("Immutable textures are not supported in WebGL1");if(!Zqe(r))throw new U("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=i?lne(e,s,n,o):1;if(rb(e)){if(o==null)throw new U("Missing depth dimension for 3D texture upload");a.texStorage3D(e,l,r,s,n,o)}else a.texStorage2D(e,l,r,s,n);this._wasImmutablyAllocated=!0}_texImage(e,r,i,s,n,o,a){const l=this._descriptor.context.gl,c=rb(e),{isImmutable:h,pixelFormat:d,dataType:f}=this._descriptor,m=this._descriptor.context.type===lr.WEBGL2,g=m?l:null;if(m||!fk(a))if(h){if(a!=null){const _=a;if(c){if(o==null)throw new U("Missing depth dimension for 3D texture upload");g.texSubImage3D(e,r,0,0,0,s,n,o,d,f,_)}else l.texSubImage2D(e,r,0,0,s,n,d,f,_)}}else{const _=a;if(c){if(o==null)throw new U("Missing depth dimension for 3D texture upload");g.texImage3D(e,r,i,s,n,o,0,d,f,_)}else l.texImage2D(e,r,i,s,n,0,d,f,_)}else l.texImage2D(e,0,i,d,f,a)}_compressedTexImage(e,r,i,s,n,o,a){const l=this._descriptor.context.gl;let c=null;const h=rb(e),d=this._descriptor.isImmutable;if(h){if(this._descriptor.context.type!==lr.WEBGL2)throw new U("3D textures are not supported in WebGL1");c=l}if(d){if(a!=null)if(h){if(o==null)throw new U("Missing depth dimension for 3D texture upload");c.compressedTexSubImage3D(e,r,0,0,0,s,n,o,i,a)}else l.compressedTexSubImage2D(e,r,0,0,s,n,i,a)}else if(h){if(o==null)throw new U("Missing depth dimension for 3D texture upload");c.compressedTexImage3D(e,r,i,s,n,o,0,a)}else l.compressedTexImage2D(e,r,i,s,n,0,a)}_forEachMipmapLevel(e,r=1/0){let{width:i,height:s,depth:n,hasMipmap:o,target:a}=this._descriptor;const l=a===cs.TEXTURE_3D;if(i==null||s==null||l&&n==null)throw new U("Missing texture dimensions for mipmap calculation");for(let c=0;e(c,i,s,n),o&&(i!==1||s!==1||l&&n!==1)&&!(c>=r);++c)i=Math.max(1,i>>1),s=Math.max(1,s>>1),l&&(n=Math.max(1,n>>1))}};function pk(t,e){(e.width!=null&&e.width<0||e.height!=null&&e.height<0||e.depth!=null&&e.depth<0)&&console.error("Negative dimension parameters are not allowed!");const r=t.type===lr.WEBGL2;r||!e.isImmutable&&!rb(e.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!"),!r&&(e.width!=null&&kw(e.width)&&e.height!=null&&kw(e.height)||(typeof e.wrapMode=="number"?e.wrapMode!==Dt.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):e.wrapMode.s===Dt.CLAMP_TO_EDGE&&e.wrapMode.t===Dt.CLAMP_TO_EDGE||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),e.hasMipmap&&console.error("Mipmapping requires power-of-two textures!")))}function one(t,e){let r=e.samplingMode,i=e.samplingMode;r===Rt.LINEAR_MIPMAP_NEAREST||r===Rt.LINEAR_MIPMAP_LINEAR?(r=Rt.LINEAR,e.hasMipmap||(i=Rt.LINEAR)):r!==Rt.NEAREST_MIPMAP_NEAREST&&r!==Rt.NEAREST_MIPMAP_LINEAR||(r=Rt.NEAREST,e.hasMipmap||(i=Rt.NEAREST)),t.texParameteri(e.target,t.TEXTURE_MAG_FILTER,r),t.texParameteri(e.target,t.TEXTURE_MIN_FILTER,i)}function ane(t,e){typeof e.wrapMode=="number"?(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode)):(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode.s),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode.t))}function Yqe(t,e){const r=t.capabilities.textureFilterAnisotropic;r&&t.gl.texParameterf(e.target,r.TEXTURE_MAX_ANISOTROPY,e.maxAnisotropy??1)}function Zqe(t){return t in Ke}function Jqe(t){return t in gs}function vN(t){return t!=null&&"type"in t&&t.type==="compressed"}function Qqe(t){return t!=null&&"byteLength"in t}function fk(t){return t!=null&&!vN(t)&&!Qqe(t)}function rb(t){return t===cs.TEXTURE_3D||t===cs.TEXTURE_2D_ARRAY}function lne(t,e,r,i=1){let s=Math.max(e,r);return t===cs.TEXTURE_3D&&(s=Math.max(s,i)),Math.round(Math.log(s)/Math.LN2)+1}Ot.TEXTURE_UNIT_FOR_UPDATES=0;const Kqe=new Map;function Hl(t,e=WJ,r=Tr,i=-1,s=1){let n=null;return e===MP?n=new Float32Array([i,i,0,0,s,i,1,0,i,s,0,1,s,s,1,1]):n=new Float32Array([i,i,s,i,i,s,s,s]),new Np(t,r,{geometry:e},{geometry:kr.createVertex(t,Cr.STATIC_DRAW,n)})}function eWe(t,e=WJ,r=Tr){const i=new Float32Array([-1,-1,3,-1,-1,3]);return new Np(t,r,{geometry:e},{geometry:kr.createVertex(t,Cr.STATIC_DRAW,i)})}const Uxe=4;function kxe(t,e=Uxe){const r=new xr;return r.samplingMode=Rt.NEAREST,r.width=r.height=e,new Ot(t,r)}function tWe(t,e,r=Uxe){const i=new Uint8Array(r*r*4);for(let n=0;n<i.length;n+=4)i[n]=255*e[0],i[n+1]=255*e[1],i[n+2]=255*e[2],i[n+3]=255*e[3];const s=new xr;return s.samplingMode=Rt.NEAREST,s.width=s.height=r,new Ot(t,s,i)}function zxe(t){const e=new xr;return e.samplingMode=Rt.NEAREST,e.width=e.height=1,new Ot(t,e,new Uint8Array([255,255,255,255]))}let cne=class{constructor(e,r){this._view=e,this.type=aa.Realistic,this._handles=new $i,this._passParameters=new Gqe,this._rootTileElevationMin=NaN,this._lowerBoundEarthRadius=nr.radius,this._fadeHaze=0,this._tmpScale=He(),this._updateRadius(nr.radius);const i=r.renderContext.rctx;this._updateRootTileElevationBounds(),this._handles.add([le(()=>this._view?.basemapTerrain?.rootTileElevationBounds,()=>this._view?.basemapTerrain?this._updateRootTileElevationBounds():null),le(()=>this._view?.basemapTerrain?.visibleElevationBounds,()=>this._view?.basemapTerrain?this._updateVisibleElevationBounds():null)]);const s=new k5;s.haze=!1,this._atmosphereTechnique=r.techniqueRepository.acquire(aO,s),s.haze=!0,this._atmosphereHazeTechnique=r.techniqueRepository.acquire(aO,s),s.reduced=!0,s.haze=!1,this._atmosphereReducedTechnique=r.techniqueRepository.acquire(aO,s),s.haze=!0,this._atmosphereHazeReducedTechnique=r.techniqueRepository.acquire(aO,s),this._vao=Hl(i,MP)}destroy(){this._handles.destroy(),this._atmosphereTechnique.release(),this._atmosphereHazeTechnique.release(),this._atmosphereReducedTechnique.release(),this._atmosphereHazeReducedTechnique.release(),this._vao.dispose()}render(e,r){this._render(e,r?this._atmosphereTechnique:this._atmosphereReducedTechnique,e.offscreenRenderingHelper.depthTexture,r,!1)}renderHaze(e,r,i){this._fadeHaze=r,this._render(e,i?this._atmosphereHazeTechnique:this._atmosphereHazeReducedTechnique,e.offscreenRenderingHelper.linearDepthTexture,i,!0)}_render(e,r,i,s,n){if(i==null)return;const o=e.offscreenRenderingHelper;this._update(e.bindParameters.camera),this._passParameters.depthTexture=i;const a=o.background.color;ne(this._passParameters.backgroundColor,a[0]*a[3],a[1]*a[3],a[2]*a[3]);const l=e.rctx.bindTechnique(r,this._passParameters,e.bindParameters);if(s)o.renderDepthDetached(()=>this._renderCommon(l,e));else{const c=e.rctx.getViewport(),h=Re(e.bindParameters.camera.eye)-nr.radius;let d;if(h<m_){const g=Math.min(1,Math.max(0,h/m_));d=n?St(.4,.5,g):St(.2,.3,g)}else{const g=Math.min(1,Math.max(0,(h-m_)/(15*m_)));d=n?St(.5,1,g):St(.3,.6,g)}const f=Math.floor(d*e.bindParameters.camera.fullViewport[2]),m=Math.floor(d*e.bindParameters.camera.fullViewport[3]);e.rctx.setViewport(0,0,f,m),o.renderToTargets(()=>this._renderCommon(l,e),o.tmpColor,o.tmpDepth,[0,0,0,1],!1,!1),e.rctx.setViewport(c.x,c.y,c.width,c.height),or(this._tmpScale,f/e.bindParameters.camera.fullViewport[2],m/e.bindParameters.camera.fullViewport[3]),o.compositeAtmosphereToMain(e.bindParameters,n,i,this._tmpScale)}}_renderCommon(e,r){this._vao!=null&&(r.rctx.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.rctx.drawArrays(At.TRIANGLE_STRIP,0,4))}_adjustRadiusForTesselation(e){return e*Math.cos(Math.PI/16/16)}_updateRootTileElevationBounds(){const e=this._view.basemapTerrain.rootTileElevationBounds.min;e!==this._rootTileElevationMin&&(this._rootTileElevationMin=e,this._lowerBoundEarthRadius=nr.radius,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const e=this._adjustRadiusForTesselation(nr.radius+this._view.basemapTerrain.visibleElevationBounds.min);e<this._lowerBoundEarthRadius&&this._updateRadius(e)}_updateRadius(e){this._lowerBoundEarthRadius=e,or(this._passParameters.radii,e,e+m_),this._passParameters.innerFadeDistance=2*Math.sqrt((2*e-kj)*kj)}_update(e){if(!e)return;const r=da(e.eye),i=Math.sqrt(r),s=r-this._passParameters.radii[1]*this._passParameters.radii[1],n=ve((i-this._passParameters.radii[0])/m_,0,1);Ti(this._passParameters.heightParameters,i,r,s,n),this._passParameters.altitudeFade=HJ(i-this._lowerBoundEarthRadius),this._passParameters.hazeStrength=St(St(.6,1,aM(9500,10500,i-nr.radius)),1,this._fadeHaze)}static isSupported(e){return e.renderContext.rctx.capabilities.depthTexture}};function Vxe(t){t.fragment.code.add(w`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)}function JJ(t,e){switch(t.include(sm,e),e.textureCoordinateType){case Fs.Default:case Fs.Compressed:return void t.fragment.code.add(w`vec4 textureLookup(sampler2D tex, vec2 uv) {
return texture(tex, uv);
}`);case Fs.Atlas:return t.include(Vxe),void t.fragment.code.add(w`vec4 textureLookup(sampler2D tex, vec2 uv) {
return textureAtlasLookup(tex, uv, vuvRegion);
}`);default:e.textureCoordinateType;case Fs.None:case Fs.COUNT:return}}let Ou=class extends ps{constructor(e,r){super(e,"vec3",ti.Draw,(i,s,n,o)=>i.setUniform3fv(e,r(s,n,o)))}},zh=class extends ps{constructor(e,r){super(e,"sampler2D",ti.Draw,(i,s,n)=>i.bindTexture(e,r(s,n)))}},Dv=class{constructor(e){this._material=e.material,this._techniqueRepository=e.techniqueRep,this._output=e.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}get _stippleTextureRepository(){return this._techniqueRepository.constructionContext.stippleTextureRepository}get _markerTextureRepository(){return this._techniqueRepository.constructionContext.markerTextureRepository}ensureTechnique(e,r){return this._technique=this._techniqueRepository.releaseAndAcquire(e,this._material.getConfiguration(this._output,r),this._technique),this._technique}ensureResources(e){return Kg.LOADED}},QJ=class extends Dv{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textureRepository=e.textureRep,this._textureId=e.textureId,this._acquire(e.textureId,r=>this._texture=r),this._acquire(e.normalTextureId,r=>this._textureNormal=r),this._acquire(e.emissiveTextureId,r=>this._textureEmissive=r),this._acquire(e.occlusionTextureId,r=>this._textureOcclusion=r),this._acquire(e.metallicRoughnessTextureId,r=>this._textureMetallicRoughness=r)}dispose(){this._texture=Gi(this._texture),this._textureNormal=Gi(this._textureNormal),this._textureEmissive=Gi(this._textureEmissive),this._textureOcclusion=Gi(this._textureOcclusion),this._textureMetallicRoughness=Gi(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return this._numLoading===0?Kg.LOADED:Kg.LOADING}get textureBindParameters(){return new Bxe(this._texture!=null?this._texture.glTexture:null,this._textureNormal!=null?this._textureNormal.glTexture:null,this._textureEmissive!=null?this._textureEmissive.glTexture:null,this._textureOcclusion!=null?this._textureOcclusion.glTexture:null,this._textureMetallicRoughness!=null?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){this._texture!=null&&e===this._texture.id||(this._texture=Gi(this._texture),this._textureId=e,this._acquire(this._textureId,r=>this._texture=r))}_acquire(e,r){if(e==null)return void r(null);const i=this._textureRepository.acquire(e);if(ku(i))return++this._numLoading,void i.then(s=>{if(this._disposed)return Gi(s),void r(null);r(s)}).finally(()=>--this._numLoading);r(i)}},Bxe=class extends ii{constructor(e=null,r=null,i=null,s=null,n=null){super(),this.texture=e,this.textureNormal=r,this.textureEmissive=i,this.textureOcclusion=s,this.textureMetallicRoughness=n}};var ut;(function(t){t[t.Disabled=0]="Disabled",t[t.Normal=1]="Normal",t[t.Schematic=2]="Schematic",t[t.Water=3]="Water",t[t.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",t[t.Terrain=5]="Terrain",t[t.TerrainWithWater=6]="TerrainWithWater",t[t.COUNT=7]="COUNT"})(ut||(ut={}));function KJ(t,e){const r=t.fragment,i=e.hasMetallicRoughnessTexture||e.hasEmissionTexture||e.hasOcclusionTexture;if(e.pbrMode===ut.Normal&&i&&t.include(JJ,e),e.pbrMode!==ut.Schematic)if(e.pbrMode!==ut.Disabled){if(e.pbrMode===ut.Normal){r.code.add(w`vec3 mrr;
vec3 emission;
float occlusion;`);const s=e.pbrTextureBindType;e.hasMetallicRoughnessTexture&&(r.uniforms.add(s===ti.Pass?new rt("texMetallicRoughness",n=>n.textureMetallicRoughness):new zh("texMetallicRoughness",n=>n.textureMetallicRoughness)),r.code.add(w`void applyMetallnessAndRoughness(vec2 uv) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),e.hasEmissionTexture&&(r.uniforms.add(s===ti.Pass?new rt("texEmission",n=>n.textureEmissive):new zh("texEmission",n=>n.textureEmissive)),r.code.add(w`void applyEmission(vec2 uv) {
emission *= textureLookup(texEmission, uv).rgb;
}`)),e.hasOcclusionTexture?(r.uniforms.add(s===ti.Pass?new rt("texOcclusion",n=>n.textureOcclusion):new zh("texOcclusion",n=>n.textureOcclusion)),r.code.add(w`void applyOcclusion(vec2 uv) {
occlusion *= textureLookup(texOcclusion, uv).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):r.code.add(w`float getBakedOcclusion() { return 1.0; }`),s===ti.Pass?r.uniforms.add(new kt("emissionFactor",n=>n.emissiveFactor),new kt("mrrFactors",n=>n.mrrFactors)):r.uniforms.add(new Ou("emissionFactor",n=>n.emissiveFactor),new Ou("mrrFactors",n=>n.mrrFactors)),r.code.add(w`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;

      ${e.hasMetallicRoughnessTexture?w`applyMetallnessAndRoughness(${e.hasMetallicRoughnessTextureTransform?w`metallicRoughnessUV`:"vuv0"});`:""}

      ${e.hasEmissionTexture?w`applyEmission(${e.hasEmissiveTextureTransform?w`emissiveUV`:"vuv0"});`:""}

      ${e.hasOcclusionTexture?w`applyOcclusion(${e.hasOcclusionTextureTransform?w`occlusionUV`:"vuv0"});`:""}
    }
  `)}}else r.code.add(w`float getBakedOcclusion() { return 1.0; }`);else r.code.add(w`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}function eQ(t,e){const r=t.fragment,i=e.lightingSphericalHarmonicsOrder!==void 0?e.lightingSphericalHarmonicsOrder:2;i===0?(r.uniforms.add(new kt("lightingAmbientSH0",(s,n)=>ne(une,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0]))),r.code.add(w`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):i===1?(r.uniforms.add(new sr("lightingAmbientSH_R",(s,n)=>Ti(zm,n.lighting.sh.r[0],n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3])),new sr("lightingAmbientSH_G",(s,n)=>Ti(zm,n.lighting.sh.g[0],n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3])),new sr("lightingAmbientSH_B",(s,n)=>Ti(zm,n.lighting.sh.b[0],n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3]))),r.code.add(w`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):i===2&&(r.uniforms.add(new kt("lightingAmbientSH0",(s,n)=>ne(une,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0])),new sr("lightingAmbientSH_R1",(s,n)=>Ti(zm,n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3],n.lighting.sh.r[4])),new sr("lightingAmbientSH_G1",(s,n)=>Ti(zm,n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3],n.lighting.sh.g[4])),new sr("lightingAmbientSH_B1",(s,n)=>Ti(zm,n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3],n.lighting.sh.b[4])),new sr("lightingAmbientSH_R2",(s,n)=>Ti(zm,n.lighting.sh.r[5],n.lighting.sh.r[6],n.lighting.sh.r[7],n.lighting.sh.r[8])),new sr("lightingAmbientSH_G2",(s,n)=>Ti(zm,n.lighting.sh.g[5],n.lighting.sh.g[6],n.lighting.sh.g[7],n.lighting.sh.g[8])),new sr("lightingAmbientSH_B2",(s,n)=>Ti(zm,n.lighting.sh.b[5],n.lighting.sh.b[6],n.lighting.sh.b[7],n.lighting.sh.b[8]))),r.code.add(w`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),e.pbrMode!==ut.Normal&&e.pbrMode!==ut.Schematic||r.code.add(w`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const une=O(),zm=Wt();function PP(t){t.vertex.code.add(w`const float PI = 3.141592653589793;`),t.fragment.code.add(w`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}var Ds,Xw;function rWe(t){return t?.cubeMap!=null}function tQ(t){return t!=null&&!t.running}(function(t){t[t.RENDERING=0]="RENDERING",t[t.FINISHED_RENDERING=1]="FINISHED_RENDERING",t[t.FADING_TEXTURE_CHANNELS=2]="FADING_TEXTURE_CHANNELS",t[t.SWITCH_CHANNELS=3]="SWITCH_CHANNELS",t[t.FINISHED=4]="FINISHED"})(Ds||(Ds={})),function(t){t[t.RG=0]="RG",t[t.BA=1]="BA"}(Xw||(Xw={}));let iWe=class{constructor(){this.readChannels=Xw.RG,this.renderingStage=Ds.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=O(),this.isCameraPositionFinal=!0,this.parallax=new hne,this.parallaxNew=new hne,this.crossFade={enabled:!1,factor:1,distanceThresholdFactor:.3},this.fadeInOut={stage:Sn.FINISHED,factor:1,distanceThresholdFactor:.6},this.fadeIn={stage:vc.FINISHED,factor:1,distanceThresholdFactor:2},this.fadeInOutHeight={stage:mv.FINISHED,factor:-1}}get isFading(){return this.fadeInOut.stage===Sn.FADE_OUT||this.fadeInOut.stage===Sn.FADE_IN||this.fadeIn.stage===vc.FADE_IN||this.fadeInOutHeight.stage!==mv.FINISHED||this.renderingStage===Ds.FADING_TEXTURE_CHANNELS}};var vc,Sn,mv;(function(t){t[t.FINISHED=0]="FINISHED",t[t.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",t[t.FADE_IN=2]="FADE_IN"})(vc||(vc={})),function(t){t[t.FINISHED=0]="FINISHED",t[t.FADE_OUT=1]="FADE_OUT",t[t.SWITCH=2]="SWITCH",t[t.FADE_IN=3]="FADE_IN"}(Sn||(Sn={})),function(t){t[t.FINISHED=0]="FINISHED",t[t.HEIGHT_FADE=1]="HEIGHT_FADE"}(mv||(mv={}));let hne=class{constructor(){this.anchorPointClouds=O(),this.cloudsHeight=1e5,this.radiusCurvatureCorrectionFactor=0,this.transform=xe()}},nm=class extends ps{constructor(e,r){super(e,"bool",ti.Pass,(i,s,n)=>i.setUniform1b(e,r(s,n)))}},sWe=class extends ps{constructor(e,r){super(e,"samplerCube",ti.Pass,(i,s,n)=>i.bindTexture(e,r(s,n)))}};function Gxe(t){const e=t.fragment;e.uniforms.add(new Ui("rotationMatrixClouds",(r,i)=>i.cloudsFade.parallax.transform),new Ui("rotationMatrixCloudsCrossFade",(r,i)=>i.cloudsFade.parallaxNew.transform),new kt("anchorPosition",(r,i)=>i.cloudsFade.parallax.anchorPointClouds),new kt("anchorPositionCrossFade",(r,i)=>i.cloudsFade.parallaxNew.anchorPointClouds),new Ie("cloudsHeight",(r,i)=>i.cloudsFade.parallax.cloudsHeight),new Ie("radiusCurvatureCorrectionFactor",(r,i)=>i.cloudsFade.parallax.radiusCurvatureCorrectionFactor),new Ie("totalFadeInOut",(r,i)=>i.cloudsFade.fadeInOut.stage===Sn.FINISHED?i.cloudsFade.fadeInOutHeight.factor+1-i.cloudsFade.fadeIn.factor:i.cloudsFade.fadeInOutHeight.factor+1-i.cloudsFade.fadeInOut.factor),new Ie("crossFadeAnchorFactor",(r,i)=>ve(i.cloudsFade.crossFade.factor,0,1)),new sWe("cubeMap",(r,i)=>i.cloudsFade.data?.cubeMap?i.cloudsFade.data.cubeMap.colorTexture:null),new nm("crossFade",(r,i)=>i.cloudsFade.crossFade.enabled),new nm("readChannelsRG",(r,i)=>i.cloudsFade.readChannels===Xw.RG),new nm("fadeTextureChannels",(r,i)=>i.cloudsFade.renderingStage===Ds.FADING_TEXTURE_CHANNELS)),e.constants.add("planetRadius","float",nr.radius),e.code.add(w`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),e.code.add(w`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),e.code.add(w`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),I0(e),$m(e),e.code.add(w`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),e.code.add(w`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = texture(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`),e.code.add(w`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),e.code.add(w`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),e.code.add(w`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}function Lm(t){t.code.add(w`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function nWe(){const t=new Sr;t.attributes.add(C.POSITION,"vec2"),t.varyings.add("worldRay","vec3");const{vertex:e,fragment:r}=t;return e.uniforms.add(new Ui("inverseProjectionMatrix",(i,s)=>s.camera.inverseProjectionMatrix),new Ui("inverseViewMatrix",(i,s)=>OC(oWe,s.camera.viewMatrix))),e.code.add(w`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),r.include(Lm),r.include(Bc),t.include(eQ,{pbrMode:ut.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(PP),t.include(F8),t.include(F5),t.include(Gxe,{instancedDoublePrecision:!1}),r.uniforms.add(new kt("cameraPosition",(i,s)=>s.camera.eye)),r.code.add(w`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
fragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),t}const oWe=xe(),aWe=Object.freeze(Object.defineProperty({__proto__:null,build:nWe},Symbol.toStringTag,{value:"Module"}));let jxe=class Hxe extends Lr{constructor(e){super(e,new Sa,()=>this.destroy())}initializeProgram(e){return new Rr(e.rctx,Hxe.shader.get().build(),Tr)}initializePipeline(){return Mt({blending:Oo(Se.ONE,Se.ZERO,Se.SRC_ALPHA,Se.ONE),depthTest:{func:ri.LEQUAL},colorWrite:Bt})}};jxe.shader=new Or(aWe,()=>he(()=>import("./CloudsComposition.glsl-1d07bc11.js"),[],import.meta.url));let ib=class extends Te{constructor(e){super(e),this._technique=new jxe(e),this._vao=Hl(e.rctx)}destroy(){this._technique=Gi(this._technique),this._vao=je(this._vao)}render(e){const r=e.bindParameters.cloudsFade;if(this._vao==null||r.data==null)return;if(!this._technique.compiled)return void this.requestRender();const i=e.rctx.bindTechnique(this._technique,lWe,e.bindParameters);e.rctx.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays(At.TRIANGLE_STRIP,0,4)}};u([p({constructOnly:!0})],ib.prototype,"rctx",void 0),u([p({constructOnly:!0})],ib.prototype,"viewingMode",void 0),u([p({constructOnly:!0})],ib.prototype,"planetRadius",void 0),u([p({constructOnly:!0})],ib.prototype,"requestRender",void 0),ib=u([P("esri.views.3d.environment.CloudsComposition")],ib);const lWe=new ii;function Jh(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function cWe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function rQ(t,e,r,i,s,n,o,a,l,c){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t[4]=n,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t}function iQ(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Qh(t,e){if(t===e){const r=e[1],i=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=i,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function $x(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],d=h*o-a*c,f=-h*n+a*l,m=c*n-o*l;let g=r*d+i*f+s*m;return g?(g=1/g,t[0]=d*g,t[1]=(-h*i+s*c)*g,t[2]=(a*i-s*o)*g,t[3]=f*g,t[4]=(h*r-s*l)*g,t[5]=(-a*r+s*n)*g,t[6]=m*g,t[7]=(-c*r+i*l)*g,t[8]=(o*r-i*n)*g,t):null}function uWe(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8];return t[0]=o*h-a*c,t[1]=s*c-i*h,t[2]=i*a-s*o,t[3]=a*l-n*h,t[4]=r*h-s*l,t[5]=s*n-r*a,t[6]=n*c-o*l,t[7]=i*l-r*c,t[8]=r*o-i*n,t}function hWe(t){const e=t[0],r=t[1],i=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*(c*n-o*l)+r*(-c*s+o*a)+i*(l*s-n*a)}function UE(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=e[8],f=r[0],m=r[1],g=r[2],_=r[3],v=r[4],b=r[5],T=r[6],x=r[7],S=r[8];return t[0]=f*i+m*o+g*c,t[1]=f*s+m*a+g*h,t[2]=f*n+m*l+g*d,t[3]=_*i+v*o+b*c,t[4]=_*s+v*a+b*h,t[5]=_*n+v*l+b*d,t[6]=T*i+x*o+S*c,t[7]=T*s+x*a+S*h,t[8]=T*n+x*l+S*d,t}function z5(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=e[8],f=r[0],m=r[1];return t[0]=i,t[1]=s,t[2]=n,t[3]=o,t[4]=a,t[5]=l,t[6]=f*i+m*o+c,t[7]=f*s+m*a+h,t[8]=f*n+m*l+d,t}function sQ(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=e[8],f=Math.sin(r),m=Math.cos(r);return t[0]=m*i+f*o,t[1]=m*s+f*a,t[2]=m*n+f*l,t[3]=m*o-f*i,t[4]=m*a-f*s,t[5]=m*l-f*n,t[6]=c,t[7]=h,t[8]=d,t}function nQ(t,e,r){const i=r[0],s=r[1],n=r[2];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=n*e[6],t[7]=n*e[7],t[8]=n*e[8],t}function dWe(t,e,r){const i=r[0],s=r[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t}function pWe(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function fWe(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=-r,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function mWe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function gWe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function k8(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=r+r,a=i+i,l=s+s,c=r*o,h=i*o,d=i*a,f=s*o,m=s*a,g=s*l,_=n*o,v=n*a,b=n*l;return t[0]=1-d-g,t[3]=h-b,t[6]=f+v,t[1]=h+b,t[4]=1-c-g,t[7]=m-_,t[2]=f-v,t[5]=m+_,t[8]=1-c-d,t}function qxe(t,e){const r=e[0],i=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],h=e[10],d=h*o-a*c,f=-h*n+a*l,m=c*n-o*l,g=r*d+i*f+s*m;if(!g)return null;const _=1/g;return t[0]=d*_,t[1]=(-h*i+s*c)*_,t[2]=(a*i-s*o)*_,t[3]=f*_,t[4]=(h*r-s*l)*_,t[5]=(-a*r+s*n)*_,t[6]=m*_,t[7]=(-c*r+i*l)*_,t[8]=(o*r-i*n)*_,t}function gv(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],d=e[9],f=e[10],m=e[11],g=e[12],_=e[13],v=e[14],b=e[15],T=r*a-i*o,x=r*l-s*o,S=r*c-n*o,E=i*l-s*a,A=i*c-n*a,R=s*c-n*l,M=h*_-d*g,D=h*v-f*g,k=h*b-m*g,L=d*v-f*_,N=d*b-m*_,q=f*b-m*v;let X=T*q-x*N+S*L+E*k-A*D+R*M;return X?(X=1/X,t[0]=(a*q-l*N+c*L)*X,t[1]=(l*k-o*q-c*D)*X,t[2]=(o*N-a*k+c*M)*X,t[3]=(s*N-i*q-n*L)*X,t[4]=(r*q-s*k+n*D)*X,t[5]=(i*k-r*N-n*M)*X,t[6]=(_*R-v*A+b*E)*X,t[7]=(v*S-g*R-b*x)*X,t[8]=(g*A-_*S+b*T)*X,t):null}function yWe(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function _We(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function vWe(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2)}function bWe(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t}function Wxe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}function wWe(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t}function xWe(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t}function TWe(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function SWe(t,e){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],d=e[0],f=e[1],m=e[2],g=e[3],_=e[4],v=e[5],b=e[6],T=e[7],x=e[8],S=cl();return Math.abs(r-d)<=S*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(i-f)<=S*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(s-m)<=S*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(n-g)<=S*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(o-_)<=S*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(a-v)<=S*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(l-b)<=S*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(c-T)<=S*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(h-x)<=S*Math.max(1,Math.abs(h),Math.abs(x))}function oQ(t){const e=cl(),r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8];return Math.abs(1-(r*r+n*n+l*l))<=e&&Math.abs(1-(i*i+o*o+c*c))<=e&&Math.abs(1-(s*s+a*a+h*h))<=e}const EWe=UE,CWe=Wxe;Object.freeze(Object.defineProperty({__proto__:null,add:bWe,adjoint:uWe,copy:cWe,determinant:hWe,equals:SWe,exactEquals:TWe,frob:vWe,fromMat2d:gWe,fromMat4:Jh,fromQuat:k8,fromRotation:fWe,fromScaling:mWe,fromTranslation:pWe,identity:iQ,invert:$x,isOrthoNormal:oQ,mul:EWe,multiply:UE,multiplyScalar:wWe,multiplyScalarAndAdd:xWe,normalFromMat4:gv,normalFromMat4Legacy:qxe,projection:yWe,rotate:sQ,scale:nQ,scaleByVec2:dWe,set:rQ,str:_We,sub:CWe,subtract:Wxe,translate:z5,transpose:Qh},Symbol.toStringTag,{value:"Module"}));function ls(){return new Float32Array(3)}function V5(t){const e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Qr(t,e,r){const i=new Float32Array(3);return i[0]=t,i[1]=e,i[2]=r,i}function Xxe(t,e){return new Float32Array(t,e,3)}function aQ(){return ls()}function Yxe(){return Qr(1,1,1)}function Zxe(){return Qr(1,0,0)}function Jxe(){return Qr(0,1,0)}function Qxe(){return Qr(0,0,1)}const AWe=aQ(),OWe=Yxe(),RWe=Zxe(),MWe=Jxe(),PWe=Qxe();Object.freeze(Object.defineProperty({__proto__:null,ONES:OWe,UNIT_X:RWe,UNIT_Y:MWe,UNIT_Z:PWe,ZEROS:AWe,clone:V5,create:ls,createView:Xxe,fromValues:Qr,ones:Yxe,unitX:Zxe,unitY:Jxe,unitZ:Qxe,zeros:aQ},Symbol.toStringTag,{value:"Module"}));var Dl;(function(t){t[t.SIXTEEN=0]="SIXTEEN",t[t.HUNDRED=1]="HUNDRED",t[t.TWOHUNDRED=2]="TWOHUNDRED",t[t.COUNT=3]="COUNT"})(Dl||(Dl={}));let bN=class extends Sa{constructor(){super(...arguments),this.steps=Dl.SIXTEEN,this.writeTextureChannels=Xw.RG}};u([B({count:Dl.COUNT})],bN.prototype,"steps",void 0),u([B({constValue:ae("esri-mobile")?1024:2048})],bN.prototype,"cubeMapSize",void 0),u([B()],bN.prototype,"writeTextureChannels",void 0);let lO=class{constructor(e,r,i,s,n,o,a,l,c=.5){this.coverage=e,this.density=r,this.absorption=i,this.cloudSize=s,this.detailSize=n,this.smoothness=o,this.cloudHeight=a,this.raymarchingSteps=l,this.median=c}};const dne=new lO([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],Dl.SIXTEEN),oa={sunny:dne,cloudy:new lO([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],Dl.TWOHUNDRED,.6),rainy:new lO([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],Dl.TWOHUNDRED,.4),snowy:new lO([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],Dl.HUNDRED,.65),foggy:new lO([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],Dl.SIXTEEN),default:dne},Sh=ae("esri-mobile")?64:128,IWe=Sh/128,Wd=Math.ceil(Math.sqrt(Sh)),K_=(Sh+2)*Wd,$We=1e5,mk=128,LWe=K_/1560;function id(t,e=!0){t.attributes.add(C.POSITION,"vec2"),e&&t.varyings.add("uv","vec2"),t.vertex.code.add(w`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${e?w`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}let SM=class extends ps{constructor(e,r){super(e,"mat3",ti.Draw,(i,s,n)=>i.setUniformMatrix3fv(e,r(s,n)))}},Kxe=class extends ii{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.raymarchingSteps=oa.default.raymarchingSteps,this.weatherTile=He()}},eTe=class extends ii{constructor(){super(...arguments),this.viewMatrix=ki()}};function DWe(t){const e=new Sr;e.include(id,!1);const r=e.fragment;return r.uniforms.add(new Ie("cloudRadius",i=>i.cloudRadius),new Ie("power",i=>St(35,120,i.absorption)),new Ie("sigmaE",i=>1+i.absorption),new Ie("density",i=>St(0,.3,i.density)),new Ie("cloudSize",i=>St(0,.02,Math.max(.01,1-i.cloudSize))),new Ie("detailSize",i=>St(0,.2,Math.max(.01,1-i.detailSize))),new Ie("smoothness",i=>St(0,.5,1-i.smoothness)),new Ie("cloudHeight",i=>St(0,1500,i.cloudHeight)),new Ie("coverage",i=>i.coverage),new SM("view",i=>i.viewMatrix),new rt("cloudShapeTexture",i=>i.noiseTexture!=null?i.noiseTexture.textureAtlas:null),new Ar("cloudVariables",i=>or(NWe,i.coverage,i.absorption))),r.constants.add("halfCubeMapSize","float",.5*t.cubeMapSize),r.code.add(w`
    const int STEPS = ${t.steps===Dl.SIXTEEN?w`16`:t.steps===Dl.HUNDRED?w`100`:w`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),r.code.add(w`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${w.float(K_)};
      const float dataWidth = ${w.float(K_)};
      const float tileRows = ${w.float(Wd)};
      const vec3 atlasDimensions = vec3(${w.float(Sh)}, ${w.float(Sh)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${w.float(IWe)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = (${w.float(LWe)} * p) / ${w.float(K_)} + 0.5;

      return texture(cloudShapeTexture, uv).a;
    }
    `),r.code.add(w`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),r.code.add(w`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),r.code.add(`
    float multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      float luminance = 0.0;

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),r.code.add(w`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),r.code.add(w`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),r.code.add(w`void main() {
if (coverage ==  0.0) {
fragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`),e}const NWe=He(),FWe=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:eTe,CloudsPassParameters:Kxe,build:DWe},Symbol.toStringTag,{value:"Module"}));let tTe=class rTe extends Lr{constructor(e,r){super(e,r,()=>this.destroy())}initializeProgram(e){return new Rr(e.rctx,rTe.shader.get().build(this.configuration),Tr)}initializePipeline(){return Mt({blending:zc(Se.CONSTANT_COLOR,Se.ONE_MINUS_CONSTANT_COLOR,vm.ADD,this.configuration.writeTextureChannels===Xw.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:ri.LEQUAL},colorWrite:Bt})}};tTe.shader=new Or(FWe,()=>he(()=>import("./Clouds.glsl-c6106007.js"),[],import.meta.url));var bu;(function(t){t[t.Full=0]="Full",t[t.WeatherMap=1]="WeatherMap",t[t.COUNT=2]="COUNT"})(bu||(bu={}));let Hj=class extends Sa{constructor(){super(...arguments),this.mode=bu.Full}};u([B({count:bu.COUNT})],Hj.prototype,"mode",void 0);let iTe=class extends ii{constructor(){super(...arguments),this.weatherTile=fr(0,0)}};function UWe(t){const e=new Sr;return e.include(id,!1),e.fragment.code.add(w`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),t.mode===bu.Full&&e.fragment.code.add(w`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${w.float(Wd)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${w.float(8)});

      float worley0 = worley(p, ${w.float(2)} * 2.0);
      float worley1 = worley(p, ${w.float(2)} * 8.0);
      float worley2 = worley(p, ${w.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${w.float(2)});
      float worley1 = worley(p, ${w.float(2)} * 2.0);
      float worley2 = worley(p, ${w.float(2)} * 4.0);
      float worley3 = worley(p, ${w.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),e.fragment.uniforms.add(new Ar("weatherTile",r=>r.weatherTile)),e.fragment.code.add(w`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${w.float(mk)});

      // Get global coordinates of p
      p += weatherTile * ${w.float(mk)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${w.float($We)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),e.fragment.code.add(w`void main() {`),t.mode===bu.Full&&e.fragment.code.add(w`
        float padWidth = 1.0;
        float paddedSize = ${w.float(Sh)} + 2.0 * padWidth;
        float tileCount = ${w.float(Wd)} * ${w.float(Wd)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${w.float(Sh)};
          }

          if (startPadY) {
            pixel.y += ${w.float(Sh)};
          }

          if (endPadX) {
            pixel.x -= ${w.float(Sh)};
          }

          if (endPadY) {
            pixel.y -= ${w.float(Sh)};
          }

          uv = vec2(pixel.xy / ${w.float(Sh)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${w.float(Sh)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${w.float(Wd)} * ${w.float(Wd)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        fragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${w.float(Wd)} * ${w.float(Wd)});
        p = p_;
        p.z /= (${w.float(Wd)} * ${w.float(Wd)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        fragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),e.fragment.code.add(w`
      vec2 mapUV = ${w.float(mk)} * (gl_FragCoord.xy / ${w.float(K_)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${t.mode===bu.Full?w`fragColor.ba = vec2(0.0, map);`:w`fragColor = vec4(map);`};
    }
  `),e}const kWe=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:iTe,build:UWe},Symbol.toStringTag,{value:"Module"}));let qj=class sTe extends Lr{initializeProgram(e){return new Rr(e.rctx,sTe.shader.get().build(this.configuration),Tr)}initializePipeline(){return Mt({blending:this.configuration.mode===bu.Full?zc(Se.ONE,Se.ZERO):Oo(Se.ZERO,Se.ONE,Se.ONE,Se.ZERO),depthTest:{func:ri.ALWAYS},colorWrite:Bt})}};qj.shader=new Or(kWe,()=>he(()=>import("./NoiseTextureAtlas.glsl-b1fc5660.js"),[],import.meta.url));let B5=class{constructor(e,r,i=r){this.internalFormat=e,this.width=r,this.height=i,this.multisampled=!1,this.samples=1}};function zWe(t){return t.width<=0||t.height<=0||t.internalFormat==null?0:t.width*t.height*ZJ(t.internalFormat)}let VWe=class{constructor(e,r){this._context=e,this._descriptor=r,this.type=fv.RenderBuffer,this._context.instanceCounter.increment(In.Renderbuffer,this);const i=this._context.gl;this.glName=i.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:s,height:n,internalFormat:o,multisampled:a}=r;if(a){if(this._context.type!==lr.WEBGL2)throw new Error("Multisampled renderbuffers are not supported in WebGL1!");i.renderbufferStorageMultisample(i.RENDERBUFFER,this.samples,o,s,n)}else i.renderbufferStorage(i.RENDERBUFFER,o,s,n)}get descriptor(){return this._descriptor}get samples(){const e=this._descriptor.samples,r=this._context.parameters.maxSamples;return e?Math.min(e,r):r}get gpuMemoryUsage(){return zWe(this._descriptor)}resize(e,r){const i=this._descriptor;if(i.width===e&&i.height===r)return;i.width=e,i.height=r;const s=this._context.gl;this._context.bindRenderbuffer(this),i.multisampled?s.renderbufferStorageMultisample(s.RENDERBUFFER,this.samples,i.internalFormat,i.width,i.height):s.renderbufferStorage(s.RENDERBUFFER,i.internalFormat,i.width,i.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(In.Renderbuffer,this),this._context=pC(this._context))}};const BWe=K.getLogger("esri.views.webgl.FramebufferObject");let fn=class T2{constructor(e,r,i=null){this._context=e,this._glName=null,this._colorAttachments=new Map,this._depthBuffer=null,this._stencilBuffer=null,this._depthStencilTexture=null,this._initialized=!1,e.instanceCounter.increment(In.FramebufferObject,this);const s=wN(r)?r:new Ot(this._context,r);if(this._colorAttachments.set(lu.COLOR_ATTACHMENT0,s),this._validateTextureDescriptor(s.descriptor),this._validateColorAttachmentPoint(lu.COLOR_ATTACHMENT0),i!=null)if(jWe(i))this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),this._depthStencilTexture=wN(i)?i:new Ot(this._context,i),this._validateTextureDescriptor(this._depthStencilTexture.descriptor);else{const n=GWe(i)?i:new VWe(this._context,i),o=n.descriptor;o.internalFormat===Zs.STENCIL_INDEX8?this._stencilBuffer=n:this._depthBuffer=n,this._validateRenderBufferDescriptor(o)}}dispose(){if(this._colorAttachments.size===0&&!this._glName)return;const e=this._context.getBoundFramebufferObject();this._colorAttachments.forEach((r,i)=>this.detachColorTexture(i)?.dispose()),this.detachDepthStencilBuffer()?.dispose(),this.detachDepthStencilTexture()?.dispose(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(e),this._context.instanceCounter.decrement(In.FramebufferObject,this)}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(lu.COLOR_ATTACHMENT0)}get depthStencilAttachment(){return this._depthStencilTexture||this._depthBuffer||this._stencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._colorAttachments.get(lu.COLOR_ATTACHMENT0)?.descriptor?.width??0}get height(){return this._colorAttachments.get(lu.COLOR_ATTACHMENT0)?.descriptor?.height??0}get gpuMemoryUsage(){return[...this._colorAttachments].reduce((e,[r,i])=>e+i.gpuMemoryUsage,this.depthStencilAttachment?.gpuMemoryUsage??0)}getColorTexture(e){const r=this._colorAttachments.get(e);return r&&wN(r)?r:null}attachColorTexture(e,r=lu.COLOR_ATTACHMENT0){if(!e)return;this._validateColorAttachmentPoint(r);const i=e.descriptor;this._validateTextureDescriptor(i),this.detachColorTexture(r)?.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,r)),this._colorAttachments.set(r,e)}detachColorTexture(e=lu.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(e);if(r)return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e)),this._colorAttachments.delete(e),r}setColorTextureTarget(e,r=lu.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(r);i&&this._framebufferTexture2D(i.glName,r,e)}attachDepthStencil(e){if(e)switch(e.type){case fv.Texture:return this._attachDepthStencilTexture(e);case fv.RenderBuffer:return this._attachDepthStencilBuffer(e)}}_attachDepthStencilTexture(e){if(e==null)return;const r=e.descriptor;r.pixelFormat!==Ct.DEPTH_STENCIL&&r.pixelFormat!==Ct.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),r.dataType!==qs.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),this._validateTextureDescriptor(r),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,Kse)),this._depthStencilTexture?.dispose(),this._depthStencilTexture=e}detachDepthStencilTexture(){const e=this._depthStencilTexture;return e&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,Kse)),this._depthStencilTexture=null,e}_attachDepthStencilBuffer(e){if(e==null)return;const r=e.descriptor;if(r.internalFormat!==Zs.DEPTH_STENCIL&&r.internalFormat!==Zs.DEPTH_COMPONENT16&&console.error("Depth/Stencil buffer must have correct internalFormat"),this._validateRenderBufferDescriptor(r),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const i=this._context.gl,s=this._getGLAttachmentPoint(r);i.framebufferRenderbuffer(yo.FRAMEBUFFER,s,i.RENDERBUFFER,e.glName)}this._depthBuffer?.dispose(),this._depthBuffer=e}detachDepthStencilBuffer(){const e=this._depthBuffer;if(e&&this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl,i=this._getGLAttachmentPoint(e.descriptor);r.framebufferRenderbuffer(yo.FRAMEBUFFER,i,r.RENDERBUFFER,null),e.dispose()}return this._depthBuffer=null,e}copyToTexture(e,r,i,s,n,o,a){(e<0||r<0||n<0||o<0)&&console.error("Offsets cannot be negative!"),(i<=0||s<=0)&&console.error("Copy width and height must be greater than zero!");const l=a.descriptor;a.descriptor.target!==cs.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),(l?.width==null||l?.height==null||e+i>this.width||r+s>this.height||n+i>l.width||o+s>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const c=this._context,h=c.bindTexture(a,Ot.TEXTURE_UNIT_FOR_UPDATES);c.setActiveTexture(Ot.TEXTURE_UNIT_FOR_UPDATES),c.bindFramebuffer(this),c.gl.copyTexSubImage2D(cs.TEXTURE_2D,0,n,o,e,r,i,s),c.bindTexture(h,Ot.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,r,i,s,n,o,a){(i<=0||s<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,r,i,s,n,o,a)}async readPixelsAsync(e,r,i,s,n,o,a){if(this._context.type!==lr.WEBGL2)return vh()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),void this.readPixels(e,r,i,s,n,o,a);const l=this._context.gl,c=kr.createPixelPack(this._context,Cr.STREAM_READ,a.byteLength);this._context.bindBuffer(c),this._context.bindFramebuffer(this),l.readPixels(e,r,i,s,n,o,0),this._context.unbindBuffer(Tt.PIXEL_PACK_BUFFER),await c.getSubDataAsync(a),c.dispose()}resize(e,r){if(this.width===e&&this.height===r)return;const i={width:e,height:r};sw(i,this._context.parameters.maxTextureSize),this._colorAttachments.forEach(s=>s.resize(i.width,i.height)),this._depthStencilTexture?.resize(i.width,i.height),this._initialized&&(sw(i,this._context.parameters.maxRenderbufferSize),this._depthBuffer?.resize(i.width,i.height),this._stencilBuffer?.resize(i.width,i.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}initializeAndBind(e=yo.FRAMEBUFFER){const r=this._context.gl;if(this._initialized)return void r.bindFramebuffer(e,this.glName);this._glName&&r.deleteFramebuffer(this._glName);const i=r.createFramebuffer();r.bindFramebuffer(e,i),this._colorAttachments.forEach((n,o)=>this._framebufferTexture2D(n.glName,o,pne(n),e));const s=this._depthBuffer||this._stencilBuffer;if(s){const n=this._getGLAttachmentPoint(s.descriptor);r.framebufferRenderbuffer(e,n,r.RENDERBUFFER,s.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,r.DEPTH_STENCIL_ATTACHMENT,pne(this._depthStencilTexture),e);vh()&&r.checkFramebufferStatus(e)!==r.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=i,this._initialized=!0}_framebufferTexture2D(e,r=lu.COLOR_ATTACHMENT0,i=cs.TEXTURE_2D,s=yo.FRAMEBUFFER,n=0){this._context.gl.framebufferTexture2D(s,r,i,e,n)}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthBuffer){if(this._initialized){this._context.bindFramebuffer(this);const r=this._getGLAttachmentPoint(this._depthBuffer.descriptor);e.framebufferRenderbuffer(yo.FRAMEBUFFER,r,e.RENDERBUFFER,null)}this._depthBuffer=je(this._depthBuffer)}this._stencilBuffer&&(this._initialized&&(this._context.bindFramebuffer(this),e.framebufferRenderbuffer(yo.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,null)),this._stencilBuffer=je(this._stencilBuffer)),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=je(this._depthStencilTexture))}_validateTextureDescriptor(e){e.target!==cs.TEXTURE_2D&&e.target!==cs.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),sw(e,this._context.parameters.maxTextureSize),this._validateBufferDimensions(e)}_validateRenderBufferDescriptor(e){sw(e,this._context.parameters.maxRenderbufferSize),this._validateBufferDimensions(e)}_validateBufferDimensions(e){e.width<=0&&(e.width=this.width),e.height<=0&&(e.height=this.height),this.width>0&&this.height>0&&(this.width===e.width&&this.height===e.height||console.error("Attachment size must match framebuffer size!"))}_getGLAttachmentPoint(e){switch(e.internalFormat){case Zs.DEPTH_COMPONENT16:case Zs.DEPTH_COMPONENT24:case Zs.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;case Zs.DEPTH24_STENCIL8:case Zs.DEPTH32F_STENCIL8:case Zs.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;case Zs.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(e){if(T2._MAX_COLOR_ATTACHMENTS===-1){const i=this._context.capabilities.drawBuffers;if(i){const s=this._context.gl;T2._MAX_COLOR_ATTACHMENTS=s.getParameter(i.MAX_COLOR_ATTACHMENTS)}else T2._MAX_COLOR_ATTACHMENTS=1}const r=e-lu.COLOR_ATTACHMENT0;r+1>T2._MAX_COLOR_ATTACHMENTS&&K.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${r+1}. Implementation supports up to ${T2._MAX_COLOR_ATTACHMENTS} color attachments`)}};function wN(t){return t!=null&&"type"in t&&t.type===fv.Texture}function GWe(t){return t!=null&&"type"in t&&t.type===fv.RenderBuffer}function jWe(t){return wN(t)||t!=null&&"pixelFormat"in t}function sw(t,e){const r=Math.max(t.width,t.height);if(r>e){BWe.warn(`Resizing FBO attachment size ${t.width}x${t.height} to device limit ${e}`);const i=e/r;return t.width=Math.round(t.width*i),t.height=Math.round(t.height*i),!1}return!0}function pne(t){return t.descriptor.target===cs.TEXTURE_CUBE_MAP?cs.TEXTURE_CUBE_MAP_POSITIVE_X:cs.TEXTURE_2D}fn._MAX_COLOR_ATTACHMENTS=-1;let cO=class extends Te{constructor(e){super(e),this._needsRender=!0,this._passParameters=new iTe,this._frameBuffer=new fn(e.context.renderContext.rctx,new xr(K_)),this._vao=Hl(e.context.renderContext.rctx)}get _techniqueRepository(){return this.context.techniqueRepository}get textureAtlas(){return this._texture!=null?this._weatherMapTechnique!=null&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render(bu.WeatherMap)):this._fullTechnique!=null&&this._fullTechnique.compiled&&(this._texture=this._render(bu.Full)),this._texture}_setDirty(){this._needsRender=!0}updateWeatherMap(e){this._passParameters.weatherTile[0]===e[0]&&this._passParameters.weatherTile[1]===e[1]||(yn(this._passParameters.weatherTile,e),this._setDirty())}destroy(){this._fullTechniqueCached=Gi(this._fullTechniqueCached),this._weatherMapTechniqueCached=Gi(this._weatherMapTechniqueCached),this._frameBuffer=je(this._frameBuffer),this._vao=je(this._vao)}get _fullTechnique(){if(this._fullTechniqueCached==null){const e=new Hj;e.mode=bu.Full,this._fullTechniqueCached=this._techniqueRepository.acquire(qj,e)}return this._fullTechniqueCached}get _weatherMapTechnique(){if(this._weatherMapTechniqueCached==null){const e=new Hj;e.mode=bu.WeatherMap,this._weatherMapTechniqueCached=this._techniqueRepository.acquire(qj,e)}return this._weatherMapTechniqueCached}_render(e){if(this._vao==null||this._frameBuffer==null)return null;const r=e===bu.Full?this._fullTechnique:this._weatherMapTechnique,i=this.context.renderContext.rctx,s=i.getViewport();i.setViewport(0,0,K_,K_),i.bindFramebuffer(this._frameBuffer);const n=i.bindTechnique(r,this._passParameters,null);return i.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao),i.gl.drawArrays(i.gl.TRIANGLE_STRIP,0,4),i.setViewport(s.x,s.y,s.width,s.height),this._needsRender=!1,this._frameBuffer.colorTexture}};u([p({constructOnly:!0})],cO.prototype,"context",void 0),u([p({readOnly:!0})],cO.prototype,"_techniqueRepository",null),cO=u([P("esri.views.3d.environment.NoiseTextureAtlas")],cO);function nTe(t){t.include(Nu),t.uniforms.add(new rt("geometryDepthTexture",(e,r)=>r.multipassGeometry.linearDepthTexture),new Ar("nearFar",(e,r)=>r.camera.nearFar)),t.code.add(w`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}let HWe=class{constructor(){this.enabled=!1}};function Fu(t,e){e.hasMultipassTerrain&&(t.fragment.include(Nu),t.fragment.uniforms.add(new rt("terrainDepthTexture",(r,i)=>i.multipassTerrain.linearDepthTexture)),t.fragment.uniforms.add(new Ar("nearFar",(r,i)=>i.camera.nearFar)),t.fragment.uniforms.add(new Ar("inverseViewport",(r,i)=>i.inverseViewport)),t.fragment.code.add(w`
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){
      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${e.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `))}let qWe=class{constructor(){this.enabled=!1,this.cullAboveGround=!1}};function WWe(t,e){const r=t.fragment;r.include(Nu),r.uniforms.add(new Ar("nearFar",(i,s)=>s.camera.nearFar)),r.uniforms.add(new rt("depthMap",(i,s)=>s.linearDepthTexture)),r.uniforms.add(new Ui("proj",(i,s)=>s.ssr.camera.projectionMatrix)),r.uniforms.add(new Ie("invResolutionHeight",(i,s)=>1/s.ssr.camera.height)),r.uniforms.add(new Ui("reprojectionMatrix",(i,s)=>s.ssr.reprojectionMatrix)),r.code.add(w`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${e.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}let XWe=class{constructor(){this.enabled=!1,this.fadeFactor=1,this.reprojectionMatrix=xe()}};function z8(t){return t?{ray:eo(t.ray),c0:t.c0,c1:t.c1}:{ray:eo(),c0:0,c1:Number.MAX_VALUE}}function YWe(t,e=z8()){return P5(t,e.ray),e.c0=0,e.c1=Number.MAX_VALUE,e}function ZWe(t,e,r=z8()){const i=Re(t.vector);return Nbe(t.origin,e,r.ray),r.c0=0,r.c1=i,r}function p8t(t,e){return oTe(t,t.c0,e)}function f8t(t,e){return oTe(t,t.c1,e)}function oTe(t,e,r){return de(r,t.ray.origin,se(r,t.ray.direction,e))}new M0(()=>z8());function EM(t){return t?[Fr(t[0]),Fr(t[1]),Fr(t[2]),Fr(t[3]),Fr(t[4]),Fr(t[5])]:[Fr(),Fr(),Fr(),Fr(),Fr(),Fr()]}function aTe(){return[O(),O(),O(),O(),O(),O(),O(),O()]}function G5(t,e){for(let r=0;r<IC;r++)A8(t[r],e[r])}function lTe(t,e,r,i=rXe){const s=ai(SJ.get(),e,t);$n(s,s);for(let n=0;n<eXe;++n){const o=xu(TJ.get(),tXe[n],s);ne(i[n],o[0]/o[3],o[1]/o[3],o[2]/o[3])}cTe(r,i)}function cTe(t,e){ua(e[et.FAR_BOTTOM_LEFT],e[et.NEAR_BOTTOM_LEFT],e[et.NEAR_TOP_LEFT],t[pi.LEFT]),ua(e[et.NEAR_BOTTOM_RIGHT],e[et.FAR_BOTTOM_RIGHT],e[et.FAR_TOP_RIGHT],t[pi.RIGHT]),ua(e[et.FAR_BOTTOM_LEFT],e[et.FAR_BOTTOM_RIGHT],e[et.NEAR_BOTTOM_RIGHT],t[pi.BOTTOM]),ua(e[et.NEAR_TOP_LEFT],e[et.NEAR_TOP_RIGHT],e[et.FAR_TOP_RIGHT],t[pi.TOP]),ua(e[et.NEAR_BOTTOM_LEFT],e[et.NEAR_BOTTOM_RIGHT],e[et.NEAR_TOP_RIGHT],t[pi.NEAR]),ua(e[et.FAR_BOTTOM_RIGHT],e[et.FAR_BOTTOM_LEFT],e[et.FAR_TOP_LEFT],t[pi.FAR])}function B_(t,e){for(let r=0;r<IC;r++){const i=t[r];if(i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]>=e[3])return!1}return!0}function JWe(t,e){return hTe(t,YWe(e,dTe.get()))}function m8t(t,e){for(let r=0;r<IC;r++){const i=t[r];if(!hBe(i,e))return!1}return!0}function QWe(t,e,r){return hTe(t,ZWe(e,r,dTe.get()))}function uTe(t,e){for(let r=0;r<IC;r++)if(fi(t[r],e)>0)return!1;return!0}function hTe(t,e){for(let r=0;r<IC;r++)if(!uBe(t[r],e))return!1;return!0}var pi,et;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.TOP=3]="TOP",t[t.NEAR=4]="NEAR",t[t.FAR=5]="FAR"})(pi||(pi={})),function(t){t[t.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",t[t.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",t[t.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",t[t.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",t[t.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",t[t.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",t[t.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",t[t.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(et||(et={}));const KWe={bottom:[et.FAR_BOTTOM_RIGHT,et.NEAR_BOTTOM_RIGHT,et.NEAR_BOTTOM_LEFT,et.FAR_BOTTOM_LEFT],near:[et.NEAR_BOTTOM_LEFT,et.NEAR_BOTTOM_RIGHT,et.NEAR_TOP_RIGHT,et.NEAR_TOP_LEFT],far:[et.FAR_BOTTOM_RIGHT,et.FAR_BOTTOM_LEFT,et.FAR_TOP_LEFT,et.FAR_TOP_RIGHT],right:[et.NEAR_BOTTOM_RIGHT,et.FAR_BOTTOM_RIGHT,et.FAR_TOP_RIGHT,et.NEAR_TOP_RIGHT],left:[et.FAR_BOTTOM_LEFT,et.NEAR_BOTTOM_LEFT,et.NEAR_TOP_LEFT,et.FAR_TOP_LEFT],top:[et.FAR_TOP_LEFT,et.NEAR_TOP_LEFT,et.NEAR_TOP_RIGHT,et.FAR_TOP_RIGHT]},IC=6,eXe=8,tXe=[Nt(-1,-1,-1,1),Nt(1,-1,-1,1),Nt(1,1,-1,1),Nt(-1,1,-1,1),Nt(-1,-1,1,1),Nt(1,-1,1,1),Nt(1,1,1,1),Nt(-1,1,1,1)],dTe=new M0(z8),rXe=aTe();function iXe(t,e,r){return 2*Math.atan(Math.sqrt(e*e+r*r)*Math.tan(.5*t)/e)}function sXe(t,e,r){return 2*Math.atan(Math.sqrt(e*e+r*r)*Math.tan(.5*t)/r)}function nXe(t,e,r){return 2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(e*e+r*r))}function oXe(t,e,r){return 2*Math.atan(r*Math.tan(.5*t)/Math.sqrt(e*e+r*r))}var Wj;let yt=Wj=class extends Te{constructor(t={}){super(t),this._center=O(),this._up=O(),this._viewUp=O(),this._viewForward=O(),this._viewRight=O(),this._ray=eo(),this._viewport=Nt(0,0,1,1),this._padding=Nt(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=fr(1,1e3),this._viewDirty=!0,this._viewMatrix=xe(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=xe(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=xe(),this._frustumDirty=!0,this._frustum=EM(),this._fullViewport=Wt(),this._pixelRatio=1,this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center,"_center")}get ray(){return fe(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){zs(this._viewMatrix,t),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get screenViewport(){if(this.pixelRatio===1)return this._viewport;const t=Uw(Wt(),this._viewport,1/this.pixelRatio),e=this._get("screenViewport");return e&&c5(t,e)?e:t}get screenPadding(){if(this.pixelRatio===1)return this._padding;const t=Uw(Wt(),this._padding,1/this.pixelRatio),e=this._get("screenPadding");return e&&c5(t,e)?e:t}get x(){return this._viewport[0]}set x(t){t+=this._padding[er.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(t){t+=this._padding[er.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[er.RIGHT]+this._padding[er.LEFT]}set fullWidth(t){this.width=t-(this._padding[er.RIGHT]+this._padding[er.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[er.TOP]+this._padding[er.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[er.TOP]+this._padding[er.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[er.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[er.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){MS(this._padding,t)||(this._viewport[0]+=t[er.LEFT]-this._padding[er.LEFT],this._viewport[1]+=t[er.BOTTOM]-this._padding[er.BOTTOM],this._viewport[2]-=t[er.RIGHT]+t[er.LEFT]-(this._padding[er.RIGHT]+this._padding[er.LEFT]),this._viewport[3]-=t[er.TOP]+t[er.BOTTOM]-(this._padding[er.TOP]+this._padding[er.BOTTOM]),Nh(this._padding,t),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&(ai(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){const t=this.width,e=this.height,r=this.near*Math.tan(this.fovY/2),i=r*this._aspect,s=L1e(xe(),-i*(1+2*this._padding[er.LEFT]/t),i*(1+2*this._padding[er.RIGHT]/t),-r*(1+2*this._padding[er.BOTTOM]/e),r*(1+2*this._padding[er.TOP]/e),this.near,this.far),n=this._get("projectionMatrix");return n&&dJ(n,s)?n:s}get inverseProjectionMatrix(){return $n(xe(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||xe()}get fov(){return this._fov}set fov(t){this._fov=t,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return nXe(this._fov,this.width,this.height)}set fovX(t){this._fov=iXe(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return oXe(this._fov,this.width,this.height)}set fovY(t){this._fov=sXe(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return mi(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&($n(this._viewInverseTransposeMatrix,this.viewMatrix),kc(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const e=2*t-1;return 2*this.near*this.far/(this.far+this.near-e*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation!=null&&this.relativeElevation>=0}copyFrom(t){ie(this._ray.origin,t.eye),this.center=t.center,this.up=t.up,Nh(this._viewport,t.viewport),this.notifyChange("_viewport"),Nh(this._padding,t.padding),this.notifyChange("_padding"),yn(this._nearFar,t.nearFar),this.notifyChange("_nearFar"),this._fov=t.fov,this.relativeElevation=t.relativeElevation;const e=t;return this._viewDirty=e._viewDirty,this._viewDirty||(zs(this._viewMatrix,t.viewMatrix),ie(this._viewRight,t.viewRight),ie(this._viewUp,t.viewUp),ie(this._viewForward,t.viewForward)),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||(G5(this._frustum,t.frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(zs(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),Nh(this._fullViewport,t.fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up}clone(){return new Wj().copyFrom(this)}equals(t){return ma(this.eye,t.eye)&&ma(this.center,t.center)&&ma(this.up,t.up)&&MS(this._viewport,t.viewport)&&MS(this._padding,t.padding)&&yxe(this.nearFar,t.nearFar)&&this._fov===t.fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation}almostEquals(t){if(Math.abs(t.fov-this._fov)>=.001||l5(t.screenPadding,this.screenPadding)>=1||l5(this.screenViewport,t.screenViewport)>=1)return!1;Pn(Ko,t.eye,t.center),Pn(gk,this.eye,this.center);const e=ye(Ko,gk),r=bB(Ko),i=bB(gk),s=5e-4;return e*e>=(1-1e-10)*r*i&&X6(t.eye,this.eye)<Math.max(r,i)*s*s}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(yR(this.viewForward,fe(Ko,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,e){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(t=Qi()){return t[0]=(this.padding[er.LEFT]+this.width/2)/this.pixelRatio,t[1]=(this.padding[er.TOP]+this.height/2)/this.pixelRatio,t}getRenderCenter(t,e=.5,r=.5){return t[0]=this.padding[er.LEFT]+this.width*e,t[1]=this.padding[er.BOTTOM]+this.height*r,t[2]=.5,t}setGLViewport(t){const e=this.viewport,r=this.padding;t.setViewport(e[0]-r[3],e[1]-r[2],e[2]+r[1]+r[3],e[3]+r[0]+r[2])}applyProjection(t,e){t!==Kt&&ie(Kt,t),Kt[3]=1,xu(Kt,Kt,this.projectionMatrix);const r=Math.abs(Kt[3]);se(Kt,Kt,1/r);const i=this.fullViewport;e[0]=St(0,i[0]+i[2],.5+.5*Kt[0]),e[1]=St(0,i[1]+i[3],.5+.5*Kt[1]),e[2]=.5*(Kt[2]+1),e[3]=r}unapplyProjection(t,e){const r=this.fullViewport;Kt[0]=(t[0]/(r[0]+r[2])*2-1)*t[3],Kt[1]=(t[1]/(r[1]+r[3])*2-1)*t[3],Kt[2]=(2*t[2]-1)*t[3],Kt[3]=t[3],this.inverseProjectionMatrix!=null&&(xu(Kt,Kt,this.inverseProjectionMatrix),e[0]=Kt[0],e[1]=Kt[1],e[2]=Kt[2])}projectToScreen(t,e){return this.projectToRenderScreen(t,yk),this.renderToScreen(yk,e),e}projectToRenderScreen(t,e){if(Kt[0]=t[0],Kt[1]=t[1],Kt[2]=t[2],Kt[3]=1,xu(Kt,Kt,this.viewProjectionMatrix),Kt[3]===0)return null;se(Kt,Kt,1/Math.abs(Kt[3]));const r=this.fullViewport;return"x"in e?(e.x=St(0,r[0]+r[2],.5+.5*Kt[0]),e.y=St(0,r[1]+r[3],.5+.5*Kt[1])):(e[0]=St(0,r[0]+r[2],.5+.5*Kt[0]),e[1]=St(0,r[1]+r[3],.5+.5*Kt[1]),e.length>2&&(e[2]=.5*(Kt[2]+1))),e}unprojectFromScreen(t,e){return this.unprojectFromRenderScreen(this.screenToRender(t,yk),e)}unprojectFromRenderScreen(t,e){if(ai(e$,this.projectionMatrix,this.viewMatrix),!$n(e$,e$))return null;const r=this.fullViewport;return Kt[0]=2*(t[0]-r[0])/r[2]-1,Kt[1]=2*(t[1]-r[1])/r[3]-1,Kt[2]=2*t[2]-1,Kt[3]=1,xu(Kt,Kt,e$),Kt[3]===0?null:(e[0]=Kt[0]/Kt[3],e[1]=Kt[1]/Kt[3],e[2]=Kt[2]/Kt[3],e)}constrainWindowSize(t,e,r,i){const s=t*this.pixelRatio,n=e*this.pixelRatio,o=Math.max(s-r/2,0),a=Math.max(this.fullHeight-n-i/2,0),l=-Math.min(s-r/2,0),c=-Math.min(this.fullHeight-n-i/2,0);return[o,a,r-l- -Math.min(this.fullWidth-s-r/2,0),i-c- -Math.min(n-i/2,0)]}computeUp(t){t===Ve.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,e){const r=t[0]*this.pixelRatio,i=this.fullHeight-t[1]*this.pixelRatio;return e[0]=r,e[1]=i,e}renderToScreen(t,e){const r=t[0]/this.pixelRatio,i=(this.fullHeight-t[1])/this.pixelRatio;e[0]=r,e[1]=i}_computeUpGlobal(){fe(Ko,this.center,this.eye);const t=Re(this.center);t<1?(ne(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(ye(Ko,this.center))>.9999*Re(Ko)*t||(pt(this._up,Ko,this.center),pt(this._up,this._up,Ko),_e(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){O0(Ko,this.eye,this.center),Math.abs(Ko[2])<=.9999&&(se(Ko,Ko,Ko[2]),ne(this._up,-Ko[0],-Ko[1],1-Ko[2]),_e(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(t,e,r=""){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?ma(t,e)||(ie(e,t),this._markViewDirty(),r.length&&this.notifyChange(r)):K.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(lTe(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(_8(this._viewMatrix,this.eye,this.center,this.up),ne(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),ne(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),ne(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};u([p()],yt.prototype,"_center",void 0),u([p()],yt.prototype,"_up",void 0),u([p()],yt.prototype,"_viewport",void 0),u([p()],yt.prototype,"_padding",void 0),u([p()],yt.prototype,"_fov",void 0),u([p()],yt.prototype,"_nearFar",void 0),u([p()],yt.prototype,"_pixelRatio",void 0),u([p()],yt.prototype,"pixelRatio",null),u([p()],yt.prototype,"eye",null),u([p()],yt.prototype,"center",null),u([p()],yt.prototype,"up",null),u([p({readOnly:!0})],yt.prototype,"nearFar",null),u([p()],yt.prototype,"near",null),u([p()],yt.prototype,"far",null),u([p()],yt.prototype,"viewport",null),u([p({readOnly:!0})],yt.prototype,"screenViewport",null),u([p({readOnly:!0})],yt.prototype,"screenPadding",null),u([p()],yt.prototype,"x",null),u([p()],yt.prototype,"y",null),u([p()],yt.prototype,"width",null),u([p()],yt.prototype,"height",null),u([p()],yt.prototype,"fullWidth",null),u([p()],yt.prototype,"fullHeight",null),u([p({readOnly:!0})],yt.prototype,"_aspect",null),u([p()],yt.prototype,"padding",null),u([p({readOnly:!0})],yt.prototype,"projectionMatrix",null),u([p({readOnly:!0})],yt.prototype,"inverseProjectionMatrix",null),u([p()],yt.prototype,"fov",null),u([p()],yt.prototype,"fovX",null),u([p()],yt.prototype,"fovY",null),yt=Wj=u([P("esri.views.3d.webgl-engine.lib.Camera")],yt);const Kt=Wt(),e$=xe(),Ko=O(),gk=O(),yk=Wo();var er;(function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT"})(er||(er={}));var pe;(function(t){t[t.INTEGRATED_MESH=0]="INTEGRATED_MESH",t[t.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",t[t.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",t[t.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL",t[t.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN",t[t.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",t[t.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN",t[t.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL",t[t.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL",t[t.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",t[t.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE",t[t.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT",t[t.LASERLINES=12]="LASERLINES",t[t.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL",t[t.HUD_MATERIAL=14]="HUD_MATERIAL",t[t.LABEL_MATERIAL=15]="LABEL_MATERIAL",t[t.LINE_CALLOUTS=16]="LINE_CALLOUTS",t[t.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH",t[t.DRAPED_MATERIAL=18]="DRAPED_MATERIAL",t[t.DRAPED_WATER=19]="DRAPED_WATER",t[t.VOXEL=20]="VOXEL",t[t.MAX_SLOTS=21]="MAX_SLOTS"})(pe||(pe={}));var dt;(function(t){t[t.Color=0]="Color",t[t.Alpha=1]="Alpha",t[t.FrontFace=2]="FrontFace",t[t.NONE=3]="NONE",t[t.COUNT=4]="COUNT"})(dt||(dt={}));let lQ=class{constructor(e=O()){this.intensity=e}},pTe=class{constructor(e=O(),r=Pe(.57735,.57735,.57735)){this.intensity=e,this.direction=r}},j5=class{constructor(e=O(),r=Pe(.57735,.57735,.57735),i=!0,s=1,n=1){this.intensity=e,this.direction=r,this.castShadows=i,this.specularStrength=s,this.environmentStrength=n}},fTe=class{constructor(){this.r=[0],this.g=[0],this.b=[0]}};function aXe(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]*e[i];return r}function _k(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]*e;return r}function DS(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]+e[i];return r}function mTe(t){return(t+1)*(t+1)}function lXe(t){return ve(Math.floor(Math.sqrt(t)-1),0,2)}function gTe(t,e,r){const i=t[0],s=t[1],n=t[2],o=r||[];return o.length=mTe(e),e>=0&&(o[0]=.28209479177),e>=1&&(o[1]=.4886025119*i,o[2]=.4886025119*n,o[3]=.4886025119*s),e>=2&&(o[4]=1.09254843059*i*s,o[5]=1.09254843059*s*n,o[6]=.31539156525*(3*n*n-1),o[7]=1.09254843059*i*n,o[8]=.54627421529*(i*i-s*s)),o}function cXe(t,e){const r=mTe(t),i=e||{r:[],g:[],b:[]};i.r.length=i.g.length=i.b.length=r;for(let s=0;s<r;s++)i.r[s]=i.g[s]=i.b[s]=0;return i}function uXe(t,e){const r=lXe(e.r.length);for(const i of t)va(Xj,i.direction),gTe(Xj,r,Vg),aXe(Vg,xN),_k(Vg,i.intensity[0],Kx),DS(e.r,Kx),_k(Vg,i.intensity[1],Kx),DS(e.g,Kx),_k(Vg,i.intensity[2],Kx),DS(e.b,Kx);return e}function hXe(t,e){gTe(Xj,0,Vg);for(const r of t)e.r[0]+=Vg[0]*xN[0]*r.intensity[0]*4*Math.PI,e.g[0]+=Vg[0]*xN[0]*r.intensity[1]*4*Math.PI,e.b[0]+=Vg[0]*xN[0]*r.intensity[2]*4*Math.PI;return e}function dXe(t,e,r,i){cXe(e,i),ne(r.intensity,0,0,0);let s=!1;const n=pXe,o=fXe,a=mXe;n.length=0,o.length=0,a.length=0;for(const l of t)l instanceof j5&&!s?(ie(r.direction,l.direction),ie(r.intensity,l.intensity),r.specularStrength=l.specularStrength,r.environmentStrength=l.environmentStrength,r.castShadows=l.castShadows,s=!0):l instanceof j5||l instanceof pTe?n.push(l):l instanceof lQ?o.push(l):l instanceof fTe&&a.push(l);uXe(n,i),hXe(o,i);for(const l of a)DS(i.r,l.r),DS(i.g,l.g),DS(i.b,l.b)}const pXe=[],fXe=[],mXe=[],Vg=[0],Kx=[0],Xj=O(),xN=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];let fne=class{constructor(){this.color=O(),this.intensity=1}},gXe=class{constructor(){this.direction=O(),this.ambient=new fne,this.diffuse=new fne}};const yTe=.4;let vk=class{constructor(){this._shOrder=2,this._legacy=new gXe,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new fTe,this._mainLight=new j5(O(),Pe(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(e){dXe(e,this._shOrder,this._mainLight,this._sphericalHarmonics),ie(this._legacy.direction,this._mainLight.direction);const r=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*r,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*r,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*r,se(this._legacy.diffuse.color,this._mainLight.intensity,r),ie(t$,this._legacy.diffuse.color),se(t$,t$,yTe*this.globalFactor),de(this._legacy.ambient.color,this._legacy.ambient.color,t$)}copyFrom(e){this._sphericalHarmonics.r=Array.from(e.sh.r),this._sphericalHarmonics.g=Array.from(e.sh.g),this._sphericalHarmonics.b=Array.from(e.sh.b),ie(this._mainLight.direction,e.mainLight.direction),ie(this._mainLight.intensity,e.mainLight.intensity),this._mainLight.castShadows=e.mainLight.castShadows,this._mainLight.specularStrength=e.mainLight.specularStrength,this._mainLight.environmentStrength=e.mainLight.environmentStrength,this.globalFactor=e.globalFactor,this.noonFactor=e.noonFactor}lerpLighting(e,r,i){if(qr(this._mainLight.intensity,e.mainLight.intensity,r.mainLight.intensity,i),this._mainLight.environmentStrength=St(e.mainLight.environmentStrength,r.mainLight.environmentStrength,i),this._mainLight.specularStrength=St(e.mainLight.specularStrength,r.mainLight.specularStrength,i),ie(this._mainLight.direction,r.mainLight.direction),this._mainLight.castShadows=r.mainLight.castShadows,this.globalFactor=St(e.globalFactor,r.globalFactor,i),this.noonFactor=St(e.noonFactor,r.noonFactor,i),e.sh.r.length===r.sh.r.length)for(let s=0;s<r.sh.r.length;s++)this._sphericalHarmonics.r[s]=St(e.sh.r[s],r.sh.r[s],i),this._sphericalHarmonics.g[s]=St(e.sh.g[s],r.sh.g[s],i),this._sphericalHarmonics.b[s]=St(e.sh.b[s],r.sh.b[s],i);else for(let s=0;s<r.sh.r.length;s++)this._sphericalHarmonics.r[s]=r.sh.r[s],this._sphericalHarmonics.g[s]=r.sh.g[s],this._sphericalHarmonics.b[s]=r.sh.b[s]}};const t$=O();let V8=class{constructor(e,r,i){this.shadowMap=e,this.ssaoHelper=r,this.slicePlane=i,this.slot=pe.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=dt.NONE,this.alignPixelEnabled=!1,this._camera=new yt,this._inverseViewport=He(),this.oldLighting=new vk,this.newLighting=new vk,this._fadedLighting=new vk,this._lighting=this.newLighting,this.ssr=new XWe,this.multipassTerrain=new qWe,this.multipassGeometry=new HWe,this.overlays=[],this.cloudsFade=new iWe}get camera(){return this._camera}set camera(e){this._camera=this.ssr.camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(e){const{oldLighting:r,newLighting:i}=this;e>=1?this._lighting=i:(this._fadedLighting.lerpLighting(r,i,e),this._lighting=this._fadedLighting)}},Tl=class extends Te{constructor(e){super(e),this._handles=new $i,this._techniques=new Array,this._techniqueConfiguration=new bN,this._bindParameters=new V8(null,null,null),this._passParameters=new Kxe,this._drawParameters=new eTe,this._weatherTile=He(),this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this.coverage=St(oa.default.coverage[0],oa.default.coverage[1],.5),this.density=St(oa.default.density[0],oa.default.density[1],.5),this.absorption=St(oa.default.absorption[0],oa.default.absorption[1],.5),this.cloudSize=St(oa.default.cloudSize[0],oa.default.cloudSize[1],.5),this.detailSize=St(oa.default.detailSize[0],oa.default.detailSize[1],.5),this.smoothness=St(oa.default.smoothness[0],oa.default.smoothness[1],.5),this.cloudHeight=St(oa.default.cloudHeight[0],oa.default.cloudHeight[1],.5),this.raymarchingSteps=oa.default.raymarchingSteps,this._viewMatrix=xe(),this._dirty=!1,this.running=!1,this._vao=Hl(e.context.renderContext.rctx)}_getTechnique(e){const r=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,i=r===Xw.RG?2*e:2*e+1;return this._techniques[i]||(this._techniqueConfiguration.writeTextureChannels=r,this._techniqueConfiguration.steps=e,this._techniques[i]=new tTe({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[i])}updateWeatherTile(){const e=this.view.camera.position.latitude,r=this.view.camera.position.longitude;if(e==null||r==null)return;or(this._weatherTile,(e+90)/180,(r+180)/360);const i=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1));this._weatherTile[0]=Math.floor(2*this._weatherTileCount*this._weatherTile[0]),this._weatherTile[1]=Math.floor(4*(this._weatherTileCount-i)*this._weatherTile[1]);let s=0,n=0;if(this.view.environment!=null&&this.view.environment.lighting.type!=="virtual"&&this.view.environment.lighting.date!=null){const o=new Date(this.view.environment.lighting.date);o.setUTCHours(this.view.environment.lighting.date.getUTCHours()+(this.view.environment.lighting.displayUTCOffset??0)),s=31*o.getUTCMonth()+o.getUTCDate(),n=o.getUTCFullYear()}this._weatherTile[0]=(this._weatherTile[0]+s)%(2*this._weatherTileCount),this._weatherTile[1]=(this._weatherTile[1]+n%100)%(4*this._weatherTileCount),_xe(this._passParameters.weatherTile,this._weatherTile)||this.setDirty()}initialize(){const e=Vr(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius,this.setDirty(),this.updateWeatherTile(),this._handles.add([this.view.resourceController.scheduler.registerTask(vt.CLOUDS_GENERATOR,this),le(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),Pr)])}destroy(){this._handles.destroy(),this._techniques.forEach(e=>Gi(e)),this._frameBufferCube=je(this._frameBufferCube),this._techniques.length=0,this._vao.dispose(),this._passParameters.noiseTexture=Ne(this._passParameters.noiseTexture)}get _tilesPerFace(){switch(this._techniqueConfiguration.steps){case Dl.SIXTEEN:return 1;case Dl.HUNDRED:return 4;case Dl.COUNT:case Dl.TWOHUNDRED:return 8}}_ensureNoiseTexture(){if(this._passParameters.noiseTexture!=null)this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile);else{const e=this.context;this._passParameters.noiseTexture=new cO({context:e}),this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile)}return this._passParameters.noiseTexture.textureAtlas!=null}_ensureFrameBufferCube(e){if(this._frameBufferCube==null){const r=new xr(e);r.target=cs.TEXTURE_CUBE_MAP,r.wrapMode=Dt.CLAMP_TO_EDGE,this._frameBufferCube=new fn(this.context.renderContext.rctx,r)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}destroyFrameBufferCube(){this._frameBufferCube=je(this._frameBufferCube)}applyPreset(e,r){const i=e.median,s=n=>{const o=St(n[0],n[1],i);return r<.5?St(n[0],o,2*r):St(o,n[1],2*(r-.5))};this.coverage=s(e.coverage),this.density=s(e.density),this.absorption=s(e.absorption),this.cloudSize=s(e.cloudSize),this.detailSize=s(e.detailSize),this.smoothness=s(e.smoothness),this.cloudHeight=s(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps}setDirty(){this._dirty=this.running=!0}runTask(e){this._faceIndex===0&&this._tileIndex===0&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),yn(this._passParameters.weatherTile,this._weatherTile));const r=this._getTechnique(this._passParameters.raymarchingSteps);if(!r.compiled||!this.context.renderContext.bindParameters.cloudsFade.isCameraPositionFinal||this.context.renderContext.bindParameters.cloudsFade.isFading||!this._ensureNoiseTexture())return Zo.YIELD;this._faceIndex===0&&this._tileIndex===0&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=Ds.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);const i=this.context.renderContext.rctx,s=i.bindTechnique(r,this._passParameters,this._bindParameters);i.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao);const n=i.getViewport(),o=r.configuration.cubeMapSize,a=o/this._tilesPerFace,l=this._tileIndex*a;i.setViewport(0,l,o,a);const c=this._ensureFrameBufferCube(o);i.bindFramebuffer(c);const h=yXe[this._faceIndex],d=_Xe[this._faceIndex];N1e(this._viewMatrix,vXe,h,d),Jh(this._drawParameters.viewMatrix,this._viewMatrix);const f=cs.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex;return c.setColorTextureTarget(f),s.bindDraw(this._drawParameters,this._bindParameters,this._passParameters),i.gl.drawArrays(i.gl.TRIANGLE_STRIP,0,4),i.gl.flush(),i.setViewport(n.x,n.y,n.width,n.height),this.requestRender(),++this._tileIndex,this._faceIndex===4&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._faceIndex=0,this._tileIndex=0,this.context.renderContext.bindParameters.cloudsFade.renderingStage=Ds.FINISHED_RENDERING):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0),e.madeProgress(),Zo.YIELD}};u([p({constructOnly:!0})],Tl.prototype,"context",void 0),u([p({constructOnly:!0})],Tl.prototype,"view",void 0),u([p({constructOnly:!0})],Tl.prototype,"requestRender",void 0),u([p()],Tl.prototype,"coverage",void 0),u([p()],Tl.prototype,"density",void 0),u([p()],Tl.prototype,"absorption",void 0),u([p()],Tl.prototype,"cloudSize",void 0),u([p()],Tl.prototype,"detailSize",void 0),u([p()],Tl.prototype,"smoothness",void 0),u([p()],Tl.prototype,"cloudHeight",void 0),u([p()],Tl.prototype,"raymarchingSteps",void 0),u([p()],Tl.prototype,"running",void 0),Tl=u([P("esri.views.3d.environment.CloudsGenerator")],Tl);const yXe=[Qr(1,0,0),Qr(-1,0,0),Qr(0,1,0),Qr(0,-1,0),Qr(0,0,1)],_Xe=[Qr(0,1,0),Qr(0,1,0),Qr(0,0,-1),Qr(0,0,1),Qr(0,1,0)],vXe=aQ();let _Te=class extends ii{constructor(){super(...arguments),this.fogColor=O(),this.fogStrength=4e-6,this.atmosphereC=1,this.fogAmount=0}};function bXe(){const t=new Sr;t.attributes.add(C.POSITION,"vec2"),t.include(sm,{textureCoordinateType:Fs.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:e,fragment:r}=t;return e.uniforms.add(new Ui("inverseProjectionMatrix",(i,s)=>s.camera.inverseProjectionMatrix),new Ui("inverseViewMatrix",(i,s)=>OC(wXe,s.camera.viewMatrix))),e.code.add(w`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add(new Ie("atmosphereC",i=>i.atmosphereC),new kt("cameraPosition",(i,s)=>s.camera.eye),new Ar("nearFar",(i,s)=>s.camera.nearFar),new rt("depthTexture",i=>i.depthTexture),new Ie("fogStrength",i=>i.fogStrength),new Ie("fogAmount",i=>i.fogAmount),new kt("fogColor",i=>i.fogColor)),t.include(F8),r.include(Nu),r.code.add(w`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(w`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),r.code.add(w`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}
void main() {
vec3 rayDir = normalize(worldRay);
float terrainDepth = -1.0;
float depthSample = texture(depthTexture, vuv0).r;
float zNorm = 2.0 * depthSample - 1.0;
float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
if(depthSample < 1.0 && depthSample > 0.0){
vec3 cameraSpaceRay = normalize(eyeDir);
cameraSpaceRay /= cameraSpaceRay.z;
cameraSpaceRay *= linDepth;
terrainDepth = max(0.0, length(cameraSpaceRay));
}
vec4 fog = applyFog(terrainDepth, rayDir);
fragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
}`),t}const wXe=xe(),xXe=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:_Te,build:bXe},Symbol.toStringTag,{value:"Module"}));let vTe=class bTe extends Lr{constructor(e){super(e,new Sa,()=>this.destroy())}initializeProgram(e){return new Rr(e.rctx,bTe.shader.get().build(),Tr)}initializePipeline(){return Mt({blending:Oo(Se.SRC_ALPHA,Se.ZERO,Se.ONE_MINUS_SRC_ALPHA,Se.ONE),colorWrite:Bt})}};vTe.shader=new Or(xXe,()=>he(()=>import("./Fog.glsl-710121e2.js"),[],import.meta.url));const TXe=.95,SXe=1;let sb=class extends Te{constructor(e){super(e),this._passParameters=new _Te;const r=e.context.renderContext.rctx;this._vao=Hl(r,MP),this._technique=new vTe(e);const i=Vr(e.view.spatialReference);this._planetRadius=i.radius,this._atmosphereRadius=i.radius+m_}destroy(){this._technique.release(),this._vao.dispose()}set strength(e){this._passParameters.fogStrength=e}get strength(){return this._passParameters.fogStrength}render(e,r){if(this._update(e,r),this._passParameters.fogAmount<=0)return;const i=this._technique;if(!i.compiled)return void this.context.requestRender();const s=e.offscreenRenderingHelper;s.renderDepthDetached(()=>{this._passParameters.depthTexture=s.depthTexture;const n=e.rctx.bindTechnique(i,this._passParameters,e.bindParameters);this._renderFog(n,e)})}_renderFog(e,r){const i=r.rctx;i.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(At.TRIANGLE_STRIP,0,4)}_update(e,r){const i=e.bindParameters.camera;_e(mne,i.eye);const s=Math.max(0,ye(mne,e.bindParameters.lighting.mainLight.direction)),n=r.color;se(gne,n,.1),qr(this._passParameters.fogColor,gne,n,s);const o=Re(i.eye),a=o*o;this._passParameters.atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.fogAmount=(1-aM(TXe*Df,SXe*Df,Math.abs(o-this._planetRadius)))*r.amount,this._passParameters.fogStrength=r.strength}static isSupported(e){return e.capabilities.depthTexture}};u([p({constructOnly:!0})],sb.prototype,"context",void 0),u([p({constructOnly:!0})],sb.prototype,"view",void 0),u([p({constructOnly:!0})],sb.prototype,"rctx",void 0),u([p({constructOnly:!0})],sb.prototype,"viewingMode",void 0),sb=u([P("esri.views.3d.environment.Fog")],sb);let EXe=class{constructor(){this.color=O(),this.strength=0,this.amount=0}};const mne=O(),gne=O();let jo=class extends Sa{};u([B({constValue:!0})],jo.prototype,"hasSliceHighlight",void 0),u([B({constValue:!1})],jo.prototype,"hasSliceInVertexProgram",void 0),u([B({constValue:!1})],jo.prototype,"instancedDoublePrecision",void 0),u([B({constValue:!1})],jo.prototype,"hasModelTransformation",void 0),u([B({constValue:ti.Pass})],jo.prototype,"pbrTextureBindType",void 0);var bm;(function(t){t[t.Cone=0]="Cone",t[t.Cylinder=1]="Cylinder",t[t.Underground=2]="Underground",t[t.COUNT=3]="COUNT"})(bm||(bm={}));let cQ=class extends jo{constructor(){super(...arguments),this.geometry=bm.Cone}};u([B({count:bm.COUNT})],cQ.prototype,"geometry",void 0);var F;(function(t){t[t.Color=0]="Color",t[t.Depth=1]="Depth",t[t.Normal=2]="Normal",t[t.Shadow=3]="Shadow",t[t.ShadowHighlight=4]="ShadowHighlight",t[t.ShadowExcludeHighlight=5]="ShadowExcludeHighlight",t[t.Highlight=6]="Highlight",t[t.Alpha=7]="Alpha",t[t.ObjectAndLayerIdColor=8]="ObjectAndLayerIdColor",t[t.COUNT=9]="COUNT"})(F||(F={}));function IP(t){t.attributes.add(C.POSITION,"vec3"),t.vertex.code.add(w`vec3 positionModel() { return position; }`)}function H5({code:t},e){e.doublePrecisionRequiresObfuscation?t.add(w`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):t.add(w`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}let sd=class extends ps{constructor(e,r){super(e,"mat3",ti.Pass,(i,s,n)=>i.setUniformMatrix3fv(e,r(s,n)))}};function NS(t,e){t.include(IP);const r=t.vertex;r.include(H5,e),t.varyings.add("vPositionWorldCameraRelative","vec3"),t.varyings.add("vPosition_view","vec3"),r.uniforms.add(new kt("transformWorldFromViewTH",i=>i.transformWorldFromViewTH),new kt("transformWorldFromViewTL",i=>i.transformWorldFromViewTL),new sd("transformViewFromCameraRelativeRS",i=>i.transformViewFromCameraRelativeRS),new Ui("transformProjFromView",i=>i.transformProjFromView),new SM("transformWorldFromModelRS",i=>i.transformWorldFromModelRS),new Ou("transformWorldFromModelTH",i=>i.transformWorldFromModelTH),new Ou("transformWorldFromModelTL",i=>i.transformWorldFromModelTL)),r.code.add(w`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),r.code.add(w`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${e.spherical?w`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:w`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),t.fragment.uniforms.add(new kt("transformWorldFromViewTL",i=>i.transformWorldFromViewTL)),r.code.add(w`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),t.fragment.code.add(w`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}let wTe=class extends ii{constructor(){super(...arguments),this.transformWorldFromViewTH=O(),this.transformWorldFromViewTL=O(),this.transformViewFromCameraRelativeRS=ki(),this.transformProjFromView=xe()}},xTe=class extends ii{constructor(){super(...arguments),this.transformWorldFromModelRS=ki(),this.transformWorldFromModelTH=O(),this.transformWorldFromModelTL=O()}};function yv(t){t.varyings.add("linearDepth","float")}function Yw(t){t.vertex.uniforms.add(new Ar("nearFar",(e,r)=>r.camera.nearFar))}function B8(t){t.vertex.code.add(w`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function $C(t,e){const{vertex:r}=t;switch(e.output){case F.Color:if(e.receiveShadows)return yv(t),void r.code.add(w`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case F.Depth:case F.Shadow:case F.ShadowHighlight:case F.ShadowExcludeHighlight:return t.include(NS,e),yv(t),Yw(t),B8(t),void r.code.add(w`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}r.code.add(w`void forwardLinearDepth() {}`)}function Nl(t){B8(t),t.vertex.code.add(w`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),t.vertex.code.add(w`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}let uQ=class extends ii{constructor(){super(...arguments),this.texV=He(),this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new TTe}},TTe=class{constructor(){this.center=O(),this.v1=O(),this.v2=O()}};function CXe(t){const e=new Sr,{vertex:r,fragment:i}=e;if(I0(r),t.geometry===bm.Underground)e.attributes.add(C.POSITION,"vec2"),e.varyings.add("color","vec4"),r.uniforms.add(new kt("cameraPosition",(s,n)=>n.camera.eye),new Ie("undergroundFadeAlpha",s=>s.undergroundFadeAlpha)),r.code.add(w`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),i.code.add(w`void main() {
fragColor = color;
}`);else{e.include(Nl,t),e.attributes.add(C.POSITION,"vec3"),e.varyings.add("vtc","vec2"),e.varyings.add("falloff","float");const s=t.geometry===bm.Cylinder;r.uniforms.add(new Ui("proj",(a,l)=>l.camera.projectionMatrix),new Ui("view",(a,l)=>l.camera.viewMatrix)),s||(e.varyings.add("innerFactor","float"),r.uniforms.add(new kt("silCircleCenter",a=>a.silhouette.center)),r.uniforms.add(new kt("silCircleV1",a=>a.silhouette.v1)),r.uniforms.add(new kt("silCircleV2",a=>a.silhouette.v2)),r.uniforms.add(new Ar("texV",a=>a.texV)),r.uniforms.add(new Ie("innerScale",a=>a.innerScale)));const n=6.2831853,o=1/128;r.code.add(w`
		void main(void) {
      ${s?w`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:w`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${w.float(n*o)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${w.float(o)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),i.uniforms.add(new rt("tex",a=>a.texture)),s||i.uniforms.add(new Ie("altitudeFade",a=>a.altitudeFade)),i.code.add(w`
		void main() {
			vec4 atmosphereColor = texture(tex, vtc) * falloff;
      ${s?w`fragColor = atmosphereColor;`:w`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			fragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return e}const AXe=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:TTe,SimpleAtmospherePassParameters:uQ,build:CXe},Symbol.toStringTag,{value:"Module"}));let q5=class STe extends Lr{initializeProgram(e){return new Rr(e.rctx,STe.shader.get().build(this.configuration),Tr)}initializePipeline(){return this.configuration.geometry===bm.Cylinder?Mt({blending:Oo(Se.SRC_ALPHA,Se.ONE,Se.ONE_MINUS_SRC_ALPHA,Se.ONE_MINUS_SRC_ALPHA),culling:qJ,depthTest:{func:ri.LEQUAL},colorWrite:Bt}):Mt({blending:Oo(Se.SRC_ALPHA,Se.ONE,Se.ONE_MINUS_SRC_ALPHA,Se.ONE_MINUS_SRC_ALPHA),depthTest:{func:ri.LEQUAL},colorWrite:Bt})}};q5.shader=new Or(AXe,()=>he(()=>import("./SimpleAtmosphere.glsl-3ed7d854.js"),[],import.meta.url));const OXe=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);function Gc(t,e=0){const r=t.stride;return Array.from(t.fields.keys()).filter(i=>{const s=t.fields.get(i)?.optional;return!(s&&s.glPadding)}).map(i=>{const s=t.fields.get(i),n=s.constructor.ElementCount,o=RXe(s.constructor.ElementType),a=s.offset,l=!(!s.optional||!s.optional.glNormalized);return new To(i,n,o,a,r,l,e)})}function RXe(t){const e=MXe[t];if(e)return e;throw new Error("BufferType not supported in WebGL")}const MXe={u8:st.UNSIGNED_BYTE,u16:st.UNSIGNED_SHORT,u32:st.UNSIGNED_INT,i8:st.BYTE,i16:st.SHORT,i32:st.INT,f32:st.FLOAT};let hQ=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=9;const o=this.TypedArrayConstructor;s===void 0&&(s=9*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getMat(e,r){let i=e*this.typedBufferStride;for(let s=0;s<9;s++)r[s]=this.typedBuffer[i++];return r}setMat(e,r){let i=e*this.typedBufferStride;for(let s=0;s<9;s++)this.typedBuffer[i++]=r[s]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;for(let l=0;l<9;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}};hQ.ElementCount=9;let dQ=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=16;const o=this.TypedArrayConstructor;s===void 0&&(s=16*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getMat(e,r){let i=e*this.typedBufferStride;for(let s=0;s<16;s++)r[s]=this.typedBuffer[i++];return r}setMat(e,r){let i=e*this.typedBufferStride;for(let s=0;s<16;s++)this.typedBuffer[i++]=r[s]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;for(let l=0;l<16;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}};dQ.ElementCount=16;let D0=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=1;const o=this.TypedArrayConstructor;s===void 0&&(s=o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.stride=s,this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,r){this.typedBuffer[e*this.typedBufferStride]=r}get buffer(){return this.typedBuffer.buffer}};D0.ElementCount=1;let N0=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=2;const o=this.TypedArrayConstructor;s===void 0&&(s=2*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,or(r,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e]=r[1]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e]=i}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};N0.ElementCount=2;let F0=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=3;const o=this.TypedArrayConstructor;s===void 0&&(s=3*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,ne(r,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e++]=r[1],this.typedBuffer[e]=r[2]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i,s){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e++]=i,this.typedBuffer[e]=s}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};F0.ElementCount=3;let U0=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.start=i,this.elementCount=4;const o=this.TypedArrayConstructor;s===void 0&&(s=4*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,Ti(r,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e++]=r[1],this.typedBuffer[e++]=r[2],this.typedBuffer[e]=r[3]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i,s,n){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e++]=i,this.typedBuffer[e++]=s,this.typedBuffer[e]=n}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};U0.ElementCount=4;let G8=class ETe extends D0{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}static fromTypedArray(e,r){return new ETe(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};G8.ElementType="f32";let Nv=class Yj extends N0{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(Yj,e,r)}static fromTypedArray(e,r){return new Yj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Nv.ElementType="f32";let mn=class Zj extends F0{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(Zj,e,r)}static fromTypedArray(e,r){return new Zj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};mn.ElementType="f32";let Ip=class Jj extends U0{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(Jj,e,r)}static fromTypedArray(e,r){return new Jj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Ip.ElementType="f32";let _v=class Qj extends hQ{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(Qj,e,r)}static fromTypedArray(e,r){return new Qj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};_v.ElementType="f32";let pQ=class Kj extends hQ{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(Kj,e,r)}static fromTypedArray(e,r){return new Kj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};pQ.ElementType="f64";let fQ=class eH extends dQ{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(eH,e,r)}static fromTypedArray(e,r){return new eH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};fQ.ElementType="f32";let CM=class tH extends dQ{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(tH,e,r)}static fromTypedArray(e,r){return new tH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};CM.ElementType="f64";let mQ=class rH extends D0{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(rH,e,r)}static fromTypedArray(e,r){return new rH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};mQ.ElementType="f64";let gQ=class iH extends N0{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(iH,e,r)}static fromTypedArray(e,r){return new iH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};gQ.ElementType="f64";let Kh=class sH extends F0{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(sH,e,r)}static fromTypedArray(e,r){return new sH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Kh.ElementType="f64";let j8=class nH extends U0{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(nH,e,r)}static fromTypedArray(e,r){return new nH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};j8.ElementType="f64";let kE=class oH extends D0{constructor(e,r=0,i,s){super(Uint8Array,e,r,i,s),this.elementType="u8"}slice(e,r){return this.sliceBuffer(oH,e,r)}static fromTypedArray(e,r){return new oH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};kE.ElementType="u8";let H8=class aH extends N0{constructor(e,r=0,i,s){super(Uint8Array,e,r,i,s),this.elementType="u8"}slice(e,r){return this.sliceBuffer(aH,e,r)}static fromTypedArray(e,r){return new aH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};H8.ElementType="u8";let q8=class lH extends F0{constructor(e,r=0,i,s){super(Uint8Array,e,r,i,s),this.elementType="u8"}slice(e,r){return this.sliceBuffer(lH,e,r)}static fromTypedArray(e,r){return new lH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};q8.ElementType="u8";let wa=class cH extends U0{constructor(e,r=0,i,s){super(Uint8Array,e,r,i,s),this.elementType="u8"}slice(e,r){return this.sliceBuffer(cH,e,r)}static fromTypedArray(e,r){return new cH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};wa.ElementType="u8";let W8=class uH extends D0{constructor(e,r=0,i,s){super(Uint16Array,e,r,i,s),this.elementType="u16"}slice(e,r){return this.sliceBuffer(uH,e,r)}static fromTypedArray(e,r){return new uH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};W8.ElementType="u16";let yQ=class hH extends N0{constructor(e,r=0,i,s){super(Uint16Array,e,r,i,s),this.elementType="u16"}slice(e,r){return this.sliceBuffer(hH,e,r)}static fromTypedArray(e,r){return new hH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};yQ.ElementType="u16";let X8=class dH extends F0{constructor(e,r=0,i,s){super(Uint16Array,e,r,i,s),this.elementType="u16"}slice(e,r){return this.sliceBuffer(dH,e,r)}static fromTypedArray(e,r){return new dH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};X8.ElementType="u16";let $P=class pH extends U0{constructor(e,r=0,i,s){super(Uint16Array,e,r,i,s),this.elementType="u16"}slice(e,r){return this.sliceBuffer(pH,e,r)}static fromTypedArray(e,r){return new pH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};$P.ElementType="u16";let Y8=class fH extends D0{constructor(e,r=0,i,s){super(Uint32Array,e,r,i,s),this.elementType="u32"}slice(e,r){return this.sliceBuffer(fH,e,r)}static fromTypedArray(e,r){return new fH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Y8.ElementType="u32";let _Q=class mH extends N0{constructor(e,r=0,i,s){super(Uint32Array,e,r,i,s),this.elementType="u32"}slice(e,r){return this.sliceBuffer(mH,e,r)}static fromTypedArray(e,r){return new mH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};_Q.ElementType="u32";let CTe=class gH extends F0{constructor(e,r=0,i,s){super(Uint32Array,e,r,i,s),this.elementType="u32"}slice(e,r){return this.sliceBuffer(gH,e,r)}static fromTypedArray(e,r){return new gH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};CTe.ElementType="u32";let ATe=class yH extends U0{constructor(e,r=0,i,s){super(Uint32Array,e,r,i,s),this.elementType="u32"}slice(e,r){return this.sliceBuffer(yH,e,r)}static fromTypedArray(e,r){return new yH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};ATe.ElementType="u32";let vQ=class _H extends D0{constructor(e,r=0,i,s){super(Int8Array,e,r,i,s),this.elementType="i8"}slice(e,r){return this.sliceBuffer(_H,e,r)}static fromTypedArray(e,r){return new _H(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};vQ.ElementType="i8";let Z8=class vH extends N0{constructor(e,r=0,i,s){super(Int8Array,e,r,i,s),this.elementType="i8"}slice(e,r){return this.sliceBuffer(vH,e,r)}static fromTypedArray(e,r){return new vH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Z8.ElementType="i8";let OTe=class bH extends F0{constructor(e,r=0,i,s){super(Int8Array,e,r,i,s),this.elementType="i8"}slice(e,r){return this.sliceBuffer(bH,e,r)}static fromTypedArray(e,r){return new bH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};OTe.ElementType="i8";let RTe=class wH extends U0{constructor(e,r=0,i,s){super(Int8Array,e,r,i,s),this.elementType="i8"}slice(e,r){return this.sliceBuffer(wH,e,r)}static fromTypedArray(e,r){return new wH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};RTe.ElementType="i8";let MTe=class xH extends D0{constructor(e,r=0,i,s){super(Int16Array,e,r,i,s),this.elementType="i16"}slice(e,r){return this.sliceBuffer(xH,e,r)}static fromTypedArray(e,r){return new xH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};MTe.ElementType="i16";let LP=class TH extends N0{constructor(e,r=0,i,s){super(Int16Array,e,r,i,s),this.elementType="i16"}slice(e,r){return this.sliceBuffer(TH,e,r)}static fromTypedArray(e,r){return new TH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};LP.ElementType="i16";let PTe=class SH extends F0{constructor(e,r=0,i,s){super(Int16Array,e,r,i,s),this.elementType="i16"}slice(e,r){return this.sliceBuffer(SH,e,r)}static fromTypedArray(e,r){return new SH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};PTe.ElementType="i16";let ITe=class EH extends U0{constructor(e,r=0,i,s){super(Int16Array,e,r,i,s),this.elementType="i16"}slice(e,r){return this.sliceBuffer(EH,e,r)}static fromTypedArray(e,r){return new EH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};ITe.ElementType="i16";let $Te=class CH extends D0{constructor(e,r=0,i,s){super(Int32Array,e,r,i,s),this.elementType="i32"}slice(e,r){return this.sliceBuffer(CH,e,r)}static fromTypedArray(e,r){return new CH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};$Te.ElementType="i32";let LTe=class AH extends N0{constructor(e,r=0,i,s){super(Int32Array,e,r,i,s),this.elementType="i32"}slice(e,r){return this.sliceBuffer(AH,e,r)}static fromTypedArray(e,r){return new AH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};LTe.ElementType="i32";let DTe=class OH extends F0{constructor(e,r=0,i,s){super(Int32Array,e,r,i,s),this.elementType="i32"}slice(e,r){return this.sliceBuffer(OH,e,r)}static fromTypedArray(e,r){return new OH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};DTe.ElementType="i32";let NTe=class RH extends U0{constructor(e,r=0,i,s){super(Int32Array,e,r,i,s),this.elementType="i32"}slice(e,r){return this.sliceBuffer(RH,e,r)}static fromTypedArray(e,r){return new RH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};NTe.ElementType="i32";function yne(t){switch(t){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}let _ne=class FTe{constructor(e,r){this.layout=e,this.buffer=typeof r=="number"?new ArrayBuffer(r*e.stride):r;for(const i of e.fields.keys()){const s=e.fields.get(i);this[i]=new s.constructor(this.buffer,s.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,r){const i=this[e];return i&&i.elementCount===r.ElementCount&&i.elementType===r.ElementType?i:null}slice(e,r){return new FTe(this.layout,this.buffer.slice(e*this.stride,r*this.stride))}copyFrom(e,r=0,i=0,s=e.count){const n=this.stride;if(n%4==0){const o=new Uint32Array(e.buffer,r*n,s*n/4);new Uint32Array(this.buffer,i*n,s*n/4).set(o)}else{const o=new Uint8Array(e.buffer,r*n,s*n);new Uint8Array(this.buffer,i*n,s*n).set(o)}return this}},UTe=class kTe{constructor(e=null){this._stride=0,this._lastAligned=0,this._fields=new Map,e&&(this._stride=e.stride,e.fields.forEach(r=>this._fields.set(r[0],{...r[1],constructor:$Xe(r[1].constructor)})))}vec2f(e,r){return this._appendField(e,Nv,r),this}vec2f64(e,r){return this._appendField(e,gQ,r),this}vec3f(e,r){return this._appendField(e,mn,r),this}vec3f64(e,r){return this._appendField(e,Kh,r),this}vec4f(e,r){return this._appendField(e,Ip,r),this}vec4f64(e,r){return this._appendField(e,j8,r),this}mat3f(e,r){return this._appendField(e,_v,r),this}mat3f64(e,r){return this._appendField(e,pQ,r),this}mat4f(e,r){return this._appendField(e,fQ,r),this}mat4f64(e,r){return this._appendField(e,CM,r),this}vec4u8(e,r){return this._appendField(e,wa,r),this}f32(e,r){return this._appendField(e,G8,r),this}f64(e,r){return this._appendField(e,mQ,r),this}u8(e,r){return this._appendField(e,kE,r),this}u16(e,r){return this._appendField(e,W8,r),this}i8(e,r){return this._appendField(e,vQ,r),this}vec2i8(e,r){return this._appendField(e,Z8,r),this}vec2i16(e,r){return this._appendField(e,LP,r),this}vec2u8(e,r){return this._appendField(e,H8,r),this}vec4u16(e,r){return this._appendField(e,$P,r),this}u32(e,r){return this._appendField(e,Y8,r),this}_appendField(e,r,i){if(this._fields.has(e))return void ot(!1,`${e} already added to vertex buffer layout`);const s=r.ElementCount*yne(r.ElementType),n=this._stride;this._stride+=s,this._fields.set(e,{size:s,constructor:r,offset:n,optional:i})}createBuffer(e){return new _ne(this,e)}createView(e){return new _ne(this,e)}clone(){const e=new kTe;return e._stride=this._stride,e._fields=new Map,this._fields.forEach((r,i)=>e._fields.set(i,r)),e.BufferType=this.BufferType,e}get stride(){if(this._lastAligned!==this._fields.size){let e=1;this._fields.forEach(r=>e=Math.max(e,yne(r.constructor.ElementType))),this._stride=Math.floor((this._stride+e-1)/e)*e,this._lastAligned=this._fields.size}return this._stride}get fields(){return this._fields}};function qi(){return new UTe}let PXe=class{constructor(e){this.fields=new Array,e.fields.forEach((r,i)=>{const s={...r,constructor:zTe(r.constructor)};this.fields.push([i,s])}),this.stride=e.stride}};const IXe=[G8,Nv,mn,Ip,_v,fQ,mQ,gQ,Kh,j8,pQ,CM,kE,H8,q8,wa,W8,yQ,X8,$P,Y8,_Q,CTe,ATe,vQ,Z8,OTe,RTe,MTe,LP,PTe,ITe,$Te,LTe,DTe,NTe];function zTe(t){return`${t.ElementType}_${t.ElementCount}`}function $Xe(t){return VTe.get(t)}const VTe=new Map;IXe.forEach(t=>VTe.set(zTe(t),t));function Xo(t,e=!1){return t<=Pu?e?new Array(t).fill(0):new Array(t):new Float64Array(t)}function BTe(t){return(Cp(t)?t.length:t.byteLength/8)<=Pu?Array.from(t):new Float64Array(t)}function Vh(t,e,r){return Array.isArray(t)?t.slice(e,e+r):t.subarray(e,e+r)}function B8t(t,e){for(let r=0;r<e.length;++r)t[r]=e[r];return t}function G8t(t){return Array.isArray(t)?new Float64Array(t):t}function es(t,e=!1){return t<=Pu?e?new Array(t).fill(0):new Array(t):new Float32Array(t)}function j8t(t){return Cp(t)?t.length<Pu?t:new Float32Array(t):t.length<Pu?Array.from(t):t}function vne(t){return(Cp(t)?t.length:t.byteLength/8)<=Pu?Array.from(t):new Float32Array(t)}function W5(t,e,r){return Array.isArray(t)?t.slice(e,e+r):t.subarray(e,e+r)}function om(t){return Cp(t)?t.length<Pu?t:bne(t):t.length<Pu?Array.from(t):t.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT?t:bne(t)}function bne(t){let e=!0;for(const r of t){if(r>=65536)return Cp(t)?new Uint32Array(t):t;r>=256&&(e=!1)}return e?new Uint8Array(t):new Uint16Array(t)}function X5(t){return t<=Pu?new Array(t):t<=65536?new Uint16Array(t):new Uint32Array(t)}function LXe(t){return t<=Pu?new Array(t):new Uint32Array(t)}let eT=(()=>{const t=new Uint32Array(131072);for(let e=0;e<t.length;++e)t[e]=e;return t})();const GTe=[0],bk=(()=>{const t=new Uint16Array(65536);for(let e=0;e<t.length;++e)t[e]=e;return t})();function zE(t){if(t===1)return GTe;if(t<Pu)return Array.from(new Uint16Array(bk.buffer,0,t));if(t<bk.length)return new Uint16Array(bk.buffer,0,t);if(t>eT.length){const e=Math.max(2*eT.length,t);eT=new Uint32Array(e);for(let r=0;r<eT.length;r++)eT[r]=r}return new Uint32Array(eT.buffer,0,t)}let r$=new Uint8Array(65536);function LC(t){if(t===1)return GTe;if(t<Pu)return new Array(t).fill(0);if(t>r$.length){const e=Math.max(2*r$.length,t);r$=new Uint8Array(e)}return new Uint8Array(r$.buffer,0,t)}let We=class{constructor(e,r,i=!1,s=r){this.data=e,this.size=r,this.exclusive=i,this.stride=s}};var MH;(function(t){function e(o,a){const l=o[a],c=o[a+1],h=o[a+2];return Math.sqrt(l*l+c*c+h*h)}function r(o,a){const l=o[a],c=o[a+1],h=o[a+2],d=1/Math.sqrt(l*l+c*c+h*h);o[a]*=d,o[a+1]*=d,o[a+2]*=d}function i(o,a,l){o[a]*=l,o[a+1]*=l,o[a+2]*=l}function s(o,a,l,c,h,d=a){(h=h||o)[d]=o[a]+l[c],h[d+1]=o[a+1]+l[c+1],h[d+2]=o[a+2]+l[c+2]}function n(o,a,l,c,h,d=a){(h=h||o)[d]=o[a]-l[c],h[d+1]=o[a+1]-l[c+1],h[d+2]=o[a+2]-l[c+2]}t.length=e,t.normalize=r,t.scale=i,t.add=s,t.subtract=n})(MH||(MH={}));var us;(function(t){t[t.Layer=0]="Layer",t[t.Object=1]="Object",t[t.Mesh=2]="Mesh",t[t.Line=3]="Line",t[t.Point=4]="Point",t[t.Material=5]="Material",t[t.Texture=6]="Texture",t[t.COUNT=7]="COUNT"})(us||(us={}));function DXe(t){if(t.length<Pu)return Array.from(t);if(Cp(t))return Float64Array.from(t);if(!("BYTES_PER_ELEMENT"in t))return Array.from(t);switch(t.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(t);case 2:return L6(t)?Uint16Array.from(t):Int16Array.from(t);case 4:return Float32Array.from(t);default:return Float64Array.from(t)}}let jTe=class HTe{constructor(e,r,i,s){this.primitiveIndices=e,this._numIndexPerPrimitive=r,this.indices=i,this.position=s,this._children=void 0,ot(e.length>=1),ot(i.length%this._numIndexPerPrimitive==0),ot(i.length>=e.length*this._numIndexPerPrimitive),ot(s.size===3||s.size===4);const{data:n,size:o}=s,a=e.length;let l=o*i[this._numIndexPerPrimitive*e[0]];Kv.clear(),Kv.push(l);const c=Pe(n[l],n[l+1],n[l+2]),h=ks(c);for(let m=0;m<a;++m){const g=this._numIndexPerPrimitive*e[m];for(let _=0;_<this._numIndexPerPrimitive;++_){l=o*i[g+_],Kv.push(l);let v=n[l];c[0]=Math.min(v,c[0]),h[0]=Math.max(v,h[0]),v=n[l+1],c[1]=Math.min(v,c[1]),h[1]=Math.max(v,h[1]),v=n[l+2],c[2]=Math.min(v,c[2]),h[2]=Math.max(v,h[2])}}this.bbMin=c,this.bbMax=h;const d=qr(O(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(h[0]-c[0],h[1]-c[1]),h[2]-c[2]);let f=this.radius*this.radius;for(let m=0;m<Kv.length;++m){l=Kv.at(m);const g=n[l]-d[0],_=n[l+1]-d[1],v=n[l+2]-d[2],b=g*g+_*_+v*v;if(b<=f)continue;const T=Math.sqrt(b),x=.5*(T-this.radius);this.radius=this.radius+x,f=this.radius*this.radius;const S=x/T;d[0]+=g*S,d[1]+=_*S,d[2]+=v*S}this.center=d,Kv.clear()}getChildren(){if(this._children||xo(this.bbMin,this.bbMax)<=1)return this._children;const e=qr(O(),this.bbMin,this.bbMax,.5),r=this.primitiveIndices.length,i=new Uint8Array(r),s=new Array(8);for(let c=0;c<8;++c)s[c]=0;const{data:n,size:o}=this.position;for(let c=0;c<r;++c){let h=0;const d=this._numIndexPerPrimitive*this.primitiveIndices[c];let f=o*this.indices[d],m=n[f],g=n[f+1],_=n[f+2];for(let v=1;v<this._numIndexPerPrimitive;++v){f=o*this.indices[d+v];const b=n[f],T=n[f+1],x=n[f+2];b<m&&(m=b),T<g&&(g=T),x<_&&(_=x)}m<e[0]&&(h|=1),g<e[1]&&(h|=2),_<e[2]&&(h|=4),i[c]=h,++s[h]}let a=0;for(let c=0;c<8;++c)s[c]>0&&++a;if(a<2)return;const l=new Array(8);for(let c=0;c<8;++c)l[c]=s[c]>0?new Uint32Array(s[c]):void 0;for(let c=0;c<8;++c)s[c]=0;for(let c=0;c<r;++c){const h=i[c];l[h][s[h]++]=this.primitiveIndices[c]}this._children=new Array;for(let c=0;c<8;++c)l[c]!==void 0&&this._children.push(new HTe(l[c],this._numIndexPerPrimitive,this.indices,this.position));return this._children}static prune(){Kv.prune()}};const Kv=new Vt({deallocator:null});let DP=class{constructor(){this.id=Ic()}unload(){}};function NXe(t){return t?{p0:ks(t.p0),p1:ks(t.p1),p2:ks(t.p2)}:{p0:O(),p1:O(),p2:O()}}function wne(t,e,r){const i=e[0]-t[0],s=e[1]-t[1],n=r[0]-t[0],o=r[1]-t[1];return .5*Math.abs(i*o-s*n)}function FXe(t,e,r){return fe(wk,e,t),fe(xne,r,t),Re(pt(wk,wk,xne))/2}new M0(Dp);new M0(()=>NXe());const wk=O(),xne=O();function UXe(t,e,r){if(!t||!e)return!1;const{size:i,data:s}=t;ne(r,0,0,0),ne(bh,0,0,0);let n=0,o=0;for(let a=0;a<e.length-2;a+=3){const l=e[a]*i,c=e[a+1]*i,h=e[a+2]*i;ne(Jn,s[l],s[l+1],s[l+2]),ne(Bg,s[c],s[c+1],s[c+2]),ne(i$,s[h],s[h+1],s[h+2]);const d=FXe(Jn,Bg,i$);d?(de(Jn,Jn,Bg),de(Jn,Jn,i$),se(Jn,Jn,1/3*d),de(r,r,Jn),n+=d):(de(bh,bh,Jn),de(bh,bh,Bg),de(bh,bh,i$),o+=3)}return(o!==0||n!==0)&&(n!==0?(se(r,r,1/n),!0):o!==0&&(se(r,bh,1/o),!0))}function kXe(t,e,r){if(!t||!e)return!1;const{size:i,data:s}=t;ne(r,0,0,0);let n=-1,o=0;for(let a=0;a<e.length;a++){const l=e[a]*i;n!==l&&(r[0]+=s[l],r[1]+=s[l+1],r[2]+=s[l+2],o++),n=l}return o>1&&se(r,r,1/o),o>0}function zXe(t,e,r,i){if(!t)return!1;ne(i,0,0,0),ne(bh,0,0,0);let s=0,n=0;const{size:o,data:a}=t,l=e?e.length-1:a.length/o-1,c=l+(r?2:0);for(let h=0;h<c;h+=2){const d=h<l?h:l,f=h<l?h+1:0,m=(e?e[d]:d)*o,g=(e?e[f]:f)*o;Jn[0]=a[m],Jn[1]=a[m+1],Jn[2]=a[m+2],Bg[0]=a[g],Bg[1]=a[g+1],Bg[2]=a[g+2],se(Jn,de(Jn,Jn,Bg),.5);const _=mP(Jn,Bg);_>0?(de(i,i,se(Jn,Jn,_)),s+=_):s===0&&(de(bh,bh,Jn),n++)}return s!==0?(se(i,i,1/s),!0):n!==0&&(se(i,bh,1/n),!0)}const Jn=O(),Bg=O(),i$=O(),bh=O();let Y5=class{constructor(e){this.channel=e,this.id=Ic()}};function PH(t,e,r){for(let i=0;i<r;++i)e[2*i]=t[i],e[2*i+1]=t[i]-e[2*i]}function VXe(t,e){const r=t.length;for(let i=0;i<r;++i)pS[0]=t[i],e[i]=pS[0];return e}function BXe(t,e){const r=t.length;for(let i=0;i<r;++i)pS[0]=t[i],pS[1]=t[i]-pS[0],e[i]=pS[1];return e}const pS=new Float32Array(2);function IH(t,e){return t==null&&(t=[]),t.push(e),t}function $H(t,e){if(t==null)return null;const r=t.filter(i=>i!==e);return r.length===0?null:r}function GXe(t,e,r,i,s){s$[0]=t.get(e,0),s$[1]=t.get(e,1),s$[2]=t.get(e,2),PH(s$,e1,3),r.set(s,0,e1[0]),i.set(s,0,e1[1]),r.set(s,1,e1[2]),i.set(s,1,e1[3]),r.set(s,2,e1[4]),i.set(s,2,e1[5])}const s$=O(),e1=new Float32Array(6);let Ks=class qTe extends DP{constructor(e,r,i=[],s=null,n=us.Mesh,o=null,a=-1){super(),this.material=e,this.mapPositions=s,this.type=n,this.objectAndLayerIdColor=o,this.edgeIndicesLength=a,this.visible=!0,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[l,c]of r)c&&this._vertexAttributes.set(l,{...c});if(i==null||i.length===0){const l=jXe(this._vertexAttributes),c=zE(l);this.edgeIndicesLength=this.edgeIndicesLength<0?l:this.edgeIndicesLength;for(const h of this._vertexAttributes.keys())this._indices.set(h,c)}else for(const[l,c]of i)c&&(this._indices.set(l,om(c)),l===C.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(l).length:this.edgeIndicesLength))}instantiate(e={}){const r=new qTe(e.material||this.material,[],void 0,this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._vertexAttributes.forEach((i,s)=>{i.exclusive=!1,r._vertexAttributes.set(s,i)}),this._indices.forEach((i,s)=>r._indices.set(s,i)),r._boundingInfo=this._boundingInfo,r.transformation=e.transformation||this.transformation,r}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(e){let r=this._vertexAttributes.get(e);return r&&!r.exclusive&&(r={...r,exclusive:!0,data:DXe(r.data)},this._vertexAttributes.set(e,r)),r}setAttributeData(e,r){const i=this._vertexAttributes.get(e);i&&this._vertexAttributes.set(e,{...i,exclusive:!0,data:r})}get indices(){return this._indices}get indexCount(){const e=this._indices.values().next().value;return e?e.length:0}get faceCount(){return this.indexCount/3}get boundingInfo(){return this._boundingInfo==null&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===us.Mesh?this._computeAttachmentOriginTriangles(e):this.type===us.Line?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(this._transformation!=null&&ze(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){const r=this.indices.get(C.POSITION),i=this.vertexAttributes.get(C.POSITION);return UXe(i,r,e)}_computeAttachmentOriginLines(e){const r=this.vertexAttributes.get(C.POSITION),i=this.indices.get(C.POSITION);return zXe(r,i,i&&HXe(this.material.parameters,r,i),e)}_computeAttachmentOriginPoints(e){const r=this.indices.get(C.POSITION),i=this.vertexAttributes.get(C.POSITION);return kXe(i,r,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.indices.get(C.POSITION),r=this.vertexAttributes.get(C.POSITION);if(!e||e.length===0||!r)return null;const i=this.type===us.Mesh?3:1;ot(e.length%i==0,"Indexing error: "+e.length+" not divisible by "+i);const s=zE(e.length/i);return new jTe(s,i,e,r)}get transformation(){return this._transformation??pn}set transformation(e){this._transformation=e&&e!==pn?OE(e):null}get shaderTransformation(){return this._shaderTransformer!=null?this._shaderTransformer(this.transformation):this.transformation}get shaderTransformer(){return this._shaderTransformer}set shaderTransformer(e){this._shaderTransformer=e}get hasVolatileTransformation(){return this._shaderTransformer!=null}addHighlight(){const e=new Y5(T0.Highlight);return this.highlights=IH(this.highlights,e),e}removeHighlight(e){this.highlights=$H(this.highlights,e)}};function jXe(t){const e=t.values().next().value;return e==null?0:e.data.length/e.size}function HXe(t,e,r){return!(!("isClosed"in t)||!t.isClosed)&&(r?r.length>2:e.data.length>6)}const tT=MH,xk=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],qXe=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],WXe=[0,0,1,0,1,1,0,1],XXe=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],WTe=new Array(36);for(let t=0;t<6;t++)for(let e=0;e<6;e++)WTe[6*t+e]=t;const nb=new Array(36);for(let t=0;t<6;t++)nb[6*t]=0,nb[6*t+1]=1,nb[6*t+2]=2,nb[6*t+3]=2,nb[6*t+4]=3,nb[6*t+5]=0;function YXe(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(24);for(let i=0;i<8;i++)r[3*i]=xk[i][0]*e[0],r[3*i+1]=xk[i][1]*e[1],r[3*i+2]=xk[i][2]*e[2];return new Ks(t,[[C.POSITION,new We(r,3,!0)],[C.NORMAL,new We(qXe,3)],[C.UV0,new We(WXe,2)]],[[C.POSITION,XXe],[C.NORMAL,WTe],[C.UV0,nb]])}const Tk=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],ZXe=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],JXe=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],QXe=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function KXe(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(18);for(let i=0;i<6;i++)r[3*i]=Tk[i][0]*e[0],r[3*i+1]=Tk[i][1]*e[1],r[3*i+2]=Tk[i][2]*e[2];return new Ks(t,[[C.POSITION,new We(r,3,!0)],[C.NORMAL,new We(ZXe,3)]],[[C.POSITION,JXe],[C.NORMAL,QXe]])}const TN=Qr(-.5,0,-.5),SN=Qr(.5,0,-.5),EN=Qr(0,0,.5),CN=Qr(0,.5,0),rT=ls(),iT=ls(),FS=ls(),US=ls(),kS=ls();fe(rT,TN,CN),fe(iT,TN,SN),pt(FS,rT,iT),_e(FS,FS),fe(rT,SN,CN),fe(iT,SN,EN),pt(US,rT,iT),_e(US,US),fe(rT,EN,CN),fe(iT,EN,TN),pt(kS,rT,iT),_e(kS,kS);const Sk=[TN,SN,EN,CN],eYe=[0,-1,0,FS[0],FS[1],FS[2],US[0],US[1],US[2],kS[0],kS[1],kS[2]],tYe=[0,1,2,3,1,0,3,2,1,3,0,2],rYe=[0,0,0,1,1,1,2,2,2,3,3,3];function iYe(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(12);for(let i=0;i<4;i++)r[3*i]=Sk[i][0]*e[0],r[3*i+1]=Sk[i][1]*e[1],r[3*i+2]=Sk[i][2]*e[2];return new Ks(t,[[C.POSITION,new We(r,3,!0)],[C.NORMAL,new We(eYe,3)]],[[C.POSITION,tYe],[C.NORMAL,rYe]])}function X8t(t,e,r,i,s={uv:!0}){const n=-Math.PI,o=2*Math.PI,a=-Math.PI/2,l=Math.PI,c=Math.max(3,Math.floor(r)),h=Math.max(2,Math.floor(i)),d=(c+1)*(h+1),f=es(3*d),m=es(3*d),g=es(2*d),_=[];let v=0;for(let S=0;S<=h;S++){const E=[],A=S/h,R=a+A*l,M=Math.cos(R);for(let D=0;D<=c;D++){const k=D/c,L=n+k*o,N=Math.cos(L)*M,q=Math.sin(R),X=-Math.sin(L)*M;f[3*v]=N*e,f[3*v+1]=q*e,f[3*v+2]=X*e,m[3*v]=N,m[3*v+1]=q,m[3*v+2]=X,g[2*v]=k,g[2*v+1]=A,E.push(v),++v}_.push(E)}const b=new Array;for(let S=0;S<h;S++)for(let E=0;E<c;E++){const A=_[S][E],R=_[S][E+1],M=_[S+1][E+1],D=_[S+1][E];S===0?(b.push(A),b.push(M),b.push(D)):S===h-1?(b.push(A),b.push(R),b.push(M)):(b.push(A),b.push(R),b.push(M),b.push(M),b.push(D),b.push(A))}const T=[[C.POSITION,b],[C.NORMAL,b]],x=[[C.POSITION,new We(f,3,!0)],[C.NORMAL,new We(m,3,!0)]];return s.uv&&(x.push([C.UV0,new We(g,2,!0)]),T.push([C.UV0,b])),s.offset&&(T[0][0]=C.OFFSET,x[0][0]=C.OFFSET,T.push([C.POSITION,LC(b.length)]),x.push([C.POSITION,new We(Float64Array.from(s.offset),3,!0)])),new Ks(t,x,T)}function sYe(t,e,r,i){const{vertexAttributes:s,indices:n}=XTe(e,r,i);return new Ks(t,s,n)}function XTe(t,e,r){const i=t;let s,n;if(r)s=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],n=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const h=i*(1+Math.sqrt(5))/2;s=[-i,h,0,i,h,0,-i,-h,0,i,-h,0,0,-i,h,0,i,h,0,-i,-h,0,i,-h,h,0,-i,h,0,i,-h,0,-i,-h,0,i],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let h=0;h<s.length;h+=3)tT.scale(s,h,t/tT.length(s,h));let o={};function a(h,d){h>d&&([h,d]=[d,h]);const f=h.toString()+"."+d.toString();if(o[f])return o[f];let m=s.length;return s.length+=3,tT.add(s,3*h,s,3*d,s,m),tT.scale(s,m,t/tT.length(s,m)),m/=3,o[f]=m,m}for(let h=0;h<e;h++){const d=n.length,f=new Array(4*d);for(let m=0;m<d;m+=3){const g=n[m],_=n[m+1],v=n[m+2],b=a(g,_),T=a(_,v),x=a(v,g),S=4*m;f[S]=g,f[S+1]=b,f[S+2]=x,f[S+3]=_,f[S+4]=T,f[S+5]=b,f[S+6]=v,f[S+7]=x,f[S+8]=T,f[S+9]=b,f[S+10]=T,f[S+11]=x}n=f,o={}}const l=vne(s);for(let h=0;h<l.length;h+=3)tT.normalize(l,h);const c=[[C.POSITION,n],[C.NORMAL,n]];return{vertexAttributes:[[C.POSITION,new We(vne(s),3,!0)],[C.NORMAL,new We(l,3,!0)]],indices:c}}function LH(t,e,r,i,s,n,o,a,l=null){const c=r?[r[0],r[1],r[2]]:[0,0,0],h=e?[e[0],e[1],e[2]]:[0,0,1];o=o||[0,0];const d=i?[255*i[0],255*i[1],255*i[2],i.length>3?255*i[3]:255]:[255,255,255,255],f=s!=null&&s.length===2?s:[1,1],m=[[C.POSITION,new We(c,3,!0)],[C.NORMAL,new We(h,3,!0)],[C.UV0,new We(o,o.length)],[C.COLOR,new We(d,4,!0)],[C.SIZE,new We(f,2)]];if(n!=null){const g=[n[0],n[1],n[2],n[3]];m.push([C.AUXPOS1,new We(g,4)])}if(a!=null){const g=[a[0],a[1],a[2],a[3]];m.push([C.AUXPOS2,new We(g,4)])}return new Ks(t,m,null,null,us.Point,l)}const nYe=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function Y8t(t,e=nYe){const r=new Array(12);for(let h=0;h<4;h++)for(let d=0;d<3;d++)r[3*h+d]=e[h][d];const i=[0,1,2,2,3,0],s=[0,0,1],n=[0,0,0,0,0,0],o=[0,0,1,0,1,1,0,1],a=[255,255,255,255],l=[[C.POSITION,i],[C.NORMAL,n],[C.UV0,i],[C.COLOR,n]],c=[[C.POSITION,new We(r,3,!0)],[C.NORMAL,new We(s,3,!0)],[C.UV0,new We(o,2,!0)],[C.COLOR,new We(a,4,!0)]];return new Ks(t,c,l)}function Tne(t,e,r,i,s,n=!0,o=!0){let a=0;const l=r,c=e;let h=Qr(0,a,0),d=Qr(0,a+c,0),f=Qr(0,-1,0),m=Qr(0,1,0);s&&(a=c,d=Qr(0,0,0),h=Qr(0,a,0),f=Qr(0,1,0),m=Qr(0,-1,0));const g=[d,h],_=[f,m],v=i+2,b=Math.sqrt(c*c+l*l);if(s)for(let M=i-1;M>=0;M--){const D=M*(2*Math.PI/i),k=Qr(Math.cos(D)*l,a,Math.sin(D)*l);g.push(k);const L=Qr(c*Math.cos(D)/b,-l/b,c*Math.sin(D)/b);_.push(L)}else for(let M=0;M<i;M++){const D=M*(2*Math.PI/i),k=Qr(Math.cos(D)*l,a,Math.sin(D)*l);g.push(k);const L=Qr(c*Math.cos(D)/b,l/b,c*Math.sin(D)/b);_.push(L)}const T=new Array,x=new Array;if(n){for(let M=3;M<g.length;M++)T.push(1),T.push(M-1),T.push(M),x.push(0),x.push(0),x.push(0);T.push(g.length-1),T.push(2),T.push(1),x.push(0),x.push(0),x.push(0)}if(o){for(let M=3;M<g.length;M++)T.push(M),T.push(M-1),T.push(0),x.push(M),x.push(M-1),x.push(1);T.push(0),T.push(2),T.push(g.length-1),x.push(1),x.push(2),x.push(_.length-1)}const S=es(3*v);for(let M=0;M<v;M++)S[3*M]=g[M][0],S[3*M+1]=g[M][1],S[3*M+2]=g[M][2];const E=es(3*v);for(let M=0;M<v;M++)E[3*M]=_[M][0],E[3*M+1]=_[M][1],E[3*M+2]=_[M][2];const A=[[C.POSITION,T],[C.NORMAL,x]],R=[[C.POSITION,new We(S,3,!0)],[C.NORMAL,new We(E,3,!0)]];return new Ks(t,R,A)}function oYe(t,e,r,i,s,n,o){const a=s?V5(s):Qr(1,0,0),l=n?V5(n):Qr(0,0,0);o??(o=!0);const c=ls();_e(c,a);const h=ls();se(h,c,Math.abs(e));const d=ls();se(d,h,-.5),de(d,d,l);const f=Qr(0,1,0);Math.abs(1-ye(c,f))<.2&&ne(f,0,0,1);const m=ls();pt(m,c,f),_e(m,m),pt(f,m,c);const g=2*i+(o?2:0),_=i+(o?2:0),v=es(3*g),b=es(3*_),T=es(2*g),x=new Array(3*i*(o?4:2)),S=new Array(3*i*(o?4:2));o&&(v[3*(g-2)]=d[0],v[3*(g-2)+1]=d[1],v[3*(g-2)+2]=d[2],T[2*(g-2)]=0,T[2*(g-2)+1]=0,v[3*(g-1)]=v[3*(g-2)]+h[0],v[3*(g-1)+1]=v[3*(g-2)+1]+h[1],v[3*(g-1)+2]=v[3*(g-2)+2]+h[2],T[2*(g-1)]=1,T[2*(g-1)+1]=1,b[3*(_-2)]=-c[0],b[3*(_-2)+1]=-c[1],b[3*(_-2)+2]=-c[2],b[3*(_-1)]=c[0],b[3*(_-1)+1]=c[1],b[3*(_-1)+2]=c[2]);const E=(L,N,q)=>{x[L]=N,S[L]=q};let A=0;const R=ls(),M=ls();for(let L=0;L<i;L++){const N=L*(2*Math.PI/i);se(R,f,Math.sin(N)),se(M,m,Math.cos(N)),de(R,R,M),b[3*L]=R[0],b[3*L+1]=R[1],b[3*L+2]=R[2],se(R,R,r),de(R,R,d),v[3*L]=R[0],v[3*L+1]=R[1],v[3*L+2]=R[2],T[2*L]=L/i,T[2*L+1]=0,v[3*(L+i)]=v[3*L]+h[0],v[3*(L+i)+1]=v[3*L+1]+h[1],v[3*(L+i)+2]=v[3*L+2]+h[2],T[2*(L+i)]=L/i,T[2*L+1]=1;const q=(L+1)%i;E(A++,L,L),E(A++,L+i,L),E(A++,q,q),E(A++,q,q),E(A++,L+i,L),E(A++,q+i,q)}if(o){for(let L=0;L<i;L++){const N=(L+1)%i;E(A++,g-2,_-2),E(A++,L,_-2),E(A++,N,_-2)}for(let L=0;L<i;L++){const N=(L+1)%i;E(A++,L+i,_-1),E(A++,g-1,_-1),E(A++,N+i,_-1)}}const D=[[C.POSITION,x],[C.NORMAL,S],[C.UV0,x]],k=[[C.POSITION,new We(v,3,!0)],[C.NORMAL,new We(b,3,!0)],[C.UV0,new We(T,2,!0)]];return new Ks(t,k,D)}function Z8t(t,e,r,i,s,n,o=Qr(0,0,0)){const a=e.length,l=es(r.length*a*3+(6*i.length||0)),c=es(r.length*a*3+(i?6:0)),h=new Array,d=new Array;let f=0,m=0;const g=ls(),_=ls(),v=ls(),b=ls(),T=ls(),x=ls(),S=ls(),E=O(),A=ls(),R=ls(),M=ls(),D=ls(),k=ls(),L=Fr();ne(A,0,1,0),fe(_,r[1],r[0]),_e(_,_),n?(de(E,r[0],o),_e(v,E)):ne(v,0,0,1),Z5(_,v,A,A,T,v,Sne),ie(b,v),ie(D,T);for(let V=0;V<i.length;V++)se(x,T,i[V][0]),se(E,v,i[V][2]),de(x,x,E),de(x,x,r[0]),l[f++]=x[0],l[f++]=x[1],l[f++]=x[2];c[m++]=-_[0],c[m++]=-_[1],c[m++]=-_[2];for(let V=0;V<s.length;V++)h.push(s[V][0]>0?s[V][0]:-s[V][0]-1+i.length),h.push(s[V][1]>0?s[V][1]:-s[V][1]-1+i.length),h.push(s[V][2]>0?s[V][2]:-s[V][2]-1+i.length),d.push(0),d.push(0),d.push(0);let N=i.length;const q=i.length-1;for(let V=0;V<r.length;V++){let j=!1;V>0&&(ie(g,_),V<r.length-1?(fe(_,r[V+1],r[V]),_e(_,_)):j=!0,de(R,g,_),_e(R,R),de(M,r[V-1],b),RP(r[V],R,L),Rx(L,Du(M,g),E)?(fe(E,E,r[V]),_e(v,E),pt(T,R,v),_e(T,T)):Z5(R,b,D,A,T,v,Sne),ie(b,v),ie(D,T)),n&&(de(E,r[V],o),_e(k,E));for(let Y=0;Y<a;Y++)if(se(x,T,e[Y][0]),se(E,v,e[Y][1]),de(x,x,E),_e(S,x),c[m++]=S[0],c[m++]=S[1],c[m++]=S[2],de(x,x,r[V]),l[f++]=x[0],l[f++]=x[1],l[f++]=x[2],!j){const Q=(Y+1)%a;h.push(N+Y),h.push(N+a+Y),h.push(N+Q),h.push(N+Q),h.push(N+a+Y),h.push(N+a+Q);for(let te=0;te<6;te++){const ge=h.length-6;d.push(h[ge+te]-q)}}N+=a}const X=r[r.length-1];for(let V=0;V<i.length;V++)se(x,T,i[V][0]),se(E,v,i[V][1]),de(x,x,E),de(x,x,X),l[f++]=x[0],l[f++]=x[1],l[f++]=x[2];const G=m/3;c[m++]=_[0],c[m++]=_[1],c[m++]=_[2];const J=N-a;for(let V=0;V<s.length;V++)h.push(s[V][0]>=0?N+s[V][0]:-s[V][0]-1+J),h.push(s[V][2]>=0?N+s[V][2]:-s[V][2]-1+J),h.push(s[V][1]>=0?N+s[V][1]:-s[V][1]-1+J),d.push(G),d.push(G),d.push(G);const I=[[C.POSITION,h],[C.NORMAL,d]],z=[[C.POSITION,new We(l,3,!0)],[C.NORMAL,new We(c,3,!0)]];return new Ks(t,z,I)}function J8t(t,e,r,i){ot(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),ot(e[0].length===3,"createPolylineGeometry(): malformed vertex"),ot(r==null||r.length===e.length,"createPolylineGeometry: need same number of points and normals"),ot(r==null||r[0].length===3,"createPolylineGeometry(): malformed normal");const s=Xo(3*e.length),n=new Array(2*(e.length-1));let o=0,a=0;for(let h=0;h<e.length;h++){for(let d=0;d<3;d++)s[o++]=e[h][d];h>0&&(n[a++]=h-1,n[a++]=h)}const l=[],c=[];if(l.push([C.POSITION,n]),c.push([C.POSITION,new We(s,3,!0)]),r){const h=es(3*r.length);let d=0;for(let f=0;f<e.length;f++)for(let m=0;m<3;m++)h[d++]=r[f][m];l.push([C.NORMAL,n]),c.push([C.NORMAL,new We(h,3,!0)])}return i&&(c.push([C.COLOR,new We(i,4)]),l.push([C.COLOR,zE(i.length/4)])),new Ks(t,c,l,null,us.Line)}function aYe(t,e=t){const r=t.vertexAttributes,i=r.get(C.POSITION).data,s=r.get(C.NORMAL).data;if(s){const n=e.getMutableAttribute(C.NORMAL).data;for(let o=0;o<s.length;o+=3){const a=s[o+1];n[o+1]=-s[o+2],n[o+2]=a}}if(i){const n=e.getMutableAttribute(C.POSITION).data;for(let o=0;o<i.length;o+=3){const a=i[o+1];n[o+1]=-i[o+2],n[o+2]=a}}}function Ek(t,e,r,i,s){return!(Math.abs(ye(e,t))>s)&&(pt(r,t,e),_e(r,r),pt(i,r,t),_e(i,i),!0)}function Z5(t,e,r,i,s,n,o){return Ek(t,e,s,n,o)||Ek(t,r,s,n,o)||Ek(t,i,s,n,o)}const Sne=.99619469809;let lYe=class{constructor(e,r){this.type=aa.Local,this._configuration=new cQ,this._passParameters=new uQ,this._configuration.geometry=bm.Cylinder,this._technique=r.techniqueRepository.acquire(q5,this._configuration);const i=r.renderContext.rctx;this._vao=this._createVertexArrayObject(i),this._vaoCount=Go(this._vao,"geometry");const s=new xr;s.wrapMode=Dt.CLAMP_TO_EDGE,s.flipped=!0,s.width=1,s.height=512,this._passParameters.texture=new Ot(i,s,OXe)}destroy(){this._passParameters.texture=je(this._passParameters.texture),this._vao.dispose(),this._technique.release()}render(e){const r=e.rctx,i=r.bindTechnique(this._technique,this._passParameters,e.bindParameters);cYe(Ene,e.bindParameters.camera.viewMatrix),i.setUniformMatrix4fv("view",Ene),r.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(At.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(e){const r=XTe(1,2,!1),i=r.indices[0][1],s=r.vertexAttributes[0][1];for(let l=0;l<i.length;l+=3){const c=i[l];i[l]=i[l+2],i[l+2]=c}const n=s.data,o=Cne.createBuffer(i.length),a=o.position;for(let l=0;l<i.length;++l){const c=3*i[l];a.set(l,0,n[c]),a.set(l,1,n[c+1]),a.set(l,2,n[c+2])}return new Np(e,Tr,{geometry:Gc(Cne)},{geometry:kr.createVertex(e,Cr.STATIC_DRAW,o.buffer)})}};function cYe(t,e){zs(t,e),t[12]=0,t[13]=0,t[14]=0,t[15]=1}const Ene=xe(),Cne=qi().vec3f(C.POSITION),uYe=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]),n$=128,Ane=-kj,One=0,Ck=50,hYe=()=>1-511/512,dYe=dN([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);let pYe=class{constructor(e,r){this.view=e,this.type=aa.Mars,this._passParameters=new uQ,this._vaoCount=0,this._texV1=1;const i=Vr(e.spatialReference);this._planetRadius=i.radius,this._outerRimWidth=i.outerAtmosphereRimWidth,this._innerRimFactor=(this._planetRadius+Ane)/this._planetRadius,this._middleRimFactor=(this._planetRadius+One)/this._planetRadius,this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius,this._texV0=One/this._outerRimWidth,this._texVScale=this._texV1-this._texV0,this._techniqueRepository=r.techniqueRepository;const s=r.renderContext.rctx;this._cameraChangeHandle=le(()=>this.view.state?.camera,()=>r.requestRender(),Ls),this._vao=this._createRibbon(s),this._vaoCount=Go(this._vao,"geometry"),this._fadeVao=Hl(s),this._fadeVaoCount=Go(this._fadeVao,"geometry");const n=new xr;n.wrapMode=Dt.CLAMP_TO_EDGE,n.flipped=!0,n.width=1,n.height=512,this._passParameters.texture=new Ot(s,n,uYe);const o=new cQ;o.geometry=bm.Cone,this._coneTechnique=this._techniqueRepository.acquire(q5,o),o.geometry=bm.Underground,this._undergroundTechnique=this._techniqueRepository.acquire(q5,o)}destroy(){this._coneTechnique.release(),this._undergroundTechnique.release(),this._cameraChangeHandle.remove(),this._passParameters.texture=je(this._passParameters.texture),this._fadeVao.dispose(),this._vao.dispose()}render(e){const r=e.bindParameters.camera;this._update(r);const i=e.rctx;this._passParameters.undergroundFadeAlpha<1&&(i.bindTechnique(this._coneTechnique,this._passParameters,e.bindParameters),i.bindVAO(this._vao),i.drawArrays(At.TRIANGLES,0,this._vaoCount)),this._passParameters.undergroundFadeAlpha>0&&(i.bindTechnique(this._undergroundTechnique,this._passParameters,e.bindParameters),i.bindVAO(this._fadeVao),i.drawArrays(At.TRIANGLE_STRIP,0,this._fadeVaoCount))}renderHaze(){}_update(e){const r=O(),i=this._planetRadius,s=Re(e.eye),n=s-i;if(n<0){const m=Math.min(-n/5e3,1);this._passParameters.undergroundFadeAlpha=m}else this._passParameters.undergroundFadeAlpha=0;const o=Math.max(Ck,n),a=i+Ane;this._passParameters.innerScale=fYe(i+o,i,a)-1,this._passParameters.altitudeFade=HJ(n),se(r,e.eye,(i+Ck)/s),Rne(r,e.center,e.up,i,this._passParameters.silhouette);const l=this._computeScreenRimWidth(e,r,e.up,this._passParameters.silhouette),c=hYe(),h=dYe(n);let d=this._texV0+c*this._texVScale,f=this._texV0+l*h*this._texVScale;if(n>Ck){Rne(e.eye,e.center,e.up,i,this._passParameters.silhouette);const m=this._computeScreenRimWidth(e,e.eye,e.up,this._passParameters.silhouette),g=ve((m-1.5)/(l-1.5),0,1);d=this._texV0+g*c*this._texVScale,f=this._texV0+St(this._texV1,l*h,g)*this._texVScale}or(this._passParameters.texV,d,f)}_createRibbon(e){const r=es(3+3*n$*3),i=new Uint32Array(3*n$*5);r[0]=0,r[1]=0,r[2]=-1;for(let o=0;o<n$;o++){const a=9*o+3;r[a]=o,r[a+1]=this._innerRimFactor,r[a+2]=-1,r[a+3]=o,r[a+4]=this._middleRimFactor,r[a+5]=0,r[a+6]=o,r[a+7]=this._outerRimFactor,r[a+8]=1;const l=3*o+1,c=o===n$-1?1:l+3,h=15*o;i[h]=l,i[h+1]=l+1,i[h+2]=c+1,i[h+3]=c+1,i[h+4]=c,i[h+5]=l,i[h+6]=l+1,i[h+7]=l+2,i[h+8]=c+2,i[h+9]=c+2,i[h+10]=c+1,i[h+11]=l+1,i[h+12]=l,i[h+13]=c,i[h+14]=0}const s=Mne.createBuffer(i.length),n=s.position;for(let o=0;o<i.length;++o){const a=3*i[o];n.set(o,0,r[a]),n.set(o,1,r[a+1]),n.set(o,2,r[a+2])}return new Np(e,Tr,{geometry:Gc(Mne)},{geometry:kr.createVertex(e,Cr.STATIC_DRAW,s.buffer)})}_computeScreenRimWidth(e,r,i,s){return de(sT,s.center,s.v2),se(o$,sT,this._outerRimFactor),_8(Ak,r,sT,i),Jse(sT,Ak,e.projectionMatrix,e.viewport,sT),Jse(o$,Ak,e.projectionMatrix,e.viewport,o$),mi(sT,o$)/e.height}};function Rne(t,e,r,i,s){const n=Re(t),o=i*Math.sqrt(n*n-i*i)/n,a=Math.sqrt(i*i-o*o),l=s.v1,c=s.v2;return se(s.center,t,a/n),pt(l,t,e),da(l)<1&&pt(l,t,r),se(l,l,o/Re(l)),pt(c,l,t),se(c,c,o/Re(c)),o}const Ak=xe(),sT=O(),o$=O();function fYe(t,e,r){return t*t/(Math.sqrt(t*t-e*e)*Math.sqrt(t*t-r*r)+e*r)}const Mne=qi().vec3f(C.POSITION);var S0;(function(t){t[t.Rain=0]="Rain",t[t.Snow=1]="Snow",t[t.COUNT=2]="COUNT"})(S0||(S0={}));let DH=class extends Sa{constructor(){super(...arguments),this.type=S0.Rain}};u([B({count:S0.COUNT})],DH.prototype,"type",void 0);function mYe(t){const e=new Sr;return e.attributes.add(C.POSITION,"vec3"),e.attributes.add(C.INSTANCEFEATUREATTRIBUTE,"float"),e.vertex.uniforms.add(new kt("cameraPosition",(r,i)=>i.camera.eye)),e.vertex.uniforms.add(new kt("offset",(r,i)=>gYe(r,i))),e.vertex.uniforms.add(new Ie("width",r=>r.width)),e.vertex.uniforms.add(new Ui("proj",(r,i)=>i.camera.projectionMatrix)),e.vertex.uniforms.add(new Ui("view",(r,i)=>i.camera.viewMatrix)),e.vertex.uniforms.add(new Ie("time",r=>r.time)),e.varyings.add("vUv","vec2"),e.vertex.code.add(w`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${t.type===S0.Rain?w`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:w`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),e.fragment.uniforms.add(new Ie("opacity",r=>r.opacity),new kt("particleColor",(r,i)=>yYe(i,t))),e.fragment.code.add(w`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${t.type===S0.Rain?w`d = 0.35 * smoothstep(0.5, 0.0, d);`:w`d = smoothstep(0.5, 0.1, d);`}
      fragColor = opacity * vec4(particleColor * d, d);
    }
  `),e}function gYe(t,e){const r=e.camera.eye,i=.5*t.width,s=1/t.width,n=Cye(NH,ne(NH,(r[0]+i)*s,(r[1]+i)*s,(r[2]+i)*s));return Pn(n,r,se(n,n,t.width))}function yYe(t,e){const r=e.type===S0.Rain?vYe:_Ye,i=se(NH,r,bYe),s=t.camera.eye;_e(Pne,s);const n=Math.max(0,ye(Pne,t.lighting.mainLight.direction));return qr(i,i,r,n)}const NH=O(),Pne=O(),_Ye=Pe(1,1,1),vYe=Pe(.85,.85,.85),bYe=.7,wYe=Object.freeze(Object.defineProperty({__proto__:null,build:mYe},Symbol.toStringTag,{value:"Module"}));let xYe=class extends ii{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=1}},FH=class YTe extends Lr{initializeProgram(e){return new Rr(e.rctx,YTe.shader.get().build(this.configuration),AN)}initializePipeline(){return Mt({blending:Oo(Se.ONE,Se.ONE,Se.ONE_MINUS_SRC_ALPHA,Se.ONE_MINUS_SRC_ALPHA),depthTest:{func:ri.LEQUAL},colorWrite:Bt})}};FH.shader=new Or(wYe,()=>he(()=>import("./Precipitation.glsl-9a97b6f9.js"),[],import.meta.url));const AN=new Map([[C.POSITION,0],[C.INSTANCEFEATUREATTRIBUTE,1]]);let ZTe=class{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance({deltaTime:e,fixedTime:r}){return r!=null?this._time!==r&&(this._time=r,!0):(this._time=this._time+e,e!==0)}},TYe=class{constructor(e,r){this.deltaTime=e,this.fixedTime=r}},ob=class extends Te{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._passParameters=new xYe,this._animation=new ZTe,this._updatingTracking=new tm,this._passParameters.time=0,this._passParameters.radius=Vr(e.view.spatialReference).radius,this._techniqueRepository=e.context.techniqueRepository}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechniqueCached=Gi(this._snowTechniqueCached),this._rainTechniqueCached=Gi(this._rainTechniqueCached),this._vao=je(this._vao),this._instanceIdBuffer=je(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get _rainTechnique(){if(this._rainTechniqueCached==null){const e=new DH;e.type=S0.Rain,this._rainTechniqueCached=this._techniqueRepository.acquire(FH,e)}return this._rainTechniqueCached}get _snowTechnique(){if(this._snowTechniqueCached==null){const e=new DH;e.type=S0.Snow,this._snowTechniqueCached=this._techniqueRepository.acquire(FH,e)}return this._snowTechniqueCached}update(e){return this._animation.advance(e)}render(e,r,i){const s=i==="rainy"?this._rainTechnique:this._snowTechnique;if(!s.compiled)return void this.context.requestRender();const n=e.rctx;if(this._ensureResources(n),s==null||this._vao==null||this._instanceIdBuffer==null||(e.bindParameters.cloudsFade.data!=null&&(this._passParameters.opacity=1-e.bindParameters.cloudsFade.fadeInOutHeight.factor),this._passParameters.opacity<=0))return;const o=.35;r=r<.5?St(0,o,2*r):St(o,1,2*(r-.5)),this._passParameters.time=(i==="rainy"?this._rainSpeed:this._snowSpeed)*PY(this._animation.time)%1e5;const a=n.bindTechnique(s,this._passParameters,e.bindParameters);n.bindVAO(this._vao),a.assertCompatibleVertexAttributeLocations(this._vao),XJ(n,AN,this._instanceIdBuffer,Ine,0),n.capabilities.instancing?.drawArraysInstanced(At.TRIANGLES,0,3,this._numParticles*r),YJ(n,AN,this._instanceIdBuffer,Ine)}_ensureResources(e){this._vao==null&&(this._vao=this._createVertexArrayObject(e)),this._instanceIdBuffer==null&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const r=[];for(let i=0;i<this._numParticles;i++)r.push(i);return kr.createVertex(e,Cr.STATIC_DRAW,new Float32Array(r))}_createVertexArrayObject(e){const r=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new Np(e,AN,{geometry:Gc(SYe)},{geometry:kr.createVertex(e,Cr.STATIC_DRAW,r)})}};u([p({constructOnly:!0})],ob.prototype,"context",void 0),u([p({constructOnly:!0})],ob.prototype,"view",void 0),u([p({readOnly:!0})],ob.prototype,"updating",null),u([p()],ob.prototype,"_updatingTracking",void 0),ob=u([P("esri.views.3d.environment.Precipitation")],ob);const SYe=qi().vec3f(C.POSITION),Ine=Gc(qi().f32(C.INSTANCEFEATUREATTRIBUTE),1);function EYe(){const t=new Sr;return t.attributes.add(C.POSITION,"vec3"),t.attributes.add(C.COLOR,"vec4"),t.attributes.add(C.SIZE,"float"),t.varyings.add("vcolor","vec4"),t.varyings.add("vsize","float"),t.vertex.uniforms.add(new Ui("transform",(e,r)=>CYe(e,r)),new sr("viewport",(e,r)=>r.camera.fullViewport),new Ie("pixelRatio",(e,r)=>r.camera.pixelRatio)),t.vertex.code.add(w`void main(void) {
gl_Position = transform * vec4(position, 0);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),t.fragment.code.add(w`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
fragColor = vec4(vcolor.xyz, intensity);
}`),t}function CYe(t,e){return zs(sy,e.camera.projectionMatrix),sy[10]=24e-8-1,sy[11]=-1,sy[14]=(24e-8-2)*e.camera.near,ai(sy,sy,e.camera.viewMatrix),ai(sy,sy,t.modelMatrix)}const sy=xe(),AYe=Object.freeze(Object.defineProperty({__proto__:null,build:EYe},Symbol.toStringTag,{value:"Module"}));let OYe=class extends ii{constructor(){super(...arguments),this.modelMatrix=xe()}},JTe=class QTe extends Lr{constructor(e){super(e,new Sa,()=>this.destroy())}initializeProgram(e){return new Rr(e.rctx,QTe.shader.get().build(),Tr)}initializePipeline(){return Mt({blending:Oo(Se.SRC_ALPHA,Se.ONE,Se.ONE_MINUS_SRC_ALPHA,Se.ONE_MINUS_SRC_ALPHA),depthTest:{func:ri.LEQUAL},colorWrite:Bt})}};JTe.shader=new Or(AYe,()=>he(()=>import("./Stars.glsl-573a2639.js"),[],import.meta.url));let Qy=class extends Te{get updating(){return this._updatingTracking.updating||this.loading}get loading(){return this._loadDataTask!=null&&!this._loadDataTask.finished}constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._renderParameter=new OYe,this._updatingTracking=new tm}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=zl(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=Gi(this._technique),this._vao=je(this._vao),t1=null}render(e){const{rctx:r}=e;if(this._ensureResources(r),this._technique==null||this._vao==null)return;if(!this._technique.compiled)return void this.requestRender();const i=r.bindTechnique(this._technique,this._renderParameter,e.bindParameters);r.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(At.POINTS,0,this._numPoints)}_ensureResources(e){if(this._technique!=null||t1==null)return;this._technique=new JTe({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=t1.byteLength/$ne;const r=new Float32Array(t1,0,2*this._numPoints),i=new Uint8Array(t1,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(e,r,i,this._numPoints),this._updatingTracking.add(()=>this.view.environment.lighting.type!=="virtual"?this.view.environment.lighting.date:null,s=>this._update(s),Pr)}_computeDayDuration(e){const r=e,i=new Date(e.getFullYear(),0,1,11,58,56);return(+r-+i)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+i)}_update(e){if(!e)return;const r=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,i=2*this._computeDayDuration(e),s=zs(this._renderParameter.modelMatrix,PYe);CE(s,s,-i*Math.PI),ai(s,MYe,s),CE(s,s,-r*Math.PI),this.requestRender()}_hexToRGB(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}_unpackUint8Attributes(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}_createVertexArrayObject(e,r,i,s){const n=Lne.createBuffer(s),o=n.position,a=n.color,l=n.size;for(let c=0;c<s;c++){const h=r[2*c],d=r[2*c+1];o.set(c,0,-Math.cos(h)*Math.sin(d)),o.set(c,1,-Math.sin(h)*Math.sin(d)),o.set(c,2,-Math.cos(d));const f=this._unpackUint8Attributes(i[c]),m=this._hexToRGB(RYe[f[1]]);a.set(c,0,255*m[0]),a.set(c,1,255*m[1]),a.set(c,2,255*m[2]),a.set(c,3,255),l.set(c,f[0])}return new Np(e,Tr,{geometry:Gc(Lne)},{geometry:kr.createVertex(e,Cr.STATIC_DRAW,n.buffer)})}_createLoadDataTask(){if(t1!=null)return null;const e=vC(async r=>{const{data:i}=await GFe("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:r});this._verifyStarData(i),t1=i});return e.promise.catch(r=>{ds(r)||K.getLogger(this).error(r)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}_verifyStarData(e){if(!e)throw new U("stars:no-data-received","Failed to create stars because star catalogue is missing");const r=e.byteLength/$ne;if(r%1!=0||r>5e4||r<5e3)throw new U("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};u([p({constructOnly:!0})],Qy.prototype,"view",void 0),u([p({constructOnly:!0})],Qy.prototype,"requestRender",void 0),u([p({readOnly:!0})],Qy.prototype,"updating",null),u([p()],Qy.prototype,"_loadDataTask",void 0),u([p()],Qy.prototype,"_updatingTracking",void 0),Qy=u([P("esri.views.3d.environment.Stars")],Qy);const RYe=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],MYe=wJ(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),PYe=wJ(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),$ne=9,Lne=qi().vec3f(C.POSITION).vec4u8(C.COLOR).f32(C.SIZE);let t1=null;function IYe(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function J5(t,e,r){r*=.5;const i=Math.sin(r);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(r),t}function bQ(t,e){const r=2*Math.acos(e[3]),i=Math.sin(r/2);return i>cl()?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=1,t[1]=0,t[2]=0),r}function J8(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=r[0],l=r[1],c=r[2],h=r[3];return t[0]=i*h+o*a+s*c-n*l,t[1]=s*h+o*l+n*a-i*c,t[2]=n*h+o*c+i*l-s*a,t[3]=o*h-i*a-s*l-n*c,t}function $Ye(t,e,r){r*=.5;const i=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+o*a,t[1]=s*l+n*a,t[2]=n*l-s*a,t[3]=o*l-i*a,t}function LYe(t,e,r){r*=.5;const i=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l-n*a,t[1]=s*l+o*a,t[2]=n*l+i*a,t[3]=o*l-s*a,t}function DYe(t,e,r){r*=.5;const i=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+s*a,t[1]=s*l-i*a,t[2]=n*l+o*a,t[3]=o*l-n*a,t}function NYe(t,e){const r=e[0],i=e[1],s=e[2];return t[0]=r,t[1]=i,t[2]=s,t[3]=Math.sqrt(Math.abs(1-r*r-i*i-s*s)),t}function ON(t,e,r,i){const s=e[0],n=e[1],o=e[2],a=e[3];let l,c,h,d,f,m=r[0],g=r[1],_=r[2],v=r[3];return c=s*m+n*g+o*_+a*v,c<0&&(c=-c,m=-m,g=-g,_=-_,v=-v),1-c>cl()?(l=Math.acos(c),h=Math.sin(l),d=Math.sin((1-i)*l)/h,f=Math.sin(i*l)/h):(d=1-i,f=i),t[0]=d*s+f*m,t[1]=d*n+f*g,t[2]=d*o+f*_,t[3]=d*a+f*v,t}function FYe(t){const e=fP,r=e(),i=e(),s=e(),n=Math.sqrt(1-r),o=Math.sqrt(r);return t[0]=n*Math.sin(2*Math.PI*i),t[1]=n*Math.cos(2*Math.PI*i),t[2]=o*Math.sin(2*Math.PI*s),t[3]=o*Math.cos(2*Math.PI*s),t}function UYe(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=r*r+i*i+s*s+n*n,a=o?1/o:0;return t[0]=-r*a,t[1]=-i*a,t[2]=-s*a,t[3]=n*a,t}function wm(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function KTe(t,e){const r=e[0]+e[4]+e[8];let i;if(r>0)i=Math.sqrt(r+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[3*s+s]&&(s=2);const n=(s+1)%3,o=(s+2)%3;i=Math.sqrt(e[3*s+s]-e[3*n+n]-e[3*o+o]+1),t[s]=.5*i,i=.5/i,t[3]=(e[3*n+o]-e[3*o+n])*i,t[n]=(e[3*n+s]+e[3*s+n])*i,t[o]=(e[3*o+s]+e[3*s+o])*i}return t}function kYe(t,e,r,i){const s=.5*Math.PI/180;e*=s,r*=s,i*=s;const n=Math.sin(e),o=Math.cos(e),a=Math.sin(r),l=Math.cos(r),c=Math.sin(i),h=Math.cos(i);return t[0]=n*l*h-o*a*c,t[1]=o*a*h+n*l*c,t[2]=o*l*c-n*a*h,t[3]=o*l*h+n*a*c,t}function zYe(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}const NP=Nh,VYe=Ti,BYe=wZ,GYe=J8,jYe=Uw,HYe=Lye,qYe=Y6,e2e=xZ,WYe=e2e,t2e=TZ,XYe=t2e,wQ=$ye,YYe=MS,ZYe=c5;function JYe(t,e,r){const i=ye(e,r);return i<-.999999?(pt(Wp,QYe,e),mc(Wp)<1e-6&&pt(Wp,KYe,e),_e(Wp,Wp),J5(t,Wp,Math.PI),t):i>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(pt(Wp,e,r),t[0]=Wp[0],t[1]=Wp[1],t[2]=Wp[2],t[3]=1+i,wQ(t,t))}const Wp=O(),QYe=Pe(1,0,0),KYe=Pe(0,1,0);function eZe(t,e,r,i,s,n){return ON(Dne,e,s,n),ON(Nne,r,i,n),ON(t,Dne,Nne,2*n*(1-n)),t}const Dne=rd(),Nne=rd();function tZe(t,e,r,i){const s=rZe;return s[0]=r[0],s[3]=r[1],s[6]=r[2],s[1]=i[0],s[4]=i[1],s[7]=i[2],s[2]=-e[0],s[5]=-e[1],s[8]=-e[2],wQ(t,KTe(t,s))}const rZe=ki();Object.freeze(Object.defineProperty({__proto__:null,add:BYe,calculateW:NYe,conjugate:wm,copy:NP,dot:HYe,equals:ZYe,exactEquals:YYe,fromEuler:kYe,fromMat3:KTe,getAxisAngle:bQ,identity:IYe,invert:UYe,len:WYe,length:e2e,lerp:qYe,mul:GYe,multiply:J8,normalize:wQ,random:FYe,rotateX:$Ye,rotateY:LYe,rotateZ:DYe,rotationTo:JYe,scale:jYe,set:VYe,setAxes:tZe,setAxisAngle:J5,slerp:ON,sqlerp:eZe,sqrLen:XYe,squaredLength:t2e,str:zYe},Symbol.toStringTag,{value:"Module"}));function k0(t=sZe){return[t[0],t[1],t[2],t[3]]}function Ok(t,e,r=k0()){return ie(r,t),r[3]=e,r}function Fne(t,e,r=k0()){return pt(r,t,e),_e(r,r),r[3]=-Oye(t,e),r}function Une(t,e,r=k0()){return J5(a$,t,kne(t)),J5(zne,e,kne(e)),J8(a$,zne,a$),iZe(r,al(bQ(r,a$)))}function a9t(t,e,r,i=k0()){return Ok(Sye,t,l$),Ok(Eye,e,Vne),Ok(_Z,r,Bne),Une(l$,Vne,l$),Une(l$,Bne,i),i}function l9t(t){return t}function c9t(t){return t[3]}function kne(t){return Ft(t[3])}function iZe(t,e){return t[3]=e,t}const sZe=[0,0,1,0],a$=rd(),zne=rd();k0();const l$=k0(),Vne=k0(),Bne=k0();function nZe(t,e,r){const i=t.parallax.anchorPointClouds;t.fadeIn.stage===vc.FINISHED&&(t.fadeIn.factor=0,ie(i,Vf),t.fadeIn.stage=vc.CHANGE_ANCHOR,t.crossFade.enabled=!1,t.fadeInOut.stage=Sn.FINISHED),t.fadeIn.stage===vc.CHANGE_ANCHOR&&t.isCameraPositionFinal&&(tQ(t.data)&&t.renderingStage!==Ds.RENDERING||t.renderingStage===Ds.FADING_TEXTURE_CHANNELS)&&(ie(i,Vf),t.fadeIn.stage=vc.FADE_IN,t.startTime=e,t.renderingStage===Ds.FADING_TEXTURE_CHANNELS&&(t.renderingStage=Ds.SWITCH_CHANNELS)),t.fadeIn.factor<1&&t.fadeIn.stage===vc.FADE_IN?t.fadeIn.factor=r?ve((e-t.startTime)/(r2e*r),0,1):1:t.fadeIn.factor>=1&&t.fadeIn.stage===vc.FADE_IN&&(t.fadeIn.stage=vc.FINISHED,t.fadeIn.factor=1)}function oZe(t,e,r){const{fadeInOut:i,crossFade:s}=t;i.stage===Sn.FINISHED&&(t.startTime=e,i.factor=1,i.stage=Sn.FADE_OUT),i.factor>0&&i.stage===Sn.FADE_OUT?i.factor=r?1-ve((e-t.startTime)/(hZe*r),0,1):0:(i.factor<=0&&i.stage===Sn.FADE_OUT&&(i.factor=0,ie(t.parallax.anchorPointClouds,Vf)),i.factor<=0&&i.stage===Sn.FADE_OUT&&t.isCameraPositionFinal&&(i.factor=0,i.stage=Sn.SWITCH,t.crossFade.enabled=!1,s.factor=1),i.stage===Sn.SWITCH&&(tQ(t.data)&&t.renderingStage!==Ds.RENDERING||t.renderingStage===Ds.FADING_TEXTURE_CHANNELS)&&(t.startTime=e,i.factor=0,i.stage=Sn.FADE_IN,ie(t.parallax.anchorPointClouds,Vf),t.crossFade.enabled=!1,s.factor=1,t.renderingStage===Ds.FADING_TEXTURE_CHANNELS&&(t.renderingStage=Ds.SWITCH_CHANNELS)),i.factor<1&&i.stage===Sn.FADE_IN?i.factor=r?ve((e-t.startTime)/(r2e*r),0,1):1:i.factor>=1&&i.stage===Sn.FADE_IN&&(i.stage=Sn.FINISHED,i.factor=1))}function aZe(t,e,r,i){const{crossFade:s}=t,n=t.parallax.anchorPointClouds;t.crossFade.enabled&&!i||(ie(t.parallaxNew.anchorPointClouds,Vf),t.startTime=e,s.factor=0,t.crossFade.enabled=!0),s.factor<1&&t.crossFade.enabled?s.factor=r?ve((e-t.startTime)/(dZe*r),0,1):1:s.factor>=1&&t.crossFade.enabled&&(t.crossFade.enabled=!1,s.factor=1,ie(n,t.parallaxNew.anchorPointClouds),t.renderingStage===Ds.FADING_TEXTURE_CHANNELS&&(t.renderingStage=Ds.SWITCH_CHANNELS))}function Gne(t,e,r,i){const s=t.fadeInOutHeight,n=s.stage===mv.FINISHED?r:t.startTimeHeightFade;if(i!==0){const o=(r-n)/(pZe*i);s.factor+=e?-o:o}else s.factor=e?0:1;t.startTimeHeightFade=r,s.factor=ve(s.factor,0,1),s.stage=mv.HEIGHT_FADE}function lZe(t,e,r,i,s){t.renderingStage===Ds.FINISHED_RENDERING&&(t.renderingStage=Ds.FADING_TEXTURE_CHANNELS);const n=Re(e.eye);t.fadeInOutHeight.factor<0&&(t.fadeInOutHeight.factor=n-nr.radius>Df?1:0),t.isCameraPositionFinal=nv(t.cameraPositionLastFrame,e.eye),_e(Vf,e.eye),se(Vf,Vf,nr.radius);const o=t.parallax;o.anchorPointClouds[0]===0&&o.anchorPointClouds[1]===0&&o.anchorPointClouds[2]===0&&ie(o.anchorPointClouds,Vf);const a=Re(fe(uZe,o.anchorPointClouds,Vf));let l=!0;a>t.fadeIn.distanceThresholdFactor*o.cloudsHeight||t.fadeIn.stage!==vc.FINISHED?nZe(t,i,s):a>t.fadeInOut.distanceThresholdFactor*o.cloudsHeight||t.fadeInOut.stage!==Sn.FINISHED?oZe(t,i,s):a>t.crossFade.distanceThresholdFactor*o.cloudsHeight||t.crossFade.enabled||t.renderingStage===Ds.FADING_TEXTURE_CHANNELS?aZe(t,i,s,(r!==Ur.IDLE||!tQ(t.data))&&t.renderingStage!==Ds.FADING_TEXTURE_CHANNELS):l=!1;const c=n-nr.radius;if((c>1.7*Df||c<-Df)&&t.fadeInOutHeight.factor<1?t.fadeInOutHeight.factor=1:(c>Df||c<-.35*Df)&&t.fadeInOutHeight.factor<1?Gne(t,!1,i,s):c<Df&&c>-.35*Df&&t.fadeInOutHeight.factor>0?Gne(t,!0,i,s):t.fadeInOutHeight.stage=mv.FINISHED,t.renderingStage===Ds.SWITCH_CHANNELS&&(t.readChannels=1-t.readChannels,t.renderingStage=Ds.FINISHED),o.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(n*n-nr.radius*nr.radius,0))/n,Fne(jne,o.anchorPointClouds,nT),Rc(o.transform,pn,nT[3],nT),l){const{parallaxNew:h}=t;Fne(jne,h.anchorPointClouds,nT),Rc(h.transform,pn,nT[3],nT)}ie(t.cameraPositionLastFrame,e.eye)}function cZe(t){return t.crossFade.enabled||t.fadeInOut.stage!==Sn.FINISHED||t.fadeIn.stage!==vc.FINISHED||t.fadeInOutHeight.stage!==mv.FINISHED||t.renderingStage!==Ds.FINISHED}const jne=Pe(0,0,1),nT=k0(),Vf=O(),uZe=O(),r2e=1,hZe=.5,dZe=1.3,pZe=1;let DC=class{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(e,r){return this._outer.get(e)?.get(r)}set(e,r,i){const s=this._outer.get(e);s?s.set(r,i):this._outer.set(e,new Map([[r,i]]))}delete(e,r){const i=this._outer.get(e);i&&(i.delete(r),i.size===0&&this._outer.delete(e))}forEach(e){this._outer.forEach((r,i)=>e(r,i))}};var Js;function Hne(t=!ae("disable-feature:high-quality-idle"),e=null){const r=new DC;return t?(r.set(Ur.IDLE,Js.Antialiasing,e!=="low"),r.set(Ur.IDLE,Js.HighResolutionAtmosphere,e!=="low"),r.set(Ur.IDLE,Js.HighQualityTransparency,!0),r.set(Ur.IDLE,Js.SSAO,!0),r.set(Ur.IDLE,Js.WaterReflection,!0),r.set(Ur.IDLE,Js.PhysicalPixelRendering,!ae("esri-mobile"))):(r.set(Ur.ANIMATING,Js.HighResolutionShadows,!0),r.set(Ur.INTERACTING,Js.HighResolutionShadows,!0)),r.set(Ur.IDLE,Js.HighResolutionShadows,!0),r.set(Ur.IDLE,Js.HighResolutionVoxel,!0),r}(function(t){t[t.Antialiasing=0]="Antialiasing",t[t.HighQualityTransparency=1]="HighQualityTransparency",t[t.HighResolutionVoxel=2]="HighResolutionVoxel",t[t.HighResolutionAtmosphere=3]="HighResolutionAtmosphere",t[t.SSAO=4]="SSAO",t[t.WaterReflection=5]="WaterReflection",t[t.HighResolutionShadows=6]="HighResolutionShadows",t[t.PhysicalPixelRendering=7]="PhysicalPixelRendering"})(Js||(Js={}));var zS;(function(t){t[t.Immediate=0]="Immediate",t[t.Faded=1]="Faded"})(zS||(zS={}));var uO;const fZe=[pe.POSTPROCESSING_ENVIRONMENT_OPAQUE,pe.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];let Io=uO=class extends Te{constructor(t){super(t),this._context=null,this._atmosphere=null,this._oldWeatherParameters=new Rk,this._newWeatherParameters=new Rk,this._fadedWeatherParameters=new Rk,this._weatherParameters=this._newWeatherParameters}initialize(){this.view._stage.addRenderPlugin(fZe,this)}destroy(){this.removeHandles(),this.uninitializeRenderContext(),this.view?._stage!=null&&this.view._stage.removeRenderPlugin(this),this._set("view",null)}get atmosphere(){return this._atmosphere}get _atmosphereType(){return this.atmosphere!=null?this.atmosphere.type:aa.None}get canRender(){return!(this._atmosphere===null&&this._stars===null)}get needsLinearDepth(){return this._atmosphereType===aa.Realistic}updateAnimation(t){return this._precipitation!=null&&this._precipitation.update(t)}get updating(){return this._stars!=null&&this._stars.updating||this._clouds!=null&&this._clouds.running}get weatherVisible(){return Re(this.view.state.camera.eye)-Vr(this.view.spatialReference).radius<=Df}get _stars(){const t=this.view,e=t.environment?.starsEnabled??!1,r=this._get("_stars");return e&&this._context!=null?r??new Qy({view:t,requestRender:()=>this._setNeedsRender()}):(Ne(r),null)}get _precipitation(){const t=this._get("_precipitation");if(!this._precipitationEnabled||this._context==null)return Ne(t),null;const e=this.view,r=this._context;return t!=null&&t.context===r?t:(Ne(t),new ob({context:r,view:e}))}get _clouds(){const t=this._get("_clouds");if(!this.weatherEnabled||this._context==null)return Ne(t),null;if(t!=null)return t;const e=this.view,r=this._context;return Ne(t),new Tl({context:r,view:e,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const t=this._get("_cloudsComposition");if(!this.weatherEnabled||this._context==null)return Ne(t),null;const e=this.view.state.viewingMode,r=this._context.renderContext.rctx,i=Vr(this.view.spatialReference).radius;return t!=null&&t.viewingMode===e&&t.planetRadius===i?t:(Ne(t),new ib({rctx:r,viewingMode:e,planetRadius:i,requestRender:()=>this._setNeedsRender()}))}get _fog(){const t=this._get("_fog");if(!this.weatherEnabled||this._context==null)return Ne(t),null;if(t!=null)return t;const e=this.view,r=this._context,i=this._context.renderContext.rctx,s=this.view.state.viewingMode;return new sb({context:r,view:e,rctx:i,viewingMode:s})}get weatherEnabled(){return!!this.view?.environmentManager?.weatherEnabled}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(t=null){this._context=t;const e=()=>this._setNeedsRender();this.addHandles([le(()=>({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),r=>this._updateAtmosphere(r),Ls),le(()=>this._stars,e),le(()=>this._precipitation,e),le(()=>this._clouds,()=>this._updateWeather(),Pr),le(()=>this._fog,()=>this._updateFogHaze(),Pr),le(()=>this.view.state.mode,()=>{this._setNeedsRender()},Wr),le(()=>this._weatherUpdateParameters,()=>{this._updateWeather(),this._updateFogHaze()},Ls)])}uninitializeRenderContext(){this._context=null,this._atmosphere=Ne(this._atmosphere),this._set("_stars",Ne(this._stars)),this._set("_precipitation",Ne(this._precipitation)),this._set("_clouds",Ne(this._clouds)),this._set("_cloudsComposition",Ne(this._cloudsComposition)),this._set("_fog",Ne(this._fog))}prepareRender(t){t.bindParameters.cloudsFade.data=rWe(this._clouds)?this._clouds:null,this.view.viewingMode!=="local"&&t.bindParameters.cloudsFade.data?.cubeMap!=null&&(lZe(t.bindParameters.cloudsFade,t.bindParameters.camera,this.view.state.mode,t.time,this.view.qualitySettings.fadeDuration),this._updateWeatherFading(t.bindParameters),t.bindParameters.cloudsFade.renderingStage===Ds.FINISHED&&this._clouds!=null&&this._clouds.coverage===0&&this._clouds.running===!1&&(this._clouds.destroyFrameBufferCube(),t.bindParameters.cloudsFade.data=null))}render(t){if(t.output===F.Color)switch(t.bindParameters.slot){case pe.POSTPROCESSING_ENVIRONMENT_OPAQUE:this._stars!=null&&this._stars.render(t),this.atmosphere!=null&&(this.atmosphere.render(t,this.view?.qualitySettings.highResolutionAtmosphere||this.view?._stage?.renderer?.isFeatureEnabled(Js.HighResolutionAtmosphere)),this._cloudsComposition!=null&&t.bindParameters.cloudsFade.data!=null&&(this.weatherVisible&&this._clouds!=null&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(t)),cZe(t.bindParameters.cloudsFade)&&this._context!=null&&t.bindParameters.cloudsFade.data?.cubeMap!=null&&this._context.requestRender());break;case pe.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if(this.atmosphere!=null&&(this.atmosphere.renderHaze(t,this._weatherParameters.hazeAmount,this.view?.qualitySettings.highResolutionAtmosphere||this.view?._stage?.renderer?.isFeatureEnabled(Js.HighResolutionAtmosphere)),this._weatherParameters.fog.amount>0&&this._fog!=null&&this._fog.render(t,this._weatherParameters.fog),this._precipitation!=null)){const e=this.view.environment.weather;e.type!=="rainy"&&e.type!=="snowy"||this._precipitation.render(t,e.precipitation,e.type)}}}updateLightSources(t,e,r,i){if(this._context!=null){const s=this._context.renderContext;s.bindParameters.oldLighting.copyFrom(s.bindParameters.lighting),s.bindParameters.newLighting.noonFactor=e,s.bindParameters.newLighting.globalFactor=r,s.bindParameters.newLighting.set(t),i===zS.Faded||s.bindParameters.weatherFading?s.bindParameters.fadeLighting(0):s.bindParameters.fadeLighting(1),this._context.requestRender()}}get _weatherUpdateParameters(){const t=this.weatherEnabled?this.view.environment.weather:null;return t==null?null:t.type==="rainy"||t.type==="snowy"?{type:t.type,weatherAdjustment:t.cloudCover,effect:t.precipitation}:{type:t.type,weatherAdjustment:t.type==="foggy"?t.fogStrength:t.cloudCover}}_updateWeatherFading(t){if(!t.weatherFading)return;const e=t.cloudsFade;return e.fadeIn.stage===vc.FADE_IN?(t.fadeLighting(e.fadeIn.factor),void this._fadeWeather(e.fadeIn.factor)):e.fadeInOut.stage===Sn.FADE_IN?(t.fadeLighting(e.fadeInOut.factor),void this._fadeWeather(e.fadeInOut.factor)):e.crossFade.enabled?(t.fadeLighting(e.crossFade.factor),void this._fadeWeather(e.crossFade.factor)):(t.fadeLighting(0),void this._fadeWeather(0))}_fadeWeather(t){const{_newWeatherParameters:e,_oldWeatherParameters:r}=this;t>=1?this._weatherParameters=e:(this._fadedWeatherParameters.lerp(r,e,t),this._weatherParameters=this._fadedWeatherParameters)}_updateWeather(){const t=this._weatherUpdateParameters;t!=null&&this._clouds!=null&&(this._clouds.applyPreset(oa[t.type],t.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){this._context!=null&&this._context.requestRender()}_updateFogHaze(){const t=this._weatherUpdateParameters;if(this._fog==null||t==null||this._context==null)return;const e=this._context.renderContext.bindParameters;switch(this._oldWeatherParameters.copyFrom(this._weatherParameters),t.type){case"foggy":this._newWeatherParameters.fog.strength=St(3e-5,.005,t.weatherAdjustment**3),ie(this._newWeatherParameters.fog.color,qne),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;case"rainy":this._newWeatherParameters.fog.strength=St(4e-6,2e-4,(t.effect??0)**3),ie(this._newWeatherParameters.fog.color,mZe),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=0,this._setNeedsRender();break;case"snowy":this._newWeatherParameters.fog.strength=St(4e-6,2e-4,(t.effect??0)**3),ie(this._newWeatherParameters.fog.color,qne),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender()}e.weatherFading?this._fadeWeather(0):this._fadeWeather(1)}_updateAtmosphere(t){const e=this._selectAtmosphereType(t);if(e!==aa.None&&this._context){if(!this._atmosphere||this._atmosphere.type!==e){this._atmosphere=Ne(this._atmosphere);const r=this._getAtmosphereClass(e);r&&(this._atmosphere=new r(this.view,this._context))}}else this._atmosphere=Ne(this._atmosphere);this._setNeedsRender()}_getAtmosphereClass(t){switch(t){case aa.Realistic:return cne;case aa.Local:return lYe;case aa.Mars:return pYe;default:case aa.None:return null}}_selectAtmosphereType(t){const{enabled:e,viewingMode:r}=t;return!e||Rm(this.view.spatialReference)?aa.None:r===Ve.Local?aa.Local:this._context!=null&&cne.isSupported(this._context)&&rM(this.view.spatialReference)?aa.Realistic:Om(this.view.spatialReference)?aa.Mars:aa.None}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),stubGetAtmosphereClass:t=>{Wne=uO.prototype._getAtmosphereClass,uO.prototype._getAtmosphereClass=t},restoreGetAtmosphereClass:()=>{uO.prototype._getAtmosphereClass=Wne}}}};u([p({constructOnly:!0})],Io.prototype,"view",void 0),u([p({readOnly:!0})],Io.prototype,"atmosphere",null),u([p({readOnly:!0})],Io.prototype,"_atmosphereType",null),u([p({type:Boolean,readOnly:!0})],Io.prototype,"updating",null),u([p({readOnly:!0})],Io.prototype,"weatherVisible",null),u([p()],Io.prototype,"_context",void 0),u([p()],Io.prototype,"_atmosphere",void 0),u([p({readOnly:!0})],Io.prototype,"_stars",null),u([p({readOnly:!0})],Io.prototype,"_precipitation",null),u([p({readOnly:!0})],Io.prototype,"_clouds",null),u([p({readOnly:!0})],Io.prototype,"_cloudsComposition",null),u([p({readOnly:!0})],Io.prototype,"_fog",null),u([p({readOnly:!0})],Io.prototype,"weatherEnabled",null),u([p({readOnly:!0})],Io.prototype,"_precipitationEnabled",null),u([p({readOnly:!0})],Io.prototype,"_weatherUpdateParameters",null),Io=uO=u([P("esri.views.3d.environment.EnvironmentRenderer")],Io);let Rk=class{constructor(){this.fog=new EXe,this.hazeAmount=1}copyFrom(e){this.fog.amount=e.fog.amount,this.hazeAmount=e.hazeAmount,this.fog.strength=e.fog.strength,ie(this.fog.color,e.fog.color)}lerp(e,r,i){this.fog.amount=St(e.fog.amount,r.fog.amount,i),this.hazeAmount=St(e.hazeAmount,r.hazeAmount,i),this.fog.strength=St(e.fog.strength,r.fog.strength,i),qr(this.fog.color,e.fog.color,r.fog.color,i)}};const mZe=Pe(.5,.5,.5),qne=Pe(1.5,1.5,1.5);let Wne;function Xne(t,e,r){if(e.longitude==null||e.latitude==null||r.longitude==null||r.latitude==null)throw new Error("Invalid points: no lon/lat");return gZe(t,e.longitude,e.latitude,r.longitude,r.latitude)}function gZe(t,e,r,i,s){const n=Ft(r),o=Ft(s),a=n-o,l=Ft(e)-Ft(i),c=Math.sin(a/2),h=Math.sin(l/2),d=2*Hh(Math.sqrt(c*c+Math.cos(n)*Math.cos(o)*h*h))*t;return Math.round(1e4*d)/1e4}function yZe(t,e,r){const i=e.spatialReference,s=Vr(i),n=new tt(e.x,t.y,i),o=new tt(r.x,t.y,i),a=new tt(t.x,e.y,i),l=new tt(t.x,r.y,i);return{lon:Xne(s.radius,n,o),lat:Xne(s.radius,a,l)}}function _Ze(t,e,r){const i=e/r,s=Ft(t),n=Math.sin(i/2),o=Math.cos(s),a=2*Hh(Math.sqrt(n*n/(o*o)));return al(a)}function vZe(t,e){let r=t/15;return e||(r=Math.round(r)),r}function Yne(t,e){const r=t?.[0];if(r==null)return null;e||(e={hours:0,minutes:0,seconds:0}),e.hours=vZe(r,!0);const i=e.hours%1;e.hours-=i,e.minutes=60*i;const s=e.minutes%1;return e.minutes-=s,e.seconds=Math.round(60*s),e}var d9t=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function FP(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Zne,Jne,Qne,UH={exports:{}};UH.exports,Zne=UH,Jne=function(){var t=Math.PI,e=Math.sin,r=Math.cos,i=Math.tan,s=Math.asin,n=Math.atan2,o=Math.acos,a=t/180,l=864e5,c=2440588,h=2451545,d={dec:0,ra:0};function f(I){return I.valueOf()/l-.5+c}function m(I){return new Date((I+.5-c)*l)}function g(I){return f(I)-h}var _=23.4397*a;function v(I,z){return n(e(I)*r(_)-i(z)*e(_),r(I))}function b(I,z){return s(e(z)*r(_)+r(z)*e(_)*e(I))}function T(I,z,V){return n(e(I),r(I)*e(z)-i(V)*r(z))}function x(I,z,V){return s(e(z)*e(V)+r(z)*r(V)*r(I))}function S(I,z){return a*(280.16+360.9856235*I)-z}function E(I){return a*(357.5291+.98560028*I)}function A(I){return a*(1.9148*e(I)+.02*e(2*I)+3e-4*e(3*I))}function R(I,z){return I+z+102.9372*a+t}function M(I,z){var V=E(I),j=R(V,A(V));return z||(z={dec:0,ra:0}),z.dec=b(j,0),z.ra=v(j,0),z}var D={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(I,z,V,j){var Y=a*-V,Q=a*z,te=g(I),ge=M(te,d),De=S(te,Y)-ge.ra;return j||(j={azimuth:0,altitude:0}),j.azimuth=T(De,Q,ge.dec),j.altitude=x(De,Q,ge.dec),j}},k=[[-.83,"sunrise","sunset"]];D.addTime=function(I,z,V){k.push([I,z,V])};var L=9e-4;function N(I,z){return Math.round(I-L-z/(2*t))}function q(I,z,V){return L+(I+z)/(2*t)+V}function X(I,z,V){return h+I+.0053*e(z)-.0069*e(2*V)}function G(I,z,V){return o((e(I)-e(z)*e(V))/(r(z)*r(V)))}function J(I){var z=a*(134.963+13.064993*I),V=a*(93.272+13.22935*I),j=a*(218.316+13.176396*I)+6.289*a*e(z),Y=5.128*a*e(V),Q=385001-20905*r(z);return{ra:v(j,Y),dec:b(j,Y),dist:Q}}return D.getTimes=function(I,z,V){var j=a*-V,Y=a*z,Q=N(g(I),j),te=q(0,j,Q),ge=E(te),De=A(ge),at=R(ge,De),we=b(at,0),Ce=X(te,ge,at);function Me(mt){return X(q(G(mt,Y,we),j,Q),ge,at)}function Z(mt){var Ye=(e(mt)-e(Y)*e(we))/(r(Y)*r(we));return Ye<-1?D.PolarException.MIDNIGHT_SUN:Ye>1?D.PolarException.POLAR_NIGHT:D.PolarException.NORMAL}var be,Fe,ce,$e,Xe,ft={solarNoon:m(Ce),nadir:m(Ce-.5),polarException:D.PolarException.NORMAL};for(be=0,Fe=k.length;be<Fe;be+=1)Xe=Ce-(($e=Me((ce=k[be])[0]*a))-Ce),ft[ce[1]]=m(Xe),ft[ce[2]]=m($e);return ft.polarException=Z(k[0][0]*a),ft},D.getMoonPosition=function(I,z,V){var j=a*-V,Y=a*z,Q=g(I),te=J(Q),ge=S(Q,j)-te.ra,De=x(ge,Y,te.dec);return De+=.017*a/i(De+10.26*a/(De+5.1*a)),{azimuth:T(ge,Y,te.dec),altitude:De,distance:te.dist}},D.getMoonFraction=function(I){var z=g(I),V=M(z),j=J(z),Y=149598e3,Q=o(e(V.dec)*e(j.dec)+r(V.dec)*r(j.dec)*r(V.ra-j.ra)),te=n(Y*e(Q),j.dist-Y*r(Q));return(1+r(te))/2},D},(Qne=Jne())!==void 0&&(Zne.exports=Qne);const Zw=FP(UH.exports),Ka={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};let c$=class{constructor(e,r){this.direct=e,this.ambient=r}};function bZe(t,e,r,i,s,n){ne(n.ambient.color,1,1,1),n.ambient.intensity=Ka.global.ambient,ne(n.direct.color,1,1,1),n.direct.intensity=Ka.global.direct;const o=e[2],a=ve((Math.abs(o)-Ka.local.altitude)/(Ka.global.altitude-Ka.local.altitude),0,1);let l;if(n.globalFactor=a,t!=null&&(l=Zw.getTimes(t,e[1],e[0])),a<1){let c;if(t!=null)c=AZe(t,l,i);else{const h=n2e(i);c={direct:{intensity:Ka.local.directAtNoon*h.direct,color:Pe(1,1,1)},ambient:{intensity:Ka.local.ambientAtNoon*h.ambient,color:Pe(1,1,1)},timeOfDay:"early afternoon"}}qr(n.ambient.color,c.ambient.color,n.ambient.color,a),n.ambient.intensity=St(c.ambient.intensity,n.ambient.intensity,a),qr(n.direct.color,c.direct.color,n.direct.color,a),n.direct.intensity=St(c.direct.intensity,n.direct.intensity,a),n.specularStrength=i==="rainy"||i==="snowy"||i==="foggy"?0:1,n.environmentStrength=i==="rainy"?.7:i==="snowy"||i==="foggy"?.75:1}n.noonFactor=t!=null?CZe(t,l):1,t!=null?wZe(t,e,r,n.direct.directionToLightSource):i2e(s,r,n.direct.directionToLightSource)}function i2e(t,e,r){e===Ve.Global?_e($k,t.eye):ne($k,0,0,1),se(Lk,t.viewForward,-1);const i=hN(Lk,$k),s=Math.max(i-2*Dk,0),n=.85*s/(s+1),o=Math.max(Dk,i-Dk-n);Lu(coe,-o,t.viewRight),ze(r,Lk,coe),de(r,r,se(OZe,t.viewRight,RZe)),_e(r,r)}function wZe(t,e,r,i){const s=EZe,n=Yh(SZe);if(r===Ve.Global)Zw.getPosition(t,0,0,s),ne(i,0,0,-1),EE(n,n,-s.azimuth),y8(n,n,-s.altitude),ze(i,i,n);else{const o=Ka.planarDirection,a=o.globalAngles,l=e[2];let c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=ve(c,0,1),c<1?(Zw.getPosition(t,e[1],e[0],s),s.azimuth=(1-c)*s.azimuth+c*a.azimuth,s.altitude=(1-c)*s.altitude+c*a.altitude):(s.azimuth=a.azimuth,s.altitude=a.altitude),ne(i,0,-1,0),CE(n,n,-s.azimuth),EE(n,n,-s.altitude),ze(i,i,n)}}function xZe(t,e){if(e===Ve.Global)return!0;const r=Ka.planarDirection;return Math.abs(t)<r.localAltitude}const TZe=Pe(.5773502691896258,-.5773502691896258,.5773502691896258);let s2e=class{constructor(){this.ambient={color:Pe(1,1,1),intensity:.55},this.direct={color:Pe(1,1,1),intensity:.55,directionToLightSource:ks(TZe)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}};const SZe=xe(),EZe={azimuth:0,altitude:0};function CZe(t,e){const r=t.valueOf();let i,s;e.polarException===Zw.PolarException.MIDNIGHT_SUN?(i=r-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,s=i+432e6):e.polarException===Zw.PolarException.POLAR_NIGHT?(i=r-2,s=r-1):(i=e.sunrise.valueOf(),s=e.sunset.valueOf());const n=i+(s-i)/2;return 1-ve(Math.abs(r-n)/432e5,0,1)}function n2e(t){switch(t){case"disabled":case"sunny":case"cloudy":return new c$(1,1);case"rainy":return new c$(.4,1.2);case"snowy":return new c$(.5,1.3);case"foggy":return new c$(.2,1.6)}}function Kne(t,e){const r=(t[0]+t[1]+t[2])/3;t[0]+=(r-t[0])*e,t[1]+=(r-t[1])*e,t[2]+=(r-t[2])*e}const Mk=Pe(.01,.01,.01),kH=Pe(1,.6,.5),zH=Pe(1,.98,.98),eoe=Pe(1,1,1),Pk=Pe(.8,.8,1),VH=Pe(.8,.8,1),BH=Pe(.98,.98,1),toe=Pe(1,1,1),Ik=fr(.01,Ka.local.ambientAtNight),GH=fr(Ka.local.directAtTwilight,Ka.local.ambientAtTwilight),jH=fr(.9*Ka.local.directAtNoon,Ka.local.ambientAtNoon),roe=fr(Ka.local.directAtNoon,Ka.local.ambientAtNoon),ioe=jH,soe=zH,noe=BH,ooe=GH,aoe=kH,loe=VH;function AZe(t,e,r){const i=t.valueOf();let s,n;e.polarException===Zw.PolarException.MIDNIGHT_SUN?(s=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,n=s+432e6):e.polarException===Zw.PolarException.POLAR_NIGHT?(s=i-2,n=i-1):(s=e.sunrise.valueOf(),n=e.sunset.valueOf());const o=n-s,a=s+o/2,l=o/4,c=a-l,h=a+l,d=.06*o,f=s-d/2,m=s+d/2,g=n-d/2,_=n+d/2,v=He(),b=O(),T=O();let x="";if(i<f||i>_)yn(v,Ik),ie(b,Mk),ie(T,Pk),x="night";else if(i<m){const A=(i-f)/(m-f);Ah(v,Ik,GH,A),qr(b,Mk,kH,A),qr(T,Pk,VH,A),x="sun rising"}else if(i<c){const A=(i-m)/(c-m);Ah(v,GH,jH,A),qr(b,kH,zH,A),qr(T,VH,BH,A),x="early morning"}else if(i<a){const A=(i-c)/(a-c);Ah(v,jH,roe,A),qr(b,zH,eoe,A),qr(T,BH,toe,A),x="late morning"}else if(i<h){const A=(i-a)/(h-a);Ah(v,roe,ioe,A),qr(b,eoe,soe,A),qr(T,toe,noe,A),x="early afternoon"}else if(i<g){const A=(i-h)/(g-h);Ah(v,ioe,ooe,A),qr(b,soe,aoe,A),qr(T,noe,loe,A),x="late afternoon"}else if(i<_){const A=(i-g)/(_-g);Ah(v,ooe,Ik,A),qr(b,aoe,Mk,A),qr(T,loe,Pk,A),x="sun setting"}let S=0;switch(r){case"rainy":case"foggy":S=.8;break;case"snowy":S=.5}S>0&&(Kne(b,S),Kne(T,S));const E=n2e(r);return{direct:{intensity:v[0]*E.direct,color:b},ambient:{intensity:v[1]*E.ambient,color:T},timeOfDay:x}}const coe=xe(),$k=O(),Lk=O(),OZe=O(),Dk=.25,RZe=.2;let Pd=class extends Ts.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandles=new $i,this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new j5,this._ambientLight=new lQ,this._moonLight=new pTe,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView(),this._viewHandles.destroy()}get _view(){return this._renderer?.view}get updating(){return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!this._renderer?.updating)}get weatherEnabled(){return this._view?.environment.atmosphereEnabled&&!this._disableWeather&&this._view?.state?.viewingMode===Ve.Global&&rM(this._view.spatialReference)}get weatherVisible(){return this.weatherEnabled&&this._renderer?.weatherVisible}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){if(this._renderer)return;this._renderer=new Io({view:e});const r=()=>this._updateRenderParameters(),i=()=>this._cameraHandler();this._viewHandles.add([le(()=>e.environment.lighting,s=>this._updateLightingHandler(s),Wr),le(()=>e.environment.lighting.type!=="virtual"?e.environment.lighting.date:null,s=>this._lightingDateHandler(s),Wr),le(()=>e.stationary,()=>this._interactingStationaryHandler()),le(()=>e.environment.lighting.directShadowsEnabled,r,Wr),le(()=>e.qualitySettings.ambientOcclusion,r,Wr),le(()=>e.qualitySettings.reflections,r,Wr),le(()=>e.environment.background?.color,r,Wr),le(()=>e.spatialReference,()=>this._resetReferencePosition(!0),Wr),le(()=>e.environment.weather.type,()=>this._updateLighting(null,zS.Faded),Wr),le(()=>this.weatherEnabled,()=>this._updateLighting(null,zS.Faded),Wr),le(()=>e.viewingMode,()=>this._resetReferencePosition(!0),Ls),le(()=>e.environment.lighting.type!=="virtual"&&e.environment.lighting.cameraTrackingEnabled,s=>this._updateCameraTracking(s),Ls),le(()=>e.state.camera,i,Ls),le(()=>this.disableQueries,i)]),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer=Ne(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type!=="virtual"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type!=="virtual"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const r=this._view.environment.lighting;r?.type!=="virtual"&&(r.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const r=this._view.environment.lighting;if(r?.type!=="virtual"){if(e){if(!r.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const i=this._view.spatialReference;if(!pv(i)){const s=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(s))return void this._requestReferencePositionUpdate(s)}if(this._preupdateTracking(e),this._referencePosWGS84Comparable!=null){const s=Yne(this._referencePosWGS84Comparable,uoe);s!=null&&(r.autoUpdate(null,s),this._trackingEnabled&&(r.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type!=="virtual"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const r=this._view;if(!r.ready)return;const i=r.stateManager.camera;i&&(this._cameraHandlerClientSide(i,e)||this._cameraHandlerServerSide(i))}_cameraHandlerClientSide(e,r){const i=rM(this._view.spatialReference);if(i&&!pv(this._view.spatialReference))return this._view.environment.lighting.type==="virtual"&&this._updateLighting(),!1;const s=e.position;return this._referencePosWGS84Comparable==null&&(this._referencePosWGS84Comparable=O()),i?rbe(s,this._referencePosWGS84Comparable):ne(this._referencePosWGS84Comparable,s.longitude??0,s.latitude??0,s.z??0),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,r)||this._updateLighting(r),!0}_cameraHandlerServerSide(e){const r=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(r))&&this._requestReferencePositionUpdate(r,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=(r.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e,r=zS.Immediate){const i=this._view;e=e||(i.environment.lighting.type==="virtual"?null:i.environment.lighting.date);const s=this._referencePosWGS84Comparable,n=s!=null?MZe:PZe,o=this.weatherVisible?i.environment.weather.type:"disabled";s!=null?bZe(e,s,i.state.viewingMode,o,i.state.camera,n):i.environment.lighting.type==="virtual"&&i2e(i.state.camera,i.state.viewingMode,n.direct.directionToLightSource);const a=this._mainLight,l=n.direct;se(a.intensity,l.color,l.intensity*Math.PI),ie(a.direction,l.directionToLightSource),a.specularStrength=n.specularStrength,a.environmentStrength=n.environmentStrength;const c=this._ambientLight;se(c.intensity,n.ambient.color,n.ambient.intensity);const h=this._moonLight;qr(h.intensity,$Ze,LZe,n.globalFactor);const d=(1-.5*n.globalFactor)*(1-.4*n.noonFactor*(1-n.globalFactor));se(h.intensity,h.intensity,d),ie(h.direction,l.directionToLightSource),this._renderer.updateLightSources([a,c,h],n.noonFactor,n.globalFactor,r),this._updateRenderParameters()}_autoUpdateTimezone(e,r=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||e==null)return!1;const i=IZe;i.setTime((r||this._view.environment.lighting.date).getTime());const s=Yne(e,uoe);if(s==null)return!1;let n=this._view.environment.lighting.positionTimezoneInfo;if(n.autoUpdated){if(n.hours===s.hours&&n.minutes===s.minutes&&n.seconds===s.seconds)return!1}else n=s;const o=i.getUTCHours()-(s.hours-n.hours),a=i.getUTCMinutes()-(s.minutes-n.minutes),l=i.getUTCSeconds()-(s.seconds-n.seconds);return i.setUTCHours(o),i.setUTCMinutes(a),i.setUTCSeconds(l),!r&&this._view.environment.lighting.autoUpdate(i,s)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const r=this._referencePosWGS84Comparable==null||xZe(this._referencePosWGS84Comparable[2],this._view.state.viewingMode),i=this._view.environment.background,s=i instanceof uxe?{type:"color",color:xJ(ke.toUnitRGBA(i.color))}:{type:"color",color:Nt(0,0,0,1)};e.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&r,background:s,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible,qualitySettings:this._view.qualitySettings})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,r=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!r,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const i=this._referencePosUpdateQuery=uE(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===i){const n=()=>this._referencePosUpdateQuery!==i;return this._doReferencePositionUpdateQuery(n)}}).catch(n=>{n.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===i&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),s=this._referencePosUpdateTimer=uE(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===s&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const r=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(r[0])&&!isNaN(r[1])){const i=(this._referencePosMapCoords.z??0)*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=r[0],this._referencePosWGS84Comparable[1]=r[1],this._referencePosWGS84Comparable[2]=i):this._referencePosWGS84Comparable=[r[0],r[1],i],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let r=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(r*=this._view.mapCoordsHelper.unitInMeters),r>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return{get renderer(){return e._renderer},set referencePointUpdateInterval(r){e._referencePointUpdateInterval=r},set referencePointUpdateDistThreshold(r){e._referencePointUpdateDistThreshold=r},set referencePosUpdateTimer(r){e._referencePosUpdateTimer=r},set referencePointUpdateDelay(r){e._referencePointUpdateDelay=r},set disableWeather(r){e._disableWeather=r}}}};u([p({type:Boolean,readOnly:!0})],Pd.prototype,"updating",null),u([p()],Pd.prototype,"disableQueries",void 0),u([p()],Pd.prototype,"_disableWeather",void 0),u([p()],Pd.prototype,"weatherEnabled",null),u([p()],Pd.prototype,"weatherVisible",null),u([p()],Pd.prototype,"referencePositionWGS84Comparable",null),u([p()],Pd.prototype,"_renderer",void 0),u([p()],Pd.prototype,"_referencePosWGS84Comparable",void 0),Pd=u([P("esri.views.3d.environment.SceneViewEnvironmentManager")],Pd);const MZe=new s2e,PZe=new s2e,IZe=new Date,uoe={hours:0,minutes:0,seconds:0},$Ze=Pe(.22,.22,.33),LZe=Pe(.22,.22,.22);var Mi;(function(t){t[t.NONE=0]="NONE",t[t.TILT=1]="TILT",t[t.ALTITUDE=2]="ALTITUDE",t[t.DISTANCE=4]="DISTANCE",t[t.COLLISION=8]="COLLISION",t[t.ALL=15]="ALL",t[t.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(Mi||(Mi={}));var Xt;(function(t){t[t.NONE=0]="NONE",t[t.ZOOM=1]="ZOOM",t[t.TUMBLE=2]="TUMBLE",t[t.LOOK_AROUND=3]="LOOK_AROUND",t[t.PAN=4]="PAN",t[t.ASCEND=5]="ASCEND"})(Xt||(Xt={}));var ro;(function(t){t[t.TUMBLE=0]="TUMBLE",t[t.LOOK_AROUND=1]="LOOK_AROUND"})(ro||(ro={}));function AM(t,e){return(t&e)!=0}function Q5(t,e,r,i,s,n){t!==0&&(r?(n.min=Math.min(n.min,e),n.max=Math.max(n.max,e)):i!=null?(n.min-=Math.max(0,(e-n.min)*(1-i)),n.max+=Math.max(0,(e-n.max)*(1-i))):s&&(n.min-=Math.max(0,e-n.min-s),n.max+=Math.max(0,e-n.max-s)))}const vv={selection:Mi.NONE,interactionType:Xt.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:ro.TUMBLE};function o2e(t,e,r,i){return e=e||t.viewForward,ie(i,e),se(i,i,Math.sign(ye(e,r))),i}function DZe(t,e,r,i){return zZe(t,e,r,UZe(i,e,r,!0))}function NZe(t,e,r,i){const s=ye(r,fe(t,i,e));return de(t,e,se(t,r,s))}const FZe={dir:O(),len:0,clip:He()};function UZe(t,e,r,i){const s=FZe;return t?(r&&i&&(s.len=mi(e,r)),ie(s.dir,t)):i?(s.len=mi(e,r),fe(s.dir,r,e),se(s.dir,s.dir,1/s.len)):(fe(s.dir,r,e),_e(s.dir,s.dir)),s}function kZe(t,e,r){const i=ye(t,r.dir),s=-fi(t,e);if(s<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return s>0;if((s<0||i<0)&&!(s<0&&i<0))return!0;const n=s/i;return i>0?n<r.clip[1]&&(r.clip[1]=n):n>r.clip[0]&&(r.clip[0]=n),r.clip[0]<=r.clip[1]}function zZe(t,e,r,i){i.clip[0]=0,i.clip[1]=r?i.len:Number.MAX_VALUE;for(let s=0;s<t.length;s++)if(!kZe(t[s],e,i))return!1;return!0}function VZe(t,e,r=vv){const i=xQ(t,e,r);if(i===0)return!1;const s=t.renderCoordsHelper,n=s.getAltitude(e.eye)+i,o=o2e(e,r.interactionDirection,jZe(t,e,Math.sign(i),XZe),WZe),a=ie(YZe,e.viewForward),l=s.intersectInfiniteManifold(Du(e.eye,o),n,Nk);return e.eye=l??s.setAltitude(Nk,n,e.eye),e.center=NZe(Nk,e.eye,a,e.center),!0}function xQ(t,e,r=vv){if(!BZe(t,r)||!t.state.constraints.altitude)return 0;const i=HZe(t.state.constraints.altitude,qZe);GZe(t,r,i);const s=t.renderCoordsHelper.getAltitude(e.eye),n=ve(s,i.min,i.max)-s;return Math.abs(n)<=1e-6?0:n}function BZe(t,e){const r=t.state.constraints.altitude;return!(!t.state.isGlobal||!r)&&(e.interactionType!==Xt.TUMBLE||!AM(e.selection,Mi.TILT))}function GZe(t,e,r){const i=e.interactionType;if(i===Xt.NONE)return;const{min:s,max:n}=r,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=i===Xt.TUMBLE||i===Xt.ZOOM,c=xQ(t,o),h=c===0?0:t.renderCoordsHelper.getAltitude(o.eye);r.min=s,r.max=n,Q5(c,h,l,a,.05*h,r)}function jZe(t,e,r,i){return t.renderCoordsHelper.worldUpAtPosition(e.eye,i),se(i,i,r),i}function HZe(t,e){return e.min=t.min,e.max=t.max,e}const qZe={min:0,max:0},WZe=O(),XZe=O(),YZe=O(),Nk=O();function TQ(t,e,r=vv){if(!t.state.isLocal)return 0;const i=t.state.constraints.distance;if(!t.pointsOfInterest.surfaceOrigin.renderLocation||i===1/0)return 0;u$.min=0,u$.max=i,JZe(t,r,u$);const s=SQ(t,e),n=u$.max-s;return n>=-1e-6?0:n}function ZZe(t,e,r=vv){const i=TQ(t,e,r);if(i===0)return!1;const s=t.pointsOfInterest.surfaceOrigin;if(!s.renderLocation)return!1;const n=SQ(t,e)+i,o=ie(KZe,e.eye),a=o2e(e,r.interactionDirection,QZe(e,s.renderLocation,rJe),tJe);if(!Lv(kbe(s.renderLocation,n),Du(e.eye,a),h$))return!1;e.eye=h$;const l=fe(eJe,e.eye,o);e.center=de(h$,e.center,l);const c=t.renderCoordsHelper.getAltitude(e.center),h=t.renderCoordsHelper.intersectInfiniteManifold(e.ray,c,h$);return h!=null&&(e.center=h),!0}function JZe(t,e,r){const i=e.interactionType;if(i===Xt.NONE)return;const{min:s,max:n}=r,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=i===Xt.ZOOM||i===Xt.PAN,c=TQ(t,o),h=c===0?0:SQ(t,o);r.min=s,r.max=n,Q5(c,h,l,a,.05*h,r)}function SQ(t,e){const r=t.pointsOfInterest.surfaceOrigin;return r.renderLocation?mi(e.eye,r.renderLocation):0}function QZe(t,e,r){return O0(r,t.eye,e)}const u$={min:0,max:0},KZe=O(),eJe=O(),tJe=O(),rJe=O(),h$=O();var ji,So;(function(t){t[t.OBJECT=0]="OBJECT",t[t.HUD=1]="HUD",t[t.TERRAIN=2]="TERRAIN",t[t.OVERLAY=3]="OVERLAY",t[t.I3S=4]="I3S",t[t.PCL=5]="PCL",t[t.LOD=6]="LOD",t[t.VOXEL=7]="VOXEL"})(ji||(ji={}));let iJe=class{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=So.ALL}};(function(t){t[t.MIN=0]="MIN",t[t.MINMAX=1]="MINMAX",t[t.ALL=2]="ALL"})(So||(So={}));let sJe=class{constructor(e,r,i){this.object=e,this.geometryId=r,this.triangleNr=i}},nJe=class extends sJe{constructor(e,r,i,s){super(e,r,i),this.center=s!=null?ks(s):null}},a2e=class{constructor(e){this.layerUid=e}},Q8=class extends a2e{constructor(e,r){super(e),this.graphicUid=r}};function Fp(t){return t!=null&&t.dist!=null}function hoe(t){return(e,r,i)=>(qr(doe,e,r,i),!MJ(t,doe))}function K8(t){return Fp(t)&&t.intersector===ji.OBJECT&&!!t.target}function e9(t){return Fp(t)&&t.intersector===ji.HUD&&!!t.target&&"center"in t.target&&t.target.center!=null}const doe=O();let oJe=class{constructor(){this._transform=xe(),this._transformInverse=new d$({value:this._transform},$n,xe),this._transformInverseTranspose=new d$(this._transformInverse,kc,xe),this._transformTranspose=new d$({value:this._transform},kc,xe),this._transformInverseRotation=new d$({value:this._transform},qxe,ki)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){zs(this._transform,e)}multiplyTransform(e){ai(this._transform,this._transform,e)}set(e){zs(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,r){this.setTransformMatrix(e),this.multiplyTransform(r),this._invalidateLazyTransforms()}},d$=class{constructor(e,r,i){this._original=e,this._update=r,this._dirty=!0,this._transform=i()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}},aJe=class{constructor(e=0){this.offset=e,this.tmpVertex=O()}applyToVertex(e,r,i){const s=e+this.localOrigin[0],n=r+this.localOrigin[1],o=i+this.localOrigin[2],a=this.offset/Math.sqrt(s*s+n*n+o*o);return this.tmpVertex[0]=e+s*a,this.tmpVertex[1]=r+n*a,this.tmpVertex[2]=i+o*a,this.tmpVertex}applyToAabb(e){for(let n=0;n<3;++n)ny[n]=e[0+n]+this.localOrigin[n],p$[n]=e[3+n]+this.localOrigin[n],m3[n]=ny[n];const r=this.applyToVertex(ny[0],ny[1],ny[2]);for(let n=0;n<3;++n)e[n]=r[n],e[n+3]=r[n];const i=n=>{const o=this.applyToVertex(n[0],n[1],n[2]);for(let a=0;a<3;++a)e[a]=Math.min(e[a],o[a]),e[a+3]=Math.max(e[a+3],o[a])};for(let n=1;n<8;++n){for(let o=0;o<3;++o)m3[o]=n&1<<o?p$[o]:ny[o];i(m3)}let s=0;for(let n=0;n<3;++n)ny[n]*p$[n]<0&&(s|=1<<n);if(s!==0&&s!==7){for(let n=0;n<8;++n)if(!(s&n)){for(let o=0;o<3;++o)m3[o]=s&1<<o?0:n&1<<o?ny[o]:p$[o];i(m3)}}for(let n=0;n<3;++n)e[n]-=this.localOrigin[n],e[n+3]-=this.localOrigin[n];return e}};const ny=O(),p$=O(),m3=O();let lJe=class{constructor(e=0){this.componentLocalOriginLength=0,this._tmpVertex=O(),this._mbs=xs(),this._obb={center:O(),halfSize:ls(),quaternion:null},this._totalOffset=0,this._offset=0,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}applyToVertex(e,r,i){const s=e,n=r,o=i+this.componentLocalOriginLength,a=this._totalOffset/Math.sqrt(s*s+n*n+o*o);return this._tmpVertex[0]=e+s*a,this._tmpVertex[1]=r+n*a,this._tmpVertex[2]=i+o*a,this._tmpVertex}applyToAabb(e){const r=e[0],i=e[1],s=e[2]+this.componentLocalOriginLength,n=e[3],o=e[4],a=e[5]+this.componentLocalOriginLength,l=r*n<0?0:Math.min(Math.abs(r),Math.abs(n)),c=i*o<0?0:Math.min(Math.abs(i),Math.abs(o)),h=s*a<0?0:Math.min(Math.abs(s),Math.abs(a)),d=Math.sqrt(l*l+c*c+h*h);if(d<this._totalOffset)return e[0]-=r<0?this._totalOffset:0,e[1]-=i<0?this._totalOffset:0,e[2]-=s<0?this._totalOffset:0,e[3]+=n>0?this._totalOffset:0,e[4]+=o>0?this._totalOffset:0,e[5]+=a>0?this._totalOffset:0,e;const f=Math.max(Math.abs(r),Math.abs(n)),m=Math.max(Math.abs(i),Math.abs(o)),g=Math.max(Math.abs(s),Math.abs(a)),_=Math.sqrt(f*f+m*m+g*g),v=this._totalOffset/_,b=this._totalOffset/d;return e[0]+=r*(r>0?v:b),e[1]+=i*(i>0?v:b),e[2]+=s*(s>0?v:b),e[3]+=n*(n<0?v:b),e[4]+=o*(o<0?v:b),e[5]+=a*(a<0?v:b),e}applyToMbs(e){const r=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this._totalOffset/r;return this._mbs[0]=e[0]+e[0]*i,this._mbs[1]=e[1]+e[1]*i,this._mbs[2]=e[2]+e[2]*i,this._mbs[3]=e[3]+e[3]*this._totalOffset/r,this._mbs}applyToObb(e){const r=e.center,i=this._totalOffset/Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);this._obb.center[0]=r[0]+r[0]*i,this._obb.center[1]=r[1]+r[1]*i,this._obb.center[2]=r[2]+r[2]*i,Lc(this._obb.halfSize,e.halfSize,e.quaternion),de(this._obb.halfSize,this._obb.halfSize,e.center);const s=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);return this._obb.halfSize[0]+=this._obb.halfSize[0]*s,this._obb.halfSize[1]+=this._obb.halfSize[1]*s,this._obb.halfSize[2]+=this._obb.halfSize[2]*s,fe(this._obb.halfSize,this._obb.halfSize,e.center),wm(goe,e.quaternion),Lc(this._obb.halfSize,this._obb.halfSize,goe),this._obb.halfSize[0]*=this._obb.halfSize[0]<0?-1:1,this._obb.halfSize[1]*=this._obb.halfSize[1]<0?-1:1,this._obb.halfSize[2]*=this._obb.halfSize[2]<0?-1:1,this._obb.quaternion=e.quaternion,this._obb}},cJe=class{constructor(e=0){this.offset=e,this.sphere=xs(),this.tmpVertex=O()}applyToVertex(e,r,i){const s=this.objectTransform.transform;let n=s[0]*e+s[4]*r+s[8]*i+s[12],o=s[1]*e+s[5]*r+s[9]*i+s[13],a=s[2]*e+s[6]*r+s[10]*i+s[14];const l=this.offset/Math.sqrt(n*n+o*o+a*a);n+=n*l,o+=o*l,a+=a*l;const c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*n+c[4]*o+c[8]*a+c[12],this.tmpVertex[1]=c[1]*n+c[5]*o+c[9]*a+c[13],this.tmpVertex[2]=c[2]*n+c[6]*o+c[10]*a+c[14],this.tmpVertex}applyToMinMax(e,r){const i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i;const s=this.offset/Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);r[0]+=r[0]*s,r[1]+=r[1]*s,r[2]+=r[2]*s}applyToAabb(e){const r=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*r,e[1]+=e[1]*r,e[2]+=e[2]*r;const i=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*i,e[4]+=e[4]*i,e[5]+=e[5]*i,e}applyToBoundingSphere(e){const r=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this.offset/r;return this.sphere[0]=e[0]+e[0]*i,this.sphere[1]=e[1]+e[1]*i,this.sphere[2]=e[2]+e[2]*i,this.sphere[3]=e[3]+e[3]*this.offset/r,this.sphere}};const poe=new cJe;function HH(t){return t!=null?(poe.offset=t,poe):null}const foe=new lJe;function uJe(t){return t!=null?(foe.offset=t,foe):null}const moe=new aJe;function hJe(t){return t!=null?(moe.offset=t,moe):null}const E_="terrain",goe=rd(),VE=1e-5;let dJe=class{constructor(e){this.options=new iJe,this._results=new pJe,this.transform=new oJe,this.tolerance=VE,this.verticalOffset=null,this._ray=eo(),this._rayEnd=O(),this._rayBeginTransformed=O(),this._rayEndTransformed=O(),this.viewingMode=e??Ve.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,r,i){this.resetWithRay(V7e(e,r,this._ray),i)}resetWithRay(e,r){this.camera=r,e!==this._ray&&P5(e,this._ray),this.options.verticalOffset!==0?this.viewingMode===Ve.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,de(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,r,i,s,n){this.point=r,this.filterPredicate=s,this.tolerance=i??VE;const o=HH(this.verticalOffset);if(e&&e.length>0){const a=n?l=>{n(l)&&this.intersectObject(l)}:l=>{this.intersectObject(l)};for(const l of e){const c=l.getSpatialQueryAccelerator&&l.getSpatialQueryAccelerator();c!=null?(o!=null?c.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,a,o):c.forEachAlongRay(this._ray.origin,this._ray.direction,a),this.options.selectionMode&&this.options.hud&&c.forEachDegenerateObject(a)):l.objects.forAll(h=>a(h))}}this.sortResults()}intersectObject(e){const r=e.geometries;if(!r)return;const i=e.shaderTransformation,s=HH(this.verticalOffset);for(const n of r){if(!n.visible)continue;const{material:o,id:a}=n;this.transform.setAndInvalidateLazyTransforms(i,n.shaderTransformation),ze(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),ze(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;s!=null&&(s.objectTransform=this.transform),o.intersect(n,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(c,h,d,f,m,g)=>{if(c>=0){if(this.filterPredicate!=null&&!this.filterPredicate(this._ray.origin,this._rayEnd,c))return;const _=f?this._results.hud:this._results,v=f?b=>{const T=new nJe(e,a,d,g);b.set(ji.HUD,T,c,h,pn,m)}:b=>b.set(ji.OBJECT,{object:e,geometryId:a,triangleNr:d},c,h,l,m);if((_.min.drapedLayerOrder==null||m>=_.min.drapedLayerOrder)&&(_.min.dist==null||c<_.min.dist)&&v(_.min),this.options.store!==So.MIN&&(_.max.drapedLayerOrder==null||m<_.max.drapedLayerOrder)&&(_.max.dist==null||c>_.max.dist)&&v(_.max),this.options.store===So.ALL)if(f){const b=new qH(this._ray);v(b),this._results.hud.all.push(b)}else{const b=new VS(this._ray);v(b),this._results.all.push(b)}}})}}sortResults(e=this._results.all){e.sort((r,i)=>r.dist!==i.dist?(r.dist??0)-(i.dist??0):r.drapedLayerOrder!==i.drapedLayerOrder?(r.drapedLayerOrder??Number.MAX_VALUE)-(i.drapedLayerOrder??Number.MAX_VALUE):(i.drapedLayerGraphicOrder??Number.MIN_VALUE)-(r.drapedLayerGraphicOrder??Number.MIN_VALUE))}};function ed(t){return new dJe(t)}let pJe=class{constructor(){this.min=new VS(eo()),this.max=new VS(eo()),this.hud={min:new qH(eo()),max:new qH(eo()),all:new Array},this.ground=new VS(eo()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}},VS=class{get ray(){return this._ray}get distanceInRenderSpace(){return this.dist!=null?(se(f$,this.ray.direction,this.dist),Re(f$)):null}getIntersectionPoint(e){return!!Fp(this)&&(se(f$,this.ray.direction,this.dist),de(e,this.ray.origin,f$),!0)}getTransformedNormal(e){return ie(g3,this.normal),g3[3]=0,xu(g3,g3,this.transformation),ie(e,g3),_e(e,e)}constructor(e){this.intersector=ji.OBJECT,this.normal=O(),this.transformation=xe(),this._ray=eo(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=ji.OBJECT,P5(e,this._ray)}set(e,r,i,s,n,o,a){this.intersector=e,this.dist=i,ie(this.normal,s??_Z),zs(this.transformation,n??pn),this.target=r,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(e){P5(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,ie(this.normal,e.normal),zs(this.transformation,e.transformation)}},qH=class extends VS{constructor(){super(...arguments),this.intersector=ji.HUD}};function EQ(t){return new VS(t)}const f$=O(),g3=Wt();function l2e(t,e,r,i){return t.renderCoordsHelper.fromRenderCoords(e.eye,K5,i)!=null&&Yye(r,K5)}function t9(t,e){return t.elevationProvider?t.elevationProvider.getElevation(e[0],e[1],e[2],t.renderCoordsHelper.spatialReference,"ground")??0:0}function Lx(t,e,r,i){const s=t.state.camera.clone();e&&r&&i&&(s.eye=e,s.center=r,s.up=i),fJe(t,s.ray,oy)||ie(oy,s.center);const n=t.state.constraints,o=n.minimumPoiDistance;if(xo(s.eye,oy)<o){const a=n.collision.enabled;ie(r1,s.viewForward),se(r1,r1,o),a?s.eye=fe(K5,oy,r1):de(oy,s.eye,r1);const l=t.renderCoordsHelper,c=l.getAltitude(s.eye),h=n.collision.elevationMargin;a&&c<h&&(fe(r1,oy,s.eye),s.eye=l.setAltitude(K5,h,s.eye),de(oy,s.eye,r1))}return s.center=oy,s}function yoe(t,e,r){if(!t.state.isGlobal||!t.stateManager.constraintsManager)return!1;const i=t9(t,e),s=t.stateManager.constraintsManager.nearFarHeuristic,{far:n}=s.compute(e,r,t.renderDataExtent,i,gJe),o=n*n;return xo(e,r)>o}function fJe(t,e,r){let i=_oe[t.viewingMode];i||(i=ed(t.state.viewingMode),i.options.backfacesTerrain=!t.state.isGlobal,i.options.invisibleTerrain=!0,_oe[t.viewingMode]=i);const{isGlobal:s}=t.state;return!(!t.sceneIntersectionHelper.intersectRay(e,i,r)||yoe(t,e.origin,r))||!(!t.renderCoordsHelper.intersectManifold(e,0,r)||yoe(t,e.origin,r))||!!s&&mJe(e,r,Vr(t.spatialReference).radius)}function mJe(t,e,r){const i=ye(t.origin,t.origin)-r*r,s=i>0?Math.sqrt(i)/3:1;return se(e,t.direction,s/Re(t.direction)),de(e,e,t.origin),!0}const _oe={},K5=O(),oy=O(),r1=O(),gJe={near:0,far:0};function NC(t,e,r=kh.EYE){const i=t.state.constraints;if(!i.collision.enabled)return!1;const s=t9(t,e.eye),n=t.renderCoordsHelper.getAltitude(e.eye),o=s+i.collision.elevationMargin;if(n>=o)return!1;const a=Re(e.eye);if(fe(m$,e.center,e.eye),e.eye=t.renderCoordsHelper.setAltitude(yJe,o,e.eye),r===kh.EYE_AND_CENTER)e.center=de(m$,e.eye,m$);else if(r===kh.EYE_AND_CENTER_SCALE){const l=(a-n+o)/a;e.center=se(m$,e.center,l)}return!0}var kh;(function(t){t[t.EYE=0]="EYE",t[t.EYE_AND_CENTER=1]="EYE_AND_CENTER",t[t.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(kh||(kh={}));const m$=O(),yJe=O();function bv(t,e,r){t.worldUpAtPosition(e,voe),fe(Fk,r,e);const i=Re(Fk);return i===0?0:Dn(ye(Fk,voe)/i)}const voe=O(),Fk=O();function c2e(t,e,r=vv,i=!0){y3.eyeCenterDistance=0,y3.requiresTwoSteps=!1;const s=CQ(t,e,r,void 0,y3);if(s===0)return!1;switch(Lu(g$,-s,e.viewRight),r.tiltMode){case ro.LOOK_AROUND:ze(ay,e.viewForward,g$),se(ay,ay,y3.eyeCenterDistance),e.center=de(C_,e.eye,ay);break;case ro.TUMBLE:fe(ay,e.center,e.eye),ze(ay,ay,g$),e.eye=fe(C_,e.center,ay);break;default:r.tiltMode}return e.up=ze(C_,e.up,g$),!y3.requiresTwoSteps||!i||c2e(t,e,r,!1)}function CQ(t,e,r=vv,i=vv,s){if(!t.state.constraints.tilt)return 0;const n=e.distance,o=t.state.constraints.tilt(n,AJe);return CJe(t,r,o),i.interactionType===Xt.TUMBLE&&AM(i.selection,Mi.ALTITUDE)&&u2e(t,i.interactionStartCamera,o),r.tiltMode===ro.LOOK_AROUND||i.tiltMode===ro.LOOK_AROUND?vJe(t,e,o,s):_Je(t,e,o)}function _Je(t,e,r){const i=bv(t.renderCoordsHelper,e.center,e.eye),s=i-ve(i,r.min,r.max);return OM(s)?s:0}function vJe(t,e,r,i){switch(i&&(i.requiresTwoSteps=!1),t.viewingMode){case"global":return wJe(t,e,r,i);case"local":return bJe(t,e,r,i)}}function bJe(t,e,r,i){const s=bv(t.renderCoordsHelper,e.center,e.eye),n=ve(s,r.min,r.max),o=s-n;if(!OM(o))return 0;if(i){const a=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=t.renderCoordsHelper.getAltitude(e.eye)-a,c=Math.cos(n);Math.abs(c)>1e-4?i.eyeCenterDistance=l/c:i.eyeCenterDistance=e.distance}return o}function wJe(t,e,r,i){const s=xJe(t,e,OJe),n=ve(s.tiltAtCenter,r.min,r.max);if(!OM(s.tiltAtCenter-n))return 0;let o,a;return s.centerIsOnSurface?(o=TJe(s),a=SJe(s,o)):(o=s.constraints.clampTilt(s.eyeCenterDistance,s.tiltAtCenter),i&&o<Math.PI/2&&(i.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=EJe(s,o)),i&&(i.eyeCenterDistance=WH(s,o)),a}function xJe(t,e,r){const i=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,s=i+Vr(t.spatialReference).radius,n=t.renderCoordsHelper.intersectManifold(e.ray,i,C_);return r.eyeCenterDistance=e.distance,r.centerIsOnSurface=!1,n!=null?(r.eyeCenterDistance=mi(e.eye,n),r.tiltAtCenter=bv(t.renderCoordsHelper,n,e.eye),r.centerIsOnSurface=!0):t.state.isLocal?r.tiltAtCenter=bv(t.renderCoordsHelper,e.center,e.eye):(PC(E8(C8,s),e.ray,C_),r.eyeCenterDistance=mi(e.eye,C_),r.tiltAtCenter=Dn(-ye(e.viewForward,_e(C_,C_)))),r.radius=s,r.eyeRadius=Re(e.eye),r.constraints=t.state.constraints,r}function OM(t){return Math.abs(t)>1e-9}function TJe(t){const{constraints:e,eyeCenterDistance:r,tiltAtCenter:i}=t;let s=i,n=e.clampTilt(r,i);const o=WH(t,n);if(e.clampTilt(o,i)===n)return n;let a=0;for(;a<10&&OM(n-s);){const l=(s+n)/2,c=WH(t,l);OM(e.clampTilt(c,l)-l)?s=l:n=l,a++}return n}function WH(t,e){if(!t.centerIsOnSurface)return t.eyeCenterDistance;const r=Math.PI-ve(e,0,Math.PI),i=Hh(t.radius/t.eyeRadius*Math.sin(r)),s=Math.PI-r-i,n=Math.sin(s)/Math.sin(r);if(t.eyeRadius<t.radius&&n>1){const o=Math.PI-i,a=Math.PI-r-o;return Math.sin(a)/Math.sin(r)*t.eyeRadius}return n*t.eyeRadius}function SJe(t,e){const r=Hh(t.radius/t.eyeRadius*Math.sin(t.tiltAtCenter)),i=Hh(t.radius/t.eyeRadius*Math.sin(e));return t.eyeRadius>t.radius?r-i:i-r}function EJe(t,e){return t.tiltAtCenter-Math.PI/2-(e-Math.PI/2)}function CJe(t,e,r){if(e.interactionType===Xt.NONE)return;const{interactionStartCamera:i,interactionFactor:s}=e;if(!i)return;const{min:n,max:o}=r,a=CQ(t,i,vv,e),l=a===0?0:bv(t.renderCoordsHelper,i.center,i.eye);r.min=n,r.max=o,e.interactionType===Xt.TUMBLE?(AM(e.selection,Mi.ALTITUDE)&&u2e(t,i,r),Q5(a,l,!0,s,boe,r)):Q5(a,l,!1,s,boe,r)}function u2e(t,e,r){const i=t.state.constraints;if(t.state.isLocal||!i.altitude||!e)return;const s=da(e.center),n=Math.sqrt(s),o=e.distance,a=Vr(t.spatialReference).radius,l=i.altitude.min+a,c=i.altitude.max+a,h=(l*l-o*o-s)/(-2*n*o),d=(c*c-o*o-s)/(-2*n*o);r.min=Math.max(r.min,Math.min(Math.PI-Dn(d),r.max)),r.max=Math.min(r.max,Math.PI-Dn(h))}const ay=O(),g$=xe(),C_=O(),boe=Ft(5),AJe={min:0,max:0},OJe={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},y3={eyeCenterDistance:0,requiresTwoSteps:!1};function RJe(t){return t}const r9=t=>t*t,AQ=t=>1-r9(1-t),MJe=t=>t<.5?r9(2*t)/2:(AQ(2*(t-.5))+1)/2,OQ=t=>t*t*t,h2e=t=>1-OQ(1-t),d2e=t=>t<.5?OQ(2*t)/2:(h2e(2*(t-.5))+1)/2,RQ=t=>t*t*t*t,p2e=t=>1-RQ(1-t),PJe=t=>t<.5?RQ(2*t)/2:(p2e(2*(t-.5))+1)/2,MQ=t=>t*t*t*t*t,f2e=t=>1-MQ(1-t),IJe=t=>t<.5?MQ(2*t)/2:(f2e(2*(t-.5))+1)/2,PQ=t=>1-Math.cos(t*Math.PI/2),m2e=t=>1-PQ(1-t),$Je=t=>t<.5?PQ(2*t)/2:(m2e(2*(t-.5))+1)/2,IQ=t=>2**(10*(t-1)),UP=t=>1-IQ(1-t),LJe=t=>t<.5?IQ(2*t)/2:(UP(2*(t-.5))+1)/2,$Q=t=>-(Math.sqrt(1-t*t)-1),g2e=t=>1-$Q(1-t),DJe=t=>t<.5?$Q(2*t)/2:(g2e(2*(t-.5))+1)/2;function nd(t){const e=2*(t-Math.sqrt((t-1)*t)),r=e/2/t;return i=>i<r?t*i*i:e*i-e+1}function od(t,e){return(r,i)=>r<e?e*t(r/e,i):1-t((1-r)/(1-e),i)*(1-e)}const NJe=od(nd(1),1),FJe=od(nd(1),0),y2e=od(nd(1),.5),UJe=od(nd(2),1),kJe=od(nd(2),0),zJe=od(nd(2),.5),VJe=od(nd(3),1),BJe=od(nd(3),0),GJe=od(nd(3),.5),jJe=od(nd(4),1),HJe=od(nd(4),0),qJe=od(nd(4),.5),WJe={linear:RJe,"in-quad":r9,"out-quad":AQ,"in-out-quad":MJe,"in-coast-quad":NJe,"out-coast-quad":FJe,"in-out-coast-quad":y2e,"in-cubic":OQ,"out-cubic":h2e,"in-out-cubic":d2e,"in-coast-cubic":UJe,"out-coast-cubic":kJe,"in-out-coast-cubic":zJe,"in-quart":RQ,"out-quart":p2e,"in-out-quart":PJe,"in-coast-quart":VJe,"out-coast-quart":BJe,"in-out-coast-quart":GJe,"in-quint":MQ,"out-quint":f2e,"in-out-quint":IJe,"in-coast-quint":jJe,"out-coast-quint":HJe,"in-out-coast-quint":qJe,"in-sine":PQ,"out-sine":m2e,"in-out-sine":$Je,"in-expo":IQ,"out-expo":UP,"in-out-expo":LJe,"in-circ":$Q,"out-circ":g2e,"in-out-circ":DJe};function Ns(t,e,r=JJe,i=e){i!==e&&i.copyFrom(e),i.computeUp(t.state.viewingMode);let s=!1;for(let a=0;a<QJe;a++){let l=0;for(const c of ZJe)if(AM(r.selection,c.type)){const h=Math.abs(c.error(t,i,r));c.apply(t,i,r)&&(s=!0,l+=h)}if(l===0)break}const n=AM(r.selection,Mi.COLLISION),o=XJe(r.interactionType,t);return n&&NC(t,i,o)&&(s=!0),s&&i.computeUp(t.state.viewingMode),s}function XJe(t,e){switch(t){case Xt.PAN:return kh.EYE_AND_CENTER;case Xt.ASCEND:return e.state.isGlobal?kh.EYE_AND_CENTER_SCALE:kh.EYE_AND_CENTER;default:return kh.EYE}}function sp(t){const e=Math.min(1,t/150);return d2e(e)}function YJe(t,e,r){return CQ(t,e,r)*e.distance}const ZJe=[{type:Mi.TILT,error:YJe,apply:c2e},{type:Mi.ALTITUDE,error:xQ,apply:VZe},{type:Mi.DISTANCE,error:TQ,apply:ZZe}],JJe={selection:Mi.ALL,interactionType:Xt.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:ro.TUMBLE},QJe=5,jc=O(),Yl=O(),ly=O(),ea=O(),i1=O(),KJe=O(),Hc={upward:Pe(0,0,1),forward:Pe(0,1,0),sideway:Pe(1,0,0)},woe=ki();let xoe=class{constructor(e=Ve.Global){this.viewingMode=e,this.center=O(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=ks(Hc.forward)}pixelsPerPanAtZoom(e){return this.size/2/(this._zoomToPanScale*e)}zoomAtPixelsPerPan(e){return this.size/2/(this._zoomToPanScale*e)}pixelsPerRotateAtZoom(){const e=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/e}compareTo(e,r){if(r||(r={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===Ve.Global){const n=(Re(this.center)+Re(e.center))/2;r.pan=hN(this.center,e.center)*n}else r.pan=mi(this.center,e.center);let i=Math.abs(e.yaw-this.yaw);i>=Math.PI&&(i=2*Math.PI-i);const s=Math.abs(e.pitch-this.pitch);return r.rotate=Math.max(i,s),r.sourceZoom=this.distance,r.targetZoom=e.distance,r}interpolate(e,r,i){this.viewingMode===Ve.Global?sBe(e.center,r.center,i.pan,this.center):qr(this.center,e.center,r.center,i.pan),this.distance=isFinite(r.distance)?St(e.distance,r.distance,i.zoom):e.distance,this.pitch=St(e.pitch,r.pitch,i.rotate);let s=e.yaw;const n=r.yaw;Math.abs(n-s)>=Math.PI&&(s+=2*(s<n?1:-1)*Math.PI),this.yaw=St(s,n,i.rotate)}copyFrom(e){ie(this.center,e.center),this.pitch=e.pitch,this.yaw=e.yaw,this.distance=e.distance,ie(this.lookAtDirection,e.lookAtDirection),this.size=e.size,this.copyFromCommon(e),this.viewingMode=e.viewingMode}copyFromRenderCamera(e){const r=this._lookAtOrientation(e.center,woe);ie(this.center,e.center),fe(ea,e.center,e.eye),Oc(ea,ea,r),Oc(i1,e.up,r),this.distance=Re(ea),this.distance!==0&&(ea[0]/=this.distance,ea[1]/=this.distance,ea[2]/=this.distance),this.pitch=this._eyeUpToPitch(ea),this.yaw=this._eyeUpToYaw(ea,i1),this.size=Math.sqrt(e.width*e.width+e.height*e.height),this.copyFromCommon(e)}copyFromCommon(e){this.fov=e.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(e){const r=this._lookAtOrientation(this.center,woe);Qh(r,r),this._axisAngleVec3(Hc.sideway,this.pitch-Math.PI/2,Hc.forward,ea),this._axisAngleVec3(Hc.upward,this.yaw,ea),this._axisAngleVec3(Hc.sideway,this.pitch-Math.PI/2,Hc.upward,i1),this._axisAngleVec3(Hc.upward,this.yaw,i1),se(ea,ea,this.distance),Oc(ea,ea,r),Oc(i1,i1,r),e.center=this.center,e.eye=fe(ea,this.center,ea),e.up=i1}_axisAngleVec3(e,r,i,s=i){const n=Math.cos(r),o=Math.sin(r);return se(jc,i,n),pt(Yl,e,i),se(Yl,Yl,o),se(ly,e,(1-n)*ye(e,i)),de(s,de(s,jc,Yl),ly)}_lookAtOrientation(e,r=ki()){return this._upAtLookAt(e,ly),pt(jc,this.lookAtDirection,ly),_e(jc,jc),jc[0]===0&&jc[1]===0&&jc[2]===0&&ie(jc,Hc.sideway),pt(Yl,ly,jc),_e(Yl,Yl),r[0]=jc[0],r[1]=Yl[0],r[2]=ly[0],r[3]=jc[1],r[4]=Yl[1],r[5]=ly[1],r[6]=jc[2],r[7]=Yl[2],r[8]=ly[2],r}_upAtLookAt(e,r){return this.viewingMode===Ve.Local?ie(r,Hc.upward):_e(r,e)}_eyeUpToPitch(e){return Math.PI-hN(Hc.upward,e)}_eyeUpToYaw(e,r){const i=KJe;return Math.abs(r[2])<.5?(ie(i,r),e[2]>0&&se(i,i,-1)):ie(i,e),pt(Yl,i,Hc.upward),_e(Yl,Yl),hN(Hc.sideway,Yl,Hc.upward)}};const eF={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};let eQe=class _2e{constructor(e){this._createCamera=e,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:eF.desiredScreenFlow},this.source=e(),this.target=e()}clone(){const e=new _2e(this._createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,r,i){this.source!==e&&this.source.copyFrom(e),this.target!==r&&this.target.copyFrom(r),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=i.desiredScreenFlow!=null?i.desiredScreenFlow:eF.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const r=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/r}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}},tQe=class{constructor(){this.segments=[]}get time(){return this.segments.reduce((e,r)=>e+r.time,0)}interpolateComponentsAt(e,r){e=Math.min(Math.max(e,0),1),e*=this.time;let i=0,s=0;const n=this.definition;for(let o=0;o<this.segments.length;o++){const a=this.segments[o],l=a.definition;if(e<=a.time||o===this.segments.length-1){if(r=this.segmentInterpolateComponentsAt(a,a.time===0?0:e/a.time,r),n.hasPan&&!isNaN(r.pan)&&isFinite(n.compared.pan)?r.pan=(i+l.compared.pan*r.pan)/n.compared.pan:r.pan=1,n.hasRotate&&!isNaN(r.rotate)&&isFinite(n.compared.rotate)?r.rotate=(s+l.compared.rotate*r.rotate)/n.compared.rotate:r.rotate=1,n.hasZoom&&!isNaN(r.zoom)&&isFinite(l.compared.targetZoom)){const c=r.zoom*(l.compared.targetZoom-l.compared.sourceZoom)+l.compared.sourceZoom,h=this.segments[0].definition.compared.sourceZoom,d=this.segments[this.segments.length-1].definition.compared.targetZoom;r.zoom=(c-h)/(d-h)}else r.zoom=1;return r}e-=a.time,i+=l.compared.pan,s+=l.compared.rotate}}segmentInterpolateComponentsAt(e,r,i){return e.interpolateComponentsAt(r,i)}},Uk=class{get time(){return this._time}constructor(e){e&&this.update(e)}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,r=e.compared,i=r.sourceZoom,s=r.targetZoom;this._zoomSign=i>s?1:-1,this._panPixelsAtSource=r.pan*e.source.pixelsPerPanAtZoom(i);const n=(e.source.pixelsPerRotateAtZoom(i)+e.target.pixelsPerRotateAtZoom(s))/2;this._rotatePixels=r.rotate*n}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom,{hasZoom:i,hasPan:s,hasRotate:n}=this.definition;let o=0,a=0;i&&(s&&(o=(r/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),n&&(a=this._zoomSign*(Math.log(e/r)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(i&&s&&n){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(i&&s){const c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(i&&n){const c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(s&&n){const c=this._panPixelsAtSource/this._rotatePixels,h=1+c;this._panPixelFlow=c/h*l,this._rotatePixelFlow=1/h*l}else s?this._panPixelFlow=l:i?this._zoomPixelFlow=l:n&&(this._rotatePixelFlow=l);this._time=n?this.rotateTime:i?this.zoomTime:s?this.panTime:0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,r=e*this._panPixelsAtSource;return Math.log(r*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0}_interpolateComponentsZoom(e){if(e===0||e===1)return e;if(this.definition.hasZoom){const r=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom;return(r*(r/i)**-e-r)/(i-r)}return e}_interpolateComponentsPan(e){if(e===0||e===1)return e;if(this.definition.hasPan&&this.definition.hasZoom){const r=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(r*e*this._time)-1))/(r*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,r){e=Math.min(Math.max(e,0),1);const i=this._interpolateComponentsZoom(e),s=this._interpolateComponentsPan(e),n=this._interpolateComponentsRotate(e);return r?(r.zoom=i,r.pan=s,r.rotate=n):r={zoom:i,pan:s,rotate:n},r}};function rQe(t,e,r){const i=e-t.compared.sourceZoom,s=t.halfWindowPanAtZoom(i);return-t.halfWindowSize*(r.ascensionFactor*Math.LN2*t.compared.pan+s)*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2*s)}function iQe(t,e,r){const i=1/e,s=Math.log(t.compared.sourceZoom*i),n=1/t.desiredPixelFlow,o=1/Math.LN2,a=e-t.compared.sourceZoom,l=1/a,c=(r.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(a))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*i*n*o*l*c-t.halfWindowSize*s*n*o*l+t.halfWindowSize*s*n*o*c/(a*a)}function sQe(t,e,r){const i=e-t.compared.sourceZoom,s=1/i,n=1/e,o=Math.log(t.compared.sourceZoom*n),a=(r.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(i))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*n*a+2*s*o+2*n-2*o*a/(i*i)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function nQe(t,e){return-t.halfWindowSize*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2)}function oQe(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function aQe(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function lQe(t,e,r){return-t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e))}function cQe(t,e,r){return t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e))}function uQe(t,e,r){return-2*t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e*e))}function hQe(t,e,r){return t.halfWindowSize*(-t.halfWindowPanAtZoom(e)-r.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*t.halfWindowPanAtZoom(-e+t.compared.targetZoom))}function dQe(t,e,r){const i=Math.log(e/t.compared.targetZoom),s=1/t.desiredPixelFlow,n=1/Math.LN2,o=-e+t.compared.targetZoom,a=1/o,l=(-t.halfWindowPanAtZoom(e)-r.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return-t.halfWindowSize*i*s*n*a+t.halfWindowSize*i*s*n*l/(o*o)+t.halfWindowSize*s*n*a*l/e}function pQe(t,e,r){const i=e-t.compared.targetZoom,s=1/i,n=1/e,o=Math.log(e/t.compared.targetZoom),a=(t.halfWindowPanAtZoom(e)+r.descensionFactor*Math.LN2*t.compared.pan-t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*n*a-2*s*o+2*n+2*o*a/(i*i)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function fQe(t,e){return t.halfWindowSize*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2)}function mQe(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function gQe(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function yQe(t){const e=Math.LN2*t.compared.pan,r=t.compared.sourceZoom-t.compared.targetZoom,i=t.halfWindowPanAtZoom(r),s=t.halfWindowSize*Math.log(t.compared.sourceZoom/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*i);return t.compared.sourceZoom<=t.compared.targetZoom?s*(e-i):s*(e+i)}function _Qe(t,e){let r=vQe(t,e);const i={ascensionFactor:e.ascensionFactor!=null?e.ascensionFactor:.5,descensionFactor:e.descensionFactor!=null?e.descensionFactor:.5},s=i.ascensionFactor===0,n=i.descensionFactor===0,o=s?nQe:rQe,a=s?oQe:iQe,l=s?aQe:sQe,c=n?fQe:hQe,h=n?mQe:dQe,d=n?gQe:pQe,f=S=>o(t,S,i)+lQe(t,S,i)+c(t,S,i),m=S=>a(t,S,i)+cQe(t,S,i)+h(t,S,i),g=S=>l(t,S,i)+uQe(t,S,i)+d(t,S,i);let _=f(r);const v=yQe(t);let b;const T=e.maximumIterations||20,x=e.maximumDistance!=null?e.maximumDistance:1/0;for(b=0;b<T;b++){const E=(m(r)+1e-6)/g(r);if(isNaN(E)||r>=x&&E<0){if(!isFinite(x))return null;r=x,_=f(r);break}if(r-=E,r<t.compared.sourceZoom||r<t.compared.targetZoom)return null;const A=f(r);if(Math.abs(A-_)/_<=.005)break;_=A}return _>v*(1-.3)||r<t.compared.sourceZoom||r<t.compared.targetZoom?null:r}function vQe(t,e){const r=Math.max(t.compared.sourceZoom,t.compared.targetZoom),i=t.source.zoomAtPixelsPerPan(t.desiredPixelFlow/t.compared.pan)/2;return i<r?e.maximumDistance!=null?r+(e.maximumDistance-r)/2:1.5*r:e.maximumDistance?Math.min(e.maximumDistance,i):i}let bQe=class extends tQe{constructor(e,r){super(),this._preallocSegments=[new Uk,new Uk,new Uk],this._ascensionSegment=null,this._descensionSegment=null,this.update(e,r)}update(e,r){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();let i=null;r&&r.apex&&(i=_Qe(e,r.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,i==null?this._updateWithoutApex():this._updateWithApex(i,r?.apex)}segmentInterpolateComponentsAt(e,r,i){return i=e.interpolateComponentsAt(r,i),e===this._ascensionSegment?i.zoom=AQ(i.zoom):e===this._descensionSegment&&(i.zoom=r9(i.zoom)),i}_updateWithApex(e,r){const[i,s,n]=this._preallocSegments,o=r?.ascensionFactor??.5,a=Math.min(1-o,r?.ascensionFactor!=null&&r.descensionFactor!=null?r.descensionFactor:.5),l=1-o-a;i.definition?i.definition.copyFrom(this.definition):i.definition=this.definition.clone(),i.definition.compared.targetZoom=e,i.definition.compared.pan=this.definition.compared.pan*o,i.definition.compared.rotate=this.definition.compared.rotate*o,i.update(),this._ascensionSegment=i,this.segments.push(i),l>0&&(s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.copyFrom(this.definition),s.definition.compared.sourceZoom=e,s.definition.compared.targetZoom=e,s.definition.compared.pan=this.definition.compared.pan*l,s.definition.compared.rotate=this.definition.compared.rotate*l,s.update(),this.segments.push(s)),n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.sourceZoom=e,n.definition.compared.pan=this.definition.compared.pan*a,n.definition.compared.rotate=this.definition.compared.rotate*a,n.update(),this._descensionSegment=n,this.segments.push(n)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}};const wQe={zoom:0,pan:0,rotate:0};let xQe=class{get time(){return this._time}constructor(e){this._createCamera=e,this._time=0,this.definition=new eQe(e),this.path=new bQe}update(e,r,i){this.definition.update(e,r,i),this.path.update(this.definition,i),this._time=this._applyTimeSettings(Dge(isFinite(this.path.time)?this.path.time:0),i),this._easing=i.easing??(this._time>=1e3?y2e:UP)}cameraAt(e,r){r=r||this._createCamera(),e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const i=this.path.interpolateComponentsAt(e,wQe);return r.interpolate(this.definition.source,this.definition.target,i),r}_normalizedEasing(e){const r=this._easing(0,this._time),i=this._easing(1,this._time);return(this._easing(e,this._time)-r)/(i-r)}_applyTimeSettings(e,r){const i=r.speedFactor!=null?r.speedFactor:1;r.duration!=null?e=r.duration:r.speedFactor!=null&&(e=e/i);const s=r.minDuration!=null?r.minDuration:eF.minDuration/i,n=r.maxDuration!=null?r.maxDuration:eF.maxDuration/i;return Math.min(Math.max(s,e),n)}};const TQe=O();let SQe=class{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(e){this.currentTime=0,this._animation=new xQe(()=>new xoe(e)),this._current=new xoe(e)}update(e,r,i){const s=this._animation.definition.source,n=this._animation.definition.target,o=fe(TQe,r.center,e.center),a=Re(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),ie(s.lookAtDirection,o),ie(n.lookAtDirection,o),s.copyFromRenderCamera(e),n.copyFromRenderCamera(r),this._current.copyFrom(s),this._animation.update(s,n,i),this.currentTime=0,e.almostEquals(r)&&(this.currentTime=this._animation.time)}cameraAt(e,r){return this._animation.cameraAt(e,this._current),r=r||new yt,this._current.copyToRenderCamera(r),r}step(e,r){return this.finished||(this.currentTime=this.currentTime+Dge(e),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,r)}};var Zi;(function(t){t.Ready="ready",t.Rejected="rejected",t.Running="running",t.Stopped="stopped",t.Finished="finished"})(Zi||(Zi={}));let Ug=class extends Te{constructor(e){super(e),this.state=Zi.Ready}get active(){return this.state===Zi.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=Zi.Stopped,!0)}finishController(){this.state=Zi.Finished}get steppingFinished(){return!1}};u([p({constructOnly:!0})],Ug.prototype,"view",void 0),u([p({readOnly:!0})],Ug.prototype,"active",null),u([p()],Ug.prototype,"state",void 0),u([p({readOnly:!0})],Ug.prototype,"isInteractive",null),Ug=u([P("esri.views.3d.state.controllers.CameraController")],Ug);let RM=class extends Ug{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(zr()),this._asyncResult=null),this.state===Zi.Finished||this.state===Zi.Stopped?(M6(e),this.state===Zi.Finished?e.resolve():e.reject(zr())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=Zi.Running,this.viewAnimation!=null&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){this.viewAnimation==null||this.state!==Zi.Ready&&this.state!==Zi.Running||(this.viewAnimation.state===DE.State.FINISHED?this.finish():this.viewAnimation.state===DE.State.STOPPED&&(this.state=Zi.Stopped))}onControllerEnd(){this.viewAnimation==null||this.viewAnimation.done||(this.state===Zi.Finished?this.viewAnimation.finish():this.state===Zi.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===Zi.Finished?this._asyncResult.resolve():this._asyncResult.reject(zr()))}finish(){this.finishController()}};RM=u([P("esri.views.3d.state.controllers.AnimationController")],RM);let Wg=class extends RM{get intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.mode="interaction",this._hasTarget=!1}initialize(){this.animation=new SQe(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new DE}get isInteractive(){return this.mode==="interaction"}begin(e,r){this._hasTarget=!0;const i=this.animationSettings(r);y$.copyFrom(this.view.state.camera);const s=ed(this.view.state.viewingMode);this.intersectionHelper.intersectRay(y$.ray,s,Toe)&&(y$.center=Toe),this.animation.update(y$,e,i),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(e,r){this._hasTarget&&this.animation.step(e,r)}onControllerEnd(e){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:typeof e.easing=="string"?WJe[e.easing]:e.easing}}};u([p({constructOnly:!0})],Wg.prototype,"mode",void 0),u([p({readOnly:!0})],Wg.prototype,"isInteractive",null),Wg=u([P("esri.views.3d.state.controllers.PointToPointAnimationController")],Wg);const y$=new yt,Toe=O();function i9(t=CQe){return[t[0],t[1],t[2],t[3]]}function MM(t,e){return EQe(t[0],t[1],t[2],e,TJ.get())}function EQe(t,e,r,i,s=i9()){return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function LQ(t,e,r){return pt(r,t,e),_e(r,r),r[3]=S8(t,e),r}const CQe=[0,0,1,0];function v2e(t,e,r){return AQe(t,t.screenToRender(e,Ge.get()),r)}function AQe(t,e,r){const i=yn(Ge.get(),e);if(i[2]=0,!t.unprojectFromRenderScreen(i,r.origin))return null;const s=yn(Ge.get(),e);s[2]=1;const n=t.unprojectFromRenderScreen(s,Ge.get());return n==null?null:(fe(r.direction,n,r.origin),r)}function FC(t,e,r){return DQ(t,t.screenToRender(e,Ge.get()),r)}function DQ(t,e,r){ie(r.origin,t.eye);const i=ne(Ge.get(),e[0],e[1],1),s=t.unprojectFromRenderScreen(i,Ge.get());return s==null?null:(fe(r.direction,s,r.origin),r)}function NQ(t,e,r,i){const s=FC(e,r,OQe);return Lv(t,s,i)}const OQe=eo();var BE;(function(t){t[t.Ellipsoid=0]="Ellipsoid",t[t.Silhouette=1]="Silhouette"})(BE||(BE={}));const b2e=30,tF=[1,3e8],s9=80,w2e=8,x2e=200,T2e=1508e5,S2e=5,E2e=50,RQe=5,MQe=10,kk=90,Dx={exclude:new Set([E_])};function vw(t,e,r){return r[0]=e[0]/(t.fullWidth/t.pixelRatio),r[1]=e[1]/(t.fullHeight/t.pixelRatio),r}function XH(t){for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;return t}function wv(t,e,r){const i=Lu(SJ.get(),r[3],r);i==null||U1e(i,pn)||(fe(Jr,t.eye,e),ze(Jr,Jr,i),t.eye=de(Jr,Jr,e),fe(Jr,t.center,e),ze(Jr,Jr,i),t.center=de(Jr,Jr,e),t.up=ze(Jr,t.up,i))}function PQe(t,e,r,i){return Rx(t,v2e(e,r,kQ),i)}function YH(t,e,r,i){return Rx(t,FC(e,r,kQ),i)}function FQ(t,e,r,i){const s=Ge.get();let n=1-r;fe(s,e,t.eye);const o=Re(s);let a=o*(1-n);n>=0&&a<i&&(a=i,n=-(a-o)/o),Math.abs(o-a)<1e-6||(se(s,s,n),t.eye=de(Jr,t.eye,s),t.center=qr(Jr,t.center,e,n))}function C2e(t,e,r){e.getScreenCenter(Soe),NQ(t,e,Soe,Jr)&&(e.center=Jr);const i=e.distance,s=i*r;if(Math.abs(i-s)<1e-6)return;const n=se(Ge.get(),e.viewForward,s);e.eye=fe(Jr,e.center,n)}const Soe=Qi();function zk(t,e){ne(e,0,0,0);for(const r of t)de(e,e,r);se(e,e,1/t.length)}function RN(t,e,r,i){return Math.sin(t/Re(e))*(r+i.radius)}function Eoe(t,e,r,i){return RN(Math.PI/2,e,r,i)+(t-Math.PI/2)}var to;(function(t){t[t.Vertical=0]="Vertical",t[t.Horizontal=1]="Horizontal"})(to||(to={}));const Coe={Elevation:3e4,Angle:Ft(16)},_$={Pole:.95,Angle:Ft(18),Tilt:45},A2e=Ft(80);function O2e(t,e,r,i,s,n){const o=O(),a=xs();let l=!0,c=!0;return t.intersectScreen(r,o,n)?a[3]=Re(o):(c=!1,e.aboveGround&&s!==BE.Ellipsoid?a[3]=Math.max(Re(e.center),.9*i.radius):a[3]=Re(e.eye)-e.relativeElevation,s===BE.Silhouette?PM(a,e,r,o):l=NQ(a,e,r,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function n9(t,e,r){return Re(t.eye)-r.radius>Coe.Elevation?to.Horizontal:(FC(t,e,Loe),-Math.sign(t.relativeElevation)*(.5*Math.PI+S8(t.eye,Loe.direction))<Coe.Angle?to.Vertical:to.Horizontal)}function R2e(t,e,r){fe(Vk,r,e),t.eye=fe(Jr,t.eye,Vk),t.center=fe(Jr,t.center,Vk)}const Vk=O();function PM(t,e,r,i){const s=FC(e,r,kQ);return s!=null&&(PC(t,s,v$),Lv(t,s,i)?!(xo(v$,s.origin)<xo(i,s.origin))||(ie(i,v$),!1):(fe(oT,e.eye,e.center),_e(oT,oT),qbe(oT,-ye(_e(oT,oT),v$),Aoe),Rx(Aoe,s,i),!1))}const v$=O(),oT=O(),Aoe=Fr();function M2e(t,e,r,i,s,n){let o=0;if(pt(sF,t,e),fe(T$,t,e),Re(t)<=s||!i.aboveGround){pt(r,T$,i.eye);const a=ye(t,e)/(Re(t)*Re(e));if(a<.9999)o=Dn(a);else{const c=Re(pt(O(),t,e))/(Re(t)*Re(e));o=Hh(c)}const l=Math.cos(ve(lv.normalize(Ft(n)),0,A2e));o=-o-Math.max(0,Re(e)-s)/(l*s)}else fe(Ooe,i.eye,i.center),pt(r,T$,Ooe),o=-Re(T$)/s;return _e(r,r),se(r,r,Re(sF)),o}const Ooe=O();function Roe(t,e,r,i){let s,n;const o=Math.cos(ve(lv.normalize(Ft(i)),0,A2e));return s=e>r?-(e-r)/(o*r):e<-r?Math.PI-(e+r)/(o*r):Dn(e/r),n=t>r?-(t-r)/(o*r):t<-r?Math.PI-(t+r)/(o*r):Dn(t/r),(n-s)*r}function IQe(t,e,r,i,s,n,o,a,l,c){const h=Roe(t[2],e[2],n[3],a),d=l?Roe(t[0],e[0],n[3],180):e[0]-t[0],f=Math.sin(o)*d-Math.cos(o)*h,m=Math.cos(o)*d+Math.sin(o)*h;_e(Jr,s);const g=l?f/Math.sqrt(Math.abs(n[3]**2-ye(r,Jr)**2)):f/n[3],_=m/Math.sqrt(Math.abs(n[3]**2-ye(r,i)**2));or(c,g,_)}function P2e(t,e,r,i,s,n,o,a,l,c){pt(sF,t,e),vj(n.up,n.eye,b$,w$,x$),vj([0,0,1],n.eye,t0,ev,D2e),ie(r,ev),ie(i,t0),_e(r,r),se(r,r,Re(sF)),nse(t,_e(w$,w$),_e(x$,x$),_e(b$,b$),Moe),nse(e,w$,x$,b$,Poe),IQe(Moe,Poe,t,t0,ev,o,a,l,c,s)}function $Qe(t,e,r,i,s,n,o){Lu(rF,s,i),Lu(iF,o,n),ai(fS,rF,iF),fe(e,t,r),ze(e,e,fS),de(e,e,r)}function I2e(t,e,r,i,s,n){Lu(rF,i,r),Lu(iF,n,s),ai(fS,rF,iF),fe(Jr,t.eye,e),ze(Jr,Jr,fS),t.eye=de(Jr,Jr,e),fe(Jr,t.center,e),ze(Jr,Jr,fS),t.center=de(Jr,Jr,e),fe(Jr,t.up,e),ze(Jr,Jr,fS),t.up=de(Jr,Jr,e)}function UQ(t,e,r,i,s,n){return(Math.abs(i)>Math.PI-_$.Angle||Math.abs(i)<_$.Angle)&&(Math.abs(t[2])<r*_$.Pole||Math.abs(e)>r)&&n.aboveGround&&s<_$.Tilt}function $2e(t,e,r,i,s,n){if(n)LQ(r,i,Ioe),wv(e,t,Ioe);else{const o=M2e(r,i,$oe,e,t[3],s);wv(e,t,MM($oe,o))}}function L2e(t,e,r,i,s,n,o){const a=o?20:1,l=1e-12;let c,h;ie(s1,i),S$.copyFrom(e);for(let d=0;d<a&&xo(r,s1)>l&&(c=xo(r,s1),P2e(r,s1,ev,t0,_3,S$,t,s,n,o),I2e(S$,t,t0,_3[1],ev,_3[0]),$Qe(s1,s1,t,t0,_3[1],ev,_3[0]),h=xo(r,s1),h<c||d===0);d++)e.copyFrom(S$)}function LQe(t,e,r,i,s,n,o){UQ(r,ye(e.up,r),t[3],-lv.normalize(Ft(s)),n,e)?L2e(t,e,r,i,-lv.normalize(Ft(s)),n,o):$2e(t,e,r,i,n,o)}function DQe(t,e,r,i,s,n){const{eye:o}=t;vj([0,0,1],o,t0,ev,D2e);const a=e.translation[0]*r.pan,l=s.mode==="zoom"?0:e.translation[1]*r.pan,c=Math.max(Math.sqrt(Math.abs(1-ye(t.center,t0)**2/Re(t.center)**2)),.5),h=(Math.sin(n)*l+Math.cos(n)*a)/c,d=-Math.cos(n)*l+Math.sin(n)*a;switch(Rc(i.pan.matrix,i.pan.matrix,h,t0),i.pan.enabled=!0,s.mode){case"pan":Rc(i.pan.matrix,i.pan.matrix,d,ev),i.pan.enabled=!0;break;case"zoom":i.zoom=-e.translation[1]*r.zoom}}function NQe(t,e,r,i,s){const{eye:n,viewRight:o}=t,a=pt(Ge.get(),o,n),l=e.translation[0]*r.pan;switch(l!==0&&(Rc(i.pan.matrix,i.pan.matrix,-l,a),i.pan.enabled=!0),s.mode){case"pan":{const c=e.translation[1]*r.pan;c!==0&&(Rc(i.pan.matrix,i.pan.matrix,c,o),i.pan.enabled=!0);break}case"zoom":i.zoom=-e.translation[1]*r.zoom}}function FQe(t,e,r,i,s,n,o,a,l){UQ(t.center,ye(t.up,t.center),Re(t.center),-lv.normalize(Ft(n)),o,e)?DQe(e,r,i,a,l,-lv.normalize(Ft(s))):NQe(e,r,i,a,l)}const t0=O(),ev=O(),D2e=O(),b$=O(),w$=O(),x$=O(),Moe=O(),Poe=O(),_3=He(),Ioe=i9(),rF=xe(),iF=xe(),fS=xe(),s1=O(),Jr=O(),T$=O(),S$=new yt,sF=O(),$oe=O(),kQ={origin:O(),direction:O()},Loe={origin:O(),direction:O()},Doe=.6,Bk=4,UQe=60;let nF=class extends Wg{constructor(){super(...arguments),this._zoomLocation=O(),this._tmpCamera=new yt,this._tmpViewDir=O(),this._tmpRayDir={origin:O(),direction:O()},this._targetOnSphere=O(),this._tmpCenter=O(),this._constraintOptions={selection:Mi.ALL_EXCEPT_COLLISION,interactionType:Xt.ZOOM,interactionFactor:null,interactionStartCamera:new yt,interactionDirection:null,tiltMode:ro.TUMBLE},this._sphere=xs()}initialize(){this._intersector=ed(this.view.state.viewingMode)}zoomStep(e,r){if(!this.active)return;const i=this.view.state,{interactionStartCamera:s}=this._constraintOptions;s&&(this.animation.finished?s.copyFrom(i.camera):this.animation.cameraAt(1,s));let n=!1,o=!1;this.intersectionHelper.intersectScreen(r,this._zoomLocation,this.view.map.ground.opacity===0?Dx:{})&&(n=e>0,o=!0),this._tmpCamera.copyFrom(i.camera),n?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:ie(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,this._zoomLocation,r,o),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:UP}}_updateCamera(e,r,i,s,n){const o=Vr(this.view.spatialReference),a=n9(e,s,o),l=Math.abs(this.view.camera.position.z);_e(C$,e.eye),se(C$,C$,-1),FC(e,s,this._tmpRayDir),_e(this._tmpRayDir.direction,this._tmpRayDir.direction);const c=ve(Math.min(w2e,1/Math.abs(ye(C$,this._tmpRayDir.direction)))*l,x2e,T2e);if(a===to.Horizontal){let h=Doe**r;this._sphere[3]=Re(i),fe(this._tmpViewDir,e.center,e.eye);const d=Math.min(Re(this._tmpViewDir),c);let f=d*h;if(h<=1&&f<Bk&&(f=Bk,h=f/d),Math.abs(d-f)<1e-6)return;const m=Re(e.center);if(this._sphere[3]!==m){const g=this._sphere[3]+h*(m-this._sphere[3]);e.center=se(E$,e.center,g/m)}se(this._tmpViewDir,this._tmpViewDir,-h),e.eye=de(E$,e.center,this._tmpViewDir),Ns(this.view,e,this._constraintOptions),xo(i,e.center)>1e-12&&NQ(this._sphere,e,s,this._targetOnSphere)&&LQe(this._sphere,e,i,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let h=Doe**Math.abs(r);const d=r>0?1:-1;fe(this._tmpViewDir,i,e.eye);const f=Re(this._tmpViewDir),m=this.view._stage.renderView.getMinimalDepthForArea(null,s[0],s[1],this.view.state.camera,UQe);let g=m??c;g=n&&r>0?Math.min(g,f):g,se(this._tmpRayDir.direction,this._tmpRayDir.direction,g),de(i,this._tmpRayDir.origin,this._tmpRayDir.direction);let _=g*h;const v=Math.max(Bk,1.01*e.nearFar[0]);if(r>0&&_<v&&(_=v,h=_/g),Math.abs(g-_)<1e-6)return;se(this._tmpRayDir.direction,this._tmpRayDir.direction,d*(1-h)),e.eye=de(E$,e.eye,this._tmpRayDir.direction),e.center=de(E$,e.center,this._tmpRayDir.direction)}NC(this.view,e)}};nF=u([P("esri.views.3d.state.controllers.global.ZoomStepController")],nF);const E$=O(),C$=O(),kQe=.6,zQe=4,VQe=60;let oF=class extends Wg{constructor(){super(...arguments),this._zoomLocation=O(),this._tmpCamera=new yt,this._tmpRayDir=O(),this._tmpCenter=O(),this._constraintOptions={selection:Mi.ALL,interactionType:Xt.ZOOM,interactionFactor:null,interactionStartCamera:new yt,interactionDirection:null,tiltMode:ro.TUMBLE}}zoomStep(e,r){if(!this.active)return;const i=this.view.state,{interactionStartCamera:s}=this._constraintOptions;s&&(this.animation.finished?s.copyFrom(i.camera):this.animation.cameraAt(1,s)),this._tmpCamera.copyFrom(i.camera);const n=ed(this.view.state.viewingMode);let o=!1;e>0?(o=this.intersectionHelper.intersectScreenFreePointFallback(r,this._zoomLocation,this.view.map.ground.opacity===0?Dx:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,n,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,n,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:ie(this._zoomLocation,this._tmpCamera.center);const a=kQe**e;let l=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,r[0],r[1],this.view.state.camera,VQe);fe(A$,this._tmpCamera.eye,this._zoomLocation),_e(A$,A$);const c=ve(Math.min(w2e,1/Math.abs(ye(BQe,A$)))*Math.abs(this.view.camera.position.z),x2e,T2e);if(l=l??c,l){const h=O();fe(h,this._zoomLocation,this._tmpCamera.eye),(l<Re(h)||!o)&&(_e(h,h),de(this._zoomLocation,this._tmpCamera.eye,se(h,h,l)))}this._updateCamera(this._tmpCamera,a,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:UP}}_updateCamera(e,r,i){fe(this._tmpRayDir,i,e.eye);const s=Re(this._tmpRayDir);let n=s*r;const o=r<=1,a=Math.max(zQe,1.01*e.nearFar[0]);n!==0&&(o&&n<a&&(n=a,r=n/s),Math.abs(s-n)<1e-6||(se(this._tmpRayDir,this._tmpRayDir,r),e.eye=fe(Noe,i,this._tmpRayDir),e.center=qr(Noe,e.center,i,1-r),Ns(this.view,e,this._constraintOptions)))}};oF=u([P("esri.views.3d.state.controllers.local.ZoomStepController")],oF);const Noe=O(),BQe=Pe(0,0,1),A$=O();function GQe(t,e){switch(e){case"primary":return t.pointerType==="touch"||t.button===0;case"secondary":return t.pointerType!=="touch"&&t.button===2;case"tertiary":return t.pointerType!=="touch"&&t.button===1}}function zQ(t,e){if(t.pointerType==="touch")return!1;switch(e){case"primary":return t.button===0;case"secondary":return t.button===2;case"tertiary":return t.button===1}}let jQe=class extends Ro{constructor(e,r){super(!0),this._view=e,this.registerIncoming("double-click",r,i=>this._handleDoubleClick(i))}_handleDoubleClick(e){const r=e.data;if(GQe(r,"primary")){const i=this._view.state.isGlobal?new nF({view:this._view,mode:"animation"}):new oF({view:this._view,mode:"animation"});this._view.state.switchCameraController(i),i.zoomStep(Math.log(.5)/Math.log(.6),Qi(r.x,r.y)),e.stopPropagation()}}};function HQe(t,e,r){return t===Ve.Global?new WQe(r):new qQe(e,r)}let qQe=class{constructor(e,r){this._elevationProvider=e,this._referenceEllipsoid=Vr(r),this._unitInMeters=Ta(r,this._referenceEllipsoid.metersPerDegree)}compute(e,r,i,s,n){n||(n={near:0,far:0});let o=e[2]*this._unitInMeters;const a=o,l=o-s,c=this._elevationProvider?.visibleElevationBounds;c&&(o=l>=0?a-this._unitInMeters*c.min:this._unitInMeters*c.max-a);const h={x:(i=i??new cr({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-i.xmin,y:i.ymax-i.ymin,z:4*Math.max(i.xmax-i.xmin,i.ymax-i.ymin)},d=Math.max(h.x,h.y,h.z);fe(n1,r,e),aT[0]=n1[0]>0?i.xmax:i.xmin,aT[1]=n1[1]>0?i.ymax:i.ymin,aT[2]=n1[2]>0?d/2:-d/2,fe(aT,aT,e),_e(n1,n1);const f=1.1*ye(aT,n1)*this._unitInMeters,m=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),g=Math.max(i.xmax-i.xmin,i.ymax-i.ymin),_=g*ZQe*this._unitInMeters,v=g*JQe*this._unitInMeters,b=ve((o-v)/(_-v),0,1)**3,T=Math.min(St(m,f,b),m)*Math.max(Math.log(Math.abs(l)),1);return N2e(Math.min(T,Math.max(34064e4,d))/this._unitInMeters,XQe,this._unitInMeters,n)}},WQe=class{constructor(e){this._referenceEllipsoid=Vr(e)}compute(e,r,i,s,n){n||(n={near:0,far:0});const o=Re(e),a=o-this._referenceEllipsoid.radius,l=this._referenceEllipsoid.radius+Math.min(0,s),c=Math.abs(a-s),h=Math.max(c,Math.abs(a)),d=Math.sqrt(h*(h+2*l)),f=o+this._referenceEllipsoid.radius;return N2e(1.2*St(d,f,HJ(h)),ve(2e4-(Math.log(h)-7.983)/9.011*19e3,1e3,2e4),1,n)}};function N2e(t,e,r,i){const s=YQe/r;return t/e>s?(i.far=t,i.near=i.far/e):(i.near=s,i.far=i.near*e),i}const XQe=2e4,YQe=2,ZQe=.001,JQe=1e-4,aT=O(),n1=O();let MN=class extends Te{constructor(e){super(e)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const r=this.view.state.camera;e.spatialReference!=null&&l2e(this.view,r,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>NC(this.view,e,kh.EYE_AND_CENTER))}};u([p({constructOnly:!0})],MN.prototype,"view",void 0),MN=u([P("esri.views.3d.state.ElevationCollisionConstraint")],MN);let hO=class extends Te{constructor(e){super(e),this.nearFarHeuristic=HQe(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([le(()=>[this.view.constraints?.clipDistance?.near,this.view.constraints?.clipDistance?.far],()=>this._clipDistanceNearFarChanged()),le(()=>this.view.constraints?.clipDistance?.mode,()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e)),le(()=>this.view.renderDataExtent,()=>this._updateNearFar(),Wr),le(()=>[this.view.constraints?.altitude?.min,this.view.constraints?.altitude?.max],()=>this._updateAltitude(),Wr),le(()=>this.view.constraints?.tilt?.max,()=>this._updateTiltMax(),Wr),le(()=>this.view.constraints?.tilt?.mode,()=>this._updateTilt(),Wr),le(()=>this.view.state?.camera,()=>this._updateTiltAutoMax(),Wr),le(()=>[this.view.map?.ground?.navigationConstraint?.type,this.view.state?.constraints?.collision?.enabled],()=>this._updateCollision(),Wr)]),this.view.state.isLocal&&this.addHandles(le(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),Pr)),this._updateNearFar(),this.view.state.viewingMode!==Ve.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new MN({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){const e=this.view.constraints?.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(r=>this._updateCameraNearFarManual(r,e))}_updateNearFar(){this.view.state.updateCamera(e=>this._updateCameraNearFar(e))}_updateCameraNearFar(e){const r=this.view.constraints&&this.view.constraints.clipDistance;(r?r.mode:"auto")==="manual"?this._updateCameraNearFarManual(e,r):this._updateCameraNearFarAuto(e,r)}_updateCameraNearFarAuto(e,r){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,t9(this.view,e.eye),e),r&&r.autoUpdate(e.near,e.far)}_updateCameraNearFarManual(e,r){r&&(e.near=r.near,e.far=r.far)}_updateCollision(){const e=this.view.map?.ground?.navigationConstraint?.type,r=!e||e==="stay-above",i=this.view.state.constraints.collision;if(r!==i.enabled){i.enabled=r,r&&this._reapplyConstraints(Mi.COLLISION);const s=this.view.constraints&&this.view.constraints.tilt;s&&s.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==Ve.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const r=this.view.state.constraints;r.tilt=r.createConstantMaxTilt(Ft(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const r=this.view.state.constraints;if(r.tilt){const i=r.tilt(this.view.state.camera.distance).max;e.autoUpdate(al(i))}}_updateLocalSurfaceDistance(e){if(e==null)return;let r=Math.max(e.width,e.height);if(r<=0)return;e.zmax!=null&&e.zmin!=null&&(r=Math.max(r,e.zmax-e.zmin));const i=this.view.state,s=3*r/Math.atan(i.camera.fov/2);s!==i.constraints.distance&&(i.constraints.distance=s)}_reapplyConstraints(e=Mi.ALL){this.view.state.updateCamera(r=>Ns(this.view,r,{selection:e,interactionType:Xt.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:ro.TUMBLE}))}};u([p({constructOnly:!0})],hO.prototype,"view",void 0),u([p({readOnly:!0})],hO.prototype,"surfaceCollisionConstraint",void 0),hO=u([P("esri.views.3d.state.ConstraintsManager")],hO);let A_=class{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}constructor(e){this.renderCoordsHelper=e,this.frustum=EM(),this._points=aTe(),this.lines=new Array(12),this._origin=O(),this._direction=O(),this._altitude=null;for(let r=0;r<12;r++)this.lines[r]={origin:null,direction:O(),endpoint:null}}update(e){lTe(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),ie(this._origin,e.eye),ie(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let r=0;r<this._points.length;r++)ie(this._points[r],e[r]);cTe(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return B_(this.frustum,e)}intersectsRay(e){return JWe(this.frustum,e)}intersectsLineSegment(e,r){return QWe(this.frustum,e,r)}intersectsPoint(e){return uTe(this.frustum,e)}_updateLines(){const e=this._points;for(let r=0;r<4;r++){const i=r+4;Gk(this.lines[r],e[r],e[i]),Gk(this.lines[r+4],e[r],r===3?e[0]:e[r+1]),Gk(this.lines[r+8],e[i],r===3?e[4]:e[i+1])}}};function Gk(t,e,r){t.origin=e,t.endpoint=r,O0(t.direction,e,r)}A_.planePointIndices=KWe,A_.nearFarLineIndices=[[et.NEAR_BOTTOM_LEFT,et.FAR_BOTTOM_LEFT],[et.NEAR_BOTTOM_RIGHT,et.FAR_BOTTOM_RIGHT],[et.NEAR_TOP_RIGHT,et.FAR_TOP_RIGHT],[et.NEAR_TOP_LEFT,et.FAR_TOP_LEFT]];let wR=class extends Ug{set desiredCamera(e){this._set("desiredCamera",e.clone())}constructor(e){super(e)}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=Zi.Running,this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this.removeAllHandles()}stepController(){}_handleElevationChangeEvent(e){(e.spatialReference==null||l2e(this.view,this.desiredCamera,e.extent,e.spatialReference))&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),NC(this.view,e,kh.EYE_AND_CENTER)||this.constraintEnabled||(this.state=Zi.Stopped)})}};u([p({constructOnly:!0})],wR.prototype,"desiredCamera",null),wR=u([P("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],wR);const QQe=O(),O$=O();function VQ(){return{direction:O(),up:O()}}function F2e(t,e,r,i,s){let n=_e(QQe,t),o=ye(n,i);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(ye(e,i)),o<.99?(ie(n,e),a&&se(n,n,-1)):n=null);let l=0;if(n){se(O$,i,ye(i,n)),fe(n,n,O$);const h=ye(n,s)/(Re(n)*Re(s));pt(O$,n,s),l=(ye(O$,i)>0?1:-1)*al(Dn(h))}const c=al(Dn(-ye(i,t)/Re(t)));return r?(r.heading=l,r.tilt=c,r):{heading:l,tilt:c}}const U2e=Pe(0,1,0),k2e=Pe(0,0,1),v3=xe(),Vm=O(),Bm=O();function z2e(t,e,r,i=VQ()){const{direction:s,up:n}=i;return P1e(v3,-Ft(e)),EE(v3,v3,Ft(r)),ze(s,k2e,v3),se(s,s,-1),ze(n,U2e,v3),i}function KQe(t,e,r,i){return F2e(e,r,i,k2e,U2e)}function eKe(t,e,r,i){const s=z2e(t,r,i),n=O();return se(n,s.direction,-e),de(n,n,t),{up:s.up,eye:n,heading:r,tilt:i}}function tKe(t){return al(t)}function rKe(t){return Ft(t)}function V2e(t,e,r,i,s){const n=t.renderSpatialReference,o=t.map&&t.spatialReference||e.spatialReference;return Ao(e,Vm,n),Ao(e,Bm,n),Vm[0]-=r/2,Bm[0]+=r/2,Vm[1]-=i/2,Bm[1]+=i/2,Qs(Vm,n,Vm,o),Qs(Bm,n,Bm,o),s?(s.xmin=Vm[0],s.ymin=Vm[1],s.xmax=Bm[0],s.ymax=Bm[1],s.spatialReference=o):s=new cr(Vm[0],Vm[1],Bm[0],Bm[1],o),s}const iKe=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:KQe,eyeForCenterWithHeadingTilt:eKe,eyeTiltToLookAtTilt:rKe,headingTiltToDirectionUp:z2e,lookAtTiltToEyeTilt:tKe,toExtent:V2e},Symbol.toStringTag,{value:"Module"})),B2e=Pe(0,0,1),G2e=_e(O(),Pe(1,1,1)),sKe=new av(-180,180),b3=xe(),g_=O(),lT=O();function j2e(t,e,r,i=VQ()){pt(g_,t,B2e),ye(g_,g_)===0&&pt(g_,t,G2e),Lu(b3,-Ft(e),t),Rc(b3,b3,-Ft(r),g_);const{up:s,direction:n}=i;return pt(s,g_,t),_e(s,s),ze(s,s,b3),_e(n,t),va(n,n),ze(n,n,b3),i}function nKe(t,e,r,i){const s=g_,n=lT;return _e(s,t),pt(lT,s,B2e),ye(lT,lT)===0&&pt(lT,s,G2e),pt(n,lT,s),F2e(e,r,i,s,n)}function oKe(t,e,r,i){const s={eye:O(),up:null,tilt:i,heading:r},n=g_;n[0]=t[0],n[1]=t[2],n[2]=-t[1];const o=e,a=Ft(r),l=Ft(i),c=Math.sin(a),h=Math.cos(a),d=Math.sin(l),f=Math.cos(l),m=Re(n);let g;if(Math.abs(l)<1e-8)g=o+m;else{const J=m/d,I=Hh(o/J),z=Math.PI-l-I;g=J*Math.sin(z)}const _=f*o,v=o*o*(d*d),b=h*h*v,T=g-_,x=T*T,S=b*(b+x-n[1]*n[1]);if(S<0)return se(s.eye,n,g/m),s.tilt=0,R$(s,t);const E=Math.sqrt(S),A=n[1]*T,R=b+x;let M;if(M=h>0?-E+A:E+A,Math.abs(R)<1e-8)return m<1e-8?(s.eye[0]=0,s.eye[1]=0,s.eye[2]=o):se(s.eye,n,g/m),s.tilt=0,jk(s.eye),R$(s,t);s.eye[1]=M/R;const D=c*c*v,k=d*o,L=h*k*s.eye[1],N=s.eye[1]*s.eye[1],q=1-N,X=Math.sqrt(q),G=b*N+D-2*L*X*T+q*x;return Math.abs(G)<1e-8?(se(s.eye,n,g/m),s.tilt=0,jk(s.eye),R$(s,t)):(s.eye[0]=(q*(g*n[0]-_*n[0])-k*X*(n[0]*s.eye[1]*h+n[2]*c))/G,s.eye[2]=(q*(g*n[2]-_*n[2])-k*X*(n[2]*s.eye[1]*h-n[0]*c))/G,se(s.eye,s.eye,g),jk(s.eye),R$(s,t))}function jk(t){const e=t[1];t[1]=-t[2],t[2]=e}function R$(t,e){const r=j2e(e,t.heading,t.tilt);return t.up=r.up,t}function aKe(t,e,r){const i=Re(e),s=Math.sqrt(r*r+i*i-2*r*i*Math.cos(Math.PI-t)),n=Hh(r/(s/Math.sin(t)));return al(t-n)}function lKe(t,e,r){const i=Ft(t),s=Re(e);return Hh(r/(s/Math.sin(i)))+i}function H2e(t,e,r,i,s){let n,o,a,l;const c=e.latitude,h=Vr(t.spatialReference).radius,d=e.longitude,f=_Ze(c,r,h)/2;n=d-f,o=d+f;const m=Ft(c),g=(1+Math.sin(m))/(1-Math.sin(m)),_=(g+1)*Math.tan(i/h/2),v=_*_;function b(x){const S=Math.PI/2;return(x=Y8e.normalize(x,-S))>S&&(x=Math.PI-x),x}if(a=1.5*Math.PI-2*Math.atan(.5*(_+Math.sqrt(4*g+v))),l=a+i/h,a=b(a),l=b(l),l<a){const x=l;l=a,a=x}if(a=Math.max(al(a),-90),l=Math.min(al(l),90),o=sKe.monotonic(n,o),o-n>180){const x=(o-n-180)/2;n+=x,o-=x}const T=t.spatialReference&&t.spatialReference.isGeographic?t.spatialReference:qe.WGS84;return s?(s.xmin=n,s.ymin=a,s.xmax=o,s.ymax=l,s.spatialReference=T):s=new cr(n,a,o,l,T),t.spatialReference&&t.spatialReference.isWebMercator&&OS(s,!1,s),s}const cKe=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:nKe,eyeForCenterWithHeadingTilt:oKe,eyeTiltToLookAtTilt:lKe,headingTiltToDirectionUp:j2e,lookAtTiltToEyeTilt:aKe,toExtent:H2e},Symbol.toStringTag,{value:"Module"}));function aF(t){return t.type==="point"}let BQ=class{constructor(e,r=null,i=0){this.array=e,this.spatialReference=r,this.offset=i}};function q2e(t){return"array"in t}function Wf(t,e,r="ground"){if(aF(e))return t.getElevation(e.x,e.y,e.z||0,e.spatialReference,r);if(q2e(e)){let i=e.offset;return t.getElevation(e.array[i++],e.array[i++],e.array[i]||0,e.spatialReference??t.spatialReference,r)}return t.getElevation(e[0],e[1],e[2]||0,t.spatialReference,r)}function ZH(t,e){return t!=null&&(e==null||(e===Ve.Local?!t.isGeographic||t.isWGS84||t.wkid===$h.CGCS2000:t.isWebMercator||t.isWGS84||t.wkid===$h.CGCS2000||t.wkid===$h.GCSMARS2000||t.wkid===$h.GCSMARS2000_SPHERE||t.wkid===$h.GCSMOON2000))}const W2e=K.getLogger("esri.views.3d.support.cameraUtils"),X2e=39.37,Y2e=96,JH=1,uKe=8,hKe=5,Z2e=1,Foe=O(),dKe={heading:0,tilt:0},O_=new tt,pKe=new av(-20037508342788905e-9,20037508342788905e-9),fKe=new av(-180,180);var Yo;function kP(t){return t.spatialReference||qe.WGS84}function UC(t){return t.viewingMode==="global"?cKe:iKe}function mKe(t,e,r,i,s){return UC(t).headingTiltToDirectionUp(e,r,i,s)}function $g(t,e){if(e==null)return null;const r=t.renderSpatialReference,i=UC(t).headingTiltToDirectionUp,s=O();if(!Ao(e.position,s,r))return null;const n=i(s,e.heading,e.tilt);se(n.direction,n.direction,t.state.camera.distance),de(n.direction,n.direction,s);const o=Lx(t,s,n.direction,n.up);return o.fov=Ft(e.fov),o}(function(t){t[t.LOCKED=0]="LOCKED",t[t.ADJUST=1]="ADJUST"})(Yo||(Yo={}));const cT=O();function GE(t,e,r){const i=t.renderSpatialReference,s=o9(t,e.eye,e.viewForward,e.up,dKe);let n=kP(t);return Qs(e.eye,i,cT,n)||(n=qe.WGS84,Qs(e.eye,i,cT,n)),r==null?new qh(new tt(cT,n),s.heading,s.tilt,al(e.fov)):(r.position.x=cT[0],r.position.y=cT[1],r.position.z=cT[2],r.position.spatialReference=n,r.heading=s.heading,r.tilt=s.tilt,r.fov=al(e.fov),r)}function GQ(t,e,r){const i=t.state.camera,s=i.width/2/i.pixelRatio;return t.renderCoordsHelper.viewingMode===Ve.Global&&r!=null&&(e*=Math.cos(Ft(r))),e/=t.renderCoordsHelper.unitInMeters,s/(Y2e*X2e/e)/Math.tan(i.fovX/2)}function Jw(t,e,r){const i=t.state.camera,s=e*Math.tan(i.fovX/2),n=i.width/2/i.pixelRatio;let o=Y2e*X2e/(n/s);return t.renderCoordsHelper.viewingMode===Ve.Global&&r!=null&&(o/=Math.cos(Ft(r))),o*t.renderCoordsHelper.unitInMeters}function J2e(t,e,r,i,s,n){return Q2e(t,e,GQ(t,r,e.latitude),i,s,n)}function Q2e(t,e,r,i,s,n){if(bw(n)){const a=new kC(n.signal);return IM(t,i.heading,i.tilt,e,r,s,a),void a.resolver.promise.then(l=>{const c=cF(t,l,i.fov);if(c!=null)return n.resolver.resolve(c);n.resolver.reject()},l=>n.resolver.reject(l))}const o=IM(t,i.heading,i.tilt,e,r,s);return cF(t,o,i.fov,n)}function o9(t,e,r,i,s){return UC(t).directionToHeadingTilt(e,r,i,s)}function gKe(t,e){return!!(t.basemapTerrain&&t.renderCoordsHelper.fromRenderCoords(e,O_,t.spatialReference)&&t.elevationProvider&&(Wf(t.elevationProvider,O_)??0)>(O_.z??0)-Z2e)}async function yKe(t,e,r){if(!t.renderCoordsHelper.fromRenderCoords(e,O_,t.spatialReference)||!t.elevationProvider)return!1;const i=O_.z??0;return(await t.elevationProvider.queryElevation(O_.x,O_.y,i,O_.spatialReference,"ground",r)??0)>i-Z2e}async function _Ke(t,e,r){const i=O();if(e)if(e instanceof tt){if(Ao(e,i,t.renderSpatialReference),e.z==null&&t.basemapTerrain!=null&&t.elevationProvider!=null){const s=await t.elevationProvider.queryElevation(e.x,e.y,e.z??0,e.spatialReference,"ground",r);return s!=null&&t.renderCoordsHelper.setAltitude(i,s),i}}else ie(i,e);else ie(i,t.state.camera.center);return i}function vKe(t,e){const r=O();if(e&&e instanceof tt){if(Ao(e,r,t.renderSpatialReference),e.z==null&&t.basemapTerrain!=null&&t.elevationProvider!=null){const i=Wf(t.elevationProvider,e);i!=null&&t.renderCoordsHelper.setAltitude(r,i)}}else ie(r,e||t.state.camera.center);return r}function IM(t,e,r,i,s,n,o){const a=i&&i instanceof tt?i:null;if(bw(o))return _Ke(t,i,o.signal).then(c=>{QH(t,e,r,a,c,s,n,o)},c=>o.resolver.reject(c)),null;const l=vKe(t,i);return QH(t,e,r,a,l,s,n,o)}function QH(t,e,r,i,s,n,o,a){if(i==null){const d=t.renderSpatialReference;if((i=b0(s,d,kP(t)))==null)return null}n=Math.max(n,t.state.constraints.minimumPoiDistance);const l=xKe(t,e,r,s,n,o),c=(0,UC(t).eyeForCenterWithHeadingTilt)(s,n,l.heading,l.tilt);if(o===Yo.ADJUST&&t.viewingMode==="global"&&r>0){const d=()=>{const m=K2e(t,s,n,SKe(t,n,r,s));return o=r-m<1?Yo.LOCKED:Yo.ADJUST,QH(t,e,m,i,s,n,o,a)},f=t.map.ground.navigationConstraint;if(!f||f.type==="stay-above"){if(gKe(t,c.eye))return d();if(bw(a))return yKe(t,c.eye,a.signal).then(m=>m?d():(a.resolver.resolve({eye:c.eye,up:c.up,center:ks(s),heading:c.heading,tilt:c.tilt}),null)),null}}const h=!a||bw(a)?{center:O(),eye:O(),up:O(),tilt:0,heading:0}:a;return h.eye=c.eye,h.up=c.up,h.center=ks(s),h.heading=c.heading,h.tilt=c.tilt,bw(a)&&a.resolver.resolve(h),h}function xR(t,e,r,i,s,n=null){let o,a,l;if(t.state.isGlobal){if(!ZH(e.spatialReference,Ve.Global))return bw(n)&&n.resolver.reject(),null;const v=new tt(e.xmin,e.ymin,e.spatialReference),b=new tt(e.xmax,e.ymax,e.spatialReference),T=e.spatialReference.isGeographic?fKe:pKe;o=new tt({x:T.center(v.x,b.x),y:(b.y+v.y)/2,z:e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0,spatialReference:e.spatialReference});const x=Vr(e.spatialReference),S=yZe(o,v,b);a=S.lon,l=S.lat,T.diff(v.x,b.x)>T.range/2&&(a+=x.halfCircumference),a=Math.min(a,x.halfCircumference),l=Math.min(l,x.halfCircumference)}else{const v=t.renderSpatialReference??e.spatialReference;v.equals(e.spatialReference)||(e=Ox(e,v)),a=e.xmax-e.xmin,l=e.ymax-e.ymin;const b=e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0;o=new tt({x:e.xmin+.5*a,y:e.ymin+.5*l,z:b,spatialReference:v})}const c=e.zmax!=null&&e.zmin!=null?e.zmax-e.zmin:0,h=t.state.camera,d=1/Math.tan(h.fovX/2),f=1/Math.tan(h.fovY/2),m=1/Math.tan(h.fov/2),g=Math.max(.5*a*d,.5*l*f,.5*c*m)/JH;if(bw(n)){const v=new kC(n.signal);return IM(t,r,i,o,g,s,v),void v.resolver.promise.then(b=>{const T=cF(t,b,t.camera.fov);if(T!=null)return n.resolver.resolve(T);n.resolver.reject()},b=>n.resolver.reject(b))}const _=IM(t,r,i,o,g,s);return cF(t,_,t.camera.fov,n)}function bKe(t,e,r){const i=t.renderSpatialReference,s=b0(r,i,kP(t));if(s==null)return null;const n=Math.tan(e.fovX/2),o=Math.tan(e.fovY/2),a=mP(e.eye,r),l=2*a*n*JH,c=2*a*o*JH;return t.viewingMode==="global"?H2e(t,s,l,c):V2e(t,s,l,c)}function wKe(t,e,r){const i=t.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(r/i)/Math.LN2>uKe)return!0;const s=t.renderSpatialReference,n=kP(t),o=b0(e,s,n),a=b0(t.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s,n);if(o==null||a==null)return!1;const l=Math.tan(.5*t.state.camera.fov)*i;return a.distance(o)/l>hKe}function xKe(t,e,r,i,s,n){let o=0;return n===Yo.ADJUST&&wKe(t,i,s)?(e=0,o=TKe(t,s,r,i)):o=jQ(t,i,s,r),o=t.state.constraints.clampTilt(s,o),{heading:e,tilt:r=K2e(t,i,s,o)}}const lF=.7;function TKe(t,e,r,i){const s=jQ(t,i,e,r);if(!t.state.constraints.tilt)return s;const n=t.state.constraints.tilt(e);n.max=Math.min(n.max,.5*Math.PI);const o=n.min*(1-lF)+n.max*lF;return Math.min(s,o)}function SKe(t,e,r,i){let s=jQ(t,i,e,r);if(!t.state.constraints.tilt)return s;const n=t.state.constraints.tilt(e);return s=Math.min(s,.5*Math.PI),n.min*(1-lF)+s*lF}function K2e(t,e,r,i){return UC(t).lookAtTiltToEyeTilt(i,e,r)}function jQ(t,e,r,i){return UC(t).eyeTiltToLookAtTilt(i,e,r)}function cF(t,e,r,i){if(e==null)return null;const s=t.renderSpatialReference,n=b0(e.eye,s,kP(t));return n==null?null:i!=null?(i.position=n,i.heading=e.heading,i.tilt=e.tilt,i.fov=r,i):new qh(n,e.heading,e.tilt,r)}function EKe(t,e){const r=t.basemapTerrain?.tilingScheme;if(r)return r.levelAtScale(e);W2e.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function eSe(t,e){const r=t.basemapTerrain?.tilingScheme;if(r)return r.scaleAtLevel(e);W2e.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function tSe(t,e){return Qs(e.center,t.renderSpatialReference,Foe,qe.WGS84),Jw(t,e.distance,Foe[1])}let kC=class{constructor(e){this.signal=e,this.resolver=Eo()}};function bw(t){return t&&"resolver"in t}const CKe=.66;function rSe(t){return 360-FZ.normalize(t)}function a9(t){return FZ.normalize(360-t)}function w3(t){return t!=null&&t.resolver&&t.resolver.reject(),null}function AKe(t,e){return t!=null&&t.resolver&&t.resolver.resolve(e),e}function iSe(t,e,r,i=null){if(!e)return w3(i);const s=t.spatialReference||qe.WGS84;if(e.camera!=null){const c=bx(e.camera.position,s);if(c==null)return w3(i);const h=e.camera.clone();return h.position=c.clone(),AKe(i,h)}if(e.targetGeometry==null)return w3(i);const n=e.get("targetGeometry.spatialReference");if(n&&!Z_(n,s))return w3(i);const o=GE(t,t.state.camera);let a=Yo.ADJUST;if(e.rotation!=null&&(o.heading=rSe(e.rotation),a=Yo.LOCKED),r!=null&&(o.tilt=r),e.targetGeometry.type==="point"){const c=e.targetGeometry;let h;const d=e.targetGeometry.clone();return h=e.scale!=null?GQ(t,e.scale,c.latitude):t.state.camera.distance,Q2e(t,d,h,o,a,i)}const l=e.targetGeometry.extent;return l?xR(t,l,o.heading,o.tilt,a,i):w3(i)}function OKe(t,e,r=null){return r==null&&(r=new Mp),WQ(t,null,e.clone(),r)}async function RKe(t,e,r){const i=kKe(t,e);if(!i)throw new U("viewpointutils-create:no-target","Missing target for creating viewpoint");const s=new qh({fov:t.camera.fov}),n=new Mp({camera:s});if(i.target instanceof Mp)return o1(await IKe(t,i.target,i,r,n));if(i.target instanceof qh)return o1(nSe(t,i.target,n));const o=i.scale!=null||i.zoom!=null;if(i.target instanceof cr){const c=i.target.xmin===i.target.xmax||i.target.ymin===i.target.ymax;return o1(o||c?await KH(t,i,i.target.center,s,r,n):await NKe(t,i,i.target,s,r,n))}const a={boundingBox:Ei(),hasZ:!1,screenSpaceObjects:[]},l=o?MKe(t,i):void 0;if(await sSe(t,i.target,l,a),isFinite(a.boundingBox[0])){let c;if(hp(a.boundingBox,$s),cu.x=$s[0],cu.y=$s[1],cu.z=$s[2],cu.spatialReference=t.spatialReference,isFinite(cu.z)&&a.hasZ?c=sJ(a.boundingBox):(cu.z=void 0,c=I8e(iJ(a.boundingBox,VKe))),o||c)return o1(await KH(t,i,cu,s,r,n));const h=zKe(t,a.screenSpaceObjects);return o1(await UKe(t,i,cu,a.boundingBox,h,s,r,n))}return i.position?o1(LKe(t,i,s,n)):o1(await DKe(t,i,s,r,n))}function HQ(t,e){return e.scale==null&&e.zoom!=null?eSe(t,e.zoom):e.scale}function MKe(t,e){const r=HQ(t,e);return r?GBe(r):void 0}function qQ(t,e){let r=!1;return e.heading!=null?(t.heading=e.heading,r=!0):e.rotation!=null&&(t.heading=rSe(e.rotation),r=!0),e.tilt!=null&&(t.tilt=e.tilt,r=!0),e.fov!=null&&(t.fov=e.fov),r}function WQ(t,e,r,i){const s=t.spatialReference||qe.WGS84;return(e=e??$g(t,r))==null||(i.targetGeometry=b0(e.center,t.renderSpatialReference,s),i.scale=tSe(t,e),i.rotation=a9(r.heading),i.camera=r),i}function uF(t,e,r){const i=()=>new U("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!e)throw i();if(!Z_(e.spatialReference,t.spatialReference))throw new U("viewpointutils:incompatible-spatialreference",`Spatial reference (${e.spatialReference?e.spatialReference.wkid:"unknown"}) is incompatible with the view (${t.spatialReference?.wkid})`,{geometry:e});const s=[];if(!e.hasZ&&t.basemapTerrain){let a;switch(e.type){case"point":a=e;break;case"multipoint":case"polyline":a=e.extent?.center;break;case"mesh":a=e.origin;break;case"extent":a=e.center;break;case"polygon":a=e.centroid}a&&t.basemapTerrain.spatialReference!=null&&Z_(a,t.basemapTerrain.spatialReference)&&t.elevationProvider?$s[2]=Wf(t.elevationProvider,a)??0:$s[2]=0}(0,BKe[e.type])(e,a=>{s.push(a[0],a[1],a[2])},$s);const n=s.length/3;if(n===0)throw i();const o=new Array(s.length);if(ci(s,e.spatialReference,0,o,t.spatialReference,0,n)){e.hasZ&&(r.hasZ=!0);for(let a=0;a<o.length;a+=3)e.hasZ?($s[0]=o[a],$s[1]=o[a+1],$s[2]=o[a+2]):($s[0]=o[a],$s[1]=o[a+1]),mm(r.boundingBox,$s)}}async function PKe(t,e,r,i){const s=await $u(t.whenViewForGraphic(e));if(s.ok===!1||s.value==null||!("whenGraphicBounds"in s.value))return void uF(t,e.geometry,i);const n=s.value,o=await $u(n.whenGraphicBounds(e,{minDemResolution:r}));if(o.ok===!1)return void uF(t,e.geometry,i);const{screenSpaceObjects:a,boundingBox:l}=o.value;xE(i.boundingBox,l),a&&a.forEach(c=>{i.screenSpaceObjects.push(c)}),isFinite(l[2])&&(i.hasZ=!0)}async function sSe(t,e,r,i){if(Array.isArray(e)&&e.length===2){const s=e[0],n=e[1];if(typeof s=="number"&&typeof n=="number")return cu.x=s,cu.y=n,cu.z=void 0,cu.spatialReference=t.spatialReference?.isGeographic?t.spatialReference:qe.WGS84,void uF(t,cu,i)}e&&"map"in e&&typeof e.map=="function"?await Ac(e.map(s=>sSe(t,s,r,i))):e instanceof Av?uF(t,e,i):e instanceof Bl&&await PKe(t,e,r,i)}async function IKe(t,e,r,i,s){if(e.camera!=null)return nSe(t,e.camera,s);s.scale=e.scale,s.rotation=e.rotation,s.targetGeometry=e.targetGeometry!=null?e.targetGeometry.clone():null,s.camera=null,r.heading!=null?s.rotation=a9(r.heading):r.rotation!=null&&(s.rotation=r.rotation);const n=HQ(t,r);n!=null&&(s.scale=n);const o=new kC(i);return iSe(t,s,r.tilt,o),s.camera=await o.resolver.promise,s}function nSe(t,e,r){const i=t.spatialReference,s=bx(e.position,i);return s==null?null:((e=e.clone()).fov=t.camera.fov,e.position=s,WQ(t,null,e,r))}function $Ke(t,e,r,i,s,n){const o=t.renderSpatialReference;return Ao(r,P$,o),Ao(e,Hk,o),n.targetGeometry=new tt(e),s.position=new tt(r),fe(hF,Hk,P$),o9(t,P$,hF,i.up,s),n.scale=Jw(t,mi(P$,Hk),n.targetGeometry.latitude),n.rotation=a9(s.heading),n.camera=s,n}async function KH(t,e,r,i,s,n){if(r==null)throw new U("createfromcenter","invalid point");n.targetGeometry=r.clone();const o=Lx(t);if(e.position)return $Ke(t,n.targetGeometry,e.position,o,i,n);if(e.zoomFactor){const l=o.distance/e.zoomFactor,c=se($s,o.viewForward,-l);o.eye=de($s,o.center,c),n.scale=Jw(t,l,r.latitude)}GE(t,o,i);const a=qQ(i,e)?Yo.LOCKED:Yo.ADJUST;if(!e.zoomFactor){const l=HQ(t,e);l==null?(Ao(r,$s,t.renderSpatialReference),uTe(o.frustum,$s)?n.scale=Jw(t,mi(o.eye,$s),r.latitude):n.scale=tSe(t,o)):n.scale=l;const c=new kC(s);J2e(t,n.targetGeometry,n.scale,i,a,c),n.camera=await c.resolver.promise}return n}function LKe(t,e,r,i){const s=Lx(t);return ie(hF,s.viewForward),o9(t,s.eye,hF,s.up,qk),r.position=new tt(e.position),r.heading=e.heading!=null?e.heading:qk.heading,r.tilt=e.tilt!=null?e.tilt:qk.tilt,WQ(t,null,r,i)}async function DKe(t,e,r,i,s){const n=Lx(t);return KH(t,e,b0(n.center,t.renderSpatialReference,t.spatialReference),r,i,s)}async function NKe(t,e,r,i,s,n){n.targetGeometry=r.clone();const o=Lx(t);GE(t,o,i);const a=qQ(i,e)?Yo.LOCKED:Yo.ADJUST,l=new kC(s);return xR(t,r,i.heading,i.tilt,a,l),n.camera=await l.resolver.promise,n}function FKe(t,e,r,i,s){let n=0;r.z!=null?n=r.z:t.basemapTerrain&&t.elevationProvider&&(n=Wf(t.elevationProvider,r)),ne($s,r.x,r.y,n),Fl(t.spatialReference,$s,Uoe,t.renderSpatialReference),Jh(M$,Uoe),Qh(M$,M$),Ei(x3);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let g=0;g<o.length;g++){const _=o[g];let v=i[_[2]];isFinite(v)||(v=n),ne($s,i[_[0]],i[_[1]],v),Qs($s,t.spatialReference,$s,t.renderSpatialReference),mm(x3,Oc($s,$s,M$))}const a=Tx(x3),l=Mv(x3),c=Sx(x3),h=1/Math.tan(e.fovX/2),d=1/Math.tan(e.fovY/2),f=.5*Math.sqrt(a*a+c*c)*Math.max(d,h)+.5*l,m=.5*l*d+.5*Math.max(a,c);return Math.max(f,m)/s}async function UKe(t,e,r,i,s,n,o,a){a.targetGeometry=r.clone();const l=Lx(t),c=FKe(t,l,r,i,s);GE(t,l,n);const h=qQ(n,e)?Yo.LOCKED:Yo.ADJUST;a.scale=Jw(t,c,a.targetGeometry.latitude);const d=new kC(o);return J2e(t,a.targetGeometry,a.scale,n,h,d),a.camera=await d.resolver.promise,a}function kKe(t,e){if(!e||!t.spatialReference)return null;const r={target:void 0};return"declaredClass"in e||Array.isArray(e)?r.target=e:(Object.assign(r,e),e.center&&!r.target&&(r.target=e.center)),r}function o1(t){return t&&t.camera!=null&&(t.rotation=a9(t.camera.heading)),t}function zKe(t,e){const r=CKe;if(!e.length)return r;let i=Number.NEGATIVE_INFINITY;for(let s=0;s<e.length;s++){const n=e[s].screenSpaceBoundingRect;i=Math.max(i,Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2]),Math.abs(n[3]))}return r-i/Math.min(t.width,t.height)*2}const $s=O(),Uoe=xe(),M$=ki(),x3=gn(),VKe=zt(),hF=O(),P$=O(),Hk=O(),qk={heading:0,tilt:0},cu=new tt,BKe={point(t,e,r){r[0]=t.x,r[1]=t.y,t.z!=null&&(r[2]=t.z),e(r)},polygon(t,e,r){const i=t.hasZ;for(let s=0;s<t.rings.length;s++){const n=t.rings[s];for(let o=0;o<n.length;o++)r[0]=n[o][0],r[1]=n[o][1],i&&(r[2]=n[o][2]),e(r)}},polyline(t,e,r){const i=t.hasZ;for(let s=0;s<t.paths.length;s++){const n=t.paths[s];for(let o=0;o<n.length;o++)r[0]=n[o][0],r[1]=n[o][1],i&&(r[2]=n[o][2]),e(r)}},multipoint(t,e,r){const i=t.points,s=t.hasZ;for(let n=0;n<i.length;n++)r[0]=i[n][0],r[1]=i[n][1],s&&(r[2]=i[n][2]),e(r)},extent(t,e,r){t.zmin!=null&&t.zmax!=null?(e(ne(r,t.xmin,t.ymin,t.zmin)),e(ne(r,t.xmax,t.ymin,t.zmin)),e(ne(r,t.xmin,t.ymax,t.zmin)),e(ne(r,t.xmax,t.ymax,t.zmin)),e(ne(r,t.xmin,t.ymin,t.zmax)),e(ne(r,t.xmax,t.ymin,t.zmax)),e(ne(r,t.xmin,t.ymax,t.zmax)),e(ne(r,t.xmax,t.ymax,t.zmax))):(e(ne(r,t.xmin,t.ymin,r[2])),e(ne(r,t.xmax,t.ymin,r[2])),e(ne(r,t.xmin,t.ymax,r[2])),e(ne(r,t.xmax,t.ymax,r[2])))},mesh(t,e,r){const i=t.vertexAttributes&&t.vertexAttributes.position;if(i)for(let s=0;s<i.length;s+=3)e(ne(r,i[s],i[s+1],i[s+2]))}};let GKe=class{constructor(e,r,i){this.target=e,this.options=r,this.view=i,this.state="pending",this._animationController=null,this._promise=new Promise((s,n)=>{this._resolveCallback=s,this._rejectCallback=n;const o=new AbortController;this.options.signal!=null&&ya(this.options.signal,()=>{this.abort()}),this._abortController=o,this.waitForReady()})}then(e,r){return this._promise.then(e,r)}catch(e){return this._promise.catch(e)}resolve(e){if(this.state!=="finished")return this.state="finished",this._resolveCallback(e)}reject(e){if(this.state!=="finished")return this.state="finished",this._rejectCallback(e)}abort(e=!1){this._abortController.abort(),this.state==="wait-for-animation-finish"&&!e&&this._animationController!=null&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController(),this.reject(zr())}async waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await d0(()=>this.view.ready,this._abortController.signal)}catch(e){return this.reject(e)}this.createViewPoint()}createViewPoint(){this.state!=="finished"&&(this.state="wait-for-viewpoint",this._animationController=this.options.animate?this._getAnimationController():null,RKe(this.view,this.target,this._abortController.signal).then(e=>{if(this.state==="finished")return;const r=e?this._getCameraFromViewpoint(e):null;if(r!=null)if(this.options.animate){if(this._animationController==null)return;this.startAnimation(r,this._animationController)}else this.view.stateManager.setStateCamera(r.camera,{applyConstraints:!r.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()},e=>{this.reject(e)}))}_getCameraFromViewpoint(e){const r=!!(this.target instanceof Mp&&this.target.camera||this.target instanceof qh),i=e.camera;if(i==null)return null;if(!this.view.stateManager.isCompatible(i)){const n=i.position,o=n&&n.spatialReference,a=o?o.wkid:"none",l=this.view.spatialReference?.wkid;return this.reject(new U("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${a}, view: ${l})`,{camera:i})),null}const s=$g(this.view,i);return s==null?(this.reject(new U("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:e,camera:s,isFullySpecified:r}}startAnimation(e,r){this.state="wait-for-animation-finish";const i=r.viewAnimation;if(i==null)return void this.reject(new U("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(i.update(e.viewpoint,"running"),!r.active||r.viewAnimation==null||r.viewAnimation.target!==e.viewpoint||this.view.state.cameraController!==r)return this.abort();let s;e.isFullySpecified?(s=new wR({view:this.view,desiredCamera:e.camera}),NC(this.view,e.camera,kh.EYE_AND_CENTER)):Ns(this.view,e.camera),r.begin(e.camera,this.options);const n=()=>{const a=this.view.state.cameraController;s&&(a&&a.active?a instanceof Wg&&a.viewAnimation!=null&&a.viewAnimation.target===e.viewpoint&&(this.view.state.cameraController=s):r.viewAnimation!=null&&r.viewAnimation.target===e.viewpoint&&r.state==="finished"&&(this.view.state.cameraController=s))},o=a=>{if(this.view.state!=null)switch(r.state){case Zi.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case Zi.Ready:case Zi.Rejected:case Zi.Running:case Zi.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(a)}}};i.when(n,a=>o(a)),r.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let e=null,r=null;const i=this.view.state.cameraController;return i instanceof Wg&&(i.updateStateFromViewAnimation(),i.active&&(e=i,r=e.viewAnimation)),e!=null||(e=new Wg({view:this.view,mode:"animation"}),r=e.viewAnimation,this.view.state.switchCameraController(e))?e:(r?.stop(),this.reject(new U("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}},xn=class extends Te{get camera(){const e=this._get("camera");if(!this.ready)return e;const r=GE(this.view,this.view.state.camera,Wk);return r&&e&&r.equals(e)?e:r.clone()}set camera(e){this._updatePropertyBeforeReady("camera",e)||(this.view.elevationProvider?.enableElevationCache(!0),this.setStateCamera($g(this.view,e),{applyConstraints:!1})||K.getLogger(this).error("#camera=","Invalid camera",e),this.view.elevationProvider?.enableElevationCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const r=GE(this.view,this.view.state.contentCamera,Wk);return r&&e&&r.equals(e)?e:r.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const r=$g(this.view,e);r!=null?(this._updateElevation(r),this.view.state.contentCamera=r):this.view.state.contentCamera=null}installContentCameraReset(e){if(this.removeHandles(Xk),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const r=this.zoom,i=this.view.state.camera.distance**2,s=Qa(this.view.state.camera.center),n=e.sticky?this.contentCamera.clone():null;return this.addHandles([le(()=>this.contentCamera,()=>{e.sticky||(this.removeHandles(Xk),this.test.contentCameraResetState.clear())}),le(()=>this.zoom,o=>{o!==void 0&&r!==void 0&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(o-r)/2),Math.abs(o-r)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n))}),le(()=>this.view.state.camera,o=>{const a=xo(s,o.center);this.test.contentCameraResetState.set("camera.center",a/i),a>i?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n)})],Xk),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():K.getLogger(this).error("#center=","Invalid center",e):K.getLogger(this).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e):K.getLogger(this).error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,r=bKe(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return r??this._get("extent")}set extent(e){this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||K.getLogger(this).error("#extent=","Invalid extent",e):K.getLogger(this).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e):K.getLogger(this).error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get hasInitialView(){return!!this.view.get("map.initialViewProperties.viewpoint")}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return Jw(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||K.getLogger(this).error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,r=e.padding,i=e.pixelRatio,s=this._get("padding"),n=Math.round(r[er.TOP]/i),o=Math.round(r[er.RIGHT]/i),a=Math.round(r[er.BOTTOM]/i),l=Math.round(r[er.LEFT]/i);return s!=null&&s.top===n&&s.right===o&&s.bottom===a&&s.left===l?s:{top:n,right:o,bottom:a,left:l}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,I$),this.view.state.updateCamera(r=>r.padding=I$))}_paddingToArray(e,r,i){e?Ti(i,e.top||0,e.right||0,e.bottom||0,e.left||0):Ti(i,0,0,0,0);for(let s=0;s<4;s++)i[s]=Math.round(i[s]*r)}get screenCenter(){const e=this.padding;return Xh((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?OKe(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||K.getLogger(this).error("#viewpoint=","Invalid viewpoint",e);else{const r=e.camera!=null?e.camera.position:e.targetGeometry,i=r!=null&&r.spatialReference;K.getLogger(this).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(i?i.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e)}else K.getLogger(this).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?EKe(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||e===void 0||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||K.getLogger(this).error("#zoom=","Invalid zoom",e)}_computeCanvasSize(){if(this._devicePixelRatioOverride)return this.view.state.contentPixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*this._devicePixelRatioOverride),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*this._devicePixelRatioOverride),this._tmpCanvasSize.pixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize;const e=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio),r=this._usePhysicalPixelRendering?this._windowDevicePixelRatio:e;this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*r),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*r);const i=this.view._stage.renderView.renderingContext.parameters.maxTextureSize;return sw(this._tmpCanvasSize,i)?this._tmpCanvasSize.pixelRatio=r:this._tmpCanvasSize.pixelRatio=this._tmpCanvasSize.width>0?this._tmpCanvasSize.width/this.view.surface.clientWidth:r,this.view.state&&(this.view.state.contentPixelRatio=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)),this._tmpCanvasSize}get _rasterPixelRatio(){return this._devicePixelRatioOverride!=null?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){return this.view?._stage?.renderer.isFeatureEnabled(Js.PhysicalPixelRendering)??!1}get _usePhysicalPixelRenderingAny(){const e=this.view?._stage?.renderer;return e&&(e.isFeatureEnabled(Js.PhysicalPixelRendering,Ur.IDLE)||e.isFeatureEnabled(Js.PhysicalPixelRendering,Ur.INTERACTING)||e.isFeatureEnabled(Js.PhysicalPixelRendering,Ur.ANIMATING))}constructor(e){super(e),this.constraintsManager=null,this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._updatingIgnoreRenderState=!1,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:r=>this._devicePixelRatioOverride=r,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},set updatingIgnoreRenderState(r){this.viewStateManager._updatingIgnoreRenderState=r},get updatingIgnoreRenderState(){return this.viewStateManager._updatingIgnoreRenderState||this.renderState!=null}},this._propertiesPool=new x0({frustum:A_},this),this._cameraSetByUser=!1,this._gotoOperation=null,this._cameraChangeTime=0,this._tmpCanvasSize=new jKe}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([_a(()=>this.view.state.events,"before-camera-change",e=>e&&this._updateElevation(e)),le(()=>this.view.state?.camera,(e,r)=>this._cameraChangedHandler(e,r),Wr)]),Iu(()=>this.view.state?.camera,e=>this._updateElevation(e),{once:!0,sync:!0}),this.addHandles([dE({prepare:()=>this._prepareFrame()}),le(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0,this.removeHandles($$)}),_a(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit(),this._propertiesPool=Ne(this._propertiesPool)}init(){this.constraintsManager=new hO({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const r of e)this.set(r.name,r.value);if(!this._cameraSetByUser){const r=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent;r&&this.isCompatible(r)?this._setInitialView(r):this.view.state.viewingMode===Ve.Local&&this.addHandles(Iu(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles($$),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),$$)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles($$),this.constraintsManager=Ne(this.constraintsManager))}async goTo(e,r){const i={animate:!0,...r};return this._gotoOperation!=null&&this._gotoOperation.abort(i.animate),this._gotoOperation=new GKe(e,i,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation}debugSetCameraOnContent(){this.setStateCamera(Lx(this.view),{applyConstraints:!1})}step(e){const r=this.view.state,i=r?.cameraController;i&&(r.updateCamera(s=>i.stepController(e,s)),i.steppingFinished&&i.finishController())}_cancelGoToOperation(){this._gotoOperation!=null&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const e=new Set,r=[];for(const{propertyName:i,overrides:s}of qKe){const n=e.has(i),o=this._isOverridden(i);!n&&o&&r.push({name:i,value:this._get(i)}),this._clearOverride(i),(n||o)&&s.forEach(a=>e.add(a))}return r}_setInitialView(e){if(e==null||this._cameraSetByUser)return;if(e instanceof qh)return void this.setStateCamera($g(this.view,e),{applyConstraints:!1});if(e instanceof Mp){if(e.targetGeometry instanceof cr){const n=xR(this.view,e.targetGeometry,0,.5,Yo.LOCKED);return void(n!=null&&this.setStateCamera($g(this.view,n),{applyConstraints:!0}))}const i={applyConstraints:!e.camera},s=this._viewpointToCamera(e);return void this.setStateCamera(s,i)}const r=xR(this.view,e,0,.5,Yo.LOCKED);r!=null&&this.setStateCamera($g(this.view,r),{applyConstraints:!0})}_updatePropertyBeforeReady(e,r){return!this.ready&&(this._override(e,r),r&&HKe.includes(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return e!=null&&(e instanceof Mp?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof qh?this.isCompatible(e.position):e.spatialReference&&Z_(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=WKe){return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,r,i=cy){const{heading:s,tilt:n}=this._getPreservingHeadingTilt(),o=IM(this.view,s,n,e,r,Yo.ADJUST);return o==null?null:(i.copyFrom(this.view.state.camera),i.eye=o.eye,i.center=o.center,i.up=o.up,i)}_centerToCamera(e){const r=this.view.pointsOfInterest.centerOnContent;r.runTask();const i=r.distance;return this._centerPointAtDistanceToCamera(e,i)}_extentToCamera(e){const{heading:r,tilt:i}=this._getPreservingHeadingTilt(),s=xR(this.view,e,r,i,Yo.ADJUST,Wk);return s?$g(this.view,s):null}_scaleToCamera(e){if(e==null)return null;const r=this.view.pointsOfInterest.centerOnContent;r.runTask();const i=r.renderLocation,s=r.location.latitude;if(s==null)return null;const n=GQ(this.view,e,s);return this._centerPointAtDistanceToCamera(i,n)}_zoomToCamera(e){return this._scaleToCamera(eSe(this.view,e))}_viewpointToCamera(e){return $g(this.view,iSe(this.view,e))}setStateCamera(e,r){return!(e==null||!this.view.state.stopActiveCameraController())&&(this._cameraSetByUser=!0,r.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(i=>{r.positionAndOrientationOnly?(i.eye=e.eye,i.center=e.center,i.up=e.up):i.copyFrom(e),r.applyConstraints&&Ns(this.view,i)}),r.applyConstraints||(this.view.state.cameraController=new wR({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:r}=this.view;if(!e||!r)return;this._windowDevicePixelRatio=window.devicePixelRatio;const i=this._computeCanvasSize();if(i.width!==0&&i.height!==0&&(r.width===i.width&&r.height===i.height||(r.width=i.width,r.height=i.height),this.view.state)){const s=this.view.state.camera;s.fullWidth===i.width&&s.fullHeight===i.height&&s.pixelRatio===i.pixelRatio||(cy.copyFrom(s),cy.pixelRatio!==i.pixelRatio&&(this._paddingToArray(this.padding,i.pixelRatio,I$),cy.padding=I$),cy.fullWidth=i.width,cy.fullHeight=i.height,cy.pixelRatio=i.pixelRatio,this.view.state.camera=cy),this._updateViewState()}}_updateElevation(e){const r=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,i=this.view.renderCoordsHelper?.getAltitude(e.eye)??0,s=r?t9(this.view,e.eye):0;e.relativeElevation=i-s}_updateViewState(){this.test.renderState!=null?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=Ur.ANIMATING:this.view.interacting?this.view.state.mode=Ur.INTERACTING:(this.view.state.mode===Ur.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<=XKe?this.view.state.mode=Ur.INTERACTING:this.view.state.mode=Ur.IDLE),this.view.state.rasterPixelRatio=this._rasterPixelRatio}_cameraChangedHandler(e,r){e&&r&&e.almostEquals(r)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};u([p({type:qh,dependsOn:["view.state.camera","ready"]})],xn.prototype,"camera",null),u([p({type:qh,dependsOn:["view.state.contentCamera","ready"]})],xn.prototype,"contentCamera",null),u([p({type:tt})],xn.prototype,"center",null),u([p({type:cr})],xn.prototype,"extent",null),u([p({readOnly:!0})],xn.prototype,"frustum",null),u([p({readOnly:!0})],xn.prototype,"hasInitialView",null),u([p({readOnly:!0,type:Boolean})],xn.prototype,"ready",void 0),u([p({type:Number})],xn.prototype,"scale",null),u([p()],xn.prototype,"padding",null),u([p({readOnly:!0})],xn.prototype,"screenCenter",null),u([p({constructOnly:!0})],xn.prototype,"view",void 0),u([p({type:Mp})],xn.prototype,"viewpoint",null),u([p({type:Number})],xn.prototype,"zoom",null),u([p({readOnly:!0})],xn.prototype,"_rasterPixelRatio",null),u([p({readOnly:!0})],xn.prototype,"_usePhysicalPixelRendering",null),u([p({readOnly:!0})],xn.prototype,"_usePhysicalPixelRenderingAny",null),u([p()],xn.prototype,"_windowDevicePixelRatio",void 0),u([p()],xn.prototype,"_devicePixelRatioOverride",void 0),xn=u([P("esri.views.3d.state.ViewStateManager")],xn);let jKe=class{constructor(){this.width=0,this.height=0,this.pixelRatio=1}};const HKe=["camera","viewpoint","extent","scale","center","zoom"],qKe=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],WKe={heading:0,tilt:0},Wk=new qh,cy=new yt,I$=Wt(),$$="pending-initial-view",Xk="content-camera-reset",XKe=300,koe=100;let Xf=class extends Ug{constructor(){super(...arguments),this.startCamera=new yt,this.currentCamera=new yt,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<koe}stepController(e,r){r.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(r)}onControllerStart(e){this.state=Zi.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout(()=>this.notifyChange("isInteractive"),koe),this.view.state.updateCamera(e=>this.stepController(0,e)),this.steppingFinished&&this.finishController()}};u([p({readOnly:!0})],Xf.prototype,"isInteractive",null),u([p()],Xf.prototype,"_lastInteraction",void 0),Xf=u([P("esri.views.3d.state.controllers.InteractiveController")],Xf);var yc;(function(t){t[t.CENTER=0]="CENTER",t[t.EYE=1]="EYE"})(yc||(yc={}));let TR=class extends Xf{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.pivot=yc.CENTER,this._rotScale=0,this._lastPoint=He(),this._tmpWorldUp=O(),this._tmpViewDir=O(),this._tmpRotCurPoint=He(),this._tmpTransf=xe(),this._tmpAxis=O(),this._tmpPivotPoint=O(),this._pivotPos=O(),this._constraintOptions={selection:Mi.ALL,interactionType:Xt.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:ro.TUMBLE}}initialize(){this._rotScale=this.pivot===yc.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case yc.EYE:ie(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=Xt.LOOK_AROUND,this._constraintOptions.tiltMode=ro.LOOK_AROUND,this._constraintOptions.selection=Mi.NONE;break;case yc.CENTER:{const r=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,this.view.map.ground.opacity===0?Dx:{});r||ie(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,r),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=Xt.TUMBLE,this._constraintOptions.tiltMode=ro.TUMBLE,this._constraintOptions.selection=Mi.ALL&~Mi.DISTANCE;break}}this._constraintOptions.interactionStartCamera=this.startCamera,vw(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,r){const i=this.startCamera,s=O();fe(s,this._pivotPos,i.eye);const n=Re(s),o=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(i.eye,zoe);let a=Math.max(Math.min(RQe,1/Math.abs(ye(zoe,i.viewForward)))*o,MQe);r&&(a=Math.min(n,a));const l=Vr(this.view.spatialReference),c=Qi(i.width/i.pixelRatio*.5,i.height/i.pixelRatio*.5),h=n9(this.startCamera,c,l);let d=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,i.fullWidth/i.pixelRatio*.5,i.fullHeight/i.pixelRatio*.5,i,2.5*kk,kk),f=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],i,kk);d==null&&f==null||(d=d??f??0,f=f==null||h===to.Horizontal?d:f,a=d>f?f:d,a=r?Math.min(a,n):a),_e(s,s),ie(this._pivotPos,de(this._tmpPivotPoint,i.eye,se(this._tmpPivotPoint,s,a)))}update(e){if(this.active){switch(this.pivot){case yc.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case yc.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}Ns(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.active&&this.finishController()}_applyRotation(e,r,i,s){this.view.renderCoordsHelper.worldUpAtPosition(s,this._tmpWorldUp),vw(e,r,this._tmpRotCurPoint);let n=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,o=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;fe(this._tmpViewDir,i,s);const a=Re(this._tmpViewDir),l=Dn(ye(this._tmpViewDir,this._tmpWorldUp)/a);if(this.pivot===yc.EYE){n*=-.5;const c=.5*Math.PI-l,h=.5*Math.PI*.99;n=c-Math.max(-h,Math.min(h,c+n))}return n=ve(n+l,ko.min,ko.max)-l,pt(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===yc.CENTER&&(o=-o),Lu(this._tmpTransf,o,this._tmpWorldUp),Rc(this._tmpTransf,this._tmpTransf,n,this._tmpAxis),ze(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=ze(Yk,e.up,this._tmpTransf),de(Yk,s,this._tmpViewDir),yn(this._lastPoint,this._tmpRotCurPoint),Yk}};u([p()],TR.prototype,"pivot",void 0),TR=u([P("esri.views.3d.state.controllers.RotateController")],TR);const Yk=O(),zoe=O();let Zk=class extends Ro{constructor(e,r,i,s){super(!0),this._view=e,this.pointerAction=r,this._pivot=i,this.registerIncoming("drag",s,n=>this._handleDrag(n))}_handleDrag(e){const r=e.data;if(r.pointers.size>1||!zQ(e.data,this.pointerAction))return;const i=Qi(r.center.x,r.center.y);switch(r.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new TR({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController&&this._cameraController.update(i);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}},eq=class extends Xf{constructor(){super(...arguments),this._pickPoint=O(),this._tmpP0=He(),this._panAxisAngle=i9(),this._tmpRayDir=O(),this._tmpRayDirPick=O(),this._targetOnSphere=O(),this._navMode=to.Horizontal,this._tmpRay={origin:O(),direction:O()},this.dragBeginPoint=Qi(),this._normalizedAnchorPoint=He(),this._constraintOptions={selection:Mi.ALL_EXCEPT_COLLISION,interactionType:Xt.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:ro.TUMBLE},this._sphere=xs(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;yn(this.dragBeginPoint,e),vw(this.startCamera,e,this._normalizedAnchorPoint);const r=Vr(this.view.spatialReference),i=O2e(this._intersectionHelper,this.startCamera,e,r,BE.Ellipsoid,this.view.map.ground.opacity===0?Dx:{});if(this._navMode=n9(this.startCamera,e,r),this._navMode===to.Horizontal)this._hasPickPoint=!!i.scenePickPoint,this._pickPoint=i.scenePickPoint??this._pickPoint,this._sphere=i.sphere;else{let s;FC(this.startCamera,e,this._tmpRay),_e(this._tmpRay.direction,this._tmpRay.direction),i.scenePickPoint!=null&&(fe(this._tmpRayDirPick,this.startCamera.eye,i.scenePickPoint),s=Re(this._tmpRayDirPick));const n=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,Voe);let o=ve(Math.min(b2e,1/Math.abs(ye(Voe,this._tmpRay.direction)))*n,tF[0],tF[1]);const a=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,s9);o=a??o,o=s!=null?Math.min(o,s):o,this._hasPickPoint=!0,se(this._tmpRay.direction,this._tmpRay.direction,o),de(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===to.Horizontal){fe(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const r=Re(this._tmpRayDir);vw(this.currentCamera,e,this._tmpP0);const i=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let s=r*2**i;const n=this.view.state.constraints.minimumPoiDistance;if(i<0&&s<n&&(s=n),Math.abs(r-s)<1e-6)return;if(this._hasPickPoint&&s<r){const o=1-(1-s/r)*(1-this._sphere[3]/Re(this.currentCamera.center));this.currentCamera.center=se(L$,this.currentCamera.center,o)}se(this._tmpRayDir,this._tmpRayDir,-s/r),this.currentCamera.eye=de(L$,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=sp(Hw(this.dragBeginPoint,e)),Ns(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(PM(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),LQ(this._pickPoint,this._targetOnSphere,this._panAxisAngle),wv(this.currentCamera,this._sphere,this._panAxisAngle))}else{const r=Re(this._tmpRay.direction);vw(this.currentCamera,e,this._tmpP0);const i=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let s=r*2**i;const n=this.view.state.constraints.minimumPoiDistance;if(i<0&&s<n&&(s=n),Math.abs(r-s)<1e-6)return;se(this._tmpRayDir,this._tmpRay.direction,1-s/r),this.currentCamera.eye=de(L$,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=de(L$,this.currentCamera.center,this._tmpRayDir)}NC(this.view,this.currentCamera),this.commitCamera()}}end(){this.active&&this.finishController()}};eq=u([P("esri.views.3d.state.controllers.global.ZoomController")],eq);const L$=O(),Voe=O();let tq=class extends Xf{constructor(){super(...arguments),this._tmpP=O(),this._tmpDir=O(),this._tmpN=O(),this._tmpP0=He(),this._tmpPoi=O(),this._tmpRayDir=O(),this.dragBeginPoint=Qi(),this._normalizedAnchorPoint=He(),this._constraintOptions={selection:Mi.ALL,interactionType:Xt.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:O(),tiltMode:ro.TUMBLE},this._plane=Fr()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;yn(this.dragBeginPoint,e),vw(this.startCamera,e,this._normalizedAnchorPoint);const r=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,this.view.map.ground.opacity===0?Dx:{});fe(this._tmpDir,this._tmpP,this.startCamera.eye);const i=Re(this._tmpDir);_e(this._tmpDir,this._tmpDir);const s=Math.abs(this.view.camera.position.z);let n=ve(Math.min(b2e,1/Math.abs(ye(YKe,this._tmpDir)))*s,tF[0],tF[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],this.view.state.camera,s9);n=o??n,n=r?Math.min(n,i):n,se(this._tmpDir,this._tmpDir,n),de(this._tmpP,this.startCamera.eye,this._tmpDir),fe(this._tmpN,this.startCamera.eye,this.startCamera.center),_e(this._tmpN,this._tmpN),this._tmpN[1]<0&&va(this._tmpN,this._tmpN),RP(this._tmpP,this._tmpN,this._plane),this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(!this.active)return;PQe(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||ie(this._tmpPoi,this.currentCamera.center),vw(this.currentCamera,e,this._tmpP0);let r=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);yn(this._normalizedAnchorPoint,this._tmpP0),fe(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const i=Re(this._tmpRayDir);let s=i*(1-r);this._constraintOptions.interactionDirection&&(ie(this._constraintOptions.interactionDirection,this._tmpRayDir),se(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(r)/i));const n=this.view.state.constraints.minimumPoiDistance;r>=0&&s<n&&(s=n,r=-(s-i)/i),Math.abs(i-s)<1e-6||(se(this._tmpRayDir,this._tmpRayDir,r),this.currentCamera.eye=de(a1,this.currentCamera.eye,this._tmpRayDir),qr(a1,this.currentCamera.center,this._tmpPoi,r),this._tmpPoi[2]>this.startCamera.center[2]?a1[2]=Math.max(this.startCamera.center[2],a1[2]):a1[2]=Math.min(this.startCamera.center[2],a1[2]),this.currentCamera.center=a1,this._constraintOptions.interactionFactor=sp(Hw(this.dragBeginPoint,e)),Ns(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}end(){this.active&&this.finishController()}};tq=u([P("esri.views.3d.state.controllers.local.ZoomController")],tq);const a1=O(),YKe=Pe(0,0,1);let ZKe=class extends Ro{constructor(e,r,i){super(!0),this._view=e,this.pointerAction=r,this.registerIncoming("drag",i,s=>this._handleDrag(s))}_handleDrag(e){const r=e.data;if(r.pointers.size>1||!zQ(e.data,this.pointerAction))return;const i=Qi(r.center.x,r.center.y);switch(r.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._view.state.isGlobal?this._cameraController=new eq({view:this._view}):this._cameraController=new tq({view:this._view}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController&&this._cameraController.update(i);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}};function fd(t){let e=t*t;return t<0&&(e*=-1),e}function Boe(t,e,r){const i=r,s=t.state,n=t.device,o=e.tiltDirection==="forward-down"?1:-1,a=1;return n.deviceType==="standard"?(i.translation[0]=fd(s.axes[0]),i.translation[1]=fd(s.axes[1]),i.translation[2]=fd(s.buttons[7])-fd(s.buttons[6]),i.heading=fd(s.axes[2]),i.tilt=fd(s.axes[3])):n.deviceType==="spacemouse"&&(i.translation[0]=1.2*fd(s.axes[0]),i.translation[1]=1.2*fd(s.axes[1]),i.translation[2]=2*-fd(s.axes[2]),i.heading=1.2*fd(s.axes[5]),i.tilt=1.2*fd(s.axes[3])),i.tilt*=o,se(i.translation,i.translation,a),i}function Goe(t,e){const r=e;return r.translation[0]=t[1]-t[0],r.translation[1]=t[3]-t[2],r.translation[2]=t[4]-t[5],r.heading=t[7]-t[6],r.tilt=t[8]-t[9],r.zoom=t[10]-t[11],r}function Jk(t){return t.translation[0]===0&&t.translation[1]===0&&t.translation[2]===0&&t.heading===0&&t.tilt===0&&t.zoom===0}let nw=class extends Xf{constructor(e){super(e),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new yt,this._headingStart=0,this._constraintOptions={selection:Mi.ALL,interactionType:Xt.NONE,interactionStartCamera:new yt,interactionFactor:0,interactionDirection:null,tiltMode:ro.LOOK_AROUND}}handleEventGamepad(e){const r=Boe(e,this.view.navigation.gamepad,this._transformation);(e.action==="end"||Jk(r))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,Goe(this._keysButtonState,this._transformation)}deactivateDirection(e){this._keysButtonState[e]=0;const r=Goe(this._keysButtonState,this._transformation);Jk(r)&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const r=this.view.pointsOfInterest.cameraOnSurface.location.z,i=1;this._filteredSurfaceElevation+=i*(r-this._filteredSurfaceElevation)*e}stepController(e,r){this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(r),this._updateCameraCenter(),this._constraintOptions.interactionStartCamera?.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,l1),this._applyDisabledMovementTypes(l1),this._applyPan(l1.pan),this._applyRotate(l1.rotate),this._applyZoom(l1.zoom),this._applyAscend(l1.ascend),this._constraintOptions.interactionType=Xt.NONE,this._constraintOptions.selection=Mi.COLLISION,Ns(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,r)}_updateStartHeading(){this._transformation.heading!==0&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const r=this.currentCamera;fe(dl,r.center,r.eye),ze(dl,dl,e.matrix),r.center=de(dl,dl,r.eye),r.up=ze(dl,r.up,e.matrix),this._constraintOptions.interactionType=Xt.LOOK_AROUND,this._constraintOptions.selection=Mi.ALL_EXCEPT_COLLISION,Ns(this.view,r,this._constraintOptions)}_applyPan(e,r=this.currentCamera){e.enabled&&(r.eye=ze(dl,r.eye,e.matrix),r.center=ze(dl,r.center,e.matrix),this.view.state.isGlobal&&(r.up=ze(dl,r.up,e.matrix)),this._constraintOptions.interactionType=Xt.PAN,this._constraintOptions.selection=Mi.ALL,Ns(this.view,r,this._constraintOptions))}_applyZoom(e){if(!e)return;const r=this.currentCamera.viewForward;this.currentCamera.eye=de(dl,this.currentCamera.eye,se(Ge.get(),r,e)),ie(T3,r),va(T3,T3),this._constraintOptions.interactionDirection=T3,this._constraintOptions.interactionType=Xt.ZOOM,this._constraintOptions.selection=Mi.ALL_EXCEPT_COLLISION,Ns(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const r=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,Ge.get());if(this._constraintOptions.interactionDirection=ie(T3,r),this.view.state.isGlobal){const i=Re(this.currentCamera.eye),s=(i+e)/i;this.currentCamera.eye=se(dl,this.currentCamera.eye,s),this.currentCamera.center=se(dl,this.currentCamera.center,s)}else{const i=se(Ge.get(),r,e);this.currentCamera.eye=de(dl,this.currentCamera.eye,i),this.currentCamera.center=de(dl,this.currentCamera.center,i)}this._updateCameraCenter(),this._constraintOptions.interactionType=Xt.ASCEND,this._constraintOptions.selection=Mi.COLLISION,Ns(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=Mi.ALL_EXCEPT_COLLISION,Ns(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,r,i){iet(i);const s=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(s,r,i):this._calculateControlTransformationGlobal(s,r,i)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,r=this.view.renderCoordsHelper,i=this.currentCamera.ray;this.currentCamera.center=r.intersectManifoldClosestSilhouette(i,e,dl)}_calculateControlTransformationLocal(e,r,i){const{viewRight:s,viewForward:n}=r,o=this._transformation,a=this.view.navigation.gamepad,l=ne(Ge.get(),n[0],n[1],0);_e(l,l);const c=o.translation[0]*e.pan;if(c!==0){const _=se(Ge.get(),s,c);Gl(i.pan.matrix,i.pan.matrix,_),i.pan.enabled=!0}switch(a.mode){case"pan":{const _=-o.translation[1]*e.pan;if(_!==0){const v=se(Ge.get(),l,_);Gl(i.pan.matrix,i.pan.matrix,v),i.pan.enabled=!0}i.zoom=o.zoom*e.zoom;break}case"zoom":i.zoom=(-o.translation[1]+o.zoom)*e.zoom;break;default:a.mode}const h=o.translation[2]*e.ascend;i.ascend=h;const d=-o.heading*e.rotate;d!==0&&(Rc(i.rotate.matrix,i.rotate.matrix,d,this.view.renderCoordsHelper.worldUpAtPosition(r.eye,Ge.get())),i.rotate.enabled=!0);const f=o.tilt*e.rotate,m=bv(this.view.renderCoordsHelper,r.center,r.eye),g=ve(m+f,ko.min,ko.max)-m;g&&(Rc(i.rotate.matrix,i.rotate.matrix,g,s),i.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,r,i){const{eye:s,viewRight:n}=r,o=this._transformation,a=this.view.navigation.gamepad,l=pt(Ge.get(),n,s);_e(l,l),va(l,l),FQe(this.startCamera,r,o,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,i,a),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(l1.pan,this._tmpCamera);const c=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,h=o.translation[2]*e.ascend;i.ascend=h;const d=-o.heading*e.rotate;d!==0&&(Rc(i.rotate.matrix,i.rotate.matrix,d,this._tmpCamera.eye),i.rotate.enabled=!0);const f=o.tilt*e.rotate,m=this._clampTiltDeltaGlobalToValidRange(f,r.ray,c);m!==0&&(Rc(i.rotate.matrix,i.rotate.matrix,m,this._tmpCamera.viewRight),i.rotate.enabled=!0),i.zoom+=o.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,r,i){const s=Vr(this.view.spatialReference),n=RN(ko.min,r.origin,i,s);let o=0,a=0;const l=Ge.get();if(this.view.renderCoordsHelper.intersectManifold(r,i,l)){const c=bv(this.view.renderCoordsHelper,l,r.origin);o=RN(c,r.origin,i,s),a=RN(ko.max,r.origin,i,s)}else{PC(E8(C8,i+s.radius),r,l);const c=Math.PI+S8(r.direction,l);o=Eoe(c,r.origin,i,s),a=Eoe(ko.max,r.origin,i,s)}return ve(o+e,n,a)-o}_getPointAbsoluteSurfaceElevation(e,r,i){const{renderCoordsHelper:s}=this.view,n=s.getAltitude(e),o=r+Math.abs(n-r);return s.setAltitude(i,o,e),o}_clampedDistanceToSurface(e,r){const{renderCoordsHelper:i}=this.view,{camera:s}=this.view.state,{direction:n}=mKe(this.view,r,0,oSe,ret),o=i.intersectManifoldClosestSilhouette(Du(r,n),e,Ge.get()),a=mi(r,o),l=i.intersectManifoldClosestSilhouette(Du(r,O0(Ge.get(),r,s.center)),e,Ge.get()),c=mi(r,l);return Math.min(a,c)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:r,state:i}=this.view,{camera:s,isGlobal:n}=i,o=r.intersectManifoldClosestSilhouette(s.ray,this._filteredSurfaceElevation,Ge.get());if(n){const a=fe(Ge.get(),e,o),l=Re(a);se(a,a,1/l);const c=_e(Ge.get(),e),h=Dn(ye(c,a));return l*Math.sin(Math.min(QKe,h))}{const a=ie(Ge.get(),e);return r.setAltitude(a,this._filteredSurfaceElevation),mi(o,a)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:KKe}_computeVelocities(e){const r=this._filteredSurfaceElevation,i=r+Vr(this.view.spatialReference).radius,{camera:s,isGlobal:n}=this.view.state,o=Ge.get(),a=this._getPointAbsoluteSurfaceElevation(s.eye,r,o),l=this._clampedDistanceToSurface(r,o),c=s.width/2,h=joe*s.width,d=joe*s.width,f=l*Math.tan(.5*s.fovX)/c,m=f/i,g=f/this._computeHeadingRotateRadius(o),_=a-r;return{pan:(n?m:f)*h*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(h*e/c)*_-_),zoom:2**(h*e/c)*l-l,rotate:ve(g*d,eet,tet)*e}}_applyDisabledMovementTypes(e){this.disableMovements==null||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&Yh(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&Yh(e.rotate.matrix))}static activatesFor(e,r){const i=Boe(r,e.navigation.gamepad,JKe);return!(r.action==="end"||Jk(i))}};u([p({constructOnly:!0})],nw.prototype,"gamepadDevice",void 0),u([p({constructOnly:!0})],nw.prototype,"disableMovements",void 0),nw=u([P("esri.views.3d.state.controllers.GamepadKeyboardController")],nw);const JKe={translation:[0,0,0],heading:0,tilt:0,zoom:0},oSe=80,QKe=Ft(oSe),joe=.75,KKe=5,eet=Ft(30),tet=Ft(80),l1={zoom:0,ascend:0,pan:{enabled:!1,matrix:xe()},rotate:{enabled:!1,matrix:xe()}},dl=O(),T3=O(),ret=VQ();function iet(t){t.zoom=0,t.ascend=0,t.pan.enabled=!1,Yh(t.pan.matrix),t.rotate.enabled=!1,Yh(t.rotate.matrix)}let set=class extends Ro{constructor(e){super(!0),this._view=e,this._watchHandles=new $i,this._handle=this.registerIncoming("gamepad",r=>this._handleEventGamepad(r)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([le(()=>this._view.navigation.gamepad.enabled,r=>{r?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},Pr),le(()=>this._view.navigation.gamepad.device,r=>{this._cameraControllerGamepad&&r&&this._cameraControllerGamepad.gamepadDevice!==r&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(e){const r=this._view.navigation.gamepad.device;if(r&&e.data.device!==r)return;const i=this._cameraControllerGamepad&&this._cameraControllerGamepad.active;if(i||nw.activatesFor(this._view,e.data)){if(!i){const s=new nw({view:this._view,gamepadDevice:e.data.device});this._view.state.switchCameraController(s)&&(this._cameraControllerGamepad=s)}this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===e.data.device&&this._cameraControllerGamepad.handleEventGamepad(e.data)}}};var uc;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.FORWARD=2]="FORWARD",t[t.BACKWARD=3]="BACKWARD",t[t.UP=4]="UP",t[t.DOWN=5]="DOWN",t[t.HEADINGLEFT=6]="HEADINGLEFT",t[t.HEADINGRIGHT=7]="HEADINGRIGHT",t[t.TILTUP=8]="TILTUP",t[t.TILTDOWN=9]="TILTDOWN",t[t.ZOOMIN=10]="ZOOMIN",t[t.ZOOMOUT=11]="ZOOMOUT"})(uc||(uc={}));let net=class extends Ro{constructor(e,r){super(!0),this._view=e,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:Ve.Local},this._keyToNumber={[r.left]:uc.LEFT,[r.right]:uc.RIGHT,[r.forward]:uc.FORWARD,[r.backward]:uc.BACKWARD,[r.up]:uc.UP,[r.down]:uc.DOWN,[r.headingLeft]:uc.HEADINGLEFT,[r.headingRight]:uc.HEADINGRIGHT,[r.tiltUp]:uc.TILTUP,[r.tiltDown]:uc.TILTDOWN,[r.zoomIn]:uc.ZOOMIN,[r.zoomOut]:uc.ZOOMOUT},this.registerIncoming("key-down",null,i=>this._handleKeyDown(i)),this.registerIncoming("key-up",null,i=>this._handleKeyUp(i)),this.registerIncoming("blur",null,()=>this._handleBlur())}_handleKeyDown(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const r=this._keyToNumber[e.data.key];r!=null&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new nw({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(r),e.stopPropagation()))}_handleBlur(){this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const r=this._keyToNumber[e.data.key];r!=null&&this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.deactivateDirection(r),e.stopPropagation())}},oet=class extends Ro{constructor(e,r){super(!0),this._view=e,this.registerIncoming("mouse-wheel",r,i=>this._handleMouseWheel(i))}_handleMouseWheel(e){if(!this._view.navigation.mouseWheelZoomEnabled)return;const r=e.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new nF({view:this._view,mode:"interaction"}):new oF({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._cameraController)),this._cameraController.zoomStep(-1/60*r.deltaY,Qi(r.x,r.y)),e.preventDefault(),e.stopPropagation()}},dF=class{constructor(e){this._gain=e}reset(e){this._value=e}set gain(e){this._gain=e}get value(){return this._value===void 0?0:this._value}update(e){this._value===void 0?this._value=e:this._value=this._gain*e+(1-this._gain)*this._value}},Qw=class extends RM{constructor(){super(...arguments),this._beginCamera=new yt,this._elapsedTimeSec=0,this.constraintOptions={selection:Mi.ALL,interactionType:Xt.PAN,interactionFactor:0,interactionStartCamera:new yt,interactionDirection:null,tiltMode:ro.TUMBLE}}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new DE}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(e){this._beginCamera.copyFrom(e),this.constraintOptions.interactionStartCamera=this._beginCamera,super.onControllerStart(e)}stepController(e,r){r.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=e,this.momentumStep(this._elapsedTimeSec,r),Ns(this.view,r,this.constraintOptions)}};Qw=u([P("esri.views.3d.state.controllers.momentum.MomentumController")],Qw);let SR=class extends Qw{constructor(e){super(e),this.interactionType=Xt.PAN,this._tmpPan=O()}momentumStep(e,r){const i=this.momentum.value(e);se(this._tmpPan,this.momentum.direction,i),r.eye=fe(Hoe,r.eye,this._tmpPan),r.center=fe(Hoe,r.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};u([p({constructOnly:!0})],SR.prototype,"momentum",void 0),SR=u([P("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],SR);const Hoe=O(),aet=O(),D$=O();let PN=class extends Qw{constructor(e){super(e),this.interactionType=Xt.PAN}momentumStep(e,r){const i=this.momentum.value1(e),s=this.momentum.value2(e);ie(D$,r.eye),_e(D$,D$),pt(this.momentum.axis2,D$,this.momentum.axis1),I2e(r,aet,this.momentum.axis1,i,this.momentum.axis2,s)}};u([p({constructOnly:!0})],PN.prototype,"momentum",void 0),PN=u([P("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],PN);let Gb=class extends Qw{set center(e){this._set("center",ks(e))}set axis(e){this._set("axis",ks(e))}constructor(e){super(e),this.interactionType=Xt.TUMBLE}momentumStep(e,r){const i=this.momentum.value(e);wv(r,this.center,MM(this.axis,i))}};u([p({constructOnly:!0})],Gb.prototype,"momentum",void 0),u([p({constructOnly:!0})],Gb.prototype,"center",null),u([p({constructOnly:!0})],Gb.prototype,"axis",null),Gb=u([P("esri.views.3d.state.controllers.momentum.MomentumController")],Gb);let mS=class extends Qw{set zoomCenter(e){this._set("zoomCenter",ks(e))}constructor(e){super(e),this.interactionType=Xt.ZOOM,this.constraintOptions.interactionDirection=O()}momentumStep(e,r){const{interactionDirection:i}=this.constraintOptions;if(!i)return;ie(i,r.eye);const s=this.momentum.valueDelta(0,e);FQ(r,this.zoomCenter,s,this.view.state.constraints.minimumPoiDistance),O0(i,r.eye,i)}};u([p({constructOnly:!0})],mS.prototype,"momentum",void 0),u([p({constructOnly:!0})],mS.prototype,"zoomCenter",null),mS=u([P("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],mS);let ab=class extends Qw{set screenCenter(e){this._set("screenCenter",Qi(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",ks(e))}constructor(e){super(e),this.interactionType=Xt.ZOOM,this.radius=0,this._tmpSceneCenter=O(),this._tmpZoomAxisAngle=i9(),this._sphere=xs()}initialize(){this._sphere[3]=this.radius}momentumStep(e,r){const i=this.momentum.valueDelta(0,e);C2e(this._sphere,r,i),this.constraintOptions.interactionType=Xt.ZOOM,Ns(this.view,r,this.constraintOptions),PM(this._sphere,r,this.screenCenter,this._tmpSceneCenter),LQ(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),wv(r,this._sphere,this._tmpZoomAxisAngle),this.constraintOptions.interactionType=Xt.PAN}};u([p({constructOnly:!0})],ab.prototype,"momentum",void 0),u([p({constructOnly:!0})],ab.prototype,"screenCenter",null),u([p({constructOnly:!0})],ab.prototype,"sceneCenter",null),u([p({constructOnly:!0})],ab.prototype,"radius",void 0),ab=u([P("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],ab);let np=class{constructor(e){this._gain=e,this.lastValue=void 0,this.filteredDelta=void 0}update(e){if(this.hasLastValue()){const r=this.computeDelta(e);this._updateDelta(r)}this.lastValue=e}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(e){return this.lastValue===void 0?NaN:e-this.lastValue}_updateDelta(e){this.filteredDelta!==void 0?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*e:this.filteredDelta=e}},l9=class{constructor(e,r,i){this._initialVelocity=e,this._stopVelocity=r,this._friction=i,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(e){return e>this.duration}get friction(){return this._friction}value(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}valueDelta(e,r){const i=this.value(e);return this.value(e+r)-i}valueFromInitialVelocity(e,r){r=Math.min(r,this.duration);const i=1-this.friction;return e*(i**r-1)/Math.log(i)}},cet=class extends l9{constructor(e,r,i,s,n){super(e,r,i),this._sceneVelocity=s,this.direction=n}value(e){return super.valueFromInitialVelocity(this._sceneVelocity,e)}},aSe=class{constructor(e=300,r=12,i=.84){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this.enabled=!0,this._time=new np(.6),this._screen=[new np(.4),new np(.4)],this._scene=[new np(.6),new np(.6),new np(.6)],this._tmpDirection=O()}add(e,r,i){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(i)<.015)return;this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._scene[0].update(r[0]),this._scene[1].update(r[1]),this._scene[2].update(r[2]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,r=this._screen[1].filteredDelta,i=e==null||r==null?0:Math.sqrt(e*e+r*r),s=this._time.filteredDelta,n=s==null||i==null?0:i/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,r,i){ne(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const s=Re(this._tmpDirection);s>0&&se(this._tmpDirection,this._tmpDirection,1/s);const n=this._time.filteredDelta;return new cet(e,r,i,n==null?0:s/n,this._tmpDirection)}},qoe=class{constructor(e){this._gain=e}update(e){this.filteredValue!==void 0?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*e:this.filteredValue=e}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}};const Woe=1e-5;let uet=class extends l9{constructor(e,r,i,s,n,o=0,a){super(e,r,i),this._angularVelocity1=s,this.axis1=n,this.angularVelocity2=o,this.axis2=a}value1(e){return super.valueFromInitialVelocity(this._angularVelocity1,e)}value2(e){return super.valueFromInitialVelocity(this.angularVelocity2,e)}},het=class{constructor(e=300,r=12,i=.84){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this.enabled=!0,this._tmpAxis1=O(),this._tmpAxis2=O(),this._tmpAngles=He(),this._time=new np(.3),this._screen=[new np(.4),new np(.4)],this._angle1=new qoe(.6),this._angle2=new qoe(.6),this._axis1=O(),this._axis2=O(),this._lastScene=O()}addMomentumDirectRotation(e,r,i,s,n,o){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(i)<.01)return;let a=M2e(this._lastScene,r,this._tmpAxis2,s,n,o);this._angle2.update(0),da(this._tmpAxis2)<Woe?a=0:_e(this._axis1,this._tmpAxis2),this._angle1.update(a),ie(this._lastScene,r)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(i)}}addMomentumPreserveHeading(e,r,i,s,n,o,a){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(i)<.01)return;P2e(this._lastScene,r,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,s,n,o,a,!1),da(this._tmpAxis2)<Woe?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),_e(this._axis1,this._tmpAxis1),_e(this._axis2,this._tmpAxis2)),ie(this._lastScene,r)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,r=this._screen[1].filteredDelta,i=e==null||r==null?null:Math.sqrt(e*e+r*r),s=this._time.filteredDelta,n=i==null||s==null?0:i/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,r,i){const s=this._time.filteredDelta,n=this._angle1.filteredValue,o=this._angle2.filteredValue,a=s==null||o==null?0:o/s;return new uet(e,r,i,s==null||n==null?0:n/s,this._axis1,a,this._axis2)}},lSe=class{constructor(e=2.5,r=.01,i=.95,s=12){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this._maxVelocity=s,this.enabled=!0,this.value=new np(.8),this.time=new np(.3)}add(e,r){if(this.enabled&&r!=null){if(this.time.hasLastValue()){if(this.time.computeDelta(r)<.01)return;if(this.value.hasFilteredDelta()){const i=this.value.computeDelta(e);this.value.filteredDelta*i<0&&this.value.reset()}}this.time.update(r),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=ve(e,-this._maxVelocity,this._maxVelocity),Math.abs(e)<this._minimumInitialVelocity?null:this.createMomentum(e,this._stopVelocity,this._friction)}createMomentum(e,r,i){return new l9(e,r,i)}},cSe=class extends lSe{constructor(e=3,r=.01,i=.95,s=12){super(e,r,i,s)}add(e,r){const i=this.value.lastValue;if(i!=null){let s=e-i;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;e=i+s}super.add(e,r)}},det=class extends l9{constructor(e,r,i){super(e,r,i)}value(e){const r=super.value(e);return Math.exp(r)}valueDelta(e,r){const i=super.value(e),s=super.value(e+r)-i;return Math.exp(s)}},uSe=class extends lSe{constructor(e=2.5,r=.01,i=.95,s=12){super(e,r,i,s)}add(e,r){super.add(Math.log(e),r)}createMomentum(e,r,i){return new det(e,r,i)}},rq=class extends Xf{constructor(){super(...arguments),this._smoothRotation=new dF(.05),this._rotationAxis=O(),this._beginAngle=0,this._beginHeading=0,this._panningPlane=Fr(),this._beginRadius=0,this._smoothScaling=new dF(.05),this._zoomCenterScreen=Qi(),this._zoomMomentumEstimator=new uSe,this._rotationMomentumEstimator=new cSe,this._panSphericalMomentumEstimator=new het,this._panPlanarMomentumEstimator=new aSe,this._adjustedSphere=xs(),this._tmp3d=O(),this._tmpScreenPointArray=Qi(),this._beginScreenPoint=Qi(),this._beginScenePoint=O(),this._screenPickPoint=Qi(),this._scenePickPoint=O(),this._mode=to.Horizontal,this._sphere=xs(),this._pointerCount=0,this._tmpInteractionDirection=O(),this._constraintOptions={selection:Mi.ALL,interactionType:Xt.NONE,interactionFactor:0,interactionStartCamera:new yt,interactionDirection:null,tiltMode:ro.TUMBLE}}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;const r=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=r,this._rotationMomentumEstimator.enabled=r,this._panPlanarMomentumEstimator.enabled=r,this._panSphericalMomentumEstimator.enabled=r,this._beginHeading=-lv.normalize(Ft(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),Uf(e.center,this._screenPickPoint),yn(this._beginScreenPoint,this._screenPickPoint);const i=Vr(this.view.spatialReference),s=O2e(this._intersectionHelper,this.startCamera,this._screenPickPoint,i,BE.Silhouette,this.view.map.ground.opacity===0?Dx:{});s.scenePickPoint!=null&&(this._scenePickPoint=s.scenePickPoint,this._sphere=s.sphere,ie(this._beginScenePoint,this._scenePickPoint),this._mode=n9(this.startCamera,this._screenPickPoint,i),this._mode===to.Vertical&&this._preparePlanarPanMode(e,s.hasGeometryIntersection),this._constraintOptions.interactionStartCamera?.copyFrom(this.startCamera))}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const r=e.pointers.size>1;this._mode===to.Horizontal?(r&&this._zoomSpherical(e),this._panningSpherical(e),r&&this._rotateSpherical(e)):(r&&this._zoomPlanar(e),this._panningPlanar(e),r&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const r=this._zoomMomentumEstimator.evaluateMomentum();if(r)return this._mode===to.Horizontal?new ab({view:this.view,momentum:r,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new mS({view:this.view,momentum:r,zoomCenter:this._beginScenePoint});const i=this._rotationMomentumEstimator.evaluateMomentum();if(i)return new Gb({view:this.view,momentum:i,center:this._sphere,axis:this._rotationAxis});if(this._mode===to.Horizontal){const s=this._panSphericalMomentumEstimator.evaluateMomentum();if(s)return new PN({view:this.view,momentum:s})}else{const s=this._panPlanarMomentumEstimator.evaluateMomentum();if(s)return new SR({view:this.view,momentum:s})}return null}_preparePlanarPanMode(e,r){const i=va(this._tmp3d,this.startCamera.viewForward);RP(this._scenePickPoint,i,this._panningPlane);const s=Qi(this._screenPickPoint[0],0),n=O(),o=Re(this.startCamera.eye);this._adjustedSphere[3]=o<this._sphere[3]?o-100:this._sphere[3],PM(this._adjustedSphere,this.startCamera,s,n);const a=Wo();this.startCamera.projectToRenderScreen(n,a);const l=O(),c=O(),h=O();fe(l,this._scenePickPoint,this.currentCamera.eye);const d=Re(l);_e(l,l);const f=S2e*Math.max(Math.abs(this.view.camera.position.z),E2e),m=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,s9);let g=m??f;g=r?Math.min(g,d):g,ie(h,de(c,this.currentCamera.eye,se(c,l,g))),this._panningPlane[3]=-ye(this._panningPlane,h),this.startCamera.center=de(c,this.startCamera.eye,se(c,this.startCamera.viewForward,g));const _=Uf(e.center,this._tmpScreenPointArray);YH(this._panningPlane,this.startCamera,_,this._beginScenePoint)}_zoomSpherical(e){const r=this._beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=i,this._smoothScaling.update(r),C2e(this._sphere,this.currentCamera,this._smoothScaling.value),Uf(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=Xt.ZOOM,this._constraintOptions.interactionFactor=sp(e.radius-this._beginRadius),Ns(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){const r=Uf(e.center,this._tmpScreenPointArray);PM(this._sphere,this.currentCamera,r,this._tmp3d),UQ(this._beginScenePoint,ye(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(L2e(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(r,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):($2e(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(r,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=Xt.PAN,this._constraintOptions.interactionFactor=sp(Hw(this._screenPickPoint,r)),Ns(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){_e(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||va(this._rotationAxis,this._rotationAxis);const r=this._smoothRotation.value,i=r+XH(e.angle-r),s=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=s,this._smoothRotation.update(i);const n=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(n,.001*e.timestamp),wv(this.currentCamera,this._sphere,MM(this._rotationAxis,n)),this._constraintOptions.interactionType=Xt.TUMBLE,this._constraintOptions.interactionFactor=sp(e.radius*i),Ns(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){const r=Uf(e.center,this._tmpScreenPointArray);YH(this._panningPlane,this.currentCamera,r,this._tmp3d)&&(R2e(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(r,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=Xt.PAN,this._constraintOptions.interactionFactor=sp(Hw(this._beginScreenPoint,r)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),Ns(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){const r=this._beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=i,this._smoothScaling.update(r),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),FQ(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=Xt.ZOOM,this._constraintOptions.interactionFactor=sp(e.radius-this._beginRadius),Ns(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){ie(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||va(this._rotationAxis,this._rotationAxis);const r=this._smoothRotation.value;let i=e.angle-r;i=XH(i);const s=r+i,n=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=n,this._smoothRotation.update(s);const o=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(o,.001*e.timestamp),wv(this.currentCamera,this._sphere,MM(this._rotationAxis,o)),this._constraintOptions.interactionType=Xt.TUMBLE,this._constraintOptions.interactionFactor=sp(e.radius*o),Ns(this.view,this.currentCamera,this._constraintOptions)}};rq=u([P("esri.views.3d.state.controllers.global.PinchAndPanController")],rq);const Xoe=Pe(0,0,1),pet={ELEVATION_THRESHOLD:3e4,ANGLE_THRESHOLD:16/180*Math.PI};let iq=class extends Xf{constructor(){super(...arguments),this._rotationValueSmooth=new dF(.05),this._scalingValueSmooth=new dF(.05),this._planeHorizontal=Fr(),this._planeVertical=Fr(),this._rotationMomentumEstimator=new cSe,this._panMomentumEstimator=new aSe(300,12,.9),this._zoomMomentumEstimator=new uSe,this._beginRadius=0,this._beginCenter=O(),this._beginAngle=0,this._tmpPoints=[],this._panMode=to.Horizontal,this._beginCenterScreen=Qi(),this._tmpCentroid3d=O(),this._tmpCentroid2d=Qi(),this._tmp2d=Qi(),this._pointerCount=0,this._constraintOptions={selection:Mi.ALL,interactionType:Xt.NONE,interactionFactor:0,interactionStartCamera:new yt,interactionDirection:null,tiltMode:ro.TUMBLE}}begin(e){if(!this.active)return;const r=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=r,this._rotationMomentumEstimator.enabled=r,this._panMomentumEstimator.enabled=r,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),Uf(e.center,this._beginCenterScreen),qbe(Xoe,0,this._planeHorizontal);const i=O(),s=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,i,this.view.map.ground.opacity===0?Dx:{}),n=O();va(n,this.startCamera.viewForward);const o=O();ie(o,Xoe);const a=ye(n,o),l=Hh(a<0?-a:a);this._panMode=l>=pet.ANGLE_THRESHOLD?to.Horizontal:to.Vertical;const c=Math.min(S2e,1/Math.abs(ye(o,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),E2e);gj(this._planeHorizontal,this._planeHorizontal,i),this.startCamera.aboveGround||yj(this._planeHorizontal,this._planeHorizontal);const h=O(),d=O(),f=O();fe(h,i,this.currentCamera.eye);const m=Re(h);if(_e(h,h),this._panMode===to.Vertical){se(o,o,a),fe(this._planeVertical,n,o),_e(this._planeVertical,this._planeVertical),gj(this._planeVertical,this._planeVertical,i);const g=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,s9);let _=g??c;_=s?Math.min(_,m):_,ie(f,de(d,this.currentCamera.eye,se(d,h,_))),this._planeVertical[3]=-ye(this._planeVertical,f),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),zk(this._tmpPoints,this._beginCenter)}else{const g=s?m:c;ie(f,de(d,this.currentCamera.eye,se(d,h,g))),this._planeHorizontal[3]=-ye(this._planeHorizontal,f),this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),zk(this._tmpPoints,this._beginCenter)}this._constraintOptions.interactionStartCamera?.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const r=e.pointers.size>1,i=this._panMode===to.Horizontal?this._planeHorizontal:this._planeVertical,s=this._beginCenter;if(r){const n=this._beginRadius/e.radius,o=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=o,this._scalingValueSmooth.update(n),FQ(this.currentCamera,s,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=Xt.ZOOM,this._constraintOptions.interactionFactor=sp(Math.abs(e.radius-this._beginRadius)),Ns(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,i,this.currentCamera,this._tmpPoints),zk(this._tmpPoints,this._tmpCentroid3d),Uf(e.center,this._tmpCentroid2d),R2e(this.currentCamera,s,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=Xt.PAN,this._constraintOptions.interactionFactor=sp(Hw(this._beginCenterScreen,this._tmpCentroid2d)),Ns(this.view,this.currentCamera,this._constraintOptions),r){const n=this._planeHorizontal,o=s,a=this._rotationValueSmooth.value,l=a+XH(e.angle-a),c=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=c,this._rotationValueSmooth.update(l);const h=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(h,.001*e.timestamp),wv(this.currentCamera,o,MM(n,h)),this._constraintOptions.interactionType=Xt.TUMBLE,this._constraintOptions.interactionFactor=sp(Math.abs(e.radius*h)),Ns(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const r=this._zoomMomentumEstimator.evaluateMomentum();if(r)return new mS({view:this.view,momentum:r,zoomCenter:this._beginCenter});const i=this._rotationMomentumEstimator.evaluateMomentum();if(i)return new Gb({view:this.view,momentum:i,center:this._beginCenter,axis:this._planeHorizontal});const s=this._panMomentumEstimator.evaluateMomentum();return s?new SR({view:this.view,momentum:s}):null}_computePlanePoints(e,r,i,s){s.length=e.size;const n=this._tmp2d;let o=0;return e.forEach(a=>{n[0]=a.x,n[1]=a.y,s[o]===void 0&&(s[o]=O()),YH(r,i,n,s[o]),o+=1}),s}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};iq=u([P("esri.views.3d.state.controllers.local.PinchAndPanController")],iq);let Yoe=class extends Ro{constructor(e,r,i){super(!0),this._view=e,this.pointerAction=r,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",i,s=>this._handleDrag(s))}_handleDrag(e){if(e.data.pointerType==="mouse"&&!zQ(e.data,this.pointerAction))return;const r=e.timestamp-this._lastEndTimestamp,i=40,s=this._momentum&&this._momentum.active&&r<i;switch(e.data.action){case"start":case"update":if(s)break;this._controller&&this._controller.active?e.data.timestamp-this._lastTimestamp>2&&(this._controller.update(e.data),this._lastTimestamp=e.timestamp):this._startController(e);break;case"end":case"removed":this._endController(e,!0);break;case"added":this._endController(e,!1),this._startController(e)}e.stopPropagation()}_endController(e,r){if(this._controller&&this._controller.active){this._lastEndTimestamp=e.timestamp;const i=this._controller.end(e.data);r&&i&&(this._momentum=i,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(e){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(e.data),this._lastTimestamp=e.timestamp}_createController(){return this._view.state.isGlobal?new rq({view:this._view}):new iq({view:this._view})}},fet=class extends Ro{constructor(e,r){super(!0),this.view=e,this.registerIncoming("pointer-down",r,()=>this.view.state.stopActiveCameraController())}},hSe=class extends Ro{constructor(e,r){super(!0),this.key=e,this.registerIncoming("key-down",r,i=>this._handleKeyDown(i))}_handleKeyDown(e){e.data.key===this.key&&(this.activate(),e.stopPropagation())}},met=class extends hSe{constructor(e,r,i){super(r,i),this.view=e}activate(){this.view.goTo({heading:0}).catch(()=>{})}},get=class extends hSe{constructor(e,r,i){super(r,i),this.view=e}activate(){this.view.goTo({tilt:0}).catch(()=>{})}},yet=class extends Ro{constructor(e,r=!1){super(!0),this._view=e,this._invert=r,this.registerIncoming("vertical-two-finger-drag",i=>this._handleTwoFinger(i))}_handleTwoFinger(e){const r=this._invert?-1:1,i=Qi(0,e.data.delta*r);switch(e.data.action){case"begin":this._cameraController?.end(),this._cameraController=new TR({view:this._view,pivot:yc.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController?.update(i);break;case"end":this._cameraController?.end(),this._cameraController=null}}};function Zoe(t){const e=t.native;return e?{buttons:e.buttons.map(r=>r.pressed?r.value||1:0),axes:e.axes.map(r=>bet(r,t.axisThreshold))}:{buttons:[],axes:[]}}function _et(t,e){if(t.axes.length!==e.axes.length||t.buttons.length!==e.buttons.length)return!1;for(let r=0;r<t.axes.length;r++)if(t.axes[r]!==e.axes[r])return!1;for(let r=0;r<t.buttons.length;r++)if(t.buttons[r]!==e.buttons[r])return!1;return!0}function vet(t){for(let e=0;e<t.axes.length;e++)if(t.axes[e]!==0)return!1;for(let e=0;e<t.buttons.length;e++)if(t.buttons[e]!==0)return!1;return!0}function bet(t,e){const r=Math.abs(t);return r<e?0:Math.sign(t)*(r-e)/(1-e)}let wet=class{constructor(e,r){this._element=e,this._input=r,this._hasEventListeners=!1,this._onConnectGamepad=n=>{this._connectGamepad(n.gamepad)},this._onDisconnectGamepad=n=>{const o=n.gamepad,a=o.index,l=this._inputDevices[a];l&&(this._emitGamepadEvent(o,Zoe(l),!1),this._inputDevices.splice(a,1),this._latestUpdate.splice(a,1),this._input.gamepad.devices.remove(l),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const i="getGamepads"in window.navigator,s=window.isSecureContext;this.supported=i&&s,this.supported&&(this._forEachGamepad(n=>this._connectGamepad(n)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const r=new zJ(e);r.deviceType!=="unknown"&&(this._inputDevices[e.index]=r,this._input.gamepad.devices.add(r)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=dE({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),r=this._element.contains(document.activeElement),i=this._input.gamepad.enabledFocusMode==="document"&&!e||this._input.gamepad.enabledFocusMode==="view"&&!r;this._forEachGamepad(s=>{const n=this._inputDevices[s.index];if(!n)return;const o=this._latestUpdate[s.index],a=Zoe(n),l=i||vet(a);o&&(o.timestamp===s.timestamp||!o.active&&l||_et(o.state,a))||this._emitGamepadEvent(s,a,!l)})}_forEachGamepad(e){const r=window.navigator.getGamepads();for(let i=0;i<r.length;i++){const s=r[i];this._validate(s)&&e(s)}}_emitGamepadEvent(e,r,i){const s=this._latestUpdate[e.index],n=s&&s.active;if(!n&&!i)return;const o=!n&&i?"start":n&&i?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:r,active:i},this._callback&&this._callback({device:this._inputDevices[e.index],state:r,action:o})}_validate(e){if(!e||!e.connected)return!1;for(let r=0;r<e.axes.length;r++)if(isNaN(e.axes[r]))return!1;return!0}};const Joe=ae("edge"),xet=ae("chrome"),Tet=ae("ff"),Eet=ae("safari"),Qoe="esri-view-surface",uT={touchNone:`${Qoe}--touch-none`,touchPan:`${Qoe}--touch-pan`};let dSe=class pSe{constructor(e,r){this._input=r,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new wet(e,this._input),this._gamepadSource.onEvent=i=>this._callback("gamepad",i)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(e=>{this._releasePointerCaptureSafe(e)}),this._gamepadSource=Ne(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const r in this._active)if(!e||!e.has(r)){const i=this._active[r];this._element.removeEventListener(Qk[r],i),delete this._active[r]}e&&e.forEach(r=>{if(!this._active[r]&&Qk[r]){const i=(this._eventHandlers[r]||this._handleDefault).bind(this,r);this._element.addEventListener(Qk[r],i),this._active[r]=i}}),this._gamepadSource.hasEventListeners=e?.has("gamepad")??!1}setPointerCapture(e,r){r?this._setPointerCatpureSafe(e.pointerId):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?uT.touchNone:uT.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?uT.touchPan:uT.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(uT.touchNone),this._element.classList.remove(uT.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCatpureSafe(e){try{this._element.setPointerCapture(e),this._activePointerCaptures.add(e)}catch{}}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch{}}_updateNormalizedPointerLikeEvent(e,r){const i=Hwe(this._element,e);return pSe.test.disableSubpixelCoordinates&&(i.x=Math.round(i.x),i.y=Math.round(i.y)),r.x=i.x,r.y=i.y,r}_handleKey(e,r){const i=Rje(r);i&&e==="key-up"&&this._keyDownState.delete(i);const s={native:r,key:i,repeat:!!i&&this._keyDownState.has(i)};i&&e==="key-down"&&this._keyDownState.add(s.key),this._callback(e,s)}_handlePointer(e,r){const i=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});this._callback(e,i)}_handlePointerPreventDefault(e,r){const i=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});r.preventDefault(),this._callback(e,i)}_handleMouseWheel(e,r){let i=r.deltaY;switch(r.deltaMode){case 0:Joe&&(i=i/document.documentElement.clientHeight*600);break;case 1:i*=30;break;case 2:i*=900}Joe?i*=.7:xet||Eet?i*=.6:Tet&&(i*=1.375);const s=100,n=Math.abs(i);n>s&&(i=i/n*200/(1+Math.exp(-.02*(n-s))));const o=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,deltaY:i});this._callback(e,o)}_handlePointerCaptureLost(e,r){this._activePointerCaptures.delete(r.pointerId),this._handleDefault(e,r)}_handleDefault(e,r){const i={native:r};r.preventDefault(),this._callback(e,i)}_preventAltKeyDefault(e){e.key==="Alt"&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}};dSe.test={disableSubpixelCoordinates:!1};const Qk={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};let Cet=class extends Ro{constructor(){super(!0),this.registerIncoming("context-menu",e=>{e.data.native.preventDefault()})}};function fSe(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}function Aet(t,e){const r=e.x-t.x,i=e.y-t.y;return Math.sqrt(r*r+i*i)}function Oet(t,e){if(e?(e.radius=0,e.center.x=0,e.center.y=0):e={radius:0,center:Xh()},t.length===0)return e;if(t.length===1)return e.center.x=t[0].x,e.center.y=t[0].y,e;if(t.length===2){const[x,S]=t,[E,A]=[S.x-x.x,S.y-x.y];return e.radius=Math.sqrt(E*E+A*A)/2,e.center.x=(x.x+S.x)/2,e.center.y=(x.y+S.y)/2,e}let r=0,i=0;for(let x=0;x<t.length;x++)r+=t[x].x,i+=t[x].y;r/=t.length,i/=t.length;const s=t.map(x=>x.x-r),n=t.map(x=>x.y-i);let o=0,a=0,l=0,c=0,h=0,d=0,f=0;for(let x=0;x<s.length;x++){const S=s[x],E=n[x],A=S*S,R=E*E;o+=A,a+=R,l+=S*E,c+=A*S,h+=R*E,d+=S*R,f+=E*A}const m=.5*(c+d),g=.5*(h+f),_=o*a-l*l,v=(m*a-g*l)/_,b=(o*g-l*m)/_,T=Xh(v+r,b+i);return{radius:Math.sqrt(v*v+b*b+(o+a)/t.length),center:T}}function ER(t){const{native:e}=t,{pointerId:r,button:i,pointerType:s}=e;return s==="mouse"?`${r}:${i}`:`${s}`}let Ret=class extends Ro{constructor(e){super(!1),this._navigationTouch=e,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,r,i,s){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:r.buttons,timestamp:s,pointers:Met(this._activePointerMap),pointer:r,angle:i.angle,radius:i.radius,center:i.center}}_addPointer(e){const r=e.native.pointerId,i=N$(this._activePointerMap).angle,s={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(r,s);const n=IN(s,mSe(this._activePointerMap));s.initialAngle=n,s.lastAngle=n,this._updatePointerAngles(i)}_updatePointer(e){if(e&&e.x==null&&e.y==null)return;const r=e.native.pointerId,i=this._activePointerMap.get(r);i?i.event=e:this._addPointer(e)}_removePointer(e){const r=N$(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(r)}_updatePointerAngles(e){const r=N$(this._activePointerMap);this._activePointerMap.forEach(i=>{i.initialAngle=IN(i,r)-e,i.lastAngle=IN(i,r)-e})}_emitEvent(e,r,i){const s=N$(this._activePointerMap);this._drag.emit(this._createPayload(e,r,s,i),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(e){const r=e.data.native.pointerId,i=e.timestamp;this._activePointerMap.get(r)&&(this._activePointerMap.size===1?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,i),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(r)):(this._removePointer(r),this._emitEvent("removed",e.data,e.timestamp)))}_handlePointerDrag(e){const r=e.data,i=r.currentEvent,s=e.timestamp;switch(r.action){case"start":case"update":this._isDragging?this._activePointerMap.has(i.native.pointerId)?(this._updatePointer(i),!this._isCurrentDragSuppressed&&this._emitEvent("update",i,s)):(this._addPointer(i),this._emitEvent("added",i,s),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(i),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",i,s))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function mSe(t){const e=[];return t.forEach(r=>{e.push(Xh(r.event.x,r.event.y))}),Oet(e)}function N$(t){const e=mSe(t);let r=0;return t.forEach(i=>{let s=IN(i,e),n=s-i.lastAngle;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;s=i.lastAngle+n,i.lastAngle=s;const o=s-i.initialAngle;r+=o}),r/=t.size||1,{angle:r,radius:e.radius,center:e.center}}function Met(t){const e=new Map;return t.forEach((r,i)=>e.set(i,r.event)),e}function IN(t,e){const r=t.event,i=r.x-e.center.x,s=r.y-e.center.y;return Math.atan2(s,i)}var Koe;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",t[t.Back=3]="Back",t[t.Forward=4]="Forward",t[t.Undefined=-1]="Undefined"})(Koe||(Koe={}));const G_={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};let Pet=class extends Ro{constructor(e=G_.maximumDoubleClickDelay,r=G_.maximumDoubleClickDistance,i=G_.maximumDoubleTouchDelay,s=G_.maximumDoubleTouchDistance,n=lP){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=r,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=Fi(e.doubleClickTimer))}get hasPendingInputs(){return Bo(this._pointerState,e=>e.doubleClickTimer!=null)}_clearDoubleClickTimer(e,r){const i=this._pointerState.get(e);i&&(i.doubleClickTimer=Fi(i.doubleClickTimer),r&&this._click.emit(i.event.data,void 0,i.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const r=this._pointerState.get(e);r.pointerDownCount===1&&this._click.emit(r.event.data,void 0,r.event.modifiers),r.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_getPointerId(e){const{pointerId:r,pointerType:i,button:s}=e.native;return i==="mouse"?`${r}:${s}`:`${i}`}_handleImmediateClick(e){const r=e.data,{pointerType:i}=r.native,s=this._getPointerId(r);if(!this._pointerState.has(s))return void this._startClick(e);const n=this._pointerState.get(s),{data:o,modifiers:a}=n.event,l=i==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;fSe(o,r)>l?(this._clearDoubleClickTimer(s,!0),this._startClick(e)):(this._clearDoubleClickTimer(s,!1),n.pointerDownCount===2&&this._doubleClick.emit(o,void 0,a))}_handlePointerDown(e){const r=ER(e.data),i=this._pointerState.get(r);i&&(i.pointerDownCount+=1)}_startClick(e){const{data:r}=e,{native:{pointerType:i}}=r,s=ER(r),n=i==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(s),n),a=1;this._pointerState.set(s,{event:e,doubleClickTimer:o,pointerDownCount:a}),this.refreshHasPendingInputs()}},Iet=class extends Ro{constructor(e=G_.maximumDoubleClickDelay,r=G_.maximumDoubleClickDistance,i=G_.maximumDoubleTouchDelay,s=G_.maximumDoubleTouchDistance,n=lP){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=r,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(e){const r=e.data,i=ER(r);if(!this._pointerState.has(i)){const s={downButton:r.native.button,immediateDoubleClick:null};this._pointerState.set(i,s),this.startCapturingPointer(r.native)}}_handlePointerUp(e){const r=e.data,i=ER(r),s=this._pointerState.get(i);if(s&&s.downButton===r.native.button){const n=s.immediateDoubleClick;if(n){n.timeoutHandle.remove();const o=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;fSe(n,e.data)>o?this._startImmediateDoubleClick(e,s):(this._immediateDoubleClick.emit(e.data,void 0,n.modifiers),this._removeState(r))}else this._startImmediateDoubleClick(e,s)}}_startImmediateDoubleClick(e,r){const i=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;r.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(e.data),i)}}_removeState(e){const r=ER(e);this._pointerState.delete(r),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}};const S3={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};let $et=class extends Ro{constructor(e=S3.maximumClickDelay,r=S3.movementUntilMouseDrag,i=S3.movementUntilPenDrag,s=S3.movementUntilTouchDrag,n=S3.holdDelay,o=lP){super(!1),this._maximumClickDelay=e,this._movementUntilMouseDrag=r,this._movementUntilPenDrag=i,this._movementUntilTouchDrag=s,this._holdDelay=n,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",a=>{this._handlePointerLoss(a,"pointer-up")}),this.registerIncoming("pointer-capture-lost",a=>{this._handlePointerLoss(a,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",a=>{this._handlePointerLoss(a,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(e=>{e.holdTimeout=Fi(e.holdTimeout)}),super.onUninstall()}_handlePointerDown(e){const r=e.data,i=r.native.pointerId;let s=null;this._pointerState.size===0&&(s=this._clock.setTimeout(()=>{const o=this._pointerState.get(i);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,e.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this._holdDelay));const n={startEvent:r,previousEvent:r,startTimestamp:e.timestamp,isDragging:!1,downButton:r.native.button,holdTimeout:s,modifiers:new Set};this._pointerState.set(i,n),this.startCapturingPointer(r.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_createPointerDragData(e,r,i){return{action:e,startEvent:r.startEvent,previousEvent:r.previousEvent,currentEvent:i}}_handlePointerMove(e){const r=e.data,i=r.native.pointerId,s=this._pointerState.get(i);s&&(s.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",s,r),void 0,s.modifiers):Aet(r,s.startEvent)>this._getDragThreshold(r.native.pointerType)&&this._startDragging(e),s.previousEvent=r)}_getDragThreshold(e){switch(e){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(e){const r=e.data,i=r.native.pointerId;this._pointerState.forEach(s=>{s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging||(s.modifiers=e.modifiers,s.isDragging=!0,i===s.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",s,r)):this._pointerDrag.emit(this._createPointerDragData("start",s,s.previousEvent),e.timestamp))})}_handlePointerLoss(e,r){const i=e.data,s=i.native.pointerId,n=this._pointerState.get(s);n&&(n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",n,r==="pointer-up"?i:n.previousEvent),void 0,n.modifiers):r==="pointer-up"&&n.downButton===i.native.button&&e.timestamp-n.startTimestamp<=this._maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(i),this._pointerState.delete(s),this.stopCapturingPointer(i.native),this._pointerState.size===0&&this._moveHandle.pause())}},Let=class{constructor(e){this._callbacks=e,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(e){const r=e.data,i=r.pointers.size;switch(r.action){case"start":this._currentCount=i,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=i,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=i,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}_emitStart(e){this._startEvent=e,this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.start(this._currentCount,e,this._startEvent)}_emitUpdate(e){this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.update(this._currentCount,e,this._startEvent)}_emitEnd(e){this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}},Det=class extends Ro{constructor(e=20,r=40){super(!1),this._threshold=e,this._maxDelta=r,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new Let({start:(i,s)=>this._observeStart(i,s),update:(i,s,n)=>this._observeUpdate(i,s,n),end:(i,s)=>this._observeEnd(s)}),this.registerIncoming("drag",i=>this._dragEventSeparator.handle(i))}get failed(){return this._state==="failed"}_observeStart(e,r){e===1&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:r.data.button,buttons:r.data.buttons,pointerType:r.data.pointerType,timestamp:r.data.timestamp,pointers:r.data.pointers,pointer:r.data.pointer,angle:r.data.angle,radius:r.data.radius,center:r.data.center}),r.stopPropagation()),this._state=e===2?"ready":"failed"}_observeUpdate(e,r,i){if(this._state!=="failed"&&e===2)return this._state==="active"?(this._vertical.emit({delta:r.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void r.stopPropagation()):void(this._checkMovementWithinLimits(r.data,i.data)?this._checkVerticalThresholdReached(r.data,i.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=r.data.center,this._artificalDrag.emit({action:"end",button:r.data.button,buttons:r.data.buttons,pointerType:r.data.pointerType,timestamp:r.data.timestamp,pointers:r.data.pointers,pointer:r.data.pointer,angle:r.data.angle,radius:r.data.radius,center:r.data.center}),this._vertical.emit({delta:r.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),r.stopPropagation()):this._state="failed")}_observeEnd(e){this._state==="active"&&(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",e.stopPropagation())}_checkMovementWithinLimits(e,r){let i=-1/0,s=1/0,n=-1/0,o=1/0;for(const{x:_,y:v}of r.pointers.values())i=Math.max(i,_),s=Math.min(s,_),n=Math.max(n,v),o=Math.min(o,v);let a=-1/0,l=1/0,c=-1/0,h=1/0;for(const{x:_,y:v}of e.pointers.values())a=Math.max(a,_),l=Math.min(l,_),c=Math.max(c,v),h=Math.min(h,v);const d=i-s,f=n-o,m=a-l,g=c-h;return Math.abs(e.center.x-r.center.x)<this._threshold&&Math.abs(m-d)<=this._maxDelta&&Math.abs(g-f)<=this._maxDelta}_checkVerticalThresholdReached(e,r){let i=Math.abs(e.center.y-r.center.y);return e.pointers.forEach((s,n)=>{const o=r.pointers.get(n);i=Math.min(i,Math.abs(s.y-o.y))}),i>=this._threshold}},Id=class extends Te{constructor(){super(...arguments),this._handles=new $i}destroy(){this._handles=Ne(this._handles),this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get updating(){return!!this._inputManager?.updating}get latestPointerType(){return this._inputManager?.latestPointerType}get latestPointerLocation(){return this._inputManager?.latestPointerLocation}get multiTouchActive(){return this._inputManager?.multiTouchActive??!1}disconnect(){this.view.viewEvents.disconnect(),this._inputManager=Ne(this._inputManager)}connect(){const e=this.view;this._source=new dSe(this.view.surface,e.input);const r=[new Iet,new $et,new Pet,new Ret(this.view.navigation),new Det],i=new oh({eventSource:this._source,recognizers:r});this._inputManager=i,i.installHandlers("prevent-context-menu",[new Cet],Q_.INTERNAL),this._modeDragPan=new Yoe(e,"primary"),this._modeDragRotate=new Zk(e,"secondary",yc.CENTER),this._modeDragZoom=new ZKe(e,"tertiary");const s={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};i.installHandlers("navigation",[new fet(e),new jQe(e),new set(e),new net(e,s.pan),new oet(e),new get(e,s.resetTilt),new met(e,s.resetHeading),new Zk(e,"primary",yc.EYE,[s.lookAround]),new Zk(e,"secondary",yc.CENTER,[s.lookAround]),new Yoe(e,"tertiary",[s.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new yet(e)],Q_.INTERNAL),this.view.viewEvents.connect(i),this._updateMode(),this._handles.add(le(()=>this.view.navigation?.browserTouchPanEnabled,n=>{this._source.browserTouchPanningEnabled=!n},Pr))}_updateMode(){const e=this.mode,r=this.primaryDragAction,i=sq.get(e)?.get(r);i&&(this._modeDragPan&&(this._modeDragPan.pointerAction=i.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=i.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=i.zoom))}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};u([p()],Id.prototype,"view",void 0),u([p({value:"pan"})],Id.prototype,"primaryDragAction",null),u([p({value:"default"})],Id.prototype,"mode",null),u([p({readOnly:!0})],Id.prototype,"updating",null),u([p()],Id.prototype,"latestPointerType",null),u([p()],Id.prototype,"latestPointerLocation",null),u([p()],Id.prototype,"multiTouchActive",null),u([p()],Id.prototype,"_inputManager",void 0),Id=u([P("esri.views.3d.input.SceneInputManager")],Id);const sq=new Map,Kk=new Map,ez=new Map;Kk.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),Kk.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),ez.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),ez.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),sq.set("default",Kk),sq.set("pro",ez);const Net=Id;let As=class extends Te{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};u([p()],As.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),u([p()],As.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),u([p()],As.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),u([p()],As.prototype,"DECONFLICTOR_SHOW_GRID",void 0),u([p()],As.prototype,"LABELS_SHOW_BORDER",void 0),u([p()],As.prototype,"TEXT_SHOW_BASELINE",void 0),u([p()],As.prototype,"TEXT_SHOW_BORDER",void 0),u([p()],As.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),u([p()],As.prototype,"OVERLAY_SHOW_CENTER",void 0),u([p()],As.prototype,"SHOW_POI",void 0),u([p()],As.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),u([p()],As.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),u([p()],As.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),u([p()],As.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),u([p()],As.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),u([p()],As.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),u([p()],As.prototype,"I3S_TREE_SHOW_TILES",void 0),u([p()],As.prototype,"I3S_SHOW_MODIFICATIONS",void 0),u([p()],As.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),u([p()],As.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),u([p()],As.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),u([p()],As.prototype,"LINE_WIREFRAMES",void 0),As=u([P("esri.views.3d.support.DebugFlags")],As);const li=new As;let uu,BS,nq=!1,oq=!1,aq=!1,lq=!1,CR=null;function Fet(t,e){if(!oq||!BS)return;gSe();const r=BS;let i=0;for(let s=0;s<t.accBinsNumX;s++)for(let n=0;n<t.accBinsNumY;n++){const o=t.accBins[s][t.accBinsNumY-1-n];i+=o.length;const a=s*t.accBinsSizeX,l=(s+1)*t.accBinsSizeX,c=n*t.accBinsSizeY,h=(n+1)*t.accBinsSizeY;r.fillText(o.length.toFixed(),a+5,c+15),ySe(a,l,c,h,"blue")}r.fillText("total totalShownLabels: "+i,70,40),r.fillText("total visible labels: "+e.size,70,50),r.fillText("total numTests: "+t.accNumTests,70,30)}function Uet(t){aq=li.DECONFLICTOR_SHOW_VISIBLE,lq=li.DECONFLICTOR_SHOW_INVISIBLE,nq=aq||lq,oq=li.DECONFLICTOR_SHOW_GRID,CR=null,nq||oq?CR=()=>ket(t):uu&&(uu.parentElement.removeChild(uu),uu=null)}function gSe(){CR&&(CR(),CR=null)}function ket(t){uu==null&&(uu=document.createElement("canvas"),uu.setAttribute("id","debugCanvas2d"),t.surface.parentElement.style.position="relative",t.surface.parentElement.appendChild(uu));const{state:e}=t,{camera:r,pixelRatio:i}=e,{width:s,height:n}=r,o=s*i,a=n*i;uu.setAttribute("width",`${o}px`),uu.setAttribute("height",`${a}px`),uu.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${s}px;height:${n}px`),BS=uu.getContext("2d"),BS.clearRect(0,0,s,n),BS.font="12px Arial"}function ySe(t,e,r,i,s){gSe();const n=uu.height,o=BS;o.beginPath(),o.lineWidth=1,o.strokeStyle=s,o.moveTo(t,n-r),o.lineTo(e,n-r),o.stroke(),o.lineTo(e,n-i),o.stroke(),o.lineTo(e,n-r),o.stroke(),o.lineTo(t,n-r),o.stroke(),o.lineTo(t,n-r),o.stroke(),o.closePath()}function zet(t,e){nq&&(e&&aq||!e&&lq)&&ySe(t.aabr[0],t.aabr[2],t.aabr[1],t.aabr[3],e?"green":"red")}var Ho,Kn;(function(t){t[t.USER=1]="USER",t[t.SCALE_RANGE=2]="SCALE_RANGE",t[t.FILTER=4]="FILTER",t[t.DECONFLICTION=8]="DECONFLICTION",t[t.ALL_GRAPHIC=15]="ALL_GRAPHIC",t[t.ALL_LABEL=255]="ALL_LABEL"})(Ho||(Ho={})),function(t){t[t.GRAPHIC=1]="GRAPHIC",t[t.LABEL=16]="LABEL"}(Kn||(Kn={}));function _Se(t,e){return new xSe(t,SSe,e)}function Vet(t,e){const{curvatureDependent:r,scaleStart:i,scaleFallOffRange:s}=SSe;return new xSe(t,{curvatureDependent:{min:{curvature:r.min.curvature,tiltAngle:r.min.tiltAngle,scaleFallOffFactor:tz.curvatureDependent.min.scaleFallOffFactor},max:{curvature:r.max.curvature,tiltAngle:r.max.tiltAngle,scaleFallOffFactor:tz.curvatureDependent.max.scaleFallOffFactor}},scaleStart:i,scaleFallOffRange:s,minPixelSize:tz.minPixelSize},e)}function Bet(t){return Math.abs(t*t*t)}function vSe(t,e,r){const i=r.parameters,s=r.paddingPixelsOverride;return E3.scale=Math.min(i.divisor/(e-i.offset),1),E3.factor=Bet(t),E3.minPixelSize=i.minPixelSize,E3.paddingPixels=s,E3}function bSe(t,e){return t===0?e.minPixelSize:e.minPixelSize*(1+2*e.paddingPixels/t)}function XQ(t,e){return Math.max(St(t*e.scale,t,e.factor),bSe(t,e))}function Get(t,e,r){const i=vSe(t,e,r);return i.minPixelSize=0,i.paddingPixels=0,XQ(1,i)}function eae(t,e,r,i){i.scale=Get(t,e,r),i.factor=0,i.minPixelSize=r.parameters.minPixelSize,i.paddingPixels=r.paddingPixelsOverride}function wSe(t,e,r=[0,0]){const i=Math.min(Math.max(e.scale,bSe(t[1],e)/Math.max(1e-5,t[1])),1);return r[0]=t[0]*i,r[1]=t[1]*i,r}function jet(t,e,r,i){return XQ(t,vSe(e,r,i))}let xSe=class TSe{get paddingPixelsOverride(){return this._paddingPixelsOverride||this.parameters.paddingPixels}constructor(e,r,i,s=Het(),n){this._viewingMode=e,this._description=r,this._ellipsoidRadius=i,this.parameters=s,this._paddingPixelsOverride=n,this._viewingMode===Ve.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(e){return(!this.parameters||this.parameters.camera.fovY!==e.fovY||this.parameters.camera.distance!==e.distance)&&(this._calculateParameters(e,this._ellipsoidRadius,this.parameters),!0)}overridePadding(e){return e!==this.paddingPixelsOverride?new TSe(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,e):this}_calculateParameters(e,r,i){const{scaleStart:s,scaleFallOffRange:n,minPixelSize:o}=this._description,{fovY:a,distance:l}=e,c=this._calculateCurvatureDependentParameters(e,r),h=this._coverageCompensation(e,r,c),{tiltAngle:d,scaleFallOffFactor:f}=c,m=Math.sin(d)*l,g=.5*Math.PI-d-a*(.5-s*h),_=m/Math.cos(g),v=g+a*n*h,b=(_-f*(m/Math.cos(v)))/(1-f);return i.camera.fovY=e.fovY,i.camera.distance=e.distance,i.offset=b,i.divisor=_-b,i.minPixelSize=o,i}_calculateCurvatureDependentParametersLocal(e,r,i=tae){return i.tiltAngle=this._description.curvatureDependent.min.tiltAngle,i.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,i}_calculateCurvatureDependentParametersGlobal(e,r,i=tae){const s=this._description.curvatureDependent,n=1+e.distance/r,o=Math.sqrt(n*n-1),[a,l]=[s.min.curvature,s.max.curvature],c=ve((o-a)/(l-a),0,1),[h,d]=[s.min,s.max];return i.tiltAngle=St(h.tiltAngle,d.tiltAngle,c),i.scaleFallOffFactor=St(h.scaleFallOffFactor,d.scaleFallOffFactor,c),i}_surfaceCoverageCompensationLocal(e,r,i){return(e.fovY-i.tiltAngle)/e.fovY}_surfaceCoverageCompensationGlobal(e,r,i){const s=r*r,n=i.tiltAngle+.5*Math.PI,{fovY:o,distance:a}=e,l=a*a+s-2*Math.cos(n)*a*r,c=Math.sqrt(l),h=Math.sqrt(l-s);return(Math.acos(h/c)-Math.asin(r/(c/Math.sin(n)))+.5*o)/o}};const SSe={curvatureDependent:{min:{curvature:Ft(10),tiltAngle:Ft(12),scaleFallOffFactor:.5},max:{curvature:Ft(70),tiltAngle:Ft(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},tz={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function Het(){return{camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}}const E3={scale:0,factor:0,minPixelSize:0,paddingPixels:0},tae={tiltAngle:0,scaleFallOffFactor:0};function qet(t){return t instanceof Float32Array&&t.length>=16}function Wet(t){return Array.isArray(t)&&t.length>=16}function Xet(t){return qet(t)||Wet(t)}function YQ(t){t.vertex.code.add(w`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`),t.vertex.code.add(w`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),t.vertex.code.add(w`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`),t.vertex.code.add(w`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`),t.vertex.code.add(w`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),t.vertex.code.add(w`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`),t.vertex.code.add(w`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function Yet(t){t.uniforms.add(new sr("screenSizePerspective",e=>ESe(e.screenSizePerspective)))}function c9(t){t.uniforms.add(new sr("screenSizePerspectiveAlignment",e=>ESe(e.screenSizePerspectiveAlignment||e.screenSizePerspective)))}function ESe(t){return Ti(Zet,t.parameters.divisor,t.parameters.offset,t.parameters.minPixelSize,t.paddingPixelsOverride)}const Zet=Wt();var Di,Oh,AR,as,cn;(function(t){t[t.INNER=0]="INNER",t[t.OUTER=1]="OUTER"})(Di||(Di={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",t[t.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",t[t.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(Oh||(Oh={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(AR||(AR={})),function(t){t[t.Color=0]="Color",t[t.ColorNoRasterImage=1]="ColorNoRasterImage",t[t.Highlight=2]="Highlight",t[t.Water=3]="Water",t[t.Occluded=4]="Occluded",t[t.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"}(as||(as={})),function(t){t[t.FADING=0]="FADING",t[t.IMMEDIATE=1]="IMMEDIATE",t[t.UNFADED=2]="UNFADED"}(cn||(cn={}));let Jet=class{constructor(e,r){this.vec3=e,this.id=r}};function pF(t,e,r,i){return new Jet(Pe(t,e,r),i)}var Ya;(function(t){t[t.None=0]="None",t[t.ColorAndWater=1]="ColorAndWater",t[t.Highlight=2]="Highlight",t[t.Occluded=3]="Occluded",t[t.ObjectAndLayerIdColor=4]="ObjectAndLayerIdColor"})(Ya||(Ya={}));const ZQ=1.3;let rae=class{get extent(){return this._extent}constructor(e,r){this.index=e,this.renderTargets=r,this._extent=zt(),this.resolution=0,this.renderLocalOrigin=pF(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new Qet,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=e,this.validTargets=new Array(r.renderTargets.length).fill(!1)}getValidTexture(e){return this.validTargets[e]?this.renderTargets.getTarget(e).getTexture():null}get _needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(e){const r=e===Ya.ColorAndWater?this.renderTargets.getTarget(as.Color):e===Ya.Highlight?this.renderTargets.getTarget(as.Highlight):e===Ya.ObjectAndLayerIdColor?this.renderTargets.getTarget(as.ObjectAndLayerIdColor):this.renderTargets.getTarget(as.Occluded);return r?r.getTexture():null}getColorTextureNoRasterImage(){return this._needsColorWithoutRasterImage?this.getValidTexture(as.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(as.Color):null}getNormalTexture(e){const r=e===Ya.ColorAndWater?this.renderTargets.getTarget(as.Water):null;return r?r.getTexture():null}draw(e,r){const i=this.computeRenderTargetValidityBitfield();for(const s of this.renderTargets.renderTargets)s.type!==as.ColorNoRasterImage||this._needsColorWithoutRasterImage?this.validTargets[s.type]=e.drawTarget(this,s,r):this.validTargets[s.type]=!1;return i^this.computeRenderTargetValidityBitfield()?FE.CHANGED:FE.UNCHANGED}computeRenderTargetValidityBitfield(){const e=this.validTargets;return+e[as.Color]|+e[as.ColorNoRasterImage]<<1|+e[as.Highlight]<<2|+e[as.Water]<<3|+e[as.Occluded]<<4}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const r=.001*e.range;if(this._extent[0]-r<=e.min){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];d5(this._extent,e.range,0,i)}if(this._extent[2]+r>=e.max){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];d5(this._extent,-e.range,0,i)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,m0(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const r=this.canvasGeometries.extents[e];if(r[0]!==r[2]&&r[1]!==r[3])return!0}return!1}applyViewport(e){e.setViewport(this.index===Di.INNER?0:this.resolution,0,this.resolution,this.resolution)}},Qet=class{constructor(){this.extents=[zt(),zt(),zt()],this.numViews=0}},CSe=class extends ps{constructor(e,r){super(e,"mat4",ti.Draw,(i,s,n)=>i.setUniformMatrix4fv(e,r(s,n)))}};function $p(t,e){e.instancedDoublePrecision?t.constants.add("cameraPosition","vec3",sl):t.uniforms.add(new Ou("cameraPosition",(r,i)=>ne(ASe,i.camera.viewInverseTransposeMatrix[3]-r.origin[0],i.camera.viewInverseTransposeMatrix[7]-r.origin[1],i.camera.viewInverseTransposeMatrix[11]-r.origin[2])))}function Dc(t,e){if(!e.instancedDoublePrecision)return void t.uniforms.add(new Ui("proj",(i,s)=>s.camera.projectionMatrix),new CSe("view",(i,s)=>Gl(iae,s.camera.viewMatrix,i.origin)),new Ou("localOrigin",i=>i.origin));const r=i=>ne(ASe,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]);t.uniforms.add(new Ui("proj",(i,s)=>s.camera.projectionMatrix),new Ui("view",(i,s)=>Gl(iae,s.camera.viewMatrix,r(s))),new kt("localOrigin",(i,s)=>r(s)))}const iae=xe(),ASe=O();function jE(t){t.uniforms.add(new Ui("viewNormal",(e,r)=>r.camera.viewInverseTransposeMatrix))}function zC(t,e){t.uniforms.add(new Ie("pixelRatio",(r,i)=>i.camera.pixelRatio/(e.draped?ZQ:1)))}function OSe(t,e){const r=t.vertex;e.hasVerticalOffset?(RSe(r),e.hasScreenSizePerspective&&(t.include(YQ),c9(r),$p(t.vertex,e)),r.code.add(w`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${e.spherical?w`vec3 worldNormal = normalize(worldPos + localOrigin);`:w`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${e.hasScreenSizePerspective?w`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:w`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):r.code.add(w`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const Ket=Wt();function RSe(t){t.uniforms.add(new sr("verticalOffset",(e,r)=>{const{minWorldLength:i,maxWorldLength:s,screenLength:n}=e.verticalOffset,o=Math.tan(.5*r.camera.fovY)/(.5*r.camera.fullViewport[3]),a=r.camera.pixelRatio||1;return Ti(Ket,n*a,o,i,s)}))}function u9(t){t.uniforms.add(new nm("alignPixelEnabled",(e,r)=>r.alignPixelEnabled)),t.code.add(w`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),t.code.add(w`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}var fc;(function(t){t[t.Occluded=0]="Occluded",t[t.NotOccluded=1]="NotOccluded",t[t.Both=2]="Both",t[t.COUNT=3]="COUNT"})(fc||(fc={}));var Il;function MSe(t,e){t.include(YQ),t.attributes.add(C.POSITION,"vec3"),t.attributes.add(C.NORMAL,"vec3"),t.attributes.add(C.AUXPOS1,"vec4");const r=t.vertex;Dc(r,e),$p(r,e),r.uniforms.add(new sr("viewport",(i,s)=>s.camera.fullViewport),new Ie("polygonOffset",i=>i.shaderPolygonOffset),new Ie("cameraGroundRelative",(i,s)=>s.camera.aboveGround?1:-1),new Ie("renderTransparentlyOccludedHUD",(i,s)=>s.renderTransparentlyOccludedHUD===fc.Occluded?1:s.renderTransparentlyOccludedHUD===fc.NotOccluded?0:.75),new rt("hudVisibilityTexture",(i,s)=>s.hudVisibilityTexture)),e.hasVerticalOffset&&RSe(r),r.constants.add("smallOffsetAngle","float",.984807753012208),r.code.add(w`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),r.code.add(w`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),e.draped&&!e.hasVerticalOffset||jE(r),e.draped||(r.uniforms.add(new Ie("perDistancePixelRatio",(i,s)=>Math.tan(s.camera.fovY/2)/(s.camera.fullViewport[2]/2))),r.code.add(w`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`)),e.screenCenterOffsetUnitsEnabled===Il.Screen&&zC(r,e),e.hasScreenSizePerspective&&c9(r),r.code.add(w`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${e.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${e.hasScreenSizePerspective&&(e.hasVerticalOffset||e.screenCenterOffsetUnitsEnabled===Il.Screen)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${e.hasVerticalOffset?e.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${e.hasVerticalOffset?w`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${e.screenCenterOffsetUnitsEnabled!==Il.Screen?w`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${e.screenCenterOffsetUnitsEnabled===Il.Screen?e.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${e.screenCenterOffsetUnitsEnabled===Il.Screen?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),r.include(u9),r.code.add(w`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}(function(t){t[t.World=0]="World",t[t.Screen=1]="Screen",t[t.COUNT=2]="COUNT"})(Il||(Il={}));const F$=gn();function PSe(t,e,r,i,s,n){if(t.visible)if(t.boundingInfo){ot(t.type===us.Mesh);const o=e.tolerance;ISe(t.boundingInfo,r,i,o,s,n)}else{const o=t.indices.get(C.POSITION),a=t.vertexAttributes.get(C.POSITION);zP(r,i,0,o.length/3,o,a,void 0,s,n)}}const ett=O();function ISe(t,e,r,i,s,n){if(t==null)return;const o=LSe(e,r,ett);if(Gve(F$,t.bbMin),jve(F$,t.bbMax),s?.applyToAabb(F$),QQ(F$,e,o,i)){const{primitiveIndices:a,indices:l,position:c}=t,h=a?a.length:l.length/3;if(h>stt){const d=t.getChildren();if(d!==void 0){for(const f of d)ISe(f,e,r,i,s,n);return}}zP(e,r,0,h,l,c,a,s,n)}}const $Se=O();function zP(t,e,r,i,s,n,o,a,l){if(o)return ttt(t,e,r,i,s,n,o,a,l);const{data:c,stride:h}=n,d=t[0],f=t[1],m=t[2],g=e[0]-d,_=e[1]-f,v=e[2]-m;for(let b=r,T=3*r;b<i;++b){let x=h*s[T++],S=c[x++],E=c[x++],A=c[x];x=h*s[T++];let R=c[x++],M=c[x++],D=c[x];x=h*s[T++];let k=c[x++],L=c[x++],N=c[x];a!=null&&([S,E,A]=a.applyToVertex(S,E,A,b),[R,M,D]=a.applyToVertex(R,M,D,b),[k,L,N]=a.applyToVertex(k,L,N,b));const q=R-S,X=M-E,G=D-A,J=k-S,I=L-E,z=N-A,V=_*z-I*v,j=v*J-z*g,Y=g*I-J*_,Q=q*V+X*j+G*Y;if(Math.abs(Q)<=Number.EPSILON)continue;const te=d-S,ge=f-E,De=m-A,at=te*V+ge*j+De*Y;if(Q>0){if(at<0||at>Q)continue}else if(at>0||at<Q)continue;const we=ge*G-X*De,Ce=De*q-G*te,Me=te*X-q*ge,Z=g*we+_*Ce+v*Me;if(Q>0){if(Z<0||at+Z>Q)continue}else if(Z>0||at+Z<Q)continue;const be=(J*we+I*Ce+z*Me)/Q;be>=0&&l(be,JQ(q,X,G,J,I,z,$Se),b,!1)}}function ttt(t,e,r,i,s,n,o,a,l){const{data:c,stride:h}=n,d=t[0],f=t[1],m=t[2],g=e[0]-d,_=e[1]-f,v=e[2]-m;for(let b=r;b<i;++b){const T=o[b];let x=3*T,S=h*s[x++],E=c[S++],A=c[S++],R=c[S];S=h*s[x++];let M=c[S++],D=c[S++],k=c[S];S=h*s[x];let L=c[S++],N=c[S++],q=c[S];a!=null&&([E,A,R]=a.applyToVertex(E,A,R,b),[M,D,k]=a.applyToVertex(M,D,k,b),[L,N,q]=a.applyToVertex(L,N,q,b));const X=M-E,G=D-A,J=k-R,I=L-E,z=N-A,V=q-R,j=_*V-z*v,Y=v*I-V*g,Q=g*z-I*_,te=X*j+G*Y+J*Q;if(Math.abs(te)<=Number.EPSILON)continue;const ge=d-E,De=f-A,at=m-R,we=ge*j+De*Y+at*Q;if(te>0){if(we<0||we>te)continue}else if(we>0||we<te)continue;const Ce=De*J-G*at,Me=at*X-J*ge,Z=ge*G-X*De,be=g*Ce+_*Me+v*Z;if(te>0){if(be<0||we+be>te)continue}else if(be>0||we+be<te)continue;const Fe=(I*Ce+z*Me+V*Z)/te;Fe>=0&&l(Fe,JQ(X,G,J,I,z,V,$Se),T,!1)}}const sae=O(),nae=O();function JQ(t,e,r,i,s,n,o){return ne(sae,t,e,r),ne(nae,i,s,n),pt(o,sae,nae),_e(o,o),o}function LSe(t,e,r){return ne(r,1/(e[0]-t[0]),1/(e[1]-t[1]),1/(e[2]-t[2]))}function QQ(t,e,r,i){return KQ(t,e,r,i,1/0)}function KQ(t,e,r,i,s){const n=(t[0]-i-e[0])*r[0],o=(t[3]+i-e[0])*r[0];let a=Math.min(n,o),l=Math.max(n,o);const c=(t[1]-i-e[1])*r[1],h=(t[4]+i-e[1])*r[1];if(l=Math.min(l,Math.max(c,h)),l<0||(a=Math.max(a,Math.min(c,h)),a>l))return!1;const d=(t[2]-i-e[2])*r[2],f=(t[5]+i-e[2])*r[2];return l=Math.min(l,Math.max(d,f)),!(l<0)&&(a=Math.max(a,Math.min(d,f)),!(a>l)&&a<s)}function DSe(t,e,r,i,s){let n=(r.screenLength||0)*t.pixelRatio;s!=null&&(n=jet(n,i,e,s));const o=n*Math.tan(.5*t.fovY)/(.5*t.fullHeight);return ve(o*e,r.minWorldLength||0,r.maxWorldLength!=null?r.maxWorldLength:1/0)}function NSe(t,e){const r=e?NSe(e):{};for(const i in t){let s=t[i];s&&s.forEach&&(s=itt(s)),s==null&&i in r||(r[i]=s)}return r}function rtt(t,e){let r=!1;for(const i in e){const s=e[i];s!==void 0&&(Array.isArray(s)?t[i]===null?(t[i]=s.slice(),r=!0):SY(t[i],s)&&(r=!0):t[i]!==s&&(r=!0,t[i]=s))}return r}function itt(t){const e=[];return t.forEach(r=>e.push(r)),e}const FSe={multiply:1,ignore:2,replace:3,tint:4},stt=1e3;let Fv=class extends DP{constructor(e,r){super(),this.type=us.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=Tr,this._pp0=Pe(0,0,1),this._pp1=Pe(0,0,0),this._parameters=NSe(e,r),this.validateParameters(this._parameters)}dispose(){}get parameters(){return this._parameters}update(e){return!1}setParameters(e,r=!0){rtt(this._parameters,e)&&(this.validateParameters(this._parameters),r&&this.parametersChanged())}validateParameters(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}shouldRender(e){return this.isVisible()&&this.isVisibleForOutput(e.output)&&(this.renderOccluded&e.renderOccludedMask)!=0}isVisibleForOutput(e){return!0}get renderOccluded(){return this.parameters.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(e){e!==this._insertOrder&&(this._insertOrder=e,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){this.repository!=null&&this.repository.materialChanged(this)}intersectDraped(e,r,i,s,n,o){return this._pp0[0]=this._pp1[0]=s[0],this._pp0[1]=this._pp1[1]=s[1],this.intersect(e,r,i,this._pp0,this._pp1,n)}},USe=class extends TYe{constructor(e,r,i){super(r,i),this.camera=e}};var Ni;(function(t){t[t.None=0]="None",t[t.Occlude=1]="Occlude",t[t.Transparent=2]="Transparent",t[t.OccludeAndTransparent=4]="OccludeAndTransparent",t[t.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",t[t.Opaque=16]="Opaque"})(Ni||(Ni={}));let eK=class extends ii{constructor(){super(...arguments),this.renderOccluded=Ni.Occlude}},kSe=class{constructor(){this.factor=new oae,this.factorAlignment=new oae}},oae=class{constructor(){this.scale=0,this.factor=0,this.minPixelSize=0,this.paddingPixels=0}};function ekt(t,e,r,i,s=1){const n=r.typedBuffer,o=r.typedBufferStride,a=t.length;if(i*=o,s===1)for(let l=0;l<a;++l)n[i]=e[t[l]],i+=o;else for(let l=0;l<a;++l){const c=e[t[l]];for(let h=0;h<s;h++)n[i]=c,i+=o}}function aae(t,e,r,i){const s=r.typedBuffer,n=r.typedBufferStride,o=t.length;i*=n;for(let a=0;a<o;++a){const l=2*t[a];s[i]=e[l],s[i+1]=e[l+1],i+=n}}function zSe(t,e,r,i,s){const n=r.typedBuffer,o=r.typedBufferStride,a=t.length;if(i*=o,s==null||s===1)for(let l=0;l<a;++l){const c=3*t[l];n[i]=e[c],n[i+1]=e[c+1],n[i+2]=e[c+2],i+=o}else for(let l=0;l<a;++l){const c=3*t[l];for(let h=0;h<s;++h)n[i]=e[c],n[i+1]=e[c+1],n[i+2]=e[c+2],i+=o}}function HE(t,e,r,i,s=1){const n=r.typedBuffer,o=r.typedBufferStride,a=t.length;if(i*=o,s===1)for(let l=0;l<a;++l){const c=4*t[l];n[i]=e[c],n[i+1]=e[c+1],n[i+2]=e[c+2],n[i+3]=e[c+3],i+=o}else for(let l=0;l<a;++l){const c=4*t[l];for(let h=0;h<s;++h)n[i]=e[c],n[i+1]=e[c+1],n[i+2]=e[c+2],n[i+3]=e[c+3],i+=o}}function lae(t,e,r){const i=t.typedBuffer,s=t.typedBufferStride;e*=s;for(let n=0;n<r;++n)i[e]=0,i[e+1]=0,i[e+2]=0,i[e+3]=0,e+=s}function tK(t,e,r,i,s,n=1){if(!r)return void zSe(t,e,i,s,n);const o=i.typedBuffer,a=i.typedBufferStride,l=t.length,c=r[0],h=r[1],d=r[2],f=r[4],m=r[5],g=r[6],_=r[8],v=r[9],b=r[10],T=r[12],x=r[13],S=r[14];s*=a;let E=0,A=0,R=0;const M=v8(r)?D=>{E=e[D]+T,A=e[D+1]+x,R=e[D+2]+S}:D=>{const k=e[D],L=e[D+1],N=e[D+2];E=c*k+f*L+_*N+T,A=h*k+m*L+v*N+x,R=d*k+g*L+b*N+S};if(n===1)for(let D=0;D<l;++D)M(3*t[D]),o[s]=E,o[s+1]=A,o[s+2]=R,s+=a;else for(let D=0;D<l;++D){M(3*t[D]);for(let k=0;k<n;++k)o[s]=E,o[s+1]=A,o[s+2]=R,s+=a}}function rK(t,e,r,i,s,n=1){if(!r)return void zSe(t,e,i,s,n);const o=r,a=i.typedBuffer,l=i.typedBufferStride,c=t.length,h=o[0],d=o[1],f=o[2],m=o[4],g=o[5],_=o[6],v=o[8],b=o[9],T=o[10],x=!pJ(o),S=1e-6,E=1-S;s*=l;let A=0,R=0,M=0;const D=v8(o)?k=>{A=e[k],R=e[k+1],M=e[k+2]}:k=>{const L=e[k],N=e[k+1],q=e[k+2];A=h*L+m*N+v*q,R=d*L+g*N+b*q,M=f*L+_*N+T*q};if(n===1)if(x)for(let k=0;k<c;++k){D(3*t[k]);const L=A*A+R*R+M*M;if(L<E&&L>S){const N=1/Math.sqrt(L);a[s]=A*N,a[s+1]=R*N,a[s+2]=M*N}else a[s]=A,a[s+1]=R,a[s+2]=M;s+=l}else for(let k=0;k<c;++k)D(3*t[k]),a[s]=A,a[s+1]=R,a[s+2]=M,s+=l;else for(let k=0;k<c;++k){if(D(3*t[k]),x){const L=A*A+R*R+M*M;if(L<E&&L>S){const N=1/Math.sqrt(L);A*=N,R*=N,M*=N}}for(let L=0;L<n;++L)a[s]=A,a[s+1]=R,a[s+2]=M,s+=l}}function ntt(t,e,r,i,s,n=1){if(!r)return void HE(t,e,i,s,n);const o=r,a=i.typedBuffer,l=i.typedBufferStride,c=t.length,h=o[0],d=o[1],f=o[2],m=o[4],g=o[5],_=o[6],v=o[8],b=o[9],T=o[10],x=!pJ(o),S=1e-6,E=1-S;if(s*=l,n===1)for(let A=0;A<c;++A){const R=4*t[A],M=e[R],D=e[R+1],k=e[R+2],L=e[R+3];let N=h*M+m*D+v*k,q=d*M+g*D+b*k,X=f*M+_*D+T*k;if(x){const G=N*N+q*q+X*X;if(G<E&&G>S){const J=1/Math.sqrt(G);N*=J,q*=J,X*=J}}a[s]=N,a[s+1]=q,a[s+2]=X,a[s+3]=L,s+=l}else for(let A=0;A<c;++A){const R=4*t[A],M=e[R],D=e[R+1],k=e[R+2],L=e[R+3];let N=h*M+m*D+v*k,q=d*M+g*D+b*k,X=f*M+_*D+T*k;if(x){const G=N*N+q*q+X*X;if(G<E&&G>S){const J=1/Math.sqrt(G);N*=J,q*=J,X*=J}}for(let G=0;G<n;++G)a[s]=N,a[s+1]=q,a[s+2]=X,a[s+3]=L,s+=l}}function VSe(t,e,r,i,s,n=1){const o=i.typedBuffer,a=i.typedBufferStride,l=t.length;if(s*=a,r!==e.length||r!==4)if(n!==1)if(r!==4)for(let c=0;c<l;++c){const h=3*t[c];for(let d=0;d<n;++d)o[s]=e[h],o[s+1]=e[h+1],o[s+2]=e[h+2],o[s+3]=255,s+=a}else for(let c=0;c<l;++c){const h=4*t[c];for(let d=0;d<n;++d)o[s]=e[h],o[s+1]=e[h+1],o[s+2]=e[h+2],o[s+3]=e[h+3],s+=a}else{if(r===4){for(let c=0;c<l;++c){const h=4*t[c];o[s]=e[h],o[s+1]=e[h+1],o[s+2]=e[h+2],o[s+3]=e[h+3],s+=a}return}for(let c=0;c<l;++c){const h=3*t[c];o[s]=e[h],o[s+1]=e[h+1],o[s+2]=e[h+2],o[s+3]=255,s+=a}}else{o[s]=e[0],o[s+1]=e[1],o[s+2]=e[2],o[s+3]=e[3];const c=new Uint32Array(i.typedBuffer.buffer,i.start),h=a/4,d=c[s/=4];s+=h;const f=l*n;for(let m=1;m<f;++m)c[s]=d,s+=h}}function ott(t,e,r,i){const s=r.typedBuffer,n=r.typedBufferStride,o=t.length,a=e[0];i*=n;for(let l=0;l<o;++l)s[i]=a,i+=n}function BSe(t,e,r,i,s=1){const n=e.typedBuffer,o=e.typedBufferStride;if(i*=o,s===1)for(let a=0;a<r;++a)n[i]=t[0],n[i+1]=t[1],n[i+2]=t[2],n[i+3]=t[3],i+=o;else for(let a=0;a<r;++a)for(let l=0;l<s;++l)n[i]=t[0],n[i+1]=t[1],n[i+2]=t[2],n[i+3]=t[3],i+=o}function GSe(t,e,r,i,s,n){for(const o of e.fields.keys()){const a=t.vertexAttributes.get(o),l=t.indices.get(o);if(a&&l)jSe(o,a,l,r,i,s,n);else if(o===C.OBJECTANDLAYERIDCOLOR&&t.objectAndLayerIdColor!=null){const c=t.indices.get(C.POSITION);if(ot(!!c,`No buffer view for ${o}`),c){const h=c.length,d=s.getField(o,wa);BSe(t.objectAndLayerIdColor,d,h,n)}}}}function jSe(t,e,r,i,s,n,o){switch(t){case C.POSITION:{ot(e.size===3);const a=n.getField(t,mn);ot(!!a,`No buffer view for ${t}`),a&&tK(r,e.data,i,a,o);break}case C.NORMAL:{ot(e.size===3);const a=n.getField(t,mn);ot(!!a,`No buffer view for ${t}`),a&&rK(r,e.data,s,a,o);break}case C.NORMALCOMPRESSED:{ot(e.size===2);const a=n.getField(t,LP);ot(!!a,`No buffer view for ${t}`),a&&aae(r,e.data,a,o);break}case C.UV0:{ot(e.size===2);const a=n.getField(t,Nv);ot(!!a,`No buffer view for ${t}`),a&&aae(r,e.data,a,o);break}case C.COLOR:case C.SYMBOLCOLOR:{const a=n.getField(t,wa);ot(!!a,`No buffer view for ${t}`),ot(e.size===3||e.size===4),!a||e.size!==3&&e.size!==4||VSe(r,e.data,e.size,a,o);break}case C.COLORFEATUREATTRIBUTE:{const a=n.getField(t,G8);ot(!!a,`No buffer view for ${t}`),ot(e.size===1),a&&e.size===1&&ott(r,e.data,a,o);break}case C.TANGENT:{ot(e.size===4);const a=n.getField(t,Ip);ot(!!a,`No buffer view for ${t}`),a&&ntt(r,e.data,s,a,o);break}case C.PROFILERIGHT:case C.PROFILEUP:case C.PROFILEVERTEXANDNORMAL:case C.FEATUREVALUE:{ot(e.size===4);const a=n.getField(t,Ip);ot(!!a,`No buffer view for ${t}`),a&&HE(r,e.data,a,o)}}}function $M(t,e,r=0){const i=ve(t,0,ctt);for(let s=0;s<4;s++)e[r+s]=Math.floor(256*utt(i*att[s]))}function iK(t,e=0){let r=0;for(let i=0;i<4;i++)r+=t[e+i]*ltt[i];return r}const att=[1,256,65536,16777216],ltt=[1/256,1/65536,1/16777216,1/4294967296],ctt=iK(new Uint8ClampedArray([255,255,255,255]));function utt(t){return t-Math.floor(t)}async function E0(t,e){const{data:r}=await ur(t,{responseType:"image",...e});return r}function htt(){if(rz==null){const t=e=>jr(`esri/libs/basisu/${e}`);rz=he(()=>import("./basis_transcoder-68aed835.js"),[],import.meta.url).then(e=>e.b).then(({default:e})=>e({locateFile:t}).then(r=>(r.initializeBasis(),delete r.then,r)))}return rz}let rz;var jb;(function(t){t[t.ETC1_RGB=0]="ETC1_RGB",t[t.ETC2_RGBA=1]="ETC2_RGBA",t[t.BC1_RGB=2]="BC1_RGB",t[t.BC3_RGBA=3]="BC3_RGBA",t[t.BC4_R=4]="BC4_R",t[t.BC5_RG=5]="BC5_RG",t[t.BC7_M6_RGB=6]="BC7_M6_RGB",t[t.BC7_M5_RGBA=7]="BC7_M5_RGBA",t[t.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",t[t.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",t[t.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",t[t.ATC_RGB=11]="ATC_RGB",t[t.ATC_RGBA=12]="ATC_RGBA",t[t.FXT1_RGB=17]="FXT1_RGB",t[t.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",t[t.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",t[t.ETC2_EAC_R11=20]="ETC2_EAC_R11",t[t.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",t[t.RGBA32=13]="RGBA32",t[t.RGB565=14]="RGB565",t[t.BGR565=15]="BGR565",t[t.RGBA4444=16]="RGBA4444"})(jb||(jb={}));let xp=null,U$=null;async function HSe(){return U$==null&&(U$=htt(),xp=await U$),U$}function dtt(t,e){if(xp==null)return t.byteLength;const r=new xp.BasisFile(new Uint8Array(t)),i=WSe(r)?qSe(r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),e):0;return r.close(),r.delete(),i}function ptt(t,e){if(xp==null)return t.byteLength;const r=new xp.KTX2File(new Uint8Array(t)),i=XSe(r)?qSe(r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),e):0;return r.close(),r.delete(),i}function qSe(t,e,r,i,s){const n=ZJ(e?gs.COMPRESSED_RGBA8_ETC2_EAC:gs.COMPRESSED_RGB8_ETC2),o=s&&t>1?(4**t-1)/(3*4**(t-1)):1;return Math.ceil(r*i*n*o)}function WSe(t){return t.getNumImages()>=1&&!t.isUASTC()}function XSe(t){return t.getFaces()>=1&&t.isETC1S()}async function ftt(t,e,r){xp==null&&(xp=await HSe());const i=new xp.BasisFile(new Uint8Array(r));if(!WSe(i))return null;i.startTranscoding();const s=YSe(t,e,i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),(n,o)=>i.getImageTranscodedSizeInBytes(0,n,o),(n,o,a)=>i.transcodeImage(a,0,n,o,0,0));return i.close(),i.delete(),s}async function mtt(t,e,r){xp==null&&(xp=await HSe());const i=new xp.KTX2File(new Uint8Array(r));if(!XSe(i))return null;i.startTranscoding();const s=YSe(t,e,i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),(n,o)=>i.getImageTranscodedSizeInBytes(n,0,0,o),(n,o,a)=>i.transcodeImage(a,n,0,0,o,0,-1,-1));return i.close(),i.delete(),s}function YSe(t,e,r,i,s,n,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=t.capabilities,[h,d]=l?i?[jb.ETC2_RGBA,gs.COMPRESSED_RGBA8_ETC2_EAC]:[jb.ETC1_RGB,gs.COMPRESSED_RGB8_ETC2]:c?i?[jb.BC3_RGBA,gs.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[jb.BC1_RGB,gs.COMPRESSED_RGB_S3TC_DXT1_EXT]:[jb.RGBA32,Ct.RGBA],f=e.hasMipmap?r:Math.min(1,r),m=[];for(let g=0;g<f;g++)m.push(new Uint8Array(o(g,h))),a(g,h,m[g]);return e.internalFormat=d,e.hasMipmap=m.length>1,e.samplingMode=e.hasMipmap?Rt.LINEAR_MIPMAP_LINEAR:Rt.LINEAR,e.width=s,e.height=n,new Ot(t,e,{type:"compressed",levels:m})}const k$=K.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),gtt=542327876,ytt=131072,_tt=4;function sK(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function vtt(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)}const btt=sK("DXT1"),wtt=sK("DXT3"),xtt=sK("DXT5"),Ttt=31,Stt=0,Ett=1,Ctt=2,Att=3,Ott=4,Rtt=7,Mtt=20,Ptt=21;function Itt(t,e,r){const i=$tt(r,e.hasMipmap??!1);if(i==null)throw new Error("DDS texture data is null");const{textureData:s,internalFormat:n,width:o,height:a}=i;return e.samplingMode=s.levels.length>1?Rt.LINEAR_MIPMAP_LINEAR:Rt.LINEAR,e.hasMipmap=s.levels.length>1,e.internalFormat=n,e.width=o,e.height=a,new Ot(t,e,s)}function $tt(t,e){const r=new Int32Array(t,0,Ttt);if(r[Stt]!==gtt)return k$.error("Invalid magic number in DDS header"),null;if(!(r[Mtt]&_tt))return k$.error("Unsupported format, must contain a FourCC code"),null;const i=r[Ptt];let s,n;switch(i){case btt:s=8,n=gs.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case wtt:s=16,n=gs.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case xtt:s=16,n=gs.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return k$.error("Unsupported FourCC code:",vtt(i)),null}let o=1,a=r[Ott],l=r[Att];!(3&a)&&!(3&l)||(k$.warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,h=l;let d,f;r[Ctt]&ytt&&e!==!1&&(o=Math.max(1,r[Rtt]));let m=r[Ett]+4;const g=[];for(let _=0;_<o;++_)f=(a+3>>2)*(l+3>>2)*s,d=new Uint8Array(t,m,f),g.push(d),m+=f,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:g},internalFormat:n,width:c,height:h}}let Nx=class extends DP{constructor(e,r){super(),this._data=e,this.type=us.Texture,this._glTexture=null,this._loadingPromise=null,this._loadingController=null,this.events=new Ts,this.parameters=r||{},this.parameters.mipmap=this.parameters.mipmap!==!1,this.parameters.noUnpackFlip=this.parameters.noUnpackFlip||!1,this.parameters.preMultiplyAlpha=this.parameters.preMultiplyAlpha||!1,this.parameters.wrap=this.parameters.wrap||{s:Dt.REPEAT,t:Dt.REPEAT},this._startPreload(e)}_startPreload(e){e!=null&&(e instanceof HTMLVideoElement?this._startPreloadVideoElement(e):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!(sv(e.src)||e.preload==="auto"&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";const r=!e.paused;if(e.src=e.src,r&&e.autoplay){const i=()=>{e.removeEventListener("canplay",i),e.play()};e.addEventListener("canplay",i)}}}_startPreloadImageElement(e){Am(e.src)||sv(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}dispose(){this._data=void 0}_createDescriptor(e){const r=new xr;return r.wrapMode=this.parameters.wrap??Dt.REPEAT,r.flipped=!this.parameters.noUnpackFlip,r.samplingMode=this.parameters.mipmap?Rt.LINEAR_MIPMAP_LINEAR:Rt.LINEAR,r.hasMipmap=!!this.parameters.mipmap,r.preMultiplyAlpha=!!this.parameters.preMultiplyAlpha,r.maxAnisotropy=this.parameters.maxAnisotropy??(this.parameters.mipmap?e.parameters.maxMaxAnisotropy:1),r}get glTexture(){return this._glTexture}get memoryEstimate(){return this._glTexture?.gpuMemoryUsage||Ltt(this._data,this.parameters)}load(e){if(this._glTexture!=null)return this._glTexture;if(this._loadingPromise)return this._loadingPromise;const r=this._data;return r==null?(this._glTexture=new Ot(e,this._createDescriptor(e),null),this._glTexture):typeof r=="string"?this._loadFromURL(e,r):r instanceof Image?this._loadFromImageElement(e,r):r instanceof HTMLVideoElement?this._loadFromVideoElement(e,r):r instanceof ImageData||r instanceof HTMLCanvasElement?this._loadFromImage(e,r):(gA(r)||I_(r))&&this.parameters.encoding===e0.DDS_ENCODING?(this._data=void 0,this._loadFromDDSData(e,r)):(gA(r)||I_(r))&&this.parameters.encoding===e0.KTX2_ENCODING?(this._data=void 0,this._loadFromKTX2(e,r)):(gA(r)||I_(r))&&this.parameters.encoding===e0.BASIS_ENCODING?(this._data=void 0,this._loadFromBasis(e,r)):I_(r)?this._loadFromPixelData(e,r):gA(r)?this._loadFromPixelData(e,new Uint8Array(r)):null}get requiresFrameUpdates(){return this._data instanceof HTMLVideoElement}frameUpdate(e){return this._data instanceof HTMLVideoElement&&this._glTexture!=null?this._data.readyState<OR.HAVE_CURRENT_DATA||e===this._data.currentTime?e:(this._glTexture.setData(this._data),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this.parameters.updateCallback&&this.parameters.updateCallback(),this._data.currentTime):e}_loadFromDDSData(e,r){return this._glTexture=Itt(e,this._createDescriptor(e),r),this._glTexture}_loadFromKTX2(e,r){return this._loadAsync(()=>mtt(e,this._createDescriptor(e),r).then(i=>(this._glTexture=i,i)))}_loadFromBasis(e,r){return this._loadAsync(()=>ftt(e,this._createDescriptor(e),r).then(i=>(this._glTexture=i,i)))}_loadFromPixelData(e,r){ot(this.parameters.width>0&&this.parameters.height>0);const i=this._createDescriptor(e);return i.pixelFormat=this.parameters.components===1?Ct.LUMINANCE:this.parameters.components===3?Ct.RGB:Ct.RGBA,i.width=this.parameters.width??0,i.height=this.parameters.height??0,this._glTexture=new Ot(e,i,r),this._glTexture}_loadFromURL(e,r){return this._loadAsync(async i=>{const s=await E0(r,{signal:i});return Yt(i),this._loadFromImage(e,s)})}_loadFromImageElement(e,r){return r.complete?this._loadFromImage(e,r):this._loadAsync(async i=>{const s=await iye(r,r.src,!1,i);return Yt(i),this._loadFromImage(e,s)})}_loadFromVideoElement(e,r){return r.readyState>=OR.HAVE_CURRENT_DATA?this._loadFromImage(e,r):this._loadFromVideoElementAsync(e,r)}_loadFromVideoElementAsync(e,r){return this._loadAsync(i=>new Promise((s,n)=>{const o=()=>{r.removeEventListener("loadeddata",a),r.removeEventListener("error",l),Fi(c)},a=()=>{r.readyState>=OR.HAVE_CURRENT_DATA&&(o(),s(this._loadFromImage(e,r)))},l=h=>{o(),n(h||new U("Failed to load video"))};r.addEventListener("loadeddata",a),r.addEventListener("error",l);const c=ya(i,()=>l(zr()))}))}_loadFromImage(e,r){const i=ZSe(r);this.parameters.width=i.width,this.parameters.height=i.height;const s=this._createDescriptor(e);return s.pixelFormat=this.parameters.components===3?Ct.RGB:Ct.RGBA,s.width=i.width,s.height=i.height,this._glTexture=new Ot(e,s,r),this._glTexture}_loadAsync(e){const r=new AbortController;this._loadingController=r;const i=e(r.signal);this._loadingPromise=i;const s=()=>{this._loadingController===r&&(this._loadingController=null),this._loadingPromise===i&&(this._loadingPromise=null)};return i.then(s,s),i}unload(){if(this._glTexture=je(this._glTexture),this._loadingController!=null){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}};function Ltt(t,e){if(t==null)return 0;if(gA(t)||I_(t))return e.encoding===e0.KTX2_ENCODING?ptt(t,!!e.mipmap):e.encoding===e0.BASIS_ENCODING?dtt(t,!!e.mipmap):t.byteLength;const{width:r,height:i}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?ZSe(t):e;return(e.mipmap?4/3:1)*r*i*(e.components||4)||0}function ZSe(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}var OR;(function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(OR||(OR={}));const LM=128,nK=.5;function Dtt(t,e=LM,r=e*nK,i=0){const s=JSe(t,e,r,i);return new Nx(s,{mipmap:!1,wrap:{s:Dt.CLAMP_TO_EDGE,t:Dt.CLAMP_TO_EDGE},width:e,height:e,components:4,noUnpackFlip:!0})}function JSe(t,e=LM,r=e*nK,i=0){switch(t){case"circle":default:return Ntt(e,r);case"square":return Ftt(e,r);case"cross":return ktt(e,r,i);case"x":return ztt(e,r,i);case"kite":return Utt(e,r);case"triangle":return Vtt(e,r);case"arrow":return Btt(e,r)}}function Ntt(t,e){const r=t/2-.5;return VP(t,eEe(r,r,e/2))}function Ftt(t,e){return QSe(t,e,!1)}function Utt(t,e){return QSe(t,e,!0)}function ktt(t,e,r=0){return KSe(t,e,!1,r)}function ztt(t,e,r=0){return KSe(t,e,!0,r)}function Vtt(t,e){return VP(t,tEe(t/2,e,e/2))}function Btt(t,e){const r=e,i=e/2,s=t/2,n=.8*r,o=eEe(s,(t-e)/2-n,Math.sqrt(n*n+i*i)),a=tEe(s,r,i);return VP(t,(l,c)=>Math.max(a(l,c),-o(l,c)))}function QSe(t,e,r){return r&&(e/=Math.SQRT2),VP(t,(i,s)=>{let n=i-.5*t+.25,o=.5*t-s-.75;if(r){const a=(n+o)/Math.SQRT2;o=(o-n)/Math.SQRT2,n=a}return Math.max(Math.abs(n),Math.abs(o))-.5*e})}function KSe(t,e,r,i=0){e-=i,r&&(e*=Math.SQRT2);const s=.5*e;return VP(t,(n,o)=>{let a,l=n-.5*t,c=.5*t-o-1;if(r){const h=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=h}return l=Math.abs(l),c=Math.abs(c),a=l>c?l>s?Math.sqrt((l-s)*(l-s)+c*c):c:c>s?Math.sqrt(l*l+(c-s)*(c-s)):l,a-=i/2,a})}function eEe(t,e,r){return(i,s)=>{const n=i-t,o=s-e;return Math.sqrt(n*n+o*o)-r}}function tEe(t,e,r){const i=Math.sqrt(e*e+r*r);return(s,n)=>{const o=Math.abs(s-t)-r,a=n-t+e/2+.75,l=(e*o+r*a)/i,c=-a;return Math.max(l,c)}}function VP(t,e){const r=new Uint8Array(4*t*t);for(let i=0;i<t;i++)for(let s=0;s<t;s++){const n=s+t*i;let o=e(s,i);o=o/t+.5,$M(o,r,4*n)}return r}let rkt=class extends ii{constructor(e){super(),this.slicePlaneLocalOrigin=e}};function Gtt(t,e){rEe(t,e,new kt("slicePlaneOrigin",(r,i)=>oEe(e,r,i)),new kt("slicePlaneBasis1",(r,i)=>fF(e,r,i,i.slicePlane?.basis1)),new kt("slicePlaneBasis2",(r,i)=>fF(e,r,i,i.slicePlane?.basis2)))}function vs(t,e){rEe(t,e,new Ou("slicePlaneOrigin",(r,i)=>oEe(e,r,i)),new Ou("slicePlaneBasis1",(r,i)=>fF(e,r,i,i.slicePlane?.basis1)),new Ou("slicePlaneBasis2",(r,i)=>fF(e,r,i,i.slicePlane?.basis2)))}function rEe(t,e,...r){if(!e.hasSlicePlane){const o=w`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return e.hasSliceInVertexProgram&&t.vertex.code.add(o),void t.fragment.code.add(o)}e.hasSliceInVertexProgram&&t.vertex.uniforms.add(...r),t.fragment.uniforms.add(...r);const i=w`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,s=w`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,n=e.hasSliceHighlight?w`
        ${s}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:w`#define highlightSlice(_color_, _pos_) (_color_)`;e.hasSliceInVertexProgram&&t.vertex.code.add(i),t.fragment.code.add(i),t.fragment.code.add(n)}function iEe(t,e,r){return t.instancedDoublePrecision?ne(jtt,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]):e.slicePlaneLocalOrigin}function sEe(t,e){return t!=null?fe(mF,e.origin,t):e.origin}function nEe(t,e,r){return t.hasSliceTranslatedView?e!=null?Gl(Htt,r.camera.viewMatrix,e):r.camera.viewMatrix:null}function oEe(t,e,r){if(r.slicePlane==null)return sl;const i=iEe(t,e,r),s=sEe(i,r.slicePlane),n=nEe(t,i,r);return n!=null?ze(mF,s,n):s}function fF(t,e,r,i){if(i==null||r.slicePlane==null)return sl;const s=iEe(t,e,r),n=sEe(s,r.slicePlane),o=nEe(t,s,r);return o!=null?(de(C3,i,n),ze(mF,n,o),ze(C3,C3,o),fe(C3,C3,mF)):i}const jtt=O(),mF=O(),C3=O(),Htt=xe();function BP(t,e){const r=e.output===F.ObjectAndLayerIdColor,i=e.objectAndLayerIdColorInstanced;r&&(t.varyings.add("objectAndLayerIdColorVarying","vec4"),i?t.attributes.add(C.INSTANCEOBJECTANDLAYERIDCOLOR,"vec4"):t.attributes.add(C.OBJECTANDLAYERIDCOLOR,"vec4")),t.vertex.code.add(w`
     void forwardObjectAndLayerIdColor() {
      ${r?i?w`objectAndLayerIdColorVarying = instanceObjectAndLayerIdColor * 0.003921568627451;`:w`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:w``} }`),t.fragment.code.add(w`
      void outputObjectAndLayerIdColor() {
        ${r?w`fragColor = objectAndLayerIdColorVarying;`:w``} }`)}function qtt(t,e){const{vertex:r,fragment:i}=t;r.include(u9),e.hasMultipassGeometry&&r.include(nTe),e.hasMultipassTerrain&&t.varyings.add("depth","float"),r.code.add(w`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${e.hasMultipassGeometry?w`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${e.hasMultipassTerrain?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),e.hasMultipassTerrain&&i.include(Nu),e.hasMultipassTerrain&&i.uniforms.add(new rt("terrainDepthTexture",(s,n)=>n.multipassTerrain.linearDepthTexture),new Ar("nearFar",(s,n)=>n.camera.nearFar)),i.include(Bc),i.code.add(w`
  void main() {
    fragColor = vec4(1);
    ${e.hasMultipassTerrain?w`
          // Read the rgba data from the texture linear depth
          vec4 terrainDepthData = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0);

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          // If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          // Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            fragColor.g = 0.5;
          }`:""}
  }
  `)}const Wtt=Nt(1,1,0,1),aEe=Nt(1,0,1,1);function z0(t){t.fragment.uniforms.add(new rt("depthTexture",(e,r)=>r.highlightDepthTexture)),t.fragment.constants.add("occludedHighlightFlag","vec4",Wtt).add("unoccludedHighlightFlag","vec4",aEe),t.fragment.code.add(w`void outputHighlight() {
float sceneDepth = float(texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x);
if (gl_FragCoord.z > sceneDepth + 5e-7) {
fragColor = occludedHighlightFlag;
} else {
fragColor = unoccludedHighlightFlag;
}
}`)}let lEe=class extends ps{constructor(e,r,i){super(e,"vec4",ti.Pass,(s,n,o)=>s.setUniform4fv(e,r(n,o)),i)}},$l=class extends ps{constructor(e,r,i){super(e,"float",ti.Pass,(s,n,o)=>s.setUniform1fv(e,r(n,o)),i)}};const qE={unknown:1,inches:Uo(1,"meters","inches"),feet:Uo(1,"meters","feet"),"us-feet":Uo(1,"meters","us-feet"),yards:Uo(1,"meters","yards"),miles:Uo(1,"meters","miles"),"nautical-miles":Uo(1,"meters","nautical-miles"),millimeters:Uo(1,"meters","millimeters"),centimeters:Uo(1,"meters","centimeters"),decimeters:Uo(1,"meters","decimeters"),meters:Uo(1,"meters","meters"),kilometers:Uo(1,"meters","kilometers"),"decimal-degrees":1/F5e(1,"meters",nr.radius)};var ha,cae;(function(t){t[t.Undefined=0]="Undefined",t[t.DefinedSize=1]="DefinedSize",t[t.DefinedScale=2]="DefinedScale"})(ha||(ha={})),function(t){t[t.Undefined=0]="Undefined",t[t.DefinedAngle=1]="DefinedAngle"}(cae||(cae={}));let oK=class{constructor(e){this.field=e}},Xtt=class extends oK{constructor(e){super(e),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[ha.Undefined,ha.Undefined,ha.Undefined]}},Ytt=class extends oK{constructor(e){super(e),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0]}},Ztt=class extends oK{constructor(e){super(e),this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}},Jtt=class{};function A3(t){return t!=null}function hT(t){return typeof t=="number"}function h9(t){return typeof t=="string"}function Qtt(t){return t==null||h9(t)}function un(t,e){t&&t.push(e)}function Ktt(t,e,r,i=xe()){const s=t||0,n=e||0,o=r||0;return s!==0&&CE(i,i,-s/180*Math.PI),n!==0&&EE(i,i,n/180*Math.PI),o!==0&&y8(i,i,o/180*Math.PI),i}function uy(t,e,r,i,s){const n=t.minSize,o=t.maxSize;if(t.expression)return un(s,"Could not convert size info: expression not supported"),!1;if(t.useSymbolValue){const a=i.symbolSize[r];return e.minSize[r]=a,e.maxSize[r]=a,e.offset[r]=e.minSize[r],e.factor[r]=0,e.type[r]=ha.DefinedSize,!0}if(A3(t.field))return A3(t.stops)?t.stops.length===2&&hT(t.stops[0].size)&&hT(t.stops[1].size)?(uae(t.stops[0].size,t.stops[1].size,t.stops[0].value,t.stops[1].value,e,r),e.type[r]=ha.DefinedSize,!0):(un(s,"Could not convert size info: stops only supported with 2 elements"),!1):hT(n)&&hT(o)&&A3(t.minDataValue)&&A3(t.maxDataValue)?(uae(n,o,t.minDataValue,t.maxDataValue,e,r),e.type[r]=ha.DefinedSize,!0):t.valueUnit==="unknown"?(un(s,"Could not convert size info: proportional size not supported"),!1):qE[t.valueUnit]!=null?(e.minSize[r]=-1/0,e.maxSize[r]=1/0,e.offset[r]=0,e.factor[r]=1/qE[t.valueUnit],e.type[r]=ha.DefinedSize,!0):(un(s,"Could not convert size info: scale-dependent size not supported"),!1);if(!A3(t.field)){if(t.stops&&t.stops[0]&&hT(t.stops[0].size))return e.minSize[r]=t.stops[0].size,e.maxSize[r]=t.stops[0].size,e.offset[r]=e.minSize[r],e.factor[r]=0,e.type[r]=ha.DefinedSize,!0;if(hT(n))return e.minSize[r]=n,e.maxSize[r]=n,e.offset[r]=n,e.factor[r]=0,e.type[r]=ha.DefinedSize,!0}return un(s,"Could not convert size info: unsupported variant of sizeInfo"),!1}function uae(t,e,r,i,s,n){const o=Math.abs(i-r)>0?(e-t)/(i-r):0;s.minSize[n]=o>0?t:e,s.maxSize[n]=o>0?e:t,s.offset[n]=t-r*o,s.factor[n]=o}function ert(t,e,r,i){if(t.normalizationField||t.valueRepresentation)return un(i,"Could not convert size info: unsupported property"),null;if(!Qtt(t.field))return un(i,"Could not convert size info: field is not a string"),null;if(e.size){if(t.field)if(e.size.field){if(t.field!==e.size.field)return un(i,"Could not convert size info: multiple fields in use"),null}else e.size.field=t.field}else e.size=new Xtt(t.field);let s;switch(t.axis){case"width":return s=uy(t,e.size,0,r,i),s?e:null;case"height":return s=uy(t,e.size,2,r,i),s?e:null;case"depth":return s=uy(t,e.size,1,r,i),s?e:null;case"width-and-depth":return s=uy(t,e.size,0,r,i),s&&uy(t,e.size,1,r,i),s?e:null;case null:case void 0:case"all":return s=uy(t,e.size,0,r,i),s=s&&uy(t,e.size,1,r,i),s=s&&uy(t,e.size,2,r,i),s?e:null;default:return un(i,`Could not convert size info: unknown axis "${t.axis}""`),null}}function trt(t,e,r){for(let s=0;s<3;++s){let n=e.unitInMeters;t.type[s]===ha.DefinedSize&&(n*=e.modelSize[s],t.type[s]=ha.DefinedScale),t.minSize[s]=t.minSize[s]/n,t.maxSize[s]=t.maxSize[s]/n,t.offset[s]=t.offset[s]/n,t.factor[s]=t.factor[s]/n}let i;if(t.type[0]!==ha.Undefined)i=0;else if(t.type[1]!==ha.Undefined)i=1;else{if(t.type[2]===ha.Undefined)return un(r,"No size axis contains a valid size or scale"),!1;i=2}for(let s=0;s<3;++s)t.type[s]===ha.Undefined&&(t.minSize[s]=t.minSize[i],t.maxSize[s]=t.maxSize[i],t.offset[s]=t.offset[i],t.factor[s]=t.factor[i],t.type[s]=t.type[i]);return!0}function hae(t,e,r){t[4*e]=r.r/255,t[4*e+1]=r.g/255,t[4*e+2]=r.b/255,t[4*e+3]=r.a}function rrt(t,e,r){if(t.normalizationField)return un(r,"Could not convert color info: unsupported property"),null;if(h9(t.field)){if(!t.stops)return un(r,"Could not convert color info: missing stops or colors"),null;{if(t.stops.length>8)return un(r,"Could not convert color info: too many color stops"),null;e.color=new Ytt(t.field);const i=t.stops;for(let s=0;s<8;++s){const n=i[Math.min(s,i.length-1)];e.color.values[s]=n.value,hae(e.color.colors,s,n.color)}}}else{if(!(t.stops&&t.stops.length>=0))return un(r,"Could not convert color info: no field and no colors/stops"),null;{const i=t.stops&&t.stops.length>=0&&t.stops[0].color;e.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)e.color.values[s]=1/0,hae(e.color.colors,s,i)}}return e}function irt(t,e,r){if(t.normalizationField)return un(r,"Could not convert opacity info: unsupported property"),null;if(h9(t.field)){if(!t.stops)return un(r,"Could not convert opacity info: missing stops or opacities"),null;{if(t.stops.length>8)return un(r,"Could not convert opacity info: too many opacity stops"),null;e.opacity=new Ztt(t.field);const i=t.stops;for(let s=0;s<8;++s){const n=i[Math.min(s,i.length-1)];e.opacity.values[s]=n.value,e.opacity.opacityValues[s]=n.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return un(r,"Could not convert opacity info: no field and no opacities/stops"),null;{const i=t.stops&&t.stops.length>=0?t.stops[0].opacity:0;e.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)e.opacity.values[s]=1/0,e.opacity.opacityValues[s]=i}}return e}function iz(t,e,r){const i=r===2&&t.rotationType==="arithmetic";e.offset[r]=i?90:0,e.factor[r]=i?-1:1,e.type[r]=1}function srt(t,e,r){if(!h9(t.field))return un(r,"Could not convert rotation info: field is not a string"),null;if(e.rotation){if(t.field)if(e.rotation.field){if(t.field!==e.rotation.field)return un(r,"Could not convert rotation info: multiple fields in use"),null}else e.rotation.field=t.field}else e.rotation={field:t.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(t.axis){case"tilt":return iz(t,e.rotation,0),e;case"roll":return iz(t,e.rotation,1),e;case null:case void 0:case"heading":return iz(t,e.rotation,2),e;default:return un(r,`Could not convert rotation info: unknown axis "${t.axis}""`),null}}let GP=class{constructor(e,r=[1,1,1],i=[1,1,1],s=1,n=[0,0,0],o=[1,1,1],a=[0,0,0]){this.supports=e,this.modelSize=r,this.symbolSize=i,this.unitInMeters=s,this.anchor=n,this.scale=o,this.rotation=a}};function cEe(t,e,r){if(!t)return null;const i=t.reduce((s,n)=>{if(!s)return s;if(n.valueExpression)return un(r,"Could not convert visual variables: arcade expressions not supported"),null;switch(n.type){case"size":return e.supports.size?ert(n,s,e,r):s;case"color":return e.supports.color?rrt(n,s,r):s;case"opacity":return e.supports.opacity?irt(n,s,r):null;case"rotation":return e.supports.rotation?srt(n,s,r):s;default:return null}},new Jtt);return!(t.length>0&&i)||i.size||i.color||i.opacity||i.rotation?i&&i.size&&!trt(i.size,e,r)?null:i:null}let nrt=class{constructor(e,r,i){this.visualVariables=e,this.materialParameters=r,this.requiresShaderTransformation=i}};function WE(t,e){if(!t||li.TESTS_DISABLE_FAST_UPDATES)return null;const r=cEe(t.visualVariables,e);return r?new nrt(r,hEe(r,e),!!r.size):null}function XE(t,e,r){if(!e||!t)return!1;const i=t.visualVariables,s=cEe(e.visualVariables,r);return!!s&&!!(z$(i.size,s.size,"size")&&z$(i.color,s.color,"color")&&z$(i.rotation,s.rotation,"rotation")&&z$(i.opacity,s.opacity,"opacity"))&&(t.visualVariables=s,t.materialParameters=hEe(s,r),t.requiresShaderTransformation=!!s.size,!0)}function z$(t,e,r){if(!!t!=!!e||t&&t.field!==e?.field)return!1;if(t&&r==="rotation"){const i=t,s=e;for(let n=0;n<3;n++)if(i.type[n]!==s.type[n]||i.offset[n]!==s.offset[n]||i.factor[n]!==s.factor[n])return!1}return!0}let uEe=class extends ii{constructor(e){super(),this.vvSize=e?.size??null,this.vvColor=e?.color??null,this.vvOpacity=e?.opacity??null}};function hEe(t,e){const r=new uEe(t);return r.vvSize&&(r.vvSymbolAnchor=e.anchor,Yh(RR),Ktt(e.rotation[2],e.rotation[0],e.rotation[1],RR),r.vvSymbolRotationMatrix=r.vvSymbolRotationMatrix||ki(),Jh(r.vvSymbolRotationMatrix,RR)),r}function cq(t,e,r){if(!t.vvSize)return r;zs(hy,r);const i=t.vvSymbolRotationMatrix;Pm(RR,i[0],i[1],i[2],0,i[3],i[4],i[5],0,i[6],i[7],i[8],0,0,0,0,1),ai(hy,hy,RR);for(let s=0;s<3;++s){const n=t.vvSize.offset[s]+e[0]*t.vvSize.factor[s];dae[s]=ve(n,t.vvSize.minSize[s],t.vvSize.maxSize[s])}return g8(hy,hy,dae),Gl(hy,hy,t.vvSymbolAnchor),hy}function ort(t,e,r){if(e.vvSize)for(let i=0;i<3;++i){const s=e.vvSize.offset[i]+r[0]*e.vvSize.factor[i];t[i]=ve(s,e.vvSize.minSize[i],e.vvSize.maxSize[i])}else ne(t,1,1,1)}function Tp(t,e){const r=t==null?0:e.attributes[t];return typeof r=="number"&&isFinite(r)?r:0}const hy=xe(),dae=O(),RR=xe();let jP=class extends uEe{constructor(){super(...arguments),this.renderOccluded=Ni.Occlude}};const GS=8;function r0(t,e){const{vertex:r,attributes:i}=t;e.hasVvInstancing&&(e.vvSize||e.vvColor)&&i.add(C.INSTANCEFEATUREATTRIBUTE,"vec4"),e.vvSize?(r.uniforms.add(new kt("vvSizeMinSize",s=>s.vvSize.minSize)),r.uniforms.add(new kt("vvSizeMaxSize",s=>s.vvSize.maxSize)),r.uniforms.add(new kt("vvSizeOffset",s=>s.vvSize.offset)),r.uniforms.add(new kt("vvSizeFactor",s=>s.vvSize.factor)),r.uniforms.add(new sd("vvSymbolRotationMatrix",s=>s.vvSymbolRotationMatrix)),r.uniforms.add(new kt("vvSymbolAnchor",s=>s.vvSymbolAnchor)),r.code.add(w`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),r.code.add(w`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${e.hasVvInstancing?w`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):r.code.add(w`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),e.vvColor?(r.constants.add("vvColorNumber","int",GS),r.uniforms.add(new $l("vvColorValues",s=>s.vvColor.values,GS),new lEe("vvColorColors",s=>s.vvColor.colors,GS)),r.code.add(w`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${e.hasVvInstancing?w`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):r.code.add(w`vec4 vvColor() { return vec4(1.0); }`)}const gF=.1,bo=.001;function art(t){const e=new Sr,r=t.signedDistanceFieldEnabled;if(e.include(MSe,t),e.include(vs,t),t.occlusionPass)return e.include(qtt,t),e;const{vertex:i,fragment:s}=e;e.include(YQ),s.include(Bc),s.include(Lm),e.include(r0,t),e.include(BP,t),e.varyings.add("vcolor","vec4"),e.varyings.add("vtc","vec2"),e.varyings.add("vsize","vec2"),t.binaryHighlightOcclusionEnabled&&e.varyings.add("voccluded","float"),i.uniforms.add(new sr("viewport",(c,h)=>h.camera.fullViewport),new Ar("screenOffset",(c,h)=>or(dEe,2*c.screenOffset[0]*h.camera.pixelRatio,2*c.screenOffset[1]*h.camera.pixelRatio)),new Ar("anchorPosition",c=>yF(c)),new sr("materialColor",c=>c.color)),zC(i,t),r&&(i.uniforms.add(new sr("outlineColor",c=>c.outlineColor)),s.uniforms.add(new sr("outlineColor",c=>pae(c)?c.outlineColor:rm),new Ie("outlineSize",c=>pae(c)?c.outlineSize:0))),t.hasScreenSizePerspective&&(Yet(i),c9(i)),(t.debugDrawLabelBorder||t.binaryHighlightOcclusionEnabled)&&e.varyings.add("debugBorderCoords","vec4"),e.attributes.add(C.UV0,"vec2"),e.attributes.add(C.COLOR,"vec4"),e.attributes.add(C.SIZE,"vec2"),e.attributes.add(C.AUXPOS2,"vec4"),i.code.add(w`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${t.hasScreenSizePerspective?w`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:w`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${t.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${t.occlusionTestEnabled||t.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${t.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const n=w`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`;t.pixelSnappingEnabled&&i.include(u9);const o=t.pixelSnappingEnabled?r?w`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:w`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:w`posProj += quadOffset;`;i.code.add(w`
    ${t.occlusionTestEnabled?"if (visible) {":""}
    ${n}
    ${t.vvColor?"vcolor = interpolateVVColor(auxpos2.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${t.output===F.ObjectAndLayerIdColor?w`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${w.float(bo)};
    ${r?`alphaDiscard = alphaDiscard && outlineColor.a < ${w.float(bo)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${o}
      gl_Position = posProj;
    }

    vtc = uv;

    ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${t.occlusionTestEnabled?w`} else { vtc = vec2(0.0);
      ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),s.uniforms.add(new rt("tex",c=>c.texture));const a=t.debugDrawLabelBorder?w`(isBorder > 0.0 ? 0.0 : ${w.float(gF)})`:w.float(gF),l=w`
    ${t.debugDrawLabelBorder?w`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${r?w`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${w.float(LM)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${w.float(bo)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        fragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        fragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:w`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          fragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${t.debugDrawLabelBorder?w`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;return t.output===F.Alpha&&s.code.add(w`
      void main() {
        ${l}
        fragColor = vec4(fragColor.a);
      }
      `),t.output===F.ObjectAndLayerIdColor&&s.code.add(w`
      void main() {
        ${l}
        outputObjectAndLayerIdColor();
      }
      `),t.output===F.Color&&s.code.add(w`
    void main() {
      ${l}
      ${t.transparencyPassType===dt.FrontFace?"fragColor.rgb /= fragColor.a;":""}
    }
    `),t.output===F.Highlight&&(e.include(z0,t),s.code.add(w`
    void main() {
      ${l}
      ${t.binaryHighlightOcclusionEnabled?w`
          if (voccluded == 1.0) {
            fragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            fragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),e}function pae(t){return t.outlineColor[3]>0&&t.outlineSize>0}function yF(t,e=dEe){return t.textureIsSignedDistanceField?lrt(t.anchorPosition,t.distanceFieldBoundingBox,e):yn(e,t.anchorPosition),e}function lrt(t,e,r){e!=null?or(r,t[0]*(e[2]-e[0])+e[0],t[1]*(e[3]-e[1])+e[1]):or(r,0,0)}const dEe=He(),crt=Object.freeze(Object.defineProperty({__proto__:null,build:art,calculateAnchorPosForRendering:yF},Symbol.toStringTag,{value:"Module"})),Ru=Oo(Se.SRC_ALPHA,Se.ONE,Se.ONE_MINUS_SRC_ALPHA,Se.ONE_MINUS_SRC_ALPHA),urt=zc(Se.ONE,Se.ONE),pEe=zc(Se.ZERO,Se.ONE_MINUS_SRC_ALPHA);function V0(t){return t===dt.FrontFace?null:t===dt.Alpha?pEe:urt}function d9(t){return t===dt.FrontFace?jl:null}const p9=5e5,f9={factor:-1,units:-2};function m9(t){return t?f9:null}function Uv(t,e=ri.LESS){return t===dt.NONE||t===dt.FrontFace?e:ri.LEQUAL}let fEe=class mEe extends Lr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Ve.Global}initializeProgram(e){return new Rr(e.rctx,mEe.shader.get().build(this.configuration),Tr)}_setPipelineState(e){const r=this.configuration,i=e===dt.NONE,s=e===dt.FrontFace,n=this.configuration.hasPolygonOffset?hrt:null,o=(i||s)&&r.output!==F.Highlight&&(r.depthEnabled||r.occlusionPass)?jl:null;return Mt({blending:r.output===F.Color||r.output===F.Alpha||r.output===F.Highlight?i?drt:V0(e):null,depthTest:{func:ri.LEQUAL},depthWrite:o,colorWrite:Bt,polygonOffset:n})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return this.configuration.occlusionPass?At.POINTS:At.TRIANGLES}};fEe.shader=new Or(crt,()=>he(()=>import("./HUDMaterial.glsl-b957761f.js"),[],import.meta.url));const hrt={factor:0,units:-4},drt=zc(Se.ONE,Se.ONE_MINUS_SRC_ALPHA);let Os=class extends jo{constructor(){super(...arguments),this.output=F.Color,this.screenCenterOffsetUnitsEnabled=Il.World,this.transparencyPassType=dt.NONE,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.binaryHighlightOcclusionEnabled=!0,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.hasMultipassGeometry=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}};u([B({count:F.COUNT})],Os.prototype,"output",void 0),u([B({count:Il.COUNT})],Os.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([B({count:dt.COUNT})],Os.prototype,"transparencyPassType",void 0),u([B()],Os.prototype,"spherical",void 0),u([B()],Os.prototype,"occlusionTestEnabled",void 0),u([B()],Os.prototype,"signedDistanceFieldEnabled",void 0),u([B()],Os.prototype,"vvSize",void 0),u([B()],Os.prototype,"vvColor",void 0),u([B()],Os.prototype,"hasVerticalOffset",void 0),u([B()],Os.prototype,"hasScreenSizePerspective",void 0),u([B()],Os.prototype,"debugDrawLabelBorder",void 0),u([B()],Os.prototype,"binaryHighlightOcclusionEnabled",void 0),u([B()],Os.prototype,"hasSlicePlane",void 0),u([B()],Os.prototype,"hasPolygonOffset",void 0),u([B()],Os.prototype,"depthEnabled",void 0),u([B()],Os.prototype,"pixelSnappingEnabled",void 0),u([B()],Os.prototype,"draped",void 0),u([B()],Os.prototype,"hasMultipassGeometry",void 0),u([B()],Os.prototype,"hasMultipassTerrain",void 0),u([B()],Os.prototype,"cullAboveGround",void 0),u([B()],Os.prototype,"occlusionPass",void 0),u([B()],Os.prototype,"objectAndLayerIdColorInstanced",void 0),u([B({constValue:!0})],Os.prototype,"hasSliceInVertexProgram",void 0),u([B({constValue:!1})],Os.prototype,"hasVvInstancing",void 0);let YE=class extends Fv{constructor(e){super(e,new xrt),this._configuration=new Os}getConfiguration(e,r){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?Il.Screen:Il.World,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.isDraped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=r.slot===pe.OCCLUSION_PIXELS&&this.parameters.occlusionTest&&(e===F.Color||e===F.Alpha),e===F.Color&&(this._configuration.debugDrawLabelBorder=!!li.LABELS_SHOW_BORDER),e===F.Highlight&&(this._configuration.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassGeometry=r.multipassGeometry.enabled,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}intersect(e,r,i,s,n,o){if(!i.options.selectionMode||!i.options.hud||!e.visible)return;const a=this.parameters;let l=1,c=1;if(Jh(nz,r),e.shaderTransformer!=null){const T=e.shaderTransformer(gae);l=T[0],c=T[5],mrt(nz)}const h=e.vertexAttributes.get(C.POSITION),d=e.vertexAttributes.get(C.SIZE),f=e.vertexAttributes.get(C.NORMAL),m=e.vertexAttributes.get(C.AUXPOS1);ot(h.size>=3);const g=i.point,_=i.camera,v=yF(a);l*=_.pixelRatio,c*=_.pixelRatio;const b=this.parameters.centerOffsetUnits==="screen";for(let T=0;T<h.data.length/h.size;T++){const x=T*h.size;ne(ta,h.data[x],h.data[x+1],h.data[x+2]),ze(ta,ta,r);const S=T*d.size;dy[0]=d.data[S]*l,dy[1]=d.data[S+1]*c,ze(ta,ta,_.viewMatrix);const E=T*m.size;if(ne(qc,m.data[E],m.data[E+1],m.data[E+2]),!b&&(ta[0]+=qc[0],ta[1]+=qc[1],qc[2]!==0)){const R=qc[2];_e(qc,ta),fe(ta,ta,se(qc,qc,R))}const A=T*f.size;if(ne(O3,f.data[A],f.data[A+1],f.data[A+2]),this._normalAndViewAngle(O3,nz,_,oz),this._applyVerticalOffsetTransformationView(ta,oz,_,sz),_.applyProjection(ta,Ma),Ma[0]>-1){Ma[0]=Math.floor(Ma[0]),Ma[1]=Math.floor(Ma[1]),b&&(qc[0]||qc[1])&&(Ma[0]+=qc[0],qc[1]!==0&&(Ma[1]+=XQ(qc[1],sz.factorAlignment)),_.unapplyProjection(Ma,ta)),Ma[0]+=this.parameters.screenOffset[0],Ma[1]+=this.parameters.screenOffset[1],wSe(dy,sz.factor,dy);const R=vrt*_.pixelRatio;let M=0;if(a.textureIsSignedDistanceField&&(M=a.outlineSize*_.pixelRatio/2),g&&fae(g,Ma[0],Ma[1],dy,R,M,a,v)){const D=i.ray;if(ze(mae,ta,$n(_rt,_.viewMatrix)),Ma[0]=g[0],Ma[1]=g[1],_.unprojectFromRenderScreen(Ma,ta)){const k=O();ie(k,D.direction);const L=1/Re(k);se(k,k,L),o(mi(D.origin,ta)*L,k,-1,!0,1,mae)}}}}}intersectDraped(e,r,i,s,n,o){const a=e.vertexAttributes.get(C.POSITION),l=e.vertexAttributes.get(C.SIZE),c=this.parameters,h=yF(c);let d=1,f=1;if(e.shaderTransformer!=null){const g=e.shaderTransformer(gae);d=g[0],f=g[5]}d*=e.screenToWorldRatio,f*=e.screenToWorldRatio;const m=brt*e.screenToWorldRatio;for(let g=0;g<a.data.length/a.size;g++){const _=g*a.size,v=a.data[_],b=a.data[_+1],T=g*l.size;dy[0]=l.data[T]*d,dy[1]=l.data[T+1]*f;let x=0;c.textureIsSignedDistanceField&&(x=c.outlineSize*e.screenToWorldRatio/2),fae(s,v,b,dy,m,x,c,h)&&n(o.dist,o.normal,-1,!1)}}createBufferWriter(){return new Srt(this)}_normalAndViewAngle(e,r,i,s){return Xet(r)&&(r=Jh(yrt,r)),Oc(s.normal,e,r),ze(s.normal,s.normal,i.viewInverseTransposeMatrix),s.cosAngle=ye(gEe,wrt),s}_updateScaleInfo(e,r,i){const s=this.parameters;s.screenSizePerspective!=null?eae(i,r,s.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),s.screenSizePerspectiveAlignment!=null?eae(i,r,s.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)}applyShaderOffsetsView(e,r,i,s,n,o,a){const l=this._normalAndViewAngle(r,i,n,oz);return this._applyVerticalGroundOffsetView(e,l,n,a),this._applyVerticalOffsetTransformationView(a,l,n,o),this._applyPolygonOffsetView(a,l,s[3],n,a),this._applyCenterOffsetView(a,s,a),a}applyShaderOffsetsNDC(e,r,i,s,n){return this._applyCenterOffsetNDC(e,r,i,s),n!=null&&ie(n,s),this._applyPolygonOffsetNDC(s,r,i,s),s}_applyPolygonOffsetView(e,r,i,s,n){const o=s.aboveGround?1:-1;let a=Math.sign(i);a===0&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return ie(n,e);const c=ve(Math.abs(r.cosAngle),.01,1),h=1-Math.sqrt(1-c*c)/c/s.viewport[2];return se(n,e,l>0?h:1/h),n}_applyVerticalGroundOffsetView(e,r,i,s){const n=Re(e),o=i.aboveGround?1:-1,a=.5*i.computeRenderPixelSizeAtDist(n),l=se(ta,r.normal,o*a);return de(s,e,l),s}_applyVerticalOffsetTransformationView(e,r,i,s){const n=this.parameters;if(!n.verticalOffset||!n.verticalOffset.screenLength){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const c=Re(e);this._updateScaleInfo(s,c,r.cosAngle)}else s.factor.scale=1,s.factorAlignment.scale=1;return e}const o=Re(e),a=n.screenSizePerspectiveAlignment??n.screenSizePerspective,l=DSe(i,o,n.verticalOffset,r.cosAngle,a);return this._updateScaleInfo(s,o,r.cosAngle),se(r.normal,r.normal,l),de(e,e,r.normal)}_applyCenterOffsetView(e,r,i){const s=this.parameters.centerOffsetUnits!=="screen";return i!==e&&ie(i,e),s&&(i[0]+=r[0],i[1]+=r[1],r[2]&&(_e(O3,i),de(i,i,se(O3,O3,r[2])))),i}_applyCenterOffsetNDC(e,r,i,s){const n=this.parameters.centerOffsetUnits!=="screen";return s!==e&&ie(s,e),n||(s[0]+=r[0]/i.fullWidth*2,s[1]+=r[1]/i.fullHeight*2),s}_applyPolygonOffsetNDC(e,r,i,s){const n=this.parameters.shaderPolygonOffset;if(e!==s&&ie(s,e),n){const o=i.aboveGround?1:-1,a=o*Math.sign(r[3]);s[2]-=(a||o)*n}return s}requiresSlot(e,r){if(r===F.Color||r===F.Alpha||r===F.Highlight||r===F.ObjectAndLayerIdColor){if(e===pe.DRAPED_MATERIAL)return!0;const{drawInSecondSlot:i,occlusionTest:s}=this.parameters;return e===(i?pe.LABEL_MATERIAL:pe.HUD_MATERIAL)||s&&e===pe.OCCLUSION_PIXELS}return!1}createGLMaterial(e){return new prt(e)}calculateRelativeScreenBounds(e,r,i=zt()){return frt(this.parameters,e,r,i),i[2]=i[0]+e[0],i[3]=i[1]+e[1],i}},prt=class extends QJ{constructor(e){super({...e,...e.material.parameters})}selectProgram(e){return this.ensureTechnique(fEe,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}};function frt(t,e,r,i=grt){return yn(i,t.anchorPosition),i[0]*=-e[0],i[1]*=-e[1],i[0]+=t.screenOffset[0]*r,i[1]+=t.screenOffset[1]*r,i}function mrt(t){const e=t[0],r=t[1],i=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=1/Math.sqrt(e*e+r*r+i*i),d=1/Math.sqrt(s*s+n*n+o*o),f=1/Math.sqrt(a*a+l*l+c*c);return t[0]=e*h,t[1]=r*h,t[2]=i*h,t[3]=s*d,t[4]=n*d,t[5]=o*d,t[6]=a*f,t[7]=l*f,t[8]=c*f,t}function fae(t,e,r,i,s,n,o,a){let l=e-s-(a[0]>0?i[0]*a[0]:0),c=l+i[0]+2*s,h=r-s-(a[1]>0?i[1]*a[1]:0),d=h+i[1]+2*s;const f=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&f!=null&&(l+=i[0]*f[0],h+=i[1]*f[1],c-=i[0]*(1-f[2]),d-=i[1]*(1-f[3]),l-=n,c+=n,h-=n,d+=n),t[0]>l&&t[0]<c&&t[1]>h&&t[1]<d}const sz=new kSe,grt=He(),ta=O(),O3=O(),Ma=Wt(),gEe=O(),mae=O(),nz=ki(),yrt=ki(),_rt=xe(),qc=O(),oz={normal:gEe,cosAngle:0},gae=xe(),vrt=1,brt=2,dy=[0,0],wrt=Pe(0,0,1);let xrt=class extends Bxe{constructor(){super(...arguments),this.renderOccluded=Ni.Occlude,this.color=Nt(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=fr(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.outlineColor=Nt(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.binaryHighlightOcclusion=!0,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1}};const yEe=qi().vec3f(C.POSITION).vec3f(C.NORMAL).vec2f(C.UV0).vec4u8(C.COLOR).vec2f(C.SIZE).vec4f(C.AUXPOS1).vec4f(C.AUXPOS2),Trt=yEe.clone().vec4u8(C.OBJECTANDLAYERIDCOLOR);let Srt=class{constructor(e){this._material=e,this.vertexBufferLayout=ae("enable-feature:objectAndLayerId-rendering")?Trt:yEe}elementCount(e){return 6*e.indices.get(C.POSITION).length}write(e,r,i,s,n){tK(i.indices.get(C.POSITION),i.vertexAttributes.get(C.POSITION).data,e,s.position,n,6),rK(i.indices.get(C.NORMAL),i.vertexAttributes.get(C.NORMAL).data,r,s.normal,n,6);const o=i.vertexAttributes.get(C.UV0).data;let a,l,c,h;if(o==null||o.length<4){const b=this._material.parameters;a=0,l=0,c=b.texCoordScale[0],h=b.texCoordScale[1]}else a=o[0],l=o[1],c=o[2],h=o[3];c=Math.min(1.99999,c+1),h=Math.min(1.99999,h+1);let d=i.indices.get(C.POSITION).length,f=n;const m=s.uv0;for(let b=0;b<d;++b)m.set(f,0,a),m.set(f,1,l),f+=1,m.set(f,0,c),m.set(f,1,l),f+=1,m.set(f,0,c),m.set(f,1,h),f+=1,m.set(f,0,c),m.set(f,1,h),f+=1,m.set(f,0,a),m.set(f,1,h),f+=1,m.set(f,0,a),m.set(f,1,l),f+=1;VSe(i.indices.get(C.COLOR),i.vertexAttributes.get(C.COLOR).data,4,s.color,n,6);const g=i.indices.get(C.SIZE),_=i.vertexAttributes.get(C.SIZE).data;d=g.length;const v=s.size;f=n;for(let b=0;b<d;++b){const T=_[2*g[b]],x=_[2*g[b]+1];for(let S=0;S<6;++S)v.set(f,0,T),v.set(f,1,x),f+=1}if(i.indices.get(C.AUXPOS1)&&i.vertexAttributes.get(C.AUXPOS1)?HE(i.indices.get(C.AUXPOS1),i.vertexAttributes.get(C.AUXPOS1).data,s.auxpos1,n,6):lae(s.auxpos1,n,6*d),i.indices.get(C.AUXPOS2)&&i.vertexAttributes.get(C.AUXPOS2)?HE(i.indices.get(C.AUXPOS2),i.vertexAttributes.get(C.AUXPOS2).data,s.auxpos2,n,6):lae(s.auxpos2,n,6*d),i.objectAndLayerIdColor!=null&&i.indices.get(C.POSITION)){const b=i.indices.get(C.POSITION).length,T=s.getField(C.OBJECTANDLAYERIDCOLOR,wa);BSe(i.objectAndLayerIdColor,T,b,n,6)}}};const Xp=O(),dT=Wt(),R3=Wt(),az=O(),Ert=xe(),Crt=xs(),lz=eo(),Art=O(),Ort=zt();class Rrt{constructor(){this.aabr=zt(),this.distance=0,this.culled=!1,this.visible=!1}}class Mrt{constructor(e,r){this.graphics3DGraphic=e,this.slicePlaneEnabled=r,this.info={}}}var pc;(function(t){t[t.Idle=0]="Idle",t[t.Process=1]="Process",t[t.Sort=2]="Sort",t[t.Deconflict=3]="Deconflict",t[t.NumStates=4]="NumStates"})(pc||(pc={}));class _Ee{constructor(){this.camera=new yt,this.slicePlane=P0(),this.slicePlaneEnabled=!1}copyFrom(e){this.camera.copyFrom(e.camera),Mx(e.slicePlane,this.slicePlane),this.slicePlaneEnabled=e.slicePlaneEnabled}}let gS=class extends Te{get dirty(){return this._dirty}get state(){return this._state}constructor(t){super(t),this._dirty=!1,this._runningViewState=new _Ee,this._state=pc.Idle,this._active=new Map,this._visible=new Map,this._iterators=new Lrt,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0}destroy(){this._active.clear(),this._visible.clear(),this._iterators=null}setDirty(){!this._dirty&&this._active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==pc.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const t=this._state/pc.NumStates;return this._dirty?.5*t:t}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(t){switch(this._state){case pc.Idle:this._startUpdate(),t.madeProgress();case pc.Process:if(this._state=pc.Process,!this._processActiveGraphics(t))return;case pc.Sort:if(this._state=pc.Sort,!this._sortVisibleGraphics(t))return;case pc.Deconflict:if(this._state=pc.Deconflict,!this._deconflictVisibleGraphics(t))return;default:Fet(this,this._visible),this._state=pc.Idle,this.notifyChange("updating")}}modifyGraphics(t,e){e?t.forEach(r=>this.addToActiveGraphics(r)):t.forEach(r=>this.removeFromActiveGraphics(r)),this.setDirty()}layerSupportsDeconfliction(t){if(t==null||t.type!=="object3d")return!1;const e=t.stageObject;return(e?e.geometries.length:0)!==1?!1:e?.geometries[0]?.material instanceof YE}_startUpdate(){Uet(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);const{fullWidth:t,fullHeight:e}=this._runningViewState.camera;this._initBins(t,e),this._resetIterators()}addToActiveGraphics(t){t.info[this.visibilityGroup]=new Rrt,this._active.set(t.graphics3DGraphic.graphic.uid,t),this.setDirty()}removeFromActiveGraphics(t){this._visible.delete(t.graphics3DGraphic.graphic.uid),Prt(t,this.visibilityGroup),delete t.info[this.visibilityGroup],this._active.delete(t.graphics3DGraphic.graphic.uid),this.setDirty()}_processActiveGraphics(t){const e=this._ensureActiveGraphicsIterator(),r=OC(Ert,this._runningViewState.camera.projectionMatrix),i=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._runningViewState.camera.relativeElevation>0?Crt:null;let s=0;for(i!=null&&(ze(i,sl,this._runningViewState.camera.viewMatrix),i[3]=Vr(this.view.spatialReference).radius,s=Bbe(i,sl));!t.done;){t.madeProgress();const n=e.next();if(n.done===!0)return this._resetActiveGraphicsIterator(),!0;const o=n.value,a=o&&o.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,r,i,s),a.culled?this._visible.delete(o.graphics3DGraphic.graphic.uid):this._visible.set(o.graphics3DGraphic.graphic.uid,o))}return!1}_sortVisibleGraphics(t){const e=this._ensureSortGraphicsIterator();for(;!t.done;){const r=e.next();if(t.madeProgress(),r.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(t){const e=this._ensureVisibleGraphicsIterator(),r=this.visibilityGroup===Kn.LABEL;for(;!t.done;){t.madeProgress();const i=e.next();if(i.done===!0)return this._resetVisibleGraphicsIterator(),!0;const s=i.value,n=s.info[this.visibilityGroup];if(!n||n.culled)continue;const o=s.graphics3DGraphic,a=!r||o.isVisible();n.visible=a&&!this._isConflicted(s),n.visible&&this._addToBins(s),this._setGraphicVisibility(s,n.visible),zet(n,n.visible)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=yae(this._active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=yae(this._visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=Irt(this._visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(t,e,r,i){const s=t.graphics3DGraphic;if(s.destroyed)return;const n=t.info[this.visibilityGroup];if(!s.isVisible(Kn.GRAPHIC,Ho.DECONFLICTION))return void(n.culled=!0);const o=this.getGraphicsLayers(s);Uc(n.aabr);let a=null;for(const l of o){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometries[0].material;if(a==null&&(a=Frt,this._getProjectionInfo(l,e,a),a.isOutsideScreen||this._isCulledBySlice(t,Xp)||r!=null&&this._isCulledByHorizon(a,r,i)))return void(n.culled=!0);this._expandBoundingRect(n,l,c,a)}a==null?n.culled=!0:(n.distance=a.distance,n.culled=!1)}_getProjectionInfo(t,e,r){const i=this._runningViewState.camera,s=t.stageObject,n=s.geometries[0],o=n.material,a=s.boundingVolumeWorldSpace.bounds;ze(Xp,a,i.viewMatrix);const l=n.vertexAttributes,c=l.get(C.NORMAL).data,h=l.get(C.AUXPOS1).data;o.applyShaderOffsetsView(Xp,c,s.transformation,h,i,r.scaleInfo,Xp),Ti(dT,Xp[0],Xp[1],Xp[2],1),xu(R3,dT,i.projectionMatrix),se(r.positionNDC,R3,1/R3[3]),o.applyShaderOffsetsNDC(r.positionNDC,h,i,r.positionNDC,az),r.distanceWithoutPolygonOffset=i.depthNDCToWorld(az[2]),r.distance=az[2]===r.positionNDC[2]?r.distanceWithoutPolygonOffset:i.depthNDCToWorld(r.positionNDC[2]),Ti(R3,r.positionNDC[0],r.positionNDC[1],r.positionNDC[2],1),xu(dT,R3,e),Uw(dT,dT,1/dT[3]),ne(r.positionView,Xp[0],Xp[1],Xp[2])}_isCulledByHorizon(t,e,r){return ie(lz.direction,t.positionView),ne(lz.origin,0,0,0),!!Lv(e,lz,Art)&&t.distanceWithoutPolygonOffset>r}_isCulledBySlice(t,e){return t.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&MJ(this._runningViewState.slicePlane,e)}_expandBoundingRect(t,e,r,{positionNDC:i,scaleInfo:s}){const n=this._runningViewState.camera,o=e.getScreenSize(Drt);wSe(o,s.factor,o),o[0]*=n.pixelRatio,o[1]*=n.pixelRatio;const a=d5(r.calculateRelativeScreenBounds(o,s.factorAlignment.scale,Ort),St(0,n.fullWidth,.5+.5*i[0]),St(0,n.fullHeight,.5+.5*i[1])),l=this.iconMarginFactor;if(l!==0){const c=l*Math.min(vu(a),Op(a));a[0]-=c,a[1]-=c,a[2]+=c,a[3]+=c}J_(t.aabr,a,t.aabr)}_isConflicted(t){const e=t.graphics3DGraphic.graphic.uid,r=t.info[this.visibilityGroup];for(let i=Math.floor(r.aabr[0]/this._accBinsSizeX);i<=Math.floor(r.aabr[2]/this._accBinsSizeX);i++)if(!(i<0||i>=this._accBinsNumX))for(let s=Math.floor(r.aabr[1]/this._accBinsSizeY);s<=Math.floor(r.aabr[3]/this._accBinsSizeY);s++){if(s<0||s>=this._accBinsNumY)continue;const n=this._accBins[i][s];for(let o=0;o<n.length;o++){const a=n.data[o],l=a.info[this.visibilityGroup];if(l&&l.visible&&a.graphics3DGraphic.graphic.uid!==e&&(this.accNumTests++,yP(l.aabr,r.aabr)))return!0}}return!1}_initBins(t,e){if(this._accBins==null){this._accBins=[];for(let r=0;r<this._accBinsNumX;r++){this._accBins.push([]);const i=this._accBins[this._accBins.length-1];for(let s=0;s<this._accBinsNumY;s++)i.push(new Vt)}}else for(let r=0;r<this._accBinsNumX;r++)for(let i=0;i<this._accBinsNumY;i++)this._accBins[r][i].clear();this._accBinsSizeX=t/this._accBinsNumX,this._accBinsSizeY=e/this._accBinsNumY,this.accNumTests=0}_addToBins(t){const e=t.info[this.visibilityGroup],r=Math.floor(e.aabr[0]/this._accBinsSizeX),i=Math.floor(e.aabr[2]/this._accBinsSizeX),s=Math.floor(e.aabr[1]/this._accBinsSizeY),n=Math.floor(e.aabr[3]/this._accBinsSizeY);for(let o=r;o<=i;o++)if(!(o<0||o>=this._accBinsNumX))for(let a=s;a<=n;a++)a<0||a>=this._accBinsNumY||this._accBins[o][a].push(t)}_setGraphicVisibility(t,e){const r=t.graphics3DGraphic;r.destroyed||(r.setVisibilityFlag(this.visibilityGroup,Ho.DECONFLICTION,e),this.visibilityGroup===Kn.LABEL&&this.view.labeler.setLabelGraphicVisibility(r,e))}};function Prt(t,e){const r=t.graphics3DGraphic;r.destroyed||r.setVisibilityFlag(e,Ho.DECONFLICTION,!0)}function*yae(t){if(Map.prototype.entries){const e=t.entries();for(let r=e.next();!r.done;r=e.next())yield r.value[1]}else yield*t.values()}function*Irt(t,e,r){e.clear(),t.forEach((s,n)=>{const o=e.pushNew();o.id=n,o.visible=s.graphics3DGraphic.getVisibilityFlag(r,Ho.DECONFLICTION);const a=s.info&&s.info[r];o.prio=s.graphics3DGraphic.deconflictionPriority,o.distance=a?a.distance:Number.MAX_VALUE}),yield;const i=e.iterableSort((s,n)=>s.prio!==n.prio?n.prio-s.prio:s.distance!==n.distance?s.distance-n.distance:s.visible!==n.visible?s.visible?-1:1:s.id-n.id);for(let s=i.next();!s.done;s=i.next())yield;e.forAll(s=>{const n=t.get(s.id);n&&(t.delete(s.id),t.set(s.id,n))}),e.clear()}u([p({constructOnly:!0})],gS.prototype,"view",void 0),u([p({type:Boolean,readOnly:!0})],gS.prototype,"updating",null),gS=u([P("esri.views.3d.layers.graphics.Deconflictor")],gS);class $rt{constructor(){this.id=0,this.visible=!1,this.prio=0,this.distance=0}}class Lrt{constructor(e=null,r=null,i=null){this.active=e,this.visible=r,this.sort=i,this.sortArray=new Vt({allocator:s=>s||new $rt})}}const Drt=He();let Nrt=class{constructor(){this.positionView=O(),this.positionNDC=O(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo=new kSe}get isOutsideScreen(){const e=this.positionNDC;return e[0]<-1||e[1]<-1||e[2]<-1||e[0]>=1||e[1]>=1}};const Frt=new Nrt,Urt=2e3;let $N=class extends gS{constructor(e){super(e),this.visibilityGroup=Kn.LABEL,this.iconMarginFactor=0,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return Zo.YIELD;const r=performance.now();if(e.state!==Ur.IDLE&&r-this._lastDeconfliction<Urt)return Zo.YIELD;super.runTask(e),this.state===pc.Idle&&(this._lastDeconfliction=r)}enabledChanged(e,r){this.modifyGraphics(r,e.labelsEnabled)}getGraphicsLayers(e){return e.labelLayers}};u([p({constructOnly:!0})],$N.prototype,"parent",void 0),$N=u([P("esri.views.3d.layers.graphics.LabelDeconflictor")],$N);let uq=class extends gS{constructor(){super(...arguments),this._handles=new $i,this._contexts=new Map,this._viewState=new _Ee,this.visibilityGroup=Kn.GRAPHIC,this._iconMarginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._handles.add([le(()=>this.view?.state?.camera,()=>{this._updateViewState(),this.setDirty()}),le(()=>this.view?.map?.ground?.opacity,(e,r)=>{e!==1&&r!==1||this.setDirty()}),le(()=>this.view?.slicePlane,()=>{this._updateSlicePlane(),this._slicePlaneChanged()},Pr)]),this._frameTask=this.view.resourceController.scheduler.registerTask(vt.GRAPHICS_DECONFLICTOR,this),this._labels=new $N({view:this.view,parent:this})}destroy(){this._labels.destroy(),this._labels=null,this._handles.destroy(),this._handles=null,this._frameTask&&(this._frameTask.remove(),this._frameTask=null)}get iconMarginFactor(){return this._iconMarginFactor}set iconMarginFactor(e){this._iconMarginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,r){const i=!(this._graphicSupportsDeconfliction(r)&&cz(e));r.setVisibilityFlag(Kn.GRAPHIC,Ho.DECONFLICTION,i)}_updateViewState(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;e!=null&&iwe(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=e!=null}_slicePlaneChanged(){Bo(this._contexts,(e,r)=>r.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){const r=this._getGraphicsContext(e);return{addGraphic:i=>this._addGraphic(e,r,i),removeGraphic:i=>this._removeGraphic(r,i),labelingInfoChange:()=>this._labels.enabledChanged(e,r),featureReductionChange:()=>this.enabledChanged(e,r),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,r),clear:()=>r.forEach(i=>this._removeGraphic(r,i.graphics3DGraphic))}}removeGraphicsOwner(e){const r=this._contexts.get(e);r&&(r.forEach(i=>this._removeGraphic(r,i.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,r,i){const s=i.graphic.uid,n=new Mrt(i,e.symbolCreationContext.slicePlaneEnabled);r.set(s,n),cz(e)&&this.addToActiveGraphics(n),e.labelsEnabled&&this._labels.addToActiveGraphics(n)}_removeGraphic(e,r){const i=r.graphic.uid,s=e.get(i);s&&(this.removeFromActiveGraphics(s),this._labels.removeFromActiveGraphics(s),e.delete(i),this.setDirty())}enabledChanged(e,r){const i=cz(e);i||krt(e),this.modifyGraphics(r,i)}_slicePlaneEnabledChanged(e,r){const i=e.symbolCreationContext.slicePlaneEnabled;r.forEach(s=>s.slicePlaneEnabled=i),this.setDirty()}getGraphicsLayers(e){return e.layers}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const r=e.layers;if(!r||!r.length)return!1;for(const i of r)if(this.layerSupportsDeconfliction(i))return!0;return!1}_getGraphicsContext(e){const r=this._contexts.get(e);if(r)return r;const i=new Map;return this._contexts.set(e,i),this.setDirty(),i}};function cz(t){const e=t.layer;return!(!e||!e.featureReduction||e.featureReduction.type!=="selection")}function krt(t){const e=t.graphics3DGraphics;e&&e.forEach(r=>r.setVisibilityFlag(Kn.GRAPHIC,Ho.DECONFLICTION,!0))}uq=u([P("esri.views.3d.layers.graphics.GraphicsDeconflictor")],uq);function vEe(t){return 32+t.length}function bEe(t){return 16}function wEe(t){if(!t)return 0;let e=SEe;for(const r in t)if(t.hasOwnProperty(r)){const i=t[r];switch(typeof i){case"string":e+=vEe(i);break;case"number":e+=bEe();break;case"boolean":e+=4}}return e}function xEe(t){if(!t)return 0;if(Array.isArray(t))return zrt(t);let e=SEe;for(const r in t)t.hasOwnProperty(r)&&(e+=TEe(t[r]));return e}function zrt(t){const e=t.length;if(e===0||typeof t[0]=="number")return 32+8*e;let r=EEe;for(let i=0;i<e;i++)r+=TEe(t[i]);return r}function TEe(t){switch(typeof t){case"object":return xEe(t);case"string":return vEe(t);case"number":return bEe();case"boolean":return 4;default:return 8}}function Tkt(t,e){return EEe+t.length*e}const SEe=32,EEe=32,aK=(t,e,r)=>[e,r],ZE=(t,e,r)=>[e,r,t[2]],lK=(t,e,r)=>[e,r,t[2],t[3]];function Skt(t){return t?{originPosition:t.originPosition==="upper-left"?"upperLeft":t.originPosition==="lower-left"?"lowerLeft":t.originPosition,scale:t.tolerance?[t.tolerance,t.tolerance]:[1,1],translate:t.extent!=null?[t.extent.xmin,t.extent.ymax]:[0,0]}:null}function Vrt({scale:t,translate:e},r){return Math.round((r-e[0])/t[0])}function Brt({scale:t,translate:e},r){return Math.round((e[1]-r)/t[1])}function CEe({scale:t,translate:e},r){return r*t[0]+e[0]}function AEe({scale:t,translate:e},r){return e[1]-r*t[1]}function OEe(t,e,r){const i=new Array(r.length);if(!r.length)return i;const[s,n]=t.scale;let o=CEe(t,r[0][0]),a=AEe(t,r[0][1]);i[0]=e(r[0],o,a);for(let l=1;l<r.length;l++){const c=r[l];o+=c[0]*s,a-=c[1]*n,i[l]=e(c,o,a)}return i}function REe(t,e,r){const i=new Array(r.length);for(let s=0;s<r.length;s++)i[s]=OEe(t,e,r[s]);return i}function Grt(t,e,r,i){return OEe(t,r?i?lK:ZE:i?ZE:aK,e)}function jrt(t,e,r,i){return REe(t,r?i?lK:ZE:i?ZE:aK,e)}function Hrt(t,e,r,i){return REe(t,r?i?lK:ZE:i?ZE:aK,e)}function Ekt(t,e,r,i,s){return e.x=Vrt(t,r.x),e.y=Brt(t,r.y),e!==r&&(i&&(e.z=r.z),s&&(e.m=r.m)),e}function MEe(t,e,r,i,s){return r!=null&&(e.points=Grt(t,r.points,i,s)),e}function PEe(t,e,r,i,s){return r==null||(e.x=CEe(t,r.x),e.y=AEe(t,r.y),e!==r&&(i&&(e.z=r.z),s&&(e.m=r.m))),e}function IEe(t,e,r,i,s){return r!=null&&(e.rings=Hrt(t,r.rings,i,s)),e}function $Ee(t,e,r,i,s){return r!=null&&(e.paths=jrt(t,r.paths,i,s)),e}var hq;let dO=hq=class extends ue{constructor(t){super(t),this.name=null,this.code=null}clone(){return new hq({name:this.name,code:this.code})}};u([p({type:String,json:{write:!0}})],dO.prototype,"name",void 0),u([p({type:[String,Number],json:{write:!0}})],dO.prototype,"code",void 0),dO=hq=u([P("esri.layers.support.CodedValue")],dO);const qrt=new $r({inherited:"inherited",codedValue:"coded-value",range:"range"});let pO=class extends ue{constructor(e){super(e),this.name=null,this.type=null}};u([p({type:String,json:{write:!0}})],pO.prototype,"name",void 0),u([nt(qrt)],pO.prototype,"type",void 0),pO=u([P("esri.layers.support.Domain")],pO);const g9=pO;var dq;let fO=dq=class extends g9{constructor(t){super(t),this.codedValues=null,this.type="coded-value"}getName(t){let e=null;if(this.codedValues){const r=String(t);this.codedValues.some(i=>(String(i.code)===r&&(e=i.name),!!e))}return e}clone(){return new dq({codedValues:ee(this.codedValues),name:this.name})}};u([p({type:[dO],json:{write:!0}})],fO.prototype,"codedValues",void 0),u([nt({codedValue:"coded-value"})],fO.prototype,"type",void 0),fO=dq=u([P("esri.layers.support.CodedValueDomain")],fO);const LEe=fO;var pq;let LN=pq=class extends g9{constructor(t){super(t),this.type="inherited"}clone(){return new pq}};u([nt({inherited:"inherited"})],LN.prototype,"type",void 0),LN=pq=u([P("esri.layers.support.InheritedDomain")],LN);const DEe=LN;var fq;let S2=fq=class extends g9{constructor(t){super(t),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new fq({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};u([p({type:Number,json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range&&e.range[1]},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(t,e,r){e[r]=[this.minValue||0,t]}}}})],S2.prototype,"maxValue",void 0),u([p({type:Number,json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range&&e.range[0]},write:{target:"range",writer(t,e,r){e[r]=[t,this.maxValue||0]}}}})],S2.prototype,"minValue",void 0),u([nt({range:"range"})],S2.prototype,"type",void 0),S2=fq=u([P("esri.layers.support.RangeDomain")],S2);const NEe=S2,FEe={key:"type",base:g9,typeMap:{range:NEe,"coded-value":LEe,inherited:DEe}};function cK(t){if(!t||!t.type)return null;switch(t.type){case"range":return NEe.fromJSON(t);case"codedValue":return LEe.fromJSON(t);case"inherited":return DEe.fromJSON(t)}return null}const Wrt=new $r({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml",esriFieldTypeBigInteger:"big-integer",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"});var mq;const Xrt=new $r({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let ka=mq=class extends ue{constructor(t){super(t),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=-1,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(t,{description:e}){let r=null;try{r=e?JSON.parse(e):null}catch{}return r?.value??null}readValueType(t,{description:e}){let r=null;try{r=e?JSON.parse(e):null}catch{}return r?Xrt.fromJSON(r.fieldValueType):null}clone(){return new mq({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};u([p({type:String,json:{write:!0}})],ka.prototype,"alias",void 0),u([p({type:[String,Number],json:{write:{allowNull:!0}}})],ka.prototype,"defaultValue",void 0),u([p()],ka.prototype,"description",void 0),u([Oe("description")],ka.prototype,"readDescription",null),u([p({types:FEe,json:{read:{reader:cK},write:!0}})],ka.prototype,"domain",void 0),u([p({type:Boolean,json:{write:!0}})],ka.prototype,"editable",void 0),u([p({type:Ki,json:{write:!0}})],ka.prototype,"length",void 0),u([p({type:String,json:{write:!0}})],ka.prototype,"name",void 0),u([p({type:Boolean,json:{write:!0}})],ka.prototype,"nullable",void 0),u([nt(Wrt)],ka.prototype,"type",void 0),u([p()],ka.prototype,"valueType",void 0),u([Oe("valueType",["description"])],ka.prototype,"readValueType",null),u([p({type:Boolean,json:{read:!1}})],ka.prototype,"visible",void 0),ka=mq=u([P("esri.layers.support.Field")],ka);const y9=ka;let Akt=class{constructor(e,r,i){this.uid=e,this.geometry=r,this.attributes=i,this.visible=!0,this.objectId=null,this.centroid=null}};function Rkt(t){return t.geometry!=null}let Mkt=class{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}};function Ikt(t){const e=c_e.fromJSON(t.geometryType),r=qe.fromJSON(t.spatialReference),i=t.transform,s=t.features.map(n=>{const o=Yrt(n,e,r,t.objectIdFieldName),a=o.geometry;if(a!=null&&i)switch(a.type){case"point":o.geometry=PEe(i,a,a,a.hasZ,a.hasM);break;case"multipoint":o.geometry=MEe(i,a,a,!!a.hasZ,!!a.hasM);break;case"polygon":o.geometry=IEe(i,a,a,!!a.hasZ,!!a.hasM);break;case"polyline":o.geometry=$Ee(i,a,a,!!a.hasZ,!!a.hasM);break;case"extent":case"mesh":o.geometry=a}return o});return{geometryType:e,features:s,spatialReference:r,fields:t.fields?.map(n=>y9.fromJSON(n))??[],objectIdFieldName:t.objectIdFieldName,globalIdFieldName:t.globalIdFieldName,geohashFieldName:t.geohashFieldName,geometryProperties:t.geometryProperties,hasZ:t.hasZ,hasM:t.hasM,exceededTransferLimit:t.exceededTransferLimit,transform:null}}function Yrt(t,e,r,i){return{uid:Ic(),objectId:i&&t.attributes?t.attributes[i]:null,attributes:t.attributes,geometry:Zrt(t.geometry,e,r),visible:!0}}function Zrt(t,e,r){if(t==null)return null;switch(e){case"point":{const i=t;return{x:i.x,y:i.y,z:i.z,m:i.m,hasZ:i.z!=null,hasM:i.m!=null,type:"point",spatialReference:r}}case"polyline":{const i=t;return{paths:i.paths,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polyline",spatialReference:r}}case"polygon":{const i=t;return{rings:i.rings,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polygon",spatialReference:r}}case"multipoint":{const i=t;return{points:i.points,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"multipoint",spatialReference:r}}}}function Fx(t,e,r,i){return{x:t,y:e,z:r,hasZ:r!=null,hasM:!1,spatialReference:i,type:"point"}}function Jrt(t){if(t==null)return 0;let e=32;switch(t.type){case"point":e+=42;break;case"polyline":case"polygon":{let r=0;const i=2+(t.hasZ?1:0)+(t.hasM?1:0),s=t.type==="polyline"?t.paths:t.rings;for(const n of s)r+=n.length;e+=8*r*i+64,e+=128*r,e+=34,e+=32*(s.length+1);break}case"multipoint":{const r=2+(t.hasZ?1:0)+(t.hasM?1:0),i=t.points.length;e+=8*i*r+64,e+=128*i,e+=34,e+=32;break}case"extent":e+=98,t.hasM&&(e+=32),t.hasZ&&(e+=32);break;case"mesh":e+=$_(t.vertexAttributes.position),e+=$_(t.vertexAttributes.normal),e+=$_(t.vertexAttributes.uv),e+=$_(t.vertexAttributes.tangent)}return e}function $kt(t){let e=32;return e+=wEe(t.attributes),e+=3,e+=8+Jrt(t.geometry),e}function Qrt(t){if(t==null)return 0;switch(t.type){case"point":return 1;case"polyline":{let e=0;for(const r of t.paths)e+=r.length;return e}case"polygon":{let e=0;for(const r of t.rings)e+=r.length;return e}case"multipoint":return t.points.length;case"extent":return 2;case"mesh":{const e=t.vertexAttributes&&t.vertexAttributes.position;return e?e.length/3:0}default:return}}function Lkt(t){if(t==null)return!1;switch(t.type){case"extent":case"point":return!0;case"polyline":for(const e of t.paths)if(e.length>0)return!0;return!1;case"polygon":for(const e of t.rings)if(e.length>0)return!0;return!1;case"multipoint":return t.points.length>0;case"mesh":return!t.loaded||t.vertexAttributes.position.length>0}}function Dkt(t,e){switch(Ei(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[3]=t.x,e[1]=e[4]=t.y,t.hasZ&&(e[2]=e[5]=t.z);break;case"polyline":for(let r=0;r<t.paths.length;r++)GU(e,t.paths[r],!!t.hasZ);break;case"polygon":for(let r=0;r<t.rings.length;r++)GU(e,t.rings[r],!!t.hasZ);break;case"multipoint":GU(e,t.points,!!t.hasZ);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[3]=t.xmax,e[4]=t.ymax,t.zmin!=null&&(e[2]=t.zmin),t.zmax!=null&&(e[5]=t.zmax)}}function Krt(t,e){switch(Uc(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[2]=t.x,e[1]=e[3]=t.y;break;case"polyline":for(let r=0;r<t.paths.length;r++)PU(e,t.paths[r]);break;case"polygon":for(let r=0;r<t.rings.length;r++)PU(e,t.rings[r]);break;case"multipoint":PU(e,t.points);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax}}function Nkt(t,e){return t.objectId!=null?t.objectId:t.attributes&&e?t.attributes[e]:null}function UEe(t){return"declaredClass"in t}function _ae(t){return"declaredClass"in t}function eit(t){return"declaredClass"in t}function tit(t,e){return t?eit(t)?t:new Bl({layer:e,sourceLayer:e,visible:t.visible,symbol:ee(t.symbol),attributes:ee(t.attributes),geometry:kEe(t.geometry)}):null}function kEe(t){return t==null?null:UEe(t)?t:ov(rit(t))}function rit(t){const{wkid:e,wkt:r,latestWkid:i}=t.spatialReference,s={wkid:e,wkt:r,latestWkid:i};switch(t.type){case"point":{const{x:n,y:o,z:a,m:l}=t;return{x:n,y:o,z:a,m:l,spatialReference:s}}case"polygon":{const{rings:n,hasZ:o,hasM:a}=t;return{rings:vae(n),hasZ:o,hasM:a,spatialReference:s}}case"polyline":{const{paths:n,hasZ:o,hasM:a}=t;return{paths:vae(n),hasZ:o,hasM:a,spatialReference:s}}case"extent":{const{xmin:n,xmax:o,ymin:a,ymax:l,zmin:c,zmax:h,mmin:d,mmax:f,hasZ:m,hasM:g}=t;return{xmin:n,xmax:o,ymin:a,ymax:l,zmin:c,zmax:h,mmin:d,mmax:f,hasZ:m,hasM:g,spatialReference:s}}case"multipoint":{const{points:n,hasZ:o,hasM:a}=t;return{points:VEe(n)?zEe(n):n,hasZ:o,hasM:a,spatialReference:s}}default:return}}function vae(t){return iit(t)?t.map(e=>zEe(e)):t}function zEe(t){return t.map(e=>Array.from(e))}function iit(t){for(const e of t)if(e.length!==0)return VEe(e);return!1}function VEe(t){return t.length>0&&(fC(t[0])||mC(t[0]))}function sit(t,e){if(!t)return null;let r;if(_ae(t)){if(e==null)return t.clone();if(_ae(e))return e.copy(t)}return e!=null?(r=e,r.x=t.x,r.y=t.y,r.spatialReference=t.spatialReference,t.hasZ?(r.z=t.z,r.hasZ=t.hasZ):(r.z=void 0,r.hasZ=!1),t.hasM?(r.m=t.m,r.hasM=!0):(r.m=void 0,r.hasM=!1)):(r=Fx(t.x,t.y,t.z,t.spatialReference),t.hasM&&(r.m=t.m,r.hasM=!0)),r}function Fkt(t){const{wkid:e,wkt:r,latestWkid:i}=t,s={wkid:e,wkt:r,latestWkid:i};return qe.fromJSON(s)}const uK="__begin__",hK="__end__",nit=new RegExp(uK,"ig"),oit=new RegExp(hK,"ig"),bae=new RegExp("^"+uK,"i"),wae=new RegExp(hK+"$","i"),_F='"',ait=_F+" + ",lit=" + "+_F;function cit(t){return t.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}function uit(t){return t.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")}function _9(t){const e={expression:"",type:"none"};return t.labelExpressionInfo?t.labelExpressionInfo.value?(e.expression=t.labelExpressionInfo.value,e.type="conventional"):t.labelExpressionInfo.expression&&(e.expression=t.labelExpressionInfo.expression,e.type="arcade"):t.labelExpression!=null&&(e.expression=cit(t.labelExpression),e.type="conventional"),e}function hit(t){const e=_9(t);if(!e)return null;switch(e.type){case"conventional":return gq(e.expression);case"arcade":return e.expression}return null}function dit(t){const e=_9(t);if(!e)return null;switch(e.type){case"conventional":return fit(e.expression);case"arcade":return dK(e.expression)}return null}function gq(t){let e;return t?(e=F6(t,r=>uK+'$feature["'+r+'"]'+hK),e=bae.test(e)?e.replace(bae,""):_F+e,e=wae.test(e)?e.replace(wae,""):e+_F,e=e.replaceAll(nit,ait).replaceAll(oit,lit)):e='""',e}const pit=/^\s*\{([^}]+)\}\s*$/i;function fit(t){const e=t?.match(pit);return e&&e[1].trim()||null}const mit=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,git=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,yit=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function dK(t){if(!t)return null;let e=mit.exec(t)||git.exec(t);return e?e[1]||e[3]:(e=yit.exec(t),e?e[2]:null)}const uz=K.getLogger("esri.layers.support.labelFormatUtils"),hz={type:"simple",evaluate:()=>null},_it={getAttribute:(t,e)=>t.field(e)};async function BEe(t,e,r){if(!t||!t.symbol||!e)return hz;const i=t.where,s=_9(t),n=i?await he(()=>import("./WhereClause-fb3d85c4.js").then(a=>a.W),["./WhereClause-fb3d85c4.js","./executionError-e8d36121.js"],import.meta.url):null;let o;if(s.type==="arcade"){const a=await Q8e(s.expression,r,e);if(a==null)return hz;o={type:"arcade",evaluate(l){try{const c=a.evaluate({$feature:"attributes"in l?a.repurposeFeature(l):l},a.services);if(c!=null)return c.toString()}catch(c){uz.error(new U("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:c,feature:l,expression:s}))}return null},needsHydrationToEvaluate:()=>dK(s.expression)==null}}else o={type:"simple",evaluate:a=>s.expression.replaceAll(/{[^}]*}/g,l=>{const c=l.slice(1,-1),h=e.get(c);if(!h)return l;let d=null;return"attributes"in a?a&&a.attributes&&(d=a.attributes[h.name]):d=a.field(h.name),d==null?"":GEe(d,h)})};if(i){let a;try{a=n.WhereClause.create(i,e)}catch(c){return uz.error(new U("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:i,error:c})),hz}const l=o.evaluate;o.evaluate=c=>{const h="attributes"in c?void 0:_it;try{if(a.testFeature(c,h))return l(c)}catch(d){uz.error(new U("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:i,feature:c,error:d}))}return null}}return o}function GEe(t,e){if(t==null)return"";const r=e.domain;if(r){if(r.type==="codedValue"||r.type==="coded-value"){const s=t;for(const n of r.codedValues)if(n.code===s)return n.name}else if(r.type==="range"){const s=+t,n="range"in r?r.range[0]:r.minValue,o="range"in r?r.range[1]:r.maxValue;if(n<=s&&s<=o)return r.name}}let i=t;return e.type==="date"||e.type==="esriFieldTypeDate"?i=y0(i,EA("short-date")):zZ(e)&&(i=wE(+i)),i||""}const Ukt=Object.freeze(Object.defineProperty({__proto__:null,createLabelFunction:BEe,formatField:GEe},Symbol.toStringTag,{value:"Module"}));let jEe=class{constructor(e=null,r="center",i="center",s=null,n=[0,0,0],o=0,a=[0,0,0,1],l=[0,0],c="world",h=0,d=0){this.verticalOffset=e,this.horizontalPlacement=r,this.verticalPlacement=i,this.text=s,this.translation=n,this.elevationOffset=o,this.centerOffset=a,this.screenOffset=l,this.centerOffsetUnits=c,this.displayWidth=h,this.displayHeight=d}};function pK(t,e){if(t.type==="point")return py(t,e,!1);if(UEe(t))switch(t.type){case"extent":return py(t.center,e,!1);case"polygon":return py(t.centroid,e,!1);case"polyline":return py(xae(t),e,!0);case"mesh":return py(t.origin,e,!1)}else switch(t.type){case"extent":return py(vit(t),e,!0);case"polygon":return py(bit(t),e,!0);case"polyline":return py(xae(t),e,!0)}}function xae(t){const e=t.paths[0];if(!e||e.length===0)return null;const r=Bye(e,Vye(e)/2);return Fx(r[0],r[1],r[2],t.spatialReference)}function vit(t){return Fx(.5*(t.xmax+t.xmin),.5*(t.ymax+t.ymin),t.zmin!=null&&t.zmax!=null&&isFinite(t.zmin)&&isFinite(t.zmax)?.5*(t.zmax+t.zmin):void 0,t.spatialReference)}function bit(t){const e=t.rings[0];if(!e||e.length===0)return null;const r=Hye(t.rings,!!t.hasZ);return Fx(r[0],r[1],r[2],t.spatialReference)}function py(t,e,r){const i=r?t:sit(t);return e&&t?Y1e(t,i,e)?i:null:i}function zkt(t,e,r,i=0){if(t){e||(e=zt());const s=t;let n=.5*s.width*(r-1),o=.5*s.height*(r-1);return s.width<1e-7*s.height?n+=o/20:s.height<1e-7*s.width&&(o+=n/20),Ti(e,s.xmin-n-i,s.ymin-o-i,s.xmax+n+i,s.ymax+o+i),e}return null}function HEe(t,e){for(let r=0;r<t.geometries.length;++r){const i=t.geometries[r].getMutableAttribute(C.AUXPOS1);i&&i.data[3]!==e&&(i.data[3]=e,t.geometryVertexAttrsUpdated(t.geometries[r]))}}function MR(t,e,r=null){const i=OP(Lh);return t!=null&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),e!=null?i[3]=e:t!=null&&t.length>3&&(i[3]=t[3]),r&&(i[0]*=r,i[1]*=r,i[2]*=r,i[3]*=r),i}function Vkt(t,e,r,i,s,n=[0,0,0,0]){for(let o=0;o<3;++o)t!=null&&t[o]!=null?n[o]=t[o]:r!=null&&r[o]!=null?n[o]=r[o]:n[o]=s[o];return n[3]=e??i??s[3],n}function Tae(t=Hg,e,r,i=1){const s=new Array(3);if(e==null||r==null)s[0]=1,s[1]=1,s[2]=1;else{let n,o=0;for(let a=2;a>=0;a--){const l=t[a];let c;const h=l!=null,d=a===0&&!n&&!h,f=r[a];l==="symbol-value"||d?c=f!==0?e[a]/f:1:h&&l!=="proportional"&&isFinite(l)&&(c=f!==0?l/f:1),c!=null&&(s[a]=c,n=c,o=Math.max(o,Math.abs(c)))}for(let a=2;a>=0;a--)s[a]==null?s[a]=n:s[a]===0&&(s[a]=.001*o)}for(let n=2;n>=0;n--)s[n]/=i;return Qa(s)}function wit(t){return t.isPrimitive!=null}function v9(t){return yq(wit(t)?[t.width,t.depth,t.height]:t)?null:"Symbol sizes may not be negative values"}function yq(t){const e=r=>r==null||r>=0;return Array.isArray(t)?t.every(e):e(t)}function xit(t,e,r,i=xe()){return t&&CE(i,i,-t/180*Math.PI),e&&EE(i,i,e/180*Math.PI),r&&y8(i,i,r/180*Math.PI),i}function fK(t,e,r){if(r.minDemResolution!=null)return r.minDemResolution;const i=Ta(e),s=Tx(t)*i,n=Sx(t)*i,o=Mv(t)*(e.isGeographic?1:i);return s===0&&n===0&&o===0?r.minDemResolutionForPoints:.01*Math.max(s,n,o)}function qEe(t,e,r,i,s,n,o,a,l,c,h){const d=Mit[h.mode];let f,m,g=0;if(ci(t,e,r,i,l.spatialReference,s,a))return d.requiresAlignment(h)?(g=d.applyElevationAlignmentBuffer(i,s,n,o,a,l,c,h),f=n,m=o):(f=i,m=s),ci(f,l.spatialReference,m,n,c.spatialReference,o,a)?g:void 0}function xv(t,e,r,i,s){const n=(aF(t)?t.z:q2e(t)?t.array[t.offset+2]:t[2])||0;switch(r.mode){case"on-the-ground":{const o=Wf(e,t,"ground")??0;return s.verticalDistanceToGround=0,s.sampledElevation=o,void(s.z=o)}case"relative-to-ground":{const o=Wf(e,t,"ground")??0,a=r.geometryZWithOffset(n,i);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"relative-to-scene":{const o=Wf(e,t,"scene")??0,a=r.geometryZWithOffset(n,i);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"absolute-height":{const o=r.geometryZWithOffset(n,i),a=Wf(e,t,"ground")??0;return s.verticalDistanceToGround=o-a,s.sampledElevation=a,void(s.z=o)}default:return void(s.z=0)}}function Tit(t,e,r,i){return xv(t,e,r,i,yS),yS.z}function HP(t,e,r){return e==null||r==null?t.definedChanged:e==="on-the-ground"&&r==="on-the-ground"?t.staysOnTheGround:e===r||e!=="on-the-ground"&&r!=="on-the-ground"?hs.UPDATE:t.onTheGroundChanged}function td(t){return t==="relative-to-ground"||t==="relative-to-scene"}function Tv(t){return t!=="absolute-height"}function Sit(t,e,r,i,s){xv(e,r,s,i,yS),HEe(t,yS.verticalDistanceToGround);const n=yS.sampledElevation,o=zs(Pit,t.transformation);return V$[0]=e.x,V$[1]=e.y,V$[2]=yS.z,Fl(e.spatialReference,V$,o,i.spatialReference)?t.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),n}function Eit(t,e,r,i,s,n){let o=0;const a=n.spatialReference;e*=3,i*=3;for(let l=0;l<s;++l){const c=t[e],h=t[e+1],d=t[e+2],f=n.getElevation(c,h,d,a,"ground")??0;o+=f,r[i]=c,r[i+1]=h,r[i+2]=f,e+=3,i+=3}return o/s}function Cit(t,e,r,i,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,d=n.spatialReference;e*=3,i*=3;for(let f=0;f<s;++f){const m=t[e],g=t[e+1],_=t[e+2],v=n.getElevation(m,g,_,d,"ground")??0;l+=v,r[i]=m,r[i+1]=g,r[i+2]=h==null?_+v+c:v+c,e+=3,i+=3}return l/s}function Ait(t,e,r,i,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,d=n.spatialReference;e*=3,i*=3;for(let f=0;f<s;++f){const m=t[e],g=t[e+1],_=t[e+2],v=n.getElevation(m,g,_,d,"scene")??0;l+=v,r[i]=m,r[i+1]=g,r[i+2]=h==null?_+v+c:v+c,e+=3,i+=3}return l/s}function Oit(t){const e=t.meterUnitOffset,r=t.featureExpressionInfoContext;return e!==0||r!=null}function Rit(t,e,r,i,s,n,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;e*=3,i*=3;for(let h=0;h<s;++h){const d=t[e],f=t[e+1],m=t[e+2];r[i]=d,r[i+1]=f,r[i+2]=c==null?m+l:l,e+=3,i+=3}return 0}let qP=class{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}};var hs;(function(t){t[t.NONE=0]="NONE",t[t.UPDATE=1]="UPDATE",t[t.RECREATE=2]="RECREATE"})(hs||(hs={}));const Mit={"absolute-height":{applyElevationAlignmentBuffer:Rit,requiresAlignment:Oit},"on-the-ground":{applyElevationAlignmentBuffer:Eit,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:Cit,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:Ait,requiresAlignment:()=>!0}},Pit=xe(),yS=new qP,V$=O();function mK(t){return t.mapPositions!=null}function WEe(t,e,r,i,s){const n=t.stageObject,o=n.geometries;let a=0;for(const l of o){if(!mK(l))continue;const{update:c,averageGeometrySampledElevation:h}=YEe(l,e,r,i,s);a+=h,c&&n.geometryVertexAttrsUpdated(l)}return a/o.length}function ww(t,e,r,i,s,n){const o=t.stageObject,a=e.centerPointInElevationSR;let l=0;o.usesVerticalDistanceToGround?(i(a,Pl),HEe(o,Pl.verticalDistanceToGround),l=Pl.sampledElevation):(i(a,Pl),e.mode!=="absolute-height"&&(l=Pl.sampledElevation));const c=zs(Iit,n??o.transformation),h=ne(XEe,c[12],c[13],c[14]);li.TESTS_DISABLE_OPTIMIZATIONS?(Ml[0]=a.x,Ml[1]=a.y,Ml[2]=Pl.z,Fl(a.spatialReference,Ml,c,s.spatialReference)&&(n?zs(n,c):o.transformation=c)):s.setAltitudeOfTransformation(Pl.z,c);const d=gK/s.unitInMeters;return(Math.abs(c[12]-h[0])>=d||Math.abs(c[13]-h[1])>=d||Math.abs(c[14]-h[2])>=d)&&(n?zs(n,c):o.transformation=c),l}const Iit=xe();function $it(t,e,r,i,s){const n=t.graphics3DSymbolLayer.lodRenderer;if(n==null)return 0;const o=e.centerPointInElevationSR;i(o,Pl);const a=e.mode!=="absolute-height"?Pl.sampledElevation:0,l=n.instanceData,c=t.instanceIndex,h=Dit;l.getGlobalTransform(c,h);const d=ne(XEe,h[12],h[13],h[14]);li.TESTS_DISABLE_OPTIMIZATIONS?(Ml[0]=o.x,Ml[1]=o.y,Ml[2]=Pl.z,Fl(o.spatialReference,Ml,h,s.spatialReference)&&l.setGlobalTransform(c,h)):s.setAltitudeOfTransformation(Pl.z,h);const f=gK/s.unitInMeters;return(li.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(h[12]-d[0])>=f||Math.abs(h[13]-d[1])>=f||Math.abs(h[14]-d[2])>=f)&&l.setGlobalTransform(c,h),a}function Lit(t,e,r,i,s){const n=t.stageObject,o=n.geometries;if(o.length===0)return 0;let a=0,l=null,c=0,h=!1;for(const d of o){if(!mK(d))continue;const f=d.vertexAttributes.get(C.POSITION);if(f!==l){const{update:m,averageGeometrySampledElevation:g}=YEe(d,e,r,i,s);c=g,l=f,h=m}h&&n.geometryVertexAttrsUpdated(d),a+=c}return a/o.length}const gK=.01,Ml=O(),ju=O(),pT=O(),Dit=xe(),XEe=O(),Pl=new qP;function YEe(t,e,r,i,s){let n=!1;const o=t.shaderTransformation,a=e.requiresSampledElevationInfo;ju[0]=o[12],ju[1]=o[13],ju[2]=o[14],t.invalidateBoundingInfo();const l=t.getMutableAttribute(C.POSITION),c=l.data,h=l.size,d=c.length/h,f=new BQ(t.mapPositions,r);let m=0,g=0;for(let _=0;_<d;_++){if(pT[0]=c[m],pT[1]=c[m+1],pT[2]=c[m+2],i(f,Pl),a&&(g+=Pl.sampledElevation),li.TESTS_DISABLE_OPTIMIZATIONS)c[m]=f.array[f.offset],c[m+1]=f.array[f.offset+1],c[m+2]=Pl.z,ci(c,r,m,c,s.spatialReference,m,1),c[m]-=ju[0],c[m+1]-=ju[1],c[m+2]-=ju[2],n=!0;else{Ml[0]=c[m]+ju[0],Ml[1]=c[m+1]+ju[1],Ml[2]=c[m+2]+ju[2],s.setAltitude(Ml,Pl.z),c[m]=Ml[0]-ju[0],c[m+1]=Ml[1]-ju[1],c[m+2]=Ml[2]-ju[2];const v=gK/s.unitInMeters;(Math.abs(pT[0]-c[m])>=v||Math.abs(pT[1]-c[m+1])>=v||Math.abs(pT[2]-c[m+2])>=v)&&(n=!0)}m+=h,f.offset+=3}return g/=d,{update:n,averageGeometrySampledElevation:g}}function Nit(t){return!!t&&qE[t]!=null}function Fit(t){return 1/(qE[t]||1)}function Uit(){const t=Object.keys(qE);return t.sort(),t}const kit=Uit(),zit=K.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function Vit(t){return{cachedResult:t.cachedResult,arcade:t.arcade?{func:t.arcade.func,context:t.arcade.modules.arcadeUtils.createExecContext(null,{sr:t.arcade.context.spatialReference}),modules:t.arcade.modules}:null}}function Gkt(t){const e=t&&t.expression;if(typeof e=="string"){const r=QEe(e);if(r!=null)return{cachedResult:r}}return null}async function jkt(t,e,r,i){const s=t&&t.expression;if(typeof s!="string")return null;const n=QEe(s);if(n!=null)return{cachedResult:n};const o=await cv();Yt(r);const a=o.arcadeUtils,l=a.createSyntaxTree(s);return a.dependsOnView(l)?(i?.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:a.createFunction(l),context:a.createExecContext(null,{sr:e}),modules:o}}}function ZEe(t,e,r){return t.arcadeUtils.createFeature(e.attributes,e.geometry,r)}function b9(t,e){if(t!=null&&!JEe(t)){if(!e||!t.arcade)return void zit.errorOncePerTick("Arcade support required but not provided");const r=e;r._geometry&&(r._geometry=kEe(r._geometry)),t.arcade.modules.arcadeUtils.updateExecContext(t.arcade.context,e)}}function Bit(t){if(t!=null){if(JEe(t))return t.cachedResult;const e=t.arcade;let r=e?.modules.arcadeUtils.executeFunction(e.func,e.context);return typeof r!="number"&&(t.cachedResult=0,r=0),r}return 0}function Hkt(t,e=!1){let r=t&&t.featureExpressionInfo;const i=r&&r.expression;return e||i==="0"||(r=null),r??null}const Git={cachedResult:0};function JEe(t){return t.cachedResult!=null}function QEe(t){return t==="0"?0:null}let Up=class KEe{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=Fit(e)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,r){const i=this.calculateOffsetRenderUnits(r);return this.featureExpressionInfoContext!=null?i:e+i}calculateOffsetRenderUnits(e){let r=this._meterUnitOffset;const i=this.featureExpressionInfoContext;return i!=null&&(r+=Bit(i)*this._metersPerElevationInfoUnit),r/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=Nit(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=e.offset??0}updateFeatureExpressionInfoContext(e,r,i){if(e==null)return void(this._featureExpressionInfoContext=null);const s=e&&e.arcade;s&&r!=null&&i!=null?(this._featureExpressionInfoContext=Vit(e),b9(this._featureExpressionInfoContext,ZEe(s.modules,r,i))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const r=new KEe;return e!=null&&r.setFromElevationInfo(e),r}},jit=class{constructor(e,r,i){this.graphic=e,this.renderingInfo=r,this.layer=i}};var jt;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.TRANSPARENT=1]="TRANSPARENT",t[t.OPAQUE=2]="OPAQUE"})(jt||(jt={}));let Hit=class{constructor(e,r,i){this.baseMaterial=e,this.edgeMaterials=r,this.properties=i}},Dm=class{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(e,r,i,s,n,o,a,l=null){this.graphics3DSymbolLayer=e,this.stageObject=r,this._uniqueGeometries=i,this._uniqueMaterials=s,this._sharedResource=n,this.elevationAligner=o,this.elevationContext=a,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e){this._stageLayer=e;const r=e.stage;r.addMany(this._uniqueMaterials),r.addMany(this._uniqueGeometries),r.add(this.stageObject)}destroy(){if(!this._stageLayer)return;const e=this._stageLayer.stage;e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);const r=e.renderer.ensureEdgeView();r.hasObject(this.stageObject)&&r.removeObject(this.stageObject),this.stageObject.dispose(),this._sharedResource!=null&&this._sharedResource.release(),this._visible=!1,this._stageLayer=null}layerOpacityChanged(e,r){if(this._edgeState==null)return;const i=Sae(this._edgeState.baseMaterial);let s=!1;for(const n of this._edgeState.edgeMaterials)n.objectTransparency!==i&&(n.objectTransparency=i,s=!0);s&&this.resetEdgeObject(r),this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[e])}slicePlaneEnabledChanged(e,r){this._edgeState!=null&&(this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:e},!r),this._edgeState.properties.hasSlicePlane=e)}setVisibility(e){if(this._stageLayer!=null&&this._visible!==e&&(this._visible=e,this.stageObject.visible=e,this._visible&&!this._addedToStage&&(this._stageLayer.add(this.stageObject),this._addedToStage=!0),this._edgeState)){const r=this._stageLayer.stage.renderer.ensureEdgeView();r.hasObject(this.stageObject)?r.updateObjectVisibility(this.stageObject,e):e&&this._addOrUpdateEdgeObject(r,!1)}}get visible(){return this._visible}alignWithElevation(e,r,i,s){if(this.elevationAligner==null)return;i!=null&&b9(this.elevationContext.featureExpressionInfoContext,i);const n=(o,a)=>xv(o,e,this.elevationContext,r,a);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,n,r),this.resetEdgeObject(s)}alignWithAbsoluteElevation(e,r,i){const s=(n,o)=>{o.sampledElevation=e,o.verticalDistanceToGround=0,o.z=e};this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,s,r),this.resetEdgeObject(i)}getCenterObjectSpace(e=O()){return ie(e,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(e=gn()){const r=this.stageObject.boundingVolumeObjectSpace;return Gve(e,r.min),jve(e,r.max),e}computeAttachmentOrigin(e){if(this.useObjectOriginAsAttachmentOrigin){const r=this.stageObject.shaderTransformation;e.render.origin[0]+=r[12],e.render.origin[1]+=r[13],e.render.origin[2]+=r[14],e.render.num++}else for(const r of this.stageObject.geometries)r.computeAttachmentOrigin(Gm)&&(ze(Gm,Gm,this.stageObject.shaderTransformation),de(e.render.origin,e.render.origin,Gm),e.render.num++)}async getProjectedBoundingBox(e,r,i,s,n){const o=this.getBoundingBoxObjectSpace(n),a=qit,l=sJ(o)?1:a.length;for(let h=0;h<l;h++){const d=a[h];fy[0]=o[d[0]],fy[1]=o[d[1]],fy[2]=o[d[2]],ze(fy,fy,this.stageObject.transformation),c1[3*h]=fy[0],c1[3*h+1]=fy[1],c1[3*h+2]=fy[2]}if(!e(c1,0,l))return null;Ei(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let d=0;d<3;d++)o[d]=Math.min(o[d],c1[h+d]),o[d+3]=Math.max(o[d+3],c1[h+d]);c&&i.push({location:c1.slice(h,h+3),screenSpaceBoundingRect:c})}if(r&&r.service&&this.elevationContext.mode!=="absolute-height"){hp(o,Gm);const h=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let d=0;if(r.useViewElevation)d=r.service.getElevation(Gm[0],Gm[1],h)??0;else try{const f=fK(o,r.service.spatialReference,r);d=await r.service.queryElevation(Gm[0],Gm[1],s,f,h)??0}catch{}Bve(o,0,0,-this.alignedSampledElevation+d)}return o}addObjectState(e,r){e===T0.Highlight&&r.addObject(this.stageObject,this.stageObject.highlight()),e===T0.MaskOccludee&&r.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeObject(this.stageObject)}resetEdgeObject(e){if(this._edgeState==null)return;const r=this._stageLayer.stage.renderer.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(r,e):r.removeObject(this.stageObject)}_addOrUpdateEdgeObject(e,r){const i=this._edgeState;if(i==null)return;const s=Sae(i.baseMaterial);for(const n of i.edgeMaterials)n.objectTransparency=s;e.addOrUpdateObject3D(this.stageObject,i.edgeMaterials,i.properties,!r).then(()=>this._stageLayer?.sync())}};function Sae(t){return t.isVisible()?t.parameters.transparent?jt.TRANSPARENT:jt.OPAQUE:jt.INVISIBLE}const c1=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],fy=O(),Gm=O(),qit=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];let eCe=class{constructor(e,r=null){this.labelText=r,this.elevationOffset=e??0}};var Us;(function(t){t[t.RecreateSymbol=0]="RecreateSymbol",t[t.RecreateGraphics=1]="RecreateGraphics",t[t.FastUpdate=2]="FastUpdate"})(Us||(Us={}));let yK=class{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=fu.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,r){return this._loadStatus===fu.LOADED?(e&&e(),this._loader??Promise.resolve()):this._loadStatus===fu.FAILED?(r&&r(this._loadError),this._loader??Promise.resolve()):(this._loader==null&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=fu.LOADED},i=>{throw this._loadError=i,this._abortController=null,this._loadStatus=fu.FAILED,!ds(i)&&this.logger&&i.message&&this.logger.warn(i.message),i})),this._loader.then(e,r).catch(()=>{}),this._loader)}abortLoad(){this._abortController!=null?this._abortController=zl(this._abortController):this._loadStatus===fu.LOADING&&(this._loadStatus=fu.FAILED),this._loader=null}};var fu;(function(t){t[t.LOADING=0]="LOADING",t[t.LOADED=1]="LOADED",t[t.FAILED=2]="FAILED"})(fu||(fu={}));const tCe=3,_q=3,rCe=10;let iCe=class{constructor(e,r=null){this.geometry=e,this.textures=r}};function B$(t){const e=[];return t.levels.forEach(r=>r.components.forEach(i=>e.push(i.geometry.material))),I6(e)}function Eae(t){const e=new Array;return t.levels.forEach(r=>{r.components.forEach(i=>{i.textures!=null&&e.push(...i.textures)})}),I6(e)}function sCe(t){const e=t.components.map(r=>r.geometry);return I6(e)}function Cae(t){const e=[];return t.levels.forEach(r=>{r.components.forEach(i=>{e.push(i.geometry)})}),I6(e)}function Wit(t){switch(t){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function nCe(t,e){const r=(i,s,n=!1)=>({levels:i.map(o=>{const a=s(o.tesselation);return n&&aYe(a),{components:[new iCe(a)],faceCount:a.indexCount/3,minScreenSpaceRadius:o.minScreenSpaceRadius}})});switch(t){case"sphere":return r([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],i=>sYe(e,.5,i,!0));case"cube":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>YXe(e,1));case"cone":return r(dz,i=>Tne(e,1,.5,i,!1),!0);case"inverted-cone":return r(dz,i=>Tne(e,1,.5,i,!0),!0);case"cylinder":return r(dz,i=>oYe(e,1,.5,i,[0,0,1],[0,0,.5]));case"tetrahedron":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>iYe(e,1),!0);case"diamond":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>KXe(e,1),!0);default:return}}const dz=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];function Xit(t){return t.type==="fill"}function Yit(t){return t.type==="extrude"}function Zit(t){return t&&t.enabled&&(Yit(t)||Xit(t))&&t.edges!=null}function Jit(t){return t&&t.enabled&&t.edges||null}function oCe(t,e){return aCe(Jit(t),e)}function aCe(t,e){if(t==null)return null;const r=t.color!=null?xJ(ke.toUnitRGBA(t.color)):Nt(0,0,0,0),i=wo(t.size),s=wo(t.extensionLength);switch(t.type){case"solid":return lCe({color:r,size:i,extensionLength:s,...e});case"sketch":return Qit({color:r,size:i,extensionLength:s,...e});default:return}}function lCe(t){return{...Kit,...t,type:"solid"}}function Qit(t){return{...est,...t,type:"sketch"}}const Kit={color:Nt(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:jt.OPAQUE,hasSlicePlane:!1},est={color:Nt(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:jt.OPAQUE,hasSlicePlane:!1},_K={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};function Qkt(t){return t.type==="web-style"?_K:vK(t.symbolLayers.toArray().map(e=>cCe(t,e)))}function vK(t){let e=0,r=0,i=0,s=!1,n=0;const o={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const a of t)a!=null&&(e+=a.primitivesPerFeature,r+=a.primitivesPerCoordinate,i+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.bytesPerCoordinate+=a.memory.bytesPerCoordinate,o.resourceBytes+=a.memory.resourceBytes,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.draped.bytesPerCoordinate+=a.memory.bytesPerCoordinate,s=s||a.estimated,++n);return{primitivesPerFeature:e,primitivesPerCoordinate:r,drawCallsPerFeature:i,estimated:s,memory:o,numComplexities:n}}function Kkt(t){const e=vK(t);return e.numComplexities>0&&(e.primitivesPerFeature/=e.numComplexities,e.primitivesPerCoordinate/=e.numComplexities,e.drawCallsPerFeature/=e.numComplexities,e.memory.bytesPerFeature/=e.numComplexities,e.memory.bytesPerFeatureLabel/=e.numComplexities,e.memory.bytesPerCoordinate/=e.numComplexities,e.memory.resourceBytes/=e.numComplexities,e.memory.draped.bytesPerFeature/=e.numComplexities,e.memory.draped.bytesPerFeatureLabel/=e.numComplexities,e.memory.draped.bytesPerCoordinate/=e.numComplexities),e}const Aae={};function cCe(t,e){const r=uCe(t,e),i=Zit(e)?2:0;switch(e.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:i,estimated:!1,memory:r};case"fill":return t.type==="mesh-3d"?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:i,estimated:!1,memory:r}:e.outline!=null&&e.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:r}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case"water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:r};case"object":return e.resource?.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:r}:{...tst(e.resource&&e.resource.primitive||t1e),memory:r};case"path":{let s=0,n=0;switch(e.profile){case"circle":s=rCe;break;case"quad":s=4;break;default:return void(e.profile,void 0)}switch(e.join??"simple"){case"round":n=tCe;break;case"miter":case"bevel":n=1;break;default:return}const o=2*s,a=s*n*2;let l=-2*a-o;switch(e.cap){case"none":break;case"butt":case"square":l+=2*(s-1);break;case"round":l+=2*(s*(_q-1)*2+s);break;default:return}return{primitivesPerFeature:l,primitivesPerCoordinate:a+o,drawCallsPerFeature:0,estimated:!1,memory:r}}case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:r};default:return}}function uCe(t,e){const r=t.type==="point-3d";switch(e.type){case"extrude":return e.edges&&e.edges.size>0?pl.EXTRUDE_EDGES:pl.EXTRUDE;case"fill":return e.outline!=null&&e.outline.size>0?pl.FILL_OUTLINE:pl.FILL;case"water":return pl.FILL;case"line":return e.join==="round"?pl.LINE_ROUND:pl.LINE_MITER;case"path":switch(e.join){case"round":switch(e.profile){case"circle":return pl.PATH_ROUND_CIRCLE;case"quad":return pl.PATH_ROUND_QUAD;default:return void(e.profile,void 0)}case"miter":case"bevel":switch(e.profile){case"circle":return pl.PATH_MITER_CIRCLE;case"quad":return pl.PATH_MITER_QUAD;default:return void(e.profile,void 0)}default:return}case"object":return r?pl.OBJECT_POINT:pl.OBJECT_POLYGON;case"icon":case"text":return r?pl.ICON_POINT:pl.ICON_POLYGON;default:return}}function tst(t){let e=Aae[t];if(e)return e;const r=nCe(t,null);return e={primitivesPerFeature:sCe(r.levels[0]).reduce((i,s)=>i+s.indices.get(C.POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1},Aae[t]=e,e}const pl={ICON_POINT:{bytesPerFeature:2321.5204640676384,bytesPerFeatureLabel:990.45722,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:2169.5155951150787,bytesPerFeatureLabel:999.2598599999999,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:3822.4566594216512,bytesPerFeatureLabel:1004.4288266666666,bytesPerCoordinate:3.8232947206245864,resourceBytes:0,draped:{bytesPerFeature:3656.161389156324,bytesPerFeatureLabel:994.9227800000001,bytesPerCoordinate:3.836714603517761}},OBJECT_POINT:{bytesPerFeature:1286.2669145138564,bytesPerFeatureLabel:1011.4901900000001,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:1286.2669145138564,bytesPerFeatureLabel:1011.4901900000001,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:2796.828455517831,bytesPerFeatureLabel:1012.9951500000002,bytesPerCoordinate:4.051546356517487,resourceBytes:0,draped:{bytesPerFeature:2796.828455517831,bytesPerFeatureLabel:1012.9951500000002,bytesPerCoordinate:4.051546356517487}},LINE_MITER:{bytesPerFeature:4906.045480276492,bytesPerFeatureLabel:1002.8815266666666,bytesPerCoordinate:24.04850207798191,resourceBytes:0,draped:{bytesPerFeature:4315.785832179941,bytesPerFeatureLabel:998.7028333333334,bytesPerCoordinate:19.457038722015074}},LINE_ROUND:{bytesPerFeature:4893.576398024015,bytesPerFeatureLabel:1015.8812866666666,bytesPerCoordinate:24.039686621147293,resourceBytes:0,draped:{bytesPerFeature:4321.076505943878,bytesPerFeatureLabel:1008.7058400000001,bytesPerCoordinate:19.522527447599565}},PATH_MITER_CIRCLE:{bytesPerFeature:27475.37385725739,bytesPerFeatureLabel:945.1915,bytesPerCoordinate:1936.190695268645,resourceBytes:0,draped:{bytesPerFeature:27475.37385725739,bytesPerFeatureLabel:945.1915,bytesPerCoordinate:1936.190695268645}},PATH_ROUND_CIRCLE:{bytesPerFeature:13432.532036888486,bytesPerFeatureLabel:949.8167000000001,bytesPerCoordinate:4250.913048917402,resourceBytes:0,draped:{bytesPerFeature:13432.532036888486,bytesPerFeatureLabel:949.8167000000001,bytesPerCoordinate:4250.913048917402}},PATH_MITER_QUAD:{bytesPerFeature:17083.041162790672,bytesPerFeatureLabel:1006.4104,bytesPerCoordinate:1543.9135284683243,resourceBytes:0,draped:{bytesPerFeature:17083.041162790672,bytesPerFeatureLabel:1006.4104,bytesPerCoordinate:1543.9135284683243}},PATH_ROUND_QUAD:{bytesPerFeature:24054.406240577355,bytesPerFeatureLabel:976.0122999999999,bytesPerCoordinate:2683.863857257418,resourceBytes:0,draped:{bytesPerFeature:24054.406240577355,bytesPerFeatureLabel:976.0122999999999,bytesPerCoordinate:2683.863857257418}},FILL:{bytesPerFeature:5336.950602511737,bytesPerFeatureLabel:993.6785799999999,bytesPerCoordinate:9.558162275921951,resourceBytes:0,draped:{bytesPerFeature:4643.732435264264,bytesPerFeatureLabel:1003.6394400000001,bytesPerCoordinate:8.123952159573538}},FILL_OUTLINE:{bytesPerFeature:8210.8457089066,bytesPerFeatureLabel:1006.2871066666667,bytesPerCoordinate:14.496686428135353,resourceBytes:0,draped:{bytesPerFeature:6982.149803527473,bytesPerFeatureLabel:1005.1158800000001,bytesPerCoordinate:11.034666572000932}},EXTRUDE:{bytesPerFeature:16336.386002724352,bytesPerFeatureLabel:1013.2957066666665,bytesPerCoordinate:40.50904192903909,resourceBytes:0,draped:{bytesPerFeature:16336.386002724352,bytesPerFeatureLabel:1013.2957066666665,bytesPerCoordinate:40.50904192903909}},EXTRUDE_EDGES:{bytesPerFeature:18251.260762353977,bytesPerFeatureLabel:1044.1864133333333,bytesPerCoordinate:40.594518397678755,resourceBytes:0,draped:{bytesPerFeature:18251.260762353977,bytesPerFeatureLabel:1044.1864133333333,bytesPerCoordinate:40.594518397678755}}},fT=K.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");let Nm=class extends yK{constructor(e,r,i,s){super(i.schedule),this.symbol=e,this.symbolLayer=r,this._context=i,this._elevationInfoOverride=null,this.ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this.complexity=null,this.logger=fT,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.skipHighSymbolLodsChanged=!0,this._renderPriority=s.renderPriority,this._renderPriorityStep=s.renderPriorityStep,this._elevationContext=new Up,this.complexity=this.computeComplexity(),this.ignoreDrivers=s.ignoreDrivers,this.ignoreDrivers||(this._drivenProperties=Oae(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}_drivenPropertiesChanged(e){if(this.ignoreDrivers)return!1;const r=this._drivenProperties,i=Oae(e);return i.color!==r.color||i.opacity!==r.opacity||i.opacityAlwaysOpaque!==r.opacityAlwaysOpaque||i.size!==r.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,r,i,s){const n=e.projectionSuccess,o="polygons"in e?e.polygons:null,a=`${s} geometry failed to be created`;let l=null;n?!this._logGeometryValidationWarnings(r,i,s)&&o&&o.length===0&&i==="rings"&&r.length>0&&r[0].length>2&&(l=`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):l=`${a} (failed to project geometry to view spatial reference)`,l&&fT.warnOncePerTick(l)}_logGeometryValidationWarnings(e,r,i){const s=`${i} geometry failed to be created`;return!e.length||e.length===1&&!e[0].length?(fT.warnOncePerTick(`${s} (no ${r} were defined)`),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(fT.warnOncePerTick(`${s} (${r} should be defined as a 2D array)`),!0)}_validateGeometry(e,r=null,i=null){if(r!=null&&!r.includes(e.type))return this.logger.warn("unsupported geometry type for "+i+` symbol: ${e.type}`),!1;if(e.type==="point"){const s=e;if(!isFinite(s.x)||!isFinite(s.y))return fT.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return rst}_defaultElevationInfoZ(){return ist}_updateElevationContext(){this._elevationInfoOverride!=null?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,r=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||r.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,r){const i=e.geometry,s=this.getDefaultElevationInfo(i);r.unit=this._elevationContext.unit!=null?this._elevationContext.unit:s.unit,r.mode=this.getGeometryElevationMode(i,s),r.offsetMeters=this._elevationContext.meterUnitOffset??s.offset??0;const n=!this._elevationOptions.supportsOnTheGround&&r.mode==="on-the-ground";n&&(r.mode="relative-to-ground",r.offsetMeters=0);const o=n?Git:this._elevationContext.featureExpressionInfoContext;return r.updateFeatureExpressionInfoContext(o,e,this._context.layer),r}prepareSymbolLayerPatch(e){}updateGeometry(e,r){return!1}updateTransform(e,r,i,s){return!1}onRemoveGraphic(e){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(e,r=Rae){let i=1;return this.draped||(i*=this._getLayerOpacity()),this._drivenProperties.opacity||(e!=null?i*=e.a:r.hasIntrinsicColor||(i=0)),i}_getCombinedOpacityAndColor(e,r=Rae){const i=this._getCombinedOpacity(e,r);if(this._drivenProperties.color)return MR(null,i);const s=e!=null?ke.toUnitRGB(e):Hg;return MR(s,i)}_getVertexOpacityAndColor(e,r=null){const i=this._drivenProperties.color?e.color:null,s=this._drivenProperties.opacity?e.opacity:null,n=MR(i,s);return r&&(n[0]*=r,n[1]*=r,n[2]*=r,n[3]*=r),n}isFastUpdatesEnabled(){return this._fastUpdates!=null}computeComplexity(){return cCe(this.symbol,this.symbolLayer)}globalPropertyChanged(e,r,i){switch(e){case"opacity":return this.layerOpacityChanged(r,i),!0;case"elevationInfo":{const s=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(r,i,s)!==hs.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(r,i);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged;case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(e,r,i){let s=hs.UPDATE;return e.forEach(n=>{const o=r(n);if(o!=null){const a=n.graphic;this.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=i(o.elevationContext.mode)}else s=hs.RECREATE}),s}applyRendererDiff(e,r){return Us.RecreateSymbol}getFastUpdateAttrValues(e){if(!this._fastUpdates)return null;const r=this._fastUpdates.visualVariables,i=r.size?Tp(r.size.field,e):0,s=r.color?Tp(r.color.field,e):0,n=r.opacity?Tp(r.opacity.field,e):0;return Nt(i,s,n,0)}get draped(){return this._draped}ensureDrapedStatus(e){return this._draped==null?(this._draped=e,!0):(e!==this.draped&&fT.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const e=()=>({size:this._fastUpdates?.visualVariables.size?.field??null,color:this._fastUpdates?.visualVariables.color?.field??null,opacity:this._fastUpdates?.visualVariables.opacity?.field??null,rotation:this._fastUpdates?.visualVariables.rotation?.field??null});return{drivenProperties:this._drivenProperties,getVisVarFields:e}}};function Oae(t){const e={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return t&&"visualVariables"in t&&t.visualVariables&&t.visualVariables.forEach(r=>{switch(r.type){case"color":if(e.color=!0,r.stops)for(let i=0;i<r.stops.length;i++){const s=r.stops[i].color;s&&(e.opacity=!0,s.a<1&&(e.opacityAlwaysOpaque=!1))}break;case"opacity":e.opacity=!0,e.opacityAlwaysOpaque=!1;break;case"size":e.size=!0}}),e}const rst={mode:"on-the-ground",offset:0,unit:"meters"},ist={mode:"absolute-height",offset:0,unit:"meters"},Rae={hasIntrinsicColor:!1};let B0=class extends DP{get geometries(){return this._geometries}get transformation(){return this._transformation??pn}set transformation(e){this._transformation=zs(this._transformation??xe(),e),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}get shaderTransformation(){return this._shaderTransformation??this.transformation}set shaderTransformation(e){this._shaderTransformation=zs(this._shaderTransformation??xe(),e),this._invalidateBoundingVolume(),this._emit("objectShaderTransformation",this)}clearShaderTransformation(){this._shaderTransformation=void 0,this._invalidateBoundingVolume(),this._emit("objectShaderTransformation",this)}constructor(e={}){super(),this.type=us.Object,this._hasVolatileTransformation=!1,this._parentLayer=null,this._visible=!0,this.castShadow=e.castShadow??!0,this.usesVerticalDistanceToGround=e.usesVerticalDistanceToGround??!1,this.graphicUid=e.graphicUid,this.layerUid=e.layerUid,e.isElevationSource&&(this.lastValidElevationBB=new hCe),this._geometries=e.geometries?Array.from(e.geometries):new Array}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){ot(this._parentLayer==null||e==null,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._hasVolatileTransformation=this._hasVolatileTransformation||e.hasVolatileTransformation,this._emit("objectGeometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const r=this._geometries.splice(e,1)[0];r&&(this._emit("objectGeometryRemoved",{object:this,geometry:r}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(e){this._emit("objectGeometryUpdated",{object:this,geometry:e}),this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const r of this._geometries)r.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new Y5(T0.MaskOccludee);for(const r of this._geometries)r.occludees=IH(r.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const r of this._geometries)r.occludees=$H(r.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new Y5(T0.Highlight);for(const r of this._geometries)r.highlights=IH(r.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const r of this._geometries)r.highlights=$H(r.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,r){return ai(r,this.transformation,e.transformation)}getCombinedShaderTransformation(e,r=xe()){return ai(r,this.shaderTransformation,e.shaderTransformation)}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._bvWorldSpace&&!this._hasVolatileTransformation||(this._bvWorldSpace=this._bvWorldSpace||new Mae,this._validateBoundingVolume(this._bvWorldSpace,PR.WorldSpace)),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._bvObjectSpace&&!this._hasVolatileTransformation||(this._bvObjectSpace=this._bvObjectSpace||new Mae,this._validateBoundingVolume(this._bvObjectSpace,PR.ObjectSpace)),this._bvObjectSpace}_validateBoundingVolume(e,r){const i=r===PR.ObjectSpace;for(const s of this._geometries){const n=s.boundingInfo;n&&sst(n,e,i?s.shaderTransformation:this.getCombinedShaderTransformation(s))}qr(e.bounds,e.min,e.max,.5);for(const s of this._geometries){const n=s.boundingInfo;if(n==null)continue;const o=i?s.shaderTransformation:this.getCombinedShaderTransformation(s),a=ME(o);ze(Pae,n.center,o);const l=mi(Pae,e.bounds),c=n.radius*a;e.bounds[3]=Math.max(e.bounds[3],l+c)}}_invalidateBoundingVolume(){const e=this._bvWorldSpace?.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0,this._parentLayer&&e&&this._parentLayer.notifyObjectBBChanged(this,e)}_emit(e,r){this._parentLayer&&this._parentLayer.events.emit(e,r)}get test(){const e=this;return{hasGeometry:r=>e._geometries.includes(r),getGeometryIndex:r=>e._geometries.indexOf(r)}}},hCe=class{constructor(){this.min=Pe(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Pe(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}},Mae=class extends hCe{constructor(){super(...arguments),this.bounds=xs()}};function sst(t,e,r){const i=t.bbMin,s=t.bbMax;if(v8(r)){const n=ne(nst,r[12],r[13],r[14]);de(Wc,i,n),de(md,s,n);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],Wc[o]),e.max[o]=Math.max(e.max[o],md[o])}else if(ze(Wc,i,r),ma(i,s))for(let n=0;n<3;++n)e.min[n]=Math.min(e.min[n],Wc[n]),e.max[n]=Math.max(e.max[n],Wc[n]);else{ze(md,s,r);for(let n=0;n<3;++n)e.min[n]=Math.min(e.min[n],Wc[n],md[n]),e.max[n]=Math.max(e.max[n],Wc[n],md[n]);for(let n=0;n<3;++n){ie(Wc,i),ie(md,s),Wc[n]=s[n],md[n]=i[n],ze(Wc,Wc,r),ze(md,md,r);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],Wc[o],md[o]),e.max[o]=Math.max(e.max[o],Wc[o],md[o])}}}const nst=O(),Wc=O(),md=O(),Pae=O();var PR;(function(t){t[t.WorldSpace=0]="WorldSpace",t[t.ObjectSpace=1]="ObjectSpace"})(PR||(PR={}));function bK(t,e,r,i,s,n){const o=t.clippingExtent;if(Ao(e,j_,t.elevationProvider.spatialReference),o!=null&&!rJ(o,j_))return null;Ao(e,j_,t.renderCoordsHelper.spatialReference),r.shaderTransformer=n,r.localOrigin=t.localOriginFactory.getOrigin(j_);const a=new B0({geometries:[r],castShadow:!1,layerUid:t.layer.uid,graphicUid:s,usesVerticalDistanceToGround:!0});return{object:a,sampledElevation:Sit(a,e,t.elevationProvider,t.renderCoordsHelper,i)}}function DM(t,e,r){const i=t.elevationContext,s=r.spatialReference;Ao(e,j_,s),i.centerPointInElevationSR=Fx(j_[0],j_[1],e.hasZ?j_[2]:0,s??null)}function NM(t){switch(t.type){case"point":return t;case"polygon":case"extent":return pK(t);case"polyline":{const e=t.paths[0];if(!e||e.length===0)return null;const r=Bye(e,Vye(e)/2);return Fx(r[0],r[1],r[2],t.spatialReference)}case"mesh":return t.origin}return null}const j_=O();function dCe(){return new Float32Array(2)}function ost(t){const e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e}function Rh(t,e){const r=new Float32Array(2);return r[0]=t,r[1]=e,r}function ast(t,e){return new Float32Array(t,e,2)}function pCe(){return dCe()}function fCe(){return Rh(1,1)}function mCe(){return Rh(1,0)}function gCe(){return Rh(0,1)}const yCe=pCe(),_Ce=fCe(),lst=mCe(),cst=gCe();Object.freeze(Object.defineProperty({__proto__:null,ONES:_Ce,UNIT_X:lst,UNIT_Y:cst,ZEROS:yCe,clone:ost,create:dCe,createView:ast,fromValues:Rh,ones:fCe,unitX:mCe,unitY:gCe,zeros:pCe},Symbol.toStringTag,{value:"Module"}));function ust(t){const e=new Sr,{vertex:r,fragment:i}=e;return r.include(u9),e.include(MSe,t),e.include(vs,t),e.attributes.add(C.UV0,"vec2"),r.uniforms.add(new sr("viewport",(s,n)=>n.camera.fullViewport),new Ie("lineSize",(s,n)=>s.size>0?Math.max(1,s.size)*n.camera.pixelRatio:0),new Ar("pixelToNDC",(s,n)=>or($ae,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new Ie("borderSize",(s,n)=>s.borderColor!=null?n.camera.pixelRatio:0),new Ar("screenOffset",(s,n)=>or($ae,s.screenOffset[0]*n.camera.pixelRatio,s.screenOffset[1]*n.camera.pixelRatio))),e.varyings.add("coverageSampling","vec4"),e.varyings.add("lineSizes","vec2"),t.hasMultipassGeometry&&e.varyings.add("depth","float"),t.hasScreenSizePerspective&&c9(r),r.code.add(w`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${t.occlusionTestEnabled?w`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${t.hasScreenSizePerspective?w`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:w`vec2 screenOffsetScaled = screenOffset;`}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
      // correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${t.hasMultipassGeometry?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${t.depthHudEnabled?t.depthHudAlignStartEnabled?w`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:w`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${t.hasScreenSizePerspective?w`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:w`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),i.uniforms.add(new sr("uColor",s=>Iae(s.color)),new sr("borderColor",s=>Iae(s.borderColor))),t.hasMultipassGeometry&&(i.include(nTe,t),i.uniforms.add(new Ar("inverseViewport",(s,n)=>n.inverseViewport))),i.code.add(w`
    void main() {
      ${t.hasMultipassGeometry?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line blends on top of the
      // border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${t.depthHudEnabled?w`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:w`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      fragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),e}function Iae(t){return t??rm}const $ae=He(),hst=Object.freeze(Object.defineProperty({__proto__:null,build:ust},Symbol.toStringTag,{value:"Module"}));let vCe=class bCe extends Lr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Ve.Global}initializeProgram(e){return new Rr(e.rctx,bCe.shader.get().build(this.configuration),Tr)}setPipelineState(e){const r=e?ri.ALWAYS:ri.LESS;return this.configuration.depthHudEnabled?Mt({depthTest:{func:r},depthWrite:jl}):Mt({blending:Oo(Se.ONE,Se.SRC_ALPHA,Se.ONE_MINUS_SRC_ALPHA,Se.ONE_MINUS_SRC_ALPHA),depthTest:{func:r},colorWrite:Bt})}initializePipeline(){return this.setPipelineState(this.configuration.hasMultipassGeometry)}};vCe.shader=new Or(hst,()=>he(()=>import("./LineCallout.glsl-7eb0bfb4.js"),[],import.meta.url));let ch=class extends jo{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=Il.World,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.hasMultipassGeometry=!1}};u([B({count:Il.COUNT})],ch.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([B()],ch.prototype,"spherical",void 0),u([B()],ch.prototype,"occlusionTestEnabled",void 0),u([B()],ch.prototype,"hasVerticalOffset",void 0),u([B()],ch.prototype,"hasScreenSizePerspective",void 0),u([B()],ch.prototype,"depthHudEnabled",void 0),u([B()],ch.prototype,"depthHudAlignStartEnabled",void 0),u([B()],ch.prototype,"hasSlicePlane",void 0),u([B()],ch.prototype,"hasMultipassGeometry",void 0),u([B({constValue:!0})],ch.prototype,"hasSliceInVertexProgram",void 0),u([B({constValue:!1})],ch.prototype,"draped",void 0);let G$=class vq extends Fv{get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}constructor(e){super(e,new wCe),this._configuration=new ch,this._uniqueMaterialIdentifier=vq.uniqueMaterialIdentifier(this.parameters)}getPassParameters(){return this.parameters}getConfiguration(e,r){const i=r?.slot!==pe.LINE_CALLOUTS;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.depthHudEnabled=i,this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?Il.Screen:Il.World,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasMultipassGeometry=r.multipassGeometry.enabled,this._configuration}intersect(){}requiresSlot(e,r){if(r===F.Color)switch(e){case pe.LINE_CALLOUTS:case pe.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1}createGLMaterial(e){return new dst(e)}createBufferWriter(){return new fst}validateParameters(e){const r=vq.uniqueMaterialIdentifier(e);r!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=r)}static uniqueMaterialIdentifier(e){return JSON.stringify({screenOffset:e.screenOffset||[0,0],centerOffsetUnits:e.centerOffsetUnits||"world"})}},dst=class extends Dv{beginSlot(e){return this.ensureTechnique(vCe,e)}},wCe=class extends eK{constructor(){super(...arguments),this.screenOffset=Pp,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}};const pst=qi().vec3f(C.POSITION).vec3f(C.NORMAL).vec2f(C.UV0).vec4f(C.AUXPOS1),Lae=[Rh(0,0),Rh(1,0),Rh(0,1),Rh(1,0),Rh(1,1),Rh(0,1)];let fst=class{constructor(){this.vertexBufferLayout=pst}elementCount(e){return 6*e.indices.get(C.POSITION).length}write(e,r,i,s,n){tK(i.indices.get(C.POSITION),i.vertexAttributes.get(C.POSITION).data,e,s.position,n,6),rK(i.indices.get(C.NORMAL),i.vertexAttributes.get(C.NORMAL).data,r,s.normal,n,6),HE(i.indices.get(C.AUXPOS1),i.vertexAttributes.get(C.AUXPOS1).data,s.auxpos1,n,6);for(let o=0;o<Lae.length;++o)s.uv0.setVec(n+o,Lae[o])}},xCe=class TCe extends Nm{constructor(e,r){super(e,null,r,yst),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._material=new G$(this._materialParameters),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}_perInstanceMaterialParameters(e){const r=this._materialParameters;return r.screenOffset=e.screenOffset||Pp,r.centerOffsetUnits=e.centerOffsetUnits||"world",r}get _materialParameters(){const e=new wCe,r=this.symbol,i=r.callout;if(e.color=i.color!=null?ke.toUnitRGBA(i.color):[0,0,0,0],e.color[3]*=this._getLayerOpacity(),e.size=wo(i.size||0),r.verticalOffset){const{screenLength:o,minWorldLength:a,maxWorldLength:l}=r.verticalOffset;e.verticalOffset={screenLength:wo(o),minWorldLength:a||0,maxWorldLength:l??1/0}}e.borderColor=i.border!=null&&i.border.color!=null?ke.toUnitRGBA(i.border.color):null;const s=r.symbolLayers.at(0).type==="object",n=r.type==="label-3d";return e.occlusionTest=!s,e.shaderPolygonOffset=s?0:void 0,e.depthHUDAlignStart=n,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return gst}createGraphics3DGraphic(e){const r=e.renderingInfo,i=e.graphic,s=this.setGraphicElevationContext(i,new Up,r.elevationOffset||0),n=r.symbol,o=this._elevationContext.mode==="on-the-ground"&&(n.type==="cim"||!n.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(n.type!=="label-3d"&&o||n.type==="point-3d"&&n.symbolLayers.every(l=>l.type==="text"&&!a1e(l)))return null;const a=pK(i.geometry);return a==null?null:this._createAs3DShape(a,s,r,i.uid)}layerOpacityChanged(){this._material?.setParameters(this._materialParameters)}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=HP(TCe.elevationModeChangeTypes,i,s);return n!==hs.UPDATE||e.forEach(o=>{const a=r(o);a!=null&&this.updateGraphicElevationContext(o.graphic,a)}),n}slicePlaneEnabledChanged(){return this._material?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(e,r,i=0){const s=super.setGraphicElevationContext(e,r);return s.addOffsetRenderUnits(i),s}updateGraphicElevationContext(e,r){this.setGraphicElevationContext(e,r.elevationContext,r.metadata!=null?r.metadata.elevationOffset:0),r.needsElevationUpdates=td(r.elevationContext.mode)}computeComplexity(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:_K.memory}}_createVertexData(e){const{translation:r,centerOffset:i}=e,s=new We(r?[r[0],r[1],r[2]]:[0,0,0],3,!0),n=new We(i?[i[0],i[1],i[2],i[3]]:[0,0,0,1],4,!0);return[[C.POSITION,s],[C.NORMAL,new We([0,0,1],3,!0)],[C.AUXPOS1,n]]}_getOrCreateMaterial(e){const r=this._perInstanceMaterialParameters(e),i=G$.uniqueMaterialIdentifier(r);if(this._material&&i===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(e.materialCollection!=null){let s=e.materialCollection.get(i);return s==null&&(s=new G$(r),e.materialCollection.add(i,s)),{material:s,isUnique:!1}}return{material:new G$(r),isUnique:!0}}_createAs3DShape(e,r,i,s){const n=this._context.layer.uid,o=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:n}),a=this._getOrCreateMaterial(i),l=new Ks(a.material,this._createVertexData(i),mst,null,us.Point,o),c=bK(this._context,e,l,r,s);if(c==null)return null;const h=new Dm(this,c.object,[l],a.isUnique?[a.material]:null,null,ww,r);return h.metadata=new eCe(i.elevationOffset),h.alignedSampledElevation=c.sampledElevation,h.needsElevationUpdates=td(r.mode),DM(h,e,this._context.elevationProvider),h}};xCe.elevationModeChangeTypes={definedChanged:hs.UPDATE,staysOnTheGround:hs.UPDATE,onTheGroundChanged:hs.RECREATE};const pz=[0],mst=[[C.POSITION,pz],[C.NORMAL,pz],[C.AUXPOS1,pz]],gst={mode:"relative-to-ground",offset:0},yst={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};let _st=class{constructor(e,r,i=O(),s=Wt(),n=He(),o="world",a=0,l=null){this.renderer=e,this.symbol=r,this.translation=i,this.centerOffset=s,this.screenOffset=n,this.centerOffsetUnits=o,this.elevationOffset=a,this.materialCollection=l}},vst=class extends jit{};const Dae=K.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function bst(t,e){if(!cJ(t))return Dae.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${t.type}' does not support callouts`),null;if(!t.callout)return null;const r=wst[t.callout.type];return r?new r(t,e):(Dae.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${t.callout.type}`),null)}const wst={line:xCe};let Kw=class SCe{constructor(e=null,r={},i,s){this.geometry=e,this.attributes=r,this.centroid=i,this.objectId=s,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const e=new SCe(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}};function uzt(t){return!(t.geometry==null||!t.geometry.coords||!t.geometry.coords.length)}let hzt=class extends Kw{},xst=class ECe{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new ECe;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}},Sv=class DN{constructor(e=[],r=[],i=!1){this.lengths=e??[],this.coords=r??[],this.hasIndeterminateRingOrder=i}static fromRect(e){const[r,i,s,n]=e,o=s-r,a=n-i;return new DN([5],[r,i,o,0,0,a,-o,0,0,-a])}get isPoint(){return this.lengths.length===0}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((e,r)=>e+r)}forEachVertex(e){let r=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let i=0;i<this.lengths.length;i++){const s=this.lengths[i];for(let n=0;n<s;n++)e(this.coords[2*(n+r)],this.coords[2*(n+r)+1]);r+=s}}clone(e){return e?(e.set(this.coords),new DN(this.lengths.slice(),e,this.hasIndeterminateRingOrder)):new DN(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}};function xa(t,e){return t?e?4:3:e?3:2}const WP=K.getLogger("esri.layers.graphics.featureConversionUtils"),CCe={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryEnvelope:0},Tst=(t,e,r,i,s,n)=>{t[r]=s,t[r+1]=n},Nae=(t,e,r,i,s,n)=>{t[r]=s,t[r+1]=n,t[r+2]=e[i+2]},Sst=(t,e,r,i,s,n)=>{t[r]=s,t[r+1]=n,t[r+2]=e[i+3]},Est=(t,e,r,i,s,n)=>{t[r]=s,t[r+1]=n,t[r+2]=e[i+2],t[r+3]=e[i+3]};function wK(t,e,r,i){if(t){if(r)return e&&i?Est:Nae;if(e&&i)return Sst}else if(e&&i)return Nae;return Tst}function fz({scale:t,translate:e},r){return Math.round((r-e[0])/t[0])}function mz({scale:t,translate:e},r){return Math.round((e[1]-r)/t[1])}function gz({scale:t,translate:e},r,i){return r*t[i]+e[i]}function pzt(t,e,r){return t?e?r?SK(t):xK(t):r?TK(t):w9(t):null}function w9(t){const e=t.coords;return{x:e[0],y:e[1]}}function ACe(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t}function xK(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2]}}function Cst(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t}function TK(t){const e=t.coords;return{x:e[0],y:e[1],m:e[2]}}function Ast(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.m,t}function SK(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2],m:e[3]}}function Ost(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t.coords[3]=e.m,t}function Rst(t,e,r,i){let s=w9;r&&i?s=SK:r?s=xK:i&&(s=TK);for(const n of e){const{geometry:o,attributes:a}=n,l=o!=null?s(o):null;t.push({attributes:a,geometry:l})}return t}function EK(t,e){return t&&e?Ost:t?Cst:e?Ast:ACe}function Mst(t,e,r,i,s){const n=EK(r,i);for(const{geometry:o,attributes:a}of e){const l=o!=null?n(new Sv,o):null;t.push(new Kw(l,a,null,s?a[s]:void 0))}return t}function fzt(t,e,r=EK(e.z!=null,e.m!=null)){return r(t,e)}function Pst(t,e,r,i){for(const{geometry:s,attributes:n}of e)t.push({attributes:n,geometry:s!=null?OCe(s,r,i):null});return t}function OCe(t,e,r){if(t==null)return null;const i=xa(e,r),s=[];for(let n=0;n<t.coords.length;n+=i){const o=[];for(let a=0;a<i;a++)o.push(t.coords[n+a]);s.push(o)}return e?r?{points:s,hasZ:e,hasM:r}:{points:s,hasZ:e}:r?{points:s,hasM:r}:{points:s}}function Ist(t,e,r,i,s){const n=xa(r,i);for(const{geometry:o,attributes:a}of e){const l=o!=null?RCe(new Sv,o,n):null;t.push(new Kw(l,a,null,s?a[s]:void 0))}return t}function RCe(t,e,r=xa(e.hasZ,e.hasM)){t.lengths[0]=e.points.length;const i=t.coords;let s=0;for(const n of e.points)for(let o=0;o<r;o++)i[s++]=n[o];return t}function $st(t,e,r,i){for(const{geometry:s,attributes:n}of e)t.push({attributes:n,geometry:s!=null?MCe(s,r,i):null});return t}function MCe(t,e,r){if(!t)return null;const i=xa(e,r),{coords:s,lengths:n}=t,o=[];let a=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const d=[];for(let f=0;f<i;f++)d.push(s[a++]);c.push(d)}o.push(c)}return e?r?{paths:o,hasZ:e,hasM:r}:{paths:o,hasZ:e}:r?{paths:o,hasM:r}:{paths:o}}function Lst(t,e,r,i,s){const n=xa(r,i);for(const{geometry:o,attributes:a}of e){const l=o!=null?PCe(new Sv,o,n):null;t.push(new Kw(l,a,null,s?a[s]:void 0))}return t}function PCe(t,e,r=xa(e.hasZ,e.hasM)){const{lengths:i,coords:s}=t;let n=0;for(const o of e.paths){for(const a of o)for(let l=0;l<r;l++)s[n++]=a[l];i.push(o.length)}return t}function Dst(t,e,r,i){for(const{geometry:s,attributes:n,centroid:o}of e){const a=s!=null?ICe(s,r,i):null;if(o!=null){const l=w9(o);t.push({attributes:n,centroid:l,geometry:a})}else t.push({attributes:n,geometry:a})}return t}function ICe(t,e,r){if(!t)return null;const i=xa(e,r),{coords:s,lengths:n}=t,o=[];let a=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const d=[];for(let f=0;f<i;f++)d.push(s[a++]);c.push(d)}o.push(c)}return e?r?{rings:o,hasZ:e,hasM:r}:{rings:o,hasZ:e}:r?{rings:o,hasM:r}:{rings:o}}function Nst(t,e,r,i,s){for(const{geometry:n,centroid:o,attributes:a}of e){const l=n!=null?$Ce(new Sv,n,r,i):null,c=s?a[s]:void 0;o!=null?t.push(new Kw(l,a,ACe(new Sv,o),c)):t.push(new Kw(l,a,null,c))}return t}function $Ce(t,e,r=e.hasZ,i=e.hasM){return Fst(t,e.rings,r,i)}function Fst(t,e,r,i){const s=xa(r,i),{lengths:n,coords:o}=t;let a=0;i0(t);for(const l of e){for(const c of l)for(let h=0;h<s;h++)o[a++]=c[h];n.push(l.length)}return t}const jS=[],IR=[];function mzt(t,e,r,i,s){jS[0]=t;const[n]=LCe(IR,jS,e,r,i,s);return Lp(jS),Lp(IR),n}function LCe(t,e,r,i,s,n){if(Lp(t),!r){for(const o of e){const a=n?o.attributes[n]:void 0;t.push(new Kw(null,o.attributes,null,a))}return t}switch(r){case"esriGeometryPoint":return Mst(t,e,i,s,n);case"esriGeometryMultipoint":return Ist(t,e,i,s,n);case"esriGeometryPolyline":return Lst(t,e,i,s,n);case"esriGeometryPolygon":return Nst(t,e,i,s,n);default:WP.error("convertToFeatureSet:unknown-geometry",new U(`Unable to parse unknown geometry type '${r}'`)),Lp(t)}return t}function gzt(t,e,r,i){IR[0]=t,DCe(jS,IR,e,r,i);const s=jS[0];return Lp(jS),Lp(IR),s}function Ust(t,e,r){if(t==null)return null;const i=new Sv;return"hasZ"in t&&e==null&&(e=t.hasZ),"hasM"in t&&r==null&&(r=t.hasM),IZ(t)?EK(e??t.z!=null,r??t.m!=null)(i,t):$S(t)?$Ce(i,t,e,r):$Z(t)?PCe(i,t,xa(e,r)):PZ(t)?RCe(i,t,xa(e,r)):void WP.error("convertFromGeometry:unknown-geometry",new U(`Unable to parse unknown geometry type '${t}'`))}function kst(t,e,r,i){const s=t&&("coords"in t?t:t.geometry);if(s==null)return null;switch(e){case"esriGeometryPoint":{let n=w9;return r&&i?n=SK:r?n=xK:i&&(n=TK),n(s)}case"esriGeometryMultipoint":return OCe(s,r,i);case"esriGeometryPolyline":return MCe(s,r,i);case"esriGeometryPolygon":return ICe(s,r,i);default:return WP.error("convertToGeometry:unknown-geometry",new U(`Unable to parse unknown geometry type '${e}'`)),null}}function zst(t,e){for(const r of e)t.push({attributes:r.attributes});return t}function DCe(t,e,r,i,s){if(Lp(t),r==null)return zst(t,e);switch(r){case"esriGeometryPoint":return Rst(t,e,i,s);case"esriGeometryMultipoint":return Pst(t,e,i,s);case"esriGeometryPolyline":return $st(t,e,i,s);case"esriGeometryPolygon":return Dst(t,e,i,s);default:WP.error("convertToFeatureSet:unknown-geometry",new U(`Unable to parse unknown geometry type '${r}'`))}return t}function yzt(t){const{objectIdFieldName:e,spatialReference:r,transform:i,fields:s,hasM:n,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:h,queryGeometry:d,queryGeometryType:f}=t,m={features:DCe([],a,l,o,n),fields:s,geometryType:l,objectIdFieldName:e,spatialReference:r,uniqueIdField:h,queryGeometry:kst(d,f,!1,!1)};return i&&(m.transform=i),c&&(m.exceededTransferLimit=c),n&&(m.hasM=n),o&&(m.hasZ=o),m}function _zt(t,e){const r=new xst,{hasM:i,hasZ:s,features:n,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:c,transform:h,fields:d}=t;return d&&(r.fields=d),r.geometryType=l??null,r.objectIdFieldName=o??e??null,r.spatialReference=a??null,r.objectIdFieldName?(n&&LCe(r.features,n,l,s,i,r.objectIdFieldName),c&&(r.exceededTransferLimit=c),i&&(r.hasM=i),s&&(r.hasZ=s),h&&(r.transform=h),r):(WP.error(new U("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),r)}function vzt(t){const{transform:e,features:r,hasM:i,hasZ:s}=t;if(!e)return t;for(const n of r)n.geometry!=null&&Uae(n.geometry,n.geometry,i,s,e),n.centroid!=null&&Uae(n.centroid,n.centroid,i,s,e);return t.transform=null,t}function bzt(t,e){const{geometryType:r,features:i,hasM:s,hasZ:n}=e;if(!t)return e;for(let o=0;o<i.length;o++){const a=i[o],l=a.weakClone();l.geometry=new Sv,Fae(l.geometry,a.geometry,s,n,r,t),a.centroid&&(l.centroid=new Sv,Fae(l.centroid,a.centroid,s,n,"esriGeometryPoint",t)),i[o]=l}return e.transform=t,e}function Fae(t,e,r,i,s,n,o=r,a=i){if(i0(t),e==null||!e.coords.length)return null;const l=CCe[s],{coords:c,lengths:h}=e,d=xa(r,i),f=xa(r&&o,i&&a),m=wK(r,i,o,a);if(!h.length)return m(t.coords,c,0,0,fz(n,c[0]),mz(n,c[1])),i0(t,d,0),t;let g,_,v,b,T=0,x=0,S=x;for(const E of h){if(E<l)continue;let A=0;x=S,v=g=fz(n,c[T]),b=_=mz(n,c[T+1]),m(t.coords,c,x,T,v,b),A++,T+=d,x+=f;for(let R=1;R<E;R++,T+=d)v=fz(n,c[T]),b=mz(n,c[T+1]),v===g&&b===_||(m(t.coords,c,x,T,v-g,b-_),x+=f,A++,g=v,_=b);A>=l&&(t.lengths.push(A),S=x)}return Lp(t.coords,S),t.coords.length?t:null}function wzt(t,e,r,i,s,n,o=r,a=i){if(i0(t),!e||!e.coords.length)return null;const l=CCe[s],{coords:c,lengths:h}=e,d=xa(r,i),f=xa(r&&o,i&&a),m=wK(r,i,o,a);if(!h.length)return m(t.coords,c,0,0,c[0],c[1]),i0(t,d,0),t;let g=0;const _=n*n;for(const v of h){if(v<l){g+=v*d;continue}const b=t.coords.length/f,T=g,x=g+(v-1)*d;m(t.coords,c,t.coords.length,T,c[T],c[T+1]),bq(t.coords,c,d,_,m,T,x),m(t.coords,c,t.coords.length,x,c[x],c[x+1]);const S=t.coords.length/f-b;S>=l?t.lengths.push(S):Lp(t.coords,b*f),g+=v*d}return t.coords.length?t:null}function Vst(t,e,r,i){const s=t[e],n=t[e+1],o=t[r],a=t[r+1],l=t[i],c=t[i+1];let h=o,d=a,f=l-h,m=c-d;if(f!==0||m!==0){const g=((s-h)*f+(n-d)*m)/(f*f+m*m);g>1?(h=l,d=c):g>0&&(h+=f*g,d+=m*g)}return f=s-h,m=n-d,f*f+m*m}function bq(t,e,r,i,s,n,o){let a,l=i,c=0;for(let h=n+r;h<o;h+=r)a=Vst(e,h,n,o),a>l&&(c=h,l=a);l>i&&(c-n>r&&bq(t,e,r,i,s,n,c),s(t,e,t.length,c,e[c],e[c+1]),o-c>r&&bq(t,e,r,i,s,c,o))}function xzt(t,e,r,i){if(e==null||!e.coords||!e.coords.length)return null;const s=xa(r,i);let n=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(e&&e.coords){const c=e.coords;for(let h=0;h<c.length;h+=s){const d=c[h],f=c[h+1];n=Math.min(n,d),a=Math.max(a,d),o=Math.min(o,f),l=Math.max(l,f)}}return wG(t)?Aze(t,n,o,a,l):CZ(n,o,a,l,t),t}function Uae(t,e,r,i,s){const{coords:n,lengths:o}=e,a=xa(r,i);if(!n.length)return t!==e&&i0(t),t;M6(s);const{originPosition:l,scale:c,translate:h}=s,d=Gst;d.originPosition=l;const f=d.scale;f[0]=c[0]??1,f[1]=-(c[1]??1),f[2]=c[2]??1,f[3]=c[3]??1;const m=d.translate;if(m[0]=h[0]??0,m[1]=h[1]??0,m[2]=h[2]??0,m[3]=h[3]??0,!o.length){for(let _=0;_<a;++_)t.coords[_]=gz(d,n[_],_);return t!==e&&i0(t,a,0),t}let g=0;for(let _=0;_<o.length;_++){const v=o[_];t.lengths[_]=v;for(let x=0;x<a;++x)t.coords[g+x]=gz(d,n[g+x],x);let b=t.coords[g],T=t.coords[g+1];g+=a;for(let x=1;x<v;x++,g+=a){b+=n[g]*f[0],T+=n[g+1]*f[1],t.coords[g]=b,t.coords[g+1]=T;for(let S=2;S<a;++S)t.coords[g+S]=gz(d,n[g+S],S)}}return t!==e&&i0(t,n.length,o.length),t}function Tzt(t,e,r,i,s,n){if(i0(t),t.lengths.push(...e.lengths),r===s&&i===n)for(let o=0;o<e.coords.length;o++)t.coords.push(e.coords[o]);else{const o=xa(r,i),a=wK(r,i,s,n),l=e.coords;for(let c=0;c<l.length;c+=o)a(t.coords,l,t.coords.length,c,l[c],l[c+1])}return t}function Bst(t,e,r,i){let s=0,n=t[i*e],o=t[i*(e+1)];for(let a=1;a<r;a++){const l=n+t[i*(e+a)],c=o+t[i*(e+a)+1],h=(l-n)*(c+o);n=l,o=c,s+=h}return .5*s}function Szt(t,e){const{coords:r,lengths:i}=t;let s=0,n=0;for(let o=0;o<i.length;o++){const a=i[o];n+=Bst(r,s,a,e),s+=a}return Math.abs(n)}function i0(t,e=0,r=0){Lp(t.lengths,r),Lp(t.coords,e)}function Lp(t,e=0){t.length!==e&&(t.length=e)}const Gst={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]},kae=new qo(Array,t=>c8(t,Hve),null,10,5),jst=zt();let Hst=class{get labelLayers(){return this._labelLayers||LDe}get extent(){return this._extent}get isElevationSource(){return this.layers.some(e=>e?.isElevationSource)}constructor(e,r,i,s,n){this.graphic=e,this.graphics3DSymbol=r,this.layers=i,this._visibleFlags=Ho.ALL_LABEL,this.deconflictionPriority=0,++r.referenced,this._featureExpressionFeature=n?ZEe(n,e,s):null}initialize(e){this._layer=e,this._forEachSymbolLayerGraphic(r=>{r.initialize(e),r.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(e=>e.destroy()),this._calloutLayer=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.layers==null}clearLabelGraphics(){this._forEachLabelGraphic(e=>e.destroy()),this._labelLayers=null}addLabelGraphic(e,r){this._labelLayers||(this._labelLayers=new Array),this._labelLayers.push(e),e.initialize(r),e.setVisibility(this.isVisible(Kn.LABEL))}setCalloutGraphic(e){this._calloutLayer=e,this._layer&&(e.initialize(this._layer),e.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic(r=>{r.type==="draped"&&(e=!0)}),e}isVisible(e=Kn.GRAPHIC,r){const i=r?this._visibleFlags|r|Kn.LABEL*r:this._visibleFlags;return e===Kn.GRAPHIC?(i&Ho.ALL_GRAPHIC)===Ho.ALL_GRAPHIC:(i&Ho.ALL_LABEL)===Ho.ALL_LABEL}setVisibilityFlag(e,r,i){const s=this.isVisible(e);i?this._visibleFlags|=e*r:this._visibleFlags&=~(e*r);const n=this.isVisible(e);if(s===n)return!1;if(e===Kn.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(n));else{this._forEachSymbolLayerGraphic(a=>a.setVisibility(n));const o=this.isVisible(Kn.LABEL);this._forEachLabelGraphic(a=>a.setVisibility(o))}return!0}getVisibilityFlag(e,r){return(this._visibleFlags&e*r)!=0}computeExtent(e){if(!this._extent){const r=this.graphic.geometry;if(r==null)return!1;this._extent=zt(),Krt(r,this._extent);const i=r.spatialReference;if(!Ln(i,e)&&!AP(this._extent,i,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,r){return this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,r)),this._optimizedGeometry}_convertGraphicToOptimizedGeometry(e,r,i){let s=e.geometry;return s.type!=="mesh"&&s.type!=="extent"||(s=Su.fromExtent(s.type==="mesh"?s.extent:s)),Ust(s,r,i)}get usedMemory(){let e=wEe(this.graphic.attributes);return this._forEachSymbolLayerGraphic(r=>{const i=r.graphics3DSymbolLayer.complexity;if(i==null)return;const s=r.type==="draped"?i.memory.draped:i.memory;e+=s.bytesPerFeature,s.bytesPerCoordinate&&(e+=Qrt(this.graphic.geometry)*s.bytesPerCoordinate)}),e}computeAttachmentOrigin(){const e={render:{origin:O(),num:0},draped:{origin:He(),num:0}};for(const r of this.layers)r?.computeAttachmentOrigin(e);return e.render.num>1&&se(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&Sc(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,r,i,s,n){return n||(n={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),n.boundingBox?Ei(n.boundingBox):n.boundingBox=Ei(),n.requiresDrapedElevation=!1,await G6(this.layers,async o=>{if(o==null)return;const a=o.type==="draped"?r:e,l=kae.acquire(),c=await o.getProjectedBoundingBox(a,i,n.screenSpaceObjects,s,l);isFinite(c[2])&&isFinite(c[5])||(n.requiresDrapedElevation=!0),c&&xE(n.boundingBox,l),kae.release(l)}),Eze(n.boundingBox)||AB(iJ(n.boundingBox,jst))?n:null}needsElevationUpdates(){for(const e of this.layers)if(e!=null&&(e.type==="object3d"||e.type==="lod-instance")&&e.needsElevationUpdates)return!0;return this._labelLayers?.some(e=>e?.needsElevationUpdates??!1)??!1}alignWithElevation(e,r,i){this._forEachRenderedGraphic(s=>{s.type!=="object3d"&&s.type!=="lod-instance"||s.alignWithElevation(e,r,this._featureExpressionFeature,i)})}alignWithAbsoluteElevation(e,r,i){this._forEachRenderedGraphic(s=>{s.type==="object3d"&&s.alignWithAbsoluteElevation(e,r,i)})}addObjectStateSet(e,r){this._forEachSymbolLayerGraphic(i=>i.addObjectState(e,r))}removeObjectState(e){this._forEachSymbolLayerGraphic(r=>r.removeObjectState(e))}_forEachGraphicList(e,r){e?.forEach(i=>i&&r(i))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._calloutLayer&&e(this._calloutLayer)}_forEachLabelGraphic(e){this._forEachGraphicList(this._labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}get test(){const e=this;return{addLabelLayer:r=>{e._labelLayers||(e._labelLayers=new Array),e._labelLayers.push(r)}}}},Czt=class{constructor(e,r){this.scheduler=e,this.schedule=r,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.skipHighSymbolLods=!1,this.isAsync=!1}},qst=class{constructor(){this.renderPriority=0,this.renderPriorityStep=1,this.ignoreDrivers=!1}};var zae,Vae,Bae,wq={exports:{}};wq.exports,zae=wq,Vae=function(){function t(I,z,V){V=V||2;var j,Y,Q,te,ge,De,at,we=z&&z.length,Ce=we?z[0]*V:I.length,Me=e(I,0,Ce,V,!0),Z=[];if(!Me||Me.next===Me.prev)return Z;if(we&&(Me=l(I,z,Me,V)),I.length>80*V){j=Q=I[0],Y=te=I[1];for(var be=V;be<Ce;be+=V)(ge=I[be])<j&&(j=ge),(De=I[be+1])<Y&&(Y=De),ge>Q&&(Q=ge),De>te&&(te=De);at=(at=Math.max(Q-j,te-Y))!==0?1/at:0}return i(Me,Z,V,j,Y,at),Z}function e(I,z,V,j,Y){var Q,te;if(Y===J(I,z,V,j)>0)for(Q=z;Q<V;Q+=j)te=q(Q,I[Q],I[Q+1],te);else for(Q=V-j;Q>=z;Q-=j)te=q(Q,I[Q],I[Q+1],te);if(te&&E(te,te.next)){var ge=te.next;X(te),te=ge}return te}function r(I,z){if(!I)return I;z||(z=I);var V,j=I;do if(V=!1,j.steiner||!E(j,j.next)&&S(j.prev,j,j.next)!==0)j=j.next;else{var Y=j.prev;if(X(j),(j=z=Y)===j.next)break;V=!0}while(V||j!==z);return z}function i(I,z,V,j,Y,Q,te){if(I){!te&&Q&&g(I,j,Y,Q);for(var ge,De,at=I;I.prev!==I.next;)if(ge=I.prev,De=I.next,Q?n(I,j,Y,Q):s(I))z.push(ge.i/V),z.push(I.i/V),z.push(De.i/V),X(I),I=De.next,at=De.next;else if((I=De)===at){te?te===1?i(I=o(r(I),z,V),z,V,j,Y,Q,2):te===2&&a(I,z,V,j,Y,Q):i(r(I),z,V,j,Y,Q,1);break}}}function s(I){var z=I.prev,V=I,j=I.next;if(S(z,V,j)>=0)return!1;for(var Y=I.next.next;Y!==I.prev;){if(T(z.x,z.y,V.x,V.y,j.x,j.y,Y.x,Y.y)&&S(Y.prev,Y,Y.next)>=0)return!1;Y=Y.next}return!0}function n(I,z,V,j){var Y=I.prev,Q=I,te=I.next;if(S(Y,Q,te)>=0)return!1;for(var ge=Y.x<Q.x?Y.x<te.x?Y.x:te.x:Q.x<te.x?Q.x:te.x,De=Y.y<Q.y?Y.y<te.y?Y.y:te.y:Q.y<te.y?Q.y:te.y,at=Y.x>Q.x?Y.x>te.x?Y.x:te.x:Q.x>te.x?Q.x:te.x,we=Y.y>Q.y?Y.y>te.y?Y.y:te.y:Q.y>te.y?Q.y:te.y,Ce=v(ge,De,z,V,j),Me=v(at,we,z,V,j),Z=I.prevZ,be=I.nextZ;Z&&Z.z>=Ce&&be&&be.z<=Me;){if(Z!==I.prev&&Z!==I.next&&T(Y.x,Y.y,Q.x,Q.y,te.x,te.y,Z.x,Z.y)&&S(Z.prev,Z,Z.next)>=0||(Z=Z.prevZ,be!==I.prev&&be!==I.next&&T(Y.x,Y.y,Q.x,Q.y,te.x,te.y,be.x,be.y)&&S(be.prev,be,be.next)>=0))return!1;be=be.nextZ}for(;Z&&Z.z>=Ce;){if(Z!==I.prev&&Z!==I.next&&T(Y.x,Y.y,Q.x,Q.y,te.x,te.y,Z.x,Z.y)&&S(Z.prev,Z,Z.next)>=0)return!1;Z=Z.prevZ}for(;be&&be.z<=Me;){if(be!==I.prev&&be!==I.next&&T(Y.x,Y.y,Q.x,Q.y,te.x,te.y,be.x,be.y)&&S(be.prev,be,be.next)>=0)return!1;be=be.nextZ}return!0}function o(I,z,V){var j=I;do{var Y=j.prev,Q=j.next.next;!E(Y,Q)&&A(Y,j,j.next,Q)&&k(Y,Q)&&k(Q,Y)&&(z.push(Y.i/V),z.push(j.i/V),z.push(Q.i/V),X(j),X(j.next),j=I=Q),j=j.next}while(j!==I);return r(j)}function a(I,z,V,j,Y,Q){var te=I;do{for(var ge=te.next.next;ge!==te.prev;){if(te.i!==ge.i&&x(te,ge)){var De=N(te,ge);return te=r(te,te.next),De=r(De,De.next),i(te,z,V,j,Y,Q),void i(De,z,V,j,Y,Q)}ge=ge.next}te=te.next}while(te!==I)}function l(I,z,V,j){var Y,Q,te,ge=[];for(Y=0,Q=z.length;Y<Q;Y++)(te=e(I,z[Y]*j,Y<Q-1?z[Y+1]*j:I.length,j,!1))===te.next&&(te.steiner=!0),ge.push(b(te));for(ge.sort(c),Y=0;Y<ge.length;Y++)V=r(V=d(ge[Y],V),V.next);return V}function c(I,z){return I.x-z.x}function h(I){if(I.next.prev===I)return I;let z=I;for(;;){const V=z.next;if(V.prev===z||V===z||V===I)break;z=V}return z}function d(I,z){var V=f(I,z);if(!V)return z;var j=N(V,I),Y=r(V,V.next);let Q=h(j);return r(Q,Q.next),Y=h(Y),h(z===V?Y:z)}function f(I,z){var V,j=z,Y=I.x,Q=I.y,te=-1/0;do{if(Q<=j.y&&Q>=j.next.y&&j.next.y!==j.y){var ge=j.x+(Q-j.y)*(j.next.x-j.x)/(j.next.y-j.y);if(ge<=Y&&ge>te){if(te=ge,ge===Y){if(Q===j.y)return j;if(Q===j.next.y)return j.next}V=j.x<j.next.x?j:j.next}}j=j.next}while(j!==z);if(!V)return null;if(Y===te)return V;var De,at=V,we=V.x,Ce=V.y,Me=1/0;j=V;do Y>=j.x&&j.x>=we&&Y!==j.x&&T(Q<Ce?Y:te,Q,we,Ce,Q<Ce?te:Y,Q,j.x,j.y)&&(De=Math.abs(Q-j.y)/(Y-j.x),k(j,I)&&(De<Me||De===Me&&(j.x>V.x||j.x===V.x&&m(V,j)))&&(V=j,Me=De)),j=j.next;while(j!==at);return V}function m(I,z){return S(I.prev,I,z.prev)<0&&S(z.next,I,I.next)<0}function g(I,z,V,j){var Y=I;do Y.z===null&&(Y.z=v(Y.x,Y.y,z,V,j)),Y.prevZ=Y.prev,Y.nextZ=Y.next,Y=Y.next;while(Y!==I);Y.prevZ.nextZ=null,Y.prevZ=null,_(Y)}function _(I){var z,V,j,Y,Q,te,ge,De,at=1;do{for(V=I,I=null,Q=null,te=0;V;){for(te++,j=V,ge=0,z=0;z<at&&(ge++,j=j.nextZ);z++);for(De=at;ge>0||De>0&&j;)ge!==0&&(De===0||!j||V.z<=j.z)?(Y=V,V=V.nextZ,ge--):(Y=j,j=j.nextZ,De--),Q?Q.nextZ=Y:I=Y,Y.prevZ=Q,Q=Y;V=j}Q.nextZ=null,at*=2}while(te>1);return I}function v(I,z,V,j,Y){return(I=1431655765&((I=858993459&((I=252645135&((I=16711935&((I=32767*(I-V)*Y)|I<<8))|I<<4))|I<<2))|I<<1))|(z=1431655765&((z=858993459&((z=252645135&((z=16711935&((z=32767*(z-j)*Y)|z<<8))|z<<4))|z<<2))|z<<1))<<1}function b(I){var z=I,V=I;do(z.x<V.x||z.x===V.x&&z.y<V.y)&&(V=z),z=z.next;while(z!==I);return V}function T(I,z,V,j,Y,Q,te,ge){return(Y-te)*(z-ge)-(I-te)*(Q-ge)>=0&&(I-te)*(j-ge)-(V-te)*(z-ge)>=0&&(V-te)*(Q-ge)-(Y-te)*(j-ge)>=0}function x(I,z){return I.next.i!==z.i&&I.prev.i!==z.i&&!D(I,z)&&(k(I,z)&&k(z,I)&&L(I,z)&&(S(I.prev,I,z.prev)||S(I,z.prev,z))||E(I,z)&&S(I.prev,I,I.next)>0&&S(z.prev,z,z.next)>0)}function S(I,z,V){return(z.y-I.y)*(V.x-z.x)-(z.x-I.x)*(V.y-z.y)}function E(I,z){return I.x===z.x&&I.y===z.y}function A(I,z,V,j){var Y=M(S(I,z,V)),Q=M(S(I,z,j)),te=M(S(V,j,I)),ge=M(S(V,j,z));return Y!==Q&&te!==ge||!(Y!==0||!R(I,V,z))||!(Q!==0||!R(I,j,z))||!(te!==0||!R(V,I,j))||!(ge!==0||!R(V,z,j))}function R(I,z,V){return z.x<=Math.max(I.x,V.x)&&z.x>=Math.min(I.x,V.x)&&z.y<=Math.max(I.y,V.y)&&z.y>=Math.min(I.y,V.y)}function M(I){return I>0?1:I<0?-1:0}function D(I,z){var V=I;do{if(V.i!==I.i&&V.next.i!==I.i&&V.i!==z.i&&V.next.i!==z.i&&A(V,V.next,I,z))return!0;V=V.next}while(V!==I);return!1}function k(I,z){return S(I.prev,I,I.next)<0?S(I,z,I.next)>=0&&S(I,I.prev,z)>=0:S(I,z,I.prev)<0||S(I,I.next,z)<0}function L(I,z){var V=I,j=!1,Y=(I.x+z.x)/2,Q=(I.y+z.y)/2;do V.y>Q!=V.next.y>Q&&V.next.y!==V.y&&Y<(V.next.x-V.x)*(Q-V.y)/(V.next.y-V.y)+V.x&&(j=!j),V=V.next;while(V!==I);return j}function N(I,z){var V=new G(I.i,I.x,I.y),j=new G(z.i,z.x,z.y),Y=I.next,Q=z.prev;return I.next=z,z.prev=I,V.next=Y,Y.prev=V,j.next=V,V.prev=j,Q.next=j,j.prev=Q,j}function q(I,z,V,j){var Y=new G(I,z,V);return j?(Y.next=j.next,Y.prev=j,j.next.prev=Y,j.next=Y):(Y.prev=Y,Y.next=Y),Y}function X(I){I.next.prev=I.prev,I.prev.next=I.next,I.prevZ&&(I.prevZ.nextZ=I.nextZ),I.nextZ&&(I.nextZ.prevZ=I.prevZ)}function G(I,z,V){this.i=I,this.x=z,this.y=V,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function J(I,z,V,j){for(var Y=0,Q=z,te=V-j;Q<V;Q+=j)Y+=(I[te]-I[Q])*(I[Q+1]+I[te+1]),te=Q;return Y}return t.deviation=function(I,z,V,j){var Y=z&&z.length,Q=Y?z[0]*V:I.length,te=Math.abs(J(I,0,Q,V));if(Y)for(var ge=0,De=z.length;ge<De;ge++){var at=z[ge]*V,we=ge<De-1?z[ge+1]*V:I.length;te-=Math.abs(J(I,at,we,V))}var Ce=0;for(ge=0;ge<j.length;ge+=3){var Me=j[ge]*V,Z=j[ge+1]*V,be=j[ge+2]*V;Ce+=Math.abs((I[Me]-I[be])*(I[Z+1]-I[Me+1])-(I[Me]-I[Z])*(I[be+1]-I[Me+1]))}return te===0&&Ce===0?0:Math.abs((Ce-te)/te)},t.flatten=function(I){for(var z=I[0][0].length,V={vertices:[],holes:[],dimensions:z},j=0,Y=0;Y<I.length;Y++){for(var Q=0;Q<I[Y].length;Q++)for(var te=0;te<z;te++)V.vertices.push(I[Y][Q][te]);Y>0&&(j+=I[Y-1].length,V.holes.push(j))}return V},t},(Bae=Vae())!==void 0&&(zae.exports=Bae);const JE=FP(wq.exports),x9=K.getLogger("esri.views.3d.support.buffer.math");function Wst(t,e,r){QE(t.typedBuffer,e.typedBuffer,r,t.typedBufferStride,e.typedBufferStride)}function QE(t,e,r,i=3,s=i){if(t.length/i!==Math.ceil(e.length/s))return x9.error("source and destination buffers need to have the same number of elements"),t;const n=t.length/i,o=r[0],a=r[1],l=r[2],c=r[4],h=r[5],d=r[6],f=r[8],m=r[9],g=r[10],_=r[12],v=r[13],b=r[14];let T=0,x=0;for(let S=0;S<n;S++){const E=e[T],A=e[T+1],R=e[T+2];t[x]=o*E+c*A+f*R+_,t[x+1]=a*E+h*A+m*R+v,t[x+2]=l*E+d*A+g*R+b,T+=s,x+=i}return t}function NCe(t,e,r){ex(t.typedBuffer,e.typedBuffer,r,t.typedBufferStride,e.typedBufferStride)}function ex(t,e,r,i=3,s=i){if(t.length/i!==Math.ceil(e.length/s))return void x9.error("source and destination buffers need to have the same number of elements");const n=t.length/i,o=r[0],a=r[1],l=r[2],c=r[3],h=r[4],d=r[5],f=r[6],m=r[7],g=r[8];let _=0,v=0;for(let b=0;b<n;b++){const T=e[_],x=e[_+1],S=e[_+2];t[v]=o*T+c*x+f*S,t[v+1]=a*T+h*x+m*S,t[v+2]=l*T+d*x+g*S,_+=s,v+=i}}function Xst(t,e,r){vF(t.typedBuffer,e,r,t.typedBufferStride)}function vF(t,e,r,i=3){const s=Math.min(t.length/i,e.count),n=e.typedBuffer,o=e.typedBufferStride;let a=0,l=0;for(let c=0;c<s;c++)t[l]=r*n[a],t[l+1]=r*n[a+1],t[l+2]=r*n[a+2],a+=o,l+=i}function Yst(t,e){T9(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function T9(t,e,r=3,i=r){const s=Math.min(t.length/r,e.length/i);let n=0,o=0;for(let a=0;a<s;a++){const l=e[n],c=e[n+1],h=e[n+2],d=l*l+c*c+h*h;if(d>0){const f=1/Math.sqrt(d);t[o]=f*l,t[o+1]=f*c,t[o+2]=f*h}n+=i,o+=r}}function Zst(t,e,r){const i=Math.min(t.count,e.count),s=t.typedBuffer,n=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;let l=0,c=0;for(let h=0;h<i;h++)s[c]=o[l]>>r,s[c+1]=o[l+1]>>r,s[c+2]=o[l+2]>>r,l+=a,c+=n}Object.freeze(Object.defineProperty({__proto__:null,normalize:T9,normalizeView:Yst,scale:vF,scaleView:Xst,shiftRight:Zst,transformMat3:ex,transformMat3View:NCe,transformMat4:QE,transformMat4View:Wst},Symbol.toStringTag,{value:"Module"}));function Jst(t,e,r){return{objectId:t,target:e,distance:r,type:"vertex"}}function Gae(t,e,r,i,s,n=!1){return{objectId:t,target:e,distance:r,type:"edge",start:i,end:s,draped:n}}var s0,_o;function H_(t){return t&&t.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function FM(t){return t!=null&&!isNaN(t)&&isFinite(t)}function FCe(t){return t.valueExpression?s0.Expression:t.field&&typeof t.field=="string"?s0.Field:s0.Unknown}function Qst(t,e){const r=e||FCe(t),i=t.valueUnit||"unknown";return r===s0.Unknown?_o.Constant:t.stops?_o.Stops:t.minSize!=null&&t.maxSize!=null&&t.minDataValue!=null&&t.maxDataValue!=null?_o.ClampedLinear:i==="unknown"?t.minSize!=null&&t.minDataValue!=null?t.minSize&&t.minDataValue?_o.Proportional:_o.Additive:_o.Identity:_o.RealWorldSize}(function(t){t.Unknown="unknown",t.Expression="expression",t.Field="field"})(s0||(s0={})),function(t){t.Unknown="unknown",t.Stops="stops",t.ClampedLinear="clamped-linear",t.Proportional="proportional",t.Additive="additive",t.Constant="constant",t.Identity="identity",t.RealWorldSize="real-world-size"}(_o||(_o={}));const Ev=K.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),jae=new Bl,NN=Math.PI,UCe=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function kCe(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(g=>g.type==="color"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void Ev.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const s=typeof e=="number",n=s?null:e,o=n&&n.attributes;let a=s?e:null;const l=i.field,{ipData:c,hasExpression:h}=i.cache;let d=i.cache.compiledFunc;if(!l&&!h){const g=i.stops;return g&&g[0]&&g[0].color}if(typeof a!="number")if(h){if(r==null||r.arcade==null)return void Ev.error("Use of arcade expressions requires an arcade context");const g={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},_=r.arcade.arcadeUtils,v=_.getViewInfo(g),b=_.createExecContext(n,v);if(!d){const T=_.createSyntaxTree(i.valueExpression);d=_.createFunction(T),i.cache.compiledFunc=d}a=_.executeFunction(d,b)}else o&&(a=o[l]);const f=i.normalizationField,m=o!=null&&f!=null?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const g=AK(a,c);if(g){const _=g[0],v=g[1],b=_===v?i.stops[_].color:ke.blendColors(i.stops[_].color,i.stops[v].color,g[2],r?.color);return new ke(b)}}}function zCe(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(g=>g.type==="opacity"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void Ev.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const s=typeof e=="number",n=s?null:e,o=n&&n.attributes;let a=s?e:null;const l=i.field,{ipData:c,hasExpression:h}=i.cache;let d=i.cache.compiledFunc;if(!l&&!h){const g=i.stops;return g&&g[0]&&g[0].opacity}if(typeof a!="number")if(h){if(r==null||r.arcade==null)return void Ev.error("Use of arcade expressions requires an arcade context");const g={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},_=r.arcade.arcadeUtils,v=_.getViewInfo(g),b=_.createExecContext(n,v);if(!d){const T=_.createSyntaxTree(i.valueExpression);d=_.createFunction(T),i.cache.compiledFunc=d}a=_.executeFunction(d,b)}else o&&(a=o[l]);const f=i.normalizationField,m=o!=null&&f!=null?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const g=AK(a,c);if(g){const _=g[0],v=g[1];if(_===v)return i.stops[_].opacity;{const b=i.stops[_].opacity;return b+(i.stops[v].opacity-b)*g[2]}}}}function VCe(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(m=>m.type==="rotation"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void Ev.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const s=i.axis||"heading",n=s==="heading"&&i.rotationType==="arithmetic"?90:0,o=s==="heading"&&i.rotationType==="arithmetic"?-1:1,a=typeof e=="number"?null:e,l=a&&a.attributes,c=i.field,{hasExpression:h}=i.cache;let d=i.cache.compiledFunc,f=0;if(!c&&!h)return f;if(h){if(r==null||r.arcade==null)return void Ev.error("Use of arcade expressions requires an arcade context");const m={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},g=r.arcade.arcadeUtils,_=g.getViewInfo(m),v=g.createExecContext(a,_);if(!d){const b=g.createSyntaxTree(i.valueExpression);d=g.createFunction(b),i.cache.compiledFunc=d}f=g.executeFunction(d,v)}else l&&(f=l[c]||0);return f=typeof f!="number"||isNaN(f)?null:n+o*f,f}function Kst(t,e,r){const i=typeof e=="number",s=i?null:e,n=s&&s.attributes;let o=i?e:null;const{isScaleDriven:a}=t.cache;let l=t.cache.compiledFunc;if(a){const h=r?.scale,d=r?.view;o=h==null||d==="3d"?ent(t):h}else if(!i)switch(t.inputValueType){case s0.Expression:{if(r==null||r.arcade==null)return void Ev.error("Use of arcade expressions requires an arcade context");const h={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},d=r.arcade.arcadeUtils,f=d.getViewInfo(h),m=d.createExecContext(s,f);if(!l){const g=d.createSyntaxTree(t.valueExpression);l=d.createFunction(g),t.cache.compiledFunc=l}o=d.executeFunction(l,m);break}case s0.Field:n&&(o=n[t.field]);break;case s0.Unknown:o=null}if(!FM(o))return null;if(i||!t.normalizationField)return o;const c=n?parseFloat(n[t.normalizationField]):null;return FM(c)&&c!==0?o/c:null}function ent(t){let e=null,r=null;const i=t.stops;return i?(e=i[0].value,r=i[i.length-1].value):(e=t.minDataValue||0,r=t.maxDataValue||0),(e+r)/2}function S9(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(n=>n.type==="size"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void Ev.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const s=GCe(Kst(i,e,r),i,e,r,i.cache.ipData);return s==null||isNaN(s)?0:s}function Nc(t,e,r){return t==null?null:H_(t)?S9(t,e,r):FM(t)?t:null}function BCe(t,e,r){return FM(r)&&t>r?r:FM(e)&&t<e?e:t}function tnt(t,e,r,i){return t+((Nc(e.minSize,r,i)||e.minDataValue)??0)}function rnt(t,e,r){const i=t.stops;let s=i&&i.length&&i[0].size;return s==null&&(s=t.minSize),Nc(s,e,r)}function int(t,e,r,i){const s=(t-e.minDataValue)/(e.maxDataValue-e.minDataValue),n=Nc(e.minSize,r,i),o=Nc(e.maxSize,r,i),a=i?.shape;if(t<=e.minDataValue)return n;if(t>=e.maxDataValue)return o;if(n==null||o==null)return null;if(e.scaleBy==="area"&&a){const l=a==="circle",c=l?NN*(n/2)**2:n*n,h=c+s*((l?NN*(o/2)**2:o*o)-c);return l?2*Math.sqrt(h/NN):Math.sqrt(h)}return n+s*(o-n)}function snt(t,e,r,i){const s=i?.shape,n=t/e.minDataValue,o=Nc(e.minSize,r,i),a=Nc(e.maxSize,r,i);let l=null;return l=s==="circle"?2*Math.sqrt(n*(o/2)**2):s==="square"||s==="diamond"||s==="image"?Math.sqrt(n*o**2):n*o,BCe(l,o,a)}function nnt(t,e,r,i,s){const[n,o,a]=AK(t,s);if(n===o)return Nc(e.stops?.[n].size,r,i);{const l=Nc(e.stops?.[n].size,r,i);return l+(Nc(e.stops?.[o].size,r,i)-l)*a}}function ont(t,e,r,i){const s=(i!=null&&i.resolution?i.resolution:1)*qE[e.valueUnit],n=Nc(e.minSize,r,i),o=Nc(e.maxSize,r,i),{valueRepresentation:a}=e;let l=null;return l=a==="area"?2*Math.sqrt(t/NN)/s:a==="radius"||a==="distance"?2*t/s:t/s,BCe(l,n,o)}function GCe(t,e,r,i,s){switch(e.transformationType){case _o.Additive:return tnt(t,e,r,i);case _o.Constant:return rnt(e,r,i);case _o.ClampedLinear:return int(t,e,r,i);case _o.Proportional:return snt(t,e,r,i);case _o.Stops:return nnt(t,e,r,i,s);case _o.RealWorldSize:return ont(t,e,r,i);case _o.Identity:return t;case _o.Unknown:return null}}function ant(t,e,r){const{isScaleDriven:i}=t.cache;if(!(i&&r==="3d"||e))return null;const s={scale:e,view:r};let n=Nc(t.minSize,jae,s),o=Nc(t.maxSize,jae,s);if(n!=null||o!=null){if(n>o){const a=o;o=n,n=a}return{minSize:n,maxSize:o}}}function CK(t,e,r){if(!t.visualVariables)return;const i=[],s=[],n=[],o=[],a=[];for(const l of t.visualVariables)switch(l.type){case"color":s.push(l);break;case"opacity":n.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return s.forEach(l=>{const c=kCe(l,e,r);i.push({variable:l,value:c})}),n.forEach(l=>{const c=zCe(l,e,r);i.push({variable:l,value:c})}),a.forEach(l=>{const c=VCe(l,e,r);i.push({variable:l,value:c})}),o.forEach(l=>{const c=S9(l,e,r);i.push({variable:l,value:c})}),i.filter(l=>l.value!=null)}function AK(t,e){if(!e)return;let r=0,i=e.length-1;return e.some((s,n)=>t<s?(i=n,!0):(r=n,!1)),[r,i,(t-e[r])/(e[i]-e[r])]}function lnt(t,e,r){const i=["proportional","proportional","proportional"];for(const s of t){const n=s.useSymbolValue?"symbol-value":S9(s,e,r);switch(s.axis){case"width":i[0]=n;break;case"depth":i[1]=n;break;case"height":i[2]=n;break;case"width-and-depth":i[0]=n,i[1]=n;break;case"all":case void 0:case null:i[0]=n,i[1]=n,i[2]=n;break;default:s.axis}}return i}const Rzt=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:lnt,getColor:kCe,getOpacity:zCe,getRotationAngle:VCe,getSize:S9,getSizeForValue:GCe,getSizeFromNumberOrVariable:Nc,getSizeRangeAtScale:ant,getVisualVariableValues:CK,viewScaleRE:UCe},Symbol.toStringTag,{value:"Module"}));function E9(t,e){if(!t||t.symbol)return null;const r=e&&e.renderer;return t&&r!=null&&r.getObservationRenderer?r.getObservationRenderer(t):r}function cnt(t,e){if(t.symbol!=null)return t.symbol;const r=E9(t,e);return r!=null&&r.type!=="dot-density"?r.getSymbol(t,e):null}function Mzt(t,e){const r=E9(t,e),i=cnt(t,e);if(i==null)return null;const s={renderer:r,symbol:i};if(r==null||!("visualVariables"in r)||!r.visualVariables)return s;const n=CK(r,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)switch(a.type){case"color":s.color=l.toRgba();break;case"size":if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;switch(c){case"width":o[0]=h;break;case"depth":o[1]=h;break;case"height":o[2]=h;break;case"width-and-depth":o[0]=o[1]=h;break;default:o[0]=o[1]=o[2]=h}}break;case"opacity":s.opacity=l;break;case"rotation":switch(a.axis){case"tilt":s.tilt=l;break;case"roll":s.roll=l;break;default:s.heading=l}}return o[0]==="proportional"&&o[1]==="proportional"&&o[2]==="proportional"||(s.size=o),s}async function unt(t,e){if(t.symbol!=null)return t.symbol;const r=E9(t,e);return r!=null?r.getSymbolAsync(t,e):null}async function Pzt(t,e){const r=E9(t,e),i=await unt(t,e);if(!i)return null;const s={renderer:r,symbol:i};if(!r||!("visualVariables"in r)||!r.visualVariables)return s;const n=CK(r,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)if(a.type==="color")s.color=ke.toUnitRGBA(l);else if(a.type==="size")if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;c==="width"?o[0]=h:c==="depth"?o[1]=h:c==="height"?o[2]=h:o[0]=o[1]=c==="width-and-depth"?h:o[2]=h}else a.type==="opacity"?s.opacity=l:a.type==="rotation"&&a.axis==="tilt"?s.tilt=l:a.type==="rotation"&&a.axis==="roll"?s.roll=l:a.type==="rotation"&&(s.heading=l);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(s.size=o),s}function hnt(t,e=0){const r=t[e];return typeof r=="number"&&isFinite(r)?r:null}function dnt(t){for(let e=0;e<3;e++){const r=t[e];if(typeof r=="number")return isFinite(r)?r:0}return 0}function Hae(t){const e=[[C.POSITION,t.indices]],r=[[C.POSITION,new We(t.attributeData.position,3,!0)]];return t.attributeData.colorFeature!=null?(r.push([C.COLORFEATUREATTRIBUTE,new We([t.attributeData.colorFeature],1,!0)]),e.push([C.COLORFEATUREATTRIBUTE,new Array(t.indices.length).fill(0)])):t.attributeData.color&&(r.push([C.COLOR,new We(t.attributeData.color,4,!0)]),e.push([C.COLOR,LC(t.indices.length)])),t.attributeData.uvMapSpace&&(r.push([C.UVMAPSPACE,new We(t.attributeData.uvMapSpace,4,!0)]),e.push([C.UVMAPSPACE,t.indices])),t.attributeData.boundingRect&&(r.push([C.BOUNDINGRECT,new We(t.attributeData.boundingRect,9,!0)]),e.push([C.BOUNDINGRECT,t.indices])),new Ks(t.material,r,e,t.mapPositions,us.Mesh,t.attributeData.objectAndLayerIdColor)}function qae(t,e=null){const r=[[C.POSITION,t.indices],[C.UV0,t.indices]],i=[[C.POSITION,new We(t.attributeData.position,3,!0)],[C.UV0,new We(t.attributeData.uv0,2,!0)]];return new Ks(t.material,i,r,t.mapPositions,us.Mesh,e)}function UM(t){switch(t.type){case"extent":if(t instanceof cr)return Su.fromExtent(t);break;case"polygon":return t}return null}let C9=class{constructor(e,r,i){this.renderData=e,this.layerUid=r,this.graphicUid=i,this.outGeometries=new Array}};function xq(t,e,r){const i=Array.isArray(t),s=i?t.length/e:t.byteLength/(4*e),n=i?t:new Uint32Array(t,0,s*e),o=r?.minReduction??0,a=r?.originalIndices||null,l=a?a.length:0,c=r?.componentOffsets||null;let h=0;if(c)for(let A=0;A<c.length-1;A++){const R=c[A+1]-c[A];R>h&&(h=R)}else h=s;const d=Math.floor(1.1*h)+1;(Yp==null||Yp.length<2*d)&&(Yp=new Uint32Array(Q6e(2*d)));for(let A=0;A<2*d;A++)Yp[A]=0;let f=0;const m=!!c&&!!a,g=m?l:s;let _=X5(s);const v=new Uint32Array(l),b=1.96;let T=o!==0?Math.ceil(4*b*b/(o*o)*o*(1-o)):g,x=1,S=c?c[1]:g;for(let A=0;A<g;A++){if(A===T){const N=1-f/A;if(N+b*Math.sqrt(N*(1-N)/A)<o)return null;T*=2}if(A===S){for(let N=0;N<2*d;N++)Yp[N]=0;if(a)for(let N=c[x-1];N<c[x];N++)v[N]=_[a[N]];S=c[++x]}const R=m?a[A]:A,M=R*e,D=mnt(n,M,e);let k=D%d,L=f;for(;Yp[2*k+1]!==0;){if(Yp[2*k]===D){const N=Yp[2*k+1]-1;if(pnt(n,M,N*e,e)){L=_[N];break}}k++,k>=d&&(k-=d)}L===f&&(Yp[2*k]=D,Yp[2*k+1]=R+1,f++),_[R]=L}if(o!==0&&1-f/s<o)return null;if(m){for(let A=c[x-1];A<v.length;A++)v[A]=_[a[A]];_=om(v)}const E=i?new Array(f):new Uint32Array(f*e);f=0;for(let A=0;A<g;A++)_[A]===f&&(fnt(n,(m?a[A]:A)*e,E,f*e,e),f++);if(a&&!m){const A=new Uint32Array(l);for(let R=0;R<A.length;R++)A[R]=_[a[R]];_=om(A)}return{buffer:Array.isArray(E)?E:E.buffer,indices:_,uniqueCount:f}}function pnt(t,e,r,i){for(let s=0;s<i;s++)if(t[e+s]!==t[r+s])return!1;return!0}function fnt(t,e,r,i,s){for(let n=0;n<s;n++)r[i+n]=t[e+n]}function mnt(t,e,r){let i=0;for(let s=0;s<r;s++)i=t[e+s]+i|0,i=i+(i<<11)+(i>>>2)|0;return i>>>0}let Yp=null;function $zt(t){const e=XP(t.rings,t.hasZ,xm.CCW_IS_HOLE),r=new Array;let i=0,s=0;for(const a of e.polygons){const l=a.count,c=a.index,h=Vh(e.position,3*c,3*l),d=a.holeIndices.map(m=>m-c),f=om(JE(h,d,3));r.push({position:h,faces:f}),i+=h.length,s+=f.length}const n=gnt(r,i,s),o=Array.isArray(n.position)?xq(n.position,3,{originalIndices:n.faces}):xq(n.position.buffer,6,{originalIndices:n.faces});return n.position=BTe(new Float64Array(o.buffer)),n.faces=o.indices,n}function gnt(t,e,r){if(t.length===1)return t[0];const i=Xo(e),s=new Array(r);let n=0,o=0,a=0;for(const l of t){for(let c=0;c<l.position.length;c++)i[n++]=l.position[c];for(const c of l.faces)s[o++]=c+a;a=n/3}return{position:i,faces:om(s)}}function XP(t,e,r){const i=t.length,s=new Array(i),n=new Array(i),o=new Array(i);let a=0,l=0,c=0,h=0;for(let m=0;m<i;++m)h+=t[m].length;const d=Xo(3*h);let f=0;for(let m=i-1;m>=0;m--){const g=t[m],_=r===xm.CCW_IS_HOLE&&ynt(g);if(_&&i!==1)s[a++]=g;else{let v=g.length;for(let T=0;T<a;++T)v+=s[T].length;const b={index:f,pathLengths:new Array(a+1),count:v,holeIndices:new Array(a)};b.pathLengths[0]=g.length,g.length>0&&(o[c++]={index:f,count:g.length}),f=_?j$(g,g.length-1,-1,d,f,g.length,e):j$(g,0,1,d,f,g.length,e);for(let T=0;T<a;++T){const x=s[T];b.holeIndices[T]=f,b.pathLengths[T+1]=x.length,x.length>0&&(o[c++]={index:f,count:x.length}),f=j$(x,0,1,d,f,x.length,e)}a=0,b.count>0&&(n[l++]=b)}}for(let m=0;m<a;++m){const g=s[m];g.length>0&&(o[c++]={index:f,count:g.length}),f=j$(g,0,1,d,f,g.length,e)}return n.length=l,o.length=c,{position:d,polygons:n,outlines:o}}function j$(t,e,r,i,s,n,o){s*=3;for(let a=0;a<n;++a){const l=t[e];i[s++]=l[0],i[s++]=l[1],i[s++]=o?l[2]:0,e+=r}return s/3}function ynt(t){return!Gye(t,!1,!1)}var xm;(function(t){t[t.NONE=0]="NONE",t[t.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(xm||(xm={}));var $R,bF,Tq;(function(t){t[t.RasterImage=0]="RasterImage",t[t.Features=1]="Features"})($R||($R={})),function(t){t[t.MapLayer=0]="MapLayer",t[t.ViewLayer=1]="ViewLayer",t[t.Outline=2]="Outline",t[t.SnappingHint=3]="SnappingHint"}(bF||(bF={})),function(t){t[t.WithRasterImage=0]="WithRasterImage",t[t.WithoutRasterImage=1]="WithoutRasterImage"}(Tq||(Tq={}));let jCe=class{constructor(e,r){this._fbo=null;const i=new xr;i.wrapMode=Dt.CLAMP_TO_EDGE,i.samplingMode=Rt.LINEAR_MIPMAP_LINEAR,i.hasMipmap=r,i.maxAnisotropy=8,this._fbo=new fn(e,i)}dispose(){this._fbo=je(this._fbo)}getTexture(){return this._fbo?.colorTexture}isValid(){return this._fbo!=null}resize(e,r){this._fbo?.resize(e,r)}bind(e){e.bindFramebuffer(this._fbo)}generateMipMap(){const e=this._fbo?.colorTexture;e?.descriptor.hasMipmap&&e.generateMipmap()}disposeRenderTargetMemory(){this._fbo?.resize(0,0)}get gpuMemoryUsage(){return this._fbo?.gpuMemoryUsage??0}},mT=class{constructor(e,r,i,s=!0){this.output=r,this.type=i,this.valid=!1,this.lastUsed=1/0,this.fbo=new jCe(e,s)}},_nt=class{constructor(e){this.renderTargets=[new mT(e,F.Color,as.Color),new mT(e,F.Color,as.ColorNoRasterImage),new mT(e,F.Highlight,as.Highlight,!1),new mT(e,F.Normal,as.Water),new mT(e,F.Color,as.Occluded)],ae("enable-feature:objectAndLayerId-rendering")&&this.renderTargets.push(new mT(e,F.ObjectAndLayerIdColor,as.ObjectAndLayerIdColor))}getTarget(e){return this.renderTargets[e].fbo}dispose(){for(const e of this.renderTargets)e.fbo.dispose()}disposeRenderTargetMemory(){for(const e of this.renderTargets)e.fbo.disposeRenderTargetMemory()}validateUsageForTarget(e,r,i){return e?(r.lastUsed=i,!1):i-r.lastUsed>vnt?(r.fbo.disposeRenderTargetMemory(),r.lastUsed=1/0,!1):r.lastUsed<1/0}get gpuMemoryUsage(){return this.renderTargets.reduce((e,r)=>e+r.fbo.gpuMemoryUsage,0)}};const vnt=1e3;let HCe=class extends ii{constructor(){super(...arguments),this.color=Nt(1,1,1,1)}};function bnt(){const t=new Sr;return t.include(id),t.fragment.uniforms.add(new rt("tex",e=>e.texture),new sr("uColor",e=>e.color)),t.fragment.code.add(w`void main() {
vec4 texColor = texture(tex, uv);
fragColor = texColor * uColor;
}`),t}const wnt=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:HCe,build:bnt},Symbol.toStringTag,{value:"Module"}));let qCe=class{constructor(e){this._context=e,this._perConstructorInstances=new DC,this._frameCounter=0,this._keepAliveFrameCount=Wae}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach(e=>e.forEach(r=>r.technique.destroy())),this._perConstructorInstances.clear()}acquire(e,r=Tnt){const i=r.key;let s=this._perConstructorInstances.get(e,i);if(s==null){const n=new e(this._context,r,()=>this.release(n));s=new xnt(n),this._perConstructorInstances.set(e,i,s)}return++s.refCount,s.technique}releaseAndAcquire(e,r,i){if(i!=null){if(r.key===i.key)return i;this.release(i)}return this.acquire(e,r)}release(e){if(e==null||this._perConstructorInstances.empty)return;const r=this._perConstructorInstances.get(e.constructor,e.key);r!=null&&(--r.refCount,r.refCount===0&&(r.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==Wae&&this._perConstructorInstances.forEach((e,r)=>{e.forEach((i,s)=>{i.refCount===0&&i.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(i.technique.destroy(),this._perConstructorInstances.delete(r,s))})})}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach((r,i)=>{const s=async(n,o)=>{const a=o.shader;a&&(await a.reload(),n.forEach(l=>l.technique.reload(this._context)))};e.push(s(r,i))}),await Promise.all(e)}},xnt=class{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}};const Wae=-1,Tnt=new Sa;let WCe=class{constructor(e,r,i,s){this._textureRepository=e,this._techniqueRepository=r,this.materialChanged=i,this.requestRender=s,this._id2glMaterialRef=new DC}dispose(){this._textureRepository.destroy()}acquire(e,r,i){if(this._ownMaterial(e),!e.requiresSlot(r,i))return null;let s=this._id2glMaterialRef.get(i,e.id);if(s==null){const n=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:i});s=new Snt(n),this._id2glMaterialRef.set(i,e.id,s)}return s.ref(),s.glMaterial}release(e,r){const i=this._id2glMaterialRef.get(r,e.id);i!=null&&(i.unref(),i.referenced||(je(i.glMaterial),this._id2glMaterialRef.delete(r,e.id)))}_ownMaterial(e){e.repository!=null&&e.repository!==this&&K.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}},Snt=class{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,ot(this._refCnt>=0)}get referenced(){return this._refCnt>0}};const Ent={orderedRepackingEnabled:!1},Cnt=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","objectGeometryUpdated"];let Sq=class FN{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(e,r){this.objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new Xn,this._objectCount=0,r&&(r.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=r.maximumObjectsPerNode),r.maximumDepth!==void 0&&(this._maximumDepth=r.maximumDepth))}destroy(){this._degenerateObjects.clear(),Xn.clearPool(),Eq[0]=null,u1.prune(),lb.prune()}add(e,r=e.length){this._objectCount+=r,this._grow(e,r);const i=Xn.acquire();for(let s=0;s<r;s++){const n=e[s];this._isDegenerate(n)?this._degenerateObjects.add(n):(i.init(this._root),this._add(n,i))}Xn.release(i)}remove(e,r=null){this._objectCount-=e.length;const i=Xn.acquire();for(const s of e){const n=r??RE(this.objectToBoundingSphere(s),Pnt);mO(n[3])?(i.init(this._root),this._remove(s,n,i)):this._degenerateObjects.delete(s)}Xn.release(i),this._shrink()}update(e,r){if(!mO(r[3])&&this._isDegenerate(e))return;const i=Mnt(e);this.remove(i,r),this.add(i)}forEachAlongRay(e,r,i){const s=Du(e,r);this._forEachNode(this._root,n=>{if(!this._intersectsNode(s,n))return!1;const o=n.node;return o.terminals.forAll(a=>{this._intersectsObject(s,a)&&i(a)}),o.residents!==null&&o.residents.forAll(a=>{this._intersectsObject(s,a)&&i(a)}),!0})}forEachAlongRayWithVerticalOffset(e,r,i,s){const n=Du(e,r);this._forEachNode(this._root,o=>{if(!this._intersectsNodeWithOffset(n,o,s))return!1;const a=o.node;return a.terminals.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&i(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&i(l)}),!0})}forEach(e){this._forEachNode(this._root,r=>{const i=r.node;return i.terminals.forAll(e),i.residents!==null&&i.residents.forAll(e),!0}),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,r,i,s=()=>!0,n=1/0){let o=1/0,a=1/0,l=null;const c=yz(e,r),h=d=>{if(--n,!s(d))return;const f=this.objectToBoundingSphere(d);if(!B_(i,f))return;const m=y_(e,r,f),g=m-f[3],_=m+f[3];g<o&&(o=g,a=_,l=d)};return this._forEachNodeDepthOrdered(this._root,d=>{if(n<=0||!B_(i,d.bounds)||(se(Hu,c,d.halfSize),de(Hu,Hu,d.bounds),y_(e,r,Hu)>a))return!1;const f=d.node;return f.terminals.forAll(m=>h(m)),f.residents!==null&&f.residents.forAll(m=>h(m)),!0},e,r),l}forEachInDepthRange(e,r,i,s,n,o,a){let l=-1/0,c=1/0;const h={setRange:_=>{i===FN.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,_.near),c=Math.min(c,_.far)):(l=Math.max(l,-_.far),c=Math.min(c,-_.near))}};h.setRange(s);const d=y_(r,i,e),f=yz(r,i),m=yz(r,-i),g=_=>{if(!a(_))return;const v=this.objectToBoundingSphere(_),b=v,T=y_(r,i,b)-d,x=T-v[3],S=T+v[3];x>c||S<l||!B_(o,v)||n(_,h)};this._forEachNodeDepthOrdered(this._root,_=>{if(!B_(o,_.bounds)||(se(Hu,f,_.halfSize),de(Hu,Hu,_.bounds),y_(r,i,Hu)-d>c)||(se(Hu,m,_.halfSize),de(Hu,Hu,_.bounds),y_(r,i,Hu)-d<l))return!1;const v=_.node;return v.terminals.forAll(b=>g(b)),v.residents!==null&&v.residents.forAll(b=>g(b)),!0},r,i)}forEachNode(e){this._forEachNode(this._root,r=>e(r.node,r.bounds,r.halfSize,r.depth))}forEachNeighbor(e,r){const i=Qg(r),s=r,n=l=>{const c=this.objectToBoundingSphere(l),h=Qg(c),d=i+h;return!(xo(c,s)-d*d<=0)||e(l)};let o=!0;const a=l=>{o&&(o=n(l))};this._forEachNode(this._root,l=>{const c=Qg(l.bounds),h=i+c;if(xo(l.bounds,s)-h*h>0)return!1;const d=l.node;return d.terminals.forAll(a),o&&d.residents!==null&&d.residents.forAll(a),o}),o&&this.forEachDegenerateObject(a)}_intersectsNode(e,r){return H$(r.bounds,2*-r.halfSize,hu),H$(r.bounds,2*r.halfSize,du),Zse(e.origin,e.direction,hu,du)}_intersectsNodeWithOffset(e,r,i){return H$(r.bounds,2*-r.halfSize,hu),H$(r.bounds,2*r.halfSize,du),i.applyToMinMax(hu,du),Zse(e.origin,e.direction,hu,du)}_intersectsObject(e,r){const i=this.objectToBoundingSphere(r);return!(i[3]>0)||fj(i,e)}_intersectsObjectWithOffset(e,r,i){const s=this.objectToBoundingSphere(r);return!(s[3]>0)||fj(i.applyToBoundingSphere(s),e)}_forEachNode(e,r){let i=Xn.acquire().init(e);const s=[i];for(;s.length!==0;){if(i=s.pop(),r(i)&&!i.isLeaf())for(let n=0;n<i.node.children.length;n++)i.node.children[n]&&s.push(Xn.acquire().init(i).advance(n));Xn.release(i)}}_forEachNodeDepthOrdered(e,r,i,s=FN.DepthOrder.FRONT_TO_BACK){let n=Xn.acquire().init(e);const o=[n];for(Rnt(i,s,Zae);o.length!==0;){if(n=o.pop(),r(n)&&!n.isLeaf())for(let a=7;a>=0;--a){const l=Zae[a];n.node.children[l]&&o.push(Xn.acquire().init(n).advance(l))}Xn.release(n)}}_remove(e,r,i){u1.clear();const s=i.advanceTo(r,(n,o)=>{u1.push(n.node),u1.push(o)})?i.node.terminals:i.node.residents;if(s.removeUnordered(e),s.length===0)for(let n=u1.length-2;n>=0;n-=2){const o=u1.data[n],a=u1.data[n+1];if(!this._purge(o,a))break}}_nodeIsEmpty(e){if(e.terminals.length!==0)return!1;if(e.residents!==null)return e.residents.length===0;for(let r=0;r<e.children.length;r++)if(e.children[r])return!1;return!0}_purge(e,r){return r>=0&&(e.children[r]=null),!!this._nodeIsEmpty(e)&&(e.residents===null&&(e.residents=new Vt({shrink:!0})),!0)}_add(e,r){r.advanceTo(this.objectToBoundingSphere(e))?r.node.terminals.push(e):(r.node.residents.push(e),r.node.residents.length>this._maximumObjectsPerNode&&r.depth<this._maximumDepth&&this._split(r))}_split(e){const r=e.node.residents;e.node.residents=null;for(let i=0;i<r.length;i++){const s=Xn.acquire().init(e);this._add(r.at(i),s),Xn.release(s)}}_grow(e,r){if(r!==0&&(Xae(e,r,i=>this.objectToBoundingSphere(i),jm),mO(jm[3])&&!this._fitsInsideTree(jm)))if(this._nodeIsEmpty(this._root.node))RE(jm,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const i=this._rootBoundsForRootAsSubNode(jm);this._placingRootViolatesMaxDepth(i)?this._rebuildTree(jm,i):this._growRootAsSubNode(i),Xn.release(i)}}_rebuildTree(e,r){ie(vz,r.bounds),vz[3]=r.halfSize,Xae([e,vz],2,s=>s,bz);const i=Xn.acquire().init(this._root);this._root.initFrom(null,bz,bz[3]),this._root.increaseHalfSize(1.25),this._forEachNode(i,s=>(this.add(s.node.terminals.data,s.node.terminals.length),s.node.residents!==null&&this.add(s.node.residents.data,s.node.residents.length),!0)),Xn.release(i)}_placingRootViolatesMaxDepth(e){const r=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let i=0;return this._forEachNode(this._root,s=>(i=Math.max(i,s.depth),i+r<=this._maximumDepth)),i+r>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const r=e[3],i=e;let s=-1/0;const n=this._root.bounds,o=this._root.halfSize;for(let l=0;l<3;l++){const c=n[l]-o-(i[l]-r),h=i[l]+r-(n[l]+o),d=Math.max(0,Math.ceil(c/(2*o))),f=Math.max(0,Math.ceil(h/(2*o)))+1,m=2**Math.ceil(Math.log(d+f)*Math.LOG2E);s=Math.max(s,m),q$[l].min=d,q$[l].max=f}for(let l=0;l<3;l++){let c=q$[l].min,h=q$[l].max;const d=(s-(c+h))/2;c+=Math.ceil(d),h+=Math.floor(d);const f=n[l]-o-c*o*2;_z[l]=f+(h+c)*o}const a=s*o;return _z[3]=a*YCe,Xn.acquire().initFrom(null,_z,a,0)}_growRootAsSubNode(e){const r=this._root.node;ie(jm,this._root.bounds),jm[3]=this._root.halfSize,this._root.init(e),e.advanceTo(jm,null,!0),e.node.children=r.children,e.node.residents=r.residents,e.node.terminals=r.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(e===-1)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let e=null;const r=this._root.node.children;let i=0,s=0;for(;s<r.length&&e==null;)i=s++,e=r[i];for(;s<r.length;)if(r[s++])return-1;return i}_isDegenerate(e){return!mO(this.objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const r=this._root.bounds,i=this._root.halfSize;return e[3]<=i&&e[0]>=r[0]-i&&e[0]<=r[0]+i&&e[1]>=r[1]-i&&e[1]<=r[1]+i&&e[2]>=r[2]-i&&e[2]<=r[2]+i}toJSON(){const{maximumDepth:e,maximumObjectsPerNode:r,_objectCount:i}=this,s=this._nodeToJSON(this._root.node);return{maximumDepth:e,maximumObjectsPerNode:r,objectCount:i,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:s}}}_nodeToJSON(e){const r=e.children.map(n=>n?this._nodeToJSON(n):null),i=e.residents?.map(n=>this.objectToBoundingSphere(n)),s=e.terminals?.map(n=>this.objectToBoundingSphere(n));return{children:r,residents:i,terminals:s}}static fromJSON(e){const r=new FN(i=>i,{maximumDepth:e.maximumDepth,maximumObjectsPerNode:e.maximumObjectsPerNode});return r._objectCount=e.objectCount,r._root.initFrom(e.root.node,e.root.bounds,e.root.halfSize,e.root.depth),r}},Xn=class E2{constructor(){this.bounds=xs(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,r,i,s=this.depth){return this.node=e??E2.createEmptyNode(),r!=null&&RE(r,this.bounds),this.halfSize=i,this.depth=s,this}increaseHalfSize(e){this.halfSize*=e,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*YCe}advance(e){let r=this.node.children[e];r||(r=E2.createEmptyNode(),this.node.children[e]=r),this.node=r,this.halfSize/=2,this.depth++;const i=XCe[e];return this.bounds[0]+=i[0]*this.halfSize,this.bounds[1]+=i[1]*this.halfSize,this.bounds[2]+=i[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(e,r,i=!1){for(;;){if(this.isTerminalFor(e))return r&&r(this,-1),!0;if(this.isLeaf()){if(!i)return r&&r(this,-1),!1;this.node.residents=null}const s=this._childIndex(e);r&&r(this,s),this.advance(s)}}isLeaf(){return this.node.residents!=null}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const r=this.bounds;return(r[0]<e[0]?1:0)+(r[1]<e[1]?2:0)+(r[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new Vt({shrink:!0}),residents:new Vt({shrink:!0})}}static acquire(){return E2._pool.acquire()}static release(e){E2._pool.release(e)}static clearPool(){E2._pool.prune()}};function Ant(t,e){t[0]=Math.min(t[0],e[0]-e[3]),t[1]=Math.min(t[1],e[1]-e[3]),t[2]=Math.min(t[2],e[2]-e[3])}function Ont(t,e){t[0]=Math.max(t[0],e[0]+e[3]),t[1]=Math.max(t[1],e[1]+e[3]),t[2]=Math.max(t[2],e[2]+e[3])}function H$(t,e,r){r[0]=t[0]+e,r[1]=t[1]+e,r[2]=t[2]+e}function Xae(t,e,r,i){if(e===1){const s=r(t[0]);RE(s,i)}else{hu[0]=1/0,hu[1]=1/0,hu[2]=1/0,du[0]=-1/0,du[1]=-1/0,du[2]=-1/0;for(let s=0;s<e;s++){const n=r(t[s]);mO(n[3])&&(Ant(hu,n),Ont(du,n))}qr(i,hu,du,.5),i[3]=Math.max(du[0]-hu[0],du[1]-hu[1],du[2]-hu[2])/2}}function Rnt(t,e,r){if(!lb.length)for(let i=0;i<8;++i)lb.push({index:0,distance:0});for(let i=0;i<8;++i){const s=XCe[i];lb.data[i].index=i,lb.data[i].distance=y_(t,e,s)}lb.sort((i,s)=>i.distance-s.distance);for(let i=0;i<8;++i)r[i]=lb.data[i].index}function yz(t,e){let r,i=1/0;for(let s=0;s<8;++s){const n=y_(t,e,Yae[s]);n<i&&(i=n,r=Yae[s])}return r}function y_(t,e,r){return e*(t[0]*r[0]+t[1]*r[1]+t[2]*r[2])}function mO(t){return!isNaN(t)&&t!==-1/0&&t!==1/0&&t>0}Xn._pool=new qo(Xn),function(t){var e;(e=t.DepthOrder||(t.DepthOrder={}))[e.FRONT_TO_BACK=1]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(Sq||(Sq={}));const XCe=[Pe(-1,-1,-1),Pe(1,-1,-1),Pe(-1,1,-1),Pe(1,1,-1),Pe(-1,-1,1),Pe(1,-1,1),Pe(-1,1,1),Pe(1,1,1)],Yae=[Pe(-1,-1,-1),Pe(-1,-1,1),Pe(-1,1,-1),Pe(-1,1,1),Pe(1,-1,-1),Pe(1,-1,1),Pe(1,1,-1),Pe(1,1,1)],YCe=Math.sqrt(3),Eq=[null];function Mnt(t){return Eq[0]=t,Eq}const _z=xs(),Hu=O(),hu=O(),du=O(),u1=new Vt,Pnt=xs(),jm=xs(),vz=xs(),bz=xs(),q$=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],lb=new Vt,Zae=[0,0,0,0,0,0,0,0],mp=Sq;var tv;(function(t){t[t.ASYNC=0]="ASYNC",t[t.SYNC=1]="SYNC"})(tv||(tv={}));let ZCe=class extends DP{get objects(){return this._objects}constructor(e,r,i=""){super(),this.stage=e,this.apiLayerUid=i,this.type=us.Layer,this.events=new Ts,this.sliceable=!1,this._objects=new Vt,this._objectsAdded=new Vt,this._handles=new $i,this.apiLayerUid=i,this.visible=r?.visible??!0,this.pickable=r?.pickable??!0,this.updatePolicy=r?.updatePolicy??tv.ASYNC,this._disableOctree=r?.disableOctree??!1,e.add(this);for(const s of Cnt)this._handles.add(this.events.on(s,n=>e.handleEvent(s,n)))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),this._octree!=null&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),this._octree!=null&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const r of e)r.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),this._octree!=null&&this._objectsAdded.pushArray(e)}removeMany(e){const r=new Array;if(this._objects.removeUnorderedMany(e,e.length,r),r.length!==0){for(const i of r)i.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:r}),this._octree!=null){for(let i=0;i<r.length;)this._objectsAdded.removeUnordered(r[i])?(r[i]=r[r.length-1],r.length-=1):++i;this._octree.remove(r)}}}sync(){this.updatePolicy!==tv.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(e,r){this._octree==null||this._objectsAdded.includes(e)||this._octree.update(e,r)}getSpatialQueryAccelerator(){return this._octree==null&&this._objects.length>50&&!this._disableOctree?(this._octree=new mp(e=>e.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):this._octree!=null&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=Ne(this._octree),this._objectsAdded.clear()}};function wF(t){return t!=null&&t.type===us.Layer}var Mu,tx;(function(t){t[t.Draped=0]="Draped",t[t.Screen=1]="Screen",t[t.World=2]="World",t[t.COUNT=3]="COUNT"})(Mu||(Mu={})),function(t){t[t.Center=0]="Center",t[t.Tip=1]="Tip",t[t.COUNT=2]="COUNT"}(tx||(tx={}));let po=class extends jo{constructor(){super(...arguments),this.output=F.Color,this.transparencyPassType=dt.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=Mu.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=tx.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}get draped(){return this.space===Mu.Draped}};u([B({count:F.COUNT})],po.prototype,"output",void 0),u([B({count:dt.COUNT})],po.prototype,"transparencyPassType",void 0),u([B()],po.prototype,"occluder",void 0),u([B()],po.prototype,"hasSlicePlane",void 0),u([B()],po.prototype,"writeDepth",void 0),u([B({count:Mu.COUNT})],po.prototype,"space",void 0),u([B()],po.prototype,"hideOnShortSegments",void 0),u([B()],po.prototype,"hasCap",void 0),u([B({count:tx.COUNT})],po.prototype,"anchor",void 0),u([B()],po.prototype,"hasTip",void 0),u([B()],po.prototype,"vvSize",void 0),u([B()],po.prototype,"vvColor",void 0),u([B()],po.prototype,"vvOpacity",void 0),u([B()],po.prototype,"hasOccludees",void 0),u([B()],po.prototype,"hasMultipassTerrain",void 0),u([B()],po.prototype,"cullAboveGround",void 0),u([B({constValue:!0})],po.prototype,"hasVvInstancing",void 0),u([B({constValue:!0})],po.prototype,"hasSliceTranslatedView",void 0);const Jae=8;function JCe(t,e){const r=t.vertex;r.uniforms.add(new Ie("intrinsicWidth",i=>i.width)),e.vvSize?(t.attributes.add(C.SIZEFEATUREATTRIBUTE,"float"),r.uniforms.add(new kt("vvSizeMinSize",i=>i.vvSize.minSize),new kt("vvSizeMaxSize",i=>i.vvSize.maxSize),new kt("vvSizeOffset",i=>i.vvSize.offset),new kt("vvSizeFactor",i=>i.vvSize.factor)),r.code.add(w`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(t.attributes.add(C.SIZE,"float"),r.code.add(w`float getSize(){
return intrinsicWidth * size;
}`)),e.vvOpacity?(t.attributes.add(C.OPACITYFEATUREATTRIBUTE,"float"),r.constants.add("vvOpacityNumber","int",8),r.uniforms.add(new $l("vvOpacityValues",i=>i.vvOpacity.values,Jae),new $l("vvOpacityOpacities",i=>i.vvOpacity.opacityValues,Jae)),r.code.add(w`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):r.code.add(w`vec4 applyOpacity( vec4 color ){
return color;
}`),e.vvColor?(t.include(r0,e),t.attributes.add(C.COLORFEATUREATTRIBUTE,"float"),r.code.add(w`vec4 getColor(){
return applyOpacity(interpolateVVColor(colorFeatureAttribute));
}`)):(t.attributes.add(C.COLOR,"vec4"),r.code.add(w`vec4 getColor(){
return applyOpacity(color);
}`))}function C0(t,e){switch(t.fragment.include(Bc),e.output){case F.Shadow:case F.ShadowHighlight:case F.ShadowExcludeHighlight:t.fragment.code.add(w`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
fragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`);break;case F.Depth:t.fragment.code.add(w`void outputDepth(float _linearDepth) {
fragColor = float2rgba(_linearDepth);
}`)}}let QCe=class{constructor(e,r,i){this._createTexture=e,this._parametersKey=r,this._repository=new Map,this._orphanCache=i.newCache(`procedural-texture-repository:${Ic()}`,s=>s.dispose())}destroy(){for(const[e,{texture:r}]of this._repository)r.dispose();this._repository.clear(),this._orphanCache.destroy()}swap(e,r=null){const i=this._acquire(e);return this.release(r),i}release(e){if(e==null)return;const r=this._parametersKey(e),i=this._repository.get(r);if(i&&(i.refCount--,i.refCount===0)){this._repository.delete(r);const{texture:s}=i,n=s.gpuMemoryUsage;this._orphanCache.put(r,s,n)}}_acquire(e){if(e==null)return null;const r=this._parametersKey(e),i=this._repository.get(r);if(i)return i.refCount++,i.texture;const s=this._orphanCache.pop(r)??this._createTexture(e),n=new Int(s);return this._repository.set(r,n),s}},Int=class{constructor(e){this.texture=e,this.refCount=1}};function $nt(t,e){return new QCe(r=>{const{encodedData:i,paddedPixels:s}=Lnt(r),n=new xr;return n.internalFormat=Ct.RGBA,n.width=s,n.height=1,n.wrapMode=Dt.CLAMP_TO_EDGE,new Ot(t,n,i)},r=>`${r.pattern.join(",")}-r${r.pixelRatio}`,e)}function Lnt(t){const e=OK(t),r=1/t.pixelRatio,i=KCe(t),s=e3e(t),n=(Math.floor(.5*(s-1))+.5)*r,o=[];let a=1;for(const m of e){for(let g=0;g<m;g++){const _=a*(Math.min(g,m-1-g)+.5)*r/n*.5+.5;o.push(_)}a=-a}const l=Math.round(e[0]/2),c=[...o.slice(l),...o.slice(0,l)],h=i+t3e,d=new Uint8Array(4*h);let f=4;for(const m of c)$M(m,d,f),f+=4;return d.copyWithin(0,f-4,f),d.copyWithin(f,4,8),{encodedData:d,paddedPixels:h}}function OK(t){return t.pattern.map(e=>Math.round(e*t.pixelRatio))}function KCe(t){if(t==null)return 1;const e=OK(t);return Math.floor(e.reduce((r,i)=>r+i))}function e3e(t){return OK(t).reduce((e,r)=>Math.max(e,r))}const t3e=2;function Dnt(t){return t==null?rm:t.length===4?t:Ti(Nnt,t[0],t[1],t[2],1)}const Nnt=Wt();function r3e(t,e){t.constants.add("stippleAlphaColorDiscard","float",.001),t.constants.add("stippleAlphaHighlightDiscard","float",.5),e.stippleEnabled?Fnt(t,e):Unt(t)}function Fnt(t,e){const r=!(e.draped&&e.stipplePreferContinuous),{vertex:i,fragment:s}=t;s.include(Bc),e.draped||($p(i,e),i.uniforms.add(new Ie("worldToScreenPerDistanceRatio",(n,o)=>1/o.camera.perScreenPixelRatio)),i.code.add(w`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),t.varyings.add("vStippleDistance","float"),e.stippleRequiresClamp&&t.varyings.add("vStippleDistanceLimits","vec2"),e.stippleRequiresStretchMeasure&&t.varyings.add("vStipplePatternStretch","float"),i.code.add(w`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${znt};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),i.code.add(w`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),i.code.add(w`
    if (segmentLengthPseudoScreen >= ${r?"patternLength":"1e4"}) {
  `),zC(i,e),i.code.add(w`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${e.stippleRequiresStretchMeasure?w`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `),s.constants.add("stippleTexturePadding","float",t3e),s.uniforms.add(new rt("stipplePatternTexture",n=>n.stippleTexture),new Ie("stipplePatternSDFNormalizer",n=>knt(n.stipplePattern)),new Ie("stipplePatternPixelSizeInv",n=>1/RK(n))),s.code.add(w`float padStippleTexture(float u) {
float paddedTextureSize = float(textureSize(stipplePatternTexture, 0).x);
float unpaddedTextureSize = paddedTextureSize - stippleTexturePadding;
return (u * unpaddedTextureSize + stippleTexturePadding * 0.5) / paddedTextureSize;
}`),s.code.add(w`
    float getStippleSDF(out bool isClamped) {
      ${e.stippleRequiresClamp?w`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:w`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${e.stippleScaleWithLineWidth?w`u *= vLineSizeInv;`:""}
      u = padStippleTexture(fract(u));

      float encodedSDF = rgba2float(texture(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${e.stippleRequiresStretchMeasure?w`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:w`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${e.stippleScaleWithLineWidth?w`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:w`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `),e.stippleOffColorEnabled?(s.uniforms.add(new sr("stippleOffColor",n=>Dnt(n.stippleOffColor))),s.code.add(w`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):s.code.add(w`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function Unt(t){t.fragment.code.add(w`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}function knt(t){return t?(Math.floor(.5*(e3e(t)-1))+.5)/t.pixelRatio:1}function RK(t){const e=t.stipplePattern;return e?KCe(t.stipplePattern)/e.pixelRatio:1}const znt=w.float(.4),xw=64,MK=xw/2,i3e=MK/5,Vnt=xw/i3e,Bnt=.25;function Gnt(t,e){const r=JSe(t,xw,MK,i3e),i=new xr;return i.internalFormat=Ct.RGBA,i.width=xw,i.height=xw,i.wrapMode=Dt.CLAMP_TO_EDGE,new Ot(e,i,r)}function s3e(t,e){const{vertex:r,constants:i}=t;i.add("markerSizePerLineWidth","float",Vnt),zC(r,e),r.uniforms.get("markerScale")==null&&r.constants.add("markerScale","float",1),r.code.add(w`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),e.space===Mu.World&&(r.constants.add("maxSegmentLengthFraction","float",.45),r.uniforms.add(new Ie("perRenderPixelRatio",(s,n)=>n.camera.perRenderPixelRatio)),r.code.add(w`bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}
float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}`))}var Bh;(function(t){t[t.BUTT=0]="BUTT",t[t.SQUARE=1]="SQUARE",t[t.ROUND=2]="ROUND",t[t.COUNT=3]="COUNT"})(Bh||(Bh={}));let Bi=class extends jo{constructor(){super(...arguments),this.output=F.Color,this.capType=Bh.BUTT,this.transparencyPassType=dt.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}};u([B({count:F.COUNT})],Bi.prototype,"output",void 0),u([B({count:Bh.COUNT})],Bi.prototype,"capType",void 0),u([B({count:dt.COUNT})],Bi.prototype,"transparencyPassType",void 0),u([B()],Bi.prototype,"occluder",void 0),u([B()],Bi.prototype,"hasSlicePlane",void 0),u([B()],Bi.prototype,"hasPolygonOffset",void 0),u([B()],Bi.prototype,"writeDepth",void 0),u([B()],Bi.prototype,"draped",void 0),u([B()],Bi.prototype,"stippleEnabled",void 0),u([B()],Bi.prototype,"stippleOffColorEnabled",void 0),u([B()],Bi.prototype,"stippleScaleWithLineWidth",void 0),u([B()],Bi.prototype,"stipplePreferContinuous",void 0),u([B()],Bi.prototype,"roundJoins",void 0),u([B()],Bi.prototype,"applyMarkerOffset",void 0),u([B()],Bi.prototype,"vvSize",void 0),u([B()],Bi.prototype,"vvColor",void 0),u([B()],Bi.prototype,"vvOpacity",void 0),u([B()],Bi.prototype,"falloffEnabled",void 0),u([B()],Bi.prototype,"innerColorEnabled",void 0),u([B()],Bi.prototype,"hasOccludees",void 0),u([B()],Bi.prototype,"hasMultipassTerrain",void 0),u([B()],Bi.prototype,"cullAboveGround",void 0),u([B()],Bi.prototype,"wireframe",void 0),u([B({constValue:!0})],Bi.prototype,"stippleRequiresClamp",void 0),u([B({constValue:!0})],Bi.prototype,"stippleRequiresStretchMeasure",void 0),u([B({constValue:!0})],Bi.prototype,"hasVvInstancing",void 0),u([B({constValue:!0})],Bi.prototype,"hasSliceTranslatedView",void 0),u([B()],Bi.prototype,"objectAndLayerIdColorInstanced",void 0);const xF=1;function jnt(t){const e=new Sr,{vertex:r,fragment:i}=e,s=t.hasMultipassTerrain&&(t.output===F.Color||t.output===F.Alpha);e.include(PP),e.include(JCe,t),e.include(r3e,t);const n=t.applyMarkerOffset&&!t.draped;n&&(r.uniforms.add(new Ie("markerScale",m=>m.markerScale)),e.include(s3e,{space:Mu.World,draped:!1})),t.output===F.Depth&&e.include(C0,t),e.include(BP,t),Dc(r,t),r.uniforms.add(new Ui("inverseProjectionMatrix",(m,g)=>g.camera.inverseProjectionMatrix),new Ar("nearFar",(m,g)=>g.camera.nearFar),new Ie("miterLimit",m=>m.join!=="miter"?0:m.miterLimit),new sr("viewport",(m,g)=>g.camera.fullViewport)),r.constants.add("LARGE_HALF_FLOAT","float",65500),e.attributes.add(C.POSITION,"vec3"),e.attributes.add(C.SUBDIVISIONFACTOR,"float"),e.attributes.add(C.UV0,"vec2"),e.attributes.add(C.AUXPOS1,"vec3"),e.attributes.add(C.AUXPOS2,"vec3"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),yv(e),s&&e.varyings.add("depth","float");const o=t.stippleEnabled&&t.stippleScaleWithLineWidth;o&&e.varyings.add("vLineSizeInv","float");const a=t.capType===Bh.ROUND,l=o||a;l&&e.varyings.add("vLineWidth","float");const c=t.innerColorEnabled||a;c&&e.varyings.add("vLineDistance","float");const h=t.stippleEnabled&&a,d=t.falloffEnabled||h;d&&e.varyings.add("vLineDistanceNorm","float"),a&&(e.varyings.add("vSegmentSDF","float"),e.varyings.add("vReverseSegmentSDF","float")),r.code.add(w`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),r.code.add(w`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),B8(e),r.code.add(w`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${s?"depth = pos.z;":""}
      linearDepth = calculateLinearDepth(nearFar,pos.z);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),zC(r,t),r.code.add(w`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${l?w`vLineWidth = lineWidth;`:""}
      ${o?w`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);
  `),n&&r.code.add(w`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),r.code.add(w`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(t.stippleEnabled||a)&&r.code.add(w`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${a?w`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),r.code.add(w`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),t.roundJoins?r.code.add(w`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${t.stippleEnabled?w`min(1.0, subdivisionFactor * ${w.float((xF+2)/(xF+1))})`:w`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):r.code.add(w`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const f=t.capType!==Bh.BUTT;return r.code.add(w`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${f?w`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),r.code.add(w`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${d||c?w`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${c?w`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${d?w`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),a&&r.code.add(w`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),t.stippleEnabled&&(t.draped?r.uniforms.add(new Ie("worldToScreenRatio",(m,g)=>1/g.screenToPCSRatio)):r.code.add(w`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),r.code.add(w`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),t.draped?r.code.add(w`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):r.code.add(w`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),r.uniforms.add(new Ie("stipplePatternPixelSize",m=>RK(m))),r.code.add(w`
      float patternLength = ${t.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `)),r.code.add(w`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${t.wireframe&&!t.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `),s&&e.include(Fu,t),e.include(vs,t),i.include(Lm),i.code.add(w`
  void main() {
    discardBySlice(vpos);
    ${s?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),t.wireframe?i.code.add(w`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(a&&i.code.add(w`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${w.float(bo)}) {
        discard;
      }
    `),h?i.code.add(w`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${w.float(bo)}, stippleCoverage);
      `):i.code.add(w`float stippleAlpha = getStippleAlpha();`),i.uniforms.add(new sr("intrinsicColor",m=>m.color)),t.output!==F.ObjectAndLayerIdColor&&i.code.add(w`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),i.code.add(w`vec4 color = intrinsicColor * vColor;`),t.innerColorEnabled&&(i.uniforms.add(new sr("innerColor",m=>m.innerColor??m.color),new Ie("innerWidth",(m,g)=>m.innerWidth*g.camera.pixelRatio)),i.code.add(w`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),i.code.add(w`vec4 finalColor = blendStipple(color, stippleAlpha);`),t.falloffEnabled&&(i.uniforms.add(new Ie("falloff",m=>m.falloff)),i.code.add(w`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`))),i.code.add(w`
    ${t.output===F.ObjectAndLayerIdColor?w`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${w.float(bo)}) {
      discard;
    }

    ${t.output===F.Alpha?w`fragColor = vec4(finalColor.a);`:""}
    ${t.output===F.Color?w`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===F.Color&&t.transparencyPassType===dt.Color?"fragColor = premultiplyAlpha(fragColor);":""}
    ${t.output===F.Highlight?w`fragColor = vec4(1.0);`:""}
    ${t.output===F.Depth?w`outputDepth(linearDepth);`:""}
    ${t.output===F.ObjectAndLayerIdColor?w`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const Hnt=Object.freeze(Object.defineProperty({__proto__:null,RIBBONLINE_NUM_ROUND_JOIN_SUBDIVISIONS:xF,build:jnt},Symbol.toStringTag,{value:"Module"})),PK={func:ri.LESS},TF={func:ri.ALWAYS},Tm={mask:255},n3e={mask:0},qnt=t=>({function:{func:ri.NOTEQUAL,ref:t,mask:t},operation:{fail:bs.KEEP,zFail:bs.KEEP,zPass:bs.KEEP}}),Wnt=t=>({function:{func:ri.ALWAYS,ref:t,mask:t},operation:{fail:bs.KEEP,zFail:bs.KEEP,zPass:bs.REPLACE}}),kv={function:{func:ri.ALWAYS,ref:Ul.OutlineVisualElementMask,mask:Ul.OutlineVisualElementMask},operation:{fail:bs.KEEP,zFail:bs.KEEP,zPass:bs.ZERO}},Cv={function:{func:ri.ALWAYS,ref:Ul.OutlineVisualElementMask,mask:Ul.OutlineVisualElementMask},operation:{fail:bs.KEEP,zFail:bs.KEEP,zPass:bs.REPLACE}},o3e={function:{func:ri.EQUAL,ref:Ul.OutlineVisualElementMask,mask:Ul.OutlineVisualElementMask},operation:{fail:bs.KEEP,zFail:bs.KEEP,zPass:bs.KEEP}},a3e={function:{func:ri.NOTEQUAL,ref:Ul.OutlineVisualElementMask,mask:Ul.OutlineVisualElementMask},operation:{fail:bs.KEEP,zFail:bs.KEEP,zPass:bs.KEEP}},l3e=new Map([[C.POSITION,0],[C.SUBDIVISIONFACTOR,1],[C.UV0,2],[C.AUXPOS1,3],[C.AUXPOS2,4],[C.COLOR,5],[C.COLORFEATUREATTRIBUTE,5],[C.SIZE,6],[C.SIZEFEATUREATTRIBUTE,6],[C.OPACITYFEATUREATTRIBUTE,7],[C.OBJECTANDLAYERIDCOLOR,8]]);let c3e=class u3e extends Lr{initializeProgram(e){return new Rr(e.rctx,u3e.shader.get().build(this.configuration),l3e)}_makePipelineState(e,r){const i=this.configuration,s=e===dt.NONE,n=e===dt.FrontFace;return Mt({blending:i.output===F.Color||i.output===F.Alpha?s?Ru:V0(e):null,depthTest:{func:Uv(e)},depthWrite:s?i.writeDepth?jl:null:d9(e),colorWrite:Bt,stencilWrite:i.hasOccludees?Tm:null,stencilTest:i.hasOccludees?r?Cv:kv:null,polygonOffset:s||n?i.hasPolygonOffset?Qae:null:f9})}initializePipeline(){const e=this.configuration;if(e.occluder){const r=e.hasPolygonOffset?Qae:null;this._occluderPipelineTransparent=Mt({blending:Ru,polygonOffset:r,depthTest:TF,depthWrite:null,colorWrite:Bt,stencilWrite:null,stencilTest:a3e}),this._occluderPipelineOpaque=Mt({blending:Ru,polygonOffset:r,depthTest:TF,depthWrite:null,colorWrite:Bt,stencilWrite:n3e,stencilTest:o3e}),this._occluderPipelineMaskWrite=Mt({blending:null,polygonOffset:r,depthTest:PK,depthWrite:null,colorWrite:null,stencilWrite:Tm,stencilTest:Cv})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?At.LINES:At.TRIANGLE_STRIP}getPipelineState(e,r){return r?this._occludeePipelineState:this.configuration.occluder?e===pe.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===pe.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,r)}};c3e.shader=new Or(Hnt,()=>he(()=>import("./RibbonLine.glsl-6fa50ac3.js"),[],import.meta.url));const Qae={factor:0,units:-4};var hc;(function(t){t[t.LEFT_JOIN_START=-2]="LEFT_JOIN_START",t[t.LEFT_JOIN_END=-1]="LEFT_JOIN_END",t[t.LEFT_CAP_START=-4]="LEFT_CAP_START",t[t.LEFT_CAP_END=-5]="LEFT_CAP_END",t[t.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",t[t.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",t[t.RIGHT_CAP_START=4]="RIGHT_CAP_START",t[t.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(hc||(hc={}));let _S=class extends Fv{constructor(e){super(e,new Ynt),this._configuration=new Bi,this._vertexAttributeLocations=l3e}isClosed(e,r){return d3e(this.parameters,e,r)}getConfiguration(e,r){this._configuration.output=e,this._configuration.draped=r.slot===pe.DRAPED_MATERIAL;const i=this.parameters.stipplePattern!=null&&e!==F.Highlight;return this._configuration.stippleEnabled=i,this._configuration.stippleOffColorEnabled=i&&this.parameters.stippleOffColor!=null,this._configuration.stippleScaleWithLineWidth=i&&this.parameters.stippleScaleWithLineWidth,this._configuration.stipplePreferContinuous=i&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins=this.parameters.join==="round",this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=this.parameters.markerParameters!=null&&Jnt(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&this.parameters.innerColor!=null,this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===Ni.OccludeAndTransparentStencil,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersectDraped(e,r,i,s,n,o){if(!i.options.selectionMode)return;const a=e.vertexAttributes.get(C.POSITION).data,l=e.vertexAttributes.get(C.SIZE);let c=this.parameters.width;if(this.parameters.vvSize){const _=e.vertexAttributes.get(C.SIZEFEATUREATTRIBUTE).data[0];c*=ve(this.parameters.vvSize.offset[0]+_*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else l&&(c*=l.data[0]);const h=s[0],d=s[1],f=(c/2+4)*e.screenToWorldRatio;let m=Number.MAX_VALUE,g=0;for(let _=0;_<a.length-5;_+=3){const v=a[_],b=a[_+1],T=h-v,x=d-b,S=a[_+3]-v,E=a[_+4]-b,A=ve((S*T+E*x)/(S*S+E*E),0,1),R=S*A-T,M=E*A-x,D=R*R+M*M;D<m&&(m=D,g=_/3)}m<f*f&&n(o.dist,o.normal,g,!1)}intersect(e,r,i,s,n,o){if(!i.options.selectionMode||!e.visible)return;if(!wxe(r))return void K.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const a=e.vertexAttributes,l=a.get(C.POSITION).data;let c=this.parameters.width;if(this.parameters.vvSize){const T=a.get(C.SIZEFEATUREATTRIBUTE).data[0];c*=ve(this.parameters.vvSize.offset[0]+T*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else a.has(C.SIZE)&&(c*=a.get(C.SIZE).data[0]);const h=i.camera,d=Qnt;yn(d,i.point);const f=c*h.pixelRatio/2+4*h.pixelRatio;ne(M3[0],d[0]-f,d[1]+f,0),ne(M3[1],d[0]+f,d[1]+f,0),ne(M3[2],d[0]+f,d[1]-f,0),ne(M3[3],d[0]-f,d[1]-f,0);for(let T=0;T<4;T++)if(!h.unprojectFromRenderScreen(M3[T],Hm[T]))return;ua(h.eye,Hm[0],Hm[1],xz),ua(h.eye,Hm[1],Hm[2],Tz),ua(h.eye,Hm[2],Hm[3],Sz),ua(h.eye,Hm[3],Hm[0],Ez);let m=Number.MAX_VALUE,g=0;const _=h3e(this.parameters,a,e.indices)?l.length-2:l.length-5;for(let T=0;T<_;T+=3){fl[0]=l[T]+r[12],fl[1]=l[T+1]+r[13],fl[2]=l[T+2]+r[14];const x=(T+3)%l.length;if(ml[0]=l[x]+r[12],ml[1]=l[x+1]+r[13],ml[2]=l[x+2]+r[14],fi(xz,fl)<0&&fi(xz,ml)<0||fi(Tz,fl)<0&&fi(Tz,ml)<0||fi(Sz,fl)<0&&fi(Sz,ml)<0||fi(Ez,fl)<0&&fi(Ez,ml)<0)continue;if(h.projectToRenderScreen(fl,d1),h.projectToRenderScreen(ml,p1),d1[2]<0&&p1[2]>0){fe(Zp,fl,ml);const E=h.frustum,A=-fi(E[pi.NEAR],fl)/ye(Zp,E[pi.NEAR]);se(Zp,Zp,A),de(fl,fl,Zp),h.projectToRenderScreen(fl,d1)}else if(d1[2]>0&&p1[2]<0){fe(Zp,ml,fl);const E=h.frustum,A=-fi(E[pi.NEAR],ml)/ye(Zp,E[pi.NEAR]);se(Zp,Zp,A),de(ml,ml,Zp),h.projectToRenderScreen(ml,p1)}else if(d1[2]<0&&p1[2]<0)continue;d1[2]=0,p1[2]=0;const S=EJ(yw(d1,p1,tle),d);S<m&&(m=S,ie(Kae,fl),ie(ele,ml),g=T/3)}const v=i.rayBegin,b=i.rayEnd;if(m<f*f){let T=Number.MAX_VALUE;if(Lbe(yw(Kae,ele,tle),yw(v,b,Knt),h1)){fe(h1,h1,v);const x=Re(h1);se(h1,h1,1/x),T=x/mi(v,b)}o(T,h1,g,!1)}}get _layout(){const e=qi().vec3f(C.POSITION).f32(C.SUBDIVISIONFACTOR).vec2f(C.UV0).vec3f(C.AUXPOS1).vec3f(C.AUXPOS2);return this.parameters.vvSize?e.f32(C.SIZEFEATUREATTRIBUTE):e.f32(C.SIZE),this.parameters.vvColor?e.f32(C.COLORFEATUREATTRIBUTE):e.vec4f(C.COLOR),this.parameters.vvOpacity&&e.f32(C.OPACITYFEATUREATTRIBUTE),ae("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(C.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new Znt(this._layout,this.parameters)}requiresSlot(e,r){return r===F.Color||r===F.Alpha||r===F.Highlight||r===F.Depth||r===F.ObjectAndLayerIdColor?e===pe.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===Ni.OccludeAndTransparentStencil?e===pe.OPAQUE_MATERIAL||e===pe.OCCLUDER_MATERIAL||e===pe.TRANSPARENT_OCCLUDER_MATERIAL:r===F.Color||r===F.Alpha?e===(this.parameters.writeDepth?pe.TRANSPARENT_MATERIAL:pe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===pe.OPAQUE_MATERIAL:!1}createGLMaterial(e){return new Xnt(e)}validateParameters(e){e.join!=="miter"&&(e.miterLimit=0),e.markerParameters!=null&&(e.markerScale=e.markerParameters.width/e.width)}},Xnt=class extends Dv{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==F.Color&&this._output!==F.Alpha||this._updateOccludeeState(e);const r=this._material.parameters.stipplePattern;return this._stipplePattern!==r&&(this._material.setParameters({stippleTexture:this._stippleTextureRepository.swap(r,this._stipplePattern)}),this._stipplePattern=r),this.ensureTechnique(c3e,e)}},Ynt=class extends jP{constructor(){super(...arguments),this.width=0,this.color=Lh,this.join="miter",this.cap=Bh.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}},Znt=class{constructor(e,r){this._parameters=r,this.numJoinSubdivisions=0,this.vertexBufferLayout=e;const i=r.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=i;break;case"round":this.numJoinSubdivisions=xF+i}}_isClosed(e){return h3e(this._parameters,e.vertexAttributes,e.indices)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const i=e.indices.get(C.POSITION).length/2+1,s=this._isClosed(e);let n=s?2:2*2;return n+=((s?i:i-1)-(s?0:1))*(2*this.numJoinSubdivisions+4),n+=2,this._parameters.wireframe&&(n=2+4*(n-2)),n}write(e,r,i,s,n){const o=eot,a=tot,l=rot,c=i.vertexAttributes.get(C.POSITION).data,h=i.indices&&i.indices.get(C.POSITION),d=i.vertexAttributes.get(C.DISTANCETOSTART)?.data;h&&h.length!==2*(c.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let f=1,m=0;this._parameters.vvSize?m=i.vertexAttributes.get(C.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(C.SIZE)&&(f=i.vertexAttributes.get(C.SIZE).data[0]);let g=[1,1,1,1],_=0;this._parameters.vvColor?_=i.vertexAttributes.get(C.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(C.COLOR)&&(g=i.vertexAttributes.get(C.COLOR).data);const v=ae("enable-feature:objectAndLayerId-rendering")?i.objectAndLayerIdColor:null;let b=0;this._parameters.vvOpacity&&(b=i.vertexAttributes.get(C.OPACITYFEATUREATTRIBUTE).data[0]);const T=c.length/3,x=new Float32Array(s.buffer),S=ae("enable-feature:objectAndLayerId-rendering")?new Uint8Array(s.buffer):null,E=this.vertexBufferLayout.stride/4;let A=n*E;const R=A;let M=0;const D=d?(G,J,I)=>M=d[I]:(G,J,I)=>M+=mi(G,J),k=ae("enable-feature:objectAndLayerId-rendering"),L=(G,J,I,z,V,j,Y)=>{if(x[A++]=J[0],x[A++]=J[1],x[A++]=J[2],x[A++]=z,x[A++]=Y,x[A++]=V,x[A++]=G[0],x[A++]=G[1],x[A++]=G[2],x[A++]=I[0],x[A++]=I[1],x[A++]=I[2],x[A++]=this._parameters.vvSize?m:f,this._parameters.vvColor)x[A++]=_;else{const Q=Math.min(4*j,g.length-4);x[A++]=g[Q],x[A++]=g[Q+1],x[A++]=g[Q+2],x[A++]=g[Q+3]}this._parameters.vvOpacity&&(x[A++]=b),k&&(v!=null&&(S[4*A]=v[0],S[4*A+1]=v[1],S[4*A+2]=v[2],S[4*A+3]=v[3]),A++)};A+=E,ne(a,c[0],c[1],c[2]),e&&ze(a,a,e);const N=this._isClosed(i);if(N){const G=c.length-3;ne(o,c[G],c[G+1],c[G+2]),e&&ze(o,o,e)}else ne(l,c[3],c[4],c[5]),e&&ze(l,l,e),L(a,a,l,1,hc.LEFT_CAP_START,0,0),L(a,a,l,1,hc.RIGHT_CAP_START,0,0),ie(o,a),ie(a,l);const q=N?0:1,X=N?T:T-1;for(let G=q;G<X;G++){const J=(G+1)%T*3;ne(l,c[J],c[J+1],c[J+2]),e&&ze(l,l,e),D(o,a,G),L(o,a,l,0,hc.LEFT_JOIN_END,G,M),L(o,a,l,0,hc.RIGHT_JOIN_END,G,M);const I=this.numJoinSubdivisions;for(let z=0;z<I;++z){const V=(z+1)/(I+1);L(o,a,l,V,hc.LEFT_JOIN_END,G,M),L(o,a,l,V,hc.RIGHT_JOIN_END,G,M)}L(o,a,l,1,hc.LEFT_JOIN_START,G,M),L(o,a,l,1,hc.RIGHT_JOIN_START,G,M),ie(o,a),ie(a,l)}N?(ne(l,c[3],c[4],c[5]),e&&ze(l,l,e),M=D(o,a,X),L(o,a,l,0,hc.LEFT_JOIN_END,q,M),L(o,a,l,0,hc.RIGHT_JOIN_END,q,M)):(M=D(o,a,X),L(o,a,a,0,hc.LEFT_CAP_END,X,M),L(o,a,a,0,hc.RIGHT_CAP_END,X,M)),wz(x,R+E,x,R,E),A=wz(x,A-E,x,A,E),this._parameters.wireframe&&this._addWireframeVertices(s,R,A,E)}_addWireframeVertices(e,r,i,s){const n=new Float32Array(e.buffer,i*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT,i-r);let a=0;const l=c=>a=wz(o,c,n,a,s);for(let c=0;c<o.length-1;c+=2*s)l(c),l(c+2*s),l(c+1*s),l(c+2*s),l(c+1*s),l(c+3*s)}};function wz(t,e,r,i,s){for(let n=0;n<s;n++)r[i++]=t[e++];return i}function h3e(t,e,r){return d3e(t,e.get(C.POSITION).data,r?r.get(C.POSITION):null)}function d3e(t,e,r){return!!t.isClosed&&(r?r.length>2:e.length>6)}function Jnt(t){return t.anchor===tx.Tip&&t.hideOnShortSegments&&t.placement==="begin-end"&&t.worldSpace}const fl=O(),ml=O(),Zp=O(),h1=O(),Qnt=O(),d1=Wo(),p1=Wo(),Kae=O(),ele=O(),tle=Dp(),Knt=Dp(),eot=O(),tot=O(),rot=O(),M3=[Wo(),Wo(),Wo(),Wo()],Hm=[O(),O(),O(),O()],xz=Fr(),Tz=Fr(),Sz=Fr(),Ez=Fr();let IK=class{constructor(e){this._originSR=e,this._origins=new Map,this._objects=new Map,this._gridSize=5e5,this._rootOriginId="root/"+Ic()}getOrigin(e){const r=this._origins.get(this._rootOriginId);if(r==null){const h=pF(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,h),h}const i=this._gridSize,s=Math.round(e[0]/i),n=Math.round(e[1]/i),o=Math.round(e[2]/i),a=`${s}/${n}/${o}`;let l=this._origins.get(a);const c=.5*i;if(fe(no,e,r.vec3),no[0]=Math.abs(no[0]),no[1]=Math.abs(no[1]),no[2]=Math.abs(no[2]),no[0]<c&&no[1]<c&&no[2]<c){if(l){const h=Math.max(...no);if(fe(no,e,l.vec3),no[0]=Math.abs(no[0]),no[1]=Math.abs(no[1]),no[2]=Math.abs(no[2]),Math.max(...no)<h)return l}return r}return l||(l=pF(s*i,n*i,o*i,a),this._origins.set(a,l)),l}_drawOriginBox(e,r=Nt(1,1,0,1)){const i=window.view,s=i._stage,n=r.toString();if(!this._objects.has(n)){this._material=new _S({width:2,color:r}),s.add(this._material);const m=new ZCe(s,{pickable:!1}),g=new B0({castShadow:!1});s.add(g),m.add(g),this._objects.set(n,g)}const o=this._objects.get(n),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=a.length,c=new Array(3*l),h=new Array,d=.5*this._gridSize;for(let m=0;m<l;m++)c[3*m]=e[0]+(1&a[m]?d:-d),c[3*m+1]=e[1]+(2&a[m]?d:-d),c[3*m+2]=e[2]+(4&a[m]?d:-d),m>0&&h.push(m-1,m);ci(c,this._originSR,0,c,i.renderSpatialReference,0,l);const f=new Ks(this._material,[[C.POSITION,new We(c,3,!0)]],[[C.POSITION,h]],null,us.Line);s.add(f),o.addGeometry(f)}get test(){const e=this;return{set gridSize(r){e._gridSize=r}}}};const no=O();let p3e=class{constructor(e,r,i,s=null){this.rctx=e,this.sliceHelper=s,this.lastFrameCamera=new yt,this.output=F.Color,this.renderOccludedMask=rle,this.bindParameters=new V8(r,i,s!=null?s.plane:null),this.bindParameters.alignPixelEnabled=!0}resetRenderOccludedMask(){this.renderOccludedMask=rle}},iot=class extends p3e{constructor(e,r,i,s,n){super(e,i,s,n),this.offscreenRenderingHelper=r,this.sliceHelper=n,this.time=0}};const rle=Ni.Occlude|Ni.OccludeAndTransparent|Ni.OccludeAndTransparentStencil;let gO=class extends yt{constructor(){super(...arguments),this._projectionMatrix=xe()}get projectionMatrix(){return this._projectionMatrix}};u([p()],gO.prototype,"_projectionMatrix",void 0),u([p({readOnly:!0})],gO.prototype,"projectionMatrix",null),gO=u([P("esri.views.3d.webgl-engine.lib.CascadeCamera")],gO);const ile=16;function $K(t){return Math.ceil(t/ile)*ile}var KE;(function(t){t[t.Highlight=0]="Highlight",t[t.Default=1]="Default"})(KE||(KE={}));let W$=class{constructor(){this.camera=new gO,this.lightMat=xe()}},sot=class{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}},LK=class{get depthTexture(){return this._fbo?.colorTexture}get textureSize(){return this._textureSize}get numCascades(){return this._numCascades}get cascadeDistances(){return Ti(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}constructor(e,r){this._rctx=e,this._viewingMode=r,this._enabled=!1,this._snapshots=new Array,this._textureSize=0,this._numCascades=1,this.settings=new sot,this._projectionView=xe(),this._projectionViewInverse=xe(),this._modelViewLight=xe(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=Wt(),this._cascades=[new W$,new W$,new W$,new W$],this._lastOrigin=null,this._maxTextureSize=Math.min(ae("esri-mobile")?2048:8192,this._rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}disposeOffscreenBuffers(){this._fbo=je(this._fbo),this._discardAllSnapshots()}set maxCascades(e){this.settings.maxNumCascadesHighQuality=ve(Math.floor(e),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&this.depthTexture!=null}getSnapshot(e){return this.enabled?this._snapshots[e]:null}get cascades(){for(let e=0;e<this._numCascades;++e)Az[e]=this._cascades[e];return Az.length=this._numCascades,Az}start(e,r,i,s,n){ot(this.enabled),this._textureSize=this._computeTextureSize(e,n,s),this._ensureDepthTexture();const{near:o,far:a}=this._clampNearFar(i);this._computeCascadeDistances(a,o,s),this._setupMatrices(e,r);const{viewMatrix:l,projectionMatrix:c}=e;for(let h=0;h<this._numCascades;++h)this._constructCascade(h,c,l,r);this._lastOrigin=null,this.clear()}finish(e){ot(this.enabled),this._rctx.bindFramebuffer(e)}getShadowMapMatrices(e){if(!this._lastOrigin||!ma(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||O(),ie(this._lastOrigin,e);for(let r=0;r<this._numCascades;++r){Gl(cle,this._cascades[r].lightMat,e);for(let i=0;i<16;++i)ule[16*r+i]=cle[i]}}return ule}takeCascadeSnapshotTo(e,r){ot(this.enabled);const i=this._ensureSnapshot(r);this._bindFbo();const s=this._rctx,n=s.bindTexture(i,Ot.TEXTURE_UNIT_FOR_UPDATES);s.gl.copyTexSubImage2D(cs.TEXTURE_2D,0,e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[2],e.camera.viewport[3]),s.bindTexture(n,Ot.TEXTURE_UNIT_FOR_UPDATES)}clear(){const e=this._rctx;this._bindFbo(),e.setClearColor(1,1,1,1),e.clearSafe(Si.COLOR_BUFFER_BIT|Si.DEPTH_BUFFER_BIT)}_computeTextureSize(e,r,i){const s=Math.min(window.devicePixelRatio,r)/e.pixelRatio,n=Math.max(e.fullWidth,e.fullHeight)*s,o=i?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality;return Math.floor(Math.min(this._maxTextureSize,$K((this.numCascades===1?1:2)*n*o)))}_ensureDepthTexture(){if(this._fbo?.width===this._textureSize)return;const e=new xr(this._textureSize);e.wrapMode=Dt.CLAMP_TO_EDGE,e.samplingMode=Rt.NEAREST,this._fbo?.dispose(),this._fbo=new fn(this._rctx,e,new B5(Zs.DEPTH_COMPONENT16,this._textureSize))}_ensureSnapshot(e){let r=this._snapshots[e];if(r!=null&&r.descriptor.width===this._textureSize)return r;this._discardSnapshot(e);const i=new xr;return i.wrapMode=Dt.CLAMP_TO_EDGE,i.samplingMode=Rt.NEAREST,i.width=this._textureSize,i.height=this._textureSize,r=new Ot(this._rctx,i),this._snapshots[e]=r,r}_discardSnapshot(e){this._snapshots[e]=je(this._snapshots[e])}_discardAllSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){const e=this._rctx;e.unbindTexture(this.depthTexture),e.bindFramebuffer(this._fbo)}_constructCascade(e,r,i,s){const n=this._cascades[e],o=-this._cascadeDistances[e],a=-this._cascadeDistances[e+1],l=(r[10]*o+r[14])/Math.abs(r[11]*o+r[15]),c=(r[10]*a+r[14])/Math.abs(r[11]*a+r[15]);ot(l<c);for(let m=0;m<8;++m){Ti(sle,m%4==0||m%4==3?-1:1,m%4==0||m%4==1?-1:1,m<4?l:c,1);const g=wh[m];xu(g,sle,this._projectionViewInverse),g[0]/=g[3],g[1]/=g[3],g[2]/=g[3]}va(Cz,wh[0]),n.camera.viewMatrix=Gl(not,this._modelViewLight,Cz);for(let m=0;m<8;++m)ze(wh[m],wh[m],n.camera.viewMatrix);let h=wh[0][2],d=wh[0][2];for(let m=1;m<8;++m)h=Math.min(h,wh[m][2]),d=Math.max(d,wh[m][2]);h-=200,d+=200,n.camera.near=-d,n.camera.far=-h,cot(i,s,h,d,n.camera),ai(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const f=this._textureSize/(this.numCascades===1?1:2);n.camera.viewport=[e%2==0?0:f,Math.floor(e/2)===0?0:f,f,f]}_setupMatrices(e,r){ai(this._projectionView,e.projectionMatrix,e.viewMatrix),$n(this._projectionViewInverse,this._projectionView);const i=this._viewingMode===Ve.Global?e.eye:ne(Cz,0,0,1);_8(this._modelViewLight,[0,0,0],[-r[0],-r[1],-r[2]],i)}_clampNearFar(e){let{near:r,far:i}=e;return r<2&&(r=2),i<2&&(i=2),r>=i&&(r=2,i=4),{near:r,far:i}}_computeCascadeDistances(e,r,i){const s=i?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor(cqe(e/r,4)),s);const n=(e-r)/this._numCascades,o=(e/r)**(1/this._numCascades);let a=r,l=r;for(let c=0;c<this._numCascades+1;++c)this._cascadeDistances[c]=St(a,l,this.settings.splitSchemeLambda),a*=o,l+=n}get gpuMemoryUsage(){return this._snapshots.reduce((e,r)=>e+(r?.gpuMemoryUsage??0),this._fbo?.gpuMemoryUsage??0)}get test(){return{cascades:this._cascades,textureSize:this._textureSize}}};const not=xe(),sle=Wt(),wh=[];for(let t=0;t<8;++t)wh.push(Wt());const nle=He(),ole=He(),oot=He(),ale=He(),lle=He(),Cz=O(),Az=[],cle=xe(),ule=new Array(64),Xc=He(),gT=He(),f1=[He(),He(),He(),He()],wn=He(),Oz=He(),my=He(),P3=He(),yT=He(),_T=He(),X$=He();function aot(t,e,r,i,s,n,o,a){or(Xc,0,0);for(let E=0;E<4;++E)Qd(Xc,Xc,t[E]);Sc(Xc,Xc,.25),or(gT,0,0);for(let E=4;E<8;++E)Qd(gT,gT,t[E]);Sc(gT,gT,.25),Ah(f1[0],t[4],t[5],.5),Ah(f1[1],t[5],t[6],.5),Ah(f1[2],t[6],t[7],.5),Ah(f1[3],t[7],t[4],.5);let l=0,c=N5(f1[0],Xc);for(let E=1;E<4;++E){const A=N5(f1[E],Xc);A<c&&(c=A,l=E)}zf(wn,f1[l],t[l+4]);const h=wn[0];let d,f;wn[0]=-wn[1],wn[1]=h,zf(Oz,gT,Xc),on(Oz,wn)<0&&jJ(wn,wn),Ah(wn,wn,Oz,r),TM(wn,wn),d=f=on(zf(my,t[0],Xc),wn);for(let E=1;E<8;++E){const A=on(zf(my,t[E],Xc),wn);A<d?d=A:A>f&&(f=A)}yn(i,Xc),Sc(my,wn,d-e),Qd(i,i,my);let m=-1,g=1,_=0,v=0;for(let E=0;E<8;++E){zf(P3,t[E],i),TM(P3,P3);const A=wn[0]*P3[1]-wn[1]*P3[0];A>0?A>m&&(m=A,_=E):A<g&&(g=A,v=E)}Jx(m>0,"leftArea"),Jx(g<0,"rightArea"),Sc(yT,wn,d),Qd(yT,yT,Xc),Sc(_T,wn,f),Qd(_T,_T,Xc),X$[0]=-wn[1],X$[1]=wn[0];const b=KI(i,t[v],_T,Qd(my,_T,X$),1,s),T=KI(i,t[_],_T,my,1,n),x=KI(i,t[_],yT,Qd(my,yT,X$),1,o),S=KI(i,t[v],yT,my,1,a);Jx(b,"rayRay"),Jx(T,"rayRay"),Jx(x,"rayRay"),Jx(S,"rayRay")}function vr(t,e){return 3*e+t}const hle=He();function Zl(t,e){return or(hle,t[e],t[e+3]),hle}const gl=He(),Je=ki();function lot(t,e,r,i,s){zf(gl,r,i),Sc(gl,gl,.5),Je[0]=gl[0],Je[1]=gl[1],Je[2]=0,Je[3]=gl[1],Je[4]=-gl[0],Je[5]=0,Je[6]=gl[0]*gl[0]+gl[1]*gl[1],Je[7]=gl[0]*gl[1]-gl[1]*gl[0],Je[8]=1,Je[vr(0,2)]=-on(Zl(Je,0),t),Je[vr(1,2)]=-on(Zl(Je,1),t);let n=on(Zl(Je,0),r)+Je[vr(0,2)],o=on(Zl(Je,1),r)+Je[vr(1,2)],a=on(Zl(Je,0),i)+Je[vr(0,2)],l=on(Zl(Je,1),i)+Je[vr(1,2)];n=-(n+a)/(o+l),Je[vr(0,0)]+=Je[vr(1,0)]*n,Je[vr(0,1)]+=Je[vr(1,1)]*n,Je[vr(0,2)]+=Je[vr(1,2)]*n,n=1/(on(Zl(Je,0),r)+Je[vr(0,2)]),o=1/(on(Zl(Je,1),r)+Je[vr(1,2)]),Je[vr(0,0)]*=n,Je[vr(0,1)]*=n,Je[vr(0,2)]*=n,Je[vr(1,0)]*=o,Je[vr(1,1)]*=o,Je[vr(1,2)]*=o,Je[vr(2,0)]=Je[vr(1,0)],Je[vr(2,1)]=Je[vr(1,1)],Je[vr(2,2)]=Je[vr(1,2)],Je[vr(1,2)]+=1,n=on(Zl(Je,1),e)+Je[vr(1,2)],o=on(Zl(Je,2),e)+Je[vr(2,2)],a=on(Zl(Je,1),r)+Je[vr(1,2)],l=on(Zl(Je,2),r)+Je[vr(2,2)],n=-.5*(n/o+a/l),Je[vr(1,0)]+=Je[vr(2,0)]*n,Je[vr(1,1)]+=Je[vr(2,1)]*n,Je[vr(1,2)]+=Je[vr(2,2)]*n,n=on(Zl(Je,1),e)+Je[vr(1,2)],o=on(Zl(Je,2),e)+Je[vr(2,2)],a=-o/n,Je[vr(1,0)]*=a,Je[vr(1,1)]*=a,Je[vr(1,2)]*=a,s[0]=Je[0],s[1]=Je[1],s[2]=0,s[3]=Je[2],s[4]=Je[3],s[5]=Je[4],s[6]=0,s[7]=Je[5],s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=Je[6],s[13]=Je[7],s[14]=0,s[15]=Je[8]}function cot(t,e,r,i,s){const n=1/wh[0][3],o=1/wh[4][3];ot(n<o);let a=n+Math.sqrt(n*o);const l=Math.sin(Dn(t[2]*e[0]+t[6]*e[1]+t[10]*e[2]));a/=l,aot(wh,a,l,nle,ole,oot,ale,lle),lot(nle,ole,ale,lle,s.projectionMatrix),s.projectionMatrix[10]=2/(r-i),s.projectionMatrix[14]=-(r+i)/(r-i)}function uot(t){return Fp(t)&&t.intersector===ji.TERRAIN&&!!t.target}let hot=class extends Q8{constructor(e,r,i){super(e,r),this.triangleNr=i}};function f3e(t){return Fp(t)&&t.intersector===ji.OVERLAY&&!!t.target}let Cq=class{constructor(){this.adds=new Vt,this.removes=new Vt,this.updates=new Vt({allocator:e=>e||new dot,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return this.adds.length===0&&this.removes.length===0&&this.updates.length===0}},dot=class{},pot=class{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}};var Yi,An;(function(t){t[t.ADD=0]="ADD",t[t.UPDATE=1]="UPDATE",t[t.REMOVE=2]="REMOVE"})(Yi||(Yi={})),function(t){t[t.NONE=0]="NONE",t[t.VISIBILITY=1]="VISIBILITY",t[t.GEOMETRY=2]="GEOMETRY",t[t.TRANSFORMATION=4]="TRANSFORMATION",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.OCCLUDEE=16]="OCCLUDEE"}(An||(An={}));function m3e(t){const e=new Map,r=i=>{let s=e.get(i);return s||(s=new pot,e.set(i,s)),s};return t.removes.forAll(i=>{Rz(i)&&r(i.material).removes.push(i)}),t.adds.forAll(i=>{Rz(i)&&r(i.material).adds.push(i)}),t.updates.forAll(i=>{Rz(i.renderGeometry)&&r(i.renderGeometry.material).updates.push(i)}),e}function Rz(t){return t.geometry.indexCount>=1}let g3e=class{constructor(e,r){this._material=e,this._repository=r,this._map=new Map}destroy(){this._map.forEach((e,r)=>{e!=null&&this._repository.release(this._material,r)})}load(e,r,i){if(!this._material.requiresSlot(r,i))return null;this._map.has(i)||this._map.set(i,this._repository.acquire(this._material,r,i));const s=this._map.get(i);if(s!=null){if(s.ensureResources(e)===Kg.LOADED)return s;this._repository.requestRender()}return null}};function YP(t,e){switch(e.normalType){case Ir.Compressed:t.attributes.add(C.NORMALCOMPRESSED,"vec2"),t.vertex.code.add(w`vec3 normalModel() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
return vec3(normalCompressed + sign(normalCompressed) * min(z, 0.0), z);
}`);break;case Ir.Attribute:t.attributes.add(C.NORMAL,"vec3"),t.vertex.code.add(w`vec3 normalModel() {
return normal;
}`);break;case Ir.ScreenDerivative:t.fragment.code.add(w`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:e.normalType;case Ir.COUNT:case Ir.Ground:}}var Ir;(function(t){t[t.Attribute=0]="Attribute",t[t.Compressed=1]="Compressed",t[t.Ground=2]="Ground",t[t.ScreenDerivative=3]="ScreenDerivative",t[t.COUNT=4]="COUNT"})(Ir||(Ir={}));function A9(t,e){switch(e.normalType){case Ir.Attribute:case Ir.Compressed:t.include(YP,e),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("vNormalView","vec3"),t.vertex.uniforms.add(new SM("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel),new sd("transformNormalViewFromGlobal",r=>r.transformNormalViewFromGlobal)),t.vertex.code.add(w`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case Ir.Ground:t.include(NS,e),t.varyings.add("vNormalWorld","vec3"),t.vertex.code.add(w`
        void forwardNormal() {
          vNormalWorld = ${e.spherical?w`normalize(vPositionWorldCameraRelative);`:w`vec3(0.0, 0.0, 1.0);`}
        }
        `);break;case Ir.ScreenDerivative:t.vertex.code.add(w`void forwardNormal() {}`);break;default:e.normalType;case Ir.COUNT:}}let y3e=class extends wTe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=ki()}},_3e=class extends xTe{constructor(){super(...arguments),this.transformNormalGlobalFromModel=ki(),this.toMapSpace=Wt()}},Aq=class extends _3e{constructor(e=O()){super(),this.origin=e,this.slicePlaneLocalOrigin=this.origin}},VC=class{constructor(e){this.vertexBufferLayout=e}elementCount(e){return e.indices.get(C.POSITION).length}write(e,r,i,s,n){GSe(i,this.vertexBufferLayout,e,r,s,n)}};const fot=qi().vec3f(C.POSITION),mot=qi().vec3f(C.POSITION).vec2f(C.UV0),got=qi().vec3f(C.POSITION).vec4u8(C.COLOR);qi().vec3f(C.POSITION).vec4u8(C.OBJECTANDLAYERIDCOLOR);const yot=qi().vec3f(C.POSITION).vec2f(C.UV0).vec4u8(C.OBJECTANDLAYERIDCOLOR);qi().vec3f(C.POSITION).vec4u8(C.COLOR).vec4u8(C.OBJECTANDLAYERIDCOLOR);let DK=class extends Fv{intersect(e,r,i,s,n,o){return PSe(e,i,s,n,void 0,o)}};function _ot(t){t.fragment.code.add(w`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function vot(t){t.fragment.code.add(w`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}let ZP=class extends ps{constructor(e,r){super(e,"int",ti.Pass,(i,s,n)=>i.setUniform1i(e,r(s,n)))}},bot=class extends ps{constructor(e,r,i){super(e,"mat4",ti.Draw,(s,n,o,a)=>s.setUniformMatrix4fv(e,r(n,o,a)),i)}},wot=class extends ps{constructor(e,r,i){super(e,"mat4",ti.Pass,(s,n,o)=>s.setUniformMatrix4fv(e,r(n,o)),i)}},xot=class extends ii{constructor(){super(...arguments),this.origin=O()}},Tot=class extends xot{},Sot=class extends ii{constructor(){super(...arguments),this.modelTransformation=pn}},NK=class extends Sot{constructor(){super(...arguments),this.origin=O()}};function O9(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new wot("shadowMapMatrix",(r,i)=>i.shadowMap.getShadowMapMatrices(r.origin),4)),v3e(t))}function rx(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new bot("shadowMapMatrix",(r,i)=>i.shadowMap.getShadowMapMatrices(r.origin),4)),v3e(t))}function v3e(t){const e=t.fragment;e.include(Bc),e.uniforms.add(new rt("shadowMapTex",(r,i)=>i.shadowMap.depthTexture),new ZP("numCascades",(r,i)=>i.shadowMap.numCascades),new sr("cascadeDistances",(r,i)=>i.shadowMap.cascadeDistances)),e.code.add(w`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, vec3 lvpos) {
return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + (numCascades == 1 ? 1.0 : 0.5) * lvpos.xy;
}
float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
return rgba2float(texture(_depthTex, uv));
}
float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, float texSize, sampler2D _depthTex) {
float halfPixelSize = 0.5 / texSize;
vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);
float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
vec2 uv = cascadeCoordinates(i, lvpos);
return filterShadow(uv, lvpos, float(textureSize(shadowMapTex, 0).x), shadowMapTex);
}`)}function dle(t){t.fragment.uniforms.add(new rt("texWaveNormal",e=>e.waveNormal),new rt("texWavePerturbation",e=>e.wavePertubation),new sr("waveParams",e=>Ti(Eot,e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset)),new Ar("waveDirection",e=>or(Cot,e.waveDirection[0]*e.waveVelocity,e.waveDirection[1]*e.waveVelocity))),t.include(_ot),t.fragment.code.add(w`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const Eot=Wt(),Cot=He();function kM(t,e){e.spherical?t.vertex.code.add(w`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):t.vertex.code.add(w`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),e.spherical?t.vertex.code.add(w`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):t.vertex.code.add(w`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}function Aot(t){const e=t.fragment.code;e.add(w`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),e.add(w`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),e.add(w`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function FK(t,e){const r=t.fragment.code;t.include(PP),e.pbrMode!==ut.Normal&&e.pbrMode!==ut.Schematic&&e.pbrMode!==ut.Terrain&&e.pbrMode!==ut.TerrainWithWater||(r.add(w`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),r.add(w`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),e.pbrMode!==ut.Normal&&e.pbrMode!==ut.Schematic||(t.include(Aot),r.add(w`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),r.add(w`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),r.add(w`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),r.add(w`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function Oot(t,e){const r=t.fragment.code;t.include(PP),r.add(w`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${e.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),r.add(w`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),r.add(w`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),r.add(w`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),r.add(w`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)}function b3e(t,e){t.include(Oot,e),t.include(F8),t.include(vot),e.hasCloudsReflections&&t.include(Gxe,e),e.hasScreenSpaceReflections&&t.include(WWe,e);const r=t.fragment;r.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),r.code.add(w`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),r.uniforms.add(new Ie("lightingSpecularStrength",(i,s)=>s.lighting.mainLight.specularStrength),new Ie("lightingEnvironmentStrength",(i,s)=>s.lighting.mainLight.environmentStrength)),r.code.add(w`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),e.hasCloudsReflections&&r.code.add(w`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),e.hasScreenSpaceReflections?(r.uniforms.add(new Ui("view",(i,s)=>s.ssr.camera.viewMatrix),new rt("lastFrameColorTexture",(i,s)=>s.ssr.lastFrameColorTexture),new Ie("fadeFactorSSR",(i,s)=>s.ssr.fadeFactor)),r.code.add(w`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):r.code.add(w`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),e.hasCloudsReflections?e.hasScreenSpaceReflections?r.code.add(w`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):r.code.add(w`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):r.code.add(w`return waterRenderedColor;
}`)}function Rot(t){const e=new Sr,{vertex:r,fragment:i}=e;Dc(r,t),e.include(Nl,t),e.attributes.add(C.POSITION,"vec3"),e.attributes.add(C.UV0,"vec2");const s=new sr("waterColor",n=>n.color);if(t.output===F.Color&&t.isDraped)return e.varyings.add("vpos","vec3"),r.uniforms.add(s),r.code.add(w`
        void main(void) {
          if (waterColor.a < ${w.float(bo)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),i.uniforms.add(s),i.code.add(w`void main() {
fragColor = waterColor;
}`),e;switch(t.output!==F.Color&&t.output!==F.Alpha||(e.include(kM,t),e.include($C,t),e.varyings.add("vuv","vec2"),e.varyings.add("vpos","vec3"),e.varyings.add("vnormal","vec3"),e.varyings.add("vtbnMatrix","mat3"),t.hasMultipassTerrain&&e.varyings.add("depth","float"),r.uniforms.add(s),r.code.add(w`
      void main(void) {
        if (waterColor.a < ${w.float(bo)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${t.output===F.Color?"forwardLinearDepth();":""}
      }
    `)),e.include(Fu,t),t.output){case F.Alpha:e.include(vs,t),i.uniforms.add(s),i.code.add(w`
        void main() {
          discardBySlice(vpos);
          ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          fragColor = vec4(waterColor.a);
        }
      `);break;case F.Color:e.include(F5),e.include(eQ,{pbrMode:ut.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(dle),e.include(vs,t),e.include(rx,t),e.include(b3e,t),i.uniforms.add(s,new Ie("timeElapsed",n=>n.timeElapsed),r.uniforms.get("view"),r.uniforms.get("localOrigin")),$p(i,t),i.include(Lm),I0(i),$m(i),i.code.add(w`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${t.receiveShadows?w`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        fragColor = delinearizeGamma(final);
        fragColor = highlightSlice(fragColor, vpos);
        ${t.transparencyPassType===dt.Color?"fragColor = premultiplyAlpha(fragColor);":""}
      }
    `);break;case F.Normal:e.include(kM,t),e.include(dle,t),e.include(vs,t),e.varyings.add("vpos","vec3"),e.varyings.add("vuv","vec2"),r.uniforms.add(s),r.code.add(w`
        void main(void) {
          if (waterColor.a < ${w.float(bo)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),i.uniforms.add(new Ie("timeElapsed",n=>n.timeElapsed)),i.code.add(w`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
fragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case F.Highlight:e.include(z0,t),e.varyings.add("vpos","vec3"),r.uniforms.add(s),r.code.add(w`
      void main(void) {
        if (waterColor.a < ${w.float(bo)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),e.include(vs,t),i.code.add(w`void main() {
discardBySlice(vpos);
outputHighlight();
}`);break;case F.ObjectAndLayerIdColor:e.include(BP,t),e.varyings.add("vpos","vec3"),r.uniforms.add(s),r.code.add(w`
      void main(void) {
        if (waterColor.a < ${w.float(bo)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
        forwardObjectAndLayerIdColor();
      }
    `),e.include(vs,t),i.code.add(w`void main() {
discardBySlice(vpos);
outputObjectAndLayerIdColor();
}`)}return e}const Mot=Object.freeze(Object.defineProperty({__proto__:null,build:Rot},Symbol.toStringTag,{value:"Module"}));let w3e=class x3e extends Lr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Ve.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Rr(e.rctx,x3e.shader.get().build(this.configuration),Tr)}_setPipelineState(e){const r=this.configuration,i=e===dt.NONE,s=e===dt.FrontFace;return Mt({blending:r.output!==F.Normal&&r.output!==F.Highlight&&r.output!==F.ObjectAndLayerIdColor&&r.transparent?i?Ru:V0(e):null,depthTest:{func:Uv(e)},depthWrite:i?r.writeDepth?jl:null:d9(e),colorWrite:Bt,polygonOffset:i||s?null:m9(r.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};w3e.shader=new Or(Mot,()=>he(()=>import("./WaterSurface.glsl-cffac1ea.js"),[],import.meta.url));let zn=class extends jo{constructor(){super(...arguments),this.output=F.Color,this.transparencyPassType=dt.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.objectAndLayerIdColorInstanced=!1,this.isDraped=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}};u([B({count:F.COUNT})],zn.prototype,"output",void 0),u([B({count:dt.COUNT})],zn.prototype,"transparencyPassType",void 0),u([B()],zn.prototype,"spherical",void 0),u([B()],zn.prototype,"receiveShadows",void 0),u([B()],zn.prototype,"hasSlicePlane",void 0),u([B()],zn.prototype,"transparent",void 0),u([B()],zn.prototype,"enableOffset",void 0),u([B()],zn.prototype,"writeDepth",void 0),u([B()],zn.prototype,"hasScreenSpaceReflections",void 0),u([B()],zn.prototype,"doublePrecisionRequiresObfuscation",void 0),u([B()],zn.prototype,"hasCloudsReflections",void 0),u([B()],zn.prototype,"objectAndLayerIdColorInstanced",void 0),u([B()],zn.prototype,"isDraped",void 0),u([B()],zn.prototype,"hasMultipassTerrain",void 0),u([B()],zn.prototype,"cullAboveGround",void 0),u([B({constValue:ut.Water})],zn.prototype,"pbrMode",void 0),u([B({constValue:!0})],zn.prototype,"useCustomDTRExponentForWater",void 0),u([B({constValue:!0})],zn.prototype,"highStepCount",void 0),u([B({constValue:!1})],zn.prototype,"useFillLights",void 0);let Pot=class extends Dv{_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}_updateSSRState(e){e.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:e.ssr.enabled})}_updateCloudsReflectionState(e){const r=e.cloudsFade.data!=null;r!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:r})}ensureResources(e){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(e)}beginSlot(e){return this._output===F.Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e)),this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters),this.ensureTechnique(w3e,e)}},T3e=class extends DK{constructor(e){super(e,new S3e),this._configuration=new zn,this.animation=new ZTe}getConfiguration(e,r){return this._configuration.output=e,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.isDraped=this.parameters.isDraped,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<p9,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}update(e){const r=Math.min(e.camera.relativeElevation,e.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*r<Iot;const i=this.animation.advance(e);return this.setParameters({timeElapsed:PY(this.animation.time)*this.parameters.animationSpeed},!1),this.animation.enabled&&i}requiresSlot(e,r){switch(r){case F.Normal:return e===pe.DRAPED_WATER;case F.Color:if(this.parameters.isDraped)return e===pe.DRAPED_MATERIAL;break;case F.Alpha:break;case F.Highlight:case F.ObjectAndLayerIdColor:return e===pe.OPAQUE_MATERIAL||e===pe.DRAPED_MATERIAL;default:return!1}let i=pe.OPAQUE_MATERIAL;return this.parameters.transparent&&(i=this.parameters.writeDepth?pe.TRANSPARENT_MATERIAL:pe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===i}createGLMaterial(e){return new Pot(e)}createBufferWriter(){return new VC(ae("enable-feature:objectAndLayerId-rendering")?yot:mot)}},S3e=class extends eK{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=fr(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=Nt(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.origin=O(),this.modelTransformation=null}};const Iot=35e3;let UK=class{constructor(e=0,r=0){this.from=e,this.to=r}get numElements(){return this.to-this.from}};function ple(t){const e=new Map;t.forAll(i=>e.set(i.from,i));let r=!0;for(;r;)r=!1,t.forEach(i=>{const s=e.get(i.to);s&&(i.to=s.to,e.delete(s.from),t.removeUnordered(s),r=!0)})}let fle=class extends UK{constructor(e,r,i){super(r,i),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return this.geometry.highlights!=null&&this.isVisible}get hasOccludees(){return this.geometry.occludees!=null}},$ot=class{constructor(){this.first=0,this.count=0}},Lot=class{constructor(){this._numElements=0,this._instances=new Map,this.holes=new Vt({allocator:e=>e||new UK,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=Y$(),this.drawCommandsHighlight=Y$(),this.drawCommandsOccludees=Y$(),this.drawCommandsShadowHighlightRest=Y$()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(e,r){this.deleteInstance(e),this._instances.set(e,r),this._numElements+=r.numElements}deleteInstance(e){const r=this._instances.get(e);r&&(this._numElements-=r.numElements,this._instances.delete(e))}updateInstance(e,r,i){const s=this._instances.get(e);s&&(this._numElements-=s.numElements,s.from=r,s.to=i,this._numElements+=s.numElements)}updateDrawState(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,this._instances.size===0)return;if(!this.needsMultipleCommands()){const i=this.drawCommandsDefault.pushNew(),s=this.holes.front();return this.vao!=null&&this.holes.length===1&&s.to===Math.floor(this.vao.byteSize/e)?(i.first=0,void(i.count=s.from)):(i.first=1/0,i.count=0,this._instances.forEach(n=>{i.first=Math.min(i.first,n.from),i.count=Math.max(i.count,n.to)}),void(i.count-=i.first))}const r=Array.from(this._instances.values()).sort((i,s)=>i.from===s.from?i.to-s.to:i.from-s.from);for(const i of r)i.isVisible&&(mle(i.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,i),mle(i.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,i))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}};function Dot(t){return t.vao!=null}function Y$(){return new Vt({allocator:t=>t||new $ot,deallocator:t=>t})}function mle(t,e){const r=t.back();if(r==null){const i=t.pushNew();return i.first=e.from,void(i.count=e.numElements)}if(Not(r,e)){const i=e.from-r.first+e.numElements;r.count=i}else{const i=t.pushNew();i.first=e.from,i.count=e.numElements}}function Not(t,e){return t.first+t.count>=e.from}let Fot=class{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach(e=>e.vao.dispose()),this.buffers.length=0}findBuffer(e){return this.buffers.find(r=>r.instances.has(e))}};const UN=-3;var kg;(function(t){t[t.ALL=0]="ALL",t[t.SOME=1]="SOME"})(kg||(kg={}));let Uot=class{constructor(e,r,i){this.name=e,this._storage=r,this.id=kot+++":",this.size=0,this.maxSize=0,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),i&&(this._storage.registerRemoveFunc(this.id,i),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get sizeAll(){return this._storage.size}resetHitRate(){this._hit=this._miss=0}put(e,r,i,s=0){this._storage.put(this,e,r,i,s)}get(e){const r=this._storage.get(this,e);return r===void 0?++this._miss:++this._hit,r}pop(e){const r=this._storage.pop(this,e);return r===void 0?++this._miss:++this._hit,r}updateSize(e,r,i){this._storage.updateSize(this,e,r,i)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}},E3e=class{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new Vt,this._users=new Vt}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,r){this._removeFuncs.push([e,r])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace(r=>r[0]!==e)}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,0),this._checkSizeLimits()}put(e,r,i,s,n){r=e.id+r;const o=this._db.get(r);if(o&&(this._size-=o.size,e.size-=o.size,this._db.delete(r),o.entry!==i&&this._notifyRemove(r,o.entry,kg.ALL)),s>this._maxSize)return void this._notifyRemove(r,i,kg.ALL);if(i===void 0)return void console.warn("Refusing to cache undefined entry ");if(!s||s<0)return void console.warn("Refusing to cache entry with invalid size "+s);const a=1+Math.max(n,UN)-UN;this._db.set(r,{entry:i,size:s,lifetime:a,lives:a}),this._size+=s,e.size+=s,this._checkSizeLimits()}updateSize(e,r,i,s){r=e.id+r;const n=this._db.get(r);if(n&&n.entry===i){for(this._size-=n.size,e.size-=n.size;s>this._maxSize;){const o=this._notifyRemove(r,i,kg.SOME);if(!(o!=null&&o>0))return void this._db.delete(r);s=o}n.size=s,this._size+=s,e.size+=s,this._checkSizeLimits()}}pop(e,r){r=e.id+r;const i=this._db.get(r);if(i)return this._size-=i.size,e.size-=i.size,this._db.delete(r),++this._hit,i.entry;++this._miss}get(e,r){r=e.id+r;const i=this._db.get(r);if(i!==void 0)return this._db.delete(r),i.lives=i.lifetime,this._db.set(r,i),++this._hit,i.entry;++this._miss}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},r={},i=new Array;this._db.forEach((o,a)=>{const l=o.lifetime;i[l]=(i[l]||0)+o.size,this._users.forAll(c=>{const{id:h,name:d}=c;if(a.startsWith(h)){const f=r[d]||0;r[d]=f+o.size}})});const s={};this._users.forAll(o=>{const a=o.name;if("hitRate"in o&&typeof o.hitRate=="number"&&!isNaN(o.hitRate)&&o.hitRate>0){const l=r[a]||0;r[a]=l,s[a]=Math.round(100*o.hitRate)+"%"}else s[a]="0%"});const n=Object.keys(r);n.sort((o,a)=>r[a]-r[o]),n.forEach(o=>e[o]=Math.round(r[o]/2**20)+"MB / "+s[o]);for(let o=i.length-1;o>=0;--o){const a=i[o];a&&(e["Priority "+(o+UN-1)]=Math.round(a/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll(e=>e.resetHitRate())}clear(e){const r=e.id;this._db.forEach((i,s)=>{s.startsWith(r)&&(this._size-=i.size,this._db.delete(s),this._notifyRemove(s,i.entry,kg.ALL))}),e.size=0}clearAll(){this._db.forEach((e,r)=>this._notifyRemove(r,e.entry,kg.ALL)),this._users.forEach(e=>e.size=0),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,r,i){let s;return this._removeFuncs.some(n=>{if(e.startsWith(n[0])){const o=n[1](r,i);return typeof o=="number"&&(s=o),!0}return!1}),s}_checkSizeLimits(){if(this._size>this._maxSize){for(const[e,r]of this._db)if(this._purgeItem(e,r),this._size<=.9*this.maxSize)return}this._users.forEach(e=>{if(e.maxSize>0&&e.size>e.maxSize){for(const[r,i]of this._db)if(r.startsWith(e.id)&&(this._purgeItem(r,i,e),e.size<=.9*e.maxSize))return}})}_purgeItem(e,r,i=this._users.find(s=>e.startsWith(s.id))){if(this._db.delete(e),r.lives<=1){this._size-=r.size,i&&(i.size-=r.size);const s=this._notifyRemove(e,r.entry,kg.SOME);s!=null&&s>0&&(this._size+=s,i&&(i.size+=s),r.lives=r.lifetime,r.size=s,this._db.set(e,r))}else--r.lives,this._db.set(e,r)}},kot=0;const zot=UN+1;let Vot=class{constructor(e,r,i){this._rctx=e,this._locations=r,this._layout=i,this._cache=e.newCache("VaoCache",Bot)}dispose(){this._cache.destroy()}newVao(e){const r=e.toString(),i=this._cache.pop(r);if(i!=null){const n=i.pop();return i.length>0&&this._cache.put(r,i,e*i.length,zot),n}const s=new Np(this._rctx,this._locations,{geometry:this._layout},{geometry:kr.createVertex(this._rctx,Cr.STATIC_DRAW)});return s.vertexBuffers.geometry.setSize(e),s}deleteVao(e){if(e==null)return null;const r=e.byteSize,i=r.toString(),s=this._cache.pop(i);return s!=null?(s.push(e),this._cache.put(i,s,r*s.length,-1)):this._cache.put(i,[e],r,-1),null}};function Bot(t,e){if(e===kg.ALL)return void t.forEach(s=>s.dispose());const r=t.pop(),i=t.length*r.byteSize;return r.dispose(),i}let C3e=class{constructor(e,r,i){this._rctx=e,this._materialRepository=r,this.material=i,this._dataByOrigin=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new g3e(this.material,this._materialRepository),this._bufferWriter=i.createBufferWriter(),this._vaoCache=new Vot(e,i.vertexAttributeLocations,Gc(this._bufferWriter.vertexBufferLayout))}dispose(){this._glMaterials.destroy(),this._dataByOrigin.forEach(e=>e.dispose()),this._dataByOrigin.clear(),this._vaoCache.dispose()}get isEmpty(){return this._dataByOrigin.size===0}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this.material instanceof T3e}get rendersOccluded(){return!this.isEmpty&&this.material.renderOccluded!==Ni.Occlude}get numGeometries(){let e=0;return this._dataByOrigin.forEach(r=>e+=r.buffers.reduce((i,s)=>i+s.instances.size,0)),e}forEachGeometry(e){this._dataByOrigin.forEach(r=>r.buffers.forEach(i=>i.instances.forEach(s=>e(s.geometry))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){const r=this._bufferWriter,i=r.vertexBufferLayout.stride/4;for(const s of e){const n=s.renderGeometry,o=this._dataByOrigin.get(n.localOrigin.id),a=o?.findBuffer(n.id);if(a==null)return;const l=a.instances.get(n.id);if(s.updateType&(An.GEOMETRY|An.TRANSFORMATION)){const c=K$(r.elementCount(l.geometry.geometry)*i),h=r.vertexBufferLayout.createView(c.buffer);this._writeGeometry(n,h,0),a.vao.vertexBuffers.geometry.setSubData(c,l.from*i,0,l.numElements*i),eL()}s.updateType&(An.HIGHLIGHT|An.OCCLUDEE|An.VISIBILITY)&&(a.drawCommandsDirty=!0)}}_computeDeltas(e,r){const i=new DC;for(const s of e){const n=s.localOrigin;if(n==null)continue;let o=i.get(n.id,null);o==null&&(o=new gle(n.vec3),i.set(n.id,null,o)),o.changes.push(s)}for(const s of r){const n=s.localOrigin;if(n==null)continue;const o=this._dataByOrigin.get(n.id),a=o?.findBuffer(s.id);if(a==null)continue;let l=i.get(n.id,a);l==null&&(l=new gle(n.vec3),i.set(n.id,a,l)),l.changes.push(s)}return i}_addAndRemoveGeometries(e,r){const{_bufferWriter:i,_dataByOrigin:s}=this,n=i.vertexBufferLayout.stride/4,o=this._computeDeltas(e,r);o.forEach((a,l)=>{const c=a.get(null),h=c!=null?c.changes:[];o.delete(l,null);let d=s.get(l);if(a.forEach((f,m)=>{if(o.delete(l,m),m==null)return void ot(!1,"No VAO for removed geometries");if(m.instances.size===f.changes.length)return this._vaoCache.deleteVao(m.vao),JR(d.buffers,m),void(d.buffers.length===0&&h.length===0&&s.delete(l));const g=m.numElements,_=m.vao.byteSize/4,v=h.reduce((S,E)=>S+i.elementCount(E.geometry),0),b=f.changes.reduce((S,E)=>S+i.elementCount(E.geometry),0),T=Math.min((g+v-b)*n,Q$),x=T>_;T>SF&&T<_/2?(f.changes.forEach(({id:S})=>m.deleteInstance(S)),m.instances.forEach(({geometry:S})=>h.push(S)),this._vaoCache.deleteVao(m.vao),JR(d.buffers,m)):x?this._applyAndRebuild(m,h,f):this._applyRemoves(m,f)}),h.length>0)for(d==null&&(d=new Fot(c.origin),s.set(l,d)),d.buffers.forEach(f=>this._applyAdds(f,h));h.length>0;)d.buffers.push(this._applyAndRebuild(new Lot,h,null))})}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(e=>{e.buffers.forEach(r=>{r.drawCommandsDirty&&(r.hasHiddenInstances=!1,r.hasHighlights=!1,r.hasOccludees=!1,Bo(r.instances,i=>(r.updateDrawState(i),r.hasHiddenInstances&&r.hasHighlights&&r.hasOccludees)),r.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)),this._hasHighlights=this._hasHighlights||r.hasHighlights,this._hasOccludees=this._hasOccludees||r.hasOccludees})})}_applyAndRebuild(e,r,i){if(i!=null)for(const g of i.changes)e.deleteInstance(g.id);const s=this._bufferWriter,n=s.vertexBufferLayout.stride,o=n/4,a=Math.floor(Q$/o);let l=e.numElements;for(;r.length>0;){const g=r.pop(),_=s.elementCount(g.geometry);if(l+_>a&&l>0){r.push(g);break}l+=_;const v=new fle(g,0,0);ot(e.instances.get(g.id)==null),e.addInstance(g.id,v)}const c=l*o,h=K$(c),d=s.vertexBufferLayout.createView(h.buffer);let f=0;e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,e.instances.forEach((g,_)=>{this._writeGeometry(g.geometry,d,f);const v=f;f+=s.elementCount(g.geometry.geometry),e.updateInstance(_,v,f),e.updateDrawState(g)}),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(vle(c)),e.vao.vertexBuffers.geometry.setSubData(h,0,0,f*o),eL(),e.holes.clear();const m=e.holes.pushNew();return m.from=f,m.to=Math.floor(e.vao.byteSize/n),e.updateDrawCommands(n),e}_applyRemoves(e,r){if(r.changes.length===0)return;for(const a of r.changes){const l=a.id,c=e.instances.get(l);if(!c)continue;e.deleteInstance(l);const h=Jp.back();if(h){if(h.to===c.from){h.to=c.to;continue}if(h.from===c.to){h.from=c.from;continue}}const d=Jp.pushNew();d.from=c.from,d.to=c.to}ple(Jp);const i=this._bufferWriter.vertexBufferLayout.stride/4,s=Jp.reduce((a,l)=>Math.max(a,l.numElements),0)*i,n=K$(s);n.fill(0,0,s);const o=e.vao.vertexBuffers.geometry;Jp.forAll(a=>o.setSubData(n,a.from*i,0,a.numElements*i)),eL(),e.holes.pushArray(Jp.data,Jp.length),Jp.forAll((a,l)=>Jp.data[l]=null),Jp.clear(),e.drawCommandsDirty=!0}_applyAdds(e,r){if(r.length===0)return;if(!Dot(e))return void this._applyAndRebuild(e,r,null);const i=this._bufferWriter,s=i.vertexBufferLayout.stride/4,n=e.numElements,o=r.reduce((b,T)=>b+i.elementCount(T.geometry),0),a=Math.min((n+o)*s,Q$),l=4*a;if(e.vao.byteSize<vle(Q$-SF)&&l>e.vao.byteSize)return void this._applyAndRebuild(e,r,null);ple(e.holes);const c=new Array;for(const b of r){const T=i.elementCount(b.geometry),x=Got(e.holes,T);c.push(x)}const h=e.vao.vertexBuffers.geometry;let d=0,f=0,m=0;const g=K$(a),_=i.vertexBufferLayout.createView(g.buffer);r.forEach((b,T)=>{const x=c[T];if(x==null)return;if(m!==x){const A=m-f;A>0&&h.setSubData(g,f*s,0,A*s),f=x,d=0}const S=i.elementCount(b.geometry);this._writeGeometry(b,_,d),d+=S,m=x+S;const E=new fle(b,x,x+S);ot(e.instances.get(b.id)==null),e.addInstance(b.id,E),e.drawCommandsDirty=!0});const v=m-f;v>0&&h.setSubData(g,f*s,0,v*s),IDe(r,(b,T)=>c[T]==null),eL()}_writeGeometry(e,r,i){const s=e.localOrigin.vec3;uqe(yle,-s[0],-s[1],-s[2]);const n=ai(jot,yle,e.transformation);$n(Z$,n),kc(Z$,Z$),this._bufferWriter.write(n,Z$,e.geometry,r,i)}updateAnimation(e){return this.material.update(e)}requiresSlot(e,r){return this.material.requiresSlot(e,r)}prepareTechnique(e){const{output:r,bindParameters:i}=e;if(!this.requiresSlot(i.slot,r))return null;const s=r===F.Highlight||r===F.ShadowHighlight;if(s&&!this._hasHighlights)return null;const n=r===F.ShadowExcludeHighlight,o=!(s||n);for(const a of this._dataByOrigin.values())for(const l of a.buffers){if(s&&!l.hasHighlights)continue;const c=(s?l.drawCommandsHighlight:n&&l.needsMultipleCommands()?l.drawCommandsShadowHighlightRest:l.drawCommandsDefault)||null,h=o&&l.drawCommandsOccludees||null;if(c?.length||h?.length){const d=this._glMaterials.load(e.rctx,i.slot,r),f=d!=null?d.beginSlot(i):null;if(f!=null)return f}}return null}render(e,r){const{output:i,bindParameters:s}=e,n=i===F.Highlight||i===F.ShadowHighlight,o=i===F.ShadowExcludeHighlight,a=!(n||o),l=this._rctx;l.appleAmdDriverHelper?.resetIndicesType(),l.bindTechnique(r,this.material.parameters,s);for(const c of this._dataByOrigin.values())for(const h of c.buffers){if(n&&!h.hasHighlights)continue;const d=(n?h.drawCommandsHighlight:o&&h.needsMultipleCommands()?h.drawCommandsShadowHighlightRest:h.drawCommandsDefault)||null,f=a&&h.drawCommandsOccludees||null;(d?.length||f?.length)&&(r.program.bindDraw(new Aq(c.origin),s,this.material.parameters),r.ensureAttributeLocations(h.vao),l.bindVAO(h.vao),d?.length&&(r.bindPipelineState(l,s.slot,!1),d.forAll(m=>l.drawArrays(r.primitiveType,m.first,m.count))),f?.length&&(r.bindPipelineState(l,s.slot,!0),f.forAll(m=>l.drawArrays(r.primitiveType,m.first,m.count))))}}get test(){return{material:this.material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}},gle=class{constructor(e){this.origin=e,this.changes=new Array}};function Got(t,e){let r;if(!t.some(s=>!(s.numElements<e)&&(r=s,!0)))return null;const i=r.from;return r.from+=e,r.from>=r.to&&t.removeUnordered(r),i}const yle=xe(),jot=xe(),Z$=xe(),Jp=new Vt({allocator:t=>t||new UK,deallocator:null}),SF=65536,J$=4*SF,_le=1024,A3e=16777216,Q$=A3e/4;let kN=new Float32Array(SF);function K$(t){return kN.length<t&&(kN=new Float32Array(t)),kN}function vle(t){const e=4*t;return e<=_le?_le:e<J$?J$:Math.max(Math.min(Math.ceil(1.5*e/J$)*J$,A3e),e)}function eL(){kN=new Float32Array(2)}let ou=class extends Te{constructor(e){super(e),this._pending=new Hot,this._changes=new Cq,this._materialRenderers=new Map,this._sortedMaterialRenderers=new Vt,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear(),this._pending.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return Bo(this._materialRenderers,e=>e.rendersOccluded)}get isEmpty(){return!this.updating&&this._materialRenderers.size===0&&this._geometries.size===0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=m3e(this._changes);let r=!1,i=!1,s=!1;return e.forEach((n,o)=>{let a=this._materialRenderers.get(o);if(!a&&n.adds.length>0&&(a=new C3e(this.rctx,this._materialRepository,o),this._materialRenderers.set(o,a),r=!0,i=!0,s=!0),!a)return;const l=i||a.hasHighlights,c=s||a.hasWater;a.modify(n),i=i||l!==a.hasHighlights,s=s||c!==a.hasWater,a.isEmpty&&(this._materialRenderers.delete(o),a.dispose(),r=!0)}),this._changes.clear(),r&&this._updateSortedMaterialRenderers(),i&&(this._hasHighlights=Bo(this._materialRenderers,n=>n.hasHighlights)),s&&(this._hasWater=Bo(this._materialRenderers,n=>n.hasWater)),this.notifyChange("updating"),!0}addGeometries(e,r){if(e.length===0)return;const i=this._validateRenderGeometries(e);for(const n of i)this._geometries.set(n.id,n);const s=this._pending.empty;for(const n of i)this._pending.adds.add(n);s&&this.notifyChange("updating"),r===Yi.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,r){const i=this._pending.empty,s=this._pending.adds;for(const n of e)s.has(n)?(this._pending.removed.add(n),s.delete(n)):this._pending.removed.has(n)||this._pending.removes.add(n),this._geometries.delete(n.id);i&&!this._pending.empty&&this.notifyChange("updating"),r===Yi.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,r){const i=this._changes.updates.length===0;for(const s of e){const n=this._changes.updates.pushNew();n.renderGeometry=this._validateRenderGeometry(s),n.updateType=r}switch(i&&this._changes.updates.length>0&&this.notifyChange("updating"),r){case An.TRANSFORMATION:case An.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case An.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let r=!1;return this._sortedMaterialRenderers.forAll(i=>r=i.updateAnimation(e)||r),r}render(e){this._sortedMaterialRenderers.forAll(r=>{if(r.material.shouldRender(e)){const i=r.prepareTechnique(e);i!=null&&r.render(e,i)}})}intersect(e,r,i,s,n){return this._geometries.forEach(o=>{if(s&&!s(o))return;this._intersectRenderGeometry(o,i,r,0,e,n);const a=this.rendererContext.longitudeCyclical;a&&(o.boundingSphere[0]-o.boundingSphere[3]<a.min&&this._intersectRenderGeometry(o,i,r,a.range,e,n),o.boundingSphere[0]+o.boundingSphere[3]>a.max&&this._intersectRenderGeometry(o,i,r,-a.range,e,n)),n++}),n}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach((r,i)=>{i.insertOrder=e++,this._sortedMaterialRenderers.push(r)}),this._sortedMaterialRenderers.sort((r,i)=>{const s=i.material.renderPriority-r.material.renderPriority;return s!==0?s:r.material.insertOrder-i.material.insertOrder})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const r=this._changes.updates.data[e];this._pending.has(r.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,r,i,s,n,o){if(!e.visible)return;let a=0;s+=e.transformation[12],a=e.transformation[13],Mz[0]=i[0]-s,Mz[1]=i[1]-a,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,n,Mz,(l,c,h)=>{qot(r,h,e.material.renderPriority,o,n,e.layerUid,e.graphicUid)},r)}_notifyGraphicGeometryChanged(e){if(this.drapeSource.notifyGraphicGeometryChanged==null)return;let r;for(const i of e){const s=i.graphicUid;s!=null&&s!==r&&(this.drapeSource.notifyGraphicGeometryChanged(s),r=s)}}_notifyGraphicVisibilityChanged(e){if(this.drapeSource.notifyGraphicVisibilityChanged==null)return;let r;for(const i of e){const s=i.graphicUid;s!=null&&s!==r&&(this.drapeSource.notifyGraphicVisibilityChanged(s),r=s)}}_validateRenderGeometries(e){for(const r of e)this._validateRenderGeometry(r);return e}_validateRenderGeometry(e){return e.localOrigin==null&&(e.localOrigin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};u([p()],ou.prototype,"drapeSource",void 0),u([p()],ou.prototype,"updating",null),u([p()],ou.prototype,"rctx",null),u([p()],ou.prototype,"rendererContext",void 0),u([p()],ou.prototype,"_materialRepository",null),u([p()],ou.prototype,"_localOriginFactory",null),u([p({readOnly:!0})],ou.prototype,"isEmpty",null),u([p()],ou.prototype,"_materialRenderers",void 0),u([p()],ou.prototype,"_geometries",void 0),ou=u([P("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],ou);let Hot=class{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}};function qot(t,e,r,i,s,n,o){const a=new hot(n,o,e),l=c=>{c.set(ji.OVERLAY,a,t.dist,t.normal,t.transformation,r,i)};if((s.results.min.drapedLayerOrder==null||r>=s.results.min.drapedLayerOrder)&&(s.results.min.dist==null||s.results.ground.dist<=s.results.min.dist)&&l(s.results.min),s.options.store!==So.MIN&&(s.results.max.drapedLayerOrder==null||r<s.results.max.drapedLayerOrder)&&(s.results.max.dist==null||s.results.ground.dist>s.results.max.dist)&&l(s.results.max),s.options.store===So.ALL){const c=EQ(s.ray);l(c),s.results.all.push(c)}}const Mz=He();let kK=class extends ps{constructor(e,r){super(e,"vec2",ti.Draw,(i,s,n,o)=>i.setUniform2fv(e,r(s,n,o)))}};const Pz=4;function Wot(){const t=new Sr,e=t.fragment;t.include(id);const r=(Pz+1)/2,i=1/(2*r*r);return e.include(Nu),e.uniforms.add(new rt("depthMap",s=>s.depthTexture),new zh("tex",s=>s.colorTexture),new kK("blurSize",s=>s.blurSize),new Ie("projScale",(s,n)=>{const o=mi(n.camera.eye,n.camera.center);return o>5e4?Math.max(0,s.projScale-(o-5e4)):s.projScale}),new Ar("nearFar",(s,n)=>n.camera.nearFar)),e.code.add(w`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv, nearFar);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${w.float(i)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),e.code.add(w`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${w.int(Pz)}; r <= ${w.int(Pz)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      fragColor = vec4(b / w_total);
    }
  `),t}const Xot=Object.freeze(Object.defineProperty({__proto__:null,build:Wot},Symbol.toStringTag,{value:"Module"}));let O3e=class R3e extends Lr{initializeProgram(e){return new Rr(e.rctx,R3e.shader.get().build(),Tr)}initializePipeline(){return Mt({colorWrite:Bt})}};O3e.shader=new Or(Xot,()=>he(()=>import("./SSAOBlur.glsl-26bb5fef.js"),[],import.meta.url));const Yot="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";function R9(t){t.fragment.uniforms.add(new sr("projInfo",(e,r)=>Zot(r))),t.fragment.uniforms.add(new Ar("zScale",(e,r)=>M3e(r))),t.fragment.code.add(w`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function Zot(t){const e=t.camera.projectionMatrix;return e[11]===0?Ti(ble,2/(t.camera.fullWidth*e[0]),2/(t.camera.fullHeight*e[5]),(1+e[12])/e[0],(1+e[13])/e[5]):Ti(ble,-2/(t.camera.fullWidth*e[0]),-2/(t.camera.fullHeight*e[5]),(1-e[8])/e[0],(1-e[9])/e[5])}const ble=Wt();function M3e(t){return t.camera.projectionMatrix[11]===0?or(wle,0,1):or(wle,1,0)}const wle=He(),xle=16;function Jot(){const t=new Sr,e=t.fragment;return t.include(id),e.include(Nu),t.include(R9),e.uniforms.add(new Ie("radius",(r,i)=>zK(i.camera))),e.code.add(w`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn - bias, 0.0);
}`),e.code.add(w`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),e.uniforms.add(new Ar("nearFar",(r,i)=>i.camera.nearFar),new rt("normalMap",r=>r.normalTexture),new rt("depthMap",r=>r.depthTexture),new Ar("zScale",(r,i)=>M3e(i)),new Ie("projScale",r=>r.projScale),new rt("rnm",r=>r.noiseTexture),new Ar("rnmScale",(r,i)=>or(Tle,i.camera.fullWidth/r.noiseTexture.descriptor.width,i.camera.fullHeight/r.noiseTexture.descriptor.height)),new Ie("intensity",r=>r.intensity),new Ar("screenSize",(r,i)=>or(Tle,i.camera.fullWidth,i.camera.fullHeight))),e.code.add(w`
    void main(void) {
      fillSphere();
      vec3 fres = normalize(2.0 * texture(rnm, uv * rnmScale).xyz - 1.0);
      float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

      if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
        fragColor = vec4(0);
        return;
      }

      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

      // get the normal of current fragment
      vec4 norm4 = texture(normalMap, uv);
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
      bool isTerrain = norm4.w < 0.5;

      float sum = 0.0;
      vec3 tapPixelPos;

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${w.int(xle)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        //don't use current or very nearby samples
        if( abs(offset.x) < 2.0 || abs(offset.y) < 2.0){
          continue;
        }

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

        if (isTerrain) {
          if (texture(normalMap, tcTap).w < 0.5) {
            continue;
          }
        }

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${w.int(xle)}), 0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4) / 2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
      fragColor = vec4(A);
    }
  `),t}function zK(t){return Math.max(10,20*t.computeScreenPixelSizeAtDist(Math.abs(4*t.relativeElevation)))}const Tle=He(),Qot=Object.freeze(Object.defineProperty({__proto__:null,build:Jot,getRadius:zK},Symbol.toStringTag,{value:"Module"}));let P3e=class I3e extends Lr{initializeProgram(e){return new Rr(e.rctx,I3e.shader.get().build(),Tr)}initializePipeline(){return Mt({colorWrite:Bt})}};P3e.shader=new Or(Qot,()=>he(()=>import("./SSAO.glsl-594e2b28.js"),[],import.meta.url));let Kot=class extends ii{constructor(){super(...arguments),this.projScale=1}},eat=class extends Kot{constructor(){super(...arguments),this.intensity=1}},tat=class extends ii{},rat=class extends tat{constructor(){super(...arguments),this.blurSize=He()}};const yO=2;let $3e=class{constructor(e,r,i,s){this._view=e,this._techniqueRepository=r,this._rctx=i,this._requestRender=s,this._quadVAO=null,this._passParameters=new eat,this._drawParameters=new rat}dispose(){this.enabled=!1,this._quadVAO=je(this._quadVAO)}destroy(){this.dispose()}disposeOffscreenBuffers(){this._ssaoFBO?.resize(0,0),this._blurFBO?.resize(0,0)}set enabled(e){e?this._enable():this._disable()}get enabled(){return this._enableTime!=null}get active(){return this.enabled&&this._ssaoTechnique.compiled&&this._blurTechnique.compiled}get colorTexture(){return this._ssaoFBO?.colorTexture}render(e,r,i,s){if(this._enableTime==null||i==null||s==null||this._ssaoFBO==null||this._blurFBO==null)return;if(!this.active)return this._enableTime=r,void this._requestRender();this._enableTime===0&&(this._enableTime=r);const n=this._rctx,o=e.camera,a=this._view.qualitySettings.fadeDuration,l=a>0?Math.min(a,r-this._enableTime)/a:1;this._passParameters.normalTexture=s,this._passParameters.depthTexture=i,this._passParameters.projScale=1/o.computeRenderPixelSizeAtDist(1),this._passParameters.intensity=4*iat/zK(o)**6*l;const c=o.fullViewport,h=c[2],d=c[3],f=h/yO,m=d/yO;this._ssaoFBO.resize(h,d),this._blurFBO.resize(f,m),this._quadVAO==null&&(this._quadVAO=Hl(this._rctx)),n.bindFramebuffer(this._ssaoFBO),n.setViewport(0,0,h,d),n.bindTechnique(this._ssaoTechnique,this._passParameters,e).bindDraw(this._drawParameters,e,this._passParameters),n.bindVAO(this._quadVAO);const g=Go(this._quadVAO,"geometry");n.drawArrays(At.TRIANGLE_STRIP,0,g);const _=n.bindTechnique(this._blurTechnique,this._passParameters,e);n.setViewport(0,0,f,m),n.bindFramebuffer(this._blurFBO),this._drawParameters.colorTexture=this._ssaoFBO.colorTexture,or(this._drawParameters.blurSize,0,yO/d),_.bindDraw(this._drawParameters,e,this._passParameters),n.setViewport(0,0,f,m),n.drawArrays(At.TRIANGLE_STRIP,0,g),n.bindFramebuffer(this._ssaoFBO),n.setViewport(0,0,h,d),n.setClearColor(1,1,1,0),n.clear(Si.COLOR_BUFFER_BIT),n.setViewport(0,0,f,m),this._drawParameters.colorTexture=this._blurFBO.colorTexture,or(this._drawParameters.blurSize,yO/h,0),_.bindDraw(this._drawParameters,e,this._passParameters),n.drawArrays(At.TRIANGLE_STRIP,0,g),n.setViewport(c[0],c[1],c[2],c[3]),l<1&&this._requestRender()}_enable(){if(this._enableTime!=null)return;const e=new xr;e.wrapMode=Dt.CLAMP_TO_EDGE,this._ssaoFBO=new fn(this._rctx,e),this._blurFBO=new fn(this._rctx,e);const r=Uint8Array.from(atob(Yot),i=>i.charCodeAt(0));e.pixelFormat=Ct.RGB,e.wrapMode=Dt.REPEAT,e.hasMipmap=!0,e.width=32,e.height=32,this._passParameters.noiseTexture=new Ot(this._rctx,e,r),this._ssaoTechnique==null&&(this._ssaoTechnique=this._techniqueRepository.acquire(P3e)),this._blurTechnique==null&&(this._blurTechnique=this._techniqueRepository.acquire(O3e)),this._enableTime=0,this._requestRender()}_disable(){this._enableTime=null,this._passParameters.noiseTexture=je(this._passParameters.noiseTexture),this._blurFBO=je(this._blurFBO),this._ssaoFBO=je(this._ssaoFBO)}get gpuMemoryUsage(){return(this._blurFBO?.gpuMemoryUsage??0)+(this._ssaoFBO?.gpuMemoryUsage??0)}};const iat=.5;let VK=class L3e extends Lr{initializeProgram(e){return new Rr(e.rctx,L3e.shader.get().build(),Tr)}initializePipeline(){return this.configuration.hasAlpha?Mt({blending:Oo(Se.SRC_ALPHA,Se.ONE,Se.ONE_MINUS_SRC_ALPHA,Se.ONE_MINUS_SRC_ALPHA),colorWrite:Bt}):Mt({colorWrite:Bt})}};VK.shader=new Or(wnt,()=>he(()=>import("./TextureOnly.glsl-7c03b14e.js"),[],import.meta.url));let BK=class extends Sa{constructor(){super(...arguments),this.hasAlpha=!1}};u([B()],BK.prototype,"hasAlpha",void 0);let xf=class extends Te{get _bindParameters(){return this._renderContext.bindParameters}get _rctx(){return this.view._stage.renderView.renderingContext}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._handles=new $i,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new Vt,this._passParameters=new HCe,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this._camera=new yt,this.worldToPCSRatio=1,this.events=new Ts,this.longitudeCyclical=null}initialize(){const e=this.view._stage.renderView,{waterTextureRepository:r,stippleTextureRepository:i,markerTextureRepository:s}=e;this._shaderTechniqueRepository=new qCe({rctx:this._rctx,viewingMode:Ve.Local,stippleTextureRepository:i,markerTextureRepository:s,waterTextureRepository:r}),this._renderContext=new p3e(this._rctx,new LK(this._rctx,this.view.state.viewingMode),new $3e(this.view,this._shaderTechniqueRepository,this._rctx,()=>{})),this._handles.add([le(()=>r.updating,()=>this.events.emit("content-changed"),Ls),le(()=>this.spatialReference,n=>this._localOriginFactory=new IK(n),Ls),_a(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materialRepository=new WCe(e.textureRepository,this._shaderTechniqueRepository,n=>{(n.renderOccluded&EF)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")},()=>this.events.emit("content-changed")),this._bindParameters.slot=pe.DRAPED_MATERIAL,this._bindParameters.highlightDepthTexture=zxe(this._rctx),this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=dt.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new lQ(Pe(1,1,1))]),this._handles.add(this.view.resourceController.scheduler.registerTask(vt.STAGE,this))}destroy(){this._handles.destroy(),this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._debugTextureTechnique=Gi(this._debugTextureTechnique),this._passParameters.texture=je(this._passParameters.texture),this._bindParameters.highlightDepthTexture=je(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=Ne(this._shaderTechniqueRepository),this._temporaryFBO=je(this._temporaryFBO),this._quadVAO=je(this._quadVAO),this.disposeOverlays()}get updating(){return this._sortedDrapeSourceRenderersDirty||Bo(this._renderers,e=>e.updating)}get hasOverlays(){return this._overlays!=null&&this._overlayRenderTarget!=null}get gpuMemoryUsage(){return this._overlayRenderTarget!=null?this._overlayRenderTarget.gpuMemoryUsage:0}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,ou)}createDrapeSourceRenderer(e,r,i){const s=this._renderers.get(e);s?.destroy();const n=new r({...i,rendererContext:this,drapeSource:e});return this._renderers.set(e,n),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(le(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),n}removeDrapeSourceRenderer(e){if(e==null)return;const r=this._renderers.get(e);r!=null&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this._handles.remove(e),r.destroy())}collectUnusedRenderTargetMemory(){let e=!1;const r=YDe();if(this._overlayRenderTarget!=null)for(const i of this._overlayRenderTarget.renderTargets){const s=this.overlays[Di.INNER].validTargets[i.type];e=this._overlayRenderTarget.validateUsageForTarget(s,i,r)||e}return e}get overlays(){return this._overlays??[]}ensureDrapeTargets(e){this._overlays!=null&&this._overlays.forEach(r=>r.hasTargetWithoutRasterImage=MD(e,i=>i.drapeTargetType===Tq.WithoutRasterImage))}ensureDrapeSources(e){this._overlays!=null&&this._overlays.forEach(r=>{r.hasDrapedFeatureSource=MD(e,i=>i.drapeSourceType===$R.Features),r.hasDrapedRasterSource=MD(e,i=>i.drapeSourceType===$R.RasterImage)})}ensureOverlays(e,r){this._overlays==null&&(this._overlayRenderTarget=new _nt(this._rctx),this._overlays=[new rae(Di.INNER,this._overlayRenderTarget),new rae(Di.OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(r)}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=je(this._overlayRenderTarget),this.events.emit("textures-disposed")}get running(){return this.updating}runTask(e){this._processDrapeSources(e,()=>!0)}_processDrapeSources(e,r){let i=!1;for(const[s,n]of this._renderers){if(e.done)break;(s.destroyed||r(s))&&n.commitChanges()&&(i=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,i=!0,this._updateSortedDrapeSourceRenderers()),i&&(this._overlays!=null&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(rl,e=>e.updatePolicy===tv.SYNC)}get isEmpty(){return!li.OVERLAY_DRAW_DEBUG_TEXTURE&&!Bo(this._renderers,e=>!e.isEmpty)}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateAnimation(e){let r=!1;return this._renderers.forEach(i=>r=i.updateAnimation(e)||r),r}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawTarget(e,r,i){const s=e.canvasGeometries;if(s.numViews===0)return!1;const{alignPixelEnabled:n,contentPixelRatio:o}=i;this._screenToWorldRatio=o*e.mapUnitsPerPixel/ZQ;const a=r.output;if(this.isEmpty||a===F.Highlight&&!this.hasHighlights||a===F.Normal&&!this.hasWater||!e.hasSomeSizedView())return!1;const l=r.fbo;if(!l.isValid())return!1;const c=2*e.resolution,h=e.resolution;l.resize(c,h);const d=this._rctx;if(this._camera.pixelRatio=e.pixelRatio*o,this._renderContext.output=a,this._bindParameters.alignPixelEnabled=n,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=a===F.Normal?pe.DRAPED_WATER:pe.DRAPED_MATERIAL,e.applyViewport(this._rctx),l.bind(d),e.index===Di.INNER&&(d.setClearColor(0,0,0,0),d.clearSafe(Si.COLOR_BUFFER_BIT)),r.type===as.Occluded&&(this._renderContext.renderOccludedMask=EF),li.OVERLAY_DRAW_DEBUG_TEXTURE&&r.type!==as.Occluded)for(let f=0;f<s.numViews;f++)this._setViewParameters(s.extents[f],e),this._drawDebugTexture(e.resolution,nat[e.index]);return this._renderers.size>0&&this._sortedRenderers.forAll(({drapeSource:f,renderer:m})=>{if(r.type===as.ColorNoRasterImage&&f.drapeSourceType===$R.RasterImage)return;const{fullOpacity:g}=f,_=g!=null&&g<1&&a===F.Color;_&&(this.bindTemporaryFramebuffer(this._rctx,c,h),d.clearSafe(Si.COLOR_BUFFER_BIT));for(let v=0;v<s.numViews;v++)this._setViewParameters(s.extents[v],e),m.render(this._renderContext);_&&this._temporaryFBO!=null&&(l.bind(d),this.view._stage.renderView.compositingHelper.compositeOverlay(this._renderContext.bindParameters,this._temporaryFBO.getTexture(),g,e.index))}),d.bindFramebuffer(null),l.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,r,i){this._temporaryFBO==null&&(this._temporaryFBO=new jCe(e,!1)),this._temporaryFBO.resize(r,i),this._temporaryFBO.bind(e)}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,r,i,s){let n=0;for(const o of this._renderers.values())n=o.intersect?.(e,r,i,s,n)??n}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const e=this.view.map.allLayers;this._renderers.forEach((r,i)=>{const s=e.indexOf(i.layer),n=s>=0,o=this._renderers.size*(i.renderGroup??(n?bF.MapLayer:bF.ViewLayer))+(n?s:0);this._sortedRenderers.push(new sat(i,r,o))}),this._sortedRenderers.sort((r,i)=>r.index-i.index)}_setViewParameters(e,r){const i=this._camera;i.viewport=[0,0,r.resolution,r.resolution],D1e(i.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],i.near,i.far),CP(i.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=Bo(this._renderers,r=>r.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_updateHasHighlights(){const e=Bo(this._renderers,r=>r.hasHighlights);e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}_updateRendersOccluded(){const e=Bo(this._renderers,r=>r.rendersOccluded);e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}_drawDebugTexture(e,r){this._ensureDebugPatternResources(e,r);const i=this._rctx;i.bindTechnique(this._debugTextureTechnique,this._passParameters,null),i.bindVAO(this._quadVAO),i.drawArrays(At.TRIANGLE_STRIP,0,Go(this._quadVAO,"geometry"))}_ensureDebugPatternResources(e,r){if(ne(this._passParameters.color,r[0],r[1],r[2]),this._passParameters.texture)return;const i=new Uint8Array(e*e*4);let s=0;for(let a=0;a<e;a++)for(let l=0;l<e;l++){const c=Math.floor(l/10),h=Math.floor(a/10);c<2||h<2||10*c>e-20||10*h>e-20?(i[s++]=255,i[s++]=255,i[s++]=255,i[s++]=255):(i[s++]=255,i[s++]=255,i[s++]=255,i[s++]=1&c&&1&h?1&l^1&a?0:255:1&c^1&h?0:128)}const n=new xr(e);n.samplingMode=Rt.NEAREST,this._passParameters.texture=new Ot(this._rctx,n,i);const o=new BK;o.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(VK,o),this._quadVAO=Hl(this._rctx)}get test(){return{drapedRenderers:Array.from(this._renderers.values()),getDrapeSourceRenderer:e=>this._renderers.get(e)}}};u([p()],xf.prototype,"_sortedDrapeSourceRenderersDirty",void 0),u([p({autoDestroy:!0})],xf.prototype,"_shaderTechniqueRepository",void 0),u([p({constructOnly:!0})],xf.prototype,"view",void 0),u([p()],xf.prototype,"worldToPCSRatio",void 0),u([p()],xf.prototype,"spatialReference",void 0),u([p({type:Boolean,readOnly:!0})],xf.prototype,"updating",null),u([p()],xf.prototype,"isEmpty",null),xf=u([P("esri.views.3d.terrain.OverlayRenderer")],xf);let sat=class{constructor(e,r,i){this.drapeSource=e,this.renderer=r,this.index=i}};const nat=[[1,.5,.5],[.5,.5,1]],GK=-2,EF=Ni.OccludeAndTransparent;function jK(t,e,r,i){const s=XP(t.rings,!!t.hasZ,xm.CCW_IS_HOLE),n=Xo(s.position.length),o=qEe(s.position,t.spatialReference,0,n,0,s.position,0,s.position.length/3,e,r,i),a=o!=null;return new lat(s.position,n,F3e(s.polygons,s.position,n),N3e(s.outlines,s.position,n),a,o)}function D3e(t,e){const r=XP(t.rings,!1,xm.CCW_IS_HOLE),i=ci(r.position,t.spatialReference,0,r.position,e,0,r.position.length/3);for(let s=2;s<r.position.length;s+=3)r.position[s]=GK;return{position:r.position,polygons:F3e(r.polygons,r.position),outlines:N3e(r.outlines,r.position),projectionSuccess:i}}function N3e(t,e,r=null){return t.filter(({count:i})=>i>1).map(({index:i,count:s})=>{const n=3*i,o=3*s;return r!=null?new U3e(i,s,Vh(e,n,o),Vh(r,n,o)):new HK(i,s,Vh(e,n,o))})}function F3e(t,e,r=null){const i=new Array;for(const{index:s,count:n,holeIndices:o,pathLengths:a}of t){if(n<=1)continue;const l=3*s,c=3*n,h=o.map(f=>f-s),d=r!=null?new oat(s,n,Vh(e,3*s,3*n),Vh(r,l,c),h,a):new aat(s,n,Vh(e,3*s,3*n),h,a);i.push(d)}return i}let HK=class{constructor(e,r,i){this.index=e,this.count=r,this.position=i}},U3e=class extends HK{constructor(e,r,i,s){super(e,r,i),this.mapPositions=s}},oat=class extends U3e{constructor(e,r,i,s,n,o){super(e,r,i,s),this.holeIndices=n,this.pathLengths=o}},aat=class extends HK{constructor(e,r,i,s,n){super(e,r,i),this.holeIndices=s,this.pathLengths=n}},lat=class{constructor(e,r,i,s,n,o){this.position=e,this.mapPositions=r,this.polygons=i,this.outlines=s,this.projectionSuccess=n,this.sampledElevation=o}};function ix(t,e,r,i,s,n=2){const o=1/(Math.abs(r)+Math.abs(i)+Math.abs(s)),a=r*o,l=i*o,c=s<=0?(a>=0?1:-1)*(1-Math.abs(l)):a,h=s<=0?(l>=0?1:-1)*(1-Math.abs(a)):l,d=e*n;t[d]=Sle(c),t[d+1]=Sle(h)}function cat(t){const e=t.length/3,r=new Int16Array(2*e);let i=0;for(let s=0;s<e;++s)ix(r,s,t[i++],t[i++],t[i++]);return r}function uat(t,e,r,i=2){const s=r*i,n=Ele(e[s]),o=Ele(e[s+1]),a=1-Math.abs(n)-Math.abs(o);t[2]=a,a<0?(t[0]=(n>=0?1:-1)*(1-Math.abs(o)),t[1]=(o>=0?1:-1)*(1-Math.abs(n))):(t[0]=n,t[1]=o),_e(t,t)}function Sle(t){return ve(Math.round(32767*t),-32767,32767)}function Ele(t){return ve(t/32767,-1,1)}function k3e(t,e){const r=t.fragment;switch(r.code.add(w`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),e.doubleSidedMode){case ts.None:r.code.add(w`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case ts.View:r.code.add(w`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case ts.WindingOrder:r.code.add(w`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:e.doubleSidedMode;case ts.COUNT:}}var ts;(function(t){t[t.None=0]="None",t[t.View=1]="View",t[t.WindingOrder=2]="WindingOrder",t[t.COUNT=3]="COUNT"})(ts||(ts={}));function z3e({normalTexture:t,metallicRoughnessTexture:e,metallicFactor:r,roughnessFactor:i,emissiveTexture:s,emissiveFactor:n,occlusionTexture:o}){return t==null&&e==null&&s==null&&(n==null||ma(n,sl))&&o==null&&(i==null||i===1)&&(r==null||r===1||r===0)}const M9=[1,1,.5],qK=[0,.6,.2],hat=[0,1,.2];function V3e(t){t.vertex.code.add(w`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}let dat=class extends Sa{constructor(){super(...arguments),this.instancedDoublePrecision=!1}};function B3e(t,e){e.instanced&&e.instancedDoublePrecision&&(t.attributes.add(C.MODELORIGINHI,"vec3"),t.attributes.add(C.MODELORIGINLO,"vec3"),t.attributes.add(C.MODEL,"mat3"),t.attributes.add(C.MODELNORMAL,"mat3"));const r=t.vertex;e.instancedDoublePrecision&&(r.include(H5,e),r.uniforms.add(new Ou("viewOriginHi",(i,s)=>VXe(ne(tL,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),tL)),new Ou("viewOriginLo",(i,s)=>BXe(ne(tL,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),tL)))),r.code.add(w`
    vec3 calculateVPos() {
      ${e.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `),r.code.add(w`
    vec3 subtractOrigin(vec3 _pos) {
      ${e.instancedDoublePrecision?w`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),r.code.add(w`
    vec3 dpNormal(vec4 _normal) {
      ${e.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `),e.output===F.Normal&&(jE(r),r.code.add(w`
    vec3 dpNormalView(vec4 _normal) {
      ${e.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `)),e.hasVertexTangents&&r.code.add(w`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${e.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `)}u([B()],dat.prototype,"instancedDoublePrecision",void 0);const tL=O();var Hs;function G3e(t){switch(t){case"multiply":default:return Hs.Multiply;case"ignore":return Hs.Ignore;case"replace":return Hs.Replace;case"tint":return Hs.Tint}}function j3e(t,e,r){if(t==null||e===Hs.Ignore)return r[0]=255,r[1]=255,r[2]=255,void(r[3]=255);const i=ve(Math.round(t[3]*CF),0,CF),s=i===0||e===Hs.Tint?0:e===Hs.Replace?pat:fat;r[0]=ve(Math.round(t[0]*vT),0,vT),r[1]=ve(Math.round(t[1]*vT),0,vT),r[2]=ve(Math.round(t[2]*vT),0,vT),r[3]=i+s}(function(t){t[t.Multiply=1]="Multiply",t[t.Ignore=2]="Ignore",t[t.Replace=3]="Replace",t[t.Tint=4]="Tint"})(Hs||(Hs={}));const vT=255,CF=85,pat=CF,fat=2*CF;function H3e(t){t.vertex.code.add(w`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${w.int(Hs.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${w.int(Hs.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${w.int(Hs.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${w.int(Hs.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}function q3e(t,e){e.hasSymbolColors?(t.include(H3e),t.attributes.add(C.SYMBOLCOLOR,"vec4"),t.varyings.add("colorMixMode","mediump float"),t.vertex.code.add(w`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(t.fragment.uniforms.add(new ZP("colorMixMode",r=>FSe[r.colorMixMode])),t.vertex.code.add(w`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function Ux(t,e){e.hasVertexColors?(t.attributes.add(C.COLOR,"vec4"),t.varyings.add("vColor","vec4"),t.vertex.code.add(w`void forwardVertexColor() { vColor = color; }`),t.vertex.code.add(w`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):t.vertex.code.add(w`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function mat(t){t.fragment.code.add(w`
    #define discardOrAdjustAlpha(color) { if (color.a < ${w.float(bo)}) { discard; } }
  `)}let Tw=class extends ps{constructor(e,r){super(e,"float",ti.Draw,(i,s,n)=>i.setUniform1f(e,r(s,n)))}};function Sw(t,e){W3e(t,e,new Ie("textureAlphaCutoff",r=>r.textureAlphaCutoff))}function gat(t,e){W3e(t,e,new Tw("textureAlphaCutoff",r=>r.textureAlphaCutoff))}function W3e(t,e,r){const i=t.fragment;switch(e.alphaDiscardMode!==Kr.Mask&&e.alphaDiscardMode!==Kr.MaskBlend||i.uniforms.add(r),e.alphaDiscardMode){case Kr.Blend:return t.include(mat);case Kr.Opaque:i.code.add(w`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case Kr.Mask:i.code.add(w`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case Kr.MaskBlend:t.fragment.code.add(w`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function X3e(t,e){const{vertex:r,fragment:i}=t,s=e.hasModelTransformation;if(s){const o=ki();r.uniforms.add(new Ui("model",a=>a.modelTransformation??pn)),r.uniforms.add(new sd("normalTransform",a=>(gv(o,a.modelTransformation??pn),o)))}const n=e.hasColorTexture&&e.alphaDiscardMode!==Kr.Opaque;switch(e.output){case F.Depth:case F.Shadow:case F.ShadowHighlight:case F.ShadowExcludeHighlight:case F.ObjectAndLayerIdColor:Dc(r,e),t.include(Nl,e),t.include(sm,e),t.include(r0,e),t.include(C0,e),t.include(vs,e),t.include(BP,e),Yw(t),t.varyings.add("depth","float"),n&&i.uniforms.add(new rt("tex",o=>o.texture)),r.code.add(w`
          void main(void) {
            vpos = calculateVPos();
            ${s?"vpos = (model * vec4(vpos, 1.0)).xyz;":""}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
            forwardTextureCoordinates();
            forwardObjectAndLayerIdColor();
          }
        `),t.include(Sw,e),i.code.add(w`
          void main(void) {
            discardBySlice(vpos);
            ${n?w`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?w`colorUV`:w`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${e.output===F.ObjectAndLayerIdColor?w`outputObjectAndLayerIdColor();`:w`outputDepth(depth);`}
          }
        `);break;case F.Normal:{Dc(r,e),t.include(Nl,e),t.include(YP,e),t.include(A9,e),t.include(sm,e),t.include(r0,e),n&&i.uniforms.add(new rt("tex",a=>a.texture)),e.normalType===Ir.ScreenDerivative&&t.varyings.add("vPositionView","vec3");const o=e.normalType===Ir.Attribute||e.normalType===Ir.Compressed;r.code.add(w`
          void main(void) {
            vpos = calculateVPos();
            ${s?"vpos = (model * vec4(vpos, 1.0)).xyz;":""}

            ${o?w`vNormalWorld = ${s?"normalize(normalTransform * dpNormal(vvLocalNormal(normalModel())))":"dpNormalView(vvLocalNormal(normalModel()))"};`:w`
                  // Get vertex position in camera space for screen-space derivative normals
                  vPositionView = (view * vec4(vpos, 1.0)).xyz;
                `}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            forwardTextureCoordinates();
          }
        `),t.include(vs,e),t.include(Sw,e),i.code.add(w`
          void main() {
            discardBySlice(vpos);
            ${n?w`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?w`colorUV`:w`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${e.normalType===Ir.ScreenDerivative?w`vec3 normal = screenDerivativeNormal(vPositionView);`:w`
                  vec3 normal = normalize(vNormalWorld);
                  if (gl_FrontFacing == false){
                    normal = -normal;
                  }`}
            fragColor = vec4(0.5 + 0.5 * normal, 1.0);
          }
        `);break}case F.Highlight:Dc(r,e),t.include(Nl,e),t.include(sm,e),t.include(r0,e),n&&i.uniforms.add(new rt("tex",o=>o.texture)),r.code.add(w`
          void main(void) {
            vpos = calculateVPos();
            ${s?"vpos = (model * vec4(vpos, 1.0)).xyz;":""}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            forwardTextureCoordinates();
          }
        `),t.include(vs,e),t.include(Sw,e),t.include(z0,e),i.code.add(w`
          void main() {
            discardBySlice(vpos);
            ${n?w`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?w`colorUV`:w`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}}function Y3e(t,e){const r=t.fragment;e.hasVertexTangents?(t.attributes.add(C.TANGENT,"vec4"),t.varyings.add("vTangent","vec4"),e.doubleSidedMode===ts.WindingOrder?r.code.add(w`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):r.code.add(w`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):r.code.add(w`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`),e.textureCoordinateType!==Fs.None&&(t.include(JJ,e),r.uniforms.add(e.pbrTextureBindType===ti.Pass?new rt("normalTexture",i=>i.textureNormal):new zh("normalTexture",i=>i.textureNormal)),r.code.add(w`vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
vec3 rawNormal = textureLookup(normalTexture, uv).rgb * 2.0 - 1.0;
return tangentSpace * rawNormal;
}`))}function JP(t,e){const r=t.fragment;e.receiveAmbientOcclusion?(r.uniforms.add(new rt("ssaoTex",(i,s)=>s.ssaoHelper.colorTexture)),r.constants.add("blurSizePixelsInverse","float",1/yO),r.code.add(w`float evaluateAmbientOcclusionInverse() {
vec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));
return texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).a;
}
float evaluateAmbientOcclusion() {
return 1.0 - evaluateAmbientOcclusionInverse();
}`)):r.code.add(w`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}function QP(t){t.constants.add("ambientBoostFactor","float",yTe)}function BC(t){t.uniforms.add(new Ie("lightingGlobalFactor",(e,r)=>r.lighting.globalFactor))}function sx(t,e){const r=t.fragment;switch(t.include(JP,e),e.pbrMode!==ut.Disabled&&t.include(FK,e),t.include(eQ,e),t.include(PP),r.code.add(w`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${e.pbrMode===ut.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),QP(r),BC(r),I0(r),r.code.add(w`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${e.spherical?w`normalize(vPosWorld)`:w`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),$m(r),r.code.add(w`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),e.pbrMode){case ut.Disabled:case ut.WaterOnIntegratedMesh:case ut.Water:t.include(F5),r.code.add(w`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case ut.Normal:case ut.Schematic:r.code.add(w`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),r.code.add(w`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),e.useFillLights?r.uniforms.add(new nm("hasFillLights",(i,s)=>s.enableFillLights)):r.constants.add("hasFillLights","bool",!1),r.code.add(w`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),r.uniforms.add(new Ie("lightingSpecularStrength",(i,s)=>s.lighting.mainLight.specularStrength),new Ie("lightingEnvironmentStrength",(i,s)=>s.lighting.mainLight.environmentStrength)),r.code.add(w`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),r.code.add(w`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${e.pbrMode===ut.Schematic?w`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:w`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case ut.Terrain:case ut.TerrainWithWater:t.include(F5),r.code.add(w`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluateTerrainLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:e.pbrMode;case ut.COUNT:}}function kl(){const t=new Float32Array(9);return t[0]=1,t[4]=1,t[8]=1,t}function Z3e(t){const e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function zN(t,e,r,i,s,n,o,a,l){const c=new Float32Array(9);return c[0]=t,c[1]=e,c[2]=r,c[3]=i,c[4]=s,c[5]=n,c[6]=o,c[7]=a,c[8]=l,c}function yat(t,e){return new Float32Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:Z3e,create:kl,createView:yat,fromValues:zN},Symbol.toStringTag,{value:"Module"}));function _at(t){t.vertex.uniforms.add(new sd("colorTextureTransformMatrix",e=>e.colorTextureTransformMatrix!=null?e.colorTextureTransformMatrix:kl())),t.varyings.add("colorUV","vec2"),t.vertex.code.add(w`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function vat(t){t.vertex.uniforms.add(new sd("normalTextureTransformMatrix",e=>e.normalTextureTransformMatrix!=null?e.normalTextureTransformMatrix:kl())),t.varyings.add("normalUV","vec2"),t.vertex.code.add(w`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function bat(t){t.vertex.uniforms.add(new sd("emissiveTextureTransformMatrix",e=>e.emissiveTextureTransformMatrix!=null?e.emissiveTextureTransformMatrix:kl())),t.varyings.add("emissiveUV","vec2"),t.vertex.code.add(w`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function wat(t){t.vertex.uniforms.add(new sd("occlusionTextureTransformMatrix",e=>e.occlusionTextureTransformMatrix!=null?e.occlusionTextureTransformMatrix:kl())),t.varyings.add("occlusionUV","vec2"),t.vertex.code.add(w`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function xat(t){t.vertex.uniforms.add(new sd("metallicRoughnessTextureTransformMatrix",e=>e.metallicRoughnessTextureTransformMatrix!=null?e.metallicRoughnessTextureTransformMatrix:kl())),t.varyings.add("metallicRoughnessUV","vec2"),t.vertex.code.add(w`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function zM(t){t.include(Lm),t.code.add(w`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${w.int(Hs.Multiply)}) {
        return allMixed;
      }
      if (mode == ${w.int(Hs.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${w.int(Hs.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${w.int(Hs.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${w.int(Hs.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function Tat(t){const e=new Sr,{vertex:r,fragment:i,varyings:s}=e;if(Dc(r,t),e.include(IP),s.add("vpos","vec3"),e.include(r0,t),e.include(B3e,t),e.include(OSe,t),t.hasColorTextureTransform&&e.include(_at),t.output===F.Color||t.output===F.Alpha){t.hasNormalTextureTransform&&e.include(vat),t.hasEmissionTextureTransform&&e.include(bat),t.hasOcclusionTextureTransform&&e.include(wat),t.hasMetallicRoughnessTextureTransform&&e.include(xat),$p(r,t),e.include(YP,t),e.include(Nl,t);const n=t.normalType===Ir.Attribute||t.normalType===Ir.Compressed;n&&t.offsetBackfaces&&e.include(V3e),e.include(Y3e,t),e.include(A9,t),t.instancedColor&&e.attributes.add(C.INSTANCECOLOR,"vec4"),s.add("vPositionLocal","vec3"),e.include(sm,t),e.include($C,t),e.include(q3e,t),e.include(Ux,t),r.uniforms.add(new sr("externalColor",a=>a.externalColor)),s.add("vcolorExt","vec4"),t.hasMultipassTerrain&&s.add("depth","float");const o=t.hasModelTransformation;if(o){const a=ki();r.uniforms.add(new Ui("model",l=>l.modelTransformation??pn)),r.uniforms.add(new sd("normalTransform",l=>(gv(a,l.modelTransformation??pn),a)))}r.code.add(w`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${w.float(bo)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = calculateVPos();
          ${o?"vpos = (model * vec4(vpos, 1.0)).xyz;":""}
          vPositionLocal = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${n?w`vNormalWorld = ${o?"normalize(normalTransform * dpNormal(vvLocalNormal(normalModel())))":"dpNormal(vvLocalNormal(normalModel()))"};`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${t.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, vpos);
          ${n&&t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        ${t.hasColorTextureTransform?w`forwardColorUV();`:""}
        ${t.hasNormalTextureTransform?w`forwardNormalUV();`:""}
        ${t.hasEmissionTextureTransform?w`forwardEmissiveUV();`:""}
        ${t.hasOcclusionTextureTransform?w`forwardOcclusionUV();`:""}
        ${t.hasMetallicRoughnessTextureTransform?w`forwardMetallicRoughnessUV();`:""}
      }
    `)}switch(t.output){case F.Alpha:e.include(vs,t),e.include(Sw,t),e.include(Fu,t),i.uniforms.add(new Ie("opacity",n=>n.opacity),new Ie("layerOpacity",n=>n.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new rt("tex",n=>n.texture)),i.include(zM),i.code.add(w`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${t.hasColorTexture?w`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?w`colorUV`:w`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:w`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?w`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:w`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        fragColor = vec4(opacity_);
      }
    `);break;case F.Color:e.include(vs,t),e.include(sx,t),e.include(JP,t),e.include(Sw,t),e.include(t.instancedDoublePrecision?O9:rx,t),e.include(Fu,t),$p(i,t),i.uniforms.add(r.uniforms.get("localOrigin"),new kt("ambient",n=>n.ambient),new kt("diffuse",n=>n.diffuse),new Ie("opacity",n=>n.opacity),new Ie("layerOpacity",n=>n.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new rt("tex",n=>n.texture)),e.include(KJ,t),e.include(FK,t),i.include(zM),e.include(k3e,t),QP(i),BC(i),$m(i),i.code.add(w`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${t.hasColorTexture?w`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?w`colorUV`:w`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:w`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${t.normalType===Ir.ScreenDerivative?w`
                vec3 normal = screenDerivativeNormal(vPositionLocal);`:w`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${t.pbrMode===ut.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${t.receiveShadows?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?w`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:w`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.hasNormalTexture?w`
                mat3 tangentSpace = ${t.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, ${t.hasNormalTextureTransform?w`normalUV`:"vuv0"});`:w`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${t.spherical?w`normalize(posWorld);`:w`vec3(0.0, 0.0, 1.0);`}

        ${t.snowCover?w`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${t.pbrMode===ut.Normal||t.pbrMode===ut.Schematic?w`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?w`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:w`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===dt.Color?w`fragColor = premultiplyAlpha(fragColor);`:""}
      }
    `)}return e.include(X3e,t),e}const Sat=Object.freeze(Object.defineProperty({__proto__:null,build:Tat},Symbol.toStringTag,{value:"Module"}));let Eat=class extends y3e{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=Qa(M9),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=gi.Back,this.isInstanced=!1,this.hasInstancedColor=!1,this.emissiveFactor=Pe(0,0,0),this.instancedDoublePrecision=!1,this.normalType=Ir.Attribute,this.receiveSSAO=!0,this.receiveShadows=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=Pe(.2,.2,.2),this.diffuse=Pe(.8,.8,.8),this.externalColor=Nt(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=O(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.modelTransformation=null,this.transparent=!1,this.writeDepth=!0,this.customDepthTest=qw.Less,this.textureAlphaMode=Kr.Blend,this.textureAlphaCutoff=gF,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=Ni.Occlude}},Cat=class extends _3e{constructor(){super(...arguments),this.origin=O(),this.slicePlaneLocalOrigin=this.origin}},WK=class J3e extends Lr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Ve.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result,r.textureCoordinateType=r.hasColorTexture||r.hasMetallicRoughnessTexture||r.hasEmissionTexture||r.hasOcclusionTexture||r.hasNormalTexture?Fs.Default:Fs.None,r.objectAndLayerIdColorInstanced=r.instanced}initializeProgram(e){return this._initializeProgram(e,J3e.shader)}_initializeProgram(e,r){return new Rr(e.rctx,r.get().build(this.configuration),Tr)}_convertDepthTestFunction(e){return e===qw.Lequal?ri.LEQUAL:ri.LESS}_makePipeline(e,r){const i=this.configuration,s=e===dt.NONE,n=e===dt.FrontFace;return Mt({blending:i.output!==F.Color&&i.output!==F.Alpha||!i.transparent?null:s?Ru:V0(e),culling:Aat(i)?U8(i.cullFace):null,depthTest:{func:Uv(e,this._convertDepthTestFunction(i.customDepthTest))},depthWrite:(s||n)&&i.writeDepth?jl:null,colorWrite:Bt,stencilWrite:i.hasOccludees?Tm:null,stencilTest:i.hasOccludees?r?Cv:kv:null,polygonOffset:s||n?null:m9(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0),this._makePipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};function Aat(t){return t.cullFace!==gi.None||!t.hasSlicePlane&&!t.transparent&&!t.doubleSidedMode}WK.shader=new Or(Sat,()=>he(()=>import("./DefaultMaterial.glsl-578c60d4.js"),[],import.meta.url));let Gt=class extends jo{constructor(){super(...arguments),this.output=F.Color,this.alphaDiscardMode=Kr.Opaque,this.doubleSidedMode=ts.None,this.pbrMode=ut.Disabled,this.cullFace=gi.None,this.transparencyPassType=dt.NONE,this.normalType=Ir.Attribute,this.textureCoordinateType=Fs.None,this.customDepthTest=qw.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.objectAndLayerIdColorInstanced=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1}};u([B({count:F.COUNT})],Gt.prototype,"output",void 0),u([B({count:Kr.COUNT})],Gt.prototype,"alphaDiscardMode",void 0),u([B({count:ts.COUNT})],Gt.prototype,"doubleSidedMode",void 0),u([B({count:ut.COUNT})],Gt.prototype,"pbrMode",void 0),u([B({count:gi.COUNT})],Gt.prototype,"cullFace",void 0),u([B({count:dt.COUNT})],Gt.prototype,"transparencyPassType",void 0),u([B({count:Ir.COUNT})],Gt.prototype,"normalType",void 0),u([B({count:Fs.COUNT})],Gt.prototype,"textureCoordinateType",void 0),u([B({count:qw.COUNT})],Gt.prototype,"customDepthTest",void 0),u([B()],Gt.prototype,"spherical",void 0),u([B()],Gt.prototype,"hasVertexColors",void 0),u([B()],Gt.prototype,"hasSymbolColors",void 0),u([B()],Gt.prototype,"hasVerticalOffset",void 0),u([B()],Gt.prototype,"hasSlicePlane",void 0),u([B()],Gt.prototype,"hasSliceHighlight",void 0),u([B()],Gt.prototype,"hasColorTexture",void 0),u([B()],Gt.prototype,"hasMetallicRoughnessTexture",void 0),u([B()],Gt.prototype,"hasEmissionTexture",void 0),u([B()],Gt.prototype,"hasOcclusionTexture",void 0),u([B()],Gt.prototype,"hasNormalTexture",void 0),u([B()],Gt.prototype,"hasScreenSizePerspective",void 0),u([B()],Gt.prototype,"hasVertexTangents",void 0),u([B()],Gt.prototype,"hasOccludees",void 0),u([B()],Gt.prototype,"hasMultipassTerrain",void 0),u([B()],Gt.prototype,"hasModelTransformation",void 0),u([B()],Gt.prototype,"offsetBackfaces",void 0),u([B()],Gt.prototype,"vvSize",void 0),u([B()],Gt.prototype,"vvColor",void 0),u([B()],Gt.prototype,"receiveShadows",void 0),u([B()],Gt.prototype,"receiveAmbientOcclusion",void 0),u([B()],Gt.prototype,"textureAlphaPremultiplied",void 0),u([B()],Gt.prototype,"instanced",void 0),u([B()],Gt.prototype,"instancedColor",void 0),u([B()],Gt.prototype,"objectAndLayerIdColorInstanced",void 0),u([B()],Gt.prototype,"instancedDoublePrecision",void 0),u([B()],Gt.prototype,"doublePrecisionRequiresObfuscation",void 0),u([B()],Gt.prototype,"writeDepth",void 0),u([B()],Gt.prototype,"transparent",void 0),u([B()],Gt.prototype,"enableOffset",void 0),u([B()],Gt.prototype,"cullAboveGround",void 0),u([B()],Gt.prototype,"snowCover",void 0),u([B()],Gt.prototype,"hasColorTextureTransform",void 0),u([B()],Gt.prototype,"hasEmissionTextureTransform",void 0),u([B()],Gt.prototype,"hasNormalTextureTransform",void 0),u([B()],Gt.prototype,"hasOcclusionTextureTransform",void 0),u([B()],Gt.prototype,"hasMetallicRoughnessTextureTransform",void 0),u([B({constValue:!0})],Gt.prototype,"hasVvInstancing",void 0),u([B({constValue:!1})],Gt.prototype,"useCustomDTRExponentForWater",void 0),u([B({constValue:!1})],Gt.prototype,"supportsTextureAtlas",void 0),u([B({constValue:!0})],Gt.prototype,"useFillLights",void 0);function Oat(t){const e=new Sr,{vertex:r,fragment:i,varyings:s}=e;return Dc(r,t),e.include(IP),s.add("vpos","vec3"),e.include(r0,t),e.include(B3e,t),e.include(OSe,t),t.output!==F.Color&&t.output!==F.Alpha||($p(e.vertex,t),e.include(YP,t),e.include(Nl,t),t.offsetBackfaces&&e.include(V3e),t.instancedColor&&e.attributes.add(C.INSTANCECOLOR,"vec4"),s.add("vNormalWorld","vec3"),s.add("localvpos","vec3"),t.hasMultipassTerrain&&s.add("depth","float"),e.include(sm,t),e.include($C,t),e.include(q3e,t),e.include(Ux,t),r.uniforms.add(new sr("externalColor",n=>n.externalColor)),s.add("vcolorExt","vec4"),r.code.add(w`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${w.float(bo)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${t.hasMultipassTerrain?w`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),t.output===F.Alpha&&(e.include(vs,t),e.include(Sw,t),e.include(Fu,t),i.uniforms.add(new Ie("opacity",n=>n.opacity),new Ie("layerOpacity",n=>n.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new rt("tex",n=>n.texture)),i.include(zM),i.code.add(w`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?w`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${t.hasColorTexture?w`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?w`colorUV`:w`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:w`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?w`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:w`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        fragColor = vec4(opacity_);
      }
    `)),t.output===F.Color&&(e.include(vs,t),e.include(sx,t),e.include(JP,t),e.include(Sw,t),e.include(t.instancedDoublePrecision?O9:rx,t),e.include(Fu,t),$p(e.fragment,t),I0(i),QP(i),BC(i),i.uniforms.add(r.uniforms.get("localOrigin"),r.uniforms.get("view"),new kt("ambient",n=>n.ambient),new kt("diffuse",n=>n.diffuse),new Ie("opacity",n=>n.opacity),new Ie("layerOpacity",n=>n.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new rt("tex",n=>n.texture)),e.include(KJ,t),e.include(FK,t),i.include(zM),$m(i),i.code.add(w`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?w`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${t.hasColorTexture?w`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?w`colorUV`:w`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:w`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${t.pbrMode===ut.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?w`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:w`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.snowCover?w`albedo = mix(albedo, vec3(1), 0.9);`:w``}
        ${w`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${t.pbrMode===ut.Normal||t.pbrMode===ut.Schematic?t.spherical?w`vec3 normalGround = normalize(vpos + localOrigin);`:w`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:w``}
        ${t.pbrMode===ut.Normal||t.pbrMode===ut.Schematic?w`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?w`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:w`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===dt.Color?w`fragColor = premultiplyAlpha(fragColor);`:w``}
      }
    `)),e.include(X3e,t),e}const Rat=Object.freeze(Object.defineProperty({__proto__:null,build:Oat},Symbol.toStringTag,{value:"Module"}));let Q3e=class K3e extends WK{initializeConfiguration(e,r){super.initializeConfiguration(e,r),r.hasMetallicRoughnessTexture=!1,r.hasEmissionTexture=!1,r.hasOcclusionTexture=!1,r.hasNormalTexture=!1,r.hasModelTransformation=!1,r.normalType=Ir.Attribute,r.doubleSidedMode=ts.WindingOrder,r.hasVertexTangents=!1}initializeProgram(e){return this._initializeProgram(e,K3e.shader)}};Q3e.shader=new Or(Rat,()=>he(()=>import("./RealisticTree.glsl-d5521d4d.js"),[],import.meta.url));let Sm=class extends Fv{constructor(e){super(e,Iat),this.supportsEdges=!0,this._configuration=new Gt,this._vertexBufferLayout=$at(this.parameters)}isVisibleForOutput(e){return e!==F.Shadow&&e!==F.ShadowExcludeHighlight&&e!==F.ShadowHighlight||this.parameters.castShadows}isVisible(){const e=this.parameters;if(!super.isVisible()||e.layerOpacity===0)return!1;const{hasInstancedColor:r,hasVertexColors:i,hasSymbolColors:s,vvColor:n}=e,o=e.colorMixMode==="replace",a=e.opacity>0,l=e.externalColor&&e.externalColor[3]>0,c=r||n||s;return i&&c?o||a:i?o?l:a:c?o||a:o?l:a}getConfiguration(e,r){return this._configuration.output=e,this._configuration.hasNormalTexture=!!this.parameters.normalTextureId,this._configuration.hasColorTexture=!!this.parameters.textureId,this._configuration.hasVertexTangents=this.parameters.hasVertexTangents,this._configuration.instanced=this.parameters.isInstanced,this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight,this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode,this._configuration.normalType=this.parameters.normalType,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this.parameters.customDepthTest!=null&&(this._configuration.customDepthTest=this.parameters.customDepthTest),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.cullFace=this.parameters.hasSlicePlane?gi.None:this.parameters.cullFace,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.hasModelTransformation=this.parameters.modelTransformation!=null,e!==F.Color&&e!==F.Alpha||(this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this._configuration.doubleSidedMode=ts.WindingOrder:this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?ts.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?ts.WindingOrder:ts.None,this._configuration.instancedColor=this.parameters.hasInstancedColor,this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=!!r.ssaoHelper.active&&this.parameters.receiveSSAO,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?ut.Schematic:ut.Normal:ut.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<p9,this._configuration.snowCover=this.hasSnowCover(r),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix),this._configuration}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}intersect(e,r,i,s,n,o){if(this.parameters.verticalOffset!=null){const a=i.camera;ne($z,r[12],r[13],r[14]);let l=null;switch(i.viewingMode){case Ve.Global:l=_e(Cle,$z);break;case Ve.Local:l=ie(Cle,Nat)}let c=0;const h=fe(Fat,$z,a.eye),d=Re(h),f=se(h,h,1/d);let m=null;this.parameters.screenSizePerspective&&(m=ye(l,f)),c+=DSe(a,d,this.parameters.verticalOffset,m??0,this.parameters.screenSizePerspective),se(l,l,c),Oc(Iz,l,i.transform.inverseRotation),s=fe(Lat,s,Iz),n=fe(Dat,n,Iz)}PSe(e,i,s,n,HH(i.verticalOffset),o)}requiresSlot(e,r){return r===F.Color||r===F.Alpha||r===F.Depth||r===F.Normal||r===F.Shadow||r===F.ShadowHighlight||r===F.ShadowExcludeHighlight||r===F.Highlight||r===F.ObjectAndLayerIdColor?e===(this.parameters.transparent?this.parameters.writeDepth?pe.TRANSPARENT_MATERIAL:pe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:pe.OPAQUE_MATERIAL)||e===pe.DRAPED_MATERIAL:!1}createGLMaterial(e){return new Mat(e)}createBufferWriter(){return new VC(this._vertexBufferLayout)}},Mat=class extends QJ{constructor(e){super({...e,...e.material.parameters})}_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:e.shadowMap.enabled})}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==F.Color&&this._output!==F.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e));const r=this._material.parameters;this.updateTexture(r.textureId);const i=e.camera.viewInverseTransposeMatrix;return ne(r.origin,i[3],i[7],i[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(r.treeRendering?Q3e:WK,e)}},Pat=class extends Eat{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}};const Iat=new Pat;function $at(t){const e=qi().vec3f(C.POSITION);return t.normalType===Ir.Compressed?e.vec2i16(C.NORMALCOMPRESSED,{glNormalized:!0}):e.vec3f(C.NORMAL),t.hasVertexTangents&&e.vec4f(C.TANGENT),(t.textureId||t.normalTextureId||t.metallicRoughnessTextureId||t.emissiveTextureId||t.occlusionTextureId)&&e.vec2f(C.UV0),t.hasVertexColors&&e.vec4u8(C.COLOR),t.hasSymbolColors&&e.vec4u8(C.SYMBOLCOLOR),ae("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(C.OBJECTANDLAYERIDCOLOR),e}const Lat=O(),Dat=O(),Nat=Pe(0,0,1),Cle=O(),Iz=O(),$z=O(),Fat=O(),Uat=["polygon","extent"];let kat=class extends Nm{constructor(e,r,i,s){super(e,r,i,s),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const a=v9(this._getSymbolSize());if(a)throw new U("graphics3dextrudesymbollayer:invalid-size",a)}const e=this.symbolLayer?.material?.color,r=this._getCombinedOpacityAndColor(e),i=Qa(r),s=r[3],n=s<1||this.needsDrivenTransparentPass,o={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:i,ambient:i,opacity:s,transparent:n,cullFace:n?gi.None:gi.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0,normalType:Ir.Compressed};this._material=new Sm(o),this._bottomMaterial=new Sm({...o,cullFace:gi.Back}),this._context.stage.add(this._material),this._context.stage.add(this._bottomMaterial)}destroy(){super.destroy(),this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,Uat,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(e.renderingInfo,255),s=this.setGraphicElevationContext(r,new Up);return this._createAs3DShape(r,e.renderingInfo,i,s,r.uid)}layerOpacityChanged(e,r){const i=this.symbolLayer?.material?.color,s=this._getCombinedOpacity(i),n=s<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:s,transparent:n}),this._bottomMaterial.setParameters({opacity:s,transparent:n});const o=this._getLayerOpacity();e.forEach(a=>{const l=r(a);l?.layerOpacityChanged(o,this._context.isAsync)})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,Tv)}slicePlaneEnabledChanged(e,r){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._bottomMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),e.forEach(i=>{const s=r(i);s?.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}_getExtrusionSize(e){let r;return r=e.size&&this._drivenProperties.size?hnt(e.size,2)??0:this._getSymbolSize(),r/=this._context.renderCoordsHelper.unitInMeters,r}applyRendererDiff(e,r){return this._drivenPropertiesChanged(r)?Us.RecreateSymbol:Us.RecreateGraphics}async queryForSnapping(e,r,i,s){const n=this._getExtrusionSize(i)*this._context.renderCoordsHelper.unitInMeters/oM(r),{objectId:o,target:a}=e,l=ee(a);switch(l.z=(l.z??0)+n,e.type){case"edge":{const{start:c,end:h}=e,d=ee(c),f=ee(h);return d.z=(d.z??0)+n,f.z=(f.z??0)+n,[Gae(o,l,1/0,d,f)]}case"vertex":return[Jst(o,l,1/0),Gae(o,a,1/0,a,l)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(e,r,i,s,n){const o=UM(e.geometry);if(o==null)return null;if(o.rings.length===0||!o.rings.some(M=>M.length>0))return this._logGeometryValidationWarnings(o.rings,"rings","ExtrudeSymbol3DLayer"),null;const a=jK(o,this._context.elevationProvider,this._context.renderCoordsHelper,s);this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer");const l=pK(o);if(l==null)return null;const c=new Array,h=new Array,d=gn(),f=xe(),m=O(),g=this._context.renderCoordsHelper.viewingMode===Ve.Global;g||this._context.renderCoordsHelper.worldUpAtPosition(null,m),Fl(o.spatialReference,[l.x,l.y,0],f,this._context.renderCoordsHelper.spatialReference);const _=xe();$n(_,f);const v=ki();gv(v,_);const{polygons:b,mapPositions:T,position:x}=a;for(const M of b){const D=M.count;if(this._context.clippingExtent&&(Ei(d),Tu(d,M.mapPositions),!dp(d,this._context.clippingExtent)))continue;const k=JE(M.mapPositions,M.holeIndices,3);if(k.length===0)continue;const L=k.length,N=6*D,q=X5(N+L),X=X5(L),G=Xo(3*N),J=Xo(3*N),I=Xo(3*N),z=Xo(N);zat(x,T,k,M,G,I,J,z,q,X,this._getExtrusionSize(r),m,g),QE(G,G,_);const V=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:this._context.layer.uid}),j=new Hat(G,I,cat(J),z);c.push(Ale(this._material,q,q.length-X.length,j,i,V),Ale(this._bottomMaterial,X,0,j,i,V)),h.push(j.heights)}if(c.length===0)return null;const S=new B0({geometries:c,layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0});S.transformation=f;const E=oCe(this.symbolLayer,{opacity:this._getLayerOpacity()}),A=E!=null?{baseMaterial:this._material,edgeMaterials:[E],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,R=new Dm(this,S,c,null,null,(M,D,k,L,N)=>Gat(M,D,k,L,N,h),s,A);return R.alignedSampledElevation=a.sampledElevation,R.needsElevationUpdates=Tv(s.mode),R}};function Ale(t,e,r,i,s,n){const o=LC(e.length),a=[[C.POSITION,new We(i.positions,3,!0)],[C.NORMALCOMPRESSED,new We(i.normals,2,!0)],[C.COLOR,new We(s,4,!0)]],l=[[C.POSITION,e],[C.NORMALCOMPRESSED,e],[C.COLOR,o]];return new Ks(t,a,l,i.elevation,us.Mesh,n,r)}function zat(t,e,r,i,s,n,o,a,l,c,h,d,f){const m=r.length/3;let g=0,_=2*i.count;Vat(t,e,i.index,i.count,r,0,m,s,n,o,a,l,c,_,h,d,f);let v=2*i.count;_=0,Ole(s,n,a,o,g,i.pathLengths[0],i.count,v,l,_,h),v+=4*i.pathLengths[0],_+=2*i.pathLengths[0],g+=i.pathLengths[0];for(let b=1;b<i.pathLengths.length;++b)Ole(s,n,a,o,g,i.pathLengths[b],i.count,v,l,_,h),v+=4*i.pathLengths[b],_+=2*i.pathLengths[b],g+=i.pathLengths[b]}function Vat(t,e,r,i,s,n,o,a,l,c,h,d,f,m,g,_,v){ie(yl,_);const b=g>0?1:-1;let T=3*r,x=0,S=3*x,E=i,A=3*E;for(let D=0;D<i;++D)v&&(yl[0]=t[T],yl[1]=t[T+1],yl[2]=t[T+2],_e(yl,yl)),a[S]=t[T],a[S+1]=t[T+1],a[S+2]=t[T+2],l[S]=e[T],l[S+1]=e[T+1],l[S+2]=e[T+2],c[S]=-b*yl[0],c[S+1]=-b*yl[1],c[S+2]=-b*yl[2],h[x]=0,a[A]=t[T]+g*yl[0],a[A+1]=t[T+1]+g*yl[1],a[A+2]=t[T+2]+g*yl[2],l[A]=e[T],l[A+1]=e[T+1],l[A+2]=e[T+2],c[A]=b*yl[0],c[A+1]=b*yl[1],c[A+2]=b*yl[2],h[E]=g,S+=3,A+=3,T+=3,x+=1,E+=1;T=3*n,S=0,A=3*m;const R=g<0?Lle:$le,M=g<0?$le:Lle;for(let D=0;D<o;++D)f[S]=s[T+R[0]],f[S+1]=s[T+R[1]],f[S+2]=s[T+R[2]],d[A]=s[T+M[0]]+i,d[A+1]=s[T+M[1]]+i,d[A+2]=s[T+M[2]]+i,S+=3,A+=3,T+=3}function rL(t,e,r,i,s,n,o){i[n]=i[o],o*=3,t[n*=3]=t[o],t[n+1]=t[o+1],t[n+2]=t[o+2],e[n]=e[o],e[n+1]=e[o+1],e[n+2]=e[o+2],r[n]=s[0],r[n+1]=s[1],r[n+2]=s[2]}const I3=O();function Ole(t,e,r,i,s,n,o,a,l,c,h){let d=s,f=s+1,m=s+o,g=s+o+1,_=a,v=a+1,b=a+2*n,T=a+2*n+1;h<0&&(d=s+o+1,g=s),c*=3;for(let x=0;x<n;++x)x===n-1&&(h>0?(f=s,g=s+o):(f=s,d=s+o)),Bat(t,d,f,m,I3),rL(t,e,i,r,I3,_,d),rL(t,e,i,r,I3,v,f),rL(t,e,i,r,I3,b,m),rL(t,e,i,r,I3,T,g),l[c++]=_,l[c++]=b,l[c++]=T,l[c++]=_,l[c++]=T,l[c++]=v,d++,f++,m++,g++,_+=2,v+=2,b+=2,T+=2}const Lz=O(),Rle=O(),Mle=O(),Ple=O(),Ile=O();function Bat(t,e,r,i,s){e*=3,r*=3,i*=3,ne(Lz,t[e++],t[e++],t[e++]),ne(Rle,t[r++],t[r++],t[r++]),ne(Mle,t[i++],t[i++],t[i++]),fe(Ple,Rle,Lz),fe(Ile,Mle,Lz),pt(s,Ile,Ple),_e(s,s)}const bT=O();function Gat(t,e,r,i,s,n){const o=t.stageObject,a=o.geometries,l=a.length,c=e.mode!=="absolute-height";let h=0;const d=o.transformation,f=OC(xe(),d);for(let m=0;m<l;m+=2){const g=a[m];if(!mK(g))continue;const _=g.getMutableAttribute(C.POSITION).data,v=n[m/2],b=new BQ(g.mapPositions),T=_.length/3;let x=0,S=!1,E=0;for(let A=0;A<T;A++){bT[0]=_[x],bT[1]=_[x+1],bT[2]=_[x+2],i(b,iL),c&&(E+=iL.sampledElevation),li.TESTS_DISABLE_OPTIMIZATIONS?(ne(Jl,b.array[b.offset],b.array[b.offset+1],iL.z+v[x/3]),r!=null&&s.toRenderCoords(Jl,r,Jl),ze(Jl,Jl,f)):(ne(Jl,_[x],_[x+1],_[x+2]),ze(Jl,Jl,d),s.setAltitude(Jl,iL.z+v[x/3]),ze(Jl,Jl,f)),_[x]=Jl[0],_[x+1]=Jl[1],_[x+2]=Jl[2];const R=jat/s.unitInMeters;(Math.abs(bT[0]-_[x])>=R||Math.abs(bT[1]-_[x+1])>=R||Math.abs(bT[2]-_[x+2])>=R)&&(S=!0),b.offset+=3,x+=3}S&&(g.invalidateBoundingInfo(),o.geometryVertexAttrsUpdated(a[m]),a[m+1].invalidateBoundingInfo(),o.geometryVertexAttrsUpdated(a[m+1])),h+=E/T}return h/l}const Jl=O(),yl=O(),iL=new qP,$le=[0,2,1],Lle=[0,1,2],jat=.01;let Hat=class{constructor(e,r,i,s){this.positions=e,this.elevation=r,this.normals=i,this.heights=s}};function P9(){const t=new Float32Array(16);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function qat(t){const e=new Float32Array(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Wat(t,e,r,i,s,n,o,a,l,c,h,d,f,m,g,_){const v=new Float32Array(16);return v[0]=t,v[1]=e,v[2]=r,v[3]=i,v[4]=s,v[5]=n,v[6]=o,v[7]=a,v[8]=l,v[9]=c,v[10]=h,v[11]=d,v[12]=f,v[13]=m,v[14]=g,v[15]=_,v}function Xat(t,e){return new Float32Array(t,e,16)}const Yat=P9();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:Yat,clone:qat,create:P9,createView:Xat,fromValues:Wat},Symbol.toStringTag,{value:"Module"}));const Zat=(t,e)=>{const r=Pm(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1);return kc(r,r)},Jat=(t,e)=>{const r=Pm(t,e,0,0,.5-.5*e,0,e,0,.5-.5*e,0,0,e,.5-.5*e,0,0,0,1);return kc(r,r)},Qat=(t,e)=>{const r=1-e,i=Pm(t,.2126+.7874*r,.7152-.7152*r,.0722-.0722*r,0,.2126-.2126*r,.7152+.2848*r,.0722-.0722*r,0,.2126-.2126*r,.7152-.7152*r,.0722+.9278*r,0,0,0,0,1);return kc(i,i)},Kat=(t,e)=>{const r=Math.sin(e*Math.PI/180),i=Math.cos(e*Math.PI/180),s=Pm(t,.213+.787*i-.213*r,.715-.715*i-.715*r,.072-.072*i+.928*r,0,.213-.213*i+.143*r,.715+.285*i+.14*r,.072-.072*i-.283*r,0,.213-.213*i-.787*r,.715-.715*i+.715*r,.072+.928*i+.072*r,0,0,0,0,1);return kc(s,s)},elt=(t,e)=>{const r=1-2*e,i=Pm(t,r,0,0,e,0,r,0,e,0,0,r,e,0,0,0,1);return kc(i,i)},tlt=(t,e)=>{const r=Pm(t,.213+.787*e,.715-.715*e,.072-.072*e,0,.213-.213*e,.715+.285*e,.072-.072*e,0,.213-.213*e,.715-.715*e,.072+.928*e,0,0,0,0,1);return kc(r,r)},rlt=(t,e)=>{const r=1-e,i=Pm(t,.393+.607*r,.769-.769*r,.189-.189*r,0,.349-.349*r,.686+.314*r,.168-.168*r,0,.272-.272*r,.534-.534*r,.131+.869*r,0,0,0,0,1);return kc(i,i)};let eAe=class tAe{constructor(e,r,i){this.strength=e,this.radius=r,this.threshold=i,this.type="bloom"}interpolate(e,r,i){this.strength=bc(e.strength,r.strength,i),this.radius=bc(e.radius,r.radius,i),this.threshold=bc(e.threshold,r.threshold,i)}clone(){return new tAe(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:LR(this.radius),strength:this.strength,threshold:this.threshold}}},rAe=class iAe{constructor(e){this.radius=e,this.type="blur"}interpolate(e,r,i){this.radius=Math.round(bc(e.radius,r.radius,i))}clone(){return new iAe(this.radius)}toJSON(){return{type:"blur",radius:LR(this.radius)}}},Oq=class sAe{constructor(e,r){this.type=e,this.amount=r,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,r,i){this.amount=bc(e.amount,r.amount,i),this._updateMatrix()}clone(){return new sAe(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const e=this._colorMatrix||P9();switch(this.type){case"brightness":this._colorMatrix=Zat(e,this.amount);break;case"contrast":this._colorMatrix=Jat(e,this.amount);break;case"grayscale":this._colorMatrix=Qat(e,this.amount);break;case"invert":this._colorMatrix=elt(e,this.amount);break;case"saturate":this._colorMatrix=tlt(e,this.amount);break;case"sepia":this._colorMatrix=rlt(e,this.amount)}}},nAe=class oAe{constructor(e,r,i,s){this.offsetX=e,this.offsetY=r,this.blurRadius=i,this.color=s,this.type="drop-shadow"}interpolate(e,r,i){this.offsetX=bc(e.offsetX,r.offsetX,i),this.offsetY=bc(e.offsetY,r.offsetY,i),this.blurRadius=bc(e.blurRadius,r.blurRadius,i),this.color[0]=Math.round(bc(e.color[0],r.color[0],i)),this.color[1]=Math.round(bc(e.color[1],r.color[1],i)),this.color[2]=Math.round(bc(e.color[2],r.color[2],i)),this.color[3]=bc(e.color[3],r.color[3],i)}clone(){return new oAe(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const e=[...this.color];return e[3]*=255,{type:"drop-shadow",xoffset:LR(this.offsetX),yoffset:LR(this.offsetY),blurRadius:LR(this.blurRadius),color:e}}},aAe=class lAe{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,r,i){this.angle=bc(e.angle,r.angle,i),this._updateMatrix()}clone(){return new lAe(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const e=this._colorMatrix||P9();this._colorMatrix=Kat(e,this.angle)}},cAe=class uAe{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,r,i){this.amount=bc(e.amount,r.amount,i)}clone(){return new uAe(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}};function bc(t,e,r){return t+(e-t)*r}function LR(t){return Math.round(1e3*Wh(t))/1e3}function ilt(t){switch(t.type){case"grayscale":case"sepia":case"invert":return new Oq(t.type,0);case"saturate":case"brightness":case"contrast":return new Oq(t.type,1);case"opacity":return new cAe(1);case"hue-rotate":return new aAe(0);case"blur":return new rAe(0);case"drop-shadow":return new nAe(0,0,0,[...mZ("transparent")]);case"bloom":return new eAe(0,0,1)}}function slt(t,e){const r=t.length>e.length?t:e;return(t.length>e.length?e:t).every((i,s)=>i.type===r[s].type)}function nlt(t,e){const r=t.length>e.length?t:e,i=t.length>e.length?e:t;for(let s=i.length;s<r.length;s++)i.push(ilt(r[s]))}function olt(t){const e=t[0];return!!e&&"type"in e}var Dle,Nle,Rq={exports:{}};Rq.exports,Nle=function(){function t(s,n){function o(){this.constructor=s}o.prototype=n.prototype,s.prototype=new o}function e(s,n,o,a){var l=Error.call(this,s);return Object.setPrototypeOf&&Object.setPrototypeOf(l,e.prototype),l.expected=n,l.found=o,l.location=a,l.name="SyntaxError",l}function r(s,n,o){return o=o||" ",s.length>n?s:(n-=s.length,s+(o+=o.repeat(n)).slice(0,n))}function i(s,n){var o,a={},l=(n=n!==void 0?n:{}).grammarSource,c={start:Um},h=Um,d="none",f=")",m=",",g="(",_="%",v="px",b="cm",T="mm",x="in",S="pt",E="pc",A="deg",R="rad",M="grad",D="turn",k="#",L=".",N="e",q=/^[ \t\n\r]/,X=/^[a-z\-]/,G=/^[0-9a-fA-F]/,J=/^[+\-]/,I=/^[0-9]/,z=ul("none"),V=Un("none",!1),j=Un(")",!1),Y=Un(",",!1),Q=ul("whitespace"),te=jv([" ","	",`
`,"\r"],!1,!1),ge=ul("function"),De=Un("(",!1),at=ul("identifier"),we=jv([["a","z"],"-"],!1,!1),Ce=ul("percentage"),Me=Un("%",!1),Z=ul("length"),be=Un("px",!1),Fe=Un("cm",!1),ce=Un("mm",!1),$e=Un("in",!1),Xe=Un("pt",!1),ft=Un("pc",!1),mt=ul("angle"),Ye=Un("deg",!1),xt=Un("rad",!1),hr=Un("grad",!1),rr=Un("turn",!1),yi=ul("number"),lt=ul("color"),ct=Un("#",!1),bt=jv([["0","9"],["a","f"],["A","F"]],!1,!1),Zt=jv(["+","-"],!1,!1),ir=jv([["0","9"]],!1,!1),Xr=Un(".",!1),_i=Un("e",!1),Jt=function(){return[]},vi=function(H,me){return{type:"function",name:H,parameters:me||[]}},zi=function(H,me){return me.length>0?JC(H,me,3):[H]},Hr=function(H){return{type:"quantity",value:H.value,unit:H.unit}},Er=function(H){return{type:"color",colorType:H.type,value:H.value}},Wi=function(H){return H},Ss=function(){return Wl()},Dr=function(H){return{value:H,unit:"%"}},si=function(H){return{value:H,unit:"px"}},Yr=function(H){return{value:H,unit:"cm"}},_r=function(H){return{value:H,unit:"mm"}},ui=function(H){return{value:H,unit:"in"}},Ws=function(H){return{value:H,unit:"pt"}},io=function(H){return{value:H,unit:"pc"}},so=function(H){return{value:H,unit:"deg"}},_n=function(H){return{value:H,unit:"rad"}},vn=function(H){return{value:H,unit:"grad"}},Xi=function(H){return{value:H,unit:"turn"}},bn=function(H){return{value:H,unit:null}},Zr=function(){return{type:"hex",value:Wl()}},Nn=function(H){return{type:"function",value:H}},Mo=function(){return{type:"named",value:Wl()}},Ca=function(){return parseFloat(Wl())},oe=0,Ci=0,ad=[{line:1,column:1}],Fn=0,ld=[],it=0;if("startRule"in n){if(!(n.startRule in c))throw new Error(`Can't start parsing from rule "`+n.startRule+'".');h=c[n.startRule]}function Wl(){return s.substring(Ci,oe)}function Un(H,me){return{type:"literal",text:H,ignoreCase:me}}function jv(H,me,Ae){return{type:"class",parts:H,inverted:me,ignoreCase:Ae}}function Hv(){return{type:"end"}}function ul(H){return{type:"other",description:H}}function Fm(H){var me,Ae=ad[H];if(Ae)return Ae;for(me=H-1;!ad[me];)me--;for(Ae={line:(Ae=ad[me]).line,column:Ae.column};me<H;)s.charCodeAt(me)===10?(Ae.line++,Ae.column=1):Ae.column++,me++;return ad[H]=Ae,Ae}function qv(H,me,Ae){var dr=Fm(H),Xs=Fm(me),bi={source:l,start:{offset:H,line:dr.line,column:dr.column},end:{offset:me,line:Xs.line,column:Xs.column}};return Ae&&l&&typeof l.offset=="function"&&(bi.start=l.offset(bi.start),bi.end=l.offset(bi.end)),bi}function Qt(H){oe<Fn||(oe>Fn&&(Fn=oe,ld=[]),ld.push(H))}function H0(H,me,Ae){return new e(e.buildMessage(H,me),H,me,Ae)}function Um(){var H;return(H=q0())===a&&(H=Aa()),H}function q0(){var H,me;return it++,H=oe,is(),s.substr(oe,4)===d?(me=d,oe+=4):(me=a,it===0&&Qt(V)),me!==a?(is(),Ci=H,H=Jt()):(oe=H,H=a),it--,H===a&&it===0&&Qt(z),H}function Aa(){var H,me;if(H=[],(me=Xl())!==a)for(;me!==a;)H.push(me),me=Xl();else H=a;return H}function Xl(){var H,me,Ae,dr;return H=oe,is(),(me=W0())!==a?(is(),(Ae=Vp())===a&&(Ae=null),is(),s.charCodeAt(oe)===41?(dr=f,oe++):(dr=a,it===0&&Qt(j)),dr!==a?(is(),Ci=H,H=vi(me,Ae)):(oe=H,H=a)):(oe=H,H=a),H}function Vp(){var H,me,Ae,dr,Xs,bi,Oa,Zv;if(H=oe,(me=kn())!==a){for(Ae=[],dr=oe,Xs=is(),s.charCodeAt(oe)===44?(bi=m,oe++):(bi=a,it===0&&Qt(Y)),bi===a&&(bi=null),Oa=is(),(Zv=kn())!==a?dr=Xs=[Xs,bi,Oa,Zv]:(oe=dr,dr=a);dr!==a;)Ae.push(dr),dr=oe,Xs=is(),s.charCodeAt(oe)===44?(bi=m,oe++):(bi=a,it===0&&Qt(Y)),bi===a&&(bi=null),Oa=is(),(Zv=kn())!==a?dr=Xs=[Xs,bi,Oa,Zv]:(oe=dr,dr=a);Ci=H,H=zi(me,Ae)}else oe=H,H=a;return H}function kn(){var H,me;return H=oe,(me=Xv())===a&&(me=jx())===a&&(me=Yv())===a&&(me=X0()),me!==a&&(Ci=H,me=Hr(me)),(H=me)===a&&(H=oe,(me=dI())!==a&&(Ci=H,me=Er(me)),H=me),H}function is(){var H,me;for(it++,H=[],q.test(s.charAt(oe))?(me=s.charAt(oe),oe++):(me=a,it===0&&Qt(te));me!==a;)H.push(me),q.test(s.charAt(oe))?(me=s.charAt(oe),oe++):(me=a,it===0&&Qt(te));return it--,me=a,it===0&&Qt(Q),H}function W0(){var H,me,Ae;return it++,H=oe,(me=Wv())!==a?(s.charCodeAt(oe)===40?(Ae=g,oe++):(Ae=a,it===0&&Qt(De)),Ae!==a?(Ci=H,H=Wi(me)):(oe=H,H=a)):(oe=H,H=a),it--,H===a&&(me=a,it===0&&Qt(ge)),H}function Wv(){var H,me,Ae;if(it++,H=oe,me=[],X.test(s.charAt(oe))?(Ae=s.charAt(oe),oe++):(Ae=a,it===0&&Qt(we)),Ae!==a)for(;Ae!==a;)me.push(Ae),X.test(s.charAt(oe))?(Ae=s.charAt(oe),oe++):(Ae=a,it===0&&Qt(we));else me=a;return me!==a&&(Ci=H,me=Ss()),it--,(H=me)===a&&(me=a,it===0&&Qt(at)),H}function Xv(){var H,me,Ae;return it++,H=oe,is(),(me=hl())!==a?(s.charCodeAt(oe)===37?(Ae=_,oe++):(Ae=a,it===0&&Qt(Me)),Ae!==a?(Ci=H,H=Dr(me)):(oe=H,H=a)):(oe=H,H=a),it--,H===a&&it===0&&Qt(Ce),H}function jx(){var H,me,Ae;return it++,H=oe,is(),(me=hl())!==a?(s.substr(oe,2)===v?(Ae=v,oe+=2):(Ae=a,it===0&&Qt(be)),Ae!==a?(Ci=H,H=si(me)):(oe=H,H=a)):(oe=H,H=a),H===a&&(H=oe,is(),(me=hl())!==a?(s.substr(oe,2)===b?(Ae=b,oe+=2):(Ae=a,it===0&&Qt(Fe)),Ae!==a?(Ci=H,H=Yr(me)):(oe=H,H=a)):(oe=H,H=a),H===a&&(H=oe,is(),(me=hl())!==a?(s.substr(oe,2)===T?(Ae=T,oe+=2):(Ae=a,it===0&&Qt(ce)),Ae!==a?(Ci=H,H=_r(me)):(oe=H,H=a)):(oe=H,H=a),H===a&&(H=oe,is(),(me=hl())!==a?(s.substr(oe,2)===x?(Ae=x,oe+=2):(Ae=a,it===0&&Qt($e)),Ae!==a?(Ci=H,H=ui(me)):(oe=H,H=a)):(oe=H,H=a),H===a&&(H=oe,is(),(me=hl())!==a?(s.substr(oe,2)===S?(Ae=S,oe+=2):(Ae=a,it===0&&Qt(Xe)),Ae!==a?(Ci=H,H=Ws(me)):(oe=H,H=a)):(oe=H,H=a),H===a&&(H=oe,is(),(me=hl())!==a?(s.substr(oe,2)===E?(Ae=E,oe+=2):(Ae=a,it===0&&Qt(ft)),Ae!==a?(Ci=H,H=io(me)):(oe=H,H=a)):(oe=H,H=a)))))),it--,H===a&&it===0&&Qt(Z),H}function Yv(){var H,me,Ae;return it++,H=oe,(me=hl())!==a?(s.substr(oe,3)===A?(Ae=A,oe+=3):(Ae=a,it===0&&Qt(Ye)),Ae!==a?(Ci=H,H=so(me)):(oe=H,H=a)):(oe=H,H=a),H===a&&(H=oe,(me=hl())!==a?(s.substr(oe,3)===R?(Ae=R,oe+=3):(Ae=a,it===0&&Qt(xt)),Ae!==a?(Ci=H,H=_n(me)):(oe=H,H=a)):(oe=H,H=a),H===a&&(H=oe,(me=hl())!==a?(s.substr(oe,4)===M?(Ae=M,oe+=4):(Ae=a,it===0&&Qt(hr)),Ae!==a?(Ci=H,H=vn(me)):(oe=H,H=a)):(oe=H,H=a),H===a&&(H=oe,(me=hl())!==a?(s.substr(oe,4)===D?(Ae=D,oe+=4):(Ae=a,it===0&&Qt(rr)),Ae!==a?(Ci=H,H=Xi(me)):(oe=H,H=a)):(oe=H,H=a)))),it--,H===a&&(me=a,it===0&&Qt(mt)),H}function X0(){var H,me;return it++,H=oe,is(),(me=hl())!==a?(Ci=H,H=bn(me)):(oe=H,H=a),it--,H===a&&it===0&&Qt(yi),H}function dI(){var H,me,Ae,dr;if(it++,H=oe,s.charCodeAt(oe)===35?(me=k,oe++):(me=a,it===0&&Qt(ct)),me!==a){if(Ae=[],G.test(s.charAt(oe))?(dr=s.charAt(oe),oe++):(dr=a,it===0&&Qt(bt)),dr!==a)for(;dr!==a;)Ae.push(dr),G.test(s.charAt(oe))?(dr=s.charAt(oe),oe++):(dr=a,it===0&&Qt(bt));else Ae=a;Ae!==a?(Ci=H,H=Zr()):(oe=H,H=a)}else oe=H,H=a;return H===a&&(H=oe,(me=Xl())!==a&&(Ci=H,me=Nn(me)),(H=me)===a&&(H=oe,(me=Wv())!==a&&(Ci=H,me=Mo()),H=me)),it--,H===a&&(me=a,it===0&&Qt(lt)),H}function hl(){var H,me,Ae,dr,Xs,bi,Oa;for(H=oe,J.test(s.charAt(oe))?(s.charAt(oe),oe++):it===0&&Qt(Zt),me=oe,Ae=[],I.test(s.charAt(oe))?(dr=s.charAt(oe),oe++):(dr=a,it===0&&Qt(ir));dr!==a;)Ae.push(dr),I.test(s.charAt(oe))?(dr=s.charAt(oe),oe++):(dr=a,it===0&&Qt(ir));if(s.charCodeAt(oe)===46?(dr=L,oe++):(dr=a,it===0&&Qt(Xr)),dr!==a){if(Xs=[],I.test(s.charAt(oe))?(bi=s.charAt(oe),oe++):(bi=a,it===0&&Qt(ir)),bi!==a)for(;bi!==a;)Xs.push(bi),I.test(s.charAt(oe))?(bi=s.charAt(oe),oe++):(bi=a,it===0&&Qt(ir));else Xs=a;Xs!==a?me=Ae=[Ae,dr,Xs]:(oe=me,me=a)}else oe=me,me=a;if(me===a)if(me=[],I.test(s.charAt(oe))?(Ae=s.charAt(oe),oe++):(Ae=a,it===0&&Qt(ir)),Ae!==a)for(;Ae!==a;)me.push(Ae),I.test(s.charAt(oe))?(Ae=s.charAt(oe),oe++):(Ae=a,it===0&&Qt(ir));else me=a;if(me!==a){if(Ae=oe,s.charCodeAt(oe)===101?(dr=N,oe++):(dr=a,it===0&&Qt(_i)),dr!==a){if(J.test(s.charAt(oe))?(Xs=s.charAt(oe),oe++):(Xs=a,it===0&&Qt(Zt)),Xs===a&&(Xs=null),bi=[],I.test(s.charAt(oe))?(Oa=s.charAt(oe),oe++):(Oa=a,it===0&&Qt(ir)),Oa!==a)for(;Oa!==a;)bi.push(Oa),I.test(s.charAt(oe))?(Oa=s.charAt(oe),oe++):(Oa=a,it===0&&Qt(ir));else bi=a;bi!==a?Ae=dr=[dr,Xs,bi]:(oe=Ae,Ae=a)}else oe=Ae,Ae=a;Ae===a&&(Ae=null),Ci=H,H=Ca()}else oe=H,H=a;return H}function ZC(H,me){return H.map(function(Ae){return Ae[me]})}function JC(H,me,Ae){return[H].concat(ZC(me,Ae))}if((o=h())!==a&&oe===s.length)return o;throw o!==a&&oe<s.length&&Qt(Hv()),H0(ld,Fn<s.length?s.charAt(Fn):null,Fn<s.length?qv(Fn,Fn+1):qv(Fn,Fn))}return t(e,Error),e.prototype.format=function(s){var n="Error: "+this.message;if(this.location){var o,a=null;for(o=0;o<s.length;o++)if(s[o].source===this.location.source){a=s[o].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,c=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(l):l,h=this.location.source+":"+c.line+":"+c.column;if(a){var d=this.location.end,f=r("",c.line.toString().length," "),m=a[l.line-1],g=(l.line===d.line?d.column:m.length+1)-l.column||1;n+=`
 --> `+h+`
`+f+` |
`+c.line+" | "+m+`
`+f+" | "+r("",l.column-1," ")+r("",g,"^")}else n+=`
 at `+h}return n},e.buildMessage=function(s,n){var o={literal:function(m){return'"'+l(m.text)+'"'},class:function(m){var g=m.parts.map(function(_){return Array.isArray(_)?c(_[0])+"-"+c(_[1]):c(_)});return"["+(m.inverted?"^":"")+g.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(m){return m.description}};function a(m){return m.charCodeAt(0).toString(16).toUpperCase()}function l(m){return m.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+a(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+a(g)})}function c(m){return m.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+a(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+a(g)})}function h(m){return o[m.type](m)}function d(m){var g,_,v=m.map(h);if(v.sort(),v.length>0){for(g=1,_=1;g<v.length;g++)v[g-1]!==v[g]&&(v[_]=v[g],_++);v.length=_}switch(v.length){case 1:return v[0];case 2:return v[0]+" or "+v[1];default:return v.slice(0,-1).join(", ")+", or "+v[v.length-1]}}function f(m){return m?'"'+l(m)+'"':"end of input"}return"Expected "+d(s)+" but "+f(n)+" found."},{SyntaxError:e,parse:i}},(Dle=Rq).exports&&(Dle.exports=Nle());var alt=Rq.exports;function hAe(t){if(!t||t.length===0)return null;if(typeof t=="string"){const r=Fle(t);return r&&r.length!==0?r:null}const e=t.map(r=>{if(!Number.isFinite(r.scale)||r.scale<=0)throw new U("effect:invalid-scale","scale must be finite and greater than 0",{stop:r});return{scale:r.scale,effects:Fle(r.value)}});e.sort((r,i)=>i.effects.length-r.effects.length);for(let r=0;r<e.length-1;r++){if(!slt(e[r].effects,e[r+1].effects))throw new U("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:e[r].effects,b:e[r+1].effects});nlt(e[r].effects,e[r+1].effects)}return e.sort((r,i)=>i.scale-r.scale),e}function Fle(t){let e;if(!t)return[];try{e=alt.parse(t)}catch(r){throw new U("effect:invalid-syntax","Invalid effect syntax",{value:t,error:r})}return e.map(r=>llt(r))}function llt(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return clt(t);case"opacity":return ult(t);case"hue-rotate":return hlt(t);case"blur":return dlt(t);case"drop-shadow":return plt(t);case"bloom":return flt(t)}}catch(e){throw e.details.filter=t,e}throw new U("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}function clt(t){let e=1;return GC(t.parameters,1),t.parameters.length===1&&(e=Kd(t.parameters[0])),new Oq(t.name,e)}function ult(t){let e=1;return GC(t.parameters,1),t.parameters.length===1&&(e=Kd(t.parameters[0])),new cAe(e)}function hlt(t){let e=0;return GC(t.parameters,1),t.parameters.length===1&&(e=blt(t.parameters[0])),new aAe(e)}function dlt(t){let e=0;return GC(t.parameters,1),t.parameters.length===1&&(e=ZK(t.parameters[0]),KP(e,t.parameters[0])),new rAe(e)}function plt(t){const e=[];let r=null;for(const i of t.parameters)if(i.type==="color"){if(e.length&&Object.freeze(e),r)throw new U("effect:type-error","Accepts only one color",{});r=wlt(i)}else{const s=ZK(i);if(Object.isFrozen(e))throw new U("effect:type-error","<length> parameters not consecutive",{lengths:e});e.push(s),e.length===3&&KP(s,i)}if(e.length<2||e.length>3)throw new U("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${e.length}}`,{lengths:e});return new nAe(e[0],e[1],e[2]||0,r||dAe("black"))}function flt(t){let e=1,r=0,i=0;return GC(t.parameters,3),t.parameters[0]&&(e=Kd(t.parameters[0])),t.parameters[1]&&(r=ZK(t.parameters[1]),KP(r,t.parameters[1])),t.parameters[2]&&(i=Kd(t.parameters[2])),new eAe(e,r,i)}function GC(t,e){if(t.length>e)throw new U("effect:type-error",`Function supports up to ${e} parameters, Actual: ${t.length}`,{parameters:t})}function I9(t){if(t.type==="color")return"<color>";if(t.unit){if(t.unit in YK)return"<length>";if(t.unit in XK)return"<angle>";if(t.unit==="%")return"<percentage>"}return"<double>"}function KP(t,e){if(t<0)throw new U("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:e})}function mlt(t){if(t.type!=="quantity"||t.unit!==null)throw new U("effect:type-error",`Expected <double>, Actual: ${I9(t)}`,{term:t})}function glt(t){if(t.type!=="quantity"||t.unit!==null&&t.unit!=="%")throw new U("effect:type-error",`Expected <double> or <percentage>, Actual: ${I9(t)}`,{term:t})}const XK={deg:1,grad:.9,rad:180/Math.PI,turn:360};function ylt(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&XK[t.unit]!=null))throw new U("effect:type-error",`Expected <angle>, Actual: ${I9(t)}`,{term:t})}const YK={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function _lt(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&YK[t.unit]!=null))throw new U("effect:type-error",`Expected <length>, Actual: ${I9(t)}`,{term:t})}function Kd(t){glt(t);const e=t.value;return KP(e,t),t.unit==="%"?.01*e:e}function vlt(t){return mlt(t),KP(t.value,t),t.value}function blt(t){return ylt(t),t.value*XK[t.unit]||0}function ZK(t){return _lt(t),t.value*YK[t.unit]||0}function wlt(t){switch(t.colorType){case"hex":return m6e(t.value);case"named":return dAe(t.value);case"function":return Slt(t.value)}}function dAe(t){if(!_ye(t))throw new U("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return f6e(t)}const xlt=/^rgba?/i,Tlt=/^hsla?/i;function Slt(t){if(GC(t.parameters,4),xlt.test(t.name))return[Kd(t.parameters[0]),Kd(t.parameters[1]),Kd(t.parameters[2]),t.parameters[3]?Kd(t.parameters[3]):1];if(Tlt.test(t.name))return vye(vlt(t.parameters[0]),Kd(t.parameters[1]),Kd(t.parameters[2]),t.parameters[3]?Kd(t.parameters[3]):1);throw new U("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}function JK(t,e,r){try{return Clt(t)}catch(i){r?.messages?.push(i)}return null}function QK(t,e,r,i){try{const s=Elt(t);ol(r,s,e)}catch(s){i.messages&&i.messages.push(s)}}function Elt(t){const e=hAe(t);return e?olt(e)?e.map(r=>r.toJSON()):e.map(({scale:r,effects:i})=>({scale:r,value:i.map(s=>s.toJSON())})):null}function Clt(t){if(!t||t.length===0)return null;if(Alt(t)){const e=[];for(const r of t)e.push({scale:r.scale,value:Ule(r.value)});return e}return Ule(t)}function Alt(t){const e=t[0];return!!e&&"scale"in e}function Ule(t){if(!t||!t.length)return"";const e=[];for(const r of t){let i=[];switch(r.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":i=[qm(r,"amount")];break;case"blur":i=[qm(r,"radius","pt")];break;case"hue-rotate":i=[qm(r,"angle","deg")];break;case"drop-shadow":i=[qm(r,"xoffset","pt"),qm(r,"yoffset","pt"),qm(r,"blurRadius","pt"),Olt(r,"color")];break;case"bloom":i=[qm(r,"strength"),qm(r,"radius","pt"),qm(r,"threshold")]}const s=`${r.type}(${i.filter(Boolean).join(" ")})`;hAe(s),e.push(s)}return e.join(" ")}function qm(t,e,r){if(t[e]==null)throw new U("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});return r?t[e]+r:""+t[e]}function Olt(t,e){if(t[e]==null)throw new U("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});const r=t[e];return`rgba(${r[0]||0}, ${r[1]||0}, ${r[2]||0}, ${r[3]/255||0})`}function Rlt(t){return typeof t=="function"}function a7t(t,e,r,i){return Rlt(t)?t(e,r,i):t}function l7t(t){return[t.r,t.g,t.b,t.a]}const Mlt=` /-,
`;function kle(t){let e=t.length;for(;e--;)if(!Mlt.includes(t.charAt(e)))return!1;return!0}function Plt(t,e){const r=[];let i=0,s=-1;do if(s=t.indexOf("[",i),s>=i){if(s>i){const n=t.substr(i,s-i);r.push([n,null,kle(n)])}if(i=s+1,s=t.indexOf("]",i),s>=i){if(s>i){const n=e[t.substr(i,s-i)];n&&r.push([null,n,!1])}i=s+1}}while(s!==-1);if(i<t.length-1){const n=t.substr(i);r.push([n,null,kle(n)])}return r}function Ilt(t,e,r){let i="",s=null;for(const n of e){const[o,a,l]=n;if(o)l?s=o:(s&&(i+=s,s=null),i+=o);else{const c=t.attributes[a];c&&(s&&(i+=s,s=null),i+=c)}}return $lt(i,r)}function c7t(t,e,r){const i=Plt(e,t);return s=>Ilt(s,i,r)}function $lt(t,e){switch(typeof t!="string"&&(t=String(t)),e){case"LowerCase":return t.toLowerCase();case"Allcaps":return t.toUpperCase();default:return t}}function u7t(t,e,r,i,s,n,o=!0){const a=e/s,l=r/n,c=Math.ceil(a/2),h=Math.ceil(l/2);for(let d=0;d<n;d++)for(let f=0;f<s;f++){const m=4*(f+(o?n-d-1:d)*s);let g=0,_=0,v=0,b=0,T=0,x=0,S=0;const E=(d+.5)*l;for(let A=Math.floor(d*l);A<(d+1)*l;A++){const R=Math.abs(E-(A+.5))/h,M=(f+.5)*a,D=R*R;for(let k=Math.floor(f*a);k<(f+1)*a;k++){let L=Math.abs(M-(k+.5))/c;const N=Math.sqrt(D+L*L);N>=-1&&N<=1&&(g=2*N*N*N-3*N*N+1,g>0&&(L=4*(k+A*e),S+=g*t[L+3],v+=g,t[L+3]<255&&(g=g*t[L+3]/250),b+=g*t[L],T+=g*t[L+1],x+=g*t[L+2],_+=g))}}i[m]=b/_,i[m+1]=T/_,i[m+2]=x/_,i[m+3]=S/v}}function pAe(t){return t?{r:t[0],g:t[1],b:t[2],a:t[3]/255}:{r:0,g:0,b:0,a:0}}function Llt(t){return t.data?.symbol??null}function Dlt(t){return t.type==="CIMVectorMarker"||t.type==="CIMPictureMarker"||t.type==="CIMBarChartMarker"||t.type==="CIMCharacterMarker"||t.type==="CIMPieChartMarker"||t.type==="CIMStackedBarChartMarker"}function Nlt(t){return t.type==="CIMGradientStroke"||t.type==="CIMPictureStroke"||t.type==="CIMSolidStroke"}function fAe(t){return t!=null&&(t.type==="CIMMarkerPlacementAlongLineRandomSize"||t.type==="CIMMarkerPlacementAlongLineSameSize"||t.type==="CIMMarkerPlacementAlongLineVariableSize"||t.type==="CIMMarkerPlacementAtExtremities"||t.type==="CIMMarkerPlacementAtMeasuredUnits"||t.type==="CIMMarkerPlacementAtRatioPositions"||t.type==="CIMMarkerPlacementOnLine"||t.type==="CIMMarkerPlacementOnVertices")}const h7t=(t,e=0)=>t==null||isNaN(t)?e:t,d7t=t=>t.tintColor?pAe(t.tintColor):{r:255,g:255,b:255,a:1},p7t=t=>{if(!t)return!1;for(const e of t)switch(e.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1};function f7t(){return he(()=>import("./geometryEngineJSON-3e508396.js"),["./geometryEngineJSON-3e508396.js","./geometryEngineBase-eaaafef1.js","./geometryEngineJSON-cc9c6b0f.js","./json-48e3ea08.js"],import.meta.url)}function m7t(t){if(!t)return"normal";switch(t.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}}function g7t(t){if(!t)return"normal";switch(t.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}}function y7t(t){let e="normal",r="normal";if(t){const i=t.toLowerCase();i.includes("italic")?e="italic":i.includes("oblique")&&(e="oblique"),i.includes("bold")?r="bold":i.includes("light")&&(r="lighter")}return{style:e,weight:r}}function _7t(t){return t.underline?"underline":t.strikethrough?"line-through":"none"}function zle(t){if(!t)return null;switch(t.type){case"CIMPolygonSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const r=zle(e);if(r!=null)return r}break;case"CIMTextSymbol":return zle(t.symbol);case"CIMSolidFill":return t.color}}function Vle(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const e=t.symbolLayers;if(e)for(const r of e){const i=Vle(r);if(i!=null)return i}break}case"CIMTextSymbol":return Vle(t.symbol);case"CIMSolidStroke":return t.color}}function Ble(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const r=Ble(e);if(r!==void 0)return r}break;case"CIMTextSymbol":return Ble(t.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return t.width}}function v7t(t){switch(t){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}}function b7t(t){switch(t){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function w7t(t){return(t?Object.keys(t):[]).map(e=>({name:e,alias:e,type:typeof t[e]=="string"?"esriFieldTypeString":"esriFieldTypeDouble"}))}const x7t=t=>t.includes("data:image/svg+xml");function T7t(t){if(!t)return null;switch(t.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function mAe(t,e,r,i){if(t)if(t.type!=="CIMTextSymbol"){if(r&&t.effects)for(const s of t.effects)klt(s,e);if(t.symbolLayers)for(const s of t.symbolLayers)switch(s.type){case"CIMPictureMarker":case"CIMVectorMarker":Flt(s,e,i);break;case"CIMPictureStroke":case"CIMSolidStroke":!i?.preserveOutlineWidth&&s.width&&(s.width*=e);break;case"CIMPictureFill":s.height&&(s.height*=e),s.offsetX&&(s.offsetX*=e),s.offsetY&&(s.offsetY*=e);break;case"CIMHatchFill":mAe(s.lineSymbol,e,!0,{...i,preserveOutlineWidth:!1}),s.offsetX&&(s.offsetX*=e),s.offsetY&&(s.offsetY*=e),s.separation&&(s.separation*=e)}}else t.height!=null&&(t.height*=e)}function Flt(t,e,r){if(t&&(t.markerPlacement&&Ult(t.markerPlacement,e),t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.anchorPoint&&t.anchorPointUnits==="Absolute"&&(t.anchorPoint={x:t.anchorPoint.x*e,y:t.anchorPoint.y*e}),t.size=t.size!=null?t.size*e:0,t.type==="CIMVectorMarker"&&t.markerGraphics))for(const i of t.markerGraphics)t.scaleSymbolsProportionally||mAe(i.symbol,e,!0,r)}function Ult(t,e){switch(fAe(t)&&t.offset&&(t.offset*=e),t.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.placementTemplate&&t.placementTemplate.length){const r=t.placementTemplate.map(i=>i*e);t.placementTemplate=r}break;case"CIMMarkerPlacementAlongLineVariableSize":if(t.maxRandomOffset&&(t.maxRandomOffset*=e),t.placementTemplate&&t.placementTemplate.length){const r=t.placementTemplate.map(i=>i*e);t.placementTemplate=r}break;case"CIMMarkerPlacementOnLine":t.startPointOffset&&(t.startPointOffset*=e);break;case"CIMMarkerPlacementAtExtremities":t.offsetAlongLine&&(t.offsetAlongLine*=e);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":t.beginPosition&&(t.beginPosition*=e),t.endPosition&&(t.endPosition*=e);break;case"CIMMarkerPlacementPolygonCenter":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMMarkerPlacementInsidePolygon":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.stepX&&(t.stepX*=e),t.stepY&&(t.stepY*=e)}}function klt(t,e){switch(t.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":t.width&&(t.width*=e);break;case"CIMGeometricEffectBuffer":t.size&&(t.size*=e);break;case"CIMGeometricEffectCut":t.beginCut&&(t.beginCut*=e),t.endCut&&(t.endCut*=e),t.middleCut&&(t.middleCut*=e);break;case"CIMGeometricEffectDashes":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.dashTemplate&&t.dashTemplate.length){const r=t.dashTemplate.map(i=>i*e);t.dashTemplate=r}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":t.length&&(t.length*=e);break;case"CIMGeometricEffectMove":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":t.offset&&(t.offset*=e);break;case"CIMGeometricEffectRegularPolygon":t.radius&&(t.radius*=e);break;case"CIMGeometricEffectTaperedPolygon":t.fromWidth&&(t.fromWidth*=e),t.length&&(t.length*=e),t.toWidth&&(t.toWidth*=e);break;case"CIMGeometricEffectWave":t.amplitude&&(t.amplitude*=e),t.period&&(t.period*=e)}}function zlt(t){const e=[];return Mq(Llt(t),e),e.length?new ke(pAe(e[0])):null}function Mq(t,e){if(!t)return;let r;r=t.type==="CIMTextSymbol"?t.symbol:t;const i=t.type==="CIMPolygonSymbol";if(r?.symbolLayers){for(const s of r.symbolLayers)if(!(s.colorLocked||i&&(Nlt(s)||Dlt(s)&&s.markerPlacement&&fAe(s.markerPlacement))))switch(s.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":s.tintColor&&Gle(e,s.tintColor);break;case"CIMVectorMarker":s.markerGraphics?.forEach(n=>{Mq(n.symbol,e)});break;case"CIMSolidStroke":case"CIMSolidFill":Gle(e,s.color);break;case"CIMHatchFill":Mq(s.lineSymbol,e)}}}function Gle(t,e){for(const r of t)if(r.join(".")===e.join("."))return;t.push(e)}let gAe=class{constructor(e,r){this._storage=new E3e,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this),r&&this._storage.registerRemoveFunc("",r)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,r,i=1){this._storage.put(this,e,r,i,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}};new gAe(1e3);new ke([128,128,128]);const Vlt=new ke("white");function Blt(t){return _c(t.resource).href}function E7t(t,e){if(!t)return null;let r=null;return Bw(t)?r=Glt(t):p8(t)&&(r=t.type==="cim"?zlt(t):t.color?new ke(t.color):null),r?VM(r,e):null}function Glt(t){const e=t.symbolLayers;if(!e)return null;let r=null;return e.forEach(i=>{i.type==="object"&&i.resource?.href||(r=i.type==="water"?i.color:i.material?i.material.color:null)}),r?new ke(r):null}function VM(t,e){if(e==null||t==null)return t;const r=t.toRgba();return r[3]=r[3]*e,new ke(r)}function jlt(t,e,r){const i=t.symbolLayers;if(!i)return;const s=n=>VM(e=e??n??(r!=null?Vlt:null),r);i.forEach(n=>{if(n.type!=="object"||!n.resource?.href||e)if(n.type==="water")n.color=s(n.color);else{const o=n.material!=null?n.material.color:null,a=s(o);n.material==null?n.material=new Au({color:a}):n.material.color=a,r!=null&&"outline"in n&&n.outline!=null&&n.outline.color!=null&&(n.outline.color=VM(n.outline.color,r))}})}function Hlt(t,e,r){(e=e??t.color)&&(t.color=VM(e,r)),r!=null&&"outline"in t&&t.outline&&t.outline.color&&(t.outline.color=VM(t.outline.color,r))}function C7t(t,e,r){t&&(e||r!=null)&&(e&&(e=new ke(e)),Bw(t)?jlt(t,e,r):p8(t)&&Hlt(t,e,r))}async function qlt(t,e){const r=t.symbolLayers;r&&await G6(r,async i=>Wlt(i,e))}async function Wlt(t,e){switch(t.type){case"extrude":Ylt(t,e);break;case"icon":case"line":case"text":Xlt(t,e);break;case"path":Jlt(t,e);break;case"object":await Zlt(t,e)}}function Xlt(t,e){const r=yAe(e);r!=null&&(t.size=r)}function yAe(t){for(const e of t)if(typeof e=="number")return e;return null}function Ylt(t,e){t.size=typeof e[2]=="number"?e[2]:0}async function Zlt(t,e){const{resourceSize:r,symbolSize:i}=await Qlt(t),s=_Ae(e,r,i);t.width=DR(e[0],i[0],r[0],s),t.depth=DR(e[1],i[1],r[1],s),t.height=DR(e[2],i[2],r[2],s)}function Jlt(t,e){const r=_Ae(e,Hg,[t.width,void 0,t.height]);t.width=DR(e[0],t.width,1,r),t.height=DR(e[2],t.height,1,r)}function _Ae(t,e,r){for(let i=0;i<3;i++){const s=t[i];switch(s){case"symbol-value":{const n=r[i];return n!=null?n/e[i]:1}case"proportional":break;default:if(s&&e[i])return s/e[i]}}return 1}async function Qlt(t){const{computeObjectLayerResourceSize:e}=await he(()=>import("./symbolLayerUtils-1702d2bd.js"),[],import.meta.url),r=await e(t,10),{width:i,height:s,depth:n}=t,o=[i,n,s];let a=1;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/r[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=r[l]*a);return{resourceSize:r,symbolSize:o}}function DR(t,e,r,i){switch(t){case"proportional":return r*i;case"symbol-value":return e??r;default:return t}}function Klt(t,e){const r=yAe(e);if(r!=null)switch(t.type){case"simple-marker":t.size=r;break;case"picture-marker":{const i=t.width/t.height;i>1?(t.width=r,t.height=r*i):(t.width=r*i,t.height=r);break}case"simple-line":t.width=r;break;case"text":t.font.size=r}}async function A7t(t,e){if(t&&e)return Bw(t)?qlt(t,e):void(p8(t)&&Klt(t,e))}function O7t(t,e,r){if(t&&e!=null)if(Bw(t)){const i=t.symbolLayers;i&&i.forEach(s=>{if(s&&s.type==="object")switch(r){case"tilt":s.tilt=e;break;case"roll":s.roll=e;break;default:s.heading=e}})}else p8(t)&&(t.type!=="simple-marker"&&t.type!=="picture-marker"&&t.type!=="text"||(t.angle=e))}function R7t(t){return t!=null&&t.type==="polygon-3d"&&t.symbolLayers.some(e=>e.type==="extrude")}async function M7t(t,e){return await t.fetchSymbol(e)||t.fetchCIMSymbol(e)}function ect(t,e,r,i,s){if(t==null)return null;const n=t.referencesGeometry()&&s?tct(e,i,s):e,o=t.repurposeFeature(n);try{return t.evaluate({...r,$feature:o},t.services)}catch(a){return K.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}}const Dz=new Map;function tct(t,e,r){const{transform:i,hasZ:s,hasM:n}=r;Dz.has(e)||Dz.set(e,rct(e));const o=Dz.get(e)(t.geometry,i,s,n);return{...t,geometry:o}}function rct(t){const e={};switch(t){case"esriGeometryPoint":return(r,i,s,n)=>PEe(i,e,r,s,n);case"esriGeometryPolygon":return(r,i,s,n)=>IEe(i,e,r,s,n);case"esriGeometryPolyline":return(r,i,s,n)=>$Ee(i,e,r,s,n);case"esriGeometryMultipoint":return(r,i,s,n)=>MEe(i,e,r,s,n);default:return K.getLogger("esri.views.2d.support.arcadeOnDemand").error(new U("mapview-arcade",`Unable to handle geometryType: ${t}`)),r=>r}}const P7t=1.2,ict=rm;let $9=class{constructor(e,r,i,s){this.graphics3DSymbolLayer=e,this.renderGeometries=r,this.boundingBox=i,this._drapeSourceRenderer=s,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(e){this.stage=e.stage}setVisibility(e){if(this.stage!=null&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,Yi.ADD);if(e||this._addedToStage){for(const r of this.renderGeometries)r.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,An.VISIBILITY)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,Yi.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(e=O()){return ne(e,0,0,0)}getBoundingBoxObjectSpace(e=gn()){return Ei(e)}addObjectState(e,r){e===T0.Highlight&&(this.renderGeometries.forEach(i=>{const s=i.geometry.addHighlight();r.addRenderGeometry(i,s,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,An.HIGHLIGHT))}removeObjectState(e){this.renderGeometries.forEach(r=>{e.removeRenderGeometry(r)})}removeRenderGeometryObjectState(e,r){e.geometry.removeHighlight(r),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,An.HIGHLIGHT)}computeAttachmentOrigin(e){for(const r of this.renderGeometries)r.geometry.computeAttachmentOrigin(wT)&&(e.draped.origin[0]+=wT[0],e.draped.origin[1]+=wT[1],e.draped.num++)}async getProjectedBoundingBox(e,r,i,s,n){Ei(n);for(let o=0;o<this.renderGeometries.length;o++){const a=this.renderGeometries[o];this._getRenderGeometryProjectedBoundingRect(a,e,jle,i),Sze(n,jle)}if(r){let o;hp(n,wT);const a=fK(n,r.service.spatialReference,r);try{o=await r.service.queryElevation(wT[0],wT[1],s,a,"ground")}catch{}o!=null&&(n[2]=Math.min(n[2],o),n[5]=Math.max(n[5],o))}return n}_getRenderGeometryProjectedBoundingRect(e,r,i,s){if(this.boundingBox)c8(Qp,this.boundingBox);else{const n=e.boundingSphere,o=n[3];Qp[0]=n[0]-o,Qp[1]=n[1]-o,Qp[2]=n[2]-o,Qp[3]=n[0]+o,Qp[4]=n[1]+o,Qp[5]=n[2]+o}return r(Qp,0,2),this.calculateRelativeScreenBounds&&s.push({location:hp(Qp),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),iJ(Qp,i)}};const jle=zt(),Qp=gn(),wT=O();let vAe=class{constructor(e,r,i,s=2048){this.text=e,this._alignment=r,this._parameters=i,this._maxSize=s,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${e}`,this._lines=e.split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._backgroundHorizontalPadding)}get displayHeight(){const e=this._lineSpacing*(this._lines.length-1),r=this._lineHeight;return Math.ceil(e+r+2*this._haloSize+this._backgroundTopPadding+this._backgroundBottomPadding)}get renderedWidth(){return Math.ceil(this._toRenderUnit(this.displayWidth))}get renderedHeight(){return Math.ceil(this._toRenderUnit(this.displayHeight))}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._baselinePosition)}get _firstLineYOffset(){return this._backgroundTopPadding+this._haloSize}get _metrics(){if(this._metricsCached==null){const e=Pq(Hle,sL,sL).getContext("2d");this._setFontProperties(e,this._fontSize);let r=2*this._haloSize;const i=this._parameters.definition.font;i.style!=="italic"&&i.style!=="oblique"&&i.weight!=="bold"&&i.weight!=="bolder"||(r+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let s,n,o=0,a=0,l=0;this._lines.forEach((g,_)=>{const v=e.measureText(g),b=v.width,T=b+r;this._textWidths.push(b),this._lineWidths.push(T),o=Math.max(o,T),a=Math.max(a,v.actualBoundingBoxAscent),l=Math.max(l,v.actualBoundingBoxDescent),_===0&&(s=v),_===this._lines.length-1&&(n=v)});const c=e.font;let h=Wle.get(c);if(!h){const g=e.measureText(nct);h=new act(g.actualBoundingBoxAscent,g.actualBoundingBoxDescent),Wle.set(c,h)}a=Math.max(a,h.actualBoundingBoxAscent),l=Math.max(l,h.actualBoundingBoxDescent);const d=a+l,f=this._hasBackground?s.actualBoundingBoxAscent:a,m=this._hasBackground?n.actualBoundingBoxDescent:l;this._metricsCached=new oct(a-f,l-m,d,o,a)}return this._metricsCached}get _lineSpacing(){return(this._lineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _lineHeight(){return this._metrics.lineHeight}get _linePadding(){return this._lineHeight*sct}get _baselinePosition(){return this._metrics.baselinePosition}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _backgroundHorizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _backgroundVerticalPadding(){return this._hasBackground?this._parameters.definition.background.padding[1]:0}get _backgroundTopPadding(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingTop)}get _backgroundBottomPadding(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingBottom)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(this._renderPixelRatio==null){const e=this._parameters.definition.pixelRatio;this._maxSize>0?this._renderPixelRatio=Math.min(e,Math.min(this._maxSize/this.displayWidth,this._maxSize/this.displayHeight)):this._renderPixelRatio=e}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case rv.Left:return this._backgroundHorizontalPadding;case rv.Center:return(this.displayWidth-this._lineWidths[e])/2;case rv.Right:return this.displayWidth-this._backgroundHorizontalPadding-this._lineWidths[e]}}render(e,r=0,i=0){e.save();const s=r/=this.renderPixelRatio,n=i/=this.renderPixelRatio,o=this._haloSize,a=this._firstLineYOffset;r+=o,i+=a+this._baselinePosition;const l=this._haloSize>0;l&&this._renderHalo(e,s,n,o,a),this._setFontProperties(e,this._renderedFontSize);for(let c=0;c<this._lines.length;++c){const h=this._lines[c],d=this._getLineXOffset(c);l&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,h,r+d,i),this._renderLineDecoration(e,r+d,i,this._textWidths[c])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,h,r+this._getLineXOffset(c),i),this._renderLineDecoration(e,r+d,i,this._textWidths[c]),i+=this._lineSpacing}if(li.TEXT_SHOW_BASELINE){e.strokeStyle=qle,e.setLineDash([2,2]),e.lineWidth=1;let c=n+a;for(let h=0;h<this._lines.length;++h){const d=c+this._baselinePosition;this._drawLine(e,[s,d],[s+this.displayWidth,d]),c+=this._lineSpacing}}if(li.TEXT_SHOW_BORDER&&(e.strokeStyle=qle,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[s,n],[this.displayWidth,this.displayHeight])),this._hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,s,n,c),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,r,i,s,n=!1){if(this._parameters.definition.font.decoration==="none"||s===0)return;const o=1,a=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":i+=2*a;break;case"line-through":i-=.33*this._baselinePosition}const l=n?this._haloSize:0;e.strokeStyle=n?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(a+2*l),e.beginPath(),e.moveTo(this._toRenderUnit(r-l),this._toRenderUnit(i)),e.lineTo(this._toRenderUnit(r+s+l),this._toRenderUnit(i)),e.stroke()}_roundedRect(e,r,i,s){r=this._toRenderUnit(r),i=this._toRenderUnit(i);const n=this.renderedWidth,o=this.renderedHeight;s!==0?(s=ve(s,0,Math.floor(o/2)),e.beginPath(),e.moveTo(r,i+s),e.arcTo(r,i,r+s,i,s),e.lineTo(r+n-s,i),e.arcTo(r+n,i,r+n,i+s,s),e.lineTo(r+n,i+o-s),e.arcTo(r+n,i+o,r+n-s,i+o,s),e.lineTo(r+s,i+o),e.arcTo(r,i+o,r,i+o-s,s),e.closePath()):e.rect(r,i,n,o)}_renderHalo(e,r,i,s,n){const o=this.renderedWidth,a=this.renderedHeight,l=Pq(Hle,Math.max(o,sL),Math.max(a,sL)),c=l.getContext("2d");c.clearRect(0,0,o,a),this._setFontProperties(c,this._renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const h=this._renderedHaloSize<3;c.lineJoin=h?"miter":"round",h?this._renderHaloEmulated(c,s,n):this._renderHaloNative(c,s,n);let d=n+this._baselinePosition;for(let f=0;f<this._lines.length;++f){const m=this._getLineXOffset(f);this._renderLineDecoration(c,s+m,d,this._textWidths[f],!0),d+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(l,0,0,o,a,this._toRenderUnit(r),this._toRenderUnit(i),o,a),e.globalAlpha=1}_renderHaloEmulated(e,r,i){i+=this._baselinePosition;for(let s=0;s<this._lines.length;++s){const n=this._lines[s],o=this._getLineXOffset(s);for(const[a,l]of bAe)this._fillText(e,n,r+o+this._haloSize*a,i+this._haloSize*l);i+=this._lineSpacing}}_renderHaloNative(e,r,i){const s=2*this._haloSize;i+=this._baselinePosition;for(let n=0;n<this._lines.length;++n){const o=this._lines[n],a=this._getLineXOffset(n),l=5,c=.1;for(let h=0;h<l;h++){const d=1-(l-1)*c+h*c;e.lineWidth=this._toRenderUnit(d*s),this._strokeText(e,o,r+a,i)}i+=this._lineSpacing}}_setFontProperties(e,r){e.font=this._parameters.fontString(r),e.textAlign="left",e.textBaseline="alphabetic"}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,r,i,s){e.fillText(r,this._toRenderUnit(i),this._toRenderUnit(s))}_strokeText(e,r,i,s){e.strokeText(r,this._toRenderUnit(i),this._toRenderUnit(s))}_drawLine(e,r,i){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),e.lineTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),e.stroke()}_drawBox(e,r,i){const s=this._toRenderUnit(r[0]),n=this._toRenderUnit(r[1]),o=this._toRenderUnit(i[0]),a=this._toRenderUnit(i[1]),l=Math.floor(s)+.5,c=Math.ceil(s+o)-.5,h=Math.floor(n)+.5,d=Math.ceil(n+a)-.5;e.beginPath(),e.moveTo(l,h),e.lineTo(c,h),e.lineTo(c,d),e.lineTo(l,d),e.lineTo(l,h),e.stroke()}};const bAe=[];for(let e=0;e<360;e+=360/16)bAe.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);var rv;function Pq(t,e,r){return t.canvas||(t.canvas=document.createElement("canvas")),t.canvas.width=e,t.canvas.height=r,t.canvas}(function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"})(rv||(rv={}));const Hle={canvas:null},sct=.2,sL=512,qle="rgb(255, 0, 255, 0.5)",nct=(()=>{let t="";for(let e=32;e<127;e++)t+=String.fromCharCode(e);return t})();let oct=class{constructor(e,r,i,s,n){this.paddingTop=e,this.paddingBottom=r,this.lineHeight=i,this.displayWidth=s,this.baselinePosition=n}},act=class{constructor(e,r){this.actualBoundingBoxAscent=e,this.actualBoundingBoxDescent=r}};const Wle=new Map,lct=Object.freeze({left:0,center:.5,right:1}),VN=Object.freeze({"bottom-left":fr(0,0),bottom:fr(.5,0),"bottom-right":fr(1,0),left:fr(0,.5),center:fr(.5,.5),right:fr(1,.5),"top-left":fr(0,1),top:fr(.5,1),"top-right":fr(1,1)});function wAe(t){switch(t){case"left":return rv.Left;case"right":return rv.Right;default:return rv.Center}}function Xle(t){switch(t){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function cct(t){switch(t){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function uct(t,e){switch(e){case"bottom":return t==="left"?"bottom-left":t==="right"?"bottom-right":"bottom";case"center":return t;case"top":return t==="left"?"top-left":t==="right"?"top-right":"top"}}function hct(t){return t==="middle"?"center":t}let eC=class{constructor(e,r={}){this.geometry=e,this.screenToWorldRatio=1,this._transformation=xe(),this._shaderTransformation=null,this._boundingSphere=null,this.id=Ic(),this.layerUid=r.layerUid,this.graphicUid=r.graphicUid,this.shaderTransformer=r.shaderTransformer,this.castShadow=r.castShadow??!1}get transformation(){return this._transformation}get boundingInfo(){return this.geometry.boundingInfo}updateTransformation(e){e(this._transformation),this._shaderTransformation=this._boundingSphere=null}shaderTransformationChanged(){this._shaderTransformation=null}get boundingSphere(){return this._boundingSphere?this._boundingSphere:this.boundingInfo?(this._boundingSphere=ze(xs(),this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*ME(this.shaderTransformation),this._boundingSphere):Ube}get hasShaderTransformation(){return this.shaderTransformer!=null}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this.shaderTransformer==null?this.transformation:(this._shaderTransformation||(this._shaderTransformation=zs(xe(),this.shaderTransformer(this.transformation))),this._shaderTransformation)}get indices(){return this.geometry.indices}get vertexAttributes(){return this.geometry.vertexAttributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}};const dct=xe(),Yle=Pe(0,0,1),pct=16,fct=1.5,ow=nK,mct=[ow/2,ow/2,1-ow/2,1-ow/2],gct=[LM*ow,LM*ow];let Iq=class xAe extends Nm{getCachedSize(){return{size:this._getIconSize()}}constructor(e,r,i,s){super(e,r,i,s),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}async doLoad(e){this._validateOrThrow();const r=this._prepareMaterialParameters(),i=this._getPrimitive();if(i!=null)this._prepareResourcesPrimitive(r,i);else{const s=Blt(this.symbolLayer),n=Iw(s);n&&n.mediaType==="application/json"?await this._prepareResourcesCIM(r,JSON.parse(n.data),e):await this._prepareResourcesHref(r,s,e)}}_validateOrThrow(){if(this._drivenProperties.size)return;const e=v9(this._getIconSize());if(e)throw new U("graphics3diconsymbollayer:invalid-size",e)}_getIconSize(){const e=this.symbolLayer,r=Math.round(e.size!=null?wo(e.size):pct);return this._drivenProperties.size?Math.max(r,64):r}_generateTextureCIM(e){const r=this._getGraphicHash(e);let i=r===""?null:this._cimSymbolTextures.get(r);if(!i){const s={scaleFactor:this._cimScaleFactorOrFunction},n=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol3D(this._cimLayers,e,"esriGeometryPoint",s,void 0,void 0);this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",n.anchorPosition);const o={width:n.imageData.width,height:n.imageData.height};i=new Nx(n.imageData,o),this._cimSymbolTextures.set(r,i),this._context.stage.add(i)}return i}_prepareMaterialParameters(){const e={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},r=this.symbol;if(yct(r)){const{screenLength:i,minWorldLength:s,maxWorldLength:n}=r.verticalOffset;e.verticalOffset={screenLength:wo(i),minWorldLength:s||0,maxWorldLength:n??1/0}}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e.occlusionTest=!0,e.hasSlicePlane=this._context.slicePlaneEnabled,e}_prepareResourcesPrimitive(e,r){const i=this._getOutlineSize();if(Nz(r)&&i===0)throw new Error("Nothing to render");if(this._outlineSize=i,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,this._context.sharedResources.textures!=null){const n=this._context.sharedResources.textures.fromData(`${r}-icon`,()=>Dtt(r));this._texture=n.texture,this._releaseTexture=n,e.textureId=this._texture.id}e.textureIsSignedDistanceField=!0,e.distanceFieldBoundingBox=mct;const s=this._getIconSize();this._size=[s,s],this._symbolTextureRatio=1/ow,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesHref(e,r,i){this._outlineSize=this._getOutlineSize(),e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,e.textureIsSignedDistanceField=!1;const s=this._getIconSize(),n=s*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;if(this._context.sharedResources.textures!=null){const o=await $u(this._context.sharedResources.textures.fromUrl(r,n,{signal:i}));if(o.ok===!1)throw zo(o.error),new U("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${r})`);this._releaseTexture=o.value;const a=o.value.texture,l=a.parameters.width/a.parameters.height;this._size=l>1?[s,Math.round(s/l)]:[Math.round(s*l),s],e.textureId=a.id}this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesCIM(e,r,i){const s=new CC({data:r});if(!this._context.sharedResources.cimSymbolRasterizer){const h=(await he(()=>import("./CIMSymbolRasterizer-1c0cbc8e.js"),["./CIMSymbolRasterizer-1c0cbc8e.js","./cimAnalyzer-a7f2e2eb.js","./TileClipper-ae6eca9e.js","./definitions-c3d21a38.js","./number-e491b09e.js","./BidiEngine-9a40f2f4.js","./imageutils-f3be6792.js","./rasterizingUtils-be9923b0.js"],import.meta.url)).CIMSymbolRasterizer;Yt(i),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new h(this._context.renderCoordsHelper.spatialReference,!0))}const n=this._context.layer.fields?this._context.layer.fields.map(h=>h.toJSON()):null;let o,a;if(this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol3D(s,n,this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:i}),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const h=this._context.renderer;if(isNaN(h.scaleExpression)){const d=h.scaleExpression,f=await K8e(d,this._context.layer.spatialReference,n);a=(m,g,_)=>{const v=ect(f,m,{$view:_},"esriGeometryPoint",g);return v!==null?v:1}}else o=Number(h.scaleExpression)}this._cimScaleFactorOrFunction=o||a||1;const l=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];Yt(i);const c=this._context.layer.fieldsIndex;this._cimRequiredFields=l.map(h=>c.get(h).name),this._cimMaterialParametersInfo=e,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||Gze}_getOutlineSize(){let e=0;const r=this.symbolLayer;return r.outline!=null&&r.outline.size!=null?Math.max(wo(r.outline.size),0):(e=Nz(this._getPrimitive())?fct:0,Math.max(e,0))}_getOutlineColor(){const e=this._getLayerOpacity(),r=this.symbolLayer,i=r?.outline?.color;if(i!=null){const s=ke.toUnitRGB(i),n=i.a*e;return[s[0],s[1],s[2],n]}return[0,0,0,0]}_getFillColor(){if(Nz(this._getPrimitive()))return ict;const e=this._getPrimitive()==null,r=this.symbolLayer?.material?.color;return this._getCombinedOpacityAndColor(r,{hasIntrinsicColor:e})}_getAnchorPos(e,r){return e==="relative"?fr((r.x||0)+.5,.5-(r.y||0)):e in VN?VN[e]:VN.center}_createMaterialAndAddToStage(e,r){if(this._cimLayers){this._fastUpdates=null;let i=e.textureId?this._cimSymbolMaterials.get(e.textureId):null;return i||(i=new YE(e),this._cimSymbolMaterials.set(e.textureId??0,i),r.add(i)),i}return this._fastUpdates=WE(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates&&(e={...e,...this._fastUpdates.materialParameters}),this._material=new YE(e),r.add(this._material),this._material}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(e=>{e.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._material=null,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(e=>this._context.stage.remove(e)),this._cimSymbolTextures.clear(),this._releaseTexture=Gi(this._releaseTexture)}_getScaleFactor(e,r){if(this._drivenProperties.size&&e.size){for(let i=0;i<3;i++){const s=e.size[i];s&&s!=="symbol-value"&&s!=="proportional"&&(e.size[i]=wo(s))}if(e.size[0]==="symbol-value")return 1;if(isFinite(+e.size[0]))return+e.size[0]/r;if(isFinite(+e.size[2]))return+e.size[2]/r}return 1}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry))return null;let i,s=[0,0];if(this._cimLayers){if(!this._cimLayers.length)return null;const d=this._generateTextureCIM(r),f={textureId:d.id,...this._cimMaterialParametersInfo};i=this._createMaterialAndAddToStage(f,this._context.stage),s=[d.parameters.width,d.parameters.height]}else s=this._size,i=this._material;const n=NM(r.geometry);if(n==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${r.geometry.type}`),null;const o=e.renderingInfo,a=this._getVertexOpacityAndColor(o);let l=1;if(!this._fastUpdates?.visualVariables.size){const d=s[0]>s[1]?s[0]:s[1];l=this._getScaleFactor(o,d)}l*=this._symbolTextureRatio;const c=fr(s[0]*l,s[1]*l),h=this.setGraphicElevationContext(r,new Up);return this.ensureDrapedStatus(h.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(r,n,i,a,c,e.layer.uid):this._createAs3DShape(r,n,i,a,c,h,r.uid)}layerOpacityChanged(){const e=this._getFillColor(),r=this._getOutlineColor();this._forEachMaterial(i=>{i.setParameters({color:e}),i.setParameters({outlineColor:r})})}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=HP(xAe.elevationModeChangeTypes,i,s);if(n!==hs.UPDATE)return n;const o=td(s)||s==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(e=>{e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return this._getPrimitive()!=null}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables"||!XE(this._fastUpdates,r,this._fastVisualVariableConvertOptions()))return Us.RecreateSymbol;this._material!=null&&this._material.setParameters(this._fastUpdates.materialParameters)}return Us.FastUpdate}_defaultElevationInfoNoZ(){return _ct}_createAs3DShape(e,r,i,s,n,o,a){const l=this.getFastUpdateAttrValues(e),c=l&&this._fastUpdates?_=>cq(this._fastUpdates.materialParameters,l,_):void 0,h=this._context.layer.uid,d=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:h}),f=LH(i,Yle,null,s,n,vct,null,l,d),m=bK(this._context,r,f,o,a,c);if(m==null)return null;const g=new Dm(this,m.object,[f],null,null,ww,o);return g.alignedSampledElevation=m.sampledElevation,g.needsElevationUpdates=td(o.mode)||o.mode==="absolute-height",g.getScreenSize=this._createScreenSizeGetter(n,c),g.calculateRelativeScreenBounds=_=>i.calculateRelativeScreenBounds(g.getScreenSize(),1,_),DM(g,r,this._context.elevationProvider),g}_createAsOverlay(e,r,i,s,n,o){i.renderPriority=this._renderPriority;const a=Wt();Ao(r,a,this._context.overlaySR),a[2]=GK;const l=this._context.clippingExtent;if(l!=null&&!rJ(l,a))return null;const c=this.getFastUpdateAttrValues(e),h=c&&this._fastUpdates?_=>cq(this._fastUpdates.materialParameters,c,_):void 0,d=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:e.uid,layerUid:this._context.layer.uid}),f=LH(i,Yle,a,s,n,null,null,c,d),m=new eC(f,{layerUid:o,graphicUid:e.uid,shaderTransformer:h}),g=new $9(this,[m],null,this._context.drapeSourceRenderer);return g.getScreenSize=this._createScreenSizeGetter(n,h),g.calculateRelativeScreenBounds=_=>i.calculateRelativeScreenBounds(g.getScreenSize(),1,_),g}_createScreenSizeGetter(e,r){const i=this._outlineSize+2;if(this._fastUpdates&&r){const s=e[0]/this._symbolTextureRatio,n=e[1]/this._symbolTextureRatio;return(o=He())=>{const a=r(dct);return o[0]=a[0]*s+i,o[1]=a[5]*n+i,o}}{const s=e[0]/this._symbolTextureRatio+i,n=e[1]/this._symbolTextureRatio+i;return(o=He())=>(o[0]=s,o[1]=n,o)}}_fastVisualVariableConvertOptions(){const e=Math.max(this._size[0],this._size[1]),r=Pe(e,e,e),i=Wh(1),s=e*i,n=Pe(s,s,s);return new GP({size:!0,color:!0,rotation:!0,opacity:!1},r,n,i)}_getGraphicHash(e){let r="";for(const i of this._cimRequiredFields)r+=i+e.attributes[i];return r}_forEachMaterial(e){this._material!=null&&e(this._material),this._cimSymbolMaterials.forEach(e)}test(){return{...super.test(),material:this._material}}};function yct(t){return t&&t.type==="point-3d"&&t.hasVisibleVerticalOffset()}function Nz(t){return t!=null&&(t==="cross"||t==="x")}Iq.PRIMITIVE_SIZE=gct,Iq.elevationModeChangeTypes={definedChanged:hs.UPDATE,staysOnTheGround:hs.NONE,onTheGroundChanged:hs.RECREATE};const _ct={mode:"relative-to-ground",offset:0},vct=Nt(0,0,0,1);function $q(t){switch(t){case"butt":return Bh.BUTT;case"square":return Bh.SQUARE;case"round":return Bh.ROUND;default:return null}}function Zle(t){return t==="diamond"?"kite":t}function Lq(t,e,r=null){const i=[],s=[],n=e.mapPositions;bct(e,s,i);const o=s[0][1].data,a=i[0][1].length,l=LC(a);return wct(e,s,i,l),Sct(e,s,i,l),xct(e,s,i,l),Tct(e,s,i,l),Ect(e,s,i,l),Cct(e,s,i,l),Act(e,s,i,o),new Ks(t,s,i,n,us.Line,r)}function bct(t,e,r){const{attributeData:{position:i},removeDuplicateStartEnd:s}=t,n=Oct(i)&&s,o=i.length/3-(n?1:0),a=new Array(2*(o-1)),l=n?i.slice(0,i.length-3):i;let c=0;for(let h=0;h<o-1;h++)a[c++]=h,a[c++]=h+1;e.push([C.POSITION,new We(l,3,n)]),r.push([C.POSITION,a])}function wct(t,e,r,i){if(t.attributeData.colorFeature!=null)return;const s=t.attributeData.color;e.push([C.COLOR,new We(s??Lh,4)]),r.push([C.COLOR,i])}function xct(t,e,r,i){if(t.attributeData.normal==null)return;const s=t.attributeData.normal;e.push([C.NORMAL,new We(s,3)]),r.push([C.NORMAL,i])}function Tct(t,e,r,i){t.attributeData.colorFeature!=null&&(e.push([C.COLORFEATUREATTRIBUTE,new We([t.attributeData.colorFeature],1,!0)]),r.push([C.COLOR,i]))}function Sct(t,e,r,i){t.attributeData.sizeFeature==null&&(e.push([C.SIZE,new We([t.attributeData.size??1],1,!0)]),r.push([C.SIZE,i]))}function Ect(t,e,r,i){t.attributeData.sizeFeature!=null&&(e.push([C.SIZEFEATUREATTRIBUTE,new We([t.attributeData.sizeFeature],1,!0)]),r.push([C.SIZEFEATUREATTRIBUTE,i]))}function Cct(t,e,r,i){const s=t.attributeData.opacityFeature;s!=null&&(e.push([C.OPACITYFEATUREATTRIBUTE,new We([s],1,!0)]),r.push([C.OPACITYFEATUREATTRIBUTE,i]))}function Act(t,e,r,i){if(t.overlayInfo==null||t.overlayInfo.renderCoordsHelper.viewingMode!==Ve.Global||!t.overlayInfo.spatialReference.isGeographic)return;const s=Xo(i.length),n=Vr(t.overlayInfo.spatialReference);for(let f=0;f<s.length;f+=3)x8(i,f,s,f,n);const o=i.length/3,a=es(o+1);let l=Rct,c=Mct,h=0,d=0;ne(l,s[d++],s[d++],s[d++]),a[0]=0;for(let f=1;f<o+1;++f)f===o&&(d=0),ne(c,s[d++],s[d++],s[d++]),h+=bxe(l,c),a[f]=h,[l,c]=[c,l];e.push([C.DISTANCETOSTART,new We(a,1,!0)]),r.push([C.DISTANCETOSTART,r[0][1]])}function Oct(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}const Rct=O(),Mct=O();function F7t(t,e){if(t==null||t.length===0)return[];const r=[];return t.forEach(i=>{const s=i.length,n=Xo(3*s);i.forEach((a,l)=>{n[3*l]=a[0],n[3*l+1]=a[1],n[3*l+2]=a[2]});const o={attributeData:{position:n,normal:e},removeDuplicateStartEnd:!1};r.push(o)}),r}function Pct(t,e,r,i){const s=t.type==="polygon"?xm.CCW_IS_HOLE:xm.NONE,n=t.type==="polygon"?t.rings:t.paths,{position:o,outlines:a}=XP(n,!!t.hasZ,s),l=Xo(o.length),c=qEe(o,t.spatialReference,0,l,0,o,0,o.length/3,e,r,i),h=c!=null;return{lines:h?TAe(a,o,l):[],projectionSuccess:h,sampledElevation:c}}function Ict(t,e){const r=t.type==="polygon"?xm.CCW_IS_HOLE:xm.NONE,i=t.type==="polygon"?t.rings:t.paths,{position:s,outlines:n}=XP(i,!1,r),o=ci(s,t.spatialReference,0,s,e,0,s.length/3);for(let a=2;a<s.length;a+=3)s[a]=GK;return{lines:o?TAe(n,s):[],projectionSuccess:o}}function TAe(t,e,r=null){const i=new Array;for(const{index:s,count:n}of t){if(n<=1)continue;const o=3*s,a=3*n;i.push({position:Vh(e,3*s,3*n),mapPositions:r!=null?Vh(r,o,a):void 0})}return i}function $ct(t){const e=new Sr,r=t.hasMultipassTerrain&&(t.output===F.Color||t.output===F.Alpha),i=t.space===Mu.World;e.include(JCe,t),e.include(s3e,t),t.output===F.Depth&&e.include(C0,t);const{vertex:s,fragment:n}=e;return n.include(Bc),Dc(s,t),e.attributes.add(C.POSITION,"vec3"),e.attributes.add(C.UV0,"vec2"),e.attributes.add(C.AUXPOS1,"vec3"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),e.varyings.add("vUV","vec2"),e.varyings.add("vSize","float"),yv(e),r&&e.varyings.add("depth","float"),t.hasTip&&e.varyings.add("vLineWidth","float"),s.uniforms.add(new Ar("nearFar",(o,a)=>a.camera.nearFar),new sr("viewport",(o,a)=>a.camera.fullViewport)),s.code.add(w`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),s.code.add(w`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`),i?(e.attributes.add(C.NORMAL,"vec3"),jE(s),s.constants.add("tiltThreshold","float",.7),s.code.add(w`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):s.code.add(w`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`),s.code.add(w`
      #define vecN ${i?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${i?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${t.anchor===tx.Tip?"pos -= 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `),t.space===Mu.Screen&&(s.uniforms.add(new Ui("inverseProjectionMatrix",(o,a)=>a.camera.inverseProjectionMatrix)),s.code.add(w`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),s.code.add(w`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),s.uniforms.add(new Ie("perScreenPixelRatio",(o,a)=>a.camera.perScreenPixelRatio)),s.code.add(w`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${t.hasCap?`
                if(prev.z > posLeft.z) {
                  vec2 diff = posLeft.xy - posRight.xy;
                  planeOrigin.xy += perpendicular(diff) / 2.0;
                }
              `:""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),zC(s,t),B8(e),s.code.add(w`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position.xyz, 1.0);
vec4 prev = view * vec4(auxpos1.xyz, 1.0);
clip(pos, prev);`),i?(t.hideOnShortSegments&&s.code.add(w`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),s.code.add(w`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(s.code.add(w`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),t.space===Mu.Screen&&s.code.add(w`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`)),s.code.add(w`
        ${r?"depth = pos.z;":""}
        linearDepth = calculateLinearDepth(nearFar,pos.z);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${i?"":"vUV *= displacedPosScreen.w;"}

        ${t.hasTip?"vLineWidth = lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),r&&e.include(Fu,t),e.include(vs,t),n.uniforms.add(new sr("intrinsicColor",o=>o.color),new rt("tex",o=>o.markerTexture)),n.include(Lm),e.constants.add("texelSize","float",1/xw),n.code.add(w`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`),t.hasTip&&(e.constants.add("relativeMarkerSize","float",MK/xw),e.constants.add("relativeTipLineWidth","float",Bnt),n.code.add(w`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${i?"halfTipLineWidth *= fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `)),e.constants.add("symbolAlphaCutoff","float",bo),n.code.add(w`
  void main() {
    discardBySlice(vpos);
    ${r?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${i?"vec2 samplePos = vUV;":"vec2 samplePos = vUV * gl_FragCoord.w;"}

    ${t.hasTip?"finalColor.a *= max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *= markerAlpha(samplePos);"}

    ${t.output===F.ObjectAndLayerIdColor?w`finalColor.a = 1.0;`:""}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${t.output===F.Alpha?w`fragColor = vec4(finalColor.a);`:""}
    ${t.output===F.Color?w`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===F.Color&&t.transparencyPassType===dt.Color?"fragColor = premultiplyAlpha(fragColor);":""}
    ${t.output===F.Highlight?w`fragColor = vec4(1.0);`:""}
    ${t.output===F.Depth?w`outputDepth(linearDepth);`:""}
  }
  `),e}const Lct=Object.freeze(Object.defineProperty({__proto__:null,build:$ct},Symbol.toStringTag,{value:"Module"})),SAe=new Map([[C.POSITION,0],[C.UV0,2],[C.AUXPOS1,3],[C.NORMAL,4],[C.COLOR,5],[C.COLORFEATUREATTRIBUTE,5],[C.SIZE,6],[C.SIZEFEATUREATTRIBUTE,6],[C.OPACITYFEATUREATTRIBUTE,7]]);let EAe=class CAe extends Lr{initializeProgram(e){return new Rr(e.rctx,CAe.shader.get().build(this.configuration),SAe)}_makePipelineState(e,r){const i=this.configuration,s=e===dt.NONE;return Mt({blending:i.output===F.Color||i.output===F.Alpha?s?Ru:V0(e):null,depthTest:{func:Uv(e)},depthWrite:s?i.writeDepth?jl:null:d9(e),colorWrite:Bt,stencilWrite:i.hasOccludees?Tm:null,stencilTest:i.hasOccludees?r?Cv:kv:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=Mt({blending:Ru,depthTest:TF,depthWrite:null,colorWrite:Bt,stencilWrite:null,stencilTest:a3e}),this._occluderPipelineOpaque=Mt({blending:Ru,depthTest:TF,depthWrite:null,colorWrite:Bt,stencilWrite:n3e,stencilTest:o3e}),this._occluderPipelineMaskWrite=Mt({blending:null,depthTest:PK,depthWrite:null,colorWrite:null,stencilWrite:Tm,stencilTest:Cv})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:this.configuration.occluder?e===pe.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===pe.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,r)}};EAe.shader=new Or(Lct,()=>he(()=>import("./LineMarker.glsl-370c5465.js"),[],import.meta.url));let Dct=class extends Fv{constructor(e){super(e,new Fct),this._vertexAttributeLocations=SAe,this._configuration=new po,this._layout=this.createLayout()}dispose(){}getConfiguration(e,r){return this._configuration.output=e,this._configuration.space=r.slot===pe.DRAPED_MATERIAL?Mu.Draped:this.parameters.worldSpace?Mu.World:Mu.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==Bh.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.occluder=this.parameters.renderOccluded===Ni.OccludeAndTransparentStencil,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}intersect(){}createLayout(){const e=qi().vec3f(C.POSITION).vec2f(C.UV0).vec3f(C.AUXPOS1);return this.parameters.worldSpace&&e.vec3f(C.NORMAL),this.parameters.vvSize?e.f32(C.SIZEFEATUREATTRIBUTE):e.f32(C.SIZE),this.parameters.vvColor?e.f32(C.COLORFEATUREATTRIBUTE):e.vec4f(C.COLOR),this.parameters.vvOpacity&&e.f32(C.OPACITYFEATUREATTRIBUTE),e}createBufferWriter(){return new Uct(this._layout,this.parameters)}requiresSlot(e,r){return r===F.Color||r===F.Alpha||r===F.Highlight||r===F.Depth?e===pe.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===Ni.OccludeAndTransparentStencil?e===pe.OPAQUE_MATERIAL||e===pe.OCCLUDER_MATERIAL||e===pe.TRANSPARENT_OCCLUDER_MATERIAL:r===F.Color||r===F.Alpha?e===(this.parameters.writeDepth?pe.TRANSPARENT_MATERIAL:pe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===pe.OPAQUE_MATERIAL:!1}createGLMaterial(e){return new Nct(e)}},Nct=class extends QJ{constructor(){super(...arguments),this._markerPrimitive=null}dispose(){super.dispose(),this._markerTextureRepository.release(this._markerPrimitive),this._markerPrimitive=null}_updateParameters(e){const r=this._material.parameters.markerPrimitive;return r!==this._markerPrimitive&&(this._material.setParameters({markerTexture:this._markerTextureRepository.swap(r,this._markerPrimitive)}),this._markerPrimitive=r),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(EAe,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==F.Color&&this._output!==F.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},Fct=class extends jP{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.markerPrimitive="arrow",this.placement="end",this.cap=Bh.BUTT,this.anchor=tx.Center,this.hasTip=!1,this.worldSpace=!1,this.hideOnShortSegments=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1,this.markerTexture=null}},Uct=class{constructor(e,r){this.vertexBufferLayout=e,this._parameters=r}elementCount(){return this._parameters.placement==="begin-end"?12:6}write(e,r,i,s,n){const o=i.vertexAttributes.get(C.POSITION).data,a=o.length/3;let l=[1,0,0];const c=i.vertexAttributes.get(C.NORMAL);this._parameters.worldSpace&&c!=null&&(l=c.data);let h=1,d=0;this._parameters.vvSize?d=i.vertexAttributes.get(C.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(C.SIZE)&&(h=i.vertexAttributes.get(C.SIZE).data[0]);let f=[1,1,1,1],m=0;this._parameters.vvColor?m=i.vertexAttributes.get(C.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(C.COLOR)&&(f=i.vertexAttributes.get(C.COLOR).data);let g=0;this._parameters.vvOpacity&&(g=i.vertexAttributes.get(C.OPACITYFEATUREATTRIBUTE).data[0]);const _=new Float32Array(s.buffer);let v=n*(this.vertexBufferLayout.stride/4);const b=(E,A,R,M)=>{if(_[v++]=E[0],_[v++]=E[1],_[v++]=E[2],_[v++]=R[0],_[v++]=R[1],_[v++]=A[0],_[v++]=A[1],_[v++]=A[2],this._parameters.worldSpace&&(_[v++]=l[0],_[v++]=l[1],_[v++]=l[2]),this._parameters.vvSize?_[v++]=d:_[v++]=h,this._parameters.vvColor)_[v++]=m;else{const D=Math.min(4*M,f.length-4);_[v++]=f[D],_[v++]=f[D+1],_[v++]=f[D+2],_[v++]=f[D+3]}this._parameters.vvOpacity&&(_[v++]=g)};let T;(function(E){E[E.ASCENDING=1]="ASCENDING",E[E.DESCENDING=-1]="DESCENDING"})(T||(T={}));const x=(E,A)=>{const R=ne(kct,o[3*E],o[3*E+1],o[3*E+2]),M=zct;let D=E+A;do ne(M,o[3*D],o[3*D+1],o[3*D+2]),D+=A;while(nv(R,M)&&D>=0&&D<a);e&&(ze(R,R,e),ze(M,M,e)),b(R,M,[-1,-1],E),b(R,M,[1,-1],E),b(R,M,[1,1],E),b(R,M,[-1,-1],E),b(R,M,[1,1],E),b(R,M,[-1,1],E)},S=this._parameters.placement;S!=="begin"&&S!=="begin-end"||x(0,T.ASCENDING),S!=="end"&&S!=="begin-end"||x(a-1,T.DESCENDING)}};const kct=O(),zct=O(),ra={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},Vct={dash:ra.dash,"dash-dot":[...ra.dash,...ra.dot],dot:ra.dot,"long-dash":ra["long-dash"],"long-dash-dot":[...ra["long-dash"],...ra.dot],"long-dash-dot-dot":[...ra["long-dash"],...ra.dot,...ra.dot],none:null,"short-dash":ra["short-dash"],"short-dash-dot":[...ra["short-dash"],...ra["short-dot"]],"short-dash-dot-dot":[...ra["short-dash"],...ra["short-dot"],...ra["short-dot"]],"short-dot":ra["short-dot"],solid:null},Bct=8;function Gct(t,e){return t==null?t:{pattern:t.slice(),pixelRatio:e}}function B7t(t){return{pattern:[t,t],pixelRatio:2}}function AAe(t){return t!=null&&t.type==="style"?jct(t.style):null}function jct(t){return t!=null?Gct(Vct[t],Bct):null}const Hct=["polyline","polygon","extent"],Jle=new GP({size:!0,color:!0,rotation:!1,opacity:!0});let OAe=class RAe extends Nm{constructor(e,r,i,s){super(e,r,i,s)}async doLoad(){if(this._fastUpdates=WE(this._context.renderer,Jle),!this._drivenProperties.size&&(this.symbolLayer.size!=null?this.symbolLayer.size:Wh(1))<0)throw new U("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values")}_getMaterialParameters(e,r=!1){const i=this._getCombinedOpacityAndColor(r&&this._markerColor||this._materialColor);this._patternHidesLine&&!r&&(i[3]=0);const s={width:this._computeMaterialWidth(this.symbolLayer?.size),color:i,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:$q(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:e,stipplePattern:AAe(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};return this._fastUpdates?.visualVariables?{...s,...this._fastUpdates.materialParameters}:s}get _materialColor(){return this.symbolLayer.material?.color}get _markerColor(){return this.symbolLayer.marker?.color}get _lineMaterial(){return this._lineMaterialCached==null&&(this._lineMaterialCached=new _S(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterialCached)),this._lineMaterialCached}get _ringMaterial(){return this._ringMaterialCached==null&&(this._ringMaterialCached=new _S(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterialCached)),this._ringMaterialCached}get _wireframeLineMaterial(){return this._wireframeLineMaterialCached==null&&(this._wireframeLineMaterialCached=new _S({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._wireframeLineMaterialCached)),this._wireframeLineMaterialCached}get _wireframeRingMaterial(){return this._wireframeRingMaterialCached==null&&(this._wireframeRingMaterialCached=new _S({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._wireframeRingMaterialCached)),this._wireframeRingMaterialCached}get _markerMaterial(){return this._markerMaterialCached==null&&this.symbolLayer.marker!=null&&(this._markerMaterialCached=new Dct({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,markerPrimitive:Zle(this.symbolLayer.marker.style)}),this._context.stage.add(this._markerMaterialCached)),this._markerMaterialCached}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._lineMaterialCached=null,this._ringMaterialCached=null,this._wireframeLineMaterialCached=null,this._wireframeRingMaterialCached=null,this._markerMaterialCached=null}_getDrivenSize(e){return this._drivenProperties.size&&e.size?wo(dnt(e.size)):1}_getDrivenColor(e){const r=Nt(1,1,1,1);return this._drivenProperties.color&&e.color&&(r[0]=e.color[0],r[1]=e.color[1],r[2]=e.color[2],e.color.length>0&&(r[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(r[3]=e.opacity),r}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,Hct,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new Up);return this.ensureDrapedStatus(i.mode==="on-the-ground"),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,i,r.uid)}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables")return Us.RecreateSymbol;{const s=this._fastUpdates;if(!XE(s,r,Jle))return Us.RecreateSymbol;this._forEachMaterial(n=>n.setParameters(s.materialParameters))}}return Us.FastUpdate}prepareSymbolLayerPatch(e){if(e.diff.type!=="partial")return;const r=e.diff.diff,i={};r.size?.type==="complete"&&(i.width=this._computeMaterialWidth(r.size.newValue),delete r.size),r.cap?.type==="complete"&&(i.cap=$q(r.cap.newValue??"butt"),delete r.cap);const s=this._prepareMarkerPatch(e,r);this._prepareMaterialPatch(e,r,s),e.symbolLayerStatePatches.push(()=>this._forEachMaterial(n=>n.setParameters(i)))}layerOpacityChanged(){this._forEachMaterial((e,r)=>this._updateMaterialLayerOpacity(e,r))}_forEachMaterial(e){this._lineMaterialCached!=null&&e(this._lineMaterialCached),this._ringMaterialCached!=null&&e(this._ringMaterialCached),this._wireframeLineMaterialCached!=null&&e(this._wireframeLineMaterialCached),this._wireframeRingMaterialCached!=null&&e(this._wireframeRingMaterialCached),this._markerMaterialCached!=null&&e(this._markerMaterialCached,!0)}_updateMaterialLayerOpacity(e,r=!1){const i=e.parameters.color,s=this.symbolLayer?.material?.color,n=this._patternHidesLine&&!r?0:this._getCombinedOpacity(s),o=Nt(i[0],i[1],i[2],n);e.setParameters({color:o})}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=HP(RAe.elevationModeChangeTypes,i,s);if(n!==hs.UPDATE)return n;const o=td(s);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){const e={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(r=>r.setParameters(e)),!0}physicalBasedRenderingChanged(){return!0}_getGeometryAsPolygonOrPolyline(e){switch(e.type){case"extent":if(e instanceof cr)return Su.fromExtent(e);break;case"polygon":case"polyline":return e}return null}_createAs3DShape(e,r,i){const s=e.graphic,n=this._getGeometryAsPolygonOrPolyline(s.geometry),o=n.type==="polygon"?n.rings:n.paths,a=new Array,l=gn(),c=Pct(n,this._context.elevationProvider,this._context.renderCoordsHelper,r),h=n.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(c,o,h,"LineSymbol3DLayer");for(let m=0;m<c.lines.length;m++){const g=c.lines[m],_=g.position,v=g.mapPositions;if(this._context.clippingExtent!=null&&(Ei(l),Tu(l,v),!dp(l,this._context.clippingExtent)))continue;const b=this._createGeometry(n.type==="polygon"?this._ringMaterial:this._lineMaterial,e,_,v,n.type,NR.ELEVATED,i);a.push(b),li.LINE_WIREFRAMES&&a.push(b.instantiate({material:n.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial})),this._markerMaterial!=null&&a.push(b.instantiate({material:this._markerMaterial}))}if(a.length===0)return null;const d=new B0({geometries:a,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:i}),f=new Dm(this,d,a,null,null,Lit,r);return f.alignedSampledElevation=c.sampledElevation,f.needsElevationUpdates=td(r.mode),f}_createGeometry(e,r,i,s,n,o,a){const l=o===NR.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,c=n==="polygon",h=this._fastUpdates?.visualVariables.color,d=this._fastUpdates?.visualVariables.size,f=this._fastUpdates?.visualVariables.opacity,m=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:this._context.layer.uid}),g={position:i,size:d?null:this._getDrivenSize(r.renderingInfo),color:h?null:this._getDrivenColor(r.renderingInfo),sizeFeature:d?Tp(d.field,r.graphic):null,colorFeature:h?Tp(h.field,r.graphic):null,opacityFeature:f?Tp(f.field,r.graphic):null};return Lq(e,{overlayInfo:l,removeDuplicateStartEnd:c,mapPositions:s,attributeData:g},m)}_createAsOverlay(e,r){const i=e.graphic,s=this._getGeometryAsPolygonOrPolyline(i.geometry),n=s.type==="polygon"?s.rings:s.paths,o=s.type==="polygon"?this._ringMaterial:this._lineMaterial;o.renderPriority=this._renderPriority;const a=li.LINE_WIREFRAMES?s.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial:null,l=this._markerMaterial;a!=null&&(a.renderPriority=this._renderPriority-.001),l!=null&&(l.renderPriority=this._renderPriority-.002);const c=new Array,h=gn(),d=Ei(),f=Ict(s,this._context.overlaySR),m=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(f,n,m,"LineSymbol3DLayer");for(const g of f.lines){if(Ei(h),Tu(h,g.position),!dp(h,this._context.clippingExtent))continue;xE(d,h);const _=v=>{const b=this._createGeometry(v,e,g.position,void 0,s.type,NR.DRAPED,i.uid),T=new eC(b,{layerUid:r,graphicUid:i.uid});c.push(T)};if(l!=null){_(l);const v=this.symbolLayer.marker.placement;v!=="begin"&&v!=="begin-end"||Tu(h,g.position,0,1),v!=="end"&&v!=="begin-end"||Tu(h,g.position,g.position.length-3,1)}_(o),li.LINE_WIREFRAMES&&_(a)}return new $9(this,c,d,this._context.drapeSourceRenderer)}get _patternHidesLine(){const e=this.symbolLayer.pattern;return e!=null&&e.type==="style"&&e.style==="none"}_computeMaterialWidth(e){return e=e??Wh(1),this._drivenProperties.size?this._fastUpdates?.visualVariables.size?wo(1):1:wo(e)}_prepareMaterialPatch(e,r,i){const s=r.material;if(s==null)return void(i.changed&&i.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._markerMaterialCached,e));if(s.type==="collection")return;const n=s.type==="complete"?s.newValue?.color:s.diff.color?.type==="complete"?s.diff.color.newValue:null,o=this._getCombinedOpacityAndColor(n);i.useMaterialColor&&this._patchMaterialColor(OP(o),this._markerMaterialCached,e),this._patternHidesLine&&(o[3]=0),this._patchMaterialColor(o,this._lineMaterialCached,e),delete r.material}_prepareMarkerPatch(e,r){const i=r.marker,s=this._markerMaterial;if(i==null||i.type!=="partial"||i.diff==null||i.diff.placement!=null||i.diff.style!=null&&i.diff.style.type!=="complete"||i.diff.color!=null&&i.diff.color.type!=="complete"||s==null)return{changed:!1,useMaterialColor:this._markerColor==null};const n=i.diff.color,o=n!=null,a=o?n.newValue:null,l=a==null&&this._markerColor==null;a&&this._patchMaterialColor(this._getCombinedOpacityAndColor(a),s,e);const c=i.diff.style?.newValue;return c&&e.symbolLayerStatePatches.push(()=>s.setParameters({markerPrimitive:Zle(c)})),delete r.marker,{changed:o,useMaterialColor:l}}_patchMaterialColor(e,r,i){r!=null&&i.symbolLayerStatePatches.push(()=>r.setParameters({color:e}))}};var NR;OAe.elevationModeChangeTypes={definedChanged:hs.RECREATE,staysOnTheGround:hs.NONE,onTheGroundChanged:hs.RECREATE},function(t){t[t.DRAPED=0]="DRAPED",t[t.ELEVATED=1]="ELEVATED"}(NR||(NR={}));let $3=null,AF=!0;function Fz(t,e,r){if(!t||!e)throw new Error("Cannot construct image data without dimensions");if(AF)try{return new ImageData(t,e)}catch{AF=!1}return MAe(t,e,r)}function qct(t,e,r,i){if(!e||!r)throw new Error("Cannot construct image data without dimensions");if(AF)try{return new ImageData(t,e,r)}catch{AF=!1}const s=MAe(e,r,i);return s.data.set(t,0),s}function Wct(){return $3||($3=document.createElement("canvas"),$3.width=1,$3.height=1),$3}function MAe(t,e,r){return r||(r=Wct()),r.getContext("2d").createImageData(t,e)}var C2;const Uz=new WeakMap;let Xct=0,Tf=C2=class extends ue{constructor(t){super(t),this.wrap="repeat"}get url(){return this._get("url")||null}set url(t){this._set("url",t),t&&this._set("data",null)}get data(){return this._get("data")||null}set data(t){this._set("data",t),t&&this._set("url",null)}writeData(t,e,r,i){if(t instanceof HTMLImageElement){const s={type:"image-element",src:v0(t.src,i),crossOrigin:t.crossOrigin};e[r]=s}else if(t instanceof HTMLCanvasElement){const s=t.getContext("2d").getImageData(0,0,t.width,t.height),n={type:"canvas-element",imageData:this._encodeImageData(s)};e[r]=n}else if(t instanceof HTMLVideoElement){const s={type:"video-element",src:v0(t.src,i),autoplay:t.autoplay,loop:t.loop,muted:t.muted,crossOrigin:t.crossOrigin,preload:t.preload};e[r]=s}else if(t instanceof ImageData){const s={type:"image-data",imageData:this._encodeImageData(t)};e[r]=s}}readData(t){switch(t.type){case"image-element":{const e=new Image;return e.src=t.src,e.crossOrigin=t.crossOrigin,e}case"canvas-element":{const e=this._decodeImageData(t.imageData),r=document.createElement("canvas");return r.width=e.width,r.height=e.height,r.getContext("2d").putImageData(e,0,0),r}case"image-data":return this._decodeImageData(t.imageData);case"video-element":{const e=document.createElement("video");return e.src=t.src,e.crossOrigin=t.crossOrigin,e.autoplay=t.autoplay,e.loop=t.loop,e.muted=t.muted,e.preload=t.preload,e}default:return}}get transparent(){const t=this.data,e=this.url;if(t instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(t.getContext("2d").getImageData(0,0,t.width,t.height));if(t instanceof ImageData)return this._imageDataContainsTransparent(t);if(e){const r=e.substr(e.length-4,4).toLowerCase(),i=e.substr(0,15).toLocaleLowerCase();if(r===".png"||i==="data:image/png;")return!0}return!1}set transparent(t){this._overrideIfSome("transparent",t)}get contentHash(){const t=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",e=(r="")=>`d:${r},t:${this.transparent},w:${t}`;return this.url!=null?e(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?e(this.data.src):(Uz.has(this.data)||Uz.set(this.data,++Xct),e(Uz.get(this.data))):e()}get memoryUsage(){let t=0;if(t+=this.url!=null?this.url.length:0,this.data!=null){const e=this.data;"data"in e?t+=e.data.byteLength:e instanceof HTMLImageElement?t+=e.naturalWidth*e.naturalHeight*3:e instanceof HTMLCanvasElement&&(t+=e.width*e.height*3)}return t}clone(){const t={url:this.url,data:this.data,wrap:this._cloneWrap()};return new C2(t)}cloneWithDeduplication(t){const e=t.get(this);if(e)return e;const r=this.clone();return t.set(this,r),r}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(t){let e="";for(let r=0;r<t.data.length;r++)e+=String.fromCharCode(t.data[r]);return{data:btoa(e),width:t.width,height:t.height}}_decodeImageData(t){const e=atob(t.data),r=new Uint8ClampedArray(e.length);for(let i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return qct(r,t.width,t.height)}_imageDataContainsTransparent(t){for(let e=3;e<t.data.length;e+=4)if(t.data[e]!==255)return!0;return!1}static from(t){return typeof t=="string"?new C2({url:t}):t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData||t instanceof HTMLVideoElement?new C2({data:t}):Mw(C2,t)}};u([p({type:String,json:{write:uv}})],Tf.prototype,"url",null),u([p({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),p()],Tf.prototype,"data",null),u([Be("data")],Tf.prototype,"writeData",null),u([Oe("data")],Tf.prototype,"readData",null),u([p({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],Tf.prototype,"transparent",null),u([p({json:{write:!0}})],Tf.prototype,"wrap",void 0),u([p({readOnly:!0})],Tf.prototype,"contentHash",null),Tf=C2=u([P("esri.geometry.support.MeshTexture")],Tf);const FR=Tf;let A2=class extends Hi(ue){constructor(e){super(e),this.offset=[0,0],this.rotation=0,this.scale=[1,1]}};u([p({type:[Number],nonNullable:!0,json:{write:!0}})],A2.prototype,"offset",void 0),u([p({type:Number,nonNullable:!0,json:{write:!0}})],A2.prototype,"rotation",void 0),u([p({type:[Number],nonNullable:!0,json:{write:!0}})],A2.prototype,"scale",void 0),A2=u([P("esri.geometry.support.MeshTextureTransform")],A2);const HS=A2;var Dq;let $d=Dq=class extends ue{constructor(t){super(t),this.color=null,this.colorTexture=null,this.colorTextureTransform=null,this.normalTexture=void 0,this.normalTextureTransform=void 0,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const r=t!=null?t.get(this):null;if(r)return r;const i=new Dq(this.clonePropertiesWithDeduplication(e));return t?.set(this,i),i}clonePropertiesWithDeduplication(t){return{color:this.color!=null?this.color.clone():null,colorTexture:this.colorTexture?.cloneWithDeduplication(t),normalTexture:this.normalTexture?.cloneWithDeduplication(t),alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:this.colorTextureTransform?.clone(),normalTextureTransform:this.normalTextureTransform?.clone()}}get memoryUsage(){return this.getMemoryUsage()}getMemoryUsage(){let t=0;return t+=this.color!=null?16:0,this.colorTexture!=null&&(t+=this.colorTexture.memoryUsage),t+=this.colorTextureTransform!=null?20:0,this.normalTexture!=null&&(t+=this.normalTexture.memoryUsage),t+=this.normalTextureTransform!=null?20:0,t}};u([p({type:ke,json:{write:!0}})],$d.prototype,"color",void 0),u([p({type:FR,json:{write:!0}})],$d.prototype,"colorTexture",void 0),u([p({type:HS,json:{write:!0}})],$d.prototype,"colorTextureTransform",void 0),u([p({type:FR,json:{write:!0}})],$d.prototype,"normalTexture",void 0),u([p({type:HS,json:{write:!0}})],$d.prototype,"normalTextureTransform",void 0),u([p({nonNullable:!0,json:{write:!0}})],$d.prototype,"alphaMode",void 0),u([p({nonNullable:!0,json:{write:!0}})],$d.prototype,"alphaCutoff",void 0),u([p({nonNullable:!0,json:{write:!0}})],$d.prototype,"doubleSided",void 0),$d=Dq=u([P("esri.geometry.support.MeshMaterial")],$d);const KK=$d;var Nq;let uh=Nq=class extends KK{constructor(t){super(t),this.emissiveColor=null,this.emissiveTexture=null,this.emissiveTextureTransform=void 0,this.occlusionTexture=null,this.occlusionTextureTransform=void 0,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null,this.metallicRoughnessTextureTransform=void 0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const r=t!=null?t.get(this):null;if(r)return r;const i=new Nq(this.clonePropertiesWithDeduplication(e));return t?.set(this,i),i}getMemoryUsage(){let t=super.getMemoryUsage();return t+=this.emissiveColor!=null?16:0,this.emissiveTexture!=null&&(t+=this.emissiveTexture.memoryUsage),t+=this.emissiveTextureTransform!=null?20:0,this.occlusionTexture!=null&&(t+=this.occlusionTexture.memoryUsage),t+=this.occlusionTextureTransform!=null?20:0,this.metallicRoughnessTexture!=null&&(t+=this.metallicRoughnessTexture.memoryUsage),t+=this.metallicRoughnessTextureTransform!=null?20:0,t}clonePropertiesWithDeduplication(t){return{...super.clonePropertiesWithDeduplication(t),emissiveColor:this.emissiveColor?.clone(),emissiveTexture:this.emissiveTexture?.cloneWithDeduplication(t),emissiveTextureTransform:this.emissiveTextureTransform?.clone(),occlusionTexture:this.occlusionTexture?.cloneWithDeduplication(t),occlusionTextureTransform:this.occlusionTextureTransform?.clone(),metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:this.metallicRoughnessTexture?.cloneWithDeduplication(t),metallicRoughnessTextureTransform:this.metallicRoughnessTextureTransform?.clone()}}};u([p({type:ke,json:{write:!0}})],uh.prototype,"emissiveColor",void 0),u([p({type:FR,json:{write:!0}})],uh.prototype,"emissiveTexture",void 0),u([p({type:HS,json:{write:!0}})],uh.prototype,"emissiveTextureTransform",void 0),u([p({type:FR,json:{write:!0}})],uh.prototype,"occlusionTexture",void 0),u([p({type:HS,json:{write:!0}})],uh.prototype,"occlusionTextureTransform",void 0),u([p({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],uh.prototype,"metallic",void 0),u([p({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],uh.prototype,"roughness",void 0),u([p({type:FR,json:{write:!0}})],uh.prototype,"metallicRoughnessTexture",void 0),u([p({type:HS,json:{write:!0}})],uh.prototype,"metallicRoughnessTextureTransform",void 0),uh=Nq=u([P("esri.geometry.support.MeshMaterialMetallicRoughness")],uh);const PAe=uh;var BN;const IAe="esri.geometry.support.MeshVertexAttributes",xT=K.getLogger(IAe);let qu=BN=class extends ue{constructor(t){super(t),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(t){return O2(t,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},xT)}castPosition(t){return t&&t instanceof Float32Array&&xT.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),O2(t,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},xT)}castUv(t){return O2(t,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},xT)}castNormal(t){return O2(t,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},xT)}castTangent(t){return O2(t,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},xT)}clone(){const t={position:ee(this.position),uv:ee(this.uv),normal:ee(this.normal),tangent:ee(this.tangent),color:ee(this.color)};return new BN(t)}clonePositional(){const t={position:ee(this.position),normal:ee(this.normal),tangent:ee(this.tangent),uv:this.uv,color:this.color};return new BN(t)}get memoryUsage(){let t=0;return t+=this.position.byteLength,this.uv!=null&&(t+=this.uv.byteLength),this.normal!=null&&(t+=this.normal.byteLength),this.tangent!=null&&(t+=this.tangent.byteLength),this.color!=null&&(t+=this.color.byteLength),t}};function kz(t,e,r,i){const{loggerTag:s,stride:n}=e;return t.length%n!=0?(i.error(s,`Invalid array length, expected a multiple of ${n}`),new r([])):t}function O2(t,e,r,i,s){if(!t)return t;if(t instanceof e)return kz(t,i,e,s);for(const n of r)if(t instanceof n)return kz(new e(t),i,e,s);if(Array.isArray(t))return kz(new e(t),i,e,s);{const n=r.map(o=>`'${o.name}'`);return s.error(`Failed to set property, expected one of ${n}, but got ${t.constructor.name}`),new e([])}}function L3(t,e,r){e[r]=Yct(t)}function Yct(t){const e=new Array(t.length);for(let r=0;r<t.length;r++)e[r]=t[r];return e}u([p({json:{write:L3}})],qu.prototype,"color",void 0),u([wr("color")],qu.prototype,"castColor",null),u([p({nonNullable:!0,json:{write:L3}})],qu.prototype,"position",void 0),u([wr("position")],qu.prototype,"castPosition",null),u([p({json:{write:L3}})],qu.prototype,"uv",void 0),u([wr("uv")],qu.prototype,"castUv",null),u([p({json:{write:L3}})],qu.prototype,"normal",void 0),u([wr("normal")],qu.prototype,"castNormal",null),u([p({json:{write:L3}})],qu.prototype,"tangent",void 0),u([wr("tangent")],qu.prototype,"castTangent",null),qu=BN=u([P(IAe)],qu);var _O;const $Ae="esri.geometry.support.MeshComponent",Zct=K.getLogger($Ae);let gg=_O=class extends ue{static from(t){return Mw(_O,t)}constructor(t){super(t),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}castFaces(t){return O2(t,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},Zct)}castMaterial(t){return Mw(t&&typeof t=="object"&&("metallic"in t||"roughness"in t||"metallicRoughnessTexture"in t)?PAe:KK,t)}clone(){return new _O({faces:ee(this.faces),shading:this.shading,material:ee(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(t,e){const r={faces:ee(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(t,e):null,trustSourceNormals:this.trustSourceNormals};return new _O(r)}get memoryUsage(){let t=0;return this.faces!=null&&(t+=this.faces.byteLength),this.material!=null&&(t+=this.material.memoryUsage),t}};u([p({json:{write:!0}})],gg.prototype,"faces",void 0),u([wr("faces")],gg.prototype,"castFaces",null),u([p({type:KK,json:{write:!0}})],gg.prototype,"material",void 0),u([wr("material")],gg.prototype,"castMaterial",null),u([p({type:String,json:{write:!0}})],gg.prototype,"shading",void 0),u([p({type:Boolean})],gg.prototype,"trustSourceNormals",void 0),gg=_O=u([P($Ae)],gg);const Jct=gg,L9=K.getLogger("esri.geometry.support.meshUtils.normalProjection");function Qct(t,e,r,i,s){return N9(i)?(D9(n0.TO_PCPF,mn.fromTypedArray(t),Kh.fromTypedArray(e),Kh.fromTypedArray(r),i,mn.fromTypedArray(s)),s):(L9.error("Cannot convert spatial reference to PCPF"),s)}function j7t(t,e,r,i,s){return N9(i)?(D9(n0.FROM_PCPF,mn.fromTypedArray(t),Kh.fromTypedArray(e),Kh.fromTypedArray(r),i,mn.fromTypedArray(s)),s):(L9.error("Cannot convert to spatial reference from PCPF"),s)}function H7t(t,e,r){return ci(t,e,0,r,_m(e),0,t.length/3),r}function q7t(t,e,r){return ci(t,_m(r),0,e,r,0,t.length/3),e}function Kct(t,e,r){return gv(Yn,r),ex(e,t,Yn),oQ(Yn)||T9(e,e),e}function eut(t,e,r){if(gv(Yn,r),ex(e,t,Yn,4),oQ(Yn)||T9(e,e,4),t!==e)for(let i=3;i<t.length;i+=4)e[i]=t[i];return e}function tut(t,e,r,i,s){if(!N9(i))return L9.error("Cannot convert spatial reference to PCPF"),s;D9(n0.TO_PCPF,mn.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),Kh.fromTypedArray(e),Kh.fromTypedArray(r),i,mn.fromTypedArray(s,4*Float32Array.BYTES_PER_ELEMENT));for(let n=3;n<t.length;n+=4)s[n]=t[n];return s}function W7t(t,e,r,i,s){if(!N9(i))return L9.error("Cannot convert to spatial reference from PCPF"),s;D9(n0.FROM_PCPF,mn.fromTypedArray(t,16),Kh.fromTypedArray(e),Kh.fromTypedArray(r),i,mn.fromTypedArray(s,16));for(let n=3;n<t.length;n+=4)s[n]=t[n];return s}function D9(t,e,r,i,s,n){if(!e)return;const o=r.count,a=_m(s);if(LAe(s))for(let l=0;l<o;l++)i.getVec(l,nL),e.getVec(l,Kp),Fl(a,nL,oL,a),Jh(Yn,oL),t===n0.FROM_PCPF&&Qh(Yn,Yn),Oc(Kp,Kp,Yn),n.setVec(l,Kp);else for(let l=0;l<o;l++){i.getVec(l,nL),e.getVec(l,Kp),Fl(a,nL,oL,a),Jh(Yn,oL);const c=r5(r.get(l,1));let h=Math.cos(c);t===n0.TO_PCPF&&(h=1/h),Yn[0]*=h,Yn[1]*=h,Yn[2]*=h,Yn[3]*=h,Yn[4]*=h,Yn[5]*=h,t===n0.FROM_PCPF&&Qh(Yn,Yn),Oc(Kp,Kp,Yn),_e(Kp,Kp),n.setVec(l,Kp)}return n}function N9(t){return LAe(t)||rut(t)}function LAe(t){return t.isWGS84||H0e(t)||Om(t)||Rm(t)}function rut(t){return t.isWebMercator}var n0;(function(t){t[t.TO_PCPF=0]="TO_PCPF",t[t.FROM_PCPF=1]="FROM_PCPF"})(n0||(n0={}));const nL=O(),Kp=O(),oL=xe(),Yn=ki();var UR;(function(t){t[t.EnableFastUpdates=0]="EnableFastUpdates",t[t.DisableFastUpdates=1]="DisableFastUpdates",t[t.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin"})(UR||(UR={}));let DAe=class{constructor(e){this.data=e,this.type="encoded-mesh-texture",this.encoding=e0.KTX2_ENCODING}};function Ew(t){return t?.type==="encoded-mesh-texture"}async function iut(t){return new Promise((e,r)=>{const i=new Blob([t]),s=new FileReader;s.onload=()=>{const n=s.result;e(JSON.parse(n))},s.onerror=n=>{r(n)},s.readAsText(i)})}async function sut(t,e){return e===e0.KTX2_ENCODING?new DAe(t):new Promise((r,i)=>{const s=new Blob([t],{type:e}),n=URL.createObjectURL(s),o=new Image,a=()=>{URL.revokeObjectURL(n),"decode"in o?o.decode().then(()=>r(o),()=>r(o)).then(c):(r(o),c())},l=h=>{URL.revokeObjectURL(n),i(h),c()},c=()=>{o.removeEventListener("load",a),o.removeEventListener("error",l)};o.addEventListener("load",a),o.addEventListener("error",l),o.src=n})}function Bf(t){if(t==null)return null;const e=t.offset!=null?t.offset:yCe,r=t.rotation!=null?t.rotation:0,i=t.scale!=null?t.scale:_Ce,s=zN(1,0,0,0,1,0,e[0],e[1],1),n=zN(Math.cos(r),-Math.sin(r),0,Math.sin(r),Math.cos(r),0,0,0,1),o=zN(i[0],0,0,0,i[1],0,0,0,1),a=kl();return UE(a,n,o),UE(a,s,a),a}K.getLogger("esri.views.3d.layers.graphics.Graphics3DMeshObject3DGraphicLayer");let nut=class extends Dm{constructor(){super(...arguments),this._originalGeometries=[],this._fastTransformUpdatesEnabled=!1}get fastTransformUpdatesEnabled(){return this._fastTransformUpdatesEnabled}enableFastTransformUpdates(e,r){if(this._fastTransformUpdatesEnabled)return;this._fastTransformUpdatesEnabled=!0;const{stageObject:i}=this,s=i.geometries.slice();i.removeAllGeometries();const n=QG(zz,i.transformation),o=r.getOrigin(n);for(const a of s){const l=e(a.material),c=a.instantiate({material:l});c.localOrigin=o,i.addGeometry(c)}this._originalGeometries=s}disableFastTransformUpdates(e){if(!this._fastTransformUpdatesEnabled)return;this._fastTransformUpdatesEnabled=!1;const{stageObject:r}=this,i=r.geometries.map(s=>e(s.material));r.removeAllGeometries();for(let s=0;s<this._originalGeometries.length;s++){const n=this._originalGeometries[s],o=i[s];o.setParameters({modelTransformation:null}),o===n.material?r.addGeometry(n):r.addGeometry(n.instantiate({material:o}))}this._originalGeometries.length=0}updateFastLocalOrigin(e,r,i){if(!this._fastTransformUpdatesEnabled)return;const{stageObject:s}=this;if(s.geometries.length===0)return;const n=s.geometries[0].localOrigin,o=QG(zz,e),a=i.getOrigin(o);if(a===n)return;const l=r?.localMatrix??pn;s.clearShaderTransformation(),s.transformation=e,s.geometries.forEach(c=>{c.transformation=l,c.localOrigin=a})}updateTransform(e,r,i){const{stageObject:s}=this,n=r?.localMatrix??pn;if(!this._fastTransformUpdatesEnabled)return s.clearShaderTransformation(),s.transformation=e,s.geometries.forEach(m=>{m.transformation=n}),void this.resetEdgeObject(i);const o=s.transformation,a=s.geometries[0].transformation,l=e,c=n,h=ai(Qle,o,a),d=ai(Kle,l,c);s.shaderTransformation=l,this._setFastMaterialTransformation({matA:h,matB:d});const f=()=>c;for(const m of s.geometries)m.shaderTransformer=f;this.resetEdgeObject(i)}alignWithElevation(e,r,i,s){if(!this._fastTransformUpdatesEnabled)return void super.alignWithElevation(e,r,i,s);i!=null&&b9(this.elevationContext.featureExpressionInfoContext,i);const n=(m,g)=>xv(m,e,this.elevationContext,r,g),{stageObject:o}=this;if(!o.geometries[0].material.parameters.modelTransformation)return;const a=o.transformation,l=o.geometries[0].transformation,c=ai(Qle,a,l),h=zs(out,o.shaderTransformation);this.alignedSampledElevation=ww(this,this.elevationContext,e.spatialReference,n,r,h),o.shaderTransformation=h;const d=o.geometries[0].shaderTransformation,f=ai(Kle,h,d);this._setFastMaterialTransformation({matA:c,matB:f}),this.resetEdgeObject(s)}_setFastMaterialTransformation({matA:e,matB:r}){const{stageObject:i}=this;if(i.geometries.length===0)return;const s=i.geometries[0].localOrigin,n=CP(aut,se(zz,s.vec3,-1)),o=ai(ece,n,e),a=ai(tce,n,r),l=$n(ece,o),c=ai(tce,a,l);for(const h of i.geometries)h.material.setParameters({modelTransformation:c})}};const zz=O(),Qle=xe(),Kle=xe(),out=xe(),ece=xe(),tce=xe(),aut=xe();let lut=class{constructor(){this._fastTransformOriginalMaterials=new Map,this._fastTransformClonedMaterials=new Map,this._graphicReferenceCount=0}enable(e,r,i){e.enableFastTransformUpdates(s=>{if(this._graphicReferenceCount<=1){if(this._fastTransformOriginalMaterials.has(s))return s;const o=r.byMaterial(s);return this._fastTransformOriginalMaterials.set(s,o),r.delete(s),s}const n=new Sm(s.parameters);return i.stage.add(n),this._fastTransformClonedMaterials.set(n,s),n},i.localOriginFactory)}disable(e,r,i){const s=new Set,n=new Set;e.disableFastTransformUpdates(o=>{if(!this._fastTransformClonedMaterials.has(o)){const c=o,h=this._fastTransformOriginalMaterials.get(c);return r.has(h.uid)?(s.add(c),r.byUid(h.uid).material):(n.add(c),h.material)}const a=o,l=this._fastTransformClonedMaterials.get(a);return this._fastTransformClonedMaterials.delete(a),i.stage.remove(a),a.dispose(),l});for(const o of s)this._fastTransformOriginalMaterials.delete(o),i.stage.remove(o),o.dispose();for(const o of n){const a=this._fastTransformOriginalMaterials.get(o);this._fastTransformOriginalMaterials.delete(o),r.set(a.uid,a)}}onAddGraphic(){this._graphicReferenceCount++}onRemoveGraphic(e,r,i){this._graphicReferenceCount--,this.disable(e,r,i)}forEachMaterialInfo(e){this._fastTransformOriginalMaterials.forEach(e)}forEachClonedMaterial(e){this._fastTransformClonedMaterials.forEach(e)}destroy(e){e.removeMany(Array.from(this._fastTransformClonedMaterials.keys())),e.removeMany(Array.from(this._fastTransformOriginalMaterials.values(),({material:r})=>r)),this._fastTransformClonedMaterials.clear(),this._fastTransformOriginalMaterials.clear()}},cut=class{constructor(){this._byUid=new Map,this._byMaterial=new Map}get materials(){return Array.from(this._byUid.values(),e=>e.material)}byUid(e){return this._byUid.get(e)}byMaterial(e){return this._byMaterial.get(e)}set(e,r){this._byUid.set(e,r),this._byMaterial.set(r.material,r)}delete(e){const r=this._byMaterial.get(e)?.uid;r&&(this._byUid.delete(r),this._byMaterial.delete(e))}has(e){return this._byUid.has(e)}forEachMaterialInfo(e){this._byUid.forEach(e)}clear(){this._byUid.clear(),this._byMaterial.clear()}};function uut(t){const e=new Sr,{vertex:r,fragment:i}=e;return e.include(Nl,t),e.include(Ux,t),e.include(r3e,t),Dc(r,t),t.stippleEnabled&&(e.attributes.add(C.UV0,"vec2"),e.attributes.add(C.AUXPOS1,"vec3"),r.uniforms.add(new sr("viewport",(s,n)=>n.camera.fullViewport))),e.attributes.add(C.POSITION,"vec3"),e.varyings.add("vpos","vec3"),r.code.add(w`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),t.stippleEnabled&&(r.code.add(w`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),t.draped?r.uniforms.add(new Ie("worldToScreenRatio",(s,n)=>1/n.screenToPCSRatio)):r.code.add(w`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),r.code.add(w`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),t.draped?r.code.add(w`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):r.code.add(w`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),r.uniforms.add(new Ie("stipplePatternPixelSize",s=>RK(s))),r.code.add(w`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`)),r.code.add(w`}`),t.output===F.Highlight&&e.include(z0,t),e.include(vs,t),i.uniforms.add(new Ie("alphaCoverage",(s,n)=>Math.min(1,s.width*n.camera.pixelRatio))),t.hasVertexColors||i.uniforms.add(new sr("constantColor",s=>s.color)),i.code.add(w`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${t.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    ${t.output===F.ObjectAndLayerIdColor?w`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${w.float(bo)}) {
      discard;
    }

    ${t.output===F.Color?w`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===F.Highlight?w`outputHighlight();`:""}
  }
  `),e}const hut=Object.freeze(Object.defineProperty({__proto__:null,build:uut},Symbol.toStringTag,{value:"Module"}));let NAe=class FAe extends Lr{get _stippleEnabled(){return this.configuration.stippleEnabled&&this.configuration.output!==F.Highlight}initializeProgram(e){return new Rr(e.rctx,FAe.shader.get().build(this.configuration),Tr)}initializePipeline(){const e=this.configuration,r=Oo(Se.SRC_ALPHA,Se.ONE,Se.ONE_MINUS_SRC_ALPHA,Se.ONE_MINUS_SRC_ALPHA),i=(s,n=null,o=null)=>Mt({blending:n,depthTest:PK,depthWrite:o,colorWrite:Bt,stencilWrite:e.hasOccludees?Tm:null,stencilTest:e.hasOccludees?s?Cv:kv:null});return e.output===F.Color?(this._occludeePipelineState=i(!0,e.transparent||this._stippleEnabled?r:null,jl),i(!1,e.transparent||this._stippleEnabled?r:null,jl)):i(!1)}get primitiveType(){return At.LINES}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};NAe.shader=new Or(hut,()=>he(()=>import("./NativeLine.glsl-f3dc795f.js"),[],import.meta.url));let eu=class extends jo{constructor(){super(...arguments),this.output=F.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}};u([B({count:F.COUNT})],eu.prototype,"output",void 0),u([B()],eu.prototype,"hasSlicePlane",void 0),u([B()],eu.prototype,"hasVertexColors",void 0),u([B()],eu.prototype,"transparent",void 0),u([B()],eu.prototype,"draped",void 0),u([B()],eu.prototype,"stippleEnabled",void 0),u([B()],eu.prototype,"stippleOffColorEnabled",void 0),u([B()],eu.prototype,"stipplePreferContinuous",void 0),u([B()],eu.prototype,"hasOccludees",void 0),u([B({constValue:!1})],eu.prototype,"stippleRequiresClamp",void 0),u([B({constValue:!1})],eu.prototype,"stippleScaleWithLineWidth",void 0),u([B({constValue:!1})],eu.prototype,"stippleRequiresStretchMeasure",void 0);var OF;(function(t){t[t.START=0]="START",t[t.END=1]="END"})(OF||(OF={}));let rce=class extends Fv{constructor(e){super(e,new fut),this._configuration=new eu}getConfiguration(e,r){this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.draped=r.slot===pe.DRAPED_MATERIAL;const i=this.parameters.stipplePattern!=null;return this._configuration.stippleEnabled=i,this._configuration.stippleOffColorEnabled=i&&this.parameters.stippleOffColor!=null,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._configuration}intersect(e,r,i,s,n,o){if(!i.options.selectionMode||!e.visible)return;if(!wxe(r))return void K.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix");const a=e.vertexAttributes.get(C.POSITION).data,l=i.camera,c=gut;yn(c,i.point);const h=2;ne(D3[0],c[0]-h,c[1]+h,0),ne(D3[1],c[0]+h,c[1]+h,0),ne(D3[2],c[0]+h,c[1]-h,0),ne(D3[3],c[0]-h,c[1]-h,0);for(let _=0;_<4;_++)if(!l.unprojectFromRenderScreen(D3[_],Wm[_]))return;ua(l.eye,Wm[0],Wm[1],Vz),ua(l.eye,Wm[1],Wm[2],Bz),ua(l.eye,Wm[2],Wm[3],Gz),ua(l.eye,Wm[3],Wm[0],jz);let d=Number.MAX_VALUE,f=0;for(let _=0;_<a.length-5;_+=3){if(za[0]=a[_]+r[12],za[1]=a[_+1]+r[13],za[2]=a[_+2]+r[14],Va[0]=a[_+3]+r[12],Va[1]=a[_+4]+r[13],Va[2]=a[_+5]+r[14],fi(Vz,za)<0&&fi(Vz,Va)<0||fi(Bz,za)<0&&fi(Bz,Va)<0||fi(Gz,za)<0&&fi(Gz,Va)<0||fi(jz,za)<0&&fi(jz,Va)<0)continue;if(l.projectToRenderScreen(za,g1),l.projectToRenderScreen(Va,y1),g1[2]<0&&y1[2]>0){fe(ef,za,Va);const b=l.frustum,T=-fi(b[pi.NEAR],za)/ye(ef,b[pi.NEAR]);se(ef,ef,T),de(za,za,ef),l.projectToRenderScreen(za,g1)}else if(g1[2]>0&&y1[2]<0){fe(ef,Va,za);const b=l.frustum,T=-fi(b[pi.NEAR],Va)/ye(ef,b[pi.NEAR]);se(ef,ef,T),de(Va,Va,ef),l.projectToRenderScreen(Va,y1)}else if(g1[2]<0&&y1[2]<0)continue;g1[2]=0,y1[2]=0;const v=EJ(yw(g1,y1,nce),c);v<d&&(d=v,ie(ice,za),ie(sce,Va),f=_/3)}const m=i.rayBegin,g=i.rayEnd;if(d<h*h){let _=Number.MAX_VALUE;if(Lbe(yw(ice,sce,nce),yw(m,g,mut),m1)){fe(m1,m1,m);const v=Re(m1);se(m1,m1,1/v),_=v/mi(m,g)}o(_,m1,f,!1)}}intersectDraped(e,r,i,s,n,o){if(!i.options.selectionMode)return;const a=e.vertexAttributes.get(C.POSITION).data,l=e.vertexAttributes.get(C.SIZE),c=l?l.data[0]:0,h=s[0],d=s[1],f=((c+1)/2+4)*e.screenToWorldRatio;let m=Number.MAX_VALUE,g=0;for(let _=0;_<a.length-5;_+=3){const v=a[_],b=a[_+1],T=h-v,x=d-b,S=a[_+3]-v,E=a[_+4]-b,A=ve((S*T+E*x)/(S*S+E*E),0,1),R=S*A-T,M=E*A-x,D=R*R+M*M;D<m&&(m=D,g=_/3)}m<f*f&&n(o.dist,o.normal,g,!1)}requiresSlot(e,r){return!(r!==F.Color&&r!==F.Highlight&&r!==F.ObjectAndLayerIdColor||e!==pe.OPAQUE_MATERIAL&&e!==pe.DRAPED_MATERIAL)}createGLMaterial(e){return new dut(e)}createBufferWriter(){const e=this.parameters.hasVertexColors?got:fot;return this.parameters.stipplePattern==null?new VC(e):new put(e.clone().vec3f(C.AUXPOS1).vec2f(C.UV0))}},dut=class extends Dv{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output===F.Color&&this._updateOccludeeState(e);const r=this._material.parameters.stipplePattern;return this._stipplePattern!==r&&(this._material.setParameters({stippleTexture:this._stippleTextureRepository.swap(r,this._stipplePattern)}),this._stipplePattern=r),this.ensureTechnique(NAe,e)}},put=class{constructor(e){this.vertexBufferLayout=e}elementCount(e){return e.indices.get(C.POSITION).length}write(e,r,i,s,n){GSe(i,this.vertexBufferLayout,e,r,s,n),this._writeAuxpos1(e,i,s,n),this._writeUV0(e,i,s,n)}_writeAuxpos1(e,r,i,s){const n=i.getField(C.AUXPOS1,mn),o=r.indices.get(C.POSITION),a=r.vertexAttributes.get(C.POSITION).data,l=e,c=n.typedBufferStride,h=n.typedBuffer;s*=c;for(let d=0;d<o.length-1;d+=2)for(const f of[1,0]){const m=3*o[d+f],g=a[m],_=a[m+1],v=a[m+2],b=l[0]*g+l[4]*_+l[8]*v+l[12],T=l[1]*g+l[5]*_+l[9]*v+l[13],x=l[2]*g+l[6]*_+l[10]*v+l[14];h[s]=b,h[s+1]=T,h[s+2]=x,s+=c}}_writeUV0(e,r,i,s){const n=i.getField(C.UV0,Nv),o=r.indices.get(C.POSITION),a=r.vertexAttributes.get(C.POSITION).data,l=r.vertexAttributes.get(C.DISTANCETOSTART)?.data,c=n.typedBufferStride,h=n.typedBuffer;let d=0;h[s*=c]=OF.START,h[s+1]=d,s+=c;const f=3*o[0],m=ne(za,a[f],a[f+1],a[f+2]);e&&ze(m,m,e);const g=Va,_=o.length-1;let v=1;const b=l?(x,S,E)=>d=l[E]:(x,S,E)=>d+=mi(x,S);for(let x=1;x<_;x+=2){const S=3*o[x];ne(g,a[S],a[S+1],a[S+2]),e&&ze(g,g,e),b(m,g,v++);for(let E=0;E<2;++E)h[s]=1-E,h[s+1]=d,s+=c;ie(m,g)}const T=3*o[_];ne(g,a[T],a[T+1],a[T+2]),e&&ze(g,g,e),b(m,g,v),h[s]=OF.END,h[s+1]=d}},fut=class extends eK{constructor(){super(...arguments),this.color=Lh,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.stipplePreferContinuous=!0,this.hasOccludees=!1,this.stippleTexture=null}};const za=O(),Va=O(),ef=O(),m1=O(),g1=Wo(),y1=Wo(),ice=O(),sce=O(),nce=Dp(),mut=Dp(),gut=O(),D3=[Wo(),Wo(),Wo(),Wo()],Wm=[O(),O(),O(),O()],Vz=Fr(),Bz=Fr(),Gz=Fr(),jz=Fr(),yut=["mesh"];let _ut=class extends Nm{constructor(e,r,i,s){super(e,r,i,s),this._materialInfoCache=new cut,this._fastUpdateProcessor=new lut,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){li.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new rce({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new rce({color:[0,1,1,1]}))}destroy(){super.destroy(),this._context.stage.removeMany(this._materialInfoCache.materials),this._context.stage.removeMany(Array.from(this._textures.values())),this._materialInfoCache.clear(),this._textures.clear(),this._fastUpdateProcessor.destroy(this._context.stage)}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,yut,"fill on mesh-3d"))return null;const i=this.setGraphicElevationContext(r,new Up),s=e.renderingInfo;return this._createAs3DShape(r,s,i,r.uid)}onRemoveGraphic(e){this._fastUpdateProcessor.onRemoveGraphic(e,this._materialInfoCache,this._context)}layerOpacityChanged(e,r){const i=this._getLayerOpacity();this._updateMaterialParameters(s=>{s.material.setParameters({layerOpacity:i});const n=s.material.parameters;this._setMaterialTransparentParameter(n,s),s.material.setParameters({transparent:n.transparent})}),e.forEach(s=>{const n=r(s);n?.layerOpacityChanged(i,this._context.isAsync)})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,Tv)}slicePlaneEnabledChanged(e,r){return this._updateMaterialParameters(({material:i})=>{i.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),e.forEach(i=>{const s=r(i);s?.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const e=this._usePBR();return this._updateMaterialParameters(({material:r})=>r.setParameters({usePBR:e})),!0}updateTransform(e,r,i,s){const n=this._context.renderCoordsHelper.spatialReference,o=vut,{origin:a,transform:l}=i;switch(Fl(r,ne(oo,a.x,a.y,a.z??0),o,n),s){case UR.EnableFastUpdates:this._fastUpdateProcessor.enable(e,this._materialInfoCache,this._context);break;case UR.DisableFastUpdates:this._fastUpdateProcessor.disable(e,this._materialInfoCache,this._context);break;case UR.UpdateFastLocalOrigin:e.updateFastLocalOrigin(o,l,this._context.localOriginFactory)}const{elevationContext:c}=e;c.centerPointInElevationSR=this._getCenterPointInElevationSR(o);const{elevationProvider:h,renderCoordsHelper:d}=this._context,f=(m,g)=>xv(m,h,c,d,g);return e.alignedSampledElevation=ww(e,c,h.spatialReference,f,d,o),e.updateTransform(o,l,this._context.isAsync),!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(e){return e==null?"-":e instanceof ke?e.toHex():e.contentHash}_materialPropertiesDefault(e,r){const i=this._requiresSymbolVertexColors(),s=!!e.vertexAttributes.color,n=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:i,hasVertexColors:s,hasVertexTangents:n,uid:`vc:${s},vt:${n},vct${r},svc:${i}`}}_textureTransformUid(e){const{offset:r,scale:i,rotation:s}=e??wut;return`${r[0]},${r[1]},${s},${i[0]},${i[1]}`}_materialProperties(e,r,i){const s=this._materialPropertiesDefault(e,i);if(!r.material)return s;const{color:n,colorTexture:o,colorTextureTransform:a,normalTexture:l,normalTextureTransform:c,doubleSided:h,alphaCutoff:d,alphaMode:f}=r.material,m=this._colorOrTextureUid(n),g=this._colorOrTextureUid(o),_=this._textureTransformUid(a),v=this._colorOrTextureUid(l),b=this._textureTransformUid(c);if(s.color=n,s.colorTexture=o,s.normalTexture=l,s.uid=`${s.uid},cmuid:${m},ctmuid:${g},cttuid:${_},ntmuid:${v},nttuid:${b},ds:${h},ac:${d},am:${f}`,r.material instanceof PAe){const{metallic:T,roughness:x,metallicRoughnessTexture:S,metallicRoughnessTextureTransform:E,emissiveColor:A,emissiveTexture:R,emissiveTextureTransform:M,occlusionTexture:D,occlusionTextureTransform:k}=r.material,L=this._colorOrTextureUid(S),N=this._textureTransformUid(E),q=this._colorOrTextureUid(A),X=this._colorOrTextureUid(R),G=this._textureTransformUid(M),J=this._colorOrTextureUid(D),I=this._textureTransformUid(k);s.metallic=T,s.roughness=x,s.metallicRoughnessTexture=S,s.emissiveColor=A,s.emissiveTexture=R,s.occlusionTexture=D,s.colorTextureTransform=this._convertTextureTransform(a),s.normalTextureTransform=this._convertTextureTransform(c),s.emissiveTextureTransform=this._convertTextureTransform(M),s.occlusionTextureTransform=this._convertTextureTransform(k),s.metallicRoughnessTextureTransform=this._convertTextureTransform(E),s.uid=`${s.uid},mrm:${T},mrr:${x},mrt:${L},mrtt:${N},emuid:${q},etmuid:${X},ett:${G},otmuid:${J},ott:${I}`}return s}_convertTextureTransform(e){if(!e)return null;const{scale:r,offset:i,rotation:s}=e;return{scale:r,offset:i,rotation:Ft(s)}}_setInternalColorValueParameters(e,r){r.diffuse=ke.toUnitRGB(e),r.opacity=e.a}_getLoadableTextureResource(e){return e.data?e.data:e.url}_getInternalTextureId(e){const r=this._getInternalTexture(e,Kr.Opaque);return r!=null?r.id:null}_getInternalTexture(e,r){const i=this._getLoadableTextureResource(e);if(!i)return null;const s=`${e.contentHash}/${r}`;let n=this._textures.get(s);return n||(n=new Nx(Ew(i)?i.data:i,{mipmap:!0,wrap:this._castTextureWrap(e.wrap),noUnpackFlip:!0,preMultiplyAlpha:!Ew(i)&&r!==Kr.Opaque,encoding:Ew(i)&&i.encoding!=null?i.encoding:void 0}),this._textures.set(s,n),this._context.stage.add(n),this._context.stage.loadImmediate(n)),n}_castTextureWrap(e="repeat"){if(typeof e=="string"){const r=this._castTextureWrapIndividual(e);return{s:r,t:r}}return{s:this._castTextureWrapIndividual(e.horizontal),t:this._castTextureWrapIndividual(e.vertical)}}_castTextureWrapIndividual(e){switch(e){case"clamp":return Dt.CLAMP_TO_EDGE;case"mirror":return Dt.MIRRORED_REPEAT;default:return Dt.REPEAT}}_setInternalMaterialParameters(e,r){if(e.color!=null&&this._setInternalColorValueParameters(e.color,r),e.colorTexture!=null){const i=this._getInternalTexture(e.colorTexture,r.textureAlphaMode);i!=null?(r.textureId=i.id,r.textureAlphaPremultiplied=!!i.parameters.preMultiplyAlpha):r.textureId=void 0}e.normalTexture!=null&&(r.normalTextureId=this._getInternalTextureId(e.normalTexture)),e.emissiveColor!=null&&(r.emissiveFactor=ke.toUnitRGB(e.emissiveColor)),e.emissiveTexture!=null&&(r.emissiveTextureId=this._getInternalTextureId(e.emissiveTexture)),e.occlusionTexture!=null&&(r.occlusionTextureId=this._getInternalTextureId(e.occlusionTexture)),e.metallicRoughnessTexture!=null&&(r.metallicRoughnessTextureId=this._getInternalTextureId(e.metallicRoughnessTexture)),r.colorTextureTransformMatrix=Bf(e.colorTextureTransform),r.normalTextureTransformMatrix=Bf(e.normalTextureTransform),r.occlusionTextureTransformMatrix=Bf(e.occlusionTextureTransform),r.emissiveTextureTransformMatrix=Bf(e.emissiveTextureTransform),r.metallicRoughnessTextureTransformMatrix=Bf(e.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(e){const r=this._drivenProperties.color;let i=this.symbolLayer.material!=null?this.symbolLayer.material.colorMixMode:null;if(r)e.externalColor=Lh;else{const s=this.symbolLayer.material!=null?this.symbolLayer.material.color:null;s!=null?e.externalColor=ke.toUnitRGBA(s):(i=null,e.externalColor=Lh)}i&&(e.colorMixMode=i),e.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(e){const r=e.vertexAttributes.color;if(r==null)return!1;for(let i=3;i<r.length;i+=4)if(r[i]!==255)return!0;return!1}_getOrCreateMaterial(e,r){const i=r.material?.color,s=r.material?.colorTexture,n=r.material?.alphaMode,o=n==="blend",a=n!=="opaque"&&(this._hasTransparentVertexColors(e)||i!=null&&i.a<1||s!=null&&s.transparent||o),l=this._materialProperties(e,r,a),c=this._materialInfoCache.byUid(l.uid);if(c)return c.material;const h={uid:l.uid,material:null,isComponentTransparent:a,alphaMode:r.material?r.material.alphaMode:"opaque"},d=z3e({normalTexture:l.normalTexture,metallicRoughnessTexture:l.metallicRoughnessTexture,metallicFactor:l.metallic,roughnessFactor:l.roughness,emissiveTexture:l.emissiveTexture,emissiveFactor:ke.toUnitRGB(l.emissiveColor),occlusionTexture:l.occlusionTexture}),f={usePBR:this._usePBR(),isSchematic:d,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:sl,diffuse:Hg,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:gi.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};f.mrrFactors=d?[...qK]:[l.metallic,l.roughness,M9[2]],r.material&&(f.doubleSided=r.material.doubleSided,f.cullFace=r.material.doubleSided?gi.None:gi.Back,f.textureAlphaCutoff=r.material.alphaCutoff),this._setExternalMaterialParameters(f),this._setMaterialTransparentParameter(f,h),this._setInternalMaterialParameters(l,f);const m=new Sm(f);return h.material=m,this._materialInfoCache.set(l.uid,h),this._context.stage.add(m),m}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(e,r){e.transparent=this.needsDrivenTransparentPass||r.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,r.alphaMode==="auto"?e.textureAlphaMode=e.transparent?Kr.MaskBlend:Kr.Opaque:e.textureAlphaMode=r.alphaMode==="opaque"?Kr.Opaque:r.alphaMode==="mask"?Kr.Mask:Kr.Blend}_addDebugNormals(e,r){const i=r.length,s=e.spatialReference.isGeographic?20015077/180:1,n=.1*Math.max(e.extent.width*s,e.extent.height*s,e.extent.zmax-e.extent.zmin),o=[],a=[],l=[],c=[];for(let m=0;m<i;m++){const g=r[m],_=g.vertexAttributes.get(C.POSITION),v=g.vertexAttributes.get(C.NORMAL),b=g.indices.get(C.POSITION),T=g.indices.get(C.NORMAL),x=_.data,S=v.data;for(let E=0;E<b.length;E++){const A=3*b[E],R=3*T[E];for(let M=0;M<3;M++)o.push(x[A+M]);for(let M=0;M<3;M++)o.push(x[A+M]+S[R+M]*n);if(a.push(a.length),a.push(a.length),E%3==0){this._calculateFaceNormal(x,b,E,ET),this._getFaceVertices(x,b,E,oo,TT,ST),de(oo,oo,TT),de(oo,oo,ST),se(oo,oo,1/3);for(let M=0;M<3;M++)l.push(oo[M]);for(let M=0;M<3;M++)l.push(oo[M]+ET[M]*n);c.push(c.length),c.push(c.length)}}}const h=r[0].transformation,d=new Ks(this._debugVertexNormalMaterial,[[C.POSITION,new We(o,3,!0)]],[[C.POSITION,a]],null,us.Line);r.push(d),d.transformation=h;const f=new Ks(this._debugFaceNormalMaterial,[[C.POSITION,new We(l,3,!0)]],[[C.POSITION,c]],null,us.Line);f.transformation=h,r.push(f)}_createAs3DShape(e,r,i,s){const n=e.geometry;if(n.type!=="mesh")return null;const o=this._createGeometryInfo(n,r,s);if(o==null)return null;const{geometries:a,objectTransformation:l}=o;li.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(n,a);const c=new B0({geometries:a,layerUid:this._context.layer.uid,graphicUid:s});c.transformation=l;const h=oCe(this.symbolLayer,{opacity:this._getLayerOpacity()}),d=h!=null?new Hit(a[0].material,[h],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null,f=new nut(this,c,a,null,null,ww,i,d);this._fastUpdateProcessor.onAddGraphic(),f.needsElevationUpdates=Tv(i.mode),f.useObjectOriginAsAttachmentOrigin=!0,i.centerPointInElevationSR=this._getCenterPointInElevationSR(c.transformation);const{elevationProvider:m,renderCoordsHelper:g}=this._context,_=(v,b)=>xv(v,m,i,g,b);return f.alignedSampledElevation=ww(f,i,m.spatialReference,_,g),f}_getCenterPointInElevationSR(e){const r=Fx(0,0,0,this._context.elevationProvider.spatialReference!=null?this._context.elevationProvider.spatialReference:null);return mJ([e[12],e[13],e[14]],this._context.renderCoordsHelper.spatialReference,r),r}_createComponentNormals(e,r,i,s){switch(i.shading||"flat"){default:case"source":return this._createComponentNormalsSource(e,r,i,s);case"flat":return this._createComponentNormalsFlat(e,s);case"smooth":return this._createComponentNormalsSmooth(e,s)}}_createComponentNormalsSource(e,r,i,s){if(r==null)return this._createComponentNormalsFlat(e,s);let n=!1;if(!i.trustSourceNormals)for(let o=0;o<s.length;o+=3){this._calculateFaceNormal(e,s,o,ET);for(let a=0;a<3;a++){const l=3*s[o+a];oo[0]=r[l],oo[1]=r[l+1],oo[2]=r[l+2],ye(ET,oo)<0&&(r[l]=-r[l],r[l+1]=-r[l+1],r[l+2]=-r[l+2],n=!0)}}return new Hz(r,s,n)}_createComponentNormalsFlat(e,r){const i=es(r.length),s=new Array(3*r.length);for(let n=0;n<r.length;n+=3){const o=this._calculateFaceNormal(e,r,n,ET);for(let a=0;a<3;a++)i[n+a]=o[a],s[n+a]=n/3}return new Hz(i,s,!1)}_createComponentNormalsSmooth(e,r){const i={};for(let o=0;o<r.length;o+=3){const a=this._calculateFaceNormal(e,r,o,ET);for(let l=0;l<3;l++){const c=r[o+l];let h=i[c];h||(h={normal:O(),count:0},i[c]=h),de(h.normal,h.normal,a),h.count++}}const s=es(3*r.length),n=new Array(3*r.length);for(let o=0;o<r.length;o++){const a=i[r[o]];a.count!==1&&(_e(a.normal,a.normal),a.count=1);for(let l=0;l<3;l++)s[3*o+l]=a.normal[l];n[o]=o}return new Hz(s,n,!1)}_getFaceVertices(e,r,i,s,n,o){const a=3*r[i],l=3*r[i+1],c=3*r[i+2];s[0]=e[a],s[1]=e[a+1],s[2]=e[a+2],n[0]=e[l],n[1]=e[l+1],n[2]=e[l+2],o[0]=e[c],o[1]=e[c+1],o[2]=e[c+2]}_calculateFaceNormal(e,r,i,s){return this._getFaceVertices(e,r,i,oo,TT,ST),fe(TT,TT,oo),fe(ST,ST,oo),pt(oo,TT,ST),_e(s,oo),s}_getOrCreateComponents(e){return e.components??but}_createPositionBuffer(e,r){let i=e.vertexAttributes.position;const s=r.reprojection===dc.ECEF?r.transformBeforeProject:null;if(s!=null&&(i=QE(new Float64Array(i.length),i,s)),r.reprojection===dc.NONE)return r.needsBufferCopy?new Float64Array(i):i;const n=s!=null?i:new Float64Array(i.length);return ci(i,e.spatialReference,0,n,this._context.renderCoordsHelper.spatialReference,0,i.length/3),n}_createNormalBuffer(e,r,i){let s=e.vertexAttributes.normal;if(s==null)return null;const n=i.reprojection===dc.ECEF?i.transformBeforeProject:null;if(n!=null&&(s=Kct(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||i.reprojection===dc.NONE)return i.needsBufferCopy&&e.vertexAttributes.normal===s?new Float32Array(s):s;const o=e.vertexAttributes.position,a=n!=null?s:new Float32Array(s.length);return Qct(s,o,r,e.spatialReference,a)}_createTangentBuffer(e,r,i){let s=e.vertexAttributes.tangent;if(s==null)return null;const n=i.reprojection===dc.ECEF?i.transformBeforeProject:null;if(n!=null&&(s=eut(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||i.reprojection===dc.NONE)return i.needsBufferCopy&&e.vertexAttributes.normal===s?new Float32Array(s):s;const o=e.vertexAttributes.position,a=n!=null?s:new Float32Array(s.length);return tut(s,o,r,e.spatialReference,a)}_createColorBuffer(e){return e.vertexAttributes.color}_createSymbolColorBuffer(e){if(this._requiresSymbolVertexColors()){const r=this._getVertexOpacityAndColor(e),i=G3e(this.symbolLayer?.material?.colorMixMode),s=new Uint8Array(4);return j3e(r,i,s),s}return null}_createBuffers(e,r){const i=e.vertexAttributes&&e.vertexAttributes.position;if(!i)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const s=e.vertexAttributes.normal,n=e.vertexAttributes.uv,o=e.vertexAttributes.tangent;if(s!=null&&s.length!==i.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(o!=null&&o.length/4!=i.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(n!=null&&n.length/2!=i.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const a=this._computeReprojectionInfo(e),l=this._createPositionBuffer(e,a),c=this._createColorBuffer(e),h=this._createSymbolColorBuffer(r),d=this._createNormalBuffer(e,l,a),f=this._createTangentBuffer(e,l,a);return{positionBuffer:l,normalBuffer:d,tangentBuffer:f,uvBuffer:n,colorBuffer:c,symbolColorBuffer:h,objectTransformation:a.reprojection===dc.NONE&&a.objectTransformation!=null?a.objectTransformation:this._transformOriginLocal(e,l,d,f),geometryTransformation:a.reprojection===dc.NONE&&a.geometryTransformation!=null?a.geometryTransformation:xe()}}_computeReprojectionInfo(e){const{vertexSpace:r}=e,i=r.isRelative,s=r.isGeoreferenced?this._context.renderCoordsHelper.viewingMode===Ve.Local?dc.NONE:dc.ECEF:dc.NONE;if(i){const{origin:n}=r,o=xe(),a=e.transform?.localMatrix??pn;if(s===dc.NONE)return Fl(e.spatialReference,n,o,this._context.renderCoordsHelper.spatialReference),{reprojection:s,objectTransformation:o,geometryTransformation:OE(a),needsBufferCopy:!1};const l=CP(xe(),n);return ai(l,l,a),{reprojection:s,transformBeforeProject:l,needsBufferCopy:!0}}return{reprojection:s,needsBufferCopy:!0}}_transformOriginLocal(e,r,i,s){const n=this._context.renderCoordsHelper.spatialReference,o=e.anchor;aL[0]=o.x,aL[1]=o.y,aL[2]=o.z??0;const a=xe();return Fl(e.spatialReference,aL,a,n),$n(oce,a),QE(r,r,oce),i==null&&s==null||(Jh(N3,a),Qh(N3,N3),i!=null&&ex(i,i,N3),s!=null&&ex(s,s,N3,4)),a}_validateFaces(e,r){const i=e.vertexAttributes.position.length/3,s=r.faces;if(s){let n=-1;for(let o=0;o<s.length;o++){const a=s[o];a>n&&(n=a)}if(i<=n)return this.logger.warn(`Vertex index ${n} is out of bounds of the mesh position buffer`),!1}else if(i%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(e,r){return r.faces??zE(e.vertexAttributes.position.length/3)}_isOutsideClippingArea(e){if(!this._context.clippingExtent)return!1;const r=e.vertexAttributes&&e.vertexAttributes.position;if(!r)return!1;const i=this._context.elevationProvider.spatialReference;let s;const n=r.length/3;return i==null||e.spatialReference.equals(i)?s=r:(s=new Float64Array(r.length),ci(e.vertexAttributes.position,e.spatialReference,0,s,i,0,n)),Ei(qz),Tu(qz,s,0,n),!dp(qz,this._context.clippingExtent)}_createGeometryInfo(e,r,i){if(!gm(e.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(e))return null;const s=this._createBuffers(e,r);if(s==null)return null;const{positionBuffer:n,uvBuffer:o,colorBuffer:a,symbolColorBuffer:l,normalBuffer:c,tangentBuffer:h,objectTransformation:d,geometryTransformation:f}=s,m=this._getOrCreateComponents(e),g=new Array;let _=!1;for(const v of m){if(!this._validateFaces(e,v))return null;const b=this._getOrCreateFaces(e,v);if(b.length===0)continue;const T=this._createComponentNormals(n,c,v,b);T.didFlipNormals&&(_=!0);const x=[[C.POSITION,new We(n,3,!0)],[C.NORMAL,new We(T.normals,3,!0)]],S=[[C.POSITION,b],[C.NORMAL,T.indices]];a!=null&&(x.push([C.COLOR,new We(a,4,!0)]),S.push([C.COLOR,b])),l!=null&&(x.push([C.SYMBOLCOLOR,new We(l,4,!0)]),S.push([C.SYMBOLCOLOR,LC(b.length)])),o!=null&&(x.push([C.UV0,new We(o,2,!0)]),S.push([C.UV0,b])),h!=null&&(x.push([C.TANGENT,new We(h,4,!0)]),S.push([C.TANGENT,b]));const E=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:i,layerUid:this._context.layer.uid}),A=this._getOrCreateMaterial(e,v),R=new Ks(A,x,S,null,us.Mesh,E);R.transformation=f,g.push(R)}return _&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:g,objectTransformation:d}}_updateMaterialParameters(e){this._materialInfoCache.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachClonedMaterial((r,i)=>{i.setParameters(r.parameters)})}test(){return{...super.test(),materials:this._materialInfoCache.materials}}},Hz=class{constructor(e,r,i){this.normals=e,this.indices=r,this.didFlipNormals=i}};const aL=O(),oo=O(),TT=O(),ST=O(),ET=O(),oce=xe(),N3=ki(),vut=xe(),qz=gn(),but=[new Jct],wut=new HS;var dc;(function(t){t[t.NONE=0]="NONE",t[t.ECEF=1]="ECEF"})(dc||(dc={}));let xut=class{constructor(e,r,i,s){this.graphics3DSymbolLayer=e,this.instanceIndex=r,this.elevationAligner=i,this.elevationContext=s,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(e){const r=this._lodRenderer.instanceData;e!==r.getVisible(this.instanceIndex)&&r.setVisible(this.instanceIndex,e)}destroy(){this.instanceIndex!=null&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(e,r,i){if(this.elevationAligner){b9(this.elevationContext.featureExpressionInfoContext,i);const s=(o,a)=>xv(o,e,this.elevationContext,r,a),n=this.elevationAligner(this,this.elevationContext,e.spatialReference,s,r);n!=null&&(this.alignedSampledElevation=n)}}getCenterObjectSpace(e=O()){return this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,tf),ze(e,this._lodRenderer.baseBoundingSphere.center,tf)}getBoundingBoxObjectSpace(e=gn()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,tf);const r=this._lodRenderer.baseBoundingBox;Ei(e);for(let i=0;i<8;++i)ne(Wu,1&i?r[3]:r[0],2&i?r[4]:r[1],4&i?r[5]:r[2]),ze(Wu,Wu,tf),mm(e,Wu);return e}computeAttachmentOrigin(e){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,tf),e.render.origin[0]+=tf[12],e.render.origin[1]+=tf[13],e.render.origin[2]+=tf[14],e.render.num++}async getProjectedBoundingBox(e,r,i,s,n){const o=this.getBoundingBoxObjectSpace(n),a=Tut,l=sJ(o)?1:a.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,tf);for(let h=0;h<l;h++){const d=a[h];Wu[0]=o[d[0]],Wu[1]=o[d[1]],Wu[2]=o[d[2]],ze(Wu,Wu,tf),_1[3*h]=Wu[0],_1[3*h+1]=Wu[1],_1[3*h+2]=Wu[2]}if(!e(_1,0,l))return null;Ei(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let d=0;d<3;d++)o[d]=Math.min(o[d],_1[h+d]),o[d+3]=Math.max(o[d+3],_1[h+d]);c&&i.push({location:_1.slice(h,h+3),screenSpaceBoundingRect:c})}if(r&&(hp(o,Wz),this.elevationContext.mode!=="absolute-height")){let h;const d=fK(o,r.service.spatialReference,r);try{h=await r.service.queryElevation(Wz[0],Wz[1],s,d,"ground")}catch{}h!=null&&Bve(o,0,0,-this.alignedSampledElevation+h)}return o}addObjectState(e,r){if(e===T0.Highlight){const i=new Y5(e);this._addHighlightId(i),r.addExternal(s=>{this._removeHighlightId(s)},i)}}removeObjectState(e){this._highlights.forEach(r=>e.remove(r))}_addHighlightId(e){this._highlights.add(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(e){this._highlights.delete(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}};const _1=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Wu=O(),Wz=O(),Tut=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],tf=xe();function Sut(t){const e=new Array;return t.stageResources.geometries.forEach(r=>{const i=t.stageResources.textures;e.push(new iCe(r,i))}),{components:e,minScreenSpaceRadius:t.lodThreshold??0,pivotOffset:t.pivotOffset}}function Eut(t){return{levels:t.map(e=>Sut(e))}}function Cut(t){return t=t||globalThis.location.hostname,Aut.some(e=>t?.match(e)!=null)}function Fq(t,e){return t&&(e=e||globalThis.location.hostname)?e.match(UAe)!=null||e.match(zAe)!=null?t.replace("static.arcgis.com","staticdev.arcgis.com"):e.match(kAe)!=null||e.match(VAe)!=null?t.replace("static.arcgis.com","staticqa.arcgis.com"):t:t}const UAe=/^devext.arcgis.com$/,kAe=/^qaext.arcgis.com$/,zAe=/^[\w-]*\.mapsdevext.arcgis.com$/,VAe=/^[\w-]*\.mapsqa.arcgis.com$/,Aut=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,UAe,kAe,/^jsapps.esri.com$/,zAe,VAe];function Out(t,e,r){if(t.count!==e.count)return void x9.error("source and destination buffers need to have the same number of elements");const i=t.count,s=r[0],n=r[1],o=r[2],a=r[3],l=r[4],c=r[5],h=r[6],d=r[7],f=r[8],m=r[9],g=r[10],_=r[11],v=r[12],b=r[13],T=r[14],x=r[15],S=t.typedBuffer,E=t.typedBufferStride,A=e.typedBuffer,R=e.typedBufferStride;for(let M=0;M<i;M++){const D=M*E,k=M*R,L=A[k],N=A[k+1],q=A[k+2],X=A[k+3];S[D]=s*L+l*N+f*q+v*X,S[D+1]=n*L+c*N+m*q+b*X,S[D+2]=o*L+h*N+g*q+T*X,S[D+3]=a*L+d*N+_*q+x*X}}function Rut(t,e,r){eee(t.typedBuffer,e.typedBuffer,r,t.typedBufferStride,e.typedBufferStride)}function eee(t,e,r,i=4,s=i){if(t.length/i!=e.length/s)return void x9.error("source and destination buffers need to have the same number of elements");const n=t.length/i,o=r[0],a=r[1],l=r[2],c=r[3],h=r[4],d=r[5],f=r[6],m=r[7],g=r[8];let _=0,v=0;for(let b=0;b<n;b++){const T=e[_],x=e[_+1],S=e[_+2],E=e[_+3];t[v]=o*T+c*x+f*S,t[v+1]=a*T+h*x+m*S,t[v+2]=l*T+d*x+g*S,t[v+3]=E,_+=s,v+=i}}function Mut(t,e){const r=Math.min(t.count,e.count),i=t.typedBuffer,s=t.typedBufferStride,n=e.typedBuffer,o=e.typedBufferStride;for(let a=0;a<r;a++){const l=a*s,c=a*o,h=n[c],d=n[c+1],f=n[c+2],m=h*h+d*d+f*f;if(m>0){const g=1/Math.sqrt(m);i[l]=g*h,i[l+1]=g*d,i[l+2]=g*f}}}function Put(t,e,r){RF(t.typedBuffer,e,r,t.typedBufferStride)}function RF(t,e,r,i=4){const s=Math.min(t.length/i,e.count),n=e.typedBuffer,o=e.typedBufferStride;let a=0,l=0;for(let c=0;c<s;c++)t[l]=r*n[a],t[l+1]=r*n[a+1],t[l+2]=r*n[a+2],t[l+3]=r*n[a+3],a+=o,l+=i}Object.freeze(Object.defineProperty({__proto__:null,normalize:Mut,scale:RF,scaleView:Put,transformMat3:eee,transformMat3View:Rut,transformMat4:Out},Symbol.toStringTag,{value:"Module"}));function Iut(t,e){tee(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function tee(t,e,r=2,i=r){const s=e.length/2;let n=0,o=0;if(Cp(e)||NDe(e)){for(let l=0;l<s;++l)t[n]=e[o],t[n+1]=e[o+1],n+=r,o+=i;return}const a=FDe(e);if(DDe(e))for(let l=0;l<s;++l)t[n]=Math.max(e[o]/a,-1),t[n+1]=Math.max(e[o+1]/a,-1),n+=r,o+=i;else for(let l=0;l<s;++l)t[n]=e[o]/a,t[n+1]=e[o+1]/a,n+=r,o+=i}function $ut(t,e,r,i){const s=t.typedBuffer,n=t.typedBufferStride,o=i?.count??t.count;let a=(i?.dstIndex??0)*n;for(let l=0;l<o;++l)s[a]=e,s[a+1]=r,a+=n}Object.freeze(Object.defineProperty({__proto__:null,fill:$ut,normalizeIntegerBuffer:tee,normalizeIntegerBufferView:Iut},Symbol.toStringTag,{value:"Module"}));function Lut(t,e){eI(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function eI(t,e,r=3,i=r){const s=e.length/i;let n=0,o=0;for(let a=0;a<s;++a)t[n]=e[o],t[n+1]=e[o+1],t[n+2]=e[o+2],n+=r,o+=i}function Dut(t,e,r,i,s){const n=t.typedBuffer,o=t.typedBufferStride,a=s?.count??t.count;let l=(s?.dstIndex??0)*o;for(let c=0;c<a;++c)n[l]=e,n[l+1]=r,n[l+2]=i,l+=o}Object.freeze(Object.defineProperty({__proto__:null,copy:eI,copyView:Lut,fill:Dut},Symbol.toStringTag,{value:"Module"}));function Nut(t,e){ree(t.typedBuffer,e,t.typedBufferStride)}function ree(t,e,r=4){const i=e.typedBuffer,s=e.typedBufferStride,n=e.count;let o=0,a=0;for(let l=0;l<n;++l)t[o]=i[a],t[o+1]=i[a+1],t[o+2]=i[a+2],t[o+3]=i[a+3],o+=r,a+=s}function Fut(t,e,r,i,s,n){const o=t.typedBuffer,a=t.typedBufferStride,l=n?.count??t.count;let c=(n?.dstIndex??0)*a;for(let h=0;h<l;++h)o[c]=e,o[c+1]=r,o[c+2]=i,o[c+3]=s,c+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:ree,copyView:Nut,fill:Fut},Symbol.toStringTag,{value:"Module"}));let BAe=class{constructor(e){this._streamDataRequester=e}async loadJSON(e,r){return this._load("json",e,r)}async loadBinary(e,r){return Am(e)?(Yt(r),YY(e)):this._load("binary",e,r)}async loadImage(e,r){return this._load("image",e,r)}async _load(e,r,i){if(this._streamDataRequester==null)return(await ur(r,{responseType:Uut[e]})).data;const s=await $u(this._streamDataRequester.request(r,e,i));if(s.ok===!0)return s.value;throw zo(s.error),new U("",`Request for resource failed: ${s.error}`)}};const Uut={image:"image",binary:"array-buffer",json:"json","image+type":void 0};function kut(t={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...t}}function zut(t,e={}){return{data:t,parameters:{wrap:{s:Dt.REPEAT,t:Dt.REPEAT,...e.wrap},noUnpackFlip:!0,mipmap:!1,...e}}}let nx=class{constructor(e,r,i=""){this.major=e,this.minor=r,this._context=i}lessThan(e,r){return this.major<e||e===this.major&&this.minor<r}since(e,r){return!this.lessThan(e,r)}validate(e){if(this.major!==e.major){const r=this._context&&this._context+":",i=this._context&&this._context+" ";throw new U(r+"unsupported-version",`Required major ${i}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new nx(this.major,this.minor,this._context)}static parse(e,r=""){const[i,s]=e.split("."),n=/^\s*\d+\s*$/;if(!i||!i.match||!n.test(i))throw new U((r&&r+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!s||!s.match||!n.test(s))throw new U((r&&r+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});const o=parseInt(i,10),a=parseInt(s,10);return new nx(o,a,r)}};function GN(t,e){const r=t.count;e||(e=new t.TypedArrayConstructor(r));for(let i=0;i<r;i++)e[i]=t.get(i);return e}Object.freeze(Object.defineProperty({__proto__:null,makeDense:GN},Symbol.toStringTag,{value:"Module"}));let ace=class{constructor(e){this._data=e,this._offset4=0,this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const e=this._offset4;return this._offset4+=1,this._dataUint32[e]}readUint8Array(e){const r=4*this._offset4;return this._offset4+=e/4,new Uint8Array(this._data,r,e)}remainingBytes(){return this._data.byteLength-4*this._offset4}};var kR,lce;(function(t){t.SCALAR="SCALAR",t.VEC2="VEC2",t.VEC3="VEC3",t.VEC4="VEC4",t.MAT2="MAT2",t.MAT3="MAT3",t.MAT4="MAT4"})(kR||(kR={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(lce||(lce={}));const GAe={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},Vut={pbrMetallicRoughness:GAe,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},But={ESRI_externalColorMixMode:"tint"},cce=(t={})=>{const e={...GAe,...t.pbrMetallicRoughness},r=Gut({...But,...t.extras});return{...Vut,...t,pbrMetallicRoughness:e,extras:r}};function Gut(t){switch(t.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:t.ESRI_externalColorMixMode,t.ESRI_externalColorMixMode="tint"}return t}const jut={magFilter:Rt.LINEAR,minFilter:Rt.LINEAR_MIPMAP_LINEAR,wrapS:Dt.REPEAT,wrapT:Dt.REPEAT},Hut=t=>({...jut,...t});function qut(t){let e,r;return t.replace(/^(.*\/)?([^/]*)$/,(i,s,n)=>(e=s||"",r=n||"","")),{dirPart:e,filePart:r}}const lL={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};let Wut=class Ky{constructor(e,r,i,s){if(this._context=e,this.uri=r,this.json=i,this._glbBuffer=s,this._bufferLoaders=new Map,this._textureLoaders=new Map,this._textureCache=new Map,this._materialCache=new Map,this._nodeParentMap=new Map,this._nodeTransformCache=new Map,this._supportedExtensions=["KHR_texture_basisu"],this._baseUri=qut(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),i.scenes==null)throw new U("gltf-loader-unsupported-feature","Scenes must be defined.");if(i.meshes==null)throw new U("gltf-loader-unsupported-feature","Meshes must be defined");if(i.nodes==null)throw new U("gltf-loader-unsupported-feature","Nodes must be defined.");this._computeNodeParents()}static async load(e,r,i){if(Am(r)){const o=Iw(r);if(o&&o.mediaType!=="model/gltf-binary")try{const l=JSON.parse(o.isBase64?atob(o.data):o.data);return new Ky(e,r,l)}catch{}const a=YY(r);if(Ky._isGLBData(a))return this._fromGLBData(e,r,a)}if(r.endsWith(".gltf")){const o=await e.loadJSON(r,i);return new Ky(e,r,o)}const s=await e.loadBinary(r,i);if(Ky._isGLBData(s))return this._fromGLBData(e,r,s);const n=await e.loadJSON(r,i);return new Ky(e,r,n)}static _isGLBData(e){if(e==null)return!1;const r=new ace(e);return r.remainingBytes()>=4&&r.readUint32()===lL.MAGIC}static async _fromGLBData(e,r,i){const s=await Ky._parseGLBData(i);return new Ky(e,r,s.json,s.binaryData)}static async _parseGLBData(e){const r=new ace(e);if(r.remainingBytes()<12)throw new U("gltf-loader-error","GLB binary data is insufficiently large.");const i=r.readUint32(),s=r.readUint32(),n=r.readUint32();if(i!==lL.MAGIC)throw new U("gltf-loader-error","Magic first 4 bytes do not fit to expected GLB value.");if(e.byteLength<n)throw new U("gltf-loader-error","GLB binary data is smaller than header specifies.");if(s!==2)throw new U("gltf-loader-unsupported-feature","An unsupported GLB container version was detected. Only version 2 is supported.");let o,a,l=0;for(;r.remainingBytes()>=8;){const c=r.readUint32(),h=r.readUint32();if(l===0){if(h!==lL.CHUNK_TYPE_JSON)throw new U("gltf-loader-error","First GLB chunk must be JSON.");if(c<0)throw new U("gltf-loader-error","No JSON data found.");o=await iut(r.readUint8Array(c))}else if(l===1){if(h!==lL.CHUNK_TYPE_BIN)throw new U("gltf-loader-unsupported-feature","Second GLB chunk expected to be BIN.");a=r.readUint8Array(c)}else K.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 GLB chunks detected. Skipping.");l+=1}if(!o)throw new U("gltf-loader-error","No GLB JSON chunk detected.");return{json:o,binaryData:a}}async getBuffer(e,r){const i=this.json.buffers[e];if(i.uri==null){if(this._glbBuffer==null)throw new U("gltf-loader-error","GLB buffer not present");return this._glbBuffer}const s=await this._getBufferLoader(e,r);if(s.byteLength!==i.byteLength)throw new U("gltf-loader-error","Buffer byte lengths should match.");return s}async _getBufferLoader(e,r){const i=this._bufferLoaders.get(e);if(i)return i;const s=this.json.buffers[e].uri,n=this._context.loadBinary(this._resolveUri(s),r).then(o=>new Uint8Array(o));return this._bufferLoaders.set(e,n),n}async getAccessor(e,r){if(!this.json.accessors)throw new U("gltf-loader-unsupported-feature","Accessors missing.");const i=this.json.accessors[e];if(i?.bufferView==null)throw new U("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(i.type in[kR.MAT2,kR.MAT3,kR.MAT4])throw new U("gltf-loader-unsupported-feature",`AttributeType ${i.type} is not supported`);const s=this.json.bufferViews[i.bufferView],n=await this.getBuffer(s.buffer,r),o=Zut[i.type],a=Jut[i.componentType],l=o*a,c=s.byteStride||l;return{raw:n.buffer,byteStride:c,byteOffset:n.byteOffset+(s.byteOffset||0)+(i.byteOffset||0),entryCount:i.count,isDenselyPacked:c===l,componentCount:o,componentByteSize:a,componentType:i.componentType,min:i.min,max:i.max,normalized:!!i.normalized}}async getIndexData(e,r){if(e.indices==null)return;const i=await this.getAccessor(e.indices,r);if(i.isDenselyPacked)switch(i.componentType){case st.UNSIGNED_BYTE:return new Uint8Array(i.raw,i.byteOffset,i.entryCount);case st.UNSIGNED_SHORT:return new Uint16Array(i.raw,i.byteOffset,i.entryCount);case st.UNSIGNED_INT:return new Uint32Array(i.raw,i.byteOffset,i.entryCount)}else switch(i.componentType){case st.UNSIGNED_BYTE:return GN(this._wrapAccessor(kE,i));case st.UNSIGNED_SHORT:return GN(this._wrapAccessor(W8,i));case st.UNSIGNED_INT:return GN(this._wrapAccessor(Y8,i))}}async getPositionData(e,r){if(e.attributes.POSITION==null)throw new U("gltf-loader-unsupported-feature","No POSITION vertex data found.");const i=await this.getAccessor(e.attributes.POSITION,r);if(i.componentType!==st.FLOAT)throw new U("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+st[i.componentType]);if(i.componentCount!==3)throw new U("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+i.componentCount.toFixed());return this._wrapAccessor(mn,i)}async getNormalData(e,r){if(e.attributes.NORMAL==null)throw new U("gltf-loader-error","No NORMAL vertex data found.");const i=await this.getAccessor(e.attributes.NORMAL,r);if(i.componentType!==st.FLOAT)throw new U("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+st[i.componentType]);if(i.componentCount!==3)throw new U("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+i.componentCount.toFixed());return this._wrapAccessor(mn,i)}async getTangentData(e,r){if(e.attributes.TANGENT==null)throw new U("gltf-loader-error","No TANGENT vertex data found.");const i=await this.getAccessor(e.attributes.TANGENT,r);if(i.componentType!==st.FLOAT)throw new U("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+st[i.componentType]);if(i.componentCount!==4)throw new U("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+i.componentCount.toFixed());return new Ip(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*i.entryCount)}async getTextureCoordinates(e,r){if(e.attributes.TEXCOORD_0==null)throw new U("gltf-loader-error","No TEXCOORD_0 vertex data found.");const i=await this.getAccessor(e.attributes.TEXCOORD_0,r);if(i.componentCount!==2)throw new U("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+i.componentCount.toFixed());if(i.componentType===st.FLOAT)return this._wrapAccessor(Nv,i);if(!i.normalized)throw new U("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return Qut(i)}async getVertexColors(e,r){if(e.attributes.COLOR_0==null)throw new U("gltf-loader-error","No COLOR_0 vertex data found.");const i=await this.getAccessor(e.attributes.COLOR_0,r);if(i.componentCount!==4&&i.componentCount!==3)throw new U("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+i.componentCount.toFixed());if(i.componentCount===4){if(i.componentType===st.FLOAT)return this._wrapAccessor(Ip,i);if(i.componentType===st.UNSIGNED_BYTE)return this._wrapAccessor(wa,i);if(i.componentType===st.UNSIGNED_SHORT)return this._wrapAccessor($P,i)}else if(i.componentCount===3){if(i.componentType===st.FLOAT)return this._wrapAccessor(mn,i);if(i.componentType===st.UNSIGNED_BYTE)return this._wrapAccessor(q8,i);if(i.componentType===st.UNSIGNED_SHORT)return this._wrapAccessor(X8,i)}throw new U("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+st[i.componentType])}hasPositions(e){return e.attributes.POSITION!==void 0}hasNormals(e){return e.attributes.NORMAL!==void 0}hasVertexColors(e){return e.attributes.COLOR_0!==void 0}hasTextureCoordinates(e){return e.attributes.TEXCOORD_0!==void 0}hasTangents(e){return e.attributes.TANGENT!==void 0}async getMaterial(e,r,i){let s=e.material?this._materialCache.get(e.material):void 0;if(!s){const n=e.material!=null?cce(this.json.materials[e.material]):cce(),o=n.pbrMetallicRoughness,a=this.hasVertexColors(e),l=this.getTexture(o.baseColorTexture,r),c=this.getTexture(n.normalTexture,r),h=i?this.getTexture(n.occlusionTexture,r):void 0,d=i?this.getTexture(n.emissiveTexture,r):void 0,f=i?this.getTexture(o.metallicRoughnessTexture,r):void 0,m=e.material!=null?e.material:-1;s={alphaMode:n.alphaMode,alphaCutoff:n.alphaCutoff,color:o.baseColorFactor,doubleSided:!!n.doubleSided,colorTexture:await l,normalTexture:await c,name:n.name,id:m,occlusionTexture:await h,emissiveTexture:await d,emissiveFactor:n.emissiveFactor,metallicFactor:o.metallicFactor,roughnessFactor:o.roughnessFactor,metallicRoughnessTexture:await f,hasVertexColors:a,ESRI_externalColorMixMode:n.extras.ESRI_externalColorMixMode,colorTextureTransform:o?.baseColorTexture?.extensions?.KHR_texture_transform,normalTextureTransform:n.normalTexture?.extensions?.KHR_texture_transform,occlusionTextureTransform:n.occlusionTexture?.extensions?.KHR_texture_transform,emissiveTextureTransform:n.emissiveTexture?.extensions?.KHR_texture_transform,metallicRoughnessTextureTransform:o?.metallicRoughnessTexture?.extensions?.KHR_texture_transform}}return s}async getTexture(e,r){if(!e)return;if((e.texCoord||0)!==0)throw new U("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");const i=e.index,s=this.json.textures[i],n=Hut(s.sampler!=null?this.json.samplers[s.sampler]:{}),o=this._getTextureSourceId(s),a=this.json.images[o],l=await this._loadTextureImageData(i,s,r);return s0e(this._textureCache,i,()=>{const c=d=>d===33071||d===33648||d===10497,h=d=>{throw new U("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${d}`)};return{data:l,wrapS:c(n.wrapS)?n.wrapS:h(n.wrapS),wrapT:c(n.wrapT)?n.wrapT:h(n.wrapT),minFilter:n.minFilter,name:a.name,id:i}})}getNodeTransform(e){if(e===void 0)return Xut;let r=this._nodeTransformCache.get(e);if(!r){const i=this.getNodeTransform(this._getNodeParent(e)),s=this.json.nodes[e];s.matrix?r=ai(xe(),i,s.matrix):s.translation||s.rotation||s.scale?(r=OE(i),s.translation&&Gl(r,r,s.translation),s.rotation&&(cL[3]=bQ(cL,s.rotation),Rc(r,r,cL[3],cL)),s.scale&&g8(r,r,s.scale)):r=OE(i),this._nodeTransformCache.set(e,r)}return r}_wrapAccessor(e,r){return new e(r.raw,r.byteOffset,r.byteStride,r.byteOffset+r.byteStride*(r.entryCount-1)+r.componentByteSize*r.componentCount)}_resolveUri(e){return _u(e,this._baseUri)}_getNodeParent(e){return this._nodeParentMap.get(e)}_checkVersionSupported(){const e=nx.parse(this.json.asset.version,"glTF");Yut.validate(e)}_checkRequiredExtensionsSupported(){const e=this.json;if(e.extensionsRequired&&!e.extensionsRequired.every(r=>this._supportedExtensions.includes(r)))throw new U("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+e.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((e,r)=>{e.children&&e.children.forEach(i=>{this._nodeParentMap.set(i,r)})})}async _loadTextureImageData(e,r,i){const s=this._textureLoaders.get(e);if(s)return s;const n=this._createTextureLoader(r,i);return this._textureLoaders.set(e,n),n}_getTextureSourceId(e){if(e.extensions!==void 0&&e.extensions.KHR_texture_basisu!==null)return e.extensions.KHR_texture_basisu.source;if(e.source!==null)return e.source;throw new U("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.")}async _createTextureLoader(e,r){const i=this._getTextureSourceId(e),s=this.json.images[i];if(s.uri){if(s.uri.endsWith(".ktx2")){const l=await this._context.loadBinary(this._resolveUri(s.uri),r);return new DAe(new Uint8Array(l))}return this._context.loadImage(this._resolveUri(s.uri),r)}if(s.bufferView==null)throw new U("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(s.mimeType==null)throw new U("gltf-loader-unsupported-feature","Image mimeType must be defined.");const n=this.json.bufferViews[s.bufferView],o=await this.getBuffer(n.buffer,r);if(n.byteStride!=null)throw new U("gltf-loader-unsupported-feature","byteStride not supported for image buffer");const a=o.byteOffset+(n.byteOffset||0);return sut(new Uint8Array(o.buffer,a,n.byteLength),s.mimeType)}async getLoadedBuffersSize(){if(this._glbBuffer)return this._glbBuffer.byteLength;const e=await B7(Array.from(this._bufferLoaders.values())),r=await B7(Array.from(this._textureLoaders.values()));return e.reduce((i,s)=>i+(s?.byteLength??0),0)+r.reduce((i,s)=>i+(s?Ew(s)?s.data.byteLength:s.width*s.height*4:0),0)}};const Xut=M1e(xe(),Math.PI/2),Yut=new nx(2,0,"glTF"),cL=rd(),Zut={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Jut={[st.BYTE]:1,[st.UNSIGNED_BYTE]:1,[st.SHORT]:2,[st.UNSIGNED_SHORT]:2,[st.FLOAT]:4,[st.INT]:4,[st.UNSIGNED_INT]:4};function Qut(t){switch(t.componentType){case st.BYTE:return new Z8(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case st.UNSIGNED_BYTE:return new H8(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case st.SHORT:return new LP(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case st.UNSIGNED_SHORT:return new yQ(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case st.UNSIGNED_INT:return new _Q(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case st.FLOAT:return new Nv(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount)}}let Kut=0;async function jAe(t,e,r={},i=!0){const s=await Wut.load(t,e,r),n="gltf_"+Kut++,o={lods:[],materials:new Map,textures:new Map,meta:eht(s)},a=!(!s.json.asset.extras||s.json.asset.extras.ESRI_type!=="symbolResource"),l=new Map;await tht(s,async(h,d,f,m)=>{const g=l.get(f)??0;l.set(f,g+1);const _=h.mode!==void 0?h.mode:At.TRIANGLES,v=_===At.TRIANGLES||_===At.TRIANGLE_STRIP||_===At.TRIANGLE_FAN?_:null;if(v==null)return void K.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+At[_]+"). Skipping primitive.");if(!s.hasPositions(h))return void K.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.");const b=s.getPositionData(h,r),T=s.getMaterial(h,r,i),x=s.hasNormals(h)?s.getNormalData(h,r):null,S=s.hasTangents(h)?s.getTangentData(h,r):null,E=s.hasTextureCoordinates(h)?s.getTextureCoordinates(h,r):null,A=s.hasVertexColors(h)?s.getVertexColors(h,r):null,R=s.getIndexData(h,r),M={transform:OE(d),attributes:{position:await b,normal:x?await x:null,texCoord0:E?await E:null,color:A?await A:null,tangent:S?await S:null},indices:await R,primitiveType:v,material:iht(o,await T,n)};let D=null;o.meta!=null&&o.meta.ESRI_lod!=null&&o.meta.ESRI_lod.metric==="screenSpaceRadius"&&(D=o.meta.ESRI_lod.thresholds[f]),o.lods[f]=o.lods[f]||{parts:[],name:m,lodThreshold:D},o.lods[f].parts[g]=M});for(const h of o.lods)h.parts=h.parts.filter(d=>!!d);const c=await s.getLoadedBuffersSize();return{model:o,meta:{isEsriSymbolResource:a,uri:s.uri},customMeta:{},size:c}}function eht(t){const e=t.json;let r=null;return e.nodes.forEach(i=>{const s=i.extras;s!=null&&(s.ESRI_proxyEllipsoid||s.ESRI_lod)&&(r=s)}),r}async function tht(t,e){const r=t.json,i=r.scenes[r.scene||0].nodes,s=i.length>1,n=[];for(const a of i){const l=r.nodes[a];n.push(o(a,0)),rht(l)&&!s&&l.extensions.MSFT_lod.ids.forEach((c,h)=>o(c,h+1))}async function o(a,l){const c=r.nodes[a],h=t.getNodeTransform(a);if(c.weights!=null&&K.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported."),c.mesh!=null){const d=r.meshes[c.mesh];for(const f of d.primitives)n.push(e(f,h,l,d.name))}for(const d of c.children||[])n.push(o(d,l))}await Promise.all(n)}function rht(t){return t.extensions&&t.extensions.MSFT_lod&&Array.isArray(t.extensions.MSFT_lod.ids)}function iht(t,e,r){const i=n=>{const o=`${r}_tex_${n&&n.id}${n&&n.name?"_"+n.name:""}`;if(n&&!t.textures.has(o)){const a=zut(n.data,{wrap:{s:n.wrapS,t:n.wrapT},mipmap:sht.includes(n.minFilter),noUnpackFlip:!0});t.textures.set(o,a)}return o},s=`${r}_mat_${e.id}_${e.name}`;if(!t.materials.has(s)){const n=kut({color:[e.color[0],e.color[1],e.color[2]],opacity:e.color[3],alphaMode:e.alphaMode,alphaCutoff:e.alphaCutoff,doubleSided:e.doubleSided,colorMixMode:e.ESRI_externalColorMixMode,textureColor:e.colorTexture?i(e.colorTexture):void 0,textureNormal:e.normalTexture?i(e.normalTexture):void 0,textureOcclusion:e.occlusionTexture?i(e.occlusionTexture):void 0,textureEmissive:e.emissiveTexture?i(e.emissiveTexture):void 0,textureMetallicRoughness:e.metallicRoughnessTexture?i(e.metallicRoughnessTexture):void 0,emissiveFactor:[e.emissiveFactor[0],e.emissiveFactor[1],e.emissiveFactor[2]],colorTextureTransform:e.colorTextureTransform,normalTextureTransform:e.normalTextureTransform,occlusionTextureTransform:e.occlusionTextureTransform,emissiveTextureTransform:e.emissiveTextureTransform,metallicRoughnessTextureTransform:e.metallicRoughnessTextureTransform,metallicFactor:e.metallicFactor,roughnessFactor:e.roughnessFactor});t.materials.set(s,n)}return s}const sht=[Rt.LINEAR_MIPMAP_LINEAR,Rt.LINEAR_MIPMAP_NEAREST];function nht(t,e){switch(e){case At.TRIANGLES:return oht(t);case At.TRIANGLE_STRIP:return aht(t);case At.TRIANGLE_FAN:return lht(t)}}function oht(t){return typeof t=="number"?zE(t):I_(t)?new Uint16Array(t):t}function aht(t){const e=typeof t=="number"?t:t.length;if(e<3)return[];const r=e-2,i=X5(3*r);if(typeof t=="number"){let s=0;for(let n=0;n<r;n+=1)n%2==0?(i[s++]=n,i[s++]=n+1,i[s++]=n+2):(i[s++]=n+1,i[s++]=n,i[s++]=n+2)}else{let s=0;for(let n=0;n<r;n+=1)n%2==0?(i[s++]=t[n],i[s++]=t[n+1],i[s++]=t[n+2]):(i[s++]=t[n+1],i[s++]=t[n],i[s++]=t[n+2])}return i}function lht(t){const e=typeof t=="number"?t:t.length;if(e<3)return new Uint16Array(0);const r=e-2,i=r<=65536?new Uint16Array(3*r):new Uint32Array(3*r);if(typeof t=="number"){let a=0;for(let l=0;l<r;++l)i[a++]=0,i[a++]=l+1,i[a++]=l+2;return i}const s=t[0];let n=t[1],o=0;for(let a=0;a<r;++a){const l=t[a+2];i[o++]=s,i[o++]=n,i[o++]=l,n=l}return i}let cht=class{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}},uht=class{constructor(e,r,i){this.name=e,this.lodThreshold=r,this.pivotOffset=i,this.stageResources=new cht,this.numberOfVertices=0}};const yg=K.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function HAe(t,e){const r=await hht(t,e),i=await ght(r.textureDefinitions??{},e);let s=0;for(const n in i)if(i.hasOwnProperty(n)){const o=i[n];s+=o?.image?o.image.width*o.image.height*4:0}return{resource:r,textures:i,size:s+xEe(r)}}async function hht(t,e){const r=e!=null&&e.streamDataRequester;if(r)return dht(t,r,e);const i=await $u(ur(t,e));if(i.ok===!0)return i.value.data;zo(i.error),qAe(i.error)}async function dht(t,e,r){const i=await $u(e.request(t,"json",r));if(i.ok===!0)return i.value;zo(i.error),qAe(i.error.details.url)}function qAe(t){throw new U("",`Request for object resource failed: ${t}`)}function pht(t){const e=t.params,r=e.topology;let i=!0;switch(e.vertexAttributes||(yg.warn("Geometry must specify vertex attributes"),i=!1),e.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const n=e.faces;if(n){if(e.vertexAttributes)for(const o in e.vertexAttributes){const a=n[o];a&&a.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(yg.warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),i=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(yg.warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),i=!1)):(yg.warn(`Indexed geometry does not specify face indices for '${o}' attribute`),i=!1)}}else yg.warn("Indexed geometries must specify faces"),i=!1;break}default:yg.warn(`Unsupported topology '${r}'`),i=!1}t.params.material||(yg.warn("Geometry requires material"),i=!1);const s=t.params.vertexAttributes;for(const n in s)s[n].values||(yg.warn("Geometries with externally defined attributes are not yet supported"),i=!1);return i}function fht(t,e){const r=new Array,i=new Array,s=new Array,n=new DC,o=t.resource,a=nx.parse(o.version||"1.0","wosr");_ht.validate(a);const l=o.model.name,c=o.model.geometries,h=o.materialDefinitions??{},d=t.textures;let f=0;const m=new Map;for(let g=0;g<c.length;g++){const _=c[g];if(!pht(_))continue;const v=yht(_),b=_.params.vertexAttributes,T=[];for(const L in b){const N=b[L],q=N.values;T.push([L,new We(q,N.valuesPerElement,!0)])}const x=[];if(_.params.topology!=="PerAttributeArray"){const L=_.params.faces;for(const N in L)x.push([N,L[N].values])}const S=v.texture,E=d&&d[S];if(E&&!m.has(S)){const{image:L,parameters:N}=E,q=new Nx(L,N);i.push(q),m.set(S,q)}const A=m.get(S),R=A?A.id:void 0,M=v.material;let D=n.get(M,S);if(D==null){const L=h[M.substring(M.lastIndexOf("/")+1)].params;L.transparency===1&&(L.transparency=0);const N=E&&E.alphaChannelUsage,q=L.transparency>0||N==="transparency"||N==="maskAndTransparency",X=E?WAe(E.alphaChannelUsage):void 0,G={ambient:Qa(L.diffuse),diffuse:Qa(L.diffuse),opacity:1-(L.transparency||0),transparent:q,textureAlphaMode:X,textureAlphaCutoff:.33,textureId:R,initTextureTransparent:!0,doubleSided:!0,cullFace:gi.None,colorMixMode:L.externalColorMixMode||"tint",textureAlphaPremultiplied:E?.parameters.preMultiplyAlpha??!1};e!=null&&e.materialParamsMixin&&Object.assign(G,e.materialParamsMixin),D=new Sm(G),n.set(M,S,D)}s.push(D);const k=new Ks(D,T,x);f+=x.find(L=>L[0]===C.POSITION)?.[1].length??0,r.push(k)}return{engineResources:[{name:l,stageResources:{textures:i,materials:s,geometries:r},pivotOffset:o.model.pivotOffset,numberOfVertices:f,lodThreshold:null}],referenceBoundingBox:mht(r)}}function mht(t){const e=Ei();return t.forEach(r=>{const i=r.boundingInfo;i!=null&&(mm(e,i.bbMin),mm(e,i.bbMax))}),e}async function ght(t,e){const r=new Array;for(const n in t){const o=t[n],a=o.images[0].data;if(!a){yg.warn("Externally referenced texture data is not yet supported");continue}const l=o.encoding+";base64,"+a,c="/textureDefinitions/"+n,h=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",d={noUnpackFlip:!0,wrap:{s:Dt.REPEAT,t:Dt.REPEAT},preMultiplyAlpha:WAe(h)!==Kr.Opaque},f=e!=null&&e.disableTextures?Promise.resolve(null):E0(l,e);r.push(f.then(m=>({refId:c,image:m,parameters:d,alphaChannelUsage:h})))}const i=await Promise.all(r),s={};for(const n of i)s[n.refId]=n;return s}function WAe(t){switch(t){case"mask":return Kr.Mask;case"maskAndTransparency":return Kr.MaskBlend;case"none":return Kr.Opaque;default:return Kr.Blend}}function yht(t){const e=t.params;return{id:1,material:e.material,texture:e.texture,region:e.texture}}const _ht=new nx(1,2,"wosr"),CT=2.1;async function XAe(t,e){const r=YAe(Fq(t));if(r.fileType==="wosr"){const d=await(e.cache?e.cache.loadWOSR(r.url,e):HAe(r.url,e)),{engineResources:f,referenceBoundingBox:m}=fht(d,e);return{lods:f,referenceBoundingBox:m,isEsriSymbolResource:!1,isWosr:!0}}const i=await(e.cache?e.cache.loadGLTF(r.url,e,!!e.usePBR):jAe(new BAe(e.streamDataRequester),r.url,e,e.usePBR)),s=i.model.meta?.ESRI_proxyEllipsoid,n=i.meta.isEsriSymbolResource&&s!=null&&i.meta.uri.includes("/RealisticTrees/");n&&!i.customMeta.esriTreeRendering&&(i.customMeta.esriTreeRendering=!0,xht(i,s));const o=!!e.usePBR,a=i.meta.isEsriSymbolResource?{usePBR:o,isSchematic:!1,treeRendering:n,mrrFactors:[...hat]}:{usePBR:o,isSchematic:!1,treeRendering:!1,mrrFactors:[...M9]},l={...e.materialParamsMixin,treeRendering:n},{engineResources:c,referenceBoundingBox:h}=ZAe(i,a,l,e.skipHighLods&&r.specifiedLodIndex==null?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:r.specifiedLodIndex});return{lods:c,referenceBoundingBox:h,isEsriSymbolResource:i.meta.isEsriSymbolResource,isWosr:!1}}function YAe(t){const e=t.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return e?{fileType:"gltf",url:e[1],specifiedLodIndex:e[4]!=null?Number(e[4]):null}:t.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:t,specifiedLodIndex:null}:{fileType:"unknown",url:t,specifiedLodIndex:null}}function ZAe(t,e,r,i){const s=t.model,n=new Array,o=new Map,a=new Map,l=s.lods.length,c=Ei();return s.lods.forEach((h,d)=>{const f=i.skipHighLods===!0&&(l>1&&d===0||l>3&&d===1)||i.skipHighLods===!1&&i.singleLodIndex!=null&&d!==i.singleLodIndex;if(f&&d!==0)return;const m=new uht(h.name,h.lodThreshold,[0,0,0]);h.parts.forEach(g=>{const _=f?new Sm({}):vht(s,g,m,e,r,o,a),{geometry:v,vertexCount:b}=bht(g,_??new Sm({})),T=v.boundingInfo;T!=null&&d===0&&(mm(c,T.bbMin),mm(c,T.bbMax)),_!=null&&(m.stageResources.geometries.push(v),m.numberOfVertices+=b)}),f||n.push(m)}),{engineResources:n,referenceBoundingBox:c}}function vht(t,e,r,i,s,n,o){const a=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),l=t.materials.get(e.material),c=e.attributes.texCoord0!=null,h=e.attributes.normal!=null;if(l==null)return null;const d=wht(l.alphaMode);if(!n.has(a)){if(c){const E=(A,R=!1)=>{if(A!=null&&!o.has(A)){const M=t.textures.get(A);if(M!=null){const D=M.data;o.set(A,new Nx(Ew(D)?D.data:D,{...M.parameters,preMultiplyAlpha:!Ew(D)&&R,encoding:Ew(D)&&D.encoding!=null?D.encoding:void 0}))}}};E(l.textureColor,d!==Kr.Opaque),E(l.textureNormal),E(l.textureOcclusion),E(l.textureEmissive),E(l.textureMetallicRoughness)}const m=l.color[0]**(1/CT),g=l.color[1]**(1/CT),_=l.color[2]**(1/CT),v=l.emissiveFactor[0]**(1/CT),b=l.emissiveFactor[1]**(1/CT),T=l.emissiveFactor[2]**(1/CT),x=l.textureColor!=null&&c?o.get(l.textureColor):null,S=z3e({normalTexture:l.textureNormal,metallicRoughnessTexture:l.textureMetallicRoughness,metallicFactor:l.metallicFactor,roughnessFactor:l.roughnessFactor,emissiveTexture:l.textureEmissive,emissiveFactor:l.emissiveFactor,occlusionTexture:l.textureOcclusion});n.set(a,new Sm({...i,transparent:d===Kr.Blend,customDepthTest:qw.Lequal,textureAlphaMode:d,textureAlphaCutoff:l.alphaCutoff,diffuse:[m,g,_],ambient:[m,g,_],opacity:l.opacity,doubleSided:l.doubleSided,doubleSidedType:"winding-order",cullFace:l.doubleSided?gi.None:gi.Back,hasVertexColors:!!e.attributes.color,hasVertexTangents:!!e.attributes.tangent,normalType:h?Ir.Attribute:Ir.ScreenDerivative,castShadows:!0,receiveSSAO:!0,textureId:x?.id,colorMixMode:l.colorMixMode,normalTextureId:l.textureNormal!=null&&c?o.get(l.textureNormal).id:void 0,textureAlphaPremultiplied:x!=null&&!!x.parameters.preMultiplyAlpha,occlusionTextureId:l.textureOcclusion!=null&&c?o.get(l.textureOcclusion).id:void 0,emissiveTextureId:l.textureEmissive!=null&&c?o.get(l.textureEmissive).id:void 0,metallicRoughnessTextureId:l.textureMetallicRoughness!=null&&c?o.get(l.textureMetallicRoughness).id:void 0,emissiveFactor:[v,b,T],mrrFactors:S?[...qK]:[l.metallicFactor,l.roughnessFactor,i.mrrFactors[2]],isSchematic:S,colorTextureTransformMatrix:Bf(l.colorTextureTransform),normalTextureTransformMatrix:Bf(l.normalTextureTransform),occlusionTextureTransformMatrix:Bf(l.occlusionTextureTransform),emissiveTextureTransformMatrix:Bf(l.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:Bf(l.metallicRoughnessTextureTransform),...s}))}const f=n.get(a);if(r.stageResources.materials.push(f),c){const m=g=>{g!=null&&r.stageResources.textures.push(o.get(g))};m(l.textureColor),m(l.textureNormal),m(l.textureOcclusion),m(l.textureEmissive),m(l.textureMetallicRoughness)}return f}function bht(t,e){const r=t.attributes.position.count,i=nht(t.indices||r,t.primitiveType),s=es(3*r),{typedBuffer:n,typedBufferStride:o}=t.attributes.position;QE(s,n,t.transform,3,o);const a=[[C.POSITION,new We(s,3,!0)]],l=[[C.POSITION,i]];if(t.attributes.normal!=null){const c=es(3*r),{typedBuffer:h,typedBufferStride:d}=t.attributes.normal;gv(uL,t.transform),ex(c,h,uL,3,d),a.push([C.NORMAL,new We(c,3,!0)]),l.push([C.NORMAL,i])}if(t.attributes.tangent!=null){const c=es(4*r),{typedBuffer:h,typedBufferStride:d}=t.attributes.tangent;gv(uL,t.transform),eee(c,h,uL,4,d),a.push([C.TANGENT,new We(c,4,!0)]),l.push([C.TANGENT,i])}if(t.attributes.texCoord0!=null){const c=es(2*r),{typedBuffer:h,typedBufferStride:d}=t.attributes.texCoord0;tee(c,h,2,d),a.push([C.UV0,new We(c,2,!0)]),l.push([C.UV0,i])}if(t.attributes.color!=null){const c=new Uint8Array(4*r);t.attributes.color.elementCount===4?t.attributes.color instanceof Ip?RF(c,t.attributes.color,255):t.attributes.color instanceof wa?ree(c,t.attributes.color):t.attributes.color instanceof $P&&RF(c,t.attributes.color,1/256):(c.fill(255),t.attributes.color instanceof mn?vF(c,t.attributes.color,255,4):t.attributes.color instanceof q8?eI(c,t.attributes.color.typedBuffer,4,t.attributes.color.typedBufferStride):t.attributes.color instanceof X8&&vF(c,t.attributes.color,1/256,4)),a.push([C.COLOR,new We(c,4,!0)]),l.push([C.COLOR,i])}return{geometry:new Ks(e,a,l),vertexCount:r}}const uL=ki();function wht(t){switch(t){case"BLEND":return Kr.Blend;case"MASK":return Kr.Mask;case"OPAQUE":case null:case void 0:return Kr.Opaque}}function xht(t,e){for(let r=0;r<t.model.lods.length;++r){const i=t.model.lods[r];for(const s of i.parts){const n=s.attributes.normal;if(n==null)return;const o=s.attributes.position,a=o.count,l=O(),c=O(),h=O(),d=new Uint8Array(4*a),f=new Float64Array(3*a),m=$n(xe(),s.transform);let g=0,_=0;for(let v=0;v<a;v++){o.getVec(v,c),n.getVec(v,l),ze(c,c,s.transform),fe(h,c,e.center),o5(h,h,e.radius);const b=h[2],T=Re(h),x=Math.min(.45+.55*T*T,1);o5(h,h,e.radius),m!==null&&ze(h,h,m),_e(h,h),r+1!==t.model.lods.length&&t.model.lods.length>1&&qr(h,h,l,b>-1?.2:Math.min(-4*b-3.8,1)),f[g]=h[0],f[g+1]=h[1],f[g+2]=h[2],g+=3,d[_]=255*x,d[_+1]=255*x,d[_+2]=255*x,d[_+3]=255,_+=4}s.attributes.normal=new mn(f),s.attributes.color=new wa(d)}}}const hBt=Object.freeze(Object.defineProperty({__proto__:null,fetch:XAe,gltfToEngineResources:ZAe,parseUrl:YAe},Symbol.toStringTag,{value:"Module"})),Tht=()=>!!ae("enable-feature:force-wosr"),dBt=()=>!!ae("enable-feature:direct-3d-object-feature-layer-display"),Sht=()=>ae.add("enable-feature:direct-3d-object-feature-layer-display",!0,!0,!0),Eht=()=>ae.add("enable-feature:direct-3d-object-feature-layer-display",!1,!0,!0),pBt=()=>!!ae("enable-i3s-patching"),Cht=()=>ae.add("enable-i3s-patching",!0,!0,!0),Aht=()=>ae.add("enable-i3s-patching",!1,!0,!0),uce=()=>!!ae("enable-feature:SceneLayer-editing"),Oht=(t="i3s-patching")=>{switch(Aht(),Eht(),ae.add("enable-feature:SceneLayer-editing",!0,!0,!0),t){case"feature-layer-view":Sht();break;case"i3s-patching":Cht()}};Oht("i3s-patching");let Xz={};async function Rht(t,e){try{return{data:(await see(t,e)).data,baseUrl:QY(t),styleUrl:t}}catch(r){return zo(r),null}}function Mht(t,e,r){const i=e.portal!=null?e.portal:en.getDefault();let s;const n=`${i.url} - ${i.user&&i.user.username} - ${t}`;return Xz[n]||(Xz[n]=Pht(t,i,r).then(o=>(s=o,o.fetchData())).then(o=>({data:o,baseUrl:s.itemUrl??"",styleName:t}))),Xz[n]}function Pht(t,e,r){return e.load(r).then(()=>{const i=new Ff({disableExtraQuery:!0,query:`owner:${hce} AND type:${dce} AND typekeywords:"${t}"`});return e.queryItems(i,r)}).then(({results:i})=>{let s=null;const n=t.toLowerCase();if(i&&Array.isArray(i)){for(const o of i)if(o.typeKeywords?.some(l=>l.toLowerCase()===n)&&o.type===dce&&o.owner===hce){s=o;break}}if(!s)throw new U("symbolstyleutils:style-not-found",`The style '${t}' could not be found`,{styleName:t});return s.load(r)})}function iee(t,e,r){return t&&t.styleUrl!=null?Rht(t.styleUrl,r):t&&t.styleName!=null?Mht(t.styleName,e,r):Promise.reject(new U("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function JAe(t){return t===null||t.type==="CIMSymbolReference"?t:{type:"CIMSymbolReference",symbol:t}}function QAe(t,e,r=["gltf"]){if(e==="cimRef")return t.cimRef;if(t.formatInfos&&!Tht())for(const i of r){const s=t.formatInfos.find(n=>n.type===i);if(s)return s.href}return t.webRef}function see(t,e){const r={responseType:"json",query:{f:"json"},...e};return ur(_p(t),r)}const hce="esri_en",dce="Style",Iht="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json",F3={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function $ht(t,e=F3){if(!t)return{symbol:null};const{retainId:r=F3.retainId,ignoreDrivers:i=F3.ignoreDrivers,hasLabelingContext:s=F3.hasLabelingContext,retainCIM:n=F3.retainCIM}=e;let o=null;if(Bw(t)||t instanceof Cx)o=t.clone();else if(t.type==="cim"){const a=t.data?.symbol?.type;if(a!=="CIMPointSymbol")return{error:new U("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${a||"unknown"}' is unsupported in 3D`,{symbol:t})};o=n?t.clone():qf.fromCIMSymbol(t)}else if(t instanceof zu)o=d8.fromSimpleLineSymbol(t);else if(t instanceof $v)o=qf.fromSimpleMarkerSymbol(t);else if(t instanceof SP)o=qf.fromPictureMarkerSymbol(t);else if(t instanceof Iv)o=e.geometryType&&e.geometryType==="mesh"?SE.fromSimpleFillSymbol(t):EP.fromSimpleFillSymbol(t);else{if(!(t instanceof Ex))return{error:new U("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${t.type||t.declaredClass}' is unsupported in 3D`,{symbol:t})};o=s?TP.fromTextSymbol(t):qf.fromTextSymbol(t)}return r&&o&&o.type!=="cim"&&(o.id=t.id),i&&Bw(o)&&o.symbolLayers.forEach(a=>a.ignoreDrivers=!0),{symbol:o}}function MF(t,e,r,i){const s=KAe(t,{},{context:i,isLabelSymbol:!1});s!=null&&(e[r]=s)}function pce(t,e,r,i){const s=KAe(t,{},{context:i,isLabelSymbol:!0});s!=null&&(e[r]=s)}function fce(t){return t instanceof AC||t instanceof Cx}function KAe(t,e,r){if(t==null)return null;const{context:i,isLabelSymbol:s}=r,n=i?.origin,o=i?.messages;if(n==="web-scene"&&!fce(t)){const a=$ht(t,{retainCIM:!0,hasLabelingContext:s});return a.symbol!=null?a.symbol.write(e,i):(o?.push(new U("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:t,context:i,error:a.error})),null)}return(n==="web-map"||n==="portal-item"&&!fye(i?.layer))&&fce(t)?(o?.push(new U("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:t,context:i})),null):t.write(e,i)}function eOe(t,e){return tVe(t,null,e)}function Lht(t,e,r,i){const s=t.name;return s==null?Promise.reject(new U("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):t.styleName&&t.styleName==="Esri2DPointSymbolsStyle"?Dht(s,e,i):iee(t,e,i).then(n=>oee(_c(n),s,e,r,QAe,i))}function nee(t,e){return e.items.find(r=>r.name===t)}function oee(t,e,r,i,s,n){const o=r&&r.portal!=null?r.portal:en.getDefault(),a={portal:o,url:Co(t.baseUrl),origin:"portal-item"},l=nee(e,t.data);if(!l){const m=`The symbol name '${e}' could not be found`;return Promise.reject(new U("symbolstyleutils:symbol-name-not-found",m,{symbolName:e}))}let c=_0(s(l,i),a),h=l.thumbnail?.href??null;const d=l.thumbnail&&l.thumbnail.imageData;Cut()&&(c=Fq(c)??"",h=Fq(h));const f={portal:o,url:Co(QY(c)),origin:"portal-item"};return see(c,n).then(m=>{const g=i==="cimRef"?JAe(m.data):m.data,_=eOe(g,f);if(_&&Bw(_)){if(h){const v=_0(h,a);_.thumbnail=new fw({url:v})}else d&&(_.thumbnail=new fw({url:`data:image/png;base64,${d}`}));t.styleUrl?_.styleOrigin=new dM({portal:r.portal,styleUrl:t.styleUrl,name:e}):t.styleName&&(_.styleOrigin=new dM({portal:r.portal,styleName:t.styleName,name:e}))}return _})}function Dht(t,e,r){const i=Iht.replaceAll(/\{SymbolName\}/gi,t),s=e.portal!=null?e.portal:en.getDefault();return see(i,r).then(n=>{const o=JAe(n.data);return eOe(o,{portal:s,url:Co(QY(i)),origin:"portal-item"})})}const Nht=Object.freeze(Object.defineProperty({__proto__:null,fetchSymbolFromStyle:oee,getStyleItemFromStyle:nee,resolveWebStyleSymbol:Lht},Symbol.toStringTag,{value:"Module"}));async function Fht(t){if(t===null||t.styleName==null&&t.styleUrl==null)return null;const e=t.name;if(e==null)throw new U("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference");const r={portal:t.portal},i=await iee(t,r).catch(()=>null);if(i===null)return null;const s=nee(e,i.data);if(s&&!s.formatInfos?.some(a=>a.type==="gltf_basisu"))return null;const n=await oee(i,e,r,"webRef",(a,l)=>QAe(a,l,["gltf_basisu","gltf"])).catch(()=>null);if(n===null||n.type!=="point-3d")return null;const o=n.symbolLayers.items[0];return o.type==="object"?o.resource:null}let Uht=class{constructor(e,r,i){this._elementSize=r,this._buffer=kr.createVertex(e,Cr.STATIC_DRAW),this.resize(i)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get memoryUsage(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}copyRange(e,r,i,s=0){const n=new Uint8Array(this.array,e*this.elementSize,(r-e)*this.elementSize);new Uint8Array(i.array,s*this.elementSize).set(n)}transferAll(){this._buffer.setData(this._array)}transferRange(e,r){const i=e*this._elementSize,s=r*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),i,i,s)}resize(e){const r=e*this._elementSize,i=new ArrayBuffer(r);this._array&&(e>=this._capacity?new Uint8Array(i).set(new Uint8Array(this._array)):new Uint8Array(i).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=i,this._buffer.setSize(r),this._capacity=e}},kht=class{constructor(e){this.modelOriginHi=e.getField(C.MODELORIGINHI,mn),this.modelOriginLo=e.getField(C.MODELORIGINLO,mn),this.model=e.getField(C.MODEL,_v),this.modelNormal=e.getField(C.MODELNORMAL,_v),this.featureAttribute=e.getField(C.INSTANCEFEATUREATTRIBUTE,Ip),this.color=e.getField(C.INSTANCECOLOR,wa),this.objectAndLayerIdColor=e.getField(C.INSTANCEOBJECTANDLAYERIDCOLOR,wa)}},mce=class{constructor(e,r){this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=e,this._instanceBufferLayout=r,this._elementSize=r.stride,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,r=this._tailIndex;return e>=r?e-r:e+this._capacity-r}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get memoryUsage(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){ot(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){ot(this._updating,"not updating"),this.size<EDe*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){ot(this._updating,"not updating"),this.isFull&&this._grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this._incrementHead(),ot(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){ot(this._updating,"not updating"),ot(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}_grow(){const e=Math.max(PF,Math.floor(this._capacity*P6));this._resize(e)}_shrink(){const e=Math.max(PF,Math.floor(this._capacity*SDe));this._resize(e)}_resize(e){if(ot(this._updating,"not updating"),e===this._capacity)return;const r=new Uht(this._rctx,this._elementSize,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const i=this.size,s=this._compactInstances(r);ot(s===i,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=s,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=r,this._view=new kht(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(e){const r=this._headIndex,i=this._tailIndex;return i<r?(this._buffer.copyRange(i,r,e),r-i):i>r?(this._buffer.copyRange(i,this._capacity,e),r>0&&this._buffer.copyRange(0,r,e,this._capacity-i),r+(this._capacity-i)):0}_incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}_incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}_transferRange(e,r){e<r?this._buffer.transferRange(e,r):e>r&&(r>0&&this._buffer.transferRange(0,r),this._buffer.transferRange(e,this._capacity))}};const PF=64;var Li;function zht(t){let e=qi().mat4f64(C.LOCALTRANSFORM).mat4f64(C.GLOBALTRANSFORM).vec4f64(C.BOUNDINGSPHERE).vec3f64(C.MODELORIGIN).mat3f(C.MODEL).mat3f(C.MODELNORMAL).vec2f(C.MODELSCALEFACTORS);return t.includes(C.FEATUREATTRIBUTE)&&(e=e.vec4f(C.FEATUREATTRIBUTE)),t.includes(C.COLOR)&&(e=e.vec4u8(C.COLOR)),t.includes(C.OBJECTANDLAYERIDCOLOR)&&(e=e.vec4u8(C.OBJECTANDLAYERIDCOLOR)),e=e.u8(C.STATE).u8(C.LODLEVEL),e}(function(t){t[t.ALLOCATED=1]="ALLOCATED",t[t.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",t[t.VISIBLE=4]="VISIBLE",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",t[t.REMOVE=32]="REMOVE",t[t.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",t[t.ACTIVE=18]="ACTIVE"})(Li||(Li={}));let gce=class{constructor(e){this.localTransform=e.getField(C.LOCALTRANSFORM,CM),this.globalTransform=e.getField(C.GLOBALTRANSFORM,CM),this.modelOrigin=e.getField(C.MODELORIGIN,Kh),this.model=e.getField(C.MODEL,_v),this.modelNormal=e.getField(C.MODELNORMAL,_v),this.modelScaleFactors=e.getField(C.MODELSCALEFACTORS,Nv),this.boundingSphere=e.getField(C.BOUNDINGSPHERE,j8),this.featureAttribute=e.getField(C.FEATUREATTRIBUTE,Ip),this.color=e.getField(C.COLOR,wa),this.objectAndLayerIdColor=e.getField(C.OBJECTANDLAYERIDCOLOR,wa),this.state=e.getField(C.STATE,kE),this.lodLevel=e.getField(C.LODLEVEL,kE)}},R2=class extends Te{constructor(e,r){super(e),this.events=new Ts,this._capacity=0,this._size=0,this._next=0,this._layout=zht(r),this._capacity=PF,this._buffer=this._layout.createBuffer(this._capacity),this._view=new gce(this._buffer)}get capacity(){return this._capacity}get size(){return this._size}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,Li.ALLOCATED),this._size++,this.events.emit("instances-changed"),e}removeInstance(e){const r=this._view.state;ot(e>=0&&e<this._capacity&&(r.get(e)&Li.ALLOCATED)!=0,"invalid instance handle"),this._getStateFlag(e,Li.ACTIVE)?this._setStateFlags(e,Li.REMOVE):this.freeInstance(e),this.events.emit("instances-changed")}freeInstance(e){const r=this._view.state;ot(e>=0&&e<this._capacity&&(r.get(e)&Li.ALLOCATED)!=0,"invalid instance handle"),r.set(e,0),this._size--}setLocalTransform(e,r,i=!0){this._view.localTransform.setMat(e,r),i&&this.updateModelTransform(e)}getLocalTransform(e,r){this._view.localTransform.getMat(e,r)}setGlobalTransform(e,r,i=!0){this._view.globalTransform.setMat(e,r),i&&this.updateModelTransform(e)}getGlobalTransform(e,r){this._view.globalTransform.getMat(e,r)}updateModelTransform(e){const r=this._view,i=Ql,s=gd;r.localTransform.getMat(e,yce),r.globalTransform.getMat(e,Yz);const n=ai(Yz,Yz,yce);ne(i,n[12],n[13],n[14]),r.modelOrigin.setVec(e,i),Jh(s,n),r.model.setMat(e,s);const o=iBe(Ql,n);o.sort(),r.modelScaleFactors.set(e,0,o[1]),r.modelScaleFactors.set(e,1,o[2]),$x(s,s),Qh(s,s),r.modelNormal.setMat(e,s),this._setStateFlags(e,Li.TRANSFORM_CHANGED),this.events.emit("instance-transform-changed",{index:e})}getModelTransform(e,r){const i=this._view;i.model.getMat(e,gd),i.modelOrigin.getVec(e,Ql),r[0]=gd[0],r[1]=gd[1],r[2]=gd[2],r[3]=0,r[4]=gd[3],r[5]=gd[4],r[6]=gd[5],r[7]=0,r[8]=gd[6],r[9]=gd[7],r[10]=gd[8],r[11]=0,r[12]=Ql[0],r[13]=Ql[1],r[14]=Ql[2],r[15]=1}applyShaderTransformation(e,r){this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,r)}getCombinedModelTransform(e,r){return this.getModelTransform(e,r),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,r),r}getCombinedLocalTransform(e,r){this._view.localTransform.getMat(e,r),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,r)}getCombinedMaxScaleFactor(e){let r=this._view.modelScaleFactors.get(e,1);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(Ql,this,e),r*=Math.max(Ql[0],Ql[1],Ql[2])),r}getCombinedMedianScaleFactor(e){let r=this._view.modelScaleFactors.get(e,0);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(Ql,this,e),r*=Vht(Ql[0],Ql[1],Ql[2])),r}getModel(e,r){this._view.model.getMat(e,r)}setFeatureAttribute(e,r){this._view.featureAttribute.setVec(e,r)}getFeatureAttribute(e,r){this._view.featureAttribute.getVec(e,r)}setColor(e,r){this._view.color.setVec(e,r)}setObjectAndLayerIdColor(e,r){this._view.objectAndLayerIdColor.setVec(e,r)}setVisible(e,r){r!==this.getVisible(e)&&(this._setStateFlag(e,Li.VISIBLE,r),this.events.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,Li.VISIBLE)}setHighlight(e,r){r!==this.getHighlight(e)&&(this._setStateFlag(e,Li.HIGHLIGHT,r),this.events.emit("instance-highlight-changed"))}getHighlight(e){return this._getStateFlag(e,Li.HIGHLIGHT)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let r=0;for(let i=0;i<this._capacity;++i)this.getState(i)&e&&++r;return r}_setStateFlags(e,r){const i=this._view.state;r=i.get(e)|r,i.set(e,r)}_clearStateFlags(e,r){const i=this._view.state;r=i.get(e)&~r,i.set(e,r)}_setStateFlag(e,r,i){i?this._setStateFlags(e,r):this._clearStateFlags(e,r)}_getStateFlag(e,r){return!!(this._view.state.get(e)&r)}_grow(){this._capacity=Math.max(PF,Math.floor(this._capacity*P6)),this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer),this._view=new gce(this._buffer)}_findSlot(){const e=this._view.state;let r=this._next;for(;e.get(r)&Li.ALLOCATED;)r=r+1===this._capacity?0:r+1;return this._next=r+1===this._capacity?0:r+1,r}};function Vht(t,e,r){return Math.max(Math.min(t,e),Math.min(Math.max(t,e),r))}u([p({constructOnly:!0})],R2.prototype,"shaderTransformation",void 0),u([p()],R2.prototype,"_size",void 0),u([p({readOnly:!0})],R2.prototype,"size",null),R2=u([P("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],R2);const Ql=O(),gd=ki(),yce=xe(),Yz=xe();let Bht=class extends mp{constructor(e,r){super(i=>this._instanceData.view.boundingSphere.getVec(i,this._tmpSphere),{maximumDepth:25}),this._instanceData=e,this._boundingSphere=r,this._tmpSphere=xs(),this._tmpMat4=xe()}addInstance(e){const r=this._instanceData.view.boundingSphere,i=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);ze(this._tmpSphere,this._boundingSphere.center,i),this._tmpSphere[3]=this._boundingSphere.radius*ME(i),r.setVec(e,this._tmpSphere),this.add([e])}removeInstance(e){this.remove([e])}},Ght=class{constructor(e,r){this._worldSpaceRadius=e,this._minScreenSpaceRadii=r}selectLevel(e,r,i){const s=i.computeScreenPixelSizeAt(e),n=this._worldSpaceRadius*r/s;let o=0;for(let a=1;a<this._minScreenSpaceRadii.length;++a)n>=this._minScreenSpaceRadii[a]&&(o=a);return o}},jht=class extends Q8{constructor(e,r,i,s,n,o){super(e,r),this.layerUid=e,this.graphicUid=r,this.geometryId=i,this.triangleNr=s,this.baseBoundingSphere=n,this.numLodLevels=o}};function aee(t){return Fp(t)&&t.intersector===ji.LOD&&!!t.target}let Hht=class{constructor(e,r){const i=e.renderContext.rctx,s=r.geometry;this._materialRepository=e.materialRepository,s.material.setParameters({instancedDoublePrecision:!0});const n=s.material.createBufferWriter(),o=n.vertexBufferLayout,a=n.elementCount(s),l=o.createBuffer(a);n.write(null,null,s,l,0),this.geometry=s,this.material=s.material,this.glMaterials=new g3e(s.material,this._materialRepository),this.vertexBufferLayout=o,this.vbo=kr.createVertex(i,Cr.STATIC_DRAW,l.buffer),this.vao=new Np(i,Tr,{geometry:Gc(o)},{geometry:this.vbo}),this.vertexCount=a}destroy(){this.glMaterials.destroy(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(e,r,i,s,n,o,a,l){const c=this.geometry.id;this.material.intersect(this.geometry,e.transform.transform,e,i,s,(h,d,f,m,g)=>{if(h>=0){if(r!=null&&!r(e.rayBegin,e.rayEnd,h))return;const _=new jht(o.layerUid,o.graphicUid(n),c,f,a,l);if((e.results.min.drapedLayerOrder==null||g>=e.results.min.drapedLayerOrder)&&(e.results.min.dist==null||h<e.results.min.dist)&&e.results.min.set(ji.LOD,_,h,d,e.transform.transform,g),e.options.store!==So.MIN&&(e.results.max.drapedLayerOrder==null||g>=e.results.max.drapedLayerOrder)&&(e.results.max.dist==null||h>e.results.max.dist)&&e.results.max.set(ji.LOD,_,h,d,e.transform.transform,g),e.options.store===So.ALL){const v=EQ(e.results.min.ray);v.set(ji.LOD,_,h,d,e.transform.transform,g),e.results.all.push(v)}}})}},qht=class tOe{static async create(e,r,i){const s=await Promise.allSettled(r.components.map(o=>e.controller.schedule(()=>new Hht(e,o),i))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(Qf);if(Mn(i)||n.length!==s.length){n.forEach(o=>o.destroy()),Yt(i);for(const o of s)if(o.status==="rejected")throw o.reason}return new tOe(r.minScreenSpaceRadius,n)}constructor(e,r){this.minScreenSpaceRadius=e,this.components=r}destroy(){this.components.forEach(e=>e.destroy())}intersect(e,r,i,s,n,o,a){this.components.forEach(l=>l.intersect(e,r,i,s,n,o,this.boundingSphere,a))}get boundingBox(){if(this._boundingBox==null){const e=Ei();this.components.forEach(r=>{r.boundingInfo!=null&&(mm(e,r.boundingInfo.bbMin),mm(e,r.boundingInfo.bbMax))}),this._boundingBox=e}return this._boundingBox}get boundingSphere(){if(this._boundingSphere==null){const e=this.boundingBox,r=O();hp(e,r),this._boundingSphere={center:r,radius:.5*Vve(e)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((e,r)=>e+r.triangleCount,0)}};const Wht=t=>{const e=t.baseBoundingSphere.radius,r=t.levels.map(i=>i.minScreenSpaceRadius);return new Ght(e,r)};let hh=class extends Te{constructor(e,r){super(e),this.type=ji.LOD,this.isGround=!1,this._handles=new $i,this._levels=[],this._defaultRenderInstanceData=[new Array],this._highlightRenderInstanceData=[new Array],this._allRenderInstanceData=[this._defaultRenderInstanceData[0],this._highlightRenderInstanceData[0]],this._instanceIndex=0,this._cycleStartIndex=0,this._slicePlane=!1,this._camera=new yt,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.slots=[pe.OPAQUE_MATERIAL,pe.TRANSPARENT_MATERIAL],this.canRender=!0,this._instanceData=new R2({shaderTransformation:e.shaderTransformation},e.optionalFields),this._handles.add(r.registerTask(vt.LOD_RENDERER,this))}initialize(){this._instanceBufferLayout=Yht(this.optionalFields),this._glInstanceBufferLayout=Gc(this._instanceBufferLayout,1),this._handles.add([this._instanceData.events.on("instances-changed",()=>this._requestUpdateCycle()),this._instanceData.events.on("instance-transform-changed",({index:e})=>{this._requestUpdateCycle(),this.metadata.notifyGraphicGeometryChanged(e)}),this._instanceData.events.on("instance-visibility-changed",({index:e})=>{this._requestUpdateCycle(!0),this.metadata.notifyGraphicVisibilityChanged(e)}),this._instanceData.events.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0))])}destroy(){this._handles.destroy()}get _enableLevelSelection(){return this.symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get memoryUsage(){const e={cpu:0,gpu:0};return this._allRenderInstanceData.forEach(r=>r.forEach(i=>{e.cpu+=i.memoryUsage.cpu,e.gpu+=i.memoryUsage.gpu})),e}get renderStats(){const e=this._instanceData.size,r=[];return this._levels.forEach((i,s)=>{const n=this._allRenderInstanceData[0][s].size+this._allRenderInstanceData[1][s].size,o=i.triangleCount;r.push({renderedInstances:n,renderedTriangles:n*o,trianglesPerInstance:o})}),{totalInstances:e,renderedInstances:r.reduce((i,s)=>i+s.renderedInstances,0),renderedTriangles:r.reduce((i,s)=>i+s.renderedTriangles,0),levels:r}}async initializeRenderContext(e,r){this._context=e;const i=e.renderContext.rctx,s=await Promise.allSettled(this.symbol.levels.map(o=>(this._defaultRenderInstanceData[0].push(new mce(i,this._instanceBufferLayout)),this._highlightRenderInstanceData[0].push(new mce(i,this._instanceBufferLayout)),qht.create(e,o,r)))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(Qf);if(Mn(r)||n.length!==s.length){n.forEach(o=>o.destroy()),Yt(r);for(const o of s)if(o.status==="rejected")throw o.reason}this._levels=n,this._levelSelector=Wht(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(e=>e.destroy()),this._defaultRenderInstanceData[0].forEach(e=>e.destroy()),this._highlightRenderInstanceData[0].forEach(e=>e.destroy())}get needsTransparentPass(){return this._levels.some(e=>e.components.some(r=>r.material.requiresSlot(pe.TRANSPARENT_MATERIAL,F.Color)))}get needsHighlight(){return this._highlightRenderInstanceData[0].some(e=>e.size>0)}prepareRender(e){if(!li.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const r=e.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(e.bindParameters.contentCamera),r||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(rl),this._needFullCycle=!1)}}prepareTechniques(e){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(e.output))return null;const r=this._getInstanceDatas(e.output);if(!r)return null;const i=new Array;return r.forEach(s=>this.levels.forEach((n,o)=>{n.components.forEach(a=>i.push(this._beginComponent(e,s[o],a)))})),i}render(e,r){const i=this._getInstanceDatas(e.output);if(!i)return;let s=0;e.rctx.bindVAO(),i.forEach(n=>this.levels.forEach((o,a)=>{o.components.forEach(l=>this._renderComponent(e,r[s++],n[a],l,a))}))}_getInstanceDatas(e){const r=e!==F.Highlight&&e!==F.ShadowHighlight,i=e!==F.ShadowExcludeHighlight;return r&&i?this._allRenderInstanceData:r?this._defaultRenderInstanceData:i?this._highlightRenderInstanceData:null}intersect(e,r,i,s){if(!this.baseMaterial.isVisible()||this._octree==null)return;const n=O();fe(n,s,i);const o=a=>{this._instanceData.getCombinedModelTransform(a,bce),e.transform.set(bce),ze(wce,i,e.transform.inverse),ze(xce,s,e.transform.inverse);const l=this._instanceData.getState(a),c=this._instanceData.getLodLevel(a),h=this._levels.length;ot((l&Li.ACTIVE)!=0,"invalid instance state"),ot(c>=0&&c<h,"invaid lod level"),this._levels[c].intersect(e,r,wce,xce,a,this.metadata,h)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(o):this._octree.forEachAlongRay(i,n,o)}queryDepthRange(e){return this._queryDepthRangeOctree(e)}notifyShaderTransformationChanged(){this._invalidateOctree(),this._requestUpdateCycle()}get _octree(){if(this._octreeCached==null){const e=this._instanceData,r=e.view?.state;if(!r)return null;this._octreeCached=new Bht(e,this.baseBoundingSphere);for(let i=0;i<e.capacity;++i)r.get(i)&Li.ACTIVE&&this._octreeCached.addInstance(i)}return this._octreeCached}_invalidateOctree(){this._octreeCached=Ne(this._octreeCached)}_queryDepthRangeOctree(e){if(this._octree==null)return{near:1/0,far:-1/0};const r=e.viewForward,i=this._octree.findClosest(r,mp.DepthOrder.FRONT_TO_BACK,e.frustum),s=this._octree.findClosest(r,mp.DepthOrder.BACK_TO_FRONT,e.frustum);if(i==null||s==null)return{near:1/0,far:-1/0};const n=e.eye,o=this._instanceData.view;o.boundingSphere.getVec(i,rf),fe(rf,rf,n);const a=ye(rf,r)-rf[3];o.boundingSphere.getVec(s,rf),fe(rf,rf,n);const l=ye(rf,r)+rf[3];return{near:Math.max(e.near,a),far:Math.min(e.far,l)}}_requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,e&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._allRenderInstanceData.forEach(e=>e.forEach(r=>r.startUpdateCycle()))}get running(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}runTask(e){const{_enableLevelSelection:r,_camera:i,_levelSelector:s}=this;this._allRenderInstanceData.forEach(h=>h.forEach(d=>d.beginUpdate()));const n=this._instanceData,o=n.view;let a=n.size;const l=n.capacity;let c=this._instanceIndex;for(let h=0;h<a&&!e.done;++h){c===this._cycleStartIndex&&this._startUpdateCycle();const d=o.state.get(c);let f=0;if(!(d&Li.ALLOCATED)){c=c+1===l?0:c+1,a++;continue}const m=o.lodLevel.get(c);if(d&Li.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[0][m].freeTail(),d&Li.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[0][m].freeTail(),d&Li.REMOVE)n.freeInstance(c);else if(d&Li.VISIBLE){let g=0;r&&(o.modelOrigin.getVec(c,vce),g=s.selectLevel(vce,n.getCombinedMedianScaleFactor(c),i)),f=d&~(Li.ACTIVE|Li.TRANSFORM_CHANGED),g>=0&&(d&Li.HIGHLIGHT?(_ce(this._highlightRenderInstanceData[0][g],o,c),f|=Li.HIGHLIGHT_ACTIVE):(_ce(this._defaultRenderInstanceData[0][g],o,c),f|=Li.DEFAULT_ACTIVE)),o.state.set(c,f),o.lodLevel.set(c,g)}else f=d&~(Li.ACTIVE|Li.TRANSFORM_CHANGED),o.state.set(c,f);if(this._octreeCached!=null){const g=!!(d&Li.ACTIVE),_=!!(f&Li.ACTIVE);!g&&_?this._octreeCached.addInstance(c):g&&!_?this._octreeCached.removeInstance(c):g&&_&&d&Li.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(c),this._octreeCached.addInstance(c))}c=c+1===l?0:c+1,e.madeProgress()}this._instanceIndex=c,this._allRenderInstanceData.forEach(h=>h.forEach(d=>d.endUpdate())),this._context.requestRender()}_beginComponent(e,r,i){const{bindParameters:s,rctx:n,output:o}=e;if(r.size===0||!i.material.requiresSlot(s.slot,e.output))return null;const a=i.glMaterials.load(n,s.slot,o);return a!=null?a.beginSlot(s):null}_renderComponent(e,r,i,s,n){if(!r)return;const{bindParameters:o,rctx:a}=e;a.appleAmdDriverHelper?.resetIndicesType();const l=a.bindTechnique(r,s.material.parameters,o);a.bindVAO(s.vao),r.ensureAttributeLocations(s.vao),l.bindDraw(Zht,o,s.material.parameters),li.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.output===F.Color&&(l.setUniform4fv("externalColor",Tce[Math.min(n,Tce.length-1)]),l.setUniform1i("colorMixMode",FSe.replace));const c=a.capabilities.instancing,h=i.capacity,d=i.headIndex,f=i.tailIndex,m=i.firstIndex,g=this._glInstanceBufferLayout,_=(v,b)=>{XJ(a,Tr,i.buffer,g,v),c.drawArraysInstanced(r.primitiveType,0,s.vertexCount,b-v),YJ(a,Tr,i.buffer,g)};s.material.parameters.transparent&&m!=null?d>f?(ot(m>=f&&m<=d,"invalid firstIndex"),_(m,d),_(f,m)):d<f&&(m<=d?(ot(m>=0&&m<=d,"invalid firstIndex"),_(m,d),_(f,h),_(0,m)):(ot(m>=f&&m<=h,"invalid firstIndex"),_(m,h),_(0,d),_(f,m))):d>f?_(f,d):d<f&&(_(0,d),_(f,h)),a.bindVAO(null)}};function _ce(t,e,r){const i=t.allocateHead();Xht(e,r,t.view,i)}function Xht(t,e,r,i){GXe(t.modelOrigin,e,r.modelOriginHi,r.modelOriginLo,i),r.model.copyFrom(i,t.model,e),r.modelNormal.copyFrom(i,t.modelNormal,e),t.color&&r.color&&r.color.copyFrom(i,t.color,e),t.objectAndLayerIdColor&&r.objectAndLayerIdColor&&r.objectAndLayerIdColor.copyFrom(i,t.objectAndLayerIdColor,e),t.featureAttribute&&r.featureAttribute&&r.featureAttribute.copyFrom(i,t.featureAttribute,e)}function Yht(t){let e=qi().vec3f(C.MODELORIGINHI).vec3f(C.MODELORIGINLO).mat3f(C.MODEL).mat3f(C.MODELNORMAL);return t!=null&&t.includes("featureAttribute")&&(e=e.vec4f(C.INSTANCEFEATUREATTRIBUTE)),t!=null&&t.includes("color")&&(e=e.vec4u8(C.INSTANCECOLOR)),t!=null&&t.includes("objectAndLayerIdColor")&&(e=e.vec4u8(C.INSTANCEOBJECTANDLAYERIDCOLOR)),e}u([p({constructOnly:!0})],hh.prototype,"symbol",void 0),u([p({constructOnly:!0})],hh.prototype,"optionalFields",void 0),u([p({constructOnly:!0})],hh.prototype,"metadata",void 0),u([p({constructOnly:!0})],hh.prototype,"shaderTransformation",void 0),u([p()],hh.prototype,"_instanceData",void 0),u([p()],hh.prototype,"_cycleStartIndex",void 0),u([p({readOnly:!0})],hh.prototype,"_enableLevelSelection",null),u([p()],hh.prototype,"_updateCyclesWithStaticCamera",void 0),u([p({readOnly:!0})],hh.prototype,"running",null),hh=u([P("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],hh);const vce=O(),rf=Wt(),bce=xe(),wce=O(),xce=O(),Tce=[Nt(1,0,1,1),Nt(0,0,1,1),Nt(0,1,0,1),Nt(1,1,0,1),Nt(1,0,0,1)],Zht=new Cat;let Sce=class{constructor(e,r,i,s,n,o,a,l,c,h,d,f){this.lodResources=e,this.lodRenderer=r,this.stageResources=i,this.originalMaterialParameters=s,this.resourceSize=n,this.isEsriSymbolResource=o,this.isWosr=a,this.resourceBoundingBox=l,this.symbolSize=c,this.extentPadding=h,this.physicalBasedRenderingEnabled=d,this.pivotOffset=f}},Jht=class extends Nm{getCachedSize(){const[e,r,i]=this._resources!=null?this._resources.symbolSize:[1,1,1];return{width:e,depth:r,height:i}}constructor(e,r,i,s){super(e,r,i,s),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this._hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.skipHighSymbolLodsChanged=!1,this.ensureDrapedStatus(!1),this._hasLoadedPBRTextures=i.physicalBasedRenderingEnabled}async doLoad(e){if(!this._drivenProperties.size&&v9(this.symbolLayer))throw new Error;if(this._isPrimitive){const r=this.symbolLayer.resource,i=r&&Wit(r.primitive)?r.primitive:t1e;this._resources=await this._createResourcesForPrimitive(i,e)}else{const r=await Fht(this.symbol.styleOrigin),i=r?.href??this.symbolLayer.resource.href;this._resources=await this._createResourcesForUrl(i,e)}this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return this._resources!=null?this._resources.extentPadding:0}get _isPrimitive(){return!this.symbolLayer.resource?.href}get lodRenderer(){return this._resources?.lodRenderer}_setMaterialTransparencyParams(e,r=this.symbolLayer?.material?.color){const i=this._getCombinedOpacity(r),s=i<1||this.needsDrivenTransparentPass;return e.transparent=s,e.opacity=i,e.cullFace=s?gi.None:gi.Back,e}async _createResourcesForPrimitive(e,r){const i=this.symbolLayer,s=gn($ze(e)),n=Qa(PI(s)),o=Qa(jU(n,i)),a=Re(o),l=!1,c=!1,h={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,mrrFactors:[...qK],ambient:Hg,diffuse:Hg,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},d=!!h.usePBR;this._setMaterialTransparencyParams(h);const f=this.symbol;if(f.type==="point-3d"&&f.verticalOffset){const{screenLength:T,minWorldLength:x,maxWorldLength:S}=f.verticalOffset;h.verticalOffset={screenLength:wo(T),minWorldLength:x||0,maxWorldLength:S??1/0},h.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(h.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)h.externalColor=Lh;else{const T=i.material!=null?i.material.color:null,x=T!=null?ke.toUnitRGBA(T):Lh;h.externalColor=x}this._fastUpdates=WE(this._context.renderer,this._fastVisualVariableConvertOptions(s,o,n,null)),h.isInstanced=!0,this._fastUpdates?(Object.assign(h,this._fastUpdates.materialParameters),this._optionalFields.push(C.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(h.hasInstancedColor=!0,this._optionalFields.push(C.COLOR)),ae("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(C.OBJECTANDLAYERIDCOLOR);const m=new Sm(h),g=nCe(e,m);if(!g)throw new Error(`Unknown object symbol primitive: ${e}`);const _=B$(g).map(T=>({opacity:1,transparent:T.parameters.transparent})),v=await this._createStageResources(g,d,r),b=await this._createLodRenderer(g,r);return new Sce(g,b,v,_,n,l,c,s,o,a,d,null)}async _createResourcesForUrl(e,r){const i={materialParamsMixin:{isInstanced:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=WE(this._context.renderer,this._fastVisualVariableConvertOptions(null,null,null,null)),this._fastUpdates?(Object.assign(i.materialParamsMixin,this._fastUpdates.materialParameters),this._optionalFields.push(C.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(i.materialParamsMixin.hasInstancedColor=!0,this._optionalFields.push(C.COLOR)),ae("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(C.OBJECTANDLAYERIDCOLOR);const s=this.symbol;if(s.type==="point-3d"&&s.verticalOffset){const{screenLength:k,minWorldLength:L,maxWorldLength:N}=s.verticalOffset;i.materialParamsMixin.verticalOffset={screenLength:wo(k),minWorldLength:L||0,maxWorldLength:N??1/0},i.materialParamsMixin.castShadows=!1}i.signal=r,i.usePBR=this._context.physicalBasedRenderingEnabled,i.skipHighLods=this._context.skipHighSymbolLods;const n=i.usePBR,o=await XAe(e,i),a=o.isEsriSymbolResource,l=o.isWosr,c=Eut(o.lods);c.levels.sort((k,L)=>k.minScreenSpaceRadius-L.minScreenSpaceRadius);const h=this._context,d=this.symbolLayer.material,f=this._getExternalColorParameters(d),m=this.symbolLayer?.material?.color,g=this._getCombinedOpacity(m,{hasIntrinsicColor:!0}),_=this.needsDrivenTransparentPass,v=B$(c),b=B$(c).map(k=>({opacity:k.parameters.opacity||1,transparent:k.parameters.transparent}));v.forEach(k=>{const L=k.parameters;k.setParameters(f);const N=L.opacity*g,q=N<1||_||L.transparent;k.setParameters({opacity:N,transparent:q}),h.screenSizePerspectiveEnabled&&k.setParameters({screenSizePerspective:h.sharedResources.screenSizePerspectiveSettings})});const T=o.referenceBoundingBox,x=Qa(PI(T)),S=Qa(c.levels[0].pivotOffset),E=Qa(jU(x,this.symbolLayer)),A=Re(E),R=this._fastUpdates;XE(R,this._context.renderer,this._fastVisualVariableConvertOptions(T,E,x,S))&&v.forEach(k=>k.setParameters(R.materialParameters));const M=await this._createStageResources(c,n,r),D=await this._createLodRenderer(c,r);return new Sce(c,D,M,b,x,a,l,T,E,A,n,S)}_addDisposeResource(e){this._disposeResourceHandles.push(e)}async _createStageResources(e,r,i){const s=this._context.stage,n=B$(e);r!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),s.addMany(n),this._addDisposeResource(()=>s.removeMany(n));const o=Eae(e);s.addMany(o),this._addDisposeResource(()=>s.removeMany(o)),await s.load(o,i),Yt(i);const a=Cae(e);return s.addMany(a),this._addDisposeResource(()=>s.removeMany(a)),{materials:n,textures:o,geometries:a}}async _createLodRenderer(e,r){const i=this._context.stage,s={layerUid:this._context.layer.uid,graphicUid:l=>this._instanceIndexToGraphicUid.get(l),notifyGraphicGeometryChanged:l=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(l)),notifyGraphicVisibilityChanged:l=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(l))},n=this._fastUpdates,o=n?{applyTransform:(l,c,h)=>{l.getFeatureAttribute(c,hL),zs(h,cq(n.materialParameters,hL,h))},scaleFactor:(l,c,h)=>{c.getFeatureAttribute(h,hL),ort(l,n.materialParameters,hL)}}:null,a=new hh({symbol:e,optionalFields:this._optionalFields,metadata:s,shaderTransformation:o},this._context.scheduler);return a.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{i.removeRenderPlugin(a),a.destroy()}),await i.addRenderPlugin(a.slots,a,r),a}_getExternalColorParameters(e){const r={};return this._drivenProperties.color?r.externalColor=Lh:e!=null&&e.color!=null?r.externalColor=ke.toUnitRGBA(e.color):(r.externalColor=Lh,r.colorMixMode="ignore"),r}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(e=>e()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry))return null;const i=NM(r.geometry);if(i==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${r.geometry.type}`),null;const s=this.setGraphicElevationContext(r,new Up),n=e.renderingInfo;return this._createAs3DShape(r,i,n,s,r.uid,e.layer.uid)}notifyDestroyGraphicLayer(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(this._resources==null)return;const e=this._drivenProperties.opacity,r=!this._isPrimitive,i=this._resources.stageResources.materials,s=this._resources.originalMaterialParameters;for(let n=0;n<i.length;n++){const o=i[n],a=this.symbolLayer?.material?.color,l=s[n],c=this._getCombinedOpacity(a,{hasIntrinsicColor:r})*l.opacity,h=c<1||e||l.transparent;o.setParameters({opacity:c,transparent:h}),this._isPrimitive&&o.setParameters({cullFace:h?gi.None:gi.Back})}}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,Tv)}slicePlaneEnabledChanged(){if(this._resources==null)return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const e of this._resources.stageResources.materials)e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(this._resources==null)return!0;const{stageResources:e,isWosr:r}=this._resources;for(const i of e.materials)this._isPrimitive?i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):r||i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this._hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this._hasLoadedPBRTextures=!0,!1)}applyRendererDiff(e,r){if(this._resources==null)return Us.RecreateSymbol;const{stageResources:{materials:i},lodRenderer:s,resourceBoundingBox:n,symbolSize:o,resourceSize:a,pivotOffset:l}=this._resources;for(const c in e.diff){if(c!=="visualVariables"||!XE(this._fastUpdates,r,this._fastVisualVariableConvertOptions(n,o,a,l)))return Us.RecreateSymbol;for(const h of i)h.setParameters(this._fastUpdates.materialParameters);s.notifyShaderTransformationChanged()}return Us.FastUpdate}computeComplexity(){if(this._resources==null)return super.computeComplexity();const e=this._resources.lodResources,r=sCe(e.levels[0]).reduce((n,o)=>n+o.indices.get(C.POSITION).length,0)/3,i=n=>Array.from(n.vertexAttributes.values()).reduce((o,a)=>o+$_(a.data),0)+Array.from(n.indices.values()).reduce((o,a)=>o+$_(a),0),s=Eae(e).reduce((n,o)=>n+(o.parameters.encoding&&o.parameters.encoding==="image/ktx2"?o.memoryEstimate:o.memoryEstimate/4),0)+Cae(e).reduce((n,o)=>n+i(o),0);return{primitivesPerFeature:r,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:{...uCe(this.symbol,this.symbolLayer),resourceBytes:s}}}_hasLodRenderer(){return this._resources!=null}_createAs3DShape(e,r,i,s,n,o){if(!this._hasLodRenderer()||this._resources==null)return null;const a=this.getFastUpdateAttrValues(e),l=this._context.clippingExtent;if(Ao(r,AT,this._context.elevationProvider.spatialReference),l!=null&&!rJ(l,AT))return null;const c=this._requiresTerrainElevation(s),h=this._computeGlobalTransform(r,s,Zz,dL),d=this._computeLocalTransform(this._resources,this.symbolLayer,i,Ece),f=this._resources.lodRenderer.instanceData,m=f.addInstance();this._instanceIndexToGraphicUid.set(m,n),f.setLocalTransform(m,d,!1),f.setGlobalTransform(m,h),a&&f.setFeatureAttribute(m,a),this._fastUpdates==null&&this._hasPerInstanceColor()&&f.setColor(m,MR(i.color,i.opacity,255)),this._context.stage.renderView.objectAndLayerIdRenderHelper!=null&&f.setObjectAndLayerIdColor(m,this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:n,layerUid:o}));const g=new xut(this,m,$it,s);return c&&(g.alignedSampledElevation=dL.sampledElevation),g.needsElevationUpdates=Tv(s.mode),DM(g,r,this._context.elevationProvider),g}_computeGlobalTransform(e,r,i,s){return xv(e,this._context.elevationProvider,r,this._context.renderCoordsHelper,s),AT[0]=e.x,AT[1]=e.y,AT[2]=s.z,Fl(e.spatialReference,AT,i,this._context.renderCoordsHelper.spatialReference),i}_computeLocalTransform(e,r,i,s){return Yh(s),this._applyObjectRotation(i,!1,s),this._applyObjectRotation(r,!0,s),this._applyObjectScale(e,i,s),this._applyAnchor(e,r,s),s}_applyObjectScale(e,r,i){if(this._fastUpdates?.requiresShaderTransformation)return;const s=this._drivenProperties.size&&r.size?r.size:e.symbolSize,n=Tae(s,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);n[0]===1&&n[1]===1&&n[2]===1||g8(i,i,n)}prepareSymbolLayerPatch(e){if(e.diff.type!=="partial")return;const r=e.diff.diff;this._preparePatchTransform(e,r),this._preparePatchColor(e,r)}updateGeometry(e,r){if(this._resources==null)return!0;const i=r&&NM(r);if(i==null)return!1;const s=this.getGeometryElevationMode(r);return e.elevationContext.mode===s&&(this._computeGlobalTransform(i,e.elevationContext,Zz,dL),this._requiresTerrainElevation(e.elevationContext)&&(e.alignedSampledElevation=dL.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,Zz,!0),DM(e,i,this._context.elevationProvider),!0)}_preparePatchTransform(e,r){if(!(r.heading||r.tilt||r.roll||r.width||r.height||r.depth||r.anchor||r.anchorPosition)||this._resources==null)return;const i=(g,_,v)=>(g!=null&&g.type==="complete"?g.newValue:_)??v,s=i(r.heading,this.symbolLayer.heading,0),n=i(r.tilt,this.symbolLayer.tilt,0),o=i(r.roll,this.symbolLayer.roll,0),a=i(r.width,this.symbolLayer.width,void 0),l=i(r.height,this.symbolLayer.height,void 0),c=i(r.depth,this.symbolLayer.depth,void 0),h=i(r.anchor,this.symbolLayer.anchor,void 0),d=i(r.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete r.heading,delete r.tilt,delete r.roll,delete r.width,delete r.height,delete r.depth,delete r.anchor,delete r.anchorPosition;const f={heading:s,tilt:n,roll:o,anchor:h,anchorPosition:d},m=this._resources;this.loadStatus===fu.LOADED&&e.symbolLayerStatePatches.push(()=>{m.symbolSize=Qa(jU(m.resourceSize,{width:a,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))}),e.graphics3DGraphicPatches.push((g,_)=>{const v=this._computeLocalTransform(m,f,_,Ece),b=g.instanceIndex;m.lodRenderer.instanceData.setLocalTransform(b,v,!0)})}_preparePatchColor(e,r){if(!r.material||r.material.type!=="partial")return;const i=r.material.diff;if(!i.color||i.color.type!=="complete"||i.color.newValue==null||i.color.oldValue==null)return;const s=i.color.newValue,n=s!=null?ke.toUnitRGBA(s):Lh;delete i.color;const o=this._resources;o!=null&&e.graphics3DGraphicPatches.push(a=>{let l;this._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(a.instanceIndex,n),l=this._setMaterialTransparencyParams({},s)):l=this._setMaterialTransparencyParams({externalColor:n},s);for(const c of o.stageResources.materials)c.setParameters(l)})}_requiresTerrainElevation(e){return e.mode!=="absolute-height"}_applyObjectRotation(e,r,i){if(!this._fastUpdates?.requiresShaderTransformation||!r)return xit(e.heading,e.tilt,e.roll,i)}_computeAnchor(e,r,i){const s=O();switch(i.anchor){case"center":ie(s,hp(e)),va(s,s);break;case"top":{const n=hp(e);ne(s,-n[0],-n[1],-e[5]);break}case"bottom":{const n=hp(e);ne(s,-n[0],-n[1],-e[2]);break}case"relative":{const n=hp(e),o=PI(e),a=i.anchorPosition,l=a?Pe(a.x,a.y,a.z):sl;W6(s,o,l),de(s,s,n),va(s,s);break}default:r!=null?va(s,r):ie(s,sl)}return s}_applyAnchor(e,r,i){if(this._fastUpdates?.requiresShaderTransformation)return;const s=this._computeAnchor(e.resourceBoundingBox,e.pivotOffset,r);s&&Gl(i,i,s)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(e,r,i,s){const n=e!=null?Qa(PI(e)):Hg,o=e!=null?this._computeAnchor(e,s,this.symbolLayer):sl,a=this._context.renderCoordsHelper.unitInMeters,l=Tae(r??void 0,r,i,a),c=Pe(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return new GP({size:!0,color:!0,rotation:!0,opacity:!1},n,r??Hg,a,o,l,c)}};const AT=O(),Ece=xe(),Zz=xe(),hL=Wt(),dL=new qP;let Qht=class{constructor(e,r,i,s){this.vertices=e,this.positionsES=r,this.offset=s;const n=e.length,o=Math.floor(n/2),a=this.offset+3*o,l=i[a],c=i[a+1],h=i[a+2];this.origin=Pe(l,c,h),this.positions=es(3*n);const d=this.offset+3*n;for(let f=this.offset;f<d;f+=3)this.positions[f]=i[f]-l,this.positions[f+1]=i[f+1]-c,this.positions[f+2]=i[f+2]-h;this.updatePathVertexInformation()}updatePathVertexInformation(){const e=this.vertices.length,r=this.vertices[0];let i=this.offset;const s=this.positions;r.vRight[0]=s[i+3]-s[i],r.vRight[1]=s[i+4]-s[i+1],r.vRight[2]=s[i+5]-s[i+2],i+=3;let n=Re(r.vRight);r.vMinSiblingLength=n,_e(r.vRight,r.vRight);let o=r;for(let a=1;a<e;++a){const l=this.vertices[a];if(l.vLeft=o.vRight,a<e-1){l.vRight[0]=s[i+3]-s[i],l.vRight[1]=s[i+4]-s[i+1],l.vRight[2]=s[i+5]-s[i+2];const c=Re(l.vRight);l.vMinSiblingLength=Math.min(n,c),n=c,_e(l.vRight,l.vRight)}else ie(l.vRight,l.vLeft),l.vMinSiblingLength=n;o=l,i+=3}}},Kht=class{constructor(e,r,i,s,n,o={}){this.path=e,this.profile=r,this.extruder=i,this.startCap=s,this.endCap=n,this.options=o,this._extrusionVertexCount=0;const a=this.path.vertices.length-2;this.numExtrusionProfiles=i.numProfilesPerJoin()*a+2,this.numVerticesTotal=r.vertices.length*this.numExtrusionProfiles,this.startCap.vertexBufferStart=this.numVerticesTotal;const l=this.startCap.numVertices;this.numVerticesTotal+=l,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.numVertices;this.numVerticesTotal+=c,this.pathVertexData=LXe(1*this.numVerticesTotal),this.profileRightAxes=es(4*this.numVerticesTotal),this.profileUpAxes=es(4*this.numVerticesTotal),this.profileVertexAndNormals=es(4*this.numVerticesTotal),this.positions=W5(e.positions,e.offset,3*e.vertices.length),this._rebuildGeometry(),this.buildTopology()}emitVertex(e,r,i,s,n){const o=4*this._extrusionVertexCount;if(this.profileRightAxes[o]=r.right[0],this.profileRightAxes[o+1]=r.right[1],this.profileRightAxes[o+2]=r.right[2],this.profileUpAxes[o]=r.up[0],this.profileUpAxes[o+1]=r.up[1],this.profileUpAxes[o+2]=r.up[2],this.profileVertexAndNormals[o]=i[0],this.profileVertexAndNormals[o+1]=i[1],this.profileVertexAndNormals[o+2]=s[0],this.profileVertexAndNormals[o+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=e,n){const a=this.path.vertices[e],l=a.maxStretchDistance;this.profileRightAxes[o+3]=a.rotationRight[0]*l,this.profileUpAxes[o+3]=a.rotationRight[1]*l}else this.profileRightAxes[o+3]=0,this.profileUpAxes[o+3]=0;++this._extrusionVertexCount}emitCapVertex(e,r,i,s,n,o){const a=4*this._extrusionVertexCount;this.profileRightAxes[a]=r.right[0],this.profileRightAxes[a+1]=r.right[1],this.profileRightAxes[a+2]=r.right[2],this.profileRightAxes[a+3]=n,this.profileUpAxes[a]=r.up[0],this.profileUpAxes[a+1]=r.up[1],this.profileUpAxes[a+2]=r.up[2],this.profileUpAxes[a+3]=o,this.profileVertexAndNormals[a]=i[0],this.profileVertexAndNormals[a+1]=i[1],this.profileVertexAndNormals[a+2]=s[0],this.profileVertexAndNormals[a+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=e,++this._extrusionVertexCount}_rebuildGeometry(){this._extrusionVertexCount=0;const{positions:e,offset:r,vertices:i}=this.path;this.positions=W5(e,r,3*i.length);let s=0;const n=(a,l,c,h,d)=>this.emitCapVertex(s,a,l,c,h,d),o=(a,l,c,h)=>this.emitVertex(s,a,l,c,h);for(this.startCap.rebuildConnectingProfileGeometry(i[s],this.profile,n),s=1;s<i.length-1;++s)this.extruder.extrude(i[s],this.profile,o);this.endCap.rebuildConnectingProfileGeometry(i[s],this.profile,n),s=0,this.startCap.rebuildCapGeometry(i[s],n),s=i.length-1,this.endCap.rebuildCapGeometry(i[s],n)}buildTopology(){const e=this.profile.vertices.length,r=this.profile.numSegments,i=this.numExtrusionProfiles-1;let s=3*(2*(r*i));this.startCap.indexBufferStart=s,this.startCap.firstProfileVertexIndex=0,s+=this.startCap.numIndices,this.endCap.indexBufferStart=s,this.endCap.firstProfileVertexIndex=e*(this.numExtrusionProfiles-1);const n=new Array,o=new Array,a=new Array,l=(c,h,d)=>{n.push(c),n.push(h),n.push(d),o.push(c),o.push(h),o.push(d),a.push(this.pathVertexData[c]),a.push(this.pathVertexData[h]),a.push(this.pathVertexData[d])};for(let c=0;c<r;++c){const h=this.profile.indices[2*c],d=this.profile.indices[2*c+1];for(let f=0;f<i;++f){const m=f*e+h,g=(f+1)*e+d,_=f*e+d;l(m,(f+1)*e+h,g),l(m,g,_)}}this.startCap.buildTopology(this.path.vertices[0],l),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],l),this.vertexIndices=om(n),this.normalIndices=om(o),this.pathVertexIndices=om(a)}onPathChanged(){this._rebuildGeometry()}},lee=class{rebuildConnectingProfileGeometry(e,r,i){for(let s=0;s<r.vertices.length;++s)i(e.frame,r.vertices[s],r.normals[s],0,0)}},Cce=class extends lee{constructor(){super(),this.numVertices=0,this.numIndices=0}rebuildCapGeometry(){}buildTopology(){}},pL=class extends lee{constructor(e,r=0,i=!1){super(),this.profile=e,this.profilePlaneOffset=r,this.flip=i}get numVertices(){return this.profile.vertices.length}get numIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(e,r,i){const s=this.profilePlaneOffset;for(let n=0;n<r.vertices.length;++n)i(e.frame,r.vertices[n],r.normals[n],s,0)}rebuildCapGeometry(e,r){const i=this.profile,s=this.flip?1:-1,n=this.profilePlaneOffset,o=rOe;or(o,0,0);for(let a=0;a<i.vertices.length;++a)r(e.frame,i.vertices[a],o,n,s)}buildTopology(e,r){const i=this.profile,s=this.vertexBufferStart+i.indices[0];for(let n=1;n<i.numSegments;++n){const o=i.indices[2*n],a=i.indices[2*n+1],l=this.vertexBufferStart+o,c=this.vertexBufferStart+a;this.flip?r(c,l,s):r(s,l,c)}}},Ace=class extends lee{constructor(e){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=e.profile,this.flip=e.flip,this.sign=this.flip?1:-1,this.breakNormals=e.breakNormals,this.numSegments=e.subdivisions}get numVertices(){let e=this.profile.vertices.length*(this.numSegments-1)+this.profile.poles.length;return this.breakNormals&&(e+=this.profile.vertices.length),e}get numIndices(){let e=0;const r=this.profile;e+=2*r.numSegments*(this.numSegments-1);for(let i=0;i<r.numSegments;++i){const s=r.indices[2*i],n=r.indices[2*i+1];r.poleIndices[s]===r.poleIndices[n]?e+=1:e+=2}return 3*e}rebuildCapGeometry(e,r){const i=this.profile,s=e.frame,n=.5*this.sign,o=edt,a=rOe;or(a,0,0);for(const l of i.poles)l.normal?r(s,l.position,l.normal,n,0):r(s,l.position,a,n,this.sign);if(this.breakNormals)for(let l=0;l<i.vertices.length;++l)r(s,i.vertices[l],i.normals[l],0,0);for(let l=0;l<this.numSegments-1;++l){const c=(1-(l+1)/this.numSegments)*Math.PI*.5,h=Math.sin(c),d=Math.cos(c);for(let f=0;f<i.vertices.length;++f){const m=i.poles[i.poleIndices[f]];zf(o,i.vertices[f],m.position),Sc(o,o,h),m.normal?(Qd(o,o,m.position),r(s,o,m.normal,n*d,0)):(TM(a,o),Sc(a,a,h),Qd(o,o,m.position),r(s,o,a,n*d,this.sign*d))}}}buildTopology(e,r){const i=this.profile,s=this.breakNormals?this.vertexBufferStart+i.poles.length:this.firstProfileVertexIndex,n=this.breakNormals?this.vertexBufferStart+i.poles.length+i.vertices.length:this.vertexBufferStart+i.poles.length;for(let o=0;o<i.numSegments;++o){const a=i.indices[2*o],l=i.indices[2*o+1],c=this.vertexBufferStart+i.poleIndices[a],h=this.vertexBufferStart+i.poleIndices[l];let d=s+a,f=s+l;for(let m=0;m<this.numSegments-1;++m){const g=n+m*i.vertices.length+a,_=n+m*i.vertices.length+l;this.flip?(r(g,f,d),r(f,g,_)):(r(d,f,g),r(_,g,f)),d=g,f=_}this.flip?(r(c,f,d),c!==h&&r(c,h,f)):(r(d,f,c),c!==h&&r(f,h,c))}}};const edt=He(),rOe=He();let tdt=class{numProfilesPerJoin(){return 1}extrude(e,r,i){for(let s=0;s<r.vertices.length;++s)i(e.frame,r.vertices[s],r.normals[s],!1)}},Jz=class{constructor(e,r){this.cutoffAngle=e,this.numBendSubdivisions=r}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(e,r,i){const s=idt,{rotationAngle:n,rotationRight:o,frame:a}=e;if(Math.abs(n)>=this.cutoffAngle){const l=e.rotationFrameUp;for(let c=0;c<this.numBendSubdivisions+1;++c){Lu(Rce,.5*-n+c*n/this.numBendSubdivisions,l),rdt(s,a,Rce);for(let h=0;h<r.vertices.length;++h)on(r.vertices[h],o)*n>=0?i(s,r.vertices[h],r.normals[h],!1):i(a,e.applyMiterStretch(Oce,r.vertices[h]),r.normals[h],!0)}}else for(let l=0;l<this.numBendSubdivisions+1;++l)for(let c=0;c<r.vertices.length;++c){const h=on(r.vertices[c],o)*n>=0;i(a,e.applyMiterStretch(Oce,r.vertices[c]),r.normals[c],!h)}}},iOe=class{constructor(){this.up=O(),this.right=O()}};function rdt(t,e,r){ze(t.up,e.up,r),ze(t.right,e.right,r)}const Oce=He(),Rce=xe(),idt=new iOe;let sdt=class extends Ks{constructor(e,r,i,s,n,o,a){super(e,r,i,null,us.Mesh,a),this.path=s,this.geometrySR=n,this.stencilWidth=o}};var am;function sOe(t){return"path"in t}(function(t){t[t.World=0]="World",t[t.Path=1]="Path"})(am||(am={}));let nOe=class{constructor(e){this.builder=e}onPathChanged(e){this.builder.onPathChanged()}},oOe=class extends nOe{constructor(e){super(e),this.vertexAttributeColor=Nt(255,255,255,255),this.size=new Array,this.vertexAttributePosition=es(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Int16Array(2*this.builder.numVerticesTotal)}bakeVertexColors(e){this.vertexAttributeColor[0]=255*e[0],this.vertexAttributeColor[1]=255*e[1],this.vertexAttributeColor[2]=255*e[2],this.vertexAttributeColor[3]=255*(e.length>3?e[3]:1)}bake(e){this.size=e;const{numVerticesTotal:r,pathVertexData:i,path:s,positions:n,profileRightAxes:o,profileUpAxes:a,profileVertexAndNormals:l}=this.builder;for(let c=0;c<r;++c){let h=i[c];const d=h===0||h===s.vertices.length-1;h*=3;const f=cdt;let m=0,g=0;const _=4*c,v=ne(udt,o[_],o[_+1],o[_+2]),b=ne(hdt,a[_],a[_+1],a[_+2]),T=or(Mce,l[_]*e[0],l[_+1]*e[1]);if(d)pt(f,b,v),m=o[_+3]*e[0],g=a[_+3];else{const A=odt,R=adt;or(A,o[_+3],a[_+3]);const M=GJ(A);TM(A,A);const D=on(T,A);if(Math.abs(D)>M){or(R,-A[1],A[0]);const k=on(T,R);Sc(A,A,M*Math.sign(D)),Sc(R,R,k),Qd(T,A,R)}ne(f,0,0,0)}const x=ne(ldt,v[0]*T[0]+b[0]*T[1],v[1]*T[0]+b[1]*T[1],v[2]*T[0]+b[2]*T[1]),S=3*c;this.vertexAttributePosition[S]=n[h]+x[0]+f[0]*m,this.vertexAttributePosition[S+1]=n[h+1]+x[1]+f[1]*m,this.vertexAttributePosition[S+2]=n[h+2]+x[2]+f[2]*m;const E=or(Mce,l[_+2],l[_+3]);ix(this.vertexAttributeNormal,c,v[0]*E[0]+b[0]*E[1]+f[0]*g,v[1]*E[0]+b[1]*E[1]+f[1]*g,v[2]*E[0]+b[2]*E[1]+f[2]*g)}}createGeometryData(){const e=this.builder.vertexIndices.length;return new aOe([[C.POSITION,new We(this.vertexAttributePosition,3,!0)],[C.NORMALCOMPRESSED,new We(this.vertexAttributeNormal,2,!0)],[C.COLOR,new We(this.vertexAttributeColor,4)]],[[C.POSITION,this.builder.vertexIndices],[C.NORMALCOMPRESSED,this.builder.normalIndices],[C.COLOR,LC(e)]])}onPathChanged(e){super.onPathChanged(e),this.bake(this.size)}intersect(e,r,i){const s=this.builder.vertexIndices,n=new We(this.vertexAttributePosition,3),o=s.length/3;zP(e,r,0,o,s,n,void 0,void 0,i)}},ndt=class extends nOe{constructor(e,r,i,s){super(e),this.sizeAttributeValue=r,this.colorAttributeValue=i,this.opacityAttributeValue=s,this.vvData=null,this.baked=new oOe(e),this.vvData=es(4*this.builder.path.vertices.length);for(let n=0;n<this.builder.path.vertices.length;++n){this.vvData[4*n]=r,this.vvData[4*n+1]=i,this.vvData[4*n+2]=s;const o=n===0||n===this.builder.path.vertices.length-1;this.vvData[4*n+3]=o?1:0}}createGeometryData(){return new aOe([[C.POSITION,new We(this.builder.positions,3,!0)],[C.PROFILERIGHT,new We(this.builder.profileRightAxes,4,!0)],[C.PROFILEUP,new We(this.builder.profileUpAxes,4,!0)],[C.PROFILEVERTEXANDNORMAL,new We(this.builder.profileVertexAndNormals,4,!0)],[C.FEATUREVALUE,new We(this.vvData,4,!0)]],[[C.POSITION,this.builder.pathVertexIndices],[C.PROFILERIGHT,this.builder.vertexIndices],[C.PROFILEUP,this.builder.vertexIndices],[C.PROFILEVERTEXANDNORMAL,this.builder.vertexIndices],[C.FEATUREVALUE,this.builder.pathVertexIndices]])}onPathChanged(e){super.onPathChanged(e);const r=e.getMutableAttribute(C.POSITION);r&&(r.data=this.builder.positions)}},aOe=class{constructor(e,r){this.vertexAttributes=e,this.indices=r}};const Mce=He(),odt=He(),adt=He(),ldt=O(),cdt=O(),udt=O(),hdt=O();function ddt(t,e){let r=null;const i=t.vertices.length,s=.99619469809,n=O(),o=O(),a=O(),l=O(),c=O(),h=O(),d=Fr();let f=t.vertices[0];ie(o,e),ne(n,0,1,0),Z5(f.vRight,o,n,n,a,o,s),ie(f.frame.up,o),ie(f.frame.right,a);const m=t.positions;let g=t.offset;r=f;for(let _=1;_<i;++_){f=t.vertices[_],de(c,f.vLeft,f.vRight);let v=Re(c);v>0?(v=1/Math.sqrt(v),c[0]=c[0]*v,c[1]=c[1]*v,c[2]=c[2]*v):(c[0]=f.vRight[0],c[1]=f.vRight[1],c[2]=f.vRight[2]),h[0]=m[g]+r.frame.up[0],h[1]=m[g+1]+r.frame.up[1],h[2]=m[g+2]+r.frame.up[2],g+=3;const b=ne(pdt,m[g],m[g+1],m[g+2]);RP(b,c,d),Rx(d,Du(h,f.vLeft),l)?(l[0]-=m[g],l[1]-=m[g+1],l[2]-=m[g+2],_e(o,l),pt(a,c,o),_e(a,a)):Z5(c,r.frame.up,r.frame.right,n,a,o,s),ie(f.frame.up,o),ie(f.frame.right,a),r=f}}const pdt=O();let lOe=class{constructor(){this.vertices=new Array,this.normals=new Array,this.indices=new Array,this.poles=new Array,this.poleIndices=new Array}addVertex(e,r){return this.vertices.push(WA(e)),this.normals.push(WA(r)),this.vertices.length-1}addPole(e,r=null){return this.poles.push({position:WA(e),normal:r?WA(r):null}),this.poles.length-1}addSegment(e,r=null){this.indices.push(e.v0),this.indices.push(e.v1),r&&(this.poleIndices.push(r.v0),this.poleIndices.push(r.v1))}get numSegments(){return this.indices.length/2}translate(e,r){for(const i of this.vertices)i[0]+=e,i[1]+=r;for(const i of this.poles)i.position[0]+=e,i.position[1]+=r}};const cOe={top:[0,-.5],bottom:[0,.5]};function Qz(t){const r=rCe,i=new lOe,s={v0:0,v1:0};i.addPole(fr(0,0));for(let o=0;o<r;++o){const a=2*o*Math.PI/r,l=Math.cos(a),c=Math.sin(a),h=fr(l*.5,c*.5),d=fr(l,c);i.addVertex(h,d)}for(let o=0;o<r-1;++o){const a={v0:o,v1:o+1};i.addSegment(a,s)}const n={v0:r-1,v1:0};if(i.addSegment(n,s),t!=="center"){const o=cOe[t];i.translate(o[0],o[1])}return i}const fdt={center:Qz("center"),top:Qz("top"),bottom:Qz("bottom")},mdt={center:Kz("center"),top:Kz("top"),bottom:Kz("bottom")};function Kz(t){const i=new lOe,s=fr(.5*-1,.5*-1),n=fr(.5*1,.5*-1),o=fr(.5*1,.5*1),a=fr(.5*-1,.5*1),l=fr(0,-1),c=fr(1,0),h=fr(0,1),d=fr(-1,0);if(i.addPole(fr(0,.5*1),h),i.addPole(fr(0,.5*1)),i.addPole(fr(0,.5*-1)),i.addPole(fr(0,.5*-1),l),i.addVertex(s,l),i.addVertex(n,l),i.addSegment({v0:0,v1:1},{v0:3,v1:3}),i.addVertex(n,c),i.addVertex(o,c),i.addSegment({v0:2,v1:3},{v0:2,v1:1}),i.addVertex(o,h),i.addVertex(a,h),i.addSegment({v0:4,v1:5},{v0:0,v1:0}),i.addVertex(a,d),i.addVertex(s,d),i.addSegment({v0:6,v1:7},{v0:1,v1:2}),t!=="center"){const f=cOe[t];i.translate(f[0],f[1])}return i}function gdt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function ydt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function uOe(t,e,r,i,s){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t}function _dt(t,e){if(t===e){const r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function vdt(t,e){const r=e[0],i=e[1],s=e[2],n=e[3];let o=r*n-s*i;return o?(o=1/o,t[0]=n*o,t[1]=-i*o,t[2]=-s*o,t[3]=r*o,t):null}function bdt(t,e){const r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t}function wdt(t){return t[0]*t[3]-t[2]*t[1]}function hOe(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=r[0],l=r[1],c=r[2],h=r[3];return t[0]=i*a+n*l,t[1]=s*a+o*l,t[2]=i*c+n*h,t[3]=s*c+o*h,t}function xdt(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+n*a,t[1]=s*l+o*a,t[2]=i*-a+n*l,t[3]=s*-a+o*l,t}function Tdt(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=r[0],l=r[1];return t[0]=i*a,t[1]=s*a,t[2]=n*l,t[3]=o*l,t}function Sdt(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t}function Edt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function Cdt(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function Adt(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2)}function Odt(t,e,r,i){return t[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-t[2]*r[1],[t,e,r]}function Rdt(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function dOe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function Mdt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Pdt(t,e){const r=t[0],i=t[1],s=t[2],n=t[3],o=e[0],a=e[1],l=e[2],c=e[3],h=cl();return Math.abs(r-o)<=h*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=h*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(s-l)<=h*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=h*Math.max(1,Math.abs(n),Math.abs(c))}function Idt(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function $dt(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t}const Ldt=hOe,Ddt=dOe;Object.freeze(Object.defineProperty({__proto__:null,LDU:Odt,add:Rdt,adjoint:bdt,copy:gdt,determinant:wdt,equals:Pdt,exactEquals:Mdt,frob:Adt,fromRotation:Sdt,fromScaling:Edt,identity:ydt,invert:vdt,mul:Ldt,multiply:hOe,multiplyScalar:Idt,multiplyScalarAndAdd:$dt,rotate:xdt,scale:Tdt,set:uOe,str:Cdt,sub:Ddt,subtract:dOe,transpose:_dt},Symbol.toStringTag,{value:"Module"}));function pOe(){return[1,0,0,1]}function Ndt(t){return[t[0],t[1],t[2],t[3]]}function Fdt(t,e,r,i){return[t,e,r,i]}function Udt(t,e){return new Float64Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:Ndt,create:pOe,createView:Udt,fromValues:Fdt},Symbol.toStringTag,{value:"Module"}));let fOe=class{constructor(){this.vLeft=O(),this.vRight=O(),this.vMinSiblingLength=0,this.frame=new iOe}setFrameFromUpVector(e){ie(this.frame.up,e),de(k3,this.vLeft,this.vRight),_e(k3,k3),se($ce,this.frame.up,ye(k3,this.frame.up)),fe(fL,k3,$ce),_e(fL,fL),pt(this.frame.right,fL,this.frame.up)}get foldingAngle(){return Math.PI-this.rotationAngle}},kdt=class extends fOe{get rotationFrameUp(){return this.frame.up}get rotationRight(){return Cbe}get rotationAngle(){return se(gy,this.frame.up,ye(this.frame.up,this.vLeft)),fe(gy,this.vLeft,gy),va(gy,gy),_e(gy,gy),se(RT,this.frame.up,ye(this.frame.up,this.vRight)),fe(RT,this.vRight,RT),_e(RT,RT),pt(IF,this.rotationFrameUp,this.vLeft),Math.sign(ye(IF,this.vRight))*(Math.PI-Dn(ye(gy,RT)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength/Math.cos(.5*this.foldingAngle))}applyMiterStretch(e,r){const i=this.rotationAngle;if(Math.abs(i)<=0)return r;const s=wB(Math.cos(.5*i));return or(e,(s-1+1)*r[0],r[1])}},zdt=class extends fOe{get rotationFrameUp(){const e=Math.sign(ye(this.frame.right,this.vRight));return pt(U3,this.vRight,this.vLeft),se(U3,U3,e),_e(U3,U3)}get rotationRight(){const e=this.rotationFrameUp,r=ye(e,this.frame.up),i=ye(e,this.frame.right);return se(OT,this.frame.up,-i),se(Ice,this.frame.right,r),de(OT,OT,Ice),_e(OT,OT),Vdt(Pce,this.frame,OT),Pce}get rotationAngle(){const e=Math.sign(ye(this.frame.right,this.vRight));return va(IF,this.vLeft),-e*(Math.PI-Dn(ye(IF,this.vRight)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength*wB(Math.cos(.5*this.foldingAngle)))}applyMiterStretch(e,r){const i=this.rotationAngle;if(Math.abs(i)===0)return r;const s=wB(Math.cos(.5*i)),n=this.rotationRight,o=uOe(Gdt,1+(s-1)*n[0]*n[0],(s-1)*n[0]*n[1],(s-1)*n[0]*n[1],1+(s-1)*n[1]*n[1]);return gxe(e,r,o)}};function Vdt(t,e,r){or(t,ye(r,e.right),ye(r,e.up))}function Bdt(t){switch(t){case am.World:return new kdt;case am.Path:return new zdt}}const U3=O(),Pce=He(),OT=O(),Ice=O(),IF=O(),gy=O(),RT=O(),$ce=O(),k3=O(),fL=O(),Gdt=pOe(),eV=8;function jdt(t,e){const r=C.FEATUREVALUE;t.attributes.add(r,"vec4");const i=t.vertex;i.code.add(w`
  bool isCapVertex() {
    return ${r}.w == 1.0;
  }
  `),i.uniforms.add(new Ar("size",s=>s.size)),e.vvSize?(i.uniforms.add(new kt("vvSizeMinSize",s=>s.vvSize.minSize),new kt("vvSizeMaxSize",s=>s.vvSize.maxSize),new kt("vvSizeOffset",s=>s.vvSize.offset),new kt("vvSizeFactor",s=>s.vvSize.factor)),i.code.add(w`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${r}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):i.code.add(w`vec2 getSize(){
return size;
}`),e.vvOpacity?(i.constants.add("vvOpacityNumber","int",eV),i.uniforms.add(new $l("vvOpacityValues",s=>s.vvOpacity.values,eV),new $l("vvOpacityOpacities",s=>s.vvOpacity.opacityValues,eV)),i.code.add(w`
    vec4 applyOpacity(vec4 color) {
      float value = ${r}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):i.code.add(w`vec4 applyOpacity(vec4 color){
return color;
}`),e.vvColor?(i.constants.add("vvColorNumber","int",GS),i.uniforms.add(new $l("vvColorValues",s=>s.vvColor.values,GS),new lEe("vvColorColors",s=>s.vvColor.colors,GS)),i.code.add(w`
    vec4 getColor() {
      float value = ${r}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):i.code.add(w`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),t.include(IP),t.attributes.add(C.PROFILERIGHT,"vec4"),t.attributes.add(C.PROFILEUP,"vec4"),t.attributes.add(C.PROFILEVERTEXANDNORMAL,"vec4"),i.code.add(w`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),i.code.add(w`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),i.code.add(w`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),i.code.add(w`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}let Hdt=class extends jP{constructor(){super(...arguments),this.size=fr(1,1)}};function qdt(t){const e=new Sr,{vertex:r,fragment:i}=e;switch(Dc(r,t),e.varyings.add("vpos","vec3"),e.include(jdt,t),t.output!==F.Color&&t.output!==F.Alpha||(e.include(Nl,t),e.include(rx,t),e.include($C,t),e.varyings.add("vnormal","vec3"),e.varyings.add("vcolor","vec4"),t.hasMultipassTerrain&&e.varyings.add("depth","float"),r.code.add(w`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${t.output===F.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),e.include(Fu,t),t.output){case F.Alpha:e.include(vs,t),i.uniforms.add(new Ie("opacity",s=>s.opacity)),i.code.add(w`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        fragColor = vec4(combinedOpacity);
      }
    `);break;case F.Color:e.include(vs,t),e.include(sx,t),e.include(JP,t),e.include(rx,t),e.include(k3e,t),$p(i,t),QP(i),BC(i),i.uniforms.add(r.uniforms.get("localOrigin"),new kt("ambient",s=>s.ambient),new kt("diffuse",s=>s.diffuse),new kt("specular",s=>s.specular),new Ie("opacity",s=>s.opacity)),i.include(Lm),$m(i),i.code.add(w`
        void main() {
          discardBySlice(vpos);
          ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          fragColor = vec4(shadedColor, combinedOpacity);
          fragColor = highlightSlice(fragColor, vpos);
          ${t.transparencyPassType===dt.Color?"fragColor = premultiplyAlpha(fragColor);":""}
        }
      `);break;case F.Depth:case F.Shadow:case F.ShadowHighlight:case F.ShadowExcludeHighlight:e.include(Nl,t),Yw(e),e.varyings.add("depth","float"),r.code.add(w`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),e.include(vs,t),e.include(C0,t),i.code.add(w`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case F.Normal:e.include(Nl,t),e.include(kM,t),jE(r),e.varyings.add("vnormal","vec3"),r.code.add(w`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(vs,t),i.code.add(w`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case F.Highlight:e.include(Nl,t),e.include(kM,t),e.varyings.add("vnormal","vec3"),r.code.add(w`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(vs,t),e.include(z0,t),i.code.add(w`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return e}const Wdt=Object.freeze(Object.defineProperty({__proto__:null,build:qdt},Symbol.toStringTag,{value:"Module"})),mOe=new Map([[C.POSITION,0],[C.PROFILERIGHT,1],[C.PROFILEUP,2],[C.PROFILEVERTEXANDNORMAL,3],[C.FEATUREVALUE,4]]);let Xdt=class extends Hdt{constructor(){super(...arguments),this.ambient=Pe(.2,.2,.2),this.diffuse=Pe(.8,.8,.8),this.specular=Pe(0,0,0),this.opacity=1,this.origin=O(),this.modelTransformation=null}},gOe=class yOe extends Lr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Ve.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Rr(e.rctx,yOe.shader.get().build(this.configuration),mOe)}initializePipeline(){const e=this.configuration.transparencyPassType,r=this.configuration,i=e===dt.NONE,s=e===dt.FrontFace;return Mt({blending:r.output!==F.Color&&r.output!==F.Alpha||!r.transparent?null:i?Ru:V0(e),culling:r.hasSlicePlane&&!r.transparent&&r.doubleSidedMode!==ts.None?Cxe:null,depthTest:{func:Uv(e)},depthWrite:i||s?jl:null,colorWrite:Bt,stencilWrite:r.hasOccludees?Tm:null,stencilTest:r.hasOccludees?kv:null,polygonOffset:i||s?null:f9})}};gOe.shader=new Or(Wdt,()=>he(()=>import("./Path.glsl-110c9560.js"),[],import.meta.url));let Vn=class extends jo{constructor(){super(...arguments),this.output=F.Color,this.doubleSidedMode=ts.None,this.transparencyPassType=dt.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1}};u([B({count:F.COUNT})],Vn.prototype,"output",void 0),u([B({count:ts.COUNT})],Vn.prototype,"doubleSidedMode",void 0),u([B({count:dt.COUNT})],Vn.prototype,"transparencyPassType",void 0),u([B()],Vn.prototype,"spherical",void 0),u([B()],Vn.prototype,"receiveShadows",void 0),u([B()],Vn.prototype,"receiveAmbientOcclusion",void 0),u([B()],Vn.prototype,"vvSize",void 0),u([B()],Vn.prototype,"vvColor",void 0),u([B()],Vn.prototype,"vvOpacity",void 0),u([B()],Vn.prototype,"hasSlicePlane",void 0),u([B()],Vn.prototype,"transparent",void 0),u([B()],Vn.prototype,"hasOccludees",void 0),u([B()],Vn.prototype,"hasMultipassTerrain",void 0),u([B()],Vn.prototype,"cullAboveGround",void 0),u([B()],Vn.prototype,"doublePrecisionRequiresObfuscation",void 0),u([B({constValue:ut.Disabled})],Vn.prototype,"pbrMode",void 0),u([B({constValue:!0})],Vn.prototype,"hasVvInstancing",void 0),u([B({constValue:!1})],Vn.prototype,"useCustomDTRExponentForWater",void 0),u([B({constValue:!1})],Vn.prototype,"useFillLights",void 0);let Ydt=class _Oe extends Fv{constructor(e){super(e,new Jdt),this.supportsEdges=!0,this._vertexAttributeLocations=mOe,this._configuration=new Vn,this._vertexBufferLayout=_Oe.getVertexBufferLayout()}getConfiguration(e,r){return this._configuration.output=e,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,e!==F.Color&&e!==F.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?ts.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?ts.WindingOrder:ts.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=!!r.ssaoHelper.active&&this.parameters.receiveSSAO),this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}isVisibleForOutput(e){return e!==F.Shadow&&e!==F.ShadowExcludeHighlight&&e!==F.ShadowHighlight||this.parameters.castShadows}isVisible(){return super.isVisible()&&this.parameters.opacity>0}intersect(e,r,i,s,n,o){const a=e;if(!sOe(a))return;const l=a.path,c=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSize){const{offset:v,factor:b,minSize:T,maxSize:x}=this.parameters.vvSize,S=l.sizeAttributeValue;c[0]*=ve(v[0]+S*b[0],T[0],x[0]),c[1]*=ve(v[2]+S*b[2],T[2],x[2])}const h=Math.max(c[0],c[1]),d=e.boundingInfo;if(d==null)return void this._intersectTriangles(l,c,s,n,o);const f=zw(d.bbMin[0]-h,d.bbMin[1]-h,d.bbMin[2]-h,d.bbMax[0]+h,d.bbMax[1]+h,d.bbMax[2]+h),m=[n[0]-s[0],n[1]-s[1],n[2]-s[2]],g=Math.sqrt(m[0]*m[0]+m[1]*m[1]+m[2]*m[2]),_=[g/m[0],g/m[1],g/m[2]];QQ(f,s,_,i.tolerance)&&this._intersectTriangles(l,c,s,n,o)}_intersectTriangles(e,r,i,s,n){e.baked.size&&e.baked.size[0]===r[0]&&e.baked.size[1]===r[1]||e.baked.bake(r),e.baked.intersect(i,s,n)}createBufferWriter(){return new VC(this._vertexBufferLayout)}requiresSlot(e,r){switch(r){case F.Shadow:case F.ShadowHighlight:case F.ShadowExcludeHighlight:if(!this.parameters.castShadows)return!1;case F.Color:case F.Alpha:case F.Depth:case F.Normal:case F.Highlight:case F.ObjectAndLayerIdColor:return e===(this.parameters.transparent?pe.TRANSPARENT_MATERIAL:pe.OPAQUE_MATERIAL)||e===pe.DRAPED_MATERIAL;default:return!1}}createGLMaterial(e){return new Zdt(e)}static getVertexBufferLayout(){return qi().vec3f(C.POSITION).vec4f(C.PROFILERIGHT).vec4f(C.PROFILEUP).vec4f(C.PROFILEVERTEXANDNORMAL).vec4f(C.FEATUREVALUE)}},Zdt=class extends Dv{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}_updateShadowState(e){this.technique!=null&&e.shadowMap.enabled===this.technique.configuration.receiveShadows||this._material.setParameters({receiveShadows:e.shadowMap.enabled})}beginSlot(e){return this._output!==F.Color&&this._output!==F.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e)),this.ensureTechnique(gOe,e)}},Jdt=class extends Xdt{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveSSAO=!0,this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}};const Qdt=["polyline"];let Kdt=class extends Nm{constructor(e,r,i,s){super(e,r,i,s),this._intrinsicSize=fr(1,1),this._upVectorAlignment=am.Path,this._stencilWidth=.1,this.ensureDrapedStatus(!1)}async doLoad(){const e=this.symbolLayer.width!=null?this.symbolLayer.width:this.symbolLayer.height,r=this.symbolLayer.height!=null?this.symbolLayer.height:e;this._vvConvertOptions=new GP({size:!0,color:!0,rotation:!1,opacity:!0},[1,1,1],[e,1,r],this._context.renderCoordsHelper.unitInMeters),this._fastUpdates=this._context.renderer?.visualVariables?.length>0?WE(this._context.renderer,this._vvConvertOptions):null;const i=this.symbolLayer.anchor||"center";this._upVectorAlignment=this.symbolLayer.profileRotation==="heading"?am.World:am.Path;const s=this.symbolLayer.profile||"circle";switch(s){default:case"circle":this._profile=fdt[i];break;case"quad":this._profile=mdt[i]}switch(this.symbolLayer.join){case"round":this._extruder=new Jz(0,tCe);break;case"bevel":this._extruder=new Jz(0,1);break;case"miter":this._extruder=new Jz(.8*Math.PI,1);break;default:this._extruder=new tdt}const n=this.symbolLayer.cap||"butt";switch(n){case"none":this._startCap=new Cce,this._endCap=new Cce;break;case"butt":default:this._startCap=new pL(this._profile,0),this._endCap=new pL(this._profile,0,!0);break;case"square":this._startCap=new pL(this._profile,-.5),this._endCap=new pL(this._profile,.5,!0);break;case"round":{const f=s==="quad";this._startCap=new Ace({profile:this._profile,flip:!1,breakNormals:f,subdivisions:_q}),this._endCap=new Ace({profile:this._profile,flip:!0,breakNormals:f,subdivisions:_q});break}}const o=this.symbolLayer?.material?.color,a=this._getCombinedOpacityAndColor(o),l=Qa(a),c=a[3],h=c<1||this.needsDrivenTransparentPass,d={diffuse:l,ambient:l,opacity:c,transparent:h,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:h||n==="none"?gi.None:gi.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(or(this._intrinsicSize,e,r),!yq(this._intrinsicSize[0])||!yq(this._intrinsicSize[1])))throw new U("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(this._fastUpdates&&this._fastUpdates.visualVariables.size||Sc(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates){const f={...d,...this._fastUpdates.materialParameters,size:bbe(this._intrinsicSize)};this._material=new Ydt(f)}else d.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,d.normalType=Ir.Compressed,this._material=new Sm(d);this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,Qdt,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new Up),s=e.renderingInfo;return this._createAs3DShape(r,s,i,r.uid)}layerOpacityChanged(){const e=this.symbolLayer?.material?.color,r=this._getCombinedOpacity(e),i=r<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:r,transparent:i})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,Tv)}slicePlaneEnabledChanged(){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables"||!XE(this._fastUpdates,r,this._vvConvertOptions))return Us.RecreateSymbol;this._material.setParameters(this._fastUpdates.materialParameters)}return Us.FastUpdate}_getVertexData(e){let r=0;const i=e.paths,s=[],n=e.spatialReference,o=this._context.elevationProvider.spatialReference,a=this._context.renderCoordsHelper.spatialReference;for(const d of i)r+=d.length;const l=Xo(3*r);let c,h=0;for(const d of i){s.push({offset:h,numVertices:d.length});for(const f of d)l[h++]=f[0],l[h++]=f[1],l[h++]=e.hasZ?f[2]:0}return o==null||n.equals(o)||ci(l,n,0,l,o,0,r)?(o==null||o.equals(a)?c=BTe(l):(c=Xo(3*r),ci(l,o,0,c,a,0,r)),{pathVertexDataInfos:s,vertexDataES:l,vertexDataRS:c}):null}_createAs3DShape(e,r,i,s){const n=e.geometry,o=this._getVertexData(n);if(o==null)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(o.pathVertexDataInfos.length===0)return n.paths.length!==0&&n.paths.some(g=>g.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;const a=new Array,l=n.spatialReference,c=gn(),h=this._context.renderCoordsHelper,d=new BQ(o.vertexDataES);for(const g of o.pathVertexDataInfos){const _=g.numVertices;if(_<2)continue;const v=g.offset;if(this._context.clippingExtent!=null&&(Ei(c),Tu(c,o.vertexDataES,v,_),!dp(c,this._context.clippingExtent)))continue;const b=new Array,T=v+3*_;for(let k=v;k<T;k+=3){d.offset=k;const L=Tit(d,this._context.elevationProvider,i,h);ne(ys,o.vertexDataRS[k],o.vertexDataRS[k+1],o.vertexDataRS[k+2]),h.setAltitude(ys,L),o.vertexDataRS[k]=ys[0],o.vertexDataRS[k+1]=ys[1],o.vertexDataRS[k+2]=ys[2],b.push(Bdt(this._upVectorAlignment))}const x=new Qht(b,o.vertexDataES,o.vertexDataRS,v);vOe(x,this._upVectorAlignment,this._context.renderCoordsHelper);const S=new Kht(x,this._profile,this._extruder,this._startCap,this._endCap);let E=null;if(this._fastUpdates){const k=this._fastUpdates.visualVariables,L=Tp(k.size?.field,e)??0,N=Tp(k.color?.field,e)??0,q=Tp(k.opacity?.field,e)??0;E=new ndt(S,L,N,q)}else{const k=[this._intrinsicSize[0],this._intrinsicSize[1]];if(this._drivenProperties.size){const q=r.size;k[0]*=Lce(q[0],q[2]==="symbol-value"?this.symbolLayer.height||0:q[2],this.symbolLayer.width||0),k[1]*=Lce(q[2],q[0]==="symbol-value"?this.symbolLayer.width||0:q[0],this.symbolLayer.height||0)}let L;this._drivenProperties.color&&(L=r.color),this._drivenProperties.opacity&&r.opacity!=null&&(L=L?[L[0],L[1],L[2],r.opacity]:[1,1,1,r.opacity]);const N=new oOe(S);N.bake(k),L&&N.bakeVertexColors(L),E=N}const{vertexAttributes:A,indices:R}=E.createGeometryData(),M=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:this._context.layer.uid}),D=new sdt(this._material,A,R,E,l,this._stencilWidth,M);D.transformation=Gl(xe(),pn,S.path.origin),a.push(D)}if(a.length===0)return null;const f=new B0({geometries:a,layerUid:this._context.layer.uid,graphicUid:s}),m=new Dm(this,f,a,null,null,(g,_,v,b,T)=>tpt(g,_,b,T,this._upVectorAlignment),i);return m.alignedSampledElevation=0,m.needsElevationUpdates=Tv(i.mode),m}};function vOe(t,e,r){const{origin:i,positions:s}=t;let n=t.offset;switch(e){default:case am.World:for(const o of t.vertices)ys[0]=s[n++]+i[0],ys[1]=s[n++]+i[1],ys[2]=s[n++]+i[2],r.worldUpAtPosition(ys,ys),o.setFrameFromUpVector(ys);break;case am.Path:ys[0]=s[n]+i[0],ys[1]=s[n+1]+i[1],ys[2]=s[n+2]+i[2],r.worldUpAtPosition(ys,ys),ddt(t,ys)}}function Lce(t,e,r){switch(t){case"symbol-value":return r;case"proportional":return e;default:return t}}function ept(t,e,r,i){let s=0;const{origin:n,vertices:o,positions:a,positionsES:l}=t,c=t.offset+3*o.length;for(let h=t.offset;h<c;h+=3)ne(ys,l[h],l[h+1],l[h+2]),r(ys,tV),s+=tV.sampledElevation,ys[0]=a[h]+n[0],ys[1]=a[h+1]+n[1],ys[2]=a[h+2]+n[2],i.setAltitude(ys,tV.z),a[h]=ys[0]-n[0],a[h+1]=ys[1]-n[1],a[h+2]=ys[2]-n[2];return t.updatePathVertexInformation(),s/o.length}function tpt(t,e,r,i,s){const n=t.stageObject,o=n.geometries;let a=0;for(const l of o){if(!sOe(l))continue;const c=l.path,h=c.builder.path;a+=ept(h,e,r,i),s!==am.World&&vOe(h,s,i),c.onPathChanged(l),l.invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(l)}return a/o.length}const ys=O(),tV=new qP;function rpt(t,e,r,i,s=1){if(r.isGeographic&&i===Ve.Global){const c=Xo(e.length),h=e.length,d=Vr(r);for(let f=0;f<h;f+=3)x8(e,f,c,f,d);e=c}or(ln,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let c=0;c<e.length;c+=3)ln[0]=Math.min(ln[0],e[c]),ln[1]=Math.min(ln[1],e[c+1]);const n=ln[0]%s,o=ln[1]%s,a=ln[0]-n,l=ln[1]-o;for(let c=0;c<e.length;c+=3){const h=c/3*4;t[h]=(e[c]-a)/s,t[h+1]=(e[c+1]-l)/s,t[h+2]=a/s,t[h+3]=l/s}}function bOe(t,e,r,i,s=1){ne(v1,1,0,0),ne(b1,0,1,0),ne(PT,0,0,1),npt(rV,r),ipt(r,Dce)&&spt(Dce,v1,b1,PT,i,rV),or(ln,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),or(w1,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let h=0;h<r.length;h+=3){ne(MT,r[h],r[h+1],r[h+2]);const d=ye(v1,MT),f=ye(b1,MT);ln[0]=Math.min(ln[0],d),ln[1]=Math.min(ln[1],f),w1[0]=Math.max(w1[0],d),w1[1]=Math.max(w1[1],f)}const n=ye(PT,rV);sV(yy,ln[0],ln[1],n,v1,b1,PT),sV(x1,w1[0],ln[1],n,v1,b1,PT),sV(T1,ln[0],w1[1],n,v1,b1,PT),fe(x1,x1,yy),se(x1,x1,.5),fe(T1,T1,yy),se(T1,T1,.5),de(yy,yy,x1),de(yy,yy,T1);const o=ln[0]%s,a=ln[1]%s,l=ln[0]-o,c=ln[1]-a;for(let h=0;h<r.length;h+=3){ne(MT,r[h],r[h+1],r[h+2]);const d=h/3,f=4*d;t[f]=(ye(v1,MT)-l)/s,t[f+1]=(ye(b1,MT)-c)/s,t[f+2]=l/s,t[f+3]=c/s;const m=9*d;for(let g=0;g<3;g++)e[m+g]=yy[g],e[m+g+3]=x1[g],e[m+g+6]=T1[g]}}const rV=O(),MT=O(),Dce=Fr(),v1=O(),b1=O(),PT=O(),ln=He(),w1=He(),yy=O(),x1=O(),T1=O();function ipt(t,e){const r=t.length/3-1;return Wbe(t,e,0,Math.floor(r/3),Math.floor(r*(2/3)))}function spt(t,e,r,i,s,n){s!=null?(s.basisMatrixAtPosition(n,sf),ne(mL,sf[0],sf[1],sf[2]),ne(gL,sf[4],sf[5],sf[6]),ne(iV,sf[8],sf[9],sf[10])):(ne(mL,1,0,0),ne(gL,0,1,0),ne(iV,0,0,1));const o=t;ye(o,iV)<0&&se(o,o,-1),ie(i,o);const a=ye(o,gL),l=ye(o,mL);Math.abs(a)<Math.abs(l)?(Kb(e,mL,o,-l),_e(e,e),pt(r,e,o),_e(r,r),se(r,r,-1)):(Kb(r,gL,o,-a),_e(r,r),pt(e,r,o),_e(e,e))}const sf=xe(),mL=O(),gL=O(),iV=O();function npt(t,e){ne(z3,0,0,0);for(let r=0;r<e.length-3;r+=3)z3[0]+=e[r],z3[1]+=e[r+1],z3[2]+=e[r+2];se(t,z3,1/(e.length/3-1))}const z3=O();function sV(t,e,r,i,s,n,o){ne(t,e*s[0]+r*n[0]+i*o[0],e*s[1]+r*n[1]+i*o[1],e*s[2]+r*n[2]+i*o[2])}function opt(t){const e=new Sr,{vertex:r,fragment:i,attributes:s,varyings:n}=e;Dc(r,t),e.include(Nl,t),e.include(Ux,t),e.include(r0,t),e.include(BP,t),s.add(C.POSITION,"vec3"),t.vvColor&&s.add(C.COLORFEATUREATTRIBUTE,"float"),n.add("vColor","vec4"),n.add("vpos","vec3");const o=t.hasMultipassTerrain&&(t.output===F.Color||t.output===F.Alpha);o&&n.add("depth","float"),r.uniforms.add(new sr("eColor",c=>c.color));const a=t.output===F.Depth;a&&(e.include(C0,t),Yw(e),yv(e)),r.code.add(w`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${t.hasVertexColors?"vColor *= eColor;":t.vvColor?"vColor = eColor * interpolateVVColor(colorFeatureAttribute);":"vColor = eColor;"}
      ${o?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${a?w`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:w`transformPosition(proj, view, vpos);`}
    }
  `),e.include(vs,t),o&&e.include(Fu,t),i.include(Lm);const l=t.output===F.Highlight;return l&&e.include(z0,t),i.code.add(w`
  void main() {
    discardBySlice(vpos);
    ${o?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = vColor;

    ${t.output===F.ObjectAndLayerIdColor?w`fColor.a = 1.0;`:""}

    if (fColor.a < ${w.float(bo)}) {
      discard;
    }

    ${t.output===F.Alpha?w`fragColor = vec4(fColor.a);`:""}

    ${t.output===F.Color?w`fragColor = highlightSlice(fColor, vpos); ${t.transparencyPassType===dt.Color?"fragColor = premultiplyAlpha(fragColor);":""}`:""}
    ${l?w`outputHighlight();`:""};
    ${t.output===F.Depth?w`outputDepth(linearDepth);`:""};
    ${t.output===F.ObjectAndLayerIdColor?w`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const apt=Object.freeze(Object.defineProperty({__proto__:null,build:opt},Symbol.toStringTag,{value:"Module"}));let wOe=class xOe extends Lr{initializeProgram(e){return new Rr(e.rctx,xOe.shader.get().build(this.configuration),Tr)}_createPipeline(e,r){const i=this.configuration,s=e===dt.NONE,n=e===dt.FrontFace;return Mt({blending:i.output!==F.Color&&i.output!==F.Alpha||!i.transparent?null:s?Ru:V0(e),culling:U8(i.cullFace),depthTest:{func:Uv(e)},depthWrite:(s||n)&&i.writeDepth?jl:null,colorWrite:Bt,stencilWrite:i.hasOccludees?Tm:null,stencilTest:i.hasOccludees?r?Cv:kv:null,polygonOffset:s||n?i.polygonOffset?lpt:null:m9(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};wOe.shader=new Or(apt,()=>he(()=>import("./ColorMaterial.glsl-794ec2da.js"),[],import.meta.url));const lpt={factor:1,units:1};let $o=class extends jo{constructor(){super(...arguments),this.output=F.Color,this.cullFace=gi.None,this.transparencyPassType=dt.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1}};u([B({count:F.COUNT})],$o.prototype,"output",void 0),u([B({count:gi.COUNT})],$o.prototype,"cullFace",void 0),u([B({count:dt.COUNT})],$o.prototype,"transparencyPassType",void 0),u([B()],$o.prototype,"hasSlicePlane",void 0),u([B()],$o.prototype,"hasVertexColors",void 0),u([B()],$o.prototype,"transparent",void 0),u([B()],$o.prototype,"polygonOffset",void 0),u([B()],$o.prototype,"enableOffset",void 0),u([B()],$o.prototype,"writeDepth",void 0),u([B()],$o.prototype,"hasOccludees",void 0),u([B()],$o.prototype,"hasMultipassTerrain",void 0),u([B()],$o.prototype,"cullAboveGround",void 0),u([B()],$o.prototype,"objectAndLayerIdColorInstanced",void 0),u([B()],$o.prototype,"vvColor",void 0),u([B({constValue:!0})],$o.prototype,"hasVvInstancing",void 0),u([B({constValue:!1})],$o.prototype,"vvSize",void 0),u([B({constValue:!1})],$o.prototype,"vvOpacity",void 0);let Nce=class extends DK{constructor(e){super(e,new upt),this.supportsEdges=!0,this._configuration=new $o}getConfiguration(e,r){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<p9,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}requiresSlot(e,r){return r===F.Color||r===F.Alpha||r===F.Highlight||r===F.Depth&&this.parameters.writeLinearDepth||r===F.ObjectAndLayerIdColor?e===pe.DRAPED_MATERIAL?!0:r===F.Highlight?e===pe.OPAQUE_MATERIAL:e===(this.parameters.transparent?this.parameters.writeDepth?pe.TRANSPARENT_MATERIAL:pe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:pe.OPAQUE_MATERIAL):!1}createGLMaterial(e){return new cpt(e)}createBufferWriter(){const e=qi().vec3f(C.POSITION);return ae("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(C.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?e.f32(C.COLORFEATUREATTRIBUTE):e.vec4u8(C.COLOR),new VC(e)}},cpt=class extends Dv{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==F.Color&&this._output!==F.Alpha||this._updateOccludeeState(e),this.ensureTechnique(wOe,e)}},upt=class extends jP{constructor(){super(...arguments),this.color=rm,this.transparent=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=gi.None,this.hasOccludees=!1}};var vo;(function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.Cross=2]="Cross",t[t.ForwardDiagonal=3]="ForwardDiagonal",t[t.BackwardDiagonal=4]="BackwardDiagonal",t[t.DiagonalCross=5]="DiagonalCross",t[t.COUNT=6]="COUNT"})(vo||(vo={}));const Uq=.70710678118,Fce=Uq,hpt=.08715574274;function dpt(t){const e=new Sr,r=t.hasMultipassTerrain&&(t.output===F.Color||t.output===F.Alpha),{vertex:i,fragment:s,attributes:n,varyings:o}=e;Dc(i,t),e.include(Nl,t),e.include(Ux,t),e.include(r0,t),t.draped?i.uniforms.add(new Ie("worldToScreenRatio",(c,h)=>1/h.screenToPCSRatio)):n.add(C.BOUNDINGRECT,"mat3"),n.add(C.POSITION,"vec3"),n.add(C.UVMAPSPACE,"vec4"),t.vvColor&&n.add(C.COLORFEATUREATTRIBUTE,"float"),o.add("vColor","vec4"),o.add("vpos","vec3"),o.add("vuv","vec2"),r&&o.add("depth","float"),i.uniforms.add(new sr("uColor",c=>c.color));const a=t.style===vo.ForwardDiagonal||t.style===vo.BackwardDiagonal||t.style===vo.DiagonalCross;a&&i.code.add(w`
      const mat2 rotate45 = mat2(${w.float(Uq)}, ${w.float(-Fce)},
                                 ${w.float(Fce)}, ${w.float(Uq)});
    `),t.draped||($p(i,t),i.uniforms.add(new Ie("worldToScreenPerDistanceRatio",(c,h)=>1/h.camera.perScreenPixelRatio)),i.code.add(w`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),i.code.add(w`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),i.code.add(w`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${w.float(hpt)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),i.code.add(w`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${a?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${a?" * rotate45":""};

      ${t.draped?"":w`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${w.float(t.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `);const l=t.output===F.Depth;return l&&(e.include(C0,t),Yw(e),yv(e)),i.code.add(w`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${r?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      ${t.hasVertexColors?"vColor *= uColor;":t.vvColor?"vColor = uColor * interpolateVVColor(colorFeatureAttribute);":"vColor = uColor;"}
      gl_Position = ${l?w`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:w`transformPosition(proj, view, vpos);`}
    }
  `),e.include(vs,t),s.include(Lm),t.draped&&s.uniforms.add(new Ie("texelSize",(c,h)=>1/h.camera.pixelRatio)),t.output===F.Highlight&&e.include(z0,t),r&&e.include(Fu,t),t.output!==F.Highlight&&(s.code.add(w`
      const float lineWidth = ${w.float(t.lineWidth)};
      const float spacing = ${w.float(t.patternSpacing)};
      const float spacingINV = ${w.float(1/t.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),t.draped||s.code.add(w`const int maxSamples = 5;
float sampleAA(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),s.code.add(w`
    void main() {
      discardBySlice(vpos);
      ${r?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = vColor;
      color = highlightSlice(color, vpos);

      ${t.output!==F.Highlight?w`color.a *= ${ppt(t)};`:""}

      ${t.output===F.ObjectAndLayerIdColor?w`color.a = 1.0;`:""}

      if (color.a < ${w.float(bo)}) {
        discard;
      }

      ${t.output===F.Alpha?w`fragColor = vec4(color.a);`:""}

      ${t.output===F.Color?w`fragColor = color; ${t.transparencyPassType===dt.Color?"fragColor = premultiplyAlpha(fragColor);":""}`:""}
      ${t.output===F.Highlight?w`outputHighlight();`:""}
      ${t.output===F.Depth?w`outputDepth(linearDepth);`:""};
    }
  `),e}function ppt(t){function e(r){return t.draped?w`coverage(vuv.${r}, texelSize)`:w`sampleAA(vuv.${r})`}switch(t.style){case vo.ForwardDiagonal:case vo.Horizontal:return e("y");case vo.BackwardDiagonal:case vo.Vertical:return e("x");case vo.DiagonalCross:case vo.Cross:return w`
        1.0 - (1.0 - ${e("x")}) * (1.0 - ${e("y")})
      `;default:return"0.0"}}const fpt=Object.freeze(Object.defineProperty({__proto__:null,build:dpt},Symbol.toStringTag,{value:"Module"}));let TOe=class SOe extends Lr{initializeProgram(e){return new Rr(e.rctx,SOe.shader.get().build(this.configuration),EOe)}_setPipelineState(e,r){const i=this.configuration,s=e===dt.NONE,n=e===dt.FrontFace;return Mt({blending:i.output===F.Color||i.output===F.Alpha?s?Ru:V0(e):null,culling:U8(i.cullFace),depthTest:{func:Uv(e)},depthWrite:s?i.writeDepth?jl:null:d9(e),colorWrite:Bt,stencilWrite:i.hasOccludees?Tm:null,stencilTest:i.hasOccludees?r?Cv:kv:null,polygonOffset:s||n?i.polygonOffset?mpt:null:m9(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};TOe.shader=new Or(fpt,()=>he(()=>import("./Pattern.glsl-ba40f731.js"),[],import.meta.url));const mpt={factor:1,units:1};let Bn=class extends jo{constructor(){super(...arguments),this.output=F.Color,this.cullFace=gi.None,this.transparencyPassType=dt.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.writeDepth=!0,this.hasOccludees=!1,this.enableOffset=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.vvColor=!1}};u([B({count:F.COUNT})],Bn.prototype,"output",void 0),u([B({count:gi.COUNT})],Bn.prototype,"cullFace",void 0),u([B({count:vo.COUNT})],Bn.prototype,"style",void 0),u([B({count:dt.COUNT})],Bn.prototype,"transparencyPassType",void 0),u([B()],Bn.prototype,"hasSlicePlane",void 0),u([B()],Bn.prototype,"hasVertexColors",void 0),u([B()],Bn.prototype,"polygonOffset",void 0),u([B()],Bn.prototype,"writeDepth",void 0),u([B()],Bn.prototype,"hasOccludees",void 0),u([B()],Bn.prototype,"patternSpacing",void 0),u([B()],Bn.prototype,"lineWidth",void 0),u([B()],Bn.prototype,"enableOffset",void 0),u([B()],Bn.prototype,"draped",void 0),u([B()],Bn.prototype,"hasMultipassTerrain",void 0),u([B()],Bn.prototype,"cullAboveGround",void 0),u([B()],Bn.prototype,"vvColor",void 0),u([B({constValue:!1})],Bn.prototype,"hasVvInstancing",void 0),u([B({constValue:!1})],Bn.prototype,"vvSize",void 0),u([B({constValue:!1})],Bn.prototype,"vvOpacity",void 0);const EOe=new Map([[C.POSITION,0],[C.COLOR,3],[C.UVMAPSPACE,4],[C.COLORFEATUREATTRIBUTE,5],[C.BOUNDINGRECT,6]]);let cee=class extends DK{constructor(e){super(e,new _pt),this.supportsEdges=!0,this._vertexAttributeLocations=EOe,this._configuration=new Bn}getConfiguration(e,r){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.style=this.parameters.style,this._configuration.patternSpacing=this.parameters.patternSpacing,this._configuration.lineWidth=this.parameters.lineWidth,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<p9,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}requiresSlot(e,r){return r===F.Color||r===F.Alpha||r===F.Highlight||r===F.Depth&&this.parameters.writeLinearDepth?e===pe.DRAPED_MATERIAL?!0:r===F.Highlight?e===pe.OPAQUE_MATERIAL:e===(this.parameters.writeDepth?pe.TRANSPARENT_MATERIAL:pe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):!1}createGLMaterial(e){return new gpt(e)}createBufferWriter(){const e=qi().vec3f(C.POSITION).vec4f(C.UVMAPSPACE);return this.parameters.draped||e.mat3f(C.BOUNDINGRECT),this.parameters.vvColor?e.f32(C.COLORFEATUREATTRIBUTE):e.vec4u8(C.COLOR),new ypt(e)}},gpt=class extends Dv{_updateParameters(e){return this.ensureTechnique(TOe,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==F.Color&&this._output!==F.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},ypt=class extends VC{write(e,r,i,s,n){for(const o of this.vertexBufferLayout.fields.keys()){const a=i.vertexAttributes.get(o),l=i.indices.get(o);if(a&&l)switch(o){case C.UVMAPSPACE:{ot(a.size===4);const c=s.getField(o,Ip);c&&HE(l,a.data,c,n);break}case C.BOUNDINGRECT:{ot(a.size===9);const c=s.getField(o,_v);c&&this.writeBoundingRect(l,a.data,e,c,n);break}default:jSe(o,a,l,e,r,s,n)}}}writeBoundingRect(e,r,i,s,n){const o=i,a=s.typedBuffer,l=s.typedBufferStride,c=e.length;n*=l;for(let h=0;h<c;++h){const d=9*e[h],f=r[d],m=r[d+1],g=r[d+2];a[n]=o[0]*f+o[4]*m+o[8]*g+o[12],a[n+1]=o[1]*f+o[5]*m+o[9]*g+o[13],a[n+2]=o[2]*f+o[6]*m+o[10]*g+o[14];for(let _=3;_<9;++_)a[n+_]=r[d+_];n+=l}}},_pt=class extends jP{constructor(){super(...arguments),this.color=Nt(1,1,1,1),this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=gi.None,this.hasOccludees=!1,this.style=vo.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}};function vpt(t,e){const r=t?.pattern??null;return r==null?new Nce(e):r.style==="none"||r.style==="solid"?(r.style==="none"&&(e.color=Nt(0,0,0,0),e.transparent=!0),new Nce(e)):(e.style=bpt(r.style),new cee(e))}function bpt(t){switch(t){case"horizontal":return vo.Horizontal;case"vertical":return vo.Vertical;case"cross":return vo.Cross;case"forward-diagonal":return vo.ForwardDiagonal;case"backward-diagonal":return vo.BackwardDiagonal;case"diagonal-cross":return vo.DiagonalCross;default:return}}function wpt(t){return t.material instanceof cee&&!t.material.parameters.draped}function xpt(t,e){if(wpt(t)){const r=t.vertexAttributes.get(C.POSITION).data,i=t.getMutableAttribute(C.UVMAPSPACE).data,s=t.getMutableAttribute(C.BOUNDINGRECT).data;bOe(i,s,r,e)}}function Tpt(t,e,r,i,s){const n=WEe(t,e,r,i,s),o=t.stageObject.geometries;for(const a of o)xpt(a,s);return n}const Spt=["polyline","polygon","extent"],Uce=new GP({size:!1,color:!0,rotation:!1,opacity:!1});let COe=class AOe extends Nm{constructor(e,r,i,s){super(e,r,i,s),this._needsUV=!1,this._hasOutline=!1}async doLoad(){this._fastUpdates=WE(this._context.renderer,Uce)}_ensureMaterials(){this._ensureFillMaterial(),this._ensureOutlineMaterial()}_ensureFillMaterial(){if(this._material!=null)return;const e=this.symbolLayer?.material?.color,r=this._getCombinedOpacityAndColor(e);this._material=vpt(this.symbolLayer,{color:r,transparent:r[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,draped:this.draped,hasSlicePlane:this._context.slicePlaneEnabled,...this._fastUpdates?.materialParameters}),this._needsUV=this._material instanceof cee,this._context.stage.add(this._material)}_ensureOutlineMaterial(){const e=this.symbolLayer.outline;if(this._outlineMaterial||!this._isValidOutline(e))return;this._hasOutline=!0;const r=i=>{const s=AAe(e.pattern);return new _S({width:i,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:s,stippleScaleWithLineWidth:!0,cap:$q(e.patternCap||"butt")})};this._outlineMaterial=r(wo(e.size)),this._context.stage.add(this._outlineMaterial)}_isValidOutline(e){return e!=null&&e.size!=null&&e.size>0&&e.color!=null&&(e.pattern==null||e.pattern.type!=="style"||e.pattern.style!=="none")}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null,this._context.stage.remove(this._outlineMaterial),this._outlineMaterial=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,Spt,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(e.renderingInfo,255),s=this.setGraphicElevationContext(r,new Up);return this.ensureDrapedStatus(s.mode==="on-the-ground"),this._ensureMaterials(),this.draped?this._createAsOverlay(r,i):this._createAs3DShape(r,i,s)}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables"||!XE(this._fastUpdates,r,Uce))return Us.RecreateSymbol;this._material&&this._material.setParameters(this._fastUpdates.materialParameters)}return Us.FastUpdate}layerOpacityChanged(){if(this._material!=null){const e=this._material.parameters.color,r=this.symbolLayer?.material?.color,i=this._getCombinedOpacity(r);this._material.setParameters({color:[e[0],e[1],e[2],i],transparent:i<1||this.needsDrivenTransparentPass})}if(this._outlineMaterial!=null){const e=this._outlineMaterial.parameters.color;this._outlineMaterial.setParameters({color:[e[0],e[1],e[2],this._getOutlineOpacity()]})}}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=HP(AOe.elevationModeChangeTypes,i,s);if(n!==hs.UPDATE)return n;const o=td(s);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){if(this._material&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._outlineMaterial){const e={hasSlicePlane:this._context.slicePlaneEnabled};this._outlineMaterial.setParameters(e)}return!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,r,i){const s=UM(e.geometry);if(!s)return null;const n=jK(s,this._context.elevationProvider,this._context.renderCoordsHelper,i),o=new Ept(n,r,this._context.layer.uid,e.uid),a=o.renderData.position.length/3;if(this._needsUV&&(o.uvMapSpace=es(4*a,!0),o.boundingRect=Xo(9*a,!0),bOe(o.uvMapSpace,o.boundingRect,o.renderData.position,this._context.renderCoordsHelper)),o.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(o),this._createAs3DShapeFill(e,o),this._hasOutline&&this._createAs3DShapeOutline(o),this._logGeometryCreationWarnings(o.renderData,s.rings,"rings","FillSymbol3DLayer"),o.outGeometries.length===0)return null;const l=new B0({geometries:o.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:e.uid}),c=new Dm(this,l,o.outGeometries,null,null,Tpt,i);return c.alignedSampledElevation=o.renderData.sampledElevation,c.needsElevationUpdates=td(i.mode),c}_createAs3DShapeFill(e,r){const i=r.renderData.polygons;for(const{position:s,mapPositions:n,holeIndices:o,index:a,count:l}of i){if(this._context.clippingExtent!=null&&(Ei(yd),Tu(yd,n),!dp(yd,this._context.clippingExtent)))continue;const c=JE(n,o,3);if(c.length===0)continue;const h=this._fastUpdates?.visualVariables.color,d=Hae({material:this._material,indices:c,mapPositions:n,attributeData:{position:s,color:h?null:r.color,colorFeature:h?Tp(h.field,e):null,uvMapSpace:this._needsUV?W5(r.uvMapSpace,4*a,4*l):null,boundingRect:this._needsUV?Vh(r.boundingRect,9*a,9*l):null,objectAndLayerIdColor:r.objectAndLayerIdColor}});r.outGeometries.push(d)}}_createAs3DShapeOutline(e){if(!this._hasOutline)return;const r=e.renderData.outlines;for(let i=0;i<r.length;++i){const{mapPositions:s,position:n}=r[i];if(this._context.clippingExtent!=null&&(Ei(yd),Tu(yd,s),!dp(yd,this._context.clippingExtent)))continue;const o=Lq(this._outlineMaterial,{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:s,attributeData:{position:n}},e.objectAndLayerIdColor);e.outGeometries.push(o)}}_createAsOverlay(e,r){const i=UM(e.geometry);if(i==null)return null;this._material.renderPriority=this._renderPriority+this._renderPriorityStep/2,this._outlineMaterial!=null&&(this._outlineMaterial.renderPriority=this._renderPriority);const s=D3e(i,this._context.overlaySR),n=new Cpt(s,r,this._context.layer.uid,e.uid),o=n.renderData.position.length/3;return this._needsUV&&(n.uvMapSpace=es(4*o,!0),rpt(n.uvMapSpace,n.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode)),n.outBoundingBox=Ei(),n.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(n),this._createAsOverlayFill(e,n),this._hasOutline&&this._createAsOverlayOutline(n),this._logGeometryCreationWarnings(n.renderData,i.rings,"rings","FillSymbol3DLayer"),n.outGeometries.length===0?null:new $9(this,n.outGeometries,n.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayFill(e,r){const i=r.renderData.polygons;for(const{position:s,holeIndices:n,index:o,count:a}of i){const l=Ei(yd);if(Tu(l,s),!dp(l,this._context.clippingExtent))continue;const c=JE(s,n,3);if(c.length===0)continue;xE(r.outBoundingBox,l);const h=this._fastUpdates?.visualVariables.color,d=Hae({material:this._material,indices:c,attributeData:{position:s,color:h?null:r.color,colorFeature:h?Tp(h.field,e):null,uvMapSpace:this._needsUV?W5(r.uvMapSpace,4*o,4*a):null,objectAndLayerIdColor:r.objectAndLayerIdColor}});r.outGeometries.push(new eC(d,r))}}_createAsOverlayOutline(e){if(!this._hasOutline)return;const r=e.renderData.outlines;for(let i=0;i<r.length;++i){const{position:s}=r[i];if(Ei(yd),Tu(yd,s),!dp(yd,this._context.clippingExtent))continue;xE(e.outBoundingBox,yd);const n=Lq(this._outlineMaterial,{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:s}},e.objectAndLayerIdColor);e.outGeometries.push(new eC(n,e))}}_getOutlineOpacity(){const e=this.symbolLayer?.outline?.color;return(this.draped?1:this._getLayerOpacity())*(e!=null?e.a:0)}_getOutlineColor(){const e=this.symbolLayer?.outline?.color,r=this._getOutlineOpacity();return MR(e!=null?ke.toUnitRGB(e):null,r)}test(){return{...super.test(),createAsOverlay:(e,r)=>this._createAsOverlay(e,r),createAs3DShape:(e,r,i)=>this._createAs3DShape(e,r,i)}}};COe.elevationModeChangeTypes={definedChanged:hs.RECREATE,staysOnTheGround:hs.NONE,onTheGroundChanged:hs.RECREATE};const yd=gn();let Ept=class extends C9{constructor(e,r,i,s){super(e,i,s),this.color=r}},Cpt=class extends C9{constructor(e,r,i,s){super(e,i,s),this.color=r}};const Apt="arial-unicode-ms",kce="woff2",zce=new Map,OOe=new Set;let Opt=class{constructor(e,r){this.fontFace=e,this.promise=r}};async function Rpt(t){const e=Ipt(t),r=zce.get(e);if(r)return r.promise;const i=new FontFace(t.family,`url('${Gr.fontsUrl}/woff2/${e}.${kce}') format('${kce}')`,{style:t.style,weight:t.weight}),s=document.fonts;if(s.has(i)&&i.status==="loading")return i.loaded;const n=i.load().then(()=>(s.add(i),i));return zce.set(e,new Opt(i,n)),OOe.add(i),n}function Mpt(t){return OOe.has(t)}function Ppt(t){if(!t)return Apt;const e=t.toLowerCase().split(" ").join("-");switch(e){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return e}}function Ipt(t){const e=$pt(t)+Lpt(t);return Ppt(t.family)+(e.length>0?e:"-regular")}function $pt(t){if(!t.weight)return"";switch(t.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function Lpt(t){if(!t.style)return"";switch(t.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}let ROe=class MOe{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.textStyle=this._colorToRGBA(e.color),this.haloStyle=this._colorToRGB(e.halo.color),this.backgroundStyle=e.background.color[3]!==0?this._colorToRGBA(e.background.color):null}fontString(e){const r=this.definition.font;return`${r.style} ${r.weight} ${e}px ${r.family}, sans-serif`}_colorToRGB(e){return`rgb(${e.slice(0,3).map(r=>Math.floor(255*r)).toString()})`}_colorToRGBA(e){return`rgba(${e.slice(0,3).map(r=>Math.floor(255*r)).toString()},${e[3]})`}static async fromSymbol(e,r){const i=e?.material?.color,s=ke.toUnitRGBA(i)??rm,n=e.size!=null?wo(e.size):12,o=e.lineHeight,a=e.background!=null?ke.toUnitRGBA(e.background.color):rm,l={family:e.font?.family??"sans-serif",decoration:e.font?.decoration??"none",weight:e.font?.weight??"normal",style:e.font?.style??"normal"},c=e.halo,h=c!=null&&c.color!=null&&c.size>0?{size:wo(c.size),color:ke.toUnitRGBA(c.color)}:{size:0,color:rm},d=new MOe({color:s,size:n,background:{color:a,padding:e.background!=null?[.65*n,.5*n]:[0,0],borderRadius:e.background!=null?n*(6/16):0},lineSpacingFactor:o,font:l,halo:h,pixelRatio:r});if(e.font){let f=!1;const m=d.fontString(n);try{f=(await document.fonts.load(m)).some(g=>!Mpt(g))}catch{K.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${m}'. Some text symbology may be rendered using the default browser font.`)}if(!f&&!Dpt.has(e.font.family))try{await Rpt(e.font)}catch{}}return d}};const Dpt=new Set(["Arial","Times New Roman","Courier New","serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]);let Npt=class{constructor(e,r,i){this._renderer=new vAe(e,r,i)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const e=Pq(Fpt,this._renderer.renderedWidth,this._renderer.renderedHeight),r=e.getContext("2d");return r.save(),this._renderer.render(r,0,0),r.restore(),new Nx(e,{wrap:{s:Dt.CLAMP_TO_EDGE,t:Dt.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0})}};const Fpt={canvas:null},Upt=[0,0,1];let kpt=class extends Nm{constructor(e,r,i,s){super(e,r,i,s),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=v9(this.symbolLayer.size);if(e)throw new U("graphics3dtextsymbollayer:invalid-size",e)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const e=this._context.graphicsCoreOwner.view.state.rasterPixelRatio;this._textRenderParameters=await ROe.fromSymbol(this.symbolLayer,e)}destroy(){super.destroy()}createGraphics3DGraphic(e){const r=e.graphic,i=NM(r.geometry);if(i==null)return this.logger.warn(`unsupported geometry type for text symbol: ${r.geometry.type}`),null;const s=this.symbolLayer.text;if(s==null||s==="")return null;const n=cJ(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(n!=null&&!a1e(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const o=new jEe(n,this.symbolLayer.horizontalAlignment,hct(this.symbolLayer.verticalAlignment));return this._createAs3DShape(r,i,s,o)}createLabel(e,r,i,s){const n=e.graphic,o=NM(n.geometry);if(o==null)return this.logger.warn(`unsupported geometry type for label: ${n.geometry.type}`),null;const a=r.text;return!a||/^\s+$/.test(a)?null:this._createAs3DShape(n,o,a,r,i,s)}setGraphicElevationContext(e,r,i=0){const s=super.setGraphicElevationContext(e,r);return s.addOffsetRenderUnits(i),s}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(e,r){return Vce(e,r,(i,s)=>{this.updateGraphicElevationContext(s,i)}),hs.UPDATE}slicePlaneEnabledChanged(e,r){return Vce(e,r,i=>{for(const s of i.stageObject.geometries)s.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return!1}updateGraphicElevationContext(e,r){const i=r.elevationContext;this.setGraphicElevationContext(e,i,r.metadata!=null?r.metadata.elevationOffset:0),r.needsElevationUpdates=td(i.mode)||i.mode==="absolute-height"}_defaultElevationInfoNoZ(){return Vpt}_createAs3DShape(e,r,i,s,n,o){const a=this.setGraphicElevationContext(e,new Up,s.elevationOffset),l=e.geometry?.type==="polyline",c=e.uid;let h=null,d=null;if(o==null){const M=wAe(s.horizontalPlacement);h=new Npt(i,M,this._textRenderParameters);let D=null;if(this._context.sharedResources.textures!=null){d=this._context.sharedResources.textures.fromData(h.key,()=>h.create(),()=>{D?.release()});const k=this._context.stage.renderView.textureRepository.acquire(d.texture.id);if(k==null||ku(k))return d.release(),null;D=k}}const f=zpt(h,s),m={occlusionTest:!0,screenOffset:s.screenOffset,anchorPosition:f,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:s.centerOffsetUnits,drawInSecondSlot:!0};if(o!=null?m.textureId=o.id:d!=null&&(m.textureId=d.texture.id),s.verticalOffset!=null){const{screenLength:M,minWorldLength:D,maxWorldLength:k}=s.verticalOffset;m.verticalOffset={screenLength:wo(M),minWorldLength:D||0,maxWorldLength:k??1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:M,screenSizePerspectiveSettingsLabels:D}=this._context.sharedResources;m.screenSizePerspective=D.overridePadding(this._textRenderParameters.haloSize+this._textRenderParameters.definition.background.padding[0]),m.screenSizePerspectiveAlignment=M}let g;if(l&&(m.shaderPolygonOffset=1e-4),m.hasSlicePlane=this._context.slicePlaneEnabled,n!=null){const M=JSON.stringify(m);g=n.get(M),g==null&&(g=new YE(m),n.add(M,g))}else g=new YE(m);const _=s.translation,v=h?fr(h.displayWidth,h.displayHeight):Pp,b=s.centerOffset,T=LH(g,Upt,_,null,v,b,[0,0],null),x=bK(this._context,r,T,a,c);if(x==null)return null;const S=new Dm(this,x.object,[T],n==null?[g]:null,d,ww,a);S.alignedSampledElevation=x.sampledElevation,S.needsElevationUpdates=td(a.mode)||a.mode==="absolute-height";const{displayWidth:E,displayHeight:A}=h??s;S.getScreenSize=(M=He())=>(M[0]=E,M[1]=A,M);const R=new eCe(s.elevationOffset,i);return S.metadata=R,DM(S,r,this._context.elevationProvider),S}};function Vce(t,e,r){t&&t.forEach(i=>{const s=e(i);s!=null&&r(s,i.graphic)})}function zpt(t,e){if(e.verticalPlacement==="baseline"){const i=lct[e.horizontalPlacement],s=t!=null?t.baselineAnchorY:0;return fr(i,s)}const r=uct(e.horizontalPlacement,e.verticalPlacement);return VN[r]}const Vpt={mode:"relative-to-ground",offset:0},Bpt={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},Gpt=["polyline","polygon","extent"];let kq=class cb extends Nm{constructor(e,r,i,s){super(e,r,i,s)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,Gpt,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new Up);return this.ensureDrapedStatus(i.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(r):this._createAs3DShape(r,i,r.uid)}ensureMaterial(){if(this._material!=null)return;const e=new S3e,r=this.symbolLayer.color;r!=null&&(e.color=ke.toUnitRGBA(r));const i=this._getCombinedOpacity(r,{hasIntrinsicColor:!0});e.color=[e.color[0],e.color[1],e.color[2],i],e.transparent=i<1||this.needsDrivenTransparentPass,e.waveDirection=this.symbolLayer.waveDirection!=null?cb.headingVectorFromAngle(this.symbolLayer.waveDirection):fr(0,0);const s=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,n=Bpt[s];e.waveStrength=n.waveStrength,e.waveTextureRepeat=n.textureRepeat,e.waveVelocity=n.waveVelocity,e.flowStrength=n.perturbationStrength,e.hasSlicePlane=this._context.slicePlaneEnabled,e.isDraped=this.draped,this._material=new T3e(e),this._context.stage.add(this._material)}layerOpacityChanged(){if(this._material==null)return;const e=this._material.parameters.color,r=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),i=r<1||this.needsDrivenTransparentPass;this._material.setParameters({color:[e[0],e[1],e[2],r],transparent:i})}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=HP(cb.elevationModeChangeTypes,i,s);if(n!==hs.UPDATE)return n;const o=td(s);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){return this._material!=null&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,r,i){const s=UM(e.geometry);if(s==null)return null;const n=jK(s,this._context.elevationProvider,this._context.renderCoordsHelper,r),o=n.position.length/3,a=Xo(2*o);this._createUVCoordsFromVertices(a,n.mapPositions,o,this._context.elevationProvider.spatialReference);const l=new jpt(n,a,this._context.layer.uid,e.uid);if(l.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(l),this._create3DShapeGeometries(l),this._logGeometryCreationWarnings(l.renderData,s.rings,"rings","WaterSymbol3DLayer"),l.outGeometries.length===0)return null;const c=new B0({geometries:l.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:i}),h=new Dm(this,c,l.outGeometries,null,null,WEe,r);return h.alignedSampledElevation=l.renderData.sampledElevation,h.needsElevationUpdates=td(r.mode),h}_createUVCoordsFromVertices(e,r,i,s){const n=Ta(s);Uc(_y);for(let l=0;l<i;l++)or(Bce,r[3*l],r[3*l+1]),IS(_y,Bce);Uw(_y,_y,n);const o=_y[0]%cb.unitSizeOfTexture,a=_y[1]%cb.unitSizeOfTexture;yL[0]=_y[0]-o,yL[1]=_y[1]-a;for(let l=0;l<i;l++)e[2*l]=(r[3*l]*n-yL[0])/cb.unitSizeOfTexture,e[2*l+1]=(r[3*l+1]*n-yL[1])/cb.unitSizeOfTexture}_create3DShapeGeometries(e){const r=e.renderData.polygons,i=e.uvCoords;for(const{count:s,index:n,position:o,mapPositions:a,holeIndices:l}of r){if(this._context.clippingExtent!=null&&(Ei(S1),Tu(S1,a),!dp(S1,this._context.clippingExtent)))continue;const c=JE(a,l,3);if(c.length===0)continue;const h=Vh(i,2*n,2*s),d=qae({material:this._material,indices:c,mapPositions:a,attributeData:{position:o,uv0:h}},e.objectAndLayerIdColor);e.outGeometries.push(d)}}_createAsOverlay(e){const r=UM(e.geometry);if(r==null)return null;this._material.renderPriority=this._renderPriority;const i=D3e(r,this._context.overlaySR),s=i.position.length/3,n=Xo(2*s);this._createUVCoordsFromVertices(n,i.position,s,this._context.overlaySR);const o=new Hpt(i,n,this._context.layer.uid,e.uid);return o.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(o),o.outBoundingBox=Ei(),this._createAsOverlayWater(o),this._logGeometryCreationWarnings(o.renderData,r.rings,"rings","WaterSymbol3DLayer"),o.outGeometries.length===0?null:new $9(this,o.outGeometries,o.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayWater(e){const r=e.uvCoords,i=e.renderData.polygons;for(const{position:s,holeIndices:n,index:o,count:a}of i){if(Ei(S1),Tu(S1,s),!dp(S1,this._context.clippingExtent))continue;xE(e.outBoundingBox,S1);const l=JE(s,n,3);if(l.length===0)continue;const c=Vh(r,2*o,2*a),h=qae({material:this._material,indices:l,attributeData:{position:s,uv0:c}},e.objectAndLayerIdColor);e.outGeometries.push(new eC(h,e))}}static headingVectorFromAngle(e){const r=He(),i=q6(e);return r[0]=Math.sin(i),r[1]=Math.cos(i),r}test(){return{...super.test(),create3DShape:e=>this._createAs3DShape(e.graphic,e.elevationContext,e.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}};kq.unitSizeOfTexture=100,kq.elevationModeChangeTypes={definedChanged:hs.RECREATE,staysOnTheGround:hs.NONE,onTheGroundChanged:hs.RECREATE};const yL=He(),_y=zt(),Bce=He(),S1=gn();let jpt=class extends C9{constructor(e,r,i,s){super(e,i,s),this.uvCoords=r}},Hpt=class extends C9{constructor(e,r,i,s){super(e,i,s),this.uvCoords=r}};function qpt(t,e,r,i){const s=Xpt[t.type]?.[e.type]||Wpt[e.type];return s?new s(t,e,r,i):(K.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",`unknown symbol type ${e.type}`),null)}const Wpt={icon:Iq,object:Jht,line:OAe,path:Kdt,fill:COe,extrude:kat,text:kpt,water:kq},Xpt={"mesh-3d":{fill:_ut}};let Ypt=class extends yK{set symbol(e){this._symbol=e,e.symbolLayers.forEach((r,i)=>{const s=this.symbolLayers[i];s!=null&&(s.symbol=e,s.symbolLayer=r)})}get symbol(){return this._symbol}constructor(e,r,i){super(r.schedule),this._symbol=e,this._context=r,this._backgroundLayers=i,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let r=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(r=this._backgroundLayers.concat(r));const i=r.length;for(;this.symbolLayers.length<r.length;)this.symbolLayers.push(null);this.symbolLayers.length=r.length;const s=[];for(let n=0;n<i;n++){const o=r.at(n);if(o.enabled===!1)continue;_L.renderPriority=1-(1+n)/i,_L.renderPriorityStep=1/i,_L.ignoreDrivers=o.ignoreDrivers;const a=qpt(this.symbol,o,this._context,_L),l=RY(e,()=>{this.symbolLayers[n]=null,a.destroy()});l&&s.push(l),this.symbolLayers[n]=a}if(await G6(this.symbolLayers,async(n,o)=>{if(n!=null)try{await n.load(),this._extentPadding+=Math.max(this._extentPadding,n.extentPadding)}catch{this.symbolLayers[o]=null}}),s.forEach(n=>n.remove()),Yt(e),this.symbolLayers.length&&!this.symbolLayers.some(n=>!!n))throw new Error}getSymbolLayerSize(e){const r=this.symbolLayers[e];return r!=null?r.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(e=>e!=null&&e.queryForSnapping)}createGraphics3DGraphic(e,r){const i=e.graphic,s=this.symbolLayers.map(o=>o?.createGraphics3DGraphic(e)??null),n=this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null;return new Hst(i,r||this,s,e.layer,n)}get complexity(){return vK(this.symbolLayers.map(e=>e!=null?e.complexity:null))}globalPropertyChanged(e,r){const i=this.symbolLayers.length;for(let s=0;s<i;s++){const n=this.symbolLayers[s],o=a=>{const l=a.layers[s];return l instanceof Dm?l:null};if(n!=null&&!n.globalPropertyChanged(e,r,o))return!1}return!0}applyRendererDiff(e,r){return this.loadStatus!==fu.LOADED?Us.RecreateSymbol:this.symbolLayers.reduce((i,s)=>i!==Us.RecreateSymbol&&s!=null?Math.min(i,s.applyRendererDiff(e,r)):i,Us.FastUpdate)}prepareSymbolPatch(e){if(this.loadStatus===fu.FAILED||e.diff.type!=="partial")return;const r=e.diff.diff;if(!r.symbolLayers||r.symbolLayers.type!=="partial")return;const i=r.symbolLayers.diff;this.symbolLayers.forEach((s,n)=>{if(s==null)return;const o=i[n];if(o){const a={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};s.prepareSymbolLayerPatch(a),e.symbolStatePatches.push(...a.symbolLayerStatePatches),a.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((l,c)=>{const h=l.layers[n];h!=null&&a.graphics3DGraphicPatches.forEach(d=>d(h,c))})}})}updateGeometry(e,r){return this._updateGeometryOrTransform(e,(i,s)=>i.updateGeometry(s,r))}updateTransform(e,r,i,s){return this._updateGeometryOrTransform(e,(n,o)=>n.updateTransform(o,r,i,s))}_updateGeometryOrTransform(e,r){for(let i=0;i<this.symbolLayers.length;i++){const s=this.symbolLayers[i];if(s==null)continue;const n=e.layers[i];if(!n||!r(s,n))return!1}return!0}onRemoveGraphic(e){for(let r=0;r<this.symbolLayers.length;r++){const i=this.symbolLayers[r];if(i==null)continue;const s=e.layers[r];s!=null&&i.onRemoveGraphic(s)}}getFastUpdateStatus(){let e=0,r=0,i=0;return this.symbolLayers.forEach(s=>{s!=null&&(s.loadStatus===fu.LOADING?e++:s.isFastUpdatesEnabled()?i++:r++)}),{loading:e,slow:r,fast:i}}async queryForSnapping(e,r,i,s){const n=this.symbolLayers.filter(Qf).filter(a=>a.queryForSnapping!=null).map(a=>a.queryForSnapping(e,r,i,s)),o=await Promise.all(n);return Yt(s),o.flat()}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const e of this.symbolLayers)e?.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}};const _L=new qst;let Zpt=class extends yK{constructor(e,r,i){super(r),this.symbol=e,this._convert=i,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const r=await this.symbol.fetchSymbol({signal:e});r.id=this.symbol.id,this.graphics3DSymbol=this._convert(r),this.graphics3DSymbol!=null&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.complexity:_K}globalPropertyChanged(e,r){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.globalPropertyChanged(e,r)}applyRendererDiff(e,r){return this.graphics3DSymbol!=null?this.graphics3DSymbol.applyRendererDiff(e,r):Us.RecreateSymbol}prepareSymbolPatch(e){this.graphics3DSymbol!=null&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,r){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.updateGeometry(e,r)}updateTransform(e,r,i,s){return this.graphics3DSymbol?.updateTransform(e,r,i,s)??!1}onRemoveGraphic(){}getFastUpdateStatus(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){this.graphics3DSymbol!=null&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}};function uee(t){return t instanceof Zpt?t.graphics3DSymbol:t instanceof Ypt?t:null}const BM=K.getLogger("esri.views.3d.layers.graphics.labelPlacement");function Jpt(t){const e=oft(t);if(e==null)return null;const r=Qpt(t,e);if(r==null)return null;const i=r.anchor,s=!!e.hasLabelVerticalOffset;return eft({anchor:i,verticalOffset:e.verticalOffset,screenOffset:He(),centerOffset:Nt(0,0,0,-1),centerOffsetUnits:"world",translation:O(),elevationOffset:0,hasLabelVerticalOffset:s},r,t)}function Qpt(t,e){if(e.anchor)return e;const r=t.labelClass.labelPlacement,i=gp[r],s=i||$F(t);return r&&!i&&BM.warnOncePerTick(`the requested label placement '${r}' is currently unsupported in SceneView.`),Kpt(s,t)}function hee(t){const e=t.graphics3DGraphic.graphics3DSymbol,r=uee(e);return r!=null?r.symbol.symbolLayers.at(0):null}function Kpt(t,e){const r=e.graphics3DGraphic.graphic.geometry;if(r==null)return null;if(e.disablePlacement!=null)return e.labelClass.labelPlacement?(BM.warnOncePerTick(Gce(t?.placement,e.disablePlacement.logEntityDescription)),$F(e)):t;const i=r.type;switch(i){case"polyline":case"polygon":case"extent":case"multipoint":if(e.labelClass.labelPlacement)return BM.warnOncePerTick(Gce(t?.placement,`'${i}' geometries`)),$F(e);break;case"point":case"mesh":return t}return t}function Gce(t,e){return`the requested label placement '${t}' is currently unsupported for ${e} in SceneView.`}function $F(t){const e=t.graphics3DGraphic.graphic.geometry;if(e==null)return null;switch(e.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case"polygon":{const r=hee(t);return r!=null&&r.type==="extrude"?gp["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"}}case"point":case"mesh":return gp["above-center"];default:return}}function eft(t,e,r){const i=r.graphics3DGraphic.graphic.geometry;if(i==null)return null;switch(i.type){case"point":rft(t,e,r);break;case"polygon":tft(t,e,r);break;case"mesh":dee(t,e,r.graphics3DGraphic.layers[0])}return t}function tft(t,e,r){const i=hee(r);if(i!=null)switch(i.type){case"extrude":{const s=r.graphics3DGraphic.layers[0];s!=null?(s.getBoundingBoxObjectSpace(zR),hp(zR,t.translation),t.translation[2]=Mv(zR)/2):ne(t.translation,0,0,0),dee(t,e,s);break}}}function rft(t,e,r){const i=hee(r);if(i==null)return;const s=r.graphics3DGraphic.layers[0];switch(s!=null?s.getCenterObjectSpace(t.translation):ne(t.translation,0,0,0),i.type){case"icon":case"text":ift(t,e,r,s);break;case"object":dee(t,e,s)}}function ift(t,e,r,i){const{graphics3DGraphic:s}=r,n=i!=null?i.getScreenSize():null;if(s.isDraped||n==null)t.hasLabelVerticalOffset||t.anchor==="center"||(gp[r.labelClass.labelPlacement]&&BM.warnOncePerTick(`the requested placement '${e.placement}' is currently unsupported for draped graphics`),t.anchor="center");else{const o=sft(r);t.screenOffset[0]=n[0]/2*(e.normalizedOffset[0]-o[0]);const a=n[1]/2*(e.normalizedOffset[1]-o[1]);t.hasLabelVerticalOffset?(t.centerOffset[1]=a,t.centerOffsetUnits="screen"):t.screenOffset[1]=a}}function sft(t,e=aft){const{graphics3DGraphic:r}=t,i=r.layers[0],s=i!=null?i.stageObject.geometries[0].material:null;if(s&&s instanceof YE){const n=s.parameters.anchorPosition;e[0]=2*(n[0]-.5),e[1]=2*(n[1]-.5)}else e[0]=0,e[1]=0;return e}function dee(t,e,r){const i=r!=null?r.getBoundingBoxObjectSpace(zR):zR,s=Pe(i[3]-i[0],i[4]-i[1],i[5]-i[2]),n=Math.sqrt(s[0]*s[0]+s[1]*s[1]);t.centerOffset[0]=n/2*e.normalizedOffset[0];const o=t.translation[2],a=s[2]/2*e.normalizedOffset[1];t.translation[2]=0,t.elevationOffset=o+a;const l=Re(s);t.centerOffset[2]=l/2*e.normalizedOffset[2]}function nft(t){return t==="above-center"}function oft(t){const e=t.labelClass.labelPlacement,{labelSymbol:r,graphics3DGraphic:i}=t,s=uee(i.graphics3DSymbol),n=Cc(s,a=>a.symbol.type==="point-3d"?a.symbol:null),o=gp[e]||$F(t);return n!=null&&n.supportsCallout()&&n.hasVisibleVerticalOffset()&&!i.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:jce(n.verticalOffset),anchor:null,normalizedOffset:null}:!r||!r.hasVisibleVerticalOffset()||n!=null&&n.supportsCallout()&&n.verticalOffset&&!i.isDraped?{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}:o&&nft(o.placement)?{placement:"above-center",verticalOffset:jce(r.verticalOffset),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(BM.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+e+" placement)"),null)}function jce(t){const{screenLength:e,minWorldLength:r,maxWorldLength:i}=t;return{screenLength:e,minWorldLength:r,maxWorldLength:i}}const gp={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},Hce={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const t in Hce){const e=Hce[t],r=gp[t];e.forEach(i=>{gp[i]=r})}Object.freeze&&(Object.freeze(gp),Object.keys(gp).forEach(t=>{Object.freeze(gp[t]),Object.freeze(gp[t]?.normalizedOffset)}));const aft=[0,0],zR=gn();let qce=class{constructor(e){this._stage=e,this._materials=new Map}get(e){return this._materials.get(e)}add(e,r){this._materials.set(e,r),this._stage.add(r)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}};const vL=4096;let lft=class{constructor(){this.offset={x:0,y:0},this.uvMinMax=Wt()}},cft=class{constructor(e,r){this.textId=e,this.textRenderer=r,this.placement=new lft,this.rendered=!1}},uft=class{constructor(e,r,i){this.size=e,this.cursor=r,this.lineHeight=i}resize(e){this.size.height=e}resetCursor(){this.cursor.x=VR,this.cursor.y=VR+POe,this.lineHeight=0}getUsage(){return(this.cursor.x+this.cursor.y*this.size.width)/(this.size.width*this.size.height)}},vO=class extends Te{constructor(e){super(e),this.type=us.Texture,this.id=Ic(),this.events=new Ts,this._glTexture=null,this._needsClear=!1,this._elementsToAddOrUpdate=new Map,this._elementsToRemove=new Map,this._elementsToRender=new Map,this._elements=new Map,this._stageObjects=new Map,this.updating=!1}initialize(){this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","textAtlasCanvas"),this._canvas.setAttribute("style","display:none"),this._ctx=this._canvas.getContext("2d"),this._stage=this.view._stage,this._stage.add(this),this._atlas=new uft({width:vL,height:256},{x:0,y:0},0),this._updateCanvasElementSize(this._atlas),this._resetAtlasCursor()}unload(){this._glTexture=je(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get requiresFrameUpdates(){return!1}_createDescriptor(e){const r=new xr;return r.wrapMode=Dt.CLAMP_TO_EDGE,r.flipped=!0,r.samplingMode=Rt.LINEAR_MIPMAP_LINEAR,r.hasMipmap=!0,r.preMultiplyAlpha=!0,r.maxAnisotropy=e.parameters.maxMaxAnisotropy,r}get glTexture(){return this._glTexture}load(e){return this._glTexture!=null||(this._glTexture=new Ot(e,this._createDescriptor(e),this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(vt.TEXT_TEXTURE_ATLAS,this),this.setDirty()),this._glTexture}dispose(){this._elements=null,this._elementsToAddOrUpdate=null,this._elementsToRemove=null,this._elementsToRender=null,this._frameWorker=Fi(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=je(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_updateCanvasElementSize(e){this._canvas.setAttribute("width",e.size.width.toString()),this._canvas.setAttribute("height",e.size.height.toString())}_resizeAtlas(e){this._atlas.resize(e),this._glTexture!=null&&this._glTexture.resize(this._atlas.size.width,e),this._updateCanvasElementSize(this._atlas)}_resetAtlasCursor(){this._atlas.resetCursor(),this._needsClear=!0}_addAtlasElement(e,r,i,s){const n=this._atlas,{renderedWidth:o,renderedHeight:a}=e.textRenderer;e.placement.offset.x=n.cursor.x,e.placement.offset.y=n.cursor.y,Ti(e.placement.uvMinMax,e.placement.offset.x/n.size.width,1-(e.placement.offset.y+a)/n.size.height,(e.placement.offset.x+o)/n.size.width,1-e.placement.offset.y/n.size.height),n.cursor.x+=i,n.lineHeight=Math.max(n.lineHeight,s),this._elements.set(r,e)}_removeAtlasElement(e){if(e&&this._elements.has(e.textId)){const r=e.placement.offset;this._ctx.clearRect(r.x,r.y,e.textRenderer.renderedWidth,e.textRenderer.renderedHeight),this._elements.delete(e.textId)}}_ensureStageObjects(e){const r=this._stageObjects.get(e);if(r)return r;const i=new Set;return this._stageObjects.set(e,i),i}_addStageObject(e,r){this._ensureStageObjects(e).add(r)}_removeStageObject(e,r){const i=this._stageObjects.get(e);i&&i.delete(r)&&(r.geometries[0].setAttributeData(C.SIZE,[0,0]),r.geometryVertexAttrsUpdated(r.geometries[0]))}_processAddition(e,r){const i=this._atlas,s=e.textId,n=e.textRenderer.renderedWidth,o=e.textRenderer.renderedHeight,a=n+VR,l=o+VR+POe;if(i.cursor.x+a<i.size.width&&i.cursor.y+l<i.size.height)this._addAtlasElement(e,s,a,l),this._elementsToRender.set(s,e),this._elementsToAddOrUpdate.delete(s);else{if(!(i.cursor.y+l+i.lineHeight<i.size.height)){const c=i.cursor.y+l+i.lineHeight-i.size.height,h=i.size.height+c<vL;if(h){const d=Math.ceil(i.size.height*Math.max(1.3,(c+i.size.height)/i.size.height));this._resizeAtlas(Math.min($K(d),vL))}return!r||!h&&i.size.height===vL?(this._processRemovals(),vS.OK):(this._repack(),vS.REPACK)}i.cursor.x=VR,i.cursor.y+=i.lineHeight,i.lineHeight=0,this._addAtlasElement(e,s,a,l),this._elementsToRender.set(s,e),this._elementsToAddOrUpdate.delete(s)}return vS.OK}_processRemovals(){this._elementsToRemove.forEach((e,r)=>{const i=this._stageObjects.get(r);i&&i.size!==0||this._removeAtlasElement(e),i&&i.size===0&&this._stageObjects.delete(r)}),this._elementsToRemove.clear()}_repack(){this._processRemovals(),this._elements.forEach((e,r)=>{e.rendered=!1,this._elementsToAddOrUpdate.set(r,e)}),this._elements.clear(),this._resetAtlasCursor(),this._elementsToRender.clear()}_processRenderingRequest(e){this._ctx.clearRect(e.placement.offset.x,e.placement.offset.y,e.textRenderer.renderedWidth,e.textRenderer.renderedHeight),e.textRenderer.render(this._ctx,e.placement.offset.x,e.placement.offset.y);const r=this._stageObjects.get(e.textId);r&&r.forEach(i=>{i.geometries[0].setAttributeData(C.UV0,e.placement.uvMinMax),i.geometries[0].setAttributeData(C.SIZE,[e.textRenderer.displayWidth,e.textRenderer.displayHeight]),i.geometryVertexAttrsUpdated(i.geometries[0])}),e.rendered=!0}get running(){return this.updating}runTask(e,r=!0){if(this._glTexture==null)return Zo.YIELD;let i=!1;if(Bo(this._elementsToAddOrUpdate,(n,o)=>{if(this._elements.get(o)?.rendered){const l=this._stageObjects.get(o);return l&&l.forEach(c=>{const h=c.geometries[0],d=this._elements.get(o);h.setAttributeData(C.UV0,d.placement.uvMinMax),h.setAttributeData(C.SIZE,[d.textRenderer.displayWidth,d.textRenderer.displayHeight]),c.geometryVertexAttrsUpdated(c.geometries[0])}),this._elementsToAddOrUpdate.delete(o),e.madeProgress(),!1}return this._processAddition(this._elementsToAddOrUpdate.get(o),r)===vS.REPACK&&(i=!0,!0)}),i)return this.runTask(rl,!1),void e.madeProgress();let s=!1;this._elementsToRender.size>0&&this._needsClear&&(this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._needsClear=!1),Bo(this._elementsToRender,(n,o)=>(this._processRenderingRequest(n),this._elementsToRender.delete(o),s=!0,e.madeProgress(),e.done)),s&&this._glTexture.setData(this._canvas),this.updating=this._elementsToRender.size>0,!this.updating&&Ent.orderedRepackingEnabled&&(this.repackOrdered(),e.madeProgress())}addTextTexture(e,r){const i=e.key;this._elementsToAddOrUpdate.has(i)||this._elementsToAddOrUpdate.set(i,new cft(i,e)),this._addStageObject(i,r),this._elementsToRemove.delete(i),this.setDirty()}removeTextTexture(e,r){const i=e.key;this._elementsToRemove.set(i,this._elements.get(i)),this._removeStageObject(i,r)}setDirty(){this._glTexture&&(this.updating=!0)}repackOrdered(){if(this._elements.size===0)return;const e=[];this._elements.forEach((i,s)=>e.push({element:i,key:s}));let r=!0;for(let i=0;i<e.length-1;i++)if(e[i].key.localeCompare(e[i+1].key)>0){r=!1;break}if(!r||this._elementsToRemove.size){e.sort((i,s)=>i.key.localeCompare(s.key)),this._elements.clear();for(const{element:i,key:s}of e)this._elements.set(s,i);this._repack(),this.setDirty()}}get test(){const{_elements:e,_stageObjects:r,_elementsToRemove:i,_atlas:s}=this,n=this;return{elements:e,stageObjects:r,elementsToRemove:i,atlas:s,resizeAtlas:o=>n._resizeAtlas(o),run:(o,a)=>n.runTask(o,a)}}};u([p({constructOnly:!0})],vO.prototype,"view",void 0),u([p({type:Boolean})],vO.prototype,"updating",void 0),vO=u([P("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],vO);const VR=2,POe=2;var vS;(function(t){t[t.OK=0]="OK",t[t.REPACK=1]="REPACK"})(vS||(vS={}));let Wce=class{constructor(e,r){this.labelingContext=e,this.graphics3DGraphic=r,this.hasGraphics3DResources=!1,this.visible=!1,this.rendered=!1,this.textInitialized=!1,this.textRenderers=new Array,this.textLabelPlacements=new Array}},hft=class{constructor(e,r,i,s,n){this.labelClass=e,this.graphics3DSymbol=r,this.graphics3DCalloutSymbolLayer=i,this.textRenderParameters=s,this.labelFunction=n,this.calloutSymbolLayerIndex=0}},dft=class{constructor(e,r,i,s,n,o,a,l){this.layer=r,this.graphics3DCore=i,this.scaleVisibility=s,this.emptySymbolLabelSupported=n,this.elevationInfoOverride=o,this.disablePlacement=a,this.active=l,this.labelClassAbortController=new AbortController,this.labelClassContexts=new Array,this.graphics=new Map,this.labelsToInitialize=new Map,this.stageLayer=new ZCe(e,{pickable:!0,disableOctree:!0},r.uid)}destroy(){this.stageLayer.destroy()}},ub=class extends Te{constructor(e){super(e),this._dirty=!1,this._labels=new Map,this._labelsToAdd=new Map,this._labelsToRemove=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this._handles=new $i,this._handles.add([le(()=>this.view.state?.camera,()=>this.setDirty()),le(()=>this.view.state?.rasterPixelRatio,()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(vt.LABELER,this)]),this._textTextureAtlas=new vO({view:this.view}),this._hudMaterialCollection=new qce(this.view._stage),this._calloutMaterialCollection=new qce(this.view._stage)}dispose(){this._handles=Ne(this._handles),this._textTextureAtlas=je(this._textTextureAtlas),this._hudMaterialCollection=je(this._hudMaterialCollection),this._calloutMaterialCollection=je(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear(),this._labelsToAdd.clear(),this._labelsToRemove.clear()}destroy(){this.dispose(),_d.graphic=null,_d.renderingInfo=null,_d.layer=null}_activateLabelingContext(e){e.graphics.forEach((r,i)=>{const s=new Wce(e,r);this._labels.set(i,s),e.labelsToInitialize.set(i,s),r.setVisibilityFlag(Kn.LABEL,Ho.USER,!0)}),e.active=!0}_deactivateLabelingContext(e){e.graphics.forEach((r,i)=>{r.setVisibilityFlag(Kn.LABEL,Ho.USER,!1),this.setLabelGraphicVisibility(r,!1),this._labels.delete(i)}),e.active=!1}_addLabelTextureToAtlas(e){for(const r of e.graphics3DGraphic.labelLayers){if(!r._labelClass)continue;const i=e.textRenderers[r._labelIndex];i&&this._textTextureAtlas.addTextTexture(i,r.stageObject)}e.rendered=!0}_removeLabelTextureFromAtlas(e){for(const r of e.graphics3DGraphic.labelLayers){if(!r._labelClass)continue;const i=e.textRenderers[r._labelIndex];i!=null&&this._textTextureAtlas.removeTextTexture(i,r.stageObject)}e.rendered=!1}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(e){return this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e),Zo.YIELD}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const r of this._labelingContexts)if(r.active){if(!Xce(r)){if(pft(r)){this._deactivateLabelingContext(r);continue}if(this._createLabelClassContext(r),nV(r)){this._dirty=!0;continue}if(!Xce(r))continue}Bo(r.labelsToInitialize,(i,s)=>(this._ensureGraphics3DResources(i)&&(this._labels.set(s,i),this.deconflictor.setDirty(),e.madeProgress()),(i.visible&&i.textInitialized||!i.visible&&i.hasGraphics3DResources)&&(r.labelsToInitialize.delete(s),e.madeProgress()),e.done))&&(this._dirty=!0)}this._labelsToRemove.forEach(r=>this._removeLabelTextureFromAtlas(r)),this._labelsToAdd.forEach(r=>this._addLabelTextureToAtlas(r)),this._labelsToRemove.clear(),this._labelsToAdd.clear(),this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){const r=e.labelClassAbortController?.signal;await e.layer.when?.(),Yt(r),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const i=e.graphics3DCore,s=i.layer,n=s.labelingInfo&&s.labelingInfo.filter(o=>!!o.symbol);!n||n.length===0||(await G6(n,async(o,a)=>{const l=o.symbol,c=uee(i.getOrCreateGraphics3DSymbol(l));if(c==null)return void K.getLogger(this).error("Failed to create Graphics3DSymbol for label");await c.load(),Yt(r);let h=null;cJ(l)&&l.hasVisibleCallout()&&(h=bst(l,i.symbolCreationContext),await h.load(),Yt(r));const d=await $u(BEe(o,e.layer.fieldsIndex,this.view.spatialReference));if(Yt(r),d.ok===!0){const f=await this._createTextRenderParameters(c.symbol);Yt(r),e.labelClassContexts[a]=new hft(o,c,h,f,d.value)}else K.getLogger(this).error(`Label expression failed to evaluate: ${d.error}`)}),Yt(r))}async _createLabelClassContext(e){return e.labelClassPromise==null&&(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(r=>{if(ds(r))throw r;e.labelClassContexts.length=0}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const r=e.symbolLayers.at(0);return r?.type!=="text"?null:ROe.fromSymbol(r,this.view.state.rasterPixelRatio)}_destroyLabelClassContext(e){for(const i of e.labelClassContexts)--i.graphics3DSymbol.referenced;const r=e.labelClassAbortController;e.labelClassAbortController=new AbortController,zl(r),e.labelClassContexts.length=0,e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,r,i,s,n){const o=new jEe(i.verticalOffset,Xle(i.anchor),cct(i.anchor),e.text,i.translation,i.elevationOffset,i.centerOffset,i.screenOffset,i.centerOffsetUnits,e.displayWidth,e.displayHeight);return _d.graphic=r,_d.renderingInfo=null,_d.layer=s,n.createLabel(_d,o,this._hudMaterialCollection,this._textTextureAtlas)}_createLineCalloutGraphic(e,r,i,s,n){return _d.graphic=e,_d.layer=n,_d.renderingInfo=new _st(null,r,s.translation,s.centerOffset,s.screenOffset,s.centerOffsetUnits,s.elevationOffset,this._calloutMaterialCollection),i.createGraphics3DGraphic(_d)}_ensureGraphics3DResources(e){if(e.hasGraphics3DResources)return!1;const r=e.graphics3DGraphic;if(r.destroyed)return!1;this._ensureTextTextureResources(e);const i=e.labelingContext,s=i.labelClassContexts;if(!s||s.length===0||!i.emptySymbolLabelSupported&&r.layers.length===0)return!1;let n=!1;const o=r.graphic,a=i.layer,l=bL(i.layer);for(let c=0;c<s.length;c++){const h=e.textRenderers[c],d=e.textLabelPlacements[c];if(h==null||d==null)continue;const f=s[c],m=f.graphics3DSymbol,g=m.symbol&&m.symbol.type==="label-3d"?m.symbol:null,_=m.symbolLayers[0];if(!_)continue;_.setElevationInfoOverride(i.elevationInfoOverride);const v=this._createTextSymbolGraphic(h,o,d,a,_);if(v==null)return!1;v._labelClass=f.labelClass,v._labelIndex=c,r.addLabelGraphic(v,i.stageLayer),r.deconflictionPriority=f.textRenderParameters?.definition.size??0,r.setVisibilityFlag(Kn.LABEL,Ho.USER,l),r.setVisibilityFlag(Kn.LABEL,Ho.SCALE_RANGE,!0),r.setVisibilityFlag(Kn.LABEL,Ho.DECONFLICTION,!1),n=!0;const b=f.graphics3DCalloutSymbolLayer;if(b&&d.hasLabelVerticalOffset){b.setElevationInfoOverride(i.elevationInfoOverride);const T=this._createLineCalloutGraphic(o,g,b,d,a);T!=null&&(f.calloutSymbolLayerIndex=r.labelLayers.length,r.addLabelGraphic(T,i.stageLayer))}break}return i.scaleVisibility&&n&&i.scaleVisibility.updateGraphicLabelScaleVisibility(r),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const r=e.labelingContext.labelClassContexts;for(const i of e.graphics3DGraphic.labelLayers){if(i._labelClass==null)continue;const s=r[i._labelIndex].graphics3DSymbol.symbolLayers[0];s?.onRemoveGraphic(i)}e.graphics3DGraphic.deconflictionPriority=0,e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){if(e.textInitialized)return;const r=e.labelingContext,i=r.labelClassContexts;if(!i||i.length===0)return;const s=e.graphics3DGraphic.graphic;for(let n=0;n<i.length;n++){const o=i[n];if(e.textRenderers[n]=null,e.textLabelPlacements[n]=null,o?.textRenderParameters==null)continue;const a=o.labelFunction;let l;if(a.type==="arcade")try{const b=a.needsHydrationToEvaluate()?tit(s,r.layer):s;l=a.evaluate(b)}catch{l=null}else l=a.evaluate(s);if(l==null||l===""||/^\s+$/.test(l))continue;const c=o.graphics3DSymbol,h=c.symbol?.type==="label-3d"?c.symbol:null;if(!c.symbolLayers[0])continue;const d=e.graphics3DGraphic,f=o.labelClass,m=r.disablePlacement,g=Jpt({graphics3DGraphic:d,labelSymbol:h,labelClass:f,disablePlacement:m});if(g==null)continue;const _=Xle(g.anchor),v=wAe(_);e.textRenderers[n]=new vAe(l,v,o.textRenderParameters),e.textLabelPlacements[n]=g}e.textInitialized=!0}_destroyTextTextureResources(e){e.textInitialized=!1,e.textRenderers.length=0,e.textLabelPlacements.length=0}_addGraphic(e,r){const i=r.graphic.uid;if(e.graphics.set(i,r),e.active){const s=new Wce(e,r);this._labels.set(i,s),e.labelsToInitialize.set(i,s)}this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(e,r){const i=r.graphic.uid,s=this._labels.get(i);e.graphics.delete(i),s&&(this._destroyGraphic(s,i),e.labelsToInitialize.delete(i),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,r){this._labels.has(r)&&(this._labels.delete(r),this._labelsToAdd.delete(r),this._labelsToRemove.delete(r)),e.textInitialized&&(this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e)),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,r){if(!r)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const i of r){const s=e.graphics.get(i);s&&(this._removeGraphic(e,s),this._addGraphic(e,s))}}_globalPropertyChanged(e,r){for(const i of r.labelClassContexts){const s=new Map;r.graphics.forEach(o=>s.set(o.graphic.uid,o));const n=o=>o.labelLayers[0];if(i.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,s,n),i.graphics3DCalloutSymbolLayer){const o=a=>a.labelLayers[i.calloutSymbolLayerIndex];i.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,s,o)}}}_visibilityInfoChange(e){const r=bL(e.layer);r&&!e.active&&this._activateLabelingContext(e),!r&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.graphics.forEach((r,i)=>{const s=this._labels.get(i);s&&(this._destroyGraphic(s,i),s.visible=!1,s.rendered=!1,e.labelsToInitialize.set(i,s))}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const r of this._labelingContexts)if(r.graphics3DCore===e)return r;return null}addGraphicsOwner(e,r,i){const s=i&&i.emptySymbolLabelSupported||!1,n=i&&i.elevationInfoOverride||null,o=i&&i.disablePlacement||null;if(this._findLabelingContext(e))return;const a=e.layer,l=new dft(this.view._stage,a,e,r,s,n,o,bL(a));return this._labelingContexts.push(l),this.setDirty(),{addGraphic:c=>this._addGraphic(l,c),removeGraphic:c=>this._removeGraphic(l,c),featureReductionChange:()=>{},layerLabelsEnabled:()=>bL(l.layer),labelingInfoChange:c=>this._labelingInfoChange(l,c),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",l),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",l),visibilityInfoChange:()=>this._visibilityInfoChange(l),reset:()=>this._resetLabels(l),clear:()=>{}}}removeGraphicsOwner(e){const r=this._findLabelingContext(e);if(!r)return;const i=this._labelingContexts.indexOf(r);this._labelingContexts.splice(i,1),r.graphics.forEach(s=>this._removeGraphic(r,s)),r.destroy(),this.setDirty()}setLabelGraphicVisibility(e,r){const i=e.graphic.uid,s=this._labels.get(i);s&&s.visible!==r&&(r&&!s.rendered?(this._labelsToAdd.set(i,s),this._labelsToRemove.delete(i),s.textInitialized||s.labelingContext.labelsToInitialize.set(i,s)):!r&&s.rendered&&(this._labelsToRemove.set(i,s),this._labelsToAdd.delete(i)),s.visible=r,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._dirty||this._textTextureAtlas?.updating||this.deconflictor.updating||this._labelingContexts.some(e=>nV(e))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((r,i)=>r+(nV(i)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function nV(t){return!!t.labelClassPromise&&!!t.labelClassAbortController}function Xce(t){return t.labelClassContexts&&t.labelClassContexts.length}function pft(t){return t.labelClassContexts===null}function bL(t){return t.labelsVisible===!0&&!!t.labelingInfo?.some(e=>!!e.symbol)}u([p({constructOnly:!0})],ub.prototype,"view",void 0),u([p({constructOnly:!0})],ub.prototype,"deconflictor",void 0),u([p()],ub.prototype,"_textTextureAtlas",void 0),u([p({type:Boolean,readOnly:!0})],ub.prototype,"updating",null),ub=u([P("esri.views.3d.layers.graphics.Labeler")],ub);const _d=new vst(null,null,null);let bO=class M2{constructor(e,r,i,s=null){this.lij=[0,0,0],this.extent=zt(),this.resolution=0,this.loadPriority=0,this.measures={visibility:la.VISIBLE_ON_SURFACE,screenRect:zt(),distance:0,shouldSplit:!1},this.used=!1,s&&this.acquire(e,r,i,s)}acquire(e,r,i,s){this.tilingScheme=s,this.id=M2.id(e,r,i),this.lij[0]=e,this.lij[1]=r,this.lij[2]=i,s.getExtent(e,r,i,this.extent),this.resolution=s.resolutionAtLevel(e)}release(){this.tilingScheme=null}getChildren(e){const r=this.lij[0]+1,i=2*this.lij[1],s=2*this.lij[2];return e?(e[0].acquire(r,i,s,this.tilingScheme),e[1].acquire(r,i+1,s,this.tilingScheme),e[2].acquire(r,i,s+1,this.tilingScheme),e[3].acquire(r,i+1,s+1,this.tilingScheme),e):[new M2(r,i,s,this.tilingScheme),new M2(r,i+1,s,this.tilingScheme),new M2(r,i,s+1,this.tilingScheme),new M2(r,i+1,s+1,this.tilingScheme)]}copyMeasurementsFrom(e){this.measures.visibility=e.measures.visibility,this.measures.shouldSplit=e.measures.shouldSplit,this.measures.distance=e.measures.distance,m0(e.measures.screenRect,this.measures.screenRect)}static id(e,r,i){return`${e}/${r}/${i}`}};var la;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",t[t.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(la||(la={}));const IOe=.5*Math.PI,fft=IOe/Math.PI*180;let mft=class{constructor(e){this._renderCoordsHelper=e.renderCoordsHelper,this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:O(),direction:O()};for(let r=0;r<4;r++)this._extent[r]={origin:O(),direction:O(),cap:{next:null,direction:O()}},this._planes[r]=Fr();this._planes[pi.NEAR]=Fr(),this._planes[pi.FAR]=Fr(),this._planesWithoutFar=this._planes.slice(0,5)}update(e,r,i,s=!0){const n=this._extent;this._toRenderBoundingExtent(e,r,i),de(this._center.origin,n[0].origin,n[2].origin),se(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),s||se(this._center.direction,this._center.direction,-1);for(let o=0;o<4;o++){const a=n[o];this._renderCoordsHelper.worldUpAtPosition(a.origin,a.direction);const l=n[o===3?0:o+1];a.cap.next=l.origin,O0(a.cap.direction,a.origin,l.origin),yM(a.direction,a.cap.direction,a.origin,this._planes[o]),s||se(a.direction,a.direction,-1)}yM(n[0].cap.direction,n[1].cap.direction,n[0].origin,this._planes[pi.NEAR]),s?yj(this._planes[pi.NEAR],this._planes[pi.FAR]):(A8(this._planes[pi.FAR],this._planes[pi.NEAR]),yj(this._planes[pi.NEAR],this._planes[pi.NEAR])),this._maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this._maxSpanSpatialReference=r,this._minGlobalAltitude=.9*Vr(this._maxSpanSpatialReference).radius}isVisibleInFrustum(e,r,i=!1){if(e==null)return!1;if(this._renderCoordsHelper.viewingMode===Ve.Global){const n=this._maxSpanSpatialReference.isGeographic?fft:IOe*r;if(this._maxSpan>n)return!0;if(e.altitude!=null&&e.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(e)}if(this._maxSpan===0){const n=this._extent[0];return!(i||!e.intersectsRay(Du(n.origin,n.direction)))}for(let n=0;n<this._extent.length;n++){const o=this._extent[n];if(!i&&e.intersectsRay(Du(o.origin,o.direction))||e.intersectsLineSegment(yw(o.origin,o.cap.next,yft),o.cap.direction))return!0}const s=i?this._planes:this._planesWithoutFar;for(let n=0;n<e.lines.length;n++){const o=e.lines[n];if(DZe(s,o.origin,o.endpoint,o.direction))return!0}return!1}_toRenderBoundingExtentGlobal(e,r,i){AZ(e,vd),vd[2]=i,Fl(r,vd,oV,this._renderCoordsHelper.spatialReference),$n(Yce,oV),Ei(Kl);for(const{x0:n,x1:o,y0:a,y1:l}of gft)for(let c=0;c<5;c++){const h=c/4;vd[0]=St(e[n],e[o],h),vd[1]=St(e[a],e[l],h),vd[2]=i,Qs(vd,r,vd,this._renderCoordsHelper.spatialReference),ze(vd,vd,Yce),mm(Kl,vd)}ne(this._extent[0].origin,Kl[0],Kl[1],Kl[2]),ne(this._extent[1].origin,Kl[3],Kl[1],Kl[2]),ne(this._extent[2].origin,Kl[3],Kl[4],Kl[2]),ne(this._extent[3].origin,Kl[0],Kl[4],Kl[2]);for(let n=0;n<4;++n)ze(this._extent[n].origin,this._extent[n].origin,oV)}_toRenderBoundingExtentLocal(e,r,i){AP(e,r,Xm,this._renderCoordsHelper.spatialReference),ne(this._extent[0].origin,Xm[0],Xm[1],i),ne(this._extent[1].origin,Xm[2],Xm[1],i),ne(this._extent[2].origin,Xm[2],Xm[3],i),ne(this._extent[3].origin,Xm[0],Xm[3],i)}_toRenderBoundingExtent(e,r,i){switch(this._renderCoordsHelper.viewingMode){case Ve.Global:this._toRenderBoundingExtentGlobal(e,r,i);break;case Ve.Local:this._toRenderBoundingExtentLocal(e,r,i);break;default:this._renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(e){if(fi(e.planes[pi.NEAR],this._center.origin)<0&&ye(this._center.direction,e.direction)<0)return!0;for(let r=0;r<4;r++){const i=this._extent[r];if(fi(e.planes[pi.NEAR],i.origin)<0&&ye(i.direction,e.direction)<0)return!0}return!1}};const gft=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],vd=O(),oV=xe(),Yce=xe(),Kl=gn(),Xm=zt(),yft=Dp();let _ft=class{constructor(e){this._renderCoordsHelper=e,this._surfaceElevation=0,this._cache=new Map,this._frustum=new A_(e),this._extendedFrustum=new A_(e),this._intersector=new mft({renderCoordsHelper:e}),this._renderCoordsHelper=e}begin(e,r){this._surfaceElevation=r,this._aboveGround=this._renderCoordsHelper.getAltitude(e.eye)>r,this._frustum.update(e),this._shortenFrustumFarPlane(this._frustum),this._updateExtendedFrustum(e)}end(){this._cache.clear()}calculate(e){if(this._allTilesInvisible)return la.INVISIBLE;const r=this._renderCoordsHelper.viewingMode===Ve.Global&&e.lij[0]>=vft&&e.lij[0]<bft,i=this._getOrCalculateSingleTileVisibility(e,!r);return i!==la.INVISIBLE&&r?this._calculateAggregatedChildrenVisibility(e):i}_shortenFrustumFarPlane(e){const r=A_.nearFarLineIndices,i=e.mutablePoints;for(const s of r){const[n,o]=s,a=i[n],l=i[o];fe(Yc,l,a),se(Yc,Yc,xft),de(i[o],a,Yc)}e.updatePoints(i)}_calculateAggregatedChildrenVisibility(e){let r=la.INVISIBLE;const i=this._cache.get(e.id);if(i!=null)return i;const s=Kce.acquire();e.getChildren(s);for(const n of s){const o=this.calculate(n);if(o!==la.INVISIBLE&&(r=o,o===la.VISIBLE_ON_SURFACE))break}return Kce.release(s),this._cache.set(e.id,r),r}_getOrCalculateSingleTileVisibility(e,r){const i=this._cache.get(e.id);if(i!=null)return i;const s=this._calculateSingleTileVisibility(e);return r&&this._cache.set(e.id,s),s}_calculateSingleTileVisibility(e){return!this._aboveGround&&this._renderCoordsHelper.viewingMode===Ve.Global&&e.lij[0]<wft?this._calculateSingleTileVisibilitySided(e,!1)===la.INVISIBLE?this._calculateSingleTileVisibilitySided(e,!0):void 0:this._calculateSingleTileVisibilitySided(e,this._aboveGround)}_calculateSingleTileVisibilitySided(e,r){this._intersector.update(e.extent,e.tilingScheme.spatialReference,this._surfaceElevation,r);const i=Vr(e.tilingScheme.spatialReference).radius;return this._intersector.isVisibleInFrustum(this._extendedFrustum,i)?this._intersector.isVisibleInFrustum(this._frustum,i,!0)?la.VISIBLE_ON_SURFACE:la.VISIBLE_WHEN_EXTENDED:la.INVISIBLE}_updateExtendedFrustum(e){this._extendedFrustum.update(e),this._shortenFrustumFarPlane(this._extendedFrustum);const r=this._renderCoordsHelper.worldUpAtPosition(e.eye,Yc);this._aboveGround||va(r,r);const i=Dn(-ye(r,e.viewForward));if(this._allTilesInvisible=i>(Math.PI+e.fovY)/2,this._allTilesInvisible||(this._hasExtendedFrustum=i>e.fovY/2,!this._hasExtendedFrustum))return;const s=this._extendedFrustumParameters(),n=this._extendedFrustum.mutablePoints;for(let o=0;o<4;o++){const a=s.pointIndices[o],l=n[a],c=this._renderCoordsHelper.getAltitude(l);if(s.needsAltitudeAdjustment(c)){switch(this._renderCoordsHelper.worldUpAtPosition(l,Yc),a){case et.FAR_BOTTOM_LEFT:case et.FAR_TOP_LEFT:case et.NEAR_BOTTOM_LEFT:case et.NEAR_TOP_LEFT:_j(this._extendedFrustum.planes[pi.LEFT],Yc,Yc);break;case et.FAR_BOTTOM_RIGHT:case et.FAR_TOP_RIGHT:case et.NEAR_BOTTOM_RIGHT:case et.NEAR_TOP_RIGHT:_j(this._extendedFrustum.planes[pi.RIGHT],Yc,Yc)}se(Yc,Yc,s.direction),this._renderCoordsHelper.intersectInfiniteManifold(Du(l,Yc),s.zWithMargin,l)}}if(this._extendedFrustum.updatePoints(n),ua(n[et.NEAR_BOTTOM_LEFT],n[et.NEAR_BOTTOM_RIGHT],n[et.NEAR_TOP_RIGHT],Jce),ua(n[et.NEAR_BOTTOM_RIGHT],n[et.NEAR_TOP_RIGHT],n[et.NEAR_TOP_LEFT],Qce),ye(Jce,Qce)<0){const o=this._extendedFrustum.mutablePoints;this._aboveGround?[o[et.NEAR_BOTTOM_LEFT],o[et.NEAR_BOTTOM_RIGHT]]=[o[et.NEAR_BOTTOM_RIGHT],o[et.NEAR_BOTTOM_LEFT]]:[o[et.NEAR_TOP_LEFT],o[et.NEAR_TOP_RIGHT]]=[o[et.NEAR_TOP_RIGHT],o[et.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(o)}}_extendedFrustumParameters(){return this._aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const e=this._surfaceElevation-Zce;return{zWithMargin:e,pointIndices:A_.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:r=>r>e}}_extendedFrustumParametersBelowSurface(){const e=this._surfaceElevation+Zce;return{zWithMargin:e,pointIndices:A_.planePointIndices.top,direction:1,needsAltitudeAdjustment:r=>r<e}}};const vft=2,bft=6,wft=12,xft=.95,Zce=1,Yc=O(),Jce=Fr(),Qce=Fr(),Kce=new qo(Array,t=>{t.length!==4&&(t[0]=new bO,t[1]=new bO,t[2]=new bO,t[3]=new bO)},t=>{t[0].release(),t[1].release(),t[2].release(),t[3].release()});let Tft=class{constructor(e){this._camera=new yt,this._focusOnMap=[0,0],this._screenRect=zt(),this._tileSize=e.tileSize,this._renderCoordsHelper=e.renderCoordsHelper,this._tilingScheme=e.tilingScheme,this._visibility=new _ft(e.renderCoordsHelper)}begin(e,r,i){this._camera.copyFrom(e),this._surfaceElevation=i,this._focusOnMap[0]=r.x,this._focusOnMap[1]=r.y,CZ(0,0,e.fullWidth,e.fullHeight,this._screenRect),this._visibility.begin(this._camera,i)}end(){this._visibility.end()}updateTile(e){e.measures.visibility=this._visibility.calculate(e),e.measures.distance=P8e(e.extent,this._focusOnMap),e.measures.visibility!==la.INVISIBLE&&this._updateScreenMeasure(e)}_updateScreenMeasure(e){const r=Sft,i=1<<r,s=e.measures.screenRect;Uc(s);let n=0;const o=e.lij[0]+r,a=e.lij[1]<<r,l=e.lij[2]<<r,c=this._tileSizeWithBias(e),h=c*c;for(let d=0;d<i;d++)for(let f=0;f<i;f++)if(n+=this._computeScreenArea(e,o,a+d,l+f,s),n>h)return void(e.measures.shouldSplit=!0);e.measures.shouldSplit=!1}_tileSizeWithBias(e){return e.measures.visibility===la.VISIBLE_WHEN_EXTENDED?this._tileSize*Eft:this._tileSize}_computeScreenArea(e,r,i,s,n){const o=e.measures.visibility===la.VISIBLE_WHEN_EXTENDED;this._projectToScreen(r,i,s,o,vy),Uc(aV);for(let a=0;a<4;a++)IS(aV,vy[a]);return J_(n,aV,n),wne(vy[0],vy[1],vy[2])+wne(vy[0],vy[2],vy[3])}_projectToScreen(e,r,i,s,n){this._tilingScheme.ensureMaxLod(e),this._tilingScheme.getExtent(e,r,i,V3),this._toRenderCoords(V3,0,3,by[0]),this._toRenderCoords(V3,2,3,by[1]),this._toRenderCoords(V3,2,1,by[2]),this._toRenderCoords(V3,0,1,by[3]),s&&(this._projectToPlane(by,this._camera.frustum[pi.NEAR]),this._projectToPlane(by,this._camera.frustum[pi.TOP]),this._projectToPlane(by,this._camera.frustum[pi.BOTTOM]));for(let o=0;o<4;o++)this._camera.projectToRenderScreen(by[o],eue),this._camera.renderToScreen(eue,n[o])}_projectToPlane(e,r){for(let s=0;s<4;s++)G3[s]=fi(r,e[s]);const i=Math.max(G3[0],G3[1],G3[2],G3[3]);if(i>0){const s=se(B3,r,-i);for(let n=0;n<4;n++)de(e[n],e[n],s)}}_toRenderCoords(e,r,i,s){return B3[0]=e[r],B3[1]=e[i],B3[2]=this._surfaceElevation,this._renderCoordsHelper.toRenderCoords(B3,this._tilingScheme.spatialReference,s),s}};const aV=zt(),Sft=2,Eft=5,vy=[Qi(),Qi(),Qi(),Qi()],V3=zt(),B3=O(),by=[O(),O(),O(),O()],G3=[0,0,0,0],eue=Wo();function CGt(t,e,r){if(t==null||r==null)return!1;let i=!0;return an[0]=t.xmin!=null?t.xmin:0,an[1]=t.ymin!=null?t.ymin:0,an[2]=t.zmin!=null?t.zmin:0,i=i&&ci(an,t.spatialReference,0,e,r,0,1),an[0]=t.xmax!=null?t.xmax:0,an[1]=t.ymax!=null?t.ymax:0,an[2]=t.zmax!=null?t.zmax:0,i=i&&ci(an,t.spatialReference,0,e,r,3,1),t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.zmin==null&&(e[2]=-1/0),t.xmax==null&&(e[3]=1/0),t.ymax==null&&(e[4]=1/0),t.zmax==null&&(e[5]=1/0),i}function $Oe(t,e,r){if(t==null||r==null)return!1;let i=!0;return an[0]=t.xmin!=null?t.xmin:0,an[1]=t.ymin!=null?t.ymin:0,an[2]=t.zmin!=null?t.zmin:0,i=i&&ci(an,t.spatialReference,0,an,r,0,1),e[0]=an[0],e[1]=an[1],an[0]=t.xmax!=null?t.xmax:0,an[1]=t.ymax!=null?t.ymax:0,an[2]=t.zmax!=null?t.zmax:0,i=i&&ci(an,t.spatialReference,0,an,r,0,1),e[2]=an[0],e[3]=an[1],t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.xmax==null&&(e[2]=1/0),t.ymax==null&&(e[3]=1/0),i}const an=O();let mo=class extends Te{get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(e!=null&&!e.spatialReference.equals(this.viewState.spatialReference))return void K.getLogger(this).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const r=this._get("filterExtent");if(r===e||r!=null&&e&&r.equals(e))return;const i=e!=null?e.clone():null;this._set("filterExtent",i),this._setDirty()}get _filterExtentRect(){if(this.filterExtent==null)return null;const e=zt();return $Oe(this.filterExtent,e,this.tilingScheme.spatialReference),e}get _rootTileIds(){const{tilingScheme:e}=this;return this._filterExtentRect&&e?e.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}constructor(e){super(e),this.tiles=new Pt,this.tileSize=512,this._idToTile=new Map,this._handles=new $i,this._clients=new Set,this._dirty=!1,this._pendingTiles=null,this._newTiles=new Vt}initialize(){this._handles.add([le(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),Wr),le(()=>[this.tileSize,this.cameraOnSurface?.location,this.tilingScheme,this.viewState?.contentCamera,this.focus?.location],()=>this._setDirty(),Ls)]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(vt.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=Fi(this._frameWorker),this._handles=Ne(this._handles)}addClient(){const e=Aft();return this._clients.add(e),this._clients.size===1&&this._setDirty(),nl(()=>this._removeClient(e))}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(rl))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),this._frameWorker!=null&&(this._frameWorker.priority=vt.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),this._pendingTiles||this._frameWorker==null||(this._frameWorker.priority=vt.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new Tft({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){const{tilingScheme:e}=this;return this._rootTileIds.map(r=>new bO(r[0],r[1],r[2],e))}_purgeHorizonTiles(e){e.sort((r,i)=>{const s=r.measures.screenRect,n=i.measures.screenRect;return s[1]+s[3]-(n[1]+n[3])}),Uc(wL);for(let r=0;r<e.length;r++)if(J_(wL,e.data[r].measures.screenRect,wL),Op(wL)>Oft)return e.data.slice(r,e.length);return[]}_subdivideTilesForView(e){if(!this._pendingTiles)return;const{tilingScheme:r}=this;for(;this._pendingTiles.length>0&&!e.done;){const i=this._pendingTiles.pop();e.madeProgress(),this._filterExtentRect&&!yP(this._filterExtentRect,i.extent)||(this._tileMeasurements.updateTile(i),i.measures.visibility!==la.INVISIBLE&&(i.measures.shouldSplit?(r.ensureMaxLod(i.lij[0]+1),this._pendingTiles.push(...i.getChildren())):this._newTiles.push(i)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}_updateTiles(e){for(const s of this.tiles.items)s.used=!1;const r=e.filter(s=>{const n=this._idToTile.get(s.id);return n?(n.copyMeasurementsFrom(s),n.used=!0):this._idToTile.set(s.id,s),!n}),i=this.tiles.items.filter(s=>!s.used&&(this._idToTile.delete(s.id),!0));this.tiles.removeMany(i),this.tiles.addMany(r),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,r)=>e.measures.visibility!==r.measures.visibility?e.measures.visibility===la.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-r.measures.distance),this.tiles.forEach((e,r)=>e.loadPriority=r)}};u([p({constructOnly:!0})],mo.prototype,"scheduler",void 0),u([p({constructOnly:!0})],mo.prototype,"renderCoordsHelper",void 0),u([p({constructOnly:!0})],mo.prototype,"tilingSchemeOwner",void 0),u([p({constructOnly:!0})],mo.prototype,"cameraOnSurface",void 0),u([p({constructOnly:!0})],mo.prototype,"focus",void 0),u([p({constructOnly:!0})],mo.prototype,"viewState",void 0),u([p({constructOnly:!0})],mo.prototype,"terrain",void 0),u([p()],mo.prototype,"tiles",void 0),u([p()],mo.prototype,"tileSize",void 0),u([p({readOnly:!0})],mo.prototype,"tilingScheme",null),u([p()],mo.prototype,"filterExtent",null),u([p({readOnly:!0})],mo.prototype,"_filterExtentRect",null),u([p({readOnly:!0})],mo.prototype,"_rootTileIds",null),u([p({value:!1})],mo.prototype,"suspended",null),u([p({readOnly:!0})],mo.prototype,"updating",null),mo=u([P("esri.views.3d.layers.support.FeatureTileTree3D")],mo);let Cft=0;function Aft(){return Cft++}const wL=zt(),Oft=10;let ss=class extends Te{constructor(){super(...arguments),this._propertiesPool=new x0({camera:yt},this),this._lastSeenCameraProjectionValues=new yt,this.mode=Ur.ANIMATING,this._cssCamera=new yt,this._camera=new yt,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.events=new Ts,this.viewingMode=Ve.Global,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}init(e,r){this._set("viewingMode",e),this._set("spatialReference",r),this._set("constraints",new mg({mode:this.viewingMode}))}exit(){this.cameraController?.destroy(),this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new x0({camera:yt},this)}destroy(){this.cameraController?.destroy(),this.cameraController=null,this._propertiesPool?.destroy(),this._propertiesPool=null}createInitialCamera(){if(this.viewingMode===Ve.Global){const e=Vr(this.spatialReference).radius;this.camera=new yt({eye:Pe(4*e,0,0),center:Pe(e,0,0),up:Pe(0,0,1)})}else this.camera=new yt({eye:Pe(0,0,100),center:Pe(0,0,0),up:Pe(0,1,0)})}get animation(){return this.cameraController instanceof RM&&this.cameraController.viewAnimation!=null?this.cameraController.viewAnimation:null}get camera(){return this._camera}get cssCamera(){const e=this._cssCamera.copyFrom(this.camera),{height:r,width:i,pixelRatio:s}=this.camera;return e.pixelRatio=1,e.height=Math.round(r/s),e.width=Math.round(i/s),e}set camera(e){e!==Xu&&Xu.copyFrom(e),Xu.computeUp(this.viewingMode),this.events.emit("before-camera-change",Xu);const r=this._camera;if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,Xu)&&(this._lastSeenCameraProjectionValues.copyFrom(Xu),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),!r.equals(Xu)&&(this._camera=this._propertiesPool.get("camera").copyFrom(Xu),this._cameraChanged=!r.almostEquals(Xu),this._cameraChanged)){const i=Qge(()=>{this._cameraChanged=!1,i.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get alignPixelEnabled(){return this.pixelRatio===this.rasterPixelRatio&&this.mode===Ur.IDLE}get updating(){return!this.alignPixelEnabled}get contentCamera(){return this._contentCamera??this.camera}set contentCamera(e){this._contentCamera=e!=null?e.clone():null}get fixedContentCamera(){return this._contentCamera!=null}get isGlobal(){return this.viewingMode===Ve.Global}get isLocal(){return this.viewingMode===Ve.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){this.stopActiveCameraController()?(this.cameraController?.destroy(),e&&(this.removeHandles(tue),this.addHandles(Iu(()=>e.state===Zi.Finished||e.state===Zi.Stopped,()=>{this._set("cameraController",null),this.updateCamera(r=>e.onControllerEnd(r))},{sync:!0,once:!0}),tue),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=Zi.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==Zi.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this._updateQueue.length===0||this._processingUpdates)return;this._processingUpdates=!0;const e=this._updateQueue.shift();Xu.copyFrom(this._get("camera")),e(Xu),this.camera=Xu,this._processingUpdates=!1,this._processUpdateQueue()}_cameraProjectionChanged(e,r){return e.fov!==r.fov||e.fullViewport[0]!==r.fullViewport[0]||e.fullViewport[1]!==r.fullViewport[1]||e.fullViewport[2]!==r.fullViewport[2]||e.fullViewport[3]!==r.fullViewport[3]||e.padding[er.TOP]!==r.padding[er.TOP]||e.padding[er.RIGHT]!==r.padding[er.RIGHT]||e.padding[er.BOTTOM]!==r.padding[er.BOTTOM]||e.padding[er.LEFT]!==r.padding[er.LEFT]}};u([p()],ss.prototype,"mode",void 0),u([p({readOnly:!0,type:DE})],ss.prototype,"animation",null),u([p({type:yt})],ss.prototype,"camera",null),u([p({type:yt})],ss.prototype,"cssCamera",null),u([p()],ss.prototype,"_cssCamera",void 0),u([p()],ss.prototype,"_camera",void 0),u([p({readOnly:!0})],ss.prototype,"pixelRatio",null),u([p()],ss.prototype,"rasterPixelRatio",void 0),u([p()],ss.prototype,"contentPixelRatio",void 0),u([p({readOnly:!0})],ss.prototype,"alignPixelEnabled",null),u([p({readOnly:!0})],ss.prototype,"updating",null),u([p({})],ss.prototype,"_contentCamera",void 0),u([p({type:yt})],ss.prototype,"contentCamera",null),u([p({readOnly:!0})],ss.prototype,"fixedContentCamera",null),u([p({readOnly:!0})],ss.prototype,"constraints",void 0),u([p({readOnly:!0})],ss.prototype,"events",void 0),u([p({readOnly:!0})],ss.prototype,"isGlobal",null),u([p({readOnly:!0})],ss.prototype,"isLocal",null),u([p({readOnly:!0})],ss.prototype,"viewingMode",void 0),u([p({readOnly:!0})],ss.prototype,"spatialReference",void 0),u([p()],ss.prototype,"navigating",null),u([p()],ss.prototype,"stationary",null),u([p()],ss.prototype,"_cameraChanged",void 0),u([p()],ss.prototype,"cameraController",null),ss=u([P("esri.views.3d.state.ViewState")],ss);const Rft=ss,Xu=new yt,tue="ViewStateHandles";let Mft=class{constructor(e,r,i){this.viewingMode=e,this._forEachLayer=r,this._view=i,this._externalIntersectionHandlers=new Vt,this._tolerance=VE,this._tmpRay=eo(),this._tmpRegion=zt(),this._validateHUDIntersector=ed(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(e,r,i){return this.intersectRay(this._getPickRay(e,this._tmpRay),rue(this.viewingMode),r,i)}intersectScreenFreePointFallback(e,r,i){return this.intersectRayFreePointFallback(this._getPickRay(e,this._tmpRay),r,i)}intersectRayFreePointFallback(e,r,i){return this.intersectRay(e,rue(this.viewingMode),r,i)||this._intersectRayFreePointLocal(e,r)}intersectRay(e,r,i,s){return r.options.selectionMode=!1,r.options.store=So.MIN,this.computeIntersection(e,r,s),!!r.results.min&&r.results.min.getIntersectionPoint(i)}getCenterRayWithSubpixelOffset(e,r,i=.5,s=.5){return e.getRenderCenter(SL,i,s),SL[0]+=.0466,SL[1]-=.0123,DQ(e,SL,r)}intersectIntersectorScreen(e,r,i){this.computeIntersection(this._getPickRay(e,this._tmpRay),r,i)}intersectToolIntersectorScreen(e,r,i){const s=this._getPickRay(e,this._tmpRay);this.intersectToolIntersectorRay(s,r,i)}intersectToolIntersectorRay(e,r,i){r.options.selectionMode=!0,this.computeIntersection(e,r,i);const s=r.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||Fp(s)&&s.intersector!==ji.TERRAIN||(r.options.selectionMode=!1,this.computeIntersection(e,r,i))}setTolerance(e=VE){this._tolerance=e}addIntersectionHandler(e){this._externalIntersectionHandlers.push(e),this._externalIntersectionHandlers.sort((r,i)=>r.type===ji.TERRAIN?1:i.type===ji.TERRAIN?-1:0)}removeIntersectionHandler(e){this._externalIntersectionHandlers.removeUnordered(e)!=null&&this._externalIntersectionHandlers.sort((r,i)=>r.type===ji.TERRAIN?1:i.type===ji.TERRAIN?-1:0)}_getPickRay(e,r){const i=this._view.state.camera;return v2e(i,e,r)}_intersectRayFreePointLocal(e,r){return this.viewingMode!==Ve.Local||e==null||de(r,e.origin,_e(Ge.get(),e.direction)),!1}intersectElevationFromScreen(e,r,i=0,s=null){return this._intersectElevation(this._getPickRay(e,this._tmpRay),r,i,s)}_intersectElevation(e,r,i=0,s=null){if(e==null)return null;const n=r!=null?r.mode:"absolute-height",o=r?.offset??0,a=n!=="on-the-ground"?o+i:0,l=a/this._view.renderCoordsHelper.unitInMeters;if(n==="absolute-height"){if(this._view.renderCoordsHelper.intersectInfiniteManifold(e,a,TL)){const T=this._view.computeMapPointFromVec3d(TL);return T.z??(T.z=0),T.z-=o,T}return null}const c=this._view.state.camera,h=Ge.get();c.projectToRenderScreen(e.origin,h);const d=new iue(null,this._forEachLayer),f=this._view.slicePlane,m=f!=null?hoe(f):null,g=ed(this.viewingMode);g.options.store=So.MIN,g.options.verticalOffset=l;const _=e.origin,v=de(Ge.get(),_,e.direction);g.reset(_,v,c),g.point=h;const b=s?"type"in s&&s.type==="graphics"?T=>T.layerUid!==s.uid:T=>T.graphicUid!==s.uid:null;switch(n){case"relative-to-scene":{const T=x=>(!b||b(x))&&!!x.lastValidElevationBB;g.intersect(d.layers,h,this._tolerance,null,T),this._externalIntersectionHandlers.forAll(x=>{if(x.type===ji.I3S||x.type===ji.TERRAIN){const S=x.slicePlaneEnabled?m:null;x.intersect(g,S,g.rayBegin,g.rayEnd,h)}});break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll(T=>{if(T.isGround){const x=T.slicePlaneEnabled?m:null;T.intersect(g,x,g.rayBegin,g.rayEnd,h)}})}if(g.results.min.getIntersectionPoint(TL)){const T=this._view.computeMapPointFromVec3d(TL);return T.z=i,T}return null}computeIntersection(e,r,i){if(e==null)return;const s=this._view.state.camera,n=Ge.get();s.projectToRenderScreen(e.origin,n);const o=new iue(i,this._forEachLayer);r.options.selectOpaqueTerrainOnly=!i||!("include"in i||"exclude"in i);const a=e.origin,l=de(Ge.get(),e.origin,e.direction);r.reset(a,l,s),r.intersect(o.layers,n,this._tolerance);const c=this._view.slicePlane,h=c!=null?hoe(c):null;r.intersect(o.sliceableLayers,n,this._tolerance,h);const d=i&&(i.requiresGroundFeedback||i.enableDraped);this._externalIntersectionHandlers.forAll(g=>{const _=g.layerUid,v=Array.isArray(_),b=v?_:[_];v&&(r.options.filteredLayerUids=[]);let T=!1;for(const x of b)o.filterLayerUid(x)?T=!0:v&&r.options.filteredLayerUids.push(x);if(r.options.isFiltered=!T,g.isGround&&d||!r.options.isFiltered){const x=g.slicePlaneEnabled?h:null;g.intersect(r,x,a,l,n)}});const f=Ge.get(),m=this._view.basemapTerrain;if(i&&i.enableDraped&&m.spatialReference!=null&&r.results.ground.getIntersectionPoint(f)){const g=m.overlayManager.renderer,_=this._view.renderCoordsHelper.spatialReference,v=Ge.get();this._view.renderCoordsHelper.fromRenderCoords(f,v,m.spatialReference),v[2]=this._view.elevationProvider?.getElevation(f[0],f[1],f[2],_,"ground")??0,g.intersect(r,v,r.results.ground,b=>o.filterRenderGeometry(b))}r.sortResults(),this._processHUDResults(r)}_processHUDResults(e){const r=e.results.hud;m0(this._tmpRegion,MB);const i=this._view.state.camera,s=[],n=this._tmpRegion,o=b=>{const T=new Ift(b);i.projectToRenderScreen(b.target.center,T.screenPoint),T.screenPoint[0]=Math.floor(T.screenPoint[0]),T.screenPoint[1]=Math.floor(T.screenPoint[1]),s.push(T),IS(n,T.screenPoint)};e.sortResults(r.all),r.min.dist!=null&&o(r.min);for(const b of r.all)r.min.target.object!==b.target.object&&r.max.target.object!==b.target.object&&o(b);if(r.max.dist!=null&&r.max.target.object!==r.min.target.object&&o(r.max),!s.length)return;n[0]===n[2]&&(n[2]+=1),n[1]===n[3]&&(n[3]+=1);const a=i.fullWidth,l=i.fullHeight,c=Math.max(0,n[0]-wO),h=Math.max(0,n[1]-wO),d=Math.min(vu(n)+2*wO,a-c),f=Math.min(Op(n)+2*wO,l-h),m=new Uint8Array(d*f*4);this._view._stage.renderer.readHUDVisibility(c,h,d,f,m);let g=!0;const _=e.results.max.dist==null;let v=0;for(const b of s)for(const T of Pft)if(m[4*(Math.min(b.screenPoint[0]+T[0],a)-n[0]+(Math.min(b.screenPoint[1]+T[1],l)-n[1])*d)]){g&&(e.results.min.copy(b.result),g=!1),_&&e.results.max.copy(b.result),e.options.store===So.ALL&&e.results.all.splice(v++,0,b.result);break}}};const wO=1,Pft=(()=>{const t=[],e=wO;for(let r=-e;r<=e;r++)for(let i=-e;i<=e;i++)t.push([i+e,r+e]);return t})();let Ift=class{constructor(e){this.result=e,this.screenPoint=Wo()}},xL;function rue(t){return xL&&xL.viewingMode===t||(xL=ed(t)),xL}let iue=class{constructor(e,r){this.layers=new Array,this.sliceableLayers=new Array,this.include=e?.include,this.exclude=e?.exclude,r(i=>{i.pickable&&this.filterLayerUid(i.apiLayerUid)&&(i.sliceable?this.sliceableLayers:this.layers).push(i)})}filterLayerUid(e){const{include:r,exclude:i}=this;return e==null?r==null&&i==null:(r==null||r.has(e))&&(i==null||!i.has(e))}filterRenderGeometry(e){return this.filterLayerUid(e.layerUid)}};function sue(t){return typeof t=="object"&&"intersect"in t}const TL=O(),SL=Wo();let IGt=class{constructor(e,r){this.spatialReference=e,this._view=r}getElevation(e,r,i){return this._view.elevationProvider.getElevation(e,r,0,this.spatialReference,i)}async queryElevation(e,r,i,s,n){return this._view.elevationProvider.queryElevation(e,r,0,this.spatialReference,n,i,s)}},$ft=class{constructor(e,r,i,s){this.spatialReference=r,this._getElevationQueryProvider=i,this._queries=new Array,this._queryOptions={...s,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(vt.ELEVATION_QUERY,this)}destroy(){this._frameTask.remove()}queryElevation(e,r,i,s=0){const n=Eo(),o={x:e,y:r,minDemResolution:s,result:n,signal:i};return this._queries.push(o),ya(i,()=>{EY(this._queries,o),n.reject(zr())}),n.promise}get running(){return this._queries.length>0}runTask(e){const r=this._queries;this._queries=[];const i=this._getElevationQueryProvider();if(!i)return r.forEach(h=>h.result.reject()),void e.madeProgress();const s=r.map(h=>[h.x,h.y]),n=r.reduce((h,d)=>Math.min(h,d.minDemResolution),1/0),o=new gP({points:s,spatialReference:this.spatialReference}),a=r.length>1&&r.some(h=>!!h.signal)?new AbortController:null,l=a!=null?a.signal:r[0].signal;if(a!=null){let h=0;r.forEach(d=>ya(d.signal,()=>{h++,d.result.reject(zr()),h===r.length&&a.abort()}))}const c={...this._queryOptions,minDemResolution:n,signal:l};i.queryElevation(o,c).then(h=>{r.forEach((d,f)=>{d.signal!=null&&d.signal.aborted?d.result.reject(zr()):d.result.resolve(h.geometry.points[f][2])})}).catch(h=>{r.forEach(d=>d.result.reject(h))}),e.madeProgress()}get test(){const e=this;return{update:()=>e._queries.length>0&&e.runTask(rl)}}},xO=class extends Ts.EventedMixin(Te){get spatialReference(){return this.view?.basemapTerrain?.spatialReference}constructor(e){super(e),this._im=new Array,this._ground=new Array,this._scene=new Array,this._handles=new Map,this.lastElevationQuery=null,this.elevationCacheEnabled=!1}destroy(){this._elevationQueryCached=Ne(this._elevationQueryCached)}get _elevationQuery(){return this._elevationQueryCached==null&&(this._elevationQueryCached=new $ft(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4})),this._elevationQueryCached}enableElevationCache(e){e||(this.lastElevationQuery=null),this.elevationCacheEnabled=e}getElevation(e,r,i,s,n){if(this.elevationCacheEnabled&&this.lastElevationQuery!=null){const a=this.lastElevationQuery;if(e===a.x&&r===a.y&&i===a.z&&Ln(s,a.spatialReference)&&n===a.queryContext)return a.result}let o=null;return o=EL(o,this._im,e,r,i,s,n),o==null&&(o=EL(o,this._ground,e,r,i,s,n)),n==="scene"&&(o=EL(o,this._scene,e,r,i,s,n)),this.elevationCacheEnabled&&(this.lastElevationQuery={x:e,y:r,z:i,spatialReference:s,queryContext:n,result:o}),o}getSphereElevationBounds(e,r){let i=1/0,s=-1/0;for(const n of[this._im,this._ground,this._scene])n.forEach(o=>{if(o.getSphereElevationBounds){const a=o.getSphereElevationBounds(e,r);a!=null&&(i=Math.min(i,a.min),s=Math.max(s,a.max))}});return{min:i,max:s}}queryElevation(e,r,i,s,n,o=null,a=0){const l=Eo();return this._elevationQuery.queryElevation(e,r,o,a).then(c=>{n==="scene"&&(c=EL(c,this._scene,e,r,i,s,n)),l.resolve(c)}).catch(c=>{ds(c)?l.reject(c):l.resolve(this.getElevation(e,r,i,s,n))}),l.promise}register(e,r){this._handles.set(r,r.on("elevation-change",i=>this.emit("elevation-change",i))),this._providersFromContext(e).push(r)}unregister(e){this._handles.has(e)&&(this._handles.get(e)?.remove(),this._handles.delete(e));for(const r of[this._im,this._ground,this._scene]){const i=r.indexOf(e);i>-1&&r.splice(i,1)}}_providersFromContext(e){switch(e){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}};function EL(t,e,r,i,s,n,o){for(const a of e){const l=a.getElevation(r,i,s,n,o);l!=null&&(t=t!=null?Math.max(l,t):l)}return t}u([p({constructOnly:!0})],xO.prototype,"view",void 0),u([p()],xO.prototype,"spatialReference",null),xO=u([P("esri.views.3d.support.CombinedElevationProvider")],xO);let TO=class zq{static isValidProfile(e){return e in zq.profiles}static getDefaultProfile(){return ae("esri-iPhone")?"low":"medium"}static apply(e,r){const i=zq.profiles[e];r.graphics3D.maxTotalNumberOfFeatures=i.graphics3D.maxTotalNumberOfFeatures,r.graphics3D.maxTotalNumberOfPrimitives=i.graphics3D.maxTotalNumberOfPrimitives,r.graphics3D.polygonLodFactor=i.graphics3D.polygonLodFactor,r.graphics3D.polylineLodFactor=i.graphics3D.polylineLodFactor,r.graphics3D.snapshotAvailable=i.graphics3D.snapshotAvailable,r.graphics3D.skipHighSymbolLods=i.graphics3D.skipHighSymbolLods;const s=r.sceneService.object,n=i.sceneService.object;s.lodFactor=n.lodFactor,s.lodCrossfadeinDuration=n.lodCrossfadeinDuration,s.lodCrossfadeoutDuration=n.lodCrossfadeoutDuration,s.lodCrossfadeUncoveredDuration=n.lodCrossfadeUncoveredDuration,r.sceneService.point.lodFactor=i.sceneService.point.lodFactor,r.sceneService.integratedMesh.lodFactor=i.sceneService.integratedMesh.lodFactor,r.sceneService.pointCloud.lodFactor=i.sceneService.pointCloud.lodFactor,r.sceneService.uncompressedTextureDownsamplingEnabled=i.sceneService.uncompressedTextureDownsamplingEnabled,r.tiledSurface.lodBias=i.tiledSurface.lodBias,r.tiledSurface.angledSplitBias=i.tiledSurface.angledSplitBias,r.tiledSurface.reduceTileLevelDifferences=i.tiledSurface.reduceTileLevelDifferences,r.tiledSurface.textureFadeDuration=i.tiledSurface.textureFadeDuration,r.heatmap.pixelRatio=i.heatmap.pixelRatio,r.heatmap.maxTotalNumberOfFeatures=i.heatmap.maxTotalNumberOfFeatures,r.fadeDuration=i.fadeDuration,r.antialiasingEnabled=i.antialiasingEnabled,r.physicallyBasedRenderingEnabled=i.physicalBasedRenderingEnabled,r.highQualityTransparency=i.highQualityTransparency,r.highResolutionAtmosphere=i.highResolutionAtmosphere,r.reflections=i.reflections,r.ambientOcclusion=i.ambientOcclusion,r.memoryLimit=i.memoryLimit,r.additionalCacheMemory=i.additionalCacheMemory,r.frameRate=i.frameRate,r.maximumPixelRatio=i.maximumPixelRatio}};function nue(){const t=!!ae("esri-mobile"),e=!!ae("ios"),r=400;return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxTotalNumberOfPrimitives:85e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25e3},sceneService:{object:{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},fadeDuration:0,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:t?.8:1,polylineLodFactor:t?1.2:1.5,snapshotAvailable:!e,skipHighSymbolLods:!1},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:r},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:t},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!ae("disable-feature:reduce-map-tile-levels"),textureFadeDuration:r},fadeDuration:r,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:t?600:750,additionalCacheMemory:t?-100:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:t?1.2:2,polylineLodFactor:t?1.2:2,snapshotAvailable:!e,skipHighSymbolLods:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:r},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!ae("disable-feature:reduce-map-tile-levels"),textureFadeDuration:r},fadeDuration:r,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!0,reflections:!0,ambientOcclusion:!0,memoryLimit:t?900:1500,additionalCacheMemory:t?-150:0,frameRate:0,maximumPixelRatio:t?1:1/0}}}TO.test={reset(){const t=nue();for(const e of Object.keys(t))TO.profiles[e]=t[e]}},function(t){t.profiles=nue()}(TO||(TO={}));const jN=TO;function LOe(){return new Float32Array(4)}function Lft(t){const e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Em(t,e,r,i){const s=new Float32Array(4);return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function Dft(t,e){return new Float32Array(t,e,4)}function DOe(){return LOe()}function NOe(){return Em(1,1,1,1)}function FOe(){return Em(1,0,0,0)}function UOe(){return Em(0,1,0,0)}function kOe(){return Em(0,0,1,0)}function zOe(){return Em(0,0,0,1)}const Nft=DOe(),Fft=NOe(),Uft=FOe(),kft=UOe(),zft=kOe(),Vft=zOe();Object.freeze(Object.defineProperty({__proto__:null,ONES:Fft,UNIT_W:Vft,UNIT_X:Uft,UNIT_Y:kft,UNIT_Z:zft,ZEROS:Nft,clone:Lft,create:LOe,createView:Dft,fromValues:Em,ones:NOe,unitW:zOe,unitX:FOe,unitY:UOe,unitZ:kOe,zeros:DOe},Symbol.toStringTag,{value:"Module"}));const oue=new ke([0,255,255]),aue=new ke([0,0,0]),lue=1,cue=.25,uue=.4,hue=.2;let Sf=class extends Te{constructor(){super(...arguments),this.color=oue.clone(),this.haloColor=null,this.haloOpacity=lue,this.fillOpacity=cue,this.shadowOpacity=uue,this.shadowColor=aue.clone(),this.shadowDifference=hue}static toEngineOptions(e){const r=ke.toUnitRGBA(e.color??oue),i=e.haloColor!=null?ke.toUnitRGBA(e.haloColor):r,s=ke.toUnitRGBA(e.shadowColor??aue),n=e.haloOpacity??lue,o=e.fillOpacity??cue,a=e.shadowOpacity??uue,l=e.shadowDifference??hue;return{color:Em(r[0],r[1],r[2],r[3]),haloColor:Em(i[0],i[1],i[2],i[3]),haloOpacity:n,haloOpacityOccluded:.25*n,fillOpacity:o,fillOpacityOccluded:.25*o,shadowOpacity:a,shadowColor:Nt(s[0],s[1],s[2],s[3]),occludedShadowOpacity:a*(1-l)}}};u([p({type:ke})],Sf.prototype,"color",void 0),u([p({type:ke})],Sf.prototype,"haloColor",void 0),u([p()],Sf.prototype,"haloOpacity",void 0),u([p()],Sf.prototype,"fillOpacity",void 0),u([p()],Sf.prototype,"shadowOpacity",void 0),u([p({type:ke})],Sf.prototype,"shadowColor",void 0),u([p()],Sf.prototype,"shadowDifference",void 0),Sf=u([P("esri.views.3d.support.HighlightOptions")],Sf);const Vq=Sf;function F9(t,e){return e?{...e,query:{...t??{},...e.query}}:{query:t}}function U9(t){return typeof t=="string"?Co(t):ee(t)}function k9(t,e,r){const i={};for(const s in t){if(s==="declaredClass")continue;const n=t[s];if(n!=null&&typeof n!="function")if(Array.isArray(n)){i[s]=[];for(let o=0;o<n.length;o++)i[s][o]=k9(n[o])}else if(typeof n=="object")if(n.toJSON){const o=n.toJSON(r&&r[s]);i[s]=e?o:JSON.stringify(o)}else i[s]=e?n:JSON.stringify(n);else i[s]=n}return i}function FGt(t){return{geometryType:LZ(t[0]),geometries:t.map(e=>e.toJSON())}}function Bft(t,e,r){const i=j8e(e);return t.map(s=>{const n=i.fromJSON(s);return n.spatialReference=r,n})}let hb=class extends ue{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(s=>s.toJSON()),r=this.geometries[0],i={};return i.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),i.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference.toJSON()),i.geometries=JSON.stringify({geometryType:LZ(r),geometries:e}),this.transformation&&(i.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(i.transformForward=this.transformForward),i}};u([p()],hb.prototype,"geometries",void 0),u([p({json:{read:{source:"outSR"}}})],hb.prototype,"outSpatialReference",void 0),u([p()],hb.prototype,"transformation",void 0),u([p()],hb.prototype,"transformForward",void 0),hb=u([P("esri.rest.support.ProjectParameters")],hb);const z9=hb,Gft=ws(z9);async function pee(t,e,r){e=Gft(e);const i=U9(t),s={...i.query,f:"json",...e.toJSON()},n=e.outSpatialReference,o=LZ(e.geometries[0]),a=F9(s,r);return ur(i.path+"/project",a).then(({data:{geometries:l}})=>Bft(l,o,n))}async function fee(t=null,e){if(Gr.geometryServiceUrl)return Gr.geometryServiceUrl;if(!t)throw new U("internal:geometry-service-url-not-configured");let r;r="portal"in t?t.portal||en.getDefault():t,await r.load({signal:e});const i=r.helperServices?.geometry?.url;if(!i)throw new U("internal:geometry-service-url-not-configured");return i}async function jft(t,e,r=null,i){const s=await fee(r,i),n=new z9;n.geometries=[t],n.outSpatialReference=e;const o=await pee(s,n,{signal:i});if(o&&Array.isArray(o)&&o.length===1)return o[0];throw new U("internal:geometry-service-projection-failed")}const Hft=Object.freeze(Object.defineProperty({__proto__:null,getGeometryServiceURL:fee,projectGeometry:jft},Symbol.toStringTag,{value:"Module"}));let qft=class{constructor(e,r){this.spatialReference=r,this.unitInMeters=Ta(this.spatialReference,Vr(this.spatialReference).metersPerDegree),this._geometryServiceURLPromise=fee(e&&e.get("portalItem")).catch(()=>{throw new U("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(e){const r=await this._geometryServiceURLPromise;let i,s=!0;Array.isArray(e[0])&&typeof e[0]!="number"?i=e:(i=[e],s=!1);const n=i.map(l=>l instanceof tt?l:new tt(l,this.spatialReference)),o=new z9({geometries:n,outSpatialReference:qe.WGS84}),a=(await pee(r,o)).map(l=>l.type==="point"?[l.x,l.y]:void 0).filter(l=>!!l);return s?a:a[0]}},Xd=class extends Te{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxTotalNumberOfPrimitives=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1}};u([p()],Xd.prototype,"minTotalNumberOfFeatures",void 0),u([p()],Xd.prototype,"maxTotalNumberOfFeatures",void 0),u([p()],Xd.prototype,"maxTotalNumberOfPrimitives",void 0),u([p()],Xd.prototype,"snapshotAvailable",void 0),u([p()],Xd.prototype,"polygonLodFactor",void 0),u([p()],Xd.prototype,"polylineLodFactor",void 0),u([p()],Xd.prototype,"skipHighSymbolLods",void 0),Xd=u([P("esri.views.3d.support.QualitySettings.Graphics3DSettings")],Xd);let lm=class extends Te{constructor(){super(...arguments),this.lodFactor=1}};u([p()],lm.prototype,"lodFactor",void 0),lm=u([P("esri.views.3d.support.QualitySettings.LoDFactorSettings")],lm);let LF=class extends lm{constructor(){super(...arguments),this.lodCrossfadeinDuration=0,this.lodCrossfadeoutDuration=0,this.lodCrossfadeUncoveredDuration=0}};LF=u([P("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],LF);let Lg=class extends Te{constructor(){super(...arguments),this.object=new LF,this.point=new lm,this.integratedMesh=new lm,this.pointCloud=new lm,this.uncompressedTextureDownsamplingEnabled=!1}};u([p({type:LF})],Lg.prototype,"object",void 0),u([p({type:lm})],Lg.prototype,"point",void 0),u([p({type:lm})],Lg.prototype,"integratedMesh",void 0),u([p({type:lm})],Lg.prototype,"pointCloud",void 0),u([p()],Lg.prototype,"uncompressedTextureDownsamplingEnabled",void 0),Lg=u([P("esri.views.3d.support.QualitySettings.SceneServiceSettings")],Lg);let __=class extends Te{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.reduceTileLevelDifferences=!0,this.textureFadeDuration=400}};u([p()],__.prototype,"lodBias",void 0),u([p()],__.prototype,"angledSplitBias",void 0),u([p()],__.prototype,"reduceTileLevelDifferences",void 0),u([p()],__.prototype,"textureFadeDuration",void 0),__=u([P("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],__);let bS=class extends Te{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};u([p()],bS.prototype,"pixelRatio",void 0),u([p()],bS.prototype,"maxTotalNumberOfFeatures",void 0),bS=u([P("esri.views.3d.support.QualitySettings.HeatmapSettings")],bS);let Lo=class extends Te{constructor(){super(...arguments),this.graphics3D=new Xd,this.sceneService=new Lg,this.tiledSurface=new __,this.heatmap=new bS,this.fadeDuration=400,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.highResolutionAtmosphere=!1,this.reflections=!1,this.ambientOcclusion=!1,this.memoryLimit=750,this.additionalCacheMemory=0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};u([p({type:Xd})],Lo.prototype,"graphics3D",void 0),u([p({type:Lg})],Lo.prototype,"sceneService",void 0),u([p({type:__})],Lo.prototype,"tiledSurface",void 0),u([p({type:bS})],Lo.prototype,"heatmap",void 0),u([p()],Lo.prototype,"fadeDuration",void 0),u([p()],Lo.prototype,"antialiasingEnabled",void 0),u([p()],Lo.prototype,"physicallyBasedRenderingEnabled",void 0),u([p()],Lo.prototype,"highQualityTransparency",void 0),u([p()],Lo.prototype,"highResolutionAtmosphere",void 0),u([p()],Lo.prototype,"reflections",void 0),u([p()],Lo.prototype,"ambientOcclusion",void 0),u([p()],Lo.prototype,"memoryLimit",void 0),u([p()],Lo.prototype,"additionalCacheMemory",void 0),u([p()],Lo.prototype,"frameRate",void 0),u([p()],Lo.prototype,"maximumPixelRatio",void 0),Lo=u([P("esri.views.3d.support.QualitySettings.QualitySettings")],Lo);const due=Lo;function Wft(t){return fC(t)&&t.length>=3}function Xft(t){return(mC(t)||Array.isArray(t))&&t.length>=3}function Yft(t){return Wft(t)||Xft(t)}let Zft=class Bq{constructor(e,r,i,s){this.viewingMode=e,this.spatialReference=r,this.unitInMeters=i,this._coordinateSystem=s,this._tmpCoordinateSystem=PBe(s)}set extent(e){e&&IBe(this._coordinateSystem,e,this._coordinateSystem)}getAltitude(e){return zBe(this._coordinateSystem,e)}setAltitude(e,r,i=e){return lwe(this._coordinateSystem,i,r,e)}setAltitudeOfTransformation(e,r){VBe(this._coordinateSystem,r,e,r)}worldUpAtPosition(e,r){return NBe(this._coordinateSystem,e,r)}worldBasisAtPosition(e,r,i){return FBe(this._coordinateSystem,e,r,i)}basisMatrixAtPosition(e,r){const i=this.worldBasisAtPosition(e,Mc.X,Ge.get()),s=this.worldBasisAtPosition(e,Mc.Y,Ge.get()),n=this.worldBasisAtPosition(e,Mc.Z,Ge.get());return Pm(r,i[0],i[1],i[2],0,s[0],s[1],s[2],0,n[0],n[1],n[2],0,0,0,0,1),r}headingAtPosition(e,r){const i=this.worldUpAtPosition(e,Ge.get()),s=this.worldBasisAtPosition(e,Mc.Y,Ge.get()),n=Fbe(r,s,i);return al(n)}intersectManifoldClosestSilhouette(e,r,i){return ek(this._coordinateSystem,r,this._tmpCoordinateSystem),kBe(this._tmpCoordinateSystem,e,i),i}intersectManifold(e,r,i){ek(this._coordinateSystem,r,this._tmpCoordinateSystem);const s=Ge.get();return UBe(this._tmpCoordinateSystem,e,s)?ie(i,s):null}intersectInfiniteManifold(e,r,i){if(this.viewingMode===Ve.Global)return this.intersectManifold(e,r,i);ek(this._coordinateSystem,r,this._tmpCoordinateSystem);const s=this._tmpCoordinateSystem.value,n=Ge.get();return Rx(s.plane,e,n)?ie(i,n):null}toRenderCoords(e,r,i){return aF(e)?Ao(e,r,this.spatialReference):Qs(e,r,i,this.spatialReference)}fromRenderCoords(e,r,i=null){return aF(r)?(i!=null&&(r.spatialReference=i),mJ(e,this.spatialReference,r)):Yft(r)?Qs(e,this.spatialReference,r,i)?r:null:b0(e,this.spatialReference,r)}static create(e,r){switch(e){case Ve.Local:return new Bq(Ve.Local,r,Ta(r),DBe());case Ve.Global:return new Bq(Ve.Global,r,1,LBe(r))}}static renderUnitScaleFactor(e,r){return xre(e)/xre(r)}};var Gf;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.BASEMAP=1]="BASEMAP",t[t.I3S_INDEX=2]="I3S_INDEX",t[t.I3S_DATA=3]="I3S_DATA",t[t.SYMBOLOGY=4]="SYMBOLOGY"})(Gf||(Gf={}));const Jft=(()=>{const t=new Array;return t[Gf.ELEVATION]=10,t[Gf.BASEMAP]=10,t[Gf.I3S_INDEX]=10,t[Gf.I3S_DATA]=10,t[Gf.SYMBOLOGY]=5,t})(),Qft=30;function VOe(t){return"usedMemory"in t&&"unloadedMemory"in t&&"ignoresMemoryFactor"in t}function Kft(t){return new Sl({view:t})}const CL=1,lV=1,emt=.75,tmt=.6,pue=1.3;let Sl=class extends Te{constructor(e){super(e),this._quality=1,this._usedMemory=0,this._updating=!1,this.minQuality=.1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new E3e,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=750,this._additionalCacheMemory=0}destroy(){this._cacheStorage.destroy()}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(CL),this._maxMemory=e)}get maxMemory(){return this._maxMemory}set additionalCacheMemory(e){e!=null&&(this._additionalCacheMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._usedMemory}newCache(e,r){return new Uot(e,this._cacheStorage,r)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._updateMemory(),this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();if(this._memoryPredicted<tmt&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(CL);else if(e)(this._memoryPredicted>1.1*lV||this._usedMemory>lV)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._usedMemory&&(this._updateQuality(this._quality/pue),this._downscaleMemoryUsed=this._usedMemory,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._usedMemory>lV)this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/pue),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._usedMemory<emt&&this._quality<CL){this._stableQuality=this._quality;const r=.05;e=this._updateQuality(this._quality+r)}else this._quality<1&&(this._canFastRecover=!0);this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,this.minQuality),CL))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){if(!this.view)return;let e=0;this.view.basemapTerrain&&(e+=this.view.basemapTerrain.usedMemory);const r=this.view?._stage&&this.view._stage.renderView&&this.view._stage.renderer?.edgeView;r!=null&&(e+=r.usedMemory);let i=0;this.view.allLayerViews&&this.view.allLayerViews.forEach(a=>{if(VOe(a)){const l=a.ignoresMemoryFactor?this._quality:1;e+=a.usedMemory*l,i+=a.unloadedMemory*l}});const s=this._warnMemoryUsage==null||Math.round(10*e)!==Math.round(10*this._warnMemoryUsage),n=1048576*this.maxMemory;if(e>n&&s){this._warnMemoryUsage=e;const a=c=>(c/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",l=Math.round(100*this._quality);K.getLogger(this).warn(`Memory Limit exceeded! Limit: ${a(n)} Current: ${a(e)} Projected: ${a(e+i)} Quality: ${l}%`)}this._usedMemory=e/n,this._memoryPredicted=(e+i)/n;const o=n-e;this._cacheStorage.maxSize=Math.max(0,o+1048576*this.additionalCacheMemory)}get test(){const e=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const r=e._numQualityChanges;return e._numQualityChanges=0,r}}}};u([p({constructOnly:!0})],Sl.prototype,"view",void 0),u([p()],Sl.prototype,"maxMemory",null),u([p()],Sl.prototype,"additionalCacheMemory",null),u([p()],Sl.prototype,"memoryFactor",null),u([p()],Sl.prototype,"updating",null),u([p()],Sl.prototype,"usedMemory",null),u([p()],Sl.prototype,"_quality",void 0),u([p()],Sl.prototype,"_usedMemory",void 0),u([p()],Sl.prototype,"_updating",void 0),u([p()],Sl.prototype,"_stableQuality",void 0),u([p()],Sl.prototype,"_maxMemory",void 0),u([p()],Sl.prototype,"_additionalCacheMemory",void 0),Sl=u([P("esri.views.3d.support.MemoryController")],Sl);let rmt=class{constructor(e){this.client=e,this._cancelled=!1,this.size=0,this.duration=0}},imt=class{constructor(e){this.typeWorkerQuota=e,this.tasks=new Array,this.numWorkers=0,this.statistics=new smt}},smt=class{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}},nmt=class{constructor(e,r,i,s){this._workerFunc=e,this._callbackFunc=r,this._maxTotalNumWorkers=i,this._totalNumWorkers=0,this._clients=s.map(n=>new imt(n))}destroy(){this._clients.length=0}hasQuota(e){const r=this._clients[e];return!!r&&(this._totalNumWorkers<this._maxTotalNumWorkers||r.numWorkers+r.tasks.length<r.typeWorkerQuota)}push(e){const r=this._clients[e.client];r&&(this._totalNumWorkers<this._maxTotalNumWorkers?(r.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,(i,s)=>this._taskCallback(i,s))):r.tasks.push(e))}cancel(e){this._taskFinished(e),e._cancelled=!0}_taskFinished(e){const r=this._clients[e.client];this._totalNumWorkers--,r&&(r.numWorkers--,r.statistics.requests++,r.statistics.size+=e.size||0,r.statistics.duration+=e.duration||0,r.statistics.speed=r.statistics.duration>0?r.statistics.size/r.statistics.duration:0,ot(r.numWorkers>=0)),this._next()}_next(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))return}_processQueue(e){for(;e.tasks.length>0;)if(this._workerFunc(e.tasks.shift(),(r,i)=>this._taskCallback(r,i)))return e.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(e,r){e._cancelled||(this._callbackFunc(e,r),this._taskFinished(e))}getStatsForType(e){const r=this._clients[e];return r?{quota:r.typeWorkerQuota,workers:r.numWorkers,queueSize:r.tasks.length,requestStats:r.statistics}:null}get test(){const e=this;return{set workerFunc(r){e._workerFunc=r}}}},HN=class extends Te{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,r,i){this._loadQueue=new nmt((s,n)=>this._startLoading(s,n),(s,n)=>this._doneLoadingCB(s,n),e,r),i&&(this._frameTask=i.registerTask(vt.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=Fi(this._frameTask),this._tasks.forEach(e=>zl(e.abortController)),this._loadQueue=Ne(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,r,i,s={}){const n=Eo();n.__signal=s!=null?s.signal:null;const o=this._createOrUpdateTask(e,r,i,s,n);return ya(s,()=>this._cancelRequest(o,n)),n.promise}_createTask(e,r,i,s,n,o){const a=new lmt(e,r,i,s,n);return this._updateTask(a,o),this._tasks.set(n,a),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(a),a}_cancelRequest(e,r){JR(e.resolvers,r),r.reject(zr()),e.resolvers.length===0&&(e.status===yh.DOWNLOADING&&(e.status=yh.CANCELLED,this._loadQueue.cancel(e),e.abortController?.abort(),e.request=null,e.abortController=null),e.status=yh.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,r){e.resolvers.push(r)}_createOrUpdateTask(e,r,i,s,n){const o=cmt(s!=null&&s.uid||e,r,i),a=this._tasks.get(o);return a?(this._updateTask(a,n),a):this._createTask(e,s,r,i,o,n)}_doneLoadingCB(e,r){this._loadQueue&&(ot(e.status===yh.DOWNLOADING),e.status=yh.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:r}):this._doneLoading(e,r))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const r=this._onLoadQueue.shift();Yt(r.task.abortController),r.task.abortController=null,r.callback(r.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const r=this._doneQueue.shift();r.task.status!==yh.DOWNLOADED&&(r.err=r.err||zr()),this._doneLoading(r.task,r.err),e.madeProgress()}}_doneLoading(e,r){if(r&&!ds(r)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let i=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const s of e.resolvers)if(r)ds(r)?s.reject(r):s.reject(new U("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${r}`,{url:e.url,error:r}));else{--i;const n=i<=0?e.result:ee(e.result);s.resolve(n)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,r){if(e.status===yh.CANCELLED)return!1;let i,s;switch(e.startTime=performance.now(),e.status=yh.DOWNLOADING,e.docType){case"binary":s="array-buffer",i=0;break;case"image":s="image";break;case"image+type":s="array-buffer";break;default:s="json"}e.abortController=new AbortController;const n=e.abortController.signal;e.request=ur(e.url,{...e.options,responseType:s,timeout:i,signal:n});let o=()=>{};const a=c=>{e.duration=performance.now()-e.startTime,e.size=c instanceof ArrayBuffer?c.byteLength:e.size||0,e.result=c,this._frameTask?this._onLoadQueue.push({callback:r,task:e}):(e.abortController=null,r(e))},l=c=>{e.status===yh.DOWNLOADING&&r(e,c),o()};return e.docType!=="image+type"?(e.request.then(c=>a(c.data),l),!0):(e.request.then(c=>{const h=c.data,d=amt(h);if(s="image",e.size=h.byteLength,d==="unknown")return e.request=ur(e.url,{responseType:s,timeout:i,signal:n}),void e.request.then(g=>a(g.data),l);const f=new Blob([h],{type:d}),m=window.URL.createObjectURL(f);o=()=>window.URL.revokeObjectURL(m),e.request=ur(m,{responseType:s,timeout:i,signal:n}),e.request.then(g=>a(new V9(g.data,d,o)),l)},l),!0)}get test(){return{loadQueue:this._loadQueue}}};u([p({readOnly:!0})],HN.prototype,"updating",void 0),HN=u([P("esri.views.3d.support.StreamDataLoader")],HN);const omt={numRetries:0};function amt(t){if(t.byteLength<2)return"unknown";const e=new Uint8Array(t,0,t.byteLength);return e[0]===137&&e[1]===80?"image/png":e[0]===71&&e[1]===73?"image/gif":e[0]===66&&e[1]===77?"image/bmp":e[0]===255&&e[1]===216?"image/jpeg":"unknown"}let V9=class{constructor(e,r,i){this.image=e,this.type=r,this.release=i}get isOpaque(){return this.type==="image/jpeg"}},lmt=class extends rmt{constructor(e,r,i,s,n){super(s),this.url=e,this.options=r,this.docType=i,this.key=n,this.result=null,this.status=yh.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=omt.numRetries}};function cmt(t,e,r){return`${t}:${e}:${r}`}var yh;(function(t){t[t.QUEUED=1]="QUEUED",t[t.DOWNLOADING=2]="DOWNLOADING",t[t.DOWNLOADED=3]="DOWNLOADED",t[t.CANCELLED=4]="CANCELLED"})(yh||(yh={}));let qN=class extends Te{constructor(){super(...arguments),this.updating=!1}};function umt(t){return new Ld({view:t})}u([p({readOnly:!0})],qN.prototype,"updating",void 0),qN=u([P("esri.views.3d.support.ResourceControllerMain")],qN);let Ld=class extends qN{constructor(){super(...arguments),this._immediateTask=LE,this._normalTask=LE,this._updatingObjects=bM([]),this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=eHe(),this._memoryController=Kft(this.view),this._streamDataLoader=new HN,this._streamDataLoader.setup(Qft,Jft,this._scheduler),this.addHandles([le(()=>this.view.state?.mode,e=>{e!=null&&(this._scheduler.state=e)},Wr),le(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=dE({update:e=>this._frame(e)}),this._immediateTask=this._scheduler.registerTask(vt.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(vt.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=Fi(this._frameTask),this._streamDataLoader=Ne(this._streamDataLoader),this._memoryController=Ne(this._memoryController),this._scheduler=Ne(this._scheduler),this.view=null}get updating(){return!!(this._memoryController?.updating||this._streamDataLoader?.updating||this._immediateTask?.updating)||this._updatingObjects?.value.some(e=>e.updating)}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(e){const r=this._streamDataLoader;return{request:(i,s,n)=>r.request(i,s,e,n),get busy(){return!r.hasDownloadSlots(e)}}}addUpdatingObject(e){const r=this._updatingObjects;return r.value=[...r.value,e],nl(()=>{r.value=r.value.filter(i=>i!==e)})}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(PY(e.deltaTime)),!this._scheduler)||(this._scheduler.updateBudget(e)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update())}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){return{getQueueStats:e=>this._streamDataLoader.test.loadQueue.getStatsForType(e)}}};u([p()],Ld.prototype,"view",void 0),u([p()],Ld.prototype,"_scheduler",void 0),u([p()],Ld.prototype,"_memoryController",void 0),u([p()],Ld.prototype,"_streamDataLoader",void 0),u([p()],Ld.prototype,"_immediateTask",void 0),u([p()],Ld.prototype,"_normalTask",void 0),u([p()],Ld.prototype,"_updatingObjects",void 0),u([p({readOnly:!0})],Ld.prototype,"updating",null),Ld=u([P("esri.views.3d.support.ResourceControllerImpl")],Ld);function hmt(t){return VOe(t)}function dmt(t){return"performanceInfo"in t}var ca,ht;(function(t){t[t.INSIDE=0]="INSIDE",t[t.INTERSECTS=1]="INTERSECTS",t[t.OUTSIDE=2]="OUTSIDE"})(ca||(ca={})),function(t){t[t.NORTH=0]="NORTH",t[t.NORTH_EAST=1]="NORTH_EAST",t[t.EAST=2]="EAST",t[t.SOUTH_EAST=3]="SOUTH_EAST",t[t.SOUTH=4]="SOUTH",t[t.SOUTH_WEST=5]="SOUTH_WEST",t[t.WEST=6]="WEST",t[t.NORTH_WEST=7]="NORTH_WEST"}(ht||(ht={}));const IT=O(),pmt=O(),Ym=O(),Zm=O();function fmt(t,e,r=0){const i=t.extent;if(i==null)return!1;if(r===0)return Yye(i,e);const s=Math.min(i[2]-i[0],i[3]-i[1]);return M8e(i,e,r*s)}function AL(t,e,r,i){ie(IT,r),IT[i]=e[i];const s=fe(IT,IT,e),n=fe(pmt,t,e),o=ye(n,s),a=ye(s,s);let l;l=o<=0?e:a<=o?r:de(IT,e,se(s,s,o/a));const c=fe(IT,t,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function mmt(t,e,r){const i=t.extent;if(i==null)return 0;Ym[0]=i[0],Ym[1]=i[1],Ym[2]=r,Zm[0]=i[2],Zm[1]=i[3],Zm[2]=r;let s=1/0,n=1/0;return e[0]<Ym[0]?s=AL(e,Ym,Zm,0):e[0]>Zm[0]&&(s=AL(e,Zm,Ym,0)),e[1]<Ym[1]?n=AL(e,Ym,Zm,1):e[1]>Zm[1]&&(n=AL(e,Zm,Ym,1)),Math.min(s,n)}function gmt(t,e,r){if(t==null)return kJ();if(t.spatialReference.isGeographic&&!pv(t.spatialReference))return new U("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const i=Tc.checkUnsupported(t);if(i!=null)return i;if(r==null)return new U("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const s=ymt(t,r);if(s)return s;const n=t.spatialReference;return e==null||n.equals(e)||e.isWGS84&&n.isWebMercator?null:new U("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")}function ymt(t,e){const r=t.lods,i=r[0].resolution*2**r[0].level,s=[i*t.size[0],i*t.size[1]],n=[t.origin.x,t.origin.y],o=Wye(e),a=zt();Tc.computeRowColExtent(o,s,n,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>cS){const c=r[0].scale*2**r[0].level;let h=Math.max((o[3]-o[1])/t.size[1],(o[2]-o[0])/t.size[0])*c/i;const d=Math.floor(Math.log(h)/Math.log(10));return h=Math.ceil(h/10**d)*10**d,new U("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+h.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:h,requiredNumRootTiles:l,allowedNumRootTiles:cS})}return null}const _mt=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:gmt,isInsideExtent:fmt,tiltToExtentEdge:mmt},Symbol.toStringTag,{value:"Module"}));function vmt(){return!0}function bmt(){return 0}function wmt(t,e){if(t==null)return kJ();const r=t.lods.length-1,i=t.spatialReference,s=pv(i)||Om(i)||Rm(i);if(i.isWebMercator){if(!Tc.makeWebMercatorAuxiliarySphere(r).compatibleWith(t))return new U("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!s)return new U("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!Tc.makeGCSWithTileSize(t.spatialReference,t.size[0],r).compatibleWith(t))return t.spatialReference.isWGS84?new U("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new U("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return e==null||t.spatialReference.equals(e)?void 0:new U("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}const xmt=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:wmt,isInsideExtent:vmt,tiltToExtentEdge:bmt},Symbol.toStringTag,{value:"Module"})),Tmt={[Ve.Global]:xmt,[Ve.Local]:_mt};function Nf(t,e){t||console.warn("Terrain: "+e)}let dn=!1,DF=!1;function Smt(t){DF=t,dn=dn||t}function Emt(t){dn=t}function Ee(t,e){if(dn&&!t){const r=new Error().stack?.slice(5);throw console.warn("Terrain internal: "+(e??"")+" at "+r),new Error("Assertion failed"+(e?": "+e:""))}}function Gq(t){return B9(t)?{fullExtent:t.fullExtent,minScale:t.layer.minScale,maxScale:t.layer.maxScale,tilemapCache:null}:t.layer}function NF(t){return t?.type==="imagery-tile"||t?.type==="wcs"}function B9(t){return t?.type==="imagery-tile-3d"}function mee(t){return t?.type==="tile-3d"}function GM(t){return t?.type==="vector-tile-3d"}function BOe(t){return t?.type==="wmts-3d"}function jq(t){return t?.type==="elevation-3d"}function j3(t){return t?.type==="group"}function FF(t){return t&&(mee(t)||BOe(t)||B9(t)||GM(t))}function Hq(t){return t&&(mee(t)||B9(t)||GM(t)||BOe(t))}function jM(t){return Hq(t)||jq(t)}function Cmt(t){const e=t?.sourceLayerInfo?.data;return e!=null&&"type"in e&&e.type==="raster-tile"}function GOe(t){return jOe(t?.sourceLayerInfo)}function Amt(t){const e=t?.sourceLayerInfo?.data;return e!=null&&"type"in e&&e.type==="tile-texture"}function Omt(t){const e=t?.sourceLayerInfo?.data;return e instanceof HTMLImageElement||e instanceof V9||e instanceof HTMLCanvasElement||e instanceof ImageData}function jOe(t){return t?.data!=null&&"type"in t.data&&t.data.type==="vector-tile"}function qS(t){return t!=null&&"release"in t&&t.release(),null}function fue(t){return t.fetchTile&&t.hasOverriddenFetchTile!==!1}function gee(t,e,r,i){return Tmt[i].checkIfTileInfoSupportedForViewSR(t,r,e)}function G9(t,e,r){let i=null,s=null;if(t?.type==="wmts"){const n=Rmt(t,e,r);i=n.tileInfo,s=n.fullExtent}else{s=NF(t)?t.getCompatibleFullExtent(e):t.fullExtent;const n=r===Ve.Local;if(NF(t))i=t.getCompatibleTileInfo(e,s,n);else if(t?.type==="vector-tile"){const o=n&&!Mmt(e)||Pmt.force512VTL,a=t.tileInfo.spatialReference.isGeographic;i=o?t.tileInfo:t.tileInfo.getOrCreateCompatible(256,a?1:2)}else i=t.tileInfo}return i!=null&&s!=null&&gee(i,s,e,r)==null?{tileInfo:i,fullExtent:s}:null}function Rmt(t,e,r){const i=KFe(t);if(i!=null){if(!Pt.isCollection(i))return{tileInfo:i.tileInfo,fullExtent:i.fullExtent};{const s=i.find(n=>gee(n.tileInfo,n.fullExtent,e,r)==null);if(s)return{tileInfo:s.tileInfo,fullExtent:s.fullExtent}}}return{tileInfo:null,fullExtent:null}}function Mmt(t){return t.isWGS84||t.isWebMercator||H0e(t)||!rM(t)}const Pmt={force512VTL:!1};function mue(t){return"["+t[0]+","+t[1]+","+t[2]+"]"}function Jm(t){return"("+t[0]+","+t[1]+","+t[2]+")"}function Mh(t,e,r=Lmt){return Math.abs(t-e)<r}function UF(t){return t===ht.NORTH_EAST?ht.SOUTH_WEST:t===ht.NORTH_WEST?ht.SOUTH_EAST:t===ht.SOUTH_WEST?ht.NORTH_EAST:ht.NORTH_WEST}function kF(t){return t===ht.NORTH?ht.SOUTH:t===ht.EAST?ht.WEST:t===ht.SOUTH?ht.NORTH:ht.EAST}function Imt(t){return t===ht.NORTH_WEST||t===ht.SOUTH_WEST}function $mt(t){return t===ht.NORTH_WEST||t===ht.NORTH_EAST}function gue(t){return t===ht.NORTH_WEST||t===ht.WEST||t===ht.SOUTH_WEST}function yue(t){return t===ht.NORTH_EAST||t===ht.EAST||t===ht.SOUTH_EAST}function _ue(t){return t===ht.SOUTH_EAST||t===ht.SOUTH||t===ht.SOUTH_WEST}function vue(t){return t===ht.NORTH_EAST||t===ht.NORTH||t===ht.NORTH_WEST}const Yf=[ht.NORTH,ht.EAST,ht.SOUTH,ht.WEST],HM=[ht.NORTH_EAST,ht.SOUTH_EAST,ht.SOUTH_WEST,ht.NORTH_WEST],Lmt=1e-5;let Dmt=class{constructor(e,r){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=e.layer,this.memory=jM(e)?r.basemapTerrain.getUsedMemoryForLayerView(e):e.usedMemory,dmt(e)){const i=e.performanceInfo;this.displayedNumberOfFeatures=i.displayedNumberOfFeatures,this.maximumNumberOfFeatures=i.maximumNumberOfFeatures,this.totalNumberOfFeatures=i.totalNumberOfFeatures}}},Nmt=class{constructor(e){if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,e.resourceController!=null){const i=e.resourceController.memoryController;this.totalMemory=(i.maxMemory??0)*R5.MEGABYTES,this.usedMemory=Math.round(i.usedMemory*this.totalMemory),this.quality=i.memoryFactor,this.load=e.resourceController.scheduler.load}this.terrainMemory=e.basemapTerrain?.usedMemory??0;const r=e._stage&&e._stage.renderView&&e._stage.renderer.edgeView;this.edgesMemory=r!=null?r.usedMemory:0,e.allLayerViews.items.forEach(i=>{(hmt(i)||jM(i))&&this.layerPerformanceInfos.push(new Dmt(i,e))}),this.layerPerformanceInfos.sort((i,s)=>s.memory-i.memory)}},Fmt=class{constructor(e){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=e("gltf-resources",()=>{}),this._wosrMemCache=e("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(e=>e.abortController.abort()),this._wosrLoading.forEach(e=>e.abortController.abort()),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(e,r,i){const s=i?`gltfPBR:${e}`:`gltf:${e}`,n=this._gltfMemCache.get(s);return n!=null?Promise.resolve(n):this._loadOnce(this._gltfLoading,this._gltfMemCache,s,o=>jAe(new BAe(o.streamDataRequester),e,o,i),r)}loadWOSR(e,r){const i=`wosr:${e}:${r.disableTextures}`,s=this._wosrMemCache.get(i);return s!=null?Promise.resolve(s):this._loadOnce(this._wosrLoading,this._wosrMemCache,i,n=>HAe(e,n),r)}async _loadOnce(e,r,i,s,n){Yt(n);const o=ya(n,()=>this._abortLoad(e,i));let a=e.get(i);if(a)a.refCount++;else{const l=new AbortController;a={refCount:1,abortController:l,promise:s({...n,signal:l.signal})},e.set(i,a)}try{const l=await a.promise;return r.put(i,l,l.size),e.delete(i),Yt(n),l}finally{Fi(o)}}_abortLoad(e,r){const i=e.get(r);i!=null&&--i.refCount>0||(e.delete(r),i?.abortController.abort())}},Umt=class extends uS{constructor(e,r,i){super(r,i),this._streamDataRequester=e}async fromUrl(e,r,i){Yt(i);const s=i!=null?i.signal:null,n=this.makeUid(e,r);let o=this._textureRequests.get(n);if(!o){const a=new AbortController,l=this._streamDataRequester.request(e,"image",{uid:n,signal:a.signal});o=new Vwe,o.abortController=a;const c=o;this._textureRequests.set(n,o),o.textureAsync=l.then(async h=>{const d=this._createTexture(e,h,r);return c.texture=d,c.abortController=null,this._stage.add(d),await this._stage.load(d),{uid:n,texture:d,release:()=>this._release(n)}},h=>{throw c.abortController=null,h})}o.referenceCount++;try{return await $ge(o.textureAsync,s)}catch(a){throw this._release(n),a}}_createTexture(e,r,i){const s={width:r.width,height:r.height,wrap:{s:Dt.CLAMP_TO_EDGE,t:Dt.CLAMP_TO_EDGE},preMultiplyAlpha:!0};if(k0e(e)){if(i||r.width===0&&r.height===0){const n=r.width?r.height/r.width:1;i=i||64,n>1?(r.width=Math.round(i/n),r.height=i):(r.width=i,r.height=Math.round(i*n))}this._stage.renderView?.renderingContext.driverTest.svgPremultipliesAlpha.result&&(s.preMultiplyAlpha=!1)}return new Nx(r,s)}},kmt=class{constructor(e){this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=e.viewState,this._view=e.view,this._pointsOfInterest=e.pointsOfInterest,this.streamDataRequester=e.resourceController.createStreamDataRequester(Gf.SYMBOLOGY),this.objectResourceCache=new Fmt((i,s)=>e.resourceController.memoryController.newCache(i,s)),this.textures=new Umt(this.streamDataRequester,e.view._stage,e.resourceController.scheduler);const r=Vr(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=_Se(e.viewingMode,r),this.screenSizePerspectiveSettingsLabels=Vet(e.viewingMode,r)}destroy(){this.textures.destroy(),this.streamDataRequester=null}addGraphicsOwner(e){if(!e)return nl();this._graphicsOwners.push(e);const r=le(()=>e.layer?.screenSizePerspectiveEnabled,()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),nl(()=>{r.remove(),JR(this._graphicsOwners,e),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const e=this._graphicsOwners.some(r=>r.layer?.screenSizePerspectiveEnabled===!0);if(e&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new $i;const r=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([le(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,r,Wr),this._viewState.events.on("camera-projection-changed",r)]),this._updateScreenSizePerspectiveSettings()}else e||(this._screenSizePerspectiveHandles=Ne(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){const e=this._pointsOfInterest;OL.distance=e.centerOnSurfaceInfrequent.distance,OL.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(OL),this.screenSizePerspectiveSettingsLabels.update(OL),this._view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this._screenSizePerspectiveHandles}}};const OL={distance:0,fovY:0};let P2=class{constructor(e,r,i=""){this.graphics=e,this._symbol=new qf({symbolLayers:[new Hf({material:{color:r},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new Pv({text:i,halo:{color:"white",size:1/.75},material:{color:r},size:12})]})}show(e,r){if(r==null)return;this.hide();const i=new tt({x:e[0],y:e[1],z:e[2],spatialReference:r});this._graphic=new Bl({geometry:i,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){this._graphic!=null&&(this.graphics.remove(this._graphic),this._graphic=null)}},R_=class extends Te{constructor(e){super(e),this.handles=new $i}destroy(){this.handles.destroy()}};u([p({constructOnly:!0})],R_.prototype,"renderCoordsHelper",void 0),u([p({constructOnly:!0})],R_.prototype,"surface",void 0),u([p({constructOnly:!0})],R_.prototype,"state",void 0),R_=u([P("esri.views.3d.support.PointOfInterest")],R_);const zmt=Array;let Dd=class extends R_{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new x0({location:tt,renderLocation:zmt},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.renderLocation=O(),this._tmpPoint=new tt}initialize(){if(this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.handles.add(_a(()=>this.map?.ground?.layers,"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=Ne(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get scale(){const e=this._camera,r=mi(e.eye,this.renderLocation),i={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return Jw(i,r,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map||!this.map.ground)return this._updateSurfaceAltitude(0),Zo.YIELD;const e=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint,e);const r=(this._tmpPoint.z??0)>Vmt&&this.renderCoordsHelper.viewingMode===Ve.Global&&(e.isWGS84||e.isWebMercator);let i=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:i.signal,cache:this.cache,minDemResolution:r?Bmt:0}).then(s=>this._updateSurfaceAltitude(s.geometry.z??0)).catch(s=>{ds(s)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===i&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),i=null}),this._pendingElevationQueryController=i,Zo.YIELD}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(cV,this._estimatedSurfaceAltitude,this._camera.eye),ma(this._get("renderLocation"),cV)||(this._set("renderLocation",ie(this._propertiesPool.get("renderLocation"),cV)),this.notifyChange("renderLocation"))}};u([p({constructOnly:!0})],Dd.prototype,"scheduler",void 0),u([p({constructOnly:!0})],Dd.prototype,"cache",void 0),u([p({constructOnly:!0})],Dd.prototype,"task",void 0),u([p({readOnly:!0})],Dd.prototype,"location",null),u([p({constructOnly:!0})],Dd.prototype,"map",void 0),u([p({readOnly:!0})],Dd.prototype,"renderLocation",void 0),u([p({readOnly:!0})],Dd.prototype,"scale",null),u([p({readOnly:!0})],Dd.prototype,"updating",null),Dd=u([P("esri.views.3d.support.CameraOnSurface")],Dd);const cV=O(),Vmt=1e5,Bmt=1e6,Gmt=Array;let _h=class extends R_{constructor(e){super(e),this._propertiesPool=new x0({location:tt,renderLocation:Gmt},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=O(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=Fi(this._frameWorker),this._propertiesPool=Ne(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,Zo.YIELD}_updateRenderLocation(){const e=Hmt;let r=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const i=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!r&&i&&(r=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),r&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const s=qmt;r&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,s)&&(ie(e,s),this._currentSurfaceAltitude=this._latestSurfaceAltitude),r?this.distance=mi(this._camera.eye,e):(se(e,this._camera.viewForward,this._get("distance")),de(e,e,this._camera.eye)),ma(this._get("renderLocation"),e)||this._set("renderLocation",ie(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,r){const i=this._camera;if(!this.renderCoordsHelper.intersectManifold(i.ray,e,r))return!1;if(this.state.isGlobal){const s=Vr(this.renderCoordsHelper.spatialReference).radius,n=s+e,o=da(i.eye),a=o<n*n,l=mi(i.eye,r);if(a&&l>s/4){const c=n-Math.sqrt(o);return se(r,i.viewForward,c),de(r,r,i.eye),!0}}else{const s=this.surface?.ready?this.surface.extent:null;s!=null&&AP(s,this.surface?.spatialReference,H3,this.renderCoordsHelper.spatialReference)&&(r[0]=ve(r[0],H3[0],H3[2]),r[1]=ve(r[1],H3[1],H3[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,r){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,r)){if(li.TESTS_DISABLE_OPTIMIZATIONS)return!0;const i=this._camera.eye,s=mi(i,e),n=mi(i,r);if(Math.abs(n-s)/s>jmt)return!0}return!1}};u([p({constructOnly:!0})],_h.prototype,"scheduler",void 0),u([p({constructOnly:!0})],_h.prototype,"task",void 0),u([p()],_h.prototype,"distance",void 0),u([p({constructOnly:!0})],_h.prototype,"estimateSurfaceAltitudeAtCenter",void 0),u([p({readOnly:!0})],_h.prototype,"location",null),u([p({readOnly:!0})],_h.prototype,"renderLocation",void 0),u([p()],_h.prototype,"updating",void 0),_h=u([P("esri.views.3d.support.CenterOnSurface")],_h);const jmt=.05,Hmt=O(),qmt=O(),H3=zt();let Wmt=class{constructor(e){this._handles=new $i,this.events=new Ts,this._contentLayerViews=e.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",r=>this._layerViewsChanged(r))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=Ne(this._handles),this._contentLayerViews.destroy()}_layerViewsChanged(e){e.added.forEach(r=>{r.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this._handles.add(r.on("visible-geometry-changed",()=>this._contentChanged()),r.uid)}),e.removed.forEach(r=>this._handles.remove(r.uid))}_contentChanged(){this.events.emit("request-update",Xmt)}};const Xmt={},Ymt=Array;let Ef=class extends R_{constructor(e){super(e),this._propertiesPool=new x0({location:tt,renderLocation:Ymt},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.handles.add([le(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),le(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.handles.add(this.scheduler.registerTask(vt.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=Ne(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),r=this.centerOnSurface.renderLocation,i=this.renderCoordsHelper,s=this.state.contentCamera;this._dirty=!1,i.worldUpAtPosition(r,bue);const n=Math.max(0,(Math.acos(ye(bue,s.viewForward))-.5*Math.PI)*(s.aboveGround?1:-1));if(Number.isNaN(n)){if(!e||!nv(e,r)){const c=this._propertiesPool.get("renderLocation");ie(c,r),this._set("renderLocation",c)}return Zo.YIELD}const o=1-ve(n/(.5*Math.PI),0,1),a=o*o*o;this._calculateScreenHorizontalEdgeOnSurface(wue);const l=this._propertiesPool.get("renderLocation");return qr(l,r,wue,a),e&&nv(e,l)||this._set("renderLocation",l),Zo.YIELD}_calculateScreenHorizontalEdgeOnSurface(e){const r=this.state.contentCamera,i=r.getRenderCenter(Wo());if(i[1]=r.aboveGround?r.padding[er.BOTTOM]:r.fullHeight-r.padding[er.TOP],this.estimateSurfaceIntersectionAtRenderPoint(i,e))return e;const s=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(r.unprojectFromRenderScreen(i,q3)){fe(q3,q3,r.eye);const n=_e(q3,q3);if(this.renderCoordsHelper.intersectManifold(Du(r.eye,n),s,e))return e}return this.renderCoordsHelper.setAltitude(e,s,r.eye)}updateRenderLocation(){this._dirty=!0}};u([p()],Ef.prototype,"_dirty",void 0),u([p({constructOnly:!0})],Ef.prototype,"scheduler",void 0),u([p({constructOnly:!0})],Ef.prototype,"centerOnSurface",void 0),u([p({constructOnly:!0})],Ef.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),u([p({readOnly:!0})],Ef.prototype,"updating",null),u([p({readOnly:!0})],Ef.prototype,"location",null),u([p({readOnly:!0})],Ef.prototype,"renderLocation",void 0),Ef=u([P("esri.views.3d.support.pointsOfInterest.Focus")],Ef);const bue=O(),q3=O(),wue=O();let _g=class extends Te{get surface(){return this.view.map?.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const e=O();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}constructor(e){super(e),this.location=null,this._updateController=null,this._handles=new $i}initialize(){this.view.state.isLocal&&(this._handles.add([le(()=>[this.surfaceView?.spatialReference,this.surfaceView?.extent],()=>this._update()),_a(()=>this.surface?.layers,"change",()=>this._update())]),this._update())}destroy(){this._handles.destroy()}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),!this.surfaceView||this.surfaceView.extent==null||this.surfaceView.spatialReference==null)return void this._set("location",null);const e=AZ(this.surfaceView.extent),r=new tt({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(r,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(i=>{this._updateController=null,this._set("location",i.geometry)}).catch(i=>{ds(i)||i&&i.name==="elevation-query:invalid-layer"||console.error("StableSurfaceCenter failed to update: ",i)})):this._set("location",r)}};u([p({constructOnly:!0})],_g.prototype,"view",void 0),u([p({constructOnly:!0})],_g.prototype,"cache",void 0),u([p()],_g.prototype,"surface",null),u([p()],_g.prototype,"surfaceView",null),u([p({readOnly:!0})],_g.prototype,"location",void 0),u([p({readOnly:!0})],_g.prototype,"renderLocation",null),_g=u([P("esri.views.3d.terrain.StableSurfaceCenter")],_g);let vg=class extends Te{constructor(e){super(e),this._tileGeometryUpdateExtent=Uc(),this._tileGeometryUpdateSpatialReference=null,this.events=new Ts,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(vt.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){return this.updating&&(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",Zmt),Uc(this._tileGeometryUpdateExtent),this._set("updating",!1)),Zo.YIELD}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,J_(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let r=1;r<this.centerOnSurfaces.length;r++){const i=this.centerOnSurfaces[r];i.distance>e.distance&&(e=i)}return e}_centerIntersectsExtent(e,r){const i=this.state.contentCamera.eye,s=Jmt,n=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(i,E1,r),this.renderCoordsHelper.fromRenderCoords(n.renderLocation,C1,r),E1[0]<C1[0]?(s[0]=E1[0],s[2]=C1[0]):(s[0]=C1[0],s[2]=E1[0]),E1[1]<C1[1]?(s[1]=E1[1],s[3]=C1[1]):(s[1]=C1[1],s[3]=E1[1]),yP(s,e)}};u([p({constructOnly:!0})],vg.prototype,"state",void 0),u([p({constructOnly:!0})],vg.prototype,"centerOnSurfaces",void 0),u([p({constructOnly:!0})],vg.prototype,"renderCoordsHelper",void 0),u([p({constructOnly:!0})],vg.prototype,"scheduler",void 0),u([p({constructOnly:!0})],vg.prototype,"surface",void 0),u([p({readOnly:!0})],vg.prototype,"updating",void 0),vg=u([P("esri.views.3d.support.SurfaceGeometryUpdates")],vg);const Zmt={},E1=O(),C1=O(),Jmt=Uc();let Al=class extends Te{constructor(e){super(e),this._handles=new $i,this._tmpRay=eo(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new x0({renderPointOfView:Qmt},this),this.renderPointOfView=O(),this._pois=new Array,this._debugCenters=new Map}initialize(){const{state:e,basemapTerrain:r,renderCoordsHelper:i,map:s}=this.view;this._surfaceIntersector=ed(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=So.MIN,this._contentIntersector=ed(e.viewingMode);const n=()=>this._estimateSurfaceAltitudeAtCenter(),o=this.view.resourceController.scheduler,a=this.view.basemapTerrain?.elevationQueryCache,l={state:e,scheduler:o,surface:r,renderCoordsHelper:i};this._set("centerOnSurfaceInfrequent",new _h({...l,task:vt.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnSurfaceFrequent",new _h({...l,task:vt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnContent",new _h({...l,task:vt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new Dd({...l,cache:a,task:vt.POINT_OF_INTEREST_INFREQUENT,map:s})),this._set("surfaceGeometryUpdates",new vg({...l,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new Wmt({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:i})),this._set("surfaceOrigin",new _g({cache:a,view:this.view})),this._set("focus",new Ef({state:e,scheduler:o,surface:r,renderCoordsHelper:i,centerOnSurface:this.centerOnSurfaceFrequent,estimateSurfaceIntersectionAtRenderPoint:(h,d)=>this._estimateSurfaceIntersectionAtRenderPoint(h,this.view.state.contentCamera,d)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);const c=this.view.graphics;this._debugCenters.set(this.centerOnContent,new P2(c,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new P2(c,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new P2(c,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new P2(c,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new P2(c,"green","Focus")),this._handles.add([le(()=>e.contentCamera,h=>this._cameraChanged(h),Wr),le(()=>r.extent,()=>this._updateCenterPointsOfInterest()),Iu(()=>!r.updating,()=>this._updateCenterPointsOfInterest(),Wr),_a(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),_a(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),Iu(()=>li.SHOW_POI,h=>this._setDebug(h),Pr)]),this._cameraChanged(this.view.state.contentCamera);for(const h of this._pois)h.runTask()}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){return!(!this.surfaceGeometryUpdates?.updating&&!this._pois.some(e=>e.updating))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this._centerRay;return e==null||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,$T,egt)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude($T):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this._centerRay;if(e==null)return this._surfaceAltitudeAtCenter;const r=e.origin,i=de($T,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.contentCamera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,r,i),this._surfaceIntersector.results.min.getIntersectionPoint($T)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude($T)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,r,i){const s=DQ(r,e,Kmt);if(s==null)return null;const n=s.origin,o=de($T,s.origin,s.direction);return this._surfaceIntersector.resetWithRay(s,r),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,n,o),this._surfaceIntersector.results.min.getIntersectionPoint(i)?i:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const r=e.eye;ma(this.renderPointOfView,r)||this._set("renderPointOfView",ie(this._propertiesPool.get("renderPointOfView"),r))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(r=>r.hide()),void this._handles.remove("debug");for(const r of this._pois)this._handles.add(le(()=>r.renderLocation,i=>this._debugCenters.get(r)?.show(i,r.renderCoordsHelper.spatialReference),Pr),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};u([p({readOnly:!0})],Al.prototype,"centerOnContent",void 0),u([p({readOnly:!0})],Al.prototype,"centerOnSurfaceFrequent",void 0),u([p({readOnly:!0})],Al.prototype,"centerOnSurfaceInfrequent",void 0),u([p({readOnly:!0})],Al.prototype,"cameraOnSurface",void 0),u([p({readOnly:!0})],Al.prototype,"focus",void 0),u([p({readOnly:!0})],Al.prototype,"renderPointOfView",void 0),u([p({readOnly:!0})],Al.prototype,"surfaceOrigin",void 0),u([p({readOnly:!0})],Al.prototype,"contentGeometryUpdates",void 0),u([p({readOnly:!0})],Al.prototype,"surfaceGeometryUpdates",void 0),u([p({constructOnly:!0})],Al.prototype,"view",void 0),u([p({readOnly:!0})],Al.prototype,"updating",null),Al=u([P("esri.views.3d.support.PointsOfInterest")],Al);const Qmt=Array,$T=O(),Kmt=eo(),egt={exclude:new Set([E_])},qM=new Pt,BR=new WeakMap;function tgt(t){HOe(t)&&qM.push(t)}function rgt(t){HOe(t)&&qM.includes(t)&&qM.remove(t)}function HOe(t){return t!=null&&typeof t=="object"&&"refreshInterval"in t&&"refresh"in t}function qOe(t,e){return Number.isFinite(t)&&Number.isFinite(e)?e<=0?t:qOe(e,t%e):0}let uV=0,RL=0;function igt(){const t=Date.now();for(const e of qM)e.refreshInterval&&t-(BR.get(e)??0)+5>=6e4*e.refreshInterval&&(BR.set(e,t),e.refresh(t))}Yge(()=>{const t=Date.now();let e=0;for(const r of qM)e=qOe(Math.round(6e4*r.refreshInterval),e),r.refreshInterval?BR.get(r)||BR.set(r,t):BR.delete(r);if(e!==RL){if(RL=e,clearInterval(uV),RL===0)return void(uV=0);uV=setInterval(igt,RL)}});function sgt(t){return t!=null&&typeof t=="object"&&"refreshTimestamp"in t&&"refresh"in t}const ngt=t=>{let e=class extends t{constructor(...r){super(...r),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=MY(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||tgt(this)},()=>{})}destroy(){rgt(this)}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(r=Date.now()){V7(this._debounceHasDataChanged()).then(i=>{i&&this._set("refreshTimestamp",r),this.emit("refresh",{dataChanged:i})},i=>{K.getLogger(this).error(i),this.emit("refresh",{dataChanged:!1,error:i})})}async hasDataChanged(){return!0}};return u([p({type:Number,cast:r=>r>=.1?r:r<=0?0:.1,json:{write:!0}})],e.prototype,"refreshInterval",void 0),u([p({readOnly:!0})],e.prototype,"refreshTimestamp",void 0),u([p()],e.prototype,"refreshParameters",null),e=u([P("esri.layers.mixins.RefreshableLayer")],e),e};let ogt=class{constructor(e){this._store=e}destroy(){this._store.destroy()}get(e){return this._store.get(e)}put(e,r){this._store.put(e,r,r.values.byteLength+256)}},agt=class{constructor(e,r,i,s){this._hasNoDataValues=null,this._minValue=null,this._maxValue=null,"pixelData"in e?(this.values=e.pixelData,this.width=e.width,this.height=e.height,this.noDataValue=e.noDataValue):(this.values=e,this.width=r,this.height=i,this.noDataValue=s)}get hasNoDataValues(){if(this._hasNoDataValues==null){const e=this.noDataValue;this._hasNoDataValues=this.values.includes(e)}return this._hasNoDataValues}get minValue(){return this._ensureBounds(),this._minValue}get maxValue(){return this._ensureBounds(),this._maxValue}_ensureBounds(){if(this._minValue!=null)return;const{noDataValue:e,values:r}=this;let i=1/0,s=-1/0,n=!0;for(const o of r)o===e?this._hasNoDataValues=!0:(i=o<i?o:i,s=o>s?o:s,n=!1);n?(this._minValue=0,this._maxValue=0):(this._minValue=i,this._maxValue=s>-3e38?s:0)}},WOe=class{constructor(e,r,i,s,n={}){this._mainMethod=r,this._transferLists=i,this._listeners=[],this._promise=A1e(e,{...n,schedule:s}).then(o=>{if(this._thread===void 0){this._thread=o,this._promise=null,n.hasInitialize&&this.broadcast({},"initialize");for(const a of this._listeners)this._connectListener(a)}else o.close()}),this._promise.catch(o=>K.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${e} worker: ${o}`))}on(e,r){const i={removed:!1,eventName:e,callback:r,threadHandle:null};return this._listeners.push(i),this._connectListener(i),nl(()=>{i.removed=!0,EY(this._listeners,i),this._thread&&i.threadHandle!=null&&i.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null,this._listeners.length=0,this._transferLists={}}invoke(e,r){return this.invokeMethod(this._mainMethod,e,r)}invokeMethod(e,r,i){if(this._thread){const s=this._transferLists[e],n=s?s(r):[];return this._thread.invoke(e,r,{transferList:n,signal:i})}return this._promise?this._promise.then(()=>(Yt(i),this.invokeMethod(e,r,i))):Promise.reject(null)}broadcast(e,r){return this._thread?Promise.all(this._thread.broadcast(r,e)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(e,r)):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then(r=>{e.removed||(e.threadHandle=r)})}},xue=class extends WOe{constructor(e=null){super("LercWorker","_decode",{_decode:r=>[r.buffer]},e,{strategy:"dedicated"}),this.schedule=e,this.ref=0}decode(e,r,i){return e&&e.byteLength!==0?this.invoke({buffer:e,options:r},i):Promise.resolve(null)}release(){--this.ref<=0&&(GR.forEach((e,r)=>{e===this&&GR.delete(r)}),this.destroy())}};const GR=new Map;function lgt(t=null){let e=GR.get(t);return e||(t!=null?(e=new xue(r=>t.immediate.schedule(r)),GR.set(t,e)):(e=new xue,GR.set(null,e))),++e.ref,e}var wc,Tue,Sue;(function(t){t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(wc||(wc={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.OUTLINE=2]="OUTLINE",t[t.LINE=3]="LINE",t[t.ICON=4]="ICON",t[t.CIRCLE=5]="CIRCLE",t[t.TEXT=6]="TEXT",t[t.TILEINFO=7]="TILEINFO"}(Tue||(Tue={})),function(t){t[t.PAINTER_CHANGED=0]="PAINTER_CHANGED",t[t.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",t[t.LAYER_CHANGED=2]="LAYER_CHANGED",t[t.LAYER_REMOVED=3]="LAYER_REMOVED",t[t.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(Sue||(Sue={}));let cgt=class{constructor(e){this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}},xjt=class{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}};function Sjt(t,e,r,i,s,n){const o=r-s;if(o>=0)return(e>>o)+(i-(n<<o))*(t>>o);const a=-o;return e-(n-(i<<a))*(t>>a)<<a}let Ejt=class{constructor(e,r,i){this._rows=Math.ceil(r/i),this._columns=Math.ceil(e/i),this._cellSize=i,this.cells=new Array(this._rows);for(let s=0;s<this._rows;s++){this.cells[s]=new Array(this._columns);for(let n=0;n<this._columns;n++)this.cells[s][n]=[]}}getCell(e,r){const i=Math.min(Math.max(Math.floor(r/this._cellSize),0),this._rows-1),s=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[i]&&this.cells[i][s]||null}getCellSpan(e,r,i,s){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}};function ugt(t,e,r,i,s,n){const o=e[i++];for(let a=0;a<o;a++){const l=new cgt(n);l.xTile=e[i++],l.yTile=e[i++],l.hash=e[i++],l.priority=e[i++];const c=e[i++];for(let f=0;f<c;f++){const m=e[i++],g=e[i++],_=e[i++],v=e[i++],b=!!e[i++],T=e[i++],x=r[i++],S=r[i++],E=e[i++],A=e[i++];l.colliders.push({xTile:m,yTile:g,dxPixels:_,dyPixels:v,hard:b,partIndex:T,width:E,height:A,minLod:x,maxLod:S})}const h=t[i++];for(let f=0;f<h;f++)l.textVertexRanges.push([t[i++],t[i++]]);const d=t[i++];for(let f=0;f<d;f++)l.iconVertexRanges.push([t[i++],t[i++]]);s.push(l)}return i}function Ajt(t,e,r){for(const[i,s]of t.symbols)hgt(t,e,r,s,i)}function hgt(t,e,r,i,s){const n=t.layerData.get(s);if(n.type===wc.SYMBOL){for(const o of i){const a=o.unique;let l;if(o.selectedForRendering){const c=a.parts[0],h=c.startOpacity,d=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&d===0;const f=r?Math.floor(127*h)|d<<7:d?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.iconVertexRanges)for(let d=c;d<c+h;d+=4)n.iconOpacity[d/4]=l;if(o.selectedForRendering){const c=a.parts[1],h=c.startOpacity,d=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&d===0;const f=r?Math.floor(127*h)|d<<7:d?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.textVertexRanges)for(let d=c;d<c+h;d+=4)n.textOpacity[d/4]=l}n.lastOpacityUpdate=e,n.opacityChanged=!0}}let j9=class{constructor(e,r){this.layerUIDs=[],this.isDestroyed=!1,this._data=e;let i=1;const s=new Uint32Array(e);this.layerUIDs=[];const n=s[i++];for(let o=0;o<n;o++)this.layerUIDs[o]=s[i++];this.bufferDataOffset=i,r&&(this.layer=r.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return this._data==null}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}prepareForRendering(e){this._data!=null&&(this.doPrepareForRendering(e,this._data,this.bufferDataOffset),this._data=null)}},dgt=class extends j9{constructor(e,r){super(e,r),this.type=wc.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const i=new Uint32Array(e);let s=this.bufferDataOffset;this.lineIndexStart=i[s++],this.lineIndexCount=i[s++];const n=i[s++];if(n>0){this.patternMap=new Map;for(let o=0;o<n;o++){const a=i[s++],l=i[s++],c=i[s++];this.patternMap.set(a,[l,c])}}this.bufferDataOffset=s}get memoryUsed(){return(this.data?.byteLength??0)+(this.vao?.memoryEstimate??0)}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.vao=je(this.vao)}doPrepareForRendering(e,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++],a=kr.createVertex(e,Cr.STATIC_DRAW,new Int32Array(n.buffer,4*i,o));i+=o;const l=s[i++],c=kr.createIndex(e,Cr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,l));i+=l;const h=this.layer.lineMaterial;this.vao=new Zh(e,h.getAttributeLocations(),h.getLayoutInfo(),{geometry:a},c)}},pgt=class extends j9{constructor(e,r){super(e,r),this.type=wc.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const i=new Uint32Array(e);let s=this.bufferDataOffset;this.fillIndexStart=i[s++],this.fillIndexCount=i[s++],this.outlineIndexStart=i[s++],this.outlineIndexCount=i[s++];const n=i[s++];if(n>0){this.patternMap=new Map;for(let o=0;o<n;o++){const a=i[s++],l=i[s++],c=i[s++];this.patternMap.set(a,[l,c])}}this.bufferDataOffset=s}get memoryUsed(){return(this.data?.byteLength??0)+(this.fillVAO?.memoryEstimate??0)+(this.outlineVAO?.memoryEstimate??0)}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVAO=je(this.fillVAO),this.outlineVAO=je(this.outlineVAO)}doPrepareForRendering(e,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++],a=kr.createVertex(e,Cr.STATIC_DRAW,new Int32Array(n.buffer,4*i,o));i+=o;const l=s[i++],c=kr.createIndex(e,Cr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,l));i+=l;const h=s[i++],d=kr.createVertex(e,Cr.STATIC_DRAW,new Int32Array(n.buffer,4*i,h));i+=h;const f=s[i++],m=kr.createIndex(e,Cr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,f));i+=f;const g=this.layer,_=g.fillMaterial,v=g.outlineMaterial;this.fillVAO=new Zh(e,_.getAttributeLocations(),_.getLayoutInfo(),{geometry:a},c),this.outlineVAO=new Zh(e,v.getAttributeLocations(),v.getLayoutInfo(),{geometry:d},m)}},fgt=class extends j9{constructor(e,r,i){super(e,r),this.type=wc.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const s=new Uint32Array(e),n=new Int32Array(e),o=new Float32Array(e);let a=this.bufferDataOffset;this.isIconSDF=!!s[a++];const l=s[a++];for(let f=0;f<l;f++){const m=s[a++],g=s[a++],_=s[a++];this.iconPerPageElementsMap.set(m,[g,_])}const c=s[a++];for(let f=0;f<c;f++){const m=s[a++],g=s[a++],_=s[a++];this.glyphPerPageElementsMap.set(m,[g,_])}const h=s[a++],d=s[a++];this.iconOpacity=new Int32Array(h),this.textOpacity=new Int32Array(d),a=ugt(s,n,o,a,this.symbols,i),this.bufferDataOffset=a}get memoryUsed(){return(this.data?.byteLength??0)+(this.iconVAO?.memoryEstimate??0)+(this.textVAO?.memoryEstimate??0)+$_(this.iconOpacity)+$_(this.textOpacity)}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let e=0;for(const[r,i]of this.iconPerPageElementsMap)e+=i[1];for(const[r,i]of this.glyphPerPageElementsMap)e+=i[1];return e/3}doDestroy(){this.iconVAO=je(this.iconVAO),this.textVAO=je(this.textVAO)}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const e=this.iconOpacity,r=this.iconVAO.vertexBuffers.opacity;e.length>0&&e.byteLength===r.byteLength&&r.setSubData(e,0,0,e.length);const i=this.textOpacity,s=this.textVAO.vertexBuffers.opacity;i.length>0&&i.byteLength===s.byteLength&&s.setSubData(i,0,0,i.length)}doPrepareForRendering(e,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++],a=kr.createVertex(e,Cr.STATIC_DRAW,new Int32Array(n.buffer,4*i,o));i+=o;const l=s[i++],c=kr.createIndex(e,Cr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,l));i+=l;const h=s[i++],d=kr.createVertex(e,Cr.STATIC_DRAW,new Int32Array(n.buffer,4*i,h));i+=h;const f=s[i++],m=kr.createIndex(e,Cr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,f));i+=f;const g=kr.createVertex(e,Cr.STATIC_DRAW,this.iconOpacity.buffer),_=kr.createVertex(e,Cr.STATIC_DRAW,this.textOpacity.buffer),v=this.layer,b=v.iconMaterial,T=v.textMaterial;this.iconVAO=new Zh(e,b.getAttributeLocations(),b.getLayoutInfo(),{geometry:a,opacity:g},c),this.textVAO=new Zh(e,T.getAttributeLocations(),T.getLayoutInfo(),{geometry:d,opacity:_},m)}},mgt=class extends j9{constructor(e,r){super(e,r),this.type=wc.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const i=new Uint32Array(e);let s=this.bufferDataOffset;this.circleIndexStart=i[s++],this.circleIndexCount=i[s++],this.bufferDataOffset=s}get memoryUsed(){return(this.data?.byteLength??0)+(this.vao?.memoryEstimate??0)}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.vao=je(this.vao)}doPrepareForRendering(e,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++],a=kr.createVertex(e,Cr.STATIC_DRAW,new Int32Array(n.buffer,4*i,o));i+=o;const l=s[i++],c=kr.createIndex(e,Cr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,l));i+=l;const h=this.layer.circleMaterial;this.vao=new Zh(e,h.getAttributeLocations(),h.getLayoutInfo(),{geometry:a},c)}};const $jt=!0,Ljt=32,Eue=200,ggt=1/ae("mapview-transitions-duration");let ygt=class extends Ts{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}get stage(){return this._stage}set stage(e){if(this._stage===e)return;const r=this._stage;this._stage=e,e?this._stage?.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):r?.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return this._transforms==null&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.requestRender())}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.opacity=1,this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=Eo(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=Eo(),this.requestRender()),this._fadeOutResolver.promise}endTransitions(){this._fadeInResolver?.(),this._fadeInResolver=null,this._fadeOutResolver?.(),this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0,this.requestRender()}beforeRender(e){this.updateTransitionProperties(e.deltaTime,e.state.scale)}afterRender(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){this.parent?.removeChild(this)}setTransform(e){}processRender(e){this.stage&&this.computedVisible&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(e,r){if(this.fadeTransitionEnabled){const i=this._fadeOutResolver||!this.visible?0:this.opacity,s=this.computedOpacity;if(s===i)this.computedVisible=this.visible;else{const n=e*ggt;this.computedOpacity=s>i?Math.max(i,s-n):Math.min(i,s+n),this.computedVisible=this.computedOpacity>0;const o=i===this.computedOpacity;this.inFadeTransition=!o,o||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}},qq=class db{static getId(e,r,i,s){return typeof e=="object"?`${e.level}/${e.row}/${e.col}/${e.world}`:`${e}/${r}/${i}/${s}`}constructor(e,r,i,s){this.set(e,r,i,s)}get key(){return this}get id(){return this.toString()}set id(e){this.set(e)}get hash(){const e=4095&this.row,r=4095&this.col,i=63&this.level;return(3&this.world)<<30|r<<22|e<<8|i}acquire(e,r,i,s){this.set(e,r,i,s)}contains(e){const r=e.level-this.level;return r>=0&&this.row===e.row>>r&&this.col===e.col>>r&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new db(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,r,i,s){if(e==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof e=="object")this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if(typeof e=="string"){const[n,o,a,l]=e.split("/");this.level=parseFloat(n),this.row=parseFloat(o),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+e,this.row=+r,this.col=+i,this.world=+s||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new db(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const e=this.level+1,r=this.row<<1,i=this.col<<1,s=this.world;return[new db(e,r,i,s),new db(e,r,i+1,s),new db(e,r+1,i,s),new db(e,r+1,i+1,s)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}};qq.pool=new qo(qq,null,null,25,50);let _gt=class extends ygt{constructor(e,r,i,s,n,o,a=n,l=o){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new qq(e),this.resolution=r,this.x=i,this.y=s,this.width=n,this.height=o,this.rangeX=a,this.rangeY=l}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(e){const r=this.resolution/(e.resolution*e.pixelRatio),i=this.transforms.tileMat3,[s,n]=e.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*r,a=this.height/this.rangeY*r;rQ(i,o,0,0,0,a,0,s,n,1),UE(this.transforms.dvs,e.displayViewMat3,i)}},hV=class XOe extends _gt{constructor(e,r,i,s,n,o,a,l=null){super(e,r,i,s,n,o,4096,4096),this.styleRepository=a,this._memCache=l,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.layerCount=0,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.invalidating=!1,this.parentTile=null,this.childrenTiles=new Set,this._processed=!1,this._referenced=1,this.id=e.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<Eue}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<Eue)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}deleteLayerData(e){let r=!1;for(const i of e)if(this.layerData.has(i)){const s=this.layerData.get(i);this._memoryUsedByLayerData-=s.memoryUsed,s.type===wc.SYMBOL&&this.symbols.has(i)&&(this.symbols.delete(i),r=!0),s.destroy(),this.layerData.delete(i),this.layerCount--}this._memCache?.updateSize(this.key.id,this,this._memoryUsedByLayerData),r&&this.emit("symbols-changed"),this.requestRender()}processed(){return this._processed}hasData(){return this.layerCount>0}dispose(){this.status!=="unloaded"&&(YOe.delete(this),XOe._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsed(){return this._memoryUsedByLayerData+256}changeDataImpl(e){let r=!1;if(e){const{bucketsWithData:i,emptyBuckets:s}=e,n=this._createRenderBuckets(i);if(s&&s.byteLength>0){const o=new Uint32Array(s);for(const a of o)this._deleteLayerData(a)}for(const[o,a]of n)this._deleteLayerData(o),a.type===wc.SYMBOL&&(this.symbols.set(o,a.symbols),r=!0),this._memoryUsedByLayerData+=a.memoryUsed,this.layerData.set(o,a),this.layerCount++;this._memCache?.updateSize(this.key.id,this,this.memoryUsed)}this._hasSymbolBuckets=!1;for(const[i,s]of this.layerData)s.type===wc.SYMBOL&&(this._hasSymbolBuckets=!0);r&&this.emit("symbols-changed")}attachWithContext(e){this.stage={context:e,trashDisplayObject(r){r.processDetach()},untrashDisplayObject:()=>!1}}setTransform(e){super.setTransform(e);const r=this.resolution/(e.resolution*e.pixelRatio),i=this.width/this.rangeX*r,s=this.height/this.rangeY*r,n=[0,0];e.toScreen(n,[this.x,this.y]);const o=this.transforms.tileUnitsToPixels;iQ(o),z5(o,o,n),sQ(o,o,Math.PI*e.rotation/180),nQ(o,o,[i,s,1])}_createTransforms(){return{dvs:kl(),tileMat3:kl(),tileUnitsToPixels:kl()}}static _destroyRenderBuckets(e){if(!e)return;const r=new Set;e.forEach(i=>{r.has(i)||(i.destroy(),r.add(i))}),e.clear()}_createRenderBuckets(e){const r=new Map,i=new Map;for(const s of e){const n=this._deserializeBucket(s,i);for(const o of n.layerUIDs)r.set(o,n)}return r}_deserializeBucket(e,r){let i=r.get(e);if(i)return i;switch(new Uint32Array(e)[0]){case wc.FILL:i=new pgt(e,this.styleRepository);break;case wc.LINE:i=new dgt(e,this.styleRepository);break;case wc.SYMBOL:i=new fgt(e,this.styleRepository,this);break;case wc.CIRCLE:i=new mgt(e,this.styleRepository)}return r.set(e,i),i}_deleteLayerData(e){if(!this.layerData.has(e))return;const r=this.layerData.get(e);this._memoryUsedByLayerData-=r.memoryUsed,r.destroy(),this.layerData.delete(e),this.layerCount--}};const YOe=new Map;function vgt(){YOe.forEach((t,e)=>{console.log(`
${e.key}:`),t[0].forEach(r=>console.log(r)),console.log("========"),t[1].forEach(r=>console.log(r))})}const Fjt={value:.5,readOnly:!0},bgt={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};let wS=class{constructor(e=0,r=0){this.min=e,this.max=r,this.level=0,this.hasNoDataValues=!1}copyFrom(e){this.min=e.min,this.max=e.max,this.level=e.level,this.hasNoDataValues=e.hasNoDataValues}},wgt=class{constructor(e,r){this.data=e,this.safeWidth=.99999999*(e.width-1),this.dx=(e.width-1)/(r[2]-r[0]),this.dy=(e.width-1)/(r[3]-r[1]),this.x0=r[0],this.y1=r[3]}},xgt=class{constructor(e,r,i){this.type="elevation",this.level=e[0],this.i=e[1],this.j=e[2],this.extent=r,this.samplerData=new wgt(i,r)}computeMinMaxValue(e,r,i,s){s.min=1/0,s.max=-1/0,s.hasNoDataValues=!1;const n=e-this.level;if(n<=0)return s;const o=2**n;if(!(Math.floor(r/o)===this.i&&Math.floor(i/o)===this.j))return s;let a=1/0,l=-1/0;const c=this.samplerData.data.width,h=this.samplerData.data.values,d=.5*vM;let f=(c-1)/o,m=(i-this.j*o)*f,g=(r-this.i*o)*f;if(f<1){const _=Math.floor(m),v=Math.floor(g),b=_+v*c,T=h[b],x=h[b+1],S=h[b+c],E=h[b+c+1];if(T+x+S+E<d){const A=m-_,R=g-v,M=VI(T,x,S,E,A,R),D=VI(T,x,S,E,A+f,R),k=VI(T,x,S,E,A,R+f),L=VI(T,x,S,E,A+f,R+f);return s.min=Math.min(M,D,k,L),s.max=Math.max(M,D,k,L),s}m=_,g=v,f=1}else m=Math.floor(m),g=Math.floor(g),f=Math.ceil(f);for(let _=m;_<=m+f;_++)for(let v=g;v<=g+f;v++){const b=h[_+v*c];b<d?(a=Math.min(a,b),l=Math.max(l,b)):s.hasNoDataValues=!0}return s.min=a,s.max=l,s}};const Tgt=.5*vM;function Ji(t,e,r){if(r==null)return null;for(const i of r){if(!i)continue;const s=i.safeWidth;let n=ve(i.dy*(i.y1-e),0,s),o=ve(i.dx*(t-i.x0),0,s);const a=Math.floor(n),l=Math.floor(o),c=i.data.width,h=a*c+l,d=i.data.values,f=d[h],m=d[h+1],g=h+c,_=d[g],v=d[g+1];if(f+_+m+v<Tgt){n-=a,o-=l;const b=f+(m-f)*o;return b+(_+(v-_)*o-b)*n}}return null}let gh=class extends Te{constructor(e){super(e)}initialize(){this.addHandles([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(r=>{const i=r.layer;if(i.operationalLayerType==="IntegratedMeshLayer"&&this.viewSpatialReference!=null){const s=ZOe(i.fullExtent,this.viewSpatialReference);s!=null&&e.push(Wye(s))}}),e}};function Sgt(t,e){return t===Ve.Global?new Wq(e):new Xq(e)}u([p({readOnly:!0})],gh.prototype,"layerViewsExtent",null),u([p({readOnly:!0})],gh.prototype,"tiledLayersExtent",null),u([p({readOnly:!0})],gh.prototype,"stencilEnabledExtents",null),u([p()],gh.prototype,"viewSpatialReference",void 0),u([p()],gh.prototype,"tilingScheme",void 0),u([p()],gh.prototype,"defaultTiledLayersExtent",void 0),u([p({constructOnly:!0})],gh.prototype,"layers",void 0),u([p({constructOnly:!0})],gh.prototype,"layerViews",void 0),gh=u([P("esri.views.3d.terrain.ExtentHelper")],gh);let Wq=class extends gh{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?kwe:wje}};Wq=u([P("esri.views.3d.terrain.ExtentHelperGlobal")],Wq);let Xq=class extends gh{_computeLayerViewsExtent(){const e=Uc(),r=this.viewSpatialReference;this.layerViews.forEach(n=>{const o=n.layer;if(n.isResolved()&&(o.type!=="graphics"||!o.internal)){const a=ZOe("fullExtentInLocalViewSpatialReference"in n&&n.fullExtentInLocalViewSpatialReference||n.layer.fullExtent,r);J_(e,a,e)}});const i=AB(e)?e:null,s=this._get("layerViewsExtent");return dw(i,s)?s:i}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const r=this.viewSpatialReference,i=Uc();this.layers.forEach(o=>{if(o.loaded&&aR(o)){const a=G9(o,r,Ve.Local);if(a==null)return;const{tileInfo:l,fullExtent:c}=a;l!=null&&c!=null&&(NF(o)||e.compatibleWith(l)&&c.spatialReference.equals(e.spatialReference))&&J_(i,c,i)}}),J_(i,this.defaultTiledLayersExtent,i);const s=AB(i)?i:null,n=this._get("tiledLayersExtent");return dw(s,n)?n:s}};function ZOe(t,e){return t==null||t.spatialReference.equals(e)?t:fJ(t,t.spatialReference,e)}Xq=u([P("esri.views.3d.terrain.ExtentHelperLocal")],Xq);var tr;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.MAP=1]="MAP"})(tr||(tr={}));const pb=[tr.ELEVATION,tr.MAP];function JOe(){const t=globalThis.require?.modules;if(t){const e=Object.keys(t);for(const r of e)r.search(".glsl")!==-1&&delete t[r]}}const Egt=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let wy,Ba=class extends Te{get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||li.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return this._spatialReference!=null&&this._spatialReference.isGeographic&&!this.view.state.isLocal?Vr(this._spatialReference).metersPerDegree:1}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get hasHighlights(){return this.renderer.hasHighlights}get rendersOccluded(){return this.renderer.rendersOccluded}constructor(e){super(e),this._handles=new $i,this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._hasUnusedRenderTargets=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=ae("esri-mobile")?2048:4096,this._animationTimeLast=0,this._removeRenderOverlayCallback=()=>{}}initialize(){const e=this.view;this.renderer=new xf({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference});const r=()=>this.setDrawTexturesDirty();this._groundIntersector=ed(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this._handles.add([this.renderer.events.on("has-highlights",()=>{r(),this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",s=>e._stage?.renderer.setParameters({hasOverlayWater:s})),this.renderer.events.on("renders-occluded",()=>{r(),this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",r),le(()=>e.state.camera.pixelRatio,r),le(()=>e.state.alignPixelEnabled,r),this.renderer.events.on("textures-disposed",()=>this.updateOverlayResult()),le(()=>[e.pointsOfInterest?.renderPointOfView,e.pointsOfInterest?.centerOnSurfaceFrequent?.location],()=>this.setPlacementDirty()),le(()=>[e.state?.pixelRatio,e.state?.contentPixelRatio],()=>this.setPlacementDirty(),Wr),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),e.resourceController.scheduler.registerTask(vt.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",s=>{this._updateOverlays(rl,s.camera,_s.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays,_s.BACKGROUND,s)})]);let i=s=>this._renderOverlayCallback(s);this._removeRenderOverlayCallback=()=>{i=()=>{}},e._stage?.renderer.setParameters({renderOverlay:s=>i(s)})}_renderOverlayCallback(e){this._contentUpdated=!1;const r=this.renderer;r.processSyncDrapeSources(),r.hasOverlays&&(this._dispatchAnimationUpdate(e),this._drawOverlayTextures(r.overlays,_s.UPDATE,this.view.state)),this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}destroy(){this._handles=Ne(this._handles),this._removeRenderOverlayCallback(),this.view?._stage?.renderer.setParameters({renderOverlay:()=>{}}),wy!=null&&(wy.hide(),wy=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const r=this.view.renderSpatialReference;e!=null&&r!=null?(this._renderSR=r,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new av(-20037508342787e-6,20037508342787e-6):new av(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}get gpuMemoryUsage(){return this.renderer.gpuMemoryUsage}registerDrapeSource(e,r,i){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const s=this.renderer.createDrapeSourceRenderer(e,r,i);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),s}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,ou)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&e.setDrapingExtent!=null&&this._spatialReference!=null&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}updateOverlayResult(){this.view._stage?.renderer.setParameters({overlays:this.renderer.overlays})}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(e){return this._updateOverlays(e,this.view.state.contentCamera,_s.UPDATE)}_updateOverlays(e,r,i){if(!this._spatialReference)return Zo.YIELD;const s=this._computeOverlayResolution(r);this._computeOverlayExtents(r,s,Qm);const n=vu(Qm.inner)/vu(Qm.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const o=this._updateOverlay(Di.INNER,Qm.inner,s,1*Qm.pixelRatioAdjustment,Qm.mapUnitsPerPixel),a=this._updateOverlay(Di.OUTER,Qm.outer,s,n*Qm.pixelRatioAdjustment,Qm.mapUnitsPerPixel);o!==Pf.EXTENT&&a!==Pf.EXTENT||(this._drapeSources.forEach(l=>this._updateDrapeSourceExtent(l)),this.surface.updateTileOverlayParams(i)),o===Pf.NONE&&a===Pf.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1,e.madeProgress()}_computeOverlayResolution(e){const r=this.view.state.contentPixelRatio,i=e.fullWidth/e.pixelRatio*r,s=e.fullHeight/e.pixelRatio*r,n=Math.ceil(1.5*Math.max(i,s));return Math.min($K(n),this._maxResolution)}_updateOverlay(e,r,i,s,n){if(this.renderer.overlays.length===0)return Pf.NONE;const o=this.renderer.overlays[e],a=o.mapUnitsPerPixel;if(o.mapUnitsPerPixel=n,o.pixelRatio=s,Cgt(r,o.extent)&&i===o.resolution)return a===n?Pf.NONE:Pf.RERENDER_ONLY;m0(o.extent,r),o.resolution=i;const l=AZ(o.extent);return o.renderLocalOrigin=pF(l[0],l[1],0,"OV_"+this._latestOriginId++),Pf.EXTENT}setTileParameters(e){const r=e.renderData.overlay;if(this.renderer.overlays.length>0){const i=this.renderer.overlays[Di.INNER],s=this.renderer.overlays[Di.OUTER],n=e.extent;this._rectInsideRect(i.extent,n)||this._rectanglesOverlap(n,i.extent)||this._rectanglesOverlap(n,s.extent)?(this._setTileOverlayData(n,Di.INNER,r),this._setTileOverlayData(n,Di.OUTER,r)):(this._clearTileOverlayData(Di.INNER,r),this._clearTileOverlayData(Di.OUTER,r))}else this._clearTileOverlayData(Di.INNER,r),this._clearTileOverlayData(Di.OUTER,r)}overlayPixelSizeInMapUnits(e){if(this.renderer.overlays.length===0)return 0;const r=this.renderer.overlays[Di.INNER],i=this.renderer.overlays[Di.OUTER],s=this._pointIsInExtent(e,r.extent)?r:i;return(s.extent[2]-s.extent[0])/s.resolution}_setTileOverlayData(e,r,i){if(this.renderer.overlays.length===0)return;const s=this.renderer.overlays[r].extent,n=vu(s),o=Op(s);let a=e[0];if(this._longitudeCyclical){a=this._longitudeCyclical.minimalMonotonic(s[0],a);const l=this._longitudeCyclical.minimalMonotonic(s[0],e[2]);a>l&&(a=l-(e[2]-e[0]))}i.setScale(r,vu(e)/n,Op(e)/o),i.setOffset(r,(a-s[0])/n,(e[1]-s[1])/o)}_clearTileOverlayData(e,r){r.setScale(e,-1,-1),r.setOffset(e,-1,-1)}async reloadShaders(){JOe(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask(rl)}_dispatchAnimationUpdate(e){const r=e-this._animationTimeLast;if(r>=this.surface.view._stage.renderer.animationTimestep||this.view.state.forcedAnimationTime!=null||this._drawTexturesDirty||this._drawTexturesAnimateDirty){const i=r/this.surface.view._stage.renderer.animationTimeDilation,s=new USe(this.view.state.camera,i,this.view.state.forcedAnimationTime);this.renderer.updateAnimation(s)&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e}}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0,this.view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(e,r,i,s){const n=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,Rgt,r,i);if(n==null)return!1;const o=n.origin,a=de(ML,n.origin,n.direction);return this._groundIntersector.reset(o,a,e),this._groundIntersector.intersect([]),this.view.basemapTerrain.intersect(this._groundIntersector,null,o,a),this._groundIntersector.results.min.getIntersectionPoint(s)}_findHorizonBasedPointOfInterest(e,r){let i=.5;const s=.55,n=this.view.renderCoordsHelper.getAltitude(e.eye),o=this.view.pointsOfInterest.centerOnSurfaceFrequent,a=1e-5,l=ve(o.estimatedSurfaceAltitude,e.aboveGround?-1/0:n+a,e.aboveGround?n-a:1/0),c=e.aboveGround;if(this.view.viewingMode==="global"){const h=ML;PC(E8(C8,Vr(this.view.spatialReference).radius+l),Du(e.eye,e.viewForward),h),fe(h,h,e.eye);const d=lv.normalize(Fbe(e.viewForward,h,e.viewRight))/e.fovY+.5,f=d<=0||d>=1?.5:s;i=c?f*d:d+f*(1-d)}else{const h=.5*Math.PI-Math.acos(-e.viewForward[2]),d=Math.tan(h),f=Nt(0,d,1,0),m=xu(f,f,e.projectionMatrix)[1],g=ve(.5+.5*m,0,1);i=g===1||g===0?.5:c?g*s:1-(1-g)*s}return!!this._intersectGroundFromView(e,.5,i,r)&&X6(r,e.eye)<o.distance*o.distance}_computeOverlayExtents(e,r,i){const s=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,n=O();this._findHorizonBasedPointOfInterest(e,n)||ie(n,s),li.OVERLAY_SHOW_CENTER?(wy==null&&(wy=new P2(this.view.graphics,"red")),wy.show(n,this._renderSR)):wy?.hide();const o=Math.max(.1,mi(e.eye,n)),a=bv(this.view.renderCoordsHelper,s,e.eye);this._overlaySREqualsRenderSR||Qs(n,this._renderSR,n,this._spatialReference);const l=this.surface.extent,c=!this._isSpherical&&this._spatialReference!=null&&this._spatialReference.isGeographic,h=c&&this._spatialReference!=null?1/Vr(this._spatialReference).metersPerDegree:1,d=this.view.state.contentPixelRatio,f=e.perScreenPixelRatio/d*o*h;i.mapUnitsPerPixel=f/this._worldToPCSRatio;let m=r*f/2*ZQ,g=!1,_=c?90:1/0;this._isSpherical&&l!=null&&this._spatialReference!=null&&(this._spatialReference.isWebMercator?(m/=Math.cos(r5(n[1])),_=l[3]):(g=!0,m/=Vr(this._spatialReference).metersPerDegree,_=90),m>=_&&(m=_,n[1]=0,this._spatialReference.isWebMercator&&(n[0]=0)));let v=1;g&&(v=1/Math.max(.2,Math.cos(Math.abs(Ft(n[1])))),m*v>180&&(v=180/m),i.mapUnitsPerPixel*=v);const b=Math.log(2)/12;m=Math.exp(Math.round(Math.log(m)/b)*b);const T=m*v,x=32,S=.5*r/(x*T),E=.5*r/(x*m);n[0]=Math.round(n[0]*S)/S,n[1]=Math.round(n[1]*E)/E;const A=i.inner;A[0]=n[0]-T,A[1]=n[1]-m,A[2]=n[0]+T,A[3]=n[1]+m,this._isSpherical&&this._shiftExtentToFitBounds(A,1/0,_);const R=i.outer;if(6*T>vu(l))m0(R,l);else if(Math.PI/2-Math.abs(a-Math.PI/2)<=.25*Math.PI)R[0]=A[0]-T,R[1]=A[1]-m,R[2]=A[2]+T,R[3]=A[3]+m;else{Qs(e.eye,this._renderSR,ML,this._spatialReference),zf(A1,n,ML);let D=-Math.atan2(A1[1],A1[0])+.125*Math.PI;D<0&&(D+=2*Math.PI);const k=Math.floor(D/(.25*Math.PI));Uw(A1,Egt[k],2*m),A1[0]*=v,A1[2]*=v,wZ(R,A,A1)}if(this._isSpherical)R[0]=this._longitudeCyclical.clamp(R[0]),R[2]=this._longitudeCyclical.clamp(R[2]),R[1]=Math.max(R[1],-_),R[3]=Math.min(R[3],_);else{const D=OB(A,l,Agt),k=OB(R,l,Ogt);Zre(D,k)&&(R[2]=R[0],R[3]=R[1])}const M=Math.abs(A[2]-A[0])/r;i.mapUnitsPerPixel=Math.max(i.mapUnitsPerPixel,M),i.pixelRatioAdjustment=i.mapUnitsPerPixel/M}_drawOverlayTextures(e,r,i){if(e.length===0||!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return;const s=this._drawTexturesDirty;this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1;const n=this._drawOverlay(e[Di.INNER],i),o=this._drawOverlay(e[Di.OUTER],i);n!==FE.CHANGED&&o!==FE.CHANGED||this.surface.updateTileOverlayParams(_s.UPDATE),this._collectUnusedRenderTargetMemory(),this.updateOverlayResult(),s?(this.surface.requestRender(r),r===_s.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(_s.BACKGROUND)}_drawOverlay(e,r){return this._longitudeCyclical?e.setupGeometryViewsCyclical(this._longitudeCyclical):e.setupGeometryViewsDirect(),e.draw(this.renderer,r)}_collectUnusedRenderTargetMemory(){this._hasUnusedRenderTargets=!1,this.renderer.hasOverlays&&(this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory())}_rectanglesOverlap(e,r){return e!=null&&(this._longitudeCyclical?(this._longitudeCyclical.contains(r[0],r[2],e[0])||this._longitudeCyclical.contains(r[0],r[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],r[0]))&&!(e[1]>r[3]||e[3]<r[1]):yP(e,r))}_rectInsideRect(e,r){return r!=null&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],r[0])&&this._longitudeCyclical.contains(e[0],e[2],r[2])&&r[1]>e[1]&&r[3]<e[3]:Zre(e,r))}_pointIsInExtent(e,r){if(this._longitudeCyclical)return this._longitudeCyclical.contains(r[0],r[2],e.x)&&e.y>=r[1]&&e.y<=r[3];const i=e.x,s=e.y;return i>r[0]&&i<r[2]&&s>r[1]&&s<r[3]}_shiftExtentToFitBounds(e,r,i){let s=0,n=0;e[0]<-r?s=e[0]+r:e[2]>r&&(s=r-e[2]),e[1]<-i?n=e[1]+i:e[3]>i&&(n=i-e[3]),d5(e,s,n)}get test(){return{renderer:this.renderer,update:()=>this.runTask(rl)}}};function Cgt(t,e){const i=li.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(t[2]-t[0],t[3]-t[1],e[2]-e[0],e[3]-e[1]);return Math.abs(e[0]-t[0])<=i&&Math.abs(e[1]-t[1])<=i&&Math.abs(e[2]-t[2])<=i&&Math.abs(e[3]-t[3])<=i}u([p()],Ba.prototype,"_spatialReference",void 0),u([p({readOnly:!0})],Ba.prototype,"running",null),u([p()],Ba.prototype,"_placementDirty",void 0),u([p()],Ba.prototype,"_contentUpdated",void 0),u([p()],Ba.prototype,"_isSpherical",null),u([p()],Ba.prototype,"_worldToPCSRatio",null),u([p({autoDestroy:!0})],Ba.prototype,"renderer",void 0),u([p({constructOnly:!0})],Ba.prototype,"view",void 0),u([p({constructOnly:!0})],Ba.prototype,"surface",void 0),u([p()],Ba.prototype,"suspended",null),u([p()],Ba.prototype,"updating",null),u([p({type:Boolean})],Ba.prototype,"hasHighlights",null),u([p({type:Boolean})],Ba.prototype,"rendersOccluded",null),Ba=u([P("esri.views.3d.terrain.OverlayManager")],Ba);const A1=Wt(),ML=O(),Qm={inner:zt(),outer:zt(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},Agt=zt(),Ogt=zt(),Rgt=eo();var Pf;(function(t){t[t.NONE=0]="NONE",t[t.EXTENT=1]="EXTENT",t[t.RERENDER_ONLY=2]="RERENDER_ONLY"})(Pf||(Pf={}));let QOe=class Yq{constructor(e,r){this._factoryCallback=e,this._lengthCallback=r,this._pool=new Map}acquire(e){if(!Yq.test.disabled){const r=this._pool.get(e);if(r&&r.length!==0)return r.pop()}try{return this._factoryCallback(e)}catch(r){const i=window.performance&&window.performance.memory;let s="";throw i&&(s=`
  totalJSHeapSize: ${i.totalJSHeapSize}, usedJSHeapSize: ${i.usedJSHeapSize}, jsHeapSizeLimit: ${i.jsHeapSizeLimit}`),console.log("Array allocation of size "+e+" failed: "+r+s),r}}release(e){if(Yq.test.disabled)return;const r=this._lengthCallback(e);let i=this._pool.get(r);i||(i=new Vt({shrink:!0}),this._pool.set(r,i)),i.push(e)}clear(){this._pool.clear()}get test(){return{size:this._pool.size}}};QOe.test={disabled:!1};let Mgt=class{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=Ei(),this.indexCount=0,this.numVerticesPerSide=0,this.uvRange=[0,0,1,1],this.outerEdges=[null,null,null,null],this.innerEdges=[null,null,null,null]}},Cue=class{constructor(e,r,i,s,n){this.attributes=e,this.localOrigin=r,this.index0=i,this.stride=s,this.count=n}getVertexIndex(e){return this.getAttributeIndex(e)}getAttributeIndex(e){return Ee(0<=e&&e<this.count),this.index0+this.stride*e}_getVertexRaw(e,r){this.attributes.position.getVec(e,r)}getVertexPos(e,r){this._getVertexRaw(this.getAttributeIndex(r),e),de(e,e,this.localOrigin)}getNormal(e,r){const{typedBuffer:i,typedBufferStride:s}=this.attributes.normalCompressed;uat(e,i,this.getAttributeIndex(r),s)}_setNormal(e,r,i,s){const{typedBuffer:n,typedBufferStride:o}=this.attributes.normalCompressed;ix(n,e,r,i,s,o)}_setUV(e,r,i){Sp(this.attributes.uv0,e,r,i)}setNormalFromValues(e,r,i,s){this._setNormal(this.getAttributeIndex(e),r,i,s)}setVertexFromValuesRawPositionUV(e,r,i,s,n,o){const a=this.getAttributeIndex(e);this.attributes.position.setValues(a,r,i,s),this._setUV(a,n,o)}setVertexFromValuesRawPositionUVNormal(e,r,i,s,n,o,a,l,c){const h=this.getAttributeIndex(e);this.attributes.position.setValues(h,r,i,s),this._setUV(h,n,o),this._setNormal(h,a,l,c)}};const Pgt=qi().vec3f(C.POSITION).vec2i16(C.UV0).vec2i16(C.NORMALCOMPRESSED,{glNormalized:!0}),yee=new QOe(t=>Pgt.createBuffer(t),t=>t.count);function Igt(){yee.clear()}function KOe(t){return yee.acquire(t)}function $gt(t){yee.release(t.vertexAttributes),t.vertexAttributes=null,t.indices=null}const Aue=16384;function Sp(t,e,r,i){t.setValues(e,r*Aue,i*Aue)}function Gh(t,e,r,i){t<i[0]?i[0]=t:t>i[3]&&(i[3]=t),e<i[1]?i[1]=e:e>i[4]&&(i[4]=e),r<i[2]?i[2]=r:r>i[5]&&(i[5]=r)}let Lgt=class{constructor(){this.sinLonLUT=new Array(YA+1),this.cosLonLUT=new Array(YA+1),this.sinLatLUT=new Array(YA+1),this.cosLatLUT=new Array(YA+1)}update(e,r,i){const s=r[0],n=r[2];for(let o=0;o<=e;o++){const a=o/e,l=s*(1-a)+n*a;this.sinLonLUT[o]=Math.sin(l),this.cosLonLUT[o]=Math.cos(l);const c=i(a);this.sinLatLUT[o]=Math.sin(c),this.cosLatLUT[o]=Math.cos(c)}}},PL=class{constructor(){this.cornerTiles=[null,null,null,null],this.cornerTileSamplerVersions=[-1,-1,-1,-1]}},Dgt=class{constructor(){this.cornerNeighborData=[new PL,new PL,new PL,new PL],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1],this.cornerPeerNeighbors=[null,null,null,null]}},Ngt=class{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.clippingArea=null,this.wireframe=!1,this.samplerDataVersion=0,this.neighborData=new Dgt}},eRe=class WN{constructor(e){this._getFadeDuration=e,this._fadeStart=0,this._delayedTime=0}clear(){this._current=Ne(this._current),this._next=Ne(this._next),this._waiting=Ne(this._waiting),this._delayed=Ne(this._delayed)}get current(){if(this._current==null)return null;if(!this._isFadingEnabled){const r=this._delayed||this._waiting||this._next||this._current;r!==this._current&&(this._current=null,this.clear(),this._current=r)}let e=WN.test.fadeMoment;if(this._delayed!=null&&(e=e||performance.now(),e>=this._delayedTime&&(this._push(this._delayed,o0.Immediate),this._delayed=null)),this._next!=null){e=e||performance.now();const r=this._fadeDuration,i=this._current!=null&&this._next.texture===this._current.texture,s=this._next.type!==cn.FADING,n=e-this._fadeStart>=r;(i||s||n)&&(Ne(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(e))}return this._current}get next(){return this._next}get fadeFactor(){if(this._next==null)return 1;const e=WN.test.fadeMoment||performance.now(),r=Math.max(0,e-this._fadeStart),i=this._fadeDuration;return r>i?0:1-r/i}get isFading(){return this._next!=null||this._delayed!=null}push(e,r=o0.Immediate){this._delayed=Ne(this._delayed),this._push(e,r)}_push(e,r){if(this._isFadingEnabled||this.clear(),this._current==null)return void(this._current=e);const i=WN.test.fadeMoment||performance.now();return r!==o0.Immediate?(this._delayed=e,void(this._delayedTime=i+r)):this._next==null?(this._next=e,void(this._fadeStart=this._alignFadeStart(i))):void(e!=null&&(Ne(this._waiting),this._waiting=e))}get _fadeDuration(){return this._waiting==null?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(e){const r=this._getFadeDuration();return e+r-e%r}get _isFadingEnabled(){return this._getFadeDuration()>0}};var o0;eRe.test={fadeMoment:0},function(t){t[t.Immediate=0]="Immediate",t[t.Delayed=5e3]="Delayed"}(o0||(o0={}));var tC;(function(t){t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT",t[t.NONE=0]="NONE",t[t.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(tC||(tC={}));let tRe=class{constructor(){this._queue=new Vt,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=void 0}reset(e=null){this._queue.clear(),e!=null&&this._queue.pushArray(e),this._last=void 0}skipSubtree(){this._last=void 0}next(){const e=this._last?.children;return e&&e[0]&&this._queue.pushArray(e),this._last=this._queue.pop(),this._last}},Fgt=class{constructor(){this._q=new Vt}get done(){return this._q.length===0}reset(e){if(this._q.clear(),e!=null){this._q.pushArray(e);for(let r=0;r<this._q.length;++r){const i=this._q.data[r];i.isLeaf||this._q.pushArray(i.children)}}}next(){return this._q.pop()}};function jR(t,e,r){if(e==null||e.fullExtent==null)return!1;const i=e.fullExtent,s=t.extent;if(r){if(s[0]<i.xmin||s[1]<i.ymin||s[2]>i.xmax||s[3]>i.ymax)return!1}else if(i.xmin>s[2]||i.ymin>s[3]||i.xmax<s[0]||i.ymax<s[1])return!1;const n=t.surface.tilingScheme.levels[t.level].scale,o=e.minScale;if(o>0&&n>1.00000001*o)return!1;const a=e.maxScale;return!(a>0&&n<.99999999*a)}function a0(t,e){const r=t.lij,i=e.lij;return r[0]-i[0]||r[1]-i[1]||r[2]-i[2]}function rRe(t,e,r=null){r==null||r.length===0?t===tC.BACK_TO_FRONT?e.sort(Ugt):e.sort(kgt):e.sort((i,s)=>zgt(i,s,t,r))}function Ugt(t,e){const r=e.screenDepth-t.screenDepth;if(r!==0)return r;const i=t.lij,s=e.lij;return i[0]-s[0]||i[1]-s[1]||i[2]-s[2]}function kgt(t,e){const r=t.screenDepth-e.screenDepth;if(r!==0)return r;const i=t.lij,s=e.lij;return i[0]-s[0]||i[1]-s[1]||i[2]-s[2]}function iRe(t,e,r){const i=t.screenDepth,s=e.screenDepth;return i<s?-r:i>s?r:a0(t,e)}function zgt(t,e,r,i){return Oue(t,i)===Oue(e,i)?iRe(t,e,r):t?r:-r}function Oue(t,e){for(const r of e)if(t.intersectsExtent(r))return!0;return!1}function Vgt(t,e){const r=t.distanceToPOI-e.distanceToPOI;if(r!==0)return r;const i=t.lij,s=e.lij;return i[0]-s[0]||i[1]-s[1]||i[2]-s[2]}function Bgt(t,e){const r=t.length;for(let i=0;i<r;++i)t.at(i).updateDistanceToPOI(e);t.sort(Vgt)}function Ggt(t,e,r){let i=1,s=0,n=0;for(;t!==e;)if(i*=.5,s*=.5,n*=.5,1&t.lij[2]&&(s+=.5),!(1&t.lij[1])&&(n+=.5),(t=t.parent)==null)throw new Error("tile was not a descendant of upsampleTile");r.init(e,s,n,i)}function jgt(t){for(let e=0;e<t.length;e++){const r=t[e],i=r.parent;if(i)for(let s=0;s<4;s++){const n=i.children[s];if(n&&n!==r)return!0}}return!1}function Kjt(t,e){if(!t||!e||t[0]===e[0])return!1;const r=t[0]<e[0],i=r?t:e,s=r?e:t,n=1<<s[0]-i[0];return Math.floor(s[1]/n)===i[1]&&Math.floor(s[2]/n)===i[2]}let _ee=class{get updating(){return!!this._tileRequested}init(e,r,i,s){this.tile=e,this._layerIdx=r,this._layerClass=i,this._suspended=s,this._tileLayerInfo=e.getLayerInfo(r,i),this._tileRequested=null;const n=this._findAncestorWithData();this._setUpsampleTile(n)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(e){e!==this._suspended&&(this._suspended=e,e?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();return this._setUpsampleTile(e),this._requestNext()}dataArrived(e,r){this._setUpsampleTile(e,r),this._tileRequested=null,e===this.tile?this.tile.updateRenderData(this._layerClass,cn.FADING,r):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return e!=null?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone(),!!this._tileRequested}_findNextDownload(){const e=this._layerIdx,r=this._layerClass,i=this.tile.surface.layerViewByIndex(e,r),s=Gq(i),{minLevel:n,maxLevel:o}=i.dataLevelRange,a=this._desiredMinLevelDelta,l=this._progressiveLevelModulo+a,c=this._scaleRangeEnabled?jR:()=>!0;let h=this.tile;const d=h.level;let f;const m=this._tileLayerInfo.upsampleInfo,g=m!=null?m.tile.level:-1,_=m!=null&&g-d>=a,v=s?.tilemapCache,b=i.type==="vector-tile-3d"?i.schemaHelper:null;for(;h&&c(h,s,!1)&&h.level>=n;){const T=h.level,x=d-T,S=h.layerInfo[r][e];if(S.data&&x>=a){(!_||T>g)&&this._setUpsampleTile(h),S.dataInvalidated&&(f=h);break}const E=b?.getLevelRowColumn(h.lij)??h.lij;if(v?.getAvailability(E[0],E[1],h.lij[2])!=="unavailable"&&T<=o&&!S.data&&!S.dataMissing&&((!f||h.level===n||T%Uwe==0||d-f.level<a)&&(f=h),x>=l))break;h=h.parent}if(f!=null&&d-f.level<a)if(m)f=null;else{const T=this._findAncestorWithData();T!=null&&(this._setUpsampleTile(T),f=T.layerInfo[r][e].dataInvalidated?T:null)}return f}_findAncestorWithData(){const e=this.tile.elevationLevel,r=this._desiredMinLevelDelta;let i;for(let s=this.tile;s;s=s.parent)if(s.hasLayerData(this._layerIdx,this._layerClass)){if(e-s.level>=r)return s;i=s}return i}_setUpsampleTile(e,r){this._tileLayerInfo.setUpsampleInfo(this.tile,e),this.tile.updateRenderData(this._layerClass,cn.FADING,r)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}},Hgt=class extends _ee{get _desiredMinLevelDelta(){throw Rue}get _progressiveLevelModulo(){throw Rue}dispose(){}};const Rue=new Error("Abstract method called on TileAgent"),ec=new Hgt;let sRe=class extends _ee{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return Sj(this.tile.level)-(this.tile.elevationLevel-this.tile.level)}get _progressiveLevelModulo(){return 0}},nRe=class extends _ee{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return Uwe}};var Cw,ox;(function(t){t[t.Stretch=0]="Stretch",t[t.Lut=1]="Lut",t[t.Hillshade=2]="Hillshade",t[t.COUNT=3]="COUNT"})(Cw||(Cw={})),function(t){t[t.Noop=0]="Noop",t[t.PerBand=1]="PerBand",t[t.COUNT=2]="COUNT"}(ox||(ox={}));function qgt(t){t.fragment.uniforms.add(new rt("u_colormap",e=>e.u_colormap),new Ie("u_colormapOffset",e=>e.colormap.u_colormapOffset),new Ie("u_colormapMaxIndex",e=>e.colormap.u_colormapMaxIndex),new Ie("u_opacity",e=>e.common.u_opacity)),t.fragment.code.add(w`vec4 colormap(vec4 currentPixel, bool isFloat) {
float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
result = texelFetch(u_colormap, ivec2(texelCoordinates), 0);
}
return result;
}`)}function Wgt(t){t.fragment.uniforms.add(new rt("u_transformGrid",e=>e.u_transformGrid),new Ar("u_transformSpacing",e=>e.common.u_transformSpacing),new Ar("u_targetImageSize",e=>e.common.u_targetImageSize)),t.fragment.code.add(w`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(4.0, 1.0);
vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;
vec2 pos = fract((index_image + 0.5) / u_transformSpacing);
vec2 transform_location = index_transform + 0.5;
vec2 srcLocation;
if (pos.s <= pos.t) {
vec3 ll_abc = texelFetch(u_transformGrid, ivec2(transform_location), 0).rgb;
vec3 ll_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 1.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
srcLocation.t = dot(ll_def, vec3(pos, 1.0));
} else {
vec3 ur_abc = texelFetch(u_transformGrid, ivec2(transform_location.s + 2.0, transform_location.t), 0).rgb;
vec3 ur_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 3.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
srcLocation.t = dot(ur_def, vec3(pos, 1.0));
}
return srcLocation;
}`)}let oRe=class extends ii{constructor(){super(...arguments),this.scale=1,this.offset=Pp}};function aRe(t){t.attributes.add(C.POSITION,"vec2"),t.attributes.add(C.UV0,"vec2"),t.vertex.uniforms.add(new Ie("scale",e=>e.scale)),t.vertex.uniforms.add(new Ar("offset",e=>e.offset)),t.varyings.add("uv","vec2"),t.varyings.add("vuv","vec2"),t.vertex.code.add(w`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}let Xgt=class extends oRe{constructor(e,r,i){super(),this.common=e,this.u_image=r,this.u_transformGrid=i}};function Ygt(t,e){t.include(Wgt),t.fragment.uniforms.add(new rt("u_image",i=>i.u_image),new nm("u_flipY",i=>i.common.u_flipY),new nm("u_applyTransform",i=>i.common.u_applyTransform));const{requireBilinearWithNN:r}=e;r&&t.fragment.uniforms.add(new Ar("u_srcImageSize",i=>i.common.u_srcImageSize)),t.fragment.code.add(w`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}`),r?t.fragment.code.add(w`vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {
vec2 texelStart = floor(coords * texSize);
vec2 coord0 = texelStart / texSize;
vec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;
vec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;
vec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;
vec4 color0 = texture(sampler, coord0);
vec4 color1 = texture(sampler, coord1);
vec4 color2 = texture(sampler, coord2);
vec4 color3 = texture(sampler, coord3);
vec2 blend = fract(coords * texSize);
vec4 color01 = mix(color0, color1, blend.x);
vec4 color23 = mix(color2, color3, blend.x);
vec4 color = mix(color01, color23, blend.y);
float alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);
color = color * alpha + (1.0 - alpha) * texture(sampler, coords);
return color;
}
vec4 getPixel(vec2 pixelLocation) {
return sampleBilinear(u_image, pixelLocation, u_srcImageSize);
}`):t.fragment.code.add(w`vec4 getPixel(vec2 pixelLocation) {
return texture(u_image, pixelLocation);
}`)}var Le;(function(t){t[t.Normal=0]="Normal",t[t.Average=1]="Average",t[t.Lighten=2]="Lighten",t[t.Lighter=3]="Lighter",t[t.Plus=4]="Plus",t[t.Screen=5]="Screen",t[t.ColorDodge=6]="ColorDodge",t[t.Darken=7]="Darken",t[t.Multiply=8]="Multiply",t[t.ColorBurn=9]="ColorBurn",t[t.Overlay=10]="Overlay",t[t.SoftLight=11]="SoftLight",t[t.HardLight=12]="HardLight",t[t.VividLight=13]="VividLight",t[t.Hue=14]="Hue",t[t.Saturation=15]="Saturation",t[t.Luminosity=16]="Luminosity",t[t.Color=17]="Color",t[t.DestinationOver=18]="DestinationOver",t[t.DestinationAtop=19]="DestinationAtop",t[t.DestinationIn=20]="DestinationIn",t[t.DestinationOut=21]="DestinationOut",t[t.SourceAtop=22]="SourceAtop",t[t.SourceIn=23]="SourceIn",t[t.SourceOut=24]="SourceOut",t[t.Xor=25]="Xor",t[t.Difference=26]="Difference",t[t.Exclusion=27]="Exclusion",t[t.Minus=28]="Minus",t[t.Invert=29]="Invert",t[t.Reflect=30]="Reflect",t[t.COUNT=31]="COUNT"})(Le||(Le={}));const Zq={normal:Le.Normal,average:Le.Average,lighten:Le.Lighten,lighter:Le.Lighter,screen:Le.Screen,plus:Le.Plus,"color-dodge":Le.ColorDodge,darken:Le.Darken,multiply:Le.Multiply,"color-burn":Le.ColorBurn,overlay:Le.Overlay,"soft-light":Le.SoftLight,"hard-light":Le.HardLight,"vivid-light":Le.VividLight,hue:Le.Hue,saturation:Le.Saturation,luminosity:Le.Luminosity,color:Le.Color,difference:Le.Difference,exclusion:Le.Exclusion,minus:Le.Minus,invert:Le.Invert,reflect:Le.Reflect,"destination-over":Le.DestinationOver,"destination-atop":Le.DestinationAtop,"destination-in":Le.DestinationIn,"destination-out":Le.DestinationOut,"source-atop":Le.SourceAtop,"source-in":Le.SourceIn,"source-out":Le.SourceOut,xor:Le.Xor};function Zgt(t){return t===Le.DestinationOver||t===Le.DestinationAtop||t===Le.DestinationIn||t===Le.DestinationOut||t===Le.SourceAtop||t===Le.SourceIn||t===Le.SourceOut||t===Le.Xor}function vee(t){t.code.add(w`
    float lineFactorAtPosition(float value) {
      float pos = value * ${w.float(257)};
      if(pos < 0.5 || pos > ${w.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)}function Jgt(t,e){const r=e.blendMode;r!==Le.Normal&&(r===Le.Reflect&&t.code.add(w`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),r!==Le.ColorDodge&&r!==Le.VividLight||t.code.add(w`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),r!==Le.ColorBurn&&r!==Le.VividLight||t.code.add(w`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),r===Le.Overlay&&t.code.add(w`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),r===Le.HardLight&&t.code.add(w`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),r===Le.SoftLight&&t.code.add(w`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),r===Le.VividLight&&t.code.add(w`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),r!==Le.Hue&&r!==Le.Saturation&&r!==Le.Color&&r!==Le.Luminosity||(t.code.add(w`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),r!==Le.Hue&&r!==Le.Saturation||t.code.add(w`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),t.code.add(w`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${r===Le.Multiply?w`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Le.Average?w`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Le.Lighten?w`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Le.Darken?w`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Le.Lighter?w`return vec4(cl * ol + cb * ob, ol + ob);`:r===Le.Plus?w`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:r===Le.Minus?w`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:r===Le.Screen?w`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Le.Difference?w`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Le.Invert?w`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:r===Le.DestinationOver?w`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:r===Le.DestinationAtop?w`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:r===Le.DestinationOut?w`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:r===Le.SourceAtop?w`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:r===Le.SourceOut?w`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:r===Le.Xor?w`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:r===Le.DestinationIn?w`return vec4(cb * ob * ol, ol * ob);`:r===Le.SourceIn?w`return vec4(cl * ol * ob, ol * ob);`:r===Le.Hue?w`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Le.Saturation?w`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Le.Color?w`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Le.Luminosity?w`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Le.Exclusion?w`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Le.Reflect?w`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Le.ColorDodge?w`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Le.ColorBurn?w`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Le.Overlay?w`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Le.SoftLight?w`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Le.HardLight?w`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Le.VividLight?w`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:w``}
    }
  `))}var On,yp,ep;(function(t){t[t.Composite=0]="Composite",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.GroupBackgroundComposite=3]="GroupBackgroundComposite",t[t.COUNT=4]="COUNT"})(On||(On={})),function(t){t[t.NotRequired=0]="NotRequired",t[t.Required=1]="Required",t[t.COUNT=2]="COUNT"}(yp||(yp={})),function(t){t[t.Off=0]="Off",t[t.On=1]="On",t[t.COUNT=2]="COUNT"}(ep||(ep={}));function lRe(t,e){const r=e.output===On.GridComposite,i=e.output===On.ColorComposite,s=e.output===On.GroupBackgroundComposite,n=e.output===On.Composite;r&&t.fragment.include(vee),i&&t.fragment.uniforms.add(new kt("backgroundColor",c=>c.backgroundColor));const o=e.baseOpacityMode===yp.Required;o&&t.fragment.uniforms.add(new Ie("baseOpacity",c=>c.baseOpacity)),n&&t.fragment.uniforms.add(new rt("fboColor",c=>c.fboTexture));const a=e.blendMode!==Le.Normal,l=e.premultipliedSource===ep.On;t.fragment.include(Jgt,e),t.fragment.code.add(w`
    vec4 getBackground(vec2 uv) {
      return ${o?w`baseOpacity *`:""} ${s?w`vec4(0.0, 0.0, 0.0, 0.0)`:i?w`vec4(backgroundColor, 1.0)`:r?w`vec4(gridColor(uv), 1.0)`:w`texelFetch(fboColor, ivec2(gl_FragCoord.xy), 0)`};
    }

    vec4 blendLayers(vec4 bgColor, vec4 colorLayer, float opacity) {
      ${a?w`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:w`
          float composeAlpha = colorLayer.a * opacity;
          return ${!l&&(n&&!o||s)?w`colorLayer * opacity;`:w`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)}let H9=class extends Xgt{constructor(e,r,i,s,n,o){super(e,s,n),this.colormap=r,this.symbolizer=i,this.u_colormap=o,this.backgroundColor=sl,this.fboTexture=null,this.baseOpacity=1}},Qgt=class extends H9{},Kgt=class extends H9{};function e0t(t){const e=new Sr;return e.include(aRe),e.include(Ygt,t),e.include(qgt,t),e.include(lRe,t),e.fragment.code.add(w`vec4 applyBackgroundBlend(vec4 layerColor) {
vec4 bgColor = getBackground(vuv);
return blendLayers(bgColor, layerColor, u_opacity);
}`),t.colorizerType===Cw.Stretch?r0t(e,t):t.colorizerType===Cw.Lut?t0t(e):t.colorizerType===Cw.Hillshade&&i0t(e,t),e}function t0t(t){t.fragment.code.add(w`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
fragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}function r0t(t,e){t.fragment.uniforms.add(new ZP("u_bandCount",i=>i.symbolizer.u_bandCount),new $l("u_minCutOff",i=>i.symbolizer.u_minCutOff,3),new $l("u_maxCutOff",i=>i.symbolizer.u_maxCutOff,3),new $l("u_factor",i=>i.symbolizer.u_factor,3),new Ie("u_minOutput",i=>i.symbolizer.u_minOutput),new Ie("u_maxOutput",i=>i.symbolizer.u_maxOutput),new nm("u_useGamma",i=>i.symbolizer.u_useGamma),new $l("u_gamma",i=>i.symbolizer.u_gamma,3),new $l("u_gammaCorrection",i=>i.symbolizer.u_gammaCorrection,3),new Ie("u_opacity",i=>i.common.u_opacity)),t.fragment.code.add(w`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const r=e.applyColormap?w`fragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:w`fragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;t.fragment.code.add(w`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${e.stretchType===ox.Noop?w`
        fragColor = applyBackgroundBlend(currentPixel);`:w`
        if (currentPixel.a == 0.0) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${r}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          fragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function i0t(t,e){const r=t.fragment;r.uniforms.add(new rt("u_image",s=>s.u_image),new ZP("u_hillshadeType",s=>s.symbolizer.u_hillshadeType),new $l("u_sinZcosAs",s=>s.symbolizer.u_sinZcosAs,6),new $l("u_sinZsinAs",s=>s.symbolizer.u_sinZsinAs,6),new $l("u_cosZs",s=>s.symbolizer.u_cosZs,6),new $l("u_weights",s=>s.symbolizer.u_weights,6),new Ar("u_factor",s=>s.symbolizer.u_factor),new Ie("u_minValue",s=>s.symbolizer.u_minValue),new Ie("u_maxValue",s=>s.symbolizer.u_maxValue),new Ar("u_srcImageSize",s=>s.common.u_srcImageSize)),r.include(Lm),r.code.add(w`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`),r.code.add(w`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const i=e.applyColormap?w`fragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:w`hillshade *= alpha;
fragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;r.code.add(w`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture(u_image, pixelLocation);
      vec4 vf = texture(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${i}
    }
  `)}const s0t=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:Kgt,ColorizerStretchUniforms:Qgt,ColorizerUniforms:H9,build:e0t},Symbol.toStringTag,{value:"Module"}));function n0t(t,e,r="nearest",i=!1){const s=!(i&&e.pixelType==="u8"),n=s?qs.FLOAT:qs.UNSIGNED_BYTE,o=e.pixels==null||e.pixels.length===0?null:s?e.getAsRGBAFloat():e.getAsRGBA(),a=t.capabilities.textureFloat?.textureFloatLinear,l=new xr;return l.width=e.width,l.height=e.height,l.internalFormat=t.type===lr.WEBGL2&&s?Ke.RGBA32F:Ct.RGBA,l.samplingMode=!a||r!=="bilinear"&&r!=="cubic"?Rt.NEAREST:Rt.LINEAR,l.dataType=n,l.wrapMode=Dt.CLAMP_TO_EDGE,new Ot(t,l,o)}function o0t(t,e){const{spacing:r,offsets:i,coefficients:s,size:[n,o]}=e,a=r[0]>1,l=new xr;l.width=a?4*n:n,l.height=o,l.internalFormat=t.type===lr.WEBGL2?Ke.RGBA32F:Ct.RGBA,l.dataType=qs.FLOAT,l.samplingMode=Rt.NEAREST,l.wrapMode=Dt.CLAMP_TO_EDGE;const c=new Float32Array(a?n*o*16:2*i.length);if(a&&s!=null)for(let h=0,d=0;h<s.length;h++)c[d++]=s[h],h%3==2&&(c[d++]=1);else for(let h=0;h<o;h++)for(let d=0;d<n;d++){const f=4*(h*n+d),m=2*(d*o+h);c[f]=i[m],c[f+1]=i[m+1],c[f+3]=i[m]===-1?0:1}return new Ot(t,l,c)}function Mue(t,e){const r=new xr;return r.internalFormat=Ct.RGBA,r.width=e.length/4,r.height=1,r.samplingMode=Rt.NEAREST,r.wrapMode=Dt.CLAMP_TO_EDGE,new Ot(t,r,e)}function a0t(t,e,r,i=1,s=!0){return{u_flipY:s,u_applyTransform:!!t,u_opacity:i,u_transformSpacing:t?t.spacing:Pp,u_transformGridSize:t?t.size:Pp,u_targetImageSize:e,u_srcImageSize:r}}function l0t(t,e){return{u_colormapOffset:e||0,u_colormapMaxIndex:t?t.length/4-1:0}}function c0t(t){return{u_bandCount:t.bandCount,u_minOutput:t.outMin,u_maxOutput:t.outMax,u_minCutOff:t.minCutOff,u_maxCutOff:t.maxCutOff,u_factor:t.factor,u_useGamma:t.useGamma,u_gamma:t.gamma,u_gammaCorrection:t.gammaCorrection}}function u0t(t){return{u_hillshadeType:t.hillshadeType,u_sinZcosAs:t.sinZcosAs,u_sinZsinAs:t.sinZsinAs,u_cosZs:t.cosZs,u_weights:t.weights,u_factor:t.factor,u_minValue:t.minValue,u_maxValue:t.maxValue}}const Pue={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};let h0t=class{constructor(e,r,i=null,s=null){this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.opacity=1,this.lij=e,this.source=r,this.width=i||r.width,this.height=s||r.height}get source(){return this._source}set source(e){this._source=e,this._rasterTexture=je(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?{...Pue,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||Pue}set symbolizerParameters(e){this._symbolizerParameters=e}get bandIds(){return this._bandIds}set bandIds(e){e!=null&&e.length>0?this._bandIds&&e.every((r,i)=>!!this._bandIds?.[i]&&r===this._bandIds[i])||(this._bandIds=e,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(e){if(this._interpolation=e,this._rasterTexture!=null){const r=this._getRasterTextureInterpolation(e);this._rasterTexture.setSamplingMode(r==="bilinear"?Rt.LINEAR:Rt.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(e){this._transformGrid=e,this._transformGridTexture=je(this._transformGridTexture),this._memoryUsed=null}bind(e){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&((this._rasterTexture==null||this._dirty)&&this._updateRasterTexture(e,this.bandIds),this._rasterTexture!=null&&(this._updateColormapTexture(e),this.transformGrid&&this._transformGridTexture==null&&(this._transformGridTexture=o0t(e,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:e,transformGrid:r,width:i,height:s,opacity:n}=this,o=a0t(r,[i,s],[this.source.width,this.source.height],n),a=l0t(e.colormap,e.colormapOffset),l=this.symbolizerParameters.type==="stretch"?c0t(this.symbolizerParameters):null,c=this.symbolizerParameters.type==="hillshade"?u0t(this.symbolizerParameters):null;return new H9(o,a,l||c,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get isBilinearWithStretchColorRamp(){const{symbolizerParameters:e}=this;return this.interpolation==="bilinear"&&e.colormap!=null&&e.type==="stretch"}get memoryUsage(){if(this._memoryUsed==null){const e=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=e.map(r=>r!=null?r.descriptor.width*r.descriptor.height*4:0).reduce((r,i)=>r+i,0)}return this._memoryUsed}release(){return this._rasterTexture=je(this._rasterTexture),this._transformGridTexture=je(this._transformGridTexture),this._colormapTexture=je(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(e,r){const i=this.source?this.source.extractBands(r):null;if(!(i&&i.pixels&&i.pixels.length>0))return void(this._rasterTexture=je(this._rasterTexture));const s=r==null&&this.bandIds==null||r!=null&&this.bandIds!=null&&r.join("")===this.bandIds.join("");if(this._rasterTexture!=null&&s)return;this._rasterTexture=je(this._rasterTexture);const n=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=n0t(e,i,n,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&this.symbolizerParameters.stretchType==="none"&&!this.symbolizerParameters.useGamma&&this.source.pixelType==="u8"}_getRasterTextureInterpolation(e){return this.symbolizerParameters.type==="lut"||e==="nearest"||e==="majority"||this.isBilinearWithStretchColorRamp?"nearest":"bilinear"}_updateColormapTexture(e){const r=this._colormap,i=this.symbolizerParameters.colormap;return i?r?i.length!==r.length||i.some((s,n)=>s!==r[n])?(this._colormapTexture=je(this._colormapTexture),this._colormapTexture=Mue(e,i),void(this._colormap=i)):void 0:(this._colormapTexture=Mue(e,i),void(this._colormap=i)):(this._colormapTexture=je(this._colormapTexture),void(this._colormap=null))}},XN=class{constructor(){this.waitingAgents=new Vt,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(e){const r=dV.acquire();return r._init(e),r}release(){this.dispose(),YN.delete(this),dV.release(this)}dispose(){this.loadingAgent=je(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=qS(this._data)}static prune(){dV.prune(0)}_init(e){this.waitingAgents.clear(),this._data=qS(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=e,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=zl(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){this._upsampleInfo!=null&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(e,r){if(e!==r&&r!=null){if(this._upsampleInfo==null)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===r)return;this._upsampleInfo.tile.unrefMapData()}r.refMapData(),Ggt(e,r,this._upsampleInfo)}else this._unsetUpsampleInfo()}get data(){return this._data}set data(e){qS(this._data),this._data=e}};const dV=new qo(XN,null,()=>{}),YN=new Map;function d0t(){YN.size>0&&(console.log(`${YN.size} live TilePerLayerInfo allocations:`),YN.forEach(t=>console.log(t,`
`)))}let I2=class{constructor(e){this._texture=e,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){--this._refCount,this._refCount===0&&this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}get gpuMemoryUsage(){return this._texture.gpuMemoryUsage}};var wt;(function(t){t[t.NONE=0]="NONE",t[t.SPLIT=1]="SPLIT",t[t.ELEVATION=2]="ELEVATION",t[t.MERGE=4]="MERGE",t[t.RENDERDATA=8]="RENDERDATA",t[t.GEOMETRY=16]="GEOMETRY",t[t.TEXTURE_NOFADING=32]="TEXTURE_NOFADING",t[t.TEXTURE_FADING=64]="TEXTURE_FADING"})(wt||(wt={}));const p0t=.1;let bee=class{constructor(){this.lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this.renderData=null,this._dirty=!0,this._previouslyRendered=!1,this.extent=zt(),this._elevationBounds=He(),this.layerInfo=[[],[]],this.extentInRadians=zt(),this.centerAtSeaLevel=O(),this._center=[O(),xs(),O()],this.up=yZ(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemoryInternal=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=O()}static prune(){wee.prune(0),xee.prune(0),XN.prune()}get _isCached(){return!this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[Gs.MIDDLE][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){this._dirty=!1;const e=this.parent,r=e?.frustumVisibility??ca.INTERSECTS;this._frustumVisibility=r===ca.INSIDE?ca.INSIDE:r===ca.OUTSIDE?ca.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);const i=this._frustumVisibility!==ca.OUTSIDE&&this._intersectsClippingArea;i!==this._visible&&(this._visible=i,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const e=!!this.renderData;return e!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=e,this._surface.renderer.setDirty()),e}get shouldLoad(){return this.isLeaf}init(e,r,i){this.lij[0]=e[0],this.lij[1]=e[1],this.lij[2]=e[2],this.ellipsoid=Vr(i.tilingScheme.spatialReference),i.tilingScheme.getExtent(e[0],e[1],e[2],this.extent),i.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,i.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[Gs.MIDDLE][3]=0,this.elevationLevel=e?e[0]:0,r&&r.elevationBounds?yn(this._elevationBounds,r.elevationBounds):or(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=r,this.unsetChildren(),this._surface=i,this.updateVisibility();for(const s of pb){const n=i.numLayers(s),o=this.layerInfo[s];for(const a of o)a.release();o.length=n;for(let a=0;a<n;a++)o[a]=XN.acquire(this._surface.upsampleInfoPool),s===tr.ELEVATION&&this.findElevationBoundsForLayer(a,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(i.tilingScheme.pixelSize,YA)}release(){Nf(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const e of pb){for(const r of this.layerInfo[e])r.release();this.layerInfo[e].length=0}this._parent=null;for(let e=0;e<4;++e)this._children[e]=null;this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this._isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this._isCached){this.setMemoryDirty();const e=this._cachedMemory;e>0&&this._surface.upsampleMapCache.put(this.key,this,e)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}get _cachedMemory(){return this._isCached?this._mapTileMemory:0}get _mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[tr.MAP].reduce((e,r)=>e+(r instanceof hV?r.memoryUsed/r.referenced:0),this._mapTileMemoryInternal)}get _cpuImageMemorySize(){const r=this._surface.tilingScheme.pixelSize;return r*r*4}_ensureUsedMemory(){if(this._usedMemory!=null)return this._usedMemory;this._usedMemory=0,this._mapTileMemoryInternal=0;let e=0;for(const{data:i}of this.layerInfo[tr.MAP])i instanceof hV?e+=this._getTerrainDataMemory(i):this._mapTileMemoryInternal+=this._getTerrainDataMemory(i);const r=this._cpuImageMemorySize;for(const i of this.layerInfo[tr.ELEVATION])this._usedMemory+=i.data?r:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemoryInternal+=this.renderData.texture?.gpuMemoryUsage??0),this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+e),this._usedMemory}getUsedMemoryForLayer(e,r){const i=this.layerInfo[e][r];return i?.data?e===tr.MAP?this._isCached?0:this._getTerrainDataMemory(i.data):e===tr.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(e){return e instanceof I2?e.texture.gpuMemoryUsage:e instanceof HTMLImageElement||e instanceof V9?this._cpuImageMemorySize:e instanceof h0t?e.memoryUsage:e instanceof hV?e.memoryUsed/e.referenced:0}updateScreenDepth(e){const r=this._center[Gs.MIDDLE],i=e,s=r[0],n=r[1],o=r[2],a=i[2]*s+i[6]*n+i[10]*o+i[14];this.screenDepth=a<0?0:a/(i[3]*s+i[7]*n+i[11]*o+i[15])}shouldSplit(e,r,i){if(!this.visible||e.frustum!=null&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(e.frustum)===ca.OUTSIDE))return wt.NONE;const s=this.level;fe($L,this._center[Gs.MIDDLE],r);let n=da($L),o=$L,a=Gs.MIDDLE;fe(pV,this._center[Gs.TOP],r);const l=da(pV);l<n&&(n=l,o=pV,a=Gs.TOP),fe(fV,this._center[Gs.BOTTOM],r);const c=da(fV);if(c<n&&(n=c,o=fV,a=Gs.BOTTOM),this._edgeLen2>n&&s<e.maxLod)return wt.SPLIT;const h=i!=null?i-s:1/0,d=Math.sqrt(n),f=e.fovX*d*2,m=this._edgeLen/f,g=()=>{if(s<e.maxLod)return this.elevationLevel=s,wt.NONE;const R=s+Math.ceil(-Math.log2(e.relativeWidthLimit/m));return R!==this.elevationLevel?(this.elevationLevel=R,wt.ELEVATION):wt.NONE};if(h<=.5)return g();const _=ye(this.up,$L),v=this._elevationBounds[1]-this._elevationBounds[0],b=v/this.edgeLen;if(e.aboveGround&&_>0&&b<.001&&_/d-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-b>0)return wt.NONE;const T=i!=null?3-Math.min(h,2):1;if(m*T<e.relativeWidthLimit||s>=e.maxLod)return g();if(s<7)return wt.SPLIT;se(ao,this.up,_),fe(ao,ao,o);const x=da(ao);if(x<=this.radius*this.radius)return wt.SPLIT;se(ao,ao,this.radius/Math.sqrt(x)),de(ao,ao,this._center[a]),fe(ao,r,ao);const S=Math.min(1,(Math.abs(ye(ao,this.up))+.5*v+this._curvatureHeight)/Re(ao)),E=p0t/e.angledSplitBias,A=e.fovY*d*2;return S*(this._edgeLen/A*T)<E*e.relativeHeightLimit?wt.NONE:wt.SPLIT}setChildren(e,r,i,s){Nf(!!(e&&r&&i&&s),"Null child passed"),this._children[0]=e,this._children[1]=r,this._children[2]=i,this._children[3]=s}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){return this.renderData?.hasGeometry??!1}load(){this.refMapData();for(const e of pb)this._createOrUpdateAgents(0,e);this.surface.renderer.loadTile(this)}unload(e){e.unloadTile(this);for(const r of pb){const i=this.layerInfo[r];for(const s of i)s.loadingAgent&&s.loadingAgent!==ec&&(IL(s.loadingAgent),s.loadingAgent=null),s.pendingUpdates=0}this.resetPendingUpdate(wt.GEOMETRY),this.resetPendingUpdate(wt.TEXTURE_NOFADING),this.resetPendingUpdate(wt.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const e=this.layerInfo[tr.MAP];for(const r of e)r.loadingAgent&&r.loadingAgent!==ec&&(IL(r.loadingAgent),r.loadingAgent=null),r.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(e){if(dw(e,this._clippingArea))return!1;const r=this._intersectsClippingArea,i=this._isWithinClippingArea;e!=null?(this._intersectsClippingArea=this.intersectsExtent(e),this._isWithinClippingArea=this._isWithinExtent(e)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=e,this.updateVisibility();const s=i&&this._isWithinClippingArea,n=!(i||r||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||s||n||this.setPendingUpdate(wt.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(e,r){return this.layerInfo[r][e]}hasLayerData(e,r){const i=this.layerInfo[r][e];return!(!i||!i.data||i.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const e of pb){const r=this.layerInfo[e];for(const i of r)if(i.loadingAgent&&i.loadingAgent!==ec&&i.loadingAgent.updating)return!0}return!1}_isSuspended(e){return!!this.hasPendingUpdate(wt.SPLIT)||e!==tr.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(e){return(this._pendingUpdates&e)===e}setPendingUpdate(e){this._pendingUpdates|=e,e===wt.SPLIT||e===wt.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(e){return!!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)}requestLayerData(e,r,i){const s=this.layerInfo[r][e];if(s.waitingAgents.has(i))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),i.tile.lij.toString(),r,e),!0;if(s.waitingAgents.push(i),s.data&&!s.dataInvalidated){console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),i.tile.lij.toString(),r,e);const a=s.data&&"type"in s.data&&s.data.type==="vector-tile";return i.dataArrived(this,a),!0}if(s.requestPromise)return!0;zl(s.requestAbort),s.requestAbort=new AbortController;const n=this._surface.requestTileData(this,e,r,s.requestAbort);if(!n)return s.requestAbort=null,!1;const o=()=>{s.requestPromise===n&&(s.requestPromise=null,s.requestAbort=null)};return s.requestPromise=n,n.then(o,o),!0}get isLeaf(){return this._children[0]==null}hasLij(e){return this.lij[0]===e[0]&&this.lij[1]===e[1]&&this.lij[2]===e[2]}findByLij(e){if(this.hasLij(e))return this;const r=this._children;return r[0]?r[0].findByLij(e)||r[1].findByLij(e)||r[2].findByLij(e)||r[3].findByLij(e):null}distanceToSquared(e){return da(fe(ao,this._center[Gs.MIDDLE],e))}containsPoint(e){const r=this.extent;return e[0]>=r[0]&&e[1]>=r[1]&&e[0]<=r[2]&&e[1]<=r[3]}containsPointXY(e,r){const i=this.extent;return e>=i[0]&&r>=i[1]&&e<=i[2]&&r<=i[3]}unrequestLayerData(e,r,i){const s=this.layerInfo[r][e],n=s.waitingAgents,o=n.removeUnordered(i)!=null;Nf(o,"agent has not requested this piece of map data"),n.length<1&&(s.abortRequest(),this.setMemoryDirty())}dataArrived(e,r,i){const s=i!=null&&"type"in i&&i.type==="vector-tile",n=this.layerInfo[r][e];n.data=i,n.dataInvalidated=!1,n.waitingAgents.forAll(o=>o.dataArrived(this,s)),n.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(e,r,i){i.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${r}/${e} error ${i}`);const s=this.layerInfo[r][e];s.dataMissing=!0,s.waitingAgents.forAll(n=>n.dataMissing()),s.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(e,r,i){switch(i&&this.forEachLoadedNeighbor(s=>s.updateRenderData(e,r)),e){case tr.MAP:return this._updateTexture(r);case tr.ELEVATION:return this._updateGeometry()}}_updateTexture(e){this.renderData&&(this.resetPendingUpdate(e===cn.FADING?wt.TEXTURE_NOFADING:wt.TEXTURE_FADING),this.setPendingUpdate(e===cn.FADING?wt.TEXTURE_FADING:wt.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(wt.GEOMETRY);for(const e of this.layerInfo[tr.ELEVATION])e.pendingUpdates|=wt.GEOMETRY}invalidateLayerData(e,r){this.layerInfo[r][e].invalidateSourceData(),this.restartAgents(r)}computeElevationBounds(){const e=this._elevationBounds,r=e[0],i=e[1];or(e,1/0,-1/0);const s=this.layerInfo[tr.ELEVATION];let n=!0;for(const o of s)o.elevationBounds!=null&&(e[0]=Math.min(e[0],o.elevationBounds.min),e[1]=Math.max(e[1],o.elevationBounds.max),o.elevationBounds.hasNoDataValues||(n=!1));n&&(e[0]=Math.min(e[0],0),e[1]=Math.max(e[1],0)),r===e[0]&&i===e[1]||(this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){const e=this._elevationBounds,r=.5*(e[0]+e[1]),i=this._center;se(ao,this.up,r),de(i[Gs.MIDDLE],this.centerAtSeaLevel,ao),se(ao,this.up,e[0]),de(i[Gs.TOP],this.centerAtSeaLevel,ao),se(ao,this.up,e[1]),de(i[Gs.BOTTOM],this.centerAtSeaLevel,ao)}findElevationBoundsForLayer(e,r){const i=this.layerInfo[tr.ELEVATION][e],s=Sj(this.level),n=Math.max(this.elevationLevel-s,0),o=i.elevationBounds;if(o!=null&&o.level>=r&&o.level<=n)return;const a=this._surface.layerViewByIndex(e,tr.ELEVATION),l=Gq(a);if(!jR(this,l,!1))return;const c=m0t;let h=!1;const d=i.data;if(d&&d.level<=n){const f=i.data;c.min=f.samplerData.data.minValue,c.max=f.samplerData.data.maxValue,c.hasNoDataValues=f.samplerData.data.hasNoDataValues,c.level=this.level,h=!0}else{let f,m,g=0;for(let _=this._parent;_&&(!m||g<s)&&(g=this.elevationLevel-_.level,f=m||f,m=_.layerInfo[tr.ELEVATION][e].data,!(!m&&f&&_.level<=n));_=_.parent);m=m||f,m&&(m.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],c),c.min!==1/0&&(c.level=m.level,h=!0))}h&&(i.elevationBounds==null&&(i.elevationBounds=new wS),i.elevationBounds.copyFrom(c))}modifyLayers(e,r,i){const s=this.layerInfo[i];for(const a of s)a.loadingAgent&&a.loadingAgent!==ec&&(IL(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<s.length;++a)e[a]===void 0&&s[a].release();const n=new Array(...s),o=r.length;s.length=o;for(let a=0;a<o;a++){const l=r[a];s[a]=l>-1?n[l]:XN.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e,cn.FADING))}updateAgents(e){if(this.renderData){const r=this.layerInfo[e];for(const i of r)i.loadingAgent===ec&&(i.loadingAgent=null);this._createOrUpdateAgents(0,e)}}updateAgentSuspension(){for(const e of pb){const r=this._isSuspended(e);for(const i of this.layerInfo[e])i.loadingAgent&&i.loadingAgent!==ec&&(i.loadingAgent.setSuspension(r),i.loadingAgent===ec&&this.updateRenderData(e,cn.FADING))}}removeLayerAgent(e,r){const i=this.layerInfo[r][e];i.loadingAgent&&i.loadingAgent!==ec&&i.loadingAgent.dispose(),i.loadingAgent=null}agentDone(e,r){const i=this.layerInfo[r][e];i.loadingAgent=ec,i.data||i.upsampleInfo!=null||this._createOrUpdateAgents(e+1,r)}_hasBlendableAncestor(e){return e.blendMode!=="normal"||mE(e.parent)&&this._hasBlendableAncestor(e.parent)}_hasBlendModes(e,r,i){for(let s=e;s<r;++s){const n=this._surface.layerViewByIndex(s,i);if(FF(n)&&n?.layer?.blendMode!=="normal"||mE(n?.layer?.parent)&&this._hasBlendableAncestor(n?.layer?.parent))return!0}return!1}_createOrUpdateAgents(e,r){const i=this.layerInfo[r];if(i.length===0)return;const s=this._isSuspended(r);for(let n=e;n<i.length;++n){const o=i[n];let a=!1;const l=this._surface.layerViewByIndex(n,r),c=Gq(l);if(o.loadingAgent?jR(this,c,!1)?(o.loadingAgent!==ec&&o.loadingAgent.setSuspension(s),o.loadingAgent!==ec&&(a=o.loadingAgent.update())):o.dispose():jR(this,c,!1)&&(o.loadingAgent=f0t(this,n,r,s),a=o.loadingAgent.startLoading(),a?o.loadingAgent===ec&&this.setPendingUpdate(wt.GEOMETRY):(IL(o.loadingAgent),o.loadingAgent=ec)),o.loadingAgent===ec&&this.updateRenderData(r,cn.FADING),!this._hasBlendModes(e,i.length,r)&&a&&l.isOpaque)return}}_isWithinExtent(e){const r=this.extent;return r[0]>=e[0]&&e[2]>=r[2]&&r[1]>=e[1]&&e[3]>=r[3]}intersectsExtent(e){const r=this.extent;return r[2]>=e[0]&&e[2]>=r[0]&&r[3]>=e[1]&&e[3]>=r[1]}getElevationVerticesPerSide(e){const r=this.elevationLevel-this.level,i=Math.max(this.level-e,Sj(this.level)-r),s=ve(1+(this.maxTesselation>>i),2,this.maxTesselation+1),n=this.getDefaultVerticesPerSide();return Math.max(s,n)}get test(){return{cachedMemory:this._cachedMemory}}_findLIJ(e,r){if(!e)return null;const i=this.surface.rootTiles;if(i!=null){for(const s of i)if(g0t(s,e)){let n=s,o=e[0]-n.level-1;for(;o>=0&&!n.isLeaf&&!r(n);){const a=e[1]>>o&1,l=e[2]>>o&1;n=n.children[2*a+l],o--}return r(n)?n:null}}return null}findNeighborTile(e,r){const i=this.lij,s=this.getNeighborLIJ(i,e);return s?y0t(i,s)?r(this)?this:null:this._findLIJ(s,r):null}findCorner(e,r){const i=e===ht.NORTH_EAST?1:e===ht.NORTH_WEST?0:e===ht.SOUTH_WEST?2:3;let s=this;for(;s.children[0]&&(!r||!r(s));)s=s.children[i];return s}findNeighborCornerTileExact(e,r){return this.findNeighborTile(e,i=>r(i)||i.level===this.level)?.findCorner(UF(e),r)||null}forAllSubtreeOnSide(e,r){const i=e===ht.NORTH?[0,1]:e===ht.NORTH_EAST?[1]:e===ht.EAST?[1,3]:e===ht.SOUTH_EAST?[3]:e===ht.SOUTH?[2,3]:e===ht.SOUTH_WEST?[2]:e===ht.WEST?[0,2]:[0],s=n=>{const o=n.children;!r(n)&&o[0]&&i.forEach(a=>s(o[a]))};s(this)}forallNeighbors(e){HM.forEach(r=>this.findNeighborCornerTileExact(r,e)),Yf.forEach(r=>this.findNeighborTile(r,i=>i.level===this.level||e(i))?.forAllSubtreeOnSide(kF(r),e))}getNeighborEdgeStartVertexIndex(e,r){if(!r)return 0;const i=this.level-r.level;if(Ee(!dn||i>=0),i===0)return 0;const s=2**i,n=(1&e)==1,o=n?0:1,a=r.lij[o+1]*s,l=this.lij[o+1],c=l-a,h=n?s-1-c:c;return dn&&(Ee(a<=l&&l<a+s),Ee(0<=h&&h<s)),h}forEachLoadedNeighbor(e){const r=this.level,i=s=>s.level===r||s.isLoaded;Yf.forEach(s=>{const n=this.findNeighborTile(s,i);n!=null&&n!==this&&n.forAllSubtreeOnSide(kF(s),o=>!!o.isLoaded&&(e(o,s),!0))}),HM.forEach(s=>{const n=this.findNeighborTile(s,i)?.findCorner(UF(s),o=>o.isLoaded);Ee(!n||Jq(this,n,s)),n?.isLoaded&&e(n,s)})}getNeighborLIJ(e,r){const i=vue(r)?-1:_ue(r)?1:0,s=gue(r)?-1:yue(r)?1:0,n=[e[0],e[1]+i,e[2]+s];return n[1]<0?null:this.surface.isGlobal?this.wrapLIJ(n):n[2]<0?null:n}wrapLIJ(e){return!e||e[1]<0||e[1]>=2**e[0]?null:this.surface.wrapEastWest(e)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this.lij[2]===0}get isNorthEnd(){return this.lij[1]===0}get isSouthEnd(){const e=this.surface.extent,r=e?.[1]??null;return r!=null&&this.extent[1]+cl()>=r}checkGeometryWaterproofness(){DF&&(Ee(this.isLoaded),this.renderData?.checkGeometryWaterproofness())}shouldHaveNeighbor(e){const r=this.extent,i=this.surface.rootTilesExtent,s=.25*(r[2]-r[0]);if(vue(e)&&r[3]+s>=i[3]||_ue(e)&&r[1]-s<=i[1])return!1;const n=this.surface.isGlobal;return!(!n&&gue(e)&&r[0]-s<=i[0])&&!(!n&&yue(e)&&r[2]+s>=i[2])}updateDistanceToPOI(e){const r=this._lastPOI;if(this.distanceToPOI>=0&&r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2])return;ie(this._lastPOI,e);const i=this._center[Gs.MIDDLE],s=e[0]-i[0],n=e[1]-i[1],o=e[2]-i[2];this.distanceToPOI=s*s+n*n+o*o}};function f0t(t,e,r,i){const s=r===tr.ELEVATION?xee.acquire():wee.acquire();return s.init(t,e,r,i),s}function IL(t){t.dispose(),t instanceof sRe?xee.release(t):t instanceof nRe&&wee.release(t)}const wee=new qo(nRe),xee=new qo(sRe),m0t=new wS;var Gs;function g0t(t,e){const r=t.level,i=e[0];if(r>i)return!1;const s=i-r,n=Math.floor(e[1]/2**s),o=Math.floor(e[2]/2**s);return n===t.lij[1]&&o===t.lij[2]}function y0t(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function _0t(t,e,r){if(t==null||e==null)return!1;if(t.level===0&&e.level===0&&(t.isEastEnd&&e.isWestEnd&&r===ht.EAST||t.isWestEnd&&e.isEastEnd&&r===ht.WEST))return!0;const i=Math.max(1e-6*(t.extent[2]-t.extent[0]),1);switch(r){case ht.NORTH:return Mh(t.extent[3],e.extent[1],i);case ht.SOUTH:return Mh(t.extent[1],e.extent[3],i);case ht.EAST:return Mh(t.extent[2],e.extent[0],i)||Mh(t.extent[2],-e.extent[0],i);case ht.WEST:return Mh(t.extent[0],e.extent[2],i)||Mh(t.extent[0],-e.extent[2],i)}}function Jq(t,e,r){return t!=null&&e!=null&&e!==t&&(t.level>=e.level?Iue(t,e,r):Iue(e,t,UF(r)))}function Iue(t,e,r){Ee(t.level>=e.level);const i=Imt(r),s=$mt(r),n=t.extent,o=e.extent,a=[i?n[0]:n[2],s?n[3]:n[1]],l=[i?o[2]:o[0],s?o[1]:o[3]],c=1e-5*(n[2]-n[0]),h=Mh(a[0],l[0],c)||t.surface.isGlobal&&Mh(a[0],-l[0],c),d=Mh(a[1],l[1],c);if(h&&d)return!0;if(t.level===e.level||!h&&!d)return Ee(!1),!1;const f=h?$ue(o[1],o[3],n[1],n[3],c):$ue(o[0],o[2],n[0],n[2],c);return Ee(f),f}function $ue(t,e,r,i,s){return t-s<=r&&r<=i&&i<=e+s}(function(t){t[t.TOP=0]="TOP",t[t.MIDDLE=1]="MIDDLE",t[t.BOTTOM=2]="BOTTOM"})(Gs||(Gs={}));const $L=O(),pV=O(),fV=O(),ao=O();let v0t=class{constructor(){this._scales=Nt(-1,-1,-1,-1),this._offsets=Nt(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(e,r,i){this._scales[2*e]=r,this._scales[2*e+1]=i}setOffset(e,r,i){this._offsets[2*e]=r,this._offsets[2*e+1]=i}get scales(){return this._scales}get offsets(){return this._offsets}};function b0t(t,e){t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),e.spherical?t.vertex.code.add(w`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):t.vertex.code.add(w`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),t.fragment.code.add(w`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}let Tee=class extends y3e{constructor(){super(...arguments),this.slicePlaneLocalOrigin=O(),this.origin=this.slicePlaneLocalOrigin,this.modelTransformation=null}};var Ec;(function(t){t[t.Material=0]="Material",t[t.ShadowMap=1]="ShadowMap",t[t.Highlight=2]="Highlight"})(Ec||(Ec={}));let w0t=class extends Tee{constructor(){super(...arguments),this.identifier=Ec.Material,this.output=F.Color,this.transparent=!1,this.integratedMesh=!1}},x0t=class extends Tee{constructor(){super(...arguments),this.identifier=Ec.ShadowMap}},T0t=class extends Tee{constructor(){super(...arguments),this.identifier=Ec.Highlight}},zF=class extends ps{constructor(e,r){super(e,"vec4",ti.Draw,(i,s,n)=>i.setUniform4fv(e,r(s,n)))}};var l0;function S0t(t,e){const{vertex:r,fragment:i}=t;r.uniforms.add(new zF("overlayTexOffset",(s,n)=>E0t(s,n)),new zF("overlayTexScale",(s,n)=>C0t(s,n))),i.constants.add("overlayOpacity","float",1),i.uniforms.add(new rt("ovColorTex",(s,n)=>Qq(s,n))),cRe(t,e)}function cRe(t,e){e.pbrMode!==ut.Water&&e.pbrMode!==ut.WaterOnIntegratedMesh&&e.pbrMode!==ut.TerrainWithWater||t.include(b3e,e);const{vertex:r,fragment:i}=t;t.varyings.add("vtcOverlay","vec4"),r.code.add(w`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),i.code.add(w`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),i.code.add(w`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),i.code.add(w`vec4 getOverlayColorTexel(vec4 texCoords) {
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y)*texDim), 0);
vec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w)*texDim), 0);
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),e.pbrMode!==ut.Water&&e.pbrMode!==ut.WaterOnIntegratedMesh&&e.pbrMode!==ut.TerrainWithWater||(I0(i),$m(i),i.code.add(w`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function Qq(t,e){return e.overlays.length===0?null:t.identifier===Ec.Material&&t.output===F.Color?e.overlays[Di.INNER].getColorTextureNoRasterImage():t.identifier===Ec.Material&&t.output===F.ObjectAndLayerIdColor?e.overlays[Di.INNER].getColorTexture(Ya.ObjectAndLayerIdColor):t.identifier===Ec.Highlight?e.overlays[Di.INNER].getValidTexture(as.Highlight):null}function E0t(t,e){for(const r of e.overlays){const{index:i,extent:s}=r;Xye(s)>0&&(WS[2*i]=t.toMapSpace[0]/vu(s)-s[0]/vu(s),WS[2*i+1]=t.toMapSpace[1]/Op(s)-s[1]/Op(s))}return WS}function C0t(t,e){for(const r of e.overlays){const{index:i,extent:s}=r;Xye(s)>0&&(WS[2*i]=t.toMapSpace[2]/vu(s),WS[2*i+1]=t.toMapSpace[3]/Op(s))}return WS}(function(t){t[t.Disabled=0]="Disabled",t[t.Enabled=1]="Enabled",t[t.EnabledWithWater=2]="EnabledWithWater",t[t.COUNT=3]="COUNT"})(l0||(l0={}));const WS=Wt();var Zf;(function(t){t[t.LayerOnly=0]="LayerOnly",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.COUNT=3]="COUNT"})(Zf||(Zf={}));let A0t=class extends NK{constructor(){super(...arguments),this.overlayOpacity=1,this.overlaySource=Ya.None}};function W3(t,e){t.vertex.uniforms.add(new VF("overlayTexOffset"),new VF("overlayTexScale")),t.fragment.uniforms.add(new Ie("overlayOpacity",r=>r.overlayOpacity),new rt("ovColorTex",(r,i)=>i.overlays.length===0?null:i.overlays[Di.INNER].getColorTexture(r.overlaySource))),cRe(t,e)}function O0t(t,e){const{vertex:r,fragment:i,varyings:s}=t;s.add("vtc","vec2"),r.uniforms.add(new VF("texOffsetAndScale")),i.uniforms.add(new Lue("tex")),i.uniforms.add(new mV("textureOpacities"));const n=e.textureFadingEnabled&&!e.renderOccluded;n&&(r.uniforms.add(new VF("nextTexOffsetAndScale")),s.add("nvtc","vec2"),i.uniforms.add(new Lue("texNext")),i.uniforms.add(new mV("nextTexOpacities")),i.uniforms.add(new R0t("fadeFactor")));const o=e.tileBlendInput===Zf.ColorComposite,a=e.tileBlendInput===Zf.GridComposite;a&&i.include(vee),o&&i.uniforms.add(new mV("backgroundColor")),r.code.add(w`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${n?w`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:w``}
  }`),i.code.add(w`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${a||o?w`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${o?w`backgroundColor`:w`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:w`return color;`}
    }`),n?i.code.add(w`vec4 getTileColor() {
vec4 color = getColor(texture(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):i.code.add(w`vec4 getTileColor() {
return getColor(texture(tex, vtc), vtc, textureOpacities);
}`)}let R0t=class extends ps{constructor(e){super(e,"float")}},mV=class extends ps{constructor(e){super(e,"vec3")}},VF=class extends ps{constructor(e){super(e,"vec4")}},Lue=class extends ps{constructor(e){super(e,"sampler2D")}},uRe=class extends A0t{};function M0t(t){const e=new Sr,{vertex:r,fragment:i,varyings:s}=e;e.include(IP),e.include(YP,t),e.include(sm,t);const n=()=>{e.include(kM,t),r.code.add(w`vec3 getNormal() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
vec3 n = vec3(normalCompressed + vec2(normalCompressed.x >= 0.0 ? 1.0 : -1.0,
normalCompressed.y >= 0.0 ? 1.0 : -1.0) * min(z, 0.0), z);
return normalize(n);
}`)};Dc(r,t),e.include(Nl,t);const o=t.overlayMode!==l0.Disabled,a=o&&t.invisible;switch(t.output){case F.Color:{e.include(O0t,t),e.include(sx,t),o&&e.include(W3,{...t,pbrMode:t.pbrMode===ut.Terrain?ut.TerrainWithWater:ut.Water});const l=t.overlayMode===l0.EnabledWithWater;l&&e.include(b0t,t),s.add("vnormal","vec3"),s.add("vpos","vec3"),s.add("vup","vec3"),n(),t.screenSizePerspective&&jE(r);const c=t.receiveShadows&&!t.renderOccluded;c&&e.include($C,t),t.screenSizePerspective&&(s.add("screenSizeDistanceToCamera","float"),s.add("screenSizeCosAngle","float")),r.code.add(w`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          //Up
          vup = getLocalUp(position, localOrigin);

          ${l?w`forwardVertexTangent(vnormal);`:w``}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${o?w`setOverlayVTC(uv);`:""}
          ${t.tileBorders?w`forwardTextureCoordinates();`:""}

          ${t.screenSizePerspective?w`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${c?w`forwardLinearDepth();`:""}

        }
      `),e.include(vs,t),e.include(sx,t),e.include(JP,t),e.include(rx,t),$p(i,t),QP(i),BC(i),i.uniforms.add(r.uniforms.get("localOrigin"),new kt("viewDirection",(h,d)=>_e(Due,ne(Due,d.camera.viewMatrix[12],d.camera.viewMatrix[13],d.camera.viewMatrix[14])))),l&&i.uniforms.add(new rt("ovWaterTex",(h,d)=>d.overlays.length===0?null:d.overlays[Di.INNER].getNormalTexture(h.overlaySource)),new CSe("view",(h,d)=>Gl(P0t,d.camera.viewMatrix,h.origin))),i.code.add(w`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),I0(i),$m(i),i.code.add(w`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${t.receiveShadows&&!t.renderOccluded?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${o?w`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${t.invisible?w`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a <= 0.0) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= sliceOpacity;
          }

          vec3 albedo = tileColor.rgb;

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${t.pbrMode===ut.Terrain||t.pbrMode===ut.TerrainWithWater?w`fragColor = vec4(evaluateTerrainLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:w`fragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${l?w`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                float opacity = sliced ? sliceOpacity : 1.0;
                // un-gamma the ground color to mix in linear space
                fragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
              }`:""}
          ${t.screenSizePerspective?w`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              fragColor = mix(fragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              fragColor = mix(fragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${t.visualizeNormals?t.spherical?w`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:w`
                  vec3 tNormal = normalize(normal);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:""}
          ${t.tileBorders?w`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          fragColor = highlightSlice(fragColor, vpos);
        }
      `)}break;case F.Depth:a&&e.include(W3,t),e.include(C0,t),yv(e),Yw(e),r.code.add(w`
              void main(void) {
                ${a?w`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
              }
          `),i.code.add(w`
              void main() {
                ${a?w`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
                outputDepth(linearDepth);
              }
          `);break;case F.Shadow:case F.ShadowHighlight:case F.ShadowExcludeHighlight:e.include(C0,t),yv(e),Yw(e),r.code.add(w`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),i.code.add(w`void main() {
outputDepth(linearDepth);
}`);break;case F.Normal:a&&e.include(W3,t),s.add("vnormal","vec3"),jE(r),n(),r.code.add(w`
            void main(void) {
              ${a?w`setOverlayVTC(getUV0());`:""}
              gl_Position = transformPosition(proj, view, position);
              vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);
            }
        `),i.code.add(w`
            void main() {
              ${a?w`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
              vec3 normal = normalize(vnormal);
              if (gl_FrontFacing == false) {
                normal = -normal;
              }
              fragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
            }
        `);break;case F.Highlight:o&&e.include(W3,t),r.code.add(w`
          void main() {
            ${o?w`setOverlayVTC(getUV0());`:""}
            gl_Position = transformPosition(proj, view, position);
          }
        `),e.include(z0,t),i.code.add(w`
          void main() {
            ${o?w`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
            outputHighlight();
          }
        `)}return t.output===F.ObjectAndLayerIdColor&&(e.include(W3,{...t,pbrMode:ut.Disabled}),r.code.add(w`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),i.code.add(w`void main() {
fragColor = getOverlayColorTexel(vtcOverlay);
}`)),e}const P0t=xe(),Due=O(),I0t=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:uRe,build:M0t},Symbol.toStringTag,{value:"Module"}));let hRe=class dRe extends Lr{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(e,r){r.spherical=e.viewingMode===Ve.Global}initializeProgram(e){return new Rr(e.rctx,dRe.shader.get().build(this.configuration),pRe)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(e){const r=this.configuration,i=r.backfaceCullingEnabled&&!r.renderOccluded;return Mt({blending:r.renderOccluded?zc(Se.ONE,Se.ONE_MINUS_SRC_ALPHA):null,culling:i?qJ:null,depthTest:r.renderOccluded?null:{func:ri.LESS},depthWrite:r.renderOccluded?null:jl,colorWrite:Bt,stencilTest:e?qnt(Ul.IntegratedMeshMaskExcluded):null})}getPipelineState(e,r){return this.useStencil?this._stencilPipelineState:super.getPipelineState(e,r)}};hRe.shader=new Or(I0t,()=>he(()=>import("./Terrain.glsl-3ab71e8b.js"),[],import.meta.url));const pRe=new Map([[C.POSITION,0],[C.UV0,1],[C.NORMALCOMPRESSED,2]]);let $0t=class{constructor(){this.geometry=new Mgt,this.intersectionData=null,this.geometryState=null,this._textureRef=new eRe(()=>this.tile.surface.textureFadeDuration),this.overlay=new v0t,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1,this._dirtyEdgeResolutions=15,this._dirtyEdges=15,this._dirtyCorners=15}get tile(){return this._tile}init(e){this.clear(),this._tile=e;const r=this.geometry;r.indices=null,r.vertexAttributes=null,Ei(r.boundingBox),r.indexCount=0,r.numVerticesPerSide=0,this.intersectionData=null,this.geometryState=new Ngt,this.localOrigin=null,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(e){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this._wireframeChanged||this._clippingAreaChanged||this._samplerDataChanged||this._numVerticesPerSideChanged||this._dirtyCorners||this._dirtyEdgeResolutions||this._dirtyEdges)&&(this._updateGeometry(e),this._geometryStateChangedSinceLastUpdate=!1),dn&&this.tile.intersectsClippingArea)for(let r=0;r<4;++r)Ee(this.geometry.outerEdges[r].count===this.geometryState.neighborData.edgeResolutions[r]+1)}_calculateEdgeResolution(e,r){const i=this.tile,s=this.geometryState.numVerticesPerSide-1;if(!i.surface.isGlobal){const l=i.surface.extent;if(l!=null&&(e===0&&i.extent[3]>l[3]||e===1&&i.extent[2]>l[2]||e===2&&i.extent[1]<l[1]||e===3&&i.extent[0]<l[0]))return s}const n=i.level,o=Yf[e];if(!r)return Ee(i.surface?.rootTiles==null||i.surface.updatingRootTiles||!i.shouldHaveNeighbor(o)),s;if(r.isLoaded){const l=r,c=l.renderData.geometryState,h=n-l.level;if(Ee(h>=0),h===0){const m=c.numVerticesPerSide-1;return Math.max(m,s)}const d=2**h,f=c.neighborData.edgeResolutions[(e+2)%4]/d;return Math.max(1,f)}Ee(!r.isLeaf);let a=s;return r.forAllSubtreeOnSide(kF(o),l=>l===i||(l.isLoaded?(a=Math.max(a,2**(l.level-n)),!0):(Ee(!l.isLeaf),!1))),a}updateNeighborData(){const e=this.tile;if(!e.intersectsClippingArea)return;const r=e.renderData.geometryState.neighborData,i=a=>(a.isLoaded||a.level===e.level)&&a?.intersectsClippingArea,s=r.edgePeerNeighbors,n=r.edgePeerNeighborSamplerVersions;for(let a=0;a<4;++a){const l=e.findNeighborTile(Yf[a],i),c=Hb(e,l),h=c?.renderData?.geometryState.samplerDataVersion??-1,d=s[a],f=c!==Hb(e,d),m=n[a]!==h;s[a]=l,(f||m)&&(n[a]=h,this._markEdgeDirty(a));const g=r.edgeResolutions[a],_=this._calculateEdgeResolution(a,l);Ee(kw(_)),Ee(_>=1),r.edgeResolutions[a]=_,g!==_&&this._markEdgeResolutionDirty(a)}const o=r.cornerPeerNeighbors;for(let a=0;a<4;++a){const l=e.findNeighborTile(HM[a],i);o[a]=l;const c=Hb(e,s[a]),h=Hb(e,s[(a+1)%4]),d=Hb(e,l);bd[a]=d,bd[(a+1)%4]=h,bd[(a+2)%4]=e,bd[(a+3)%4]=c,Ee(bd.some(_=>_?.isLoaded||_===e));const f=bd.reduce((_,v)=>Math.min(_,v?.level??1/0),1/0);bd.forEach((_,v)=>{_&&_?.level>f&&(bd[v]=null)}),Ee(bd.some(_=>_?.isLoaded||_===e));const m=r.cornerNeighborData[a].cornerTiles,g=r.cornerNeighborData[a].cornerTileSamplerVersions;for(let _=0;_<4;++_){const v=bd[_],b=v?.renderData.geometryState.samplerDataVersion??-1,T=m[_]!==v,x=!T&&g[_]!==b;(T||x)&&(m[_]=v,g[_]=b,this._markCornerDirty(a))}Ee(m.some(_=>_?.isLoaded||_===e))}dn&&Ee(this.geometryState.neighborData.edgeResolutions.every(a=>a>0));for(let a=0;a<4;++a)bd[a]=null}_updateGeometry(e){if(!this.tile.intersectsClippingArea)return;dn&&Ee(!this.tile.intersectsClippingArea||this.geometryState.neighborData.edgeResolutions.every(l=>l>0)),this.intersectionData=null;const r=this.tile,i=this._vao,s=this.geometry.vertexAttributes,n=!i||!s||this._wireframeChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||this._dirtyEdgeResolutions,o=!n&&(this._dirtyEdges!==0||this._dirtyEdgeResolutions!==0),a=!o&&this._dirtyCorners!==0;n?(this.releaseGeometry(),this._createGeometry(e)):o||a?r.updateEdgeElevations():a?r.updateCornerElevations():console.warn("Update for no reason?"),this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._dirtyEdgeResolutions=0,this._dirtyEdges=0,this._dirtyCorners=0,this._clippingAreaChanged=!1,this._wireframeChanged=!1}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao.dispose(),this._vao=null,$gt(this.geometry),!0)}ensureTexture(e,r){return this._texture!=null&&this._texture.descriptor.width!==e&&this.releaseTexture(),this._texture==null&&(this._texture=r(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){this._texture!=null&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}_markCornerDirty(e){const r=1<<e;this._dirtyCorners|=r}_markEdgeDirty(e){const r=1<<e;this._dirtyEdges|=r,this._markCornerDirty((e+0)%4),this._markCornerDirty((e+3)%4)}_markEdgeResolutionDirty(e){const r=1<<e;this._dirtyEdgeResolutions|=r,this._markEdgeDirty(e)}_markAllEdgesAndCornersDirty(){this._dirtyCorners=15,this._dirtyEdges=15,this._dirtyEdgeResolutions=15}updateGeometryState(){const e=this._getElevationInfo(),r=this.tile,i=e.samplerData?r.getElevationVerticesPerSide(e.maxTileLevel):r.getDefaultVerticesPerSide(),s=Math.max(i,5);let n=r.clippingArea;r.intersectsClippingArea&&!r.isWithinClippingArea||(n=null);const o=this.geometryState;let a=!1;o.numVerticesPerSide!==s&&(this._numVerticesPerSideChanged=!0,o.numVerticesPerSide=s,o.samplerDataVersion++,a=!0),e.changed&&(this._samplerDataChanged=!0,o.samplerData=e.samplerData,o.samplerDataVersion++,a=!0),u0(o.clippingArea,n)||(this._clippingAreaChanged=!0,o.clippingArea=n,a=!0);const l=r.surface.wireframe;return o.wireframe!==l&&(this._wireframeChanged=!0,o.wireframe=l,a=!0),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=a),a&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(e){this.tile.createGeometry();const r=this.geometry.vertexAttributes,i=this.geometry.indices,s=e.gl;this._vao=new Np(e,pRe,{geometry:Gc(r.layout)},{geometry:kr.createVertex(e,s.STATIC_DRAW,r.buffer)},kr.createIndex(e,s.STATIC_DRAW,i)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(e,r=o0.Immediate){e!=null&&e.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(e,r)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const e=this.geometryState.samplerData,r=this.tile.layerInfo[tr.ELEVATION],i=r.length,s=new Array(i);let n=0,o=0,a=!1;for(let h=0;h<i;h++){const d=r[h];if(d.upsampleInfo!=null){const f=d.upsampleInfo.tile,m=f.layerInfo[tr.ELEVATION][h].data,g=m&&m.samplerData;e&&e[n]===g||(a=!0),s[n++]=g,o=Math.max(o,f.lij[0])}else if(d.data){const f=this.tile.surface.layerViewByIndex(h,tr.ELEVATION);if(jR(this.tile,f.layer,!1)){const m=d.data;e&&e[n]===m.samplerData||(a=!0),s[n++]=m.samplerData,o=this.tile.level}}}e!=null&&e.length!==n&&(a=!0);const l=n>0,c=l?s:null;return l&&(s.length=n),{changed:a,samplerData:c,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){const e=this.intersectionData?.estimatedMemoryUsage??0;return(this.geometry.indices?.byteLength??0)+(this.geometry.vertexAttributes?.byteLength??0)+e}get texture(){return this._texture}get test(){return{hasTexture:this._texture!=null}}checkGeometryWaterproofness(){if(!dn)return;const e=this.tile;if(!e.isLoaded||!e.intersectsClippingArea||e.level===0)return void Ee(e?.isLoaded);const r=e.surface.extent;if(r!=null&&!e.intersectsExtent(r))return;const i=Yf.map((a,l)=>r!=null&&(l<2?-1:1)*(e.extent[3-l]-r[3-l])<0),s=e.level;Ee(this._dirtyCorners===0),Ee(this._dirtyEdges===0),Ee(this._dirtyEdgeResolutions===0),Ee(!this._numVerticesPerSideChanged),Ee(!this._samplerDataChanged),Ee(!this._clippingAreaChanged),Ee(!this._wireframeChanged);const n=HM.map(a=>e.findNeighborCornerTileExact(a,l=>!l.intersectsClippingArea||l.isLoaded||l.level===e.level)??null).map(a=>a?.intersectsClippingArea?a:null),o=this.geometryState.neighborData;for(let a=0;a<4;++a){const l=o.cornerPeerNeighbors[a],c=n[a];Ee(c===l,`Tile[${e.lij}].corner[${a}] out of date: cur=[${l?.lij}] exp=[${c?.lij}]`)}Yf.forEach((a,l)=>{if(i[l])return;const c=e.findNeighborTile(a,V=>(V.level===s||V?.isLoaded)&&V?.intersectsClippingArea);if(!c){const V=!e.surface.updatingRootTiles&&e.surface.rootTiles!=null&&e.surface.rootTiles.length>0&&e.shouldHaveNeighbor(a);return void Ee(!V)}Ee(c.isLoaded||c.level===e.level),Ee(c===this.geometryState.neighborData.edgePeerNeighbors[l]);const h=s-c.level;if(!c.isLoaded)return Ee(!c.isLeaf),void Ee(h===0);const d=c.renderData;Ee(_0t(e,c,a)),Ee(h>=0);const f=2**h;if(h<0)return void Ee(!1);const m=e.renderData,g=m.geometry,_=g.outerEdges[l],v=g.numVerticesPerSide-1,b=d.geometry;if(!b)return void Ee(!1);const T=this.geometryState.neighborData.edgePeerNeighbors[l];if(T?.isLoaded){const V=T.renderData;Ee(T==T),Ee(m.geometryState.neighborData.edgePeerNeighborSamplerVersions[l]===V.geometryState.samplerDataVersion),Ee(this.geometryState.neighborData.edgePeerNeighborSamplerVersions[l]===V.geometryState.samplerDataVersion)}const x=(l+2)%4,S=b.outerEdges[x],E=_.count-1,A=S.count-1;Ee(E*f===A,`Tile[${e.lij}]:e${l},res=${E} edgeRes mismatch with Neighbor[${c.lij}]:e${x},res=${A} (expected:${E*f})`);const R=e.extent,M=a===ht.NORTH||a===ht.SOUTH,D=S.count-1,k=D/2**h,L=_.count-1;if(k<1)return void Ee(L===1);Ee(k===L),Ee(kw(k));const N=b.numVerticesPerSide-1;Ee(h>0||k===Math.max(N,v));const q=e.getNeighborEdgeStartVertexIndex(l,c);Ee(0<=q&&q<f);const X=q*k;Ee(0<=X&&X<=D-k);let G=0,J=X;_.getVertexPos(nf,0),_.getVertexPos(of,_.count-1);const I=mi(nf,of),z=Math.max(L0t,1e-4*I);for(let V=0;V<=k;++V){_.getVertexPos(nf,G),S.getVertexPos(of,J);const j=V/k,Y=M?R[0]+j*(R[2]-R[0]):a===ht.WEST?R[0]:R[2],Q=M?a===ht.SOUTH?R[1]:R[3]:R[1]+j*(R[3]-R[1]),te=e.surface.extent;if(te==null||K6(te,Y,Q)){const ge=mP(nf,of),De=mc(nf)-nr.radius,at=mc(of)-nr.radius,we=ge<z;if(!we){console.warn(`Tile edge vertex position mismatch: between [${e.lij}].edge${l}[${G}/${_.count}] and [${c.lij}].edge${x}[${J}/${S.count}]`),te!=null&&console.warn("  surface extent= ",te," x,y=",Y,",",Q);const Z=O();fe(Z,m.localOrigin,d.localOrigin),mc(Z)>0&&console.warn(`   localOrigins: ${m.localOrigin} vs ${d.localOrigin} d=${mc(Z)} [${Z}]`),(()=>{const be=ks(nf),Fe=ks(of);e.updateEdgeElevations(),c.updateEdgeElevations(),_.getVertexPos(nf,G),S.getVertexPos(of,J);const ce=O();Pn(ce,nf,be),mc(ce)>0&&console.warn(`  XXX Tile[${e.lij}] edge out of date: ${be} vs ${nf} d=${mc(ce)} [${ce}]`),Pn(ce,of,Fe),mc(ce)>0&&console.warn(`  XXX Neighbor[${c.lij}] edge out of date: ${Fe} vs ${of} d=${mc(ce)} [${ce}]`)})(),Ee(we,`Mismatch in tile [${e.lij}].edge[${l}][${G}/${_.count}] vs neighbor [${c.lij}].edge[${x}][${J}/${S.count}] ${Jm(nf)} vs ${Jm(of)}  dist=${ge} h(t|n|d)=${De}|${at}|${at-De}`)}_.getNormal(LT,G),S.getNormal(DT,J),_e(Nue,LT),_e(Fue,DT);const Ce=ye(Nue,Fue),Me=1-Ce<.01||!1||e===c;if(!Me){const Z=O();Pn(Z,LT,DT);const be=()=>`Mismatch in tile edge normal ${mue(e.lij)} (${G}/${_.count-1}) edge ${l} vs neighbor ${mue(c.lij)}  (${J}/${S.count-1}) nedge ${x} :${Jm(LT)} vs ${Jm(DT)}  dot = ${Ce} : ${Jm(Z)}`;console.warn("Mismatch in tile edge normal: ",be());{e.updateEdgeElevations(),c.updateEdgeElevations();const Fe=O(),ce=O();_.getNormal(Fe,G),S.getNormal(ce,J),nv(LT,Fe)||console.warn("Missing update in tile normal: ",Jm(LT)," => ",Jm(Fe)),nv(DT,ce)||console.warn("Missing update in neighbor normal: ",Jm(DT)," => ",Jm(ce))}Ee(Me,be())}}G+=1,J+=1}})}};const nf=O(),of=O(),LT=O(),DT=O(),Nue=O(),Fue=O(),L0t=1,bd=[null,null,null,null];function Hb(t,e){return e?.isLoaded||e===t?e:null}const D0t=65536;function N0t(t,e){const r=t.tile,{extent:i,extentInRadians:s,surface:n}=r,o=t.localOrigin,a=t.geometryState,l=n.isWebMercator,c=a.numVerticesPerSide,h=c-1,d=(c-2)**2,f=l&&(e===Oh.HAS_SOUTH_POLE||e===Oh.HAS_BOTH_POLES),m=l&&(e===Oh.HAS_NORTH_POLE||e===Oh.HAS_BOTH_POLES),g=6,_=((f?1:0)+(m?1:0))*g*(h+1),v=a.neighborData,b=v.edgeResolutions.reduce((R,M)=>R+M+1,0),T=KOe(d+_+b),x=t.geometry;x.numVerticesPerSide=a.numVerticesPerSide,x.vertexAttributes=T;const S=x.boundingBox;Ei(S);const E=See(t);go.update(h,s,E),F0t(t),TRe(t,d),fRe(t);const A=[];if((()=>{let R=d+b;const M=o[0],D=o[1],k=o[2],L=r.ellipsoid.radius,N=i[1],q=i[3],X=(G,J)=>{const I=J*c;Gh(-M,-D,G*L-k,S),A.push({connectedRowOffset:I,connectedOuterEdgeOffset:G===1?0:2,rowOffset:R,latitudeResolution:g});const z=yRe(G===-1?N:q,L),V=G*Math.PI/2-z,j=.99*(G===1?1:-1),Y=L+0,Q=T.position,te=T.uv0,{typedBuffer:ge,typedBufferStride:De}=T.normalCompressed;for(let at=1;at<=g;++at){const we=z+V*(at/g),Ce=Math.cos(we),Me=Math.sin(we);for(let Z=0;Z<=h;Z++){const be=Z/h,Fe=go.sinLonLUT[Z],ce=go.cosLonLUT[Z]*Ce,$e=Fe*Ce,Xe=Me,ft=ce*Y-M,mt=$e*Y-D,Ye=Xe*Y-k;Gh(ft,mt,Ye,S),Q.setValues(R,ft,mt,Ye),Sp(te,R,be,j),ix(ge,R,ce,$e,Xe,De),++R}}};f&&X(-1,0),m&&X(1,h)})(),xRe(x,a.numVerticesPerSide,A,[0,c-1],[0,c-1],a.wireframe),t.intersectionData=null,dn)for(let R=0;R<4;++R)Ee(x.outerEdges[R].count===v.edgeResolutions[R]+1)}function F0t(t){const e=t.tile;if(!e.intersectsClippingArea)return;const r=t.geometryState,i=r.numVerticesPerSide,s=i-2,n=i-1,o=t.geometry,a=o.vertexAttributes,l=a.position,c=a.uv0,{typedBuffer:h,typedBufferStride:d}=a.normalCompressed,f=e.extent,m=f[0],g=f[2],_=f[1],v=f[3],b=e.ellipsoid.radius,T=r.samplerData,x=t.localOrigin,S=x[0],E=x[1],A=x[2],R=l.typedBuffer,M=l.typedBufferStride,D=1/n,k=o.boundingBox;let L=0;if(1<=s){const N=D,q=_*(1-N)+v*N,X=go.sinLatLUT[1],G=go.cosLatLUT[1];for(let J=1;J<=s;J++){const I=J*D,z=m*(1-I)+g*I,V=go.sinLonLUT[J],j=go.cosLonLUT[J],Y=b+Ji(z,q,T),Q=Y*j*G-S,te=Y*V*G-E,ge=Y*X-A;Gh(Q,te,ge,k);const De=(J-1)*M;R[De]=Q,R[De+1]=te,R[De+2]=ge,Sp(c,J-1,I,N)}}for(let N=1;N<=s;N++){const q=N*D,X=_*(1-q)+v*q,G=go.sinLatLUT[N],J=go.cosLatLUT[N],I=N+1,z=I*D,V=_*(1-z)+v*z,j=go.sinLatLUT[I],Y=go.cosLatLUT[I],Q=go.sinLonLUT[0],te=go.cosLonLUT[0],ge=b+Ji(m,X,T);let De=te*J*ge-S,at=Q*J*ge-E,we=G*ge-A;const Ce=L*M;let Me=R[Ce],Z=R[Ce+1],be=R[Ce+2];for(let Fe=1;Fe<=s;Fe++){const ce=Fe*D,$e=m*(1-ce)+g*ce,Xe=go.sinLonLUT[Fe],ft=go.cosLonLUT[Fe];let mt=0,Ye=0,xt=0;if(Fe<s){const _r=(L+1)*M;mt=R[_r],Ye=R[_r+1],xt=R[_r+2]}else{const _r=go.sinLonLUT[n],ui=go.cosLonLUT[n],Ws=b+Ji(g,X,T);mt=ui*J*Ws-S,Ye=_r*J*Ws-E,xt=G*Ws-A}const hr=De,rr=at,yi=we;De=Me,at=Z,we=be,Me=mt,Z=Ye,be=xt;const lt=mt-hr,ct=Ye-rr,bt=xt-yi;let Zt=0,ir=0,Xr=0;if(N>1){const _r=(L-s)*M;Zt=R[_r],ir=R[_r+1],Xr=R[_r+2]}else{const _r=go.sinLatLUT[0],ui=go.cosLatLUT[0],Ws=b+Ji($e,_,T);Zt=ft*ui*Ws-S,ir=Xe*ui*Ws-E,Xr=_r*Ws-A}const _i=b+Ji($e,V,T),Jt=ft*Y*_i-S,vi=Xe*Y*_i-E,zi=j*_i-A;if(N<s){const _r=L+s,ui=_r*M;R[ui]=Jt,R[ui+1]=vi,R[ui+2]=zi,Gh(Jt,vi,zi,k),Sp(c,_r,ce,z)}const Hr=Zt-Jt,Er=ir-vi,Wi=Xr-zi;let Ss=ft*J,Dr=Xe*J,si=G;si*si<.999&&(Ss=bt*Er-ct*Wi,Dr=lt*Wi-bt*Hr,si=ct*Hr-lt*Er);const Yr=1/Math.sqrt(Ss*Ss+Dr*Dr+si*si);ix(h,L,Ss*Yr,Dr*Yr,si*Yr,d),++L}}}function U0t(t){t.tile.intersectsClippingArea&&(fRe(t),q9(t))}function k0t(t){t.tile.intersectsClippingArea&&(gRe(t),mRe(t,!0),q9(t))}function fRe(t){t.tile.intersectsClippingArea&&(gRe(t),mRe(t))}function mRe(t,e=!1){const r=t.geometryState,i=t.geometry,s=r.neighborData,n=t.tile,o=n.level,a=n.extent,l=n.ellipsoid.radius,c=n.extentInRadians,h=c[0],d=c[2],f=c[1],m=c[3],g=r.samplerData,_=a[0],v=a[2],b=a[1],T=a[3],x=See(t),S=i.boundingBox,E=t.localOrigin,A=E[0],R=E[1],M=E[2],D=i.vertexAttributes,k=D.position,L=k.typedBuffer,N=k.typedBufferStride,q=D.uv0;for(let X=0;X<4;++X){const G=X===1||X===3,J=s.edgeResolutions[X];Ee(kw(J));const I=J+1,z=Hb(n,s.edgePeerNeighbors[X]);if(CRe(n,z,X)){SRe(t,X,z);continue}const V=z!=null;Ee(!V||z.level===n.level),Ee(!V||a0(n,z)<=0);const j=z?.renderData,Y=j?.geometryState;if(dn){const lt=n.surface;if(!z&&lt&&!lt.updatingRootTiles){const ct=Yf[X],bt=n.findNeighborTile(ct,Zt=>Zt.isLoaded||Zt.isLeaf||Zt.level===n.level);bt?bt.intersectsClippingArea&&(Ee(!bt.isLoaded),Ee(!bt.isLeaf),Ee(bt.level===o)):Ee(lt?.rootTiles==null||!n.shouldHaveNeighbor(ct))}}const Q=X===1?a[2]:a[0],te=z?.extent,ge=te&&G?X===1?te[0]:te[2]:Q,De=X===0?a[3]:a[1],at=X===1?1:0,we=X===0?1:0,Ce=X===1?d:h,Me=X===0?m:f,Z=Math.sin(Ce),be=Math.cos(Ce),Fe=Math.sin(Me),ce=Math.cos(Me),$e=Y?.samplerData,Xe=V?(lt,ct,bt)=>.5*(Ji(lt,ct,g)+Ji(bt,ct,$e)):(lt,ct,bt)=>Ji(lt,ct,g),ft=i.outerEdges[X],mt=e&&I>3?I-3:1,Ye=g!=null&&g.some(lt=>lt!=null),xt=$e!=null&&$e.some(lt=>lt!=null),hr=Ye||xt,rr=1/J,yi=ft.index0;Ee(!te||Mh(te[2]-te[0],a[2]-a[0])),(()=>{const lt=X===1?-1:X===3?1:0,ct=X===0?-1:X===2?1:0,bt=(a[2]-a[0])*rr,Zt=lt*bt,ir=ct*bt,Xr=G?lt*((d-h)*rr):0,_i=G?0:ct*rr,Jt=we,vi=G?Ce+Xr:Ce,zi=G?Math.sin(vi):Z,Hr=G?Math.cos(vi):be,Er=G?Ce-Xr:Ce,Wi=G?Math.sin(Er):Z,Ss=G?Math.cos(Er):be,Dr=G?Me:x(Jt+_i),si=G?Fe:Math.sin(Dr),Yr=G?ce:Math.cos(Dr),_r=G?Me:x(Jt-_i),ui=G?Fe:Math.sin(_r),Ws=G?ce:Math.cos(_r);let io=0,so=0,_n=0;{const Zr=0*rr,Nn=G?Q:_*(1-Zr)+v*Zr,Mo=G?ge:Nn,Ca=G?b*(1-Zr)+T*Zr:De,oe=G?Ce:h*(1-Zr)+d*Zr,Ci=G?Z:Math.sin(oe),ad=G?be:Math.cos(oe),Fn=G?x(Zr):Me,ld=G?Math.sin(Fn):Fe,it=G?Math.cos(Fn):ce,Wl=l+Xe(Nn,Ca,Mo);io=ad*it*Wl,so=Ci*it*Wl,_n=ld*Wl}let vn=0,Xi=0,bn=0;{const Zr=1*rr,Nn=G?Q:_*(1-Zr)+v*Zr,Mo=G?ge:Nn,Ca=G?b*(1-Zr)+T*Zr:De,oe=G?Ce:h*(1-Zr)+d*Zr,Ci=G?Z:Math.sin(oe),ad=G?be:Math.cos(oe),Fn=G?x(Zr):Me,ld=G?Math.sin(Fn):Fe,it=G?Math.cos(Fn):ce,Wl=l+Xe(Nn,Ca,Mo);vn=ad*it*Wl,Xi=Ci*it*Wl,bn=ld*Wl}for(let Zr=1;Zr<I-1;Zr+=mt){let Nn=0,Mo=0,Ca=0;{const Aa=(Zr+1)*rr,Xl=G?Q:_*(1-Aa)+v*Aa,Vp=G?ge:Xl,kn=G?b*(1-Aa)+T*Aa:De,is=G?Ce:h*(1-Aa)+d*Aa,W0=G?Z:Math.sin(is),Wv=G?be:Math.cos(is),Xv=G?x(Aa):Me,jx=G?Math.sin(Xv):Fe,Yv=G?Math.cos(Xv):ce,X0=l+Xe(Xl,kn,Vp);Nn=Wv*Yv*X0,Mo=W0*Yv*X0,Ca=jx*X0}const oe=Nn,Ci=Mo,ad=Ca,Fn=vn,ld=Xi,it=bn;vn=oe,Xi=Ci,bn=ad;{const Aa=yi+Zr,Xl=Aa*N,Vp=Fn-A,kn=ld-R,is=it-M;L[Xl]=Vp,L[Xl+1]=kn,L[Xl+2]=is,Gh(Vp,kn,is,S);const W0=Zr*rr;Sp(q,Aa,G?at:W0,G?W0:we)}const Wl=io,Un=so,jv=_n;io=Fn,so=ld,_n=it;const Hv=Fn,ul=ld,Fm=it,qv=1/Math.sqrt(Hv*Hv+ul*ul+Fm*Fm),Qt=Fm*qv;let H0=0,Um=0,q0=0;if(hr&&Qt*Qt<.999){let Aa=0,Xl=0,Vp=0;{const kn=X===0?-1:1;Aa=kn*(oe-Wl),Xl=kn*(Ci-Un),Vp=kn*(ad-jv)}{const kn=Zr*rr,is=G?Q:_*(1-kn)+v*kn,W0=G?ge:is,Wv=G?b*(1-kn)+T*kn:De,Xv=G?Ce:h*(1-kn)+d*kn,jx=G?Z:Math.sin(Xv),Yv=G?be:Math.cos(Xv),X0=G?x(kn):Me,dI=G?Math.sin(X0):Fe,hl=G?Math.cos(X0):ce;let ZC=Hv,JC=ul,H=Fm;if(V){const me=l+Ji(W0-Zt,Wv-ir,$e),Ae=G?hl:Ws;ZC=(G?Ss:Yv)*Ae*me,JC=(G?Wi:jx)*Ae*me,H=(G?dI:ui)*me}{const me=l+Ji(is+Zt,Wv+ir,g),Ae=G?hl:Yr,dr=(G?Hr:Yv)*Ae*me,Xs=(G?zi:jx)*Ae*me,bi=(G?dI:si)*me;V||(ZC=2*Hv-dr,JC=2*ul-Xs,H=2*Fm-bi);const Oa=X===3?-1:1,Zv=Oa*(ZC-dr),Bte=Oa*(JC-Xs),Gte=Oa*(H-bi);H0=Vp*Bte-Xl*Gte,Um=Aa*Gte-Vp*Zv,q0=Xl*Zv-Aa*Bte;const yU=1/Math.sqrt(H0*H0+Um*Um+q0*q0);H0*=yU,Um*=yU,q0*=yU}}}else H0=Hv*qv,Um=ul*qv,q0=Fm*qv;ft.setNormalFromValues(Zr,H0,Um,q0)}})()}}function gRe(t){ERe(t)}function yRe(t,e){return Math.PI/2-2*Math.atan(Math.exp(-t/e))}function z0t(t,e,r,i){return yRe(t*(1-i)+e*i,r)}function V0t(t,e,r){return t*(1-r)+e*r}function See(t){const e=t.tile;if(e.surface.isWebMercator){const i=e.extent,s=e.ellipsoid.radius;return n=>z0t(i[1],i[3],s,n)}const r=e.extentInRadians;return i=>V0t(r[1],r[3],i)}function B0t(t,e){const r=t.tile.extent,i=t.geometryState,s=r[0],n=r[1],o=r[2]-s,a=r[3]-n,l=i.clippingArea,c=l!=null?Math.max(0,(l[0]-s)/o):0,h=l!=null?Math.max(0,(l[1]-n)/a):0,d=l!=null?Math.min(1,(l[2]-s)/o):1,f=l!=null?Math.min(1,(l[3]-n)/a):1,m=i.numVerticesPerSide,g=(m-2)**2,_=i.neighborData.edgeResolutions.reduce((x,S)=>x+S+1,0),v=KOe(g+_),b=t.geometry,T=b.boundingBox;Ei(T),b.numVerticesPerSide=i.numVerticesPerSide,b.vertexAttributes=v,Ti(b.uvRange,c,h,d,f),G0t(t),TRe(t,g),_Re(t),xRe(b,i.numVerticesPerSide,[],[0,m-1],[0,m-1],i.wireframe),t.intersectionData=null}function G0t(t){const e=t.tile;if(!e.intersectsClippingArea)return;const r=e.surface,i=t.geometryState,s=i.samplerData,n=t.localOrigin,o=r.isWebMercatorOnPlateeCarree,a=i.clippingArea,l=a??Eee,c=e.extent,h=c[0],d=c[1],f=c[2],m=c[3],g=Math.max(h,l[0]),_=Math.min(f,l[2]),v=Math.max(d,l[1]),b=Math.min(m,l[3]),T=e.ellipsoid.radius,x=e.horizontalScale,S=i.numVerticesPerSide,E=S-1,A=S-2,R=t.geometry,M=R.vertexAttributes,D=M.position,k=M.uv0,{typedBuffer:L,typedBufferStride:N}=M.normalCompressed,q=R.uvRange,X=q[0],G=q[1],J=q[2],I=q[3],z=R.boundingBox,V=n[0],j=n[1],Y=n[2],Q=D.typedBuffer,te=D.typedBufferStride;let ge=0;const De=ve(d,v,b),at=o?(Math.PI/2-2*Math.atan(Math.exp(-De/T)))*T:De*x,we=1/E,Ce=ve(d*(1-we)+m*we,v,b);let Me=at,Z=o?(Math.PI/2-2*Math.atan(Math.exp(-Ce/T)))*T:Ce*x;for(let be=1;be<=A;be++){const Fe=be/E,ce=ve(d*(1-Fe)+m*Fe,v,b),$e=ve(Fe,G,I),Xe=Z,ft=(be-1)/E,mt=ve(d*(1-ft)+m*ft,v,b),Ye=Me,xt=(be+1)/E,hr=ve(d*(1-xt)+m*xt,v,b),rr=o?(Math.PI/2-2*Math.atan(Math.exp(-hr/T)))*T:hr*x,yi=ve(xt,G,I);Me=Z,Z=rr;const lt=ve(h,g,_);let ct=lt*x,bt=Ji(lt,ce,s);const Zt=1/E,ir=ve(Zt,X,J),Xr=ve(h*(1-ir)+f*ir,g,_);let _i=ir,Jt=Xr,vi=Xr*x,zi=Ji(Xr,ce,s);if(be===1){const Hr=vi-V,Er=Me-j,Wi=zi-Y,Ss=0*te;Q[Ss]=Hr,Q[Ss+1]=Er,Q[Ss+2]=Wi,Gh(Hr,Er,Wi,z);const Dr=ve(Zt,X,J);Sp(k,ge,Dr,$e)}for(let Hr=1;Hr<=A;Hr++){const Er=vi,Wi=zi,Ss=(Hr+1)/E,Dr=ve(Ss,X,J),si=ve(h*(1-Ss)+f*Ss,g,_),Yr=Jt;Jt=si;{const Xi=ge+1,bn=Xi*te;if(be===1||Hr===A){const Zr=si*x,Nn=Ji(si,ce,s);if(be===1&&Hr<A){const Mo=Zr-V,Ca=Xe-j,oe=Nn-Y;Q[bn]=Mo,Q[bn+1]=Ca,Q[bn+2]=oe,Gh(Mo,Ca,oe,z),Sp(k,Xi,Dr,$e)}vi=Zr,zi=Nn}else vi=Q[bn]+V,zi=Q[bn+2]+Y}const _r=vi,ui=zi,Ws=ct,io=bt;ct=Er,bt=Wi;const so=(ge-A)*te,_n=be===1?Ji(Yr,mt,s):Q[so+2]+Y,vn=Ji(Yr,hr,s);if(be<A){const Xi=ge+A,bn=Xi*te,Zr=Er-V,Nn=rr-j,Mo=vn-Y;Q[bn]=Zr,Q[bn+1]=Nn,Q[bn+2]=Mo,Gh(Zr,Nn,Mo,z);const Ca=_i;_i=Dr,Sp(k,Xi,Ca,yi)}{const Xi=_r-Ws,bn=Ye-rr,Zr=bn*(ui-io),Nn=Xi*(_n-vn),Mo=-bn*Xi,Ca=Zr*Zr+Nn*Nn+Mo*Mo;if(Ca===0)ix(L,ge,0,0,1,N);else{const oe=1/Math.sqrt(Ca);ix(L,ge,Zr*oe,Nn*oe,Mo*oe,N)}}++ge}}}function j0t(t,e){t.tile.intersectsClippingArea&&(bRe(t),vRe(t,!0),q9(t))}function H0t(t,e){t.tile.intersectsClippingArea&&(_Re(t),q9(t))}function _Re(t,e){t.tile.intersectsClippingArea&&(bRe(t),vRe(t,!1))}function vRe(t,e){const r=t.geometryState,i=r.neighborData,s=t.tile,n=s.surface,o=s.extent,a=r.clippingArea,l=a??Eee,c=o[0],h=o[2],d=o[1],f=o[3],m=[f>l[3],h>l[2],d<l[1],c<l[0]],g=t.geometry,_=s.horizontalScale,v=wRe(n.isWebMercatorOnPlateeCarree,s.ellipsoid.radius,_),b=g.boundingBox,T=g.uvRange[0],x=g.uvRange[1],S=g.uvRange[2],E=g.uvRange[3],A=Math.max(c,l[0]),R=Math.min(h,l[2]),M=Math.max(d,l[1]),D=Math.min(f,l[3]),k=t.localOrigin,L=k[0],N=k[1],q=k[2],X=r.samplerData;for(let G=0;G<4;++G){const J=G===1||G===3,I=i.edgeResolutions[G];Ee(kw(I));const z=I+1,V=m[G],j=Hb(s,i.edgePeerNeighbors[G]);if(!V&&CRe(s,j,G)){SRe(t,G,j);continue}const Y=j!=null&&!V,Q=j?.renderData,te=Q?.geometryState;if(dn&&(Ee(!Y||j.level===s.level),Ee(!Y||a0(s,j)<=0),s&&!j&&!n.updatingRootTiles)){const lt=Yf[G],ct=s.findNeighborTile(lt,bt=>bt.isLoaded||bt.isLeaf||bt.level===s.level);n.updatingRootTiles||(ct?ct.intersectsClippingArea&&(Ee(!ct.isLoaded),Ee(!ct.isLeaf),Ee(ct.level===s.level)):Ee(n?.rootTiles==null||!s.shouldHaveNeighbor(lt)))}const ge=ve(G===1?h:c,A,R),De=ve(G===0?f:d,M,D),at=te?.samplerData,we=g.outerEdges[G],Ce=e&&z>3?z-3:1,Me=ve(G===1?1:0,T,S),Z=ve(G===0?1:0,x,E),be=Y?(lt,ct)=>.5*(Ji(lt,ct,at)+Ji(lt,ct,X)):(lt,ct)=>Ji(lt,ct,X),Fe=(h-c)/I,ce=J?G===1?Fe:-Fe:0,$e=J?0:G===0?Fe:-Fe,Xe=-ce,ft=-$e;let mt=0,Ye=0,xt=0;{const lt=0/I,ct=J?ge:ve(c*(1-lt)+h*lt,A,R),bt=J?ve(d*(1-lt)+f*lt,M,D):De,Zt=be(ct,bt);mt=ct*_,Ye=v(bt),xt=Zt}let hr=0,rr=0,yi=0;{const lt=1/I,ct=J?ge:ve(c*(1-lt)+h*lt,A,R),bt=J?ve(d*(1-lt)+f*lt,M,D):De,Zt=be(ct,bt);hr=ct*_,rr=v(bt),yi=Zt}for(let lt=1;lt<z-1;lt+=Ce){const ct=lt/I,bt=hr,Zt=rr,ir=yi;{const Dr=J?Me:ve(ct,T,S),si=J?ve(ct,x,E):Z,Yr=bt-L,_r=Zt-N,ui=ir-q;Gh(bt,_r,ui,b),we.setVertexFromValuesRawPositionUV(lt,Yr,_r,ui,Dr,si)}{const Dr=(lt+1)/I,si=J?ge:ve(c*(1-Dr)+h*Dr,A,R),Yr=J?ve(d*(1-Dr)+f*Dr,M,D):De,_r=be(si,Yr);hr=si*_,rr=v(Yr),yi=_r}const Xr=hr,_i=yi,Jt=mt,vi=Ye,zi=xt;mt=bt,Ye=Zt,xt=ir;let Hr=0,Er=0,Wi=0;if(J){const Dr=rr-Zt,si=_i-ir,Yr=vi-Zt,_r=zi-ir,ui=ve(d*(1-ct)+f*ct,M,D),Ws=ge+Xe,io=Ws*_-bt,so=Ji(Ws,ui,X)-ir,_n=G===3?-1:1;if(Hr=_n*(-Yr+Dr)*so,Er=_n*io*(-_r+si),Wi=-_n*io*(-Yr+Dr),Y){const vn=ge+ce,Xi=vn*_-bt;Hr=(-Yr+Dr)*(so-(Ji(vn,ui,at)-ir)),Er=(io-Xi)*(-_r+si),Wi=-(io-Xi)*(-Yr+Dr)}}else{const Dr=Xr-bt,si=_i-ir,Yr=Jt-bt,_r=zi-ir,ui=ve(c*(1-ct)+h*ct,A,R),Ws=De+ft,io=Ji(ui,Ws,X)-ir,so=v(Ws)-Zt,_n=G===2?-1:1;if(Hr=_n*so*(-_r+si),Er=_n*(-Yr+Dr)*io,Wi=-_n*so*(-Yr+Dr),Y){const vn=ui,Xi=De+$e,bn=v(Xi)-Zt;Hr=(-so+bn)*(-_r+si),Er=(-Yr+Dr)*(-io+(Ji(vn,Xi,at)-ir)),Wi=-(-so+bn)*(-Yr+Dr)}}const Ss=1/Math.sqrt(Hr*Hr+Er*Er+Wi*Wi);we.setNormalFromValues(lt,Hr*Ss,Er*Ss,Wi*Ss)}}}function bRe(t,e){ERe(t)}function q0t(t,e){return(Math.PI/2-2*Math.atan(Math.exp(-t/e)))*e}function W0t(t,e){return t*e}function wRe(t,e,r){return t?i=>q0t(i,e):i=>W0t(i,r)}function xRe(t,e,r,i,s,n){const o=e-1,a=t.vertexAttributes.count,l=2*(Math.min(e-2,i[1])-Math.max(1,i[0]))*(Math.min(e-2,s[1])-Math.max(1,s[0])),c=Yf.map((x,S)=>S===0&&s[1]<e-2||S===1&&i[1]<e-2||S===2&&s[0]>1||S===3&&i[0]>1),h=t.outerEdges.reduce((x,S,E)=>x+(c[E]?0:o-2+S.count-1),0),d=r.reduce((x,S)=>x+o*(2*(S.latitudeResolution-1)+1),0),f=n?2:1,m=3*(l+h+d)*f,g=a>=D0t?new Uint32Array(m):new Uint16Array(m);let _=0;const v=e-2,b=o-2;Ee(b>=0);const T=(x,S,E,A,R,M)=>{const D=x*R,k=M[D],L=M[D+1],N=M[D+2],q=S*R,X=M[q],G=M[q+1],J=M[q+2],I=E*R,z=M[I],V=M[I+1],j=M[I+2],Y=A*R,Q=M[Y],te=M[Y+1],ge=M[Y+2];return(X-Q)*(X-Q)+(G-te)*(G-te)+(J-ge)*(J-ge)>(k-z)*(k-z)+(L-V)*(L-V)+(N-j)*(N-j)};if(n){const x=(E,A,R)=>{g[_++]=E,g[_++]=A,g[_++]=A,g[_++]=R,g[_++]=R,g[_++]=E,dn&&(Ee(E<a),Ee(A<a),Ee(R<a),Ee(_<=m))};(()=>{for(let E=Math.max(s[0],1)-1;E<Math.min(s[1],e-2)-1;++E){const A=E*v;for(let R=Math.max(i[0],1)-1;R<Math.min(i[1],e-2)-1;++R){const M=E*v+R,D=M+1,k=D+v,L=k-1,N=A+R,q=N+1,X=q+v,G=X-1,J=t.vertexAttributes.position.typedBuffer,I=t.vertexAttributes.position.typedBufferStride;T(N,q,X,G,I,J)?(x(M,D,k),x(k,L,M)):(x(M,D,L),x(L,k,D))}}})(),Ee(_===3*l*f),(()=>{for(let E=0;E<4;++E){const A=_;if(c[E])continue;const R=t.outerEdges[E],M=t.innerEdges[E];let D=0,k=0;const L=R.count,N=M.count;Ee(N===o-1);let q=0;const X=E===1||E===2?(G,J,I)=>x(G,J,I):(G,J,I)=>x(G,I,J);for(;D<L-1||k<N-1;){const G=M.getVertexIndex(k),J=R.getVertexIndex(D),I=D<L-1,z=k<N-1;I&&(!z||(I?0+o*(D+.5)/(L-1):0)<=(z?1+b*(k+.5)/(N-1):0))?(++D,dn&&Ee(D<L),X(G,J,R.getVertexIndex(D)),q++):(++k,dn&&Ee(k<N),X(G,J,M.getVertexIndex(k)),q++)}dn&&(Ee(D===L-1),Ee(k===N-1),Ee(q===L+N-2),Ee(q===o-2+R.count-1),Ee(_===A+3*q*f))}})(),Ee(_===3*(l+h)*f);const S=E=>{const A=t.outerEdges[E.connectedOuterEdgeOffset];let R=A.getVertexIndex(0),M=A.stride;for(let D=0;D<E.latitudeResolution;++D){const k=D===0?E.rowOffset:R+e;for(let L=0;L<o;L++)x(R,R+1,k+L),D<E.latitudeResolution-1&&x(R+1,k+L+1,k+L),R+=M;R=k,M=1}};r.forEach(S)}else{(()=>{const S=Math.max(s[0],1)-1,E=Math.min(s[1],e-2)-1,A=Math.max(i[0],1)-1,R=Math.min(i[1],e-2)-1;for(let M=S;M<E;++M){const D=M*v;for(let k=A;k<R;++k){const L=D+k,N=L+1,q=N+v,X=q-1,G=t.vertexAttributes.position.typedBuffer,J=t.vertexAttributes.position.typedBufferStride;T(L,N,q,X,J,G)?(g[_]=L,g[_+1]=N,g[_+2]=q,g[_+3]=q,g[_+4]=X,g[_+5]=L):(g[_]=L,g[_+1]=N,g[_+2]=X,g[_+3]=X,g[_+4]=N,g[_+5]=q),_+=6}}})(),Ee(_===3*l*f),(()=>{for(let S=0;S<4;++S){if(c[S])continue;const E=t.outerEdges[S],A=t.innerEdges[S];let R=0,M=0;const D=E.count,k=A.count;Ee(k===o-1);const L=S===1||S===2,N=L?1:2,q=L?2:1,X=E.index0,G=E.stride,J=A.index0,I=A.stride;for(;R<D-1||M<k-1;){const z=J+M*I,V=X+R*G,j=R<D-1,Y=M<k-1,Q=j&&(!Y||(j?0+o*(R+.5)/(D-1):0)<=(Y?1+b*(M+.5)/(k-1):0));Q?++R:++M;const te=Q?V+G:z+I;g[_]=z,g[_+N]=V,g[_+q]=te,_+=3}}})(),Ee(_===3*(l+h)*f);const x=S=>{const E=t.outerEdges[S.connectedOuterEdgeOffset];let A=E.getVertexIndex(0),R=E.stride;for(let M=0;M<S.latitudeResolution;++M){const D=M===0?S.rowOffset:A+e;for(let k=0;k<o;k++){const L=D+k;g[_]=A,g[_+1]=A+1,g[_+2]=L,M<S.latitudeResolution-1?(g[_+3]=A+1,g[_+4]=L+1,g[_+5]=L,_+=6):_+=3,A+=R}A=D,R=1}};r.forEach(x)}Ee(_===m),t.indices=g,t.indexCount=m}function TRe(t,e){const r=t.localOrigin,i=t.geometry,s=t.geometryState.neighborData.edgeResolutions,n=i.numVerticesPerSide-2,o=i.vertexAttributes;let a=e;for(let l=0;l<4;++l){{const c=l===0||l===2,h=(l===0?n-1:0)*n+(l===1?n-1:0),d=(c?0:1)*n+(c?1:0);i.innerEdges[l]=new Cue(o,r,h,d,n)}{const c=a,h=s[l]+1;i.outerEdges[l]=new Cue(o,r,c,1,h),a+=h}}}function SRe(t,e,r){const i=(e+2)%4,s=t.geometryState,n=t.tile,o=s.neighborData,a=n.level-r.level,l=e===1||e===3,c=o.edgeResolutions[e];Ee(kw(c));const h=c+1,d=t.geometry,f=d.boundingBox,m=d.outerEdges[e],g=d.uvRange[0],_=d.uvRange[1],v=d.uvRange[2],b=d.uvRange[3],T=ve(e===1?1:0,g,v),x=ve(e===0?1:0,_,b),S=r.renderData,E=S.geometryState,A=S.geometry.outerEdges[i],R=n.getNeighborEdgeStartVertexIndex(e,r)*c,M=c*2**a;Ee(E.neighborData.edgeResolutions[i]===M),Ee(A.count-1===M);const D=S.localOrigin[0]-t.localOrigin[0],k=S.localOrigin[1]-t.localOrigin[1],L=S.localOrigin[2]-t.localOrigin[2],N=m.attributes,q=m.index0,X=m.stride,G=N.position.typedBuffer,J=N.position.typedBufferStride,I=N.normalCompressed.typedBuffer,z=N.normalCompressed.typedBufferStride,V=N.uv0,j=A.attributes,Y=A.index0,Q=A.stride,te=j.position.typedBuffer,ge=j.position.typedBufferStride,De=j.normalCompressed.typedBuffer,at=j.normalCompressed.typedBufferStride;for(let we=1;we<h-1;++we){const Ce=q+X*we,Me=Y+Q*(R+we),Z=Ce*J,be=Me*ge,Fe=te[be]+D,ce=te[be+1]+k,$e=te[be+2]+L;G[Z]=Fe,G[Z+1]=ce,G[Z+2]=$e,Gh(Fe,ce,$e,f);const Xe=Ce*z,ft=Me*at;I[Xe]=De[ft],I[Xe+1]=De[ft+1];const mt=we/c,Ye=l?T:ve(mt,g,v),xt=l?ve(mt,_,b):x;Sp(V,Ce,Ye,xt)}}function ERe(t){const e=t.geometryState,r=e.neighborData,i=t.localOrigin,s=r.cornerNeighborData,n=t.geometry,o=n.outerEdges,a=n.boundingBox,l=t.tile,c=t.tile.surface.view?.viewingMode==="local",h=l.ellipsoid.radius,d=l.extentInRadians,f=l.horizontalScale;let m=0,g=0,_=0;const v=(Z,be,Fe)=>{const ce=d[be===0?1:3],$e=d[Z===0?0:2],Xe=Math.cos(ce),ft=Math.sin(ce),mt=Math.sin($e),Ye=Math.cos($e),xt=h+Fe;m=Ye*Xe*xt,g=mt*Xe*xt,_=ft*xt},b=c?(()=>{const Z=t.geometryState.clippingArea,be=l.extent,Fe=Z!=null&&(be[3]>Z[3]||be[2]>Z[2]||be[1]<Z[1]||be[0]<Z[0]),ce=wRe(l.surface.isWebMercatorOnPlateeCarree,l.ellipsoid.radius,f);return($e,Xe,ft)=>{const mt=$e===0?q[0]:q[2],Ye=Xe===0?q[1]:q[3],xt=Fe?ve(mt,Z[0],Z[2]):mt,hr=Fe?ve(Ye,Z[1],Z[3]):Ye,rr=ft;m=xt*f,g=ce(hr),_=rr}})():v;let T=0,x=0,S=0,E=0,A=0,R=0,M=0,D=0,k=0;const L=c&&t.tile.surface.isWebMercatorOnPlateeCarree,N=(Z,be,Fe,ce,$e)=>{let Xe=0,ft=0,mt=0;if(c){const Ye=be*f,xt=L?(Math.PI/2-2*Math.atan(Math.exp(-Fe/h)))*h:Fe*f;Xe=Ye-m,ft=xt-g,mt=ce-_}else{const Ye=See(Z),xt=Z.tile,hr=xt.extent,rr=xt.extentInRadians,yi=(be-hr[0])/(hr[2]-hr[0]),lt=(Fe-hr[1])/(hr[3]-hr[1]),ct=rr[0]*(1-yi)+rr[2]*yi,bt=Ye(lt),Zt=Math.cos(bt),ir=Math.sin(bt),Xr=Math.sin(ct),_i=Math.cos(ct),Jt=h+ce;Xe=_i*Zt*Jt-m,ft=Xr*Zt*Jt-g,mt=ir*Jt-_}switch($e){case 0:M+=Xe,D+=ft,k+=mt;break;case 1:E-=Xe,A-=ft,R-=mt;break;case 2:M-=Xe,D-=ft,k-=mt;break;case 3:E+=Xe,A+=ft,R+=mt}},q=l.extent,X=e.clippingArea,G=X??Eee,J=q[0],I=q[2],z=q[1],V=q[3],j=[V>G[3],I>G[2],z<G[1],J<G[0]],Y=Math.max(J,G[0]),Q=Math.min(I,G[2]),te=Math.max(z,G[1]),ge=Math.min(V,G[3]),De=n.uvRange[0],at=n.uvRange[1],we=n.uvRange[2],Ce=n.uvRange[3],Me=Z=>{const be=s[Z].cornerTiles;T=0,x=0,S=1,E=0,A=0,R=0,M=0,D=0,k=0;let Fe=1/0;for(let Ye=0;Ye<4;++Ye)Fe=Math.min(Fe,be[Ye]?.level??1/0);for(let Ye=0;Ye<4;++Ye){const xt=be[Ye];X3[Ye]=xt?.level===Fe?xt:null}let ce=1,$e=0;for(let Ye=0;Ye<4;++Ye){const xt=X3[Ye];xt&&(ce=Math.max(ce,xt?.renderData.geometryState.numVerticesPerSide),$e=xt.extent[2]-xt.extent[0])}const Xe=$e,ft=ce;Ee(ft>1);const mt=Xe/ft;for(let Ye=0;Ye<4;++Ye){const xt=X3[(Ye+3)%4],hr=X3[Ye%4];if(!xt&&!hr)continue;const rr=Ye===0?1:Ye===1?2:Ye===2?3:0,yi=Ye===0?2:Ye===1?3:Ye===2?0:1;if(xt&&hr){const lt=gV[Ye][0]*mt,ct=gV[Ye][1]*mt,bt=xt.extent,Zt=bt[rr===0||rr===1?2:0]+lt,ir=bt[rr===0||rr===3?3:1]+ct,Xr=hr.extent,_i=Xr[yi===0||yi===1?2:0]+lt,Jt=Xr[yi===0||yi===3?3:1]+ct,vi=xt.renderData,zi=hr.renderData,Hr=Ji(Zt,ir,vi.geometryState.samplerData),Er=Ji(_i,Jt,zi.geometryState.samplerData);N(vi,Zt,ir,.5*(Hr+Er),Ye)}else{const lt=xt??hr,ct=xt?rr:yi,bt=lt.extent,Zt=gV[Ye],ir=bt[ct===0||ct===1?2:0]+Zt[0]*mt,Xr=bt[ct===0||ct===3?3:1]+Zt[1]*mt,_i=lt.renderData,Jt=Ji(ir,Xr,_i.geometryState.samplerData);N(_i,ir,Xr,Jt,Ye)}}if(!c){const Ye=Math.sqrt(m*m+g*g+_*_);T=m/Ye,x=g/Ye,S=_/Ye}if(c||S*S<.999){const Ye=Math.sqrt(E*E+A*A+R*R);E/=Ye,A/=Ye,R/=Ye;const xt=Math.sqrt(M*M+D*D+k*k);M/=xt,D/=xt,k/=xt,T=R*D-A*k,x=E*k-R*M,S=A*M-E*D;const hr=1/Math.sqrt(T*T+x*x+S*S);T*=hr,x*=hr,S*=hr}};for(let Z=0;Z<4;++Z){const be=Z,Fe=(Z+1)%4,ce=Z===0||Z===1?1:0,$e=Z===0||Z===3?1:0,Xe=ve(ce,De,we),ft=ve($e,at,Ce),mt=o[be],Ye=Z===0||Z===3?mt.count-1:0,xt=o[Fe],hr=Z===0||Z===1?xt.count-1:0,rr=s[Z].cornerTiles;let yi=-1;for(let bt=0;bt<4;++bt){const Zt=rr[bt];Zt&&(yi===-1||a0(rr[yi],Zt)>0)&&(yi=bt)}const lt=yi,ct=rr[lt];if(ct!==l){const bt=l.level-ct.level,Zt=2**bt,ir=[ct.lij[0]+bt,ct.lij[1]*Zt,ct.lij[2]*Zt],Xr=[ir[1]+Zt===l.lij[1],Z===0&&(lt===1||lt===0&&ct!==rr[3])||Z===1&&(lt===0||lt===1&&ct!==rr[2]),ir[1]===l.lij[1]+1,Z===2&&(lt===3||lt===2&&ct!==rr[1])||Z===3&&(lt===2||lt===3&&ct!==rr[0])],_i=Xr.reduce((Er,Wi)=>Er+(Wi?1:0),0);Ee(_i===1||_i===2);let Jt=-1,vi=-1;const zi=ct.renderData;if(_i===1){const Er=Xr.findIndex(Ss=>Ss);Ee(0<=Er&&Er<=3),Jt=(Er+2)%4;const Wi=t.geometryState.neighborData.edgeResolutions[Er];vi=l.getNeighborEdgeStartVertexIndex(Er,ct)*Wi+Wi*(Er===0&&Z===0||Er===1&&Z===0||Er===2&&Z===1||Er===3&&Z===3?1:0)}else{Ee(Xr[1]||Xr[3]),Jt=Xr[1]?3:1;const Er=zi.geometryState.neighborData.edgeResolutions[Jt];vi=Z===0||Z===3?0:Er}const Hr=zi.geometry.outerEdges[Jt];{const Er=mt.index0+Ye*mt.stride,Wi=xt.index0+hr*xt.stride,Ss=Hr.index0+vi*Hr.stride;{const Dr=Hr.attributes.position,si=Dr.typedBuffer,Yr=Ss*Dr.typedBufferStride,_r=t.localOrigin,ui=Hr.localOrigin,Ws=si[Yr]+ui[0]-_r[0],io=si[Yr+1]+ui[1]-_r[1],so=si[Yr+2]+ui[2]-_r[2];Gh(Ws,io,so,a);{const _n=mt.attributes.position,vn=_n.typedBuffer,Xi=Er*_n.typedBufferStride;vn[Xi]=Ws,vn[Xi+1]=io,vn[Xi+2]=so}{const _n=xt.attributes.position,vn=_n.typedBuffer,Xi=Wi*_n.typedBufferStride;vn[Xi]=Ws,vn[Xi+1]=io,vn[Xi+2]=so}}Sp(mt.attributes.uv0,Er,Xe,ft),Sp(xt.attributes.uv0,Wi,Xe,ft);{const Dr=Hr.attributes.normalCompressed.typedBuffer,si=Ss*Hr.attributes.normalCompressed.typedBufferStride;{const Yr=mt.attributes.normalCompressed,_r=Yr.typedBuffer,ui=Er*Yr.typedBufferStride;_r[ui]=Dr[si],_r[ui+1]=Dr[si+1]}{const Yr=xt.attributes.normalCompressed,_r=Yr.typedBuffer,ui=Wi*Yr.typedBufferStride;_r[ui]=Dr[si],_r[ui+1]=Dr[si+1]}}}}else{const bt=j[be],Zt=j[Fe];let ir;if(bt||Zt){const vi=ve(J*(1-ce)+I*ce,Y,Q),zi=ve(z*(1-$e)+V*$e,te,ge),Hr=e.samplerData;ir=Ji(vi,zi,Hr)}else ir=X0t(rr);b(ce,$e,ir),Me(Z);const Xr=m-i[0],_i=g-i[1],Jt=_-i[2];Gh(Xr,_i,Jt,a),mt.setVertexFromValuesRawPositionUVNormal(Ye,Xr,_i,Jt,Xe,ft,T,x,S),xt.setVertexFromValuesRawPositionUVNormal(hr,Xr,_i,Jt,Xe,ft,T,x,S)}}for(let Z=0;Z<4;++Z)X3[Z]=null}function X0t(t){const e=t.reduce((n,o)=>Math.min(n,o?.level??1/0),1/0);dn&&(Ee(!t[0]||!t[2]||Jq(t[0],t[2],ht.SOUTH_WEST)),Ee(!t[1]||!t[3]||Jq(t[1],t[3],ht.NORTH_WEST)));let r=0,i=0;for(let n=0;n<4;++n){const o=t[n];if(o&&o.level===e){const a=n===0||n===1,l=n===0||n===3,c=o.extent,h=c[a?0:2],d=c[l?1:3],f=o.renderData?.geometryState?.samplerData;i+=Ji(h,d,f),r++}}const s=r?i/r:0;return Ee(s!=null),s}function q9(t){const e=t.vao,r=t.geometry.vertexAttributes.position.typedBuffer;e.vertexBuffers.geometry.setSubData(r,0,0,r.length)}const gV=[[0,1],[1,0],[0,-1],[-1,0]],go=new Lgt,Eee=CZ(-1/0,-1/0,1/0,1/0),X3=[null,null,null,null];function CRe(t,e,r){if(!e)return!1;const i=a0(t,e);return i>0||i===0&&r>=2}let Y0t=class extends bee{get horizontalScale(){return this._horizontalScaleFactor}constructor(e,r,i){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=zt(),e!==void 0&&this.init(e,r,i)}init(e,r,i){super.init(e,r,i);const s=i.view.renderSpatialReference,n=i.spatialReference,o=s!=null&&sM(s)&&n!=null&&n.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=o;const a=this.surface.isWebMercatorOnPlateeCarree,l=this._extentInRenderSR,c=this.extent;if(a){const h=Pe(c[0],c[1],0);Qs(h,qe.WebMercator,h,qe.PlateCarree);const d=Pe(c[2],c[3],0);Qs(d,qe.WebMercator,d,qe.PlateCarree),l[0]=h[0],l[1]=h[1],l[2]=d[0],l[3]=d[1]}else for(let h=0;h<4;++h)l[h]=c[h]*o;this.centerAtSeaLevel[0]=.5*(l[0]+l[2]),this.centerAtSeaLevel[1]=.5*(l[1]+l[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(l[2]-l[0],l[3]-l[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const e=this._extentInRenderSR,r=.5*(e[2]-e[0]),i=.5*(e[3]-e[1]),s=Math.sqrt(r*r+i*i),n=.5*(this.elevationBounds[0]-this.elevationBounds[1]),o=Math.max(s,n);this._center[Gs.MIDDLE][3]=o}_calculateFrustumVisibilityStatus(e){const r=this._aabb(),i=r[0],s=r[1],n=r[2],o=r[3],a=r[4],l=r[5];let c=!0;for(let h=0;h<6;h++){const d=e[h],f=d[0],m=d[1],g=d[2],_=d[3];if(f*(f>0?i:o)+m*(m>0?s:a)+g*(g>0?n:l)+_>=0)return ca.OUTSIDE;c=c&&f*(f<0?i:o)+m*(m<0?s:a)+g*(g<0?n:l)+_<=0}return c?ca.INSIDE:ca.INTERSECTS}_aabb(){const e=this._extentInRenderSR;return Oze(e[0],e[1],this.elevationBounds[0],e[2],e[3],this.elevationBounds[1])}intersectsRay(e,r,i,s){return LL[0]=1/r[0],LL[1]=1/r[1],LL[2]=1/r[2],KQ(this._aabb(),e,LL,i,s)}createGeometry(){B0t(this.renderData,this._horizontalScaleFactor),this.setMemoryDirty()}getDefaultVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){j0t(this.renderData,this._horizontalScaleFactor)}updateEdgeElevations(){H0t(this.renderData,this._horizontalScaleFactor)}};const LL=O();let Z0t=class{constructor(){this.extent=Wt(),this.minLevel=0,this.maxLevel=0,this.callback=null}},ZN=class extends Te{constructor(){super(...arguments),this._queries=new Vt({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new Vt({initialSize:30}),this._queryPool=new qo(Z0t)}queryVisibleLevelRange(e,r,i,s){const n=this._queryPool.acquire();Nh(n.extent,e),n.minLevel=r??-Number.MAX_VALUE,n.maxLevel=i??Number.MAX_VALUE,n.callback=s,this._queryQueue.push(n),this.notifyChange("updating")}get updating(){return this._queryQueue.length!==0}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}process(){for(let e=0;e<this._queries.length;e++){const r=this._queries.data[e];this._queryPool.release(r),r.callback(e>=this._queriesInvPtr),r.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(e){const r=e.level;let i=0;for(;i<this._queriesInvPtr;){const s=this._queries.data[i],n=s.extent;r>=s.minLevel&&r<=s.maxLevel&&n[0]<=e.extent[2]&&n[2]>=e.extent[0]&&n[1]<=e.extent[3]&&n[3]>=e.extent[1]?(this._queries.swapElements(i,this._queriesInvPtr-1),this._queriesInvPtr--):i++}}};u([p()],ZN.prototype,"updating",null),ZN=u([P("esri.views.3d.terrain.ScaleRangeQueries")],ZN);let J0t=class extends bee{get convexHull(){return this._convexHull}constructor(e,r,i){super(),this._convexHull=new Array(24),this._boundingSphere=xs(),e!==void 0&&this.init(e,r,i)}init(e,r,i){super.init(e,r,i);const s=this.ellipsoid.radius,n=this.extentInRadians[0],o=this.extentInRadians[1],a=this.extentInRadians[2],l=this.extentInRadians[3],c=e[0],h=St(o,l,.5),d=St(n,a,.5),f=c===0?0:Math.min(Math.abs(o),Math.abs(l));this._edgeLen=(a-n)*Math.cos(f)*s,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=s-Math.sqrt(s*s-this._edgeLen2/4),cbe(this.centerAtSeaLevel,d,h,this.ellipsoid.radius),_e(this.up,this.centerAtSeaLevel),this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const e=this._center;if(this.lij[0]===0)ne(e[Gs.MIDDLE],0,0,0),ne(e[Gs.TOP],0,0,0),ne(e[Gs.BOTTOM],0,0,0),e[Gs.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const r=e[Gs.MIDDLE],i=this.convexHull;let s=0;for(let n=0;n<8;++n)s=Math.max(s,Q0t(r,i,3*n));e[Gs.MIDDLE][3]=Math.sqrt(s)}}_calculateFrustumVisibilityStatus(e){if(!B_(e,this._boundingSphere))return ca.OUTSIDE;if(this.lij[0]<10)return ca.INTERSECTS;const r=this.convexHull,i=this.surface.view.state.camera.near;let s=!0;for(let n=0;n<IC;n++){const o=n===pi.NEAR,a=e[n],l=a[0],c=a[1],h=a[2],d=a[3]-(o?i:0);let f=!1;for(let m=0;m<8;++m){const g=3*m;if(l*r[g]+c*r[g+1]+h*r[g+2]+d<0){if(f=!0,!s)break}else s=!1}if(!f)return ca.OUTSIDE}return s?ca.INSIDE:ca.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){N0t(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),dn&&this._checkBVs()}_updateBoundingSphere(){const e=this._boundingSphere,r=e,i=this.elevationBounds,s=this.ellipsoid.radius,n=i[1];if(this.level===0)ne(r,0,0,0),e[3]=s+n;else{const o=this.extentInRadians,a=.5*(o[0]+o[2]),l=o[1],c=o[3];O1(zue,a,l,s),O1(Vue,a,c,s),de(r,zue,Vue);const h=.5*(i[0]+i[1]);se(r,r,(s+h)/mc(r));const d=this.convexHull;let f=0;const m=(_,v)=>{const b=_[0]-d[3*v],T=_[1]-d[3*v+1],x=_[2]-d[3*v+2];return Math.sqrt(b*b+T*T+x*x)};for(let _=0;_<8;++_){const v=m(r,_);f=Math.max(f,v)}const g=f;e[3]=g+2}}_updateConvexHull(){const e=this.extentInRadians,r=this.ellipsoid.radius;if(this.level===0)return;const i=this.elevationBounds,s=this._getPatchType(),n=this.surface.isWebMercator,o=n&&s===Oh.HAS_NORTH_POLE,a=n&&s===Oh.HAS_SOUTH_POLE,l=a||o,c=Math.PI/2,h=e[0],d=e[2],f=a?-c:e[1],m=o?c:e[3],g=.5*(h+d),_=i[0],v=r+(l?Math.min(0,_-1):_),b=(J,I,z)=>O1(J,I,z,v),T=O(),x=O(),S=O(),E=O();b(T,h,f),b(x,h,m),b(S,d,m),b(E,d,f);const A=(J,I)=>{for(let z=0;z<3;++z)this._convexHull[3*I+z]=J[z]};A(T,0),A(x,1),A(S,2),A(E,3);const R=i[1],M=r+(l?Math.max(0,R+1):R),D=O(),k=O(),L=O();O1(k,g,m,v),O1(L,g,f,v),de(D,k,L),_e(D,D);const N=O(),q=O(),X=(J,I)=>{Pn(q,J,I),_e(q,q);const z=-ye(J,N)/ye(q,N);Ee(z>=0),se(q,q,z),de(J,J,q)};if(2**this.lij[0]>2*this.lij[1]){const J=L,I=O();pt(I,kue,J),_e(I,I),pt(N,J,I),_e(N,N),Ee(Mh(ye(N,J)/mc(J),0)),X(T,x),X(E,S),A(T,0),A(E,3)}else if(2**this.lij[0]!==2*this.lij[1]){const J=k,I=O();pt(I,kue,J),_e(I,I),pt(N,I,J),_e(N,N),X(x,T),X(S,E),A(x,1),A(S,2)}const G=(J,I)=>{const z=M/ye(I,D);for(let V=0;V<3;++V)this._convexHull[3*J+V]=I[V]*z};G(4,T),G(5,x),G(6,S),G(7,E)}_getPatchType(){const e=this.lij[1],r=e===0,i=e===(1<<this.level)-1;return r?i?Oh.HAS_BOTH_POLES:Oh.HAS_NORTH_POLE:i?Oh.HAS_SOUTH_POLE:Oh.REGULAR}intersectsRay(e,r,i,s){const n=this._boundingSphere,o=n[3]+i,a=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],l=n[0]-e[0],c=n[1]-e[1],h=n[2]-e[2],d=(l*r[0]+c*r[1]+h*r[2])/a,f=r[0]*d-l,m=r[1]*d-c,g=r[2]*d-h;return f*f+m*m+g*g<o*o}getDefaultVerticesPerSide(){return this.level<Uue.length?Uue[this.level]+1:2}updateCornerElevations(){k0t(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){U0t(this.renderData),this._updateBoundingVolumes()}_checkBVs(){if(!dn||this.level<=2)return;const e=this._boundingSphere,r=e[3],i=e,s=O(),n=this.ellipsoid.radius,o=this.elevationBounds;o[1],o[0];const a=n+o[0],l=1,c=0,h=this._center[Gs.MIDDLE][3],d=this.convexHull,f=(ce,$e)=>{for(let Xe=0;Xe<3;++Xe)ce[Xe]=d[3*$e+Xe]};{const ce=O(),$e=O(),Xe=O(),ft=O(),mt=O(),Ye=(xt,hr,rr,yi)=>{f($e,xt),f(Xe,hr),f(ft,rr),Pn($e,$e,Xe),Pn(ft,ft,Xe),pt(ce,$e,ft),_e(ce,ce);const lt=ye(ce,Xe);f(mt,yi);const ct=ye(ce,mt),bt=Math.abs(ct-lt);Ee(Mh(bt,0),`Non coplanar ${xt},${hr},${rr},${yi} diff = ${bt}`)};Ye(0,1,2,3),Ye(4,5,6,7),Ye(0,1,4,5),Ye(1,2,5,6),Ye(2,3,6,7),Ye(3,0,7,4)}const m=Xo(24),g=(ce,$e,Xe)=>{const ft=4*ce;for(let mt=0;mt<3;++mt)m[ft+mt]=$e[mt];m[ft+3]=Xe},_=O(),v=O(),b=O(),T=O(),x=(ce,$e,Xe,ft)=>{f(_,$e),f(v,Xe),f(b,ft),Pn(_,_,v),_e(_,_),Pn(b,b,v),_e(b,b),pt(T,_,b),_e(T,T);const mt=ye(T,v);g(ce,T,mt)};x(0,0,1,2),x(1,1,0,4),x(2,1,5,2),x(3,3,2,6),x(4,4,0,3),x(5,4,6,5);const S=1,E=(ce,$e,Xe,ft)=>{const mt=4*ce;return m[mt]*$e+m[mt+1]*Xe+m[mt+2]*ft-m[mt+3]},A=(ce,$e,Xe,ft)=>E(ce,$e,Xe,ft)>=-S,R=(ce,$e)=>A(ce,$e[0],$e[1],$e[2]),M=2**this.lij[0]>2*this.lij[1],D=(ce,$e,Xe)=>Math.sqrt(ARe(ce,$e,Xe,i[0],i[1],i[2]))<r,k=ce=>D(ce[0],ce[1],ce[2]),L=(ce,$e)=>D(ce[$e],ce[$e+1],ce[$e+2]),N=this.extentInRadians,q=.5*(N[0]+N[2]),X=N[1],G=N[3],J=O(),I=O();O1(J,q,G,a),O1(I,q,X,a);const z=M?"Upper":"Lower";let V=!0;for(let ce=0;ce<6;++ce){for(let $e=0;$e<8;++$e){const Xe=3*$e,ft=A(ce,d[Xe],d[Xe+1],d[Xe+2]);V&&(V=ft),Ee(ft,`Tile[${this.lij}] Convex hull point ${$e} outside of plane ${ce}`)}Ee(R(ce,I),`Tile[${this.lij}] (${z}) bottom mid outside of plane ${ce}`),Ee(R(ce,J),`Tile[${this.lij}] (${z}) top mid outside of plane ${ce}`)}Ee(V,"Not all convex hull points are inside  convex hull polyhedron"),Ee(k(I),`Tile[${this.lij}] (${z}) bottom mid outside of bounding sphere`),Ee(k(J),`Tile[${this.lij}] (${z}) top mid outside of bounding sphere`);for(let ce=0;ce<8;++ce){const $e=L(d,3*ce);Ee($e,`Tile[${this.lij}] Convex hull point ${ce} outside of bounding sphere`)}for(let ce=0;ce<6;++ce)for(let $e=0;$e<8;++$e){const Xe=3*$e;A(ce,d[Xe],d[Xe+1],d[Xe+2])||console.error(`Tile[${this.lij}] Convex hull point ${$e} outside of plane ${ce}`)}const j=this.extentInRadians,Y=Math.max(j[2]-j[0],j[3]-j[1]),Q=Math.round(Y*n),te=this.renderData;if(!te)return;const{geometry:ge,localOrigin:De}=te,at=ge.vertexAttributes?.position;if(!at)return;const we=at.count,Ce=O(),Me=ge.numVerticesPerSide-2,Z=Me*Me,be=te.geometryState.neighborData,Fe=be.edgeResolutions.reduce((ce,$e)=>ce+$e+1,0);for(let ce=0;ce<we;++ce){const $e=ce<Z,Xe=!$e&&ce<Z+Fe;let ft=!1,mt=-1;if(Xe){let Jt=Z;for(let vi=0;vi<4;++vi){const zi=be.edgeResolutions[vi];if(ce===Jt||ce===Jt+zi-1){ft=!0;break}if(Jt+=zi,ce<Jt){mt=vi;break}}}const Ye=Xe?be.edgePeerNeighbors[mt]:null,xt=Xe&&Ye&&a0(this,Ye)>0;at.getVec(ce,s),de(Ce,s,De);const hr=mc(Ce)-n;let rr=0,yi=!1;const lt=o[0]-hr,ct=hr-o[1],bt=lt>l,Zt=ct>l,ir=bt||Zt,Xr=()=>{const Jt=$e?"internal":Xe&&!ft?"edge":ft?"corner":"pole";return`Tile[${this.lij}].vertex[${ce}]:${Jt}`+(bt?"(below)":Zt?"(above)":"")+(xt?"(Neighbor)":"")},_i=mP(Ce,i);if(_i>=r+c){const Jt=_i-r;ir||(console.error(`${Xr()} is out of the bounding sphere by ${Jt.toFixed(0)} / ${r.toFixed(0)}[tol=${c}] h=${hr.toFixed(0)} / [${o[0].toFixed(0)}..${o[1].toFixed(0)}] (${(Jt/r).toFixed(0)})`),yi=!0)}for(let Jt=0;Jt<6;++Jt)if(!A(Jt,Ce[0],Ce[1],Ce[2])){const vi=E(Jt,Ce[0],Ce[1],Ce[2]),zi=ce%Me,Hr=(ce-zi)/Me;Jt===0&&lt||Jt===5&&ct||(console.error(`${Xr()} (${zi},${Hr})|${Me}] is out of the bounding trapezoid plane ${Jt} h=${Math.round(hr)} / [${Math.round(o[0])}..${Math.round(o[1])}] dist=${Math.round(vi)} radii = ${Math.round(r)}/${Math.round(h)}} : maxL = ${Q}`),++rr)}if(yi||rr>0)break}}};const Uue=[128,64,64,32,16,8,8,4];function Q0t(t,e,r){return ARe(t[0],t[1],t[2],e[r],e[r+1],e[r+2])}function ARe(t,e,r,i,s,n){const o=i-t,a=s-e,l=n-r;return o*o+a*a+l*l}const O1=(t,e,r,i)=>{const s=Math.cos(e),n=Math.sin(e),o=Math.cos(r),a=Math.sin(r);t[0]=i*o*s,t[1]=i*o*n,t[2]=i*a},kue=[0,0,1],zue=O(),Vue=O();let Nd=class extends Te{constructor(){super(...arguments),this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}};u([p()],Nd.prototype,"fovX",void 0),u([p()],Nd.prototype,"fovY",void 0),u([p()],Nd.prototype,"relativeWidthLimit",void 0),u([p()],Nd.prototype,"relativeHeightLimit",void 0),u([p()],Nd.prototype,"maxLod",void 0),u([p()],Nd.prototype,"angledSplitBias",void 0),u([p()],Nd.prototype,"aboveGround",void 0),u([p()],Nd.prototype,"frustum",void 0),Nd=u([P("esri.views.3d.terrain.SplitLimits")],Nd);let ORe=class extends Sa{constructor(){super(...arguments),this.blendMode=Le.Normal}};u([B({count:Le.COUNT})],ORe.prototype,"blendMode",void 0);let HR=class extends ORe{constructor(){super(...arguments),this.output=On.Composite,this.baseOpacityMode=yp.NotRequired,this.premultipliedSource=ep.Off}};u([B({count:On.COUNT})],HR.prototype,"output",void 0),u([B({count:yp.COUNT})],HR.prototype,"baseOpacityMode",void 0),u([B()],HR.prototype,"premultipliedSource",void 0);var ax;function K0t(t){const e=new Sr;if(e.include(aRe),t.background===ax.Only){const r=t.output===On.ColorComposite;return r?e.fragment.uniforms.add(new kt("backgroundColor",i=>i.backgroundColor)):e.fragment.include(vee),e.fragment.code.add(w`
    void main() {
      fragColor = vec4(${r?w`backgroundColor`:w`gridColor(uv)`}, 1.0);
    }
  `),e}return e.include(lRe,t),e.fragment.uniforms.add(new rt("tex",r=>r.texture)),e.fragment.uniforms.add(new Ie("opacity",r=>r.opacity)),e.fragment.code.add(w`void main() {
vec4 bgColor = getBackground(uv);
fragColor = blendLayers(bgColor, texture(tex, uv), opacity);
}`),e}(function(t){t[t.BelowLayer=0]="BelowLayer",t[t.Only=1]="Only",t[t.COUNT=2]="COUNT"})(ax||(ax={}));const eyt=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return ax},build:K0t},Symbol.toStringTag,{value:"Module"}));let tyt=class extends oRe{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=sl}},RRe=class MRe extends Lr{initializeProgram(e){return new Rr(e.rctx,MRe.shader.get().build(this.configuration),Tr)}initializePipeline(){return Mt({blending:zc(Se.ONE,Se.ONE_MINUS_SRC_ALPHA),colorWrite:Bt})}};RRe.shader=new Or(eyt,()=>he(()=>import("./BlendLayers.glsl-3fcfcf95.js"),[],import.meta.url));let PRe=class extends HR{constructor(){super(...arguments),this.background=ax.BelowLayer}};u([B()],PRe.prototype,"background",void 0);let yV=class{constructor(e,r,i,s,n,o){this.texture=e,this.type=r,e.retain(),this.offsetAndScale=Nt(i.offset[0],i.offset[1],i.scale,i.scale),this.opacities=Pe(s,n,o)}destroy(){this.texture.release()}};function ryt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function iyt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function syt(t,e,r,i,s,n,o){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t[4]=n,t[5]=o,t}function IRe(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5];let l=r*n-i*s;return l?(l=1/l,t[0]=n*l,t[1]=-i*l,t[2]=-s*l,t[3]=r*l,t[4]=(s*a-n*o)*l,t[5]=(i*o-r*a)*l,t):null}function nyt(t){return t[0]*t[3]-t[1]*t[2]}function $Re(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=r[0],h=r[1],d=r[2],f=r[3],m=r[4],g=r[5];return t[0]=i*c+n*h,t[1]=s*c+o*h,t[2]=i*d+n*f,t[3]=s*d+o*f,t[4]=i*m+n*g+a,t[5]=s*m+o*g+l,t}function Cee(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=Math.sin(r),h=Math.cos(r);return t[0]=i*h+n*c,t[1]=s*h+o*c,t[2]=i*-c+n*h,t[3]=s*-c+o*h,t[4]=a,t[5]=l,t}function LRe(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=r[0],h=r[1];return t[0]=i*c,t[1]=s*c,t[2]=n*h,t[3]=o*h,t[4]=a,t[5]=l,t}function Aee(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=r[0],h=r[1];return t[0]=i,t[1]=s,t[2]=n,t[3]=o,t[4]=i*c+n*h+a,t[5]=s*c+o*h+l,t}function oyt(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t[4]=0,t[5]=0,t}function ayt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function Oee(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function lyt(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function cyt(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+1)}function uyt(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t}function DRe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}function hyt(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t}function dyt(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t}function pyt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function fyt(t,e){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=e[0],c=e[1],h=e[2],d=e[3],f=e[4],m=e[5],g=cl();return Math.abs(r-l)<=g*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(i-c)<=g*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(s-h)<=g*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(n-d)<=g*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(o-f)<=g*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(a-m)<=g*Math.max(1,Math.abs(a),Math.abs(m))}const myt=$Re,gyt=DRe;Object.freeze(Object.defineProperty({__proto__:null,add:uyt,copy:ryt,determinant:nyt,equals:fyt,exactEquals:pyt,frob:cyt,fromRotation:oyt,fromScaling:ayt,fromTranslation:Oee,identity:iyt,invert:IRe,mul:myt,multiply:$Re,multiplyScalar:hyt,multiplyScalarAndAdd:dyt,rotate:Cee,scale:LRe,set:syt,str:lyt,sub:gyt,subtract:DRe,translate:Aee},Symbol.toStringTag,{value:"Module"}));function NRe(){const t=new Float32Array(6);return t[0]=1,t[3]=1,t}function yyt(t){const e=new Float32Array(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function _yt(t,e,r,i,s,n){const o=new Float32Array(6);return o[0]=t,o[1]=e,o[2]=r,o[3]=i,o[4]=s,o[5]=n,o}function vyt(t,e){return new Float32Array(t,e,6)}function FRe(t,e,r,i){const s=e[i],n=e[i+1];t[i]=r[0]*s+r[2]*n+r[4],t[i+1]=r[1]*s+r[3]*n+r[5]}function byt(t,e,r,i=0,s=0,n=2){const o=s||e.length/n;for(let a=i;a<o;a++)FRe(t,e,r,a*n)}Object.freeze(Object.defineProperty({__proto__:null,clone:yyt,create:NRe,createView:vyt,fromValues:_yt,transform:FRe,transformMany:byt},Symbol.toStringTag,{value:"Module"}));function JN(){return[1,0,0,1,0,0]}function wyt(t){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function xyt(t,e,r,i,s,n){return[t,e,r,i,s,n]}function Tyt(t,e){return new Float64Array(t,e,6)}Object.freeze(Object.defineProperty({__proto__:null,clone:wyt,create:JN,createView:Tyt,fromValues:xyt},Symbol.toStringTag,{value:"Module"}));function Syt(t){return t instanceof Float32Array&&t.length>=2}function Eyt(t){return Array.isArray(t)&&t.length>=2}function _V(t){return Syt(t)||Eyt(t)}const Cyt=96,Ayt=39.37;function Ree(t,e){return e.type?or(t,e.x,e.y):yn(t,e)}function Oyt(t){return Ta(t)}function Ryt(t,e){const r=t.targetGeometry,i=e.targetGeometry;return r.x=i.x,r.y=i.y,r.spatialReference=i.spatialReference,t.scale=e.scale,t.rotation=e.rotation,t}const Myt=function(){const t=He();return function(e,r,i){const s=r.targetGeometry;Ree(t,s);const n=.5*W9(r);return e.xmin=t[0]-n*i[0],e.ymin=t[1]-n*i[1],e.xmax=t[0]+n*i[0],e.ymax=t[1]+n*i[1],e.spatialReference=s.spatialReference,e}}();function W9(t){return t.scale*Pyt(t.targetGeometry)}function Pyt(t){return t!=null&&fa(t.spatialReference)?1/(Oyt(t.spatialReference)*Ayt*Cyt):1}function Iyt(t){return q6(t.rotation)||0}const Mee=function(){const t=He(),e=He(),r=He();return function(i,s,n,o,a,l){return jJ(t,s),Sc(e,n,.5*l),or(r,1/o*l,-1/o*l),Oee(i,e),a&&Cee(i,i,a),LRe(i,i,r),Aee(i,i,t),i}}(),$yt=function(){const t=He();return function(e,r,i,s){const n=W9(r),o=Iyt(r);return Ree(t,r.targetGeometry),Mee(e,t,i,n,o,s)}}(),Lyt=function(){const t=He();return function(e,r,i,s){const n=W9(r);return Ree(t,r.targetGeometry),Mee(e,t,i,n,0,s)}}();function Dyt(t){const e=cw(t);return e?e.valid[1]-e.valid[0]:0}function Nyt(t,e){return Math.round(Dyt(t)/e)}var Kq;const Km=[0,0];let e_=Kq=class extends ue{constructor(t){super(t),this._viewpoint2D={center:He(),rotation:0,scale:0,spatialReference:void 0},this.center=[0,0],this.extent=new cr,this.id=0,this.inverseTransform=JN(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=JN(),this.transformNoRotation=JN(),this.displayMat3=kl(),this.displayViewMat3=kl(),this.viewMat3=kl(),this.viewMat2d=NRe(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(t){this._set("pixelRatio",t),this._update()}set size(t){this._set("size",t),this._update()}set viewpoint(t){if(t){const e=this._viewpoint2D,r=t.targetGeometry;e.center[0]=r.x,e.center[1]=r.y,e.rotation=t.rotation,e.scale=t.scale,e.spatialReference=r.spatialReference}this._update()}copy(t){const e=this.size,r=this.viewpoint;return r&&e?(this.viewpoint=Ryt(r,t.viewpoint),this._set("size",yn(e,t.size))):(this.viewpoint=t.viewpoint.clone(),this._set("size",[t.size[0],t.size[1]])),this._set("pixelRatio",t.pixelRatio),this}clone(){return new Kq({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(t,e,r){return _V(e)?tb(t,e,this.inverseTransform):(Km[0]=e,Km[1]=r,tb(t,Km,this.inverseTransform))}toScreen(t,e,r){return _V(e)?tb(t,e,this.transform):(Km[0]=e,Km[1]=r,tb(t,Km,this.transform))}toScreenNoRotation(t,e,r){return _V(e)?tb(t,e,this.transformNoRotation):(Km[0]=e,Km[1]=r,tb(t,Km,this.transformNoRotation))}getScreenTransform(t,e){const{center:r}=this._viewpoint2D,i=this._get("pixelRatio")||1,s=this._get("size");return Mee(t,r,s,e,0,i),t}_update(){const{center:t,spatialReference:e,scale:r,rotation:i}=this._viewpoint2D,s=this._get("pixelRatio")||1,n=this._get("size"),o=new Mp({targetGeometry:new tt(t[0],t[1],e),scale:r,rotation:i});if(this._set("viewpoint",o),!n||!e||!r)return;this.resolution=W9(o),this.rotation=i,this.scale=r,this.spatialReference=e,yn(this.center,t);const a=n[0]!==0?2/n[0]:0,l=n[1]!==0?-2/n[1]:0;rQ(this.displayMat3,a,0,0,0,l,0,-1,1,1);const c=iQ(this.viewMat3),h=Rh(n[0]/2,n[1]/2),d=Rh(-n[0]/2,-n[1]/2),f=q6(i);z5(c,c,h),sQ(c,c,f),z5(c,c,d),UE(this.displayViewMat3,this.displayMat3,c);const m=Oee(this.viewMat2d,h);return Cee(m,m,f),Aee(m,m,d),Myt(this.extent,o,n),$yt(this.transform,o,n,s),IRe(this.inverseTransform,this.transform),Lyt(this.transformNoRotation,o,n,s),this.worldScreenWidth=Nyt(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};u([p({readOnly:!0})],e_.prototype,"id",void 0),u([p({value:1,json:{write:!0}})],e_.prototype,"pixelRatio",null),u([p({json:{write:!0}})],e_.prototype,"size",null),u([p()],e_.prototype,"spatialReference",void 0),u([p({type:Mp,json:{write:!0}})],e_.prototype,"viewpoint",null),e_=Kq=u([P("esri.views.2d.ViewState")],e_);const Fyt=e_;var eW,tW,Bue,Gue,jue,Hue,que,Wue,Xue,Yue,Zue,Jue,Que,Kue,ehe,the,rhe,ihe,she,nhe,ohe,ahe,lhe,che,uhe,hhe,dhe,phe,fhe,mhe,ghe,yhe,_he,vhe,bhe,whe,xhe,The,She,Ehe,Che,Ahe,Ohe,Rhe,Mhe,Phe,Ihe,$he,Lhe,Dhe,Nhe,Fhe,Uhe,khe,zhe,Vhe,Bhe,Ghe,jhe,Hhe,qhe;(function(t){t[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE",t[t.UNKNOWN=4]="UNKNOWN"})(eW||(eW={})),function(t){t[t.BEVEL=0]="BEVEL",t[t.ROUND=1]="ROUND",t[t.MITER=2]="MITER",t[t.UNKNOWN=4]="UNKNOWN"}(tW||(tW={})),function(t){t[t.SCREEN=0]="SCREEN",t[t.MAP=1]="MAP"}(Bue||(Bue={})),function(t){t[t.Tint=0]="Tint",t[t.Ignore=1]="Ignore",t[t.Multiply=99]="Multiply"}(Gue||(Gue={})),function(t){t.Both="Both",t.JustBegin="JustBegin",t.JustEnd="JustEnd",t.None="None"}(jue||(jue={})),function(t){t[t.Mosaic=0]="Mosaic",t[t.Centered=1]="Centered"}(Hue||(Hue={})),function(t){t[t.Normal=0]="Normal",t[t.Superscript=1]="Superscript",t[t.Subscript=2]="Subscript"}(que||(que={})),function(t){t[t.MSSymbol=0]="MSSymbol",t[t.Unicode=1]="Unicode"}(Wue||(Wue={})),function(t){t[t.Unspecified=0]="Unspecified",t[t.TrueType=1]="TrueType",t[t.PSOpenType=2]="PSOpenType",t[t.TTOpenType=3]="TTOpenType",t[t.Type1=4]="Type1"}(Xue||(Xue={})),function(t){t[t.Display=0]="Display",t[t.Map=1]="Map"}(Yue||(Yue={})),function(t){t.None="None",t.Loop="Loop",t.Oscillate="Oscillate"}(Zue||(Zue={})),function(t){t[t.Z=0]="Z",t[t.X=1]="X",t[t.Y=2]="Y"}(Jue||(Jue={})),function(t){t[t.XYZ=0]="XYZ",t[t.ZXY=1]="ZXY",t[t.YXZ=2]="YXZ"}(Que||(Que={})),function(t){t[t.Rectangle=0]="Rectangle",t[t.RoundedRectangle=1]="RoundedRectangle",t[t.Oval=2]="Oval"}(Kue||(Kue={})),function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.Screen=2]="Screen",t[t.Multiply=3]="Multiply",t[t.Add=4]="Add"}(ehe||(ehe={})),function(t){t[t.TTB=0]="TTB",t[t.RTL=1]="RTL",t[t.BTT=2]="BTT"}(the||(the={})),function(t){t[t.None=0]="None",t[t.SignPost=1]="SignPost",t[t.FaceNearPlane=2]="FaceNearPlane"}(rhe||(rhe={})),function(t){t[t.Float=0]="Float",t[t.String=1]="String",t[t.Boolean=2]="Boolean"}(ihe||(ihe={})),function(t){t[t.Intersect=0]="Intersect",t[t.Subtract=1]="Subtract"}(she||(she={})),function(t){t.OpenEnded="OpenEnded",t.Block="Block",t.Crossed="Crossed"}(nhe||(nhe={})),function(t){t.FullGeometry="FullGeometry",t.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment",t.ReversedFirstSegment="ReversedFirstSegment",t.PerpendicularToSecondSegment="PerpendicularToSecondSegment",t.SecondSegmentWithTicks="SecondSegmentWithTicks",t.DoublePerpendicular="DoublePerpendicular",t.OppositeToFirstSegment="OppositeToFirstSegment",t.TriplePerpendicular="TriplePerpendicular",t.HalfCircleFirstSegment="HalfCircleFirstSegment",t.HalfCircleSecondSegment="HalfCircleSecondSegment",t.HalfCircleExtended="HalfCircleExtended",t.OpenCircle="OpenCircle",t.CoverageEdgesWithTicks="CoverageEdgesWithTicks",t.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks",t.GapExtentMidline="GapExtentMidline",t.Chevron="Chevron",t.PerpendicularWithArc="PerpendicularWithArc",t.ClosedHalfCircle="ClosedHalfCircle",t.TripleParallelExtended="TripleParallelExtended",t.ParallelWithTicks="ParallelWithTicks",t.Parallel="Parallel",t.PerpendicularToFirstSegment="PerpendicularToFirstSegment",t.ParallelOffset="ParallelOffset",t.OffsetOpposite="OffsetOpposite",t.OffsetSame="OffsetSame",t.CircleWithArc="CircleWithArc",t.DoubleJog="DoubleJog",t.PerpendicularOffset="PerpendicularOffset",t.LineExcludingLastSegment="LineExcludingLastSegment",t.MultivertexArrow="MultivertexArrow",t.CrossedArrow="CrossedArrow",t.ChevronArrow="ChevronArrow",t.ChevronArrowOffset="ChevronArrowOffset",t.PartialFirstSegment="PartialFirstSegment",t.Arch="Arch",t.CurvedParallelTicks="CurvedParallelTicks",t.Arc90Degrees="Arc90Degrees"}(ohe||(ohe={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square",t.TrueBuffer="TrueBuffer"}(ahe||(ahe={})),function(t){t.ClosePath="ClosePath",t.ConvexHull="ConvexHull",t.RectangularBox="RectangularBox"}(lhe||(lhe={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(che||(che={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square"}(uhe||(uhe={})),function(t){t.Fast="Fast",t.Accurate="Accurate"}(hhe||(hhe={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(dhe||(dhe={})),function(t){t.Sinus="Sinus",t.Square="Square",t.Triangle="Triangle",t.Random="Random"}(phe||(phe={})),function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Force=2]="Force"}(fhe||(fhe={})),function(t){t[t.Buffered=0]="Buffered",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.AlongLine=3]="AlongLine"}(mhe||(mhe={})),function(t){t[t.Linear=0]="Linear",t[t.Rectangular=1]="Rectangular",t[t.Circular=2]="Circular",t[t.Buffered=3]="Buffered"}(ghe||(ghe={})),function(t){t[t.Discrete=0]="Discrete",t[t.Continuous=1]="Continuous"}(yhe||(yhe={})),function(t){t[t.AcrossLine=0]="AcrossLine",t[t.AloneLine=1]="AloneLine"}(_he||(_he={})),function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Center=2]="Center",t[t.Justify=3]="Justify"}(vhe||(vhe={})),function(t){t[t.Base=0]="Base",t[t.MidPoint=1]="MidPoint",t[t.ThreePoint=2]="ThreePoint",t[t.FourPoint=3]="FourPoint",t[t.Underline=4]="Underline",t[t.CircularCW=5]="CircularCW",t[t.CircularCCW=6]="CircularCCW"}(bhe||(bhe={})),function(t){t.Butt="Butt",t.Round="Round",t.Square="Square"}(whe||(whe={})),function(t){t.NoConstraint="NoConstraint",t.HalfPattern="HalfPattern",t.HalfGap="HalfGap",t.FullPattern="FullPattern",t.FullGap="FullGap",t.Custom="Custom"}(xhe||(xhe={})),function(t){t[t.None=-1]="None",t[t.Custom=0]="Custom",t[t.Circle=1]="Circle",t[t.OpenArrow=2]="OpenArrow",t[t.ClosedArrow=3]="ClosedArrow",t[t.Diamond=4]="Diamond"}(The||(The={})),function(t){t[t.ExtraLeading=0]="ExtraLeading",t[t.Multiple=1]="Multiple",t[t.Exact=2]="Exact"}(She||(She={})),function(t){t.Bevel="Bevel",t.Round="Round",t.Miter="Miter"}(Ehe||(Ehe={})),function(t){t[t.Default=0]="Default",t[t.String=1]="String",t[t.Numeric=2]="Numeric"}(Che||(Che={})),function(t){t[t.InsidePolygon=0]="InsidePolygon",t[t.PolygonCenter=1]="PolygonCenter",t[t.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"}(Ahe||(Ahe={})),function(t){t[t.Tint=0]="Tint",t[t.Replace=1]="Replace",t[t.Multiply=2]="Multiply"}(Ohe||(Ohe={})),function(t){t[t.ClipAtBoundary=0]="ClipAtBoundary",t[t.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary",t[t.DoNotTouchBoundary=2]="DoNotTouchBoundary",t[t.DoNotClip=3]="DoNotClip"}(Rhe||(Rhe={})),function(t){t.NoConstraint="NoConstraint",t.WithMarkers="WithMarkers",t.WithFullGap="WithFullGap",t.WithHalfGap="WithHalfGap",t.Custom="Custom"}(Mhe||(Mhe={})),function(t){t.Fixed="Fixed",t.Random="Random",t.RandomFixedQuantity="RandomFixedQuantity"}(Phe||(Phe={})),function(t){t.LineMiddle="LineMiddle",t.LineBeginning="LineBeginning",t.LineEnd="LineEnd",t.SegmentMidpoint="SegmentMidpoint"}(Ihe||(Ihe={})),function(t){t.OnPolygon="OnPolygon",t.CenterOfMass="CenterOfMass",t.BoundingBoxCenter="BoundingBoxCenter"}($he||($he={})),function(t){t[t.Low=0]="Low",t[t.Medium=1]="Medium",t[t.High=2]="High"}(Lhe||(Lhe={})),function(t){t[t.MarkerCenter=0]="MarkerCenter",t[t.MarkerBounds=1]="MarkerBounds"}(Dhe||(Dhe={})),function(t){t[t.None=0]="None",t[t.PropUniform=1]="PropUniform",t[t.PropNonuniform=2]="PropNonuniform",t[t.DifUniform=3]="DifUniform",t[t.DifNonuniform=4]="DifNonuniform"}(Nhe||(Nhe={})),function(t){t.Tube="Tube",t.Strip="Strip",t.Wall="Wall"}(Fhe||(Fhe={})),function(t){t[t.Random=0]="Random",t[t.Increasing=1]="Increasing",t[t.Decreasing=2]="Decreasing",t[t.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"}(Uhe||(Uhe={})),function(t){t[t.Relative=0]="Relative",t[t.Absolute=1]="Absolute"}(khe||(khe={})),function(t){t[t.Normal=0]="Normal",t[t.LowerCase=1]="LowerCase",t[t.Allcaps=2]="Allcaps"}(zhe||(zhe={})),function(t){t[t.LTR=0]="LTR",t[t.RTL=1]="RTL"}(Vhe||(Vhe={})),function(t){t.Draft="Draft",t.Picture="Picture",t.Text="Text"}(Bhe||(Bhe={})),function(t){t[t.Top=0]="Top",t[t.Center=1]="Center",t[t.Baseline=2]="Baseline",t[t.Bottom=3]="Bottom"}(Ghe||(Ghe={})),function(t){t[t.Right=0]="Right",t[t.Upright=1]="Upright"}(jhe||(jhe={})),function(t){t[t.Small=0]="Small",t[t.Medium=1]="Medium",t[t.Large=2]="Large"}(Hhe||(Hhe={})),function(t){t[t.Calm=0]="Calm",t[t.Rippled=1]="Rippled",t[t.Slight=2]="Slight",t[t.Moderate=3]="Moderate"}(qhe||(qhe={}));var rW,qb,iW,BF,sW,GF,nW,Wb,oW;(function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(rW||(rW={})),function(t){t[t.VISIBLE=0]="VISIBLE",t[t.NONE=1]="NONE"}(qb||(qb={})),function(t){t[t.POINT=0]="POINT",t[t.LINE=1]="LINE",t[t.LINE_CENTER=2]="LINE_CENTER"}(iW||(iW={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT",t[t.AUTO=2]="AUTO"}(BF||(BF={})),function(t){t[t.AUTO=0]="AUTO",t[t.LEFT=1]="LEFT",t[t.CENTER=2]="CENTER",t[t.RIGHT=3]="RIGHT"}(sW||(sW={})),function(t){t[t.CENTER=0]="CENTER",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.TOP=3]="TOP",t[t.BOTTOM=4]="BOTTOM",t[t.TOP_LEFT=5]="TOP_LEFT",t[t.TOP_RIGHT=6]="TOP_RIGHT",t[t.BOTTOM_LEFT=7]="BOTTOM_LEFT",t[t.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"}(GF||(GF={})),function(t){t[t.NONE=0]="NONE",t[t.UPPERCASE=1]="UPPERCASE",t[t.LOWERCASE=2]="LOWERCASE"}(nW||(nW={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT"}(Wb||(Wb={})),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(oW||(oW={}));let wd=class{};wd.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:qb.VISIBLE}},wd.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:qb.VISIBLE}},wd.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:qb.VISIBLE},"line-cap":{type:"enum",values:["butt","round","square"],default:eW.BUTT},"line-join":{type:"enum",values:["bevel","round","miter"],default:tW.MITER},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}},wd.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:qb.VISIBLE},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:iW.POINT},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:GF.CENTER},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:BF.AUTO},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:GF.CENTER},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:sW.CENTER},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:BF.AUTO},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:nW.NONE},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[oW.HORIZONTAL]}},wd.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:qb.VISIBLE}},wd.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}},wd.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:Wb.MAP}},wd.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:Wb.MAP},"line-width":{type:"number",minimum:0,default:1}},wd.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:Wb.MAP},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:Wb.MAP}},wd.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}},wd.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:Wb.MAP}};const Uyt=.125;let kyt=class{constructor(){this._renderParams={context:null,drawPhase:1,state:new Fyt({viewpoint:new Mp({targetGeometry:new tt(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null}}dispose(){this._renderParams=null}render(e,r,i,s,n,o,a,l,c,h,d){this._render(e,r,i,s,n,o,a,l,c,h,d)}renderSymbols(e,r,i,s,n,o,a,l,c,h,d){this._render(e,r,i,s,n,o,a,l,c,h,d,rW.SYMBOL)}_render(e,r,i,s,n,o,a,l,c,h,d,f){const m=r[0]-o.getLevelShift(r[0]),g=this._renderParams;g.context=e,g.painter=s,g.glyphMosaic=s.glyphMosaic,g.spriteMosaic=s.spriteMosaic,g.pixelRatio=h*d,g.displayLevel=m,g.requiredLevel=m;const _=o.getScale(r[0]),[v,b]=o.getOffset(r,a*_),T=Uyt*a*_/c,x=i.transforms.dvs;x[0]=T,x[4]=-T,x[6]=-1-v-l[0]*a*2,x[7]=1+b+(1-l[1])*a*2-2,g.state.size[0]=c/d,g.state.size[1]=c/d,g.state.pixelRatio=d,i.stage||i.attachWithContext(e),i.triangleCount=0,s.drawTile(g,i,n,f)}},URe=class kRe extends Lr{initializeProgram(e){return new Rr(e.rctx,kRe.shader.get().build(this.configuration),Tr)}initializePipeline(){return Mt({blending:zc(Se.ONE,Se.ONE_MINUS_SRC_ALPHA),colorWrite:Bt})}};URe.shader=new Or(s0t,()=>he(()=>import("./RasterColorizer.glsl-215d0770.js"),[],import.meta.url));let SO=class extends HR{constructor(){super(...arguments),this.colorizerType=Cw.Stretch,this.stretchType=ox.Noop,this.applyColormap=!0,this.requireBilinearWithNN=!1}};u([B({count:Cw.COUNT})],SO.prototype,"colorizerType",void 0),u([B({count:ox.COUNT})],SO.prototype,"stretchType",void 0),u([B()],SO.prototype,"applyColormap",void 0),u([B()],SO.prototype,"requireBilinearWithNN",void 0);let Whe=class{constructor(e){this._rctx=e,this._fbos=new Map}get(e){return this._getPool(e)}dispose(){this._fbos.forEach(e=>e.dispose()),this._fbos.clear()}_getPool(e){const r=this._fbos.get(e);if(r)return r;const i=new fn(this._rctx,new xr(e),new B5(Zs.DEPTH_COMPONENT16,e));return this._fbos.set(e,i),i}};const zyt=K.getLogger("esri.views.3d.terrain");let Vyt=class{constructor(e,r){this._rctx=e,this._techniqueRepository=r,this._fbos=[],this._vectorTileHelper=new kyt,this._bindParameters=new V8(null,null,null),this._blendLayersTechniqueConfig=new PRe,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=Hl(this._rctx,MP)}dispose(){this._fbos.forEach(je),this._fbos=null,this._vtFBO=je(this._vtFBO),this._vaoQuad=je(this._vaoQuad),this._vectorTileHelper=je(this._vectorTileHelper),this._backgroundTechnique=Gi(this._backgroundTechnique),this._applyOpacityTechnique=Gi(this._applyOpacityTechnique),this._blendLayersTechnique=Gi(this._blendLayersTechnique)}_getBlendLayersTechnique(e,r,i,s=ep.Off,n=ax.BelowLayer){return this._blendLayersTechniqueConfig.output=r,this._blendLayersTechniqueConfig.blendMode=e,this._blendLayersTechniqueConfig.baseOpacityMode=i,this._blendLayersTechniqueConfig.premultipliedSource=s,this._blendLayersTechniqueConfig.background=n,this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(RRe,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(e,r){const i=this._getBlendLayersTechnique(Le.Normal,r?On.ColorComposite:On.GridComposite,yp.NotRequired,ep.Off,ax.Only),s=this._rctx.bindTechnique(i,e,this._bindParameters);this._render(s)}_render(e){this._rctx.bindVAO(this._vaoQuad),e.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(At.TRIANGLE_STRIP,0,Go(this._vaoQuad,"geometry"))}drawGroup(e,r,i,s,n,o=ep.On){r===On.Composite&&(e.fboTexture=this._fbos[this.getLastOnHoldId()].get(i).colorTexture),e.texture=this.currentFBO(i).colorTexture,this.closeGroup(i);const a=this._getBlendLayersTechnique(s,r,n,o),l=this._rctx.bindTechnique(a,e,this._bindParameters);this._render(l)}drawRasterData(e,r,i,s,n,o=ep.Off){if(e.texture==null)return;e.fboTexture=r===On.GroupBackgroundComposite||s===Le.Normal&&n===yp.NotRequired&&o===ep.Off?null:this.switch(i).colorTexture;const a=this._getBlendLayersTechnique(s,r,n,o),l=this._rctx.bindTechnique(a,e,this._bindParameters);this._render(l)}drawImageryTileData(e,r,i,s,n,o){const a=o.sourceLayerInfo.data;if(!a.source||(o.tile.surface.layerViewByIndex(o.layerIndex,tr.MAP).ensureSymbolizerParameters(a),!a.bind(this._rctx)))return;e.fboTexture=s===Le.Normal&&n===yp.NotRequired?null:this.switch(i).colorTexture;const l=this._getRasterColorizerTechnique(a,r,s,n);a.opacity=e.opacity;const c=a.getUniforms();c.scale=o.scale,c.offset=o.offset,c.backgroundColor=e.backgroundColor,c.fboTexture=e.fboTexture,c.baseOpacity=e.baseOpacity;const h=this._rctx.bindTechnique(l,c,null);this._render(h)}_getRasterColorizerTechnique(e,r,i,s){const n=e.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(n.type);return this._rasterColorizerConfig==null&&(this._rasterColorizerConfig=new SO,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=r,this._rasterColorizerConfig.blendMode=i,this._rasterColorizerConfig.baseOpacityMode=s,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!n.colormap,this._rasterColorizerConfig.requireBilinearWithNN=e.isBilinearWithStretchColorRamp,this._rasterColorizerConfig.stretchType=e.hasStretchTypeNone()?ox.Noop:ox.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(URe,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(e,r,i,s,n,o,a,l,c){const h=this._rctx,d=o.sourceLayerInfo.data,f=o.tile.surface.layerViewByIndex(o.layerIndex,tr.MAP),m=n===yp.Required||e.opacity<1||s!==Le.Normal||r!==On.Composite,g=m?ep.On:ep.Off;this._getBlendLayersTechnique(s,r,n,g).bindPipelineState(h);let _=null,v=null;m?(v=this.currentFBO(i),this._vtFBO==null&&(this._vtFBO=new Whe(this._rctx)),_=this._vtFBO.get(i),h.bindFramebuffer(_),this._clearCurrentFBO()):c&&h.clearSafe(Si.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.render(h,o.sourceLod,d,f.painter,f.layer.styleRepository,f.schemaHelper,Math.round(1/o.scale),o.offset,l,a,f.contentZoom),o.vtlNeighborInfos.forAll(b=>this._vectorTileHelper.renderSymbols(h,b.sourceLod,b.sourceLayerInfo.data,f.painter,f.layer.styleRepository,f.schemaHelper,1,b.offset,l,a,f.contentZoom))}catch(b){zyt.warnOnce("A render call containing vector tiles did not resolve correctly.",b)}return _==null||(h.bindFramebuffer(v),e.texture=_.colorTexture,e.offset=Pp,e.scale=1,this.drawRasterData(e,r,i,s,n,g),c)}copyFBOToTexture(e){const r=this._rctx,i=r.bindTexture(e.texture,Ot.TEXTURE_UNIT_FOR_UPDATES),s=e.descriptor;r.gl.copyTexImage2D(cs.TEXTURE_2D,0,s.pixelFormat,0,0,s.width,s.height,0),e.generateMipmap(),r.bindTexture(i,Ot.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.clearSafe(Si.COLOR_BUFFER_BIT|Si.DEPTH_BUFFER_BIT)}_initFBO(e,r,i){this._rctx.bindFramebuffer(e),i&&(this._rctx.setViewport(0,0,r,r),this._clearCurrentFBO())}ensureBuffer(e){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(e)}bind(e,r=0,i=!0){if(this._current=r,r>=this._fbos.length)for(let s=this._fbos.length;s<=r;s++)this._fbos.push(new Whe(this._rctx));this._initFBO(this._fbos[r].get(e),e,i)}_bindNextFreeBuffer(e){this._lastUsedIds.length>0?this.bind(e,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(e,this._lastCreatedBufferId))}openGroup(e){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(e)}switch(e){const r=this.currentFBO(e),i=this._current;return this._bindNextFreeBuffer(e),this._lastUsedIds.push(i),r}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(e){const r=this._current;this._bindNextFreeBuffer(e),this._lastUsedIds.push(r),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(e){return this._fbos[this._current].get(e)}},Byt=class{constructor(){this.sourceLod=[0,0,0],this.offset=[0,0],this.scale=1,this.layerIndex=0,this.vtlNeighborInfos=new Vt({allocator:e=>e||new Gyt})}},Gyt=class{constructor(){this.sourceLayerInfo=null,this.sourceLod=[0,0,0],this.offset=[-1,0]}},jyt=class{constructor(e,r,i,s){this.start=e,this.end=r,this.blendMode=i,this.opacity=s}},Hyt=class{constructor(e,r,i){this._rctx=e,this.tileSize=r,this._techniqueRepository=i,this._passParameters=new tyt,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._blackTex=null,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._composition=new Vyt(this._rctx,this._techniqueRepository),this._blackTex=new I2(tWe(this._rctx,[0,0,0,1])),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=je(this._composition),this._backgroundTexture=Gi(this._backgroundTexture),this._blackTex=Gi(this._blackTex)}get backgroundIsGrid(){return this._backgroundColor==null}get backgroundColor(){return this._backgroundColor}updateTileTexture(e,r){if(!e.renderData)return;const i=e.surface,s=i.baseOpacity;let n=0,o=0,a=this.tileSize,l=!1;const c=i.view.state.contentPixelRatio;let h=!1;jF.clear(),NT.length=0;const d=e.layerInfo[tr.MAP];let f=d.length,m=0,g=null;for(;m<d.length;m++){const v=i.layerViewByIndex(m,tr.MAP),b=v.layer.opacity;Xhe[m]=b;const T=v.fullOpacity;if(Yhe[m]=T,mye(v.layer)&&f>=d.length&&(f=m),FF(v)){Zhe[m]=v.layer.blendMode;let S=v.layer.blendMode!=="normal";if(mE(v.layer.parent)){const E=aW(v.layer.parent);E!=null&&E!==""&&(S=zRe(v.layer.parent)||S)}S&&(h=S,l=!1)}if(b===0&&!h){d[m].pendingUpdates&=~(wt.TEXTURE_NOFADING&wt.TEXTURE_FADING);continue}++o;const x=vV(e,m);if(x){if(d[m].pendingUpdates&=~(wt.TEXTURE_NOFADING&wt.TEXTURE_FADING),mE(v.layer.parent)){const S=aW(v.layer.parent);S!=null&&S!==""&&VRe(v.layer.parent,m)}GM(v)?a=Math.max(a,this.tileSize*c):s===1&&T===1&&(v.isOpaque||this._dataToTexture(x)&&x.sourceLayerInfo.data.descriptor.isOpaque)&&(l=!0),++n,g===null&&(g=m)}}const _=a/this.tileSize;this._ensureBackgroundTexture(this.tileSize),n!==0&&g!==null?n===1&&!h&&this._useLayerTexture(e,g,f,Yhe[g])||this._composeMapLayers(e,r,m-1,f,Xhe,Zhe,a,_,!l||h,jF,h):this._useBackgroundTexture(e,o)}_ensureBackgroundTexture(e){this._backgroundTexture==null&&(this._backgroundTexture=this._buildTexture(e),this._backgroundDirty=!0),this._backgroundDirty&&(this._composition.bind(e),this._passParameters.offset=Pp,this._passParameters.scale=1,this._passParameters.opacity=1,this.backgroundColor!=null&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,this.backgroundColor!=null),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.unbind(),this._backgroundDirty=!1)}_useBackgroundTexture(e,r){let i=o0.Immediate;(e.surface.view.layerViewManager.updating||r>0)&&(i=o0.Delayed);const s=e.renderData;this._backgroundTexture&&s.textureReference==null&&(i=o0.Immediate),s.setTextureReference(this._backgroundTexture!=null?new yV(this._backgroundTexture,cn.FADING,Jhe,e.surface.baseOpacity,0,1):null,i)}_useLayerTexture(e,r,i,s){const n=r<i,o=n?1:e.surface.baseOpacity,a=n?e.surface.baseOpacity:1,l=vV(e,r);return!!this._dataToTexture(l)&&(e.renderData.setTextureReference(new yV(l.sourceLayerInfo.data,cn.FADING,l,o,a,s)),!0)}_composeMapLayers(e,r,i,s,n,o,a,l,c,h,d){this._composition.ensureBuffer(a);const f=e.surface.baseOpacity;let m=!1,g=Rt.LINEAR_MIPMAP_LINEAR,_=!1,v=0;for(let x=i;x>=0;x--){const S=vV(e,x);if(!S||n[x]===0&&!d)continue;const E=x<s&&f<1&&!m;this._passParameters.baseOpacity=E?f:1;const A=this._passParameters.baseOpacity<1?yp.Required:yp.NotRequired;E&&(m=!0);let R=!1;h.forEach(L=>{L.start===x&&(NT.push(L),this._composition.openGroup(a),R=!0)});const M=v===0,D=R?On.GroupBackgroundComposite:c&&M?this.backgroundIsGrid?On.GridComposite:On.ColorComposite:On.Composite,k=Zq[o[x]];for(GOe(S)?(this._passParameters.opacity=n[x],_=this._composition.drawVectorData(this._passParameters,D,a,k,A,S,l,this.tileSize,_)):Cmt(S)?(this._passParameters.opacity=n[x],this._composition.drawImageryTileData(this._passParameters,D,a,k,A,S),this._hasNearestInterpolation(S)&&(g=Rt.NEAREST)):this._dataToTexture(S)&&(this._passParameters.texture=S.sourceLayerInfo.data.texture,this._passParameters.offset=S.offset,this._passParameters.scale=S.scale,this._passParameters.opacity=n[x],this._composition.drawRasterData(this._passParameters,D,a,k,A));NT.length>0&&NT[NT.length-1].end===x;){const L=NT.pop();this._passParameters.opacity=L.opacity,this._passParameters.offset=Pp,this._passParameters.scale=1;const N=c&&M?this.backgroundIsGrid?On.GridComposite:On.ColorComposite:On.Composite;this._composition.drawGroup(this._passParameters,N,a,Zq[L.blendMode],A)}v++}const b=e.renderData,T=b.ensureTexture(a,()=>this._buildTexture(a,g));this._composition.copyFBOToTexture(T),this._composition.unbind(),b.setTextureReference(new yV(T,r,Jhe,m?1:f,0,1))}_hasNearestInterpolation(e){const r=e.sourceLayerInfo.data;return!!r.source&&r.interpolation==="nearest"}_dataToTexture(e){if(Omt(e)){const r=e.sourceLayerInfo;r.data=this._buildTexture(r.data),e.tile.setMemoryDirty()}return Amt(e)}setBackground(e){this._backgroundColor!==e&&(this._backgroundColor=e,this._backgroundDirty=!0)}_buildTexture(e,r=Rt.LINEAR_MIPMAP_LINEAR){if(e==null)return null;const i=new xr;i.wrapMode=Dt.CLAMP_TO_EDGE,i.samplingMode=r,i.maxAnisotropy=this._maxAnisotropy,i.preMultiplyAlpha=!0,i.flipped=!0,i.hasMipmap=!0;const s=this._rctx;let n;if(typeof e=="number")i.width=i.height=e,n=new I2(new Ot(s,i));else if(e instanceof V9)i.isOpaque=e.isOpaque,n=new I2(new Ot(s,i,e.image)),e.release();else try{i.width=e.width,i.height=e.height,n=new I2(new Ot(s,i,e))}catch{n=new I2(kxe(s)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const o=s.bindTexture(n.texture,Ot.TEXTURE_UNIT_FOR_UPDATES);return n.generateMipmap(),s.bindTexture(o,Ot.TEXTURE_UNIT_FOR_UPDATES),n}get test(){return{backgroundTexture:this._backgroundTexture}}};function vV(t,e){Pa.layerIndex=e,Pa.vtlNeighborInfos.clear();const r=t.layerInfo[tr.MAP][e];if(r.data)return or(Pa.offset,0,0),Pa.tile=t,Pa.scale=1,Pa.sourceLod=t.lij,Pa.sourceLayerInfo=r,GOe(Pa)&&t.forEachLoadedNeighbor((s,n)=>{if(s.level!==t.level)return;const o=s.layerInfo[tr.MAP][e];if(!jOe(o)||r.data===o.data)return;const a=Pa.vtlNeighborInfos.pushNew();a.offset=bg[n],a.sourceLod=s.lij,a.sourceLayerInfo=o}),Pa;const i=r.upsampleInfo;if(i){const s=i.tile.layerInfo[tr.MAP][e];return Pa.tile=i.tile,yn(Pa.offset,i.offset),Pa.scale=i.scale,Pa.sourceLod=i.tile.lij,Pa.sourceLayerInfo=s,Pa}return null}function aW(t){return t.get("uid")}function zRe(t){let e=t.blendMode!=="normal";return mE(t.parent)&&(e=zRe(t.parent)||e),e}function VRe(t,e){mE(t.parent)&&VRe(t.parent,e);const r=aW(t);if(r!=null&&r!==""){const i=jF.get(r);i?i.start=e:jF.set(r,new jyt(e,e,t.blendMode,t.opacity))}}const Xhe=new Array,Yhe=new Array,Zhe=new Array,jF=new Map,NT=new Array,Pa=new Byt,Jhe={offset:[0,0],scale:1},bg=new Array;bg[ht.NORTH]=[0,-1],bg[ht.NORTH_EAST]=[-1,-1],bg[ht.EAST]=[-1,0],bg[ht.SOUTH_EAST]=[-1,1],bg[ht.SOUTH]=[0,1],bg[ht.SOUTH_WEST]=[1,1],bg[ht.WEST]=[1,0],bg[ht.NORTH_WEST]=[1,-1];const BRe=200,bV=40,qyt=.8,Wyt=10,EO=1e-6;function Xyt(t,e,r){const i=e,s=r;let n=0,o=1/0;for(let a=0;a<3;++a){{const l=t[a];if(i[a]<l){if(s[a]<=EO)return!1;const c=(l-i[a])/s[a];n=Math.max(n,c)}else if(s[a]<=-EO){const c=(l-i[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}{const l=t[a+3];if(i[a]>l){if(s[a]>=-EO)return!1;const c=(l-i[a])/s[a];n=Math.max(n,c)}else if(s[a]>=EO){const c=(l-i[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}}return!0}let Qhe=class{constructor(e,r,i,s,n){this.aabb=e,this.axis=r,this.d=i,this.midStartIndex=s,this.rightStartIndex=n}},Pee=class lW{constructor(e,r,i,s){this.globalTriangleVertexIndices=e,this.firstTriangleIndex=r,this.positionAttribute=s,this._rayDirection=O(),this.bspNodeTree=new Array;const n=i-r,o=n<=GRe?new Uint16Array(n):new Uint32Array(n);this.indices=o;for(let a=0;a<n;++a)o[a]=a;{const a=Kyt(e,r,i,s.data,s.stride),l=ve(Math.log2(n/bV),2,Wyt),c=(h,d,f)=>{const m=Jyt(o,a,h,d),g=d-h;if(g<=bV){const S=new Qhe(m,void 0,0,h,d);return this.bspNodeTree.push(S),S}const{axis:_,midValue:v}=Qyt(m),b=Zyt(o,a,h,d,_,v),T=(S,E)=>{if(f>l)return;const A=E-S;return A<bV||A>=qyt*g?void 0:c(S,E,f+1)},x=new Qhe(m,_,v,b.next,b.mid);return this.bspNodeTree.push(x),x.leftNode=T(h,b.next),x.rightNode=T(b.mid,d),x};c(0,n,0),this.triangleVertexIndices=e_t(o,e,r,i)}}intersectRayTriangleRange(e,r){{if(e>=r)return;const i=this.triangleVertexIndices,s=this.positionAttribute.data,n=this.positionAttribute.stride,o=this._rayOrigin,a=o[0],l=o[1],c=o[2],h=this._rayDirection,d=h[0],f=h[1],m=h[2];for(let g=e,_=3*e;g<r;++g){let v=i[_++]*n;const b=s[v++],T=s[v++],x=s[v];v=i[_++]*n;const S=s[v++],E=s[v++],A=s[v];v=i[_++]*n;const R=S-b,M=E-T,D=A-x,k=s[v++]-b,L=s[v++]-T,N=s[v]-x,q=f*N-L*m,X=m*k-N*d,G=d*L-k*f,J=R*q+M*X+D*G;if(Math.abs(J)<=Number.EPSILON)continue;const I=a-b,z=l-T,V=c-x,j=I*q+z*X+V*G;if(J>0){if(j<0||j>J)continue}else if(j>0||j<J)continue;const Y=z*D-M*V,Q=V*R-D*I,te=I*M-R*z,ge=d*Y+f*Q+m*te;if(J>0){if(ge<0||j+ge>J)continue}else if(ge>0||j+ge<J)continue;const De=(k*Y+L*Q+N*te)/J;if(De>=0){const at=this.indices[g]+this.firstTriangleIndex,we=JQ(R,M,D,k,L,N,Yyt);this._callback(De,we,at,!1)}}}lW.numFacesTested+=r-e}intersectRay(e,r){lW.numFacesTested=0;const i=Pe(e.r0[0],e.r0[1],e.r0[2]),s=Pe(e.r1[0],e.r1[1],e.r1[2]),n=s[0]-i[0],o=s[1]-i[1],a=s[2]-i[2];if(n*n+o*o+a*a<EO)return;this._rayOrigin=i;const l=this._rayDirection;l[0]=n,l[1]=o,l[2]=a;const c=this.triangleVertexIndices.length/3;this._callback=r;const h=this.bspNodeTree[0];this.intersectRayBSP(h,0,c)}intersectRayBSP(e,r,i){const s=this._rayOrigin,n=this._rayDirection;if(!Xyt(e.aabb,s,n))return;const o=e.axis,a=e.d;if(s[o]<a||n[o]<0){const l=r,c=e.midStartIndex;if(l<c){const h=e.leftNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(e.midStartIndex,e.rightStartIndex),s[o]>a||n[o]>0){const l=e.rightStartIndex,c=i;if(l<c){const h=e.rightNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}};Pee.numFacesTested=0;const Yyt=O(),FT=[1/0,1/0,1/0],UT=[-1/0,-1/0,-1/0];function Zyt(t,e,r,i,s,n){let o=r,a=i;for(;o<a;){const c=t[o];e[6*c+s+3]<=n?++o:(--a,t[o]=t[a],t[a]=c)}let l=o;for(a=i;l<a;){const c=t[a-1];e[6*c+s]>=n?--a:(t[a-1]=t[l],t[l]=c,++l)}return{next:o,mid:l}}function Jyt(t,e,r,i){if(i<=r)return zw(NaN,NaN,NaN,NaN,NaN,NaN);{const s=6*t[r];for(let n=0;n<3;++n)FT[n]=e[s+0+n],UT[n]=e[s+3+n]}for(let s=r+1;s<i;++s){const n=6*t[s];for(let o=0;o<3;++o)FT[o]=Math.min(FT[o],e[n+0+o]),UT[o]=Math.max(UT[o],e[n+3+o])}return zw(FT[0],FT[1],FT[2],UT[0],UT[1],UT[2])}function Qyt(t){const e=t[3]-t[0],r=t[4]-t[1],i=t[5]-t[2],s=e>r?e>i?0:r>i?1:2:r>i?1:i>e?2:0;return{axis:s,midValue:(t[s]+t[s+3])/2}}function Kyt(t,e,r,i,s){const n=r-e,o=new Float32Array(6*n);for(let a=0;a<n;++a){const l=3*(a+e),c=t[l]*s,h=t[l+1]*s,d=t[l+2]*s;for(let f=0;f<3;++f){const m=i[c+f],g=i[h+f],_=i[d+f];o[6*a+f]=Math.min(m,g,_),o[6*a+3+f]=Math.max(m,g,_)}}return o}function e_t(t,e,r,i){const s=i-r;let n=0;for(let a=r;a<i;++a)for(let l=0;l<3;++l)n=Math.max(e[3*a+l],n);const o=n<=GRe?new Uint16Array(3*s):new Uint32Array(3*s);for(let a=0;a<s;++a){const l=3*(t[a]+r);for(let c=0;c<3;++c){const h=e[l+c];o[3*a+c]=h}}return o}const GRe=65535;let Vs=class extends jo{constructor(){super(...arguments),this.output=F.Color,this.overlayMode=l0.Disabled,this.tileBlendInput=Zf.LayerOnly,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.invisible=!1,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.pbrMode=ut.Terrain}};u([B({count:F.COUNT})],Vs.prototype,"output",void 0),u([B({count:l0.COUNT})],Vs.prototype,"overlayMode",void 0),u([B({count:Zf.COUNT})],Vs.prototype,"tileBlendInput",void 0),u([B()],Vs.prototype,"spherical",void 0),u([B()],Vs.prototype,"doublePrecisionRequiresObfuscation",void 0),u([B()],Vs.prototype,"receiveShadows",void 0),u([B()],Vs.prototype,"hasSlicePlane",void 0),u([B()],Vs.prototype,"backfaceCullingEnabled",void 0),u([B()],Vs.prototype,"textureFadingEnabled",void 0),u([B()],Vs.prototype,"renderOccluded",void 0),u([B()],Vs.prototype,"hasScreenSpaceReflections",void 0),u([B()],Vs.prototype,"hasCloudsReflections",void 0),u([B()],Vs.prototype,"invisible",void 0),u([B()],Vs.prototype,"tileBorders",void 0),u([B()],Vs.prototype,"visualizeNormals",void 0),u([B()],Vs.prototype,"screenSizePerspective",void 0),u([B()],Vs.prototype,"receiveAmbientOcclusion",void 0),u([B({count:ut.COUNT})],Vs.prototype,"pbrMode",void 0),u([B({constValue:Ir.Compressed})],Vs.prototype,"normalType",void 0),u([B({constValue:Fs.Compressed})],Vs.prototype,"textureCoordinateType",void 0),u([B({constValue:!1})],Vs.prototype,"highStepCount",void 0),u([B({constValue:!1})],Vs.prototype,"useCustomDTRExponentForWater",void 0),u([B({constValue:!1})],Vs.prototype,"useFillLights",void 0);const wV=7,t_t=10,xV=gn();var En;(function(t){t[t.Opaque=0]="Opaque",t[t.Semitransparent=1]="Semitransparent",t[t.TransparentWithDraped=2]="TransparentWithDraped",t[t.Empty=3]="Empty"})(En||(En={}));let nc=class extends Te{get _isGlobal(){return this._stage.viewingMode===Ve.Global}constructor(e){super(e),this.type=ji.TERRAIN,this.isGround=!0,this._tileSize=256,this._techniqueConfiguration=new Vs,this._passParameters=new uRe,this._rctx=null,this._renderDataPool=new qo($0t),this._patchGroups=new Map,this._patchGroupsDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new tRe,this._highestVisibleLODTile=null,this._visible=!0,this._transparencyState=En.Opaque,this._castShadows=!0,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.needsHighlight=!1,this.renderOccludedFlags=Ni.Occlude}initialize(){const e=[pe.OPAQUE_TERRAIN,pe.TRANSPARENT_TERRAIN,pe.OCCLUDED_TERRAIN];this._stage.addRenderPlugin(e,this)}destroy(){this._stage.removeRenderPlugin(this),Igt()}get canRender(){return this._visible&&!!this._rootTiles&&!this.renderingDisabled}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setDirty()}set transparency(e){this._transparencyState!==e&&(this._techniqueConfiguration.invisible=e===En.TransparentWithDraped||e===En.Empty,this._transparencyState=e,this.setNeedsRender())}get transparency(){return this._transparencyState}get needsLinearDepth(){return this._overlayRenderer.hasWater}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return!!this._techniqueConfiguration.visualizeNormals}set visualizeNormals(e){this._techniqueConfiguration.visualizeNormals!==e&&(this._techniqueConfiguration.visualizeNormals=e,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this._setSortingDirty()}get layerUid(){return E_}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}set pbrMode(e){this._techniqueConfiguration.pbrMode!==e&&(this._techniqueConfiguration.pbrMode=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setDirty()}setNeedsHighlight(e){this.needsHighlight=e,this.setNeedsRender()}setRenderOccludedOverlay(e){this.renderOccludedFlags=e?EF:Ni.Occlude,this.setNeedsRender()}setStencilEnabledLayerExtents(e){this._stencilEnabledLayerExtents=e,this._setSortingDirty()}setTileSize(e){this._tileSize=e,this._tileRenderer!=null&&(this._tileRenderer.tileSize=e),this.setDirty()}_prepareTileForLoading(e){e.renderData||(e.renderData=this._renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometryState(e),this.updateTileTexture(e,wt.TEXTURE_FADING)}updateTileTexture(e,r){this._tileRenderer!=null&&(this._tileRenderer.updateTileTexture(e,r===wt.TEXTURE_FADING?cn.FADING:cn.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(r))}updateTileGeometryState(e){for(const i of e.layerInfo[tr.ELEVATION])i.pendingUpdates&=~wt.GEOMETRY;e.resetPendingUpdate(wt.GEOMETRY);const r=e.renderData.updateGeometryState();return r&&this.setDirty(),r}updateGeometryIfNeeded(e){e.isLoaded&&e.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(e){const r=e.renderData;r&&(r.releaseGeometry(),this._renderDataPool.release(r),r.clear(),e.renderData=null,e.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(e){const r=t_t-wV,i=Math.max(0,Math.floor((e.level-r)/wV)*wV);if(this._isGlobal&&i===0)return sl;for(;e.parent&&e.level>i;)e=e.parent;return e.centerAtSeaLevel}setVisibility(e){this._visible=e,this.setDirty()}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.setNeedsRender())}setDirty(e=_s.UPDATE){this._patchGroupsDirty=!0,this._context.requestRender(e)}_setSortingDirty(e=_s.UPDATE){this._patchSortingDirty=!0,this._context.requestRender(e)}setNeedsRender(e=_s.UPDATE){this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this._rctx=e.renderContext.rctx,this._techniqueRepository=e.techniqueRepository,this._tileRenderer=new Hyt(this._rctx,this._tileSize,this._techniqueRepository),this.updateTileBackground(),this._emptyTex=kxe(this._rctx)}uninitializeRenderContext(){this._emptyTex=je(this._emptyTex),this._tileRenderer=je(this._tileRenderer)}intersect(e,r,i,s){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&this.transparency!==En.Opaque)return;const n=r_t,o=i_t;fe(n,s,i),ne(o,1/n[0],1/n[1],1/n[2]);const a=e.results.min,l=e.results.max,c=e.results.ground,h=e.options.store===So.MIN,d=!!e.results.ground.target,f=hJe(e.verticalOffset),m=e.tolerance;let g,_=h&&a.dist!=null?a.dist:1/0;const v=T=>{const x=T.renderData;if(!x?.vao)return;const S=x.geometry;c8(xV,S.boundingBox);const E=x.localOrigin;f!=null&&(f.localOrigin=E,f.applyToAabb(xV));const A=xV;if(kT[0]=i[0]-E[0],kT[1]=i[1]-E[1],kT[2]=i[2]-E[2],!KQ(A,kT,o,m,_))return;const R=(G,J,I)=>{G.set(this.type,T,J,I,pn),_=h&&a.dist!=null?a.dist:1/0},M=(G,J)=>{if(J!=null&&G>=0&&(e.options.backfacesTerrain||ye(J,n)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||r==null||r(i,s,G))){if((c.dist==null||G<c.dist)&&R(c,G,J),e.options.isFiltered)return;e.options.store===So.ALL&&(g==null?(g=EQ(e.ray),R(g,G,J),e.results.all.push(g)):G<g.dist&&R(g,G,J)),(a.dist==null||G<a.dist)&&R(a,G,J),e.options.store!==So.MIN&&(l.dist==null||G>l.dist)&&R(l,G,J)}},D=s_t;fe(D,s,E);const k=S.indices,L=S.vertexAttributes,N=L.getField(C.POSITION,mn),q=new We(N.typedBuffer,3,!1,L.stride/4),X=S.indexCount/3;if(!f&&X>BRe){const G=T.renderData;G.intersectionData==null&&(G.intersectionData=new Pee(k,0,X,q)),G.intersectionData.intersectRay({r0:kT,r1:D},M)}else zP(kT,D,0,X,k,q,null,f,M)},b=this._rootTiles;b!=null&&(()=>{const T=this._tileIterator;T.reset(b);const x=e.options.invisibleTerrain;for(let S=T.next();S;S=T.next())!(S.visible||x&&S.intersectsClippingArea)||f==null&&!S.intersectsRay(i,n,m,_)||d&&this._useStencilForTile(S)?T.skipSubtree():v(S)})()}processScaleRangeQueries(e,r){if(!r.done)for(this._updatePatchGroups();e.updating&&!r.done;){e.prepare();for(const i of this._patchGroups.values())for(const s of i)s.renderData?.textureReference!=null&&e.queriesForTile(s);e.process(),r.madeProgress()}}prepareTechnique(e){if(e.bindParameters.slot===pe.OCCLUDED_TERRAIN){if(!(e.renderOccludedMask&EF))return null}else{const r=this.transparency===En.Opaque?pe.OPAQUE_TERRAIN:pe.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==r)return null}switch(e.output){case F.Color:return this.transparency===En.Empty?null:(this._techniqueConfiguration.hasScreenSpaceReflections=e.bindParameters.ssr.enabled,this._techniqueConfiguration.hasCloudsReflections=e.bindParameters.cloudsFade.data!=null,this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssaoHelper.active,this._techniqueConfiguration.overlayMode=this._overlayRenderer.isEmpty?l0.Disabled:this._overlayRenderer.hasWater?l0.EnabledWithWater:l0.Enabled,this._updateTechnique(F.Color,e.bindParameters.slot===pe.OCCLUDED_TERRAIN));case F.Shadow:case F.ShadowExcludeHighlight:return this._castShadows&&e.bindParameters.lighting.globalFactor===1?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(F.Shadow,!1)):null;case F.Depth:return this.transparency===En.Empty?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(F.Depth,!1));case F.Normal:return this.transparency===En.Empty?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(F.Normal,!1));case F.ObjectAndLayerIdColor:return this.transparency===En.Empty?null:this._updateTechnique(F.ObjectAndLayerIdColor,!1);case F.Highlight:return this.transparency!==En.Empty&&this.needsHighlight?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(F.Highlight,!1)):null}return null}render(e,r){const i=e.bindParameters.lighting.globalFactor===1;switch(this._updatePatchGroups(),r.useStencil=!1,e.output){case F.Color:{const s=e.bindParameters.slot===pe.OCCLUDED_TERRAIN?Ya.Occluded:Ya.ColorAndWater;this.transparency===En.Opaque?this._renderMaterialPass(e,r,s):e.offscreenRenderingHelper.renderToTargets(()=>this._renderMaterialPass(e,r,s),e.offscreenRenderingHelper.tmpColor,e.offscreenRenderingHelper.mainDepth,[0,0,0,0]);break}case F.Depth:case F.Normal:this._renderAuxiliaryPass(e,r,Ya.ColorAndWater);break;case F.Highlight:this.needsHighlight&&this._renderAuxiliaryPass(e,r,Ya.Highlight);break;case F.Shadow:case F.ShadowExcludeHighlight:this._castShadows&&i&&this._renderAuxiliaryPass(e,r,Ya.None);break;case F.ObjectAndLayerIdColor:this._renderAuxiliaryPass(e,r,Ya.ObjectAndLayerIdColor)}}_renderMaterialPass(e,r,i){const{rctx:s}=e;this._passParameters.overlaySource=i,s.bindTechnique(r,this._passParameters,e.bindParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this._renderPatchGroups(e,r,i)}_renderAuxiliaryPass(e,r,i){const s=e.rctx;this._passParameters.overlaySource=i,s.bindTechnique(r,this._passParameters,e.bindParameters),this._renderPatchGroupsAuxiliary(e,r,i)}updateTileBackground(e=null){if(this._tileRenderer==null)return;const r=this._tileRenderer;let i=null;if(e!=null){const s=ke.toUnitRGBA(e);i=Pe(s[0]||0,s[1]||0,s[2]||0)}r.setBackground(i),this._allTiles.forAll(s=>r.updateTileTexture(s,cn.FADING)),this._techniqueConfiguration.tileBlendInput=r.backgroundIsGrid?Zf.GridComposite:r.backgroundColor!=null?Zf.ColorComposite:Zf.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchGroupsDirty&&(this._highestVisibleLODTile=null,this._rebuildPatchGroups(),this._patchGroupsDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==tC.NONE){const e=Array.from(this._patchGroups.values()),r=this._stencilEnabledLayerExtents;for(const i of e)rRe(this.renderOrder,i,r);e.sort((i,s)=>iRe(i[0],s[0],this.renderOrder)),this._patchGroups=new Map(e.map(i=>[i[0].renderData.localOrigin,i])),this._patchSortingDirty=!1}}_rebuildPatchGroups(){const e=this._rootTiles;if(e!=null){e[0]?.surface.checkAllTilesWaterproofness(),this._patchGroups.clear();for(const r of e)this._rebuildPatchGroupsForRootTile(r)}}_rebuildPatchGroupsForRootTile(e){const r=this._tileIterator;for(r.resetOne(e);!r.done;){const i=r.next(),s=i.renderData;if(!s){this._numTilesCulled++;continue}if(!i.visible){this._numTilesCulled++,r.skipSubtree();continue}const n=s.localOrigin;let o=this._patchGroups.get(n);o||(o=new Array,this._patchGroups.set(n,o)),o.push(i),(!this._highestVisibleLODTile||i.elevationLevel>this._highestVisibleLODTile.elevationLevel)&&(this._highestVisibleLODTile=i),r.skipSubtree()}}_useStencilForTile(e){for(const r of this._stencilEnabledLayerExtents)if(e.intersectsExtent(r))return!0;return!1}_renderPatchGroupsAuxiliary(e,r,i){const s=this._stencilEnabledLayerExtents.length>0;this._patchGroups.forEach(n=>{const o=n[0].renderData.localOrigin;r.program.bindDraw(new Aq(o),e.bindParameters,this._passParameters);for(let a=0;a<n.length;a++)this._renderPatch(e,r,n[a],At.TRIANGLES,s,i)}),e.rctx.bindVAO(null)}_renderPatchGroups(e,r,i){const s=e.bindParameters.camera,n=r.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const d=_Se(this._stage.viewingMode,this._ellipsoidRadius),f=this.pointsOfInterest.centerOnSurfaceFrequent.distance;d.update({distance:f,fovY:s.fovY})}const o=this._stencilEnabledLayerExtents.length>0,a=i===Ya.Occluded;a&&(n.bindTexture("tex",this._emptyTex),n.setUniform3fv("textureOpacities",sl),n.setUniform4fv("texOffsetAndScale",rm));const l=this._tileRenderer!=null&&this._tileRenderer.backgroundColor!=null?this._tileRenderer.backgroundColor:sl;this._techniqueConfiguration.tileBlendInput===Zf.ColorComposite&&n.setUniform3fv("backgroundColor",l);const c=this.wireframe?At.LINES:At.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&n.bindTexture("texNext",this._emptyTex);const h=this._patchGroups;for(const d of h.values()){const f=d[0].renderData.localOrigin;r.program.bindDraw(new Aq(f),e.bindParameters,this._passParameters),this._numOriginsRendered++;for(const m of d){const g=m.renderData,_=g.textureReference;if(_!=null){if(!a){n.setUniform4fv("texOffsetAndScale",_.offsetAndScale),n.bindTexture("tex",_.texture.texture);const v=g.textureFadeFactor,b=v<1?g.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&b!=null&&v<1?(n.setUniform1f("fadeFactor",v),n.setUniform4fv("nextTexOffsetAndScale",b.offsetAndScale),n.setUniform3fv("nextTexOpacities",b.opacities),n.bindTexture("texNext",b.texture.texture)):n.setUniform1f("fadeFactor",1),g.textureIsFading&&this.setNeedsRender(),n.setUniform3fv("textureOpacities",_.opacities)}this._renderPatch(e,r,m,c,o,i),m.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}e.rctx.bindVAO(null)}_renderPatch(e,r,i,s,n,o){const a=i.renderData,l=a.vao,c=l.indexBuffer;if(c==null)return void(dn&&console.error("Rendered tile with no indices: ",i.lij," : ",a));const h=r.program;o===Ya.None||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(h,a.overlay),n&&(r.useStencil=this._useStencilForTile(i),r.bindPipelineState(e.rctx,e.bindParameters.slot));const d=a.geometry.indexCount;e.rctx.bindVAO(l),h.assertCompatibleVertexAttributeLocations(l),e.rctx.drawElements(s,d,c.indexType,0)}_bindOverlayPatchData(e,r){e.setUniform4fv("overlayTexOffset",r.offsets),e.setUniform4fv("overlayTexScale",r.scales)}_updateTechnique(e,r){return this._techniqueConfiguration.output=e,this._techniqueConfiguration.renderOccluded=r,this._shaderTechnique=this._techniqueRepository.releaseAndAcquire(hRe,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){return{tileRenderer:this._tileRenderer}}};u([p({constructOnly:!0})],nc.prototype,"_overlayRenderer",void 0),u([p({constructOnly:!0})],nc.prototype,"_stage",void 0),u([p({readOnly:!0})],nc.prototype,"_isGlobal",null),u([p({constructOnly:!0})],nc.prototype,"_allTiles",void 0),u([p({constructOnly:!0})],nc.prototype,"_ellipsoidRadius",void 0),u([p({value:!1})],nc.prototype,"renderingDisabled",null),u([p()],nc.prototype,"renderPatchBorders",null),u([p()],nc.prototype,"visualizeNormals",null),u([p()],nc.prototype,"cullBackFaces",null),u([p({value:tC.FRONT_TO_BACK})],nc.prototype,"renderOrder",null),u([p()],nc.prototype,"wireframe",null),nc=u([P("esri.views.3d.terrain.TerrainRenderer")],nc);const r_t=O(),i_t=O(),kT=O(),s_t=O();let n_t=class{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}},Cf=class extends Te{constructor(e){super(e),this._handles=new $i}initialize(){this._handles.add(this.layers.on("change",()=>this._update())),this._handles.add(le(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._handles=Ne(this._handles),this._waitTask=null,this.layers.destroy()}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(r=>!(!aR(r)||r.isRejected())&&!(r.isFulfilled()&&!o_t(r,this.viewSpatialReference,this.viewingMode))&&(e=r,!(r?.type==="vector-tile"||NF(r)))),e)if(e.isResolved()){const r=G9(e,this.viewSpatialReference,this.viewingMode);if(r!=null){const i=new Tc(r.tileInfo);this._lockTilingScheme(i)}}else this._updateWhen(e)}_updateWhen(e){const r=e.when().catch(()=>{}).then(()=>{r!==this._waitTask||this.destroyed||this._update()});this._waitTask=r}_lockTilingScheme(e){if(this.viewingMode===Ve.Global){const r=e.levels.length-1;e.spatialReference.isWebMercator?e=Tc.makeWebMercatorAuxiliarySphere(r):pv(e.spatialReference)&&(e=Tc.makeGCSWithTileSize(e.spatialReference,e.pixelSize,r))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this._handles.removeAll(),this._handles.add(le(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===Ve.Global){const e=this.extentHelper.viewSpatialReference,r=pv(e)||Om(e)||Rm(e);e.isWebMercator?this.tilingScheme=Tc.WebMercatorAuxiliarySphere:r&&(this.tilingScheme=Tc.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;e==null||dw(e,this.extent)||(this.tilingScheme=Tc.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function o_t(t,e,r){return G9(t,e,r)!=null}u([p()],Cf.prototype,"tilingScheme",void 0),u([p({readOnly:!0})],Cf.prototype,"extent",void 0),u([p({value:!1})],Cf.prototype,"tilingSchemeLocked",void 0),u([p({constructOnly:!0})],Cf.prototype,"viewSpatialReference",void 0),u([p({constructOnly:!0})],Cf.prototype,"layers",void 0),u([p({constructOnly:!0})],Cf.prototype,"extentHelper",void 0),u([p({constructOnly:!0})],Cf.prototype,"viewingMode",void 0),Cf=u([P("esri.views.3d.terrain.TilingSchemeLogic")],Cf);let a_t=class{constructor(){this.offset=He(),this.scale=0,this.tile=null}init(e,r,i,s){this.tile=e,this.offset[0]=r,this.offset[1]=i,this.scale=s}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}},Ht=class extends Ts.EventedMixin(Te){constructor(e){super(e),this._scaleRangeQueries=new ZN,this._iteratorPool=new qo(tRe,r=>r.remove=()=>this._iteratorPool.release(r)),this._postorderIterator=new Fgt,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._visibleCached=!1,this._usedMemory=null,this._performanceInfo=new n_t,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=O(),this._eyePosSurfaceSR=O(),this._splitLimits=new Nd,this._frustum=EM(),this._viewProjectionMatrix=xe(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._handles=new $i,this._watchUpdatingTracking=new tm,this._frameTask=LE,this._allTiles=new Vt,this._upsampleInfoPool=new qo(a_t),this._rootTilesExtent=zt(),this.updatingProgress=.5,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=qe.WebMercator,this.visibleElevationBounds=new wS(1/0,-1/0),this.rootTileElevationBounds=new wS(1/0,-1/0),this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this.oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._isWebMercator=!1,this._isWebMercatorOnPlateeCarree=!1,this.overlayManager=new Ba({...e,surface:this}),this._isGlobal=!e.view?.state?.isLocal}initialize(){this._lercDecoder=lgt(this.view.resourceController),this._tilePool=this.view.state.isLocal?new qo(Y0t):new qo(J0t);const e=this.view.resourceController.memoryController;this._upsampleMapCache=e.newCache("terrain-upsample",o=>o.unloadMapData()),this._elevationQueryCache=new ogt(e.newCache("elevation-query")),this._handles.add([le(()=>this.overlayManager.hasHighlights,o=>this._renderer.setNeedsHighlight(o)),le(()=>this.overlayManager.rendersOccluded,o=>this._renderer.setRenderOccludedOverlay(o)),le(()=>this.overlayManager.renderer.isEmpty,()=>this._evaluateTransparency())],"overlayManager"),this._renderer=new nc({_overlayRenderer:this.overlayManager.renderer,_ellipsoidRadius:Vr(this.view.spatialReference).radius,_stage:this.view._stage,_allTiles:this._allTiles}),this._handles.add([le(()=>this.baseOpacity,()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?cn.UNFADED:cn.IMMEDIATE)},Ls),le(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?cn.UNFADED:cn.IMMEDIATE),Ls),le(()=>this.renderingDisabled,()=>this.view?._stage?.renderer.setParameters({terrainRenderingEnabled:!this.renderingDisabled}),Wr),le(()=>this.backgroundColor,o=>{this._handleLayerViewChanges(),this._renderer.updateTileBackground(o)},Ls),le(()=>this.snapLevel,()=>this._viewChanged=!0,Wr),le(()=>this.view.pointsOfInterest,o=>{this._renderer.pointsOfInterest=o,this._watchUpdatingTracking.removeAll(),o&&this._watchUpdatingTracking.add(()=>o.focus.renderLocation,()=>this._allTilesSorted=!1)}),le(()=>li.TERRAIN_TILE_TREE_SHOW_TILES,o=>{o&&!this._treeDebugger?he(()=>import("./TerrainTileTree3DDebugger-b516a82b.js"),["./TerrainTileTree3DDebugger-b516a82b.js","./TileTreeDebugger-55130260.js"],import.meta.url).then(({TerrainTileTree3DDebugger:a})=>{!this._treeDebugger&&li.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new a({view:this.view}))}):o||(this._treeDebugger=Ne(this._treeDebugger))},Pr)]);const{spatialReference:r}=this.view;this._extentHelper=Sgt(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:r});const i=new lM({getCollections:()=>this.view?.defaultsFromMap?.mapCollections?.map(({layers:o})=>o),getChildrenFunction:o=>o&&"layers"in o?o.layers:null}),s=new Cf({layers:i,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:r});this._set("tilingSchemeLogic",s),this._updateTilingScheme(),this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(Gf.ELEVATION),this._mapDataRequester=this.view.resourceController.createStreamDataRequester(Gf.BASEMAP);const n=this.view.resourceController.scheduler;this._frameTask=n.registerTask(vt.TERRAIN_SURFACE,this),this._handles.add([le(()=>this._extentHelper.stencilEnabledExtents,o=>this._renderer.setStencilEnabledLayerExtents(o),Pr),le(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),Wr),le(()=>this.extent,()=>this._updateRootTiles(),Pr),this.view.on("resize",()=>this._viewChangeUpdate()),le(()=>{const o=this.view,a=o.state;return[this._lodBias,this.lodSnapping,o.resourceController?.memoryController?.memoryFactor,a.camera,a.contentCamera,a.fixedContentCamera]},()=>this._viewChangeUpdate(),Ls),le(()=>this.view.qualitySettings?.tiledSurface?.textureFadeDuration,o=>this._renderer.textureFadingEnabled=o>0,Pr),le(()=>this.view.qualitySettings?.physicallyBasedRenderingEnabled,o=>this._renderer.pbrMode=o?ut.Terrain:ut.Disabled,Pr),le(()=>this._userClippingExtent,()=>this._updateClippingExtent(),Wr)]),this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges()}destroy(){this._frameTask.remove(),this._handles.destroy(),this._watchUpdatingTracking.destroy(),this._lercDecoder=Gi(this._lercDecoder),this._removeAllTiles(),this._upsampleMapCache=Ne(this._upsampleMapCache),this._elevationQueryCache=Ne(this._elevationQueryCache),this._set("tilingSchemeLogic",Ne(this.tilingSchemeLogic)),this._basemapLayerViewHandles.forEach((e,r)=>this._unregisterTiledLayerView(r)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",Ne(this.overlayManager)),this._tilePool=Ne(this._tilePool),bee.prune(),this._treeDebugger=Ne(this._treeDebugger),this._renderer=Ne(this._renderer),this._iteratorPool=Ne(this._iteratorPool),this._set("view",null),this._extentHelper=Ne(this._extentHelper),this._upsampleInfoPool=Ne(this._upsampleInfoPool),vgt(),d0t()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){if(this.lodSnapping===AR.ON){const e=this.view,r=this.tilingScheme,i=e.pointsOfInterest?.cameraOnSurface?.scale;if(r&&i){const s=e.state.contentCamera;let n=o9(e,s.eye,s.viewForward,s.up).tilt;n>90&&(n=180-n);const o=2*(n/90)**2,a=r.levelAtScale(i)-o,l=Math.min(a,this._splitLimits.maxLod||1/0);return l<=0?null:l}}return null}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?AR.ON:AR.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:e}=this,{clippingArea:r}=this.view;if(r==null||e==null)return null;const i=zt(),s=$Oe(r,i,e)?i:null,n=this._get("extent");return dw(s,n)?n:s}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const e=OB(this.groundExtent,this._userClippingExtent,zt()),r=this._get("extent");return dw(e,r)?r:e}get groundExtent(){return this._tilingSchemeExtent!=null?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){return this.tilingSchemeLogic?.extent}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||this._watchUpdatingTracking?.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||this.overlayManager?.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){return this.view?.map?.ground?.opacity??1}set baseOpacity(e){this.view.map.ground.opacity=e}get viewingMode(){return this.view.state.viewingMode}get ready(){return this._rootTiles!=null}set renderOrder(e){this._renderer.renderOrder=e,this._set("renderOrder",e)}get rootTiles(){return this._rootTiles}get spatialReference(){return this.tilingScheme?.spatialReference??null}get backgroundColor(){return this.view.map.ground.surfaceColor}set backgroundColor(e){this.view.map.ground.surfaceColor=e}set slicePlaneEnabled(e){this._renderer.slicePlaneEnabled=e,this._set("slicePlaneEnabled",e),this._evaluateTransparency()}get tilingSchemeLocked(){return this.tilingSchemeLogic?.tilingSchemeLocked??!1}get wireframe(){return this._renderer?.wireframe}set wireframe(e){e!==this._renderer.wireframe&&(this._renderer.wireframe=e,this._updateAllTileGeometries())}set _visible(e){e!==this._visibleCached&&(this._visibleCached=e,this._renderer.setVisibility(e),this.suspended=!e)}get opaque(){return this._renderer.transparency===En.Opaque}set suspended(e){this._set("suspended",e),this._viewChangeUpdate()}get textureFadeDuration(){return this.view.qualitySettings.tiledSurface.textureFadeDuration??0}intersect(e,r,i,s){this._renderer.intersect(e,r,i,s)}getElevation(e,r,i,s){const n=this._rootTiles;if(n==null||!n.length||n[0].layerInfo[tr.ELEVATION].length===0)return null;const o=_l;return o[0]=e,o[1]=r,o[2]=i,Qs(o,s,o,this._spatialReference)?ede(n,o[0],o[1]):(K.getLogger(this).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null)}getElevations(e,r,i){const s=this._rootTiles,n=s?s[0].layerInfo[tr.ELEVATION].length:0;if(s!=null&&s.length&&n!==0)for(let o=0;o<r;++o){const a=3*o;i(o,ede(s,e[a],e[a+1]))}else for(let o=0;o<r;++o)i(o,null)}getScale(e){if(!this.tilingScheme)return null;if(!Ao(e,_l,this.spatialReference))return K.getLogger(this).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const r=this._rootTiles;if(r!=null){for(const i of r)if(i?.containsPoint(_l)){let s=i;for(;s.children[0]&&!s.rendered;){const n=s.children[0].extent;let o=0;_l[0]>n[2]&&(o+=1),_l[1]<n[1]&&(o+=2),s=s.children[o]}return this._getLodBiasCorrectedScale(s.level)}}return 1/0}getSphereElevationBounds(e,r){if(_l[0]=e[0],_l[1]=e[1],_l[2]=e[2],_l[3]=e[3],!Qs(_l,r,_l,this.tilingScheme?.spatialReference))return K.getLogger(this).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let i=1/0,s=-1/0;const n=a=>{if(a&&Yre(a.extent,_l))if(a.isLeaf||a.rendered)i=Math.min(i,a.elevationBounds[0]),s=Math.max(s,a.elevationBounds[1]);else for(const l of a.children)n(l)},o=this._rootTiles;if(o!=null)for(const a of o)n(a);return{min:i,max:s}}getSphereScale(e,r){if(!this.tilingScheme)return null;if(!Ao(e,_l,this.spatialReference))return K.getLogger(this).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;_l[3]=r;let i=null;const s=o=>{if(o&&Yre(o.extent,_l)){const a=o.children;if(a[0]&&!o.rendered)for(const l of a)s(l);else{const l=this._getLodBiasCorrectedScale(o.level);i=i==null?l:Math.min(i,l)}}},n=this._rootTiles;if(n!=null)for(const o of n)s(o);return i}queryVisibleScaleRange(e,r,i,s){const n=r?this.tilingScheme.levelAtScale(r):0,o=i?this.tilingScheme.levelAtScale(i):1/0,a=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(e,n+a,o+a,s)}_evaluateTransparency(){const e=this.baseOpacity,r=this.overlayManager.renderer.isEmpty,i=this._renderer.transparency,s=this._allSurfaceLayersTransparent()?r?En.Empty:En.TransparentWithDraped:e>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?En.Opaque:En.Semitransparent,n=i!==s;return n&&(this._renderer.transparency=s,this.view?._stage?.renderer.setParameters({terrainTransparency:this._renderer.transparency})),n}_updateTilingScheme(){const e=this.tilingSchemeLogic.tilingScheme;if(e===this.tilingScheme)return;Nf(!!e,"tiling scheme cannot be reset to undefined"),this._isGlobal=!this.view?.state?.isLocal,this.tilingScheme&&this._removeAllTiles();const r=e?.spatialReference??qe.WebMercator;this._spatialReference=r,this._isWebMercator=!!r?.isWebMercator,this._isWebMercatorOnPlateeCarree=this._isWebMercator&&sM(this.view?.renderSpatialReference),this._set("tilingScheme",e),this._updateClippingExtent(),e&&(this._updateTiledLayers(),this._renderer.setTileSize(e.pixelSize),this.overlayManager.setSpatialReference(e.spatialReference),this._updateRootTiles())}_acquireTile(e,r,i,s){const n=this._tilePool.acquire();return DL[0]=e,DL[1]=r,DL[2]=i,n.init(DL,s,this),n}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:e,tilingScheme:r}=this;if(!r)return;const i=u_t;let s=r.rootTilesInExtent(e,i,5*cS);if(this._rootTiles!=null){if(s.length>cS)return void K.getLogger(this).warn(xje);const n=this._rootTiles.map(a=>a.lij),o=CDe(n,s,Khe);if(this._updatingRootTiles=!0,o.removed.length>0||o.added.length>0){const a=this._rootTiles.filter(l=>!(o.removed.findIndex(c=>Khe(c,l.lij))>-1)||(this._purgeTile(l),!1));o.added.forEach(l=>a.push(this._newRootTile(l))),this._setRootTiles(a)}}else this._updatingRootTiles=!0,s.length>cS&&(K.getLogger(this).warn(Tje),s=r.rootTilesInExtent(e,i,cS)),this._setRootTiles(s.map(n=>this._newRootTile(n)));dw(i,this._rootTilesExtent)||(this._rootTilesExtent=zt(i)),this._visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const e=this._allTiles.filter(r=>r.isLoaded&&r.intersectsClippingArea);e.forEach(r=>this._renderer.updateTileGeometryState(r)),e.forEach(r=>r.renderData.updateNeighborData()),this._updateTilesGeometries(e),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(e){if(e.length===0)return;e.sort(a0);const r=this.renderer;e.forEach(i=>r.updateGeometryIfNeeded(i)),e.forEach(i=>this._pendingTilesForElevationUpdateEvent.add(i))}_shouldSplit(e){return e.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===wt.SPLIT}_newRootTile(e){const r=this._acquireTile(0,e[1],e[2],null);return this._shouldSplit(r)&&r.setPendingUpdate(wt.SPLIT),this._loadTile(r),this._markTileToUpdate(r),this._updateRootTileElevationBounds(),r}_setRootTiles(e){if(this._rootTiles=e,this._allTiles.clear(),e!=null){const r=this._iteratorPool.acquire();for(r.reset(e);!r.done;)this._allTiles.push(r.next());r.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(e)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this._visibleCached&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(e){e.updateClippingStatus(this.extent)&&e.resetPendingUpdate(wt.GEOMETRY)&&this._updateTileGeometryState(e)}_updateTilesVisibility(e){if(e==null)return;const r=jgt(e),i=this.visibleElevationBounds;let s=r?i.min:1/0,n=r?i.max:-1/0;const o=this.extent,a=this._viewProjectionMatrix;this.setTileTreeDirty();const l=this._iteratorPool.acquire();for(l.reset(e);!l.done;){const c=l.next();c.updateClippingStatus(o)&&c.resetPendingUpdate(wt.GEOMETRY)&&this._updateTileGeometryState(c),c.setPendingUpdate(wt.RENDERDATA),c.computeVisibility(),c.updateScreenDepth(a),c.renderData&&(s=Math.min(c.elevationBounds[0],s),n=Math.max(c.elevationBounds[1],n))}l.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._batchUpdatePendingTileGeometries(),isFinite(s)&&isFinite(n)&&(i.min!==s||i.max!==n)&&(this.visibleElevationBounds=new wS(s,n))}_updateRootTileElevationBounds(){let e=1/0,r=-1/0;const i=this._rootTiles;i?.forEach(({elevationBounds:n})=>{e=Math.min(e,n[0]),r=Math.max(r,n[1])});const s=this.rootTileElevationBounds;s.min===e&&s.max===r||(this.rootTileElevationBounds=new wS(e,r))}_updateViewDependentParameters(){const{camera:e,contentCamera:r}=this.view.state,i=Math.tan(.5*r.fovX),s=Math.tan(.5*r.fovY),n=this.tilingScheme.pixelSize,o=2**-this._lodBias*e.pixelRatio;this._splitLimits.aboveGround=e.aboveGround,this._splitLimits.fovX=i,this._splitLimits.fovY=s,this._splitLimits.relativeWidthLimit=n/e.width*this.maxTextureScale*o,this._splitLimits.relativeHeightLimit=n/e.height*this.maxTextureScale*o,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?(this._splitLimits.frustum==null&&(this._splitLimits.frustum=EM()),G5(this._splitLimits.frustum,r.frustum)):this._splitLimits.frustum=null,G5(this._frustum,e.frustum),ai(this._viewProjectionMatrix,r.projectionMatrix,r.viewMatrix),ie(this._eyePosRenderSR,r.eye),Qs(e.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateRenderData(e){e.rendered&&!e.shouldLoad&&(jRe(e)?this._loadChildren(e):c_t(e)&&this._loadParent(e))}_updateTileGeometryState(e){e.updateVisibility(),this._renderer.updateTileGeometryState(e)&&this._markTileToUpdate(e),this._usedMemory=null}_markAllTileNeighborsForGeometryUpdate(e){const r=this._pendingTilesToUpdate;e.forEachLoadedNeighbor(i=>{r.add(i)})}_updateTileTexture(e,r){const i=e.resetPendingUpdate(wt.TEXTURE_FADING)?wt.TEXTURE_FADING:!!e.resetPendingUpdate(wt.TEXTURE_NOFADING)&&wt.TEXTURE_NOFADING;i&&(this._renderer.updateTileTexture(e,i),this._usedMemory=null,r.madeProgress())}_emitElevationUpdateEventForTiles(){const e=SV.extent;Uc(e),this._pendingTilesForElevationUpdateEvent.forEach(r=>J_(e,r.extent,e)),this._pendingTilesForElevationUpdateEvent.clear(),SV.spatialReference=this.spatialReference,this.emit("elevation-change",SV)}runTask(e){this._handleLayerViewChanges(e),this._frameTask.processQueue(e),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,e),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(e),this._sortTiles(e);const r=!this.view.state.fixedContentCamera;this._mergeAndSplit(e,r),this._updateElevation(e),this._updateTextures(e),r||this._mergeAndSplit(e,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._batchUpdatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),e.done&&e.hasProgressed&&this.requestUpdate(),this.notifyChange("updatingProgressValue")}_updateAllTilesStatus(e){if(!this._viewChanged||!this._rootTiles||e.done)return;this._viewChanged=!1;const r=this._iteratorPool.acquire();r.reset(this._rootTiles);const i=this.snapLevel,s=this._splitLimits,n=this._eyePosRenderSR;for(;!r.done;){const o=r.next(),a=o.shouldSplit(s,n,i);if(a!==wt.SPLIT){if(o.resetPendingUpdate(wt.SPLIT)&&o.updateAgentSuspension(),a===wt.ELEVATION&&o.updateAgents(tr.ELEVATION),r.skipSubtree(),!o.isLeaf){o.setPendingUpdate(wt.MERGE),o.resetPendingUpdate(wt.SPLIT);const l=this._iteratorPool.acquire();l.resetOne(o);const c=this._viewProjectionMatrix;for(let h=l.next();!l.done;h=l.next())this._updateClippingStatus(h),h.updateVisibility(),h.updateScreenDepth(c);l.remove()}}else o.resetPendingUpdate(wt.MERGE),o.isLeaf&&(o.setPendingUpdate(wt.SPLIT),r.skipSubtree()),o.rendered&&o.setPendingUpdate(wt.RENDERDATA)}r.remove(),this.requestUpdate(),(this.shortBatches||!this.oneBatchPerFrameTask)&&this._batchUpdatePendingTileGeometries(),e.madeProgress()}_sortTiles(e){e.done||this._allTilesSorted||(Bgt(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),e.madeProgress())}_markTileToUpdate(e){Ee(e.isLoaded),e.intersectsClippingArea&&(this._pendingTilesToUpdate.add(e),this._markAllTileNeighborsForGeometryUpdate(e))}_batchUpdatePendingTileGeometries(){const e=this._pendingTilesToUpdate;if(e.size===0)return;const r=Array.from(this._pendingTilesToUpdate.keys()).filter(n=>n.isLoaded&&n.intersectsClippingArea),i=(n,o)=>{!o?.isLoaded||!o.intersectsClippingArea||o.level<n.level||e.has(o)||(e.add(o),r.push(o),o.renderData.updateNeighborData())};r.sort(a0);const s=r.length;for(let n=0;n<s;++n){const o=r[n];Ee(o.isLoaded),Ee(o.intersectsClippingArea);const a=o.renderData;a.updateNeighborData();const l=a._dirtyEdgeResolutions,c=a.geometryState.neighborData.cornerPeerNeighbors,h=d=>{const f=HM[d];i(o,c[d]?.findCorner(UF(f),m=>m.isLoaded))};for(let d=0;d<4;++d)if(l&1<<d){const f=a.geometryState.neighborData.edgePeerNeighbors[d];f&&f?.level>=o.level&&f.forAllSubtreeOnSide(kF(Yf[d]),m=>!(!m.isLoaded||!m.intersectsClippingArea)&&(Ee(e.has(m)||a0(o,m)<0),i(o,m),!0)),h((d+1)%4),h(d)}}e.clear(),this._updateTilesGeometries(r),dn&&DF&&this.checkAllTilesWaterproofness()}_mergeAndSplit(e,r){if(this.suspended||e.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let i=!1;const s=this.view.state.fixedContentCamera;let n=!1;for(;!e.done;){n=!0;let o=!1;const a=!this._allTiles.some(l=>{if(!i&&!s&&!l.visible)return e.done;let c=l;if(l.resetPendingUpdate(wt.MERGE)){if(!r)return l.setPendingUpdate(wt.MERGE),e.done;for(;c.parent?.resetPendingUpdate(wt.MERGE);)c=c.parent;this._mergeTile(c),o=!0,e.madeProgress()}else l.resetPendingUpdate(wt.SPLIT)&&(this._splitTile(l),o=!0,e.madeProgress());return!e.done&&c===l&&l.resetPendingUpdate(wt.RENDERDATA)&&(this._updateRenderData(l),e.madeProgress()),e.done});if(o&&(this._allTilesSorted=!1,this._allTilesDirty=!0),a){if(!i){i=!0;continue}if(!o)break}else this._allTilesDirty=!0}n?e.madeProgress():this._allTilesDirty=!0,!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries(),this._sortTiles(e)}_updateElevation(e){e.done||(this._allTiles.some(r=>(r.resetPendingUpdate(wt.GEOMETRY)&&(this._updateTileGeometryState(r),this._updateTileTexture(r,e),this.shortBatches&&this._batchUpdatePendingTileGeometries(),e.madeProgress()),e.done)),!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries())}_updateTextures(e){e.done||this._allTiles.some(r=>(this._updateTileTexture(r,e),e.done))}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(_s.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){const e=this.view.resourceController.memoryController.memoryFactor;return this.view.qualitySettings.tiledSurface.lodBias-(1-e)*bje}_getLodBiasCorrectedScale(e){const r=this.tilingScheme.levels,i=ve(e-this._lodBias,0,r.length-1),s=i-Math.floor(i);return r[Math.floor(i)].scale*(1-s)+r[Math.ceil(i)].scale*s}_removeAllTiles(){this._rootTiles!=null&&(this._rootTiles.forEach(e=>this._purgeTile(e)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this._visible=!1}_purgeDescendantTiles(e){if(!e.children[0])return!1;let r=!1;for(let i=0;i<4;++i)r=this._purgeTile(e.children[i])||r;return e.unsetChildren(),r}_purgeTile(e){const r=this._purgeDescendantTiles(e)||e.rendered;return this._allTiles.removeUnordered(e),this._unloadTile(e),this._tilePool.release(e),r}_unloadTile(e){this._pendingTilesToUpdate.delete(e),this._pendingTilesForElevationUpdateEvent.delete(e),e.unload(this._renderer)}_splitTile(e){Nf(e.isLeaf,"tile that is already split should not be split again!");const r=e.level+1,i=2*e.lij[1],s=2*e.lij[2];e.setChildren(this._createTile(r,i,s,e),this._createTile(r,i,s+1,e),this._createTile(r,i+1,s,e),this._createTile(r,i+1,s+1,e)),e.setPendingUpdate(wt.RENDERDATA),e.updateAgentSuspension(),this._allTiles.pushArray(e.children),this._allTilesDirty=!0,++this._performanceInfo.numSplit}_emitTileScaleChange(e,r=e.level){NL.spatialReference=this.spatialReference,NL.extent=e.extent,NL.scale=this._getLodBiasCorrectedScale(r),this.emit("scale-change",NL)}_createTile(e,r,i,s){Nf(!!s,"_createTile sanity check");const n=this._acquireTile(e,r,i,s);return n.updateClippingStatus(this.extent),n.updateScreenDepth(this._viewProjectionMatrix),this._shouldSplit(n)&&n.setPendingUpdate(wt.SPLIT),n}get shortBatches(){return this.view.state.mode!==Ur.IDLE}_mergeTile(e){Nf(!e.hasPendingUpdate(wt.SPLIT),"_mergeTile sanity check"),this._purgeDescendantTiles(e)&&(Nf(!e.renderData,"_mergeTile sanity check"),this._loadTile(e),this._markTileToUpdate(e),this._emitTileScaleChange(e),this.shortBatches&&this._batchUpdatePendingTileGeometries()),this._allTilesDirty=!0,++this._performanceInfo.numMerged}_loadChildren(e){Nf(e.rendered,"parent should be rendered"),this._unloadTile(e);const r=e.children;r.forEach(i=>this._loadTile(i)),r.forEach(i=>this._pendingTilesToUpdate.add(i)),this._markAllTileNeighborsForGeometryUpdate(e),this._emitTileScaleChange(e,e.level+1),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_loadParent(e){const r=e.parent;this._unloadChildren(r),this._loadTile(r),this._markTileToUpdate(r),this._emitTileScaleChange(r,r.level),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_unloadChildren(e){const r=e.children;if(r[0])for(let i=0;i<4;++i){const s=r[i];this._unloadChildren(s),this._unloadTile(s)}}_loadTile(e){e.load(),e.setPendingUpdate(wt.RENDERDATA),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(e)}_elevationDataArrived(e,r,i){const s=new xgt(e.lij,e.extent,i);e.dataArrived(r,tr.ELEVATION,s);const n=[e],o=e.level,a=this._iteratorPool.acquire();for(a.reset(n);!a.done;){const l=a.next();l.findElevationBoundsForLayer(r,o),l.computeElevationBounds()}o===0&&this._updateRootTileElevationBounds(),a.remove(),this._updateTilesVisibility(n)}_handleLayerViewChanges(e=rl){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let r=!1;const i=new Set;let s=-1;for(const n of this.view.allLayerViews.items)if(i.add(n.uid),jM(n)||j3(n))if(this._basemapLayerViewHandles.has(n.uid)&&!j3(n)){const o=this._layerClassFromLayerView(n),a=this._getLayerIdxByUID(o,n.uid);a!=null&&((a<s||s==null)&&(r=!0),s=a)}else this._registerTiledLayerView(n),n.layer.loaded&&(r=!0);this._basemapLayerViewHandles.forEach((n,o)=>{i.has(o)||(this._unregisterTiledLayerView(o),r=!0)}),r&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),e.madeProgress()}_allSurfaceLayersTransparent(){let e=this.view.map?.ground?.opacity===0;for(const r of this.view.allLayerViews.items)if(Hq(r)&&!mye(r.layer)&&r.fullOpacity!==0)return e=!1,e;return e}_hasCompositeBlendMode(){for(const e of this.view.allLayerViews.items)if((FF(e)||j3(e))&&Zgt(Zq[e.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(e){return jq(e)?tr.ELEVATION:tr.MAP}_registerTiledLayerView(e){const r=[];if((FF(e)||j3(e))&&r.push(le(()=>e.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(cn.UNFADED)})),!j3(e)){const i=this._layerClassFromLayerView(e);r.push(le(()=>e.suspended,()=>this._updateTiledLayers())),r.push(le(()=>e.fullOpacity,()=>this._updateTileTextures(cn.UNFADED))),r.push(le(()=>"effectiveScaleRange"in e.layer?e.layer.effectiveScaleRange:null,()=>this._restartAllAgents(i))),r.push(e.on("data-changed",()=>{const s=this._getLayerIdxByUID(i,e.uid);s!=null&&this._invalidateLayerData(s,i)}))}this._unregisterTiledLayerView(e.uid),this._basemapLayerViewHandles.set(e.uid,r)}_unregisterTiledLayerView(e){const r=this._basemapLayerViewHandles.get(e);if(r){for(const i of r)i.remove();this._basemapLayerViewHandles.delete(e)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const e=this.view.allLayerViews,r=[[],[]];let i=null;e.forEach(s=>{if(!s.layer||s.suspended||!jM(s)||!s.fullExtent)return;const n=this._layerClassFromLayerView(s);if(n===tr.MAP){const o=s.displayLevelRange.maxLevel;o!==1/0&&(i===null||o>i)&&(i=o)}r[n].push(s)});for(const s of pb){const n=this._layerViews[s],o=r[s];o.reverse();const a=o.length;let l=n.length!==a;const c=new Array(a),h=new Array(n.length);this._layerIndexByUid[s].clear();for(let d=0;d<a;d++){const f=o[d].uid;this._layerIndexByUid[s].set(f,d);const m=n.indexOf(o[d]);c[d]=m,d!==m&&(l=!0),m>-1&&(h[m]=d)}if(l){const d=this._postorderIterator;for(d.reset(this._rootTiles);!d.done;)d.next().modifyLayers(h,c,s);this._layerViews[s]=o,this._restartAllAgents(s),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(i)&&this._viewChangeUpdate()}_restartAllAgents(e){const r=this._postorderIterator;for(r.reset(this._rootTiles);!r.done;){const i=r.next();i.restartAgents(e),e===tr.ELEVATION&&i.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(e,r){return this._layerViews[r][e]}numLayers(e){return this._layerViews[e].length}_updateTileTextures(e){this._allTiles.forAll(r=>{r.updateAgents(tr.MAP),e===cn.IMMEDIATE?this.renderer.updateTileTexture(r,wt.TEXTURE_NOFADING):r.updateRenderData(tr.MAP,e)}),this._evaluateTransparency()}_invalidateLayerData(e,r){this._allTiles.forAll(i=>i.removeLayerAgent(e,r)),this._allTiles.forAll(i=>i.invalidateLayerData(e,r))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(e=_s.UPDATE){this.renderer.setNeedsRender(e)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(e,r,i,s){const n=this.layerViewByIndex(r,i),o=n.layer;return!o.tilemapCache||GM(n)?this._requestTileData(e,i,n,s):(++this._asyncWorkItems,o.tilemapCache.fetchAvailability(e.lij[0],e.lij[1],e.lij[2],{...s,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(a=>{throw--this._asyncWorkItems,Yt(s),ds(a)||this._dataMissing(e,i,n,{notInTilemap:!0}),a}).then(()=>this._frameTask.schedule(()=>this._requestTileData(e,i,n,s),s.signal)))}_requestTileData(e,r,i,s){return r===tr.ELEVATION?jq(i)?this._requestElevationTileData(e,i,s):Promise.reject():Hq(i)?this._requestMapTileData(e,i,s):Promise.reject()}_requestElevationTileData(e,r,i){++this._asyncWorkItems;const s=a=>{if(Mn(i))return;const l=this._layerIndexByUid[tr.ELEVATION].get(r.uid);l!=null?(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(e,l,a)):K.getLogger(this).warn("TerrainSurface: received data from unknown layer %d %s",tr.ELEVATION,e.lij.toString())},n=a=>{ds(a)||(this._dataMissing(e,tr.ELEVATION,r,a),this.requestUpdate())};if(fue(r.layer))return r.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],{noDataValue:vM,signal:i.signal}).then(a=>{if(!Mn(i))return this._frameTask.schedule(()=>s(a),i.signal,n);K.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.")},n).finally(()=>{--this._asyncWorkItems});const o=r.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);return this._elevationDataRequester.request(o,"binary",i).then(a=>this._lercDecoder.decode(a,{noDataValue:vM},i.signal)).then(a=>{a?s(new agt(a)):n(new Error("LERC decoding failed"))},n).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(e,r,i){++this._asyncWorkItems;const s=(h,d)=>{--this._asyncWorkItems,qS(d),Mn(i)||(this._dataMissing(e,tr.MAP,r,h),this.requestUpdate())},n=h=>d=>s(d,h),o=h=>this._frameTask.schedule(()=>{--this._asyncWorkItems,this.requestUpdate(),Mn(i)?qS(h):this._mapTileDataArrived(e,r,h)},i.signal,n(h)).catch(n(h)),a=(h,d=null)=>this._frameTask.schedule(()=>s(h,d));if(GM(r)){const h=r.schemaHelper.getLevelRowColumn(e.lij);return r.fetchTile(h[0],h[1],h[2],i).then(o,a)}if(B9(r))return r.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(o,a);if(mee(r)&&fue(r.layer))return r.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(h=>{if(Mn(i))return K.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void a(zr());o(h)},a);let l=r.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);sgt(r.layer)&&r.layer.refreshTimestamp&&(l+=`${l.includes("?")?"&":"?"}_ts=${r.layer.refreshTimestamp}`);const c=r.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(l,c,i).then(o,a)}_mapTileDataArrived(e,r,i){const s=this._getLayerIdxByUID(tr.MAP,r.uid);s!=null?e.dataArrived(s,tr.MAP,i):(qS(i),K.getLogger(this).warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(e,r){return this._layerIndexByUid[e].get(r)}_dataMissing(e,r,i,s){const n=this._getLayerIdxByUID(r,i.uid);n!=null?e.dataMissing(n,r,s):K.getLogger(this).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(e){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll(r=>{r.renderData&&this.overlayManager.setTileParameters(r)}),this._renderer.setNeedsRender(e))}get performanceInfo(){const e=this._performanceInfo;return e.numNodes=this._allTiles.length,e.numLeaves=e.numVisible=e.numRendered=e.numLoadedPerLevel.length=e.numRenderedPerLevel.length=0,this._allTiles.forAll(r=>{r.isLeaf&&e.numLeaves++;const i=r.level;r.renderData&&(e.numLoadedPerLevel[i]=(e.numLoadedPerLevel[i]||0)+1),r.visible&&(e.numVisible++,r.rendered&&(e.numRenderedPerLevel[i]=(e.numRenderedPerLevel[i]||0)+1,e.numRendered++))}),e}get usedMemory(){return this.tilingScheme?(this._usedMemory==null&&(this._usedMemory=this._recalculateUsedMemory()),this._usedMemory!=null?this._usedMemory:0):0}_recalculateUsedMemory(){return this.tilingScheme?this._allTiles.reduce((e,r)=>e+r.usedMemory,0):null}getUsedMemoryForLayerView(e){let r=this.overlayManager.gpuMemoryUsage;const i=this._layerClassFromLayerView(e),s=this._getLayerIdxByUID(i,e.uid);return s!=null&&this._allTiles.forAll(n=>r+=n.getUsedMemoryForLayer(i,s)),r}getTile(e){if(e==null||this._rootTiles==null)return null;const r=e.split("/").map(a=>+a);if(r[0]===0)return this._rootTiles.find(a=>a.lij[1]===r[1]&&a.lij[2]===r[2]);const i=2**r[0],s=Math.floor(r[1]/i),n=Math.floor(r[2]/i);let o;if(this._rootTiles.some(a=>a.lij[1]===s&&a.lij[2]===n&&(o=a,!0)),o){let a=1<<r[0]-1;for(;o.lij[0]<r[0];){let l=r[1]&a?2:0;if((r[2]&a)>0&&l++,!o.children[l])return null;o=o.children[l],a>>=1}return Nf(o.lij[0]===r[0]&&o.lij[1]===r[1]&&o.lij[2]===r[2],"not the right tile?"),o}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(e){this._renderer.renderPatchBorders=e}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(e){this._renderer.visualizeNormals=e}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(e){this._renderer.renderingDisabled=e}get test(){const e=this;return{renderer:e._renderer,lercDecoder:e._lercDecoder,forceReload:()=>{e._rootTiles!=null&&e._rootTiles.length>0&&(e._mergeTile(e._rootTiles[0]),e._viewChangeUpdate())},getTiles:()=>e._allTiles.toArray(),getRenderedTiles(){TV.clear(),e._allTiles.forAll(i=>{i.visible&&i.rendered&&TV.push(i)});const r=TV.toArray();return rRe(e.renderOrder,r),r},lockTilingScheme(r,i){e._extentHelper.defaultTiledLayersExtent=i,e.tilingSchemeLogic.test.lockTilingScheme(r)}}}checkAllTilesWaterproofness(){if(!DF)return;const e=this._rootTiles;if(e==null)return;const r=o=>o?.renderData?.geometry?.indices?.length>0,i=(o,a)=>{r(o)&&console.error("Tile[",o.lij,"] has geometry although parent[",a.lij,"] has geom")},s=o=>{if(o.intersectsClippingArea)if(o.renderData&&!o.renderData.geometryState&&console.error("Tile[",o.lij,"] has renderData but not geometryState"),o.renderData&&!o.renderData.geometry&&console.error("Tile[",o.lij,"] has renderData but not geometryInfo"),!o.renderData?.geometry||(o.renderData.geometry.indices?.length??0)>0||console.error("Tile[",o.lij,"] has renderData but no indices - geometryInfo: ",o.renderData.geometry),r(o)){o.checkGeometryWaterproofness();for(const a of o.children)i(a,o)}else if(o.isLeaf)console.error("Tile[",o.lij,"] has no geometry and no children, from root to leaf");else for(const a of o.children)s(a)},n=o=>{const a=o.parent?.visible??!0,l=o.visible;o.computeVisibility();const c=o.visible;if(l!==c&&a&&console.error(" Tile[",o.lij,"] has out of date visibility: ",l," instead of ",c),!o.isLeaf)for(const h of o.children)n(h)};for(const o of e)s(o),n(o)}get isGlobal(){return this._isGlobal}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateeCarree(){return this._isWebMercatorOnPlateeCarree}isEastEndWrap(e){return this.isGlobal&&e[2]===this.lijEastEnd(e[0])-1}isWestEndWrap(e){return this.isGlobal&&e[2]===0}lijEastEnd(e){return 2**(e+(this.spatialReference!=null&&this.spatialReference.isGeographic?1:0))}wrapEastWest(e){const r=this.lijEastEnd(e[0]),i=e[2];if(0<=i&&i<r)return e;if(!this.isGlobal)return null;const s=(i+(i<0?r:0))%r;return[e[0],e[1],s]}enableInternalChecks(e){Emt(e)}enableWaterproofnessChecks(e){Smt(e)}};u([p()],Ht.prototype,"_renderer",void 0),u([p({constructOnly:!0})],Ht.prototype,"_scaleRangeQueries",void 0),u([p({constructOnly:!0})],Ht.prototype,"view",void 0),u([p({constructOnly:!0})],Ht.prototype,"overlayManager",void 0),u([p()],Ht.prototype,"_hasPendingUpdates",void 0),u([p()],Ht.prototype,"_asyncWorkItems",void 0),u([p()],Ht.prototype,"_allTilesDirty",void 0),u([p()],Ht.prototype,"_allTilesSorted",void 0),u([p()],Ht.prototype,"_viewChanged",void 0),u([p()],Ht.prototype,"_splitLimits",void 0),u([p({readOnly:!0})],Ht.prototype,"_watchUpdatingTracking",void 0),u([p()],Ht.prototype,"_frameTask",void 0),u([p({readOnly:!0})],Ht.prototype,"snapLevel",null),u([p({readOnly:!0})],Ht.prototype,"lodSnapping",null),u([p()],Ht.prototype,"_userClippingExtent",null),u([p()],Ht.prototype,"_rootTilesExtent",void 0),u([p({readOnly:!0})],Ht.prototype,"extent",null),u([p({readOnly:!0})],Ht.prototype,"groundExtent",null),u([p({readOnly:!0})],Ht.prototype,"_tilingSchemeExtent",null),u([p({readOnly:!0})],Ht.prototype,"updating",null),u([p({readOnly:!0})],Ht.prototype,"running",null),u([p(bgt)],Ht.prototype,"updatingProgress",void 0),u([p({readOnly:!0})],Ht.prototype,"updatingProgressValue",null),u([p()],Ht.prototype,"_maxNumUpdating",void 0),u([p()],Ht.prototype,"baseOpacity",null),u([p()],Ht.prototype,"hasCompositeBlendMode",void 0),u([p({readOnly:!0})],Ht.prototype,"viewingMode",null),u([p()],Ht.prototype,"maxTextureScale",void 0),u([p({readOnly:!0})],Ht.prototype,"ready",null),u([p({value:tC.FRONT_TO_BACK})],Ht.prototype,"renderOrder",null),u([p({readOnly:!0})],Ht.prototype,"rootTiles",null),u([p()],Ht.prototype,"_rootTiles",void 0),u([p({readOnly:!0})],Ht.prototype,"spatialReference",null),u([p({type:ke})],Ht.prototype,"backgroundColor",null),u([p({value:!1})],Ht.prototype,"slicePlaneEnabled",null),u([p({readOnly:!0})],Ht.prototype,"tilingScheme",void 0),u([p({readOnly:!0})],Ht.prototype,"tilingSchemeLocked",null),u([p({readOnly:!0})],Ht.prototype,"tilingSchemeLogic",void 0),u([p()],Ht.prototype,"wireframe",null),u([p({value:!1})],Ht.prototype,"suspended",null),u([p()],Ht.prototype,"textureFadeDuration",null),u([p()],Ht.prototype,"visibleElevationBounds",void 0),u([p()],Ht.prototype,"rootTileElevationBounds",void 0),u([p()],Ht.prototype,"_layerViewsDirty",void 0),u([p()],Ht.prototype,"renderPatchBorders",null),u([p()],Ht.prototype,"visualizeNormals",null),u([p()],Ht.prototype,"renderingDisabled",null),Ht=u([P("esri.views.3d.terrain.TerrainSurface")],Ht);const l_t=Ht;function Khe(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function jRe(t){const e=t.children;if(!e[0])return!1;for(const r of e)if(r.shouldLoad)return!0;for(const r of e)if(jRe(r))return!0;return!1}function c_t(t){return t.isLeaf&&(t.parent?.shouldLoad??!1)}const _l=Wt(),u_t=zt(),DL=[0,0,0],TV=new Vt,SV={spatialReference:null,extent:zt(),context:"ground"},NL={spatialReference:null,extent:null,scale:0};function ede(t,e,r){for(const i of t){if(!i.containsPointXY(e,r))continue;let s=i;for(;s&&!s.renderData;){const o=(e>s.extentMidX?1:0)+(r<s.extentMidY?2:0);s=s.children[o]}const n=s?.renderData?.geometryState.samplerData??null;return Ji(e,r,n)}return null}let h_t=class{constructor(e,r,i){this.operation=e,this.geometry=r,this.states=i}},CO=class extends Te{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commitLayer(e,r){const i=this._dirtyGeomRecords.get(e);i&&(i.forEach((s,n)=>{const o=this._ensureGeomRecord(e,n);s.forEach(({geometry:a,operation:l,states:c},h)=>{let d=!1;if(l===Yi.UPDATE){const f=o.get(h);if(f){if(c&An.TRANSFORMATION){const m=this.model.getObject(n);this.model.updateRenderGeometryTransformation(m,a,f)&&(d=!0)}d||r.updates.push({renderGeometry:f,updateType:c})}else ot(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(l===Yi.REMOVE||d){const f=o.get(h);f?(r.removes.push(f),o.delete(h)):l===Yi.REMOVE&&ot(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove")}if(l===Yi.ADD||d){const f=this.model.getObject(n);if(f!=null){const m=this.model.getRenderGeometry(f,a);r.adds.push(m),o.set(h,m)}}}),o.size===0&&this._residentGeomRecords.get(e).delete(n)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e),this.dirty=this._hasDirtyGeometryRecords)}getResidentRenderGeometries(e,r){const i=this._residentGeomRecords.get(e);i&&i.forEach(s=>s.forEach(n=>r.push(n)))}_objectStateChanged(e,r){for(const i of r.geometries)this._updateOrCreateDirtyRecord(r,i,null,Yi.UPDATE,e)}visibilityChanged(e){this._objectStateChanged(An.VISIBILITY,e)}highlightChanged(e){this._objectStateChanged(An.HIGHLIGHT,e)}occlusionChanged(e){this._objectStateChanged(An.OCCLUDEE,e)}objectGeometryUpdated(e){this._updateOrCreateDirtyRecord(e.object,e.geometry,null,Yi.UPDATE,An.GEOMETRY)}layerAdded(e){e.objects.forAll(r=>this._layerObjectAdded(e,r))}layerRemoved(e){e.objects.forAll(r=>this._layerObjectRemoved(e,r))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,r){const i=e.id;for(const s of r.geometries)this._objectGeometryAdded(r,s,i)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const r of e.objects)this._layerObjectAdded(e.layer,r)}layerObjectsRemoved(e){for(const r of e.objects)this._layerObjectRemoved(e.layer,r)}_layerObjectRemoved(e,r){const i=e.id;for(const s of r.geometries)this._objectGeometryRemoved(r,s,i)}shaderTransformationChanged(e){const r=this._residentGeomRecords.get(e.id);r&&r.forEach((i,s)=>{const n=this.model.getObject(s);n&&n.hasVolativeTransformation()&&i.forEach(o=>o.shaderTransformationChanged())})}objectTransformation(e){const r=this._getParentLayerId(e),i=e.id;this._ensureGeomRecord(r,i).forEach(s=>{this._updateOrCreateDirtyRecord(e,s.geometry,r,Yi.UPDATE,An.TRANSFORMATION)})}objectShaderTransformation(){}objectGeometryAdded(e){this._objectGeometryAdded(e.object,e.geometry)}_objectGeometryAdded(e,r,i=null){this._updateOrCreateDirtyRecord(e,r,i,Yi.ADD)}objectGeometryRemoved(e){this._objectGeometryRemoved(e.object,e.geometry)}_objectGeometryRemoved(e,r,i=null){this._updateOrCreateDirtyRecord(e,r,i,Yi.REMOVE)}_updateOrCreateDirtyRecord(e,r,i,s,n=An.NONE){i=i??this._getParentLayerId(e);const o=e.id,a=r.id,l=this._ensureDirtyRecord(i,o),c=l.get(a);if(c){const h=c.operation;h===Yi.REMOVE&&s===Yi.ADD&&c.states!==An.NONE?c.operation=Yi.UPDATE:h===Yi.REMOVE&&s===Yi.ADD||h===Yi.ADD&&s===Yi.REMOVE?l.delete(a):h!==Yi.UPDATE||s!==Yi.REMOVE&&s!==Yi.UPDATE?(ot((h===Yi.REMOVE||h===Yi.ADD)&&s===Yi.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),c.states|=n):(c.operation=s,c.states|=n)}else l.set(a,new h_t(s,r,n));this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(e,r){let i=this._residentGeomRecords.get(e);i||(i=new Map,this._residentGeomRecords.set(e,i));let s=i.get(r);return s||(s=new Map,i.set(r,s)),s}get _hasDirtyGeometryRecords(){return Bo(this._dirtyGeomRecords,e=>Bo(e,r=>r&&r.size>0))}_ensureDirtyRecord(e,r){let i=this._dirtyGeomRecords.get(e);i||(i=new Map,this._dirtyGeomRecords.set(e,i));let s=i.get(r);return s||(s=new Map,i.set(r,s)),s}_getParentLayerId(e){return e.parentLayer?e.parentLayer.id:nNe}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let r="";return this._dirtyGeomRecords.forEach((i,s)=>{i.forEach((n,o)=>{r.length>0&&(r+=`
`),r+=s+"."+o;const a=[];n.forEach(l=>{const c=l.operation;a[c]||(a[c]=[]),a[c].push(l.geometry.id)});for(let l=0;l<a.length;l++)if(a[l]){r+=" "+e[l-1]+": ";for(let c=0;c<a[l].length;c++)r+=a[l][c]+", "}})}),r}get test(){const e=this;return{get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce((r,i)=>r+i.size,0)},commit:r=>e._dirtyGeomRecords.forEach((i,s)=>e.commitLayer(s,r))}}};u([p({constructOnly:!0})],CO.prototype,"model",void 0),u([p()],CO.prototype,"dirty",void 0),CO=u([P("esri.views.3d.webgl-engine.lib.ModelDirtySet")],CO);const d_t=CO;let QN=class extends Te{constructor(){super(...arguments),this.dirtySet=new d_t({model:this}),this._content=new Map,this._originFactory=new IK(null)}getObject(e){return this._content.get(e)}add(e){const r=e.id;ot(!this._content.has(r),"Model/Stage already contains object to be added"),this._content.set(r,e),wF(e)&&this.dirtySet.layerAdded(e)}remove(e){ot(this._content.has(e.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(e.id),e.unload(),wF(e)&&this.dirtySet.layerRemoved(e)}addMany(e){for(const r of e)r!=null&&(ot(!this._content.has(r.id),"Model/Stage already contains object to be added"),this._content.set(r.id,r))}removeMany(e){for(const r of e)ot(this._content.has(r.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(r.id),r.unload()}has(e){return this._content.has(e.id)}forEachOfType(e,r){this._content.forEach(i=>{i.type===e&&r(i)})}getRenderGeometry(e,r){const{shaderTransformer:i,localOrigin:s}=r,n=new eC(r,{shaderTransformer:i,castShadow:e.castShadow});return n.updateTransformation(o=>e.getCombinedStaticTransformation(r,o)),n.localOrigin=s??this._originFactory.getOrigin(n.boundingSphere),n}updateRenderGeometryTransformation(e,r,i){if(e==null)return!1;i.updateTransformation(n=>e.getCombinedStaticTransformation(r,n));const s=this._originFactory.getOrigin(i.boundingSphere);return i.localOrigin!==s}getStats(){const e={},r=Array.from(this._content.values());for(let i=0;i<us.COUNT;++i)e[i]=r.filter(s=>s.type===i).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};u([p({constructOnly:!0})],QN.prototype,"dirtySet",void 0),QN=u([P("esri.views.3d.webgl-engine.parts.Model")],QN);function HRe(){const t=new Float32Array(4);return t[3]=1,t}function qRe(t){const e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function p_t(t,e,r,i){const s=new Float32Array(4);return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function WRe(t,e){return new Float32Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:qRe,create:HRe,createView:WRe,fromValues:p_t},Symbol.toStringTag,{value:"Module"}));const rC=1e-6,Y3=[0,0,0],FL=[0,0,0];function f_t(t,e){const{data:r,size:i}=t,s=r.length/i;if(s<=0)return;const n=new T_t(t);KN(Y3,n.minProj,n.maxProj),Xb(Y3,Y3,.5),Ph(FL,n.maxProj,n.minProj);const o=cW(FL),a=new S_t;a.quality=o,s<14&&(t=new We(new Float64Array(n.buffer,112,42),3));const l=[0,0,0],c=[0,0,0],h=[0,0,0],d=[0,0,0],f=[0,0,0],m=[0,0,0],g=[0,0,0];switch(m_t(n,t,g,l,c,h,d,f,m,a)){case 1:return void sde(Y3,FL,e);case 2:return void x_t(t,d,e)}g_t(t,g,l,c,h,d,f,m,a),XRe(t,a.b0,a.b1,a.b2,YS,ZS);const _=[0,0,0];Ph(_,ZS,YS),a.quality=cW(_),a.quality<o?YRe(a.b0,a.b1,a.b2,YS,ZS,_,e):sde(Y3,FL,e)}function m_t(t,e,r,i,s,n,o,a,l,c){return y_t(t,i,s),uW(i,s)<rC?1:(Ph(o,i,s),Fo(o,o),__t(e,i,o,n)<rC?2:(Ph(a,s,n),Fo(a,a),Ph(l,n,i),Fo(l,l),Ih(r,a,o),Fo(r,r),fb(e,r,o,a,l,c),0))}const Z3=[0,0,0],J3=[0,0,0],Yu=[0,0,0],Zu=[0,0,0],Ju=[0,0,0],xy=[0,0,0],Ty=[0,0,0],Sy=[0,0,0];function g_t(t,e,r,i,s,n,o,a,l){v_t(t,e,r,Z3,J3),Z3[0]!==void 0&&(Ph(Yu,Z3,r),Fo(Yu,Yu),Ph(Zu,Z3,i),Fo(Zu,Zu),Ph(Ju,Z3,s),Fo(Ju,Ju),Ih(xy,Zu,n),Fo(xy,xy),Ih(Ty,Ju,o),Fo(Ty,Ty),Ih(Sy,Yu,a),Fo(Sy,Sy),fb(t,xy,n,Zu,Yu,l),fb(t,Ty,o,Ju,Zu,l),fb(t,Sy,a,Yu,Ju,l)),J3[0]!==void 0&&(Ph(Yu,J3,r),Fo(Yu,Yu),Ph(Zu,J3,i),Fo(Zu,Zu),Ph(Ju,J3,s),Fo(Ju,Ju),Ih(xy,Zu,n),Fo(xy,xy),Ih(Ty,Ju,o),Fo(Ty,Ty),Ih(Sy,Yu,a),Fo(Sy,Sy),fb(t,xy,n,Zu,Yu,l),fb(t,Ty,o,Ju,Zu,l),fb(t,Sy,a,Yu,Ju,l))}function y_t(t,e,r){let i=uW(t.maxVert[0],t.minVert[0]),s=0;for(let n=1;n<7;++n){const o=uW(t.maxVert[n],t.minVert[n]);o>i&&(i=o,s=n)}Pc(e,t.minVert[s]),Pc(r,t.maxVert[s])}const Qu=[0,0,0];function __t(t,e,r,i){const{data:s,size:n}=t;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<s.length;l+=n){Qu[0]=s[l]-e[0],Qu[1]=s[l+1]-e[1],Qu[2]=s[l+2]-e[2];const c=r[0]*Qu[0]+r[1]*Qu[1]+r[2]*Qu[2],h=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],d=Qu[0]*Qu[0]+Qu[1]*Qu[1]+Qu[2]*Qu[2]-c*c/h;d>o&&(o=d,a=l)}return Pc(i,s,a),o}const Cn=[0,0];function v_t(t,e,r,i,s){w_t(t,e,Cn,s,i);const n=JRe(r,e);Cn[1]-rC<=n&&(i[0]=void 0),Cn[0]+rC>=n&&(s[0]=void 0)}const tde=[0,0,0],rde=[0,0,0],ide=[0,0,0],zT=[0,0,0],VT=[0,0,0],UL=[0,0,0];function fb(t,e,r,i,s,n){if(ZRe(e)<rC)return;Ih(tde,r,e),Ih(rde,i,e),Ih(ide,s,e),XS(t,e,Cn),VT[1]=Cn[0],zT[1]=Cn[1],UL[1]=zT[1]-VT[1];const o=[r,i,s],a=[tde,rde,ide];for(let l=0;l<3;++l){XS(t,o[l],Cn),VT[0]=Cn[0],zT[0]=Cn[1],XS(t,a[l],Cn),VT[2]=Cn[0],zT[2]=Cn[1],UL[0]=zT[0]-VT[0],UL[2]=zT[2]-VT[2];const c=cW(UL);c<n.quality&&(Pc(n.b0,o[l]),Pc(n.b1,e),Pc(n.b2,a[l]),n.quality=c)}}const b_t=[0,0,0];function XS(t,e,r){const{data:i,size:s}=t;r[0]=Number.POSITIVE_INFINITY,r[1]=Number.NEGATIVE_INFINITY;for(let n=0;n<i.length;n+=s){const o=i[n]*e[0]+i[n+1]*e[1]+i[n+2]*e[2];r[0]=Math.min(r[0],o),r[1]=Math.max(r[1],o)}}function w_t(t,e,r,i,s){const{data:n,size:o}=t;Pc(i,n),Pc(s,i),r[0]=JRe(b_t,e),r[1]=r[0];for(let a=o;a<n.length;a+=o){const l=n[a]*e[0]+n[a+1]*e[1]+n[a+2]*e[2];l<r[0]&&(r[0]=l,Pc(i,n,a)),l>r[1]&&(r[1]=l,Pc(s,n,a))}}function sde(t,e,r){Pc(r.center,t),Xb(r.halfSize,e,.5),r.quaternion[0]=0,r.quaternion[1]=0,r.quaternion[2]=0,r.quaternion[3]=1}const eg=[0,0,0],BT=[0,0,0],Q3=[0,0,0],YS=[0,0,0],ZS=[0,0,0],nde=[0,0,0];function x_t(t,e,r){Pc(eg,e),Math.abs(e[0])>Math.abs(e[1])&&Math.abs(e[0])>Math.abs(e[2])?eg[0]=0:Math.abs(e[1])>Math.abs(e[2])?eg[1]=0:eg[2]=0,ZRe(eg)<rC&&(eg[0]=eg[1]=eg[2]=1),Ih(BT,e,eg),Fo(BT,BT),Ih(Q3,e,BT),Fo(Q3,Q3),XRe(t,e,BT,Q3,YS,ZS),Ph(nde,ZS,YS),YRe(e,BT,Q3,YS,ZS,nde,r)}function XRe(t,e,r,i,s,n){XS(t,e,Cn),s[0]=Cn[0],n[0]=Cn[1],XS(t,r,Cn),s[1]=Cn[0],n[1]=Cn[1],XS(t,i,Cn),s[2]=Cn[0],n[2]=Cn[1]}const kL=[0,0,0],af=[1,0,0,0,1,0,0,0,1],GT=[0,0,0];function YRe(t,e,r,i,s,n,o){af[0]=t[0],af[1]=t[1],af[2]=t[2],af[3]=e[0],af[4]=e[1],af[5]=e[2],af[6]=r[0],af[7]=r[1],af[8]=r[2],E_t(o.quaternion,af),KN(GT,i,s),Xb(GT,GT,.5),Xb(o.center,t,GT[0]),Xb(kL,e,GT[1]),KN(o.center,o.center,kL),Xb(kL,r,GT[2]),KN(o.center,o.center,kL),Xb(o.halfSize,n,.5)}const Zc=7;let T_t=class{constructor(e){this.minVert=new Array(Zc),this.maxVert=new Array(Zc);const r=64*Zc;this.buffer=new ArrayBuffer(r);let i=0;this.minProj=new Float64Array(this.buffer,i,Zc),i+=8*Zc,this.maxProj=new Float64Array(this.buffer,i,Zc),i+=8*Zc;for(let l=0;l<Zc;++l)this.minVert[l]=new Float64Array(this.buffer,i,3),i+=24;for(let l=0;l<Zc;++l)this.maxVert[l]=new Float64Array(this.buffer,i,3),i+=24;for(let l=0;l<Zc;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const s=new Array(Zc),n=new Array(Zc),{data:o,size:a}=e;for(let l=0;l<o.length;l+=a){let c=o[l];c<this.minProj[0]&&(this.minProj[0]=c,s[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,n[0]=l),c=o[l+1],c<this.minProj[1]&&(this.minProj[1]=c,s[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,n[1]=l),c=o[l+2],c<this.minProj[2]&&(this.minProj[2]=c,s[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,n[2]=l),c=o[l]+o[l+1]+o[l+2],c<this.minProj[3]&&(this.minProj[3]=c,s[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,n[3]=l),c=o[l]+o[l+1]-o[l+2],c<this.minProj[4]&&(this.minProj[4]=c,s[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,n[4]=l),c=o[l]-o[l+1]+o[l+2],c<this.minProj[5]&&(this.minProj[5]=c,s[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,n[5]=l),c=o[l]-o[l+1]-o[l+2],c<this.minProj[6]&&(this.minProj[6]=c,s[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,n[6]=l)}for(let l=0;l<Zc;++l){let c=s[l];Pc(this.minVert[l],o,c),c=n[l],Pc(this.maxVert[l],o,c)}}},S_t=class{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}};function cW(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function KN(t,e,r){t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2]}function Ph(t,e,r){t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2]}function Xb(t,e,r){t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r}function Pc(t,e,r=0){t[0]=e[r],t[1]=e[r+1],t[2]=e[r+2]}function Ih(t,e,r){const i=e[0],s=e[1],n=e[2],o=r[0],a=r[1],l=r[2];t[0]=s*l-n*a,t[1]=n*o-i*l,t[2]=i*a-s*o}function Fo(t,e){const r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(r>0){const i=1/Math.sqrt(r);t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}}function ZRe(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function uW(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2];return r*r+i*i+s*s}function JRe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function E_t(t,e){const r=e[0]+e[4]+e[8];if(r>0){let i=Math.sqrt(r+1);t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i}else{let i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);const s=(i+1)%3,n=(i+2)%3;let o=Math.sqrt(e[3*i+i]-e[3*s+s]-e[3*n+n]+1);t[i]=.5*o,o=.5/o,t[3]=(e[3*s+n]-e[3*n+s])*o,t[s]=(e[3*s+i]+e[3*i+s])*o,t[n]=(e[3*n+i]+e[3*i+n])*o}}const Aw=rd(),Xa=O(),hW=O(),C_t=ki();let iqt=class{constructor(e){const o=e*56;this.buffer=new ArrayBuffer(o),this.obbs=new Array(e);for(let a=0;a<e;a++)this.obbs[a]={center:gZ(this.buffer,56*a+0),halfSize:Xxe(this.buffer,56*a+24),quaternion:WRe(this.buffer,56*a+36)}}};function Iee(t=[0,0,0],e=[-1,-1,-1],r=rd()){return{center:ks(t),halfSize:V5(e),quaternion:qRe(r)}}function ode(t){return Iee(t.center,t.halfSize,t.quaternion)}function nqt(t,e){ie(e.center,t.center),ie(e.halfSize,t.halfSize),NP(e.quaternion,t.quaternion)}function QRe(t,e){return e=e||Iee(),f_t(t,e),e}function mb(t,e){const r=fi(e,t.center),i=X9(t,e);return r>i?1:r<-i?-1:0}function oqt(t,e){return Xa[0]=t.center[0]-e[0],Xa[1]=t.center[1]-e[1],Xa[2]=t.center[2]-e[2],wm(Aw,t.quaternion),Lc(Xa,Xa,Aw),a5(Xa,Xa),bZ(hW,Xa,t.halfSize),X6(hW,Xa)<e[3]*e[3]}function aqt(t,e){e||(e=gn());const r=k8(C_t,t.quaternion),i=t.halfSize[0]*Math.abs(r[0])+t.halfSize[1]*Math.abs(r[3])+t.halfSize[2]*Math.abs(r[6]),s=t.halfSize[0]*Math.abs(r[1])+t.halfSize[1]*Math.abs(r[4])+t.halfSize[2]*Math.abs(r[7]),n=t.halfSize[0]*Math.abs(r[2])+t.halfSize[1]*Math.abs(r[5])+t.halfSize[2]*Math.abs(r[8]);return e[0]=t.center[0]-i,e[1]=t.center[1]-s,e[2]=t.center[2]-n,e[3]=t.center[0]+i,e[4]=t.center[1]+s,e[5]=t.center[2]+n,e}function lqt(t,e){return fi(e,t.center)-X9(t,e)}function cqt(t,e){return fi(e,t.center)+X9(t,e)}function uqt(t,e){return mb(t,e[0])<=0&&mb(t,e[1])<=0&&mb(t,e[2])<=0&&mb(t,e[3])<=0&&mb(t,e[4])<=0&&mb(t,e[5])<=0}function hqt(t,e,r,i=0){wm(Aw,t.quaternion),fe(Xa,e,t.center);const s=Lc(Xa,Xa,Aw),n=Lc(hW,r,Aw);let o=-1/0,a=1/0;for(let l=0;l<3;l++)if(Math.abs(n[l])>1e-6){const c=(i+t.halfSize[l]-s[l])/n[l],h=(-i-t.halfSize[l]-s[l])/n[l];o=Math.max(o,Math.min(c,h)),a=Math.min(a,Math.max(c,h))}else if(s[l]>t.halfSize[l]+i||s[l]<-t.halfSize[l]-i)return!1;return o<=a}(()=>{const t=new Int8Array(162);let e=0;const r=i=>{for(let s=0;s<i.length;s++)t[e+s]=i[s];e+=6};return r([6,2,3,1,5,4]),r([0,2,3,1,5,4]),r([0,2,3,7,5,4]),r([0,1,3,2,6,4]),r([0,1,3,2,0,0]),r([0,1,5,7,3,2]),r([0,1,3,7,6,4]),r([0,1,3,7,6,2]),r([0,1,5,7,6,2]),r([0,1,5,4,6,2]),r([0,1,5,4,0,0]),r([0,1,3,7,5,4]),r([0,2,6,4,0,0]),r([0,0,0,0,0,0]),r([1,3,7,5,0,0]),r([2,3,7,6,4,0]),r([2,3,7,6,0,0]),r([2,3,1,5,7,6]),r([0,1,5,7,6,2]),r([0,1,5,7,6,4]),r([0,1,3,7,6,4]),r([4,5,7,6,2,0]),r([4,5,7,6,0,0]),r([4,5,1,3,7,6]),r([0,2,3,7,5,4]),r([6,2,3,7,5,4]),r([6,2,3,1,5,4]),t})();function X9(t,e){wm(Aw,t.quaternion),Lc(Xa,e,Aw);const r=t.halfSize;return Math.abs(Xa[0]*r[0])+Math.abs(Xa[1]*r[1])+Math.abs(Xa[2]*r[2])}function KRe(t,e){for(let r=0;r<8;++r){const i=e[r];i[0]=1&r?-t.halfSize[0]:t.halfSize[0],i[1]=2&r?-t.halfSize[1]:t.halfSize[1],i[2]=4&r?-t.halfSize[2]:t.halfSize[2],Lc(i,i,t.quaternion),de(i,i,t.center)}}function A_t(t){return mc(t.halfSize)}function O_t(t,e,r,i,s){if(NP(s.quaternion,t.quaternion),i===Ve.Global){wm(zL,t.quaternion),Lc(Ey,t.center,zL),a5(jT,Ey),bZ(HT,jT,t.halfSize),Pn(HT,jT,HT);const n=Re(HT);de(HT,jT,t.halfSize);const o=Re(HT);if(n<r)ie(s.center,t.center),ne(Ey,r,r,r),de(s.halfSize,t.halfSize,Ey);else{const a=o>0?1+e/o:1,l=n>0?1+r/n:1,c=(l+a)/2,h=(l-a)/2;se(s.halfSize,jT,h),Kb(s.halfSize,s.halfSize,t.halfSize,c),se(s.center,jT,c),Kb(s.center,s.center,t.halfSize,h),Aye(Ey,Ey),W6(s.center,s.center,Ey),Lc(s.center,s.center,s.quaternion)}}else{const n=ne(Ey,0,0,1);Kb(s.center,t.center,n,(r+e)/2),wm(zL,t.quaternion),Lc(n,n,zL),a5(n,n),Kb(s.halfSize,t.halfSize,n,(r-e)/2)}return s}const Ey=O(),jT=O(),HT=O(),zL=rd();let R_t=class{constructor(e){this._totalCount=e,this._indexRanges=[0,e]}allVisible(){return this.componentCount()===this._totalCount}allInvisible(){return this._indexRanges.length===0}componentCount(){const e=this._indexRanges;let r=0;for(let i=0;i<e.length;i+=2)r+=e[i+1];return r}reset(e){e==="all"||e.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=M_t(e)}forEachComponent(e){const r=this._indexRanges;for(let i=0;i<r.length;i+=2){const s=r[i],n=s+r[i+1];for(let o=s;o<n;o++)if(!e(o))return!1}return!0}forEachComponentRange(e){const r=this._indexRanges;for(let i=0;i<r.length;i+=2){const s=r[i];if(!e(s,s+r[i+1]))return!1}return!0}computeOffsetRanges(e){const r=new Array(this._indexRanges.length),i=this._indexRanges;for(let s=0;s<i.length;s+=2){const n=i[s],o=n+i[s+1],a=e[n],l=e[o];r[s]=a,r[s+1]=l-a}return r}};function M_t(t){const e=new Array;if(t.length===0)return e;let r=t[0],i=1;for(let s=1;s<t.length;s++){const n=t[s];r+i===n?i+=1:(e.push(r),e.push(i),r=n,i=1)}return e.push(r),e.push(i),e}let P_t=class{constructor(e,r){this.offsets=r,this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null;const i=this.count;this.visibility=new R_t(i),this.materialDataBuffer=e.getBuffer(i),this.materialDataIndices=new Uint16Array(i);for(let s=0;s<i;s++)this.materialDataIndices[s]=this.materialDataBuffer.acquireIndex()}destroy(){for(let e=0;e<this.count;e++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[e])}get count(){return this.offsets.length-1}get geometryRanges(){return this.cachedGeometryRanges==null&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return this.highlightCounts==null?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return this.highlightCounts==null?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((this.cachedHighlightRanges==null||this.cachedDefaultRanges==null)&&this.highlightCounts!=null){const{highlightRanges:e,defaultRanges:r}=I_t(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=e,this.cachedDefaultRanges=r}}};function I_t(t,e,r){const i=[],s=[];let n=r.length,o=r.length;return e.forEachComponent(a=>(t[a]>0?(n!==a-1&&(i.length&&i.push(r[n+1]-i[i.length-1]),i.push(r[a])),n=a):(o!==a-1&&(s.length&&s.push(r[o+1]-s[s.length-1]),s.push(r[a])),o=a),!0)),i.length&&i.push(r[n+1]-i[i.length-1]),s.length&&s.push(r[o+1]-s[s.length-1]),{highlightRanges:i,defaultRanges:s}}let AO=class extends Te{constructor(){super(...arguments),this.visible=JS.Hidden}};var JS;u([p({autoDestroy:!0})],AO.prototype,"renderable",void 0),u([p({autoDestroy:!0})],AO.prototype,"components",void 0),AO=u([P("esri.views.3d.webgl-engine.collections.Component.ComponentObject")],AO),function(t){t[t.Hidden=0]="Hidden",t[t.Visible=1]="Visible"}(JS||(JS={}));function $_t(t,e,r,i){if(r>=e)return t;t==null&&(t=L_t());const s=t.isVisibleBit;let n=t.data;const o=tMe(n),a=r/o|0,l=r-o*a,c=(e-1)/o|0,h=n,d=i===s;if(!(r<h.length*o)&&d){const f=a+1,m=Math.ceil(h.length*P6),g=c+1;let _=Math.max(f,m);_=Math.min(_,g),n=new Uint32Array(_),n.set(h)}return a<n.length&&(n[a]=N_t(n[a],l,d)),t.data=n,t}function eMe(t,e){if(t==null)return!0;const{isVisibleBit:r,data:i}=t,s=tMe(i);return e<i.length*s?D_t(r,i,e,s):!t.isVisibleBit}function L_t(t=!0){return{isVisibleBit:!t,data:new Uint32Array(0)}}function D_t(t,e,r,i){const s=r/i|0,n=r-s*i;return F_t(e[s],n)===t}function tMe(t){return t.BYTES_PER_ELEMENT*8}function N_t(t,e,r){return t&~(1<<e)|(r?1:0)<<e}function F_t(t,e){return(t&1<<e)!=0}let U_t=class{constructor(e,r){this._components=r,this._indices=e.indices!=null?om(e.indices):zE(e.positions.length/3),this._positions=e.positions,this._componentIntersectionData=new Array(r.count)}getComponentAabb(e,r){this._perComponentAabbs||(this._perComponentAabbs=this._computePerComponentAabbs());for(let i=0;i<6;i++)r[i]=this._perComponentAabbs[6*e+i];return r}getComponentPositions(e,r){r.indices=this._indices,r.data=this._positions,r.stride=3,r.startIndex=this._components.offsets[e],r.endIndex=this._components.offsets[e+1]}intersect(e,r,i,s,n,o,a){const l=new We(this._positions,3,!1,3),c=this._indices,h=this._components.offsets,d=LSe(e,r,k_t),f=e[2],m=r[2];this._components.visibility.forEachComponent(g=>{if(!eMe(this._components.pickability,g))return!0;const _=this.getComponentAabb(g,z_t);if(o!=null){const x=o[g];n!=null?n.componentOffset=x:(e[2]=f-x,r[2]=m-x)}if(n?.applyToAabb(_),!QQ(_,e,d,i))return!0;const v=h[g]/3,b=h[g+1]/3,T=(x,S,E)=>a(g,x,Oc(S,S,s),E);return n==null&&b-v>BRe?(this._componentIntersectionData[g]==null&&(this._componentIntersectionData[g]=new Pee(this._indices,v,b,l)),this._componentIntersectionData[g].intersectRay({r0:e,r1:r},T)):zP(e,r,v,b,c,l,void 0,n,T),!0})}_computePerComponentAabbs(){const e=this._components.count,r=es(6*e),i=this._indices,s=this._positions,n=this._components.offsets;let o=0;for(let a=0;a<e;a++){const l=n[a],c=n[a+1];let h=1/0,d=1/0,f=1/0,m=-1/0,g=-1/0,_=-1/0;for(let v=l;v<c;v++){const b=3*i[v],T=s[b],x=s[b+1],S=s[b+2];h=Math.min(h,T),d=Math.min(d,x),f=Math.min(f,S),m=Math.max(m,T),g=Math.max(g,x),_=Math.max(_,S)}r[o++]=h,r[o++]=d,r[o++]=f,r[o++]=m,r[o++]=g,r[o++]=_}return r}get positions(){return this._positions}get indices(){return this._indices}};const k_t=O(),z_t=gn();let V_t=class{constructor(e,r,i){this.material=e,this.geometry=r,this.meta=i}destroy(){this.material.dispose(),this.geometry.dispose()}},B_t=class{constructor(e,r,i,s){this.vao=e,this.primitiveType=r,this.parameters=i,this.indexed=s}dispose(){this.vao.dispose()}},G_t=class{constructor(){this.near=Number.MAX_VALUE,this.far=-Number.MAX_VALUE}};function j_t(t,e){return{near:t,far:e}}function tI(t){return t?WM(t,1/0,-1/0):j_t(1/0,-1/0)}function WM(t,e,r){return t.near=e,t.far=r,t}function iC(t,e,r=t){return e!=null&&(r.near=Math.min(t.near,e.near),r.far=Math.max(t.far,e.far)),r}function VL(t,e){return t.near<=e&&e<=t.far}const dW={near:0,far:0};function H_t(t,e){const r=tI(),{eye:i,frustum:s,viewForward:n}=t;e.forAll(o=>{const a=o.offsetObb!=null?o.offsetObb:o.obb,l=ye(Pn(tu,a.center,i),n),c=X9(a,n);if(VL(r,l-c)&&VL(r,l+c))return;const h=Z_t(a,s);if(h===-1)return;if(h===0)return tg.far=l+c,tg.near=l-c,void iC(r,tg);const d=BL.pushNew();d.near=l-c,d.far=l+c,d.mask=h,d.object=o});for(let o=0;o<BL.length;o++){const a=BL.data[o];if(VL(r,a.near)&&VL(r,a.far))continue;tg.far=a.far,tg.near=1/0,Y_t(a.object.offsetObb!=null?a.object.offsetObb:a.object.obb,i,q_t,c=>{let h=W_t;for(let d=0;d<rMe&&c.length>0;d++){if(!(a.mask&1<<d))continue;X_t(s[d],c,h);const f=c;c=h,h=f}for(let d=0;d<c.length;d+=3){ne(Ol,c.data[d],c.data[d+1],c.data[d+2]);const f=ye(Pn(Ol,Ol,i),n);tg.near=Math.min(tg.near,f)}})===0&&(tg.near=0),iC(r,tg)}return BL.length=0,r}const BL=new Vt({allocator:t=>t||{near:1/0,far:-1/0,mask:0,object:null},deallocator:t=>(t.object=pC(t.object),t)}),tg=tI(),Ol=O(),R1=O(),q_t=new Vt({deallocator:null}),W_t=new Vt({deallocator:null});function X_t(t,e,r){r.length=0;const i=e.length-3;EV(Ol,e,i);const s=fi(t,Ol);s<=0&&(r.push(Ol[0]),r.push(Ol[1]),r.push(Ol[2]));let n=0,o=s;for(;n<i;n+=3){EV(R1,e,n);const a=fi(t,R1);o*a<0&&(qr(Ol,R1,Ol,a/(a-o)),Rl(r,Ol)),a<=0&&Rl(r,R1),o=a,ie(Ol,R1)}o*s<0&&(EV(R1,e,i),qr(Ol,R1,Ol,s/(s-o)),Rl(r,Ol))}function EV(t,e,r){return ne(t,e.data[r],e.data[r+1],e.data[r+2])}function Rl(t,e){t.push(e[0]),t.push(e[1]),t.push(e[2])}function Y_t(t,e,r,i){wm(lde,t.quaternion),Pn(tu,e,t.center),Lc(tu,tu,lde);const s=8*((tu[0]<-t.halfSize[0]?-1:tu[0]>t.halfSize[0]?1:0)+3*(tu[1]<-t.halfSize[1]?-1:tu[1]>t.halfSize[1]?1:0)+9*(tu[2]<-t.halfSize[2]?-1:tu[2]>t.halfSize[2]?1:0)+13),n=ade[s];if(n===0)return n;k8(GL,t.quaternion),nQ(GL,GL,t.halfSize);const o=(a,l)=>{const c=ade[s+l+1];return ne(a,((1&c)<<1)-1,(2&c)-1,((4&c)>>1)-1),Oc(a,a,GL),de(a,t.center,a)};return r.length=0,Rl(r,o(CV,0)),Rl(r,o(cde,1)),Rl(r,o(tu,2)),Rl(r,o(ude,3)),i(r),n===1||(r.length=0,Rl(r,CV),Rl(r,ude),Rl(r,o(tu,4)),Rl(r,o(hde,5)),i(r),n===2||(r.length=0,Rl(r,CV),Rl(r,hde),Rl(r,o(tu,6)),Rl(r,cde),i(r))),n}const ade=(()=>{const t=new Array(216);let e=0;const r=i=>{for(let s=0;s<i.length;s++)t[e+s]=i[s];e+=8};return r([3,0,6,2,3,1,5,4]),r([2,0,2,3,1,5,4,0]),r([3,1,0,2,3,7,5,4]),r([2,0,1,3,2,6,4,0]),r([1,0,1,3,2,0,0,0]),r([2,1,5,7,3,2,0,0]),r([3,2,0,1,3,7,6,4]),r([2,2,0,1,3,7,6,0]),r([3,3,0,1,5,7,6,2]),r([2,0,1,5,4,6,2,0]),r([1,0,1,5,4,0,0,0]),r([2,1,3,7,5,4,0,0]),r([1,0,2,6,4,0,0,0]),r([0,0,0,0,0,0,0,0]),r([1,1,3,7,5,0,0,0]),r([2,2,3,7,6,4,0,0]),r([1,2,3,7,6,0,0,0]),r([2,3,1,5,7,6,2,0]),r([3,4,0,1,5,7,6,2]),r([2,5,7,6,4,0,1,0]),r([3,5,0,1,3,7,6,4]),r([2,4,5,7,6,2,0,0]),r([1,4,5,7,6,0,0,0]),r([2,5,1,3,7,6,4,0]),r([3,6,0,2,3,7,5,4]),r([2,6,2,3,7,5,4,0]),r([3,7,6,2,3,1,5,4]),t})(),rMe=4;function Z_t(t,e){let r=0;for(let i=0;i<rMe;i++){const s=mb(t,e[i]);if(s>0)return-1;s===0&&(r|=1<<i)}return r}const GL=ki(),lde=rd(),tu=O(),CV=O(),cde=O(),ude=O(),hde=O();let J_t=class{constructor(e){this._objects=e}submit(e,r){this._objects.preSubmit(r),this._objects.visibleObjects.forAll(i=>i.renderable.material.submit(e,r,i))}queryShadowCasterDepthRange(e){return this._objects.visibleObjects.length?H_t(e,this._objects.visibleObjects):null}};function Q_t(t){const e=qi().vec3f(C.POSITION);return t.normals&&e.vec2i16(C.NORMALCOMPRESSED,{glNormalized:!0}),t.textureCoordinates===Fs.Default?e.vec2f(C.UV0):t.textureCoordinates===Fs.Atlas&&(e.vec2f(C.UV0),e.vec4u16(C.UVREGION,{glNormalized:!0})),t.colors&&e.vec4u8(C.COLOR,{glNormalized:!0}),e}let K_t=class{constructor(){this.externalColor=Wt(),this.externalColorMixMode=Hs.Multiply,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0}},evt=class extends ps{constructor(e,r){super(e,"int",ti.Draw,(i,s,n)=>i.setUniform1i(e,r(s,n)))}};var cm;(function(t){t[t.Uniform=0]="Uniform",t[t.Varying=1]="Varying",t[t.COUNT=2]="COUNT"})(cm||(cm={}));const $ee=429496.7296;function iMe(t,e){$M(t/$ee*.5+.5,e)}function tvt(t,e){switch(e.componentData){case cm.Varying:return rvt(t,e);case cm.Uniform:return ivt(t);case cm.COUNT:return;default:e.componentData}}function rvt(t,e){const{vertex:r,fragment:i}=t;r.include(Bc),r.uniforms.add(new zh("componentColorTex",n=>n.componentParameters.texture.texture)),t.attributes.add(C.COMPONENTINDEX,"float"),t.varyings.add("vExternalColorMixMode","mediump float"),t.varyings.add("vExternalColor","vec4");const s=e.output===F.ObjectAndLayerIdColor;s&&t.varyings.add("vObjectAndLayerIdColor","vec4"),t.include(H3e),r.constants.add("elevationScale","float",2*$ee),r.constants.add("stride","float",ae("enable-feature:objectAndLayerId-rendering")?3:2),r.code.add(w`vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
float index = componentIndex * stride + typeOffset;
float texSize = float(textureSize(componentColorTex, 0).x);
float coordX = mod(index, texSize);
float coordY = floor(index / texSize);
return vec2(coordX, coordY) + 0.5;
}`),r.code.add(w`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${s?w`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
          }`:w`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),i.code.add(w`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${s?w`fragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function ivt(t){const{vertex:e,fragment:r}=t;e.uniforms.add(new zF("externalColor",i=>i.componentParameters.externalColor)),r.uniforms.add(new evt("externalColorMixMode",i=>i.componentParameters.externalColorMixMode)),t.varyings.add("vExternalColor","vec4"),e.code.add(w`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`),r.code.add(w`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}
void outputObjectAndLayerIdColor() {
fragColor = vec4(1.0,0.0,0.0,0.0);
}`)}var Dh;function svt(t,e){const r=t.vertex;switch(r.code.add(w`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),e.vertexDiscardMode){case Dh.None:r.code.add(w`#define vertexDiscardByOpacity(_opacity_) {}`);break;case Dh.Opaque:r.code.add(w`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case Dh.Transparent:r.code.add(w`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}}(function(t){t[t.None=0]="None",t[t.Transparent=1]="Transparent",t[t.Opaque=2]="Opaque",t[t.COUNT=3]="COUNT"})(Dh||(Dh={}));var um;function xqt(t){return t&&Om(t)?um.Mars:t&&Rm(t)?um.Moon:um.Earth}(function(t){t[t.Earth=1]="Earth",t[t.Mars=2]="Mars",t[t.Moon=3]="Moon",t[t.COUNT=4]="COUNT"})(um||(um={}));var yu;(function(t){t[t.None=0]="None",t[t.NoOverlay=1]="NoOverlay",t[t.ColorOverlay=2]="ColorOverlay",t[t.ColorOverlayWithWater=3]="ColorOverlayWithWater",t[t.COUNT=4]="COUNT"})(yu||(yu={}));let pr=class extends Sa{constructor(){super(...arguments),this.output=F.Color,this.textureCoordinateType=Fs.None,this.componentData=cm.Uniform,this.cullFace=gi.Back,this.vertexDiscardMode=Dh.None,this.doubleSidedMode=ts.WindingOrder,this.alphaDiscardMode=Kr.Opaque,this.integratedMeshMode=yu.None,this.transparencyPassType=dt.NONE,this.ellipsoidMode=um.Earth,this.pbrMode=ut.Disabled,this.normalType=Ir.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasBaseColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.hasCloudsReflections=!0,this.snowCover=!1,this.objectAndLayerIdColor=!1}};u([B({count:F.COUNT})],pr.prototype,"output",void 0),u([B({count:Fs.COUNT})],pr.prototype,"textureCoordinateType",void 0),u([B({count:cm.COUNT})],pr.prototype,"componentData",void 0),u([B({count:gi.COUNT})],pr.prototype,"cullFace",void 0),u([B({count:Dh.COUNT})],pr.prototype,"vertexDiscardMode",void 0),u([B({count:ts.COUNT})],pr.prototype,"doubleSidedMode",void 0),u([B({count:Kr.COUNT})],pr.prototype,"alphaDiscardMode",void 0),u([B({count:yu.COUNT})],pr.prototype,"integratedMeshMode",void 0),u([B({count:dt.COUNT})],pr.prototype,"transparencyPassType",void 0),u([B({count:um.COUNT})],pr.prototype,"ellipsoidMode",void 0),u([B({count:ut.COUNT})],pr.prototype,"pbrMode",void 0),u([B({count:Ir.COUNT})],pr.prototype,"normalType",void 0),u([B()],pr.prototype,"spherical",void 0),u([B()],pr.prototype,"doublePrecisionRequiresObfuscation",void 0),u([B()],pr.prototype,"hasVertexColors",void 0),u([B()],pr.prototype,"hasNormals",void 0),u([B()],pr.prototype,"hasSlicePlane",void 0),u([B()],pr.prototype,"hasBaseColorTexture",void 0),u([B()],pr.prototype,"receiveAmbientOcclusion",void 0),u([B()],pr.prototype,"receiveShadows",void 0),u([B()],pr.prototype,"blendingEnabled",void 0),u([B()],pr.prototype,"hasScreenSpaceReflections",void 0),u([B()],pr.prototype,"hasPolygonOffset",void 0),u([B()],pr.prototype,"hasMetallicRoughnessTexture",void 0),u([B()],pr.prototype,"hasEmissionTexture",void 0),u([B()],pr.prototype,"hasOcclusionTexture",void 0),u([B()],pr.prototype,"hasNormalTexture",void 0),u([B()],pr.prototype,"hasOccludees",void 0),u([B()],pr.prototype,"hasMultipassTerrain",void 0),u([B()],pr.prototype,"cullAboveGround",void 0),u([B()],pr.prototype,"hasCloudsReflections",void 0),u([B()],pr.prototype,"snowCover",void 0),u([B()],pr.prototype,"objectAndLayerIdColor",void 0),u([B({constValue:ti.Draw})],pr.prototype,"pbrTextureBindType",void 0),u([B({constValue:!0})],pr.prototype,"hasSliceHighlight",void 0),u([B({constValue:!1})],pr.prototype,"hasSliceInVertexProgram",void 0),u([B({constValue:!1})],pr.prototype,"useCustomDTRExponentForWater",void 0),u([B({constValue:!1})],pr.prototype,"hasVertexTangents",void 0),u([B({constValue:!0})],pr.prototype,"supportsTextureAtlas",void 0),u([B({constValue:!1})],pr.prototype,"highStepCount",void 0),u([B({constValue:!1})],pr.prototype,"instancedDoublePrecision",void 0),u([B({constValue:!0})],pr.prototype,"useFillLights",void 0),u([B({constValue:!1})],pr.prototype,"objectAndLayerIdColorInstanced",void 0);function dde(t,e){t.include(Ux,e),t.fragment.include(zM);const r=t.fragment;r.uniforms.add(new zF("baseColor",i=>i.baseColor)),r.uniforms.add(new Tw("objectOpacity",i=>i.objectOpacity)),e.hasVertexColors?r.code.add(w`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):r.code.add(w`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),r.code.add(w`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function pde(t,e){const r=t.fragment;switch(e.doubleSidedMode){case ts.None:r.code.add(w`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case ts.View:t.include(NS,e),r.code.add(w`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case ts.WindingOrder:r.code.add(w`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:e.doubleSidedMode;case ts.COUNT:}switch(e.normalType){case Ir.Attribute:case Ir.Compressed:t.include(A9,e),r.code.add(w`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case Ir.ScreenDerivative:t.include(NS,e),r.code.add(w`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case Ir.Ground:e.spherical?(t.include(NS,e),r.code.add(w`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):r.code.add(w`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),r.code.add(w`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:e.normalType;case Ir.COUNT:}}function nvt(t,e){const r=t.fragment;if(e.hasBaseColorTexture&&(e.output===F.Color||e.alphaDiscardMode!==Kr.Opaque)){t.include(JJ,e);const i=e.textureCoordinateType===Fs.Atlas;r.uniforms.add(new zh("baseColorTexture",s=>s.texture)),i?(t.include(Vxe),r.code.add(w`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, vuv0, vuvRegion);
}`)):r.code.add(w`vec4 readBaseColorTexture() {
return texture(baseColorTexture, vuv0);
}`)}else r.code.add(w`vec4 readBaseColorTexture() { return vec4(1.0); }`)}function ovt(t){const e=new Sr;e.include(NS,t),e.include(A9,t),e.include(Ux,t),e.include(sm,t),e.include($C,t),e.include(tvt,t),e.include(gat,t),e.include(Gtt,t),e.include(nvt,t),e.include(svt,t);const{vertex:r,fragment:i}=e;t.pbrMode!==ut.Normal&&t.pbrMode!==ut.Schematic||(e.include(KJ,t),t.hasNormalTexture&&e.include(Y3e,t));const s=t.output===F.Shadow||t.output===F.ShadowHighlight||t.output===F.ShadowExcludeHighlight;s&&t.componentData===cm.Varying?r.code.add(w`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):r.code.add(w`#define discardShadows(castShadows) {}`);const n=t.integratedMeshMode===yu.ColorOverlay||t.integratedMeshMode===yu.ColorOverlayWithWater,o=n&&t.output===F.Color&&t.pbrMode===ut.WaterOnIntegratedMesh;return n&&(e.include(sx,t),e.include(S0t,t),t.spherical?r.code.add(w`
      const float invEllipsoidRadius = ${w.float(1/(t.ellipsoidMode===um.Earth?nr.radius:t.ellipsoidMode===um.Mars?Kf.radius:f0.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):r.code.add(w`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),o&&(e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),e.varyings.add("groundNormal","vec3")),r.code.add(w`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      ${t.output===F.ObjectAndLayerIdColor?w`externalColor.a = 1.0;`:""}

      if (externalColor.a < ${w.float(bo)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${t.output===F.ObjectAndLayerIdColor?w`forwardObjectAndLayerIdColor();`:""}
      ${o?t.spherical?w`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:w`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${n?w`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),t.output===F.Alpha&&(i.include(Nu),e.include(Fu,t),e.include(dde,t),n&&i.uniforms.add(new rt("ovColorTex",(a,l)=>Qq(a,l))),i.code.add(w`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.hasMultipassTerrain?w`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${n?w`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        fragColor = vec4(materialColor.a);
      }
    `)),t.output===F.Color&&(i.include(Nu),e.include(Fu,t),e.include(dde,t),e.include(pde,t),e.include(sx,t),t.receiveShadows?(e.include(O9,t),i.code.add(w`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):i.code.add(w`float evaluateShadow() { return 0.0; }`),n&&i.uniforms.add(new rt("ovColorTex",(a,l)=>Qq(a,l))),i.code.add(w`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.hasMultipassTerrain?w`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${n?w`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),t.pbrMode===ut.Normal||t.pbrMode===ut.Schematic?($m(i),i.code.add(w`
        ${t.pbrMode===ut.Normal?w`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),t.hasNormalTexture?i.code.add(w`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):i.code.add(w`vec3 shadingNormal = normalVertex;`),i.code.add(w`${t.spherical?w`vec3 normalGround = normalize(positionWorld());`:w`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),i.code.add(w`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());

        ${t.snowCover?w`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${n?w` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(t.receiveShadows?i.code.add(w`float shadow = evaluateShadow();`):t.spherical?(BC(i),i.code.add(w`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):i.code.add(w`float shadow = 0.0;`),o&&i.uniforms.add(new rt("ovNormalTex",(a,l)=>Lee(l))),t.snowCover&&i.code.add(w`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`),i.code.add(w`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${n?w` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${o?w`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),i.code.add(w`
        fragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${t.transparencyPassType===dt.Color?"fragColor = premultiplyAlpha(fragColor);":""}
      }
    `)),(t.output===F.Depth||s)&&(e.include(C0,t),i.code.add(w`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),t.output===F.Normal&&(e.include(pde,t),i.code.add(w`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${t.normalType===Ir.Ground?"0.0":"1.0"};
        fragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),t.output===F.ObjectAndLayerIdColor&&e.fragment.code.add(w`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${n?w`fragColor = getOverlayColorTexel(vtcOverlay);`:"outputObjectAndLayerIdColor();"}
      }
    `),t.output===F.Highlight&&(e.include(z0,t),i.code.add(w`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${n?w`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  fragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),e}function Lee(t){return t.overlays.length===0?null:t.overlays[Di.INNER].getValidTexture(as.Water)}const avt=Object.freeze(Object.defineProperty({__proto__:null,build:ovt,getOverlayNormalTexture:Lee},Symbol.toStringTag,{value:"Module"}));let sMe=class nMe extends Lr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Ve.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Rr(e.rctx,nMe.shader.get().build(this.configuration),oMe)}_setPipelineState(e){const r=this.configuration,i=r.integratedMeshMode!==yu.None,s=e===dt.NONE,n=e===dt.FrontFace;return Mt({blending:r.output!==F.Color&&r.output!==F.Alpha||!r.blendingEnabled?null:s?Ru:V0(e),culling:U8(r.cullFace),depthTest:{func:Uv(e)},depthWrite:s||n?jl:null,colorWrite:Bt,stencilWrite:i||r.hasOccludees?Tm:null,stencilTest:i?Wnt(Ul.IntegratedMeshMaskExcluded):r.hasOccludees?kv:null,polygonOffset:s||n?r.hasPolygonOffset?{factor:2,units:2}:null:f9})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};sMe.shader=new Or(avt,()=>he(()=>import("./ComponentShader.glsl-bab3abaa.js"),[],import.meta.url));const oMe=new Map([[C.POSITION,0],[C.NORMAL,1],[C.NORMALCOMPRESSED,1],[C.COLOR,2],[C.UV0,3],[C.UVREGION,4],[C.COMPONENTINDEX,5]]);let lvt=class extends ii{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const e of this._parameterBlocks)this[e]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const e of this._parameterBlocks)if(this[e].dirty)return!0;return!1}},Dee=class{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}};function ns(t={}){return(e,r)=>{const i=e._parameterCount??0;if(e._parameterCount=i+1,t.vectorOps){const s=t.vectorOps;Object.defineProperty(e,r,{get(){return this[i]},set(n){const o=this[i];if(o==null)this[i]=n;else{if(s.equals(o,n))return;s.copy(o,n)}this._setDirty()}})}else Object.defineProperty(e,r,{get(){return this[i]},set(s){this[i]!==s&&(t.dispose&&this[i]&&this[i].dispose(),this[i]=s,this._setDirty())}})}}function fde(){return(t,e)=>{const r=t._parameterCount??0;t._parameterCount=r+1,t._parameterBlocks=t._parameterBlocks||[],t._parameterBlocks.push(r),Object.defineProperty(t,e,{get(){return this[r]},set(i){this[r]!==i&&(this[r]=i,this._setDirty())}})}}let Y9=class{constructor(e){this._low=O(),this._high=O(),e&&this.set(e)}get low(){return this._low}get high(){return this._high}set(e){ie(this._low,ie(mde,e));const r=Pn(mde,e,this._low);ie(this._high,r)}get(e){return de(e,this._low,this._high)}getLowScaled(e){return se(e,this._low,1)}};const mde=ls();let Gn=class extends lvt{constructor(e,r){super(),this.toMapSpace=r,this.baseColor=Nt(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=Qa(M9),this.emissiveFactor=Pe(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new e4,this.componentParameters=new qR,this.textureAlphaCutoff=gF,this.alphaDiscardMode=Kr.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=um.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new pr;const i=new Y9(e.position),s=Z3e(e.rotationScale);$x(s,s),this.transformNormalGlobalFromModel=ybe(Qh(s,s)),this.transformWorldFromModelTL=i.low,this.transformWorldFromModelTH=i.high,this.transformWorldFromModelRS=e.rotationScale}dispose(){this._technique=Gi(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return this.baseColorTexture!=null?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return this.metallicRoughnessTexture!=null?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return this.emissionTexture!=null?this.emissionTexture.glTexture:null}get textureOcclusion(){return this.occlusionTexture!=null?this.occlusionTexture.glTexture:null}get textureNormal(){return this.normalTexture!=null?this.normalTexture.glTexture:null}prepareTechnique(e,r,i,s){const n=this._techniqueConfiguration;n.hasVertexColors=s.colors,n.hasNormals=s.normals,n.textureCoordinateType=s.textureCoordinates,n.hasMetallicRoughnessTexture=this.metallicRoughnessTexture!=null,n.hasEmissionTexture=this.emissionTexture!=null,n.hasOcclusionTexture=this.occlusionTexture!=null,n.hasNormalTexture=this.normalTexture!=null,n.transparencyPassType=r.identifier===Ec.Material&&i.transparencyPassType!=null?i.transparencyPassType:dt.NONE,n.hasMultipassTerrain=r.identifier===Ec.Material&&i.multipassTerrain!=null&&i.multipassTerrain.enabled,n.cullAboveGround=r.identifier===Ec.Material&&i.multipassTerrain!=null&&i.multipassTerrain.cullAboveGround,n.ellipsoidMode=this.ellipsoidMode,n.componentData=this.componentParameters.type,n.cullFace=this.commonMaterialParameters.cullFace,n.doubleSidedMode=this.commonMaterialParameters.doubleSided?ts.View:ts.None,n.hasBaseColorTexture=this.baseColorTexture!=null;const o=this._computeWhichMaterialPass();n.blendingEnabled=o===qa.Transparent||o===qa.OpaqueAndTransparent,n.alphaDiscardMode=this.alphaDiscardMode,n.integratedMeshMode=this.isIntegratedMesh?uvt(i)?Lee(i)?yu.ColorOverlayWithWater:yu.ColorOverlay:yu.NoOverlay:yu.None,n.hasPolygonOffset=this.polygonOffsetEnabled;const a=this.hasParametersFromSource&&this.baseColorTexture==null;if(n.pbrMode=n.integratedMeshMode===yu.ColorOverlayWithWater?ut.WaterOnIntegratedMesh:this.usePBR?a?ut.Schematic:ut.Normal:ut.Disabled,n.normalType=n.integratedMeshMode===yu.None?n.hasNormals?Ir.Compressed:Ir.ScreenDerivative:Ir.Ground,n.hasSlicePlane=i.slicePlane!=null&&this.commonMaterialParameters.hasSlicePlane,r.identifier===Ec.ShadowMap)n.output=F.Shadow,n.vertexDiscardMode=Dh.None;else if(r.identifier===Ec.Highlight)n.output=F.Highlight,n.vertexDiscardMode=Dh.None;else{switch(this._computeWhichMaterialPass()===qa.OpaqueAndTransparent?n.vertexDiscardMode=r.transparent?Dh.Opaque:Dh.Transparent:n.vertexDiscardMode=Dh.None,n.output=r.output,n.receiveAmbientOcclusion=!1,n.receiveShadows=!1,r.output){case F.Color:n.receiveAmbientOcclusion=i.ssaoHelper.active,n.hasOccludees=i.hasOccludees,n.receiveShadows=i.shadowMap.ready,n.hasScreenSpaceReflections=i.ssr.enabled,n.hasCloudsReflections=i.cloudsFade.data!=null;break;case F.Alpha:n.hasOccludees=i.hasOccludees;break;case F.ObjectAndLayerIdColor:n.objectAndLayerIdColor=!0}n.snowCover=this.hasSnowCover(i)}return this._technique=e.releaseAndAcquire(sMe,n,this._technique),this._setClean(),this._technique}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}submit(e,r,i){if(this.objectOpacity===0)return;const s=i.renderable.geometry,n=i.components,o=i.renderable.meta.cameraDepthSquared,a=n.geometryRanges,l=n.highlightRanges,c=n.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case qa.Opaque:e.materialOpaque.submitDraw(this,s,a,o);break;case qa.Transparent:e.materialTransparent.submitDraw(this,s,a,o);break;case qa.OpaqueAndTransparent:e.materialOpaque.submitDraw(this,s,a,o),e.materialTransparent.submitDraw(this,s,a,o);break;case qa.IntegratedMesh:e.materialIntegratedMesh.submitDraw(this,s,a,o),cvt(r)&&e.highlightIntegratedMesh.submitDraw(this,s,a,o)}const h=this.componentParameters.castShadows!==Rn.None;h&&e.shadowMap.submitDraw(this,s,a,o),l!=null&&(e.highlight.submitDraw(this,s,l,o),h&&e.highlightShadowMap.submitDraw(this,s,l,o)),h&&c!=null&&e.defaultShadowMap.submitDraw(this,s,c,o)}_computeWhichMaterialPass(){return this.isIntegratedMesh?qa.IntegratedMesh:this.objectOpacity<1?qa.Transparent:this.componentParameters.opaqueOverride===Rn.All?qa.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===Kr.Blend||this.alphaDiscardMode===Kr.MaskBlend?qa.Transparent:this.componentParameters.transparent===Rn.None?qa.Opaque:this.componentParameters.transparent===Rn.All?qa.Transparent:qa.OpaqueAndTransparent}};var qa,Rn;u([ns({vectorOps:Dye})],Gn.prototype,"baseColor",void 0),u([ns()],Gn.prototype,"usePBR",void 0),u([ns()],Gn.prototype,"hasParametersFromSource",void 0),u([ns({vectorOps:Bre})],Gn.prototype,"mrrFactors",void 0),u([ns({vectorOps:Bre})],Gn.prototype,"emissiveFactor",void 0),u([ns({dispose:!0})],Gn.prototype,"baseColorTexture",void 0),u([ns({dispose:!0})],Gn.prototype,"metallicRoughnessTexture",void 0),u([ns({dispose:!0})],Gn.prototype,"emissionTexture",void 0),u([ns({dispose:!0})],Gn.prototype,"occlusionTexture",void 0),u([ns({dispose:!0})],Gn.prototype,"normalTexture",void 0),u([ns()],Gn.prototype,"objectOpacity",void 0),u([fde()],Gn.prototype,"commonMaterialParameters",void 0),u([fde()],Gn.prototype,"componentParameters",void 0),u([ns()],Gn.prototype,"textureAlphaCutoff",void 0),u([ns()],Gn.prototype,"alphaDiscardMode",void 0),u([ns()],Gn.prototype,"isIntegratedMesh",void 0),u([ns()],Gn.prototype,"polygonOffsetEnabled",void 0),u([ns()],Gn.prototype,"ellipsoidMode",void 0),u([ns()],Gn.prototype,"hasOccludees",void 0),function(t){t[t.Opaque=0]="Opaque",t[t.Transparent=1]="Transparent",t[t.OpaqueAndTransparent=2]="OpaqueAndTransparent",t[t.IntegratedMesh=3]="IntegratedMesh"}(qa||(qa={}));let e4=class extends Dee{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=gi.Back,this.hasSlicePlane=!0}};u([ns()],e4.prototype,"doubleSided",void 0),u([ns()],e4.prototype,"cullFace",void 0),u([ns()],e4.prototype,"hasSlicePlane",void 0);let qR=class extends Dee{constructor(){super(...arguments),this.externalColor=Nt(1,1,1,1),this.externalColorMixMode=Hs.Multiply,this.castShadows=Rn.All}get transparent(){return this.externalColor[3]<1?Rn.All:Rn.None}get opaqueOverride(){return this.externalColorMixMode===Hs.Replace&&this.externalColor[3]===1?Rn.All:Rn.None}get visible(){return this.externalColor[3]>0?Rn.All:Rn.None}get type(){return cm.Uniform}};u([ns({vectorOps:Dye})],qR.prototype,"externalColor",void 0),u([ns()],qR.prototype,"externalColorMixMode",void 0),u([ns()],qR.prototype,"castShadows",void 0),function(t){t[t.All=0]="All",t[t.Some=1]="Some",t[t.None=2]="None"}(Rn||(Rn={}));let OO=class extends Dee{constructor(){super(...arguments),this.texture=null,this.transparent=Rn.None,this.opaqueOverride=Rn.None,this.castShadows=Rn.None}get type(){return cm.Varying}};function cvt(t){return t.overlays.length!==0&&t.overlays[Di.INNER].getValidTexture(as.Highlight)!=null}function uvt(t){return t.overlays.length!==0&&t.overlays[Di.INNER].getColorTextureNoRasterImage()!=null}u([ns()],OO.prototype,"texture",void 0),u([ns()],OO.prototype,"transparent",void 0),u([ns()],OO.prototype,"opaqueOverride",void 0),u([ns()],OO.prototype,"castShadows",void 0);const HF=qi().vec3f(C.POSITION).u16(C.COMPONENTINDEX).u16(C.U16PADDING),aMe=qi().vec2u8(C.SIDENESS),hvt=Gc(aMe),lMe=qi().vec3f(C.POSITION0).vec3f(C.POSITION1).u16(C.COMPONENTINDEX).u8(C.VARIANTOFFSET,{glNormalized:!0}).u8(C.VARIANTSTROKE).u8(C.VARIANTEXTENSION,{glNormalized:!0}).u8(C.U8PADDING,{glPadding:!0}).u16(C.U16PADDING,{glPadding:!0}),pW=lMe.clone().vec3f(C.NORMAL),fW=lMe.clone().vec3f(C.NORMALA).vec3f(C.NORMALB),cMe=new Map([[C.POSITION0,0],[C.POSITION1,1],[C.COMPONENTINDEX,2],[C.VARIANTOFFSET,3],[C.VARIANTSTROKE,4],[C.VARIANTEXTENSION,5],[C.NORMAL,6],[C.NORMALA,6],[C.NORMALB,7],[C.SIDENESS,8]]);function gde(t,e,r){const i=e/3,s=new Uint32Array(r+1),n=new Uint32Array(r+1),o=(b,T)=>{b<T?s[b+1]++:n[T+1]++};for(let b=0;b<i;b++){const T=t[3*b],x=t[3*b+1],S=t[3*b+2];o(T,x),o(x,S),o(S,T)}let a=0,l=0;for(let b=0;b<r;b++){const T=s[b+1],x=n[b+1];s[b+1]=a,n[b+1]=l,a+=T,l+=x}const c=new Uint32Array(6*i),h=s[r],d=(b,T,x)=>{if(b<T){const S=s[b+1]++;c[2*S]=T,c[2*S+1]=x}else{const S=n[T+1]++;c[2*h+2*S]=b,c[2*h+2*S+1]=x}};for(let b=0;b<i;b++){const T=t[3*b],x=t[3*b+1],S=t[3*b+2];d(T,x,b),d(x,S,b),d(S,T,b)}const f=(b,T)=>{const x=2*b,S=T-b;for(let E=1;E<S;E++){const A=c[x+2*E],R=c[x+2*E+1];let M=E-1;for(;M>=0&&c[x+2*M]>A;M--)c[x+2*M+2]=c[x+2*M],c[x+2*M+3]=c[x+2*M+1];c[x+2*M+2]=A,c[x+2*M+3]=R}};for(let b=0;b<r;b++)f(s[b],s[b+1]),f(h+n[b],h+n[b+1]);const m=new Int32Array(3*i),g=(b,T)=>b===t[3*T]?0:b===t[3*T+1]?1:b===t[3*T+2]?2:-1,_=(b,T)=>{const x=g(b,T);m[3*T+x]=-1},v=(b,T,x,S)=>{const E=g(b,T);m[3*T+E]=S;const A=g(x,S);m[3*S+A]=T};for(let b=0;b<r;b++){let T=s[b];const x=s[b+1];let S=n[b];const E=n[b+1];for(;T<x&&S<E;){const A=c[2*T],R=c[2*h+2*S];A===R?(v(b,c[2*T+1],R,c[2*h+2*S+1]),T++,S++):A<R?(_(b,c[2*T+1]),T++):(_(R,c[2*h+2*S+1]),S++)}for(;T<x;)_(b,c[2*T+1]),T++;for(;S<E;)_(c[2*h+2*S],c[2*h+2*S+1]),S++}return m}let uMe=class{updateSettings(e){this.settings=e,this._edgeHashFunction=e.reducedPrecision?pvt:dvt}write(e,r,i){const s=this._edgeHashFunction(i);HL.seed=s;const n=HL.getIntRange(0,255),o=HL.getIntRange(0,this.settings.variants-1),a=.7,l=HL.getFloat(),c=255*(.5*fvt(-(1-Math.min(l/a,1))+Math.max(0,l-a)/(1-a),1.2)+.5);e.position0.setVec(r,i.position0),e.position1.setVec(r,i.position1),e.componentIndex.set(r,i.componentIndex),e.variantOffset.set(r,n),e.variantStroke.set(r,o),e.variantExtension.set(r,c)}trim(e,r){return e.slice(0,r)}};const Nee=new Float32Array(6),qF=new Uint32Array(Nee.buffer),q_=new Uint32Array(1);function dvt(t){const e=Nee;e[0]=t.position0[0],e[1]=t.position0[1],e[2]=t.position0[2],e[3]=t.position1[0],e[4]=t.position1[1],e[5]=t.position1[2],q_[0]=5381;for(let r=0;r<qF.length;r++)q_[0]=31*q_[0]+qF[r];return q_[0]}function pvt(t){const e=Nee;e[0]=qT(t.position0[0]),e[1]=qT(t.position0[1]),e[2]=qT(t.position0[2]),e[3]=qT(t.position1[0]),e[4]=qT(t.position1[1]),e[5]=qT(t.position1[2]),q_[0]=5381;for(let r=0;r<qF.length;r++)q_[0]=31*q_[0]+qF[r];return q_[0]}const yde=1e4;function qT(t){return Math.round(t*yde)/yde}function fvt(t,e){const r=t<0?-1:1;return Math.abs(t)**e*r}let WF=class{constructor(){this._commonWriter=new uMe}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return pW.createBuffer(e)}write(e,r,i){this._commonWriter.write(e,r,i),de(jL,i.faceNormal0,i.faceNormal1),_e(jL,jL),e.normal.setVec(r,jL)}trim(e,r){return this._commonWriter.trim(e,r)}};WF.Layout=pW,WF.glLayout=Gc(pW,1);let XF=class{constructor(){this._commonWriter=new uMe}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return fW.createBuffer(e)}write(e,r,i){this._commonWriter.write(e,r,i),e.normalA.setVec(r,i.faceNormal0),e.normalB.setVec(r,i.faceNormal1)}trim(e,r){return this._commonWriter.trim(e,r)}};XF.Layout=fW,XF.glLayout=Gc(fW,1);const jL=O(),HL=new tR,gb=-1;var YF;function mvt(t,e,r,i=wvt){const s=t.vertices.position,n=t.vertices.componentIndex,o=Ft(i.anglePlanar),a=Ft(i.angleSignificantEdge),l=Math.cos(a),c=Math.cos(o),h=mW.edge,d=h.position0,f=h.position1,m=h.faceNormal0,g=h.faceNormal1,_=bvt(t),v=vvt(t),b=v.length/4,T=e.allocate(b);let x=0;const S=b,E=r.allocate(S);let A=0,R=0,M=0;const D=MDe(0,b),k=new Float32Array(b);k.forEach((G,J,I)=>{s.getVec(v[4*J],d),s.getVec(v[4*J+1],f),I[J]=mi(d,f)}),D.sort((G,J)=>k[J]-k[G]);const L=new Array,N=new Array;for(let G=0;G<b;G++){const J=D[G],I=k[J],z=v[4*J],V=v[4*J+1],j=v[4*J+2],Y=v[4*J+3],Q=Y===gb;if(s.getVec(z,d),s.getVec(V,f),Q)ne(m,_[3*j],_[3*j+1],_[3*j+2]),ie(g,m),h.componentIndex=n.get(z),h.cosAngle=ye(m,g);else{if(ne(m,_[3*j],_[3*j+1],_[3*j+2]),ne(g,_[3*Y],_[3*Y+1],_[3*Y+2]),h.componentIndex=n.get(z),h.cosAngle=ye(m,g),yvt(h,c))continue;h.cosAngle<-.9999&&ie(g,m)}R+=I,M++,Q||gvt(h,l)?(e.write(T,x++,h),L.push(I)):_vt(h,o)&&(r.write(E,A++,h),N.push(I))}const q=new Float32Array(L.reverse()),X=new Float32Array(N.reverse());return{regular:{instancesData:e.trim(T,x),lodInfo:{lengths:q}},silhouette:{instancesData:r.trim(E,A),lodInfo:{lengths:X}},averageEdgeLength:R/M}}function gvt(t,e){return t.cosAngle<e}function yvt(t,e){return t.cosAngle>e}function _vt(t,e){const r=Dn(t.cosAngle),i=mW.fwd,s=mW.ortho;return O0(i,t.position1,t.position0),r*(ye(pt(s,t.faceNormal0,t.faceNormal1),i)>0?-1:1)>e}function vvt(t){const e=t.faces.length/3,r=t.faces,i=t.neighbors;let s=0;for(let a=0;a<e;a++){const l=i[3*a],c=i[3*a+1],h=i[3*a+2],d=r[3*a],f=r[3*a+1],m=r[3*a+2];s+=l===gb||d<f?1:0,s+=c===gb||f<m?1:0,s+=h===gb||m<d?1:0}const n=new Int32Array(4*s);let o=0;for(let a=0;a<e;a++){const l=i[3*a],c=i[3*a+1],h=i[3*a+2],d=r[3*a],f=r[3*a+1],m=r[3*a+2];(l===gb||d<f)&&(n[o++]=d,n[o++]=f,n[o++]=a,n[o++]=l),(c===gb||f<m)&&(n[o++]=f,n[o++]=m,n[o++]=a,n[o++]=c),(h===gb||m<d)&&(n[o++]=m,n[o++]=d,n[o++]=a,n[o++]=h)}return n}function bvt(t){const e=t.faces.length/3,r=t.vertices.position,i=t.faces,s=AV.v0,n=AV.v1,o=AV.v2,a=new Float32Array(3*e);for(let l=0;l<e;l++){const c=i[3*l],h=i[3*l+1],d=i[3*l+2];r.getVec(c,s),r.getVec(h,n),r.getVec(d,o),fe(n,n,s),fe(o,o,s),pt(s,n,o),_e(s,s),a[3*l]=s[0],a[3*l+1]=s[1],a[3*l+2]=s[2]}return a}(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH"})(YF||(YF={}));const mW={edge:{position0:O(),position1:O(),faceNormal0:O(),faceNormal1:O(),componentIndex:0,cosAngle:0},ortho:O(),fwd:O()},AV={v0:O(),v1:O(),v2:O()},wvt={anglePlanar:4,angleSignificantEdge:35};function xvt(t){const e=Tvt(t.data,t.skipDeduplicate,t.indices,t.indicesLength);return _de.updateSettings(t.writerSettings),vde.updateSettings(t.writerSettings),mvt(e,_de,vde)}function Tvt(t,e,r,i){if(e){const o=gde(r,i,t.count);return new Svt(r,i,o,t)}const s=xq(t.buffer,t.stride/4,{originalIndices:r,originalIndicesLength:i}),n=gde(s.indices,i,s.uniqueCount);return{faces:s.indices,facesLength:s.indices.length,neighbors:n,vertices:HF.createView(s.buffer)}}let Svt=class{constructor(e,r,i,s){this.faces=e,this.facesLength=r,this.neighbors=i,this.vertices=s}};const _de=new WF,vde=new XF,Dqt=qi().vec3f(C.POSITION0).vec3f(C.POSITION1),Evt=qi().vec3f(C.POSITION0).vec3f(C.POSITION1).u16(C.COMPONENTINDEX).u16(C.U16PADDING,{glPadding:!0});let Cvt=class{constructor(e){this._maxCount=e,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(e){this._recycledIndices.push(e)}},Avt=class{constructor(e,r=1){this._rctx=e,this._fieldCount=r,this.textureWidth=4096,this._dirty=!0;const i=new xr;i.samplingMode=Rt.NEAREST,i.wrapMode=Dt.CLAMP_TO_EDGE,i.width=this.textureWidth,i.height=1,this._texture=new Ot(this._rctx,i),this._data=new wa(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(e,r,i,s,n,o){const a=e*this._fieldCount+r;this._dirty=!0,this._data.set(a,0,i),this._data.set(a,1,s),this._data.set(a,2,n),this._data.set(a,3,o)}setDataElement(e,r,i,s){const n=e*this._fieldCount+r;this._dirty=!0,this._data.set(n,i,s)}getDataElement(e,r,i){const s=e*this._fieldCount+r;return this._dirty=!0,this._data.get(s,i)}resizeToFit(e){const r=(e+1)*this._fieldCount;if(r>this._data.count){const i=Math.ceil(r/this.textureWidth)*this.textureWidth,s=new wa(new ArrayBuffer(4*i));s.typedBuffer.set(this._data.typedBuffer),this._data=s}}updateTexture(){if(!this._dirty)return;const e=this._texture.descriptor.width,r=this._texture.descriptor.height;this._data.count>e*r&&this._texture.resize(e,this._data.count/e),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}};const hMe=65536;let Ovt=class{constructor(e,r=1){this.textureBuffer=new Avt(e,r),this._indexManager=new Cvt(hMe)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const e=this._indexManager.acquire();return this.textureBuffer.resizeToFit(e),e}releaseIndex(e){this._indexManager.release(e)}},dMe=class{constructor(e,r=1){this._rctx=e,this._fieldCount=r,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(e=>e.activeCount!==0||(e.dispose(),!1))}destroy(){this._buffers.forEach(e=>e.dispose()),this._buffers=[]}getBuffer(e){for(const i of this._buffers)if(i.availableCount>=e)return i;if(e>hMe)return null;const r=new Ovt(this._rctx,this._fieldCount);return this._buffers.push(r),r}updateTextures(){for(const e of this._buffers)e.textureBuffer.updateTexture()}};const bde=K.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");let Rvt=class{constructor(e,r){this._renderManager=e,this._viewingMode=r,this._objects=[new Vt,new Vt],this._renderSubmit=new J_t(this),this._renderManager.register(this._renderSubmit),this._hasObjectAndLayerId=ae("enable-feature:objectAndLayerId-rendering"),this._componentBufferManager=new dMe(e.rctx,2+(this._hasObjectAndLayerId?1:0))}destroy(){ot(this._objects[JS.Hidden].length===0&&this._objects[JS.Visible].length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy();const e=this._objects.flatMap(r=>r.toArray());for(const r of e)r?.destroy()}createObject(e){const r=new AO;return r.toMapSpace=e.toMapSpace,r.transform=e.transform,r.obb=ode(e.obb),r.components=new P_t(this._componentBufferManager,om(e.geometry.componentOffsets)),r.renderable=this._createRenderable(e,r.components),r.intersectionGeometry=new U_t(e.geometry.positionData,r.components),this._objects[r.visible].push(r),r}destroyObject(e){const r=e;this._objects[r.visible].removeUnordered(r),r.destroy(),this._notifyDirty()}setObjectVisibility(e,r){const i=e;r!==i.visible&&(this._objects[i.visible].removeUnordered(i),this._objects[r].push(i),i.visible=r,this._notifyDirty())}preSubmit(e){const r=e.camera.eye;this.visibleObjects.forAll(i=>i.renderable.meta.cameraDepthSquared=xo(r,i.obb.center))}getMaterial(e){return e.renderable.material}updateMaterial(e,r){const i=e.renderable.material;r(i),i.dirty&&this._notifyDirty()}setAllComponentVisibilities(e,r){const i=e;i.components.visibility.reset(r),i.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(e,r){return e.components.visibility.forEachComponent(r)}getComponentCount(e){const r=e,i=r.components.visibility.componentCount();return{visible:i,invisible:r.components.count-i}}setComponentData(e,r){const i=e,s=i.renderable.material,n=i.components,o=n.materialDataBuffer,a=n.materialDataIndices,l=new K_t,c=o.textureBuffer,h=new Uint8Array(4),d=new Uint32Array(h.buffer);let f=0,m=0,g=0,_=n.verticalOffsets,v=1/0,b=-1/0,T=!1,x=!1,S=0;for(let E=0;E<n.count;E++){r(E,l),f+=+(l.externalColor[3]<1),m+=+(l.externalColorMixMode===Hs.Replace&&l.externalColor[3]===1),g+=+l.castShadows,j3e(l.externalColor,l.externalColorMixMode,h),h[2]=254&h[2]|+l.castShadows,c.setData(a[E],0,h[0],h[1],h[2],h[3]),T||(T=E>0&&S!==d[0]),S=d[0],x||(x=l.elevationOffset!==0),x&&_==null&&(_=new Array(E).fill(0)),_!=null&&(_[E]=l.elevationOffset),v=Math.min(v,l.elevationOffset),b=Math.max(b,l.elevationOffset),iMe(l.elevationOffset,h),c.setData(a[E],1,h[0],h[1],h[2],h[3]);const A=l.objectAndLayerIdColor;A!=null&&c.setData(a[E],2,A[0],A[1],A[2],A[3]),l.pickable!==eMe(n.pickability,E)&&(n.pickability=$_t(n.pickability,n.count,E,l.pickable))}n.verticalOffsets=x?_:null,i.offsetObb=x?O_t(i.obb,v,b,this._viewingMode,i.offsetObb!=null?i.offsetObb:ode(i.obb)):null,T||x||this._hasObjectAndLayerId?(s.componentParameters=new OO,s.componentParameters.castShadows=OV(g,n.count),s.componentParameters.transparent=OV(f,n.count),s.componentParameters.opaqueOverride=OV(m,n.count),s.componentParameters.texture=c,c.updateTexture()):(s.componentParameters=new qR,s.componentParameters.castShadows=l.castShadows?Rn.All:Rn.None,s.componentParameters.externalColor=l.externalColor,s.componentParameters.externalColorMixMode=l.externalColorMixMode),this._notifyDirty()}getComponentAabb(e,r,i,s=!1){e.intersectionGeometry.getComponentAabb(r,i);const n=e,o=n.components.verticalOffsets;if(s||o==null)return i;const a=o[r];if(this._viewingMode===Ve.Local||a===0)return i[2]+=a,i[5]+=a,i;const l=uJe(a);return l.localOrigin=n.transform.position,l.applyToAabb(i)}getComponentObb(e){return e.obb}getObjectTransform(e){return e.transform}getComponentPositions(e,r,i){return e.intersectionGeometry.getComponentPositions(r,i)}intersect(e,r,i,s,n,o){const a=e;n!=null&&(n.localOrigin=a.transform.position);const l=$x(wde,a.transform.rotationScale);Pn(qL,r,a.transform.position),Pn(WL,i,a.transform.position),Oc(qL,qL,l),Oc(WL,WL,l);const c=Qh(wde,l);return a.intersectionGeometry.intersect(qL,WL,s,c,n,a.components.verticalOffsets,o)}addEdges(e,r,i,s){const n=e,{indices:o,positions:a}=n.intersectionGeometry,l=n.components.offsets;return r.addComponentObject(e,n.transform,{center:n.obb.center,radius:A_t(n.obb)},a,o,l,i,s)}async extractEdgeInformation(e,r,i){const s=e,n=s.components.visibility;if(n.allInvisible())return{buffer:Evt.createBuffer(0),origin:[0,0,0]};const{indices:o,positions:a}=s.intersectionGeometry,l=s.components.offsets,c=HF.createBuffer(a.length/3);eI(c.position.typedBuffer,a,c.position.typedBufferStride,3),NCe(c.position,c.position,s.transform.rotationScale),this._setComponentIndices(c.componentIndex,o,l);const h=c.count,d=this._computeVisibilityIndices(o,n,l,h);return{origin:ks(s.transform.position),buffer:await r.extractComponentsEdgeLocations({indices:d,indicesLength:d.length,skipDeduplicate:!0,data:c,writerSettings:{reducedPrecision:!1,variants:0}},i)}}_setComponentIndices(e,r,i){let s=0;for(let n=0;n<i.length-1;n++){const o=i[n],a=i[n+1];for(let l=o;l<a;l++){const c=r?r[l]:l;e.set(c,s)}s++}}_computeVisibilityIndices(e,r,i,s){if(e&&r.allVisible())return e;let n=0;r.forEachComponentRange((l,c)=>(n+=i[c]-i[l],!0));const o=Cp(e)?new Array(n):e?.BYTES_PER_ELEMENT===2||s<=65536?new Uint16Array(n):new Uint32Array(n);let a=0;return r.forEachComponentRange((l,c)=>{const h=i[l],d=i[c];for(let f=h;f<d;f++)o[a++]=e?e[f]:f;return!0}),o}addComponentHighlight(e,r){const i=e.components;i.highlightCounts==null&&(i.highlightCounts=new Uint32Array(i.count+1)),i.highlightCounts[r]++===0&&(i.highlightsDirty(),this._notifyDirty()),i.highlightCounts[i.count]++}removeComponentHighlight(e,r){const i=e.components;if(i.highlightCounts==null)return void bde.warn("Removing non-existing highlight.");const s=i.highlightCounts[r],n=i.highlightCounts[i.count];if(s!==0){if(s>1)return i.highlightCounts[r]=s-1,void(i.highlightCounts[i.count]=n-1);i.highlightCounts[r]=0,i.highlightsDirty(),this._notifyDirty(),n===1?i.highlightCounts=null:i.highlightCounts[i.count]=n-1}else bde.warn("Removing non-existing highlight.")}clearHighlights(e){const r=e.components;r.highlightCounts!=null&&(r.highlightCounts=null,r.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(e){return e.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[JS.Visible]}_createRenderable(e,r){const i=this._renderManager.rctx,s=e.geometry,n=s.vertices.layoutParameters,o=kr.createVertex(i,Cr.STATIC_DRAW,s.vertices.data),a=Cc(s.indices,_=>kr.createIndex(i,Cr.STATIC_DRAW,_)),l=Gc(Q_t(n)),c=new Uint16Array(s.vertices.count);for(let _=0;_<r.count;_++){const v=r.offsets[_],b=r.offsets[_+1],T=r.materialDataIndices[_];if(s.indices!=null)for(let x=v;x<b;x++)c[s.indices[x]]=T;else for(let x=v;x<b;x++)c[x]=T}const h=kr.createVertex(i,Cr.STATIC_DRAW,c.buffer),d=new Gn(e.transform,e.toMapSpace),f=new Zh(i,oMe,{data:l,componentIndices:Mvt},{data:o,componentIndices:h},a),m=new B_t(f,At.TRIANGLES,n,a!=null),g={cameraDepthSquared:.5,gpuMemoryEstimate:o.byteLength+h.byteLength+(a!=null?a.byteLength:0)};return new V_t(d,m,g)}_notifyDirty(){this._renderManager.notifyDirty()}};const Mvt=Gc(qi().u16(C.COMPONENTINDEX));function OV(t,e){return t===e?Rn.All:t===0?Rn.None:Rn.Some}const wde=kl(),qL=O(),WL=O();let pMe=class extends ii{constructor(){super(...arguments),this.scale=He()}};function Pvt(t){const e=new Sr;e.attributes.add(C.POSITION,"vec2"),e.varyings.add("uv0","vec2"),e.varyings.add("uv1","vec2"),e.vertex.uniforms.add(new Ar("scale",i=>i.scale)),e.vertex.code.add(w`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv0 = position * 0.5 + vec2(0.5);
uv1 = (position * 0.5 + vec2(0.5)) * scale;
}`),e.fragment.uniforms.add(new rt("tex",i=>i.texture),new rt("depthTexture",i=>i.depthTexture),new Ar("scale",i=>i.scale),new Ar("clampUV",i=>Ivt(i)));const r=t.haze;return e.fragment.code.add(w`
    void main() {
      ${r?w`vec4`:w`float`} depthSample = texture(depthTexture, uv0) ${r?"":w`.r`};
      if (depthSample ${r?w`== vec4(0)`:w`!= 1.0`} ) {
          fragColor = vec4(0);
          return;
      }
      fragColor = texture(tex, min(uv1, clampUV));
    }
    `),e}function Ivt(t){if(!t.texture)return xde;const e=or(xde,t.texture.descriptor.width,t.texture.descriptor.height),r=BJ(e,e,t.scale),i=mxe(r,r);return vxe(i,t.scale,i)}const xde=He(),$vt=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:pMe,build:Pvt},Symbol.toStringTag,{value:"Module"}));let fMe=class mMe extends Lr{initializeProgram(e){return new Rr(e.rctx,mMe.shader.get().build(this.configuration),Tr)}initializePipeline(){return this.configuration.haze?Mt({blending:Oo(Se.ONE,Se.ZERO,Se.ONE_MINUS_SRC_COLOR,Se.ONE),depthTest:{func:ri.ALWAYS},colorWrite:Bt}):Mt({blending:zc(Se.SRC_ALPHA,Se.ONE_MINUS_SRC_ALPHA),depthTest:{func:ri.ALWAYS},colorWrite:Bt})}};fMe.shader=new Or($vt,()=>he(()=>import("./AtmosphereCompositing.glsl-6c6da030.js"),[],import.meta.url));let gMe=class extends ii{constructor(){super(...arguments),this.opacity=1}};function Lvt(t){const e=new Sr;return e.include(id),e.fragment.uniforms.add(new rt("tex",r=>r.texture)),t.hasOpacityFactor&&e.fragment.uniforms.add(new Ie("opacity",r=>r.opacity)),e.fragment.code.add(w`
    void main() {
      fragColor = texture(tex, uv) ${t.hasOpacityFactor?"* opacity":""};
    }`),e}const Dvt=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:gMe,build:Lvt},Symbol.toStringTag,{value:"Module"}));var pa;(function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.PremultipliedAlpha=2]="PremultipliedAlpha",t[t.COUNT=3]="COUNT"})(pa||(pa={}));let gW=class extends Sa{constructor(){super(...arguments),this.alphaMode=pa.None,this.hasOpacityFactor=!1}};u([B({count:pa.COUNT})],gW.prototype,"alphaMode",void 0),u([B()],gW.prototype,"hasOpacityFactor",void 0);let yMe=class _Me extends Lr{initializeProgram(e){return new Rr(e.rctx,_Me.shader.get().build(this.configuration),Tr)}initializePipeline(){switch(this.configuration.alphaMode){case pa.None:return Mt({colorWrite:Bt});case pa.Alpha:return Mt({blending:Oo(Se.SRC_ALPHA,Se.ONE,Se.ONE_MINUS_SRC_ALPHA,Se.ONE_MINUS_SRC_ALPHA),colorWrite:Bt});case pa.PremultipliedAlpha:case pa.COUNT:return Mt({blending:zc(Se.ONE,Se.ONE_MINUS_SRC_ALPHA),colorWrite:Bt})}}};yMe.shader=new Or(Dvt,()=>he(()=>import("./Compositing.glsl-0cf5acc5.js"),[],import.meta.url));let vMe=class extends ii{};function Nvt(){const t=new Sr;return t.include(id),t.fragment.uniforms.add(new rt("tex",e=>e.texture)),t.fragment.code.add(w`void main() {
fragColor = vec4(1.0 - texture(tex, uv).a);
}`),t}const Fvt=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:vMe,build:Nvt},Symbol.toStringTag,{value:"Module"}));let bMe=class wMe extends Lr{initializeProgram(e){return new Rr(e.rctx,wMe.shader.get().build(),Tr)}initializePipeline(){return Mt({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}};bMe.shader=new Or(Fvt,()=>he(()=>import("./HUDCompositing.glsl-f641617d.js"),[],import.meta.url));let xMe=class extends ii{};function Uvt(){const t=new Sr;return t.include(id),t.fragment.uniforms.add(new rt("colorTexture",e=>e.colorTexture),new rt("alphaTexture",e=>e.alphaTexture),new rt("frontFaceTexture",e=>e.frontFaceTexture)),t.fragment.code.add(w`void main() {
vec4 srcColor = texture(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture(alphaTexture, uv).r;
vec4 frontFace = texture(frontFaceTexture, uv);
fragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`),t}const kvt=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:xMe,build:Uvt},Symbol.toStringTag,{value:"Module"}));let TMe=class SMe extends Lr{initializeProgram(e){return new Rr(e.rctx,SMe.shader.get().build(),Tr)}initializePipeline(){return Mt({blending:Oo(Se.SRC_ALPHA,Se.ONE,Se.ONE_MINUS_SRC_ALPHA,Se.ONE_MINUS_SRC_ALPHA),colorWrite:Bt})}};TMe.shader=new Or(kvt,()=>he(()=>import("./OITCompositing.glsl-e4d41dbd.js"),[],import.meta.url));let EMe=class extends ii{constructor(){super(...arguments),this.overlayIndex=Di.INNER,this.opacity=1}};function zvt(){const t=new Sr;return t.include(id),t.fragment.uniforms.add(new rt("tex",e=>e.texture)),t.fragment.uniforms.add(new ZP("overlayIdx",e=>e.overlayIndex)),t.fragment.uniforms.add(new Ie("opacity",e=>e.opacity)),t.fragment.code.add(w`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;
}`),t}const Vvt=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:EMe,build:zvt},Symbol.toStringTag,{value:"Module"}));let CMe=class AMe extends Lr{initializeProgram(e){return new Rr(e.rctx,AMe.shader.get().build(),Tr)}initializePipeline(){return Mt({blending:zc(Se.ONE,Se.ONE_MINUS_SRC_ALPHA),colorWrite:Bt})}};CMe.shader=new Or(Vvt,()=>he(()=>import("./OverlayCompositing.glsl-2b5537d3.js"),[],import.meta.url));let Bvt=class{constructor(e,r){this._rctx=e,this._techniqueRepository=r,this._configuration=new gW,this._atmosphereConfiguration=new k5,this._passParameters=new gMe,this._atmosphereParameters=new pMe,this._oitParameters=new xMe,this._hudParameters=new vMe,this._overlayParameters=new EMe}destroy(){this._vao=je(this._vao)}compositeOIT(e,r,i,s){this._oitParameters.colorTexture=r,this._oitParameters.alphaTexture=i,this._oitParameters.frontFaceTexture=s;const n=this._rctx,o=this._techniqueRepository.acquire(TMe);n.bindTechnique(o,this._oitParameters,e);const a=this._ensureVAO();n.bindVAO(a),n.drawArrays(At.TRIANGLE_STRIP,0,Go(a,"geometry")),o.release()}compositeHUD(e,r){this._hudParameters.texture=r;const i=this._rctx,s=this._techniqueRepository.acquire(bMe);i.bindTechnique(s,this._hudParameters,e);const n=this._ensureVAO();i.bindVAO(n),i.drawArrays(At.TRIANGLE_STRIP,0,Go(n,"geometry")),s.release()}compositeOverlay(e,r,i,s){this._overlayParameters.texture=r,this._overlayParameters.opacity=i,this._overlayParameters.overlayIndex=s;const n=this._rctx,o=this._techniqueRepository.acquire(CMe);n.bindTechnique(o,this._overlayParameters,e);const a=this._ensureVAO();n.bindVAO(a),n.drawArrays(At.TRIANGLE_STRIP,0,Go(a,"geometry")),o.release()}compositeAtmosphere(e,r,i,s,n){const o=this._rctx;this._atmosphereParameters.texture=r,this._atmosphereParameters.depthTexture=i,this._atmosphereParameters.scale=s,this._atmosphereConfiguration.haze=n;const a=this._techniqueRepository.acquire(fMe,this._atmosphereConfiguration);o.bindTechnique(a,this._atmosphereParameters,e);const l=this._ensureVAO();o.bindVAO(l),o.drawArrays(At.TRIANGLE_STRIP,0,Go(l,"geometry")),a.release()}composite(e,r,i=pa.None,s=1){const n=this._rctx;this._configuration.alphaMode=i,this._configuration.hasOpacityFactor=s!==1,this._passParameters.texture=r,this._passParameters.opacity=s;const o=this._techniqueRepository.acquire(yMe,this._configuration);n.bindTechnique(o,this._passParameters,e);const a=this._ensureVAO();n.bindVAO(a),n.drawArrays(At.TRIANGLE_STRIP,0,Go(a,"geometry")),o.release()}_ensureVAO(){return this._vao==null&&(this._vao=Hl(this._rctx)),this._vao}};const Gvt=1e4,yW=100,jvt=500,Hvt=500,qvt=.1;function Wvt(t,e,r){return iK(e,t)*(r[1]-r[0])+r[0]}function Xvt(t,e,r){let i=0;if(!e.some(n=>(i+=n.numGeometries,i>=Gvt)))return r1t.compute(t,e);const s=tI();return r.forAll(n=>{n.visible&&iC(s,Yvt(t,n))}),s}function Yvt(t,e){if(!e.visible)return;const r=tI(),i=e.getSpatialQueryAccelerator();return i!=null?Zvt(r,t,i):Jvt(r,t,e.objects),r}function Zvt(t,e,r){const i=e.eye,s=e.viewForward,n=e.frustum,o=l=>l.visible,a=r.objectCount;if(a<jvt)WM(xh,e.near,Math.min(t.near,e.far)),r.forEachInDepthRange(i,s,mp.DepthOrder.FRONT_TO_BACK,xh,(l,c)=>{_W(t,e,l),xh.far=t.near,c.setRange(xh)},n,o),WM(xh,Math.max(t.far,e.near),e.far),r.forEachInDepthRange(i,s,mp.DepthOrder.BACK_TO_FRONT,xh,(l,c)=>{_W(t,e,l),xh.near=t.far,c.setRange(xh)},n,o);else{const l=Math.max(Math.min(a,Hvt),Math.ceil(a*qvt)),c=r.findClosest(s,mp.DepthOrder.FRONT_TO_BACK,n,o,l),h=r.findClosest(s,mp.DepthOrder.BACK_TO_FRONT,n,o,l);c&&h&&(Tde(t,e,c.boundingVolumeWorldSpace.bounds),Tde(t,e,h.boundingVolumeWorldSpace.bounds))}}function Jvt(t,e,r){WT.clear(),r.forAll(i=>{i.visible&&i.geometries.length!==0&&WT.add(i)}),WT.empty||(WT.sort(e),WM(xh,e.near,Math.min(t.near,e.far)),WT.forEachInDepthRange(xh,mp.DepthOrder.FRONT_TO_BACK,(i,s)=>{s<t.near&&_W(t,e,i)}),WM(xh,Math.max(t.far,e.near),e.far),WT.forEachInDepthRange(xh,mp.DepthOrder.BACK_TO_FRONT,(i,s,n)=>{t.far=Math.max(t.far,n)}))}function _W(t,e,r){if(!r.visible||!B_(e.frustum,r.boundingVolumeWorldSpace.bounds))return;const i=r.transformation,s=t1t;r.geometries.forEach(n=>{ai(s,i,n.shaderTransformation);const o=ME(s);OMe(t,e,n.boundingInfo,s,o)})}function OMe(t,e,r,i,s){if(r==null)return;ze(Za,r.center,i);const{eye:n,viewForward:o}=e,a=o[0]*(Za[0]-n[0])+o[1]*(Za[1]-n[1])+o[2]*(Za[2]-n[2]);if(Za[3]=r.radius*s,!(a-Za[3]>t.near&&a+Za[3]<t.far)&&B_(e.frustum,Za))if(r.radius>yW&&r.getChildren())for(const l of r.getChildren())OMe(t,e,l,i,s);else vW.unionDepthRangeWithAABB(t,e.viewProjectionMatrix,i,r.bbMin,r.bbMax)}function Tde(t,e,r){const i=e.eye,s=e.viewForward,n=(r[0]-i[0])*s[0]+(r[1]-i[1])*s[1]+(r[2]-i[2])*s[2];t.near=Math.min(t.near,n-r[3]),t.far=Math.max(t.far,n+r[3])}let Qvt=class{constructor(){this._items=new Vt({allocator:e=>e||{obj:null,distance:0,near:0,far:0},deallocator:e=>(e.obj=null,e.distance=0,e.near=0,e.far=0,e)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(e){this._items.pushNew().obj=e}sort(e){const r=e.eye,i=e.viewForward;this._items.forAll(s=>{const n=s.obj.boundingVolumeWorldSpace.bounds,o=(n[0]-r[0])*i[0]+(n[1]-r[1])*i[1]+(n[2]-r[2])*i[2];s.distance=o,s.near=o-n[3],s.far=o+n[3]}),this._items.sort((s,n)=>s.distance-n.distance)}forEachInDepthRange(e,r,i){if(r===mp.DepthOrder.FRONT_TO_BACK)for(let s=0;s<this._items.length;++s){const n=this._items.data[s];n.far<e.near||n.near>e.far||i(n.obj,n.near,n.far)}else for(let s=this._items.length-1;s>=0;--s){const n=this._items.data[s];n.far<e.near||n.near>e.far||i(n.obj,n.near,n.far)}}},Kvt=class{constructor(){this._view=xe(),this._viewProj=xe(),this._frustum=EM(),this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange={near:0,far:0}}compute(e,r){this._reset(),zs(this._view,e.viewMatrix),ai(this._viewProj,e.projectionMatrix,this._view),G5(this._frustum,e.frustum);const i=this._view,s=i[2],n=i[6],o=i[10],a=i[14];r.forAll(f=>f.forEachGeometry(m=>{if(!m.visible||!m.castShadow)return;const g=m.boundingSphere,_=s*g[0]+n*g[1]+o*g[2]+a,v=_-g[3],b=_+g[3];this._geometries.push(m),this._near.push(-b),this._far.push(-v)}));const l=new G_t;if(this._geometries.length===0)return l;for(let f=0;f<this._geometries.length;++f)this._near[f]>l.far&&(l.far=this._near[f]),this._near[f]>2&&this._far[f]<l.near&&(l.near=this._far[f]);const c=this._looseRange;c.near=Math.max(.5*l.near,2),c.far=2*l.far;let h=0,d=0;for(let f=0;f<this._geometries.length;++f)this._near[f]<l.near&&(this._near[f]>=c.near?l.near=this._near[f]:this._nearCandidates[h++]=f),this._far[f]>l.far&&(this._far[f]<=c.far?l.far=this._far[f]:this._farCandidates[d++]=f);if(this._nearCandidates.length===0&&this._farCandidates.length===0)return l;this._nearCandidates.sort((f,m)=>this._near[f]<this._near[m]?-1:this._near[f]>this._near[m]?1:0),this._farCandidates.sort((f,m)=>this._far[f]<this._far[m]?1:this._far[f]>this._far[m]?-1:0);for(let f=0;f<this._nearCandidates.length;++f){const m=this._nearCandidates[f];if(this._near[m]<l.near){const g=this._geometries[m],_=g.boundingInfo;this._includeNearBoundingInfoRec(_,g.shaderTransformation,l)}}for(let f=0;f<this._farCandidates.length;++f){const m=this._farCandidates[f];if(this._far[m]>l.far){const g=this._geometries[m],_=g.boundingInfo;this._includeFarBoundingInfoRec(_,g.shaderTransformation,l)}}return this._reset(),l}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_includeNearBoundingInfoRec(e,r,i){if(e==null)return;const s=e.center;ze(Za,s,r);const n=ME(r),o=Za[0],a=Za[1],l=Za[2],c=e.radius*n,h=this._frustum;if(h[0][0]*o+h[0][1]*a+h[0][2]*l+h[0][3]>c||h[1][0]*o+h[1][1]*a+h[1][2]*l+h[1][3]>c||h[2][0]*o+h[2][1]*a+h[2][2]*l+h[2][3]>c||h[3][0]*o+h[3][1]*a+h[3][2]*l+h[3][3]>c)return;const d=this._view[2]*o+this._view[6]*a+this._view[10]*l+this._view[14],f=d+c;if(!(-(d-c)<2||-f>=i.near))if(-f>this._looseRange.near)i.near=-f;else{if(c>yW){const m=e.getChildren();if(m!==void 0){for(const g of m)this._includeNearBoundingInfoRec(g,r,i);return}}vW.unionDepthRangeWithAABB(i,this._viewProj,r,e.bbMin,e.bbMax)}}_includeFarBoundingInfoRec(e,r,i){if(e==null)return;let s=e.radius;const n=e.center;ze(Za,n,r);const o=ME(r),a=Za[0],l=Za[1],c=Za[2];s*=o;const h=this._frustum;if(h[0][0]*a+h[0][1]*l+h[0][2]*c+h[0][3]>s||h[1][0]*a+h[1][1]*l+h[1][2]*c+h[1][3]>s||h[2][0]*a+h[2][1]*l+h[2][2]*c+h[2][3]>s||h[3][0]*a+h[3][1]*l+h[3][2]*c+h[3][3]>s)return;const d=this._view[2]*a+this._view[6]*l+this._view[10]*c+this._view[14]-s;if(!(-d<=i.far))if(-d<this._looseRange.far)i.far=-d;else{if(s>yW){const f=e.getChildren();if(f!==void 0){for(const m of f)this._includeFarBoundingInfoRec(m,r,i);return}}vW.unionDepthRangeWithAABB(i,this._viewProj,r,e.bbMin,e.bbMax)}}},e1t=class{constructor(){this._modelViewProj=xe(),this._clipPosition=[Wt(),Wt(),Wt(),Wt(),Wt(),Wt(),Wt(),Wt()]}unionDepthRangeWithAABB(e,r,i,s,n){const o=this._modelViewProj;ai(o,r,i);let a=!1;for(let l=0;l<8;++l){const c=this._clipPosition[l],h=l===0||l===3||l===4||l===7?s[0]:n[0],d=l===0||l===1||l===4||l===5?s[1]:n[1],f=l<4?s[2]:n[2];c[0]=o[0]*h+o[4]*d+o[8]*f+o[12],c[1]=o[1]*h+o[5]*d+o[9]*f+o[13],c[2]=o[2]*h+o[6]*d+o[10]*f+o[14],c[3]=o[3]*h+o[7]*d+o[11]*f+o[15]}for(let l=0;l<12;++l){const c=this._clipPosition[RV[l][0]],h=this._clipPosition[RV[l][1]],d=this._clipPosition[RV[l][2]],f=this._clipTriangle(c,h,d);let m=!0;for(let g=0;g<f.length;++g)if(f[g][3]>=2){m=!1;break}if(!m){a=!0;for(let g=0;g<f.length;++g){const _=f[g][3];Number.isFinite(_)&&(e.near=Math.min(_,e.near),e.far=Math.max(_,e.far))}}}return a}_inside(e,r){return r===0?e[0]>=-e[3]:r===1?e[1]>=-e[3]:r===2?e[0]<=e[3]:r===3?e[1]<=e[3]:void ot(!1)}_intersect(e,r,i){let s=0;return i===0?s=(-e[3]-e[0])/(r[0]-e[0]+r[3]-e[3]):i===1?s=(-e[3]-e[1])/(r[1]-e[1]+r[3]-e[3]):i===2?s=(e[3]-e[0])/(r[0]-e[0]-r[3]+e[3]):i===3&&(s=(e[3]-e[1])/(r[1]-e[1]-r[3]+e[3])),Y6(Wt(),e,r,s)}_clipTriangle(e,r,i){let s=[e,r,i];for(let n=0;n<4;++n){const o=s;s=[];for(let a=0;a<o.length;++a){const l=o[a],c=o[(a+1)%o.length];this._inside(c,n)?(this._inside(l,n)||s.push(this._intersect(l,c,n)),s.push(c)):this._inside(l,n)&&s.push(this._intersect(l,c,n))}}return s}};const RV=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],Za=xs(),t1t=xe(),xh=tI(),WT=new Qvt,r1t=new Kvt,vW=new e1t;let i1t=class{},s1t=class extends ii{constructor(){super(...arguments),this.textures=new i1t}};function n1t(){const t=new Sr;return t.attributes.add(C.POSITION,"vec2"),t.vertex.uniforms.add(new sr("drawPosition",(e,r)=>o1t(e,r))),t.varyings.add("vUV","vec2"),t.vertex.code.add(w`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),t.fragment.uniforms.add(new rt("textureInput",e=>e.textures.input)),t.fragment.uniforms.add(new rt("textureMask",e=>e.textures.mask)),t.fragment.uniforms.add(new rt("textureOverlay",e=>e.textures.overlay)),t.fragment.uniforms.add(new nm("maskEnabled",e=>e.magnifier.maskEnabled)),t.fragment.uniforms.add(new nm("overlayEnabled",e=>e.magnifier.overlayEnabled)),t.fragment.code.add(w`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture(textureMask, vUV).a : 1.0;
vec4 inputColor = texture(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture(textureOverlay, vUV) : vec4(0);
fragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),t}function o1t(t,e){const r=e.camera.pixelRatio,i=t.magnifier.offset.x*r,s=t.magnifier.offset.y*r;Uf(t.magnifier.position,Sde);const n=e.camera.screenToRender(Sde,a1t),o=Math.ceil(r*t.magnifier.size),a=e.camera.fullWidth,l=e.camera.fullHeight;return Ti(l1t,(n[0]+i)/a*2-1,(n[1]-s)/l*2-1,o/a*2,o/l*2)}const Sde=Qi(),a1t=Pve(),l1t=Wt();async function c1t(t){const e=he(()=>import("./mask-svg-023bbc42.js"),[],import.meta.url),r=he(()=>import("./overlay-svg-d62383f3.js"),[],import.meta.url),i=E0((await e).default,{signal:t}),s=E0((await r).default,{signal:t}),n={mask:await i,overlay:await s};return Yt(t),n}let $2=class extends Te{constructor(){super(...arguments),this._handles=new $i,this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this._passParameters=new s1t,this.events=new Ts,this.attributeLocations=new Map([[C.POSITION,0]]),this._tmpScreenPoint=Qi(),this._tmpRenderPoint=Pve()}get updating(){return this._imageSources==null&&this._imageLoadTask!=null&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this._handles.removeAll(),this._magnifier=e;const r=()=>{this._updateResourceLoading(),this.events.emit("request-render")};this._magnifier!=null&&this._handles.add(le(()=>Cc(this._magnifier,i=>i.version),r)),r()}get enabled(){return this._validMagnifier!=null}get _validMagnifier(){return this._magnifier!=null&&this._magnifier.visible&&this._magnifier.position!=null&&this._magnifier.size>0?this._magnifier:null}get _factor(){return this._magnifier!=null&&this._magnifier.factor||1}destroy(){this._magnifier=null,this._handles.destroy(),this._imageLoadTask!=null&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources()}render(e,r){const i=this._validMagnifier;if(i==null)return;const s=r.camera.pixelRatio,n=Math.ceil(s*i.size);if(this._updateResources(e,n),this._resources==null)return;const o=this._passParameters.textures,a=Math.ceil(1/this._factor*n);o.input.resize(a,a),Uf(i.position,this._tmpScreenPoint);const l=r.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),c=r.camera.fullWidth,h=r.camera.fullHeight,d=.5*a,f=.5*a;l[0]=ve(l[0],d,c-d-1),l[1]=ve(l[1],f,h-f-1);const m=Math.floor(l[0]-d),g=Math.floor(l[1]-f),_=this._resources.program;_.bindTexture("textureInput",o.input),e.gl.copyTexImage2D(o.input.descriptor.target,0,o.input.descriptor.pixelFormat,m,g,a,a,0),this._passParameters.magnifier=i,e.useProgram(_),_.bindPass(this._passParameters,r),e.bindVAO(this._resources.vao),e.setPipelineState(this._resources.pipelineState),e.drawArrays(At.TRIANGLE_STRIP,0,4)}_updateResourceLoading(){const e=this._validMagnifier;if(e==null)return;const r=e.maskUrl,i=e.overlayUrl;this._imageLoadTask==null||this._imageLoadTask.maskUrl===r&&this._imageLoadTask.overlayUrl===i||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),this._imageSources==null&&this._imageLoadTask==null&&(this._imageLoadTask={maskUrl:r,overlayUrl:i,task:vC(async s=>{const n=r==null||i==null?c1t(s):null,o=r!=null?E0(r,{signal:s}):n.then(l=>l.mask),a=i!=null?E0(i,{signal:s}):n.then(l=>l.overlay);this._imageSources={mask:await o,overlay:await a},this._disposeResources(),this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}_updateResources(e,r){if(!this.enabled)return void this._disposeResources();if(this._resources!=null){if(this._passParameters.textures.size!==r){const s=this._createTextureResources(e,r);if(s==null)return void this._disposeResources();this._disposeTextureResources(this._passParameters.textures),this._passParameters.textures=s}return}const i=this._createTextureResources(e,r);i!=null&&(this._resources={program:this._createProgram(e),vao:Hl(e,WJ,this.attributeLocations,0,1),pipelineState:Mt({blending:zc(Se.ONE,Se.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:Bt})},this._passParameters.textures=i)}_disposeResources(){this._resources!=null&&(this._disposeTextureResources(this._passParameters.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose()}_createTextureResources(e,r){if(this._imageSources==null)return null;this._imageSources.overlay.width=r,this._imageSources.overlay.height=r,this._imageSources.mask.width=r,this._imageSources.mask.height=r;const i=new xr;i.internalFormat=Ct.RGBA,i.wrapMode=Dt.CLAMP_TO_EDGE,i.flipped=!0,i.preMultiplyAlpha=!k0e(this._imageSources.overlay.src)||!e.driverTest.svgPremultipliesAlpha.result;const s=new Ot(e,i,this._imageSources.overlay);i.pixelFormat=i.internalFormat=Ct.ALPHA,i.preMultiplyAlpha=!1;const n=new Ot(e,i,this._imageSources.mask);return i.pixelFormat=i.internalFormat=Ct.RGBA,i.flipped=!1,{input:new Ot(e,i),mask:n,overlay:s,size:r}}_createProgram(e){return new Rr(e,n1t(),this.attributeLocations)}};u([p()],$2.prototype,"_imageSources",void 0),u([p()],$2.prototype,"_imageLoadTask",void 0),u([p({readOnly:!0})],$2.prototype,"updating",null),$2=u([P("esri/views/3d/webgl-engine/lib/MagnifierHelper")],$2);let u1t=class{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new wa(new ArrayBuffer(4)),this._uidToRenderColor=new Map,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new Map,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(e,r,i,s,n,o=null,a=null,l=null){if(!(e&&r&&i&&s)||(this._layerUidToId.set(s,i),this._layerUidToPopupEnabled.set(s,n),!n))return;let c=this._layerUidToGraphicsUidToObjectId.get(s);c||(c=new Map,this._layerUidToGraphicsUidToObjectId.set(s,c)),c.set(r,{objectId:e,attributeNodeId:o,attributeIndex:a,subLayerId:l})}getObjectAndLayerIdColor(e){const r=this.getObjectAndLayerIdColorArray(e);return Nt(r.get(0,1),r.get(0,2),r.get(0,3),255)}getObjectAndLayerIdColorArray(e){if(!e.layerUid||!e.graphicUid)return this.colorZero;const r=this._layerUidToPopupEnabled.get(e.layerUid);if(r===void 0)return K.getLogger(this).warn("popupEnabled is undefined for layerUid "+e.layerUid),this.colorZero;if(r===!1)return this.colorZero;let i=this._uidToRenderColor.get(e.layerUid);i||(i=new Map,this._uidToRenderColor.set(e.layerUid,i));let s=i.get(e.graphicUid);if(!s){for(;!s;){const o=Math.floor(16777214*Math.random())+1;this._colorToUID.has(o)||(s=o)}if(s>16777215)throw new Error("Object ID Overflow");i.set(e.graphicUid,s),this._colorToUID.set(s,e)}const n=new ArrayBuffer(4);return new DataView(n).setUint32(0,s,!1),new wa(n)}getColorToObjectAndLayerIdMapping(){const e=new Map;for(const[r,i]of this._colorToUID.entries()){const s=this._layerUidToGraphicsUidToObjectId.get(i.layerUid);let n=null;s?(n=s.get(i.graphicUid),n||K.getLogger(this).warn("getColorMapping: no entry found for graphicsId "+i.graphicUid)):K.getLogger(this).warn("getColorMapping: no entry found for layerUid "+i.layerUid);const o=this._layerUidToId.get(i.layerUid);o||K.getLogger(this).warn("no layerId found for uid "+i.layerUid),n&&o&&e.set(r,n.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:n.objectId,lid:o,attrId:n.attributeNodeId,attrIdx:n.attributeIndex,subLayerId:n.subLayerId}:{type:"object-and-layer-id",oid:n.objectId,lid:o})}return e}};var XM;(function(t){t[t.FrontToBack=0]="FrontToBack",t[t.BackToFront=1]="BackToFront"})(XM||(XM={}));let Cy=class{constructor(e,r,i=XM.FrontToBack){this._rctx=e,this._techniqueRepository=r,this._sorting=i,this._draws=new Vt({initialSize:32,allocator:s=>s||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(e,r,i,s){const n=this._draws.pushNew();n.geometry=r,n.geometryRanges=i,n.material=e,n.depthSquaredHint=s,n.indexType=(r.indexed?r.vao.indexBuffer.indexType:null)??0}prepare(e,r){return this._draws.map(i=>i.material.prepareTechnique(this._techniqueRepository,e,r,i.geometry.parameters))}dispatch(e,r,i){const s=this._rctx;this._previouslyBoundDraw.clear();let n=null;const o=this._draws.length;for(let a=0;a<o;a++){const l=i[a];l===n&&l.configuration.transparencyPassType===dt.NONE||(s.bindTechnique(l,e,r),n=l);const c=this._draws.data[a],h=c.geometry;s.bindVAO(h.vao),this._previouslyBoundDraw.get(l)!==c.material&&(l.program.bindDraw(c.material,r,e),this._previouslyBoundDraw.set(l,c.material));const d=c.geometryRanges,f=d.length;if(c.indexType!==0){const m=t4.get(c.indexType);for(let g=0;g<f;g+=2){const _=d[g],v=d[g+1];s.drawElements(h.primitiveType,v,c.indexType,_*m)}}else for(let m=0;m<f;m+=2){const g=d[m],_=d[m+1];s.drawArrays(h.primitiveType,g,_)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const e=this._sorting===XM.FrontToBack?1:-1;this._draws.sort((r,i)=>{const s=e*(r.depthSquaredHint-i.depthSquaredHint);return s!==0?s:r.geometry.vao.byteSize-i.geometry.vao.byteSize})}get count(){return this._draws.length}};const t4=new Map;t4.set(st.UNSIGNED_BYTE,1),t4.set(st.UNSIGNED_SHORT,2),t4.set(st.UNSIGNED_INT,4);let h1t=class{constructor(e,r){this.rctx=e,this.shaderTechniqueRepository=r,this.canRender=!0,this._materialPassParameters=new w0t,this._shadowPassParameters=new x0t,this._highlightPassParameters=new T0t,this._systems=new Set,this._passes={materialOpaque:new Cy(e,r),materialTransparent:new Cy(e,r,XM.BackToFront),materialIntegratedMesh:new Cy(e,r),shadowMap:new Cy(e,r),highlight:new Cy(e,r),highlightIntegratedMesh:new Cy(e,r),highlightShadowMap:new Cy(e,r),defaultShadowMap:new Cy(e,r)}}destroy(){this._context=null,this._systems.clear()}register(e){this._systems.add(e)}prepareRender(e){if(this._systems.size!==0){for(const r of Object.values(this._passes))r.prepareSubmit();this._systems.forEach(r=>r.submit(this._passes,e.bindParameters));for(const r of Object.values(this._passes))r.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}}prepareTechniques(e){return this._systems.size===0?null:(this._configure(e),this._materialPassParameters.output=e.output,this._invoke(e,(r,i)=>r.prepare(i,e.bindParameters)))}render(e,r){this._invoke(e,(i,s)=>i.dispatch(s,e.bindParameters,r))}_invoke(e,r){switch(e.bindParameters.slot){case pe.OPAQUE_MATERIAL:switch(e.output){case F.Color:case F.Depth:case F.Normal:case F.ObjectAndLayerIdColor:return r(this._passes.materialOpaque,this._materialPassParameters);case F.Highlight:return r(this._passes.highlight,this._highlightPassParameters);case F.Shadow:return r(this._passes.shadowMap,this._shadowPassParameters);case F.ShadowHighlight:return r(this._passes.highlightShadowMap,this._shadowPassParameters);case F.ShadowExcludeHighlight:return r(this._passes.defaultShadowMap,this._shadowPassParameters)}break;case pe.TRANSPARENT_MATERIAL:switch(e.output){case F.Color:case F.Alpha:case F.Depth:case F.Normal:case F.ObjectAndLayerIdColor:return r(this._passes.materialTransparent,this._materialPassParameters)}break;case pe.INTEGRATED_MESH:switch(e.output){case F.Color:case F.Depth:case F.Normal:case F.ObjectAndLayerIdColor:return r(this._passes.materialIntegratedMesh,this._materialPassParameters);case F.Highlight:return r(this._passes.highlightIntegratedMesh,this._highlightPassParameters)}}return null}notifyDirty(){this._context.requestRender()}slots(){return[pe.OPAQUE_MATERIAL,pe.TRANSPARENT_MATERIAL,pe.INTEGRATED_MESH]}initializeRenderContext(e){this._context=e}uninitializeRenderContext(){}queryDepthRange(e){const r={near:1/0,far:-1/0};return this._systems.forEach(i=>{const s=i.queryShadowCasterDepthRange(e);s!=null&&iC(r,s,r)}),r}_configure(e){const r=e.output===F.Shadow||e.output===F.ShadowHighlight||e.output===F.ShadowExcludeHighlight?this._shadowPassParameters:e.output===F.Highlight?this._highlightPassParameters:this._materialPassParameters;this._updateParameters(e,r)}_updateParameters(e,r){const i=e.bindParameters.camera,s=i.viewInverseTransposeMatrix;ne(MV,s[3],s[7],s[11]),PV.set(MV),ie(r.transformWorldFromViewTH,PV.high),ie(r.transformWorldFromViewTL,PV.low),ie(r.slicePlaneLocalOrigin,MV),Jh(r.transformViewFromCameraRelativeRS,i.viewMatrix),zs(r.transformProjFromView,i.projectionMatrix),r.identifier===Ec.Material&&(this._materialPassParameters.transparent=e.bindParameters.slot===pe.TRANSPARENT_MATERIAL,this._materialPassParameters.integratedMesh=e.bindParameters.slot===pe.INTEGRATED_MESH,Qh(Ede,r.transformViewFromCameraRelativeRS),$x(r.transformNormalViewFromGlobal,Ede))}get needsHighlight(){return this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0}get needsTransparentPass(){return this._passes.materialTransparent.count>0}};const MV=O(),Ede=ki(),PV=new Y9;let d1t=class{constructor(){this._step=Ode,this._dilation=1,this._firstIdleTime=0}frame(e,r){if(r?this._firstIdleTime===0&&(this._firstIdleTime=performance.now()):this._firstIdleTime=0,ae("disable-feature:high-quality-idle"))this._dilation=1;else{const s=r?performance.now()-this._firstIdleTime:0;if(s>=Cde+f1t)return this._step=1/0,void(this._dilation=1);this._dilation=s>=Cde?m1t:1}const i=ve(e/p1t,Ode,y1t);this._step===1/0?this._step=i:this._step=this._step*Ade+i*(1-Ade)}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=0}};const p1t=.5,Cde=12e4,f1t=1e4,m1t=10,Ade=.9,g1t=30,Ode=1e3/1,y1t=1e3/g1t,_1t=8.6,v1t=.4;function b1t(){const t=new Sr,{vertex:e,fragment:r}=t,i=e.code,s=r.code;return t.attributes.add(C.POSITION,"vec2"),t.varyings.add("uv","vec2"),t.attributes.add(C.UV0,"vec2"),e.uniforms.add(new rt("coverageTex",n=>n.coverageTexture)),i.add(w`void main() {
vec4 cov = texture(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),r.uniforms.add(new rt("tex",n=>n.blurColorTexture),new rt("origin",n=>n.highlightColorTexture),new sr("uColor",n=>n.color),new sr("haloColor",n=>n.haloColor),new sr("opacities",n=>Ti(w1t,n.haloOpacity,n.haloOpacityOccluded,n.fillOpacity,n.fillOpacityOccluded))),r.constants.add("outlineSize","float",_1t),r.constants.add("blurSize","float",v1t),s.add(w`void main() {
vec4 blurredHighlightValue = texture(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
fragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),t}const w1t=Wt(),x1t=Object.freeze(Object.defineProperty({__proto__:null,build:b1t},Symbol.toStringTag,{value:"Module"}));let RMe=class MMe extends Lr{initializeProgram(e){return new Rr(e.rctx,MMe.shader.get().build(),Tr)}initializePipeline(){return Mt({blending:Oo(Se.SRC_ALPHA,Se.ONE,Se.ONE_MINUS_SRC_ALPHA,Se.ONE_MINUS_SRC_ALPHA),colorWrite:Bt})}};RMe.shader=new Or(x1t,()=>he(()=>import("./HighlightApply.glsl-914c4b2e.js"),[],import.meta.url));let PMe=class extends ii{constructor(){super(...arguments),this.blurSize=He()}};function T1t(){const t=new Sr,{vertex:e,fragment:r}=t,i=e.code,s=r.code;return t.attributes.add(C.POSITION,"vec2"),t.attributes.add(C.UV0,"vec2"),t.varyings.add("blurCoordinate","vec3"),e.uniforms.add(new rt("coverageTex",n=>n.coverageTexture)),r.uniforms.add(new kK("blurSize",n=>n.blurSize)),i.add(w`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
}`),r.uniforms.add(new zh("tex",n=>n.blurInputTexture)),s.add(w`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture(tex, uv);
if (blurCoordinate.z == 1.0) {
fragColor = center;
} else {
vec4 sum = vec4(0.0);
sum += center * 0.204164;
sum += texture(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture(tex, uv - blurSize * 3.294215) * 0.093913;
fragColor = sum;
}
}`),t}const S1t=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:PMe,build:T1t},Symbol.toStringTag,{value:"Module"}));let IMe=class $Me extends Lr{initializeProgram(e){return new Rr(e.rctx,$Me.shader.get().build(),Tr)}initializePipeline(){return Mt({colorWrite:Bt})}};IMe.shader=new Or(S1t,()=>he(()=>import("./HighlightBlur.glsl-1b1c0e0e.js"),[],import.meta.url));let LMe=class extends ii{constructor(){super(...arguments),this.invFramebufferDim=He()}};function E1t(){const t=new Sr,{vertex:e,fragment:r}=t,i=e.code,s=r.code;return t.attributes.add(C.POSITION,"vec2"),i.add(w`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`),r.uniforms.add(new zh("tex",n=>n.inputTexture)),r.uniforms.add(new kK("invFramebufferDim",n=>n.invFramebufferDim)),s.add(w`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture(tex, coord);
float mx = floor(max(value.g, value.b));
fragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`),t}const C1t=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:LMe,build:E1t},Symbol.toStringTag,{value:"Module"}));let DMe=class NMe extends Lr{initializeProgram(e){return new Rr(e.rctx,NMe.shader.get().build(),Tr)}initializePipeline(){return Mt({colorWrite:Bt})}};DMe.shader=new Or(C1t,()=>he(()=>import("./HighlightDownsample.glsl-97411c60.js"),[],import.meta.url));let Rde=class extends ii{constructor(){super(...arguments),this.color=Em(1,0,1,1),this.haloColor=Em(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.shadowColor=Nt(1,0,1,1),this.shadowOpacity=.15,this.occludedShadowOpacity=.075}};const A1t=32;let O1t=class{constructor(e,r){this._techniqueRep=e,this._rctx=r,this._viewportToRestore=Wt(),this._passParameters=new Rde,this._downsampleDrawParameters=new LMe,this._blurDrawParameters=new PMe,this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0}}_assertResources(){if(this._quadVAO)return;this._quadVAO=Hl(this._rctx);const e=new xr;e.wrapMode=Dt.CLAMP_TO_EDGE,this._blur0Fbo=new fn(this._rctx,e),this._blur1Fbo=new fn(this._rctx,e),this._blurTechnique=this._techniqueRep.acquire(IMe),this._downsampleTechnique=this._techniqueRep.acquire(DMe),this._applyTechnique=this._techniqueRep.acquire(RMe)}dispose(){if(this._blurTechnique=Gi(this._blurTechnique),this._downsampleTechnique=Gi(this._downsampleTechnique),this._applyTechnique=Gi(this._applyTechnique),this._grid.coverageMipmap)for(let e=1;e<this._grid.coverageMipmap.length;e++)this._grid.coverageMipmap[e].dispose();this._grid.vao&&this._grid.vao.dispose(),this._quadVAO&&(this._quadVAO.dispose(),this._quadVAO=null),this._blur0Fbo=je(this._blur0Fbo),this._blur1Fbo=je(this._blur1Fbo)}setDefaultOptions(e){this._passParameters={...new Rde,...e}}render(e,r,i){this._passParameters.highlightColorTexture=r.colorTexture,this._assertResources();const s=e.camera;Nh(this._viewportToRestore,s.fullViewport);const n=s.fullWidth,o=s.fullHeight,a=s.pixelRatio,l=Math.ceil(n/a),c=Math.ceil(o/a);this._blur0Fbo.resize(l,c),this._blur1Fbo.resize(l,c);const h=this._rctx;h.bindVAO(this._quadVAO);let d=null;this._gridUpdateResources(r,A1t),this._gridComputeMipmap(e),this._passParameters.coverageTexture=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,d=this._grid.vao;const f=h.bindTechnique(this._blurTechnique,this._passParameters,e);h.bindVAO(d),h.bindFramebuffer(this._blur0Fbo),h.setViewport(0,0,l,c),h.setClearColor(0,0,0,0),h.clear(Si.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=r.colorTexture,or(this._blurDrawParameters.blurSize,1/l,0),f.bindDraw(this._blurDrawParameters,e,this._passParameters),h.drawArrays(this._blurTechnique.primitiveType,0,Go(d,"geometry")),h.bindFramebuffer(this._blur1Fbo),h.clear(Si.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=this._blur0Fbo.colorTexture,or(this._blurDrawParameters.blurSize,0,1/c),f.bindDraw(this._blurDrawParameters,e,this._passParameters),h.drawArrays(this._blurTechnique.primitiveType,0,Go(d,"geometry")),h.bindFramebuffer(i),h.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3]),this._passParameters.blurColorTexture=this._blur1Fbo.colorTexture,h.bindTechnique(this._applyTechnique,this._passParameters,e),h.drawArrays(this._applyTechnique.primitiveType,0,Go(d,"geometry")),h.bindVAO(null)}_gridUpdateResources(e,r){const i=this._rctx,s=this._grid;let n=!1;if(s.coverageMipmap===null&&(s.coverageMipmap=[e],n=!0),s.viewportWidth===e.width&&s.viewportHeight===e.height||(n=!0,s.viewportWidth=e.width,s.viewportHeight=e.height),s.coverageMipmap[0]=e,s.cellPixelSize!==r&&(s.cellPixelSize=r,n=!0),n){for(let l=1;l<s.coverageMipmap.length;l++)s.coverageMipmap[l].dispose();s.mipmapLevels=Math.ceil(Math.log(s.cellPixelSize)*Math.LOG2E),s.coverageMipmap.length=s.mipmapLevels+1;for(let l=0;l<s.mipmapLevels;l++){const c=s.coverageMipmap[l],h=new xr(Math.ceil(c.width/2),Math.ceil(c.height/2));h.pixelFormat=Ct.RGB,h.dataType=qs.UNSIGNED_SHORT_5_6_5,h.wrapMode=Dt.CLAMP_TO_EDGE,s.coverageMipmap[l+1]=new fn(i,h)}}const o=Math.ceil(e.height/s.cellPixelSize),a=Math.ceil(e.width/s.cellPixelSize);if(!s.vao||s.verticalCellCount!==o||s.horizontalCellCount!==a){s.verticalCellCount=o,s.horizontalCellCount=a;const l=o+1,c=a+1,h=1/o,d=1/a,f=6,m=4,g=new Float32Array(f*m*l*c);let _=0;for(let v=0;v<l;v++)for(let b=0;b<c;b++)g[_]=(b-.5)*d*2-1,g[_+1]=(v-.5)*h*2-1,g[_+2]=b*d,g[_+3]=v*h,g[_+4]=(b+.5)*d*2-1,g[_+5]=(v-.5)*h*2-1,g[_+6]=b*d,g[_+7]=v*h,g[_+8]=(b-.5)*d*2-1,g[_+9]=(v+.5)*h*2-1,g[_+10]=b*d,g[_+11]=v*h,g[_+12]=(b-.5)*d*2-1,g[_+13]=(v+.5)*h*2-1,g[_+14]=b*d,g[_+15]=v*h,g[_+16]=(b+.5)*d*2-1,g[_+17]=(v-.5)*h*2-1,g[_+18]=b*d,g[_+19]=v*h,g[_+20]=(b+.5)*d*2-1,g[_+21]=(v+.5)*h*2-1,g[_+22]=b*d,g[_+23]=v*h,_+=f*m;s.vao&&s.vao.dispose(),s.vao=new Np(i,Tr,{geometry:MP},{geometry:kr.createVertex(i,Cr.STATIC_DRAW,g)})}}_gridComputeMipmap(e){const r=this._rctx,i=this._grid,s=r.bindTechnique(this._downsampleTechnique,this._passParameters,e);r.bindVAO(this._quadVAO);for(let n=0;n<i.mipmapLevels;n++){r.bindFramebuffer(i.coverageMipmap[n+1]);const o=i.coverageMipmap[n+1].width,a=i.coverageMipmap[n+1].height;this._downsampleDrawParameters.inputTexture=i.coverageMipmap[n].colorTexture,or(this._downsampleDrawParameters.invFramebufferDim,1/o,1/a),s.bindDraw(this._downsampleDrawParameters,e,this._passParameters),r.setViewport(0,0,o,a),r.drawArrays(At.TRIANGLE_STRIP,0,Go(this._quadVAO,"geometry"))}}get gpuMemoryUsage(){let e=(this._blur0Fbo!=null?this._blur0Fbo.gpuMemoryUsage:0)+(this._blur1Fbo!=null?this._blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const r of this._grid.coverageMipmap)e+=r.gpuMemoryUsage;return e}get test(){return{coverage:this._grid.coverageMipmap,blur:[this._blur0Fbo,this._blur1Fbo]}}};const R1t={dataType:qs.UNSIGNED_BYTE,internalFormat:Ct.RGBA},M1t={};let P1t=class{constructor(e){this._rctx=e,this._activeTargets=new Set,this._colorTextures=new Map,this._depthTextures=new Map,this._fbos=new Map}dispose(){this._depthTextures.forEach(e=>e.dispose()),this._depthTextures.clear(),this._colorTextures.forEach(e=>e.dispose()),this._colorTextures.clear(),this._fbos.forEach(e=>e.dispose()),this._fbos.clear(),this._activeTargets.clear()}disposeTargetResource(e){const r=e.id;this._activeTargets.has(r)&&(this._activeTargets.delete(r),this._disposeWithFramebuffers(this._depthTextures,r),this._disposeWithFramebuffers(this._colorTextures,r))}_disposeWithFramebuffers(e,r){const i=e.get(r);i&&(this._fbos.forEach((s,n)=>{s.colorTexture!==i&&s.depthStencilAttachment!==i||(s.detachColorTexture(),s.detachDepthStencilTexture(),s.dispose(),this._fbos.delete(n))}),i.dispose(),e.delete(r))}_getDepthTexture(e,r,i){let s=this._depthTextures.get(e.id);if(!s||s.descriptor.width===r&&s.descriptor.height===i||(s.dispose(),s=null),!s){const n=new xr(r,i);n.pixelFormat=Ct.DEPTH_STENCIL,n.dataType=qs.UNSIGNED_INT_24_8,n.samplingMode=Rt.NEAREST,n.wrapMode=Dt.CLAMP_TO_EDGE,s=new Ot(this._rctx,n),this._depthTextures.set(e.id,s),this._activeTargets.add(e.id)}return s}getAllocatedDepthTexture(e){return this._depthTextures.get(e.id)}getColorTexture(e,r,i){let s=this._colorTextures.get(e.id);if(s&&(s.descriptor.width===r&&s.descriptor.height===i||(s.dispose(),s=pC())),!s){const n=new xr(r,i);n.internalFormat=e.internalFormat,n.dataType=e.dataType,n.samplingMode=e.samplingMode!=null?e.samplingMode:Rt.LINEAR,n.wrapMode=Dt.CLAMP_TO_EDGE,s=new Ot(this._rctx,n),this._colorTextures.set(e.id,s),this._activeTargets.add(e.id)}return s}getAllocatedColorTexture(e){return this._colorTextures.get(e.id)}registerDepthTarget(e={}){return{id:Ic(),...M1t,...e}}registerColorTarget(e={}){return{id:Ic(),...R1t,...e}}getFramebuffer(e,r,i,s){const n=this._getKey(i,s);let o=this._fbos.get(n);const a=this.getColorTexture(i,e,r),l=s?this._getDepthTexture(s,e,r):void 0;return o?((o.width!==e||o.height!==r||o.colorTexture!==a||o.depthStencilAttachment!==l)&&(o.detachColorTexture(),o.detachDepthStencilTexture(),o.resize(e,r),o.attachColorTexture(a),o.attachDepthStencil(l)),o):(o=new fn(this._rctx,a,l),this._fbos.set(n,o),o)}_getKey(e,r){return`${e.id}_${r?r.id:"X"}_${e.name}${r?"_"+r.name:""}`}get gpuMemoryUsage(){let e=0;const r=new Set,i=s=>{r.has(s)||(r.add(s),e+=s.gpuMemoryUsage)};return this._colorTextures.forEach(i),this._depthTextures.forEach(i),e}},I1t=class{constructor(e,r){this._rctx=e,this._compositingHelper=r,this._mainColorTarget=0,this.width=4,this.height=4,this._background={type:"color",color:[0,0,0,1]},this._renderTargetHelper=new P1t(e);const i=this._renderTargetHelper;this._mainColorTargets=[i.registerColorTarget({name:"mainColorTarget0"}),i.registerColorTarget({name:"mainColorTarget1"})],this.frontFaceTarget=i.registerColorTarget({name:"frontFaceTarget"}),this.colorFloatTarget=i.registerColorTarget({name:"colorFloatTarget",dataType:qs.HALF_FLOAT,internalFormat:Ke.RGBA16F,samplingMode:Rt.NEAREST}),this.alphaFloatTarget=i.registerColorTarget({name:"alphaFloatTarget",dataType:qs.HALF_FLOAT,internalFormat:Ke.R16F,samplingMode:Rt.NEAREST}),this.mainDepth=i.registerDepthTarget({name:"mainDepth"}),this.linearDepth=i.registerColorTarget({name:"linearDepth",samplingMode:Rt.NEAREST}),this.terrainLinearDepth=i.registerColorTarget({name:"terrainLinearDepth"}),this.geometryLinearDepth=i.registerColorTarget({name:"geometryLinearDepth"}),this.normal=i.registerColorTarget({name:"normal"}),this.highlight=i.registerColorTarget({name:"highlight",internalFormat:Ke.RGBA4,dataType:qs.UNSIGNED_SHORT_4_4_4_4}),this.hudVisibility=i.registerColorTarget({name:"hudVisibility",internalFormat:Ke.RGBA4,dataType:qs.UNSIGNED_SHORT_4_4_4_4}),this.tmpColor=i.registerColorTarget({name:"tmpColor"}),this.tmpDepth=i.registerDepthTarget({name:"tmpDepth"}),this.hudColor=i.registerColorTarget({name:"hudColor"})}dispose(){this._renderTargetHelper.dispose()}set background(e){this._background=e}get background(){return this._background}get currentColorTarget(){return this._mainColorTargets[this._mainColorTarget]}get previousColorTarget(){return this._mainColorTargets[1-this._mainColorTarget]}get framebuffer(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}getFramebuffer(e,r){return this._renderTargetHelper.getFramebuffer(this.width,this.height,e,r)}get colorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}get depthTexture(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}get linearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}get terrainLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}get geometryLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}get lastFrameColorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}get normalTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}get highlightTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}get hudVisibilityTexture(){return this._getColorTexture(this.hudVisibility)}get tmpColorTexture(){return this._getColorTexture(this.tmpColor)}get hudColorTexture(){return this._getColorTexture(this.hudColor)}get mainColorTexture(){return this._getColorTexture(this.currentColorTarget)}setupRenderTarget(e){e?this._mainColorTarget=this._mainColorTarget?0:1:(this._mainColorTarget=0,this.disposeTarget(this._mainColorTargets[1]))}initializeFrame(e){const r=this._rctx;this.width=e.fullWidth,this.height=e.fullHeight,sw(this,r.parameters.maxTextureSize),this.bindTarget(this.currentColorTarget,this.mainDepth),r.setClearStencil(0);const i=this._background.color;r.setClearColor(i[0]*i[3],i[1]*i[3],i[2]*i[3],i[3]),r.clearSafe(Si.COLOR_BUFFER_BIT|Si.DEPTH_BUFFER_BIT|Si.STENCIL_BUFFER_BIT)}composite(e){this.colorTexture!=null&&this._compositingHelper.composite(e,this.colorTexture,pa.None)}renderTmpAndCompositeToMain(e,r,i,s=!1){this.renderToTargets(e,this.tmpColor,s?this.tmpDepth:this.mainDepth,$1t),this._compositingHelper.composite(r,this._getColorTexture(this.tmpColor),i)}compositeAtmosphereToMain(e,r,i,s){this.bindTarget(this.currentColorTarget),this._compositingHelper.compositeAtmosphere(e,this._renderTargetHelper.getColorTexture(this.tmpColor,this.width,this.height),i,s,r),this.bindTarget(this.currentColorTarget,this.mainDepth)}renderHUDVisibility(e,r=!1){this.renderToTargets(e,this.hudVisibility,r?this.tmpDepth:this.mainDepth,L1t)}compositeTransparentTerrainOntoHUDVisibility(e){this.renderToTargets(()=>this._compositingHelper.compositeHUD(e,this._getColorTexture(this.tmpColor)),this.hudVisibility,this.tmpDepth)}renderOITPass(e,r,i){let s,n;switch(r){case dt.Color:s=this.colorFloatTarget,n=[0,0,0,0];break;case dt.Alpha:s=this.alphaFloatTarget,n=[1,1,1,1];break;case dt.FrontFace:s=this.frontFaceTarget,n=[0,0,0,0];break;case dt.NONE:case dt.COUNT:return}i?this.renderToTargets(e,s,this.tmpDepth,n,!0,!0):this.renderToTargets(e,s,this.mainDepth,n,!1)}compositeTransparentTerrainOntoMain(e){this.bindFramebuffer(),this._compositingHelper.composite(e,this._getColorTexture(this.tmpColor),pa.PremultipliedAlpha)}compositeOccludedOntoMain(e,r){this.bindFramebuffer(),this._compositingHelper.composite(e,this._getColorTexture(this.tmpColor),pa.PremultipliedAlpha,r)}compositeTransparentOntoOpaque(e,r){r?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clearSafe(Si.COLOR_BUFFER_BIT)):this.bindFramebuffer(),this._compositingHelper.compositeOIT(e,this._getColorTexture(this.colorFloatTarget),this._getColorTexture(this.alphaFloatTarget),this._getColorTexture(this.frontFaceTarget))}bindFramebuffer(){this._rctx.bindFramebuffer(this.framebuffer)}renderDepthDetached(e){this.bindTarget(this.currentColorTarget),e(),this.bindTarget(this.currentColorTarget,this.mainDepth)}disposeTarget(e){this._renderTargetHelper.disposeTargetResource(e)}renderToFBO(e,r,i=!1,s=!1){const n=this._rctx;let o=0;if(r){const l=Math.max(1e-13,r[3]);n.setClearColor(r[0],r[1],r[2],l),o|=Si.COLOR_BUFFER_BIT}i&&(o|=Si.DEPTH_BUFFER_BIT),s===!1?s=0:(s===!0&&(s=255),o|=Si.STENCIL_BUFFER_BIT),o&&n.clearSafe(o,s),e(),n.gl.flush(),this.bindTarget(this.currentColorTarget,this.mainDepth)}renderToTargets(e,r,i,s,n=!1,o=!1){const a=this.bindTarget(r,i);return this.renderToFBO(e,s,n,o),a}bindTarget(e,r){const i=this._renderTargetHelper.getFramebuffer(this.width,this.height,e,r);return this._rctx.bindFramebuffer(i),i}_getColorTexture(e){return this._renderTargetHelper.getColorTexture(e,this.width,this.height)}get gpuMemoryUsage(){let e=0;return this._renderTargetHelper&&(e+=this._renderTargetHelper.gpuMemoryUsage),e}};const $1t=[0,0,0,0],L1t=[0,1,0,1];let RO=class extends Te{constructor(e){super({}),this._context=e,this._renderPlugins=new Vt,this._slots=[];for(let r=0;r<pe.MAX_SLOTS;++r)this._slots[r]=[]}normalizeCtorArgs(){return{}}add(e,r,i){const s=()=>{if(i?.aborted)throw r.uninitializeRenderContext(),zr();this._renderPlugins.push(r);for(const o of e)this._slots[o].push(r);this._context.requestRender()},n=r.initializeRenderContext(this._context,i);if(ku(n))return n.then(s);s(),this.notifyChange("_renderPlugins")}remove(e){if(this._renderPlugins.removeUnordered(e)!=null){for(let r=0;r<this._slots.length;++r)this._slots[r]=this._slots[r].filter(i=>i!==e);e.uninitializeRenderContext(),this._context.requestRender(),this.notifyChange("_renderPlugins")}}prepareRender(){this._renderPlugins.forAll(e=>{e.prepareRender&&e.prepareRender(this._context.renderContext)})}updateAnimation(e){let r=!1;return this._renderPlugins.forAll(i=>{i.updateAnimation&&(r=i.updateAnimation(e)||r)}),r}prepareSlots(e){for(const r of e)this._context.renderContext.bindParameters.slot=r,this._slots[r].filter(i=>{i.canRender&&(Mde(i)&&i.prepareTechnique(this._context.renderContext),Pde(i)&&i.prepareTechniques(this._context.renderContext))})}render(){const e=this._slots[this._context.renderContext.bindParameters.slot],r=new Array;e.filter(i=>{if(!i.canRender)return!1;if(Mde(i)){const s=i.prepareTechnique(this._context.renderContext);return s!=null&&(r.push(s),!0)}if(Pde(i)){const s=i.prepareTechniques(this._context.renderContext);return s!=null&&(r.push(s),!0)}return r.push(null),!0}).forEach((i,s)=>i.render(this._context.renderContext,r[s]))}queryDepthRange(e){const r=D1t;return r.near=1/0,r.far=-1/0,this._renderPlugins.forAll(i=>{if(i.queryDepthRange){const s=i.queryDepthRange(e);s&&iC(r,s,r)}}),r}get updating(){return this._renderPlugins.some(e=>e.running)}get needsTransparentPass(){return this._renderPlugins.some(e=>e.needsTransparentPass)}get needsHighlight(){return this._renderPlugins.some(e=>e.needsHighlight)}get needsLinearDepth(){return this._renderPlugins.some(e=>e.needsLinearDepth)}get needsLaserlineWithContrastControl(){const e=this._slots[pe.LASERLINES_CONTRAST_CONTROL];return!!e&&e.length>0}get renderOccludedFlags(){return this._renderPlugins.reduce((e,r)=>e|r.renderOccludedFlags,Ni.None)}};function Mde(t){return"prepareTechnique"in t}function Pde(t){return"prepareTechniques"in t}u([p()],RO.prototype,"_renderPlugins",void 0),u([p({readOnly:!0})],RO.prototype,"updating",null),RO=u([P("esri.views.3d.webgl-engine.lib.RenderPluginManager")],RO);const D1t={near:0,far:0};let FMe=class extends NK{};const Z9=255,N1t=1/Z9;function F1t(t){const e=new Sr,r=e.fragment;return r.include(Bc),r.include(Nu),e.include(R9),e.include(id),e.include(O9,t),r.uniforms.add(new rt("depthMap",i=>i.linearDepthTexture),new Ui("inverseViewMatrix",(i,s)=>$n(Ide,Gl(Ide,s.camera.viewMatrix,s.camera.center))),new Ar("nearFar",(i,s)=>s.camera.nearFar)),r.constants.add("sampleValue","float",N1t),r.code.add(w`void main(void) {
float depth = rgba2float(texture(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
fragColor = vec4(sampleValue);
}`),e}const Ide=xe(),U1t=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastAccumulatePassParameters:FMe,ShadowCastMaxSamples:Z9,build:F1t},Symbol.toStringTag,{value:"Module"}));var lx;(function(t){t[t.Gradient=0]="Gradient",t[t.Threshold=1]="Threshold",t[t.COUNT=2]="COUNT"})(lx||(lx={}));let bW=class extends Sa{constructor(){super(...arguments),this.visualization=lx.Gradient,this.bandsEnabled=!1}};u([B({count:lx.COUNT})],bW.prototype,"visualization",void 0),u([B()],bW.prototype,"bandsEnabled",void 0);let UMe=class extends ii{constructor(e){super(),this._data=e,this.sampleScale=0,this.opacityFromElevation=1,this.color=OP(k1t),this.bandSize=.1,this.threshold=.5}get shadowCastMap(){return this._data.shadowCastTexture}};const k1t=Nt(.01,0,.25,1);function z1t(t){const e=new Sr,r=e.fragment;r.include(Bc),r.include(Nu),e.include(R9),e.include(id);const{visualization:i,bandsEnabled:s}=t;r.constants.add("inverseSampleValue","float",Z9),r.uniforms.add(new rt("shadowCastMap",a=>a.shadowCastMap),new Ie("sampleScale",a=>a.sampleScale),new Ie("opacityFromElevation",a=>a.opacityFromElevation),new sr("uColor",a=>a.color));const n=i===lx.Gradient,o=i===lx.Threshold;return n&&s?r.uniforms.add(new Ie("bandSize",a=>a.bandSize)):o&&r.uniforms.add(new Ie("threshold",a=>a.threshold)),r.code.add(w`
      void main(void) {
        vec4 record = texture(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${o?w`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${n&&s?w`strength = ceil(strength / bandSize) * bandSize;`:""}

        fragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${n?w`* strength`:""});
      }
    `),e}const V1t=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:UMe,build:z1t},Symbol.toStringTag,{value:"Module"}));let kMe=class zMe extends Lr{constructor(e,r){super(e,r,()=>this.destroy())}initializeProgram(e){return new Rr(e.rctx,zMe.shader.get().build(this.configuration),Tr)}initializePipeline(){return Mt({blending:Ru,colorWrite:Bt,depthTest:null,depthWrite:null})}get primitiveType(){return At.TRIANGLE_STRIP}};kMe.shader=new Or(V1t,()=>he(()=>import("./ShadowCastVisualize.glsl-6779a58c.js"),[],import.meta.url));const B1t=4e4,G1t=5e4,VMe=1/512;let r4=class extends Te{constructor(e,r,i,s){super({}),this._techniqueRepository=e,this._rctx=r,this._data=i,this._requestRender=s,this._passParameters=new UMe(this._data),this._techniqueConfig=new bW,this._enabled=!1,this._vao=Hl(r),this._techniqueConfig.visualization=lx.Gradient}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=je(this._vao),this._techniqueRepository.release(this._technique),this._technique=null}get _visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(kMe,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._showVisualization)return;this._passParameters.sampleScale=1/this._data.computedSamples;const r=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(r,this._passParameters,e),this._rctx.drawArrays(r.primitiveType,0,Go(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&this._data.computedSamples>0&&this.opacityFromElevation>VMe}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const r=this._passParameters.color;MS(e,r)||(Nh(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};u([p()],r4.prototype,"opacityFromElevation",null),r4=u([P("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],r4);let Fee=class extends Sa{constructor(){super(...arguments),this.receiveShadows=!0}};u([B()],Fee.prototype,"receiveShadows",void 0);let BMe=class GMe extends Lr{constructor(e){super(e,new Fee,()=>this.destroy())}initializeProgram(e){return new Rr(e.rctx,GMe.shader.get().build(this.configuration),Tr)}initializePipeline(){return Mt({blending:Oo(Se.ONE,Se.ONE,Se.ONE,Se.ONE),colorWrite:Bt,depthTest:null,depthWrite:null})}get primitiveType(){return At.TRIANGLE_STRIP}};BMe.shader=new Or(U1t,()=>he(()=>import("./ShadowCastAccumulate.glsl-fc38930b.js"),[],import.meta.url));let El=class extends Te{constructor(e,r,i,s,n,o){super({}),this._rctx=e,this._stage=i,this._prepareForShadowMapPass=s,this._renderToShadowMap=n,this._requestRender=o,this._progress=0,this._sampleCount=0,this._passParameters=new FMe,this._cachedLightDirections=[],this._depthRange=dW,this._previewing=!1,this._handles=new $i,this._cameraForcedForScreenshot=!1,this._bindParameters=new V8(new LK(e,i.viewingMode),null,null),this._bindParameters.shadowMap.enabled=!0,this._vao=Hl(e),this._accumulationRenderer=new r4(r,e,this,o);const a=this._stage.view.resourceController.scheduler;this._handles.add([a.registerTask(vt.SHADOW_ACCUMULATOR,this),le(()=>i.renderView,l=>{this._handles.remove($de),l!=null&&this._handles.add(l.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),$de)},Ls),le(()=>this._previewing,()=>this._requestRenderIfEnabled(),Wr)])}normalizeCtorArgs(){return{}}dispose(){this._disable(),this._handles.destroy(),this._accumulationRenderer=je(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=je(this._fbo),this._vao=je(this._vao),this._accumulationTechniqueCached=Gi(this._accumulationTechniqueCached),this._cachedLightDirections.length=0,this._sampleCount=0}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo?.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _accumulationTechnique(){if(this._accumulationTechniqueCached==null){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechniqueCached=new BMe(e)}return this._accumulationTechniqueCached}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._fbo!=null&&this._sampleCount>0}get canAccumulate(){return this._passParameters.linearDepthTexture!==null&&this._depthRange!==dW&&this._opacityFromElevation>VMe}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const r=this._cachedLightDirections;if(u0(r,e,nv))return;const i=Math.min(Z9,e.length);r.length=i,this._sampleCount=i;for(let s=0;s<i;++s)r[s]=ie(r[s]??O(),e[s]);this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,r,i,s){if(this._depthRange=r,this._updateCamera(i),this._bindParameters.contentCamera=s,this._passParameters.linearDepthTexture=e,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const n=this._cameraForcedForScreenshot?this._sampleCount:Math.min(j1t,this._sampleCount-this._progress);for(let o=0;o<n;++o)this._accumulateShadow();this._cameraForcedForScreenshot=!1,this._requestRender()}render(e){this._accumulationRenderer.render(e)}setOptions(e){if(e.enabled!==void 0){const r=this._fbo!=null;e.enabled!==r&&(e.enabled?this._enable():this._disable())}e.previewing!==void 0&&(this._previewing=e.previewing),e.lightDirections!==void 0&&(this._lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}readAccumulatedShadow(e,r){return!this._isActive||!this._fbo||this._progress<1||e<0||e>=this._fbo.width||r<0||r>=this._fbo.height?0:(this._fbo.readPixels(e,r,1,1,Ct.RGBA,qs.UNSIGNED_BYTE,Lde),Lde[0]/this._progress)}_enable(){this._progress=0;const e=new xr;e.wrapMode=Dt.CLAMP_TO_EDGE,this._fbo=new fn(this._rctx,e)}_disable(){this._fbo=je(this._fbo)}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(Si.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._sampleLightDirection(),this._depthRange);const e=this._accumulationTechnique;this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(e,this._passParameters,this._bindParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(e.primitiveType,0,Go(this._vao,"geometry"))}_sampleLightDirection(){return this._progress++,this._lightDirections[this._progress*H1t%this._lightDirections.length]}_updateCamera(e){!e.equals(this._bindParameters.camera)&&this._fbo&&(this._bindParameters.camera.copyFrom(e),this._fbo.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-aM(B1t,G1t,e.relativeElevation))}_requestRenderIfEnabled(){this._fbo&&this._requestRender()}get test(){const e=this;return{lightDirections:this._lightDirections,get isDone(){return e._isDoneAccumulating},get isActive(){return e._isActive}}}};u([p()],El.prototype,"_progress",void 0),u([p()],El.prototype,"_sampleCount",void 0),u([p()],El.prototype,"_fbo",void 0),u([p()],El.prototype,"_depthRange",void 0),u([p()],El.prototype,"_previewing",void 0),u([p()],El.prototype,"_accumulationRenderer",void 0),u([p()],El.prototype,"_isRefining",null),u([p()],El.prototype,"_isActive",null),u([p()],El.prototype,"canAccumulate",null),u([p()],El.prototype,"_isDoneAccumulating",null),u([p()],El.prototype,"_opacityFromElevation",null),u([p()],El.prototype,"running",null),El=u([P("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],El);const j1t=6,$de="renderView",H1t=104729,Lde=new Uint8Array(4),Dde={highlightedThreshold:.99999,selfShadowThreshold:.025};function q1t(t){const e=new Sr;e.include(rx,t);const r=e.fragment;return r.include(Bc),r.include(Nu),e.include(R9),e.include(id),r.uniforms.add(new rt("defaultDepthTex",(i,s)=>s.shadowMap.getSnapshot(KE.Default)),new rt("highlightDepthTex",(i,s)=>s.shadowMap.getSnapshot(KE.Highlight)),new rt("depthMap",(i,s)=>s.linearDepthTexture),new rt("highlightMap",(i,s)=>s.highlightColorTexture),new sr("uColor",i=>i.shadowColor),new Ar("nearFar",(i,s)=>s.camera.nearFar),new Ie("opacity",i=>i.shadowOpacity),new Ie("occludedOpacity",i=>i.occludedShadowOpacity),new Ie("terminationFactor",i=>i.opacityElevation*i.dayNightTerminator),new kt("lightingMainDirectionView",(i,s)=>_e(Fde,ze(Fde,s.lighting.mainLight.direction,s.camera.viewInverseTransposeMatrix))),new Ar("texelSize",(i,s)=>s.linearDepthTexture!=null?or(W1t,1/s.linearDepthTexture.descriptor.width,1/s.linearDepthTexture.descriptor.height):Pp),new Ui("inverseViewMatrix",(i,s)=>$n(Nde,Gl(Nde,s.camera.viewMatrix,s.camera.center)))),r.constants.add("unoccludedHighlightFlag","vec4",aEe).add("highlightedThreshold","float",Dde.highlightedThreshold).add("selfShadowThreshold","float",Dde.selfShadowThreshold),r.code.add(w`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`),r.code.add(w`void main(void) {
vec4 highlightInfo = texture(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
fragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`),e}const Nde=xe(),Fde=O(),W1t=He(),X1t=Object.freeze(Object.defineProperty({__proto__:null,build:q1t},Symbol.toStringTag,{value:"Module"}));let Y1t=class extends NK{constructor(){super(...arguments),this.shadowColor=Nt(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}},jMe=class HMe extends Lr{constructor(e){super(e,new Fee,()=>this.destroy())}initializeProgram(e){return new Rr(e.rctx,HMe.shader.get().build(this.configuration),Tr)}initializePipeline(){return Mt({blending:Oo(Se.SRC_ALPHA,Se.ONE,Se.ONE_MINUS_SRC_ALPHA,Se.ONE_MINUS_SRC_ALPHA),colorWrite:Bt,depthTest:null,depthWrite:null})}get primitiveType(){return At.TRIANGLE_STRIP}};jMe.shader=new Or(X1t,()=>he(()=>import("./ShadowHighlight.glsl-3bd7f1f4.js"),[],import.meta.url));const Z1t=.001953125,J1t=4e4,Q1t=5e4;let K1t=class{constructor(e,r){this._rctx=e,this._viewingMode=r,this._maxOpacity=1,this._passParameters=new Y1t,this._drawParameters=new Tot,this._vao=Hl(this._rctx)}get _technique(){return this._techniqueCached==null&&(this._techniqueCached=new jMe({rctx:this._rctx,viewingMode:this._viewingMode})),this._techniqueCached}render(e,r){if(!e.shadowMap.enabled||!e.linearDepthTexture||!this.isVisible)return;const i=this._technique;this._drawParameters.origin=e.camera.center,this._rctx.bindFramebuffer(r),this._rctx.bindTechnique(i,this._passParameters,e).bindDraw(this._drawParameters,e,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(i.primitiveType,0,Go(this._vao,"geometry"))}get gpuMemoryUsage(){return this._vao?.memoryEstimate??0}setDefaultOptions(e){this._passParameters={...this._passParameters,...e},this._updateMaxOpacity()}updateParameters(e,r){this._passParameters.opacityElevation=1-aM(J1t,Q1t,e.relativeElevation);const i=this._viewingMode===Ve.Global?_e(Ude,e.center):ne(Ude,0,0,1),s=ye(i,r);this._passParameters.dayNightTerminator=aM(0,1,ve(30*s,0,1))}dispose(){this._vao=je(this._vao),this._techniqueCached=Gi(this._techniqueCached)}get isVisible(){const{opacityElevation:e,dayNightTerminator:r}=this._passParameters;return this._maxOpacity*e*r>=Z1t}_updateMaxOpacity(){const e=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=e*this._passParameters.shadowColor[3]}};const Ude=O(),kde=P0();let ebt=class{constructor(){this._plane=P0()}get isEnabled(){return!rwe(this.plane,kde)}get plane(){return this._plane}set plane(e){Mx(e||kde,this._plane)}},tbt=class extends ii{};function YM(t){t.uniforms.add(new sr("resolution",e=>{const{descriptor:r}=e.colorTexture,i=r.width,s=r.height;return Ti(rbt,1/i,1/s,i,s)}))}const rbt=Wt(),XT={maxSearchSteps:8,maxDistanceAreaTex:16};function ibt(){const t=new Sr,{attributes:e,varyings:r,vertex:i,fragment:s}=t;return e.add(C.POSITION,"vec2"),r.add("uv","vec2"),r.add("offsets[2]","vec4"),r.add("maxOffset","vec4"),r.add("pixelCoord","vec2"),YM(i),i.code.add(w`
      void main() {
        uv = position * 0.5 + vec2(0.5);
        gl_Position = vec4(position, 0, 1);

        pixelCoord = uv * resolution.zw;
        offsets[0] = uv.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        offsets[1] = uv.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        maxOffset = vec4( offsets[0].xz, offsets[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${w.int(XT.maxSearchSteps)} );
      }
    `),s.uniforms.add(new rt("edgesTexture",n=>n.edges.colorTexture)),s.uniforms.add(new rt("areaTexture",n=>n.areaTexture)),s.uniforms.add(new rt("searchTexture",n=>n.searchTexture)),YM(s),s.code.add(w`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 sampleLevelZeroOffset(sampler2D tex, vec2 coord, vec2 offset) {
        return texture(tex, coord + offset.x * resolution.xy, 0.0);
      }

      float searchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
        e.r = bias + e.r * scale;
        return 255.0 * texture( searchTex, e, 0.0 ).r;
      }

      float searchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${w.int(XT.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * searchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float searchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${w.int(XT.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * searchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float searchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${w.int(XT.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * searchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float searchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${w.int(XT.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * searchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 getArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${w.int(XT.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture( areaTex, texcoord, 0.0 ).rg;
      }

      void main() {
        ivec4 subsampleIndices = ivec4(0.0);
        vec4 weights = vec4(0.0);
        vec2 e = texture( edgesTexture, uv ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = searchXLeft( edgesTexture, searchTexture, offsets[0].xy, maxOffset.x );
          coords.y = offsets[1].y;
          d.x = coords.x;
          float e1 = texture( edgesTexture, coords, 0.0 ).r;
          coords.x = searchXRight( edgesTexture, searchTexture, offsets[0].zw, maxOffset.y );
          d.y = coords.x;
          d = d * resolution.z - pixelCoord.x;
          vec2 sqrt_d = sqrt( abs(d) );
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = searchYUp( edgesTexture, searchTexture, offsets[1].xy, maxOffset.z );
          coords.x = offsets[0].x;
          d.x = coords.y;
          float e1 = texture( edgesTexture, coords, 0.0 ).g;
          coords.y = searchYDown( edgesTexture, searchTexture, offsets[1].zw, maxOffset.w );
          d.y = coords.y;
          d = d * resolution.w - pixelCoord.y;
          vec2 sqrt_d = sqrt(abs(d));
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2(0.0, 1.0)).g;
          weights.ba = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
        }
        fragColor = weights;
      }
    `),t}const sbt=Object.freeze(Object.defineProperty({__proto__:null,build:ibt},Symbol.toStringTag,{value:"Module"}));let qMe=class WMe extends Lr{initializeProgram(e){return new Rr(e.rctx,WMe.shader.get().build(),Tr)}initializePipeline(){return Mt({colorWrite:Bt})}};qMe.shader=new Or(sbt,()=>he(()=>import("./BlendWeights.glsl-75ba1002.js"),[],import.meta.url));function nbt(){const t=new Sr,{attributes:e,varyings:r,vertex:i,fragment:s}=t;return e.add(C.POSITION,"vec2"),r.add("uv","vec2"),r.add("offsets[2]","vec4"),YM(i),i.code.add(w`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}`),s.uniforms.add(new rt("blendWeightsTexture",n=>n.blend.colorTexture),new rt("colorTexture",n=>n.colorTexture)),YM(s),s.code.add(w`void main() {
vec4 a;
a.rb = texture(blendWeightsTexture, uv).rb;
a.g = texture(blendWeightsTexture, offsets[1].zw).g;
a.a = texture(blendWeightsTexture, offsets[1].xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
fragColor = texture( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture( colorTexture, uv, 0.0 );
vec4 Cop = texture( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
fragColor = mix(C, Cop, s);
}
}`),t}const obt=Object.freeze(Object.defineProperty({__proto__:null,build:nbt},Symbol.toStringTag,{value:"Module"}));let XMe=class YMe extends Lr{initializeProgram(e){return new Rr(e.rctx,YMe.shader.get().build(),Tr)}initializePipeline(){return Mt({colorWrite:Bt})}};XMe.shader=new Or(obt,()=>he(()=>import("./Blur.glsl-9ec9ee34.js"),[],import.meta.url));const zde={threshold:.05,localConstrastAdaption:2};function abt(){const t=new Sr,{attributes:e,varyings:r,vertex:i,fragment:s}=t;return e.add(C.POSITION,"vec2"),YM(i),r.add("uv","vec2"),r.add("offsets[3]","vec4"),i.code.add(w`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
offsets[2] = uv.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}`),s.uniforms.add(new rt("colorTexture",n=>n.colorTexture)),s.code.add(w`
    float absMax3(vec3 v) {
      vec3 t = abs(v);
      return max(max(t.r, t.g), t.b);
    }

    void main() {
      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture(colorTexture, uv).rgb;

      vec3 Cleft = texture(colorTexture, offsets[0].xy).rgb;
      delta.x = absMax3(C - Cleft);

      vec3 Ctop = texture(colorTexture, offsets[0].zw).rgb;
      delta.y = absMax3(C - Ctop);

      vec2 edges = step(vec2(${w.float(zde.threshold)}), delta.xy);

      // discard if there is no edge:
      if (dot(edges, vec2(1.0)) == 0.0) {
        discard;
      }

      // Calculate right and bottom deltas:
      vec3 Cright = texture(colorTexture, offsets[1].xy).rgb;
      delta.z = absMax3(C - Cright);

      vec3 Cbottom  = texture(colorTexture, offsets[1].zw).rgb;
      delta.w = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture(colorTexture, offsets[2].xy).rgb;
      delta.z = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture(colorTexture, offsets[2].zw).rgb;
      delta.w = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, delta.z), delta.w);

      // Local contrast adaptation in action:
      edges.xy *= step(maxDelta, float(${w.float(zde.localConstrastAdaption)}) * delta.xy);

      fragColor = vec4(edges, 0.0, 0.0);
    }
  `),t}const lbt=Object.freeze(Object.defineProperty({__proto__:null,build:abt},Symbol.toStringTag,{value:"Module"}));let ZMe=class JMe extends Lr{initializeProgram(e){return new Rr(e.rctx,JMe.shader.get().build(),Tr)}initializePipeline(){return Mt({colorWrite:Bt})}};ZMe.shader=new Or(lbt,()=>he(()=>import("./EdgeDetect.glsl-4ad41c2b.js"),[],import.meta.url));let MO=class extends Te{constructor(e,r){super({}),this._rctx=e,this._techniqueRep=r,this._passParameters=new tbt,this._isEnabled=!1}normalizeCtorArgs(){return{}}dispose(){this._abortController=zl(this._abortController),this.disable()}_loadResources(e){if(this._abortController!=null)return!1;if(this._passParameters.searchTexture!=null)return!0;this._abortController=new AbortController;const r=this._abortController.signal;return he(()=>import("./SmaaRenderPassData-660b7d34.js"),[],import.meta.url).then(i=>this._loadTextures(i,r)).then(()=>e()).finally(()=>this._abortController=null),!1}_loadTextures(e,r){return Yt(r),Promise.all([this._loadTextureFromBase64(e.areaTexture,Rt.LINEAR,Ct.RGB),this._loadTextureFromBase64(e.searchTexure,Rt.NEAREST,Ct.LUMINANCE)]).then(([i,s])=>{Mn(r)?(i.dispose(),s.dispose(),Yt(r)):(this._passParameters.areaTexture=i,this._passParameters.searchTexture=s)})}get updating(){return this._abortController!=null}enable(e){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const s=new Sa;this._edgeDetectTechnique=this._techniqueRep.releaseAndAcquire(ZMe,s,this._edgeDetectTechnique),this._blendWeightsTechnique=this._techniqueRep.releaseAndAcquire(qMe,s,this._blendWeightsTechnique),this._blurTechnique=this._techniqueRep.releaseAndAcquire(XMe,s,this._blurTechnique)}if(!this._loadResources(e))return!1;this._vao=eWe(this._rctx);const r=new xr(4,4);r.pixelFormat=Ct.RG,r.internalFormat=Ke.RG8,r.wrapMode=Dt.CLAMP_TO_EDGE,this._passParameters.edges=new fn(this._rctx,r);const i=new xr(4,4);return i.pixelFormat=Ct.RGBA,i.wrapMode=Dt.CLAMP_TO_EDGE,this._passParameters.blend=new fn(this._rctx,i),this._isEnabled=!0,!0}disable(){this._isEnabled&&(this._vao=je(this._vao),this._passParameters.areaTexture=je(this._passParameters.areaTexture),this._passParameters.searchTexture=je(this._passParameters.searchTexture),this._passParameters.blend=je(this._passParameters.blend),this._passParameters.edges=je(this._passParameters.edges),this._isEnabled=!1)}get _validPassParameters(){return this._isEnabled?this._passParameters:null}render(e){const r=this._validPassParameters;if(r==null)return;r.colorTexture=e;const i=this._rctx,s=i.getBoundFramebufferObject(),n=e.descriptor.width,o=e.descriptor.height;i.bindVAO(this._vao),i.setViewport(0,0,n,o),r.edges.resize(n,o),i.bindFramebuffer(r.edges),i.setClearColor(0,0,0,1),i.clear(Si.COLOR_BUFFER_BIT),i.bindTechnique(this._edgeDetectTechnique,r,null),i.drawArrays(At.TRIANGLES,0,3),r.blend.resize(n,o),i.bindFramebuffer(r.blend),i.setClearColor(0,0,1,1),i.clear(Si.COLOR_BUFFER_BIT),i.bindTechnique(this._blendWeightsTechnique,r,null),i.drawArrays(At.TRIANGLES,0,3),i.bindFramebuffer(s),i.setClearColor(0,1,0,1),i.clear(Si.COLOR_BUFFER_BIT),i.bindTechnique(this._blurTechnique,r,null),i.drawArrays(At.TRIANGLES,0,3)}_loadTextureFromBase64(e,r,i){return E0(e).then(s=>{const n=new xr;return n.pixelFormat=i,n.wrapMode=Dt.CLAMP_TO_EDGE,n.width=s.width,n.height=s.height,n.samplingMode=r,new Ot(this._rctx,n,s)})}};u([p()],MO.prototype,"_abortController",void 0),u([p({readOnly:!0})],MO.prototype,"updating",null),MO=u([P("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],MO);function cbt(t,e){const r=-t[0],i=-t[1],s=-t[2],n=e[3],o=e[7],a=e[11],l=e[15];e[0]+=n*r,e[1]+=n*i,e[2]+=n*s,e[4]+=o*r,e[5]+=o*i,e[6]+=o*s,e[8]+=a*r,e[9]+=a*i,e[10]+=a*s,e[12]+=l*r,e[13]+=l*i,e[14]+=l*s}function ubt(t,e){const r=t[0],i=t[1],s=t[2];e[12]+=r*e[0]+i*e[4]+s*e[8],e[13]+=r*e[1]+i*e[5]+s*e[9],e[14]+=r*e[2]+i*e[6]+s*e[10],e[14]+=r*e[3]+i*e[7]+s*e[11]}let hbt=class{constructor(e){this._factory=e,this._originData=new Map}acquire(e){return this.register(this._factory.getOrigin(e))}register(e){const r=this._originData.get(e.id)||new dbt(e);return r.refCount++,this._originData.has(r.origin.id)||this._originData.set(r.origin.id,r),r}release(e){e.refCount--,e.refCount===0&&this._originData.delete(e.origin.id)}updateViewMatrices(e){this._originData.forEach(r=>{zs(r.viewMatrix,e),ubt(r.origin.vec3,r.viewMatrix)})}},dbt=class{constructor(e){this.origin=e,this.refCount=0,this.viewMatrix=xe()}},pbt=class extends wTe{constructor(e,r){super(),this.distanceFalloffFactor=e,this.transparency=r,this.transformNormalViewFromGlobal=ki()}},fbt=class extends xTe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=ki(),this.slicePlaneLocalOrigin=O(),this.transformNormalGlobalFromModel=ki()}};function mbt(t){const e=w`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;t.code.add(e)}const gbt=fr(.5,-4e-4);function ybt(t,e){const r=t.vertex;r.include(mbt),r.constants.add("depthBias","vec2",gbt),r.uniforms.add(new Ar("inverseViewport",(i,s)=>s.inverseViewport)),e.legacy?(r.uniforms.add(new Ui("proj",(i,s)=>s.camera.projectionMatrix)),r.code.add(w`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(r.uniforms.add(new sd("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal),new Ui("transformProjFromView",i=>i.transformProjFromView)),r.code.add(w`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)),r.code.add(w`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}function _bt(t,e){const r=t.fragment;r.constants.add("coverageTestThreshold","float",.01),e.antialiasing?r.code.add(w`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):r.code.add(w`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)}function vbt(t,e){const r=t.vertex;e.silhouette?(r.code.add(w`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),e.legacy?r.code.add(w`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):r.code.add(w`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):r.code.add(w`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)}function bbt(t,e){const r=t.vertex;r.include(Bc),r.uniforms.add(new Ie("distanceFalloffFactor",i=>i.distanceFalloffFactor)),r.code.add(w`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),r.uniforms.add(new zh("componentDataTex",i=>i.componentDataTexture)),t.attributes.add(C.COMPONENTINDEX,"float"),r.constants.add("componentColorFieldOffset","float",0),r.constants.add("componentOtherFieldOffset","float",1),r.constants.add("componentVerticalOffsetFieldOffset","float",2),r.constants.add("componentFieldCount","float",3),r.constants.add("lineWidthFractionFactor","float",8),r.constants.add("extensionLengthOffset","float",128),r.constants.add("verticalOffsetScale","float",2*$ee),r.code.add(w`vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
float texSize = float(textureSize(componentDataTex, 0).x);
float colIndex = mod(fieldIndex, texSize);
float rowIndex = floor(fieldIndex / texSize);
return vec2(colIndex, rowIndex) + 0.5;
}
struct ComponentData {
vec4 color;
float lineWidth;
float extensionLength;
float type;
float verticalOffset;
};
ComponentData readComponentData() {
vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
vec4 colorValue = texelFetch(componentDataTex, ivec2(colorIndex), 0);
vec4 otherValue = texelFetch(componentDataTex, ivec2(otherIndex), 0);
float verticalOffset = (rgba2float(texelFetch(componentDataTex, ivec2(verticalOffsetIndex), 0)) - 0.5) * verticalOffsetScale;
return ComponentData(
vec4(colorValue.rgb, colorValue.a * otherValue.w),
otherValue.x * (255.0 / lineWidthFractionFactor),
otherValue.y * 255.0 - extensionLengthOffset,
-(otherValue.z * 255.0) + 0.5,
verticalOffset
);
}`),e.legacy?r.code.add(w`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(r.uniforms.add(new SM("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel)),r.code.add(w`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),e.silhouette?(t.attributes.add(C.NORMALA,"vec3"),t.attributes.add(C.NORMALB,"vec3"),r.code.add(w`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(t.attributes.add(C.NORMAL,"vec3"),r.code.add(w`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`)),e.legacy?r.code.add(w`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(r.include(H5,e),r.include(H5,e),r.uniforms.add(new sd("transformViewFromCameraRelativeRS",i=>i.transformViewFromCameraRelativeRS),new SM("transformWorldFromModelRS",i=>i.transformWorldFromModelRS),new Ou("transformWorldFromModelTL",i=>i.transformWorldFromModelTL),new Ou("transformWorldFromModelTH",i=>i.transformWorldFromModelTH),new kt("transformWorldFromViewTL",i=>i.transformWorldFromViewTL),new kt("transformWorldFromViewTH",i=>i.transformWorldFromViewTH)),r.code.add(w`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${e.spherical?w`normalize(transformWorldFromModelTL + rotatedModelPosition);`:w`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),r.uniforms.add(new Ui("transformProjFromView",(i,s)=>s.camera.projectionMatrix)),r.code.add(w`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),r.code.add(w`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function wbt(t){return t.mode===hn.SKETCH||t.mode===hn.MIXED}var hn,Yb;(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH",t[t.MIXED=2]="MIXED",t[t.COUNT=3]="COUNT"})(hn||(hn={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.SILHOUETTE=1]="SILHOUETTE"}(Yb||(Yb={}));function Uee(t,e){const r=t.vertex;switch(t.attributes.add(C.SIDENESS,"vec2"),e.mode===hn.MIXED?r.code.add(w`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):r.code.add(w`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),e.mode){case hn.MIXED:r.code.add(w`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case hn.SKETCH:r.code.add(w`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case hn.SOLID:r.code.add(w`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case hn.COUNT:break;default:e.mode}}function xbt(t,e){const r=t.vertex;switch(t.include(Uee,e),e.mode){case hn.SOLID:r.code.add(w`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case hn.SKETCH:r.uniforms.add(new Tw("strokesAmplitude",i=>i.strokesTexture.amplitude)),r.code.add(w`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case hn.MIXED:r.uniforms.add(new Tw("strokesAmplitude",i=>i.strokesTexture.amplitude)),r.code.add(w`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}}function Tbt(t,e){t.include(Uee,e);const{vertex:r,fragment:i}=t;switch(wbt(e)&&(r.uniforms.add(new zh("strokesTexture",s=>s.strokesTexture.texture)),r.uniforms.add(new Tw("strokesLog2Resolution",s=>Math.log2(s.strokesTexture.resolution)),new Tw("strokeVariants",s=>s.strokesTexture.variants)),t.varyings.add("vStrokeUV","vec2"),i.uniforms.add(new zh("strokesTexture",s=>s.strokesTexture.texture),new Tw("strokesNormalizationScale",s=>s.strokesTexture.normalizationScale)),r.code.add(w`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) / vec2(textureSize(strokesTexture, 0));
vStrokeUV.x += variantOffset;
}`),t.fragment.include(Bc),i.code.add(w`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),e.mode){case hn.SOLID:r.code.add(w`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),i.code.add(w`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case hn.SKETCH:r.code.add(w`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),i.code.add(w`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case hn.MIXED:t.varyings.add("vType","float"),r.code.add(w`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),i.code.add(w`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}function Sbt(t){const e=new Sr,{vertex:r,fragment:i}=e;return t.legacy&&r.uniforms.add(new Vde("model"),new Vde("localView")),e.include(ybt,t),e.include(bbt,t),e.include(xbt,t),e.include(Uee,t),e.include(Tbt,t),e.include(vs,t),e.include(vbt,t),e.include(_bt,t),e.include(Fu,t),e.varyings.add("vColor","vec4"),e.varyings.add("vRadius","float"),e.varyings.add("vPosition","vec3"),e.varyings.add("vWorldPosition","vec3"),e.varyings.add("vViewPos","vec3"),e.varyings.add("vLineLengthPixels","float"),e.varyings.add("vSizeFalloffFactor","float"),r.uniforms.add(new Ar("pixelToNDC",(s,n)=>or(Ebt,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new sr("viewport",(s,n)=>n.camera.fullViewport),new Ie("pixelRatio",(s,n)=>n.camera.pixelRatio)),e.attributes.add(C.POSITION0,"vec3"),e.attributes.add(C.POSITION1,"vec3"),e.attributes.add(C.VARIANTOFFSET,"float"),e.attributes.add(C.VARIANTSTROKE,"float"),e.attributes.add(C.VARIANTEXTENSION,"float"),r.code.add(w`
    const float opaqueCutoff = 1.0 / 255.0;

    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
      vec2 sideness = unpackedAttributes.sideness;
      vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

      vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;

      vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
      vViewPos = viewPos;

      vec4 projPosV0 = projFromViewPosition(viewPosV0);
      vec4 projPosV1 = projFromViewPosition(viewPosV1);
      vec4 projPos = projFromViewPosition(viewPos);

      vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
      vec2 ndcToPixel = viewport.zw * 0.5;
      vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
      float lineLengthPixels = length(screenSpaceLinePixels);

      float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
      vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;

      float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
      float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;

      float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
      float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;

      vSizeFalloffFactor = falloffFactor;

      float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
      float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;

      ${t.antialiasing?w`
        const float aaPaddingPixels = 1.0;

        // Line size with padding
        float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
        float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;`:w`
        float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
        float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;`}

      // Half line width in NDC including padding for anti aliasing
      vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
      vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
      vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;

      // Compute screen space position of vertex, offsetting for line size and end caps
      vec2 ndcOffset = (
          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
      );

      projPos.xy += ndcOffset * projPos.w;
      projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;

      projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));

      // Line length with end caps
      float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;

      float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;

      // Position in pixels with origin at first vertex of line segment
      vPosition = vec3(
        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
        pixelPositionAlongLine,
        pixelPositionAlongLine / extendedLineLengthPixels
      );

      // The line width radius in pixels
      vRadius = lineWidthPixels * 0.5;
      vLineLengthPixels = extendedLineLengthPixels;

      // discard short edges below a certain length threshold
      ${t.mode===hn.SKETCH?w`
        if (lineLengthPixels <= 3.0) {
          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
          return;
        }`:t.mode===hn.MIXED?w`
        if (lineLengthPixels <= 3.0 && unpackedAttributes.type <= 0.0) {
           gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
           return;
        }`:""}
      gl_Position = projPos;
    }

    void main() {
      ComponentData component = readComponentData();
      UnpackedAttributes unpackedAttributes = unpackAttributes(component);

      vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
      worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
      worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);

      // Component color
      vColor = component.color;

      // Discard fully transparent edges
      if (vColor.a < opaqueCutoff) {
        gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
        return;
      }

      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
        return;
      }

      // General geometric computation for all types of edges
      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);

      // Specific computation for different edge styles
      calculateStyleOutputs(unpackedAttributes);
    }
  `),i.code.add(w`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float positionX = position.x - calculateLineOffset();

      if (radius < 1.0) {
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);
        return vec2(0.5 - min(coverageX, coverageY), 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      fragColor = vec4(vColor.rgb, vColor.a * coverage);
    }
  `),e}const Ebt=He();let Vde=class extends ps{constructor(e){super(e,"mat4")}};const Cbt=Object.freeze(Object.defineProperty({__proto__:null,build:Sbt},Symbol.toStringTag,{value:"Module"}));let QMe=class KMe extends Lr{initializeProgram(e){return new Rr(e.rctx,KMe.shader.get().build(this.configuration),cMe)}initializePipeline(e){return e.blendMinMax?Mt({blending:Oo(Se.ONE,Se.ONE,Se.ZERO,Se.ONE,vm.ADD,e.blendMinMax.MAX),depthTest:{func:ri.LEQUAL},colorWrite:Bt}):Mt({depthTest:{func:ri.LEQUAL},depthWrite:jl,colorWrite:Bt})}};QMe.shader=new Or(Cbt,()=>he(()=>import("./EdgeShader.glsl-a9696df9.js"),[],import.meta.url));let Af=class extends jo{constructor(){super(...arguments),this.mode=hn.SOLID,this.hasSlicePlane=!1,this.silhouette=!1,this.legacy=!1,this.antialiasing=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.spherical=!1}};u([B({count:hn.COUNT})],Af.prototype,"mode",void 0),u([B()],Af.prototype,"hasSlicePlane",void 0),u([B()],Af.prototype,"silhouette",void 0),u([B()],Af.prototype,"legacy",void 0),u([B()],Af.prototype,"antialiasing",void 0),u([B()],Af.prototype,"doublePrecisionRequiresObfuscation",void 0),u([B()],Af.prototype,"hasMultipassTerrain",void 0),u([B()],Af.prototype,"cullAboveGround",void 0),u([B()],Af.prototype,"spherical",void 0);const Abt=8,IV=128,Obt={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0},Rbt={solid:hn.SOLID,sketch:hn.SKETCH,uber:hn.MIXED};let $V=class ePe{constructor(e,r,i){this._rctx=e,this._shaderTechniqueRepository=r,this._configuration=new Af,this.refCount=0,this._renderables=new Set,this._sortedRenderables={[jt.TRANSPARENT]:{[jt.TRANSPARENT]:new Vt,[jt.OPAQUE]:new Vt},[jt.OPAQUE]:{[jt.TRANSPARENT]:new Vt,[jt.OPAQUE]:new Vt}},this._renderablesDirty=!1,this._drawParameters=new fbt,this._settings={...Obt,...i},this.key=ePe.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);const s=this._settings.strokesTexture.variants;this.writerSettings={variants:s,reducedPrecision:li.TESTS_DISABLE_OPTIMIZATIONS},this._configuration.legacy=this._settings.legacy,this._configuration.mode=Rbt[this._settings.type],this._configuration.silhouette=!1,this._configuration.antialiasing=!!this._rctx.capabilities.blendMinMax,this._configuration.hasSlicePlane=this._settings.hasSlicePlane,this._configuration.doublePrecisionRequiresObfuscation=e.driverTest.doublePrecisionRequiresObfuscation.result,this._configuration.spherical=i.spherical}dispose(){this._technique=Gi(this._technique)}addRenderable(e){this._renderables.add(e),this._renderablesDirty=!0}removeRenderable(e){this._renderables.delete(e),this._renderablesDirty=!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(e,r){if(this._renderablesDirty&&this._sortRenderables(),r!==jt.INVISIBLE){const i=this._sortedRenderables[r];i[jt.TRANSPARENT].forAll(e),i[jt.OPAQUE].forAll(e)}}updateTechnique(e,r){return this._configuration.hasMultipassTerrain=!!e.multipassTerrain.enabled,this._configuration.cullAboveGround=!!e.multipassTerrain.cullAboveGround,this._configuration.silhouette=r,this._technique=this._shaderTechniqueRepository.releaseAndAcquire(QMe,this._configuration,this._technique),this._technique}bindRegularEdges(e,r){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(r,!1),e,r)}bindSilhouetteEdges(e,r){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(r,!0),e,r)}renderRegularEdges(e,r,i,s,n){this._render(e,r,r.regular.vao,i,s,n)}renderSilhouetteEdges(e,r,i,s,n){this._render(e,r,r.silhouette.vao,i,s,n)}_render(e,r,i,s,n,o){o>0&&(this._bindDraw(e,r,s,n),this._rctx.bindVAO(i),this._rctx.capabilities.instancing.drawArraysInstanced(At.TRIANGLE_FAN,0,4,o))}_bindDraw(e,r,i,s){if(this._drawParameters.componentDataTexture=r.components.buffer.textureBuffer.texture,this._drawParameters.strokesTexture=this._settings.strokesTexture,"origin"in r.transform)this._lastOriginId!==r.transform.origin.origin.id&&(e.setUniformMatrix4fv("localView",r.transform.origin.viewMatrix),this._lastOriginId=r.transform.origin.origin.id),e.setUniformMatrix4fv("model",r.transform.modelMatrix),this._drawParameters.slicePlaneLocalOrigin=r.transform.origin.origin.vec3;else{const n=new Y9(r.transform.position),o=Qh(Bde,$x(Bde,r.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=n.low,this._drawParameters.transformWorldFromModelTH=n.high,this._drawParameters.transformWorldFromModelRS=r.transform.rotationScale,this._drawParameters.transformNormalGlobalFromModel=o;const a=s.camera.viewInverseTransposeMatrix;ne(this._drawParameters.slicePlaneLocalOrigin,a[3],a[7],a[11])}e.bindDraw(this._drawParameters,s,i)}_sortRenderables(){this._renderablesDirty=!1,this._sortedRenderables[jt.TRANSPARENT][jt.TRANSPARENT].clear(),this._sortedRenderables[jt.TRANSPARENT][jt.OPAQUE].clear(),this._sortedRenderables[jt.OPAQUE][jt.TRANSPARENT].clear(),this._sortedRenderables[jt.OPAQUE][jt.OPAQUE].clear(),this._renderables.forEach(r=>{r.objectTransparency!==jt.INVISIBLE&&r.edgeTransparency!==jt.INVISIBLE&&this._sortedRenderables[r.objectTransparency][r.edgeTransparency].push(r)});const e=(r,i)=>"origin"in r.transform?"origin"in i.transform?r.transform.origin.origin.id<i.transform.origin.origin.id?-1:r.transform.origin.origin.id>i.transform.origin.origin.id?1:0:1:0;this._sortedRenderables[jt.TRANSPARENT][jt.TRANSPARENT].sort(e),this._sortedRenderables[jt.TRANSPARENT][jt.OPAQUE].sort(e),this._sortedRenderables[jt.OPAQUE][jt.TRANSPARENT].sort(e),this._sortedRenderables[jt.OPAQUE][jt.OPAQUE].sort(e)}static getKey(e,r,i){return`edges-t:${e}:${r}:${i}`}};const Bde=kl();function OWt(t,e){return e.push(t.buffer),{buffer:t.buffer,layout:new PXe(t.layout)}}function XL(t){return new UTe(t.layout).createView(t.buffer)}let Mbt=class extends WOe{constructor(e){super("EdgeProcessingWorker","extract",{extract:r=>[r.dataBuffer],extractComponentsEdgeLocations:r=>[r.dataBuffer],extractEdgeLocations:r=>[r.dataBuffer]},e)}async process(e,r,i){if(i)return xvt(e);const s=await this.invoke(new LV(e),r);return this._unpackOutput(s)}async extractEdgeLocations(e,r){const i=await this.invokeMethod("extractEdgeLocations",new LV(e),r);return XL(i)}async extractComponentsEdgeLocations(e,r){const i=await this.invokeMethod("extractComponentsEdgeLocations",new LV(e),r);return XL(i)}_unpackOutput(e){return{regular:{instancesData:XL(e.regular.instancesData),lodInfo:{lengths:new Float32Array(e.regular.lodInfo.lengths)}},silhouette:{instancesData:XL(e.silhouette.instancesData),lodInfo:{lengths:new Float32Array(e.silhouette.lodInfo.lengths)}},averageEdgeLength:e.averageEdgeLength}}},LV=class{constructor(e){this.dataBuffer=e.data.buffer,this.writerSettings=e.writerSettings,this.skipDeduplicate=e.skipDeduplicate,this.indices=Cp(e.indices)?e.indices:e.indices.buffer,this.indicesType=Cp(e.indices)?"Array":N6(e.indices)?"Uint32Array":"Uint16Array",this.indicesLength=e.indicesLength}};function Pbt(t){const r=K3.resolution,i=r/2,s=new Uint8Array(4*r*r),n=4*r*i,o=K3.amplitude,a=2*o,l=4*r,c=Math.log2(r)+1,h=K3.strokes.length;let d=(c-1)*h*l;for(const{distance:g,pressure:_}of K3.strokes){let v=g,b=_,T=d;for(let x=0;x<c;x++){x!==0&&(v=Gde(v,ZM.DISTANCE),b=Gde(b,ZM.PRESSURE));for(let S=0;S<K3.resolution;S++){const E=.5+(v?v[S%v.length]/a:0),A=b?b[S%b.length]:1;$M(E,s,T),$M(A,s,T+n),T+=4}T-=l*(h+1)}d+=l}const f=new xr;f.width=f.height=r;const m=new Ot(t,f,s);return new $bt(r,a,o,h,m)}function Gde(t,e){if(!t)return null;const r=t.length/2,i=Ibt*r,s=new Array(r);let n=0;const o=e===ZM.PRESSURE;for(let a=0;a<t.length;a+=2){const l=(t[a]+t[a+1])/2;s[n++]=o?Math.min(i,1-(1-l)*jde):Math.min(i,l*jde)}return s}var ZM;(function(t){t[t.DISTANCE=0]="DISTANCE",t[t.PRESSURE=1]="PRESSURE"})(ZM||(ZM={}));const Ibt=.1,jde=.5;let $bt=class{constructor(e,r,i,s,n){this.resolution=e,this.normalizationScale=r,this.amplitude=i,this.variants=s,this.texture=n}dispose(){this.texture=je(this.texture)}};const K3={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};function Hde(t){let e=null;for(const r of t){const i=r.type;if(Lbt(r)){if(e==null)e=i;else if(e!==i)return"uber"}}return e??"uber"}function qde(t){let e=jt.INVISIBLE;for(const{material:r}of t)if(tPe(r)){if(r.color[3]*r.opacity<1)return jt.TRANSPARENT;e=jt.OPAQUE}return e}function Wde(t){let e=jt.INVISIBLE;for(const{material:r}of t)if(tPe(r)){switch(r.objectTransparency){case jt.TRANSPARENT:case jt.INVISIBLE:return jt.TRANSPARENT;case jt.OPAQUE:if(r.opacity<1)return jt.TRANSPARENT}e=jt.OPAQUE}return e}function tPe(t){return t.size*t.color[3]*t.opacity>0}function Lbt(t){return t.size*t.color[3]>0}function Xde(t,e,r,i){for(let s=0;s<t.length;s++){const n=t[s].index,o=e[s],a=e[s+1];if(i)for(let l=o;l<a;l++){const c=i[l];r.set(c,n)}else for(let l=o;l<a;l++)r.set(l,n)}}let Fd=class extends Te{constructor(e){super(e),this._updatingHandles=new tm,this._perObjectData=new Map,this._perObjectDataEvictionCache=new Set,this._renderers=new Map,this._gpuMemoryUsage=0,this._workerAbort=new AbortController,this._tmpModelPosition=O(),this._localOrigins=new hbt(new IK(e.renderSR))}initialize(){this._worker=new Mbt(this.schedule),this._componentColorManager=new dMe(this.rctx,3);const e=aMe.createBuffer(4);for(let r=0;r<4;r++)e.sideness.set(r,0,r===0||r===3?0:1),e.sideness.set(r,1,r===0||r===1?0:1);this._verticesBufferObject=kr.createVertex(this.rctx,Cr.STATIC_DRAW,e.buffer)}destroy(){this.destroyed||(this._perObjectData.forEach(e=>this._discardObjectEntry(e)),this._perObjectData.clear(),this._strokesTexture=je(this._strokesTexture),this._componentColorManager=Ne(this._componentColorManager),this._workerAbort.abort(),this._worker.destroy(),this._verticesBufferObject=je(this._verticesBufferObject),this._renderers.clear(),this._updatingHandles.destroy(),this._set("schedule",zbt))}get updating(){return this._updatingHandles.updating}get usedMemory(){return this._gpuMemoryUsage}shouldRender(){return this._renderers.size>0}async addComponentObject(e,r,i,s,n,o,a,l){if(this.hasObject(e))return this.getObjectMemoryUsage(e);let c;const h=new Zde(new Promise(f=>c=f),i.center,i.radius);this._perObjectData.set(e,h);const d=await this._updatingHandles.addPromise(this._addComponentGeometry(r,h,s,n,o,a,l));return this.setNeedsRender(),c(),d}async addOrUpdateObject3D(e,r,i,s){if(this.destroyed)return void K.getLogger(this).warn("Attempt to add an object to a destroyed instance");const n=this._perObjectData.get(e);let o;n?.renderables.length>0&&this._perObjectDataEvictionCache.add(n);const a=e.boundingVolumeWorldSpace.bounds,l=new Zde(new Promise(h=>o=h),a,Qg(a));this._perObjectData.set(e,l);const c=new Array;if(i.mergeGeometries&&e.geometries.length>1&&Dbt(e))c.push(this._addObjectMergedGeometries(e,l,r,i,s));else for(let h=0;h<e.geometries.length;h++){const d=e.geometries[h];d.material.supportsEdges&&c.push(this._addGeometry(e,l,d,r[0],i,s))}await this._updatingHandles.addPromise(Promise.all(c)),this._perObjectDataEvictionCache.delete(l),this._discardObjectEntry(n),this.setNeedsRender(),o()}_discardObjectEntry(e){e&&(e.renderables.length&&(e.renderables.forEach(r=>this._removeRenderable(r)),this.setNeedsRender()),e.loaded=null)}hasObject(e){return this._perObjectData.has(e)}async updateAllComponentOpacities(e,r){const i=await this._updatingHandles.addPromise(this._getObjectEntry(e));if(i==null)return;const s=r instanceof Array?n=>r[n]:()=>r;i.renderables.forEach(n=>{const o=n.components.meta.length;for(let a=0;a<o;a++){const l=s(a),c=n.components.meta[a],h=c.index;c.material.opacity=l,n.components.buffer.textureBuffer.setDataElement(h,1,3,255*l)}this._updateTransparency(n)}),this.setNeedsRender()}async getObjectMemoryUsage(e){const r=await this._getObjectEntry(e);return r!=null?r.renderables.reduce((i,s)=>i+s.statistics.gpuMemoryUsage,0):0}async updateAllComponentMaterials(e,r,i,s){const n=e instanceof B0,o=!!i.hasSlicePlane,a=Hde(r),l=$V.getKey(a,o,n),c=await this._updatingHandles.addPromise(this._getObjectEntry(e));c!=null&&(c.renderables.forEach(h=>{if(l!==h.rendererKey){const d=this._renderers.get(h.rendererKey),f=this._acquireRenderer(a,o,n);d.removeRenderable(h),--d.refCount,h.rendererKey=l,f.addRenderable(h)}for(let d=0;d<r.length;d++)h.components.meta[d].material=r[d];s&&this._updateComponentBuffer(h.components),this._updateTransparency(h)}),this.setNeedsRender())}async updateAllVerticalOffsets(e,r){const i=await this._updatingHandles.addPromise(this._getObjectEntry(e));i!=null&&(i.renderables.forEach(s=>{const n=s.components.meta;for(let o=0;o<n.length;o++)s.components.meta[o].verticalOffset=r?.[o]??0;this._updateComponentBuffer(s.components)}),this.setNeedsRender())}async updateObjectVisibility(e,r){const i=await this._updatingHandles.addPromise(this._getObjectEntry(e));i!=null&&(i.renderables.forEach(s=>s.visible=r),this.setNeedsRender())}removeObject(e){const r=this._perObjectData.get(e);r&&(this._perObjectData.delete(e),this._discardObjectEntry(r))}async _getObjectEntry(e){const r=this._perObjectData.get(e);if(!r)throw new Error("no object");return await r.loaded,r.loaded==null?null:r}render(e,r){if(this._componentColorManager==null)return;this._localOrigins.updateViewMatrices(e.camera.viewMatrix);const i=e.camera.viewInverseTransposeMatrix,s=O(),n=new Y9;let o=0,a=0;if(this._renderers.forEach(c=>{if(c.refCount===0)this._renderers.delete(c.key),c.dispose();else{let h=!0,d=!0;c.forEachRenderable(f=>{f.visible&&(o+=f.statistics.averageEdgeLength,a++,h&&f.regular&&(c.updateTechnique(e,!1),h=!1),d&&f.silhouette&&(c.updateTechnique(e,!0),d=!1))},r)}}),this._componentColorManager.garbageCollect(),this._componentColorManager.updateTextures(),a===0)return;const l=new pbt(40*o/a,r);ne(s,i[3],i[7],i[11]),n.set(s),ie(l.transformWorldFromViewTH,n.high),ie(l.transformWorldFromViewTL,n.low),Jh(l.transformViewFromCameraRelativeRS,e.camera.viewMatrix),Qh(epe,l.transformViewFromCameraRelativeRS),$x(l.transformNormalViewFromGlobal,epe),l.transformProjFromView=e.camera.projectionMatrix,this._updateObjectCameraDistances(e),this._renderers.forEach(c=>{this._renderRegularEdges(c,e,l),this._renderSilhouetteEdges(c,e,l)})}_updateTransparency(e){const r=qde(e.components.meta),i=Wde(e.components.meta);r===e.edgeTransparency&&i===e.objectTransparency||(e.edgeTransparency=r,e.objectTransparency=i,this._renderers.get(e.rendererKey).setRenderablesDirty())}_computeModelTransformWithLocalOrigin(e,r,i){e.getCombinedShaderTransformation(r,i);const s=r.localOrigin!=null?this._localOrigins.register(r.localOrigin):this._localOrigins.acquire(ne(this._tmpModelPosition,i[12],i[13],i[14]));return r.localOrigin=s.origin,cbt(s.origin.vec3,i),s}_updateComponentBuffer(e){const{meta:r,buffer:i}=e,s=new Uint8Array(4);for(let n=0;n<r.length;n++){const o=r[n].material,a=r[n].index,l=ve(Math.round(o.size*Abt),0,255),c=ve(o.extensionLength,-IV,255-IV)+IV,h=o.type==="solid"?YF.SOLID:YF.SKETCH,d=255*o.opacity,f=o.color,m=255*f[0],g=255*f[1],_=255*f[2],v=255*f[3];i.textureBuffer.setData(a,0,m,g,_,v),i.textureBuffer.setData(a,1,l,c,h,d),iMe(r[n].verticalOffset,s),i.textureBuffer.setData(a,2,s[0],s[1],s[2],s[3])}}_createComponentBuffers(e){if(this._componentColorManager==null)return null;const r=new Array,i=this._componentColorManager.getBuffer(e.length);for(let n=0;n<e.length;n++){const o=e[n],a=i.acquireIndex();r.push({index:a,verticalOffset:0,material:o})}const s=new Nbt(i,r);return this._updateComponentBuffer(s),s}_extractEdges(e,r,i,s,n,o=n.length){return this._worker.process({data:r,indices:n,indicesLength:o,writerSettings:e,skipDeduplicate:i},this._workerAbort.signal,s)}_createRenderable(e,r,i,s,n){const o=h=>this._verticesBufferObject!=null?new Fbt(new Np(this.rctx,cMe,{vertices:hvt,instances:h===Yb.REGULAR?WF.glLayout:XF.glLayout},{vertices:this._verticesBufferObject,instances:kr.createVertex(this.rctx,Cr.STATIC_DRAW,h===Yb.REGULAR?e.regular.instancesData.buffer:e.silhouette.instancesData.buffer)}),h===Yb.REGULAR?e.regular.lodInfo:e.silhouette.lodInfo):null,a=e.regular.lodInfo.lengths.length>0?o(Yb.REGULAR):null,l=e.silhouette.lodInfo.lengths.length>0?o(Yb.SILHOUETTE):null,c=(a?.vao.memoryEstimate??0)+(l?.vao.memoryEstimate??0);return new kbt(a,l,{gpuMemoryUsage:c,externalMemoryUsage:n,averageEdgeLength:e.averageEdgeLength},i,qde(r.meta),Wde(r.meta),r,s)}async _addGeometry(e,r,i,s,n,o){const a=i.vertexAttributes.get(C.POSITION),l=i.indices.get(C.POSITION),c=xe(),h=this._computeModelTransformWithLocalOrigin(e,i,c),d=new Kde(a,l,c,h);return this._addPositionData(r,d,i.edgeIndicesLength,s,n,o)}async _addPositionData(e,r,i,s,n,o=!1){if(e.loaded==null)return;const a=this._createComponentBuffers([s]);if(a==null||i<=0)return;const l=this._acquireRenderer(s.type,!!n.hasSlicePlane,!0),{modelTransform:c,origin:h}=r,d=r.indices,f=r.position,m=f.data.length/f.size,g=HF.createBuffer(m);for(let b=0;b<m;b++)g.position.set(b,0,f.data[b*f.size]),g.position.set(b,1,f.data[b*f.size+1]),g.position.set(b,2,f.data[b*f.size+2]);Xde(a.meta,[0,g.componentIndex.count],g.componentIndex);const _=await this._updatingHandles.addPromise(this._extractEdges(l.writerSettings,g,!1,o,d,i));if(e.loaded==null)return;const v=this._createRenderable(_,a,new Ubt(c,h),l.key,!1);e.renderables.push(v),l.addRenderable(v),this._gpuMemoryUsage+=v.statistics.gpuMemoryUsage}async _addComponentGeometry(e,r,i,s,n,o,a){if(r.loaded==null)return 0;const l=this._createComponentBuffers(o);if(l==null)return 0;const c=Hde(o),h=this._acquireRenderer(c,a.hasSlicePlane||!1,!1),d=HF.createBuffer(i.length/3);eI(d.position.typedBuffer,i,d.position.typedBufferStride,3),Xde(l.meta,n,d.componentIndex,s);const f=!0,m=h.writerSettings,g=await this._updatingHandles.addPromise(this._extractEdges(m,d,f,!1,s));if(r.loaded==null)return 0;const _=this._createRenderable(g,l,e,h.key,!0);return r.renderables.push(_),h.addRenderable(_),_.statistics.gpuMemoryUsage}async _addObjectMergedGeometries(e,r,i,s,n){const o=new Map;let a=0,l=null,c=0;for(let T=0;T<e.geometries.length;T++){const x=e.geometries[T];if(!x.material.supportsEdges)continue;!l&&x.localOrigin&&(l=x);const S=x.vertexAttributes.get(C.POSITION);c+=S.data.length/S.size,a+=x.edgeIndicesLength}const h=c>=65536?Uint32Array:Uint16Array,d=a?new h(a):null,f=[];let m=0;for(let T=0;T<e.geometries.length;T++){const x=e.geometries[T];if(!x.material.supportsEdges)continue;const S=x.vertexAttributes.get(C.POSITION),E=x.indices.get(C.POSITION);let A=o.get(S.data);if(A==null){A=f.length/3;for(let R=0;R<S.data.length;R+=S.size)f.push(S.data[R]),f.push(S.data[R+1]),f.push(S.data[R+2]);o.set(S.data,A)}if(E)for(let R=0;R<x.edgeIndicesLength;R++)d[m++]=A+E[R]}const g=l||e.geometries[0],_=xe(),v=this._computeModelTransformWithLocalOrigin(e,g,_);for(let T=0;T<e.geometries.length;T++)e.geometries[T].localOrigin=v.origin;const b=new Kde({data:f,size:3},d,_,v);await this._updatingHandles.addPromise(this._addPositionData(r,b,d.length,i[0],s,n))}_acquireRenderer(e,r,i){const s=$V.getKey(e,r,i);let n=this._renderers.get(s);return this._strokesTexture==null&&(this._strokesTexture=Pbt(this.rctx)),n||(n=new $V(this.rctx,this.techniqueRepository,{type:e,hasSlicePlane:r,strokesTexture:this._strokesTexture,legacy:i,spherical:this.viewingMode===Ve.Global}),this._renderers.set(s,n)),++n.refCount,n}_removeRenderable(e){Yde(e.regular),Yde(e.silhouette);const r=this._renderers.get(e.rendererKey);if(r){r.removeRenderable(e),--r.refCount,"origin"in e.transform&&this._localOrigins.release(e.transform.origin),this._gpuMemoryUsage-=e.statistics.externalMemoryUsage?0:e.statistics.gpuMemoryUsage;for(const i of e.components.meta)e.components.buffer.releaseIndex(i.index)}}_updateObjectCameraDistances(e){const r=e.camera.eye,i=e.camera.viewForward,s=O(),n=o=>{Pn(s,o.center,r);const a=ye(s,i),l=o.radius,c=a<-l?1/0:a<l?0:a-l;o.renderables.forEach(h=>h.distanceToCamera=c)};this._perObjectData.forEach(n),this._perObjectDataEvictionCache.forEach(n)}_renderRegularEdges(e,r,i){const s=e.bindRegularEdges(i,r),n=i.transparency,o=r.camera.perScreenPixelRatio;e.forEachRenderable(a=>{if(!Jde(a)||!a.visible)return;const l=YL(a.regular.lod.lengths,a.distanceToCamera,o);e.renderRegularEdges(s,a,i,r,l)},n)}_renderSilhouetteEdges(e,r,i){const s=e.bindSilhouetteEdges(i,r),n=i.transparency,o=r.camera.perScreenPixelRatio;e.forEachRenderable(a=>{if(!Qde(a)||!a.visible)return;const l=YL(a.silhouette.lod.lengths,a.distanceToCamera,o);e.renderSilhouetteEdges(s,a,i,r,l)},n)}get test(){return{hasRenderedPrimitives:e=>{let r=!1;const i=e.perScreenPixelRatio,s=(n,o)=>n.forEachRenderable(a=>{a.visible&&!r&&(Jde(a)&&(r=YL(a.regular.lod.lengths,a.distanceToCamera,i)>0),!r&&Qde(a)&&(r=YL(a.silhouette.lod.lengths,a.distanceToCamera,i)>0))},o);return this._renderers.forEach(n=>{r||(s(n,jt.OPAQUE),s(n,jt.TRANSPARENT))}),r}}}};function Yde(t){t!=null&&(t.vao.vertexBuffers.instances.dispose(),t.vao.disposeVAOOnly(),t.vao=null)}function Dbt(t){let e=null,r=null;for(let i=0;i<t.geometries.length;i++){const s=t.geometries[i];if(s.material.supportsEdges){if(e){if(!u0(e,s.transformation))return!1}else e=s.transformation;if(r||s.localOrigin==null){if(r&&r.localOrigin!=null&&s.localOrigin!=null&&r.localOrigin.id!==s.localOrigin.id)return!1}else r=s}}return!0}u([p({constructOnly:!0})],Fd.prototype,"rctx",void 0),u([p({constructOnly:!0})],Fd.prototype,"renderSR",void 0),u([p({constructOnly:!0})],Fd.prototype,"viewingMode",void 0),u([p({constructOnly:!0})],Fd.prototype,"techniqueRepository",void 0),u([p({constructOnly:!0})],Fd.prototype,"setNeedsRender",void 0),u([p({constructOnly:!0})],Fd.prototype,"schedule",void 0),u([p({readOnly:!0})],Fd.prototype,"_updatingHandles",void 0),u([p({readOnly:!0})],Fd.prototype,"updating",null),Fd=u([P("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],Fd);let Zde=class{constructor(e,r,i){this.center=r,this.radius=i,this.renderables=new Array,this.loaded=e,this.loaded.then(()=>{this.loaded!=null&&(this.loaded=!0)})}},Nbt=class{constructor(e,r){this.buffer=e,this.meta=r}},Fbt=class{constructor(e,r){this.vao=e,this.lod=r}},Ubt=class{constructor(e,r){this.modelMatrix=e,this.origin=r}},kbt=class{constructor(e,r,i,s,n,o,a,l){this.regular=e,this.silhouette=r,this.statistics=i,this.transform=s,this.edgeTransparency=n,this.objectTransparency=o,this.components=a,this.rendererKey=l,this.distanceToCamera=0,this.visible=!0}};function Jde(t){return t.regular!=null}function Qde(t){return t.silhouette!=null}function YL(t,e,r){const i=e*r,s=_ge(t,i,!0);return s===-1?i<t[0]?t.length:0:t.length-s}let Kde=class{constructor(e,r,i,s){this.position=e,this.indices=r,this.modelTransform=i,this.origin=s}};const epe=ki(),zbt=()=>Promise.reject();function kp(t){return window.WebGL2RenderingContext&&t instanceof window.WebGL2RenderingContext}let tpe=class{constructor(e,r,i,s,n,o,a,l,c){this.createQuery=e,this.deleteQuery=r,this.resultAvailable=i,this.getResult=s,this.disjoint=n,this.beginTimeElapsed=o,this.endTimeElapsed=a,this.createTimestamp=l,this.timestampBits=c}},wg=!1;function Vbt(t,e){if(e.disjointTimerQuery)return null;let r=t.getExtension("EXT_disjoint_timer_query_webgl2");return r&&kp(t)?new tpe(()=>t.createQuery(),i=>{t.deleteQuery(i),wg=!1},i=>t.getQueryParameter(i,t.QUERY_RESULT_AVAILABLE),i=>t.getQueryParameter(i,t.QUERY_RESULT),()=>t.getParameter(r.GPU_DISJOINT_EXT),i=>{wg||(wg=!0,t.beginQuery(r.TIME_ELAPSED_EXT,i))},()=>{t.endQuery(r.TIME_ELAPSED_EXT),wg=!1},i=>r.queryCounterEXT(i,r.TIMESTAMP_EXT),()=>t.getQuery(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):(r=t.getExtension("EXT_disjoint_timer_query"),r?new tpe(()=>r.createQueryEXT(),i=>{r.deleteQueryEXT(i),wg=!1},i=>r.getQueryObjectEXT(i,r.QUERY_RESULT_AVAILABLE_EXT),i=>r.getQueryObjectEXT(i,r.QUERY_RESULT_EXT),()=>t.getParameter(r.GPU_DISJOINT_EXT),i=>{wg||(wg=!0,r.beginQueryEXT(r.TIME_ELAPSED_EXT,i))},()=>{r.endQueryEXT(r.TIME_ELAPSED_EXT),wg=!1},i=>r.queryCounterEXT(i,r.TIMESTAMP_EXT),()=>r.getQueryEXT(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):null)}function Bbt(t,e){const r=t.capabilities.disjointTimerQuery;return r==null?null:new Gbt(r,e)}let Gbt=class{constructor(e,r){this._timer=e,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,r.forEach(i=>{const s=this._timer.createQuery(),n=this._timer.createQuery();this._queryPool.push(s,n),this._queryResults.set(i,null)})}start(){wg||(this._currentQuery=this._queryPool.pop(),this._currentQuery!=null&&(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(e){if(this._timer.disjoint()||this._currentQuery==null||!this._queryResults.has(e))return this.abort(),null;this._timer.endTimeElapsed();const r=this._queryResults.get(e);if(r==null)return this._queryResults.set(e,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(r))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const i=this._timer.getResult(r)/1e6;return this._queryPool.unshift(r),this._queryResults.set(e,this._currentQuery),this._currentQuery=null,i}abort(){this._currentQuery!=null&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){this._currentQuery!=null&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach(e=>{this._timer.deleteQuery(e)}),this._queryResults.forEach(e=>{e!=null&&this._timer.deleteQuery(e)})}};var xi;(function(t){t.OVERLAY="overlay",t.PREPARE="prepare",t.SHADOW_MAP="shadow map",t.LINEAR_DEPTH="linear depth",t.ACCUMULATED_SHADOWS="accumulated shadows",t.NORMALS="normals",t.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",t.SSAO="SSAO",t.OPAQUE="opaque",t.OPAQUE_EDGES="opaque edges",t.VOXEL="voxel",t.TRANSPARENT="transparent",t.TRANSPARENT_EDGES="transparent edges",t.HUD_VISIBILITY="HUD visibility",t.TRANSPARENT_TERRAIN="transparent terrain",t.ENVIRONMENT="environment",t.LASER_LINE="laser line",t.OCCLUDED="occluded",t.ANTIALIASING="antialiasing",t.HIGHLIGHTS="highlights",t.HUD="HUD",t.HUD_OCCLUDED="HUD occluded",t.FINISH="finish"})(xi||(xi={}));const rpe="Total";let jbt=class{constructor(e){this._rctx=e,this._startTimeStampCPU=0,this._lastTimeStampCPU=0,this._totalCPUTime=new Gg(rpe),this._cpuTimeSamplers=new Map(Object.values(xi).map(r=>[r,new Gg(r)])),this._enableGPUTimer=0,this._totalGPUTime=new Gg("GPU"),this._gpuTimeSamplers=new Map(Object.values(xi).map(r=>[r,new Gg(r)])),this._totalTime=0,this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return this._gpuTimerPool!=null}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return performance.now()-this._startTimeStampCPU}enableGPUPerformanceInfo(){if(this._gpuTimerPool==null){const e=[...Object.values(xi),rpe];this._gpuTimerPool=Bbt(this._rctx,e)}return this._gpuTimerPool==null?{hasGPUTimerSupport:!1,remove:()=>{}}:(++this._enableGPUTimer,{hasGPUTimerSupport:!0,remove:IY(()=>{--this._enableGPUTimer,this._enableGPUTimer===0&&(this._gpuTimerPool=je(this._gpuTimerPool))})})}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=performance.now(),this._gpuTimerPool!=null&&this._gpuTimerPool.start()}advance(e){const r=performance.now();if(this._cpuTimeSamplers.get(e).record(r-this._lastTimeStampCPU),this._lastTimeStampCPU=r,this._gpuTimerPool!=null){const i=this._gpuTimerPool.stop(e);this._gpuTimeSamplers.get(e).record(i),this._gpuTimerPool.start()}}finishFrame(){if(this._gpuTimerPool!=null){const r=this._gpuTimerPool.stop(xi.FINISH);this._gpuTimeSamplers.get(xi.FINISH).record(r)}const e=performance.now()-this._startTimeStampCPU;this._totalTime=this._totalTime+e,this._totalCPUTime.record(e),this._gpuTimerPool!=null&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((r,i)=>r+(i.last||0),0)),++this._totalFrameCount}},oc=class extends Te{get _bindParameters(){return this._renderContext.bindParameters}updateRenderFeature(e=null,r=!ae("disable-feature:high-quality-idle")){this._renderStateFeatures=Hne(r,e),this.notifyChange("_renderStateFeatures"),this._requestRender()}isFeatureEnabled(e,r=this._state){return this._renderStateFeatures?.get(r,e)??!1}setFeatureEnabled(e,r,i){this._renderStateFeatures?.set(r,e,i),this.notifyChange("_renderStateFeatures"),this._requestRender()}get _antialiasing(){return this._antialiasingEnabled||this.isFeatureEnabled(Js.Antialiasing)}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(Js.HighQualityTransparency)}get hasReflections(){return this.hasWater&&(this._ssrEnabled||this.isFeatureEnabled(Js.WaterReflection))}get hasWater(){return this._hasWater||this._hasOverlayWater}constructor(e,r,i,s,n,o,a,l){super({}),this._stage=e,this._materialRepository=r,this._techniqueRepository=s,this._rctx=n,this._compositingHelper=o,this._magnifierHelper=a,this._requestRender=l,this._materialRenderers=new Vt,this._needsTransparentPass=!1,this._hasHUDElements=!1,this._hasHighlights=!1,this._hasWater=!1,this._hasOverlayWater=!1,this._renderOverlay=c=>{},this._isRendering=!1,this._fallbackDepthStencilTexture=null,this._sliceHelper=new ebt,this._state=Ur.IDLE,this._renderStateFeatures=null,this._antialiasingEnabled=!0,this._highQualityTransparencyEnabled=!0,this._terrainRenderingEnabled=!0,this._terrainTransparency=En.Opaque,this._ssrEnabled=!1,this._ssaoEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new d1t,this._handles=new $i,this._renderHiddenTransparentEdges=()=>{},this._oitUsed=!1,this.updateRenderFeature(e.view.qualityProfile),this._smaaPass=new MO(this._rctx,s),l(),this._offscreen=new I1t(this._rctx,this._compositingHelper),this.performanceInfo=new jbt(this._rctx),this._shadowMap=new LK(this._rctx,e.viewingMode),this._ssaoHelper=new $3e(e.view,s,this._rctx,l),this._highlight=new O1t(s,this._rctx),this._shadowHighlight=new K1t(this._rctx,e.viewingMode),this._shadowAccumulator=new El(this._rctx,s,e,c=>{const h=this.shadowsEnabled;this._shadowMap.enabled=!0,this._prepare(c.camera,c.contentCamera),this._renderPlugins.prepareRender(),this._shadowMap.enabled=h},(c,h,d)=>{c.shadowMap.start(c.camera,h,d,!0,this._stage.view.qualitySettings.maximumPixelRatio),this._renderShadowCascades(F.Shadow,c.shadowMap),c.camera.setGLViewport(this._rctx),this._prepare(c.camera,c.contentCamera)},l),this._renderContext=new iot(this._rctx,this._offscreen,this._shadowMap,this._ssaoHelper,this._sliceHelper),this._renderPlugins=new RO({renderContext:this._renderContext,techniqueRepository:s,textureRepository:i,materialRepository:this._materialRepository,requestRender:l,controller:e}),this.renderPassManager=new h1t(this._rctx,this._techniqueRepository),this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager),this._handles.add([le(()=>this._stage.view.state.camera,()=>l(),Ls),le(()=>li.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,c=>{this._renderHiddenTransparentEdges=c?()=>this._renderEdges(jt.TRANSPARENT):()=>{},l()},Pr),le(()=>this._ssaoEnabled||this.isFeatureEnabled(Js.SSAO),c=>this._ssaoHelper.enabled=c,Ls)])}normalizeCtorArgs(){return{}}destroy(){this._handles.destroy(),this._smaaPass.dispose(),this._gpuTimerHandle=Fi(this._gpuTimerHandle),this._materialRenderers.forAll(e=>e.dispose()),this._materialRenderers.clear(),this._offscreen.dispose(),this._fallbackDepthStencilTexture=je(this._fallbackDepthStencilTexture),this._shadowMap.dispose(),this._ssaoHelper.destroy(),this._highlight.dispose(),this._shadowHighlight.dispose(),this._shadowAccumulator.dispose(),this._edgeView=Ne(this._edgeView),this.renderPassManager.destroy(),jTe.prune()}disposeOffscreenBuffers(){this._offscreen.dispose(),this._shadowMap.disposeOffscreenBuffers(),this._smaaPass.disable(),this._ssaoHelper.disposeOffscreenBuffers()}get updating(){return this._antialiasing&&this._smaaPass.updating||this._edgeView!=null&&this._edgeView.updating||this._shadowAccumulator.running||this._renderPlugins.updating||!this.isCameraFinal}ensureEdgeView(){if(this._edgeView==null){const e=this._stage.view.resourceController;this._edgeView=new Fd({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniqueRepository:this._techniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:Hbt(e)}),this._handles.add(le(()=>Cc(this._edgeView,r=>r.updating),()=>this._requestRender(),Wr)),this._requestRender()}return this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return dJ(this._bindParameters.ssr.reprojectionMatrix,pn)}set _reprojectionMatrix(e){SY(this._bindParameters.ssr.reprojectionMatrix,e)&&this.notifyChange("isCameraFinal")}get shadowsEnabled(){return!!this._shadowMap?.enabled}setParameters(e){const{_shadowMap:r,_bindParameters:i}=this;if(e.qualitySettings?.reflections!==void 0&&this._ssrEnabled!==e.qualitySettings.reflections&&(this._ssrEnabled=e.qualitySettings.reflections,this._requestRender()),e.qualitySettings?.ambientOcclusion!==void 0&&this._ssaoEnabled!==e.qualitySettings.ambientOcclusion&&(this._ssaoEnabled=e.qualitySettings.ambientOcclusion,this._requestRender()),e.shadowMap!==void 0&&this._shadowMap.enabled!==e.shadowMap&&(this._shadowMap.enabled=e.shadowMap,this._requestRender()),e.shadowMapMaxCascades!==void 0&&r.maxCascades!==e.shadowMapMaxCascades&&(r.maxCascades=e.shadowMapMaxCascades,this._requestRender()),e.environment!=null){e.environment.weather!=null&&(this._bindParameters.weather=e.environment.weather,this._bindParameters.weatherVisible=!!e.weatherVisible);const s=e.environment.lighting.type!=="virtual";i.enableFillLights!==s&&(i.enableFillLights=s,this._requestRender())}e.background&&this._offscreen.background!==e.background&&(this._offscreen.background=e.background,this._requestRender()),e.antialiasingEnabled!==void 0&&this._antialiasingEnabled!==e.antialiasingEnabled&&(this._antialiasingEnabled=e.antialiasingEnabled,this._requestRender()),e.highQualityTransparency!==void 0&&this._highQualityTransparencyEnabled!==e.highQualityTransparency&&(this._highQualityTransparencyEnabled=e.highQualityTransparency,this._requestRender()),e.defaultHighlightOptions!==void 0&&(this._highlight.setDefaultOptions(e.defaultHighlightOptions),this._shadowHighlight.setDefaultOptions(e.defaultHighlightOptions),this._requestRender()),e.overlays!==void 0&&this._bindParameters.overlays!==e.overlays&&(this._bindParameters.overlays=e.overlays,this._requestRender()),e.hasOverlayWater!==void 0&&this._hasOverlayWater!==e.hasOverlayWater&&(this._hasOverlayWater=e.hasOverlayWater,this._requestRender()),e.renderOverlay!==void 0&&this._renderOverlay!==e.renderOverlay&&(this._renderOverlay=e.renderOverlay,this._requestRender()),e.slicePlane!==void 0&&this._sliceHelper.plane!==e.slicePlane&&(this._sliceHelper.plane=e.slicePlane,this._requestRender()),e.terrainRenderingEnabled!==void 0&&this._terrainRenderingEnabled!==e.terrainRenderingEnabled&&(this._terrainRenderingEnabled=e.terrainRenderingEnabled,this._requestRender()),e.terrainTransparency!==void 0&&this._terrainTransparency!==e.terrainTransparency&&(this._terrainTransparency=e.terrainTransparency,this._requestRender()),e.shadowCastOptions!==void 0&&this._shadowAccumulator.setOptions(e.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}modify(e,r){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:i,removes:s,updates:n}=e;if(i.length===0&&s.length===0&&n.length===0)return;const o=m3e(e);let a=!1;o.forEach((l,c)=>{if(r.done)return;let h=this._materialRenderers.find(d=>d.material===c);h==null&&l.adds.length>0&&(h=new C3e(this._rctx,this._materialRepository,c),this._materialRenderers.push(h)),h&&(h.modify(l),h.isEmpty&&(a=!0)),l.removes.forEach(d=>e.removes.removeUnordered(d)),l.adds.forEach(d=>e.adds.removeUnordered(d)),l.updates.forEach(d=>e.updates.removeUnordered(d)),r.madeProgress()}),a&&this._materialRenderers.filterInPlace(l=>!l.isEmpty||(l.dispose(),!1)),this._hasHighlights=this._materialRenderers.some(l=>l.hasHighlights),this._bindParameters.hasOccludees=this._materialRenderers.some(l=>l.hasOccludees),this._hasWater=this._materialRenderers.some(l=>l.hasWater),this._hasHUDElements=this._materialRenderers.some(l=>l.requiresSlot(pe.LINE_CALLOUTS_HUD_DEPTH,F.Color)||l.requiresSlot(pe.HUD_MATERIAL,F.Color)||l.requiresSlot(pe.LABEL_MATERIAL,F.Color)),this._requestRender()}updateAnimation(e){const r=this._hasAnimations;return this._hasAnimations=!1,this._materialRenderers.forAll(i=>this._hasAnimations=i.updateAnimation(e)||this._hasAnimations),this._hasAnimations=this._renderPlugins.updateAnimation(e)||this._hasAnimations,this._hasAnimations!==r&&(this._gpuTimerHandle=r?Fi(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}render(e,r,i,s,n){this._isRendering=!0,this._oitUsed=!1,this.performanceInfo.startFrame();const{camera:o,contentCamera:a,mode:l,alignPixelEnabled:c}=i;this._state=l,this._renderOverlay(n),this.performanceInfo.advance(xi.OVERLAY),this._renderContext.time=n,this._bindParameters.transparencyPassType=dt.NONE,this._bindParameters.alignPixelEnabled=c;const h=this._offscreen;h.setupRenderTarget(this.hasReflections);const d=P0(this._sliceHelper.plane);s===Ww.OFF&&(this._sliceHelper.plane=null),this._rctx.bindFramebuffer(e),o.setGLViewport(this._rctx),this._prepare(o,a),this._renderPlugins.prepareRender(),this.performanceInfo.advance(xi.PREPARE);const f=this._computeDepthRange(o);this._renderShadowMap(e,o,this._bindParameters.lighting.mainLight.direction,f),this.performanceInfo.advance(xi.SHADOW_MAP),h.initializeFrame(o),this._ensureBindParameters(o,a);const m=this._terrainRenderingEnabled&&(this._terrainTransparency===En.Semitransparent||this._terrainTransparency===En.TransparentWithDraped),g=this._highQualityTransparency&&m,_=this._needsTransparentPass||this._renderPlugins.needsTransparentPass;this._prepareShaders(g,_),this._renderLinearDepth(),this.performanceInfo.advance(xi.LINEAR_DEPTH),this._accumulateShadows(f,o,a),this.performanceInfo.advance(xi.ACCUMULATED_SHADOWS),this._renderNormal(),this.performanceInfo.advance(xi.NORMALS),this._ensureBindParametersSSR(n),this._renderSSAO(n),this.performanceInfo.advance(xi.SSAO),this._renderContext.output=F.Color,h.bindFramebuffer(),this._renderOpaqueGeometry(),this.performanceInfo.advance(xi.OPAQUE),this._renderTerrainLinearDepth(g),this._setMultipassTerrain(g),this._renderEdges(jt.OPAQUE),this.performanceInfo.advance(xi.OPAQUE_EDGES),this._offscreen.bindTarget(this._offscreen.currentColorTarget,this._offscreen.mainDepth),this._renderSlot(pe.VOXEL),this.performanceInfo.advance(xi.VOXEL),this._renderHiddenTransparentEdges(),_&&(this._oitEnabled?this._renderOITPass(xS.Geometry):this._renderTransparentGeometry()),this.performanceInfo.advance(xi.TRANSPARENT),this._renderGeometryLinearDepth(g);const v=this._renderHUDVisibility(g);g||this._renderInternalSlot(pe.LINE_CALLOUTS),this.performanceInfo.advance(xi.HUD_VISIBILITY),this._renderObjectAndLayerIdColor(r),this.performanceInfo.advance(xi.OBJECT_AND_LAYER_ID_COLOR),this._renderEdges(jt.TRANSPARENT,g),this.performanceInfo.advance(xi.TRANSPARENT_EDGES),this._renderTransparentTerrain(),m&&v&&(g?this._renderLineCallouts(fc.Occluded):h.compositeTransparentTerrainOntoHUDVisibility(this._bindParameters),this._renderHUD(fc.Occluded,h.framebuffer),this.performanceInfo.advance(xi.HUD_OCCLUDED)),this.performanceInfo.advance(xi.TRANSPARENT_TERRAIN),this._setTerrainCulling(!1),m&&(h.compositeTransparentTerrainOntoMain(this._bindParameters),g&&(this._renderEdges(jt.OPAQUE),this.performanceInfo.advance(xi.OPAQUE_EDGES),_&&(this._oitEnabled?this._renderOITPass(xS.Geometry):this._renderTransparentGeometry()),this.performanceInfo.advance(xi.TRANSPARENT),this._renderEdges(jt.TRANSPARENT),this.performanceInfo.advance(xi.TRANSPARENT_EDGES))),g&&this._renderLineCallouts(fc.NotOccluded),this._setMultipassEnabled(!1),this._shadowAccumulator.render(this._bindParameters),h.renderToTargets(()=>{this._renderInternalSlot(pe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderSlot(pe.POSTPROCESSING_ENVIRONMENT_TRANSPARENT),this._renderSlot(pe.LASERLINES)},h.currentColorTarget,h.mainDepth),this.performanceInfo.advance(xi.ENVIRONMENT),this._renderPlugins.needsLaserlineWithContrastControl&&h.renderTmpAndCompositeToMain(()=>this._renderSlot(pe.LASERLINES_CONTRAST_CONTROL),this._bindParameters,pa.PremultipliedAlpha),this.performanceInfo.advance(xi.LASER_LINE),this._renderOccluded(),this.performanceInfo.advance(xi.OCCLUDED);const b=s===Ww.ON&&this._magnifierHelper.enabled,T=b&&e==null?this._offscreen.getFramebuffer(this._offscreen.tmpColor,this._offscreen.tmpDepth):e;this._rctx.bindFramebuffer(T);const x=this._offscreen.colorTexture;this._renderAntiAliasing(x)||x==null||this._compositingHelper.composite(this._bindParameters,x,pa.None),this.performanceInfo.advance(xi.ANTIALIASING),this._renderHUD(fc.NotOccluded,T),this.performanceInfo.advance(xi.HUD),this._renderHighlights(T,this._bindParameters),this.performanceInfo.advance(xi.HIGHLIGHTS),b&&this._magnifierHelper.render(this._rctx,this._bindParameters),T!==e&&(this._rctx.bindFramebuffer(e),this._compositingHelper.composite(this._bindParameters,this._offscreen.tmpColorTexture,pa.None)),this._disposeOITBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=d,this._isRendering=!1,this.onPostRender&&this.onPostRender(),this.performanceInfo.finishFrame()}_prepareShaders(e,r){this._renderContext.output=F.Color,this._prepareOpaqueGeometrySlots(),this._setMultipassTerrain(e),this._prepareSlots(pe.TRANSPARENT_TERRAIN),this._setMultipassTerrain(!1),e||this._prepareInternalSlots(this._materialRenderers,pe.LINE_CALLOUTS),r&&this._prepareTransparencySlots(),this._prepareInternalSlots(this._materialRenderers,pe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._prepareSlots(pe.POSTPROCESSING_ENVIRONMENT_TRANSPARENT,pe.LASERLINES),this._rctx.gl.flush()}_renderObjectAndLayerIdColor(e){if(e!=null&&ae("enable-feature:objectAndLayerId-rendering")){const r=this._renderContext.output;this._rctx.bindFramebuffer(e),this._offscreen.renderToFBO(()=>this._renderGeometryAndTransparentTerrainPass(F.ObjectAndLayerIdColor),[0,0,0,0],!0,!0),this._rctx.bindFramebuffer(e),this._offscreen.renderToFBO(()=>{this._bindParameters.renderTransparentlyOccludedHUD=fc.NotOccluded,this._renderInternalSlot(pe.HUD_MATERIAL)},void 0,!0,!0),this._renderContext.output=r}}finish(e){this._hasAnimations||this._animationTimestep.clear();const r=this.performanceInfo.gpuSamplingEnabled,i=e===_s.BACKGROUND;if(i||r){const s=i?this.performanceInfo.elapsedTime:0,n=r?this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError(),o=Math.max(s,n);this._animationTimestep.frame(o,i)}}readDepthPixels(e,r,i){const s=this._offscreen.bindTarget(this._offscreen.linearDepth,this._offscreen.tmpDepth);if(!this._needsLinearDepth){this._ensureBindParameters(e,e),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const n=Si.COLOR_BUFFER_BIT|Si.DEPTH_BUFFER_BIT|Si.STENCIL_BUFFER_BIT;this._rctx.clearSafe(n),this._renderGeometryAndTransparentTerrainPass(F.Depth)}s.readPixels(r[0],r[1],r[2],r[3],Ct.RGBA,qs.UNSIGNED_BYTE,i)}readHUDVisibility(e,r,i,s,n){this._offscreen.bindTarget(this._offscreen.hudVisibility).readPixels(e,r,i,s,Ct.RGBA,qs.UNSIGNED_BYTE,n)}readAccumulatedShadow(e){return this._shadowAccumulator.readAccumulatedShadow(e[0],e[1])}_setMultipassTerrain(e){this._setMultipassEnabled(e),this._setTerrainCulling(e)}_setMultipassEnabled(e){this._bindParameters.multipassTerrain.enabled=this._bindParameters.multipassGeometry.enabled=e}_setTerrainCulling(e){this._bindParameters.multipassTerrain.cullAboveGround=e}_prepareSlots(...e){this._renderPlugins.prepareSlots(e)}_renderSlot(e){this._bindParameters.slot=e,this._renderPlugins.render()}_renderEdges(e,r=!1){const i=this._edgeView;i!=null&&i.shouldRender()&&this._offscreen.renderTmpAndCompositeToMain(()=>i.render(this._bindParameters,e),this._bindParameters,pa.Alpha,r)}_renderShadowMap(e,r,i,s){const n=this._shadowMap;n.enabled&&(n.start(r,i,s,this.isFeatureEnabled(Js.HighResolutionShadows),this._stage.view.qualitySettings.maximumPixelRatio),this._shadowHighlight.updateParameters(r,i),this._needsShadowHighlight?(this._renderShadowCascades(F.ShadowHighlight,this._shadowMap,o=>n.takeCascadeSnapshotTo(o,KE.Highlight)),n.clear(),this._renderShadowCascades(F.ShadowExcludeHighlight,this._shadowMap,o=>{n.takeCascadeSnapshotTo(o,KE.Default),this._renderGeometryAndTransparentTerrainPass(F.ShadowHighlight)})):this._renderShadowCascades(F.Shadow),n.finish(e),r.setGLViewport(this._rctx))}_renderShadowCascades(e,r=this._shadowMap,i=s=>{}){for(const s of r.cascades)s.camera.setGLViewport(this._rctx),this._prepare(s.camera,s.camera),this._renderGeometryAndTransparentTerrainPass(e),i(s)}get _needsLinearDepth(){return this._ssaoHelper.active||this._renderPlugins.needsLinearDepth||this.hasReflections||this._needsShadowHighlight||this._needsShadowCast}_renderLinearDepth(){this._needsLinearDepth?this._offscreen.renderToTargets(()=>this._renderGeometryAndTransparentTerrainPass(F.Depth),this._offscreen.linearDepth,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.linearDepth),this._bindParameters.linearDepthTexture=this._offscreen.linearDepthTexture}_renderTerrainLinearDepth(e){if(e){const r=this._renderContext.output;this._renderContext.output=F.Depth,this._offscreen.renderToTargets(()=>this._renderTransparentTerrain(),this._offscreen.terrainLinearDepth,this._offscreen.tmpDepth,[-1e10,-1e10,-1e10,1],!0,!0),this._renderContext.output=r}else this._offscreen.disposeTarget(this._offscreen.terrainLinearDepth);this._bindParameters.multipassTerrain.linearDepthTexture=this._offscreen.terrainLinearDepthTexture}_renderGeometryLinearDepth(e){if(e){const r=this._renderContext.output;this._offscreen.renderToTargets(()=>this._renderGeometryPass(F.Depth),this._offscreen.geometryLinearDepth,this._offscreen.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.output=r}else this._offscreen.disposeTarget(this._offscreen.geometryLinearDepth);this._bindParameters.multipassGeometry.linearDepthTexture=this._offscreen.geometryLinearDepthTexture}get _needsNormal(){return this._ssaoHelper.active}_renderNormal(){this._needsNormal?this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(F.Normal)},this._offscreen.normal,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.normal)}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowCast}_computeDepthRange(e){if(!this._needsDepthRange)return dW;const r=Xvt(e,this._materialRenderers,this._stage.layers);return iC(r,this.renderPlugins.queryDepthRange(e)),r.near=Math.max(e.near,r.near),r.far=Math.min(e.far,r.far),r}_renderGeometryAndTransparentTerrainPass(e){this._renderContext.output=e,this._prepareSlots(pe.TRANSPARENT_TERRAIN),this._renderGeometryPass(e),this._renderTransparentTerrain()}_renderGeometryPass(e){this._renderContext.output=e,this._prepareSlots(pe.TRANSPARENT_MATERIAL),this._renderOpaqueGeometry(),this._renderTransparentGeometry()}_renderSSAO(e){this._ssaoHelper.render(this._bindParameters,e,this._offscreen.linearDepthTexture,this._offscreen.normalTexture)}_prepareOpaqueGeometrySlots(){this._prepareSlots(pe.INTEGRATED_MESH,pe.OPAQUE_TERRAIN,pe.OPAQUE_MATERIAL,pe.POSTPROCESSING_ENVIRONMENT_OPAQUE),this._prepareInternalSlots(this._materialRenderers,pe.OPAQUE_MATERIAL)}_renderOpaqueGeometry(){this._renderSlot(pe.INTEGRATED_MESH),this._renderSlot(pe.OPAQUE_TERRAIN),this._renderInternalSlot(pe.OPAQUE_MATERIAL),this._renderSlot(pe.OPAQUE_MATERIAL),this._renderSlot(pe.POSTPROCESSING_ENVIRONMENT_OPAQUE)}_renderTransparentGeometry(){this._renderInternalSlot(pe.TRANSPARENT_MATERIAL),this._renderSlot(pe.TRANSPARENT_MATERIAL)}_renderTransparentTerrain(){this._renderSlot(pe.TRANSPARENT_TERRAIN)}_renderHUDVisibility(e){let r=!1;return this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper.hudVisibilityTexture,r=this._renderInternalSlot(pe.OCCLUSION_PIXELS)},e),r}_renderLineCallouts(e){this._bindParameters.renderTransparentlyOccludedHUD=e,e===fc.Occluded?this._offscreen.renderToTargets(()=>this._renderInternalSlot(pe.LINE_CALLOUTS),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderInternalSlot(pe.LINE_CALLOUTS)}_renderHUD(e,r){this._hasHUDElements&&(this._oitEnabled?(this._renderOITPass(xS.HUD,e),this._rctx.bindFramebuffer(r),this._compositingHelper.composite(this._bindParameters,this._offscreen.hudColorTexture,pa.PremultipliedAlpha)):e===fc.Occluded?this._offscreen.renderToTargets(()=>this._renderHUDElements(fc.Occluded),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderHUDElements(e))}_renderHUDElements(e){this._bindParameters.renderTransparentlyOccludedHUD=e,this._prepareInternalSlots(this._materialRenderers,pe.LINE_CALLOUTS_HUD_DEPTH,pe.HUD_MATERIAL,pe.LABEL_MATERIAL),this._renderInternalSlot(pe.LINE_CALLOUTS_HUD_DEPTH),this._renderInternalSlot(pe.HUD_MATERIAL),this._renderInternalSlot(pe.LABEL_MATERIAL)}get _needsHighlight(){return this._hasHighlights||this._renderPlugins.needsHighlight}get _needsShadowHighlight(){return this._shadowMap.enabled&&this._shadowHighlight.isVisible&&this._needsHighlight}_renderHighlights(e,r){if(!this._needsHighlight)return void this._offscreen.disposeTarget(this._offscreen.highlight);const i=this._highlight,s=this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(F.Highlight),this._rctx.clearSafe(Si.DEPTH_BUFFER_BIT),this._renderHUDElements(fc.Both)},this._offscreen.highlight,this._offscreen.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=s.colorTexture,this._needsShadowHighlight&&this._shadowHighlight.render(r,e),i.render(this._bindParameters,s,e)}get _needsShadowCast(){return this._shadowAccumulator.isAccumulating}_accumulateShadows(e,r,i){this._needsShadowCast&&this._offscreen.linearDepthTexture!=null&&this._shadowAccumulator.renderAccumulation(this._offscreen.linearDepthTexture,e,r,i)}_prepareTransparencySlots(){this._renderContext.output=F.Alpha,this._bindParameters.transparencyPassType=dt.Alpha,this._prepareInternalSlots(this._materialRenderers,pe.TRANSPARENT_MATERIAL),this._prepareSlots(pe.TRANSPARENT_MATERIAL),this._renderContext.output=F.Color,this._bindParameters.transparencyPassType=dt.Color,this._prepareInternalSlots(this._materialRenderers,pe.TRANSPARENT_MATERIAL),this._prepareSlots(pe.TRANSPARENT_MATERIAL),this._bindParameters.transparencyPassType=dt.FrontFace,this._prepareInternalSlots(this._materialRenderers,pe.TRANSPARENT_MATERIAL),this._prepareSlots(pe.TRANSPARENT_MATERIAL),this._bindParameters.transparencyPassType=dt.NONE}_renderOITPass(e,r=fc.Both){const i=e===xS.HUD,s=i?()=>this._renderHUDElements(r):()=>this._renderTransparentGeometry(),n=a=>{this._bindParameters.transparencyPassType=a,this._offscreen.renderOITPass(s,a,i)},o=this._renderContext.output;this._renderContext.output=F.Alpha,n(dt.Alpha),this._renderContext.output=F.Color,n(dt.Color),n(dt.FrontFace),this._offscreen.compositeTransparentOntoOpaque(this._bindParameters,i),this._bindParameters.transparencyPassType=dt.NONE,this._renderContext.output=o,this._oitUsed=!0}_disposeOITBuffers(){this._oitUsed||(this._offscreen.disposeTarget(this._offscreen.alphaFloatTarget),this._offscreen.disposeTarget(this._offscreen.colorFloatTarget),this._offscreen.disposeTarget(this._offscreen.frontFaceTarget))}_renderOccluded(){let e=0;Jc.clear(),this._materialRenderers.forAll(o=>{o.material&&o.material.isVisible()&&o.material.renderOccluded===Ni.OccludeAndTransparentStencil&&(e|=o.material.renderOccluded,Jc.push(o))});const r=this._offscreen,i=(o,a,l,c,h)=>{e&a&&(r.renderToTargets(l,r.tmpColor,r.mainDepth,[0,0,0,0],c,h),r.compositeOccludedOntoMain(this._bindParameters,o))};Jc.length!==0&&(this._prepareInternalSlots(Jc,pe.OCCLUDER_MATERIAL,pe.TRANSPARENT_OCCLUDER_MATERIAL),this._renderInternalSlot(pe.OCCLUDER_MATERIAL,Jc),i(.5,Ni.OccludeAndTransparentStencil,()=>this._renderInternalSlot(pe.TRANSPARENT_OCCLUDER_MATERIAL,Jc),!1,!1)),Jc.clear(),this._materialRenderers.forAll(o=>{o.material&&o.material.isVisible()&&(o.material.renderOccluded===Ni.OccludeAndTransparent||o.material.renderOccluded===Ni.Transparent||o.material.renderOccluded===Ni.Opaque)&&(e|=o.material.renderOccluded,Jc.push(o))});const s=this._renderPlugins.renderOccludedFlags;if(e|=s,!e)return;const n=o=>{this._renderContext.renderOccludedMask=o,this._prepareInternalSlots(Jc,pe.OPAQUE_MATERIAL,pe.TRANSPARENT_MATERIAL,pe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),s>Ni.Occlude&&this._renderSlot(pe.OCCLUDED_TERRAIN),this._renderInternalSlot(pe.OPAQUE_MATERIAL,Jc),this._renderInternalSlot(pe.TRANSPARENT_MATERIAL,Jc),this._renderInternalSlot(pe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,Jc),this._renderContext.resetRenderOccludedMask()};this._renderContext.output=F.Color,i(.5,Ni.OccludeAndTransparent,()=>n(Ni.OccludeAndTransparent),!0,Ul.OutlineVisualElementMask),i(.5,Ni.Transparent,()=>n(Ni.Transparent),!0,Ul.OutlineVisualElementMask),i(1,Ni.Opaque,()=>n(Ni.Opaque),!0,Ul.OutlineVisualElementMask),Jc.clear()}_renderAntiAliasing(e){if(this._antialiasing){if(this._smaaPass.enable(()=>this._requestRender())&&e!=null)return this._smaaPass.render(e),!0}else this._smaaPass.disable();return!1}_prepare(e,r){this._needsTransparentPass=this._materialRenderers.some(i=>i.requiresSlot(pe.TRANSPARENT_MATERIAL,F.Color)),this._bindParameters.camera=e,this._bindParameters.contentCamera=r}_ensureBindParameters(e,r){this._bindParameters.camera=e,this._bindParameters.contentCamera=r;const i=this._renderContext.offscreenRenderingHelper;this._bindParameters.hudVisibilityTexture=i.hudVisibilityTexture,this._bindParameters.mainColorTexture=i.mainColorTexture,this._bindParameters.highlightDepthTexture=i.depthTexture??this._getFallbackDepthTexture()}_ensureBindParametersSSR(e){if(this._bindParameters.ssr.enabled=this.hasReflections,this._bindParameters.ssr.enabled){this._ssrEnableTime==null&&(this._ssrEnableTime=e),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=pn:($n(spe,this._bindParameters.camera.viewMatrix),$n(ipe,this._bindParameters.camera.projectionMatrix),ai(YT,spe,ipe),ai(YT,this._renderContext.lastFrameCamera.viewMatrix,YT),ai(YT,this._renderContext.lastFrameCamera.projectionMatrix,YT),this._reprojectionMatrix=YT),this._bindParameters.ssr.lastFrameColorTexture=this._offscreen.lastFrameColorTexture;const r=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=r>0?Math.min(r,e-this._ssrEnableTime)/r:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._reprojectionMatrix=pn,this._bindParameters.ssr.lastFrameColorTexture=null,this._ssrEnableTime=null}_prepareInternalSlots(e,...r){for(const i of r)this._bindParameters.slot=i,e.forAll(s=>{s.material.shouldRender(this._renderContext)&&s.prepareTechnique(this._renderContext)})}_renderInternalSlot(e,r=this._materialRenderers){let i=!1;return this._bindParameters.slot=e,r.forAll(s=>{if(s.material.shouldRender(this._renderContext)){const n=s.prepareTechnique(this._renderContext);n!=null&&(s.render(this._renderContext,n),i=!0)}}),i}_getFallbackDepthTexture(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=zxe(this._rctx)),this._fallbackDepthStencilTexture}get gpuMemoryUsage(){return{offscreen:this._offscreen?.gpuMemoryUsage??0,highlights:(this._highlight?.gpuMemoryUsage??0)+(this._shadowHighlight?.gpuMemoryUsage??0),shadows:this._shadowMap?.gpuMemoryUsage??0,ssao:this._ssaoHelper?.gpuMemoryUsage??0}}get test(){const e=this;return{offscreen:this._offscreen,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,weatherIsFading:this._bindParameters.cloudsFade.isFading,resetRenderStateFeatures:()=>{e._renderStateFeatures=Hne()},getFramebufferTexture:r=>{switch(r){case v_.Color:return e._offscreen.colorTexture;case v_.LinearDepth:return e._offscreen.linearDepthTexture;case v_.Normals:return e._offscreen.normalTexture;case v_.ShadowMap:return e._shadowMap.depthTexture;case v_.HudVisibility:return e._offscreen.hudVisibilityTexture;case v_.Highlight:return e._offscreen.highlightTexture}}}}};var xS,v_;u([p()],oc.prototype,"_renderPlugins",void 0),u([p()],oc.prototype,"_shadowAccumulator",void 0),u([p()],oc.prototype,"_state",void 0),u([p()],oc.prototype,"_renderStateFeatures",void 0),u([p()],oc.prototype,"_antialiasingEnabled",void 0),u([p({readOnly:!0})],oc.prototype,"_antialiasing",null),u([p()],oc.prototype,"_ssaoEnabled",void 0),u([p()],oc.prototype,"_smaaPass",void 0),u([p({autoDestroy:!0})],oc.prototype,"_edgeView",void 0),u([p()],oc.prototype,"updating",null),u([p()],oc.prototype,"isCameraFinal",null),oc=u([P("esri.views.3d.webgl-engine.lib.Renderer")],oc),function(t){t[t.Geometry=0]="Geometry",t[t.HUD=1]="HUD"}(xS||(xS={})),function(t){t[t.Color=0]="Color",t[t.LinearDepth=1]="LinearDepth",t[t.Normals=2]="Normals",t[t.ShadowMap=3]="ShadowMap",t[t.HudVisibility=4]="HudVisibility",t[t.Highlight=5]="Highlight"}(v_||(v_={}));const Jc=new Vt,ipe=xe(),spe=xe(),YT=xe();function Hbt(t){return e=>t.immediate.schedule(e)}let rPe=class iPe{constructor(e){this._rctx=e,this._indexBuffer=this._createIndexbuffer(),this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:`#version 300 es
    precision highp float;

    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,fragment:`#version 300 es
    precision highp float;

    out vec4 fragColor;

    void main(void) {
      fragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`}}_createHelperProgram(){const e=iPe.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}_createIndexbuffer(){return kr.createIndex(this._rctx,Cr.STATIC_DRAW,new Uint32Array([0]))}resetIndicesType(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,Tt.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(At.POINTS,1,st.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}},npe=class{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:Se.ONE,dstRGB:Se.ZERO,srcAlpha:Se.ONE,dstAlpha:Se.ZERO},this.blendEquation={mode:vm.ADD,modeAlpha:vm.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=fp.BACK,this.frontFace=NE.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=ri.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:fp.FRONT_AND_BACK,func:ri.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:fp.FRONT_AND_BACK,fail:bs.KEEP,zFail:bs.KEEP,zPass:bs.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.uniformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}},qbt=class{constructor(e){this._allocations=new Map,e?Error.stackTraceLimit=1/0:(this.add=()=>{},this.remove=()=>{})}add(e){this._allocations.set(e,new Error().stack)}remove(e){this._allocations.delete(e)}get information(){let e="";if(this._allocations.size>0){e+=`${this._allocations.size} live object allocations:
`;const r=new Map;this._allocations.forEach(i=>{r.set(i,(r.get(i)??0)+1)}),r.forEach((i,s)=>{const n=s.split(`
`);n.shift(),n.shift(),e+=`${i}: ${n.shift()}
`,n.forEach(o=>e+=`   ${o}
`)})}return e}};const Wbt={RECORD_ALLOCATIONS:!1};let Xbt=class{constructor(){for(this._current=new Array,this._max=new Array,this._allocations=new qbt(Wbt.RECORD_ALLOCATIONS);this._current.length<In.COUNT;)this._current.push(0),this._max.push(0)}resetMax(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)}increment(e,r){const i=++this._current[e];this._max[e]=Math.max(i,this._max[e]),this._allocations.add(r)}decrement(e,r){--this._current[e],this._allocations.remove(r)}get max(){return this._max}get current(){return this._current}get total(){return this.current.reduce((e,r)=>e+r,0)}get resourceInformation(){let e="";if(this.total>0){e+=`Live objects:
`;for(let r=0;r<In.COUNT;++r){const i=this._current[r];i>0&&(e+=`${In[r]}: ${i}
`)}}return e+=this._allocations.information,e}},Ybt=class{constructor(e,r,i){const s=r.textureFilterAnisotropic,n=i.maxAnisotropy??1/0;this.versionString=e.getParameter(e.VERSION),this.maxVertexTextureImageUnits=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxVertexAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.maxMaxAnisotropy=s?Math.min(e.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY),n):1,this.maxTextureImageUnits=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxRenderbufferSize=e.getParameter(e.MAX_RENDERBUFFER_SIZE),this.maxViewportDims=e.getParameter(e.MAX_VIEWPORT_DIMS),kp(e)?(this.maxUniformBufferBindings=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS),this.maxVertexUniformBlocks=e.getParameter(e.MAX_VERTEX_UNIFORM_BLOCKS),this.maxFragmentUniformBlocks=e.getParameter(e.MAX_FRAGMENT_UNIFORM_BLOCKS),this.maxUniformBlockSize=e.getParameter(e.MAX_UNIFORM_BLOCK_SIZE),this.uniformBufferOffsetAlignment=e.getParameter(e.UNIFORM_BUFFER_OFFSET_ALIGNMENT),this.maxArrayTextureLayers=e.getParameter(e.MAX_ARRAY_TEXTURE_LAYERS),this.maxSamples=e.getParameter(e.MAX_SAMPLES)):(this.maxUniformBufferBindings=0,this.maxVertexUniformBlocks=0,this.maxFragmentUniformBlocks=0,this.maxUniformBlockSize=0,this.uniformBufferOffsetAlignment=1,this.maxArrayTextureLayers=1,this.maxSamples=1)}};const Zbt=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var ope,sPe={exports:{}};(ope=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(sPe.exports=ope);const Jbt=FP(sPe.exports);var ape,wW={exports:{}};wW.exports,ape=wW,function(t){var e=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];e!==void 0&&(ape.exports=e)}();const lpe=FP(wW.exports);var nPe={exports:{}};(function(t){(function(e){var r=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"]}();r!==void 0&&(t.exports=r)})()})(nPe);const Qbt=FP(nPe.exports);var xd=999,cpe=9999,DV=0,NV=1,upe=2,hpe=3,dpe=4,ZL=5,Kbt=6,ewt=7,twt=8,ppe=9,rwt=10,fpe=11,iwt=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function swt(){var t,e,r,i=0,s=0,n=xd,o=[],a=[],l=1,c=0,h=0,d=!1,f=!1,m="";return function(N){return a=[],N!==null?_(N.replace?N.replace(/\r\n/g,`
`):N):v()};function g(N){N.length&&a.push({type:iwt[n],data:N,position:h,line:l,column:c})}function _(N){var q;for(i=0,r=(m+=N).length;t=m[i],i<r;){switch(q=i,n){case DV:i=E();break;case NV:i=S();break;case upe:i=x();break;case hpe:i=A();break;case dpe:i=D();break;case fpe:i=M();break;case ZL:i=k();break;case cpe:i=L();break;case ppe:i=T();break;case xd:i=b()}q!==i&&(m[q]===`
`?(c=0,++l):++c)}return s+=i,m=m.slice(i),a}function v(N){return o.length&&g(o.join("")),n=rwt,g("(eof)"),a}function b(){return o=o.length?[]:o,e==="/"&&t==="*"?(h=s+i-1,n=DV,e=t,i+1):e==="/"&&t==="/"?(h=s+i-1,n=NV,e=t,i+1):t==="#"?(n=upe,h=s+i,i):/\s/.test(t)?(n=ppe,h=s+i,i):(d=/\d/.test(t),f=/[^\w_]/.test(t),h=s+i,n=d?dpe:f?hpe:cpe,i)}function T(){return/[^\s]/g.test(t)?(g(o.join("")),n=xd,i):(o.push(t),e=t,i+1)}function x(){return t!=="\r"&&t!==`
`||e==="\\"?(o.push(t),e=t,i+1):(g(o.join("")),n=xd,i)}function S(){return x()}function E(){return t==="/"&&e==="*"?(o.push(t),g(o.join("")),n=xd,i+1):(o.push(t),e=t,i+1)}function A(){if(e==="."&&/\d/.test(t))return n=ZL,i;if(e==="/"&&t==="*")return n=DV,i;if(e==="/"&&t==="/")return n=NV,i;if(t==="."&&o.length){for(;R(o););return n=ZL,i}if(t===";"||t===")"||t==="("){if(o.length)for(;R(o););return g(t),n=xd,i+1}var N=o.length===2&&t!=="=";if(/[\w_\d\s]/.test(t)||N){for(;R(o););return n=xd,i}return o.push(t),e=t,i+1}function R(N){for(var q,X,G=0;;){if(q=lpe.indexOf(N.slice(0,N.length+G).join("")),X=lpe[q],q===-1){if(G--+N.length>0)continue;X=N.slice(0,1).join("")}return g(X),h+=X.length,(o=o.slice(X.length)).length}}function M(){return/[^a-fA-F0-9]/.test(t)?(g(o.join("")),n=xd,i):(o.push(t),e=t,i+1)}function D(){return t==="."||/[eE]/.test(t)?(o.push(t),n=ZL,e=t,i+1):t==="x"&&o.length===1&&o[0]==="0"?(n=fpe,o.push(t),e=t,i+1):/[^\d]/.test(t)?(g(o.join("")),n=xd,i):(o.push(t),e=t,i+1)}function k(){return t==="f"&&(o.push(t),e=t,i+=1),/[eE]/.test(t)||t==="-"&&/[eE]/.test(e)?(o.push(t),e=t,i+1):/[^\d]/.test(t)?(g(o.join("")),n=xd,i):(o.push(t),e=t,i+1)}function L(){if(/[^\d\w_]/.test(t)){var N=o.join("");return n=Jbt.indexOf(N)>-1?twt:Qbt.indexOf(N)>-1?ewt:Kbt,g(o.join("")),n=xd,i}return o.push(t),e=t,i+1}}function nwt(t){var e=swt(),r=[];return r=(r=r.concat(e(t))).concat(e(null))}function owt(t){return nwt(t)}function awt(t){return t.map(e=>e.type!=="eof"?e.data:"").join("")}const FV=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];function lwt(t,e="100",r="300 es"){const i=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const s of t)if(s.type==="preprocessor"){const n=i.exec(s.data);if(n){const o=n[1].replaceAll(/\s\s+/g," ");if(o===r)return o;if(o===e)return s.data="#version "+r,e;throw new Error("unknown glsl version: "+o)}}return t.splice(0,0,{type:"preprocessor",data:"#version "+r},{type:"whitespace",data:`
`}),null}function cwt(t,e){for(let r=e-1;r>=0;r--){const i=t[r];if(i.type!=="whitespace"&&i.type!=="block-comment"){if(i.type!=="keyword")break;if(i.data==="attribute"||i.data==="in")return!0}}return!1}function PO(t,e,r,i){i=i||r;for(const s of t)if(s.type==="ident"&&s.data===r)return i in e?e[i]++:e[i]=0,PO(t,e,i+"_"+e[i],i);return r}function oPe(t,e,r="afterVersion"){function i(l,c){for(let h=c;h<l.length;h++){const d=l[h];if(d.type==="operator"&&d.data===";")return h}return null}function s(l){let c=-1,h=0,d=-1;for(let f=0;f<l.length;f++){const m=l[f];if(m.type==="preprocessor"&&(/\#(if|ifdef|ifndef)\s+.+/.test(m.data)?++h:/\#endif\s*.*/.test(m.data)&&--h),r!=="afterVersion"&&r!=="afterPrecision"||m.type==="preprocessor"&&/^#version/.test(m.data)&&(d=Math.max(d,f)),r==="afterPrecision"&&m.type==="keyword"&&m.data==="precision"){const g=i(l,f);if(g===null)throw new Error("precision statement not followed by any semicolons!");d=Math.max(d,g)}c<d&&h===0&&(c=f)}return c+1}const n={data:`
`,type:"whitespace"},o=l=>l<t.length&&/[^\r\n]$/.test(t[l].data);let a=s(t);o(a-1)&&t.splice(a++,0,n);for(const l of e)t.splice(a++,0,l);o(a-1)&&o(a)&&t.splice(a,0,n)}function uwt(t,e,r,i="lowp"){oPe(t,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function hwt(t,e,r,i,s="lowp"){oPe(t,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:i.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:s},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function dwt(t,e){let r,i,s=-1;for(let n=e;n<t.length;n++){const o=t[n];if(o.type==="operator"&&(o.data==="["&&(r=n),o.data==="]")){i=n;break}o.type==="integer"&&(s=parseInt(o.data,10))}return r&&i&&t.splice(r,i-r+1),s}function mpe(t,e){if(t.startsWith("#version 300"))return t;const r=owt(t);if(lwt(r,"100","300 es")==="300 es")return t;let i=null,s=null;const n={},o={};for(let a=0;a<r.length;++a){const l=r[a];switch(l.type){case"keyword":e===gu.VERTEX_SHADER&&l.data==="attribute"?l.data="in":l.data==="varying"&&(l.data=e===gu.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(l.data.trim())&&(l.data=l.data.replaceAll(/(2D|Cube|EXT)/g,"")),e===gu.FRAGMENT_SHADER&&l.data==="gl_FragColor"&&(i||(i=PO(r,n,"fragColor"),uwt(r,i,"vec4")),l.data=i),e===gu.FRAGMENT_SHADER&&l.data==="gl_FragData"){const c=dwt(r,a+1),h=PO(r,n,"fragData");hwt(r,h,"vec4",c,"mediump"),l.data=h}else e===gu.FRAGMENT_SHADER&&l.data==="gl_FragDepthEXT"&&(s||(s=PO(r,n,"gl_FragDepth")),l.data=s);break;case"ident":if(Zbt.includes(l.data)){if(e===gu.VERTEX_SHADER&&cwt(r,a))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");l.data in o||(o[l.data]=PO(r,n,l.data)),l.data=o[l.data]}}}for(let a=r.length-1;a>=0;--a){const l=r[a];if(l.type==="preprocessor"){const c=l.data.match(/\#extension\s+(.*)\:/);if(c&&c[1]&&FV.includes(c[1].trim())){const f=r[a+1];r.splice(a,f&&f.type==="whitespace"?2:1)}const h=l.data.match(/\#ifdef\s+(.*)/);h&&h[1]&&FV.includes(h[1].trim())&&(l.data="#if 1");const d=l.data.match(/\#ifndef\s+(.*)/);d&&d[1]&&FV.includes(d[1].trim())&&(l.data="#if 0")}}return pwt(t,awt(r))}function pwt(t,e){return e}const fwt=4294967295;let mwt=class{constructor(e,r,i,s,n=new Map){this._context=e,this._locations=s,this._uniformBlockBindings=n,this._refCount=1,this._compiled=!1,this._nameToUniformLocation={},this._nameToUniform1={},this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,e||console.error("RenderingContext isn't initialized!"),r.length===0&&console.error("Shaders source should not be empty!"),this._context.type===lr.WEBGL2&&(r=mpe(r,gu.VERTEX_SHADER),i=mpe(i,gu.FRAGMENT_SHADER)),this._vShader=gpe(this._context,gu.VERTEX_SHADER,r),this._fShader=gpe(this._context,gu.FRAGMENT_SHADER,i),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(In.Shader,this),Gj()&&(this.vertexShader=r,this.fragmentShader=i);const o=this._context.gl,a=o.createProgram();if(o.attachShader(a,this._vShader),o.attachShader(a,this._fShader),this._locations.forEach((l,c)=>o.bindAttribLocation(a,l,c)),o.linkProgram(a),Gj()&&!o.getProgramParameter(a,o.LINK_STATUS)&&console.error(`Could not link shader
validated: ${o.getProgramParameter(a,o.VALIDATE_STATUS)}, gl error ${o.getError()}, vertex: ${o.getShaderParameter(this._vShader,o.COMPILE_STATUS)}, fragment: ${o.getShaderParameter(this._fShader,o.COMPILE_STATUS)}, info log: ${o.getProgramInfoLog(a)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`),this._context.type===lr.WEBGL2){const l=o;for(const[c,h]of this._uniformBlockBindings){const d=l.getUniformBlockIndex(a,c);d<fwt&&l.uniformBlockBinding(a,d,h)}}this._glName=a,this._context.instanceCounter.increment(In.Program,this)}get glName(){return this._glName}get hasGLName(){return this._glName!=null}get compiled(){if(this._compiled)return!0;const e=this._context.gl.getExtension("KHR_parallel_shader_compile");return e==null||this.glName==null?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,e.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const e=this._context.gl;this._vShader&&(e.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(In.Shader,this)),this._fShader&&(e.deleteShader(this._fShader),this._fShader=null),this._glName&&(e.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(In.Program,this))}ref(){++this._refCount}_getUniformLocation(e){return this._nameToUniformLocation[e]===void 0&&this.glName!=null&&(this._nameToUniformLocation[e]=this._context.gl.getUniformLocation(this.glName,e)),this._nameToUniformLocation[e]}hasUniform(e){return this._getUniformLocation(e)!==null}setUniform1i(e,r){const i=this._nameToUniform1[e];i!==void 0&&r===i||(this._context.gl.uniform1i(this._getUniformLocation(e),r),this._nameToUniform1[e]=r)}setUniform1iv(e,r){lf(this._nameToUniform1v,e,r)&&this._context.gl.uniform1iv(this._getUniformLocation(e),r)}setUniform2iv(e,r){lf(this._nameToUniform2,e,r)&&this._context.gl.uniform2iv(this._getUniformLocation(e),r)}setUniform3iv(e,r){lf(this._nameToUniform3,e,r)&&this._context.gl.uniform3iv(this._getUniformLocation(e),r)}setUniform4iv(e,r){lf(this._nameToUniform4,e,r)&&this._context.gl.uniform4iv(this._getUniformLocation(e),r)}setUniform1f(e,r){const i=this._nameToUniform1[e];i!==void 0&&r===i||(this._context.gl.uniform1f(this._getUniformLocation(e),r),this._nameToUniform1[e]=r)}setUniform1fv(e,r){lf(this._nameToUniform1v,e,r)&&this._context.gl.uniform1fv(this._getUniformLocation(e),r)}setUniform2f(e,r,i){const s=this._nameToUniform2.get(e);s===void 0?(this._context.gl.uniform2f(this._getUniformLocation(e),r,i),this._nameToUniform2.set(e,[r,i])):r===s[0]&&i===s[1]||(this._context.gl.uniform2f(this._getUniformLocation(e),r,i),s[0]=r,s[1]=i)}setUniform2fv(e,r){lf(this._nameToUniform2,e,r)&&this._context.gl.uniform2fv(this._getUniformLocation(e),r)}setUniform3f(e,r,i,s){const n=this._nameToUniform3.get(e);n===void 0?(this._context.gl.uniform3f(this._getUniformLocation(e),r,i,s),this._nameToUniform3.set(e,[r,i,s])):r===n[0]&&i===n[1]&&s===n[2]||(this._context.gl.uniform3f(this._getUniformLocation(e),r,i,s),n[0]=r,n[1]=i,n[2]=s)}setUniform3fv(e,r){lf(this._nameToUniform3,e,r)&&this._context.gl.uniform3fv(this._getUniformLocation(e),r)}setUniform4f(e,r,i,s,n){const o=this._nameToUniform4.get(e);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(e),r,i,s,n),this._nameToUniform4.set(e,[r,i,s,n])):o!==void 0&&r===o[0]&&i===o[1]&&s===o[2]&&n===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(e),r,i,s,n),o[0]=r,o[1]=i,o[2]=s,o[3]=n)}setUniform4fv(e,r){lf(this._nameToUniform4,e,r)&&this._context.gl.uniform4fv(this._getUniformLocation(e),r)}setUniformMatrix3fv(e,r,i=!1){lf(this._nameToUniformMatrix3,e,r)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(e),i,r)}setUniformMatrix4fv(e,r,i=!1){lf(this._nameToUniformMatrix4,e,r)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(e),i,r)}stop(){}};function gpe(t,e,r){const i=t.gl,s=i.createShader(e);return i.shaderSource(s,r),i.compileShader(s),Gj()&&!i.getShaderParameter(s,i.COMPILE_STATUS)&&(console.error("Compile error in ".concat(e===gu.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(i.getShaderInfoLog(s)),console.error(gwt(r))),s}function gwt(t){let e=2;return t.replaceAll(`
`,()=>`
`+ywt(e++)+":")}function ywt(t){return t>=1e3?t.toString():("  "+t).slice(-3)}function lf(t,e,r){const i=t.get(e);return i?SY(i,r):(t.set(e,Array.from(r)),!0)}let _wt=class{constructor(e){this._rctx=e,this._store=new DC}dispose(){this._store.forEach(e=>e.forEach(r=>r.dispose())),this._store.clear()}acquire(e,r,i,s){const n=this._store.get(e,r);if(n!=null)return n.ref(),n;const o=new mwt(this._rctx,e,r,i,s);return o.ref(),this._store.set(e,r,o),o}get test(){let e=0;return this._store.forEach(r=>r.forEach(i=>e+=i.hasGLName?2:1)),{cachedWebGLObjects:e}}},rI=class{constructor(){this._result=!1}dispose(){this._program=je(this._program)}get result(){return this._program!=null&&(this._result=this._test(this._program),this.dispose()),this._result}},vwt=class extends rI{constructor(e){super(),this._rctx=e,this._helperProgram=null,this._rctx.type===lr.WEBGL2&&ae("mac")&&ae("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){super.dispose(),this._helperProgram?.dispose(),this._helperProgram=null}_test(e){const r=this._rctx;r.resetState();const i=new xr(1);i.wrapMode=Dt.CLAMP_TO_EDGE,i.samplingMode=Rt.NEAREST;const s=new fn(r,i),n=kr.createIndex(this._rctx,Cr.STATIC_DRAW,new Uint8Array([0]));r.bindFramebuffer(s),r.setViewport(0,0,1,1),r.useProgram(this._helperProgram),r.bindBuffer(n,Tt.ELEMENT_ARRAY_BUFFER),r.drawElements(At.POINTS,1,st.UNSIGNED_BYTE,0),r.useProgram(e),r.bindVAO(null),r.drawArrays(At.TRIANGLES,0,258);const o=new Uint8Array(4);return s.readPixels(0,0,1,1,Ct.RGBA,qs.UNSIGNED_BYTE,o),s.dispose(),n.dispose(),o[0]===255}_prepareProgram(){const r=`#version 300 es
    precision highp float;

    out float triangleId;

    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));

    void main(void) {
      triangleId = floor(float(gl_VertexID)/3.0);

      vec3 position = triangleVertices[gl_VertexID % 3];
      float offset = triangleId / ${w.float(85)};
      position.z = 0.5 - offset;

      gl_Position = vec4(position, 1.0);
    }
    `,i=`#version 300 es
    precision highp float;

    in float triangleId;

    out vec4 fragColor;

    void main(void) {
      fragColor = triangleId == ${w.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);
    }
    `;return this._rctx.programCache.acquire(r,i,new Map([]))}_prepareHelperProgram(){const e=rPe.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}},bwt=class extends rI{constructor(e){super(),this._rctx=e,this._program=ype(this._rctx,!1),this._obfuscated=ype(this._rctx,!0)}dispose(){super.dispose(),this._obfuscated=je(this._obfuscated)}_test(e){if(ae("force-double-precision-obfuscation"))return!0;if(this._obfuscated==null)return!1;const r=this._runProgram(e),i=this._runProgram(this._obfuscated);return r!==0&&(i===0||r/i>5)}_runProgram(e){const r=this._rctx;r.resetState();const i=new xr(1);i.wrapMode=Dt.CLAMP_TO_EDGE,i.samplingMode=Rt.NEAREST;const s=new fn(r,i),n=kr.createVertex(r,Cr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new Zh(r,new Map([["position",0]]),{geometry:[new To("position",2,st.UNSIGNED_SHORT,0,4)]},{geometry:n}),a=Pe(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),l=Pe(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),c=new Float32Array(6);PH(a,c,3);const h=new Float32Array(6);PH(l,h,3),r.useProgram(e),e.setUniform3f("u_highA",c[0],c[2],c[4]),e.setUniform3f("u_lowA",c[1],c[3],c[5]),e.setUniform3f("u_highB",h[0],h[2],h[4]),e.setUniform3f("u_lowB",h[1],h[3],h[5]),r.bindFramebuffer(s),r.setViewport(0,0,1,1),r.bindVAO(o),r.drawArrays(At.TRIANGLE_STRIP,0,4);const d=new Uint8Array(4);s.readPixels(0,0,1,1,Ct.RGBA,qs.UNSIGNED_BYTE,d),o.dispose(),s.dispose();const f=(a[2]-l[2])/25,m=iK(d);return Math.abs(f-m)}};function ype(t,e){const r=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${e?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `,i=`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `;return t.programCache.acquire(r,i,new Map([["position",0]]))}let wwt=class extends rI{constructor(e){if(super(),this._rctx=e,!e.gl)return;if(e.type===lr.WEBGL1)return void(this._result=!(!e.capabilities.textureFloat?.textureFloat||!e.capabilities.colorBufferFloat?.textureFloat));if(!(e.capabilities.textureFloat?.textureFloat&&e.capabilities.colorBufferFloat?.textureFloat&&e.capabilities.colorBufferFloat?.floatBlend))return;const r=`
    precision highp float;
    attribute vec2 a_pos;

    void main() {
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,i=`
     precision highp float;

     void main() {
      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
     }
    `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}_test(e){const r=this._rctx,i=new xr(1);i.wrapMode=Dt.CLAMP_TO_EDGE,i.dataType=qs.FLOAT,i.internalFormat=Ke.RGBA32F,i.samplingMode=Rt.NEAREST;const s=new fn(r,i),n=kr.createVertex(r,Cr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new Zh(r,new Map([["a_pos",0]]),{geometry:[new To("a_pos",2,st.UNSIGNED_SHORT,0,4)]},{geometry:n});r.useProgram(e);const a=r.getBoundFramebufferObject(),{x:l,y:c,width:h,height:d}=r.getViewport();r.bindFramebuffer(s),r.setViewport(0,0,1,1),r.bindVAO(o),r.drawArrays(At.TRIANGLE_STRIP,0,4);const f=Mt({blending:pEe});r.setPipelineState(f),r.drawArrays(At.TRIANGLE_STRIP,0,4);const m=r.gl.getError();return r.setViewport(l,c,h,d),r.bindFramebuffer(a),o.dispose(),s.dispose(),m!==1282||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}},xwt=class extends rI{constructor(e){super(),this._rctx=e;const r=`
      precision highp float;
      attribute vec2 a_pos;
      uniform highp sampler2D u_texture;
      varying vec4 v_color;

      float getBit(in float bitset, in int bitIndex) {
        float offset = pow(2.0, float(bitIndex));
        return mod(floor(bitset / offset), 2.0);
      }

      void main() {
        vec4 value = texture2D(u_texture, vec2(0.0));
        float bit = getBit(value.x * 255.0, 1);

        v_color = bit * vec4(1.0);
        gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
      }
      `,i=`
      precision highp float;
      varying vec4 v_color;

      void main() {
        gl_FragColor = v_color;
      }
      `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}_test(e){const r=this._rctx,i=new xr(1);i.wrapMode=Dt.CLAMP_TO_EDGE,i.samplingMode=Rt.NEAREST;const s=new fn(r,i),n=new Uint8Array(4),o=kr.createVertex(r,Cr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),a=new Zh(r,new Map([["a_position",0]]),{geometry:[new To("a_position",2,st.SHORT,0,4)]},{geometry:o});r.useProgram(e);const l=new Ot(r,i,new Uint8Array([2,255,0,0]));e.setUniform1i("u_texture",0),r.bindTexture(l,0);const c=r.getBoundFramebufferObject();r.bindFramebuffer(s),r.useProgram(e);const{x:h,y:d,width:f,height:m}=r.getViewport();r.setViewport(0,0,1,1),r.bindVAO(a),r.drawArrays(At.TRIANGLE_STRIP,0,4),r.setViewport(h,d,f,m),s.readPixels(0,0,1,1,Ct.RGBA,qs.UNSIGNED_BYTE,n),a.dispose(),s.dispose();const g=n[0]!==255||n[1]!==255||n[2]!==255||n[3]!==255;return g&&K.getLogger("esri.views.webgl.testSamplerPrecision").warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${n[0]}.${n[1]}.${n[2]}.${n[3]}]`),r.bindFramebuffer(c),g}};new To("a_pos",2,st.BYTE,0,2);new To("a_pos",2,st.BYTE,0,4),new To("a_tex",2,st.BYTE,2,4);const Twt={geometry:[new To("a_pos",2,st.UNSIGNED_SHORT,0,4)]};let Swt=class extends rI{constructor(e){super(),this._rctx=e;const r=`
    precision highp float;

    attribute vec2 a_pos;
    varying vec2 v_uv;

    void main() {
      v_uv = a_pos;
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,i=`
    precision highp float;

    varying vec2 v_uv;

    uniform sampler2D u_texture;

    void main() {
      gl_FragColor = texture2D(u_texture, v_uv);
    }
    `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(e){const r=this._rctx;if(!r.gl)return e.dispose(),!0;const i=new xr(1);i.wrapMode=Dt.CLAMP_TO_EDGE,i.samplingMode=Rt.NEAREST;const s=new fn(r,i),n=kr.createVertex(r,Cr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new Zh(r,new Map([["a_pos",0]]),Twt,{geometry:n}),a=new xr;a.samplingMode=Rt.LINEAR,a.wrapMode=Dt.CLAMP_TO_EDGE;const l=new Ot(r,a,IO);r.useProgram(e),r.bindTexture(l,0),e.setUniform1i("u_texture",0);const c=r.getBoundFramebufferObject(),{x:h,y:d,width:f,height:m}=r.getViewport();r.bindFramebuffer(s),r.setViewport(0,0,1,1),r.setClearColor(0,0,0,0),r.setBlendingEnabled(!1),r.clearSafe(Si.COLOR_BUFFER_BIT),r.bindVAO(o),r.drawArrays(At.TRIANGLE_STRIP,0,4);const g=new Uint8Array(4);return s.readPixels(0,0,1,1,Ct.RGBA,qs.UNSIGNED_BYTE,g),o.dispose(),s.dispose(),l.dispose(),r.setViewport(h,d,f,m),r.bindFramebuffer(c),g[0]!==255}};const IO=new Image;IO.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",IO.width=5,IO.height=5,IO.decode();let Ewt=class{constructor(e){this.rctx=e,this.floatBufferBlend=new wwt(e),this.svgPremultipliesAlpha=new Swt(e),this.doublePrecisionRequiresObfuscation=new bwt(e),this.ignoresSamplerPrecision=new xwt(e),this.drawArraysRequiresIndicesTypeReset=new vwt(e)}dispose(){this.ignoresSamplerPrecision.dispose(),this.doublePrecisionRequiresObfuscation.dispose(),this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}};function Cwt(t,e){if(e.disjointTimerQuery)return null;if(kp(t))return{drawBuffers:t.drawBuffers.bind(t),MAX_DRAW_BUFFERS:t.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:t.MAX_COLOR_ATTACHMENTS};if(e.drawBuffers)return null;const r=t.getExtension("WEBGL_draw_buffers");return r?{drawBuffers:r.drawBuffersWEBGL.bind(r),MAX_DRAW_BUFFERS:r.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:r.MAX_COLOR_ATTACHMENTS_WEBGL}:null}function Awt(t){if(kp(t))return t;const e=t.getExtension("ANGLE_instanced_arrays");return e?{drawArraysInstanced:e.drawArraysInstancedANGLE.bind(e),drawElementsInstanced:e.drawElementsInstancedANGLE.bind(e),vertexAttribDivisor:e.vertexAttribDivisorANGLE.bind(e)}:null}function Owt(t,e){if(e.compressedTextureETC)return null;const r=t.getExtension("WEBGL_compressed_texture_etc");return r?{COMPRESSED_R11_EAC:r.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:r.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:r.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:r.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:r.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:r.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function Rwt(t,e){if(e.compressedTextureS3TC)return null;const r=t.getExtension("WEBGL_compressed_texture_s3tc");return r?{COMPRESSED_RGB_S3TC_DXT1:r.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:r.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:r.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:r.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function Mwt(t,e){if(kp(t))return{MIN:t.MIN,MAX:t.MAX};if(e.blendMinMax)return null;{const r=t.getExtension("EXT_blend_minmax");return r?{MIN:r.MIN_EXT,MAX:r.MAX_EXT}:null}}function Pwt(t,e){if(e.textureFilterAnisotropic)return null;const r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return r?{MAX_TEXTURE_MAX_ANISOTROPY:r.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:r.TEXTURE_MAX_ANISOTROPY_EXT}:null}function Iwt(t,e){if(kp(t))return{textureFloat:!0,textureFloatLinear:!e.textureFloatLinear&&!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:t.HALF_FLOAT,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F};if(t instanceof WebGLRenderingContext){const r=!e.textureHalfFloat&&t.getExtension("OES_texture_half_float");return{textureFloat:!e.textureFloat&&!!t.getExtension("OES_texture_float"),textureFloatLinear:!e.textureFloatLinear&&!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!!r,textureHalfFloatLinear:!e.textureHalfFloatLinear&&!!t.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:r?r.HALF_FLOAT_OES:void 0}}return null}function $wt(t,e){if(kp(t)){const r=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float")||!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),i=!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),s=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return r||i||s?{textureFloat:!!i,textureHalfFloat:!!r,floatBlend:!!s,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F}:null}if(t instanceof WebGLRenderingContext){const r=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float"),i=!e.colorBufferFloat&&t.getExtension("WEBGL_color_buffer_float"),s=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return r||i||s?{textureFloat:!!i,textureHalfFloat:!!r,floatBlend:!!s,RGBA16F:r?r.RGBA16F_EXT:void 0,RGB16F:r?r.RGB16F_EXT:void 0,RGBA32F:i?i.RGBA32F_EXT:void 0}:null}return null}function _pe(t,e,r,i,s){if(i&&kp(t))return!0;if(e[r])return!1;for(const n of s)if(t.getExtension(n))return!0;return!1}function Lwt(t,e){if(!kp(t)||e.textureNorm16)return null;const r=t.getExtension("EXT_texture_norm16");return r?{R16:r.R16_EXT,RG16:r.RG16_EXT,RGB16:r.RGB16_EXT,RGBA16:r.RGBA16_EXT,R16_SNORM:r.R16_SNORM_EXT,RG16_SNORM:r.RG16_SNORM_EXT,RGB16_SNORM:r.RGB16_SNORM_EXT,RGBA16_SNORM:r.RGBA16_SNORM_EXT}:null}function Dwt(t,e){const r=e.loseContext&&t.getExtension("WEBGL_lose_context");return r?{loseRenderingContext:()=>r.loseContext()}:null}function Nwt(t,e){if(kp(t))return{createVertexArray:t.createVertexArray.bind(t),deleteVertexArray:t.deleteVertexArray.bind(t),bindVertexArray:t.bindVertexArray.bind(t)};if(e.vao)return null;const r=t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object");return r?{createVertexArray:r.createVertexArrayOES.bind(r),deleteVertexArray:r.deleteVertexArrayOES.bind(r),bindVertexArray:r.bindVertexArrayOES.bind(r)}:null}let Fwt=class{constructor(e,r){this._gl=e,this._instancing=null,this._vertexArrayObject=null,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._textureFloat=null,this._colorBufferFloat=null,this._minMaxBlending=null,this._loseContext=null,this._drawBuffers=null,this._textureNorm16=null,this._depthTexture=null,this._textureFloatLinear=null,this._disabledExtensions=r.disabledExtensions||{},this._debugWebGLExtensions=r.debugWebGLExtensions||{}}get drawBuffers(){return this._drawBuffers||(this._drawBuffers=Cwt(this._gl,this._disabledExtensions)),this._drawBuffers}get instancing(){return this._instancing||(this._instancing=Awt(this._gl)),this._instancing}get vao(){return this._vertexArrayObject||(this._vertexArrayObject=Nwt(this._gl,this._disabledExtensions)),this._vertexArrayObject}get compressedTextureETC(){return this._compressedTextureETC||(this._compressedTextureETC=Owt(this._gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=Rwt(this._gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=Pwt(this._gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery||(this._disjointTimerQuery=Vbt(this._gl,this._disabledExtensions)),this._disjointTimerQuery}get textureFloat(){return this._textureFloat||(this._textureFloat=Iwt(this._gl,this._disabledExtensions)),this._textureFloat}get colorBufferFloat(){return this._colorBufferFloat||(this._colorBufferFloat=$wt(this._gl,this._disabledExtensions)),this._colorBufferFloat}get blendMinMax(){return this._minMaxBlending||(this._minMaxBlending=Mwt(this._gl,this._disabledExtensions)),this._minMaxBlending}get depthTexture(){return this._depthTexture===null&&(this._depthTexture=_pe(this._gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}get loseContext(){return this._loseContext||(this._loseContext=Dwt(this._gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16||(this._textureNorm16=Lwt(this._gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear===null&&(this._textureFloatLinear=_pe(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(e){return this[e]}},Uwt=class{constructor(e,r){this.gl=e,this.instanceCounter=new Xbt,this.programCache=new _wt(this),this._state=new npe,this._numOfDrawCalls=0,this._numOfTriangles=0,this.type=kp(e)?lr.WEBGL2:lr.WEBGL1,this._loadExtensions(),this.configure(r)}get gl2(){return this.type===lr.WEBGL1?null:this.gl}configure(e){this._capabilities=new Fwt(this.gl,e),this._parameters=new Ybt(this.gl,this._capabilities,e),Ot.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;const r=this.gl.getParameter(this.gl.VIEWPORT);this._state=new npe,this._state.viewport={x:r[0],y:r[1],width:r[2],height:r[3]},this._stateTracker=new Bqe({setBlending:i=>{if(i){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(i.opRgb,i.opAlpha),this.setBlendFunctionSeparate(i.srcRgb,i.dstRgb,i.srcAlpha,i.dstAlpha);const s=i.color;this.setBlendColor(s.r,s.g,s.b,s.a)}else this.setBlendingEnabled(!1)},setCulling:i=>{i?(this.setFaceCullingEnabled(!0),this.setCullFace(i.face),this.setFrontFace(i.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:i=>{i?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(i.factor,i.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:i=>{i?(this.setDepthTestEnabled(!0),this.setDepthFunction(i.func)):this.setDepthTestEnabled(!1)},setStencilTest:i=>{if(i){this.setStencilTestEnabled(!0);const s=i.function;this.setStencilFunction(s.func,s.ref,s.mask);const n=i.operation;this.setStencilOp(n.fail,n.zFail,n.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:i=>{i?(this.setDepthWriteEnabled(!0),this.setDepthRange(i.zNear,i.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:i=>{i?this.setColorMask(i.r,i.g,i.b,i.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:i=>{i?this.setStencilWriteMask(i.mask):this.setStencilWriteMask(0)}}),this.enforceState(),je(this._driverTest),this._driverTest=new Ewt(this)}dispose(){je(this._driverTest),this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(Tt.ARRAY_BUFFER),this.unbindBuffer(Tt.ELEMENT_ARRAY_BUFFER),this.type===lr.WEBGL2&&(this.unbindBuffer(Tt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Tt.PIXEL_PACK_BUFFER),this.unbindBuffer(Tt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Tt.COPY_READ_BUFFER),this.unbindBuffer(Tt.COPY_WRITE_BUFFER)),this._state.textureUnitMap.length=0,vh()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._state.blend!==e&&(e===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=e,this._stateTracker.invalidateBlending())}externalProgramUpdate(){this._state.program?.stop(),this._state.program=null}externalTextureUnitUpdate(e,r){for(let i=0;i<e.length;++i)this._state.textureUnitMap[e[i]]=null;r>=0&&(this._state.activeTexture=r)}externalVertexArrayObjectUpdate(){const e=this.capabilities.vao;e&&(e.bindVertexArray(null),this._state.vertexArrayObject=null),this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(e,r,i,s){e===this._state.blendColor.r&&r===this._state.blendColor.g&&i===this._state.blendColor.b&&s===this._state.blendColor.a||(this.gl.blendColor(e,r,i,s),this._state.blendColor.r=e,this._state.blendColor.g=r,this._state.blendColor.b=i,this._state.blendColor.a=s,this._stateTracker.invalidateBlending())}setBlendFunction(e,r){e===this._state.blendFunction.srcRGB&&r===this._state.blendFunction.dstRGB||(this.gl.blendFunc(e,r),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=e,this._state.blendFunction.dstRGB=r,this._state.blendFunction.dstAlpha=r,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,r,i,s){this._state.blendFunction.srcRGB===e&&this._state.blendFunction.srcAlpha===i&&this._state.blendFunction.dstRGB===r&&this._state.blendFunction.dstAlpha===s||(this.gl.blendFuncSeparate(e,r,i,s),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=i,this._state.blendFunction.dstRGB=r,this._state.blendFunction.dstAlpha=s,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._state.blendEquation.mode!==e&&(this.gl.blendEquation(e),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,r){this._state.blendEquation.mode===e&&this._state.blendEquation.modeAlpha===r||(this.gl.blendEquationSeparate(e,r),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=r,this._stateTracker.invalidateBlending())}setColorMask(e,r,i,s){this._state.colorMask.r===e&&this._state.colorMask.g===r&&this._state.colorMask.b===i&&this._state.colorMask.a===s||(this.gl.colorMask(e,r,i,s),this._state.colorMask.r=e,this._state.colorMask.g=r,this._state.colorMask.b=i,this._state.colorMask.a=s,this._stateTracker.invalidateColorWrite())}setClearColor(e,r,i,s){this._state.clearColor.r===e&&this._state.clearColor.g===r&&this._state.clearColor.b===i&&this._state.clearColor.a===s||(this.gl.clearColor(e,r,i,s),this._state.clearColor.r=e,this._state.clearColor.g=r,this._state.clearColor.b=i,this._state.clearColor.a=s)}setFaceCullingEnabled(e){this._state.faceCulling!==e&&(e===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._state.polygonOffsetFill!==e&&(e===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,r){this._state.polygonOffset[0]===e&&this._state.polygonOffset[1]===r||(this._state.polygonOffset[0]=e,this._state.polygonOffset[1]=r,this.gl.polygonOffset(e,r),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._state.cullFace!==e&&(this.gl.cullFace(e),this._state.cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._state.frontFace!==e&&(this.gl.frontFace(e),this._state.frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._state.scissorTest!==e&&(e===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=e)}setScissorRect(e,r,i,s){this._state.scissorRect.x===e&&this._state.scissorRect.y===r&&this._state.scissorRect.width===i&&this._state.scissorRect.height===s||(this.gl.scissor(e,r,i,s),this._state.scissorRect.x=e,this._state.scissorRect.y=r,this._state.scissorRect.width=i,this._state.scissorRect.height=s)}setDepthTestEnabled(e){this._state.depthTest!==e&&(e===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._state.clearDepth!==e&&(this.gl.clearDepth(e),this._state.clearDepth=e)}setDepthFunction(e){this._state.depthFunction!==e&&(this.gl.depthFunc(e),this._state.depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._state.depthWrite!==e&&(this.gl.depthMask(e),this._state.depthWrite=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,r){this._state.depthRange.zNear===e&&this._state.depthRange.zFar===r||(this.gl.depthRange(e,r),this._state.depthRange.zNear=e,this._state.depthRange.zFar=r,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._state.stencilTest!==e&&(e===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._state.clearStencil&&(this.gl.clearStencil(e),this._state.clearStencil=e)}setStencilFunction(e,r,i){this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===i||(this.gl.stencilFunc(e,r,i),this._state.stencilFunction.face=fp.FRONT_AND_BACK,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=i,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,r,i,s){this._state.stencilFunction.face===e&&this._state.stencilFunction.func===r&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===s||(this.gl.stencilFuncSeparate(e,r,i,s),this._state.stencilFunction.face=e,this._state.stencilFunction.func=r,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=s,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._state.stencilWriteMask!==e&&(this.gl.stencilMask(e),this._state.stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,r,i){this._state.stencilOperation.face===fp.FRONT_AND_BACK&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===i||(this.gl.stencilOp(e,r,i),this._state.stencilOperation.face=fp.FRONT_AND_BACK,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=i,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,r,i,s){this._state.stencilOperation.face===e&&this._state.stencilOperation.fail===r&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===s||(this.gl.stencilOpSeparate(e,r,i,s),this._state.stencilOperation.face=e,this._state.stencilOperation.fail=r,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=s,this._stateTracker.invalidateStencilTest())}setActiveTexture(e,r=!1){const i=this._state.activeTexture;return e>=0&&(r||e!==this._state.activeTexture)&&(this.gl.activeTexture(dk+e),this._state.activeTexture=e),i}clear(e){e&&this.gl.clear(e)}clearSafe(e,r=255){e&&(e&Si.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),e&Si.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),e&Si.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(r),this.gl.clear(e))}drawArrays(e,r,i){if(vh()&&(this._numOfDrawCalls++,this._numOfTriangles+=vpe(e,i)),this.gl.drawArrays(e,r,i),vh()){const s=sne(this);s&&console.error("drawArrays:",s)}}drawElements(e,r,i,s){if(vh()&&(this._numOfDrawCalls++,this._numOfTriangles+=vpe(e,r)),this.gl.drawElements(e,r,i,s),vh()){const n=sne(this);if(n){const o=this.getBoundVAO(),a=o?.indexBuffer,l=o?.vertexBuffers,c={indexBuffer:a,vertexBuffers:l},h={mode:e,count:r,type:i,offset:s},d=a?.size??0,f=s+r,m=d<f?`. Buffer is too small. Attempted to draw index ${f} of ${d}`:"";console.error(`drawElements: ${n}${m}`,{args:h,vao:c})}}}logInfo(){vh()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){vh()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(e,r,i,s){i=Math.max(Math.round(i),1),s=Math.max(Math.round(s),1);const n=this._state.viewport;n.x===e&&n.y===r&&n.width===i&&n.height===s||(n.x=e,n.y=r,n.width=i,n.height=s,this.gl.viewport(e,r,i,s))}getViewport(){const e=this._state.viewport;return{x:e.x,y:e.y,width:e.width,height:e.height}}useProgram(e){this._state.program!==e&&(this._state.program?.stop(),this._state.program=e,this.gl.useProgram(e?.glName??null))}bindTexture(e,r,i=!1){(r>=this.parameters.maxTextureImageUnits||r<0)&&console.error("Input texture unit is out of range of available units!");const s=this._state.textureUnitMap[r];return e==null||e.glName==null?(s!=null&&(this.setActiveTexture(r,i),this.gl.bindTexture(s.descriptor.target,null)),this._state.textureUnitMap[r]=null,s):i||s!==e?(this.setActiveTexture(r,i),this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._state.textureUnitMap[r]=e,s):(e.isDirty&&(this.setActiveTexture(r,i),e.applyChanges()),s)}unbindTexture(e){if(e!=null)for(let r=0;r<this.parameters.maxTextureImageUnits;r++)this._state.textureUnitMap[r]===e&&(this.bindTexture(null,r),this._state.textureUnitMap[r]=null)}bindFramebuffer(e,r=!1){if(r||this._state.readFramebuffer!==e||this._state.drawFramebuffer!==e){if(e==null)return this.gl.bindFramebuffer(yo.FRAMEBUFFER,null),this._state.readFramebuffer=null,void(this._state.drawFramebuffer=null);e.initializeAndBind(yo.FRAMEBUFFER),this._state.readFramebuffer=e,this._state.drawFramebuffer=e}}bindFramebufferSeparate(e,r,i=!1){const s=r===yo.READ_FRAMEBUFFER,n=s?this._state.readFramebuffer:this._state.drawFramebuffer;(i||n!==e)&&(e==null?this.gl.bindFramebuffer(r,null):e.initializeAndBind(r),s?this._state.readFramebuffer=e??null:this._state.drawFramebuffer=e??null)}blitFramebuffer(e,r,i=0,s=0,n=e.width,o=e.height,a=0,l=0,c=r.width,h=r.height,d=Si.COLOR_BUFFER_BIT,f=Rt.NEAREST){this.bindFramebufferSeparate(e,yo.READ_FRAMEBUFFER),this.bindFramebufferSeparate(r,yo.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(i,s,n,o,a,l,c,h,d,f)}bindBuffer(e,r){if(e)switch(r??(r=e.bufferType),r){case Tt.ARRAY_BUFFER:this._state.vertexBuffer=tc(this.gl,e,r,this._state.vertexBuffer);break;case Tt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=tc(this.gl,e,r,this._state.indexBuffer);break;case Tt.UNIFORM_BUFFER:this._state.uniformBuffer=tc(this.gl,e,r,this._state.uniformBuffer);break;case Tt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=tc(this.gl,e,r,this._state.pixelPackBuffer);break;case Tt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=tc(this.gl,e,r,this._state.pixelUnpackBuffer);break;case Tt.COPY_READ_BUFFER:this._state.copyReadBuffer=tc(this.gl,e,r,this._state.copyReadBuffer);break;case Tt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=tc(this.gl,e,r,this._state.copyWriteBuffer)}}bindRenderbuffer(e){const r=this.gl;e||(r.bindRenderbuffer(r.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==e&&(r.bindRenderbuffer(r.RENDERBUFFER,e.glName),this._state.renderbuffer=e)}_getBufferBinding(e,r){if(r>=this.parameters.maxUniformBufferBindings||r<0)return console.error("Uniform buffer binding point is out of range!"),null;const i=this._state.uniformBufferBindingPoints;let s=i[r];return s==null&&(s={buffer:null,offset:0,size:0},i[r]=s),s}bindBufferBase(e,r,i){const s=this._getBufferBinding(e,r);s!=null&&(s.buffer===i&&s.offset===0&&s.size===0||(this.gl.bindBufferBase(e,r,i?i.glName:null),s.buffer=i,s.offset=0,s.size=0))}bindBufferRange(e,r,i,s,n){const o=this._getBufferBinding(e,r);if(o!=null&&!(o.buffer===i&&o.offset===s&&o.size===n)){if(s%this._parameters.uniformBufferOffsetAlignment!=0)return void console.error("Uniform buffer binding offset is not a multiple of the context offset alignment");this.gl.bindBufferRange(e,r,i.glName,s,n),o.buffer=i,o.offset=s,o.size=n}}bindUBO(e,r,i,s){r!=null?(vh()&&(s??r.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),r.initialize(),i!==void 0&&s!==void 0?this.bindBufferRange(Tt.UNIFORM_BUFFER,e,r.buffer,i,s):this.bindBufferBase(Tt.UNIFORM_BUFFER,e,r.buffer)):this.bindBufferBase(Tt.UNIFORM_BUFFER,e,null)}unbindUBO(e){for(let r=0,i=this._state.uniformBufferBindingPoints.length;r<i;r++){const s=this._state.uniformBufferBindingPoints[r];s!=null&&s.buffer===e.buffer&&this.bindBufferBase(Tt.UNIFORM_BUFFER,r,null)}}unbindBuffer(e){switch(e){case Tt.ARRAY_BUFFER:this._state.vertexBuffer=tc(this.gl,null,e,this._state.vertexBuffer);break;case Tt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=tc(this.gl,null,e,this._state.indexBuffer);break;case Tt.UNIFORM_BUFFER:this._state.uniformBuffer=tc(this.gl,null,e,this._state.uniformBuffer);break;case Tt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=tc(this.gl,null,e,this._state.pixelPackBuffer);break;case Tt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=tc(this.gl,null,e,this._state.pixelUnpackBuffer);break;case Tt.COPY_READ_BUFFER:this._state.copyReadBuffer=tc(this.gl,null,e,this._state.copyReadBuffer);break;case Tt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=tc(this.gl,null,e,this._state.copyWriteBuffer)}}bindVAO(e=null){e!=null?this._state.vertexArrayObject!==e&&(e.bind(),this._state.vertexArrayObject=e):this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null)}async clientWaitAsync(e=10){const r=this.gl,i=r.fenceSync(Bj.SYNC_GPU_COMMANDS_COMPLETE,0);if(!i)throw new Error("Client wait failed, could not create sync object");let s;this.instanceCounter.increment(In.Sync,i),r.flush();do await uE(e),s=r.clientWaitSync(i,0,0);while(s===U5.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(In.Sync,i),r.deleteSync(i),s===U5.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(e=yo.FRAMEBUFFER){return e===yo.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(Tt.ARRAY_BUFFER),this.unbindBuffer(Tt.ELEMENT_ARRAY_BUFFER),this.type===lr.WEBGL2&&(this.unbindBuffer(Tt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Tt.PIXEL_PACK_BUFFER),this.unbindBuffer(Tt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Tt.COPY_READ_BUFFER),this.unbindBuffer(Tt.COPY_WRITE_BUFFER));for(let e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(Se.ONE,Se.ZERO),this.setBlendEquation(vm.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(fp.BACK),this.setFrontFace(NE.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(ri.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(ri.ALWAYS,0,0),this.setStencilOp(bs.KEEP,bs.KEEP,bs.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){const e=this.capabilities.vao;e&&e.bindVertexArray(null);const{gl:r,gl2:i}=this;for(let n=0;n<this.parameters.maxVertexAttributes;n++)r.disableVertexAttribArray(n);if(this._state.vertexBuffer?r.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):r.bindBuffer(Tt.ARRAY_BUFFER,null),this._state.indexBuffer?r.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):r.bindBuffer(Tt.ELEMENT_ARRAY_BUFFER,null),i!=null){this._state.uniformBuffer?i.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):i.bindBuffer(Tt.UNIFORM_BUFFER,null);for(let n=0;n<this._parameters.maxUniformBufferBindings;n++){const o=this._state.uniformBufferBindingPoints[n];if(o!=null){const{buffer:a,offset:l,size:c}=o;a!==null?l===0&&c===0?i.bindBufferBase(Tt.UNIFORM_BUFFER,n,a.glName):i.bindBufferRange(Tt.UNIFORM_BUFFER,n,a.glName,l,c):i.bindBufferBase(Tt.UNIFORM_BUFFER,n,null)}}this._state.pixelPackBuffer?i.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):i.bindBuffer(Tt.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?i.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):i.bindBuffer(Tt.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?i.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):i.bindBuffer(Tt.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?i.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):i.bindBuffer(Tt.COPY_WRITE_BUFFER,null),i.bindFramebuffer(yo.READ_FRAMEBUFFER,null),i.readBuffer(i.BACK),this._state.readFramebuffer&&(i.bindFramebuffer(yo.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),i.readBuffer(lu.COLOR_ATTACHMENT0)),i.bindFramebuffer(yo.DRAW_FRAMEBUFFER,this._state.drawFramebuffer?.glName??null)}else this._state.readFramebuffer=this._state.drawFramebuffer,r.bindFramebuffer(yo.FRAMEBUFFER,this._state.drawFramebuffer?.glName??null);if(e&&this._state.vertexArrayObject){const n=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(n)}r.useProgram(this._state.program?.glName??null),r.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),r.bindRenderbuffer(r.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null),this._state.blend===!0?r.enable(this.gl.BLEND):r.disable(this.gl.BLEND),r.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),r.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),r.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),r.clearDepth(this._state.clearDepth),r.clearStencil(this._state.clearStencil),r.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),r.cullFace(this._state.cullFace),r.depthFunc(this._state.depthFunction),r.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),r.depthMask(this._state.depthWrite),r.frontFace(this._state.frontFace),r.lineWidth(1),this._state.faceCulling===!0?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),r.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?r.enable(r.POLYGON_OFFSET_FILL):r.disable(r.POLYGON_OFFSET_FILL),r.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?r.enable(r.SCISSOR_TEST):r.disable(r.SCISSOR_TEST),r.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),r.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),r.stencilMask(this._state.stencilWriteMask);for(let n=0;n<this.parameters.maxTextureImageUnits;n++){r.activeTexture(dk+n),r.bindTexture(cs.TEXTURE_2D,null),r.bindTexture(cs.TEXTURE_CUBE_MAP,null),this.type===lr.WEBGL2&&(r.bindTexture(cs.TEXTURE_3D,null),r.bindTexture(cs.TEXTURE_2D_ARRAY,null));const o=this._state.textureUnitMap[n];o!=null&&r.bindTexture(o.descriptor.target,o.glName)}r.activeTexture(dk+this._state.activeTexture);const s=this._state.viewport;r.viewport(s.x,s.y,s.width,s.height),this.resetInfo()}_loadExtensions(){this.type===lr.WEBGL1&&this.gl.getExtension("OES_element_index_uint"),this.gl.getExtension("KHR_parallel_shader_compile")}};function tc(t,e,r,i){return e?i!==e&&t.bindBuffer(r,e.glName):t.bindBuffer(r,null),e}function vpe(t,e){switch(t){case At.POINTS:return 2*e;case At.TRIANGLES:return e/3;case At.TRIANGLE_STRIP:case At.TRIANGLE_FAN:return e-2;default:return 0}}let kwt=class extends Uwt{constructor(e,r,i){super(e,r),this.newCache=i,this._refCount=1,this._appleAmdDriverHelper=null}destroy(){--this._refCount>0||this.dispose()}ref(){++this._refCount}dispose(){super.dispose(),this._appleAmdDriverHelper?.dispose()}bindTechnique(e,r,i,s){return this.useProgram(e.program),e.bindPipelineState(this,i?.slot,!!s),e.program.bindPass(r,i),e.program}get appleAmdDriverHelper(){return this.driverTest.drawArraysRequiresIndicesTypeReset.result?(this._appleAmdDriverHelper=this._appleAmdDriverHelper??new rPe(this),this._appleAmdDriverHelper):null}get test(){return this.programCache.test}},L2=class extends Te{constructor(e,r,i){super({}),this._stage=e,this._techniqueRepository=r,this._rctx=i,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new Ts,this._frameTask=e.view.resourceController.scheduler.registerTask(vt.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this._stage.forEachOfType(us.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return this._textureTechnique==null&&(this._textureTechnique=this._techniqueRepository.acquire(VK,new BK)),this._textureTechnique}acquire(e){const r=this._textures.get(e);return r?(r.ref(),r.loadingPromise??r):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(r=>{const i=r.texture.frameUpdate(r.previousToken);i>=0&&i!==r.previousToken&&(r.previousToken=i,e=!0)}),e&&this.events.emit("changed",_s.BACKGROUND)}_createNewRef(e){const r=this._stage.getObject(e);if(r==null)return ot(r!==void 0),null;const i=r.events.on("unloaded",()=>{i.remove(),this._onTextureUnloaded(e)}),s=new zwt(e,()=>{this._frameTask.schedule(()=>{s.isUnreferenced&&r.unload()})});return this._textures.set(e,s),s.ref(),r.glTexture!=null?(this._updateGLTexture(s,r.glTexture),r.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:r,previousToken:-1}),s):(this._loadingCount++,s.loadingPromise=this._stage.schedule(()=>{const n=r.load(this._rctx),o=l=>(this._loadingCount--,s.loadingPromise=null,this._updateGLTexture(s,l),r.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:r,previousToken:-1}),s),a=l=>(this._loadingCount--,s.loadingPromise=null,ds(l)||K.getLogger(this).error(l),null);return ku(n)?n.then(o,a):o(n)}),s.loadingPromise)}_updateGLTexture(e,r){e.glTexture=r,this.events.emit("changed",_s.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};u([p()],L2.prototype,"_loadingCount",void 0),u([p()],L2.prototype,"_frameTask",void 0),u([p()],L2.prototype,"updating",null),L2=u([P("esri.views.3d.webgl-engine.lib.TextureRepository")],L2);let zwt=class{constructor(e,r){this.id=e,this._release=r,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(K.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}};function Vwt(t,e){return new QCe(r=>Gnt(r,t),r=>r,e)}let $O=class extends Te{constructor(){super(...arguments),this._passParameters=new Bwt,this._loading=0}get passParameters(){return this._passParameters}destroy(){this._passParameters.waveNormal=je(this._passParameters.waveNormal),this._passParameters.wavePertubation=je(this._passParameters.wavePertubation)}get updating(){return this._loading>0}ensureResources(e){if(this._loading>0)return Kg.LOADING;if(this._passParameters.waveNormal!=null&&this._passParameters.wavePertubation!=null)return Kg.LOADED;const r=new xr;return r.samplingMode=Rt.LINEAR_MIPMAP_LINEAR,r.hasMipmap=!0,r.maxAnisotropy=8,++this._loading,E0(jr("esri/images/materials/water/normals.jpg")).then(i=>this._passParameters.waveNormal=new Ot(e,{...r,width:i.width,height:i.height},i)).catch(i=>K.getLogger(this).error("Failed to load water material normal texture.",i)).finally(()=>--this._loading),++this._loading,E0(jr("esri/images/materials/water/perturbation.jpg")).then(i=>this._passParameters.wavePertubation=new Ot(e,{...r,width:i.width,height:i.height},i)).catch(i=>K.getLogger(this).error("Failed to load water material pertubation texture.",i)).finally(()=>--this._loading),Kg.LOADING}};u([p()],$O.prototype,"_loading",void 0),u([p({type:Boolean,readOnly:!0})],$O.prototype,"updating",null),$O=u([P("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],$O);let Bwt=class extends ii{};const bpe=2048,Gwt=1.5,jwt=8;function Hwt(t,e){const{format:r,quality:i,rotation:s,disableDecorations:n}=t||{},o=kee(t,e.padding),a=Qwt(t,{width:e.width-o.left-o.right,height:e.height-o.top-o.bottom}),{width:l,height:c}=Jwt(t,a),h=txt(r),d=oxt[h];return{format:h,quality:ve(i??d,0,100),area:a,width:l,height:c,rotation:s,disableDecorations:!!n,ignoreBackground:!(!t||!t.ignoreBackground),ignorePadding:!(!t||!t.ignorePadding)}}function qwt(t,e){const r=Hwt(t,e),i=r.area,s=r.width/i.width,n=kee(r,e.padding),o=n.left+n.right,a=n.top+n.bottom,l=e.width-o,c=e.height-a,h=Math.floor(l*s+o),d=Math.floor(c*s+a),f=t&&t.layers?t.layers:[],m=r.ignoreBackground,g=r.ignorePadding;return{framebufferWidth:h,framebufferHeight:d,region:{x:Math.floor(i.x*s)+n.left,y:Math.floor(i.y*s)+n.top,width:r.width,height:r.height},format:r.format,quality:r.quality,rotation:r.rotation,pixelRatio:s,layers:f,disableDecorations:r.disableDecorations,ignoreBackground:m,ignorePadding:g,objectAndLayerIdColor:!1}}function UV(t,e,r){const{ctx:i,canvas:s}=aPe(t,r),n=i.getImageData(0,0,t.width,t.height),o=Xwt(s,e);return lPe(s),{dataUrl:o,data:n}}function kV(t,e){const{ctx:r,canvas:i}=aPe(t,e),s=r.getImageData(0,0,t.width,t.height);return lPe(i),s}function aPe(t,e){const r=Wwt();e.premultipliedAlpha&&ixt(t),r.width=t.width,r.height=t.height;const i=r.getContext("2d",{willReadFrequently:!0});return i.putImageData(t,0,0),e.flipY&&rxt(i),{ctx:i,canvas:r}}function lPe(t){t.width=0,t.height=0}function Wwt(){return zV==null&&(zV=document.createElement("canvas")),zV}let zV=null;function Xwt(t,e){const r=sxt[e.format],i=e.quality/100;return t.toDataURL(r,i)}function Ywt(t,e,r,i=0,s=0,n=t.width-i,o=t.height-s,a=!1){const{data:l}=t,{width:c,height:h,data:d}=e,f=n/c,m=o/h,g=Math.ceil(f/2),_=Math.ceil(m/2),v=t.width;for(let b=0;b<h;b++)for(let T=0;T<c;T++){const x=4*(T+(a?h-b-1:b)*c);let S=0,E=0,A=0,R=0,M=0,D=0;const k=(b+.5)*m;for(let L=Math.floor(b*m);L<(b+1)*m;L++){const N=Math.abs(k-(L+.5))/_,q=(T+.5)*f,X=N*N;for(let G=Math.floor(T*f);G<(T+1)*f;G++){const J=Math.abs(q-(G+.5))/g,I=Math.sqrt(X+J*J);if(I>=1)continue;let z=2*I*I*I-3*I*I+1;const V=4*(i+G+(s+L)*v);D+=z*l[V+3],E+=z,!r&&l[V+3]<255&&(z=z*l[V+3]/255),A+=z*l[V],R+=z*l[V+1],M+=z*l[V+2],S+=z}}d[x]=A/S,d[x+1]=R/S,d[x+2]=M/S,d[x+3]=D/E}return e}function Zwt(t,e,r){if(!e)return t;const{framebufferWidth:i,framebufferHeight:s,pixelRatio:n,region:o}=t,a=kee(t,r),l=a.left+a.right,c=a.top+a.bottom,h=i-l,d=s-c,f=Math.min(jwt,Math.min((bpe-l)/h,(bpe-c)/d));return f<Gwt?t:{...t,framebufferWidth:Math.round(h*f)+l,framebufferHeight:Math.round(d*f)+c,pixelRatio:n*f,resample:{region:{x:Math.round((o.x-a.left)*f)+a.left,y:Math.round((o.y-a.top)*f)+a.top,width:Math.round(o.width*f),height:Math.round(o.height*f)},width:i,height:s}}}function Jwt(t,e){if(!t)return e;const r=t.width,i=t.height;if(r!=null&&i!=null)return{width:Math.floor(r),height:Math.floor(i)};if(r==null&&i==null)return e;const s=e.width/e.height;return i==null?{width:Math.floor(r),height:Math.floor(r/s)}:{width:Math.floor(i*s),height:Math.floor(i)}}function Qwt(t,e){const r={x:0,y:0,width:e.width,height:e.height};if(t&&t.area){t.area.x!=null&&(r.x=Math.floor(t.area.x)),t.area.y!=null&&(r.y=Math.floor(t.area.y));const i=t.area.width!=null?Math.floor(t.area.width):null,s=t.area.height!=null?Math.floor(t.area.height):null;if(r.width=e.width-r.x,r.height=e.height-r.y,i!=null&&s!=null)r.width=Math.min(r.width,i),r.height=Math.min(r.height,s);else if(i==null&&s!=null){const n=Math.min(r.width,i);r.height=n/r.width*r.height,r.width=n}else if(i!=null&&s==null){const n=Math.min(r.height,s);r.width=n/r.height*r.width,r.height=n}}return Kwt(ext(r,t),e)}function Kwt(t,e){const r=Math.floor(Math.max(t.x,0)),i=Math.floor(Math.max(t.y,0)),s={x:r,y:i,width:Math.floor(Math.min(t.width,e.width-r)),height:Math.floor(Math.min(t.height,e.height-i))},n=s.width/s.height,o=t.width/t.height;if(o===n)return s;if(o>n){const c=Math.floor(s.width/o),h=s.height-c;return{x:s.x,y:Math.floor(s.y+h/2),width:s.width,height:c}}const a=Math.floor(s.height*o),l=s.width-a;return{x:Math.floor(s.x+l/2),y:s.y,width:a,height:s.height}}function ext(t,e){if(!e||e.width==null||e.height==null)return t;const r=e.width/e.height,i=t.width/t.height;if(i===r)return t;if(i<r){const n=Math.floor(t.height*r);return t.x-=(n-t.width)/2,t.width=n,t}const s=Math.floor(t.width/r);return t.y-=(s-t.height)/2,t.height=s,t}function kee(t,e){return!e||t&&t.ignorePadding?axt:e}function txt(t){switch(t){case"png":case"jpg":case"jpeg":return t;default:return nxt}}function rxt(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}function ixt(t){const e=t.data,r=e.length;for(let i=0;i<r;i+=4){const s=e[i+3];if(s!==255&&s>0){const n=255/s;e[i]=e[i]*n,e[i+1]=e[i+1]*n,e[i+2]=e[i+2]*n}}}const sxt={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},wpe=98,nxt="png",oxt={png:100,jpg:wpe,jpeg:wpe},axt={top:0,right:0,bottom:0,left:0};let lxt=class{constructor(e,r){this.parameters=e,this.frameHasDecorations=r}},cxt=class{constructor(e,r,i,s){this._rctx=e,this._renderFunctions=r,this._forceCameraHook=i,this._disposeOffscreenBuffers=s,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}async takeScreenshot(e){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene(_s.BACKGROUND);const r=Eo();return this._screenshotQueue.push({settings:e,resolver:r}),r.promise}update(e,r){for(const i of this._screenshotQueue){if(this._rctx==null){i.resolver.reject();continue}const s={...i.settings,pixelRatio:i.settings.pixelRatio*e.parameters.camera.pixelRatio},n=this._renderScreenshot(e,s,r);i.resolver(n)}this._screenshotQueue.length=0}_renderScreenshotOverlay(e,r,i){e.width=r.width,e.height=r.height;const s=e.getContext("2d"),n=i.pixelRatio;return s.save(),s.translate(0,r.height),s.scale(1,-1),i.region&&s.translate(-i.region.x,-i.region.y),s.scale(n,n),r=this._renderFunctions.renderOverlay(e,r),s.restore(),r}_readbackScreenshot(e,r){return e.resample?this._readbackScreenshotResampled({...e,resample:e.resample},r):this._readbackScreenshotImmediate(e,r)}_readbackScreenshotResampled(e,r){const{framebufferWidth:i,framebufferHeight:s,region:n,resample:o}=e,a=this._ensureScreenshotEncodeCanvas();let l=Fz(i,s,a);this._rctx.gl.readPixels(0,0,i,s,Ct.RGBA,st.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),r(),l=this._renderScreenshotOverlay(a,l,{...e,region:void 0});const c=Fz(n.width,n.height,a);return Ywt(l,c,!0,o.region.x,s-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(e,r){const{framebufferHeight:i,region:s}=e,n=this._ensureScreenshotEncodeCanvas(),o=Fz(s.width,s.height,n);return this._rctx.gl.readPixels(s.x,i-(s.y+s.height),s.width,s.height,Ct.RGBA,st.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),r(),this._renderScreenshotOverlay(n,o,e)}_renderScreenshot(e,r,i){let s=null;const n=e.parameters.camera,o={width:r.framebufferWidth,height:r.framebufferHeight};sw(o,Math.min(this._rctx.parameters.maxTextureSize,this._rctx.parameters.maxRenderbufferSize));let a=!1;const l=r.disableDecorations&&e.frameHasDecorations,c=o.width!==n.fullWidth||o.height!==n.fullHeight,h=r.ignorePadding&&n.pixelRatio!==r.pixelRatio,d=c||l||h||r.objectAndLayerIdColor,f=r.objectAndLayerIdColor?new fn(this._rctx,new xr(o.width,o.height),new B5(Zs.DEPTH_STENCIL,o.width,o.height)):null;if(d){const v=n.clone();if(r.ignorePadding){const E=OP(v.padding);for(let A=0;A<4;A++)E[A]=Math.round(E[A]/v.pixelRatio*r.pixelRatio);v.padding=E}v.fullWidth=o.width,v.fullHeight=o.height,v.pixelRatio=r.pixelRatio;const b=n.fovX-v.fovX,T=n.fovY-v.fovY;b<0&&b<T?v.fovX=n.fovX:T<0&&T<b&&(v.fovY=n.fovY);const x={camera:v,contentCamera:v,mode:Ur.IDLE,alignPixelEnabled:!0,contentPixelRatio:v.pixelRatio};this._forceCameraHook(x),a=!0,s=new fn(this._rctx,new xr(o.width,o.height),new B5(Zs.DEPTH_STENCIL,o.width,o.height));const S=r.disableDecorations?Ww.OFF:Ww.ON;this._renderFunctions.renderScene(s,f,x,S,i),this._disposeOffscreenBuffers()}const m=()=>{this._rctx.bindFramebuffer(null),je(s)},g=this._readbackScreenshot(r,m);m();let _=null;if(r.objectAndLayerIdColor){const v=()=>{this._rctx.bindFramebuffer(null),je(f)};this._rctx.bindFramebuffer(f),_=this._readbackScreenshot(r,v),this._rctx.bindFramebuffer(null),v()}if(d&&!this._rctx.contextAttributes.alpha)for(let v=3;v<g.data.length;v+=4)g.data[v]=255;if(_&&!this._rctx.contextAttributes.alpha)for(let v=3;v<_.data.length;v+=4)_.data[v]=255;return a&&this._forceCameraHook(e.parameters),[g,_]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}},jn=class extends Te{constructor(e){super({}),this.events=new Ts,this.waterTextureRepository=new $O,this._magnifierHelper=new $2,this.objectAndLayerIdRenderHelper=ae("enable-feature:objectAndLayerId-rendering")?new u1t:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode,this._initializeContext(e),this.addHandles([le(()=>this.waterTextureRepository?.updating,()=>this.requestRender(),Pr),le(()=>e.view.qualityProfile,s=>this.renderer?.updateRenderFeature(s),Ls),this._magnifierHelper.events.on("request-render",()=>this.requestRender())]);const{memoryController:r}=e.view.resourceController;this.stippleTextureRepository=$nt(this._rctx,r),this.markerTextureRepository=Vwt(this._rctx,r),this._shaderTechniqueRepository=new qCe({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextureRepository:this.stippleTextureRepository,waterTextureRepository:this.waterTextureRepository,markerTextureRepository:this.markerTextureRepository}),this._textureRepository=new L2(e,this._shaderTechniqueRepository,this._rctx),this.addHandles(this._textureRepository.events.on("changed",s=>this.requestRender(s))),this._materialRepository=new WCe(this._textureRepository,this._shaderTechniqueRepository,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new Bvt(this._rctx,this._shaderTechniqueRepository),this.renderer=new oc(e,this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,s=>this.requestRender(s));const i={renderScene:(s,n,o,a,l)=>this.renderer.render(s,n,o,a,l),requestRenderScene:s=>this.requestRender(s),prepareOverlay:()=>e.options.screenshot.prepareOverlay(),renderOverlay:(s,n)=>e.options.screenshot.renderOverlay(s,n)};this._screenshotManager=new cxt(this._rctx,i,s=>this.events.emit("force-camera-for-screenshot",s),()=>this.renderer.disposeOffscreenBuffers()),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}destroy(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=Fi(this._frameTask),this._shaderTechniqueRepository=Ne(this._shaderTechniqueRepository)}requestRender(e=_s.UPDATE){this._needsRender=!0,e===_s.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(e){this._magnifierHelper.magnifier=e}setIdleSuspend(e){this._idleSuspend!==e&&(this._idleSuspend=e,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e).then(r=>r[0])}takeScreenshotWithOID(e){return e.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(e)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(e,r,i,s,n,o=n){const a=s.constrainWindowSize(r,i,n*s.pixelRatio,o*s.pixelRatio),l=this._ensureDepthBuffer(a);this.renderer.readDepthPixels(s,a,l);let c=Number.MAX_VALUE;for(let h=0;h<a[2]*a[3];h++){const d=Wvt(4*h,l,s.nearFar);c>d&&d!==s.nearFar[0]&&d!==s.nearFar[1]&&(c=d)}if(e!=null){const h=e.pickDepth(r*s.pixelRatio,i*s.pixelRatio,s);h!=null&&c>h&&h!==s.nearFar[0]&&h!==s.nearFar[1]&&(c=h)}return c===Number.MAX_VALUE?void 0:c}_ensureDepthBuffer(e){const r=4*e[2]*e[3];return(this._tmpDepthBuffer==null||this._tmpDepthBuffer.byteLength<r)&&(this._tmpDepthBuffer=new Uint8Array(r)),this._tmpDepthBuffer}async reloadShaders(){JOe(),await this._shaderTechniqueRepository.reloadAll(),this.requestRender()}_registerFrameTask(e){const r=e.view.state;let i=!1,s=_s.BACKGROUND,n=!1;const o={preRender:({time:a})=>{i=this.updating,s=this._needsUpdate?_s.UPDATE:_s.BACKGROUND,e.commitSyncLayers();const l=a-this._lastAnimationUpdate;if(l>this.renderer.animationTimestep||r.forcedAnimationTime!=null||i||this._needsRender){const c=l/this.renderer.animationTimeDilation,h=new USe(r.camera,c,r.forcedAnimationTime);this.renderer.updateAnimation(h)&&this.requestRender(_s.BACKGROUND),this._lastAnimationUpdate=a}},render:({time:a})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&r.camera.fullWidth>0&&r.camera.fullHeight>0){const l=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this.renderer.render(null,null,r,Ww.ON,a),n=!0,l&&this.renderer.hasReflections&&(this.requestRender(_s.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:a})=>{const l=new lxt(r,this.renderer.hasSlicePlane||this._magnifierHelper.enabled);this._textureRepository.update(),this._screenshotManager.update(l,a)},finish:()=>{n&&(this.renderer.finish(r.mode===Ur.IDLE?s:_s.UPDATE),n=!1)}};this._frameTask=dE(o)}_initializeContext(e){const r=e.options;this._canvas=r.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const i={alpha:r.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:r.stencil??!0,powerPreference:"high-performance",preserveDrawingBuffer:r.preserveDrawingBuffer??!1},s=Hqe("3d",this._canvas,i);s!=null?(this._rctx=this._newRenderingContext(s,e),this._loadShaderOnlyExtensions(),!r.alpha&&this._rctx.contextAttributes.alpha&&K.getLogger(this).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&ae("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)):K.getLogger(this).error("A WebGL2 context could not be created.")}_newRenderingContext(e,r){const i={disabledExtensions:r.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:r.options.debugWebGLExtensions||{},maxAnisotropy:8},s=(n,o)=>r.view.resourceController.memoryController.newCache(n,o);return new kwt(e,i,s)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("textureFloat")}getObjectAndLayerIdColor(e){return this.objectAndLayerIdRenderHelper!=null?this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(e):null}get componentObjectCollection(){return this._componentObjectCollection==null&&(this._componentObjectCollection=new Rvt(this.renderer.renderPassManager,this._viewingMode)),this._componentObjectCollection}set componentObjectCollection(e){this._componentObjectCollection=e}};u([p({type:Boolean,readOnly:!0})],jn.prototype,"updating",null),u([p({autoDestroy:!0})],jn.prototype,"_rctx",void 0),u([p({autoDestroy:!0})],jn.prototype,"_container",void 0),u([p({autoDestroy:!0})],jn.prototype,"_canvas",void 0),u([p({autoDestroy:!0})],jn.prototype,"stippleTextureRepository",void 0),u([p({autoDestroy:!0})],jn.prototype,"markerTextureRepository",void 0),u([p({autoDestroy:!0})],jn.prototype,"waterTextureRepository",void 0),u([p({autoDestroy:!0})],jn.prototype,"_magnifierHelper",void 0),u([p({readOnly:!0})],jn.prototype,"objectAndLayerIdRenderHelper",void 0),u([p({autoDestroy:!0})],jn.prototype,"_textureRepository",void 0),u([p({autoDestroy:!0})],jn.prototype,"_compositingHelper",void 0),u([p({autoDestroy:!0,readOnly:!0})],jn.prototype,"renderer",void 0),u([p({autoDestroy:!0})],jn.prototype,"_screenshotManager",void 0),u([p()],jn.prototype,"componentObjectCollection",null),u([p({autoDestroy:!0})],jn.prototype,"_componentObjectCollection",void 0),u([p()],jn.prototype,"_needsUpdate",void 0),u([p()],jn.prototype,"_needsWaterReflectionUpdate",void 0),jn=u([P("esri.views.3d.webgl-engine.parts.RenderView")],jn);let ru=class extends Te{constructor(e){super(e),this._model=new QN,this._layers=new Vt,this._asyncChangeSet=new Cq,this._syncChangeSet=new Cq,this._layerSyncSet=new Set}initialize(){this._set("renderView",new jn(this)),this._frameTask=this.view.resourceController.scheduler.registerTask(vt.STAGE,this),this.addHandles(this._frameTask)}destroy(){this.removeAllHandles()}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||this.renderView.updating||this._frameTask.updating}get renderer(){return this.renderView?.renderer}add(e){this._model.add(e),wF(e)&&this._addLayer(e),this.renderView.requestRender()}remove(e){e==null||this.destroyed||(this._model.remove(e),wF(e)&&this._removeLayer(e),this.renderView.requestRender())}addMany(e){e!=null&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){e!=null&&(this._model?.removeMany(e),this.renderView?.requestRender())}async load(e,r){e!=null&&(Array.isArray(e)||(e=[e]),await Promise.all(e.filter(i=>i.glTexture==null).map(i=>this.schedule(()=>this._model.has(i)?i.load(this.renderView.renderingContext):null),r)))}loadImmediate(e){return e.load(this.renderView.renderingContext)}forEachOfType(e,r){this._model.forEachOfType(e,r)}handleEvent(e,r){this.destroyed||(this._model.dirtySet[e](r),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(e){this._frameTask.processQueue(e),this._commit(e)}_commit(e){const r=this._model.dirtySet;this._asyncChangeSet.empty||e.done||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(i=>{if(e.done)return;const s=this._layerSyncSet.has(i.id)||i.updatePolicy===tv.SYNC,n=s?this._syncChangeSet:this._asyncChangeSet;r.commitLayer(i.id,n),this._layerSyncSet.delete(i.id),n.empty||(this.renderer.modify(n,s?rl:e),this.renderView.requestRender(),e.madeProgress())}),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,rl),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(i=>{e.done||this._layerSyncSet.has(i.id)||i.updatePolicy!==tv.ASYNC||(r.commitLayer(i.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()))}),this._layerSyncSet.clear(),this.notifyChange("running")}commitSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(r=>{(this._layerSyncSet.has(r.id)||r.updatePolicy===tv.SYNC)&&(e.commitLayer(r.id,this._syncChangeSet),this._layerSyncSet.delete(r.id))});for(const r of this._layerSyncSet)e.commitLayer(r,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,rl),this.renderView.requestRender())}_commitLayer(e){this._model.dirtySet.commitLayer(e.id,this._syncChangeSet),this._layerSyncSet.delete(e.id),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,rl),this.renderView.requestRender())}schedule(e,r){return this._frameTask.schedule(e,r)}reschedule(e,r){return this._frameTask.reschedule(e,r)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commitLayer(e),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,rl))}addRenderPlugin(e,r,i){const s=this.renderer.renderPlugins.add(e,r,i),n=()=>{sue(r)&&this.view.sceneIntersectionHelper.addIntersectionHandler(r)};if(ku(s))return s.then(n);n()}removeRenderPlugin(e){this.destroyed||(sue(e)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderer.renderPlugins.remove(e))}get performanceInfo(){return{renderer:this.renderer.performanceInfo,model:this._model.getStats()}}get test(){const e=this;return{getCount:r=>e._model.test.content.filter(i=>i.type===r).length,model:e._model}}};ru.DebugSettings={endFrameContentValidation:!1},u([p({constructOnly:!0})],ru.prototype,"view",void 0),u([p({constructOnly:!0})],ru.prototype,"options",void 0),u([p({readOnly:!0})],ru.prototype,"viewingMode",null),u([p({constructOnly:!0})],ru.prototype,"container",void 0),u([p({readOnly:!0})],ru.prototype,"updating",null),u([p({constructOnly:!0})],ru.prototype,"_model",void 0),u([p({autoDestroy:!0})],ru.prototype,"renderView",void 0),u([p({readOnly:!0})],ru.prototype,"renderer",null),u([p({readOnly:!0})],ru.prototype,"running",null),ru=u([P("esri.views.3d.webgl-engine.Stage")],ru);let pXt=class extends Q8{constructor(e,r,i,s){super(r,i),this.point=e,this.createGraphic=s}};function cPe(t){return Fp(t)&&t.intersector===ji.PCL&&!!t.target}let mXt=class extends a2e{constructor(e,r,i,s,n){super(e),this.layerUid=e,this.sublayerUid=r,this.nodeIndex=i,this.componentIndex=s,this.triangleNr=n}},yXt=class extends Q8{constructor(e,r,i){super(r,null),this.point=e,this.createVoxelGraphic=i}};function J9(t){return Fp(t)&&t.intersector===ji.I3S&&!!t.target}function uPe(t){return Fp(t)&&t.intersector===ji.VOXEL&&!!t.target}function xpe(t,e){return K8(t)||e9(t)?JM(t.target?.object,e):uot(t)?e.map?.ground:cPe(t)||J9(t)||f3e(t)||uPe(t)?JM(t.target,e):null}function vXt(t,e){const r=xW(t,e);return r!=null&&r.type==="graphic"?r.graphic:null}function xW(t,e){if(t==null)return null;if(K8(t)||e9(t))return Tpe(t.target?.object,e);if(cPe(t)){const r=t.target.createGraphic();return{type:"graphic",graphic:r,layer:r.layer}}if(uPe(t)){const r=t.target.createVoxelGraphic();return{type:"graphic",graphic:r,layer:r.layer}}return f3e(t)||aee(t)?Tpe(t.target,e):J9(t)?uxt(t.target,e):null}function Tpe(t,e){if(t==null||t.graphicUid==null)return null;const r=JM(t,e);if(r==null)return null;if(r===e.graphics)return e.graphicsView==null||typeof t.graphicUid!="number"?null:e.graphicsView.getHit(t.graphicUid);const i=e.allLayerViews.find(s=>s.layer===r);return!i||i.suspended||t.graphicUid==null?null:"getHit"in i?i.getHit(t.graphicUid):null}function uxt(t,e){const r=JM(t,e);if(r==null)return null;const i=e.allLayerViews.find(s=>s.layer===r);return i&&!i.suspended&&"getGraphicFromIntersectorTarget"in i?dxt(i.getGraphicFromIntersectorTarget(t)):null}function hxt(t,e){const r=JM(t,e);if(r==null)return null;const i=e.allLayerViews.find(s=>s.layer===r);return i&&!i.suspended&&"getAABBFromIntersectorTarget"in i?i.getAABBFromIntersectorTarget(t):null}function dxt(t){return t!=null?{type:"graphic",graphic:t,layer:t.layer}:null}function JM(t,e){return t&&t.layerUid!=null?e.graphicsView!=null&&t.layerUid===e.graphicsView.processor.layer.id?e.graphics:e.map.findLayerByUid(t.layerUid):null}function bXt(t,e){if(K8(t)||e9(t))return Qg(t.target.object.boundingVolumeWorldSpace.bounds);if(aee(t)){$1e(JL,t.transformation);const r=Math.max(JL[0],JL[1],JL[2]);return t.target.baseBoundingSphere.radius*r}return J9(t)?Cc(hxt(t.target,e),r=>.5*Vve(r)):null}function wXt(t){return!K8(t)&&!e9(t)&&(aee(t)?t.target.numLodLevels>1:!!J9(t))}const JL=O();async function pxt(t,e){if(t.type==="2d")return t.hitTest(e);const r=await t.hitTest(e);if(r.results.length===0)return r;const i=(r.results[0].distance??0)*(1+fxt),s=r.results.findIndex(n=>(n.distance??0)>i);return s!==-1&&(r.results=r.results.slice(0,s)),r}const fxt=.05;function mxt(t){return t&&typeof t.highlight=="function"}function gxt(t){return t&&typeof t.maskOccludee=="function"}function xXt(t,e,r){return t==null||t>r&&(e===0||t<e)}function TXt(t,e){return t!=null&&t>0||e!=null&&e>0}function SXt(t){const e=t.effectiveScaleRange;return{minScale:e?.minScale??0,maxScale:e?.maxScale??0}}let VV,BV;function yxt(t){const e=Nxe(t);for(;e.length>1;){const r=Spe(e.shift());if(r.available)return r}return Spe(e.shift())}function Spe(t){switch(t){case lr.WEBGL1:return _xt();case lr.WEBGL2:return vxt()}}function _xt(){return VV||(VV=xxt()),VV}function vxt(){return BV||(BV=Txt()),BV}let hPe=class{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsElementIndexUint=!1,this.supportsStandardDerivatives=!1,this.supportsInstancedArrays=!1,this.supportsTextureFloat=!1,this.supportsTextureHalfFloat=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}},bxt=class extends hPe{constructor(){super(...arguments),this.type=lr.WEBGL1}},wxt=class extends hPe{constructor(){super(...arguments),this.type=lr.WEBGL2,this.supportsElementIndexUint=!0,this.supportsStandardDerivatives=!0,this.supportsInstancedArrays=!0,this.supportsTextureFloat=!0,this.supportsTextureHalfFloat=!0}};function dPe(t,e){if(t===lr.WEBGL1&&typeof WebGLRenderingContext>"u"||t===lr.WEBGL2&&typeof WebGL2RenderingContext>"u")return null;const r=document.createElement("canvas");if(!r)return null;let i=jj(r,t,{failIfMajorPerformanceCaveat:!0});if(i==null&&(i=jj(r,t),i!=null&&(e.majorPerformanceCaveat=!0)),i==null)return i;if(t===lr.WEBGL1){const n=i.getParameter(i.VERSION),o=n?.match(/^WebGL\s+([\d.]*)/);if(o){const a=parseFloat(o[1]);e.available=a>=.94}}else e.available=!0;e.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),e.supportsVertexShaderSamplers=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const s=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);return s&&(e.supportsHighPrecisionFragment=s.precision>0),i}function xxt(){const t=new bxt,e=dPe(lr.WEBGL1,t);return e==null||(t.supportsElementIndexUint=e.getExtension("OES_element_index_uint")!==null,t.supportsStandardDerivatives=e.getExtension("OES_standard_derivatives")!==null,t.supportsInstancedArrays=e.getExtension("ANGLE_instanced_arrays")!==null,t.supportsTextureFloat=e.getExtension("OES_texture_float")!==null,t.supportsTextureHalfFloat=e.getExtension("OES_texture_half_float")!==null,t.supportsColorBufferFloat=e.getExtension("WEBGL_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=e.getExtension("EXT_color_buffer_half_float")!==null),t}function Txt(){const t=new wxt,e=dPe(lr.WEBGL2,t);return e==null||(t.supportsColorBufferFloat=e.getExtension("EXT_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=t.supportsColorBufferFloat||e.getExtension("EXT_color_buffer_half_float")!==null),t}function Sxt(t){const e=yxt(t);if(!e.available)return new U("webgl:required",t==="3d"?"WebGL2 is required but not supported.":"WebGL is required but not supported.",new Error().stack);if(t==="3d"&&e.majorPerformanceCaveat)return new U("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!e.supportsHighPrecisionFragment)return new U("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!e.supportsVertexShaderSamplers)return new U("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(e.type===lr.WEBGL1){if(!e.supportsElementIndexUint)return new U("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!e.supportsStandardDerivatives)return new U("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!e.supportsInstancedArrays)return new U("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null}function Ext(t){return t&&"nodeType"in t}function Cxt(t){return t&&typeof t.render=="function"}const Epe={component:"esri-component"};let yb=class extends Te{constructor(){super(...arguments),this.widget=null}destroy(){this.node=null,this.widget?.destroy()}get id(){return this.get("widget.id")||this.get("node.id")}set node(e){const r=this._get("node");e!==r&&(e&&e.classList.add(Epe.component),r&&r.classList.remove(Epe.component),this._set("node",e))}castNode(e){return this.widget?.destroy(),e?typeof e=="string"||Ext(e)?(this._set("widget",null),f8(e)):(Cxt(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};u([p({dependsOn:[]})],yb.prototype,"id",null),u([p()],yb.prototype,"node",null),u([wr("node")],yb.prototype,"castNode",null),u([p({readOnly:!0})],yb.prototype,"widget",void 0),yb=u([P("esri.views.ui.Component")],yb);const i4=yb,pPe="calcite-mode-";function Axt(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-mode-name").replaceAll(/\s|'|"/g,"")}function Oxt(){return Axt().startsWith("dark")}function Rxt(){return`${pPe}${Oxt()?"dark":"light"}`}function Mxt(t){Pxt(t),t.classList.add(Rxt())}function Pxt(t){Array.from(t.classList).forEach(e=>{e.startsWith(pPe)&&t.classList.remove(e)})}const Ixt={left:0,top:0,bottom:0,right:0},fPe={bottom:30,top:15,right:15,left:15},rg="esri-ui",rc={ui:rg,corner:`${rg}-corner`,innerContainer:`${rg}-inner-container`,manualContainer:`${rg}-manual-container`,cornerContainer:`${rg}-corner-container`,topLeft:`${rg}-top-left`,topRight:`${rg}-top-right`,bottomLeft:`${rg}-bottom-left`,bottomRight:`${rg}-bottom-right`};function $xt(t){return t&&!t._started&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}function QL(t){return t===0?"0":`${t}px`}function GV(t){const e=typeof t=="object"&&t!==null&&Object.getPrototypeOf(t);return(e===null||e===Object.prototype)&&("component"in t||"index"in t||"position"in t)?t:null}function jV(t,{top:e,bottom:r,left:i,right:s}){t.style.top=e,t.style.bottom=r,t.style.left=i,t.style.right=s}let Of=class extends Ts.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._locale=bp(),this.view=null,this._applyViewPadding=()=>{const r=this.container;r&&jV(r,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const r=this._innerContainer;r&&jV(r,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([le(()=>[this.view?.padding,this.container],this._applyViewPadding,Pr),le(()=>this.padding,this._applyUIPadding,Pr),le(()=>[this.container,this._locale],([e,r])=>{e&&e.setAttribute("lang",r)},Pr),uZ(e=>{this._locale=e})])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._componentMap.clear()}set container(e){const r=this._get("container");e!==r&&(e&&(e.classList.add(rc.ui),Mxt(e),this._attachContainers(e)),r&&(r.classList.remove(rc.ui),jV(r,{top:"",bottom:"",left:"",right:""}),x1e(r)),this._set("container",e))}get height(){const e=this.view?.height??0;if(e===0)return e;const r=this._getViewPadding(),{top:i,bottom:s}=r;return Math.max(e-i-s,0)}get padding(){return this._get("padding")}set padding(e){this._overrideIfSome("padding",e)}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:{...fPe,...e}}get width(){const e=this.view?.width??0;if(e===0)return e;const r=this._getViewPadding(),{left:i,right:s}=r;return Math.max(e-i-s,0)}add(e,r){let i,s,n;if(Array.isArray(e))return void e.forEach(a=>this.add(a,r));const o=GV(e);o&&({index:i,position:r,component:e,key:s}=o),r&&typeof r=="object"&&({index:i,key:s,position:r,internal:n}=r),!e||r&&!this._isValidPosition(r)||this._add(e,r,i,s,n)}remove(e,r){if(!e)return;if(Array.isArray(e))return e.map(s=>this.remove(s,r));const i=this._find(e);if(i){if(this._componentMap.has(e)&&this._componentMap.get(e)?.key!==r)return;const s=this._components.indexOf(i);return i.node.parentNode?.removeChild(i.node),this._componentMap.delete(e),this._components.splice(s,1)[0]}}empty(e,r={removeInternal:!1}){if(Array.isArray(e)){for(const n of e)this.empty(n,r);return}const i=this._positionNameToContainerLookup[e??"manual"],s=Array.prototype.slice.call(i.children).map(n=>this._findByNode(n)).filter(n=>n==null?!1:!(this._componentMap.get(n)?.internal??!1)||r.removeInternal);for(const n of s)this.remove(n)}move(e,r){if(Array.isArray(e)&&e.forEach(o=>this.move(o,r)),!e)return;let i;const s=GV(e)||GV(r);if(s&&(i=s.index,r=s.position,e=s.component||e),r&&!this._isValidPosition(r))return;const n=this.remove(e);n&&this.add(n,{position:r,index:i})}find(e){if(!e)return null;const r=this._findById(e);return r&&(r.widget||r.node)}getComponents(e,r={includeInternal:!1}){return e?Array.isArray(e)?e.map(i=>this._getComponentsAtPosition(i,r)).flat():this._getComponentsAtPosition(e,r):this._components.filter(i=>r.includeInternal||!this._componentMap.get(i)?.internal).map(({widget:i,node:s})=>i??s)}getPosition(e){for(const r in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[r].contains(e))return r;return null}_add(e,r,i,s,n){e instanceof i4||(e=new i4({node:e})),this._place({component:e,position:r,index:i}),this._components.push(e),this._componentMap.set(e,{key:s,internal:n})}_find(e){return e?e instanceof i4?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){return this.view?.padding??Ixt}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(rc.innerContainer,rc.cornerContainer);const r=document.createElement("div");r.classList.add(rc.innerContainer,rc.manualContainer);const i=document.createElement("div");i.classList.add(rc.topLeft,rc.corner),e.appendChild(i);const s=document.createElement("div");s.classList.add(rc.topRight,rc.corner),e.appendChild(s);const n=document.createElement("div");n.classList.add(rc.bottomLeft,rc.corner),e.appendChild(n);const o=document.createElement("div");o.classList.add(rc.bottomRight,rc.corner),e.appendChild(o),this._innerContainer=e,this._manualContainer=r;const a=WGe();this._cornerNameToContainerLookup={"top-left":i,"top-right":s,"bottom-left":n,"bottom-right":o,"top-leading":a?s:i,"top-trailing":a?i:s,"bottom-leading":a?o:n,"bottom-trailing":a?n:o},this._positionNameToContainerLookup={manual:r,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const r=e.position??"manual",{component:i,index:s}=e,n=this._positionNameToContainerLookup[r],o=s!=null&&s>-1;if($xt(i.widget)&&i.widget.startup(),!o)return void n.appendChild(i.node);const a=Array.from(n.children);if(s===0)return void(n.firstChild?$ie(i.node,n.firstChild):n.appendChild(i.node));s>=a.length?n.appendChild(i.node):$ie(i.node,a[s])}_toPixelPosition(e){return{top:QL(e.top),left:QL(e.left),right:QL(e.right),bottom:QL(e.bottom)}}_findByComponent(e){return this._components.find(r=>r===e)??null}_findById(e){return this._components.find(({id:r})=>r===e)??null}_findByNode(e){return this._components.find(({node:r})=>r===e)??null}_getComponentsAtPosition(e,r){const i=this._positionNameToContainerLookup[e];return Array.prototype.slice.call(i.children).map(s=>this._findByNode(s)).filter(Qf).filter(s=>r.includeInternal||!this._componentMap.get(s)?.internal).map(({widget:s,node:n})=>s??n)}};u([p()],Of.prototype,"_locale",void 0),u([p()],Of.prototype,"container",null),u([p()],Of.prototype,"height",null),u([p({value:fPe})],Of.prototype,"padding",null),u([wr("padding")],Of.prototype,"castPadding",null),u([p()],Of.prototype,"view",void 0),u([p()],Of.prototype,"width",null),Of=u([P("esri.views.ui.UI")],Of);const Lxt=Of,Dxt="randomUUID"in crypto;function Q9(){if(Dxt)return crypto.randomUUID();const t=crypto.getRandomValues(new Uint16Array(8));t[3]=4095&t[3]|16384,t[4]=16383&t[4]|32768;const e=r=>t[r].toString(16).padStart(4,"0");return e(0)+e(1)+"-"+e(2)+"-"+e(3)+"-"+e(4)+"-"+e(5)+e(6)+e(7)}function MXt(){return`{${Q9()}}`}const Nxt={handleInterceptedEvent:(t,e,r,i)=>(t.scheduleRender(),e.properties[`on${i.type}`].apply(e.properties.bind||r,[i]))},Fxt={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,r)=>{t.style[e]=r}},Uxt=t=>({...Fxt,...t}),kxt=(t,e)=>{const r=[];for(;t&&t!==e;)r.push(t),t=t.parentNode;return r},zxt=(t,e)=>t.find(e),Cpe=(t,e,r=!1)=>{let i=t;return e.forEach((s,n)=>{const o=i?.children?zxt(i.children,a=>a.domNode===s):void 0;r&&!o&&n!==e.length-1||(i=o)}),i},Vxt=t=>{let e;const r={...Nxt,...t},i=Uxt(r),s=i.performanceLogger;let n,o=!0,a=!1;const l=[],c=[],h=(f,m,g)=>{let _;i.eventHandlerInterceptor=(b,T,x,S)=>function(E){let A;s("domEvent",E);const R=kxt(E.currentTarget,_.domNode),M=R.some(k=>customElements.get(k?.tagName?.toLowerCase()));if(E.eventPhase===Event.CAPTURING_PHASE||!M)R.reverse(),A=Cpe(_.getLastRender(),R);else{const k=E.composedPath(),L=k.slice(k.indexOf(E.currentTarget),k.indexOf(_.domNode)).filter(N=>N.getRootNode()===N.ownerDocument).reverse();A=Cpe(_.getLastRender(),L,!0)}let D;return A&&(D=r.handleInterceptedEvent(e,A,this,E)),s("domEventProcessed",E),D},r.postProcessProjectionOptions?.(i);const v=g();_=f(m,v,i),l.push(_),c.push(g),r.afterFirstVNodeRendered&&r.afterFirstVNodeRendered(_,v)};let d=()=>{if(n=void 0,o){o=!1,s("renderStart",void 0);for(let f=0;f<l.length;f++){const m=c[f]();s("rendered",void 0),l[f].update(m),s("patched",void 0)}s("renderDone",void 0),o=!0}};return r.modifyDoRenderImplementation&&(d=r.modifyDoRenderImplementation(d,l,c)),e={renderNow:d,scheduleRender:()=>{n||a||(n=requestAnimationFrame(d))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),a=!0},resume:()=>{a=!1,o=!0,e.scheduleRender()},append:(f,m)=>{h(V_.append,f,m)},insertBefore:(f,m)=>{h(V_.insertBefore,f,m)},merge:(f,m)=>{h(V_.merge,f,m)},replace:(f,m)=>{h(V_.replace,f,m)},detach:f=>{for(let m=0;m<c.length;m++)if(c[m]===f)return c.splice(m,1),l.splice(m,1)[0];throw new Error("renderFunction was not found")}},e},D2={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,safari10:!1,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,cssVarShim:!1,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,dynamicImportShim:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0};let N2,mPe,K9,gPe=!1,ZF=!1,zee=!1,pu=!1,Ape=null,TW=!1;const Bxt=t=>{const e=new URL(t,Jo.$resourcesUrl$);return e.origin!==nI.location.origin?e.href:e.pathname},Gxt=t=>Jo.$resourcesUrl$=t,cx=(t,e="")=>()=>{},Ope="http://www.w3.org/1999/xlink",Rpe={},jxt="http://www.w3.org/2000/svg",Hxt="http://www.w3.org/1999/xhtml",qxt=t=>t!=null,Vee=t=>(t=typeof t,t==="object"||t==="function");function Wxt(t){var e,r,i;return(i=(r=(e=t.head)===null||e===void 0?void 0:e.querySelector('meta[name="csp-nonce"]'))===null||r===void 0?void 0:r.getAttribute("content"))!==null&&i!==void 0?i:void 0}const yPe=(t,e,...r)=>{let i=null,s=null,n=null,o=!1,a=!1;const l=[],c=d=>{for(let f=0;f<d.length;f++)i=d[f],Array.isArray(i)?c(i):i!=null&&typeof i!="boolean"&&((o=typeof t!="function"&&!Vee(i))&&(i=String(i)),o&&a?l[l.length-1].$text$+=i:l.push(o?JF(null,i):i),a=o)};if(c(r),e){e.key&&(s=e.key),e.name&&(n=e.name);{const d=e.className||e.class;d&&(e.class=typeof d!="object"?d:Object.keys(d).filter(f=>d[f]).join(" "))}}if(typeof t=="function")return t(e===null?{}:e,l,Zxt);const h=JF(t,null);return h.$attrs$=e,l.length>0&&(h.$children$=l),h.$key$=s,h.$name$=n,h},JF=(t,e)=>{const r={$flags$:0,$tag$:t,$text$:e,$elm$:null,$children$:null};return r.$attrs$=null,r.$key$=null,r.$name$=null,r},Xxt={},Yxt=t=>t&&t.$tag$===Xxt,Zxt={forEach:(t,e)=>t.map(Mpe).forEach(e),map:(t,e)=>t.map(Mpe).map(e).map(Jxt)},Mpe=t=>({vattrs:t.$attrs$,vchildren:t.$children$,vkey:t.$key$,vname:t.$name$,vtag:t.$tag$,vtext:t.$text$}),Jxt=t=>{if(typeof t.vtag=="function"){const r=Object.assign({},t.vattrs);return t.vkey&&(r.key=t.vkey),t.vname&&(r.name=t.vname),yPe(t.vtag,r,...t.vchildren||[])}const e=JF(t.vtag,t.vtext);return e.$attrs$=t.vattrs,e.$children$=t.vchildren,e.$key$=t.vkey,e.$name$=t.vname,e},Qxt=t=>ETt.map(e=>e(t)).find(e=>!!e),Kxt=(t,e)=>t!=null&&!Vee(t)?e&4?t==="false"?!1:t===""||!!t:e&2?parseFloat(t):e&1?String(t):t:t,eTt=t=>t,PXt=(t,e,r)=>{const i=eTt(t);return{emit:s=>tTt(i,e,{bubbles:!!(r&4),composed:!!(r&2),cancelable:!!(r&1),detail:s})}},tTt=(t,e,r)=>{const i=Jo.ce(e,r);return t.dispatchEvent(i),i},Ppe=new WeakMap,rTt=(t,e,r)=>{let i=KF.get(t);OTt&&r?(i=i||new CSSStyleSheet,typeof i=="string"?i=e:i.replaceSync(e)):i=e,KF.set(t,i)},iTt=(t,e,r,i)=>{var s;let n=_Pe(e,r);const o=KF.get(n);if(t=t.nodeType===11?t:Ep,o)if(typeof o=="string"){t=t.head||t;let a=Ppe.get(t),l;if(a||Ppe.set(t,a=new Set),!a.has(n)){{l=Ep.createElement("style"),l.innerHTML=o;const c=(s=Jo.$nonce$)!==null&&s!==void 0?s:Wxt(Ep);c!=null&&l.setAttribute("nonce",c),t.insertBefore(l,t.querySelector("link"))}a&&a.add(n)}}else t.adoptedStyleSheets.includes(o)||(t.adoptedStyleSheets=[...t.adoptedStyleSheets,o]);return n},sTt=t=>{const e=t.$cmpMeta$,r=t.$hostElement$,i=e.$flags$,s=cx("attachStyles",e.$tagName$),n=iTt(r.shadowRoot?r.shadowRoot:r.getRootNode(),e,t.$modeName$);i&10&&(r["s-sc"]=n,r.classList.add(n+"-h"),i&2&&r.classList.add(n+"-s")),s()},_Pe=(t,e)=>"sc-"+(e&&t.$flags$&32?t.$tagName$+"-"+e:t.$tagName$),Ipe=(t,e,r,i,s,n)=>{if(r!==i){let o=Npe(t,e),a=e.toLowerCase();if(e==="class"){const l=t.classList,c=$pe(r),h=$pe(i);l.remove(...c.filter(d=>d&&!h.includes(d))),l.add(...h.filter(d=>d&&!c.includes(d)))}else if(e==="style"){for(const l in r)(!i||i[l]==null)&&(l.includes("-")?t.style.removeProperty(l):t.style[l]="");for(const l in i)(!r||i[l]!==r[l])&&(l.includes("-")?t.style.setProperty(l,i[l]):t.style[l]=i[l])}else if(e!=="key")if(e==="ref")i&&i(t);else if(!t.__lookupSetter__(e)&&e[0]==="o"&&e[1]==="n")e[2]==="-"?e=e.slice(3):Npe(nI,a)?e=a.slice(2):e=a[2]+e.slice(3),r&&Jo.rel(t,e,r,!1),i&&Jo.ael(t,e,i,!1);else{const l=Vee(i);if((o||l&&i!==null)&&!s)try{if(t.tagName.includes("-"))t[e]=i;else{const h=i??"";e==="list"?o=!1:(r==null||t[e]!=h)&&(t[e]=h)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(e=a,c=!0),i==null||i===!1?(i!==!1||t.getAttribute(e)==="")&&(c?t.removeAttributeNS(Ope,e):t.removeAttribute(e)):(!o||n&4||s)&&!l&&(i=i===!0?"":i,c?t.setAttributeNS(Ope,e,i):t.setAttribute(e,i))}}},nTt=/\s/,$pe=t=>t?t.split(nTt):[],vPe=(t,e,r,i)=>{const s=e.$elm$.nodeType===11&&e.$elm$.host?e.$elm$.host:e.$elm$,n=t&&t.$attrs$||Rpe,o=e.$attrs$||Rpe;for(i in n)i in o||Ipe(s,i,n[i],void 0,r,e.$flags$);for(i in o)Ipe(s,i,n[i],o[i],r,e.$flags$)},QF=(t,e,r,i)=>{const s=e.$children$[r];let n=0,o,a,l;if(gPe||(zee=!0,s.$tag$==="slot"&&(N2&&i.classList.add(N2+"-s"),s.$flags$|=s.$children$?2:1)),s.$text$!==null)o=s.$elm$=Ep.createTextNode(s.$text$);else if(s.$flags$&1)o=s.$elm$=Ep.createTextNode("");else{if(pu||(pu=s.$tag$==="svg"),o=s.$elm$=Ep.createElementNS(pu?jxt:Hxt,s.$flags$&2?"slot-fb":s.$tag$),pu&&s.$tag$==="foreignObject"&&(pu=!1),vPe(null,s,pu),qxt(N2)&&o["s-si"]!==N2&&o.classList.add(o["s-si"]=N2),s.$children$)for(n=0;n<s.$children$.length;++n)a=QF(t,s,n,o),a&&o.appendChild(a);s.$tag$==="svg"?pu=!1:o.tagName==="foreignObject"&&(pu=!0)}return o["s-hn"]=K9,s.$flags$&3&&(o["s-sr"]=!0,o["s-cr"]=mPe,o["s-sn"]=s.$name$||"",l=t&&t.$children$&&t.$children$[r],l&&l.$tag$===s.$tag$&&t.$elm$&&QM(t.$elm$,!1)),o},QM=(t,e)=>{Jo.$flags$|=1;const r=t.childNodes;for(let i=r.length-1;i>=0;i--){const s=r[i];s["s-hn"]!==K9&&s["s-ol"]&&(xPe(s).insertBefore(s,Bee(s)),s["s-ol"].remove(),s["s-ol"]=void 0,zee=!0),e&&QM(s,e)}Jo.$flags$&=-2},bPe=(t,e,r,i,s,n)=>{let o=t["s-cr"]&&t["s-cr"].parentNode||t,a;for(o.shadowRoot&&o.tagName===K9&&(o=o.shadowRoot);s<=n;++s)i[s]&&(a=QF(null,r,s,t),a&&(i[s].$elm$=a,o.insertBefore(a,Bee(e))))},wPe=(t,e,r,i,s)=>{for(;e<=r;++e)(i=t[e])&&(s=i.$elm$,EPe(i),ZF=!0,s["s-ol"]?s["s-ol"].remove():QM(s,!0),s.remove())},oTt=(t,e,r,i)=>{let s=0,n=0,o=0,a=0,l=e.length-1,c=e[0],h=e[l],d=i.length-1,f=i[0],m=i[d],g,_;for(;s<=l&&n<=d;)if(c==null)c=e[++s];else if(h==null)h=e[--l];else if(f==null)f=i[++n];else if(m==null)m=i[--d];else if(KL(c,f))F2(c,f),c=e[++s],f=i[++n];else if(KL(h,m))F2(h,m),h=e[--l],m=i[--d];else if(KL(c,m))(c.$tag$==="slot"||m.$tag$==="slot")&&QM(c.$elm$.parentNode,!1),F2(c,m),t.insertBefore(c.$elm$,h.$elm$.nextSibling),c=e[++s],m=i[--d];else if(KL(h,f))(c.$tag$==="slot"||m.$tag$==="slot")&&QM(h.$elm$.parentNode,!1),F2(h,f),t.insertBefore(h.$elm$,c.$elm$),h=e[--l],f=i[++n];else{for(o=-1,a=s;a<=l;++a)if(e[a]&&e[a].$key$!==null&&e[a].$key$===f.$key$){o=a;break}o>=0?(_=e[o],_.$tag$!==f.$tag$?g=QF(e&&e[n],r,o,t):(F2(_,f),e[o]=void 0,g=_.$elm$),f=i[++n]):(g=QF(e&&e[n],r,n,t),f=i[++n]),g&&xPe(c.$elm$).insertBefore(g,Bee(c.$elm$))}s>l?bPe(t,i[d+1]==null?null:i[d+1].$elm$,r,i,n,d):n>d&&wPe(e,s,l)},KL=(t,e)=>t.$tag$===e.$tag$?t.$tag$==="slot"?t.$name$===e.$name$:t.$key$===e.$key$:!1,Bee=t=>t&&t["s-ol"]||t,xPe=t=>(t["s-ol"]?t["s-ol"]:t).parentNode,F2=(t,e)=>{const r=e.$elm$=t.$elm$,i=t.$children$,s=e.$children$,n=e.$tag$,o=e.$text$;let a;o===null?(pu=n==="svg"?!0:n==="foreignObject"?!1:pu,n==="slot"||vPe(t,e,pu),i!==null&&s!==null?oTt(r,i,e,s):s!==null?(t.$text$!==null&&(r.textContent=""),bPe(r,null,e,s,0,s.length-1)):i!==null&&wPe(i,0,i.length-1),pu&&n==="svg"&&(pu=!1)):(a=r["s-cr"])?a.parentNode.textContent=o:t.$text$!==o&&(r.data=o)},TPe=t=>{const e=t.childNodes;let r,i,s,n,o,a;for(i=0,s=e.length;i<s;i++)if(r=e[i],r.nodeType===1){if(r["s-sr"]){for(o=r["s-sn"],r.hidden=!1,n=0;n<s;n++)if(a=e[n].nodeType,e[n]["s-hn"]!==r["s-hn"]||o!==""){if(a===1&&o===e[n].getAttribute("slot")){r.hidden=!0;break}}else if(a===1||a===3&&e[n].textContent.trim()!==""){r.hidden=!0;break}}TPe(r)}},op=[],SPe=t=>{let e,r,i,s,n,o,a=0;const l=t.childNodes,c=l.length;for(;a<c;a++){if(e=l[a],e["s-sr"]&&(r=e["s-cr"])&&r.parentNode)for(i=r.parentNode.childNodes,s=e["s-sn"],o=i.length-1;o>=0;o--)r=i[o],!r["s-cn"]&&!r["s-nr"]&&r["s-hn"]!==e["s-hn"]&&(Lpe(r,s)?(n=op.find(h=>h.$nodeToRelocate$===r),ZF=!0,r["s-sn"]=r["s-sn"]||s,n?n.$slotRefNode$=e:op.push({$slotRefNode$:e,$nodeToRelocate$:r}),r["s-sr"]&&op.map(h=>{Lpe(h.$nodeToRelocate$,r["s-sn"])&&(n=op.find(d=>d.$nodeToRelocate$===r),n&&!h.$slotRefNode$&&(h.$slotRefNode$=n.$slotRefNode$))})):op.some(h=>h.$nodeToRelocate$===r)||op.push({$nodeToRelocate$:r}));e.nodeType===1&&SPe(e)}},Lpe=(t,e)=>t.nodeType===1?t.getAttribute("slot")===null&&e===""||t.getAttribute("slot")===e:t["s-sn"]===e?!0:e==="",EPe=t=>{t.$attrs$&&t.$attrs$.ref&&t.$attrs$.ref(null),t.$children$&&t.$children$.map(EPe)},aTt=(t,e)=>{const r=t.$hostElement$,i=t.$cmpMeta$,s=t.$vnode$||JF(null,null),n=Yxt(e)?e:yPe(null,null,e);K9=r.tagName,i.$attrsToReflect$&&(n.$attrs$=n.$attrs$||{},i.$attrsToReflect$.map(([o,a])=>n.$attrs$[a]=r[o])),n.$tag$=null,n.$flags$|=4,t.$vnode$=n,n.$elm$=s.$elm$=r.shadowRoot||r,N2=r["s-sc"],mPe=r["s-cr"],gPe=(i.$flags$&1)!==0,ZF=!1,F2(s,n);{if(Jo.$flags$|=1,zee){SPe(n.$elm$);let o,a,l,c,h,d,f=0;for(;f<op.length;f++)o=op[f],a=o.$nodeToRelocate$,a["s-ol"]||(l=Ep.createTextNode(""),l["s-nr"]=a,a.parentNode.insertBefore(a["s-ol"]=l,a));for(f=0;f<op.length;f++)if(o=op[f],a=o.$nodeToRelocate$,o.$slotRefNode$){for(c=o.$slotRefNode$.parentNode,h=o.$slotRefNode$.nextSibling,l=a["s-ol"];l=l.previousSibling;)if(d=l["s-nr"],d&&d["s-sn"]===a["s-sn"]&&c===d.parentNode&&(d=d.nextSibling,!d||!d["s-nr"])){h=d;break}(!h&&c!==a.parentNode||a.nextSibling!==h)&&a!==h&&(!a["s-hn"]&&a["s-ol"]&&(a["s-hn"]=a["s-ol"].parentNode.nodeName),c.insertBefore(a,h))}else a.nodeType===1&&(a.hidden=!0)}ZF&&TPe(n.$elm$),Jo.$flags$&=-2,op.length=0}},lTt=(t,e)=>{},Gee=(t,e)=>(t.$flags$|=16,lTt(t,t.$ancestorComponent$),PTt(()=>cTt(t,e))),cTt=(t,e)=>{const r=t.$hostElement$,i=cx("scheduleUpdate",t.$cmpMeta$.$tagName$),s=r;let n;return e?n=QS(s,"componentWillLoad"):n=QS(s,"componentWillUpdate"),n=Dpe(n,()=>QS(s,"componentWillRender")),i(),Dpe(n,()=>uTt(t,s,e))},uTt=async(t,e,r)=>{const i=t.$hostElement$,s=cx("update",t.$cmpMeta$.$tagName$);i["s-rc"],r&&sTt(t);const n=cx("render",t.$cmpMeta$.$tagName$);hTt(t,e,i),n(),s(),dTt(t)},hTt=(t,e,r)=>{try{Ape=e,e=e.render&&e.render(),t.$flags$&=-17,t.$flags$|=2,(D2.hasRenderFn||D2.reflect)&&(D2.vdomRender||D2.reflect)&&(D2.hydrateServerSide||aTt(t,e))}catch(a){sI(a,t.$hostElement$)}return Ape=null,null},dTt=t=>{const e=t.$cmpMeta$.$tagName$,r=t.$hostElement$,i=cx("postUpdate",e),s=r;t.$ancestorComponent$,QS(s,"componentDidRender"),t.$flags$&64?(QS(s,"componentDidUpdate"),i()):(t.$flags$|=64,QS(s,"componentDidLoad"),i())},IXt=t=>{{const e=iI(t),r=e.$hostElement$.isConnected;return r&&(e.$flags$&18)===2&&Gee(e,!1),r}},QS=(t,e,r)=>{if(t&&t[e])try{return t[e](r)}catch(i){sI(i)}},Dpe=(t,e)=>t&&t.then?t.then(e):e(),pTt=(t,e)=>iI(t).$instanceValues$.get(e),fTt=(t,e,r,i)=>{const s=iI(t),n=t,o=s.$instanceValues$.get(e),a=s.$flags$,l=n;r=Kxt(r,i.$members$[e][0]);const c=Number.isNaN(o)&&Number.isNaN(r);if(r!==o&&!c){s.$instanceValues$.set(e,r);{if(i.$watchers$&&a&128){const d=i.$watchers$[e];d&&d.map(f=>{try{l[f](r,o,e)}catch(m){sI(m,n)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(r,o,e)===!1)return;Gee(s,!1)}}}},mTt=(t,e,r)=>{if(e.$members$){t.watchers&&(e.$watchers$=t.watchers);const i=Object.entries(e.$members$),s=t.prototype;i.map(([n,[o]])=>{(o&31||o&32)&&Object.defineProperty(s,n,{get(){return pTt(this,n)},set(a){fTt(this,n,a,e)},configurable:!0,enumerable:!0})});{const n=new Map;s.attributeChangedCallback=function(o,a,l){Jo.jmp(()=>{const c=n.get(o);if(this.hasOwnProperty(c))l=this[c],delete this[c];else if(s.hasOwnProperty(c)&&typeof this[c]=="number"&&this[c]==l)return;this[c]=l===null&&typeof this[c]=="boolean"?!1:l})},t.observedAttributes=i.filter(([o,a])=>a[0]&15).map(([o,a])=>{const l=a[1]||o;return n.set(l,o),a[0]&512&&e.$attrsToReflect$.push([o,l]),l})}}return t},gTt=async(t,e,r,i,s)=>{if(!(e.$flags$&32)&&(s=t.constructor,e.$flags$|=32,customElements.whenDefined(r.$tagName$).then(()=>e.$flags$|=128),s.style)){let o=s.style;typeof o!="string"&&(o=o[e.$modeName$=Qxt(t)]);const a=_Pe(r,e.$modeName$);if(!KF.has(a)){const l=cx("registerStyles",r.$tagName$);rTt(a,o,!!(r.$flags$&1)),l()}}e.$ancestorComponent$,(()=>Gee(e,!0))()},yTt=t=>{},_Tt=t=>{if(!(Jo.$flags$&1)){const e=iI(t),r=e.$cmpMeta$,i=cx("connectedCallback",r.$tagName$);e.$flags$&1?(CPe(t,e,r.$listeners$),yTt(e.$lazyInstance$)):(e.$flags$|=1,r.$flags$&12&&vTt(t),r.$members$&&Object.entries(r.$members$).map(([s,[n]])=>{if(n&31&&t.hasOwnProperty(s)){const o=t[s];delete t[s],t[s]=o}}),gTt(t,e,r)),i()}},vTt=t=>{const e=t["s-cr"]=Ep.createComment("");e["s-cn"]=!0,t.insertBefore(e,t.firstChild)},bTt=t=>{if(!(Jo.$flags$&1)){const e=iI(t);e.$rmListeners$&&(e.$rmListeners$.map(r=>r()),e.$rmListeners$=void 0)}},$Xt=(t,e)=>{const r={$flags$:e[0],$tagName$:e[1]};r.$members$=e[2],r.$listeners$=e[3],r.$watchers$=t.$watchers$,r.$attrsToReflect$=[];const i=t.prototype.connectedCallback,s=t.prototype.disconnectedCallback;return Object.assign(t.prototype,{__registerHost(){STt(this,r)},connectedCallback(){_Tt(this),i&&i.call(this)},disconnectedCallback(){bTt(this),s&&s.call(this)},__attachShadow(){this.attachShadow({mode:"open",delegatesFocus:!!(r.$flags$&16)})}}),t.is=r.$tagName$,mTt(t,r)},LXt=(t,e)=>e,CPe=(t,e,r,i)=>{r&&r.map(([s,n,o])=>{const a=xTt(t,s),l=wTt(e,o),c=TTt(s);Jo.ael(a,n,l,c),(e.$rmListeners$=e.$rmListeners$||[]).push(()=>Jo.rel(a,n,l,c))})},wTt=(t,e)=>r=>{try{D2.lazyLoad||t.$hostElement$[e](r)}catch(i){sI(i)}},xTt=(t,e)=>e&4?Ep:e&8?nI:e&16?Ep.body:t,TTt=t=>CTt?{passive:(t&1)!==0,capture:(t&2)!==0}:(t&2)!==0,APe=new WeakMap,iI=t=>APe.get(t),STt=(t,e)=>{const r={$flags$:0,$hostElement$:t,$cmpMeta$:e,$instanceValues$:new Map};return CPe(t,r,e.$listeners$),APe.set(t,r)},Npe=(t,e)=>e in t,sI=(t,e)=>(0,console.error)(t,e),KF=new Map,ETt=[],nI=typeof window<"u"?window:{},Ep=nI.document||{head:{}},DXt=nI.HTMLElement||class{},Jo={$flags$:0,$resourcesUrl$:"",jmp:t=>t(),raf:t=>requestAnimationFrame(t),ael:(t,e,r,i)=>t.addEventListener(e,r,i),rel:(t,e,r,i)=>t.removeEventListener(e,r,i),ce:(t,e)=>new CustomEvent(t,e)},CTt=(()=>{let t=!1;try{Ep.addEventListener("e",null,Object.defineProperty({},"passive",{get(){t=!0}}))}catch{}return t})(),ATt=t=>Promise.resolve(t),OTt=(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replaceSync=="function"}catch{}return!1})(),Fpe=[],OPe=[],RTt=(t,e)=>r=>{t.push(r),TW||(TW=!0,e&&Jo.$flags$&4?MTt(SW):Jo.raf(SW))},Upe=t=>{for(let e=0;e<t.length;e++)try{t[e](performance.now())}catch(r){sI(r)}t.length=0},SW=()=>{Upe(Fpe),Upe(OPe),(TW=Fpe.length>0)&&Jo.raf(SW)},MTt=t=>ATt().then(t),PTt=RTt(OPe,!0);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.4.3
 */const RPe="calcite-mode-auto",MPe="calcite-mode-dark",ITt="calcite-mode-light",NXt={autoMode:RPe,darkMode:MPe,lightMode:ITt,rtl:"calcite--rtl",calciteAnimate:"calcite-animate",calciteAnimateIn:"calcite-animate__in",calciteAnimateInUp:"calcite-animate__in-up",calciteAnimateInDown:"calcite-animate__in-down",calciteAnimateInRight:"calcite-animate__in-right",calciteAnimateInLeft:"calcite-animate__in-left",calciteAnimateInScale:"calcite-animate__in-scale"};/*!
* tabbable 6.1.2
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var PPe=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],e6=PPe.join(","),IPe=typeof Element>"u",ux=IPe?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,t6=!IPe&&Element.prototype.getRootNode?function(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}:function(t){return t?.ownerDocument},r6=function t(e,r){var i;r===void 0&&(r=!0);var s=e==null||(i=e.getAttribute)===null||i===void 0?void 0:i.call(e,"inert"),n=s===""||s==="true",o=n||r&&e&&t(e.parentNode);return o},$Tt=function(e){var r,i=e==null||(r=e.getAttribute)===null||r===void 0?void 0:r.call(e,"contenteditable");return i===""||i==="true"},$Pe=function(e,r,i){if(r6(e))return[];var s=Array.prototype.slice.apply(e.querySelectorAll(e6));return r&&ux.call(e,e6)&&s.unshift(e),s=s.filter(i),s},LPe=function t(e,r,i){for(var s=[],n=Array.from(e);n.length;){var o=n.shift();if(!r6(o,!1))if(o.tagName==="SLOT"){var a=o.assignedElements(),l=a.length?a:o.children,c=t(l,!0,i);i.flatten?s.push.apply(s,c):s.push({scopeParent:o,candidates:c})}else{var h=ux.call(o,e6);h&&i.filter(o)&&(r||!e.includes(o))&&s.push(o);var d=o.shadowRoot||typeof i.getShadowRoot=="function"&&i.getShadowRoot(o),f=!r6(d,!1)&&(!i.shadowRootFilter||i.shadowRootFilter(o));if(d&&f){var m=t(d===!0?o.children:d.children,!0,i);i.flatten?s.push.apply(s,m):s.push({scopeParent:o,candidates:m})}else n.unshift.apply(n,o.children)}}return s},DPe=function(e,r){return e.tabIndex<0&&(r||/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||$Tt(e))&&isNaN(parseInt(e.getAttribute("tabindex"),10))?0:e.tabIndex},LTt=function(e,r){return e.tabIndex===r.tabIndex?e.documentOrder-r.documentOrder:e.tabIndex-r.tabIndex},NPe=function(e){return e.tagName==="INPUT"},DTt=function(e){return NPe(e)&&e.type==="hidden"},NTt=function(e){var r=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(i){return i.tagName==="SUMMARY"});return r},FTt=function(e,r){for(var i=0;i<e.length;i++)if(e[i].checked&&e[i].form===r)return e[i]},UTt=function(e){if(!e.name)return!0;var r=e.form||t6(e),i=function(a){return r.querySelectorAll('input[type="radio"][name="'+a+'"]')},s;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")s=i(window.CSS.escape(e.name));else try{s=i(e.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var n=FTt(s,e.form);return!n||n===e},kTt=function(e){return NPe(e)&&e.type==="radio"},zTt=function(e){return kTt(e)&&!UTt(e)},VTt=function(e){var r,i=e&&t6(e),s=(r=i)===null||r===void 0?void 0:r.host,n=!1;if(i&&i!==e){var o,a,l;for(n=!!((o=s)!==null&&o!==void 0&&(a=o.ownerDocument)!==null&&a!==void 0&&a.contains(s)||e!=null&&(l=e.ownerDocument)!==null&&l!==void 0&&l.contains(e));!n&&s;){var c,h,d;i=t6(s),s=(c=i)===null||c===void 0?void 0:c.host,n=!!((h=s)!==null&&h!==void 0&&(d=h.ownerDocument)!==null&&d!==void 0&&d.contains(s))}}return n},kpe=function(e){var r=e.getBoundingClientRect(),i=r.width,s=r.height;return i===0&&s===0},BTt=function(e,r){var i=r.displayCheck,s=r.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var n=ux.call(e,"details>summary:first-of-type"),o=n?e.parentElement:e;if(ux.call(o,"details:not([open]) *"))return!0;if(!i||i==="full"||i==="legacy-full"){if(typeof s=="function"){for(var a=e;e;){var l=e.parentElement,c=t6(e);if(l&&!l.shadowRoot&&s(l)===!0)return kpe(e);e.assignedSlot?e=e.assignedSlot:!l&&c!==e.ownerDocument?e=c.host:e=l}e=a}if(VTt(e))return!e.getClientRects().length;if(i!=="legacy-full")return!0}else if(i==="non-zero-area")return kpe(e);return!1},GTt=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var r=e.parentElement;r;){if(r.tagName==="FIELDSET"&&r.disabled){for(var i=0;i<r.children.length;i++){var s=r.children.item(i);if(s.tagName==="LEGEND")return ux.call(r,"fieldset[disabled] *")?!0:!s.contains(e)}return!0}r=r.parentElement}return!1},i6=function(e,r){return!(r.disabled||r6(r)||DTt(r)||BTt(r,e)||NTt(r)||GTt(r))},EW=function(e,r){return!(zTt(r)||DPe(r)<0||!i6(e,r))},jTt=function(e){var r=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(r)||r>=0)},HTt=function t(e){var r=[],i=[];return e.forEach(function(s,n){var o=!!s.scopeParent,a=o?s.scopeParent:s,l=DPe(a,o),c=o?t(s.candidates):a;l===0?o?r.push.apply(r,c):r.push(a):i.push({documentOrder:n,tabIndex:l,item:s,isScope:o,content:c})}),i.sort(LTt).reduce(function(s,n){return n.isScope?s.push.apply(s,n.content):s.push(n.content),s},[]).concat(r)},qTt=function(e,r){r=r||{};var i;return r.getShadowRoot?i=LPe([e],r.includeContainer,{filter:EW.bind(null,r),flatten:!1,getShadowRoot:r.getShadowRoot,shadowRootFilter:jTt}):i=$Pe(e,r.includeContainer,EW.bind(null,r)),HTt(i)},FXt=function(e,r){r=r||{};var i;return r.getShadowRoot?i=LPe([e],r.includeContainer,{filter:i6.bind(null,r),flatten:!0,getShadowRoot:r.getShadowRoot}):i=$Pe(e,r.includeContainer,i6.bind(null,r)),i},UXt=function(e,r){if(r=r||{},!e)throw new Error("No node provided");return ux.call(e,e6)===!1?!1:EW(r,e)},WTt=PPe.concat("iframe").join(","),kXt=function(e,r){if(r=r||{},!e)throw new Error("No node provided");return ux.call(e,WTt)===!1?!1:i6(r,e)};const XTt={getShadowRoot:!0};function zXt(t){const e="dir",r=`[${e}]`,i=YTt(t,r);return i?i.getAttribute(e):"ltr"}function jee(t){return t.getRootNode()}function VXt(t){const e=jee(t);return"host"in e?e:null}function FPe(t){return t.host||null}function BXt(t,{selector:e,id:r}){function i(s){if(!s)return null;s.assignedSlot&&(s=s.assignedSlot);const n=jee(s),o=r?"getElementById"in n?n.getElementById(r):null:e?n.querySelector(e):null,a=FPe(n);return o||(a?i(a):null)}return i(t)}function YTt(t,e){function r(i){return i?i.closest(e)||r(FPe(jee(i))):null}return r(t)}function ZTt(t,e){return UPe(t,e)}function UPe(t,e){if(!t)return;const r=e(t);if(r!==void 0)return r;const{parentNode:i}=t;return UPe(i instanceof ShadowRoot?i.host:i,e)}function GXt(t,e){return!!ZTt(e,r=>r===t?!0:void 0)}function JTt(t){return typeof t?.setFocus=="function"}async function jXt(t){if(t)return JTt(t)?t.setFocus():t.focus()}function HXt(t){t&&(qTt(t,XTt)[0]||t).focus()}const KM=":not([slot])";function qXt(t,e,r){e&&!Array.isArray(e)&&typeof e!="string"&&(r=e,e=null);const i=e?Array.isArray(e)?e.map(s=>`[slot="${s}"]`).join(","):`[slot="${e}"]`:KM;return r?.all?QTt(t,i,r):KTt(t,i,r)}function kPe(t,e){return t?Array.from(t.children||[]).filter(r=>r?.matches(e)):[]}function QTt(t,e,r){let i=e===KM?kPe(t,KM):Array.from(t.querySelectorAll(e));i=r&&r.direct===!1?i:i.filter(n=>n.parentElement===t),i=r?.matches?i.filter(n=>n?.matches(r.matches)):i;const s=r?.selector;return s?i.map(n=>Array.from(n.querySelectorAll(s))).reduce((n,o)=>[...n,...o],[]).filter(n=>!!n):i}function KTt(t,e,r){let i=e===KM?kPe(t,KM)[0]||null:t.querySelector(e);i=r&&r.direct===!1||i?.parentElement===t?i:null,i=r?.matches?i?.matches(r.matches)?i:null:i;const s=r?.selector;return s?i?.querySelector(s):i}function WXt(t,e,r){if(typeof e=="string"&&e!=="")return e;if(e==="")return t[r]}function XXt(t){return(!!t).toString()}function YXt(t){return!!e2t(t).length}function e2t(t){return t.target.assignedElements({flatten:!0})}function ZXt(t){return!!(t.isPrimary&&t.button===0)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.4.3
 */function zpe(){const{classList:t}=document.body,e=window.matchMedia("(prefers-color-scheme: dark)").matches,r=()=>t.contains(MPe)||t.contains(RPe)&&e?"dark":"light",i=o=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:o}})),s=o=>{n!==o&&i(o),n=o};let n=r();i(n),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",o=>s(o.matches?"dark":"light")),new MutationObserver(()=>s(r())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}function t2t(){typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document&&(document.readyState==="interactive"?zpe():document.addEventListener("DOMContentLoaded",()=>zpe(),{once:!0}))}const r2t=t2t;r2t();let zPe;function i2t(){try{Bxt(".")}catch{Gxt(_u(jr(zPe)))}}function JXt(t){const e=[];for(const r of Object.keys(t))customElements.get(`calcite-${r}`)||e.push(t[r]?.());return Promise.all(e)}zPe="components/assets";const VPe=Symbol("widget"),s2t=Symbol("widget-test-data"),n2t=[],o2t={},s6=new WeakMap;function BPe(t,e){let r=e.children;if(r&&r.length)for(let s=0;s<r.length;++s)r[s]=BPe(t,r[s]);else r=n2t;const i=e.vnodeSelector;if(Hee(i)){const s=e.properties||o2t,n=s.key||i;return{vnodeSelector:"div",properties:{key:n,afterCreate:a2t,afterUpdate:l2t,afterRemoved:GPe,parentWidget:t,widgetConstructor:i,widgetProperties:{...s,key:n,children:r}},children:void 0,text:void 0,domNode:null}}return e}function a2t(t,e,r,{parentWidget:i,widgetConstructor:s,widgetProperties:n}){const o=new s(n);o.container=t,s6.set(t,o),o.afterCreate?.(o,t),i._internalHandles.add(nl(()=>GPe(t)))}function l2t(t,e,r,{widgetProperties:i}){const s=s6.get(t);s&&(s.set(i),s.afterUpdate?.(s,t))}function GPe(t){const e=s6.get(t);e&&(e.afterRemoved?.(e,t),e.destroy(),s6.delete(t))}function Hee(t){return typeof t=="function"&&t[VPe]}const Vpe=new Set;function c2t(t){Vpe.add(t),t.finally(()=>Vpe.delete(t))}var jPe;const u2t="esri.widgets.Widget";let h2t=0;const d2t={widgetIcon:"esri-icon-checkbox-unchecked"};function HPe(t,e){for(const r in e)t[r]!=null&&(typeof t[r]=="object"&&typeof e[r]=="object"?HPe(t[r],e?.[r]):t[r]=e[r]);return t}const p2t=Vxt({postProcessProjectionOptions(t){const e=t.eventHandlerInterceptor,r=/capture$/i;t.eventHandlerInterceptor=(i,s,n,o)=>{const a=e?.(i,s,n,o),l=r.test(i);if(!((i=i.replace(r,"")).toLowerCase()in n)||l){const c=i[2].toLowerCase()+i.slice(3),h=m=>a?.call(n,m);n.addEventListener(c,h,l);const d=()=>n.removeEventListener(c,h,l),f=o.afterRemoved;o.afterRemoved=m=>{f?.(m),d()}}return a}},handleInterceptedEvent(t,e,r,i){const{eventPhase:s,type:n}=i,o=s===Event.CAPTURING_PHASE;let a=`on${n}${o?"capture":""}`;const l=e.properties;(l&&a in l||(a=`on${n[0].toUpperCase()}${n.slice(1)}${o?"Capture":""}`,l&&a in l))&&(Swe(),t.scheduleRender(),l[a].call(l.bind||r,i))}});let HV=!1,Hn=class extends B6(Ts.EventedAccessor){constructor(e,r){super(e,r),this._attached=!1,this._internalHandles=new $i,this._projector=p2t,this._readyForTrueRender=!1,this.iconClass=d2t.widgetIcon,this.icon=null,this.key=this,this._loadLocale=MY(async()=>{if(this._messageBundleProps&&this._messageBundleProps.length){const o=await Ac(this._messageBundleProps.map(async({bundlePath:a,propertyName:l})=>{if(this.destroyed)return;let c=await pZ(a);this.uiStrings&&Object.keys(this.uiStrings)&&(c=HPe(ee(c),this.uiStrings)),this[l]=c}));if(this.destroyed)return;for(const a of o)a.error&&K.getLogger(this).error("widget-intl:locale-error",this.declaredClass,a.error)}await this.loadLocale()}),i2t();const i="esri-widget-uid-"+Q9(),s=this.render.bind(this);this._trackingTarget=new k6(()=>this.scheduleRender());const n=()=>{if(!this._readyForTrueRender||this.destroyed)return null;const o=s();let{properties:a}=o;a||(o.properties=a={});const{key:l}=a;l||(a.key=i),this.visible?a.styles||(a.styles={}):(a.class="",a.styles={display:"none"}),a.styles.display||(a.styles.display="");let c=0;return o.children?.forEach(h=>{if(Hee(h.vnodeSelector))return;let{properties:d}=h;d||(h.properties=d={}),d.key||(d.key=`${this.id}--${c++}`)}),BPe(this,o)};this.render=()=>{if(HV)return n();let o=zGe(this)??null;if(o)return o;this._trackingTarget.clear(),HV=!0;try{o=h0(this._trackingTarget,n)}catch(a){throw console.error(a),a}finally{HV=!1}return o&&VGe(this,o),o},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then(()=>{this._readyForTrueRender=!0,this._postInitialize()})),c2t(this._resourcesFetch)}normalizeCtorArgs(e,r){const i={...e};return r&&(i.container=r),i}postInitialize(){}beforeFirstRender(){return Promise.all([this.loadDependencies(),this._loadLocale()]).then(()=>{}).catch(Xte)}async loadDependencies(){}async loadLocale(){}destroy(){this.destroyed||(Ne(this._trackingTarget),Ne(this.viewModel),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null,ik(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return f8(e)}get domNode(){return this.container}set domNode(e){this.container=e}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+h2t++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(jPe=VPe,s2t)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(ik(this),this._projector.scheduleRender())}classes(...e){return qGe.apply(this,e)}renderNow(){ik(this),this._projector.renderNow()}_postInitialize(){if(this.destroyed)return;this.scheduleRender(),this._delegatedEventNames?.length&&this._internalHandles.add(le(()=>this.viewModel,(r,i)=>{i&&this._internalHandles.remove("delegated-events"),r&&R6(r)&&this._internalHandles.add(this._delegatedEventNames.map(s=>aP(r,s,n=>{this.emit(s,n)})),"delegated-events")},Pr)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(Xte),this.scheduleRender()};this._internalHandles.add([uZ(e),le(()=>this.uiStrings,e),Iu(()=>this.container,r=>{this.destroyed||this._attach(r)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){this._attached&&(this._projector.detach(this.render),this._attached=!1),e?.parentNode?.removeChild(e)}};Hn[jPe]=!0,u([p()],Hn.prototype,"_readyForTrueRender",void 0),u([p({value:null})],Hn.prototype,"container",null),u([wr("container")],Hn.prototype,"castContainer",null),u([p()],Hn.prototype,"iconClass",void 0),u([p()],Hn.prototype,"icon",void 0),u([p()],Hn.prototype,"id",null),u([p()],Hn.prototype,"label",null),u([p()],Hn.prototype,"renderable",null),u([p()],Hn.prototype,"uiStrings",void 0),u([p()],Hn.prototype,"viewModel",void 0),u([p({value:!0})],Hn.prototype,"visible",null),u([p()],Hn.prototype,"key",void 0),u([p()],Hn.prototype,"children",void 0),u([p()],Hn.prototype,"afterCreate",void 0),u([p()],Hn.prototype,"afterUpdate",void 0),u([p()],Hn.prototype,"afterRemoved",void 0),Hn=u([P(u2t)],Hn);const kx=Hn;function Bpe(t,e){return t&&"copyright"in t&&(!e||typeof t.originOf=="function"&&t.originOf("copyright")==="user")}function f2t(t,e){return t.length!==e.length||t.some((r,i)=>r.text!==e[i].text)}function eD(t,e,r){!r||!e||t.find(i=>i.layerView===e&&i.text===r)||t.push({text:r,layerView:e})}function m2t(t){return t.type==="bing-maps"}const Ay=[];let U2=class extends mM{constructor(t){super(t),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.handles.remove("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new Pt,this.view=null,this._allLayerViewsChange=e=>{this.handles.remove("suspension");const r=this.get("view.allLayerViews");r&&this.handles.add(r.map(i=>le(()=>[i.suspended,i.layer?.attributionVisible],()=>this._updateAttributionItems())),"suspension"),e&&e.removed&&e.removed.forEach(i=>{this._pendingAttributions.delete(i),this._fetchedAttributionData.delete(i)}),this._updateAttributionItems()},this.handles.add([_a(()=>this.view?.allLayerViews,"change",e=>this._allLayerViewsChange(e),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),Iu(()=>this.view?.stationary===!0,()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const t=this.view,e=t?.allLayerViews;Ay.length=0,t&&e?(e.forEach(r=>{if(r.suspended||!r.layer?.attributionVisible)return;const i=r.layer;if(Bpe(i,"user"))return void eD(Ay,r,i.copyright);if(i.hasAttributionData){if(this._fetchedAttributionData.has(r)){const n=this._fetchedAttributionData.get(r);return void(n?eD(Ay,r,this._getDynamicAttribution(n,t,i)):Bpe(i)&&eD(Ay,r,i.copyright))}return void this._fetchAttributionData(r)}const s=i.get("portalItem.accessInformation");eD(Ay,r,s||i.copyright)}),f2t(this.items,Ay)&&(this.items.removeAll(),this.items.addMany(Ay)),Ay.length=0,this.notifyChange("state")):this._clear()}async _fetchAttributionData(t){if(this._pendingAttributions.has(t))return;this._pendingAttributions.add(t);const e=await $u(t.layer.fetchAttributionData());if(this._pendingAttributions.has(t)){const r=e.ok?this._createContributionIndex(e.value,m2t(t.layer)):null;this._pendingAttributions.delete(t),this._fetchedAttributionData.set(t,r)}this._updateAttributionItems()}_createContributionIndex(t,e){const r=t.contributors,i={};if(!r)return i;for(let s=0;s<r.length;s++){const n=r[s],o=n.coverageAreas;if(!o)return;for(const a of o){const l=a.bbox,c=a.zoomMin-(e&&a.zoomMin?1:0),h=a.zoomMax-(e&&a.zoomMax?1:0),d=new cr({xmin:l[1],ymin:l[0],xmax:l[3],ymax:l[2],spatialReference:qe.WGS84}),f={extent:OS(d),attribution:n.attribution||"",score:a.score!=null?a.score:100,id:s};for(let m=c;m<=h;m++)i[m]??(i[m]=[]),i[m].push(f)}}return i.maxKey=Math.max.apply(null,Object.keys(i)),i}_getDynamicAttribution(t,e,r){const{extent:i,scale:s}=e;let n=r.tileInfo?.scaleToZoom(s)??0;if(n=Math.min(t.maxKey??0,Math.round(n)),!i||n==null||n<=-1)return"";const o=t[n],a=bx(i.center.clone().normalize(),e.spatialReference),l=new Set;return o?o.filter(c=>{const h=c.id,d=!l.has(h)&&a&&c.extent&&cZ(c.extent,a);return d&&l.add(h),d}).sort((c,h)=>h.score-c.score||c.objectId-h.objectId).map(c=>c.attribution).join(", "):""}};u([p({readOnly:!0,type:Pt})],U2.prototype,"items",void 0),u([p({readOnly:!0})],U2.prototype,"state",null),u([p()],U2.prototype,"view",void 0),U2=u([P("esri.widgets.Attribution.AttributionViewModel")],U2);const qPe=U2;function sC(){return function(t,e){if(!t[e])throw new TypeError(`Cannot auto bind undefined function '${String(e)}'`);return{value:y2t(t[e])}}}function g2t(t){const e=t?.type;return t instanceof KeyboardEvent||e==="keyup"||e==="keydown"||e==="keypress"}function y2t(t){return function(e,...r){g2t(e)?Awe(e.key)&&(e.preventDefault(),e.stopPropagation(),e.target.click()):t.call(this,e,...r)}}function hx(t){return(e,r)=>{e.hasOwnProperty("_messageBundleProps")||(e._messageBundleProps=e._messageBundleProps?e._messageBundleProps.slice():[]),e._messageBundleProps.push({bundlePath:t,propertyName:r})}}var _2t=function(t){return{vnodeSelector:"",properties:void 0,children:void 0,text:t.toString(),domNode:null}},WPe=function(t,e){for(var r=0,i=t.length;r<i;r++){var s=t[r];Array.isArray(s)?WPe(s,e):s!=null&&s!==!1&&(s.hasOwnProperty("vnodeSelector")||(s=_2t(s)),e.push(s))}},v2t=function(t,e){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(r.length===1&&typeof r[0]=="string")return{vnodeSelector:t,properties:e||void 0,children:void 0,text:r[0],domNode:null};var s=[];return WPe(r,s),{vnodeSelector:t,properties:e||void 0,children:s,text:void 0,domNode:null}};function gt(t,e,...r){return typeof t!="function"||Hee(t)?v2t(t,e,...r):t(e,...r)}const ZT="esri-attribution",Oy={base:`${ZT} esri-widget`,poweredBy:`${ZT}__powered-by`,sources:`${ZT}__sources`,open:`${ZT}--open`,sourcesOpen:`${ZT}__sources--open`,link:`${ZT}__link`,widgetIcon:"esri-icon-description",interactive:"esri-interactive"};let Ga=class extends kx{constructor(e,r){super(e,r),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(i=>i.forEach(({target:s})=>this._checkSourceTextOverflow(s))),this.iconClass=Oy.widgetIcon,this.icon=null,this.itemDelimiter=" | ",this.messages=null,this.viewModel=new qPe}initialize(){this.addHandles(_a(()=>this.viewModel?.items,"change",()=>this.scheduleRender()))}destroy(){this._resizeObserver?.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,r)=>(e.includes(r.text)||e.push(r.text),e),[]).join(this.itemDelimiter)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[Oy.open]:this._isOpen};return gt("div",{bind:this,class:this.classes(Oy.base,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}renderPoweredBy(){return gt("div",{class:Oy.poweredBy},"Powered by"," ",gt("a",{class:Oy.link,href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}renderSourcesNode(){const e=this._isOpen,r=this._isInteractive,i=r?"0":"",{attributionText:s}=this,n={[Oy.sourcesOpen]:e,[Oy.interactive]:r};return gt("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(Oy.sources,n),innerHTML:s,tabindex:i})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let r=!1;const{clientHeight:i,clientWidth:s,scrollWidth:n}=e,o=n>s,a=this._attributionTextOverflowed!==o;if(this._attributionTextOverflowed=o,a&&(r=!0),this._isOpen){const l=i<this._prevSourceNodeHeight;this._prevSourceNodeHeight=i,l&&(this._isOpen=!1,r=!0)}r&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};u([p()],Ga.prototype,"_isOpen",void 0),u([p()],Ga.prototype,"_isInteractive",null),u([p()],Ga.prototype,"_attributionTextOverflowed",void 0),u([p()],Ga.prototype,"_prevSourceNodeHeight",void 0),u([p({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],Ga.prototype,"attributionText",null),u([p()],Ga.prototype,"iconClass",void 0),u([p()],Ga.prototype,"icon",void 0),u([p()],Ga.prototype,"itemDelimiter",void 0),u([p()],Ga.prototype,"label",null),u([p(),hx("esri/widgets/Attribution/t9n/Attribution")],Ga.prototype,"messages",void 0),u([p()],Ga.prototype,"view",null),u([p({type:qPe})],Ga.prototype,"viewModel",void 0),u([sC()],Ga.prototype,"_toggleState",null),Ga=u([P("esri.widgets.Attribution")],Ga);const b2t=Ga,XPe=t=>{let e=class extends t{constructor(...r){super(...r),this.goToOverride=null,this.view=null}callGoTo(r){const{view:i}=this;return M6(i),this.goToOverride?this.goToOverride(i,r):i.goTo(r.target,r.options)}};return u([p()],e.prototype,"goToOverride",void 0),u([p()],e.prototype,"view",void 0),e=u([P("esri.widgets.support.GoTo")],e),e},w2t="esri.widgets.CompassViewModel";let _b=class extends XPe(Te){constructor(e){super(e),this._handles=new $i,this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._handles.add(le(()=>this.view,this._updateRotationWatcher,Pr))}destroy(){Fi(this._handles),this.view=null}get canShowNorth(){const e=this.get("view.spatialReference");return!(!e||!e.isWebMercator&&!e.isGeographic)}get state(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}reset(){if(!this.get("view.ready"))return;const e={};this.view?.type==="2d"?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){e!=null&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const r=-e.heading;this.orientation={x:0,y:0,z:r}}_updateRotationWatcher(e){this._handles.removeAll(),e&&this._handles.add(e.type==="2d"?le(()=>e?.rotation,this._updateForRotation,Pr):le(()=>e?.camera,this._updateForCamera,Pr))}};u([p({readOnly:!0})],_b.prototype,"canShowNorth",null),u([p()],_b.prototype,"orientation",void 0),u([p({readOnly:!0})],_b.prototype,"state",null),u([p()],_b.prototype,"view",void 0),_b=u([P(w2t)],_b);const YPe=_b,Ry={base:"esri-compass esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",icon:"esri-compass__icon",rotationIcon:"esri-icon-dial",northIcon:"esri-icon-compass",widgetIcon:"esri-icon-locate-circled",interactive:"esri-interactive",disabled:"esri-disabled"};let Ud=class extends kx{constructor(e,r){super(e,r),this.iconClass=Ry.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new YPe}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:r}=this.viewModel,i=r==="disabled",s=(r==="rotation"?"rotation":"compass")=="compass",n=i?-1:0,o={[Ry.disabled]:i,[Ry.interactive]:!i},a={[Ry.northIcon]:s,[Ry.rotationIcon]:!s},{messages:l}=this;return gt("div",{bind:this,class:this.classes(Ry.base,o),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:n,"aria-label":l.reset,title:l.reset},gt("span",{"aria-hidden":"true",class:this.classes(Ry.icon,a),styles:this._toRotationTransform(e)}),gt("span",{class:Ry.text},l.reset))}_reset(){this.viewModel.reset()}_toRotationTransform(e){return{transform:`rotateZ(${e.z}deg)`}}};u([p()],Ud.prototype,"goToOverride",null),u([p()],Ud.prototype,"iconClass",void 0),u([p()],Ud.prototype,"icon",void 0),u([p()],Ud.prototype,"label",null),u([p(),hx("esri/widgets/Compass/t9n/Compass")],Ud.prototype,"messages",void 0),u([p()],Ud.prototype,"view",null),u([p({type:YPe})],Ud.prototype,"viewModel",void 0),u([sC()],Ud.prototype,"_reset",null),Ud=u([P("esri.widgets.Compass")],Ud);const x2t=Ud,JT="esri-navigation-toggle",Ku={base:`${JT} esri-widget`,button:`${JT}__button esri-widget--button`,activeButton:`${JT}__button--active`,panButton:`${JT}__button--pan`,rotateButton:`${JT}__button--rotate`,isLayoutHorizontal:`${JT}--horizontal`,rotationIcon:"esri-icon-rotate",panIcon:"esri-icon-pan",widgetIcon:"esri-icon-pan2",disabled:"esri-disabled"};let k2=class extends Te{constructor(e){super(e),this.navigationMode="pan",this.view=null}initialize(){this.own(Iu(()=>this.view?.inputManager,()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){return this.get("view.ready")&&this.view?.type==="3d"?"ready":"disabled"}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){this.get("view.inputManager").primaryDragAction=this.navigationMode==="pan"?"pan":"rotate"}};u([p({readOnly:!0})],k2.prototype,"state",null),u([p()],k2.prototype,"navigationMode",void 0),u([p()],k2.prototype,"view",void 0),k2=u([P("esri.widgets.NavigationToggleViewModel")],k2);const ZPe=k2;let kd=class extends kx{constructor(e,r){super(e,r),this.iconClass=Ku.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new ZPe}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}toggle(){return this.viewModel.toggle()}render(){const e=this.get("viewModel.state")==="disabled",r=this.get("viewModel.navigationMode")==="pan",i={[Ku.disabled]:e,[Ku.isLayoutHorizontal]:this.layout==="horizontal"},s={[Ku.activeButton]:r},n={[Ku.activeButton]:!r},o=e?-1:0,a=this.messages.toggle;return gt("div",{bind:this,class:this.classes(Ku.base,i),onclick:this._toggle,onkeydown:this._toggle,tabIndex:o,"aria-label":a,title:a},gt("div",{class:this.classes(Ku.button,Ku.panButton,s)},gt("span",{class:Ku.panIcon})),gt("div",{class:this.classes(Ku.button,Ku.rotateButton,n)},gt("span",{class:Ku.rotationIcon})))}_toggle(){this.toggle()}};u([p()],kd.prototype,"iconClass",void 0),u([p()],kd.prototype,"icon",void 0),u([p()],kd.prototype,"label",null),u([p({value:"vertical"})],kd.prototype,"layout",null),u([p(),hx("esri/widgets/NavigationToggle/t9n/NavigationToggle")],kd.prototype,"messages",void 0),u([p()],kd.prototype,"view",null),u([p({type:ZPe})],kd.prototype,"viewModel",void 0),u([sC()],kd.prototype,"_toggle",null),kd=u([P("esri.widgets.NavigationToggle")],kd);const T2t=kd,eA={button:"esri-widget--button esri-widget",disabled:"esri-disabled",interactive:"esri-interactive",iconText:"esri-icon-font-fallback-text",icon:"esri-icon"};let xg=class extends kx{constructor(){super(...arguments),this.enabled=!0,this.iconClass=null,this.icon=null,this.title=""}render(){const e=this.enabled?0:-1,r={[eA.disabled]:!this.enabled,[eA.interactive]:this.enabled};return gt("div",{bind:this,class:this.classes(eA.button,r),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:e,title:this.title},gt("span",{"aria-hidden":"true",role:"presentation",class:this.classes(eA.icon,this.iconClass??"")}),gt("span",{class:eA.iconText},this.title))}_triggerAction(){this.action.call(this)}};u([p()],xg.prototype,"action",void 0),u([p()],xg.prototype,"enabled",void 0),u([p()],xg.prototype,"iconClass",void 0),u([p()],xg.prototype,"icon",void 0),u([p()],xg.prototype,"title",void 0),u([sC()],xg.prototype,"_triggerAction",null),xg=u([P("esri.widgets.IconButton")],xg);const Gpe=xg;let z2=class extends Te{get canZoomIn(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),r=this.get("view.constraints.effectiveMaxScale");return r===0||e>r}get canZoomOut(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),r=this.get("view.constraints.effectiveMinScale");return r===0||e<r}};u([p({readOnly:!0})],z2.prototype,"canZoomIn",null),u([p({readOnly:!0})],z2.prototype,"canZoomOut",null),u([p()],z2.prototype,"view",void 0),z2=u([P("esri.widgets.Zoom.ZoomConditions2D")],z2);const S2t=z2;let V2=class extends Te{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};u([p({readOnly:!0})],V2.prototype,"canZoomIn",null),u([p({readOnly:!0})],V2.prototype,"canZoomOut",null),u([p()],V2.prototype,"view",void 0),V2=u([P("esri.widgets.Zoom.ZoomConditions3D")],V2);const E2t=V2;let t_=class extends Te{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return this._zoomConditions!=null&&this._zoomConditions.canZoomIn}get canZoomOut(){return this._zoomConditions!=null&&this._zoomConditions?.canZoomOut}get state(){return this.view?.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new S2t({view:e}):e.type==="3d"&&(this._zoomConditions=new E2t({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():V7(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():V7(e.goTo({zoomFactor:.5}))}};u([p()],t_.prototype,"_zoomConditions",void 0),u([p()],t_.prototype,"canZoomIn",null),u([p()],t_.prototype,"canZoomOut",null),u([p({readOnly:!0})],t_.prototype,"state",null),u([p()],t_.prototype,"view",null),t_=u([P("esri.widgets.Zoom.ZoomViewModel")],t_);const JPe=t_,tA={base:"esri-zoom esri-widget",horizontalLayout:"esri-zoom--horizontal",zoomInIcon:"esri-icon-plus",zoomOutIcon:"esri-icon-minus",widgetIcon:"esri-icon-zoom-in-magnifying-glass"};let Rf=class extends kx{constructor(e,r){super(e,r),this.iconClass=tA.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new JPe}initialize(){this._zoomInButton=new Gpe({action:this.zoomIn.bind(this),iconClass:tA.zoomInIcon}),this._zoomOutButton=new Gpe({action:this.zoomOut.bind(this),iconClass:tA.zoomOutIcon})}destroy(){this._zoomInButton=Ne(this._zoomInButton),this._zoomOutButton=Ne(this._zoomOutButton)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){const e=this.viewModel,r={[tA.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:i,canZoomOut:s}=e;this._zoomInButton.enabled=i,this._zoomOutButton.enabled=s;const{zoomIn:n,zoomOut:o}=this.messages;return this._zoomInButton.title=n,this._zoomOutButton.title=o,gt("div",{class:this.classes(tA.base,r)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};u([p()],Rf.prototype,"iconClass",void 0),u([p()],Rf.prototype,"icon",void 0),u([p()],Rf.prototype,"label",null),u([p({value:"vertical"})],Rf.prototype,"layout",null),u([p(),hx("esri/widgets/Zoom/t9n/Zoom")],Rf.prototype,"messages",void 0),u([p()],Rf.prototype,"view",null),u([p({type:JPe})],Rf.prototype,"viewModel",void 0),Rf=u([P("esri.widgets.Zoom")],Rf);const C2t=Rf;function A2t(t){return t?.view!==void 0}let s4=class extends Lxt{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[],this._updateViewAwareWidgets=r=>{this.components.forEach(i=>{const s=this._find(i),n=s?.widget;A2t(n)&&(n.view=r)})},this._componentsWatcher=(r,i)=>{this._removeComponents(i),this._addComponents(r),this._adjustPadding(r)}}initialize(){this.addHandles([le(()=>this.components,this._componentsWatcher,Pr),le(()=>this.view,this._updateViewAwareWidgets,Pr)])}_add(e,r,i,s,n){let o=e;if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;o=this._createComponent(e)}super._add(o,r,i,s,n)}_removeComponents(e){e.forEach(r=>{const i=this._find(r);i&&(this.remove(i),i.destroy())})}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:r}=this.padding;this.padding=r}}_addComponents(e){this.constructed&&e.forEach(r=>this.add(this._createComponent(r),this._defaultPositionLookup[r]))}_createComponent(e){const r=this._createWidget(e);return new i4({id:e,node:r})}_createWidget(e){const{view:r}=this;switch(e){case"attribution":return new b2t({view:r});case"compass":return new x2t({view:r});case"navigation-toggle":return new T2t({view:r});case"zoom":return new C2t({view:r})}}};u([p()],s4.prototype,"components",void 0),s4=u([P("esri.views.ui.DefaultUI")],s4);const QPe=s4;let n4=class extends QPe{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};u([p()],n4.prototype,"components",void 0),n4=u([P("esri.views.ui.3d.DefaultUI3D")],n4);const KPe=n4;let Qe=class extends WBe(zje(dje(SHe))){constructor(t){super(t),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._defaults={},this._externallySet={environment:!1},this._createGraphicsViewController=null,this._resolveWhenReady=[],this._propertiesPool=new x0({slicePlane:Ybe},this),this._resourceController=umt(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new uq({view:this}),this.labeler=new ub({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new PE,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new Bb,this.environmentManager=new Pd,this.floors=new Pt,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new AHe({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new Rft,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new KPe,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.highlightOptions=new Vq,this.voxelWasm=null,this.voxelWasmPromise=null,IVe(),t&&t.environment||(this._defaults.environment=new w2,this.environment=this._defaults.environment);const e=(r=null)=>{r!=null&&r.type===ni.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async i=>{try{await i.when()}catch{}this._updatingChanged()}))};this.addHandles([_a(()=>this.map?.allLayers,"after-changes",r=>e(r),{onListenerAdd:()=>e(),onListenerRemove:()=>e(),sync:!0}),this.allLayerViews.on("after-changes",r=>this._updateUpdatingMonitors(r)),le(()=>this.map,r=>{r&&"load"in r&&r.load&&r.load().catch(()=>{})})]),this.inputManager=new Net({view:this}),this.stateManager=new xn({view:this})}initialize(){this.groundView=new Aje({view:this}),this._updateUpdatingMonitors();const t=()=>this._updateDefaultToMapOptions();this.addHandles(_a(()=>this.map?.allLayers,"after-changes",t,{onListenerAdd:t,onListenerRemove:t})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,e=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=e)},Pr),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,e=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=e)},Pr),this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,e=>eNe(e>0?1e3/Math.ceil(e):0),Pr),this.updatingHandles.add(()=>this.map?.ground,t,Ls),this.updatingHandles.add(()=>this.map?.ground?.opacity,()=>this._updateDefaultHitTestOptions(),Ls),this.addHandles(le(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),Wr))}destroy(){this.destroyed||(this.updatingHandles.removeAll(),this.removeAllHandles(),this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=Ne(this.sharedSymbolResources),this._set("labeler",Ne(this.labeler)),this._set("deconflictor",Ne(this.deconflictor)),this._resourceController=Ne(this._resourceController),this._set("stateManager",Ne(this.stateManager)),this._set("inputManager",Ne(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.removeHandles("updatingMonitors"),this._set("environmentManager",Ne(this.environmentManager)),this.groundView=Ne(this.groundView),this._exitBasemapTerrain(),this._stage?.destroy(),this.removeAllHandles(),this.updatingHandles.removeAll(),this.handles.removeAll())}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){return this.basemapTerrain?.spatialReference}get animation(){return this.state?.animation}get camera(){return this.stateManager?.camera}set camera(t){this.stateManager&&(this.stateManager.camera=t)}get contentCamera(){return this.stateManager?.contentCamera}set contentCamera(t){this.stateManager&&(this.stateManager.contentCamera=t)}installContentCameraReset(t={sticky:!1}){return this.stateManager.installContentCameraReset(t)}get center(){return this.stateManager?.center}set center(t){this.stateManager&&(this.stateManager.center=t)}get clippingArea(){if(this.viewingMode==="global")return null;let t=this._userClippingArea||("clippingArea"in this.map?this.map?.clippingArea:void 0);return!this._userClippingArea&&!this.get("map.clippingEnabled")||t==null?(this._clippingArea=null,null):t instanceof cr?this.spatialReference&&(t=tD(t,this.spatialReference),t==null)?(K.getLogger(this).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(t=t.clone(),t.intersection(this._groundAndLayersExtent)==null&&(t.xmin=t.xmax,t.ymin=t.ymax),t.zmin=void 0,t.zmax=void 0,t.equals(this._clippingArea)||(this._clippingArea=t),this._clippingArea):(K.getLogger(this).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(t){this.ready&&this.viewingMode==="global"&&t!=null?K.getLogger(this).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=t}get renderDataExtent(){if(this.state.viewingMode===Ve.Global)return null;const t=this.renderSpatialReference,e=this.dataExtent;return e==null||t==null||e.spatialReference.equals(t)?e:tD(e,t)}get dataExtent(){let t=this._groundAndLayersExtent;const e=this.spatialReference||qe.WGS84,r=tD(this.clippingArea,e);r!=null&&(t=t!=null?t.intersection(r):r);const i=this._get("dataExtent");return t!=null&&t.equals(i)?i:t}get _groundAndLayersExtent(){const t=this.spatialReference||qe.WGS84;let e;const r=n=>{const o=tD(n,t);o!=null&&(e!=null?e.union(o):e=o.clone())},i=this.basemapTerrain;if(i?.spatialReference){const n=i.groundExtent;r(new cr({xmin:n[0],ymin:n[1],zmin:0,xmax:n[2],ymax:n[3],zmax:0,spatialReference:i.spatialReference}))}if(this.map){const n=o=>{o.fullExtent==null||o.type==="graphics"&&o.internal||r(o.fullExtent)};this.map.allLayers.forEach(o=>n(o))}if(e==null)return null;e.hasZ?(e.zmin=Math.min(0,e.zmin??0),e.zmax=Math.max(0,e.zmax??0)):(e.zmin=0,e.zmax=0);const s=this._get("_groundAndLayersExtent");return e.equals(s)?s:e}set environment(t){t!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",t)}castEnvironment(t){return t?t instanceof w2?t:t instanceof dxe?this.environment!=null?this.environment.cloneWithWebsceneEnvironment(t):w2.fromWebsceneEnvironment(t):ws(w2,t):new w2}get extent(){return this.stateManager?.extent}set extent(t){this.stateManager&&(this.stateManager.extent=t)}get screenCenter(){return this.stateManager?.screenCenter}get frustum(){return this.stateManager?.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||(this.toolViewManager?.interacting??!1)}get stationary(){return!this.animation&&!this.resizing&&(this.state==null||this.state.stationary)}get navigating(){return this.state?.navigating??!1}get padding(){return this.stateManager?.padding}set padding(t){this.stateManager&&(this.stateManager.padding=t)}set qualityProfile(t){jN.isValidProfile(t)&&(jN.apply(t,this.qualitySettings),this._set("qualityProfile",t))}get qualityProfile(){return this._get("qualityProfile")||jN.getDefaultProfile()}set slicePlane(t){if(this._stage!=null&&this._stage.renderer.setParameters({slicePlane:t}),t==null)return void this._set("slicePlane",null);const e=this._propertiesPool.get("slicePlane");Mx(t,e),this._set("slicePlane",e)}get typeSpecificPreconditionsReady(){return!!this.viewingMode}get resolution(){return this.spatialReference!=null?cwe(this.scale,this.spatialReference):0}get scale(){return this.stateManager?.scale}set scale(t){this.stateManager&&(this.stateManager.scale=t)}get heightModelInfo(){const t=this.getDefaultHeightModelInfo();return t!=null?Ax.deriveUnitFromSR(t,this.spatialReference):null}get updating(){if(this.destroyed)return!1;let t=0,e=this.layerViewManager.updating,r=e?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(s=>{if(s.isFulfilled()){if(s.updating){if(e=!0,s.suspended||jM(s))return;++r,t+=s.updatingProgress}}else++r});for(const s of this._updatingObjects)s!=null&&s.updating&&(r+=.1,t+=.5*.1);for(const s of this._updatingObjectsWithProgress)s!=null&&s.updating&&(++r,t+=s.updatingProgress);const i=!this.stateManager.test.updatingIgnoreRenderState&&this.state.updating;if(e=!!(e||r>0||this.updatingHandles.updating||!this.ready||!this.stationary||i||this._createGraphicsViewController||this.inputManager?.updating||this.map?.allLayers?.some(s=>!s.isFulfilled())),e?(this._numUpdating=Math.max(r,this._numUpdating),t+=this._numUpdating-r):this._numUpdating=0,this._numUpdating>0?t/=this._numUpdating:t=e?0:1,this._get("updatingProgress")!==t){const s=performance.now();if(t<1){const n=Math.min((s-this._lastUpdateTime)/2e3,1);t=this.updatingProgress*(1-n)+t*n}this._set("updatingProgress",t),this._lastUpdateTime=e&&t<1?s:0}return e}get _updatingObjects(){return[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager]}get _updatingObjectsWithProgress(){return[this.deconflictor,this.labeler,this.basemapTerrain]}get viewingMode(){const t=this._predeterminedViewingMode;if(t!=null)return ak(t);const e=this.spatialReference;return e?this.defaultsFromMap?.viewingMode!=null&&e.equals(this.defaultsFromMap.spatialReference)?ak(this.defaultsFromMap.viewingMode):ZH(e,Ve.Global)?"global":"local":"global"}set viewingMode(t){this.ready?K.getLogger(this).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",t)}get viewpoint(){return this.stateManager?.viewpoint}set viewpoint(t){this.stateManager&&(this.stateManager.viewpoint=t)}get zoom(){return this.stateManager.zoom}set zoom(t){this.stateManager&&(this.stateManager.zoom=t)}get resourceController(){return this._resourceController}get performanceInfo(){return new Nmt(this)}on(t,e,r,i){return this.viewEvents.on(t,e,r,i)||super.on(t,e)}hasEventListener(t){return super.hasEventListener(t)||this.viewEvents.hasHandler(t)}toMap(t,e){if(!this.ready)return K.getLogger(this).error("#toMap()","Scene view cannot be used before it is ready"),null;const r=e?this.externalToInternalIntersectOptions(e):this._defaultToMapOptions,i=r.graphics!=null&&(r.graphics.include!=null||r.graphics.exclude!=null),s=Nse(t)?Dse(this,t):t,n=Uf(s);r.enableDraped=r.include&&!r.include.has(E_)||r.exclude&&r.exclude.has(E_);const o=this.sceneIntersectionHelper,a=ed(this.state.viewingMode);if(a.options.selectionMode=!0,a.options.store=i?So.ALL:So.MIN,o.intersectIntersectorScreen(n,a,r),i){for(const l of a.results.all){const c=xW(l,this);if(c==null)return this._intersectResultToMapPoint(l);if(c.type!=="graphic"||this._testGraphicUidFilter(r.graphics,c.graphic))return this._intersectResultToMapPoint(l)}return null}return this._intersectResultToMapPoint(a.results.min)}toScreen(t){if(!this.ready)return K.getLogger(this).error("#toScreen()","Scene view cannot be used before it is ready"),null;const e=(t.z==null?Wf(this.elevationProvider,t):null)??0;return Ao(t,QT,this.renderSpatialReference,e),this.state.camera.projectToScreen(QT,qV),Xh(qV[0],qV[1])}pixelSizeAt(t){return this.ready?t?(Ao(t,QT,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(QT)):0:(K.getLogger(this).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(t){const e=this.basemapTerrain.overlayManager;return e?e.overlayPixelSizeInMapUnits(t):1}hitTest(t,e){if(!this.ready)return K.getLogger(this).error("#hitTest()","Scene view cannot be used before it is ready"),null;const r=Nse(t)?Dse(this,t):t,i=Qi(r.x,r.y),s=e?this.externalToInternalIntersectOptions(e):this._defaultHitTestOptions;s.requiresGroundFeedback=!0,s.enableDraped=!0;const n=ed(this.state.viewingMode);n.options.selectionMode=!0,n.options.store=So.ALL,this.sceneIntersectionHelper.intersectIntersectorScreen(i,n,s);const o=this._intersectResultsToHits(n.results.all,s.graphics),a=n.results.ground,l=xpe(a,this),c=l!=null&&"type"in l&&l.type==="integrated-mesh"?l:null,h={screenPoint:r,results:o,ground:{mapPoint:this._intersectResultToMapPoint(a),distance:Fp(a)?a.distanceInRenderSpace:0,layer:c}};return li.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(h.intersector=n),Promise.resolve(h)}async popupHitTest(t){const{results:e,ground:r}=await pxt(this,t);let i=null;return!(e.length===0||Math.abs((e[0].distance??0)-r.distance)<1e-5)||r.layer&&r.layer.type==="integrated-mesh"||(i=r.mapPoint),{results:e,screenPoint:t,mapPoint:i}}goTo(t,e){return this.updatingHandles.addPromise(this.stateManager.goTo(t,e))}async whenAnalysisView(t){if(t.parent==null)throw new U("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:t});switch(t.parent.type){case"line-of-sight":case"dimension":return(await this.whenLayerView(t.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(t)}}whenLayerView(t){return super.whenLayerView(t)}async takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshot(e);return UV(r,e,this._pixelFormat())}async _takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshot(e);return kV(r,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshotWithOID(e);return[kV(r[0],this._pixelFormat()),kV(r[1],this._pixelFormat())]}_completeSettings(t){const e=qwt(t,this);return e.pixelRatio/=this.state.pixelRatio,Zwt(e,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:t=>this._takeScreenshot(t),takeScreenshotWithObjectAndLayerId:t=>this._takeScreenshotWithObjectAndLayerId(t)}}async takeScreenshotWithObjectAndLayerId(t){if(!ae("enable-feature:objectAndLayerId-rendering"))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshotWithOID(e),i=UV(r[0],e,this._pixelFormat()),s=this._completeSettings(t);return s.format="png",[i,UV(r[1],s,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){if(this._stage.renderView.objectAndLayerIdRenderHelper==null)throw new Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()}addUpdatingPromise(t){return this.updatingHandles.addPromise(t)}importLayerView(t){return jse.importLayerView(t)}hasLayerViewModule(t){return jse.hasLayerViewModule(t)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){return this.map&&"initialViewProperties"in this.map&&this.map?.initialViewProperties?.spatialReference||this.defaultsFromMap?.spatialReference||this.defaultsFromMap?.ready&&this._initialDefaultSpatialReference||null}async validate(){let t=Sxt(this.type);const e=ae("safari");if(e&&e<9&&(t=new U("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:e})),t!=null)throw K.getLogger(this).warn("#validate()",t.message),t}get _predeterminedViewingMode(){const t=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties?.viewingMode:null)??null;return t!=null?Vse(t):null}getSpatialReferenceSupport({spatialReference:t,layer:e}){const r=this._predeterminedViewingMode;if(r!=null)return this._validateSpatialReferenceForViewingMode(t,e,r)?{constraints:this._makeSpatialReferenceConstraints(t,e,r)}:null;const i=this._validateSpatialReferenceForViewingMode(t,e,Ve.Local),s=this._validateSpatialReferenceForViewingMode(t,e,Ve.Global);return i||s?i&&s?{constraints:this._makeSpatialReferenceConstraints(t,e,null)}:i?{constraints:this._makeSpatialReferenceConstraints(t,e,Ve.Local)}:{constraints:this._makeSpatialReferenceConstraints(t,e,Ve.Global)}:null}_validateSpatialReferenceForViewingMode(t,e,r){return!!ZH(t,r)&&(e==null||!!kre(e)||(!aR(e)||G9(e,t,r)!=null)&&(!Ure(e)||r!==Ve.Global))}_makeSpatialReferenceConstraints(t,e,r){if(e==null)return[{spatialReference:t,viewingMode:r}];const i=t.isWebMercator,s=t.isWGS84;return kre(e)&&(i||s)?!s||r===Ve.Local||gee(e.tileInfo,e.fullExtent,t,Ve.Global)===null?[{spatialReference:t,viewingMode:r},{spatialReference:qe.WebMercator,viewingMode:r}]:[{spatialReference:i?qe.WGS84:qe.WebMercator,viewingMode:r}]:aR(e)||Ure(e)||!i&&!s?aR(e)&&i&&r!==Ve.Global?[{spatialReference:t,viewingMode:r},{spatialReference:qe.WGS84,viewingMode:Ve.Local}]:[{spatialReference:t,viewingMode:r}]:[{spatialReference:t,viewingMode:r},{spatialReference:i?qe.WGS84:qe.WebMercator,viewingMode:r}]}_validateSpatialReference(t){const e=this.getSpatialReferenceSupport({spatialReference:t})!=null,r=this._predeterminedViewingMode;return e||(r!=null?K.getLogger(this).warnOnce(`Spatial reference defined on view not supported in ${ak(r)} viewing mode.`):t.isGeographic&&K.getLogger(this).warnOnce("Spatial reference is geographic but not supported.")),e}whenReady(){return new Promise(t=>{this.ready?t(this):this._resolveWhenReady.push(t)})}computeMapPointFromVec3d(t,e){let r=this.spatialReference||qe.WGS84;return Qs(t,this.renderSpatialReference,t,r)||(r=qe.WGS84,Qs(t,this.renderSpatialReference,t,r)),e?(e.x=t[0],e.y=t[1],e.z=t[2],e.spatialReference=r):e=new tt(t,r),e}trackGraphicState(t){if(!t.graphic)return K.getLogger(this).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const e=this.getViewForGraphic(t.graphic);let r=null,i=!1;const s=n=>{!i&&n!=null&&"processor"in n&&n.processor?.type==="graphics-3d"&&n.processor.graphicsCore&&(r=n.processor.graphicsCore.trackGraphicState(t))};return e!=null?s(e):this.whenViewForGraphic(t.graphic,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{i=!0,r!=null&&(r.remove(),r=null)}}}highlight(t){if(Array.isArray(t))return cE(t.map(r=>this.highlight(r)));if(Pt.isCollection(t))return cE(t.toArray().map(r=>this.highlight(r)));const e=this.getViewForGraphic(t);return e&&"highlight"in e?e.highlight(t):nl()}maskOccludee(t){if(!t)return K.getLogger(this).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const e=this.getViewForGraphic(t);let r=null,i=!1;const s=n=>{!i&&n!=null&&gxt(n)&&(r=n.maskOccludee(t))};return e!=null?s(e):this.whenViewForGraphic(t,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{i=!0,r!=null&&(r.remove(),r=null)}}}getViewForGraphic(t){return t.layer===this.graphics?this.graphicsView:t.layer?this.allLayerViews.find(e=>e.layer===t.layer):null}graphicChanged(t){this.graphicsView!=null&&this.graphicsView.graphicChanged(t)}async whenViewForGraphic(t,e){if(t.layer===this)return await d0(()=>this.graphicsView),this.graphicsView;if(!t.layer||!this.map)throw new U("no-view-for-graphic");return e&&e.waitForLayer&&!this.map.allLayers.includes(t.layer)?new Promise((r,i)=>{const s=this.map.allLayers.on("change",n=>{n.added.includes(t.layer)&&(s.remove(),this.whenLayerView(t.layer).then(r,i))})}):this.whenLayerView(t.layer)}externalToInternalIntersectOptions(t){const e=this._externalToInternalRenderItems(t.include,WR.INCLUDE),r=this._externalToInternalRenderItems(t.exclude,WR.EXCLUDE);return{include:e.layerUids,exclude:r.layerUids,graphics:{include:e.graphicUids,exclude:r.graphicUids}}}_intersectResultToMapPoint(t,e){return t.getIntersectionPoint(QT)?(e=this.computeMapPointFromVec3d(QT,e),t.intersector===ji.TERRAIN&&this.basemapTerrain&&(e.z=Wf(this.basemapTerrain,e)??0),e):null}_intersectResultsToHits(t,e){const r=new Array;let i=null;for(let s=0;s<t.length;s++){const n=t[s],o=xpe(n,this);if(o!=null&&(o===this.map.ground||"type"in o&&o.type==="integrated-mesh"))break;const a=xW(n,this);if(a==null)continue;if(a.type==="graphic"){if(i==null&&s!==t.length-1&&(i=new Set),i!=null){const h=this._getGraphicFilterUid(a.graphic);if(i.has(h))continue;i.add(h)}if(!this._testGraphicUidFilter(e,a.graphic))continue}const l=this._intersectResultToMapPoint(n),c=n.distanceInRenderSpace;r.push({...a,mapPoint:l,distance:c})}return r}_getGraphicFilterUid(t){const e=t.sourceLayer,r=t.layer,i=e&&"objectIdField"in e?e:r&&"objectIdField"in r?r:e;if(i){const s=i.objectIdField??HBe,n=t.attributes?.[s];if(n)return`o-${i.id}-${n}`}return`u-${t.uid}`}_testGraphicUidFilter(t,e){const r=this._getGraphicFilterUid(e);return t==null||(t.include==null||t.include.has(r))&&(t.exclude==null||!t.exclude.has(r))}_externalToInternalRenderItems(t,e,r={layerUids:void 0,graphicUids:void 0}){if(!t)return r;if(t instanceof Bl)O2t(r,this._getGraphicFilterUid(t)),e===WR.INCLUDE&&(this.graphicsView!=null&&t.layer===this?rA(r,this.graphicsView.processor.layer.id):t.layer&&rA(r,t.layer.uid));else if(J7(t))for(const i of t)i===this.graphics&&this.graphicsView!=null?rA(r,this.graphicsView.processor.layer.id):i===this.map.ground?rA(r,E_):this._externalToInternalRenderItems(i,e,r);else"uid"in t&&rA(r,t.uid);return r}_initBasemapTerrain(){this._set("basemapTerrain",new l_t({view:this})),this._set("elevationProvider",new xO({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new Al({view:this})),this._set("featureTiles",new mo({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const t=()=>{const e=this.basemapTerrain?.extent;if(this.clippingArea||e)if(e&&this.basemapTerrain.spatialReference){const r=this.basemapTerrain.extent!=null&&this.basemapTerrain.spatialReference!=null?Ox(Q6(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;this.clippingArea!=null?this.featureTiles.filterExtent=this.clippingArea.intersection(r):this.featureTiles.filterExtent=r}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.addHandles([this.updatingHandles.add(()=>li.FEATURE_TILE_TREE_SHOW_TILES,e=>{e&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(he(()=>import("./FeatureTileTree3DDebugger-a19d036d.js"),["./FeatureTileTree3DDebugger-a19d036d.js","./TileTreeDebugger-55130260.js"],import.meta.url)).then(({FeatureTileTree3DDebugger:r})=>{!this._featureTreeDebugger&&li.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new r({view:this}))}):e||!this._featureTreeDebugger||li.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},Ls),this.updatingHandles.add(()=>this.clippingArea,t,Ls),this.updatingHandles.add(()=>this.basemapTerrain.extent,t,Ls)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.exit(),this.removeHandles("render-coords-helper"),this.removeHandles("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const t=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(t)||this._set("mapCoordsHelper",new qft(this.map,t));const e=this.state.isGlobal,r=BBe(e,t);r!==this.renderSpatialReference&&(this._set("renderCoordsHelper",Zft.create(this.state.viewingMode,r)),e||this.addHandles(le(()=>this.basemapTerrain?.extent,i=>{const s=this.renderCoordsHelper.spatialReference;i==null||i[0]===0&&i[1]===0&&i[2]===0&&i[3]===0||!AP(i,this.basemapTerrain.spatialReference,jpe,s)||(this.renderCoordsHelper.extent=jpe)},Wr),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(VE/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.removeHandles("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(t=null){t!=null&&t.type===ni.MOVE||(this.removeHandles("updatingMonitors"),this.allLayerViews.forEach(e=>{e.destroyed||(this.addHandles(le(()=>[e.updating,e.updatingProgress],()=>this._updatingChanged(),Wr),"updatingMonitors"),e.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(t,e){if(!this.overlay||!this.overlay.hasVisibleItems)return e;const r=t.getContext("2d");return r.putImageData(e,0,0),this.overlay.renderCanvas(t),r.getImageData(0,0,e.width,e.height)}_initStage(){const t={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(s,n)=>this._renderScreenshotOverlay(s,n)}},e=new Mft(this.state.viewingMode,s=>this._stage.layers.forAll(s),this);this._set("sceneIntersectionHelper",e);const r=f8(this.surface);this._stage=new ru({view:this,options:t,container:r}),this._stage.renderer.setParameters({slicePlane:this.slicePlane}),this.addHandles([this.updatingHandles.add(()=>this.qualitySettings.antialiasingEnabled,()=>this._stage.renderer.setParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled}),Pr),this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,s=>this._stage.renderer.setParameters({highQualityTransparency:s}),Pr),le(()=>this.magnifier,s=>this._stage.renderView.magnifier=s,Ls),this.on("pointer-move",()=>this._stage?.renderer.resetAnimation()),aP(this._stage.renderView.canvas,"webglcontextlost",s=>this.fatalError=new U("webgl-context-lost",s.statusMessage))],"stage");const i=()=>{this._stage.renderer.setParameters({defaultHighlightOptions:Vq.toEngineOptions(this.highlightOptions)})};this.addHandles(this.updatingHandles.add(()=>[this.highlightOptions.color,this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference],i),"stage"),i(),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(VE/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage=Ne(this._stage),this.removeHandles("stage"),this._set("canvas",null)}_initSurface(t){this._exitSurface(),this.state.init(t,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new kmt({view:this,viewingMode:t,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.removeHandles("graphics-view"),this._createGraphicsViewController=new AbortController;const t=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(t,t),this._updatingChanged()}async _createGraphicsViewAsync(t){const e=(await he(()=>import("./GraphicsView3D-e342aac7.js"),["./GraphicsView3D-e342aac7.js","./GraphicsProcessor-5f16deec.js","./Graphics3DObjectStates-119da5ff.js","./optimizedFeatureQueryEngineAdapter-a3b2ad14.js","./centroid-3dcadaf5.js","./PooledRBush-f65c099f.js","./quickselect-89073317.js"],import.meta.url)).default;Yt(t),await d0(()=>this.basemapTerrain?.ready,t),this._set("graphicsView",new e({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.removeHandles("graphics-view"),this.graphicsView!=null&&(this.removeHandles(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const t=Vse(this.viewingMode);if(t===Ve.Global&&(this._clippingArea=null),this._initSurface(t),this._set("ready",!0),this.addHandles(_a(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){const r=this.get("map.initialViewProperties.environment");r&&(this.environment=r)}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect();const e=this._resolveWhenReady;this._resolveWhenReady=[],e.forEach(r=>r(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.removeHandles("graphics-view"),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(E_);for(const t of this.map.allLayers.items)t.type==="integrated-mesh"&&this._defaultToMapOptions.include.add(t.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(E_);for(const t of this.map.allLayers.items)t.type==="integrated-mesh"&&t.opacity<1&&this._defaultHitTestOptions.exclude.add(t.uid)}}addVoxelLayerViewToWasm(t){return this.voxelWasm==null?(this.voxelWasmPromise==null&&(this.voxelWasmPromise=he(()=>import("./VoxelWasmPerSceneView-8d8fa3e7.js"),[],import.meta.url).then(e=>(this.voxelWasm=new e.default(this),this.voxelWasm))),this.voxelWasmPromise.then(e=>e.addVoxelLayer(t))):this.voxelWasm.addVoxelLayer(t)}removeVoxelLayerViewFromWasm(t){this.voxelWasm!=null&&this.voxelWasm.removeVoxelLayer(t)<1&&(this.voxelWasm=null,this.voxelWasmPromise=null)}};function rA(t,e){t.layerUids||(t.layerUids=new Set),t.layerUids.add(e)}function O2t(t,e){t.graphicUids||(t.graphicUids=new Set),t.graphicUids.add(e)}function tD(t,e){return t!=null&&gm(t.spatialReference,e)?Ox(t,e):null}var WR;Qe.type="3d",u([p()],Qe.prototype,"_userClippingArea",void 0),u([p()],Qe.prototype,"_resourceController",void 0),u([p()],Qe.prototype,"_stage",void 0),u([p({readOnly:!0})],Qe.prototype,"deconflictor",void 0),u([p({readOnly:!0})],Qe.prototype,"labeler",void 0),u([p(JG(PE,"analyses"))],Qe.prototype,"analyses",void 0),u([p({type:DE,readOnly:!0})],Qe.prototype,"animation",null),u([p({readOnly:!0})],Qe.prototype,"basemapTerrain",void 0),u([p({readOnly:!0})],Qe.prototype,"elevationProvider",void 0),u([p()],Qe.prototype,"camera",null),u([p({type:qh})],Qe.prototype,"contentCamera",null),u([p({readOnly:!0})],Qe.prototype,"canvas",void 0),u([p({type:tt})],Qe.prototype,"center",null),u([p({type:cr})],Qe.prototype,"clippingArea",null),u([p({type:Bb})],Qe.prototype,"constraints",void 0),u([p({type:cr,readOnly:!0})],Qe.prototype,"renderDataExtent",null),u([p({type:cr,readOnly:!0})],Qe.prototype,"dataExtent",null),u([p({type:cr,readOnly:!0})],Qe.prototype,"_groundAndLayersExtent",null),u([p({value:null,type:w2})],Qe.prototype,"environment",null),u([wr("environment")],Qe.prototype,"castEnvironment",null),u([p({readOnly:!0})],Qe.prototype,"environmentManager",void 0),u([p({type:cr})],Qe.prototype,"extent",null),u([p()],Qe.prototype,"floors",void 0),u([p()],Qe.prototype,"screenCenter",null),u([p()],Qe.prototype,"frustum",null),u([p({type:Number,readOnly:!0})],Qe.prototype,"fullOpacity",void 0),u([p({readOnly:!0})],Qe.prototype,"graphicsView",void 0),u([p({readOnly:!0})],Qe.prototype,"analysisViewManager",void 0),u([p()],Qe.prototype,"groundView",void 0),u([p({type:Boolean})],Qe.prototype,"initialExtentRequired",null),u([p()],Qe.prototype,"_defaultsFromMapSettings",null),u([p()],Qe.prototype,"interacting",null),u([p()],Qe.prototype,"stationary",null),u([p()],Qe.prototype,"navigating",null),u([p()],Qe.prototype,"map",void 0),u([p({readOnly:!0})],Qe.prototype,"mapCoordsHelper",void 0),u([p()],Qe.prototype,"padding",null),u([p({type:Al,readOnly:!0})],Qe.prototype,"pointsOfInterest",void 0),u([p({type:mo,readOnly:!0})],Qe.prototype,"featureTiles",void 0),u([p()],Qe.prototype,"_featureTreeDebugger",void 0),u([p({type:Boolean})],Qe.prototype,"screenSizePerspectiveEnabled",void 0),u([p({constructOnly:!0})],Qe.prototype,"deactivatedWebGLExtensions",void 0),u([p({constructOnly:!0})],Qe.prototype,"debugWebGLExtensions",void 0),u([p({constructOnly:!0})],Qe.prototype,"renderCanvas",void 0),u([p({constructOnly:!0})],Qe.prototype,"state",void 0),u([p({readOnly:!0})],Qe.prototype,"inputManager",void 0),u([p({readOnly:!0})],Qe.prototype,"stateManager",void 0),u([p({type:["low","medium","high"]})],Qe.prototype,"qualityProfile",null),u([p({type:due,get(){let t=this._get("qualitySettings");return t||(t=new due,jN.apply(this.qualityProfile,t)),t}})],Qe.prototype,"qualitySettings",void 0),u([p()],Qe.prototype,"slicePlane",null),u([p({readOnly:!0})],Qe.prototype,"typeSpecificPreconditionsReady",null),u([p({readOnly:!0})],Qe.prototype,"renderCoordsHelper",void 0),u([p({readOnly:!0})],Qe.prototype,"sceneIntersectionHelper",void 0),u([p({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],Qe.prototype,"resolution",null),u([p({type:Number})],Qe.prototype,"scale",null),u([p()],Qe.prototype,"heightModelInfo",null),u([p()],Qe.prototype,"spatialReference",void 0),u([p({type:Boolean,constructOnly:!0})],Qe.prototype,"alphaCompositingEnabled",void 0),u([p({constructOnly:!0})],Qe.prototype,"preserveDrawingBufferEnabled",void 0),u([p({type:Boolean})],Qe.prototype,"supersampleScreenshotsEnabled",void 0),u([p({readOnly:!0})],Qe.prototype,"type",void 0),u([p(),wr(t=>t instanceof QPe?t:Mw(KPe,t))],Qe.prototype,"ui",void 0),u([p({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.updating","toolViewManager.updating","analysisViewManager.updating","state.updating"]})],Qe.prototype,"updating",null),u([p()],Qe.prototype,"_updatingObjects",null),u([p()],Qe.prototype,"_updatingObjectsWithProgress",null),u([p({type:Number,readOnly:!0,dependsOn:["updating"]})],Qe.prototype,"updatingProgress",void 0),u([p({type:["global","local"]})],Qe.prototype,"viewingMode",null),u([p({type:Mp})],Qe.prototype,"viewpoint",null),u([p({type:Number})],Qe.prototype,"zoom",null),u([p({type:Vq})],Qe.prototype,"highlightOptions",void 0),Qe=u([P("esri.views.SceneView")],Qe),function(t){t[t.INCLUDE=0]="INCLUDE",t[t.EXCLUDE=1]="EXCLUDE"}(WR||(WR={}));const QT=O(),qV=Qi(),jpe=zt(),R2t=Qe;var CW;let LO=CW=class extends ue{constructor(t){super(t),this.minValue=0,this.maxValue=0}clone(){return new CW({minValue:this.minValue,maxValue:this.maxValue})}};u([p({type:Number,json:{write:!0}})],LO.prototype,"minValue",void 0),u([p({type:Number,json:{write:!0}})],LO.prototype,"maxValue",void 0),LO=CW=u([P("esri.renderer.support.AuthoringInfoClassBreakInfo")],LO);var AW;let b_=AW=class extends ue{constructor(t){super(t),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=[]}clone(){return new AW({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:ee(this.classBreakInfos)})}};u([p({type:String,json:{write:!0}})],b_.prototype,"field",void 0),u([p({type:String,json:{write:!0}})],b_.prototype,"normalizationField",void 0),u([p({type:String,json:{write:!0}})],b_.prototype,"label",void 0),u([p({type:[LO],json:{write:!0}})],b_.prototype,"classBreakInfos",void 0),b_=AW=u([P("esri.renderers.support.AuthoringInfoFieldInfo")],b_);var OW;const rD=new $r({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),iD=new $r({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),Hpe={key:t=>typeof t=="number"?"number":"string",typeMap:{number:Number,string:String},base:null},qpe=["high-to-low","above-and-below","centered-on","extremes"],Wpe=[...new Set(["high-to-low","above-and-below","centered-on","extremes","90-10","above","below","high-to-low","above-and-below","90-10","above","below"])],Xpe=["seconds","minutes","hours","days","months","years"];let ac=OW=class extends ue{constructor(t){super(t),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(t){return typeof t=="string"||typeof t=="number"?t:null}castStartTime(t){return typeof t=="string"||typeof t=="number"?t:null}get style(){return this.type==="color"?this._get("style"):null}set style(t){this._set("style",t)}get theme(){return this.type==="color"||this.type==="size"?this._get("theme")||"high-to-low":null}set theme(t){this._set("theme",t)}clone(){return new OW({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};u([p({types:Hpe,json:{write:!0}})],ac.prototype,"endTime",void 0),u([wr("endTime")],ac.prototype,"castEndTime",null),u([p({type:String,json:{write:!0}})],ac.prototype,"field",void 0),u([p({type:Number,json:{write:!0}})],ac.prototype,"maxSliderValue",void 0),u([p({type:Number,json:{write:!0}})],ac.prototype,"minSliderValue",void 0),u([p({types:Hpe,json:{write:!0}})],ac.prototype,"startTime",void 0),u([wr("startTime")],ac.prototype,"castStartTime",null),u([p({type:rD.apiValues,value:null,json:{type:rD.jsonValues,read:rD.read,write:rD.write}})],ac.prototype,"style",null),u([p({type:Wpe,value:null,json:{type:Wpe,origins:{"web-scene":{type:qpe,write:{writer:(t,e)=>{qpe.includes(t)&&(e.theme=t)}}}},write:!0}})],ac.prototype,"theme",null),u([p({type:iD.apiValues,json:{type:iD.jsonValues,read:iD.read,write:iD.write}})],ac.prototype,"type",void 0),u([p({type:Xpe,json:{type:Xpe,write:!0}})],ac.prototype,"units",void 0),ac=OW=u([P("esri.renderers.support.AuthoringInfoVisualVariable")],ac);const M2t=ac;let o4=class extends ue{constructor(e){super(e),this.type=null}};u([p({readOnly:!0,json:{read:!1,write:!0}})],o4.prototype,"type",void 0),o4=u([P("esri.rest.support.ColorRamp")],o4);const qee=o4;var RW;let vb=RW=class extends qee{constructor(t){super(t),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new RW({fromColor:ee(this.fromColor),toColor:ee(this.toColor),algorithm:this.algorithm})}};u([nt({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],vb.prototype,"algorithm",void 0),u([p({type:ke,json:{type:[Ki],write:!0}})],vb.prototype,"fromColor",void 0),u([p({type:ke,json:{type:[Ki],write:!0}})],vb.prototype,"toColor",void 0),u([p({type:["algorithmic"]})],vb.prototype,"type",void 0),vb=RW=u([P("esri.rest.support.AlgorithmicColorRamp")],vb);const Wee=vb;var MW;let DO=MW=class extends qee{constructor(t){super(t),this.colorRamps=null,this.type="multipart"}clone(){return new MW({colorRamps:ee(this.colorRamps)})}};u([p({type:[Wee],json:{write:!0}})],DO.prototype,"colorRamps",void 0),u([p({type:["multipart"]})],DO.prototype,"type",void 0),DO=MW=u([P("esri.rest.support.MultipartColorRamp")],DO);const eIe=DO,P2t={key:"type",base:qee,typeMap:{algorithmic:Wee,multipart:eIe}};function I2t(t){return t&&t.type?t.type==="algorithmic"?Wee.fromJSON(t):t.type==="multipart"?eIe.fromJSON(t):null:null}var PW;const M1=new $r({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),sD=new $r({pieChart:"pie-chart",classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),Ype=new $r({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),Zpe=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"],$2t=["high-to-low","above-and-below","above","below","90-10"],L2t=["flow-line","wave-front"],D2t=["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"];let Ys=PW=class extends ue{constructor(t){super(t),this.colorRamp=null,this.fadeRatio=null,this.isAutoGenerated=!1,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const t=this._get("classificationMethod"),e=this.type;return e&&e!=="relationship"?e==="class-breaks-size"||e==="class-breaks-color"?t||"manual":null:t}set classificationMethod(t){this._set("classificationMethod",t)}readColorRamp(t){return t?I2t(t):void 0}get fields(){return this.type&&this.type!=="predominance"?null:this._get("fields")}set fields(t){this._set("fields",t)}get field1(){return this.type&&this.type!=="relationship"?null:this._get("field1")}set field1(t){this._set("field1",t)}get field2(){return this.type&&this.type!=="relationship"?null:this._get("field2")}set field2(t){this._set("field2",t)}get flowTheme(){return this.type==="flow"?this._get("flowTheme"):null}set flowTheme(t){this._set("flowTheme",t)}get focus(){return this.type&&this.type!=="relationship"?null:this._get("focus")}set focus(t){this._set("focus",t)}get numClasses(){return this.type&&this.type!=="relationship"?null:this._get("numClasses")}set numClasses(t){this._set("numClasses",t)}get statistics(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("statistics"):null}set statistics(t){this._set("statistics",t)}get standardDeviationInterval(){const t=this.type;return t&&t!=="relationship"&&t!=="class-breaks-size"&&t!=="class-breaks-color"||this.classificationMethod&&this.classificationMethod!=="standard-deviation"?null:this._get("standardDeviationInterval")}set standardDeviationInterval(t){this._set("standardDeviationInterval",t)}get type(){return this._get("type")}set type(t){let e=t;t==="classed-size"?e="class-breaks-size":t==="classed-color"&&(e="class-breaks-color"),this._set("type",e)}get univariateSymbolStyle(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(t){this._set("univariateSymbolStyle",t)}get univariateTheme(){return this.type==="univariate-color-size"?this._get("univariateTheme"):null}set univariateTheme(t){this._set("univariateTheme",t)}clone(){return new PW({classificationMethod:this.classificationMethod,colorRamp:ee(this.colorRamp),fadeRatio:ee(this.fadeRatio),fields:this.fields&&this.fields.slice(0),field1:ee(this.field1),field2:ee(this.field2),isAutoGenerated:this.isAutoGenerated,focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(t=>t.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};u([p({type:M1.apiValues,value:null,json:{type:M1.jsonValues,read:M1.read,write:M1.write,origins:{"web-document":{default:"manual",type:M1.jsonValues,read:M1.read,write:M1.write}}}})],Ys.prototype,"classificationMethod",null),u([p({types:P2t,json:{write:!0}})],Ys.prototype,"colorRamp",void 0),u([Oe("colorRamp")],Ys.prototype,"readColorRamp",null),u([p({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Ys.prototype,"fadeRatio",void 0),u([p({type:[String],value:null,json:{write:!0}})],Ys.prototype,"fields",null),u([p({type:b_,value:null,json:{write:!0}})],Ys.prototype,"field1",null),u([p({type:b_,value:null,json:{write:!0}})],Ys.prototype,"field2",null),u([p({type:L2t,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Ys.prototype,"flowTheme",null),u([p({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],Ys.prototype,"focus",null),u([p({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],Ys.prototype,"isAutoGenerated",void 0),u([p({type:Number,value:null,json:{type:Ki,write:!0}})],Ys.prototype,"numClasses",null),u([p({type:Zpe,json:{type:Zpe,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],Ys.prototype,"lengthUnit",void 0),u([p({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Ys.prototype,"maxSliderValue",void 0),u([p({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Ys.prototype,"minSliderValue",void 0),u([p({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Ys.prototype,"statistics",null),u([p({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],Ys.prototype,"standardDeviationInterval",null),u([p({type:sD.apiValues,value:null,json:{type:sD.jsonValues,read:sD.read,write:sD.write,origins:{"web-scene":{type:Ype.jsonValues,write:{writer:Ype.write,overridePolicy:t=>({enabled:t!=="flow"})}}}}})],Ys.prototype,"type",null),u([p({type:[M2t],json:{write:!0}})],Ys.prototype,"visualVariables",void 0),u([p({type:D2t,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Ys.prototype,"univariateSymbolStyle",null),u([p({type:$2t,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Ys.prototype,"univariateTheme",null),Ys=PW=u([P("esri.renderers.support.AuthoringInfo")],Ys);const Xee=Ys,WV=new $r({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let NO=class extends ue{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const r=new Set;return await this.collectRequiredFields(r,e),Array.from(r).sort()}getSymbol(e,r){}async getSymbolAsync(e,r){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};u([p({type:Xee,json:{write:!0}})],NO.prototype,"authoringInfo",void 0),u([p({type:WV.apiValues,readOnly:!0,json:{type:WV.jsonValues,read:!1,write:{writer:WV.write,ignoreOrigin:!0}}})],NO.prototype,"type",void 0),NO=u([P("esri.renderers.Renderer")],NO);const G0=NO;function N2t(t){return t.match(F2t)?.[1]?.replace(/\\'/g,"'")??null}const F2t=/^hash\(\$feature\['((\\'|[^'])+)'\]\) \* 8\.381e-8$/;var IW;let KS=IW=class extends ue{constructor(){super(...arguments),this.title=null}clone(){return new IW({title:this.title})}};u([p({type:String,json:{write:!0}})],KS.prototype,"title",void 0),KS=IW=u([P("esri.renderers.support.LegendOptions")],KS);var $W;let a4=$W=class extends KS{constructor(){super(...arguments),this.showLegend=null}clone(){return new $W({title:this.title,showLegend:this.showLegend})}};u([p({type:Boolean,json:{write:!0}})],a4.prototype,"showLegend",void 0),a4=$W=u([P("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],a4);const tIe=a4,XV=new $r({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let zd=class extends ue{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return e==null?e:typeof e=="function"?(K.getLogger(this).error(".field: field must be a string value"),null):pP(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};u([p()],zd.prototype,"index",void 0),u([p({type:XV.apiValues,readOnly:!0,json:{read:XV.read,write:XV.write}})],zd.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],zd.prototype,"field",void 0),u([wr("field")],zd.prototype,"castField",null),u([p({type:String,json:{write:!0}})],zd.prototype,"valueExpression",void 0),u([p({type:String,json:{write:!0}})],zd.prototype,"valueExpressionTitle",void 0),u([p({readOnly:!0})],zd.prototype,"arcadeRequired",null),u([p({type:tIe,json:{write:!0}})],zd.prototype,"legendOptions",void 0),zd=u([P("esri.renderers.visualVariables.VisualVariable")],zd);const oI=zd;var LW;let bb=LW=class extends ue{constructor(t){super(t),this.color=null,this.label=null,this.value=null}writeValue(t,e,r){e[r]=t??0}clone(){return new LW({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};u([p({type:ke,json:{type:[Ki],write:!0}})],bb.prototype,"color",void 0),u([p({type:String,json:{write:!0}})],bb.prototype,"label",void 0),u([p({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],bb.prototype,"value",void 0),u([Be("value")],bb.prototype,"writeValue",null),bb=LW=u([P("esri.renderers.visualVariables.support.ColorStop")],bb);const U2t=bb;var DW;let wb=DW=class extends oI{constructor(t){super(t),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,r)=>e.value-r.value),this._set("stops",t)}clone(){return new DW({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(t=>t.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};u([p({readOnly:!0})],wb.prototype,"cache",null),u([p({type:["color"],json:{type:["colorInfo"]}})],wb.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],wb.prototype,"normalizationField",void 0),u([p({type:[U2t],json:{write:!0}})],wb.prototype,"stops",null),wb=DW=u([P("esri.renderers.visualVariables.ColorVariable")],wb);const rIe=wb;var NW;let r_=NW=class extends ue{constructor(t){super(t),this.label=null,this.opacity=null,this.value=null}readOpacity(t,e){return gE(e.transparency)}writeOpacity(t,e,r){e[r]=Z6(t)}clone(){return new NW({label:this.label,opacity:this.opacity,value:this.value})}};u([p({type:String,json:{write:!0}})],r_.prototype,"label",void 0),u([p({type:Number,json:{type:Ki,write:{target:"transparency"}}})],r_.prototype,"opacity",void 0),u([Oe("opacity",["transparency"])],r_.prototype,"readOpacity",null),u([Be("opacity")],r_.prototype,"writeOpacity",null),u([p({type:Number,json:{write:!0}})],r_.prototype,"value",void 0),r_=NW=u([P("esri.renderers.visualVariables.support.OpacityStop")],r_);const k2t=r_;var FW;let xb=FW=class extends oI{constructor(t){super(t),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,r)=>e.value-r.value),this._set("stops",t)}clone(){return new FW({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(t=>t.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};u([p({readOnly:!0})],xb.prototype,"cache",null),u([p({type:["opacity"],json:{type:["transparencyInfo"]}})],xb.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],xb.prototype,"normalizationField",void 0),u([p({type:[k2t],json:{write:!0}})],xb.prototype,"stops",null),xb=FW=u([P("esri.renderers.visualVariables.OpacityVariable")],xb);const Yee=xb;var UW;let Tg=UW=class extends oI{constructor(t){super(t),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(t,e,r,i){if(i&&i.messages){const s=`visualVariables[${this.index}]`;i.messages.push(new U("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:s+".valueExpressionTitle",context:i}))}}clone(){return new UW({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions&&this.legendOptions.clone()})}};u([p({readOnly:!0})],Tg.prototype,"cache",null),u([p({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],Tg.prototype,"axis",void 0),u([p({type:["rotation"],json:{type:["rotationInfo"]}})],Tg.prototype,"type",void 0),u([p({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],Tg.prototype,"rotationType",void 0),u([p({type:String,json:{write:!0}})],Tg.prototype,"valueExpressionTitle",void 0),u([Be("web-scene","valueExpressionTitle")],Tg.prototype,"writeValueExpressionTitleWebScene",null),Tg=UW=u([P("esri.renderers.visualVariables.RotationVariable")],Tg);const iIe=Tg;var kW;let B2=kW=class extends ue{constructor(t){super(t),this.label=null,this.size=null,this.value=null}clone(){return new kW({label:this.label,size:this.size,value:this.value})}};u([p({type:String,json:{write:!0}})],B2.prototype,"label",void 0),u([p({type:Number,cast:ei,json:{write:!0}})],B2.prototype,"size",void 0),u([p({type:Number,json:{write:!0}})],B2.prototype,"value",void 0),B2=kW=u([P("esri.renderers.visualVariables.support.SizeStop")],B2);const G2=B2;var zW;let l4=zW=class extends tIe{constructor(){super(...arguments),this.customValues=null}clone(){return new zW({title:this.title,showLegend:this.showLegend,customValues:this.customValues&&this.customValues.slice(0)})}};u([p({type:[Number],json:{write:!0}})],l4.prototype,"customValues",void 0),l4=zW=u([P("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],l4);const z2t=l4;var VW;const nD=new $r({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),BW=new $r({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function Jpe(t){if(t!=null)return typeof t=="string"||typeof t=="number"?ei(t):t.type==="size"?H_(t)?t:(delete(t={...t}).type,new hi(t)):void 0}function Qpe(t,e,r){if(typeof t!="object")return t;const i=new hi;return i.read(t,r),i}let hi=VW=class extends oI{constructor(t){super(t),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:this.valueExpression!=null&&UCe.test(this.valueExpression)}}set expression(t){K.getLogger(this).warn("'expression' is deprecated since version 4.2. Use 'valueExpression' instead. The only supported expression is 'view.scale'."),t==="view.scale"?(this.valueExpression="$view.scale",this._set("expression",t)):this._set("expression",null)}set index(t){H_(this.maxSize)&&(this.maxSize.index=`visualVariables[${t}].maxSize`),H_(this.minSize)&&(this.minSize.index=`visualVariables[${t}].minSize`),this._set("index",t)}get inputValueType(){return FCe(this)}set maxDataValue(t){t&&this.stops&&(K.getLogger(this).warn("cannot set maxDataValue when stops is not null."),t=null),this._set("maxDataValue",t)}set maxSize(t){t&&this.stops&&(K.getLogger(this).warn("cannot set maxSize when stops is not null."),t=null),this._set("maxSize",t)}castMaxSize(t){return Jpe(t)}readMaxSize(t,e,r){return Qpe(t,e,r)}set minDataValue(t){t&&this.stops&&(K.getLogger(this).warn("cannot set minDataValue when stops is not null."),t=null),this._set("minDataValue",t)}set minSize(t){t&&this.stops&&(K.getLogger(this).warn("cannot set minSize when stops is not null."),t=null),this._set("minSize",t)}castMinSize(t){return Jpe(t)}readMinSize(t,e,r){return Qpe(t,e,r)}get arcadeRequired(){return!!this.valueExpression||this.minSize!=null&&typeof this.minSize=="object"&&this.minSize.arcadeRequired||this.maxSize!=null&&typeof this.maxSize=="object"&&this.maxSize.arcadeRequired}set stops(t){this.minDataValue==null&&this.maxDataValue==null&&this.minSize==null&&this.maxSize==null?t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,r)=>e.value-r.value):t&&(K.getLogger(this).warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),t=null),this._set("stops",t)}get transformationType(){return Qst(this,this.inputValueType)}readValueExpression(t,e){return t||e.expression&&"$view.scale"}writeValueExpressionWebScene(t,e,r,i){if(t==="$view.scale"){if(i&&i.messages){const s=this.index,n=typeof s=="string"?s:`visualVariables[${s}]`;i.messages.push(new U("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:n+".valueExpression",context:i}))}}else e[r]=t}readValueUnit(t){return t?BW.read(t):null}clone(){return new VW({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:H_(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:H_(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(t=>t.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone()})}flipSizes(){if(this.transformationType===_o.ClampedLinear){const{minSize:t,maxSize:e}=this;return this.minSize=e,this.maxSize=t,this}if(this.transformationType===_o.Stops){const t=this.stops;if(!t)return this;const e=t.map(i=>i.size).reverse(),r=t.length;for(let i=0;i<r;i++)t[i].size=e[i];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};u([p({readOnly:!0})],hi.prototype,"cache",null),u([p({type:nD.apiValues,json:{type:nD.jsonValues,origins:{"web-map":{read:!1}},read:nD.read,write:nD.write}})],hi.prototype,"axis",void 0),u([p({type:String,value:null,json:{read:!1}})],hi.prototype,"expression",null),u([p()],hi.prototype,"index",null),u([p({type:String,readOnly:!0})],hi.prototype,"inputValueType",null),u([p({type:z2t,json:{write:!0}})],hi.prototype,"legendOptions",void 0),u([p({type:Number,value:null,json:{write:!0}})],hi.prototype,"maxDataValue",null),u([p({type:Number,value:null,json:{write:!0}})],hi.prototype,"maxSize",null),u([wr("maxSize")],hi.prototype,"castMaxSize",null),u([Oe("maxSize")],hi.prototype,"readMaxSize",null),u([p({type:Number,value:null,json:{write:!0}})],hi.prototype,"minDataValue",null),u([p({type:Number,value:null,json:{write:!0}})],hi.prototype,"minSize",null),u([wr("minSize")],hi.prototype,"castMinSize",null),u([Oe("minSize")],hi.prototype,"readMinSize",null),u([p({type:String,json:{write:!0}})],hi.prototype,"normalizationField",void 0),u([p({readOnly:!0})],hi.prototype,"arcadeRequired",null),u([p({type:String})],hi.prototype,"scaleBy",void 0),u([p({type:[G2],value:null,json:{write:!0}})],hi.prototype,"stops",null),u([p({type:["outline"],json:{write:!0}})],hi.prototype,"target",void 0),u([p({type:String,readOnly:!0})],hi.prototype,"transformationType",null),u([p({type:["size"],json:{type:["sizeInfo"]}})],hi.prototype,"type",void 0),u([p({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],hi.prototype,"useSymbolValue",void 0),u([p({type:String,json:{write:!0}})],hi.prototype,"valueExpression",void 0),u([Oe("valueExpression",["valueExpression","expression"])],hi.prototype,"readValueExpression",null),u([Be("web-scene","valueExpression")],hi.prototype,"writeValueExpressionWebScene",null),u([p({type:["radius","diameter","area","width","distance"],json:{write:!0}})],hi.prototype,"valueRepresentation",void 0),u([p({type:BW.apiValues,json:{write:BW.write,origins:{"web-map":{read:!1},"web-scene":{write:!0},"portal-item":{write:!0}}}})],hi.prototype,"valueUnit",void 0),u([Oe("valueUnit")],hi.prototype,"readValueUnit",null),hi=VW=u([P("esri.renderers.visualVariables.SizeVariable")],hi);const eU=hi,V2t={color:rIe,size:eU,opacity:Yee,rotation:iIe},B2t=new $r({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),G2t=/^\[([^\]]+)\]$/i;let c4=class extends Te{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),(e=e&&e.filter(r=>!!r))&&e.length){for(const r of e)switch(r.type){case"color":this.colorVariables.push(r);break;case"opacity":this.opacityVariables.push(r);break;case"rotation":this.rotationVariables.push(r);break;case"size":this.sizeVariables.push(r)}this.sizeVariables.length&&this.sizeVariables.some(r=>!!r.target)&&e.sort((r,i)=>{let s=null;return s=r.target===i.target?0:r.target?1:-1,s});for(let r=0;r<e.length;r++)e[r].index=r;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,r,i){const{rotationExpression:s,rotationType:n}=r,o=s&&s.match(G2t),a=o&&o[1];if(a&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:n,field:a})),e)return e.map(l=>{const c=B2t.read(l.type),h=V2t[c];h||(K.getLogger(this).warn(`Unknown variable type: ${c}`),i&&i.messages&&i.messages.push(new jh("visual-variable:unsupported",`visualVariable of type '${c}' is not supported`,{definition:l,context:i})));const d=new h;return d.read(l,i),d})}writeVariables(e,r){const i=[];for(const s of e){const n=s.toJSON(r);n&&i.push(n)}return i}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};u([p()],c4.prototype,"visualVariables",null),c4=u([P("esri.renderers.visualVariables.VisualVariableFactory")],c4);const j2t=c4,H2t={base:oI,key:"type",typeMap:{opacity:Yee,color:rIe,rotation:iIe,size:eU}},jC=t=>{let e=class extends t{constructor(){super(...arguments),this._vvFactory=new j2t}set visualVariables(r){this._vvFactory.visualVariables=r,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(r,i,s){return this._vvFactory.readVariables(r,i,s)}writeVisualVariables(r,i,s,n){i[s]=this._vvFactory.writeVariables(r,n)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const r of this.visualVariables)if(r.arcadeRequired)return!0;return!1}hasVisualVariables(r,i){return r?this.getVisualVariablesForType(r,i).length>0:this.getVisualVariablesForType("size",i).length>0||this.getVisualVariablesForType("color",i).length>0||this.getVisualVariablesForType("opacity",i).length>0||this.getVisualVariablesForType("rotation",i).length>0}getVisualVariablesForType(r,i){const s=this.visualVariables;return s?s.filter(n=>n.type===r&&(typeof i=="string"?n.target===i:i!==!1||!n.target)):[]}async collectVVRequiredFields(r,i){let s=[];this.visualVariables&&(s=s.concat(this.visualVariables));for(const n of s)n&&(n.field&&Eu(r,i,n.field),n.normalizationField&&Eu(r,i,n.normalizationField),n.valueExpression&&(q2t(n.valueExpression,r,i)||await Vl(r,i,n.valueExpression)))}};return u([p({types:[H2t],value:null,json:{write:!0}})],e.prototype,"visualVariables",null),u([Oe("visualVariables",["visualVariables","rotationType","rotationExpression"])],e.prototype,"readVisualVariables",null),u([Be("visualVariables")],e.prototype,"writeVisualVariables",null),e=u([P("esri.renderers.mixins.VisualVariablesMixin")],e),e};function q2t(t,e,r){const i=N2t(t);return i!=null&&(Eu(e,r,i),!0)}const HC={types:b1e,json:{write:{writer:MF},origins:{"web-scene":{types:Iie,write:{writer:MF},read:{reader:yC({types:Iie})}}}}},sIe={types:{base:Vc,key:"type",typeMap:{"simple-fill":mw.typeMap["simple-fill"],"picture-fill":mw.typeMap["picture-fill"],"polygon-3d":mw.typeMap["polygon-3d"]}},json:{write:{writer:MF},origins:{"web-scene":{type:EP,write:{writer:MF}}}}},u4={cast:t=>t==null||typeof t=="string"||typeof t=="number"?t:`${t}`,json:{type:String,write:{writer:(t,e)=>{e.value=t?.toString()}}}};var GW;let i_=GW=class extends ue{constructor(t){super(t),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new GW({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const t=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${t}`}};u([p({type:String,json:{write:!0}})],i_.prototype,"description",void 0),u([p({type:String,json:{write:!0}})],i_.prototype,"label",void 0),u([p({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],i_.prototype,"minValue",void 0),u([p({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],i_.prototype,"maxValue",void 0),u([p(HC)],i_.prototype,"symbol",void 0),i_=GW=u([P("esri.renderers.support.ClassBreakInfo")],i_);const n6=i_;var jW;const nIe="log",h4="percent-of-total",d4="field",oD=new $r({esriNormalizeByLog:nIe,esriNormalizeByPercentOfTotal:h4,esriNormalizeByField:d4}),W2t=ws(n6);let qn=jW=class extends jC(G0){constructor(t){super(t),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(t,e,r){if(!Array.isArray(t))return;let i=e.minValue;return t.map(s=>{const n=new n6;return n.read(s,r),n.minValue==null&&(n.minValue=i),n.maxValue==null&&(n.maxValue=n.minValue),i=n.maxValue,n})}writeClassBreakInfos(t,e,r,i){const s=t.map(n=>n.write({},i));this._areClassBreaksConsecutive()&&s.forEach(n=>delete n.classMinValue),e[r]=s}castField(t){return t==null?t:typeof t=="function"?(K.getLogger(this).error(".field: field must be a string value"),null):pP(t)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let t=this._get("normalizationType");const e=!!this.normalizationField,r=this.normalizationTotal!=null;return e||r?(t=e&&d4||r&&h4||null,e&&r&&K.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):t!==d4&&t!==h4||(t=null),t}set normalizationType(t){this._set("normalizationType",t)}addClassBreakInfo(t,e,r){let i=null;i=typeof t=="number"?new n6({minValue:t,maxValue:e,symbol:w1e(r)}):W2t(ee(t)),this.classBreakInfos.push(i),this.classBreakInfos.length===1&&this.notifyChange("minValue")}removeClassBreakInfo(t,e){const r=this.classBreakInfos.length;for(let i=0;i<r;i++){const s=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(s[0]===t&&s[1]===e){this.classBreakInfos.splice(i,1);break}}}getBreakIndex(t,e){return!this.valueExpression||e!=null&&e.arcade!=null||K.getLogger(this).warn(""),this.valueExpression?this._getBreakIndexForExpression(t,e):this._getBreakIndexForField(t)}async getClassBreakInfo(t,e){let r=e;!this.valueExpression||e!=null&&e.arcade!=null||(r={...r,arcade:await cv()});const i=this.getBreakIndex(t,r);return i!==-1?this.classBreakInfos[i]:null}getSymbol(t,e){if(this.valueExpression&&(e==null||e.arcade==null))return void K.getLogger(this).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const r=this.getBreakIndex(t,e);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}async getSymbolAsync(t,e){let r=e;if(this.valueExpression&&(e==null||e.arcade==null)){const s=await cv(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),r={...r,arcade:s}}const i=this.getBreakIndex(t,r);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}getSymbols(){const t=[];return this.classBreakInfos.forEach(e=>{e.symbol&&t.push(e.symbol)}),this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),r=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${t}.${e}.${this.classBreakInfos.reduce((i,s)=>i+s.getMeshHash(),"")}.${r}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new jW({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol&&this.backgroundFillSymbol.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:ee(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:ee(this.visualVariables),legendOptions:ee(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}async collectRequiredFields(t,e){const r=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(r)}async collectSymbolFields(t,e){const r=[...this.getSymbols().map(i=>i.collectRequiredFields(t,e)),Vl(t,e,this.valueExpression)];Eu(t,e,this.field),Eu(t,e,this.normalizationField),await Promise.all(r)}_getBreakIndexForExpression(t,e){const{viewingMode:r,scale:i,spatialReference:s,arcade:n}=e??{},{valueExpression:o}=this;let a=this._compiledValueExpression.valueExpression===o?this._compiledValueExpression.compiledFunction:null;const l=n.arcadeUtils;if(!a){const h=l.createSyntaxTree(o);a=l.createFunction(h),this._compiledValueExpression.compiledFunction=a}this._compiledValueExpression.valueExpression=o;const c=l.executeFunction(a,l.createExecContext(t,l.getViewInfo({viewingMode:r,scale:i,spatialReference:s})));return this._getBreakIndexfromInfos(c)}_getBreakIndexForField(t){const e=this.field,r=t.attributes,i=this.normalizationType;let s=parseFloat(r[e]);if(i){const n=this.normalizationTotal,o=parseFloat(this.normalizationField?r[this.normalizationField]:void 0);if(i===nIe)s=Math.log(s)*Math.LOG10E;else if(i!==h4||n==null||isNaN(n)){if(i===d4&&!isNaN(o)){if(isNaN(s)||isNaN(o))return-1;s/=o}}else s=s/n*100}return this._getBreakIndexfromInfos(s)}_getBreakIndexfromInfos(t){const e=this.isMaxInclusive;if(t!=null&&typeof t=="number"&&!isNaN(t))for(let r=0;r<this.classBreakInfos.length;r++){const i=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(i[0]<=t&&(e?t<=i[1]:t<i[1]))return r}return-1}_areClassBreaksConsecutive(){const t=this.classBreakInfos,e=t.length;for(let r=1;r<e;r++)if(t[r-1].maxValue!==t[r].minValue)return!1;return!0}};u([p(sIe)],qn.prototype,"backgroundFillSymbol",void 0),u([p({type:[n6]})],qn.prototype,"classBreakInfos",void 0),u([Oe("classBreakInfos")],qn.prototype,"readClassBreakInfos",null),u([Be("classBreakInfos")],qn.prototype,"writeClassBreakInfos",null),u([p({type:String,json:{write:!0}})],qn.prototype,"defaultLabel",void 0),u([p(HC)],qn.prototype,"defaultSymbol",void 0),u([p({type:String,json:{write:!0}})],qn.prototype,"field",void 0),u([wr("field")],qn.prototype,"castField",null),u([p({type:Boolean})],qn.prototype,"isMaxInclusive",void 0),u([p({type:KS,json:{write:!0}})],qn.prototype,"legendOptions",void 0),u([p({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return this.classBreakInfos.length!==0&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],qn.prototype,"minValue",null),u([p({type:String,json:{write:!0}})],qn.prototype,"normalizationField",void 0),u([p({type:Number,cast:t=>Eh(t),json:{write:!0}})],qn.prototype,"normalizationTotal",void 0),u([p({type:oD.apiValues,value:null,json:{type:oD.jsonValues,read:oD.read,write:oD.write}})],qn.prototype,"normalizationType",null),u([nt({classBreaks:"class-breaks"})],qn.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],qn.prototype,"valueExpression",void 0),u([p({type:String,json:{write:!0}})],qn.prototype,"valueExpressionTitle",void 0),qn=jW=u([P("esri.renderers.ClassBreaksRenderer")],qn);const Zee=qn;function X2t(t){return t.type==="date"||t.type==="esriFieldTypeDate"||t.type==="date-only"||t.type==="esriFieldTypeDateOnly"||t.type==="timestamp-offset"||t.type==="esriFieldTypeTimestampOffset"}function Kpe(t){return t.type==="oid"||t.type==="esriFieldTypeOID"}function efe(t){return t.type==="global-id"||t.type==="esriFieldTypeGlobalID"}let Jee=class{constructor(e=[]){if(this.fields=[],this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this.dateFields=[],this.numericFields=[],this._requiredFields=null,!e)return;this.fields=e;const r=[];for(const i of e){const s=i?.name,n=rfe(i?.name);if(s&&n){const o=tfe(s);this._fieldsMap.set(s,i),this._fieldsMap.set(o,i),this._normalizedFieldsMap.set(n,i),r.push(o),X2t(i)?(this.dateFields.push(i),this._dateFieldsSet.add(i)):zZ(i)&&(this._numericFieldsSet.add(i),this.numericFields.push(i)),Kpe(i)||efe(i)||(i.editable=i.editable==null||!!i.editable,i.nullable=i.nullable==null||!!i.nullable)}}r.sort(),this.uid=r.join(",")}destroy(){this._fieldsMap.clear()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)Kpe(e)||efe(e)||e.nullable||w9e(e)!==void 0||this._requiredFields.push(e)}return this._requiredFields}has(e){return this.get(e)!=null}get(e){if(!e)return;let r=this._fieldsMap.get(e);return r||(r=this._fieldsMap.get(tfe(e))??this._normalizedFieldsMap.get(rfe(e)),r&&this._fieldsMap.set(e,r),r)}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){const r=this.get(e);if(r)return r.name??void 0}};function tfe(t){return t.trim().toLowerCase()}function rfe(t){return i9e(t)?.toLowerCase()??""}const ife="esri.renderers.support.DictionaryLoader",Y2t={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};let Qee=class{constructor(e,r,i){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new gAe(100),this._dictionaryVersion=null,this._fieldIndex=null,this._dictionaryPromise=null,this.url=e,this.config=r,this.fieldMap=i}getSymbolFields(){return this._symbolFields}async getSymbolAsync(e,r){let i;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(r));try{i=await this._dictionaryPromise}catch(g){if(ds(g))return this._dictionaryPromise=null,null}const s=this._dictionaryVersion&&this._dictionaryVersion.since(4,0),n={};if(this.fieldMap)for(const g of this._symbolFields){const _=this._getFieldName(this.fieldMap[g]);n[g]=_?s?e.attributes[_]:""+e.attributes[_]:""}let o=null;try{o=i?.(n,r)}catch{return null}if(!o||typeof o!="string")return null;const a=OY(o).toString(),l=this._symbolCache.get(a);if(l)return l.catch(()=>{this._symbolCache.pop(a)}),l;const c=o.split(";"),h=[],d=[];for(const g of c)if(g)if(g.includes("po:")){const _=g.substr(3).split("|");if(_.length===3){const v=_[0],b=_[1];let T=_[2];if(b==="DashTemplate")T=T.split(" ").map(x=>Number(x));else if(b==="Color"){const x=new ke(T).toRgba();T=[x[0],x[1],x[2],255*x[3]]}else T=Number(T);d.push({primitiveName:v,propertyName:b,value:T})}}else if(g.includes("|")){for(const _ of g.split("|"))if(this._itemNames.has(_)){h.push(_);break}}else this._itemNames.has(g)&&h.push(g);const f=e.geometry==null||!e.geometry.hasZ&&e.geometry.type==="point",m=this._cimPartsToCIMSymbol(h,d,f,r);return this._symbolCache.put(a,m,1),m}async fetchResources(e){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void K.getLogger(ife).error("no valid URL!");const r=ur(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:e!=null?e.signal:null}),[{data:i}]=await Promise.all([r,cv()]);if(!i)throw this._dictionaryPromise=null,new U("esri.renderers.DictionaryRenderer","Bad dictionary data!");const{authoringInfo:s,dictionary_version:n,expression:o,itemsNames:a}=i,l=o;let c=!1;n&&(this._dictionaryVersion=nx.parse(n),c=this._dictionaryVersion.since(4,0)),this._refSymbolUrlTemplate=this.url+"/"+i.cimRefTemplateUrl,this._itemNames=new Set(a),this._symbolFields=s.symbol;const h={};if(this.config){const m=this.config;for(const g in m)h[g]=m[g]}if(s.configuration)for(const m of s.configuration)h.hasOwnProperty(m.name)||(h[m.name]=m.value);const d=[];if(e!=null&&e.fields&&this.fieldMap)for(const m of this._symbolFields){const g=this.fieldMap[m],_=e.fields.filter(v=>v.name.toLowerCase()===g?.toLowerCase());_.length>0&&d.push({..._[0],type:c?_[0].type:"esriFieldTypeString"})}d.length>0&&(this._fieldIndex=new Jee(d));const f=e9e(l,e!=null?e.spatialReference:null,d,h).then(m=>{const g={scale:0};return(_,v)=>{if(m==null)return null;const b=m.repurposeFeature({geometry:null,attributes:_});return g.scale=v!=null?v.scale??void 0:void 0,m.evaluate({$feature:b,$view:g},m.services)}}).catch(m=>(K.getLogger(ife).error("Creating dictinoary expression failed:",m),null));return this._dictionaryPromise=f,f}async _cimPartsToCIMSymbol(e,r,i,s){const n=new Array(e.length);for(let l=0;l<e.length;l++)n[l]=this._getSymbolPart(e[l],s);const o=await Promise.all(n),a=this.fieldMap;if(a)for(const l of o)oIe(l,a);return new CC({data:this._combineSymbolParts(o,r,i)})}async _getSymbolPart(e,r){if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then(n=>n.data);const i=this._refSymbolUrlTemplate.replaceAll(/\{itemName\}/gi,e),s=ur(i,{responseType:"json",query:{f:"json"},...r});this._ongoingRequests.set(e,s);try{return(await s).data}catch(n){throw this._ongoingRequests.delete(e),n}}_combineSymbolParts(e,r,i){if(!e||e.length===0)return null;const s={...e[0]};if(e.length>1){s.symbolLayers=[];for(const n of e){const o=n;s.symbolLayers.unshift(...o.symbolLayers)}}return i&&(s.callout=Y2t),{type:"CIMSymbolReference",symbol:s,primitiveOverrides:r}}_getFieldName(e){if(this._fieldIndex!==null){const r=this._fieldIndex.get(e);return r?r.name:e}return e}};function oIe(t,e){if(!t)return;const r=t.symbolLayers;if(!r)return;let i=r.length;for(;i--;){const s=r[i];s&&s.enable!==!1&&s.type==="CIMVectorMarker"&&Z2t(s,e)}}function Z2t(t,e){const r=t.markerGraphics;if(r)for(const i of r){if(!i)continue;const s=i.symbol;if(s)switch(s.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":oIe(s,e);break;case"CIMTextSymbol":s.fieldMap=e}}}const yYt=Object.freeze(Object.defineProperty({__proto__:null,DictionaryLoader:Qee},Symbol.toStringTag,{value:"Module"}));var HW;let Vd=HW=class extends jC(G0){constructor(t){super(t),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new Qee(this.url,this.config,this.fieldMap)}writeData(t,e){t&&(e.scalingExpressionInfo={expression:t,returnType:"number"})}writeVisualVariables(t,e,r,i){i?.origin||super.writeVisualVariables(t,e,r,i)}clone(){return new HW({config:ee(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:ee(this.fieldMap),url:ee(this.url),visualVariables:ee(this.visualVariables)})}async getSymbolAsync(t,e){return this._loader.getSymbolAsync(t,e)}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e),this.scaleExpression&&await Vl(t,e,this.scaleExpression);for(const r in this.fieldMap){const i=this.fieldMap[r];e.has(i)&&t.add(i)}}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};u([p({type:Qee})],Vd.prototype,"_loader",null),u([p({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],Vd.prototype,"config",void 0),u([p({type:Object,json:{write:!0}})],Vd.prototype,"fieldMap",void 0),u([p({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],Vd.prototype,"scaleExpression",void 0),u([Be("scaleExpression")],Vd.prototype,"writeData",null),u([p({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(t){return{enabled:!!t&&!!this.scaleExpression}}}}})],Vd.prototype,"scaleExpressionTitle",void 0),u([p({type:String,json:{write:!0}})],Vd.prototype,"url",void 0),u([Be("visualVariables")],Vd.prototype,"writeVisualVariables",null),Vd=HW=u([P("esri.renderers.DictionaryRenderer")],Vd);const J2t=Vd;var qW;let Sg=qW=class extends ue{constructor(t){super(t),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(t){return t==null?t:typeof t=="function"?(K.getLogger(this).error(".field: field must be a string value"),null):pP(t)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new qW({color:this.color&&this.color.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([p({type:ke,json:{type:[Number],write:!0}})],Sg.prototype,"color",void 0),u([p({type:String,json:{write:!0}})],Sg.prototype,"field",void 0),u([wr("field")],Sg.prototype,"castField",null),u([p({type:String,json:{write:!0}})],Sg.prototype,"label",void 0),u([p({type:String,json:{write:!0}})],Sg.prototype,"valueExpression",void 0),u([p({type:String,json:{write:!0}})],Sg.prototype,"valueExpressionTitle",void 0),Sg=qW=u([P("esri.renderers.support.AttributeColorInfo")],Sg);const aIe=Sg;var WW;let p4=WW=class extends ue{constructor(){super(...arguments),this.unit=null}clone(){return new WW({unit:this.unit})}};u([p({type:String,json:{write:!0}})],p4.prototype,"unit",void 0),p4=WW=u([P("esri.renderers.support.DotDensityLegendOptions")],p4);const Q2t=p4;var XW;let lc=XW=class extends jC(G0){constructor(t){super(t),this.attributes=null,this.backgroundColor=new ke([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new zu,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(t){if(this.referenceScale==null)return this.dotValue;const e=t/this.referenceScale*this.dotValue;return e<1?1:e}getSymbol(){return new Iv({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){return this.attributes?.reduce((t,e)=>t+e.getAttributeHash(),"")??""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new XW({attributes:ee(this.attributes),backgroundColor:ee(this.backgroundColor),dotBlendingEnabled:ee(this.dotBlendingEnabled),dotShape:ee(this.dotShape),dotSize:ee(this.dotSize),dotValue:ee(this.dotValue),legendOptions:ee(this.legendOptions),outline:ee(this.outline),referenceScale:ee(this.referenceScale),visualVariables:ee(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}getControllerHash(){return`${this.attributes?.map(e=>e.field||e.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e);for(const r of this.attributes??[])r.valueExpression&&await Vl(t,e,r.valueExpression),r.field&&t.add(r.field)}};u([p({type:[aIe],json:{write:!0}})],lc.prototype,"attributes",void 0),u([p({type:ke,json:{write:!0}})],lc.prototype,"backgroundColor",void 0),u([p({type:Boolean,json:{write:!0}})],lc.prototype,"dotBlendingEnabled",void 0),u([p({type:String,json:{write:!1}})],lc.prototype,"dotShape",void 0),u([p({type:Number,json:{write:!0}})],lc.prototype,"dotSize",void 0),u([p({type:Q2t,json:{write:!0}})],lc.prototype,"legendOptions",void 0),u([p({type:zu,json:{default:null,write:!0}})],lc.prototype,"outline",void 0),u([p({type:Number,json:{write:!0}})],lc.prototype,"dotValue",void 0),u([p({type:Number,json:{write:!0}})],lc.prototype,"referenceScale",void 0),u([p({type:Number,json:{write:!0}})],lc.prototype,"seed",void 0),u([nt({dotDensity:"dot-density"})],lc.prototype,"type",void 0),lc=XW=u([P("esri.renderers.DotDensityRenderer")],lc);const K2t=lc;var YW;let FO=YW=class extends ue{constructor(t){super(t),this.color=null,this.ratio=null}clone(){return new YW({color:this.color,ratio:this.ratio})}};u([p({type:ke,json:{type:[Ki],default:null,write:!0}})],FO.prototype,"color",void 0),u([p({type:Number,json:{write:!0}})],FO.prototype,"ratio",void 0),FO=YW=u([P("esri.renderers.support.HeatmapColorStop")],FO);const f4=FO;let j2=class extends Hi(ue){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};u([p({type:String,json:{write:!0}})],j2.prototype,"minLabel",void 0),u([p({type:String,json:{write:!0}})],j2.prototype,"maxLabel",void 0),u([p({type:String,json:{write:!0}})],j2.prototype,"title",void 0),j2=u([P("esri.renderers.support.HeatmapLegendOptions")],j2);const Kee=2.4;function eSt(t){return Wh(t*Kee)}function tSt(t){return wo(t)/Kee}function rSt(t,e,r,i){let{color:s,ratio:n}=e,{color:o,ratio:a}=r;a===n&&(a===1?n-=1e-6:a+=1e-6);const l=ve((i-n)/(a-n),0,1);Y6(t,s.toArray(),o.toArray(),l)}function vYt(t){const r=new Uint8ClampedArray(2048);if(t=t.filter(({ratio:a})=>a>=0&&a<=1).sort((a,l)=>a.ratio-l.ratio).map(({color:a,ratio:l})=>({color:a,ratio:Math.max(l,.001)})),t.length<1)return r;let i=t[0],s=t[0],n=1;const o=Wt();for(let a=0;a<512;a++){const l=(a+.5)/512;for(;l>s.ratio&&n<t.length;)i=s,s=t[n++];rSt(o,i,s,l),r.set(o,4*a)}return r}function bYt(t,e,r,i){const{radius:s,fieldOffset:n,field:o}=e,a=Math.round(wo(s)),l=new Float64Array(r*i);let c,h=Number.NEGATIVE_INFINITY;const d=sSt(o,n),f=new Set;for(const m of t){const g=m.getCursor();for(;g.next();){const _=g.getObjectId();if(f.has(_))continue;f.add(_);const v=g.readLegacyPointGeometry(),b=128;if(v.x<-b||v.x>=r+b||v.y<-b||v.y>i+b)continue;const T=+d(g),x=Math.max(0,Math.round(v.x)-a),S=Math.max(0,Math.round(v.y)-a),E=Math.min(i,Math.round(v.y)+a),A=Math.min(r,Math.round(v.x)+a);for(let R=S;R<E;R++)for(let M=x;M<A;M++){const D=R*r+M,k=iSt(v.x-M,v.y-R,a);c=l[D]+=k*T,c>h&&(h=c)}}}return{matrix:l.buffer,max:h}}function iSt(t,e,r){const i=Math.sqrt(t**2+e**2)/r;return i>1?0:3/(Math.PI*r**2)*(1-i**2)**2}function wYt(t,e){return typeof t=="function"?t:t?typeof e=="string"?r=>-1*+r[t]:r=>+r[t]+e:()=>1}function sSt(t,e){return t!=null?typeof e=="string"?r=>-1*+r.readAttribute(t):r=>+r.readAttribute(t)+e:r=>1}var ZW;const lIe="esri.renderers.HeatmapRenderer",nSt=K.getLogger(lIe);function sfe(t){if(t!=null){const{maxDensity:e,minDensity:r,radius:i}=t;if(e!=null||r!=null||i!=null){const{blurRadius:s,maxPixelIntensity:n,minPixelIntensity:o,...a}=t;return a}}return t}let fo=ZW=class extends G0{constructor(t){super(t),this.authoringInfo=null,this.colorStops=[new f4({ratio:0,color:new ke("rgba(255, 140, 0, 0)")}),new f4({ratio:.75,color:new ke("rgba(255, 140, 0, 1)")}),new f4({ratio:.9,color:new ke("rgba(255, 0,   0, 1)")})],this.field=null,this.fieldOffset=0,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null,this._warnedProps={blurRadius:!1,maxPixelIntensity:!1,minPixelIntensity:!1}}normalizeCtorArgs(t){return sfe(t)}get blurRadius(){return tSt(this.radius)}set blurRadius(t){const e=this.maxPixelIntensity,r=this.minPixelIntensity;this._set("radius",eSt(t)),this._warnAboutDeprecatedGaussianBlurProp("blurRadius","radius"),this._set("maxDensity",e*this._pixelIntensityToDensity),this._set("minDensity",r*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(t){this._set("maxDensity",t*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("maxPixelIntensity","maxDensity")}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(t){this._set("minDensity",t*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("minPixelIntensity","minDensity")}get _pixelIntensityToDensity(){return 24/(Kee**2*this.blurRadius**4)}_warnAboutDeprecatedGaussianBlurProp(t,e){this._warnedProps[t]||ba(this).getDefaultOrigin()==="user"&&(this._warnedProps[t]=!0,gC(()=>{cp(nSt,t,{replacement:`${String(e)} (suggested value: ${this._get(e)})`,version:"4.24"})}))}read(t,e){t=sfe(t),super.read(t,e)}getSymbol(){return new $v}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}async collectRequiredFields(t,e){const r=this.field,i=this.valueExpression;r&&typeof r=="string"&&await Eu(t,e,r),i&&typeof i=="string"&&await Vl(t,e,i)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new ZW({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:ee(this.colorStops),field:this.field,legendOptions:ee(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([p({type:Xee,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],fo.prototype,"authoringInfo",void 0),u([p({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],fo.prototype,"blurRadius",null),u([p({type:[f4],json:{write:!0}})],fo.prototype,"colorStops",void 0),u([p({type:String,json:{write:!0}})],fo.prototype,"field",void 0),u([p({type:Number,json:{write:{overridePolicy:(t,e,r)=>({enabled:r==null})},origins:{"web-scene":{write:!1}}}})],fo.prototype,"fieldOffset",void 0),u([p({type:j2,json:{write:!0}})],fo.prototype,"legendOptions",void 0),u([p({type:Number,json:{write:!0}})],fo.prototype,"maxDensity",void 0),u([p({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],fo.prototype,"maxPixelIntensity",null),u([p({type:Number,json:{write:!0}})],fo.prototype,"minDensity",void 0),u([p({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],fo.prototype,"minPixelIntensity",null),u([p({type:Number,cast:ei,json:{write:!0}})],fo.prototype,"radius",void 0),u([p({type:Number,range:{min:0},json:{default:0,write:!0}})],fo.prototype,"referenceScale",void 0),u([nt({heatmap:"heatmap"})],fo.prototype,"type",void 0),u([p({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],fo.prototype,"valueExpression",void 0),u([p({type:String})],fo.prototype,"valueExpressionTitle",void 0),u([p({readOnly:!0})],fo.prototype,"_pixelIntensityToDensity",null),fo=ZW=u([P(lIe)],fo);const cIe=fo;let Zb=class extends Hi(ue){constructor(){super(...arguments),this.color=new ke([0,0,0,0]),this.label=null,this.threshold=0}};u([p({type:ke,json:{write:!0}})],Zb.prototype,"color",void 0),u([p({type:String,json:{write:!0}})],Zb.prototype,"label",void 0),u([p({type:Number,range:{min:0,max:1},json:{write:!0}})],Zb.prototype,"threshold",void 0),Zb=u([P("esri.renderers.support.OthersCategory")],Zb);let m4=class extends Hi(ue){constructor(){super(...arguments),this.title=null}};u([p({type:String,json:{write:!0}})],m4.prototype,"title",void 0),m4=u([P("esri.renderers.support.PieChartLegendOptions")],m4);let iu=class extends jC(Hi(G0)){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new ke([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new Zb,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart"}getSymbol(){return new $v({size:this.size?this.size/2+(this.outline?.width||0):0})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter(Qf)}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,r)=>e+r.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,r)=>e+JSON.stringify(r),"")}async collectRequiredFields(e,r){await this.collectVVRequiredFields(e,r);for(const i of this.attributes)i.valueExpression&&await Vl(e,r,i.valueExpression),i.field&&e.add(i.field)}};u([p({type:[aIe],json:{write:!0}})],iu.prototype,"attributes",void 0),u([p({type:Iv,json:{default:null,write:!0}})],iu.prototype,"backgroundFillSymbol",void 0),u([p({type:ke,json:{write:!0}})],iu.prototype,"defaultColor",void 0),u([p({type:String,json:{write:!0}})],iu.prototype,"defaultLabel",void 0),u([p({type:Number,range:{min:0,max:1},json:{write:!0}})],iu.prototype,"holePercentage",void 0),u([p({type:Zb,json:{write:!0}})],iu.prototype,"othersCategory",void 0),u([p({type:m4,json:{write:!0}})],iu.prototype,"legendOptions",void 0),u([p({type:zu,json:{default:null,write:!0}})],iu.prototype,"outline",void 0),u([p({type:Number,cast:ei,json:{write:!0}})],iu.prototype,"size",void 0),u([nt({pieChart:"pie-chart"})],iu.prototype,"type",void 0),iu=u([P("esri.renderers.PieChartRenderer")],iu);const oSt=iu;var JW;let Tb=JW=class extends jC(G0){constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(t,e){await Promise.all([this.collectSymbolFields(t,e),this.collectVVRequiredFields(t,e)])}async collectSymbolFields(t,e){await Promise.all(this.getSymbols().map(r=>r.collectRequiredFields(t,e)))}getSymbol(t,e){return this.symbol}async getSymbolAsync(t,e){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((t,e)=>t+JSON.stringify(e),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new JW({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:ee(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}};u([p({type:String,json:{write:!0}})],Tb.prototype,"description",void 0),u([p({type:String,json:{write:!0}})],Tb.prototype,"label",void 0),u([p(HC)],Tb.prototype,"symbol",void 0),u([nt({simple:"simple"})],Tb.prototype,"type",void 0),Tb=JW=u([P("esri.renderers.SimpleRenderer")],Tb);const aI=Tb,aSt=["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"];function QW(t){return t instanceof Te}function nfe(t){return t instanceof Pt?Object.keys(t.items):QW(t)?ba(t).keys():t?Object.keys(t):[]}function aD(t,e){return t instanceof Pt?t.items[e]:t[e]}function lSt(t,e){return!(!Array.isArray(t)||!Array.isArray(e))&&t.length!==e.length}function XR(t){return t?t.declaredClass:null}function uIe(t,e){const r=t.diff;if(r&&typeof r=="function")return r(t,e);const i=nfe(t),s=nfe(e);if(i.length===0&&s.length===0)return;if(!i.length||!s.length||lSt(t,e))return{type:"complete",oldValue:t,newValue:e};const n=s.filter(d=>!i.includes(d)),o=i.filter(d=>!s.includes(d)),a=i.filter(d=>s.includes(d)&&aD(t,d)!==aD(e,d)).concat(n,o).sort(),l=XR(t);if(l&&aSt.includes(l)&&a.length)return{type:"complete",oldValue:t,newValue:e};let c;const h=QW(t)&&QW(e);for(const d of a){const f=aD(t,d),m=aD(e,d);let g;if((h||typeof f!="function"&&typeof m!="function")&&f!==m&&(f!=null||m!=null)){if(r&&r[d]&&typeof r[d]=="function")g=r[d]?.(f,m);else if(f instanceof Date&&m instanceof Date){if(f.getTime()===m.getTime())continue;g={type:"complete",oldValue:f,newValue:m}}else g=typeof f=="object"&&typeof m=="object"&&XR(f)===XR(m)?uIe(f,m):{type:"complete",oldValue:f,newValue:m};g!=null&&(c!=null?c.diff[d]=g:c={type:"partial",diff:{[d]:g}})}}return c}function cSt(t,e){if(t==null)return!1;const r=e.split(".");let i=t;for(const s of r){if(i.type==="complete")return!0;if(i.type!=="partial")return!1;{const n=i.diff[s];if(!n)return!1;i=n}}return!0}function EYt(t,e){for(const r of e)if(cSt(t,r))return!0;return!1}function uSt(t,e){if(typeof t!="function"&&typeof e!="function"&&(t!=null||e!=null))return t==null||e==null||typeof t=="object"&&typeof e=="object"&&XR(t)!==XR(e)?{type:"complete",oldValue:t,newValue:e}:uIe(t,e)}function lD(t){if(t==null)return!0;switch(t.type){case"complete":return!1;case"collection":{const e=t;for(const r of e.added)if(!lD(r))return!1;for(const r of e.removed)if(!lD(r))return!1;for(const r of e.changed)if(!lD(r))return!1;return!0}case"partial":for(const e in t.diff)if(!lD(t.diff[e]))return!1;return!0}}let H2=class extends Hi(ue){constructor(e){super(e),this.value=null,this.value2=null,this.value3=null}};u([p(u4)],H2.prototype,"value",void 0),u([p(u4)],H2.prototype,"value2",void 0),u([p(u4)],H2.prototype,"value3",void 0),H2=u([P("esri.renderers.support.UniqueValue")],H2);const eE=H2;let s_=class extends Hi(ue){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.values=null}castValues(e){if(e==null)return null;const r=typeof(e=Array.isArray(e)?e:[e])[0];return r==="string"||r==="number"?e.map(i=>new eE({value:i})):r==="object"?e[0]instanceof eE?e:e.map(i=>new eE(i)):null}};u([p({type:String,json:{write:!0}})],s_.prototype,"description",void 0),u([p({type:String,json:{write:!0}})],s_.prototype,"label",void 0),u([p(HC)],s_.prototype,"symbol",void 0),u([p({type:[eE],json:{type:[[String]],read:{reader:t=>t?t.map(e=>new eE({value:e[0],value2:e[1],value3:e[2]})):null},write:{writer:(t,e)=>{const r=[];for(const i of t){const s=[i.value,i.value2,i.value3].filter(Qf).map(n=>n.toString());r.push(s)}e.values=r}}}})],s_.prototype,"values",void 0),u([wr("values")],s_.prototype,"castValues",null),s_=u([P("esri.renderers.support.UniqueValueClass")],s_);const hIe=s_;let UO=class extends Hi(ue){constructor(e){super(e),this.heading=null,this.classes=null}};u([p({type:String,json:{write:!0}})],UO.prototype,"heading",void 0),u([p({type:[hIe],json:{write:!0}})],UO.prototype,"classes",void 0),UO=u([P("esri.renderers.support.UniqueValueGroup")],UO);const KW=UO;var eX;let Sb=eX=class extends ue{constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new eX({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const t=JSON.stringify(this.symbol&&this.symbol.toJSON());return`${this.value}.${t}`}};u([p({type:String,json:{write:!0}})],Sb.prototype,"description",void 0),u([p({type:String,json:{write:!0}})],Sb.prototype,"label",void 0),u([p(HC)],Sb.prototype,"symbol",void 0),u([p(u4)],Sb.prototype,"value",void 0),Sb=eX=u([P("esri.renderers.support.UniqueValueInfo")],Sb);const YR=Sb;var kO;const dIe="esri.renderers.UniqueValueRenderer",My=K.getLogger(dIe),ofe="uvInfos-watcher",afe="uvGroups-watcher",hSt=",",dSt=ws(YR);function pSt(t){const{field1:e,field2:r,field3:i,fieldDelimiter:s,uniqueValueInfos:n,valueExpression:o}=t,a=!(!e||!r);return[{classes:(n??[]).map(l=>{const{symbol:c,label:h,value:d,description:f}=l,[m,g,_]=a?d?.toString()?.split(s||"")||[]:[d],v=[];return(e||o)&&v.push(m),r&&v.push(g),i&&v.push(_),{symbol:c,label:h,values:[v],description:f}})}]}let Rs=kO=class extends jC(G0){constructor(t){super(t),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this._isInfosSource=null,this.type="unique-value",this.backgroundFillSymbol=null,this.orderByClassesEnabled=!1,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(e,r){if(!e&&!r)return;if(!e||!r)return{type:"complete",oldValue:e,newValue:r};let i=!1;const s={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let n=0;n<r.length;n++){const o=e.find(a=>a.value===r[n].value);o?uSt(o,r[n])?(s.changed.push({type:"complete",oldValue:o,newValue:r[n]}),i=!0):s.unchanged.push({oldValue:o,newValue:r[n]}):(s.added.push(r[n]),i=!0)}for(let n=0;n<e.length;n++)r.find(o=>o.value===e[n].value)||(s.removed.push(e[n]),i=!0);return i?s:void 0}},this._set("uniqueValueInfos",[]),this._set("uniqueValueGroups",[])}get _cache(){return{compiledFunc:null}}set field(t){this._set("field",t),this._updateFieldDelimiter(),this._updateUniqueValues()}castField(t){return t==null||typeof t=="function"?t:pP(t)}writeField(t,e,r,i){typeof t=="string"?e[r]=t:i&&i.messages?i.messages.push(new U("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):My.error(".field: cannot write field to JSON since it's not a string value")}set field2(t){this._set("field2",t),this._updateFieldDelimiter(),this._updateUniqueValues()}set field3(t){this._set("field3",t),this._updateUniqueValues()}set valueExpression(t){this._set("valueExpression",t),this._updateUniqueValues()}set defaultSymbol(t){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",t)}set fieldDelimiter(t){this._set("fieldDelimiter",t),this._updateUniqueValues()}readPortal(t,e,r){return r.portal||en.getDefault()}readStyleOrigin(t,e,r){if(e.styleName)return Object.freeze({styleName:e.styleName});if(e.styleUrl){const i=_0(e.styleUrl,r);return Object.freeze({styleUrl:i})}}writeStyleOrigin(t,e,r,i){t.styleName?e.styleName=t.styleName:t.styleUrl&&(e.styleUrl=v0(t.styleUrl,i))}set uniqueValueGroups(t){this.styleOrigin?My.error("#uniqueValueGroups=","Cannot modify unique value groups of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueGroups",t),this._updateInfosFromGroups(),this._isInfosSource=!1,this._watchUniqueValueGroups())}set uniqueValueInfos(t){this.styleOrigin?My.error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos())}addUniqueValueInfo(t,e){if(this.styleOrigin)return void My.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let r;r=typeof t=="object"?dSt(t):new YR({value:t,symbol:w1e(e)}),this.uniqueValueInfos?.push(r),this._valueInfoMap[r.value]=r,this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}removeUniqueValueInfo(t){if(this.styleOrigin)return void My.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");const e=this.uniqueValueInfos;if(e){for(let r=0;r<e.length;r++)if(e[r].value===t+""){delete this._valueInfoMap[t],e.splice(r,1);break}}this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}async getUniqueValueInfo(t,e){let r=e;return!this.valueExpression||e!=null&&e.arcade!=null||(r={...r,arcade:await cv()}),this._getUniqueValueInfo(t,r)}getSymbol(t,e){if(this.valueExpression&&(e==null||e.arcade==null))return void My.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const r=this._getUniqueValueInfo(t,e);return r&&r.symbol||this.defaultSymbol}async getSymbolAsync(t,e){let r=e;if(this.valueExpression&&(r==null||r.arcade==null)){const s=await cv(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),r={...r,arcade:s}}const i=this._getUniqueValueInfo(t,r);return i&&i.symbol||this.defaultSymbol}getSymbols(){const t=[];for(const e of this.uniqueValueInfos??[])e.symbol&&t.push(e.symbol);return this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),r=this.uniqueValueInfos?.reduce((i,s)=>i+s.getMeshHash(),"");return`${t}.${e}.${r}.${`${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}`}.${this.valueExpression}`}clone(){const t=new kO({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:ee(this.defaultSymbol),orderByClassesEnabled:this.orderByClassesEnabled,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:ee(this.visualVariables),legendOptions:ee(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),backgroundFillSymbol:ee(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(t._isDefaultSymbolDerived=!0),t._set("portal",this.portal);const e=ee(this.uniqueValueInfos),r=ee(this.uniqueValueGroups);return this.styleOrigin&&(t._set("styleOrigin",Object.freeze(ee(this.styleOrigin))),Object.freeze(e),Object.freeze(r)),t._set("uniqueValueInfos",e),t._updateValueInfoMap(),t._set("uniqueValueGroups",r),t._isInfosSource=this._isInfosSource,t._watchUniqueValueInfosAndGroups(),t}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(t,e){const r=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(r)}async collectSymbolFields(t,e){const r=[...this.getSymbols().map(i=>i.collectRequiredFields(t,e)),Vl(t,e,this.valueExpression)];Eu(t,e,this.field),Eu(t,e,this.field2),Eu(t,e,this.field3),await Promise.all(r)}populateFromStyle(){return iee(this.styleOrigin,{portal:this.portal}).then(t=>{const e=[];return this._valueInfoMap={},t&&t.data&&Array.isArray(t.data.items)&&t.data.items.forEach(r=>{const i=new Cx({styleUrl:t.styleUrl,styleName:t.styleName,portal:this.portal,name:r.name});this.defaultSymbol||r.name!==t.data.defaultItem||(this.defaultSymbol=i,this._isDefaultSymbolDerived=!0);const s=new YR({value:r.name,symbol:i});e.push(s),this._valueInfoMap[r.name]=s}),this._set("uniqueValueInfos",Object.freeze(e)),this._updateGroupsFromInfos(!0),this._isInfosSource=null,this._watchUniqueValueInfos(),!this.defaultSymbol&&this.uniqueValueInfos?.length&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateFieldDelimiter(){this.field&&this.field2&&!this.fieldDelimiter&&this._set("fieldDelimiter",hSt)}_updateUniqueValues(){this._isInfosSource!=null&&(this._isInfosSource?this._updateGroupsFromInfos():this._updateInfosFromGroups())}_updateValueInfoMap(){this._valueInfoMap={};const{uniqueValueInfos:t}=this;if(t)for(const e of t)this._valueInfoMap[e.value+""]=e}_watchUniqueValueInfosAndGroups(){this._watchUniqueValueInfos(),this._watchUniqueValueGroups()}_watchUniqueValueInfos(){this.removeHandles(ofe);const{uniqueValueInfos:t}=this;if(t){const e=[];for(const r of t)e.push(le(()=>({symbol:r.symbol,value:r.value,label:r.label,description:r.description}),(i,s)=>{i!==s&&(this._updateGroupsFromInfos(),this._isInfosSource=!0)},{sync:!0}));this.addHandles(e,ofe)}}_watchUniqueValueGroups(){this.removeHandles(afe);const{uniqueValueGroups:t}=this;if(t){const e=[];for(const r of t){e.push(le(()=>({classes:r.classes}),(i,s)=>{i!==s&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}));for(const i of r.classes??[])e.push(le(()=>({symbol:i.symbol,values:i.values,label:i.label,description:i.description}),(s,n)=>{s!==n&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}))}this.addHandles(e,afe)}}_updateInfosFromGroups(){if(!this.uniqueValueGroups)return this._set("uniqueValueInfos",null),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const t=[],{field:e,field2:r,field3:i,fieldDelimiter:s,uniqueValueGroups:n,valueExpression:o}=this;if(!e&&!o)return this._set("uniqueValueInfos",t),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const a=!(!e||!r);for(const l of n)for(const c of l.classes??[]){const{symbol:h,label:d,values:f,description:m}=c;for(const g of f??[]){const{value:_,value2:v,value3:b}=g,T=[_];r&&T.push(v),i&&T.push(b);const x=a?T.join(s||""):T[0];t.push(new YR({symbol:h,label:d,value:x,description:m}))}}this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._watchUniqueValueInfos()}_updateGroupsFromInfos(t=!1){if(!this.uniqueValueInfos)return this._set("uniqueValueGroups",null),void this._watchUniqueValueGroups();const{field:e,field2:r,valueExpression:i,fieldDelimiter:s,uniqueValueInfos:n}=this;if(!e&&!i||!n.length)return this._set("uniqueValueGroups",[]),void this._watchUniqueValueGroups();const o=!(!e||!r),a=n.map(c=>{const{symbol:h,label:d,value:f,description:m}=c,[g,_,v]=o?f?.toString()?.split(s||"")||[]:[f];return new hIe({symbol:h,label:d,description:m,values:[new eE({value:g,value2:_,value3:v})]})}),l=[new KW({classes:a})];t&&Object.freeze(l),this._set("uniqueValueGroups",l),this._watchUniqueValueGroups()}_getUniqueValueInfo(t,e){return this.valueExpression?this._getUnqiueValueInfoForExpression(t,e):this._getUnqiueValueInfoForFields(t)}_getUnqiueValueInfoForExpression(t,e){const{viewingMode:r,scale:i,spatialReference:s,arcade:n}=e??{};let o=this._cache.compiledFunc;const a=n.arcadeUtils;if(!o){const c=a.createSyntaxTree(this.valueExpression);o=a.createFunction(c),this._cache.compiledFunc=o}const l=a.executeFunction(o,a.createExecContext(t,a.getViewInfo({viewingMode:r,scale:i,spatialReference:s})));return this._valueInfoMap[l+""]}_getUnqiueValueInfoForFields(t){const e=this.field,r=t.attributes;let i;if(typeof e!="function"&&this.field2){const s=this.field2,n=this.field3,o=[];e&&o.push(r[e]),s&&o.push(r[s]),n&&o.push(r[n]),i=o.join(this.fieldDelimiter||"")}else typeof e=="function"?i=e(t):e&&(i=r[e]);return this._valueInfoMap[i+""]}static fromPortalStyle(t,e){const r=new kO(e&&e.properties);r._set("styleOrigin",Object.freeze({styleName:t})),r._set("portal",e&&e.portal||en.getDefault());const i=r.populateFromStyle();return i.catch(s=>{My.error(`#fromPortalStyle('${t}'[, ...])`,"Failed to create unique value renderer from style name",s)}),i}static fromStyleUrl(t,e){const r=new kO(e&&e.properties);r._set("styleOrigin",Object.freeze({styleUrl:t}));const i=r.populateFromStyle();return i.catch(s=>{My.error(`#fromStyleUrl('${t}'[, ...])`,"Failed to create unique value renderer from style URL",s)}),i}};u([p({readOnly:!0})],Rs.prototype,"_cache",null),u([nt({uniqueValue:"unique-value"})],Rs.prototype,"type",void 0),u([p(sIe)],Rs.prototype,"backgroundFillSymbol",void 0),u([p({value:null,json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],Rs.prototype,"field",null),u([wr("field")],Rs.prototype,"castField",null),u([Be("field")],Rs.prototype,"writeField",null),u([p({type:String,value:null,json:{write:!0}})],Rs.prototype,"field2",null),u([p({type:String,value:null,json:{write:!0}})],Rs.prototype,"field3",null),u([p({type:Boolean,json:{name:"drawInClassOrder",default:!1,write:!0,origins:{"web-scene":{write:!1}}}})],Rs.prototype,"orderByClassesEnabled",void 0),u([p({type:String,value:null,json:{write:!0}})],Rs.prototype,"valueExpression",null),u([p({type:String,json:{write:!0}})],Rs.prototype,"valueExpressionTitle",void 0),u([p({type:KS,json:{write:!0}})],Rs.prototype,"legendOptions",void 0),u([p({type:String,json:{write:!0}})],Rs.prototype,"defaultLabel",void 0),u([p(Oge({...HC},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],Rs.prototype,"defaultSymbol",null),u([p({type:String,value:null,json:{write:!0}})],Rs.prototype,"fieldDelimiter",null),u([p({type:en,readOnly:!0})],Rs.prototype,"portal",void 0),u([Oe("portal",["styleName"])],Rs.prototype,"readPortal",null),u([p({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],Rs.prototype,"styleOrigin",void 0),u([Oe("styleOrigin",["styleName","styleUrl"])],Rs.prototype,"readStyleOrigin",null),u([Be("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],Rs.prototype,"writeStyleOrigin",null),u([p({type:[KW],json:{read:{source:["uniqueValueGroups","uniqueValueInfos"],reader:(t,e,r)=>(e.uniqueValueGroups||pSt(e)).map(i=>KW.fromJSON(i,r))},write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],Rs.prototype,"uniqueValueGroups",null),u([p({type:[YR],json:{read:!1,write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],Rs.prototype,"uniqueValueInfos",null),Rs=kO=u([P(dIe)],Rs);const tU=Rs,rU={key:"type",base:G0,typeMap:{heatmap:cIe,simple:aI,"unique-value":tU,"class-breaks":Zee,"dot-density":K2t,dictionary:J2t,"pie-chart":oSt},errorContext:"renderer"},pIe={key:"type",base:G0,typeMap:{simple:aI,"unique-value":tU,"class-breaks":Zee,heatmap:cIe},errorContext:"renderer"};function RYt(t,e){return eP(t,null,e)}const fSt=yC({types:rU});function eP(t,e,r){return t?t&&(t.styleName||t.styleUrl)&&t.type!=="uniqueValue"?(r&&r.messages&&r.messages.push(new jh("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+t.type+"'",{definition:t,context:r})),null):fSt(t,e,r):null}let mSt=class fIe{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(K7),this._values=new Map,this.multipleOriginsSupported=!0}clone(e){const r=new fIe,i=this._originStores[mr.DEFAULTS];i&&i.forEach((s,n)=>{r.set(n,ee(s),mr.DEFAULTS)});for(let s=mr.SERVICE;s<K7;s++){const n=this._originStores[s];n&&n.forEach((o,a)=>{e&&e.has(a)||r.set(a,ee(o),s)})}return r}get(e,r){const i=r===void 0?this._values:this._originStores[r];return i?i.get(e):void 0}keys(e){const r=e==null?this._values:this._originStores[e];return r?[...r.keys()]:[]}set(e,r,i=mr.USER){let s=this._originStores[i];if(s||(s=new Map,this._originStores[i]=s),s.set(e,r),!this._values.has(e)||this._propertyOriginMap.get(e)<=i){const n=this._values.get(e);return this._values.set(e,r),this._propertyOriginMap.set(e,i),n!==r}return!1}delete(e,r=mr.USER){const i=this._originStores[r];if(!i)return;const s=i.get(e);if(i.delete(e),this._values.has(e)&&this._propertyOriginMap.get(e)===r){this._values.delete(e);for(let n=r-1;n>=0;n--){const o=this._originStores[n];if(o&&o.has(e)){this._values.set(e,o.get(e)),this._propertyOriginMap.set(e,n);break}}}return s}has(e,r){const i=r===void 0?this._values:this._originStores[r];return!!i&&i.has(e)}revert(e,r){for(;r>0&&!this.has(e,r);)--r;const i=this._originStores[r],s=i&&i.get(e),n=this._values.get(e);return this._values.set(e,s),this._propertyOriginMap.set(e,r),n!==s}originOf(e){return this._propertyOriginMap.get(e)||mr.DEFAULTS}forEach(e){this._values.forEach(e)}};const mIe=t=>{let e=class extends t{constructor(...r){super(...r);const i=ba(this),s=i.store,n=new mSt;i.store=n,E0e(i,s,n)}read(r,i){A0e(this,r,i)}getAtOrigin(r,i){const s=YV(this),n=jg(i);if(typeof r=="string")return s.get(r,n);const o={};return r.forEach(a=>{o[a]=s.get(a,n)}),o}originOf(r){return j4(this.originIdOf(r))}originIdOf(r){return YV(this).originOf(r)}revert(r,i){const s=YV(this),n=jg(i),o=ba(this);let a;a=typeof r=="string"?r==="*"?s.keys(n):[r]:r,a.forEach(l=>{o.invalidate(l),s.revert(l,n),o.commit(l)})}};return e=u([P("esri.core.ReadOnlyMultiOriginJSONSupport")],e),e};function YV(t){return ba(t).store}let lfe=class extends mIe(Te){};lfe=u([P("esri.core.ReadOnlyMultiOriginJSONSupport")],lfe);const gSt=t=>{let e=class extends t{constructor(...r){super(...r)}clear(r,i="user"){return ZV(this).delete(r,jg(i))}write(r,i){return R0e(this,r=r||{},i),r}setAtOrigin(r,i,s){ba(this).setAtOrigin(r,i,jg(s))}removeOrigin(r){const i=ZV(this),s=jg(r),n=i.keys(s);for(const o of n)i.originOf(o)===s&&i.set(o,i.get(o,s),mr.USER)}updateOrigin(r,i){const s=ZV(this),n=jg(i),o=this.get(r);for(let a=n+1;a<K7;++a)s.delete(r,a);s.set(r,o,n)}toJSON(r){return this.write({},r)}};return e=u([P("esri.core.WriteableMultiOriginJSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function ZV(t){return ba(t).store}const ete=t=>{let e=class extends gSt(mIe(t)){constructor(...r){super(...r)}};return e=u([P("esri.core.MultiOriginJSONSupport")],e),e};let cfe=class extends ete(Te){};cfe=u([P("esri.core.MultiOriginJSONSupport")],cfe);function ySt(t){return"portalItem"in t}const gIe=t=>{let e=class extends t{get apiKey(){return this._isOverridden("apiKey")?this._get("apiKey"):ySt(this)?this.portalItem?.apiKey:null}set apiKey(r){r!=null?this._override("apiKey",r):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return u([p({type:String})],e.prototype,"apiKey",null),e=u([P("esri.layers.mixins.APIKeyMixin")],e),e},yIe=t=>{let e=class extends t{get title(){if(this._get("title")&&this.originOf("title")!=="defaults")return this._get("title");if(this.url){const r=Ix(this.url);if(r!=null&&r.title)return r.title}return this._get("title")||""}set title(r){this._set("title",r)}set url(r){this._set("url",yHe(r,K.getLogger(this)))}};return u([p()],e.prototype,"title",null),u([p({type:String})],e.prototype,"url",null),e=u([P("esri.layers.mixins.ArcGISService")],e),e},_Ie=new Ts.EventEmitter;function IYt(t,e,r=!1){const i=Eo();return r=e==null||r,_Ie.emit("apply-edits",{serviceUrl:t,layerId:e,mayReceiveServiceEdits:r,result:i.promise}),i}const vIe="esri.layers.mixins.EditBusLayer",bIe=Symbol(vIe);function $Yt(t){return t!=null&&typeof t=="object"&&bIe in t}const wIe=t=>{var e;let r=class extends t{constructor(...i){super(...i),this[e]=!0,this.when().then(()=>{this.own([_Ie.on("apply-edits",s=>{const{serviceUrl:n,layerId:o,mayReceiveServiceEdits:a,result:l}=s,c=n===this.url,h=o!=null&&this.layerId!=null&&o===this.layerId;if(!c||!h&&!a)return;const d=l.then(f=>{if(h&&(f.addedFeatures.length||f.updatedFeatures.length||f.deletedFeatures.length||f.addedAttachments.length||f.updatedAttachments.length||f.deletedAttachments.length))return this.emit("edits",ee(f)),f;const m=f.editedFeatures?.find(({layerId:g})=>g===this.layerId);if(m){const{adds:g,updates:_,deletes:v}=m.editedFeatures,b={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:g?g.map(({attributes:T})=>({objectId:this.objectIdField&&T[this.objectIdField],globalId:this.globalIdField&&T[this.globalIdField]})):[],deletedFeatures:v?v.map(({attributes:T})=>({objectId:this.objectIdField&&T[this.objectIdField],globalId:this.globalIdField&&T[this.globalIdField]})):[],updatedFeatures:_?_.map(({current:{attributes:T}})=>({objectId:this.objectIdField&&T[this.objectIdField],globalId:this.globalIdField&&T[this.globalIdField]})):[],editedFeatures:ee(f.editedFeatures),exceededTransferLimit:!1};return this.emit("edits",b),b}return{edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:ee(f.editedFeatures),exceededTransferLimit:!1}});this.emit("apply-edits",{result:d})})])},()=>{})}};return e=bIe,r=u([P(vIe)],r),r},ufe={ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CSV:!0,GeoRSS:!0,GeoJSON:!0,GroupLayer:!0,KML:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},hfe={ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0},dfe={ArcGISFeatureLayer:!0},_St={"web-scene/operational-layers":{ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,GroupLayer:!0,IntegratedMeshLayer:!0,OGCFeatureLayer:!0,PointCloudLayer:!0,WebTiledLayer:!0,CSV:!0,GeoJSON:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,KML:!0,RasterDataLayer:!0,Voxel:!0,LineOfSightLayer:!0},"web-scene/basemap":{ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,WebTiledLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,ArcGISImageServiceLayer:!0,WMS:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-map/operational-layers":ufe,"web-map/basemap":hfe,"web-map/tables":dfe,"link-chart/operational-layers":{...ufe,LinkChartLayer:!0},"link-chart/basemap":hfe,"link-chart/tables":dfe,"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISSceneServiceLayer:!0,PointCloudLayer:!0,BuildingSceneLayer:!0,IntegratedMeshLayer:!0,OrientedImageryLayer:!0}};function vSt(t){if(!t)return t;const{start:e,end:r}=t;return new Im({start:e!=null?_w(e,-e.getTimezoneOffset(),"minutes"):e,end:r!=null?_w(r,-r.getTimezoneOffset(),"minutes"):r})}function bSt(t){if(!t)return t;const{start:e,end:r}=t;return new Im({start:e!=null?_w(e,e.getTimezoneOffset(),"minutes"):e,end:r!=null?_w(r,r.getTimezoneOffset(),"minutes"):r})}var tX;let zO=tX=class extends ue{constructor(t){super(t)}async collectRequiredFields(t,e){return Vl(t,e,this.expression)}clone(){return new tX({expression:this.expression,title:this.title})}equals(t){return this.expression===t.expression&&this.title===t.title}};u([p({type:String,json:{write:!0}})],zO.prototype,"expression",void 0),u([p({type:String,json:{write:!0}})],zO.prototype,"title",void 0),zO=tX=u([P("esri.layers.support.FeatureExpressionInfo")],zO);const pfe=zO;var rX;const cD=ll()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),ffe=new $r({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let Eg=rX=class extends ue{constructor(t){super(t),this.offset=null}readFeatureExpressionInfo(t,e){return t??(e.featureExpression&&e.featureExpression.value===0?{expression:"0"}:void 0)}writeFeatureExpressionInfo(t,e,r,i){e[r]=t.write({},i),t.expression==="0"&&(e.featureExpression={value:0})}get mode(){const{offset:t,featureExpressionInfo:e}=this;return this._isOverridden("mode")?this._get("mode"):t!=null||e?"relative-to-ground":"on-the-ground"}set mode(t){this._override("mode",t)}set unit(t){this._set("unit",t)}write(t,e){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(t,e):null}clone(){return new rX({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(t){return this.mode===t.mode&&this.offset===t.offset&&this.unit===t.unit&&xDe(this.featureExpressionInfo,t.featureExpressionInfo)}};u([p({type:pfe,json:{write:!0}})],Eg.prototype,"featureExpressionInfo",void 0),u([Oe("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],Eg.prototype,"readFeatureExpressionInfo",null),u([Be("featureExpressionInfo",{featureExpressionInfo:{type:pfe},"featureExpression.value":{type:[0]}})],Eg.prototype,"writeFeatureExpressionInfo",null),u([p({type:cD.apiValues,nonNullable:!0,json:{type:cD.jsonValues,read:cD.read,write:{writer:cD.write,isRequired:!0}}})],Eg.prototype,"mode",null),u([p({type:Number,json:{write:!0}})],Eg.prototype,"offset",void 0),u([p({type:kit,json:{type:String,read:ffe.read,write:ffe.write}})],Eg.prototype,"unit",null),Eg=rX=u([P("esri.layers.support.ElevationInfo")],Eg);const wSt=Eg,xIe={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:!0}},iU={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(t,e)=>!e.disablePopup},write:{enabled:!0,writer(t,e,r){e[r]=!t}}}},sU={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:!0}},TIe={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:uv}}},SIe={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},EIe={value:null,type:wSt,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function LYt(t){return{type:t,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const CIe={write:!0,read:!0},iX={type:Number,json:{origins:{"web-document":CIe,"portal-item":{write:!0}}}},xSt={...iX,json:{...iX.json,origins:{"web-document":{...CIe,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(t,e,r)=>r&&r.origin!=="service"||!e.drawingInfo||e.drawingInfo.transparency===void 0?e.layerDefinition&&e.layerDefinition.drawingInfo&&e.layerDefinition.drawingInfo.transparency!==void 0?gE(e.layerDefinition.drawingInfo.transparency):void 0:gE(e.drawingInfo.transparency)}}},DYt={type:Im,readOnly:!0,get(){if(!this.layer?.timeInfo)return null;const{datesInUnknownTimezone:t,timeOffset:e,useViewTime:r}=this.layer,i=this.view?.timeExtent;let s=this.layer.timeExtent;t&&(s=bSt(s));let n=r?i&&s?i.intersection(s):i||s:s;if(!n||n.isEmpty||n.isAllTime)return n;e&&(n=n.offset(-e.value,e.unit)),t&&(n=vSt(n));const o=this._get("timeExtent");return n.equals(o)?o:n}},NYt={type:cr,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(t,e)=>{const r=cr.fromJSON(t);return e.spatialReference!=null&&typeof e.spatialReference=="object"&&(r.spatialReference=qe.fromJSON(e.spatialReference)),r}}}},read:!1}},AIe={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},TSt={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}},SSt={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}},OIe={json:{write:{ignoreOrigin:!0},origins:{"web-map":{read:!1,write:!1}}}},RIe=t=>{let e=class extends t{constructor(){super(...arguments),this.title=null}writeListMode(r,i,s,n){(n&&n.layerContainerType==="ground"||r&&$4e(this,s,{},n))&&(i[s]=r)}writeOperationalLayerType(r,i,s,n){!r||n&&n.layerContainerType==="tables"||(i.layerType=r)}writeTitle(r,i){i.title=r??"Layer"}read(r,i){i&&(i.layer=this),M4e(this,r,s=>super.read(r,s),i)}write(r,i){if(i?.origin){const o=`${i.origin}/${i.layerContainerType||"operational-layers"}`;let l=!!_St[o]?.[this.operationalLayerType];if(this.operationalLayerType==="ArcGISTiledElevationServiceLayer"&&o==="web-scene/operational-layers"&&(l=!1),this.operationalLayerType==="ArcGISDimensionLayer"&&o==="web-map/operational-layers"&&(l=!1),!l)return i.messages?.push(new U("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${o}'`,{layer:this})),null}const s=super.write(r,{...i,layer:this}),n=!!i&&!!i.messages&&!!i.messages.filter(o=>o instanceof U&&o.name==="web-document-write:property-required").length;return sv(s?.url)?(i?.messages?.push(new U("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&n?null:s}beforeSave(){}};return u([p({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],e.prototype,"id",void 0),u([p(OIe)],e.prototype,"listMode",void 0),u([Be("listMode")],e.prototype,"writeListMode",null),u([p({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1}}}})],e.prototype,"operationalLayerType",void 0),u([Be("operationalLayerType")],e.prototype,"writeOperationalLayerType",null),u([p(iX)],e.prototype,"opacity",void 0),u([p({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],e.prototype,"title",void 0),u([Be("title"),Be(["web-scene"],"title")],e.prototype,"writeTitle",null),u([p({type:Boolean,json:{name:"visibility"}})],e.prototype,"visible",void 0),e=u([P("esri.layers.mixins.OperationalLayer")],e),e};async function ESt(t){const e=t.spatialReference;if(e.isWGS84)return t.clone();if(e.isWebMercator)return vA(t);const r=qe.WGS84;return await X1e(e,r),Ox(t,r)}function FYt(t,e){if(!MIe(t,e)){const r=t.typeKeywords;r?r.push(e):t.typeKeywords=[e]}}function MIe(t,e){return!!t.typeKeywords?.includes(e)}function UYt(t){return MIe(t,CSt.HOSTED_SERVICE)}function kYt(t,e){const r=t.typeKeywords;if(r){const i=r.indexOf(e);i>-1&&r.splice(i,1)}}async function zYt(t){const e=t.clone().normalize();let r;if(e.length>1)for(const i of e)r?i.width>r.width&&(r=i):r=i;else r=e[0];return ESt(r)}const CSt={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table",HOSTED_SERVICE:"Hosted Service"};function mfe(t){const{portal:e,isOrgItem:r,itemControl:i}=t,s=e.user?.privileges;let n=!s||s.includes("features:user:edit"),o=!!r&&!!s?.includes("features:user:fullEdit");const a=i==="update"||i==="admin";return a?o=n=!0:o&&(n=!0),{features:{edit:n,fullEdit:o},content:{updateItem:a}}}const PIe=t=>{let e=class extends t{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=Ne(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(r){r!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",r))}readPortalItem(r,i,s){if(i.itemId)return new hw({id:i.itemId,portal:s&&s.portal})}writePortalItem(r,i){r&&r.id&&(i.itemId=r.id)}async loadFromPortal(r,i){if(this.portalItem&&this.portalItem.id)try{const{load:s}=await he(()=>import("./layersLoader-76363640.js"),["./layersLoader-76363640.js","./fetchService-21f7bf3b.js","./jsonContext-bd549146.js"],import.meta.url);return Yt(i),await s({instance:this,supportedTypes:r.supportedTypes,validateItem:r.validateItem,supportsData:r.supportsData,layerModuleTypeMap:r.layerModuleTypeMap},i)}catch(s){throw ds(s)||K.getLogger(this).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})
  ${s}`),s}}async finishLoadEditablePortalLayer(r){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(r).catch(i=>(zo(i),!0)))}async _setUserPrivileges(r,i){if(!Gr.userPrivilegesApplied)return this.finishLoadEditablePortalLayer(i);if(this.url)try{const{features:{edit:s,fullEdit:n},content:{updateItem:o}}=await this._fetchUserPrivileges(r,i);this._set("userHasEditingPrivileges",s),this._set("userHasFullEditingPrivileges",n),this._set("userHasUpdateItemPrivileges",o)}catch(s){zo(s)}}async _fetchUserPrivileges(r,i){let s=this.portalItem;if(!r||!s||!s.loaded||s.sourceUrl)return this._fetchFallbackUserPrivileges(i);const n=r===s.id;if(n&&s.portal.user)return mfe(s);let o,a;if(n)o=s.portal.url;else try{o=await gye(this.url,i)}catch(d){zo(d)}if(!o||!o5e(o,s.portal.url))return this._fetchFallbackUserPrivileges(i);try{const d=i!=null?i.signal:null;a=await Ii?.getCredential(`${o}/sharing`,{prompt:!1,signal:d})}catch(d){zo(d)}const l=!0,c=!1,h=!1;if(!a)return{features:{edit:l,fullEdit:c},content:{updateItem:h}};try{if(n?await s.reload():(s=new hw({id:r,portal:{url:o}}),await s.load(i)),s.portal.user)return mfe(s)}catch(d){zo(d)}return{features:{edit:l,fullEdit:c},content:{updateItem:h}}}async _fetchFallbackUserPrivileges(r){let i=!0;try{i=await this._fetchUserHasEditingPrivileges(r)}catch(s){zo(s)}return{features:{edit:i,fullEdit:!1},content:{updateItem:!1}}}async _fetchUserHasEditingPrivileges(r){const i=this.url?Ii?.findCredential(this.url):null;if(!i)return!0;const s=uD.credential===i?uD.user:await this._fetchEditingUser(r);return uD.credential=i,uD.user=s,s==null||s.privileges==null||s.privileges.includes("features:user:edit")}async _fetchEditingUser(r){const i=this.portalItem?.portal?.user;if(i)return i;const s=Ii.findServerInfo(this.url??"");if(!s?.owningSystemUrl)return null;const n=`${s.owningSystemUrl}/sharing/rest`,o=en.getDefault();if(o&&o.loaded&&_p(o.restUrl)===_p(n))return o.user;const a=`${n}/community/self`,l=r!=null?r.signal:null,c=await $u(ur(a,{authMode:"no-prompt",query:{f:"json"},signal:l}));return c.ok?dZ.fromJSON(c.value.data):null}read(r,i){i&&(i.layer=this),super.read(r,i)}write(r,i){const s=i&&i.portal,n=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||en.getDefault());return s&&n&&!D0e(n.restUrl,s.restUrl)?(i.messages&&i.messages.push(new U("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(r,{...i,layer:this})}};return u([p({type:hw})],e.prototype,"portalItem",null),u([Oe("web-document","portalItem",["itemId"])],e.prototype,"readPortalItem",null),u([Be("web-document","portalItem",{itemId:{type:String}})],e.prototype,"writePortalItem",null),u([p({clonable:!1})],e.prototype,"resourceReferences",void 0),u([p({type:Boolean,readOnly:!0})],e.prototype,"userHasEditingPrivileges",void 0),u([p({type:Boolean,readOnly:!0})],e.prototype,"userHasFullEditingPrivileges",void 0),u([p({type:Boolean,readOnly:!0})],e.prototype,"userHasUpdateItemPrivileges",void 0),e=u([P("esri.layers.mixins.PortalLayer")],e),e},uD={credential:null,user:null},IIe=t=>{let e=class extends t{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const r={minScale:this.minScale,maxScale:this.maxScale},i=this.parent;i&&"effectiveScaleRange"in i&&ASt(r,i.effectiveScaleRange);const s=this._get("effectiveScaleRange");return s&&s.minScale===r.minScale&&s.maxScale===r.maxScale?s:r}};return u([p({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"minScale",void 0),u([p({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"maxScale",void 0),u([p({readOnly:!0})],e.prototype,"effectiveScaleRange",null),e=u([P("esri.layers.mixins.ScaleRangeLayer")],e),e};function ASt(t,e){return t.minScale=t.minScale>0?e.minScale>0?Math.min(t.minScale,e.minScale):t.minScale:e.minScale,t.maxScale=t.maxScale>0?e.maxScale>0?Math.max(t.maxScale,e.maxScale):t.maxScale:e.maxScale,t}function $Ie(t){return t&&"getAtOrigin"in t&&"originOf"in t}function gfe(t){t&&t.writtenProperties&&t.writtenProperties.forEach(({target:e,propName:r,newOrigin:i})=>{$Ie(e)&&i&&e.originOf(r)!==i&&e.updateOrigin(r,i)})}async function OSt(t,e,r,i,s,n){let o=null;if(r!=null){const c=`${t}/nodepages/`,h=c+Math.floor(r.rootIndex/r.nodesPerPage);try{return{type:"page",rootPage:(await ur(h,{query:{f:"json",token:i},responseType:"json",signal:n})).data,rootIndex:r.rootIndex,pageSize:r.nodesPerPage,lodMetric:r.lodSelectionMetricType,urlPrefix:c}}catch(d){s?.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",h,d),o=d}}if(!e)return null;const a=`${t}/nodes/`,l=a+(e&&e.split("/").pop());try{return{type:"node",rootNode:(await ur(l,{query:{f:"json",token:i},responseType:"json",signal:n})).data,urlPrefix:a}}catch(c){throw new U("sceneservice:root-node-missing","Root node missing.",{pageError:o,nodeError:c,url:l})}}let RSt=null;function MSt(){return RSt}async function PSt(t,e={},r){await t.load(r);const i=Fc(t.itemUrl,"resources"),{start:s=1,num:n=10,sortOrder:o="asc",sortField:a="created"}=e,l={query:{start:s,num:n,sortOrder:o,sortField:a,token:t.apiKey},signal:r?.signal},c=await t.portal.request(i,l);return{total:c.total,nextStart:c.nextStart,resources:c.resources.map(({created:h,size:d,resource:f})=>({created:new Date(h),size:d,resource:t.resourceFromPath(f)}))}}async function ISt(t,e,r,i){if(!t.hasPath())throw new U(`portal-item-resource-${e}:invalid-path`,"Resource does not have a valid path");const s=t.portalItem;await s.load(i);const n=Fc(s.userItemUrl,e==="add"?"addResources":"updateResources"),[o,a]=LIe(t.path),l=await DIe(r),c=new FormData;return o&&o!=="."&&c.append("resourcesPrefix",o),i!=null&&i.compress&&c.append("compress","true"),c.append("fileName",a),c.append("file",l,a),c.append("f","json"),i!=null&&i.access&&c.append("access",i.access),await s.portal.request(n,{method:"post",body:c,signal:i?.signal}),t}async function $St(t,e,r){if(!e.hasPath())throw new U("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await t.load(r);const i=Fc(t.userItemUrl,"removeResources");await t.portal.request(i,{method:"post",query:{resource:e.path},signal:r?.signal}),e.portalItem=null}async function LSt(t,e){await t.load(e);const r=Fc(t.userItemUrl,"removeResources");return t.portal.request(r,{method:"post",query:{deleteAll:!0},signal:e?.signal})}function LIe(t){const e=t.lastIndexOf("/");return e===-1?[".",t]:[t.slice(0,e),t.slice(e+1)]}function tte(t){const[e,r]=DSt(t),[i,s]=LIe(e);return[i,s,r]}function DSt(t){const e=KY(t);return e==null?[t,""]:[t.slice(0,t.length-e.length-1),`.${e}`]}async function DIe(t){return t instanceof Blob?t:(await ur(t.url,{responseType:"blob"})).data}function NSt(t,e){if(!t.hasPath())return null;const[r,,i]=tte(t.path);return t.portalItem.resourceFromPath(Fc(r,e+i))}function NIe(t,e){if(!t.hasPath())return null;const[r,,i]=tte(t.path);return t.portalItem.resourceFromPath(Fc(r,e+i))}const VO=Object.freeze(Object.defineProperty({__proto__:null,addOrUpdateResource:ISt,contentToBlob:DIe,fetchResources:PSt,getSiblingOfSameType:NSt,getSiblingOfSameTypeI:NIe,removeAllResources:LSt,removeResource:$St,splitPrefixFileNameAndExtension:tte},Symbol.toStringTag,{value:"Module"}));async function yfe(t,e,r){if(!e||!e.resources)return;const i=e.portalItem===t.portalItem?new Set(t.paths):new Set;t.paths.length=0,t.portalItem=e.portalItem;const s=new Set(e.resources.toKeep.map(c=>c.resource.path)),n=new Set,o=[];s.forEach(c=>{i.delete(c),t.paths.push(c)});for(const c of e.resources.toUpdate)if(i.delete(c.resource.path),s.has(c.resource.path)||n.has(c.resource.path)){const{resource:h,content:d,finish:f,error:m}=c,g=NIe(h,Q9());t.paths.push(g.path),o.push(_fe({resource:g,content:d,compress:c.compress,finish:f,error:m},r))}else t.paths.push(c.resource.path),o.push(FSt(c,r)),n.add(c.resource.path);for(const c of e.resources.toAdd)o.push(_fe(c,r)),t.paths.push(c.resource.path);if(i.forEach(c=>{if(e.portalItem){const h=e.portalItem.resourceFromPath(c);o.push(h.portalItem.removeResource(h).catch(()=>{}))}}),o.length===0)return;const a=await Ac(o);Yt(r);const l=a.filter(c=>"error"in c).map(c=>c.error);if(l.length>0)throw new U("save:resources","Failed to save one or more resources",{errors:l})}async function _fe(t,e){const r={...e??{},compress:t.compress},i=await $u(t.resource.portalItem.addResource(t.resource,t.content,r));if(i.ok!==!0)throw t.error?.(i.error),i.error;t.finish?.(t.resource)}async function FSt(t,e){const r=await $u(t.resource.update(t.content,e));if(r.ok!==!0)throw t.error?.(r.error),r.error;t.finish?.(t.resource)}const FIe="esri.layers.mixins.SceneService",KT=K.getLogger(FIe),USt=t=>{let e=class extends t{constructor(){super(...arguments),this.spatialReference=null,this.fullExtent=null,this.heightModelInfo=null,this.minScale=0,this.maxScale=0,this.version={major:Number.NaN,minor:Number.NaN,versionString:""},this.copyright=null,this.sublayerTitleMode="item-title",this.title=null,this.layerId=null,this.indexInfo=null,this._debouncedSaveOperations=MY(async(r,i,s)=>{switch(r){case nC.SAVE:return this._save(i);case nC.SAVE_AS:return this._saveAs(s,i)}})}readSpatialReference(r,i){return this._readSpatialReference(i)}_readSpatialReference(r){if(r.spatialReference!=null)return qe.fromJSON(r.spatialReference);{const i=r.store,s=i.indexCRS||i.geographicCRS,n=s&&parseInt(s.substring(s.lastIndexOf("/")+1,s.length),10);return n!=null?new qe(n):null}}readFullExtent(r,i,s){if(r!=null&&typeof r=="object"){const a=r.spatialReference==null?{...r,spatialReference:this._readSpatialReference(i)}:r;return cr.fromJSON(a,s)}const n=i.store,o=this._readSpatialReference(i);return o==null||n==null||n.extent==null||!Array.isArray(n.extent)||n.extent.some(a=>a<JV)?null:new cr({xmin:n.extent[0],ymin:n.extent[1],xmax:n.extent[2],ymax:n.extent[3],spatialReference:o})}parseVersionString(r){const i={major:Number.NaN,minor:Number.NaN,versionString:r},s=r.split(".");return s.length>=2&&(i.major=parseInt(s[0],10),i.minor=parseInt(s[1],10)),i}readVersion(r,i){const s=i.store,n=s.version!=null?s.version.toString():"";return this.parseVersionString(n)}readTitlePortalItem(r){return this.sublayerTitleMode!=="item-title"?void 0:r}readTitleService(r,i){const s=this.portalItem&&this.portalItem.title;if(this.sublayerTitleMode==="item-title")return Jwe(this.url,i.name);let n=i.name;if(!n&&this.url){const o=Ix(this.url);o!=null&&(n=o.title)}return this.sublayerTitleMode==="item-title-and-service-name"&&s&&(n=s+" - "+n),D8(n)}set url(r){const i=Qwe({layer:this,url:r,nonStandardUrlAllowed:!1,logger:KT});this._set("url",i.url),i.layerId!=null&&this._set("layerId",i.layerId)}writeUrl(r,i,s,n){Kwe(this,r,"layers",i,n)}get parsedUrl(){const r=this._get("url"),i=Co(r);return this.layerId!=null&&(i.path=`${i.path}/layers/${this.layerId}`),i}async _fetchIndexAndUpdateExtent(r,i){this.indexInfo=OSt(this.parsedUrl.path,this.rootNode,r,this.apiKey,KT,i),this.fullExtent==null||this.fullExtent.hasZ||this._updateExtent(await this.indexInfo)}_updateExtent(r){if(r?.type==="page"){const i=r.rootIndex%r.pageSize,s=r.rootPage?.nodes?.[i];if(s==null||s.obb==null||s.obb.center==null||s.obb.halfSize==null)throw new U("sceneservice:invalid-node-page","Invalid node page.");if(s.obb.center[0]<JV||this.fullExtent==null||this.fullExtent.hasZ)return;const n=s.obb.halfSize,o=s.obb.center[2],a=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);this.fullExtent.zmin=o-a,this.fullExtent.zmax=o+a}else if(r?.type==="node"){const i=r.rootNode?.mbs;if(!Array.isArray(i)||i.length!==4||i[0]<JV)return;const s=i[2],n=i[3],{fullExtent:o}=this;o&&(o.zmin=s-n,o.zmax=s+n)}}async _fetchService(r){if(this.url==null)throw new U("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(this.layerId==null&&/SceneServer\/*$/i.test(this.url)){const i=await this._fetchFirstLayerId(r);i!=null&&(this.layerId=i)}return this._fetchServiceLayer(r)}async _fetchFirstLayerId(r){const i=await ur(this.url,{query:{f:"json",token:this.apiKey},responseType:"json",signal:r});if(i.data&&Array.isArray(i.data.layers)&&i.data.layers.length>0)return i.data.layers[0].id}async _fetchServiceLayer(r){const i=await ur(this.parsedUrl?.path??"",{query:{f:"json",token:this.apiKey},responseType:"json",signal:r});i.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));let s=!1;if(i.data.layerType&&i.data.layerType==="Voxel"&&(s=!0),s)return this._fetchVoxelServiceLayer();const n=i.data;this.read(n,this._getServiceContext()),this.validateLayer(n)}async _fetchVoxelServiceLayer(r){const i=(await ur(this.parsedUrl?.path+"/layer",{query:{f:"json",token:this.apiKey},responseType:"json",signal:r})).data;this.read(i,this._getServiceContext()),this.validateLayer(i)}_getServiceContext(){return{origin:"service",portalItem:this.portalItem,portal:this.portalItem?.portal,url:this.parsedUrl}}async _ensureLoadBeforeSave(){await this.load(),"beforeSave"in this&&typeof this.beforeSave=="function"&&await this.beforeSave()}validateLayer(r){}_updateTypeKeywords(r,i,s){r.typeKeywords||(r.typeKeywords=[]);const n=i.getTypeKeywords();for(const o of n)r.typeKeywords.push(o);r.typeKeywords&&(r.typeKeywords=r.typeKeywords.filter((o,a,l)=>l.indexOf(o)===a),s===ZR.newItem&&(r.typeKeywords=r.typeKeywords.filter(o=>o!=="Hosted Service")))}async _saveAs(r,i){const s={...vfe,...i};let n=hw.from(r);n||(KT.error("_saveAs(): requires a portal item parameter"),await Promise.reject(new U("sceneservice:portal-item-required","_saveAs() requires a portal item to save to"))),n.id&&(n=n.clone(),n.id=null);const o=n.portal||en.getDefault();await this._ensureLoadBeforeSave(),n.type=hD,n.portal=o;const a={origin:"portal-item",url:null,messages:[],portal:o,portalItem:n,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},l={layers:[this.write({},a)]};return await Promise.all(a.resources.pendingOperations??[]),await this._validateAgainstJSONSchema(l,a,s),n.url=this.url,n.title||(n.title=this.title),this._updateTypeKeywords(n,s,ZR.newItem),await o.signIn(),await o.user?.addItem({item:n,folder:s&&s.folder,data:l}),await yfe(this.resourceReferences,a,null),this.portalItem=n,gfe(a),a.portalItem=n,n}async _save(r){const i={...vfe,...r};if(!this.portalItem)throw KT.error("_save(): requires the .portalItem property to be set"),new U("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService");if(this.portalItem.type!==hD)throw KT.error("_save(): Non-matching portal item type. Got "+this.portalItem.type+", expected "+hD),new U("sceneservice:portal-item-wrong-type",`Portal item needs to have type "${hD}"`);await this._ensureLoadBeforeSave();const s={origin:"portal-item",url:this.portalItem.itemUrl&&Co(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||en.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},n={layers:[this.write({},s)]};return await Promise.all(s.resources.pendingOperations??[]),await this._validateAgainstJSONSchema(n,s,i),this.portalItem.url=this.url,this.portalItem.title||(this.portalItem.title=this.title),this._updateTypeKeywords(this.portalItem,i,ZR.existingItem),await this.portalItem.update({data:n}),await yfe(this.resourceReferences,s,null),gfe(s),this.portalItem}async _validateAgainstJSONSchema(r,i,s){let n=i.messages?.filter(c=>c.type==="error").map(c=>new U(c.name,c.message,c.details))??[];s?.validationOptions?.ignoreUnsupported&&(n=n.filter(c=>c.name!=="layer:unsupported"&&c.name!=="symbol:unsupported"&&c.name!=="symbol-layer:unsupported"&&c.name!=="property:unsupported"&&c.name!=="url:unsupported"&&c.name!=="scenemodification:unsupported"));const o=s?.validationOptions,a=o?.enabled,l=MSt();if(a&&l){const c=(await l()).validate(r,s.portalItemLayerType);if(c.length>0){const h=`Layer item did not validate:
${c.join(`
`)}`;if(KT.error(`_validateAgainstJSONSchema(): ${h}`),o.failPolicy==="throw"){const d=c.map(f=>new U("sceneservice:schema-validation",f)).concat(n);throw new U("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{combined:d})}}}if(n.length>0)throw new U("sceneservice:save","Failed to save SceneService due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:n})}};return u([p(AIe)],e.prototype,"id",void 0),u([p({type:qe})],e.prototype,"spatialReference",void 0),u([Oe("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],e.prototype,"readSpatialReference",null),u([p({type:cr})],e.prototype,"fullExtent",void 0),u([Oe("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],e.prototype,"readFullExtent",null),u([p({readOnly:!0,type:Ax})],e.prototype,"heightModelInfo",void 0),u([p({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],e.prototype,"minScale",void 0),u([p({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],e.prototype,"maxScale",void 0),u([p({readOnly:!0})],e.prototype,"version",void 0),u([Oe("version",["store.version"])],e.prototype,"readVersion",null),u([p({type:String,json:{read:{source:"copyrightText"}}})],e.prototype,"copyright",void 0),u([p({type:String,json:{read:!1}})],e.prototype,"sublayerTitleMode",void 0),u([p({type:String})],e.prototype,"title",void 0),u([Oe("portal-item","title")],e.prototype,"readTitlePortalItem",null),u([Oe("service","title",["name"])],e.prototype,"readTitleService",null),u([p({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],e.prototype,"layerId",void 0),u([p(TIe)],e.prototype,"url",null),u([Be("url")],e.prototype,"writeUrl",null),u([p()],e.prototype,"parsedUrl",null),u([p({readOnly:!0})],e.prototype,"store",void 0),u([p({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],e.prototype,"rootNode",void 0),e=u([P(FIe)],e),e},JV=-1e38;var ZR;(function(t){t[t.existingItem=0]="existingItem",t[t.newItem=1]="newItem"})(ZR||(ZR={}));const hD="Scene Service",vfe={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}};var nC;(function(t){t[t.SAVE=0]="SAVE",t[t.SAVE_AS=1]="SAVE_AS"})(nC||(nC={}));const kSt={analytics:{supportsCacheHint:!1},attachment:{supportsContentType:!1,supportsExifInfo:!1,supportsKeywords:!1,supportsName:!1,supportsSize:!1,supportsCacheHint:!1,supportsResize:!1},data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsAsyncApplyEdits:!1},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1,supportsAsyncConvert3D:!1},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},query:{maxRecordCount:0,maxRecordCountFactor:0,standardMaxRecordCount:0,supportsCacheHint:!1,supportsCentroid:!1,supportsCompactGeometry:!1,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsSqlExpression:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsStatistics:!1,tileMaxRecordCount:0}};let c0=class extends ue{constructor(){super(...arguments),this.type=null}};u([p({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],c0.prototype,"type",void 0),c0=u([P("esri.layers.support.FeatureReduction")],c0);var sX;let g4=sX=class extends c0{constructor(t){super(t),this.type="selection"}clone(){return new sX}};u([p({type:["selection"]})],g4.prototype,"type",void 0),g4=sX=u([P("esri.layers.support.FeatureReductionSelection")],g4);const nX=g4;async function zSt(t,e){const{WhereClause:r}=await he(()=>import("./WhereClause-fb3d85c4.js").then(i=>i.W),["./WhereClause-fb3d85c4.js","./executionError-e8d36121.js"],import.meta.url);return r.create(t,e)}function VSt(t,e){return t!=null?e!=null?`(${t}) AND (${e})`:t:e}var oX;let Eb=oX=class extends ue{constructor(t){super(t),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new oX({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([p({type:String,json:{write:!0}})],Eb.prototype,"expression",void 0),u([p({type:String,json:{write:!0}})],Eb.prototype,"name",void 0),u([p({type:["boolean","date","number","string"],json:{write:!0}})],Eb.prototype,"returnType",void 0),u([p({type:String,json:{write:!0}})],Eb.prototype,"title",void 0),Eb=oX=u([P("esri.form.ExpressionInfo")],Eb);const BSt=Eb;let Cb=class extends ue{constructor(e){super(e),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};u([p({type:String,json:{write:!0}})],Cb.prototype,"description",void 0),u([p({type:String,json:{write:!0}})],Cb.prototype,"label",void 0),u([p()],Cb.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],Cb.prototype,"visibilityExpression",void 0),Cb=u([P("esri.form.elements.Element")],Cb);const oC=Cb;var aX;let y4=aX=class extends ue{constructor(t){super(t),this.type=null}clone(){return new aX({type:this.type})}};u([p({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],y4.prototype,"type",void 0),y4=aX=u([P("esri.form.elements.inputs.AttachmentInput")],y4);const GSt=y4;var lX;let Ab=lX=class extends oC{constructor(t){super(t),this.attachmentKeyword=null,this.editable=!0,this.input=null,this.type="attachment"}clone(){return new lX({attachmentKeyword:this.attachmentKeyword,description:this.description,editable:this.editable,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};u([p({type:String,json:{write:!0}})],Ab.prototype,"attachmentKeyword",void 0),u([p({type:Boolean,json:{write:!0}})],Ab.prototype,"editable",void 0),u([p({type:GSt,json:{read:{source:"inputType"},write:{target:"inputType"}}})],Ab.prototype,"input",void 0),u([p({type:["attachment"],json:{read:!1,write:!0}})],Ab.prototype,"type",void 0),Ab=lX=u([P("esri.form.elements.AttachmentElement")],Ab);const bfe=Ab;let _4=class extends ue{constructor(e){super(e),this.type=null}};u([p()],_4.prototype,"type",void 0),_4=u([P("esri.form.elements.inputs.Input")],_4);const qC=_4;let BO=class extends qC{constructor(e){super(e),this.maxLength=null,this.minLength=0}};u([p({type:Number,json:{write:!0}})],BO.prototype,"maxLength",void 0),u([p({type:Number,json:{write:!0}})],BO.prototype,"minLength",void 0),BO=u([P("esri.form.elements.inputs.TextInput")],BO);const rte=BO;var cX;let v4=cX=class extends rte{constructor(t){super(t),this.type="barcode-scanner"}clone(){return new cX({maxLength:this.maxLength,minLength:this.minLength})}};u([p({type:["barcode-scanner"],json:{read:!1,write:!0}})],v4.prototype,"type",void 0),v4=cX=u([P("esri.form.elements.inputs.BarcodeScannerInput")],v4);const jSt=v4;var uX;let q2=uX=class extends qC{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="combo-box"}clone(){return new uX({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};u([p({type:String,json:{write:!0}})],q2.prototype,"noValueOptionLabel",void 0),u([p({type:Boolean,json:{write:!0}})],q2.prototype,"showNoValueOption",void 0),u([p({type:["combo-box"],json:{read:!1,write:!0}})],q2.prototype,"type",void 0),q2=uX=u([P("esri.form.elements.inputs.ComboBoxInput")],q2);const HSt=q2;var hX;function wfe(t){return t!=null?new Date(t):null}function xfe(t){return t?t.getTime():null}let Bd=hX=class extends qC{constructor(t){super(t),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(t,e){return wfe(e.max)}writeMax(t,e){e.max=xfe(t)}readMin(t,e){return wfe(e.min)}writeMin(t,e){e.min=xfe(t)}clone(){return new hX({includeTime:this.includeTime,max:this.max,min:this.min})}};u([p({type:Boolean,json:{write:!0}})],Bd.prototype,"includeTime",void 0),u([p({type:Date,json:{type:Number,write:!0}})],Bd.prototype,"max",void 0),u([Oe("max")],Bd.prototype,"readMax",null),u([Be("max")],Bd.prototype,"writeMax",null),u([p({type:Date,json:{type:Number,write:!0}})],Bd.prototype,"min",void 0),u([Oe("min")],Bd.prototype,"readMin",null),u([Be("min")],Bd.prototype,"writeMin",null),u([p({type:["datetime-picker"],json:{read:!1,write:!0}})],Bd.prototype,"type",void 0),Bd=hX=u([P("esri.form.elements.inputs.DateTimePickerInput")],Bd);const qSt=Bd;var dX;let W2=dX=class extends qC{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="radio-buttons"}clone(){return new dX({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};u([p({type:String,json:{write:!0}})],W2.prototype,"noValueOptionLabel",void 0),u([p({type:Boolean,json:{write:!0}})],W2.prototype,"showNoValueOption",void 0),u([p({type:["radio-buttons"],json:{read:!1,write:!0}})],W2.prototype,"type",void 0),W2=dX=u([P("esri.form.elements.inputs.RadioButtonsInput")],W2);const WSt=W2;var pX;let X2=pX=class extends qC{constructor(t){super(t),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new pX({offValue:this.offValue,onValue:this.onValue})}};u([p({type:[String,Number],json:{write:!0}})],X2.prototype,"offValue",void 0),u([p({type:[String,Number],json:{write:!0}})],X2.prototype,"onValue",void 0),u([p({type:["switch"],json:{read:!1,write:!0}})],X2.prototype,"type",void 0),X2=pX=u([P("esri.form.elements.inputs.SwitchInput")],X2);const XSt=X2;var fX;let b4=fX=class extends rte{constructor(t){super(t),this.type="text-area"}clone(){return new fX({maxLength:this.maxLength,minLength:this.minLength})}};u([p({type:["text-area"],json:{read:!1,write:!0}})],b4.prototype,"type",void 0),b4=fX=u([P("esri.form.elements.inputs.TextAreaInput")],b4);const YSt=b4;var mX;let w4=mX=class extends rte{constructor(t){super(t),this.type="text-box"}clone(){return new mX({maxLength:this.maxLength,minLength:this.minLength})}};u([p({type:["text-box"],json:{read:!1,write:!0}})],w4.prototype,"type",void 0),w4=mX=u([P("esri.form.elements.inputs.TextBoxInput")],w4);const ZSt=w4,JSt={base:qC,key:"type",typeMap:{"barcode-scanner":jSt,"combo-box":HSt,"datetime-picker":qSt,"radio-buttons":WSt,switch:XSt,"text-area":YSt,"text-box":ZSt}};var gX;const UIe="esri.form.elements.FieldElement",Tfe=K.getLogger(UIe);let dh=gX=class extends oC{constructor(t){super(t),this.domain=null,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}get editable(){return cp(Tfe,"editable",{replacement:"editableExpression",version:"4.26",warnOnce:!0}),this._get("editable")??!0}set editable(t){cp(Tfe,"editable",{replacement:"editableExpression",version:"4.26",warnOnce:!0}),this._set("editable",t)}clone(){return new gX({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};u([p({types:FEe,json:{read:{reader:cK},write:!0}})],dh.prototype,"domain",void 0),u([p({type:Boolean,json:{write:!0}})],dh.prototype,"editable",null),u([p({type:String,json:{write:!0}})],dh.prototype,"editableExpression",void 0),u([p({type:String,json:{write:!0}})],dh.prototype,"fieldName",void 0),u([p({type:String,json:{write:!0}})],dh.prototype,"hint",void 0),u([p({types:JSt,json:{read:{source:"inputType"},write:{target:"inputType"}}})],dh.prototype,"input",void 0),u([p({type:String,json:{write:!0}})],dh.prototype,"requiredExpression",void 0),u([p({type:String,json:{read:!1,write:!0}})],dh.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],dh.prototype,"valueExpression",void 0),dh=gX=u([P(UIe)],dh);const Sfe=dh;var yX;let Cg=yX=class extends oC{constructor(t){super(t),this.displayCount=null,this.displayType="list",this.editableExpression=null,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new yX({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editableExpression:this.editableExpression,label:this.label,orderByFields:ee(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};u([p({type:Number,json:{write:!0}})],Cg.prototype,"displayCount",void 0),u([p({type:["list"],json:{write:!0}})],Cg.prototype,"displayType",void 0),u([p({type:String,json:{write:!0}})],Cg.prototype,"editableExpression",void 0),u([p({type:[QZ],json:{write:!0}})],Cg.prototype,"orderByFields",void 0),u([p({type:Number,json:{write:!0}})],Cg.prototype,"relationshipId",void 0),u([p({type:["relationship"],json:{read:!1,write:!0}})],Cg.prototype,"type",void 0),Cg=yX=u([P("esri.form.elements.RelationshipElement")],Cg);const Efe=Cg;function kIe(t){return{typesWithGroup:{base:oC,key:"type",typeMap:{attachment:bfe,field:Sfe,group:t,relationship:Efe}},typesWithoutGroup:{base:oC,key:"type",typeMap:{attachment:bfe,field:Sfe,relationship:Efe}}}}function zIe(t,e,r=!0){if(!t)return null;const i=r?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(s=>i[s.type]).map(s=>i[s.type].fromJSON(s))}function VIe(t,e,r=!0){if(!t)return null;const i=r?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(s=>i[s.type]).map(s=>s.toJSON())}function BIe(t,e,r=!0){return t?t.map(i=>Ap(r?e.typesWithGroup:e.typesWithoutGroup,i)):null}var _X;let If=_X=class extends oC{constructor(t){super(t),this.elements=null,this.initialState="expanded",this.type="group"}castElements(t){return BIe(t,QV,!1)}readElements(t,e){return zIe(e.formElements,QV,!1)}writeElements(t,e){e.formElements=VIe(t,QV,!1)}clone(){return new _X({description:this.description,elements:ee(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};u([p({json:{write:!0}})],If.prototype,"elements",void 0),u([wr("elements")],If.prototype,"castElements",null),u([Oe("elements",["formElements"])],If.prototype,"readElements",null),u([Be("elements")],If.prototype,"writeElements",null),u([p({type:["collapsed","expanded"],json:{write:!0}})],If.prototype,"initialState",void 0),u([p({type:String,json:{read:!1,write:!0}})],If.prototype,"type",void 0),If=_X=u([P("esri.form.elements.GroupElement")],If);const QV=kIe(If),QSt=If;var vX;const KV=kIe(QSt);let Gd=vX=class extends ue{constructor(t){super(t),this.description=null,this.elements=null,this.expressionInfos=null,this.preserveFieldValuesWhenHidden=!1,this.title=null}castElements(t){return BIe(t,KV)}readElements(t,e){return zIe(e.formElements,KV)}writeElements(t,e){e.formElements=VIe(t,KV)}clone(){return new vX({description:this.description,expressionInfos:ee(this.expressionInfos),elements:ee(this.elements),title:this.title,preserveFieldValuesWhenHidden:this.preserveFieldValuesWhenHidden})}};u([p({type:String,json:{write:!0}})],Gd.prototype,"description",void 0),u([p({json:{write:!0}})],Gd.prototype,"elements",void 0),u([wr("elements")],Gd.prototype,"castElements",null),u([Oe("elements",["formElements"])],Gd.prototype,"readElements",null),u([Be("elements")],Gd.prototype,"writeElements",null),u([p({type:[BSt],json:{write:!0}})],Gd.prototype,"expressionInfos",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],Gd.prototype,"preserveFieldValuesWhenHidden",void 0),u([p({type:String,json:{write:!0}})],Gd.prototype,"title",void 0),Gd=vX=u([P("esri.form.FormTemplate")],Gd);const KSt=Gd;function Cfe(t,e,r){if(t.hasM==null||t.hasZ)for(const i of e)for(const s of i)s.length>2&&(s[2]*=r)}function eEt(t,e,r){if(!t&&!e||!r)return;const i=oM(r);Afe(t,r,i),Afe(e,r,i)}function Afe(t,e,r){if(t)for(const i of t)tEt(i.geometry,e,r)}function tEt(t,e,r){if(t==null||!t.spatialReference||Ln(t.spatialReference,e))return;const i=oM(t.spatialReference)/r;if(i!==1){if("x"in t)t.z!=null&&(t.z*=i);else if("rings"in t)Cfe(t,t.rings,i);else if("paths"in t)Cfe(t,t.paths,i);else if("points"in t&&(t.hasM==null||t.hasZ))for(const s of t.points)s.length>2&&(s[2]*=i)}}function Ofe(t,e,r){if(!r||!r.features||!r.hasZ)return;const i=G1e(r.geometryType,e,t.outSpatialReference);if(i!=null)for(const s of r.features)i(s.geometry)}var bX;const wX=new $r({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let Do=bX=class extends ue{constructor(t){super(t),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(t,e){const r=qe.fromJSON(e.spatialReference),i=[];for(let s=0;s<t.length;s++){const n=t[s],o=Bl.fromJSON(n),a=n.geometry&&n.geometry.spatialReference;o.geometry==null||a||(o.geometry.spatialReference=r);const l=n.aggregateGeometries,c=o.aggregateGeometries;if(l&&c!=null)for(const h in c){const d=c[h],f=l[h],m=f?.spatialReference;d==null||m||(d.spatialReference=r)}i.push(o)}return i}writeGeometryType(t,e,r,i){if(t)return void wX.write(t,e,r,i);const{features:s}=this;if(s){for(const n of s)if(n&&n.geometry!=null)return void wX.write(n.geometry.type,e,r,i)}}readQueryGeometry(t,e){if(!t)return null;const r=!!t.spatialReference,i=ov(t);return i&&!r&&e.spatialReference&&(i.spatialReference=qe.fromJSON(e.spatialReference)),i}writeSpatialReference(t,e){if(t)return void(e.spatialReference=t.toJSON());const{features:r}=this;if(r){for(const i of r)if(i&&i.geometry!=null&&i.geometry.spatialReference)return void(e.spatialReference=i.geometry.spatialReference.toJSON())}}clone(){return new bX(this.cloneProperties())}cloneProperties(){return ee({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(t){const e=this.write();if(e.features&&Array.isArray(t)&&t.length>0)for(let r=0;r<e.features.length;r++){const i=e.features[r];if(i.geometry){const s=t&&t[r];i.geometry=s&&s.toJSON()||i.geometry}}return e}quantize(t){const{scale:[e,r],translate:[i,s]}=t,n=c=>Math.round((c-i)/e),o=c=>Math.round((s-c)/r),a=this.features,l=this._getQuantizationFunction(this.geometryType,n,o);for(let c=0,h=a.length;c<h;c++)l?.(a[c].geometry)||(a.splice(c,1),c--,h--);return this.transform=t,this}unquantize(){const{geometryType:t,features:e,transform:r}=this;if(!r)return this;const{translate:[i,s],scale:[n,o]}=r,a=f=>f*n+i,l=f=>s-f*o;let c=null,h=null;if(this.hasZ&&r?.scale?.[2]!=null){const{translate:[,,f],scale:[,,m]}=r;c=g=>g*m+f}if(this.hasM&&r?.scale?.[3]!=null){const{translate:[,,,f],scale:[,,,m]}=r;h=g=>g==null?g:g*m+f}const d=this._getHydrationFunction(t,a,l,c,h);for(const{geometry:f}of e)f!=null&&d&&d(f);return this.transform=null,this}_quantizePoints(t,e,r){let i,s;const n=[];for(let o=0,a=t.length;o<a;o++){const l=t[o];if(o>0){const c=e(l[0]),h=r(l[1]);c===i&&h===s||(n.push([c-i,h-s]),i=c,s=h)}else i=e(l[0]),s=r(l[1]),n.push([i,s])}return n.length>0?n:null}_getQuantizationFunction(t,e,r){return t==="point"?i=>(i.x=e(i.x),i.y=r(i.y),i):t==="polyline"||t==="polygon"?i=>{const s=$S(i)?i.rings:i.paths,n=[];for(let o=0,a=s.length;o<a;o++){const l=s[o],c=this._quantizePoints(l,e,r);c&&n.push(c)}return n.length>0?($S(i)?i.rings=n:i.paths=n,i):null}:t==="multipoint"?i=>{const s=this._quantizePoints(i.points,e,r);return s&&s.length>0?(i.points=s,i):null}:t==="extent"?i=>i:null}_getHydrationFunction(t,e,r,i,s){return t==="point"?n=>{n.x=e(n.x),n.y=r(n.y),i&&(n.z=i(n.z))}:t==="polyline"||t==="polygon"?n=>{const o=$S(n)?n.rings:n.paths;let a,l;for(let c=0,h=o.length;c<h;c++){const d=o[c];for(let f=0,m=d.length;f<m;f++){const g=d[f];f>0?(a+=g[0],l+=g[1]):(a=g[0],l=g[1]),g[0]=e(a),g[1]=r(l)}}if(i&&s)for(let c=0,h=o.length;c<h;c++){const d=o[c];for(let f=0,m=d.length;f<m;f++){const g=d[f];g[2]=i(g[2]),g[3]=s(g[3])}}else if(i)for(let c=0,h=o.length;c<h;c++){const d=o[c];for(let f=0,m=d.length;f<m;f++){const g=d[f];g[2]=i(g[2])}}else if(s)for(let c=0,h=o.length;c<h;c++){const d=o[c];for(let f=0,m=d.length;f<m;f++){const g=d[f];g[2]=s(g[2])}}}:t==="extent"?n=>{n.xmin=e(n.xmin),n.ymin=r(n.ymin),n.xmax=e(n.xmax),n.ymax=r(n.ymax),i&&n.zmax!=null&&n.zmin!=null&&(n.zmax=i(n.zmax),n.zmin=i(n.zmin)),s&&n.mmax!=null&&n.mmin!=null&&(n.mmax=s(n.mmax),n.mmin=s(n.mmin))}:t==="multipoint"?n=>{const o=n.points;let a,l;for(let c=0,h=o.length;c<h;c++){const d=o[c];c>0?(a+=d[0],l+=d[1]):(a=d[0],l=d[1]),d[0]=e(a),d[1]=r(l)}if(i&&s)for(let c=0,h=o.length;c<h;c++){const d=o[c];d[2]=i(d[2]),d[3]=s(d[3])}else if(i)for(let c=0,h=o.length;c<h;c++){const d=o[c];d[2]=i(d[2])}else if(s)for(let c=0,h=o.length;c<h;c++){const d=o[c];d[2]=s(d[2])}}:null}};u([p({type:String,json:{write:!0}})],Do.prototype,"displayFieldName",void 0),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Do.prototype,"exceededTransferLimit",void 0),u([p({type:[Bl],json:{write:!0}})],Do.prototype,"features",void 0),u([Oe("features")],Do.prototype,"readFeatures",null),u([p({type:[y9],json:{write:!0}})],Do.prototype,"fields",void 0),u([p({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:wX.read}}})],Do.prototype,"geometryType",void 0),u([Be("geometryType")],Do.prototype,"writeGeometryType",null),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Do.prototype,"hasM",void 0),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Do.prototype,"hasZ",void 0),u([p({types:wx,json:{write:!0}})],Do.prototype,"queryGeometry",void 0),u([Oe("queryGeometry")],Do.prototype,"readQueryGeometry",null),u([p({type:qe,json:{write:!0}})],Do.prototype,"spatialReference",void 0),u([Be("spatialReference")],Do.prototype,"writeSpatialReference",null),u([p({json:{write:!0}})],Do.prototype,"transform",void 0),Do=bX=u([P("esri.rest.support.FeatureSet")],Do),Do.prototype.toJSON.isDefaultToJSON=!0;const GIe=Do;let rEt=0;const jIe="esri.layers.graphics.sources.MemorySource",e7=K.getLogger(jIe);let Dg=class extends p0.LoadableMixin(B6(m8(Pt))){constructor(e){super(e),this._idToClientGraphic=null,this.type="memory"}load(e){const r=e!=null?e.signal:null;return this.addResolvingPromise(this._startWorker(r)),Promise.resolve(this)}destroy(){this._connection?.close(),this._connection=null}get _workerGeometryType(){const e=this.layer?.geometryType;return e?this._geometryTypeRequiresClientGraphicMapping(e)?"polygon":e:null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}async queryFeatures(e,r={}){await this.load(r);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,r);Ofe(e,this.layer.spatialReference,i);const s=GIe.fromJSON(i);if(!this._requiresClientGraphicMapping())return s;const n=this.layer.objectIdField;for(const o of s.features){const a=o.attributes[n],l=this._idToClientGraphic.get(a);l&&(o.geometry=l.geometry)}return s.geometryType=this.layer.geometryType,s}async queryFeaturesJSON(e,r={}){if(this._requiresClientGraphicMapping())throw new U("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");await this.load(r);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,r);return Ofe(e,this.layer.spatialReference,i),i}queryFeatureCount(e,r={}){return this.load(r).then(()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,r))}queryObjectIds(e,r={}){return this.load(r).then(()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,r))}queryExtent(e,r={}){return this.load(r).then(()=>this._connection.invoke("queryExtent",e?e.toJSON():null,r)).then(i=>({count:i.count,extent:cr.fromJSON(i.extent)}))}querySnapping(e,r={}){return this.load(r).then(()=>this._connection.invoke("querySnapping",e,r))}async _applyEdits(e){if(!this._connection)throw new U("feature-layer-source:edit-failure","Memory source not loaded");const r=this.layer.objectIdField;let i=null;const s=[],n=[];await Promise.all([this._prepareClientMapping(e.addFeatures,null),this._prepareClientMapping(e.updateFeatures,null)]);const o=h=>"objectId"in h&&h.objectId!=null?h.objectId:"attributes"in h&&h.attributes[r]!=null?h.attributes[r]:null;if(e.addFeatures&&(i=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const h of e.deleteFeatures){const d=o(h);d!=null&&s.push(d)}const a=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures){for(const h of e.updateFeatures)if(n.push(this._serializeFeature(h)),a){const d=o(h);d!=null&&a.set(d,h)}}eEt(i?i.features:null,n,this.layer.spatialReference);const{fullExtent:l,featureEditResults:c}=await this._connection.invoke("applyEdits",{adds:i?i.features:[],updates:n,deletes:s});return this.fullExtent=l,i&&i.finish(c.uidToObjectId),this._updateClientGraphicIds(a,c),this._createEditsResult(c)}async _prepareClientMapping(e,r){if(this._layerOrSourceGeometryType!=="mesh"||e==null)return;const i=[];for(const{geometry:s}of e)s==null||s.type!=="mesh"||s.hasExtent||s.loaded||i.push(s.load({signal:r}));i.length&&await Promise.all(i)}_updateClientGraphicIds(e,r){if(this._idToClientGraphic){if(e)for(const i of r.updateResults){if(!i.success)continue;const s=e.get(i.objectId);s!=null&&this._addIdToClientGraphic(s)}for(const i of r.deleteResults)i.success&&this._idToClientGraphic.delete(i.objectId)}}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const r=e.success===!0?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:r?new U("feature-layer-source:edit-failure",r.description,{code:r.code}):null}}_prepareAddFeatures(e){const r=new Map,i=new Array(e.length);let s=null;for(let o=0;o<e.length;o++){const a=e[o],l=this._serializeFeature(a);s||a.geometry==null||(s=a.geometry.type),i[o]=l,r.set(`${l.uid}`,a)}const n=this;return{features:i,inferredGeometryType:s,finish(o){const a=n.sourceJSON.objectIdField;for(const l in o){const c=o[l],h=r.get(l);h&&(h.attributes||(h.attributes={}),c===-1?delete h.attributes[a]:h.attributes[a]=c,n._addIdToClientGraphic(h))}}}}_addIdToClientGraphic(e){if(!this._idToClientGraphic)return;const r=this.sourceJSON.objectIdField,i=e.attributes&&e.attributes[r];i!=null&&this._idToClientGraphic.set(i,e)}get _layerOrSourceGeometryType(){return this.layer?.geometryType??this.sourceJSON?.geometryType}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this._layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return e==="mesh"||e==="multipatch"||e==="extent"}_serializeFeature(e){const{attributes:r}=e,i=this._geometryForSerialization(e),s=(rEt++).toString();return i?{uid:s,geometry:i.toJSON(),attributes:r}:{uid:s,attributes:r}}_geometryForSerialization(e){const{geometry:r}=e;return r==null?null:this._geometryRequiresClientGraphicMapping(r)?r.extent?Su.fromExtent(r.extent):null:r}async _startWorker(e){this._connection=await A1e("MemorySourceWorker",{strategy:ae("feature-layers-workers")?"dedicated":"local",signal:e});const{fields:r,spatialReference:i,objectIdField:s,hasM:n,hasZ:o,timeInfo:a}=this.layer,l=this.layer.originOf("spatialReference")==="defaults";await this._prepareClientMapping(this.items,e);const c=this._prepareAddFeatures(this.items);this.handles.add(this.on("before-changes",m=>{e7.error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),m.preventDefault()}));const h={features:c.features,fields:r&&r.map(m=>m.toJSON()),geometryType:Qre.toJSON(this._workerGeometryType),hasM:this._layerOrSourceGeometryType!=="mesh"&&n,hasZ:this._layerOrSourceGeometryType==="mesh"||o,objectIdField:s,spatialReference:l?null:i&&i.toJSON(),timeInfo:a?a.toJSON():null},d=await this._connection.invoke("load",h,{signal:e});for(const m of d.warnings)e7.warn(m.message,{layer:this.layer,warning:m});d.featureErrors.length&&e7.warn(`Encountered ${d.featureErrors.length} validation errors while loading features`,d.featureErrors);const f=d.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(c.inferredGeometryType)&&(f.geometryType=Qre.toJSON(c.inferredGeometryType)),this.sourceJSON=f,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),c.finish(d.assignedObjectIds)}};u([zY({Type:Bl,ensureType:ws(Bl)})],Dg.prototype,"itemType",void 0),u([p()],Dg.prototype,"type",void 0),u([p({constructOnly:!0})],Dg.prototype,"layer",void 0),u([p({readOnly:!0})],Dg.prototype,"_workerGeometryType",null),u([p()],Dg.prototype,"sourceJSON",void 0),Dg=u([P(jIe)],Dg);const Rfe={read:{reader:JK},write:{allowNull:!0,writer:QK}},iEt=t=>{let e=class extends t{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return u([p({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}})],e.prototype,"blendMode",void 0),u([p({json:{read:!1,write:!1,origins:{"web-map":Rfe,"portal-item":Rfe}}})],e.prototype,"effect",void 0),e=u([P("esri.layers.mixins.BlendLayer")],e),e},sEt=t=>{let e=class extends t{constructor(){super(...arguments),this.customParameters=null}};return u([p({type:Object,json:{write:{overridePolicy:r=>({enabled:!!(r&&Object.keys(r).length>0)})}}})],e.prototype,"customParameters",void 0),e=u([P("esri.layers.mixins.CustomParametersMixin")],e),e};var xX;let Y2=xX=class extends ue{constructor(t){super(t),this.type="map-layer"}clone(){const{mapLayerId:t,gdbVersion:e}=this;return new xX({mapLayerId:t,gdbVersion:e})}};u([nt({mapLayer:"map-layer"})],Y2.prototype,"type",void 0),u([p({type:Ki,json:{write:!0}})],Y2.prototype,"mapLayerId",void 0),u([p({type:String,json:{write:!0}})],Y2.prototype,"gdbVersion",void 0),Y2=xX=u([P("esri.layers.support.source.MapLayerSource")],Y2);var TX;let Ag=TX=class extends ue{constructor(t){super(t),this.type="query-table"}clone(){const{workspaceId:t,query:e,oidFields:r,spatialReference:i,geometryType:s}=this,n={workspaceId:t,query:e,oidFields:r,spatialReference:i?.clone()??void 0,geometryType:s};return new TX(n)}};u([nt({queryTable:"query-table"})],Ag.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],Ag.prototype,"workspaceId",void 0),u([p({type:String,json:{write:!0}})],Ag.prototype,"query",void 0),u([p({type:String,json:{write:!0}})],Ag.prototype,"oidFields",void 0),u([p({type:qe,json:{write:!0}})],Ag.prototype,"spatialReference",void 0),u([nt(c_e)],Ag.prototype,"geometryType",void 0),Ag=TX=u([P("esri.layers.support.source.QueryTableDataSource")],Ag);var SX;let Z2=SX=class extends ue{constructor(t){super(t),this.type="raster"}clone(){const{workspaceId:t,dataSourceName:e}=this;return new SX({workspaceId:t,dataSourceName:e})}};u([nt({raster:"raster"})],Z2.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],Z2.prototype,"dataSourceName",void 0),u([p({type:String,json:{write:!0}})],Z2.prototype,"workspaceId",void 0),Z2=SX=u([P("esri.layers.support.source.RasterDataSource")],Z2);var EX;let Ob=EX=class extends ue{constructor(t){super(t),this.type="table"}clone(){const{workspaceId:t,gdbVersion:e,dataSourceName:r}=this;return new EX({workspaceId:t,gdbVersion:e,dataSourceName:r})}};u([nt({table:"table"})],Ob.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],Ob.prototype,"workspaceId",void 0),u([p({type:String,json:{write:!0}})],Ob.prototype,"gdbVersion",void 0),u([p({type:String,json:{write:!0}})],Ob.prototype,"dataSourceName",void 0),Ob=EX=u([P("esri.layers.support.source.TableDataSource")],Ob);var CX,AX;const nEt=ll()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let su=CX=class extends ue{constructor(t){super(t),this.type="join-table"}readLeftTableSource(t,e,r){return Mfe()(t,e,r)}castLeftTableSource(t){return Ap(OX(),t)}readRightTableSource(t,e,r){return Mfe()(t,e,r)}castRightTableSource(t){return Ap(OX(),t)}clone(){const{leftTableKey:t,rightTableKey:e,leftTableSource:r,rightTableSource:i,joinType:s}=this,n={leftTableKey:t,rightTableKey:e,leftTableSource:r?.clone()??void 0,rightTableSource:i?.clone()??void 0,joinType:s};return new CX(n)}};u([nt({joinTable:"join-table"})],su.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],su.prototype,"leftTableKey",void 0),u([p({type:String,json:{write:!0}})],su.prototype,"rightTableKey",void 0),u([p({json:{write:!0}})],su.prototype,"leftTableSource",void 0),u([Oe("leftTableSource")],su.prototype,"readLeftTableSource",null),u([wr("leftTableSource")],su.prototype,"castLeftTableSource",null),u([p({json:{write:!0}})],su.prototype,"rightTableSource",void 0),u([Oe("rightTableSource")],su.prototype,"readRightTableSource",null),u([wr("rightTableSource")],su.prototype,"castRightTableSource",null),u([nt(nEt)],su.prototype,"joinType",void 0),su=CX=u([P("esri.layers.support.source.JoinTableDataSource")],su);let t7=null;function Mfe(){return t7||(t7=yC({types:OX()})),t7}let r7=null;function OX(){return r7||(r7={key:"type",base:null,typeMap:{"data-layer":tp,"map-layer":Y2}}),r7}const oEt={key:"type",base:null,typeMap:{"join-table":su,"query-table":Ag,raster:Z2,table:Ob}};let tp=AX=class extends ue{constructor(t){super(t),this.type="data-layer"}clone(){const{fields:t,dataSource:e}=this;return new AX({fields:t,dataSource:e})}};u([nt({dataLayer:"data-layer"})],tp.prototype,"type",void 0),u([p({type:[y9],json:{write:!0}})],tp.prototype,"fields",void 0),u([p({types:oEt,json:{write:!0}})],tp.prototype,"dataSource",void 0),tp=AX=u([P("esri.layers.support.source.DataLayerSource")],tp),tp.from=ws(tp);let Rb=class extends Hi(ue){constructor(e){super(e),this.onFields=null,this.operator=null,this.searchTerm=null,this.searchType=null}};u([p({type:[String],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.onFields!=null&&this.onFields.length>0}}}}})],Rb.prototype,"onFields",void 0),u([p({type:String,json:{write:!0}})],Rb.prototype,"operator",void 0),u([p({type:String,json:{write:!0}})],Rb.prototype,"searchTerm",void 0),u([p({type:String,json:{write:!0}})],Rb.prototype,"searchType",void 0),Rb=u([P("esri.rest.support.FullTextSearch")],Rb);const HIe=Rb;var RX;const Pfe=new $r({upperLeft:"upper-left",lowerLeft:"lower-left"});let Mb=RX=class extends ue{constructor(t){super(t),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new RX(ee({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};u([p({type:cr,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],Mb.prototype,"extent",void 0),u([p({type:["view","edit"],json:{write:!0}})],Mb.prototype,"mode",void 0),u([p({type:String,json:{read:Pfe.read,write:Pfe.write}})],Mb.prototype,"originPosition",void 0),u([p({type:Number,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],Mb.prototype,"tolerance",void 0),Mb=RX=u([P("esri.rest.support.QuantizationParameters")],Mb);const aEt=Mb;var MX;const Ife=new $r({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let jd=MX=class extends ue{constructor(t){super(t),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(t,e){this.statisticType!=="percentile-continuous"&&this.statisticType!=="percentile-discrete"||(e.statisticParameters=ee(t))}clone(){return new MX({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:ee(this.statisticParameters)})}};u([p({type:Number,json:{write:!0}})],jd.prototype,"maxPointCount",void 0),u([p({type:Number,json:{write:!0}})],jd.prototype,"maxRecordCount",void 0),u([p({type:Number,json:{write:!0}})],jd.prototype,"maxVertexCount",void 0),u([p({type:String,json:{write:!0}})],jd.prototype,"onStatisticField",void 0),u([p({type:String,json:{write:!0}})],jd.prototype,"outStatisticFieldName",void 0),u([p({type:String,json:{read:{source:"statisticType",reader:Ife.read},write:{target:"statisticType",writer:Ife.write}}})],jd.prototype,"statisticType",void 0),u([p({type:Object})],jd.prototype,"statisticParameters",void 0),u([Be("statisticParameters")],jd.prototype,"writeStatisticParameters",null),jd=MX=u([P("esri.rest.support.StatisticDefinition")],jd);const lEt=jd;var tE;const cEt=new $r({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),uEt=new $r({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let $t=tE=class extends ue{static from(t){return Mw(tE,t)}constructor(t){super(t),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.fullText=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}castDatumTransformation(t){return typeof t=="number"||typeof t=="object"?t:null}writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeParameterValues(t,e){if(t){const r={};for(const i in t){const s=t[i];Array.isArray(s)?r[i]=s.map(n=>n instanceof Date?n.getTime():n):s instanceof Date?r[i]=s.getTime():r[i]=s}e.parameterValues=r}}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,e.where="1=1"}writeWhere(t,e){e.where=t||"1=1"}clone(){return new tE(ee({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,fullText:this.fullText,formatOf3DObjects:this.formatOf3DObjects,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:this.historicMoment!=null?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};$t.MAX_MAX_RECORD_COUNT_FACTOR=5,u([p({json:{write:!0}})],$t.prototype,"aggregateIds",void 0),u([p({type:Boolean,json:{write:!0}})],$t.prototype,"cacheHint",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],$t.prototype,"compactGeometryEnabled",void 0),u([p({json:{write:!0}})],$t.prototype,"datumTransformation",void 0),u([wr("datumTransformation")],$t.prototype,"castDatumTransformation",null),u([p({type:Boolean,json:{default:!1,write:!0}})],$t.prototype,"defaultSpatialReferenceEnabled",void 0),u([p({type:Number,json:{write:{overridePolicy:t=>({enabled:t>0})}}})],$t.prototype,"distance",void 0),u([p({type:tp,json:{write:!0}})],$t.prototype,"dynamicDataSource",void 0),u([p({type:String,json:{write:!0}})],$t.prototype,"formatOf3DObjects",void 0),u([p({type:[HIe],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.fullText!=null&&this.fullText.length>0}}}}})],$t.prototype,"fullText",void 0),u([p({type:String,json:{write:!0}})],$t.prototype,"gdbVersion",void 0),u([p({types:wx,json:{read:ov,write:!0}})],$t.prototype,"geometry",void 0),u([p({type:Number,json:{write:!0}})],$t.prototype,"geometryPrecision",void 0),u([p({type:[String],json:{write:!0}})],$t.prototype,"groupByFieldsForStatistics",void 0),u([p({type:String,json:{write:!0}})],$t.prototype,"having",void 0),u([p({type:Date})],$t.prototype,"historicMoment",void 0),u([Be("historicMoment")],$t.prototype,"writeHistoricMoment",null),u([p({type:Number,json:{write:!0}})],$t.prototype,"maxAllowableOffset",void 0),u([p({type:Number,cast:t=>t<1?1:t>tE.MAX_MAX_RECORD_COUNT_FACTOR?tE.MAX_MAX_RECORD_COUNT_FACTOR:t,json:{write:{overridePolicy:t=>({enabled:t>1})}}})],$t.prototype,"maxRecordCountFactor",void 0),u([p({type:["xyFootprint"],json:{write:!0}})],$t.prototype,"multipatchOption",void 0),u([p({type:Number,json:{read:{source:"resultRecordCount"}}})],$t.prototype,"num",void 0),u([p({json:{write:!0}})],$t.prototype,"objectIds",void 0),u([p({type:[String],json:{write:!0}})],$t.prototype,"orderByFields",void 0),u([p({type:[String],json:{write:!0}})],$t.prototype,"outFields",void 0),u([p({type:qe,json:{name:"outSR",write:!0}})],$t.prototype,"outSpatialReference",void 0),u([p({type:[lEt],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.outStatistics!=null&&this.outStatistics.length>0}}}}})],$t.prototype,"outStatistics",void 0),u([p({json:{write:!0}})],$t.prototype,"parameterValues",void 0),u([Be("parameterValues")],$t.prototype,"writeParameterValues",null),u([p({type:tt,json:{write:!0}})],$t.prototype,"pixelSize",void 0),u([p({type:aEt,json:{write:!0}})],$t.prototype,"quantizationParameters",void 0),u([p({type:[Object],json:{write:!0}})],$t.prototype,"rangeValues",void 0),u([p({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:this.spatialRelationship==="relation"}}}}})],$t.prototype,"relationParameter",void 0),u([p({type:String,json:{write:!0}})],$t.prototype,"resultType",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],$t.prototype,"returnCentroid",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],$t.prototype,"returnDistinctValues",void 0),u([p({type:Boolean,json:{default:!0,write:!0}})],$t.prototype,"returnExceededLimitFeatures",void 0),u([p({type:Boolean,json:{write:!0}})],$t.prototype,"returnGeometry",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],$t.prototype,"returnQueryGeometry",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],$t.prototype,"returnM",void 0),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],$t.prototype,"returnZ",void 0),u([p({type:qe,json:{write:!0}})],$t.prototype,"sourceSpatialReference",void 0),u([nt(cEt,{ignoreUnknown:!1,name:"spatialRel"})],$t.prototype,"spatialRelationship",void 0),u([p({type:Number,json:{read:{source:"resultOffset"}}})],$t.prototype,"start",void 0),u([Be("start"),Be("num")],$t.prototype,"writeStart",null),u([p({type:String,json:{write:!0}})],$t.prototype,"sqlFormat",void 0),u([p({type:String,json:{write:!0}})],$t.prototype,"text",void 0),u([p({type:Im,json:{write:!0}})],$t.prototype,"timeExtent",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],$t.prototype,"timeReferenceUnknownClient",void 0),u([nt(uEt,{ignoreUnknown:!1}),p({json:{write:{overridePolicy(t){return{enabled:!!t&&this.distance!=null&&this.distance>0}}}}})],$t.prototype,"units",void 0),u([p({type:String,json:{write:{overridePolicy(t){return{enabled:t!=null||this.start!=null&&this.start>0}}}}})],$t.prototype,"where",void 0),u([Be("where")],$t.prototype,"writeWhere",null),$t=tE=u([P("esri.rest.support.Query")],$t);const j0=$t;var PX;const i7=new $r({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),s7=new $r({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Mf=PX=class extends ue{constructor(t){super(t),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(t={}){const{where:e,geometry:r,spatialRelationship:i,timeExtent:s,objectIds:n,units:o,distance:a}=this;return new j0({geometry:ee(r),objectIds:ee(n),spatialRelationship:i,timeExtent:ee(s),where:e,units:o,distance:a,...t})}clone(){const{where:t,geometry:e,spatialRelationship:r,timeExtent:i,objectIds:s,units:n,distance:o}=this;return new PX({geometry:ee(e),objectIds:ee(s),spatialRelationship:r,timeExtent:ee(i),where:t,units:n,distance:o})}};u([p({type:String,json:{write:!0}})],Mf.prototype,"where",void 0),u([p({types:wx,json:{write:!0}})],Mf.prototype,"geometry",void 0),u([p({type:i7.apiValues,json:{name:"spatialRel",read:{reader:i7.read},write:{allowNull:!1,writer:i7.write,overridePolicy(){return{enabled:this.geometry!=null}}}}})],Mf.prototype,"spatialRelationship",void 0),u([p({type:Number,json:{write:{overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],Mf.prototype,"distance",void 0),u([p({type:[Number],json:{write:!0}})],Mf.prototype,"objectIds",void 0),u([p({type:s7.apiValues,json:{read:s7.read,write:{writer:s7.write,overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],Mf.prototype,"units",void 0),u([p({type:Im,json:{write:!0}})],Mf.prototype,"timeExtent",void 0),Mf=PX=u([P("esri.layers.support.FeatureFilter")],Mf);const hEt=Mf;var IX;const $fe={read:{reader:JK},write:{writer:QK,overridePolicy(){return{allowNull:this.excludedEffect!=null,isRequired:this.excludedEffect==null}}}},Lfe={read:{reader:JK},write:{writer:QK,overridePolicy(){return{allowNull:this.includedEffect!=null,isRequired:this.includedEffect==null}}}},Dfe={name:"showExcludedLabels",default:!0};let Pb=IX=class extends ue{constructor(t){super(t),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(t,e){const r=super.write(t,e);if(e?.origin){if(r.filter){const i=Object.keys(r.filter);if(i.length>1||i[0]!=="where")return e.messages?.push(new U("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:e.layer,effect:this})),null}if("showExcludedLabels"in r)return e.messages?.push(new U("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:e.layer,effect:this})),null}return r}clone(){return new IX({filter:this.filter!=null?this.filter.clone():null,includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};u([p({type:hEt,json:{write:{allowNull:!0,writer(t,e,r,i){const s=t?.write({},i);s&&Object.keys(s).length!==0?ol(r,s,e):ol(r,null,e)}}}})],Pb.prototype,"filter",void 0),u([p({json:{write:!0,origins:{"web-map":$fe,"portal-item":$fe}}})],Pb.prototype,"includedEffect",void 0),u([p({json:{write:!0,origins:{"web-map":Lfe,"portal-item":Lfe}}})],Pb.prototype,"excludedEffect",void 0),u([p({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":Dfe,"portal-item":Dfe}}})],Pb.prototype,"excludedLabelsVisible",void 0),Pb=IX=u([P("esri.layers.support.FeatureEffect")],Pb);const dEt=Pb,Nfe={write:{allowNull:!0}},pEt=t=>{let e=class extends t{constructor(){super(...arguments),this.featureEffect=null}};return u([p({type:dEt,json:{origins:{"web-map":Nfe,"portal-item":Nfe}}})],e.prototype,"featureEffect",void 0),e=u([P("esri.layers.mixins.FeatureEffectLayer")],e),e};let Og=class extends Hi(ue){constructor(e){super(e),this.creatorField=null,this.creationDateField=null,this.editorField=null,this.editDateField=null,this.realm=null,this.dateFieldsTimeReference=null}};u([p()],Og.prototype,"creatorField",void 0),u([p()],Og.prototype,"creationDateField",void 0),u([p()],Og.prototype,"editorField",void 0),u([p()],Og.prototype,"editDateField",void 0),u([p()],Og.prototype,"realm",void 0),u([p({type:$E})],Og.prototype,"dateFieldsTimeReference",void 0),Og=u([P("esri.layers.support.EditFieldsInfo")],Og);const fEt=Og;let $f=class extends Hi(ue){constructor(e){super(e)}};u([p({constructOnly:!0,json:{write:!0}})],$f.prototype,"name",void 0),u([p({constructOnly:!0,json:{write:!0}})],$f.prototype,"fields",void 0),u([p({constructOnly:!0,json:{write:!0}})],$f.prototype,"isAscending",void 0),u([p({constructOnly:!0,json:{write:!0}})],$f.prototype,"indexType",void 0),u([p({constructOnly:!0,json:{write:!0}})],$f.prototype,"isUnique",void 0),u([p({constructOnly:!0,json:{write:!0}})],$f.prototype,"description",void 0),$f=u([P("esri.layers.support.FeatureIndex")],$f);var $X;let No=$X=class extends ue{constructor(t){super(t),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new $X(ee({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};u([p({type:[String],json:{write:!0}})],No.prototype,"attachmentTypes",void 0),u([p({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],No.prototype,"attachmentsWhere",void 0),u([p({type:Boolean,json:{write:!0}})],No.prototype,"cacheHint",void 0),u([p({type:[String],json:{write:!0}})],No.prototype,"keywords",void 0),u([p({type:[Number],json:{write:!0}})],No.prototype,"globalIds",void 0),u([p({json:{write:!0}})],No.prototype,"name",void 0),u([p({type:Number,json:{read:{source:"resultRecordCount"}}})],No.prototype,"num",void 0),u([p({type:[Number],json:{write:!0}})],No.prototype,"objectIds",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],No.prototype,"returnMetadata",void 0),u([p({type:[Number],json:{write:!0}})],No.prototype,"size",void 0),u([p({type:Number,json:{read:{source:"resultOffset"}}})],No.prototype,"start",void 0),u([Be("start"),Be("num")],No.prototype,"writeStart",null),u([p({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],No.prototype,"where",void 0),No=$X=u([P("esri.rest.support.AttachmentQuery")],No),No.from=ws(No);const mEt=No;var LX;let Bs=LX=class extends ue{constructor(t){super(t),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,this.start>0&&this.where==null&&(e.definitionExpression="1=1")}clone(){return new LX(ee({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};u([p({type:Boolean,json:{write:!0}})],Bs.prototype,"cacheHint",void 0),u([p({type:tp,json:{write:!0}})],Bs.prototype,"dynamicDataSource",void 0),u([p({type:String,json:{write:!0}})],Bs.prototype,"gdbVersion",void 0),u([p({type:Number,json:{write:!0}})],Bs.prototype,"geometryPrecision",void 0),u([p({type:Date})],Bs.prototype,"historicMoment",void 0),u([Be("historicMoment")],Bs.prototype,"_writeHistoricMoment",null),u([p({type:Number,json:{write:!0}})],Bs.prototype,"maxAllowableOffset",void 0),u([p({type:[Number],json:{write:!0}})],Bs.prototype,"objectIds",void 0),u([p({type:[String],json:{write:!0}})],Bs.prototype,"orderByFields",void 0),u([p({type:[String],json:{write:!0}})],Bs.prototype,"outFields",void 0),u([p({type:qe,json:{read:{source:"outSR"},write:{target:"outSR"}}})],Bs.prototype,"outSpatialReference",void 0),u([p({json:{write:!0}})],Bs.prototype,"relationshipId",void 0),u([p({type:Number,json:{read:{source:"resultOffset"}}})],Bs.prototype,"start",void 0),u([Be("start"),Be("num")],Bs.prototype,"writeStart",null),u([p({type:Number,json:{read:{source:"resultRecordCount"}}})],Bs.prototype,"num",void 0),u([p({json:{write:!0}})],Bs.prototype,"returnGeometry",void 0),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Bs.prototype,"returnM",void 0),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Bs.prototype,"returnZ",void 0),u([p({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],Bs.prototype,"where",void 0),Bs=LX=u([P("esri.rest.support.RelationshipQuery")],Bs),Bs.from=ws(Bs);const ite=Bs,YYt=Object.freeze(Object.defineProperty({__proto__:null,default:ite},Symbol.toStringTag,{value:"Module"})),DX=new $r({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function gEt(t,e,r,i){const s=await zv(t);if(await ste(t,e,i),!s.addAttachment)throw new U(i,"Layer source does not support addAttachment capability");return s.addAttachment(e,r)}function ste(t,e,r){const{attributes:i}=e,{objectIdField:s}=t;return t.get("capabilities.data.supportsAttachment")?e?i?s&&i[s]?Promise.resolve():Promise.reject(new U(r,`feature is missing the identifying attribute ${s}`)):Promise.reject(new U(r,"'attributes' are required on a feature to query attachments")):Promise.reject(new U(r,"A feature is required to add/delete/update attachments")):Promise.reject(new U(r,"this layer doesn't support attachments"))}async function yEt(t,e,r,i,s){const n=await zv(t);if(await ste(t,e,s),!n.updateAttachment)throw new U(s,"Layer source does not support updateAttachment capability");return n.updateAttachment(e,r,i)}async function _Et(t,e,r){const{applyEdits:i}=await he(()=>import("./editingSupport-59a69552.js"),["./editingSupport-59a69552.js","./normalizeUtils-ca47990d.js","./normalizeUtilsCommon-448ddeb2.js"],import.meta.url),s=await t.load();return i(s,s.source,e,r)}async function vEt(t,e,r){const{uploadAssets:i}=await he(()=>import("./editingSupport-59a69552.js"),["./editingSupport-59a69552.js","./normalizeUtils-ca47990d.js","./normalizeUtilsCommon-448ddeb2.js"],import.meta.url),s=await t.load();return i(s,s.source,e,r)}async function bEt(t,e,r,i){const s=await zv(t);if(await ste(t,e,i),!s.deleteAttachments)throw new U(i,"Layer source does not support deleteAttachments capability");return s.deleteAttachments(e,r)}async function wEt(t,e,r){const i=(await t.load({signal:e?.signal})).source;if(!i.fetchRecomputedExtents)throw new U(r,"Layer source does not support fetchUpdates capability");return i.fetchRecomputedExtents(e)}async function xEt(t,e,r,i){e=mEt.from(e),await t.load();const s=t.source,n=t.capabilities;if(!n?.data?.supportsAttachment)throw new U(i,"this layer doesn't support attachments");const{attachmentTypes:o,objectIds:a,globalIds:l,num:c,size:h,start:d,where:f}=e;if(!n?.operations?.supportsQueryAttachments&&(o?.length>0||l?.length>0||h?.length>0||c||d||f))throw new U(i,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",e);if(!(a?.length||l?.length||f))throw new U(i,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",e);if(!s.queryAttachments)throw new U(i,"Layer source does not support queryAttachments capability",e);return s.queryAttachments(e)}async function TEt(t,e,r,i){const s=await zv(t);if(!s.queryObjectIds)throw new U(i,"Layer source does not support queryObjectIds capability");return s.queryObjectIds(j0.from(e)??t.createQuery(),r)}async function SEt(t,e,r,i){const s=await zv(t);if(!s.queryFeatureCount)throw new U(i,"Layer source does not support queryFeatureCount capability");return s.queryFeatureCount(j0.from(e)??t.createQuery(),r)}async function EEt(t,e,r,i){const s=await zv(t);if(!s.queryExtent)throw new U(i,"Layer source does not support queryExtent capability");return s.queryExtent(j0.from(e)??t.createQuery(),r)}async function CEt(t,e,r,i){const s=await zv(t);if(!s.queryRelatedFeatures)throw new U(i,"Layer source does not support queryRelatedFeatures capability");return s.queryRelatedFeatures(ite.from(e),r)}async function AEt(t,e,r,i){const s=await zv(t);if(!s.queryRelatedFeaturesCount)throw new U(i,"Layer source does not support queryRelatedFeaturesCount capability");return s.queryRelatedFeaturesCount(ite.from(e),r)}async function OEt(t){const e=t.source;if(e?.refresh)try{const{dataChanged:r,updates:i}=await e.refresh();if(i!=null&&(t.sourceJSON={...t.sourceJSON,...i},t.read(i,{origin:"service",url:t.parsedUrl})),r)return!0}catch{}if(t.definitionExpression)try{return(await zSt(t.definitionExpression,t.fieldsIndex)).hasDateFunctions}catch{}return!1}function REt(t){const e=new j0,r=t.get("capabilities.data"),i=t.get("capabilities.query");e.historicMoment=t.historicMoment,e.gdbVersion=t.gdbVersion,e.returnGeometry=!0,i&&(e.compactGeometryEnabled=i.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=i.supportsDefaultSpatialReference),r&&(r.supportsZ&&t.returnZ!=null&&(e.returnZ=t.returnZ),r.supportsM&&t.returnM!=null&&(e.returnM=t.returnM)),e.outFields=["*"];const{timeOffset:s,timeExtent:n}=t;return e.timeExtent=s!=null&&n!=null?n.offset(-s.value,s.unit):n||null,e.multipatchOption=t.geometryType==="multipatch"?"xyFootprint":null,e}function qIe(t){const{globalIdField:e,fields:r}=t;if(e)return e;if(r){for(const i of r)if(i.type==="esriFieldTypeGlobalID")return i.name}}function WIe(t){const{objectIdField:e,fields:r}=t;if(e)return e;if(r){for(const i of r)if(i.type==="esriFieldTypeOID")return i.name}}function MEt(t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}async function zv(t){return(await t.load()).source}async function PEt(t,e){if(!Ii||Ii.findCredential(t))return;let r;try{const i=await gye(t,e);i&&(r=await Ii.checkSignInStatus(`${i}/sharing`))}catch{}if(r)try{const i=e!=null?e.signal:null;await Ii.getCredential(t,{signal:i})}catch{}}async function IEt(t,e){const r=t.parsedUrl?.path;r&&$Et(t)&&await PEt(r,e)}function $Et(t){const e=t.editFieldsInfo;return!(!e?.creatorField&&!e?.editorField)||(t.userHasUpdateItemPrivileges?t.hasUpdateItemRestrictions:!!t.userHasFullEditingPrivileges&&t.hasFullEditingRestrictions)}function LEt(t){return!t.sourceJSON?.isMultiServicesView&&(t.userHasUpdateItemPrivileges||t.editingEnabled)}const n7=yC({types:b1e});function nte(t,e){if(t.defaultSymbol)return t.types&&t.types.length?new tU({defaultSymbol:n7(t.defaultSymbol,t,e),field:t.typeIdField,uniqueValueInfos:t.types.map(r=>({id:r.id,symbol:n7(r.symbol,r,e)}))}):new aI({symbol:n7(t.defaultSymbol,t,e)})}let J2=class extends Hi(ue){constructor(e){super(e),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};u([p({type:String,json:{read:{source:"shapeAreaFieldName"}}})],J2.prototype,"shapeAreaField",void 0),u([p({type:String,json:{read:{source:"shapeLengthFieldName"}}})],J2.prototype,"shapeLengthField",void 0),u([p({type:String,json:{read:t=>H5e.read(t)||q5e.read(t)}})],J2.prototype,"units",void 0),J2=u([P("esri.layers.support.GeometryFieldsInfo")],J2);const DEt=J2;var NX;let Q2=NX=class extends ue{constructor(t){super(t),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new Pt}clone(){return new NX({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};u([p({type:String,json:{write:!0}})],Q2.prototype,"floorField",void 0),u([p({json:{read:!1,write:!1}})],Q2.prototype,"viewAllMode",void 0),u([p({json:{read:!1,write:!1}})],Q2.prototype,"viewAllLevelIds",void 0),Q2=NX=u([P("esri.layers.support.LayerFloorInfo")],Q2);const XIe=Q2,Ffe=new $r({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),Ufe=new $r({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let ph=class extends Hi(ue){constructor(e){super(e),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};u([p({json:{read:Ffe.read,write:Ffe.write}})],ph.prototype,"cardinality",void 0),u([p({json:{read:!0,write:!0}})],ph.prototype,"composite",void 0),u([p({json:{read:!0,write:!0}})],ph.prototype,"id",void 0),u([p({json:{read:!0,write:!0}})],ph.prototype,"keyField",void 0),u([p({json:{read:!0,write:!0}})],ph.prototype,"keyFieldInRelationshipTable",void 0),u([p({json:{read:!0,write:!0}})],ph.prototype,"name",void 0),u([p({json:{read:!0,write:!0}})],ph.prototype,"relatedTableId",void 0),u([p({json:{read:!0,write:!0}})],ph.prototype,"relationshipTableId",void 0),u([p({json:{read:Ufe.read,write:Ufe.write}})],ph.prototype,"role",void 0),ph=u([P("esri.layers.support.Relationship")],ph);const NEt=ph,FEt={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"};function Ut(t,e,r){return!!YIe(t,e,r)}function dD(t,e,r){return YIe(t,e,r)}function YIe(t,e,r){return t&&t.hasOwnProperty(e)?t[e]:r}function UEt(t){const e=t?.supportedSpatialAggregationStatistics?.map(r=>r.toLowerCase());return{envelope:!!e?.includes("envelopeaggregate"),centroid:!!e?.includes("centroidaggregate"),convexHull:!!e?.includes("convexhullaggregate")}}function lI(t,e){return!!t?.supportedOperationsWithCacheHint?.map(i=>i.toLowerCase())?.includes(e.toLowerCase())}function ZIe(t,e){return{analytics:kEt(t),attachment:zEt(t),data:VEt(t),metadata:BEt(t),operations:GEt(t.capabilities,t,e),query:jEt(t,e),queryRelated:HEt(t),queryTopFeatures:qEt(t),editing:WEt(t)}}function kEt(t){return{supportsCacheHint:lI(t.advancedQueryCapabilities,"queryAnalytics")}}function zEt(t){const e=t.attachmentProperties,r={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:lI(t.advancedQueryCapabilities,"queryAttachments"),supportsResize:Ut(t,"supportsAttachmentsResizing",!1)};return e&&Array.isArray(e)&&e.forEach(i=>{const s=FEt[i.name];s&&(r[s]=!!i.isEnabled)}),r}function VEt(t){return{isVersioned:Ut(t,"isDataVersioned",!1),supportsAttachment:Ut(t,"hasAttachments",!1),supportsM:Ut(t,"hasM",!1),supportsZ:Ut(t,"hasZ",!1)}}function BEt(t){return{supportsAdvancedFieldProperties:Ut(t,"supportsFieldDescriptionProperty",!1)}}function GEt(t,e,r){const i=t?t.toLowerCase().split(",").map(f=>f.trim()):[],s=r?Ix(r):null,n=i.includes(s!=null&&s.serverType==="MapServer"?"data":"query"),o=i.includes("editing")&&!e.datesInUnknownTimezone;let a=o&&i.includes("create"),l=o&&i.includes("delete"),c=o&&i.includes("update");const h=i.includes("changetracking"),d=e.advancedQueryCapabilities;return o&&!(a||l||c)&&(a=l=c=!0),{supportsCalculate:Ut(e,"supportsCalculate",!1),supportsTruncate:Ut(e,"supportsTruncate",!1),supportsValidateSql:Ut(e,"supportsValidateSql",!1),supportsAdd:a,supportsDelete:l,supportsEditing:o,supportsChangeTracking:h,supportsQuery:n,supportsQueryAnalytics:Ut(d,"supportsQueryAnalytic",!1),supportsQueryAttachments:Ut(d,"supportsQueryAttachments",!1),supportsQueryTopFeatures:Ut(d,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:Ut(e,"supportsAttachmentsResizing",!1),supportsSync:i.includes("sync"),supportsUpdate:c,supportsExceedsLimitStatistics:Ut(e,"supportsExceedsLimitStatistics",!1),supportsAsyncConvert3D:Ut(e,"supportsAsyncConvert3D",!1)}}function jEt(t,e){const r=t.advancedQueryCapabilities,i=t.ownershipBasedAccessControlForFeatures,s=t.archivingInfo,n=t.currentVersion,o=e?.includes("MapServer"),a=!o||n>=ae("mapserver-pbf-version-support"),l=VJ(e),c=new Set((t.supportedQueryFormats??"").split(",").map(h=>h.toLowerCase().trim()));return{supportsStatistics:Ut(r,"supportsStatistics",t.supportsStatistics),supportsPercentileStatistics:Ut(r,"supportsPercentileStatistics",!1),supportsSpatialAggregationStatistics:Ut(r,"supportsSpatialAggregationStatistics",!1),supportedSpatialAggregationStatistics:UEt(r),supportsCentroid:Ut(r,"supportsReturningGeometryCentroid",!1),supportsDistance:Ut(r,"supportsQueryWithDistance",!1),supportsDistinct:Ut(r,"supportsDistinct",t.supportsAdvancedQueries),supportsExtent:Ut(r,"supportsReturningQueryExtent",!1),supportsGeometryProperties:Ut(r,"supportsReturningGeometryProperties",!1),supportsHavingClause:Ut(r,"supportsHavingClause",!1),supportsOrderBy:Ut(r,"supportsOrderBy",t.supportsAdvancedQueries),supportsPagination:Ut(r,"supportsPagination",!1),supportsQuantization:Ut(t,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:Ut(t,"supportsQuantizationEditMode",!1),supportsQueryGeometry:Ut(t,"supportsReturningQueryGeometry",!1),supportsResultType:Ut(r,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:Ut(r,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:Ut(r,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:Ut(t,"useStandardizedQueries",!1),supportsTopFeaturesQuery:Ut(r,"supportsTopFeaturesQuery",!1),supportsQueryByOthers:Ut(i,"allowOthersToQuery",!0),supportsHistoricMoment:Ut(s,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:a&&c.has("pbf"),supportsDisjointSpatialRelationship:Ut(r,"supportsDisjointSpatialRel",!1),supportsCacheHint:Ut(r,"supportsQueryWithCacheHint",!1)||lI(r,"query"),supportsDefaultSpatialReference:Ut(r,"supportsDefaultSR",!1),supportsCompactGeometry:l,supportsFullTextSearch:Ut(r,"supportsFullTextSearch",!1),maxRecordCountFactor:dD(t,"maxRecordCountFactor",void 0),maxRecordCount:dD(t,"maxRecordCount",void 0),standardMaxRecordCount:dD(t,"standardMaxRecordCount",void 0),tileMaxRecordCount:dD(t,"tileMaxRecordCount",void 0)}}function HEt(t){const e=t.advancedQueryCapabilities,r=Ut(e,"supportsAdvancedQueryRelated",!1);return{supportsPagination:Ut(e,"supportsQueryRelatedPagination",!1),supportsCount:r,supportsOrderBy:r,supportsCacheHint:lI(e,"queryRelated")}}function qEt(t){return{supportsCacheHint:lI(t.advancedQueryCapabilities,"queryTopFilter")}}function WEt(t){const e=t.ownershipBasedAccessControlForFeatures,r=t?t.advancedEditingCapabilities:void 0;return{supportsGeometryUpdate:Ut(t,"allowGeometryUpdates",!0),supportsGlobalId:Ut(t,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:Ut(t,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:Ut(t,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:Ut(t,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:Ut(t,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:Ut(e,"allowAnonymousToDelete",!0),supportsDeleteByOthers:Ut(e,"allowOthersToDelete",!0),supportsUpdateByAnonymous:Ut(e,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:Ut(e,"allowOthersToUpdate",!0),supportsAsyncApplyEdits:Ut(r,"supportsAsyncApplyEdits",!1)}}const XEt=t=>{let e=class extends t{constructor(){super(...arguments),this.capabilities=null,this.copyright=null,this.dateFieldsTimeReference=null,this.datesInUnknownTimezone=!1,this.displayField=null,this.definitionExpression=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.floorInfo=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.isTable=!1,this.layerId=void 0,this.minScale=0,this.maxScale=0,this.globalIdField=null,this.objectIdField=null,this.preferredTimeReference=null,this.relationships=null,this.sourceJSON=null,this.returnM=void 0,this.returnZ=void 0,this.serviceDefinitionExpression=null,this.serviceItemId=null,this.spatialReference=qe.WGS84,this.subtypeField=null,this.trackIdField=null,this.indexes=new(Pt.ofType($f)),this.version=void 0}readCapabilitiesFromService(r,i){return ZIe(i,this.url)}get effectiveCapabilities(){const r=this.capabilities;if(!r)return null;const i=ee(r),{operations:s,editing:n}=i;return this.sourceJSON?.isMultiServicesView?(this.userHasUpdateItemPrivileges&&(s.supportsQuery=!0),i):this.userHasUpdateItemPrivileges?(s.supportsAdd=s.supportsDelete=s.supportsEditing=s.supportsQuery=s.supportsUpdate=n.supportsDeleteByOthers=n.supportsGeometryUpdate=n.supportsUpdateByOthers=!0,i):(this.userHasFullEditingPrivileges&&s.supportsEditing&&(s.supportsAdd=s.supportsDelete=s.supportsUpdate=n.supportsGeometryUpdate=!0),i)}get hasFullEditingRestrictions(){const r=this.capabilities;if(!r||this.sourceJSON?.isMultiServicesView)return!1;const{operations:i,editing:s}=r;return i.supportsEditing&&!(i.supportsAdd&&i.supportsDelete&&i.supportsUpdate&&s.supportsGeometryUpdate)}get hasUpdateItemRestrictions(){const r=this.capabilities;if(!r)return!1;const{operations:i,editing:s}=r;return this.sourceJSON?.isMultiServicesView?!i.supportsQuery:!(i.supportsAdd&&i.supportsDelete&&i.supportsEditing&&i.supportsQuery&&i.supportsUpdate&&s.supportsDeleteByOthers&&s.supportsGeometryUpdate&&s.supportsUpdateByOthers)}readEditingInfo(r,i){const{editingInfo:s}=i;return s?{lastEditDate:s.lastEditDate!=null?new Date(s.lastEditDate):null}:null}readIsTableFromService(r,i){return i.type==="Table"}readMinScale(r,i){return i.effectiveMinScale||r||0}readMaxScale(r,i){return i.effectiveMaxScale||r||0}readGlobalIdFieldFromService(r,i){return qIe(i)}readObjectIdFieldFromService(r,i){return WIe(i)}readServiceDefinitionExpression(r,i){return i.definitionQuery||i.definitionExpression}set url(r){const i=Qwe({layer:this,url:r,nonStandardUrlAllowed:!0,logger:K.getLogger(this)});this._set("url",i.url),i.layerId!=null&&this._set("layerId",i.layerId)}writeUrl(r,i,s,n){Kwe(this,r,null,i,n)}readVersion(r,i){return MEt(i)}};return u([p({readOnly:!0,json:{read:!1,origins:{service:{read:{source:["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"]}}}}})],e.prototype,"capabilities",void 0),u([Oe("service","capabilities")],e.prototype,"readCapabilitiesFromService",null),u([p({readOnly:!0})],e.prototype,"effectiveCapabilities",null),u([p({readOnly:!0})],e.prototype,"hasFullEditingRestrictions",null),u([p({readOnly:!0})],e.prototype,"hasUpdateItemRestrictions",null),u([p({type:String,json:{origins:{service:{read:{source:"copyrightText"}}}}})],e.prototype,"copyright",void 0),u([p({type:$E})],e.prototype,"dateFieldsTimeReference",void 0),u([p({type:Boolean})],e.prototype,"datesInUnknownTimezone",void 0),u([p({type:String,json:{origins:{service:{read:{source:"displayField"}}}}})],e.prototype,"displayField",void 0),u([p({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],e.prototype,"definitionExpression",void 0),u([p({readOnly:!0,type:fEt})],e.prototype,"editFieldsInfo",void 0),u([p({readOnly:!0})],e.prototype,"editingInfo",void 0),u([Oe("editingInfo")],e.prototype,"readEditingInfo",null),u([p((()=>{const r=ee(EIe),i=r.json.origins;return i["web-map"]={read:!1,write:!1},i["portal-item"]={read:!1,write:!1},r})())],e.prototype,"elevationInfo",void 0),u([p({type:XIe,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],e.prototype,"floorInfo",void 0),u([p({type:cr,json:{origins:{service:{read:{source:"extent"}}}}})],e.prototype,"fullExtent",void 0),u([p()],e.prototype,"gdbVersion",void 0),u([p({readOnly:!0,type:DEt,json:{read:{source:"geometryProperties"}}})],e.prototype,"geometryFieldsInfo",void 0),u([p({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:DX.read}}}})],e.prototype,"geometryType",void 0),u([p({type:Boolean,json:{origins:{service:{read:!0}}}})],e.prototype,"hasM",void 0),u([p({type:Boolean,json:{origins:{service:{read:!0}}}})],e.prototype,"hasZ",void 0),u([p({readOnly:!0,type:Ax})],e.prototype,"heightModelInfo",void 0),u([p({type:Date})],e.prototype,"historicMoment",void 0),u([p({readOnly:!0})],e.prototype,"isTable",void 0),u([Oe("service","isTable",["type"])],e.prototype,"readIsTableFromService",null),u([p({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],e.prototype,"layerId",void 0),u([p(TSt)],e.prototype,"minScale",void 0),u([Oe("service","minScale",["minScale","effectiveMinScale"])],e.prototype,"readMinScale",null),u([p(SSt)],e.prototype,"maxScale",void 0),u([Oe("service","maxScale",["maxScale","effectiveMaxScale"])],e.prototype,"readMaxScale",null),u([p({type:String})],e.prototype,"globalIdField",void 0),u([Oe("service","globalIdField",["globalIdField","fields"])],e.prototype,"readGlobalIdFieldFromService",null),u([p({type:String})],e.prototype,"objectIdField",void 0),u([Oe("service","objectIdField",["objectIdField","fields"])],e.prototype,"readObjectIdFieldFromService",null),u([p({type:$E})],e.prototype,"preferredTimeReference",void 0),u([p({type:[NEt],readOnly:!0})],e.prototype,"relationships",void 0),u([p()],e.prototype,"sourceJSON",void 0),u([p({type:Boolean})],e.prototype,"returnM",void 0),u([p({type:Boolean})],e.prototype,"returnZ",void 0),u([p({readOnly:!0})],e.prototype,"serviceDefinitionExpression",void 0),u([Oe("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],e.prototype,"readServiceDefinitionExpression",null),u([p({type:String,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],e.prototype,"serviceItemId",void 0),u([p({type:qe,json:{origins:{service:{read:{source:"extent.spatialReference"}}}}})],e.prototype,"spatialReference",void 0),u([p({type:String,readOnly:!0,json:{origins:{service:{read:!0}}}})],e.prototype,"subtypeField",void 0),u([p({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],e.prototype,"trackIdField",void 0),u([p({readOnly:!0,json:{write:!1}})],e.prototype,"serverGens",void 0),u([p({type:Pt.ofType($f),readOnly:!0})],e.prototype,"indexes",void 0),u([p(TIe)],e.prototype,"url",null),u([Be("url")],e.prototype,"writeUrl",null),u([p({json:{origins:{service:{read:!0}},read:!1}})],e.prototype,"version",void 0),u([Oe("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],e.prototype,"readVersion",null),e=u([P("esri.layers.mixins.FeatureLayerBase")],e),e};let K2=class extends Hi(ue){constructor(e){super(e),this.expression=null,this.title=null,this.returnType=null}};u([p({type:String,json:{write:!0}})],K2.prototype,"expression",void 0),u([p({type:String,json:{write:!0}})],K2.prototype,"title",void 0),u([p({type:String,json:{write:!0}})],K2.prototype,"returnType",void 0),K2=u([P("esri.layers.support.ExpressionInfo")],K2);const ote=K2;var FX;let Rg=FX=class extends ue{constructor(t){super(t),this.isAutoGenerated=!1,this.name=null,this.alias=null,this.onStatisticField=null,this.onStatisticExpression=null,this.statisticType=null}clone(){return new FX({name:this.name,alias:this.alias,isAutoGenerated:this.isAutoGenerated,onStatisticExpression:ee(this.onStatisticExpression),onStatisticField:this.onStatisticField,statisticType:this.statisticType})}};u([p({type:Boolean,json:{write:!0}})],Rg.prototype,"isAutoGenerated",void 0),u([p({type:String,json:{write:!0}})],Rg.prototype,"name",void 0),u([p({type:String,json:{write:!0}})],Rg.prototype,"alias",void 0),u([p({type:String,json:{write:!0}})],Rg.prototype,"onStatisticField",void 0),u([p({type:ote,json:{write:!0}})],Rg.prototype,"onStatisticExpression",void 0),u([p({type:String,json:{write:!0}})],Rg.prototype,"statisticType",void 0),Rg=FX=u([P("esri.layers.support.AggregateField")],Rg);const dx=Rg;var UX;let n_=UX=class extends ue{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(t,e){return e.value?gq(e.value):t}writeExpression(t,e,r){this.value!=null&&(t=gq(this.value)),t!=null&&(e[r]=t)}clone(){return new UX({expression:this.expression,title:this.title,value:this.value})}};u([p({type:String,json:{write:{writerEnsuresNonNull:!0}}})],n_.prototype,"expression",void 0),u([Oe("expression",["expression","value"])],n_.prototype,"readExpression",null),u([Be("expression")],n_.prototype,"writeExpression",null),u([p({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],n_.prototype,"title",void 0),u([p({json:{read:!1,write:!1}})],n_.prototype,"value",void 0),n_=UX=u([P("esri.layers.support.LabelExpressionInfo")],n_);const JIe=n_,QIe=[252,146,31,255],KYt=[153,153,153,255],YEt={type:"esriSMS",style:"esriSMSCircle",size:6,color:QIe,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},ZEt={type:"esriSLS",style:"esriSLSSolid",width:.75,color:QIe},JEt={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},QEt={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},KEt={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},eCt={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},tCt={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},eZt=$v.fromJSON(YEt),tZt=zu.fromJSON(ZEt),rZt=Iv.fromJSON(JEt),rCt=Ex.fromJSON(QEt);$v.fromJSON(KEt);zu.fromJSON(eCt);Iv.fromJSON(tCt);var kX;const pD=new $r({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function fD(t,e,r){return{enabled:!fye(r?.layer)}}function KIe(t){return!t||t.origin!=="service"&&t.layer?.type!=="map-image"}function iCt(t){return t?.type==="map-image"}function e$e(t){return!!iCt(t)&&!!t.capabilities?.exportMap?.supportsArcadeExpressionForLabeling}function sCt(t){return KIe(t)||e$e(t?.layer)}let sn=kX=class extends ue{static evaluateWhere(t,e){const r=(i,s,n)=>{switch(s){case"=":return i==n;case"<>":return i!=n;case">":return i>n;case">=":return i>=n;case"<":return i<n;case"<=":return i<=n}return!1};try{if(t==null)return!0;const i=t.split(" ");if(i.length===3)return r(e[i[0]],i[1],i[2]);if(i.length===7){const s=r(e[i[0]],i[1],i[2]),n=i[3],o=r(e[i[4]],i[5],i[6]);switch(n){case"AND":return s&&o;case"OR":return s||o}}return!1}catch{console.log("Error.: can't parse = "+t)}}constructor(t){super(t),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=rCt,this.useCodedValues=void 0,this.where=null}readLabelExpression(t,e){const r=e.labelExpressionInfo;if(!r||!r.value&&!r.expression)return t}writeLabelExpression(t,e,r){if(this.labelExpressionInfo){if(this.labelExpressionInfo.value!=null)t=uit(this.labelExpressionInfo.value);else if(this.labelExpressionInfo.expression!=null){const i=dK(this.labelExpressionInfo.expression);i&&(t="["+i+"]")}}t!=null&&(e[r]=t)}writeLabelExpressionInfo(t,e,r,i){if(t==null&&this.labelExpression!=null&&KIe(i))t=new JIe({expression:this.getLabelExpressionArcade()});else if(!t)return;const s=t.toJSON(i);s.expression&&(e[r]=s)}writeMaxScale(t,e){(t||this.minScale)&&(e.maxScale=t)}writeMinScale(t,e){(t||this.maxScale)&&(e.minScale=t)}getLabelExpression(){return _9(this)}getLabelExpressionArcade(){return hit(this)}getLabelExpressionSingleField(){return dit(this)}hash(){return JSON.stringify(this)}clone(){return new kX({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:ee(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:ee(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};u([p({type:String,json:{write:!0}})],sn.prototype,"name",void 0),u([p({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1},"portal-item":{default:!1,write:{overridePolicy:fD}}}}})],sn.prototype,"allowOverrun",void 0),u([p({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1},"portal-item":{default:"static",write:{overridePolicy:fD}}}}})],sn.prototype,"deconflictionStrategy",void 0),u([p({type:String,json:{write:{overridePolicy(t,e,r){return this.labelExpressionInfo&&r?.origin==="service"&&e$e(r.layer)?{enabled:!1}:{allowNull:!0}}}}})],sn.prototype,"labelExpression",void 0),u([Oe("labelExpression")],sn.prototype,"readLabelExpression",null),u([Be("labelExpression")],sn.prototype,"writeLabelExpression",null),u([p({type:JIe,json:{write:{overridePolicy:(t,e,r)=>sCt(r)?{allowNull:!0}:{enabled:!1}}}})],sn.prototype,"labelExpressionInfo",void 0),u([Be("labelExpressionInfo")],sn.prototype,"writeLabelExpressionInfo",null),u([p({type:pD.apiValues,json:{type:pD.jsonValues,read:pD.read,write:pD.write}})],sn.prototype,"labelPlacement",void 0),u([p({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],sn.prototype,"labelPosition",void 0),u([p({type:Number})],sn.prototype,"maxScale",void 0),u([Be("maxScale")],sn.prototype,"writeMaxScale",null),u([p({type:Number})],sn.prototype,"minScale",void 0),u([Be("minScale")],sn.prototype,"writeMinScale",null),u([p({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:fD}}}}})],sn.prototype,"repeatLabel",void 0),u([p({type:Number,cast:ei,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:fD}}}}})],sn.prototype,"repeatLabelDistance",void 0),u([p({types:rVe,json:{origins:{"web-scene":{types:iVe,write:pce,default:null}},write:pce,default:null}})],sn.prototype,"symbol",void 0),u([p({type:Boolean,json:{write:!0}})],sn.prototype,"useCodedValues",void 0),u([p({type:String,json:{write:!0}})],sn.prototype,"where",void 0),sn=kX=u([P("esri.layers.support.LabelClass")],sn);const WC=sn;var zX;const nCt="esri.layers.support.FeatureReductionBinning";let Cl=zX=class extends c0{constructor(t){super(t),this.type="binning",this.binType="geohash",this.fixedBinLevel=3,this.labelingInfo=null,this.labelsVisible=!0,this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.fields=[],this.renderer=null}writeFields(t,e,r){const i=t.filter(s=>s.statisticType!=="avg_angle").map(s=>s.toJSON());ol(r,i,e)}readRenderer(t,e,r){const i=e.drawingInfo?.renderer;return i?eP(i,e,r)??void 0:nte(e,r)}clone(){return new zX({fields:ee(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:ee(this.labelingInfo),labelsVisible:this.labelsVisible,maxScale:this.maxScale,popupEnabled:this.popupEnabled,popupTemplate:ee(this.popupTemplate),renderer:ee(this.renderer)})}};u([nt({binning:"binning"})],Cl.prototype,"type",void 0),u([nt({geohash:"geohash"})],Cl.prototype,"binType",void 0),u([p({type:Number,range:{min:1,max:9},json:{write:!0}})],Cl.prototype,"fixedBinLevel",void 0),u([p({type:[WC],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],Cl.prototype,"labelingInfo",void 0),u([p(sU)],Cl.prototype,"labelsVisible",void 0),u([p({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],Cl.prototype,"maxScale",void 0),u([p(iU)],Cl.prototype,"popupEnabled",void 0),u([p({type:Rv,json:{name:"popupInfo",write:!0}})],Cl.prototype,"popupTemplate",void 0),u([p({type:[dx],json:{write:!0}})],Cl.prototype,"fields",void 0),u([Be("fields")],Cl.prototype,"writeFields",null),u([p({types:rU,json:{write:{target:"drawingInfo.renderer"}}})],Cl.prototype,"renderer",void 0),u([Oe("renderer",["drawingInfo.renderer"])],Cl.prototype,"readRenderer",null),Cl=zX=u([P(nCt)],Cl);const t$e=Cl;var VX;const oCt="esri.layers.support.FeatureReductionCluster";function kfe(t){return t.type==="simple"&&!t.visualVariables?.length}let Wn=VX=class extends ue{constructor(t){super(t),this.type="cluster",this.clusterRadius=ei("80px"),this.clusterMinSize=ei("12px"),this.clusterMaxSize=ei("50px"),this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=null}readRenderer(t,e,r){const i=e.drawingInfo?.renderer;return i?.authoringInfo?.isAutoGenerated?null:i?kfe(i)?null:eP(i,e,r)??void 0:nte(e,r)}readSymbol(t,e,r){const i=e.drawingInfo?.renderer;return i?.authoringInfo?.isAutoGenerated?null:i&&kfe(i)?eP(i,e,r)?.symbol:null}writeSymbol(t,e,r,i){const s=this.renderer?.authoringInfo?.isAutoGenerated;if(!this.renderer||s){const n=new aI({symbol:t});e.drawingInfo={renderer:n.write({},i)}}}writeFields(t,e,r){const i=t.filter(s=>s.statisticType!=="avg_angle").map(s=>s.toJSON());ol(r,i,e)}readFields(t,e,r){return t.filter(i=>!i.isAutoGenerated).map(i=>dx.fromJSON(i))}clone(){return new VX({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:ee(this.labelingInfo),labelsVisible:this.labelsVisible,fields:ee(this.fields),maxScale:this.maxScale,renderer:ee(this.renderer),symbol:ee(this.symbol),popupEnabled:this.popupEnabled,popupTemplate:ee(this.popupTemplate)})}};u([p({type:["cluster"],readOnly:!0,json:{write:!0}})],Wn.prototype,"type",void 0),u([p({type:Number,cast:t=>t==="auto"?t:ei(t),json:{write:!0}})],Wn.prototype,"clusterRadius",void 0),u([p({type:Number,cast:ei,json:{write:!0}})],Wn.prototype,"clusterMinSize",void 0),u([p({type:Number,cast:ei,json:{write:!0}})],Wn.prototype,"clusterMaxSize",void 0),u([p({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],Wn.prototype,"maxScale",void 0),u([p(iU)],Wn.prototype,"popupEnabled",void 0),u([p({type:Rv,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],Wn.prototype,"popupTemplate",void 0),u([p({types:rU,json:{write:{target:"drawingInfo.renderer"}}})],Wn.prototype,"renderer",void 0),u([Oe("renderer",["drawingInfo.renderer"])],Wn.prototype,"readRenderer",null),u([p({types:eVe})],Wn.prototype,"symbol",void 0),u([Oe("symbol",["drawingInfo.renderer"])],Wn.prototype,"readSymbol",null),u([Be("symbol")],Wn.prototype,"writeSymbol",null),u([p({type:[WC],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],Wn.prototype,"labelingInfo",void 0),u([p(sU)],Wn.prototype,"labelsVisible",void 0),u([p({type:[dx],json:{write:!0}})],Wn.prototype,"fields",void 0),u([Be("fields")],Wn.prototype,"writeFields",null),u([Oe("fields")],Wn.prototype,"readFields",null),Wn=VX=u([P(oCt)],Wn);const r$e=Wn,zfe={key:"type",base:c0,typeMap:{cluster:r$e,binning:t$e}},aCt={types:{key:"type",base:c0,typeMap:{selection:nX,cluster:r$e,binning:t$e}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:zfe},"portal-item":{types:zfe},"web-scene":{types:{key:"type",base:c0,typeMap:{selection:nX}}}}}},e2={Base64:0,Hex:1,String:2,Raw:3},rE=8,i$e=(1<<rE)-1;function W_(t,e){const r=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(r>>16)<<16|65535&r}function lCt(t){const e=[];for(let r=0,i=t.length*rE;r<i;r+=rE)e[r>>5]|=(t.charCodeAt(r/rE)&i$e)<<r%32;return e}function cCt(t){const e=[];for(let r=0,i=32*t.length;r<i;r+=rE)e.push(String.fromCharCode(t[r>>5]>>>r%32&i$e));return e.join("")}function uCt(t){const e="0123456789abcdef",r=[];for(let i=0,s=4*t.length;i<s;i++)r.push(e.charAt(t[i>>2]>>i%4*8+4&15)+e.charAt(t[i>>2]>>i%4*8&15));return r.join("")}function hCt(t){const e="=",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=[];for(let s=0,n=4*t.length;s<n;s+=3){const o=(t[s>>2]>>s%4*8&255)<<16|(t[s+1>>2]>>(s+1)%4*8&255)<<8|t[s+2>>2]>>(s+2)%4*8&255;for(let a=0;a<4;a++)8*s+6*a>32*t.length?i.push(e):i.push(r.charAt(o>>6*(3-a)&63))}return i.join("")}function dCt(t,e){return t<<e|t>>>32-e}function nU(t,e,r,i,s,n){return W_(dCt(W_(W_(e,t),W_(i,n)),s),r)}function Ia(t,e,r,i,s,n,o){return nU(e&r|~e&i,t,e,s,n,o)}function $a(t,e,r,i,s,n,o){return nU(e&i|r&~i,t,e,s,n,o)}function La(t,e,r,i,s,n,o){return nU(e^r^i,t,e,s,n,o)}function Da(t,e,r,i,s,n,o){return nU(r^(e|~i),t,e,s,n,o)}function pCt(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;let r=1732584193,i=-271733879,s=-1732584194,n=271733878;for(let o=0;o<t.length;o+=16){const a=r,l=i,c=s,h=n;r=Ia(r,i,s,n,t[o],7,-680876936),n=Ia(n,r,i,s,t[o+1],12,-389564586),s=Ia(s,n,r,i,t[o+2],17,606105819),i=Ia(i,s,n,r,t[o+3],22,-1044525330),r=Ia(r,i,s,n,t[o+4],7,-176418897),n=Ia(n,r,i,s,t[o+5],12,1200080426),s=Ia(s,n,r,i,t[o+6],17,-1473231341),i=Ia(i,s,n,r,t[o+7],22,-45705983),r=Ia(r,i,s,n,t[o+8],7,1770035416),n=Ia(n,r,i,s,t[o+9],12,-1958414417),s=Ia(s,n,r,i,t[o+10],17,-42063),i=Ia(i,s,n,r,t[o+11],22,-1990404162),r=Ia(r,i,s,n,t[o+12],7,1804603682),n=Ia(n,r,i,s,t[o+13],12,-40341101),s=Ia(s,n,r,i,t[o+14],17,-1502002290),i=Ia(i,s,n,r,t[o+15],22,1236535329),r=$a(r,i,s,n,t[o+1],5,-165796510),n=$a(n,r,i,s,t[o+6],9,-1069501632),s=$a(s,n,r,i,t[o+11],14,643717713),i=$a(i,s,n,r,t[o],20,-373897302),r=$a(r,i,s,n,t[o+5],5,-701558691),n=$a(n,r,i,s,t[o+10],9,38016083),s=$a(s,n,r,i,t[o+15],14,-660478335),i=$a(i,s,n,r,t[o+4],20,-405537848),r=$a(r,i,s,n,t[o+9],5,568446438),n=$a(n,r,i,s,t[o+14],9,-1019803690),s=$a(s,n,r,i,t[o+3],14,-187363961),i=$a(i,s,n,r,t[o+8],20,1163531501),r=$a(r,i,s,n,t[o+13],5,-1444681467),n=$a(n,r,i,s,t[o+2],9,-51403784),s=$a(s,n,r,i,t[o+7],14,1735328473),i=$a(i,s,n,r,t[o+12],20,-1926607734),r=La(r,i,s,n,t[o+5],4,-378558),n=La(n,r,i,s,t[o+8],11,-2022574463),s=La(s,n,r,i,t[o+11],16,1839030562),i=La(i,s,n,r,t[o+14],23,-35309556),r=La(r,i,s,n,t[o+1],4,-1530992060),n=La(n,r,i,s,t[o+4],11,1272893353),s=La(s,n,r,i,t[o+7],16,-155497632),i=La(i,s,n,r,t[o+10],23,-1094730640),r=La(r,i,s,n,t[o+13],4,681279174),n=La(n,r,i,s,t[o],11,-358537222),s=La(s,n,r,i,t[o+3],16,-722521979),i=La(i,s,n,r,t[o+6],23,76029189),r=La(r,i,s,n,t[o+9],4,-640364487),n=La(n,r,i,s,t[o+12],11,-421815835),s=La(s,n,r,i,t[o+15],16,530742520),i=La(i,s,n,r,t[o+2],23,-995338651),r=Da(r,i,s,n,t[o],6,-198630844),n=Da(n,r,i,s,t[o+7],10,1126891415),s=Da(s,n,r,i,t[o+14],15,-1416354905),i=Da(i,s,n,r,t[o+5],21,-57434055),r=Da(r,i,s,n,t[o+12],6,1700485571),n=Da(n,r,i,s,t[o+3],10,-1894986606),s=Da(s,n,r,i,t[o+10],15,-1051523),i=Da(i,s,n,r,t[o+1],21,-2054922799),r=Da(r,i,s,n,t[o+8],6,1873313359),n=Da(n,r,i,s,t[o+15],10,-30611744),s=Da(s,n,r,i,t[o+6],15,-1560198380),i=Da(i,s,n,r,t[o+13],21,1309151649),r=Da(r,i,s,n,t[o+4],6,-145523070),n=Da(n,r,i,s,t[o+11],10,-1120210379),s=Da(s,n,r,i,t[o+2],15,718787259),i=Da(i,s,n,r,t[o+9],21,-343485551),r=W_(r,a),i=W_(i,l),s=W_(s,c),n=W_(n,h)}return[r,i,s,n]}function s$e(t,e=e2.Hex){const r=e||e2.Base64,i=pCt(lCt(t),t.length*rE);switch(r){case e2.Raw:return i;case e2.Hex:return uCt(i);case e2.String:return cCt(i);case e2.Base64:return hCt(i)}}var BX;let GO=BX=class extends eU{writeLevels(t,e,r){for(const i in t){const s=this.levels[i];return void(e.stops=s)}}clone(){return new BX({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:H_(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:H_(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(t=>t.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone(),levels:ee(this.levels)})}};u([p()],GO.prototype,"levels",void 0),u([Be("levels")],GO.prototype,"writeLevels",null),GO=BX=u([P("esri.views.2d.engine.LevelDependentSizeVariable")],GO);const fCt=K.getLogger("esri.views.2d.layers.support.clusterUtils");ae.add("esri-cluster-arcade-enabled",!0);const mCt=ae("esri-cluster-arcade-enabled"),gCt=(t,e,r,i,s)=>{const n=e.clone();if(!bCt(n))return n;if(n.authoringInfo||(n.authoringInfo=new Xee),n.authoringInfo.isAutoGenerated=!0,"visualVariables"in n){const o=(n.visualVariables||[]).filter(l=>l.valueExpression!=="$view.scale"),a=yCt(o);o.forEach(l=>{l.type==="rotation"?l.field?l.field=P1(t,l.field,"avg_angle","number"):l.valueExpression&&(l.field=iA(t,l.valueExpression,"avg_angle","number"),l.valueExpression=null):l.normalizationField?(l.field=P1(t,l.field,"avg_norm","number",l.normalizationField),l.normalizationField=null):l.field?l.field=P1(t,l.field,"avg","number"):l.valueExpression&&(l.field=iA(t,l.valueExpression,"avg","number"),l.valueExpression=null)}),a==null&&!_Ct(o)&&s&&(o.push(vCt(r,i)),n.dynamicClusterSize=!0),n.visualVariables=o}switch(n.type){case"simple":break;case"pie-chart":for(const o of n.attributes)o.field?o.field=P1(t,o.field,"sum","number"):o.valueExpression&&(o.field=iA(t,o.valueExpression,"sum","number"),o.valueExpression=null);break;case"unique-value":n.field?n.field=P1(t,n.field,"mode","string"):n.valueExpression&&(n.field=iA(t,n.valueExpression,"mode","string"),n.valueExpression=null);break;case"class-breaks":n.normalizationField?(n.field=P1(t,n.field,"avg_norm","number",n.normalizationField),n.normalizationField=null):n.field?n.field=P1(t,n.field,"avg","number"):n.valueExpression&&(n.field=iA(t,n.valueExpression,"avg","number"),n.valueExpression=null)}return n},yCt=t=>{for(const e of t)if(e.type==="size")return e;return null},_Ct=t=>{for(const e of t)if(e.field==="cluster_count")return!0;return!1},vCt=(t,e)=>{const r=[new G2({value:0,size:0}),new G2({value:1})];if(e==null)return new eU({field:"cluster_count",stops:[...r,new G2({value:2,size:0})]});const i=Object.keys(e).reduce((s,n)=>({...s,[n]:[...r,new G2({value:Math.max(2,e[n].minValue),size:t.clusterMinSize}),new G2({value:Math.max(3,e[n].maxValue),size:t.clusterMaxSize})]}),{});return new GO({field:"cluster_count",levels:i})},bCt=t=>{const e=r=>fCt.error(new U("Unsupported-renderer",r,{renderer:t}));if(!t)return!1;switch(t.type){case"unique-value":if(t.field2||t.field3)return e("FeatureReductionCluster does not support multi-field UniqueValueRenderers"),!1;break;case"class-breaks":if(t.normalizationField){const r=t.normalizationType;if(r!=="field")return e(`FeatureReductionCluster does not support a normalizationType of ${r}`),!1}break;case"simple":case"pie-chart":break;default:return e(`FeatureReductionCluster does not support renderers of type ${t.type}`),!1}if(!mCt){if("valueExpression"in t&&t.valueExpression)return e("FeatureReductionCluster does not currently support renderer.valueExpression. Support will be added in a future release"),!1;if(("visualVariables"in t&&t.visualVariables||[]).some(r=>!(!("valueExpression"in r)||!r.valueExpression)))return e("FeatureReductionCluster does not currently support visualVariables with a valueExpression. Support will be added in a future release"),!1}return!0};function wCt(t,e,r){switch(t){case"sum":return`cluster_sum_${e}`;case"avg":case"avg_angle":return`cluster_avg_${e}`;case"mode":return`cluster_type_${e}`;case"avg_norm":{const i=r,s="field",n=e.toLowerCase()+",norm:"+s+","+i.toLowerCase();return"cluster_avg_"+s$e(n)}}}function iA(t,e,r,i){const s=s$e(e),n=r==="mode"?`cluster_type_${s}`:r==="sum"?`cluster_sum_${s}`:`cluster_avg_${s}`;return t.some(o=>o.name===n)||t.push(new dx({name:n,isAutoGenerated:!0,onStatisticExpression:new ote({expression:e,returnType:i}),statisticType:r})),n}function P1(t,e,r,i,s){if(e==="cluster_count"||t.some(o=>o.name===e))return e;const n=wCt(r,e,s);return t.some(o=>o.name===n)||(r==="avg_norm"?t.push(new dx({name:n,isAutoGenerated:!0,onStatisticExpression:new ote({expression:`$feature.${e} / $feature.${s}`,returnType:i}),statisticType:"avg"})):t.push(new dx({name:n,isAutoGenerated:!0,onStatisticField:e,statisticType:r}))),n}const xCt=t=>{let e=class extends t{constructor(...r){super(...r),this.own(this.watch("renderer",()=>{if(this.featureReduction){const i=this._normalizeFeatureReduction(this.featureReduction);this._set("featureReduction",i)}},!0))}set featureReduction(r){const i=this._normalizeFeatureReduction(r);this._set("featureReduction",i)}set renderer(r){}_normalizeFeatureReduction(r){if(r?.type!=="cluster")return r;const i=r.clone(),s=[new dx({name:"cluster_count",isAutoGenerated:!0,statisticType:"count"})],n=(i.fields??[]).filter(a=>!a.isAutoGenerated);if(r.renderer&&!r.renderer.authoringInfo?.isAutoGenerated)return i.fields=[...s,...n],i;if(r.symbol)return i.fields=[...s,...n],i.renderer=null,i;if(!this.renderer)return r;const o=gCt(s,this.renderer,r,null,!1);return i.fields=[...s,...n],i.renderer=o,i}};return u([p(aCt)],e.prototype,"featureReduction",null),e=u([P("esri.layers.mixins.FeatureReductionLayer")],e),e};var GX;const o7=new $r({asc:"ascending",desc:"descending"});let eS=GX=class extends ue{constructor(t){super(t),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new GX({field:this.field,valueExpression:this.valueExpression,order:this.order})}};u([p({type:String,json:{write:!0}})],eS.prototype,"field",void 0),u([p({type:String,json:{write:!0}})],eS.prototype,"valueExpression",void 0),u([p({type:o7.apiValues,json:{read:o7.read,write:o7.write}})],eS.prototype,"order",void 0),eS=GX=u([P("esri.layers.support.OrderByInfo")],eS);const n$e=eS;function TCt(t,e,r){if(!t)return null;const i=t.find(n=>!!n.field);if(!i)return null;const s=new n$e;return s.read(i,r),[s]}function SCt(t,e,r,i){const s=t.find(n=>!!n.field);s&&ol(r,[s.toJSON()],e)}const ECt=t=>{let e=class extends t{constructor(){super(...arguments),this.orderBy=null}};return u([p({type:[n$e],json:{origins:{"web-scene":{write:!1,read:!1}},read:{source:"layerDefinition.orderBy",reader:TCt},write:{target:"layerDefinition.orderBy",writer:SCt}}})],e.prototype,"orderBy",void 0),e=u([P("esri.layers.mixins.OrderedLayer")],e),e};let jO=class extends Te{constructor(){super(...arguments),this.updating=!1,this.status="unknown"}};u([p()],jO.prototype,"updating",void 0),u([p()],jO.prototype,"status",void 0),jO=u([P("esri.layers.support.PublishingInfo")],jO);const CCt=jO,o$e="esri.layers.mixins.PublishableLayer",ACt=Symbol(o$e),OCt=t=>{var e;let r=class extends t{constructor(){super(...arguments),this[e]=!0}get publishingInfo(){if(this.destroyed)return null;const i=this._get("publishingInfo");if(i)return i;const s=new CCt;return this._checkPublishingStatus(s),s}_checkPublishingStatus(i){let o=0;const a=async c=>{let h;i.updating=!0;try{h=await this.fetchPublishingStatus()}catch{h="unavailable"}h!=="published"&&h!=="unavailable"||(i.status==="publishing"&&this.refresh(),l.remove()),i.status=h,i.updating=!1,l.removed||(o=setTimeout(a,c,c+125))},l={removed:!1,remove(){this.removed=!0,clearTimeout(o)}};this.when().catch(()=>l.remove()),a(250),this.own(l)}};return e=ACt,u([p({readOnly:!0,clonable:!1})],r.prototype,"publishingInfo",null),r=u([P(o$e)],r),r},a$e=ll()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0});let HO=class extends Hi(ue){constructor(e){super(e),this.unit="milliseconds",this.value=0}toMilliseconds(){return Gje(this.value,this.unit,"milliseconds")}};u([nt(a$e,{nonNullable:!0})],HO.prototype,"unit",void 0),u([p({type:Number,json:{write:!0},nonNullable:!0})],HO.prototype,"value",void 0),HO=u([P("esri.TimeInterval")],HO);const o6=HO;function Vfe(t,e){return o6.fromJSON({value:t,unit:e})}let ja=class extends Hi(ue){constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeReference=null,this.trackIdField=null,this.useTime=!0}readFullTimeExtent(e,r){if(!r.timeExtent||!Array.isArray(r.timeExtent)||r.timeExtent.length!==2)return null;const i=new Date(r.timeExtent[0]),s=new Date(r.timeExtent[1]);return new Im({start:i,end:s})}writeFullTimeExtent(e,r){e&&e.start!=null&&e.end!=null?r.timeExtent=[e.start.getTime(),e.end.getTime()]:r.timeExtent=null}readInterval(e,r){return r.timeInterval&&r.timeIntervalUnits?Vfe(r.timeInterval,r.timeIntervalUnits):r.defaultTimeInterval&&r.defaultTimeIntervalUnits?Vfe(r.defaultTimeInterval,r.defaultTimeIntervalUnits):null}writeInterval(e,r){r.timeInterval=e?.toJSON().value??null,r.timeIntervalUnits=e?.toJSON().unit??null}};u([p({type:Boolean,json:{name:"exportOptions.timeDataCumulative",write:!0}})],ja.prototype,"cumulative",void 0),u([p({type:String,json:{name:"endTimeField",write:{enabled:!0,allowNull:!0}}})],ja.prototype,"endField",void 0),u([p({type:Im,json:{write:{enabled:!0,allowNull:!0}}})],ja.prototype,"fullTimeExtent",void 0),u([Oe("fullTimeExtent",["timeExtent"])],ja.prototype,"readFullTimeExtent",null),u([Be("fullTimeExtent")],ja.prototype,"writeFullTimeExtent",null),u([p({type:Boolean,json:{write:!0}})],ja.prototype,"hasLiveData",void 0),u([p({type:o6,json:{write:{enabled:!0,allowNull:!0}}})],ja.prototype,"interval",void 0),u([Oe("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],ja.prototype,"readInterval",null),u([Be("interval")],ja.prototype,"writeInterval",null),u([p({type:String,json:{name:"startTimeField",write:{enabled:!0,allowNull:!0}}})],ja.prototype,"startField",void 0),u([p({type:$E,json:{write:{enabled:!0,allowNull:!0}}})],ja.prototype,"timeReference",void 0),u([p({type:String,json:{write:{enabled:!0,allowNull:!0}}})],ja.prototype,"trackIdField",void 0),u([p({type:Boolean,json:{name:"exportOptions.useTime",write:!0}})],ja.prototype,"useTime",void 0),ja=u([P("esri.layers.support.TimeInfo")],ja);const l$e=ja,RCt=t=>{let e=class extends t{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(r,i){const s=i.timeInfo.exportOptions;if(!s)return null;const n=s.timeOffset,o=a$e.fromJSON(s.timeOffsetUnits);return n&&o?new o6({value:n,unit:o}):null}set timeInfo(r){f_e(r,this.fieldsIndex),this._set("timeInfo",r)}};return u([p({type:Im,json:{write:!1}})],e.prototype,"timeExtent",void 0),u([p({type:o6})],e.prototype,"timeOffset",void 0),u([Oe("service","timeOffset",["timeInfo.exportOptions"])],e.prototype,"readOffset",null),u([p({value:null,type:l$e,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],e.prototype,"timeInfo",null),u([p({type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation"},origins:{"web-scene":{read:!1,write:!1}}}})],e.prototype,"useViewTime",void 0),e=u([P("esri.layers.mixins.TemporalLayer")],e),e},Bfe=new $r({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let o_=class extends Hi(ue){constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};u([p({json:{write:!0}})],o_.prototype,"name",void 0),u([p({json:{write:!0}})],o_.prototype,"description",void 0),u([p({json:{read:Bfe.read,write:Bfe.write}})],o_.prototype,"drawingTool",void 0),u([p({json:{write:!0}})],o_.prototype,"prototype",void 0),u([p({json:{write:!0}})],o_.prototype,"thumbnail",void 0),o_=u([P("esri.layers.support.FeatureTemplate")],o_);const ate=o_;let Mg=class extends Hi(ue){constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const r={};for(const i of Object.keys(e))r[i]=cK(e[i]);return r}writeDomains(e,r){const i={};for(const s of Object.keys(e))e[s]&&(i[s]=e[s]?.toJSON());r.domains=i}};u([p({json:{write:!0}})],Mg.prototype,"id",void 0),u([p({json:{write:!0}})],Mg.prototype,"name",void 0),u([p({json:{write:!0}})],Mg.prototype,"domains",void 0),u([Oe("domains")],Mg.prototype,"readDomains",null),u([Be("domains")],Mg.prototype,"writeDomains",null),u([p({type:[ate],json:{write:!0}})],Mg.prototype,"templates",void 0),Mg=u([P("esri.layers.support.FeatureType")],Mg);const c$e=Mg;function u$e(){return{fields:{type:[y9],value:null},fieldsIndex:{readOnly:!0,get(){return new Jee(this.fields||[])}},outFields:{type:[String],json:{read:!1},set:function(t){this._userOutFields=t,this.notifyChange("outFields")},get:function(){const t=this._userOutFields;if(!t||!t.length)return null;if(t.includes("*"))return["*"];if(!this.fields)return t;for(const e of t)this.fieldsIndex?.has(e)||K.getLogger("esri.layers.support.fieldProperties").error("field-attributes-layer:invalid-field",`Invalid field ${e} found in outFields`,{layer:this,outFields:t});return r8(this.fieldsIndex,t)}}}}const a7=K.getLogger("esri.layers.support.labelingInfo"),MCt=/\[([^\[\]]+)\]/gi;function a6(t,e,r){return t?t.map(i=>{const s=new WC;if(s.read(i,r),s.labelExpression){const n=e.fields||e.layerDefinition&&e.layerDefinition.fields||this.fields;s.labelExpression=s.labelExpression.replaceAll(MCt,(o,a)=>`[${PCt(a,n)}]`)}return s}):null}function PCt(t,e){if(!e)return t;const r=t.toLowerCase();for(let i=0;i<e.length;i++){const s=e[i].name;if(s.toLowerCase()===r)return s}return t}const ICt={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along"],esriGeometryMultipoint:null};function lZt(t,e){const r=ee(t);return r.some(i=>$Ct(i,e))?[]:r}function $Ct(t,e){const r=t.labelPlacement,i=ICt[e];if(!t.symbol)return a7.warn("No ILabelClass symbol specified."),!0;if(!i)return a7.error(new U("labeling:unsupported-geometry-type",`Unable to create labels for layer, geometry type '${e}' is not supported`)),!0;if(!i.includes(r)){const s=i[0];r&&a7.warn(`Found invalid label placement type ${r} for ${e}. Defaulting to ${s}`),t.labelPlacement=s}return!1}const Hd=[];function LCt(t,e){if(VJ(t.url??""))return!0;const{wkid:r}=e;for(const i of Hd){if((t.version??0)>=i[0])return!0;if(typeof i[1]=="function"&&(i[1]=i[1]()),i[1].has(r))return!1}return!0}Hd.push([10.91,()=>{const t=new Set([9709,9716,9741,9761,9766]);for(let e=9712;e<=9713;e++)t.add(e);for(let e=9748;e<=9749;e++)t.add(e);for(let e=20904;e<=20932;e++)t.add(e);for(let e=21004;e<=21032;e++)t.add(e);for(let e=21207;e<=21264;e++)t.add(e);for(let e=21307;e<=21364;e++)t.add(e);for(let e=102759;e<=102760;e++)t.add(e);for(let e=102901;e<=102955;e++)t.add(e);return t}]),Hd.push([10.9,()=>{const t=new Set([9300,9354,9364,9367,9373,9377,9387,9456,9473,9498,9678,9680,29874,103599,103872,104028]);for(let e=9356;e<=9360;e++)t.add(e);for(let e=9404;e<=9407;e++)t.add(e);for(let e=9476;e<=9482;e++)t.add(e);for(let e=9487;e<=9494;e++)t.add(e);for(let e=9697;e<=9699;e++)t.add(e);return t}]),Hd.push([10.81,()=>{const t=new Set([9265,9333,103598,103699]);for(let e=9248;e<=9254;e++)t.add(e);for(let e=9271;e<=9273;e++)t.add(e);for(let e=9284;e<=9285;e++)t.add(e);for(let e=21453;e<=21463;e++)t.add(e);return t}]),Hd.push([10.8,()=>{const t=new Set([8088,8395,8428,8433,8531,8687,8692,8694,8699,8900,9003,9006,9009,9012,9017,9191]);for(let e=8035;e<=8036;e++)t.add(e);for(let e=8455;e<=8456;e++)t.add(e);for(let e=8518;e<=8529;e++)t.add(e);for(let e=8533;e<=8536;e++)t.add(e);for(let e=8538;e<=8540;e++)t.add(e);for(let e=8677;e<=8679;e++)t.add(e);for(let e=8902;e<=8903;e++)t.add(e);for(let e=8907;e<=8910;e++)t.add(e);for(let e=8949;e<=8951;e++)t.add(e);for(let e=8972;e<=8987;e++)t.add(e);for(let e=9039;e<=9040;e++)t.add(e);for(let e=9068;e<=9069;e++)t.add(e);for(let e=9140;e<=9141;e++)t.add(e);for(let e=9148;e<=9150;e++)t.add(e);for(let e=9153;e<=9159;e++)t.add(e);for(let e=9205;e<=9218;e++)t.add(e);for(let e=9221;e<=9222;e++)t.add(e);for(let e=54098;e<=54101;e++)t.add(e);return t}]),Hd.push([10.71,()=>{const t=new Set([6316]);for(let e=8351;e<=8353;e++)t.add(e);for(let e=9294;e<=9297;e++)t.add(e);for(let e=22619;e<=22621;e++)t.add(e);for(let e=103586;e<=103594;e++)t.add(e);return t}]),Hd.push([10.7,()=>{const t=new Set([8387,8391,8427,8545,8682,8685,8818,31370,104022,104024,104975]);for(let e=8065;e<=8068;e++)t.add(e);for(let e=8082;e<=8083;e++)t.add(e);for(let e=8379;e<=8385;e++)t.add(e);for(let e=8836;e<=8840;e++)t.add(e);for(let e=8857;e<=8860;e++)t.add(e);for(let e=53035;e<=53037;e++)t.add(e);for(let e=54090;e<=54091;e++)t.add(e);for(let e=102498;e<=102499;e++)t.add(e);return t}]),Hd.push([10.61,()=>new Set([102497])]),Hd.push([10.6,()=>{const t=new Set([7803,7805,7887,8086,8232,8237,8240,8246,8249,8252,8255,9019,9391]);for(let e=7755;e<=7787;e++)t.add(e);for(let e=7791;e<=7795;e++)t.add(e);for(let e=7799;e<=7801;e++)t.add(e);for(let e=7825;e<=7831;e++)t.add(e);for(let e=7877;e<=7878;e++)t.add(e);for(let e=7882;e<=7883;e++)t.add(e);for(let e=7991;e<=7992;e++)t.add(e);for(let e=8042;e<=8043;e++)t.add(e);for(let e=8058;e<=8059;e++)t.add(e);for(let e=8311;e<=8348;e++)t.add(e);for(let e=9060;e<=9067;e++)t.add(e);for(let e=102562;e<=102568;e++)t.add(e);for(let e=102799;e<=102900;e++)t.add(e);return t}]),Hd.push([10.51,()=>{const t=new Set([7683,7881,7886,7899,8888,9e3]);for(let e=8013;e<=8032;e++)t.add(e);for(let e=9053;e<=9057;e++)t.add(e);for(let e=104017;e<=104018;e++)t.add(e);for(let e=104971;e<=104974;e++)t.add(e);return t}]),Hd.push([10.5,()=>{const t=new Set([6962,7035,7037,7039,7041,7084,7086,7133,7798,102399]);for(let e=4087;e<=4088;e++)t.add(e);for(let e=5896;e<=5899;e++)t.add(e);for(let e=7005;e<=7007;e++)t.add(e);for(let e=7057;e<=7070;e++)t.add(e);for(let e=7073;e<=7082;e++)t.add(e);for(let e=7109;e<=7128;e++)t.add(e);for(let e=7844;e<=7859;e++)t.add(e);return t}]);async function h$e(t,e,r){const i=t&&t.getAtOrigin&&t.getAtOrigin("renderer",e.origin);if(i&&i.type==="unique-value"&&i.styleOrigin){const s=await $u(i.populateFromStyle());if(Yt(r),s.ok===!1){const n=s.error;e&&e.messages&&e.messages.push(new jh("renderer:style-reference",`Failed to create unique value renderer from style reference: ${n.message}`,{error:n,context:e})),t.clear("renderer",e?.origin)}}}var jX;let tS=jX=class extends ue{constructor(t){super(t),this.groupByFields=void 0,this.topCount=void 0,this.orderByFields=void 0}clone(){return new jX({groupByFields:this.groupByFields,topCount:this.topCount,orderByFields:this.orderByFields})}};u([p({type:[String],json:{write:!0}})],tS.prototype,"groupByFields",void 0),u([p({type:Number,json:{write:!0}})],tS.prototype,"topCount",void 0),u([p({type:[String],json:{write:!0}})],tS.prototype,"orderByFields",void 0),tS=jX=u([P("esri.rest.support.TopFilter")],tS);const DCt=tS;var HX;const Gfe=new $r({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),jfe=new $r({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let ms=HX=class extends ue{constructor(t){super(t),this.cacheHint=void 0,this.distance=void 0,this.geometry=null,this.geometryPrecision=void 0,this.maxAllowableOffset=void 0,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.resultType=null,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.start=void 0,this.spatialRelationship="intersects",this.timeExtent=null,this.topFilter=void 0,this.units=null,this.where="1=1"}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new HX(ee({cacheHint:this.cacheHint,distance:this.distance,geometry:this.geometry,geometryPrecision:this.geometryPrecision,maxAllowableOffset:this.maxAllowableOffset,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,resultType:this.resultType,returnGeometry:this.returnGeometry,returnZ:this.returnZ,returnM:this.returnM,start:this.start,spatialRelationship:this.spatialRelationship,timeExtent:this.timeExtent,topFilter:this.topFilter,units:this.units,where:this.where}))}};u([p({type:Boolean,json:{write:!0}})],ms.prototype,"cacheHint",void 0),u([p({type:Number,json:{write:{overridePolicy:t=>({enabled:t>0})}}})],ms.prototype,"distance",void 0),u([p({types:wx,json:{read:ov,write:!0}})],ms.prototype,"geometry",void 0),u([p({type:Number,json:{write:!0}})],ms.prototype,"geometryPrecision",void 0),u([p({type:Number,json:{write:!0}})],ms.prototype,"maxAllowableOffset",void 0),u([p({type:Number,json:{read:{source:"resultRecordCount"}}})],ms.prototype,"num",void 0),u([p({json:{write:!0}})],ms.prototype,"objectIds",void 0),u([p({type:[String],json:{write:!0}})],ms.prototype,"orderByFields",void 0),u([p({type:[String],json:{write:!0}})],ms.prototype,"outFields",void 0),u([p({type:qe,json:{read:{source:"outSR"},write:{target:"outSR"}}})],ms.prototype,"outSpatialReference",void 0),u([p({type:String,json:{write:!0}})],ms.prototype,"resultType",void 0),u([p({json:{write:!0}})],ms.prototype,"returnGeometry",void 0),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],ms.prototype,"returnM",void 0),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],ms.prototype,"returnZ",void 0),u([p({type:Number,json:{read:{source:"resultOffset"}}})],ms.prototype,"start",void 0),u([Be("start"),Be("num")],ms.prototype,"writeStart",null),u([p({type:String,json:{read:{source:"spatialRel",reader:Gfe.read},write:{target:"spatialRel",writer:Gfe.write}}})],ms.prototype,"spatialRelationship",void 0),u([p({type:Im,json:{write:!0}})],ms.prototype,"timeExtent",void 0),u([p({type:DCt,json:{write:!0}})],ms.prototype,"topFilter",void 0),u([p({type:String,json:{read:jfe.read,write:{writer:jfe.write,overridePolicy(t){return{enabled:t!=null&&this.distance!=null&&this.distance>0}}}}})],ms.prototype,"units",void 0),u([p({type:String,json:{write:!0}})],ms.prototype,"where",void 0),ms=HX=u([P("esri.rest.support.TopFeaturesQuery")],ms),ms.from=ws(ms);const mD=ms;function d$e({displayField:t,editFieldsInfo:e,fields:r,objectIdField:i,title:s},n){if(!r)return null;const o=kCt({editFieldsInfo:e,fields:r,objectIdField:i},n);if(!o.length)return null;const a=BCt({titleBase:s,fields:r,displayField:t}),l=VCt();return new Rv({title:a,content:l,fieldInfos:o})}const NCt=(t,e)=>e.visibleFieldNames?e.visibleFieldNames.has(t.name):v9e(t,e);function FCt(t,e){const r=t;return e&&(t=t.filter(i=>!e.includes(i.type))),t===r&&(t=t.slice()),t.sort(UCt),t}function UCt(t,e){return t.type==="oid"?-1:e.type==="oid"?1:Hfe(t)?-1:Hfe(e)?1:(t.alias||t.name).toLocaleLowerCase().localeCompare((e.alias||e.name).toLocaleLowerCase())}function kCt(t,e){const r=e?.visibleFieldNames;return FCt(t.fields??[],e?.ignoreFieldTypes||GCt).map(i=>new ZZ({fieldName:i.name,isEditable:_9e(i,t),label:i.alias,format:zCt(i),visible:NCt(i,{...t,visibleFieldNames:r})}))}function zCt(t){switch(t.type){case"small-integer":case"integer":case"single":return new CA({digitSeparator:!0,places:0});case"double":return new CA({digitSeparator:!0,places:2});case"date":return new CA({dateFormat:"long-month-day-year"});default:return t.type==="string"&&F9e(t.name)?new CA({digitSeparator:!0,places:0}):null}}function VCt(){return[new hM,new uM]}function BCt(t){const e=a9e(t),{titleBase:r}=t;return e?`${r}: {${e.trim()}}`:r??""}function Hfe(t){return(t.name&&t.name.toLowerCase())==="name"?!0:(t.alias&&t.alias.toLowerCase())==="name"}const GCt=["geometry","blob","raster","guid","xml"],vl="FeatureLayer",p$e="esri.layers.FeatureLayer",jCt=K.getLogger(p$e);function gD(t,e){return new U("layer:unsupported",`Layer (${t.title}, ${t.id}) of type '${t.declaredClass}' ${e}`,{layer:t})}function qfe(t){return t&&t instanceof Pt}const l7=u$e();function c7(t,e,r){const i=!!r?.writeLayerSchema;return{enabled:i,ignoreOrigin:i}}let _t=class extends XEt(xCt(pEt(OCt(wIe(iEt(ECt(RCt(IIe(ngt(yIe(RIe(PIe(ete(sEt(gIe(Hi(DZ))))))))))))))))){constructor(...e){super(...e),this._handles=new $i,this.charts=null,this.copyright=null,this.displayField=null,this.dynamicDataSource=null,this.fields=null,this.fieldsIndex=null,this.formTemplate=null,this.fullExtent=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.spatialReference=qe.WGS84,this.subtypeCode=null,this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.type="feature",this.typeIdField=null,this.types=null,this.visible=!0}destroy(){this.source?.destroy(),this._handles=Ne(this._handles)}normalizeCtorArgs(e,r){return typeof e=="string"?{url:e,...r}:e}load(e){const r=e!=null?e.signal:null;if(this.portalItem?.loaded&&this.source)return this.addResolvingPromise(this.createGraphicsSource(r).then(s=>this.initLayerProperties(s))),Promise.resolve(this);const i=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection"]},e).catch(zo).then(async()=>{if(this.url&&this.layerId==null&&/FeatureServer|MapServer\/*$/i.test(this.url)){const s=await this._fetchFirstLayerId(r);s!=null&&(this.layerId=s)}if(!this.url&&!this._hasMemorySource())throw new U("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this.initLayerProperties(await this.createGraphicsSource(r))}).then(()=>this._setUserPrivileges(this.serviceItemId,e)).then(()=>IEt(this,e));return this.addResolvingPromise(i),Promise.resolve(this)}readCapabilities(e,r){return r=r.layerDefinition||r,ZIe(r,this.url)}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")??0)+1}get editingEnabled(){return!(this.loaded&&!this.capabilities?.operations.supportsEditing)&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)}set editingEnabled(e){this._overrideIfSome("editingEnabled",e)}readEditingEnabled(e,r){return this._readEditingEnabled(r,!1)}readEditingEnabledFromWebMap(e,r,i){return this._readEditingEnabled(r,!0,i)}writeEditingEnabled(e,r){this._writeEditingEnabled(e,r,!1)}writeEditingEnabledToWebMap(e,r,i,s){this._writeEditingEnabled(e,r,!0,s)}get effectiveEditingEnabled(){return LEt(this)}readIsTable(e,r){return(r=r?.layerDefinition??r).type==="Table"||!r.geometryType}writeIsTable(e,r,i,s){s?.writeLayerSchema&&ol(i,e?"Table":"Feature Layer",r)}readGlobalIdField(e,r){return qIe(r.layerDefinition||r)}readObjectIdField(e,r){return WIe(r.layerDefinition||r)}get parsedUrl(){const e=Co(this.url);return e!=null&&(this.dynamicDataSource!=null?e.path=Fc(e.path,"dynamicLayer"):this.layerId!=null&&(e.path=Fc(e.path,this.layerId.toString()))),e}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){p5(e,this.fieldsIndex),this._set("renderer",e)}readRenderer(e,r,i){r=r.layerDefinition||r;const s=r.drawingInfo?.renderer;if(s){const n=eP(s,r,i)??void 0;return n||jCt.error("Failed to create renderer",{rendererDefinition:r.drawingInfo.renderer,layer:this,context:i}),n}return nte(r,i)}set source(e){const r=this._get("source");r!==e&&(qfe(r)&&this._resetMemorySource(r),qfe(e)&&this._initMemorySource(e),this._set("source",e))}castSource(e){return e?Array.isArray(e)||e instanceof Pt?new Dg({layer:this,items:e}):e:null}readSource(e,r){const i=GIe.fromJSON(r.featureSet);return new Dg({layer:this,items:i?.features??[]})}readTemplates(e,r){const i=r.editFieldsInfo,s=i&&i.creatorField,n=i&&i.editorField;return e=e&&e.map(o=>ate.fromJSON(o)),this._fixTemplates(e,s),this._fixTemplates(e,n),e}readTitle(e,r){const i=r.layerDefinition?.name??r.name,s=r.title||r.layerDefinition&&r.layerDefinition.title;if(i){const n=this.portalItem&&this.portalItem.title;if(this.sublayerTitleMode==="item-title")return this.url?Jwe(this.url,i):i;let o=i;if(!o&&this.url){const a=Ix(this.url);a!=null&&(o=a.title)}return o?(this.sublayerTitleMode==="item-title-and-service-name"&&n&&n!==o&&(o=n+" - "+o),D8(o)):void 0}if(this.sublayerTitleMode==="item-title"&&s)return s}readTitleFromWebMap(e,r){return r.title||r.layerDefinition&&r.layerDefinition.name}readTypeIdField(e,r){let i=(r=r.layerDefinition||r).typeIdField;if(i&&r.fields){i=i.toLowerCase();const s=r.fields.find(n=>n.name.toLowerCase()===i);s&&(i=s.name)}return i}readTypes(e,r){e=(r=r.layerDefinition||r).types;const i=r.editFieldsInfo,s=i&&i.creatorField,n=i&&i.editorField;return e&&e.map(o=>(o=c$e.fromJSON(o),this._fixTemplates(o.templates,s),this._fixTemplates(o.templates,n),o))}readVisible(e,r){return r.layerDefinition&&r.layerDefinition.defaultVisibility!=null?!!r.layerDefinition.defaultVisibility:r.visibility!=null?!!r.visibility:void 0}async addAttachment(e,r){return gEt(this,e,r,vl)}async updateAttachment(e,r,i){return yEt(this,e,r,i,vl)}async applyEdits(e,r){return _Et(this,e,r)}async uploadAssets(e,r){return vEt(this,e,r)}on(e,r){return super.on(e,r)}createPopupTemplate(e){return d$e(this,e)}async createGraphicsSource(e){if(this._hasMemorySource()&&this.source)return this.source.load({signal:e});const{default:r}=await $ge(he(()=>import("./FeatureLayerSource-a1fd9c02.js"),["./FeatureLayerSource-a1fd9c02.js","./MeshGeoreferencedRelativeVertexSpace-0d2c6219.js","./External-17ec106a.js","./editingSupport-59a69552.js","./normalizeUtils-ca47990d.js","./normalizeUtilsCommon-448ddeb2.js","./clientSideDefaults-02120944.js","./QueryEngineCapabilities-42e44ded.js","./QueryTask-53f33022.js","./executeForIds-9cee3635.js","./query-f938b96a.js","./pbfQueryUtils-4859e776.js","./pbf-482f6762.js","./executeQueryJSON-6cf505f3.js","./executeQueryPBF-097da803.js"],import.meta.url),e);return new r({layer:this}).load({signal:e})}createQuery(){const e=REt(this);e.dynamicDataSource=this.dynamicDataSource;const r=this.subtypeCode!=null?`${this.subtypeField} = ${this.subtypeCode}`:null,i=VSt(this.definitionExpression,r);return e.where=i||"1=1",e}async deleteAttachments(e,r){return bEt(this,e,r,vl)}async fetchRecomputedExtents(e){return wEt(this,e,vl)}getFeatureType(e){const{typeIdField:r,types:i}=this;if(!r||!e)return null;const s=e.attributes?e.attributes[r]:void 0;if(s==null)return null;let n=null;return i?.some(o=>{const{id:a}=o;return a!=null&&(a.toString()===s.toString()&&(n=o),!!n)}),n}getFieldDomain(e,r){const i=r?.feature,s=this.getFeatureType(i);if(s){const n=s.domains&&s.domains[e];if(n&&n.type!=="inherited")return n}return this._getLayerDomain(e)}getField(e){return this.fieldsIndex.get(e)}async queryAttachments(e,r){return xEt(this,e,r,vl)}async queryFeatures(e,r){const i=await this.load(),s=await i.source.queryFeatures(j0.from(e)??i.createQuery(),r);if(s?.features)for(const n of s.features)n.layer=n.sourceLayer=i;return s}async queryObjectIds(e,r){return TEt(this,e,r,vl)}async queryFeatureCount(e,r){return SEt(this,e,r,vl)}async queryExtent(e,r){return EEt(this,e,r,vl)}async queryRelatedFeatures(e,r){return CEt(this,e,r,vl)}async queryRelatedFeaturesCount(e,r){return AEt(this,e,r,vl)}async queryTopFeatures(e,r){const{source:i,capabilities:s}=await this.load();if(!i.queryTopFeatures||!s?.query?.supportsTopFeaturesQuery)throw new U(vl,"Layer source does not support queryTopFeatures capability");const n=await i.queryTopFeatures(mD.from(e),r);if(n?.features)for(const o of n.features)o.layer=o.sourceLayer=this;return n}async queryTopObjectIds(e,r){const{source:i,capabilities:s}=await this.load();if(!i.queryTopObjectIds||!s?.query.supportsTopFeaturesQuery)throw new U(vl,"Layer source does not support queryTopObjectIds capability");return i.queryTopObjectIds(mD.from(e),r)}async queryTopFeaturesExtent(e,r){const{source:i,capabilities:s}=await this.load();if(!i.queryTopExtents||!s?.query?.supportsTopFeaturesQuery)throw new U(vl,"Layer source does not support queryTopExtents capability");return i.queryTopExtents(mD.from(e),r)}async queryTopFeatureCount(e,r){const{source:i,capabilities:s}=await this.load();if(!i.queryTopCount||!s?.query?.supportsTopFeaturesQuery)throw new U(vl,"Layer source does not support queryFeatureCount capability");return i.queryTopCount(mD.from(e),r)}read(e,r){const i=e.featureCollection;if(i){const s=i.layers;s&&s.length===1&&(super.read(s[0],r),i.showLegend!=null&&super.read({showLegend:i.showLegend},r))}super.read(e,r),r&&r.origin==="service"&&(this.revert(["objectIdField","fields","timeInfo"],"service"),this.spatialReference||this.revert(["spatialReference"],"service"))}write(e,r){r={...r,origin:r?.origin??void 0,writeLayerSchema:r?.writeLayerSchema??this._hasMemorySource()};const{origin:i,layerContainerType:s,messages:n}=r;if(this.dynamicDataSource)return n?.push(gD(this,"using a dynamic data source cannot be written to web scenes, web maps and feature service items")),null;if(this.isTable){if(i==="web-scene"||i==="web-map"&&s!=="tables")return n?.push(gD(this,"using a table source cannot be written to web scenes and web maps")),null;if(this._hasMemorySource())return n?.push(gD(this,"using an in-memory table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&i==="web-map"&&s==="tables")return n?.push(gD(this,"using a non-table source cannot be written to tables in web maps")),null;return super.write(e,r)}clone(){if(this._hasMemorySource())throw new U(vl,`FeatureLayer (title: ${this.title}, id: ${this.id}) created using in-memory source cannot be cloned`);return super.clone()}serviceSupportsSpatialReference(e){return!!this.loaded&&(this.source?.type==="memory"||LCt(this,e))}async save(e){const{save:r}=await he(()=>import("./featureLayerUtils-d1f78b99.js"),["./featureLayerUtils-d1f78b99.js","./fetchService-21f7bf3b.js","./jsonContext-bd549146.js"],import.meta.url);return r(this,e)}async saveAs(e,r){const{saveAs:i}=await he(()=>import("./featureLayerUtils-d1f78b99.js"),["./featureLayerUtils-d1f78b99.js","./fetchService-21f7bf3b.js","./jsonContext-bd549146.js"],import.meta.url);return i(this,e,r)}_readEditingEnabled(e,r,i){let s=e.layerDefinition?.capabilities;return s?this._hasEditingCapability(s):(s=e.capabilities,r&&i?.origin==="web-map"&&!this._hasMemorySource()&&s?this._hasEditingCapability(s):void 0)}_hasEditingCapability(e){return e.toLowerCase().split(",").map(r=>r.trim()).includes("editing")}_writeEditingEnabled(e,r,i,s){if(!e){const n=this.capabilities?.operations?.supportsSync?"Query,Sync":"Query";ol("layerDefinition.capabilities",n,r),i&&!s?.writeLayerSchema&&(r.capabilities=n)}}_getLayerDomain(e){const r=this.fieldsIndex.get(e);return r?r.domain:null}_fetchFirstLayerId(e){return ur(this.url,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:e}).then(r=>{const i=r.data;if(i)return Array.isArray(i.layers)&&i.layers.length>0?i.layers[0].id:Array.isArray(i.tables)&&i.tables.length>0?i.tables[0].id:void 0})}async initLayerProperties(e){return this._set("source",e),e.sourceJSON&&(this.sourceJSON=e.sourceJSON,this.read(e.sourceJSON,{origin:"service",portalItem:this.portalItem,portal:this.portalItem?.portal,url:this.parsedUrl})),this._verifySource(),this._verifyFields(),p5(this.renderer,this.fieldsIndex),f_e(this.timeInfo,this.fieldsIndex),h$e(this,{origin:"service"})}async hasDataChanged(){return OEt(this)}async fetchPublishingStatus(){const e=this.source;return e?.fetchPublishingStatus?e.fetchPublishingStatus():"unavailable"}_verifyFields(){const e=this.parsedUrl?.path??"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+e+")"),this.isTable||this._hasMemorySource()||e.search(/\/FeatureServer\//i)!==-1||this.fields?.some(r=>r.type==="geometry")||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+e+")")}_fixTemplates(e,r){e&&e.forEach(i=>{const s=i.prototype&&i.prototype.attributes;s&&r&&delete s[r]})}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new U("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new U("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(e){e.forEach(r=>{r.layer=this,r.sourceLayer=this}),this._handles.add([e.on("after-add",r=>{r.item.layer=this,r.item.sourceLayer=this}),e.on("after-remove",r=>{r.item.layer=null,r.item.sourceLayer=null})],"fl-source")}_resetMemorySource(e){e.forEach(r=>{r.layer=null,r.sourceLayer=null}),this._handles.remove("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}};u([Oe("service","capabilities")],_t.prototype,"readCapabilities",null),u([p({json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],_t.prototype,"charts",void 0),u([p({readOnly:!0})],_t.prototype,"createQueryVersion",null),u([p({json:{read:{source:"layerDefinition.copyrightText"}}})],_t.prototype,"copyright",void 0),u([p({json:{read:{source:"layerDefinition.displayField"}}})],_t.prototype,"displayField",void 0),u([p({types:mw,readOnly:!0})],_t.prototype,"defaultSymbol",void 0),u([p({type:tp})],_t.prototype,"dynamicDataSource",void 0),u([p({type:Boolean})],_t.prototype,"editingEnabled",null),u([Oe(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],_t.prototype,"readEditingEnabled",null),u([Oe("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],_t.prototype,"readEditingEnabledFromWebMap",null),u([Be(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],_t.prototype,"writeEditingEnabled",null),u([Be("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],_t.prototype,"writeEditingEnabledToWebMap",null),u([p({readOnly:!0})],_t.prototype,"effectiveEditingEnabled",null),u([p({...l7.fields,json:{read:{source:"layerDefinition.fields"},origins:{service:{name:"fields"},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:c7}}}}})],_t.prototype,"fields",void 0),u([p(l7.fieldsIndex)],_t.prototype,"fieldsIndex",void 0),u([p({type:KSt,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],_t.prototype,"formTemplate",void 0),u([p({json:{read:{source:"layerDefinition.extent"}}})],_t.prototype,"fullExtent",void 0),u([p({json:{origins:{"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:c7,writer(t,e,r){const i=t?DX.toJSON(t):null;i&&ol(r,i,e)}}}},read:{source:"layerDefinition.geometryType",reader:DX.read}}})],_t.prototype,"geometryType",void 0),u([p({json:{read:{source:"layerDefinition.hasM"}}})],_t.prototype,"hasM",void 0),u([p({json:{read:{source:"layerDefinition.hasZ"}}})],_t.prototype,"hasZ",void 0),u([p(AIe)],_t.prototype,"id",void 0),u([p({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],_t.prototype,"infoFor3D",void 0),u([p({json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],_t.prototype,"isTable",void 0),u([Oe("service","isTable",["type","geometryType"]),Oe("isTable",["layerDefinition.type","layerDefinition.geometryType"])],_t.prototype,"readIsTable",null),u([Be("web-map","isTable")],_t.prototype,"writeIsTable",null),u([p(sU)],_t.prototype,"labelsVisible",void 0),u([p({type:[WC],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:a6},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:a6},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],_t.prototype,"labelingInfo",void 0),u([p((()=>{const t=ee(xSt);return t.json.origins["portal-item"]={write:{target:"layerDefinition.drawingInfo.transparency",writer(e,r,i){ol(i,Z6(e),r)}}},t})())],_t.prototype,"opacity",void 0),u([p(SIe)],_t.prototype,"legendEnabled",void 0),u([p({type:["show","hide"],json:(()=>{const t=ee(OIe.json);return t.origins["portal-item"]={read:!1,write:!1},t})()})],_t.prototype,"listMode",void 0),u([Oe("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],_t.prototype,"readGlobalIdField",null),u([p({json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:c7}}}}})],_t.prototype,"objectIdField",void 0),u([Oe("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],_t.prototype,"readObjectIdField",null),u([p({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],_t.prototype,"operationalLayerType",void 0),u([p(l7.outFields)],_t.prototype,"outFields",void 0),u([p({readOnly:!0})],_t.prototype,"parsedUrl",null),u([p({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],_t.prototype,"path",void 0),u([p(iU)],_t.prototype,"popupEnabled",void 0),u([p({type:Rv,json:{name:"popupInfo",write:!0}})],_t.prototype,"popupTemplate",void 0),u([p({readOnly:!0})],_t.prototype,"defaultPopupTemplate",null),u([p({types:rU,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:pIe,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:(t,e,r)=>({ignoreOrigin:r?.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(t,e,r)=>({ignoreOrigin:r?.writeLayerSchema})}}})],_t.prototype,"renderer",null),u([Oe("service","renderer",["drawingInfo.renderer","defaultSymbol"]),Oe("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],_t.prototype,"readRenderer",null),u([p((()=>{const t=ee(xIe);return t.json.origins["portal-item"]={read:!1,write:!1},t})())],_t.prototype,"screenSizePerspectiveEnabled",void 0),u([p({clonable:!1})],_t.prototype,"source",null),u([wr("source")],_t.prototype,"castSource",null),u([Oe("portal-item","source",["featureSet"]),Oe("web-map","source",["featureSet"])],_t.prototype,"readSource",null),u([p({json:{read:{source:"layerDefinition.extent.spatialReference"}}})],_t.prototype,"spatialReference",void 0),u([p({type:Number})],_t.prototype,"subtypeCode",void 0),u([p({type:[ate]})],_t.prototype,"templates",void 0),u([Oe("templates",["editFieldsInfo","creatorField","editorField","templates"])],_t.prototype,"readTemplates",null),u([p({type:l$e})],_t.prototype,"timeInfo",void 0),u([p()],_t.prototype,"title",void 0),u([Oe("service","title",["name"]),Oe("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],_t.prototype,"readTitle",null),u([Oe("web-map","title",["layerDefinition.name","title"])],_t.prototype,"readTitleFromWebMap",null),u([p({type:String})],_t.prototype,"sublayerTitleMode",void 0),u([p({json:{read:!1}})],_t.prototype,"type",void 0),u([p({type:String})],_t.prototype,"typeIdField",void 0),u([Oe("service","typeIdField"),Oe("typeIdField",["layerDefinition.typeIdField"])],_t.prototype,"readTypeIdField",null),u([p({type:[c$e]})],_t.prototype,"types",void 0),u([Oe("service","types",["types"]),Oe("types",["layerDefinition.types"])],_t.prototype,"readTypes",null),u([p({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],_t.prototype,"visible",void 0),u([Oe("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],_t.prototype,"readVisible",null),_t=u([P(p$e)],_t);const tP=_t,uZt=Object.freeze(Object.defineProperty({__proto__:null,default:tP},Symbol.toStringTag,{value:"Module"}));let HCt=class{constructor(e,r,i,s){this._parsedUrl=e,this._portalItem=r,this._apiKey=i,this.signal=s,this._rootDocument=null;const n=this._parsedUrl?.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i);n&&(this._urlParts={root:n[1],layerId:parseInt(n[2],10)})}async fetch(){if(!this._urlParts)return null;const e=this._portalItem??await this._portalItemFromServiceItemId();if(e==null)return this._loadFromUrl();const r=await this._findAndLoadRelatedPortalItem(e);return r==null?null:this._loadFeatureLayerFromPortalItem(r)}async fetchPortalItem(){if(!this._urlParts)return null;const e=this._portalItem??await this._portalItemFromServiceItemId();return e==null?null:this._findAndLoadRelatedPortalItem(e)}async _fetchRootDocument(){if(this._rootDocument!=null)return this._rootDocument;if(this._urlParts==null)return this._rootDocument={},{};const e={query:{f:"json",token:this._apiKey},responseType:"json",signal:this.signal},r=`${this._urlParts.root}/SceneServer`;try{const i=await ur(r,e);this._rootDocument=i.data}catch{this._rootDocument={}}return this._rootDocument}async _fetchServiceOwningPortalUrl(){const e=this._parsedUrl?.path,r=e?Ii?.findServerInfo(e):null;if(r?.owningSystemUrl)return r.owningSystemUrl;const i=e?e.replace(/(.*\/rest)\/.*/i,"$1")+"/info":null;try{const s=(await ur(i,{query:{f:"json"},responseType:"json",signal:this.signal})).data.owningSystemUrl;if(s)return s}catch(s){zo(s)}return null}async _findAndLoadRelatedPortalItem(e){try{return(await e.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:this.signal})).find(r=>r.type==="Feature Service")||null}catch(r){return zo(r),null}}async _loadFeatureLayerFromPortalItem(e){await e.load({signal:this.signal});const r=await this._findMatchingAssociatedSublayerUrl(e.url??"");return new tP({url:r,portalItem:e}).load({signal:this.signal})}async _loadFromUrl(){const e=await this._findMatchingAssociatedSublayerUrl(`${this._urlParts?.root}/FeatureServer`);return new tP({url:e}).load({signal:this.signal})}async _findMatchingAssociatedSublayerUrl(e){const r=e.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1"),i=this._urlParts?.layerId,s=this._fetchRootDocument(),n=d=>{const f={query:{f:"json"},responseType:"json",authMode:d,signal:this.signal};return ur(r,f)},o=n("anonymous").catch(()=>n("no-prompt")),[a,l]=await Promise.all([o,s]),c=l&&l.layers,h=a.data&&a.data.layers;if(!Array.isArray(h))throw new Error("expected layers array");if(Array.isArray(c)){for(let d=0;d<Math.min(c.length,h.length);d++)if(c[d].id===i)return`${r}/${h[d].id}`}else if(i!=null&&i<h.length)return`${r}/${h[i].id}`;throw new Error("could not find matching associated sublayer")}async _portalItemFromServiceItemId(){const e=(await this._fetchRootDocument()).serviceItemId;if(!e)return null;const r=new hw({id:e,apiKey:this._apiKey}),i=await this._fetchServiceOwningPortalUrl();i!=null&&(r.portal=new en({url:i}));try{return r.load({signal:this.signal})}catch(s){return zo(s),null}}},Jb=class extends ue{constructor(){super(...arguments),this.nodesPerPage=null,this.rootIndex=0,this.lodSelectionMetricType=null}};u([p({type:Number})],Jb.prototype,"nodesPerPage",void 0),u([p({type:Number})],Jb.prototype,"rootIndex",void 0),u([p({type:String})],Jb.prototype,"lodSelectionMetricType",void 0),Jb=u([P("esri.layer.support.I3SNodePageDefinition")],Jb);let Xg=class extends ue{constructor(){super(...arguments),this.factor=1}};u([p({type:Number,json:{read:{source:"textureSetDefinitionId"}}})],Xg.prototype,"id",void 0),u([p({type:Number})],Xg.prototype,"factor",void 0),Xg=u([P("esri.layer.support.I3SMaterialTexture")],Xg);let a_=class extends ue{constructor(){super(...arguments),this.baseColorFactor=[1,1,1,1],this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.metallicFactor=1,this.roughnessFactor=1}};u([p({type:[Number]})],a_.prototype,"baseColorFactor",void 0),u([p({type:Xg})],a_.prototype,"baseColorTexture",void 0),u([p({type:Xg})],a_.prototype,"metallicRoughnessTexture",void 0),u([p({type:Number})],a_.prototype,"metallicFactor",void 0),u([p({type:Number})],a_.prototype,"roughnessFactor",void 0),a_=u([P("esri.layer.support.I3SMaterialPBRMetallicRoughness")],a_);let fh=class extends ue{constructor(){super(...arguments),this.alphaMode="opaque",this.alphaCutoff=.25,this.doubleSided=!1,this.cullFace="none",this.normalTexture=null,this.occlusionTexture=null,this.emissiveTexture=null,this.emissiveFactor=null,this.pbrMetallicRoughness=null}};u([nt({opaque:"opaque",mask:"mask",blend:"blend"})],fh.prototype,"alphaMode",void 0),u([p({type:Number})],fh.prototype,"alphaCutoff",void 0),u([p({type:Boolean})],fh.prototype,"doubleSided",void 0),u([nt({none:"none",back:"back",front:"front"})],fh.prototype,"cullFace",void 0),u([p({type:Xg})],fh.prototype,"normalTexture",void 0),u([p({type:Xg})],fh.prototype,"occlusionTexture",void 0),u([p({type:Xg})],fh.prototype,"emissiveTexture",void 0),u([p({type:[Number]})],fh.prototype,"emissiveFactor",void 0),u([p({type:a_})],fh.prototype,"pbrMetallicRoughness",void 0),fh=u([P("esri.layer.support.I3SMaterialDefinition")],fh);let qO=class extends ue{};u([p({type:String,json:{read:{source:["name","index"],reader:(t,e)=>t??`${e.index}`}}})],qO.prototype,"name",void 0),u([nt({jpg:"jpg",png:"png",dds:"dds","ktx-etc2":"ktx-etc2",ktx2:"ktx2",basis:"basis"})],qO.prototype,"format",void 0),qO=u([P("esri.layer.support.I3STextureFormat")],qO);let WO=class extends ue{constructor(){super(...arguments),this.atlas=!1}};u([p({type:[qO]})],WO.prototype,"formats",void 0),u([p({type:Boolean})],WO.prototype,"atlas",void 0),WO=u([P("esri.layer.support.I3STextureSetDefinition")],WO);let rp=class extends ue{};u([nt({Float32:"Float32",UInt64:"UInt64",UInt32:"UInt32",UInt16:"UInt16",UInt8:"UInt8"})],rp.prototype,"type",void 0),u([p({type:Number})],rp.prototype,"component",void 0),rp=u([P("esri.layer.support.I3SGeometryAttribute")],rp);let XO=class extends ue{};u([nt({draco:"draco"})],XO.prototype,"encoding",void 0),u([p({type:[String]})],XO.prototype,"attributes",void 0),XO=u([P("esri.layer.support.I3SGeometryCompressedAttributes")],XO);let Td=class extends ue{constructor(){super(...arguments),this.offset=0}};u([p({type:Number})],Td.prototype,"offset",void 0),u([p({type:rp})],Td.prototype,"position",void 0),u([p({type:rp})],Td.prototype,"normal",void 0),u([p({type:rp})],Td.prototype,"uv0",void 0),u([p({type:rp})],Td.prototype,"color",void 0),u([p({type:rp})],Td.prototype,"uvRegion",void 0),u([p({type:rp})],Td.prototype,"featureId",void 0),u([p({type:rp})],Td.prototype,"faceRange",void 0),u([p({type:XO})],Td.prototype,"compressedAttributes",void 0),Td=u([P("esri.layer.support.I3SGeometryBuffer")],Td);let YO=class extends ue{};u([nt({triangle:"triangle"})],YO.prototype,"topology",void 0),u([p()],YO.prototype,"geometryBuffers",void 0),YO=u([P("esri.layer.support.I3SGeometryDefinition")],YO);let l_=class extends ue{constructor(){super(...arguments),this.name=null,this.field=null,this.currentRangeExtent=null,this.fullRangeExtent=null,this.type="rangeInfo"}};u([p({type:String,json:{read:!0,write:!0}})],l_.prototype,"name",void 0),u([p({type:String,json:{read:!0,write:!0}})],l_.prototype,"field",void 0),u([p({type:[Number],json:{read:!0,write:!0}})],l_.prototype,"currentRangeExtent",void 0),u([p({type:[Number],json:{read:!0,write:!0}})],l_.prototype,"fullRangeExtent",void 0),u([p({type:["rangeInfo"],readOnly:!0,json:{read:!1,write:!0}})],l_.prototype,"type",void 0),l_=u([P("esri.layers.support.RangeInfo")],l_);function qX(t){return lte[qCt(t)]||XCt}function qCt(t){return t instanceof Blob?t.type:WCt(t.url)}function WCt(t){const e=KY(t);return WX[e]||f$e}const lte={},f$e="text/plain",XCt=lte[f$e],WX={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(const t in WX)lte[WX[t]]=t;function YCt(t){const e=t?.origins??[void 0];return(r,i)=>{const s=ZCt(t,r,i);for(const n of e){const o=NY(r,n,i);for(const a in s)o[a]=s[a]}}}function ZCt(t,e,r){if(t?.type==="resource")return JCt(t,e,r);switch(t?.type??"other"){case"other":return{read:!0,write:!0};case"url":{const{read:i,write:s}=Vze;return{read:i,write:s}}}}function JCt(t,e,r){const i=dP(e,r);return{type:String,read:(s,n,o)=>{const a=h8(s,n,o);return i.type===String?a:typeof i.type=="function"?new i.type({url:a}):void 0},write:{writer(s,n,o,a){if(!a||!a.resources)return typeof s=="string"?void(n[o]=v0(s,a)):void(n[o]=s.write({},a));const l=t3t(s),c=v0(l,{...a,verifyItemRelativeUrls:a&&a.verifyItemRelativeUrls?{writtenUrls:a.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},TE.NO),h=i.type!==String&&(!$Ie(this)||a&&a.origin&&this.originIdOf(r)>jg(a.origin)),d={object:this,propertyName:r,value:s,targetUrl:c,dest:n,targetPropertyName:o,context:a,params:t};a&&a.portalItem&&c&&!$c(c)?h?QCt(d):KCt(d):a&&a.portalItem&&(c==null||Jve(c)!=null||sv(c)||h)?m$e(d):n[o]=c}}}}function m$e(t){const{targetUrl:e,params:r,value:i,context:s,dest:n,targetPropertyName:o}=t;if(!s.portalItem)return;const a=Qve(e),l=a?.filename??Q9(),c=r?.prefix??a?.prefix,h=y$e(i,e,s),d=Fc(c,l),f=`${d}.${qX(h)}`,m=s.portalItem.resourceFromPath(f);sv(e)&&s.resources&&s.resources.pendingOperations.push(e3t(e).then(_=>{m.path=`${d}.${qX(_)}`,n[o]=m.itemRelativeUrl}).catch(()=>{}));const g=r?.compress??!1;s.resources&&g$e({...t,resource:m,content:h,compress:g,updates:s.resources.toAdd}),n[o]=m.itemRelativeUrl}function QCt(t){const{context:e,targetUrl:r,params:i,value:s,dest:n,targetPropertyName:o}=t;if(!e.portalItem)return;const a=e.portalItem.resourceFromPath(r),l=y$e(s,r,e),c=qX(l),h=KY(a.path),d=i?.compress??!1;c===h?(e.resources&&g$e({...t,resource:a,content:l,compress:d,updates:e.resources.toUpdate}),n[o]=r):m$e(t)}function KCt({context:t,targetUrl:e,dest:r,targetPropertyName:i}){t.portalItem&&t.resources&&(t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(e),compress:!1}),r[i]=e)}function g$e({object:t,propertyName:e,updates:r,resource:i,content:s,compress:n}){r.push({resource:i,content:s,compress:n,finish:o=>{r3t(t,e,o)}})}function y$e(t,e,r){return typeof t=="string"?{url:e}:new Blob([JSON.stringify(t.toJSON(r))],{type:"application/json"})}async function e3t(t){const e=(await he(()=>Promise.resolve().then(()=>aye),void 0,import.meta.url)).default,{data:r}=await e(t,{responseType:"blob"});return r}function t3t(t){return t==null?null:typeof t=="string"?t:t.url}function r3t(t,e,r){typeof t[e]=="string"?t[e]=r.url:t[e].url=r.url}var x4;let XX=x4=class extends _C(Pt.ofType(Su)){constructor(t){super(t)}clone(){return new x4(this.items.map(t=>t.clone()))}write(t,e){return this.toJSON(e)}toJSON(t){const e=t?.layer?.spatialReference;return e?this.toArray().map(r=>{if(!e.equals(r.spatialReference)){if(!gm(r.spatialReference,e))return t&&t.messages&&t.messages.push(new jh("scenefilter:unsupported","Scene filters with incompatible spatial references are not supported",{modification:this,spatialReference:t.layer.spatialReference,context:t})),null;const s=new Su;K1e(r,s,e),r=s}const i=r.toJSON(t);return delete i.spatialReference,i}).filter(r=>r!=null):(t?.messages&&t.messages.push(new jh("scenefilter:unsupported","Writing Scene filters without context layer is not supported",{modification:this,spatialReference:t.layer.spatialReference,context:t})),this.toArray().map(r=>r.toJSON(t)))}static fromJSON(t,e){const r=new x4;return t.forEach(i=>r.add(Su.fromJSON(i,e))),r}};XX=x4=u([P("esri.layers.support.PolygonCollection")],XX);const T4=XX;var YX;let rS=YX=class extends ue{constructor(t){super(t),this.spatialRelationship="disjoint",this.geometries=new T4,this._geometriesSource=null,this._handles=new $i}initialize(){this._handles.add(_a(()=>this.geometries,"after-changes",()=>this.geometries=this.geometries,Wr))}destroy(){this._handles.destroy()}readGeometries(t,e,r){Array.isArray(t)?this.geometries=T4.fromJSON(t,r):this._geometriesSource={url:_0(t,r),context:r}}async loadGeometries(t,e){if(this._geometriesSource==null)return;const{url:r,context:i}=this._geometriesSource,s=await ur(r,{responseType:"json",signal:e?.signal}),n=t.toJSON(),o=s.data.map(a=>({...a,spatialReference:n}));this.geometries=T4.fromJSON(o,i),this._geometriesSource=null}clone(){const t=new YX({geometries:ee(this.geometries),spatialRelationship:this.spatialRelationship});return t._geometriesSource=this._geometriesSource,t}};u([p({type:["disjoint","contains"],nonNullable:!0,json:{write:!0}})],rS.prototype,"spatialRelationship",void 0),u([p({type:T4,nonNullable:!0,json:{write:!0}}),YCt({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries"})],rS.prototype,"geometries",void 0),u([Oe(["web-scene","portal-item"],"geometries")],rS.prototype,"readGeometries",null),rS=YX=u([P("esri.layers.support.SceneFilter")],rS);const i3t=rS,Ps=!0,aw={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};function cte(t,e,r){return{identifier:String.fromCharCode.apply(null,new Uint8Array(t,r+aw.identifierOffset,aw.identifierLength)),version:e.getUint16(r+aw.versionOffset,Ps),checksum:e.getUint32(r+aw.checksumOffset,Ps)}}const cc={sizeLo:0,sizeHi:4,minX:8,minY:16,minZ:24,maxX:32,maxY:40,maxZ:48,errorX:56,errorY:64,errorZ:72,count:80,reserved:84,byteCount:88};function s3t(t,e){return{sizeLo:t.getUint32(e+cc.sizeLo,Ps),sizeHi:t.getUint32(e+cc.sizeHi,Ps),minX:t.getFloat64(e+cc.minX,Ps),minY:t.getFloat64(e+cc.minY,Ps),minZ:t.getFloat64(e+cc.minZ,Ps),maxX:t.getFloat64(e+cc.maxX,Ps),maxY:t.getFloat64(e+cc.maxY,Ps),maxZ:t.getFloat64(e+cc.maxZ,Ps),errorX:t.getFloat64(e+cc.errorX,Ps),errorY:t.getFloat64(e+cc.errorY,Ps),errorZ:t.getFloat64(e+cc.errorZ,Ps),count:t.getUint32(e+cc.count,Ps),reserved:t.getUint32(e+cc.reserved,Ps)}}function TZt(t){const e=new DataView(t,0);let r=0;const{identifier:i,version:s}=cte(t,e,r);if(r+=aw.byteCount,i!=="LEPCC     ")throw new U("lepcc-decode-error","Bad identifier");if(s>1)throw new U("lepcc-decode-error","Unknown version");const n=s3t(e,r);if(r+=cc.byteCount,n.sizeHi*2**32+n.sizeLo!==t.byteLength)throw new U("lepcc-decode-error","Bad size");const o=new Float64Array(3*n.count),a=[],l=[],c=[],h=[];if(r=yD(t,r,a),r=yD(t,r,l),r=yD(t,r,c),r=yD(t,r,h),r!==t.byteLength)throw new U("lepcc-decode-error","Bad length");let d=0,f=0;for(let m=0;m<a.length;m++){f+=a[m];let g=0;for(let _=0;_<l[m];_++){g+=c[d];const v=h[d];o[3*d]=Math.min(n.maxX,n.minX+2*n.errorX*g),o[3*d+1]=Math.min(n.maxY,n.minY+2*n.errorY*f),o[3*d+2]=Math.min(n.maxZ,n.minZ+2*n.errorZ*v),d++}}return{errorX:n.errorX,errorY:n.errorY,errorZ:n.errorZ,result:o}}function yD(t,e,r){const i=[];e=ZX(t,e,i);const s=[];for(let n=0;n<i.length;n++){s.length=0,e=ZX(t,e,s);for(let o=0;o<s.length;o++)r.push(s[o]+i[n])}return e}function ZX(t,e,r){const i=new DataView(t,e),s=i.getUint8(0),n=31&s,o=!!(32&s),a=(192&s)>>6;let l=0;if(a===0)l=i.getUint32(1,Ps),e+=5;else if(a===1)l=i.getUint16(1,Ps),e+=3;else{if(a!==2)throw new U("lepcc-decode-error","Bad count type");l=i.getUint8(1),e+=2}if(o)throw new U("lepcc-decode-error","LUT not implemented");const c=Math.ceil(l*n/8),h=new Uint8Array(t,e,c);let d=0,f=0,m=0;const g=-1>>>32-n;for(let _=0;_<l;_++){for(;f<n;)d|=h[m]<<f,f+=8,m+=1;r[_]=d&g,d>>>=n,f-=n,f+n>32&&(d|=h[m-1]>>8-f)}return e+m}const Ib={sizeLo:0,sizeHi:4,count:8,colorMapCount:12,lookupMethod:14,compressionMethod:15,byteCount:16};function n3t(t,e){return{sizeLo:t.getUint32(e+Ib.sizeLo,Ps),sizeHi:t.getUint32(e+Ib.sizeHi,Ps),count:t.getUint32(e+Ib.count,Ps),colorMapCount:t.getUint16(e+Ib.colorMapCount,Ps),lookupMethod:t.getUint8(e+Ib.lookupMethod),compressionMethod:t.getUint8(e+Ib.compressionMethod)}}function o3t(t){const e=new DataView(t,0);let r=0;const{identifier:i,version:s}=cte(t,e,r);if(r+=aw.byteCount,i!=="ClusterRGB")throw new U("lepcc-decode-error","Bad identifier");if(s>1)throw new U("lepcc-decode-error","Unknown version");const n=n3t(e,r);if(r+=Ib.byteCount,n.sizeHi*2**32+n.sizeLo!==t.byteLength)throw new U("lepcc-decode-error","Bad size");if((n.lookupMethod===2||n.lookupMethod===1)&&n.compressionMethod===0){if(3*n.colorMapCount+n.count+r!==t.byteLength||n.colorMapCount>256)throw new U("lepcc-decode-error","Bad count");const o=new Uint8Array(t,r,3*n.colorMapCount),a=new Uint8Array(t,r+3*n.colorMapCount,n.count),l=new Uint8Array(3*n.count);for(let c=0;c<n.count;c++){const h=a[c];l[3*c]=o[3*h],l[3*c+1]=o[3*h+1],l[3*c+2]=o[3*h+2]}return l}if(n.lookupMethod===0&&n.compressionMethod===0){if(3*n.count+r!==t.byteLength||n.colorMapCount!==0)throw new U("lepcc-decode-error","Bad count");return new Uint8Array(t,r).slice()}if(n.lookupMethod<=2&&n.compressionMethod===1){if(r+3!==t.byteLength||n.colorMapCount!==1)throw new U("lepcc-decode-error","Bad count");const o=e.getUint8(r),a=e.getUint8(r+1),l=e.getUint8(r+2),c=new Uint8Array(3*n.count);for(let h=0;h<n.count;h++)c[3*h]=o,c[3*h+1]=a,c[3*h+2]=l;return c}throw new U("lepcc-decode-error","Bad method "+n.lookupMethod+","+n.compressionMethod)}const $b={sizeLo:0,sizeHi:4,count:8,scaleFactor:12,bitsPerPoint:14,reserved:15,byteCount:16};function a3t(t,e){return{sizeLo:t.getUint32(e+$b.sizeLo,Ps),sizeHi:t.getUint32(e+$b.sizeHi,Ps),count:t.getUint32(e+$b.count,Ps),scaleFactor:t.getUint16(e+$b.scaleFactor,Ps),bitsPerPoint:t.getUint8(e+$b.bitsPerPoint),reserved:t.getUint8(e+$b.reserved)}}function l3t(t){const e=new DataView(t,0);let r=0;const{identifier:i,version:s}=cte(t,e,r);if(r+=aw.byteCount,i!=="Intensity ")throw new U("lepcc-decode-error","Bad identifier");if(s>1)throw new U("lepcc-decode-error","Unknown version");const n=a3t(e,r);if(r+=$b.byteCount,n.sizeHi*2**32+n.sizeLo!==t.byteLength)throw new U("lepcc-decode-error","Bad size");const o=new Uint16Array(n.count);if(n.bitsPerPoint===8){if(n.count+r!==t.byteLength)throw new U("lepcc-decode-error","Bad size");const a=new Uint8Array(t,r,n.count);for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}else if(n.bitsPerPoint===16){if(2*n.count+r!==t.byteLength)throw new U("lepcc-decode-error","Bad size");const a=new Uint16Array(t,r,n.count);for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}else{const a=[];if(ZX(t,r,a)!==t.byteLength)throw new U("lepcc-decode-error","Bad size");for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}return o}const JX=K.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");function c3t(t,e,r){let i="",s=0;for(;s<r;){const n=t[e+s];if(n<128)i+=String.fromCharCode(n),s++;else if(n>=192&&n<224){if(s+1>=r)throw new U("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");const o=(31&n)<<6|63&t[e+s+1];i+=String.fromCharCode(o),s+=2}else if(n>=224&&n<240){if(s+2>=r)throw new U("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const o=(15&n)<<12|(63&t[e+s+1])<<6|63&t[e+s+2];i+=String.fromCharCode(o),s+=3}else{if(!(n>=240&&n<248))throw new U("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");{if(s+3>=r)throw new U("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const o=(7&n)<<18|(63&t[e+s+1])<<12|(63&t[e+s+2])<<6|63&t[e+s+3];if(o>=65536){const a=55296+(o-65536>>10),l=56320+(1023&o);i+=String.fromCharCode(a,l)}else i+=String.fromCharCode(o);s+=4}}}return i}function _$e(t,e){const r={byteOffset:0,byteCount:0,fields:Object.create(null)};let i=0;for(let s=0;s<e.length;s++){const n=e[s],o=n.valueType||n.type,a=_3t[o];r.fields[n.property]=a(t,i),i+=oU[o].BYTES_PER_ELEMENT}return r.byteCount=i,r}function u3t(t,e,r){return v$e(t,e,r).map(i=>{const s=i?Date.parse(i):null;return s&&!Number.isNaN(s)?s:null})}function v$e(t,e,r){const i=[];let s,n,o=0;for(n=0;n<t;n+=1){if(s=e[n],s>0){if(i.push(c3t(r,o,s-1)),r[o+s-1]!==0)throw new U("string-array-error","Invalid string array: missing null termination.")}else i.push(null);o+=s}return i}function Wfe(t,e){return new oU[e.valueType](t,e.byteOffset,e.count*e.valuesPerElement)}function h3t(t,e){return new Uint8Array(t,e.byteOffset,e.byteCount)}function d3t(t,e,r){const i=e.header!=null?_$e(t,e.header):{byteOffset:0,byteCount:0,fields:{count:r}},s={header:i,byteOffset:i.byteCount,byteCount:0,entries:Object.create(null)};let n=i.byteCount;for(let o=0;o<e.ordering.length;o++){const a=e.ordering[o],l=ee(e[a]);if(l.count=i.fields.count??0,l.valueType==="String"){if(l.byteOffset=n,l.byteCount=i.fields[a+"ByteCount"],l.encoding!=="UTF-8")throw new U("unsupported-encoding","Unsupported String encoding.",{encoding:l.encoding});if(l.timeEncoding&&l.timeEncoding!=="ECMA_ISO8601")throw new U("unsupported-time-encoding","Unsupported time encoding.",{timeEncoding:l.timeEncoding})}else{if(!w$e(l.valueType))throw new U("unsupported-value-type","Unsupported binary valueType",{valueType:l.valueType});{const c=S4(l.valueType);n+=n%c!=0?c-n%c:0,l.byteOffset=n,l.byteCount=c*l.valuesPerElement*l.count}}n+=l.byteCount??0,s.entries[a]=l}return s.byteCount=n-s.byteOffset,s}function b$e(t,e,r){if(e!==t&&JX.error(`Invalid ${r} buffer size
 expected: ${t}, actual: ${e})`),e<t)throw new U("buffer-too-small","Binary buffer is too small",{expectedSize:t,actualSize:e})}function p3t(t){return{isDraco:!1,isLegacy:!1,color:t.color!=null,normal:t.normal!=null,uv0:t.uv0!=null,uvRegion:t.uvRegion!=null,featureIndex:t.faceRange!=null&&t.featureId!=null}}function SZt(t,e){const r=_$e(t,e&&e.header);let i=r.byteCount;const s={isDraco:!1,header:r,byteOffset:r.byteCount,byteCount:0,vertexAttributes:{}},n=r.fields,o=n.vertexCount!=null?n.vertexCount:n.count;for(const c of e.ordering){if(!e.vertexAttributes[c])continue;const h={...e.vertexAttributes[c],byteOffset:i,count:o},d=g3t[c]||"_"+c;s.vertexAttributes[d]=h,i+=S4(h.valueType)*h.valuesPerElement*o}const a=n.faceCount;if(e.faces&&a){s.faces={};for(const c of e.ordering){if(!e.faces[c])continue;const h={...e.faces[c],byteOffset:i,count:a};s.faces[c]=h,i+=S4(h.valueType)*h.valuesPerElement*a}}const l=n.featureCount;if(e.featureAttributes&&e.featureAttributeOrder&&l){s.featureAttributes={};for(const c of e.featureAttributeOrder){if(!e.featureAttributes[c])continue;const h={...e.featureAttributes[c],byteOffset:i,count:l};s.featureAttributes[c]=h,i+=(h.valueType==="UInt64"?8:S4(h.valueType))*h.valuesPerElement*l}}return b$e(i,t.byteLength,"geometry"),s.byteCount=i-s.byteOffset,s}function EZt(t,e){return!t||!t.compressedAttributes||t.compressedAttributes.encoding!=="draco"?t?p3t(t):f3t(e):m3t(t.compressedAttributes.attributes)}function f3t(t){const e={isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const r of t.ordering)if(t.vertexAttributes[r])switch(r){case"position":break;case"normal":e.normal=!0;break;case"color":e.color=!0;break;case"uv0":e.uv0=!0;break;case"region":e.uvRegion=!0}return t.featureAttributes&&t.featureAttributeOrder&&(e.featureIndex=!0),e}function m3t(t){const e={isDraco:!0,isLegacy:!1,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const r of t)switch(r){case"position":break;case"normal":e.normal=!0;break;case"uv0":e.uv0=!0;break;case"color":e.color=!0;break;case"uv-region":e.uvRegion=!0;break;case"feature-index":e.featureIndex=!0}return e}const g3t={position:C.POSITION,normal:C.NORMAL,color:C.COLOR,uv0:C.UV0,region:C.UVREGION};function y3t(t,e,r){if(t.encoding==="lepcc-rgb")return o3t(e);if(t.encoding==="lepcc-intensity")return l3t(e);if(t.encoding!=null&&t.encoding!=="")throw new U("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");t["attributeByteCounts "]&&!t.attributeByteCounts&&(JX.warn("Warning: Trailing space in 'attributeByteCounts '."),t.attributeByteCounts=t["attributeByteCounts "]),t.ordering[0]==="ObjectIds"&&t.hasOwnProperty("objectIds")&&(JX.warn("Warning: Case error in objectIds"),t.ordering[0]="objectIds");const i=d3t(e,t,r);b$e(i.byteOffset+i.byteCount,e.byteLength,"attribute");const s=i.entries.attributeValues||i.entries.objectIds;if(s){if(s.valueType==="String"){const n=i.entries.attributeByteCounts,o=Wfe(e,n),a=h3t(e,s);return s.timeEncoding?u3t(n.count,o,a):v$e(n.count,o,a)}return Wfe(e,s)}throw new U("bad-attribute-storage-info","Bad attributeStorageInfo specification.")}const oU={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},_3t={Float32:(t,e)=>new DataView(t,0).getFloat32(e,!0),Float64:(t,e)=>new DataView(t,0).getFloat64(e,!0),UInt8:(t,e)=>new DataView(t,0).getUint8(e),Int8:(t,e)=>new DataView(t,0).getInt8(e),UInt16:(t,e)=>new DataView(t,0).getUint16(e,!0),Int16:(t,e)=>new DataView(t,0).getInt16(e,!0),UInt32:(t,e)=>new DataView(t,0).getUint32(e,!0),Int32:(t,e)=>new DataView(t,0).getInt32(e,!0)};function w$e(t){return oU.hasOwnProperty(t)}function S4(t){return w$e(t)?oU[t].BYTES_PER_ELEMENT:0}function v3t(t,e,r,i){const s=b3t(t,e,r),n=xe();return Fl(r,s,n,i),n}const x$e=1,Xfe=5-x$e;function b3t(t,e,r){const i=O(),s=t[3],n=2**(Math.ceil(Math.log(s)*Math.LOG2E/Xfe)*Xfe+x$e);if(r.isGeographic){const l=n/Vr(r).radius*180/Math.PI,c=Math.round(t[1]/l),h=Math.max(-90,Math.min(90,c*l)),d=l/Math.cos((Math.abs(h)-l/2)/180*Math.PI),f=Math.round(t[0]/d)*d;i[0]=f,i[1]=h}else{const l=Math.round(t[0]/n),c=Math.round(t[1]/n);i[0]=l*n,i[1]=c*n}const o=t[2]+e,a=Math.round(o/n);return i[2]=a*n,i}function T$e(t){return t?parseInt(t.substring(t.lastIndexOf("/")+1,t.length),10):void 0}function CZt(t){if(ae("disable-feature:i3s-draco")||!t)return!1;for(const e of t)for(const r of e.geometryBuffers)if(r.compressedAttributes?.encoding==="draco")return!0;return!1}function AZt(t,e,r,i){r.traverse(e,s=>{const n=s.mbs;return(n!=null&&w3t(t,n))!==lw.OUTSIDE&&(i(s),!0)})}function OZt(t,e,r){let i=0,s=0;for(let n=0;n<e.length&&i<t.length;n++)t[i]===e[n]&&(r(n)&&(t[s]=t[i],s++),i++);t.length=s}function RZt(t,e,r){let i=0,s=0;for(;i<r.length;)_ge(t,r[i])>=0===e&&(r[s]=r[i],s++),i++;r.length=s}const sA=zt();function MZt(t,e){if(e.rotationScale[1]===0&&e.rotationScale[2]===0&&e.rotationScale[3]===0&&e.rotationScale[5]===0&&e.rotationScale[6]===0&&e.rotationScale[7]===0)return sA[0]=(t[0]-e.position[0])/e.rotationScale[0],sA[1]=(t[1]-e.position[1])/e.rotationScale[4],sA[2]=(t[2]-e.position[0])/e.rotationScale[0],sA[3]=(t[3]-e.position[1])/e.rotationScale[4],sA}var lw;function w3t(t,e){const r=e[0],i=e[1],s=e[3],n=t[0]-r,o=r-t[2],a=t[1]-i,l=i-t[3],c=Math.max(n,o,0),h=Math.max(a,l,0),d=c*c+h*h;return d>s*s?lw.OUTSIDE:d>0?lw.INTERSECTS_CENTER_OUTSIDE:-Math.max(n,o,a,l)>s?lw.INSIDE:lw.INTERSECTS_CENTER_INSIDE}function x3t(t,e,r){const i=[],s=r&&r.missingFields,n=r&&r.originalFields;for(const o of t){const a=o.toLowerCase();let l=!1;for(const c of e)if(a===c.name.toLowerCase()){i.push(c.name),l=!0,n&&n.push(o);break}!l&&s&&s.push(o)}return i}async function PZt(t,e,r,i,s){if(e.length===0)return[];const n=t.attributeStorageInfo;if(t.associatedLayer!=null)try{return await S3t(t.associatedLayer,e,r,i)}catch(o){if(t.associatedLayer.loaded)throw o}if(n){const o=T3t(e,r,s);if(o==null)throw new U("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const a=t.parsedUrl.path;return(await Promise.all(o.map(l=>E3t(a,n,l.node,l.indices,i).then(c=>{for(let h=0;h<l.graphics.length;h++){const d=l.graphics[h],f=c[h];if(d.attributes)for(const m in d.attributes)m in f||(f[m]=d.attributes[m]);d.attributes=f}return l.graphics})))).flat()}throw new U("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available")}function T3t(t,e,r){const i=new Map,s=[],n=r();for(const o of t){const a=o.attributes[e];for(let l=0;l<n.length;l++){const c=n[l],h=c.featureIds.indexOf(a);if(h>=0){let d=i.get(c.node);d||(d={node:c.node,indices:[],graphics:[]},s.push(d),i.set(c.node,d)),d.indices.push(h),d.graphics.push(o);for(let f=l;f>0;f--)n[f]=n[f-1];n[0]=c;break}}}return s}async function S3t(t,e,r,i){e.sort((l,c)=>l.attributes[r]-c.attributes[r]);const s=e.map(l=>l.attributes[r]),n=[],o=x3t(i,t.fields,{originalFields:n}),a=await S$e(t,s,o);for(let l=0;l<e.length;l++){const c=e[l],h=a[l],d={};if(c.attributes)for(const f in c.attributes)d[f]=c.attributes[f];for(let f=0;f<n.length;f++)d[n[f]]=h[o[f]];c.attributes=d}return e}function S$e(t,e,r){const i=t.capabilities.query.maxRecordCount;if(i!=null&&e.length>i){const n=ODe(e,i);return Promise.all(n.map(o=>S$e(t,o,r))).then(o=>o.flat())}const s=new j0({objectIds:e,outFields:r,orderByFields:[t.objectIdField]});return t.queryFeatures(s).then(n=>{if(n&&n.features&&n.features.length===e.length)return n.features.map(o=>o.attributes);throw new U("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer")})}function E3t(t,e,r,i,s){return E$e(t,e,r.resources.attributes,i,s)}function E$e(t,e,r,i,s){const n=[];for(const o of e)if(o&&s.includes(o.name)){const a=`${t}/nodes/${r}/attributes/${o.key}/0`;n.push({url:a,storageInfo:o})}return Ac(n.map(o=>ur(o.url,{responseType:"array-buffer"}).then(a=>y3t(o.storageInfo,a.data)))).then(o=>{const a=[];for(const l of i){const c={};for(let h=0;h<o.length;h++){const d=o[h].value;d!=null&&(c[n[h].storageInfo.name]=O3t(d,l))}a.push(c)}return a})}(function(t){t[t.OUTSIDE=0]="OUTSIDE",t[t.INTERSECTS_CENTER_OUTSIDE=1]="INTERSECTS_CENTER_OUTSIDE",t[t.INTERSECTS_CENTER_INSIDE=2]="INTERSECTS_CENTER_INSIDE",t[t.INSIDE=3]="INSIDE"})(lw||(lw={}));const C3t=-32768,A3t=-(2**31);function O3t(t,e){if(!t)return null;const r=t[e];return $6(t)?r===C3t?null:r:D6(t)?r===A3t?null:r:r!=r?null:r}function R3t(t){const e=t.store,r=e.indexCRS||e.geographicCRS,i=r===void 0?e.indexWKT:void 0;if(i){if(!t.spatialReference)throw new U("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference","Found indeWKT in the scene layer store but no layer spatial reference",{});if(i!==t.spatialReference.wkt)throw new U("layerview:store-spatial-reference-wkt-index-incompatible","The indeWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const s=r?new qe(T$e(r)):t.spatialReference;return s.equals(t.spatialReference)?t.spatialReference:s}function M3t(t){const e=t.store,r=e.vertexCRS||e.projectedCRS,i=r===void 0?e.vertexWKT:void 0;if(i){if(!t.spatialReference)throw new U("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference","Found vertexWKT in the scene layer store but no layer spatial reference",{});if(i!==t.spatialReference.wkt)throw new U("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const s=r?new qe(T$e(r)):t.spatialReference;return s.equals(t.spatialReference)?t.spatialReference:s}function IZt(t,e){return e==null?"@null":e===_m(e)?"@ECEF":t.equals(e)?"":e.wkid!=null?"@"+e.wkid:null}function QX(t,e,r){if(!gm(t,e))throw new U("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if(r==="local"&&!P3t(t,e))throw new U("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{})}function $Zt(t,e,r){if(t.serviceUpdateTimeStamp?.lastUpdate!==e.serviceUpdateTimeStamp?.lastUpdate||!r.isEmpty||Cc(t.associatedLayer,i=>i.url)!==Cc(e.associatedLayer,i=>i.url))throw new U("layerview:recycle-failed")}function P3t(t,e){return t.equals(e)||t.isWGS84&&e.isWebMercator||t.isWebMercator&&e.isWGS84}function I3t(t,e,r){const i=R3t(t),s=M3t(t);QX(i,e,r),QX(s,e,r)}function $3t(t){return(t.geometryType==null||t.geometryType==="triangles")&&(t.topology==null||t.topology==="PerAttributeArray")&&t.vertexAttributes!=null&&t.vertexAttributes.position!=null}function LZt(t){if(t.store==null||t.store.defaultGeometrySchema==null||!$3t(t.store.defaultGeometrySchema))throw new U("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:t.parsedUrl.path})}function DZt(t,e){I3t(t,e.spatialReference,e.viewingMode)}function L3t(t){return t.geometryType!=null&&t.geometryType==="points"&&(t.topology==null||t.topology==="PerAttributeArray")&&(t.encoding==null||t.encoding===""||t.encoding==="lepcc-xyz")&&t.vertexAttributes!=null&&t.vertexAttributes.position!=null}function NZt(t){if(t.store==null||t.store.defaultGeometrySchema==null||!L3t(t.store.defaultGeometrySchema))throw new U("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{})}function FZt(t,e){QX(t.spatialReference,e.spatialReference,e.viewingMode)}function D3t(t){return t.type==="simple"||t.type==="class-breaks"||t.type==="unique-value"}function N3t(t){return t.type==="mesh-3d"}function UZt(t){if(t==null||!D3t(t)||(t.type==="unique-value"||t.type==="class-breaks")&&t.defaultSymbol==null)return!0;const e=t.getSymbols();if(e.length===0)return!0;for(const r of e){if(!N3t(r)||r.symbolLayers.length===0)return!0;for(const i of r.symbolLayers.items)if(i.type!=="fill"||i.material==null||i.material.color==null||i.material.colorMixMode!=="replace")return!0}return!1}const kZt=lCe({color:[0,0,0,0],opacity:0});class F3t{constructor(){this.edgeMaterial=null,this.material=null,this.castShadows=!0}}function zZt(t){const e=new F3t;let r=!1,i=!1;for(const s of t.symbolLayers.items)if(s.type==="fill"&&s.enabled){const n=s.material,o=s.edges;if(n!=null&&!r){const a=n.color,l=G3e(n.colorMixMode);e.material=a!=null?{color:[a.r/255,a.g/255,a.b/255],alpha:a.a,colorMixMode:l}:{color:[1,1,1],alpha:1,colorMixMode:Hs.Multiply},e.castShadows=s.castShadows,r=!0}o==null||i||(e.edgeMaterial=aCe(o,{}),i=!0)}return e.material||(e.material={color:[1,1,1],alpha:1,colorMixMode:Hs.Multiply}),e}function VZt(t,e){return(0|t)+(0|e)|0}function U3t(t,e,r,i,s=0){i===_m(i)?e.isGeographic?j3t(t,r,e,s):G3t(t,r,e,s):e.isWGS84&&(i.isWebMercator||sM(i))?k3t(e,t,i,r,s):e.isWebMercator&&sM(i)?B3t(e,t,i,r,s):t===r?(r.center[2]+=s,ci(r.center,e,0,r.center,i,0,1)):(ne(r.center,t.center[0],t.center[1],t.center[2]+s),ci(r.center,e,0,r.center,i,0,1),NP(r.quaternion,t.quaternion),ie(r.halfSize,t.halfSize))}function k3t(t,e,r,i,s){ie(M_,e.center),M_[2]+=s;const n=_m(r);ci(M_,t,0,M_,n,0,1),C$e(n,e,M_,r,i)}const E4=new Array(24),z3t=new We(E4,3,!0),Yfe=O(),M_=O(),V3t=ki();function B3t(t,e,r,i,s){ie(M_,e.center),M_[2]+=s,C$e(t,e,M_,r,i)}function C$e(t,e,r,i,s){const n=k8(V3t,e.quaternion);for(let o=0;o<8;++o){for(let a=0;a<3;++a)Yfe[a]=e.halfSize[a]*(o&1<<a?-1:1);for(let a=0;a<3;++a){let l=r[a];for(let c=0;c<3;++c)l+=Yfe[c]*n[3*c+a];E4[3*o+a]=l}}ci(E4,t,0,E4,i,0,8),QRe(z3t,s)}function G3t(t,e,r,i){KRe(t,KX),ne(e.center,t.center[0],t.center[1],t.center[2]+i),Fl(r,e.center,Qc,_m(r)),ne(e.center,Qc[12],Qc[13],Qc[14]);const s=2*Math.sqrt(1+Qc[0]+Qc[5]+Qc[10]);Ng[0]=(Qc[6]-Qc[9])/s,Ng[1]=(Qc[8]-Qc[2])/s,Ng[2]=(Qc[1]-Qc[4])/s,Ng[3]=.25*s,J8(e.quaternion,Ng,t.quaternion),wm(Ng,e.quaternion);let n=0,o=0,a=0;for(const l of KX)l[2]+=i,ci(l,r,0,l,_m(r),0,1),Pn(Mr,l,e.center),Lc(Mr,Mr,Ng),n=Math.max(n,Math.abs(Mr[0])),o=Math.max(o,Math.abs(Mr[1])),a=Math.max(a,Math.abs(Mr[2]));ne(e.halfSize,n,o,a)}function j3t(t,e,r,i){const s=Vr(r),n=1+Math.max(0,i)/(s.radius+t.center[2]);ne(e.center,t.center[0],t.center[1],t.center[2]+i),ci(e.center,r,0,e.center,_m(r),0,1),NP(e.quaternion,t.quaternion),wm(Ng,t.quaternion),ne(Mr,0,0,1),Lc(Mr,Mr,Ng),ne(Mr,t.halfSize[0]*Math.abs(Mr[0]),t.halfSize[1]*Math.abs(Mr[1]),t.halfSize[2]*Math.abs(Mr[2])),se(Mr,Mr,s.inverseFlattening),de(e.halfSize,t.halfSize,Mr),se(e.halfSize,e.halfSize,n)}function BZt(t,e,r,i,s,n){if(!n||n.length===0||e==null||!t.mbs)return null;const o=v3t(t.mbs,s,r,e);$n(vD,o);let a=null;const l=()=>{if(!a)if(a=KX,Uc(_D),t.serviceObb!=null){U3t(t.serviceObb,r,Zfe,e,s),KRe(Zfe,a);for(const m of a)ze(m,m,vD),IS(_D,m)}else{const m=t.mbs;if(!m)return;const g=m[3];Qs(m,r,Mr,e),ze(Mr,Mr,vD),Mr[2]+=s;for(let _=0;_<8;++_){const v=1&_?g:-g,b=2&_?g:-g,T=4&_?g:-g,x=a[_];ie(x,[Mr[0]+v,Mr[1]+b,Mr[2]+T]),IS(_D,x)}}};let c=1/0,h=-1/0;const d=m=>{if(m.type!=="replace")return;const g=m.geometry;if(!g?.hasZ)return;Uc(u7);const _=g.spatialReference||i,v=g.rings.reduce((b,T)=>T.reduce((x,S)=>(Qs(S,_,Mr,e),ze(Mr,Mr,vD),IS(u7,Mr),Math.min(Mr[2],x)),b),1/0);l(),yP(_D,u7)&&(c=Math.min(c,v),h=Math.max(h,v))};if(n.forEach(m=>d(m)),c===1/0)return null;const f=(m,g,_)=>{ze(Mr,_,o),m[g]=Mr[0],m[g+1]=Mr[1],m[g+2]=Mr[2],g+=24,_[2]=c,ze(Mr,_,o),m[g]=Mr[0],m[g+1]=Mr[1],m[g+2]=Mr[2],g+=24,_[2]=h,ze(Mr,_,o),m[g]=Mr[0],m[g+1]=Mr[1],m[g+2]=Mr[2]};for(let m=0;m<8;++m)f(Jfe.data,3*m,a[m]);return QRe(Jfe)}function GZt(t){return t!=null&&t.halfSize[0]>=0}function jZt(t){return t[3]>=0}function HZt(t){t!=null&&(t.halfSize[0]=-1)}function qZt(t){t!=null&&(t[3]=-1)}const Qc=xe(),Ng=HRe(),KX=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],u7=zt(),_D=zt(),Zfe=Iee(),Mr=O(),Jfe={data:new Array(72),size:3,exclusive:!0,stride:3},vD=xe();async function H3t(t,e=t.popupTemplate){if(e==null)return[];const r=await e.getRequiredFields(t.fieldsIndex),{lastEditInfoEnabled:i}=e,{objectIdField:s,typeIdField:n,globalIdField:o,relationships:a}=t;if(r.includes("*"))return["*"];const l=i?await d9e(t):[],c=r8(t.fieldsIndex,[...r,...l]);return n&&c.push(n),c&&s&&t.fieldsIndex?.has(s)&&!c.includes(s)&&c.push(s),c&&o&&t.fieldsIndex?.has(o)&&!c.includes(o)&&c.push(o),a&&a.forEach(h=>{const{keyField:d}=h;c&&d&&t.fieldsIndex?.has(d)&&!c.includes(d)&&c.push(d)}),c}function A$e(t,e){return t.popupTemplate?t.popupTemplate:e!=null&&e.defaultPopupTemplateEnabled&&t.defaultPopupTemplate!=null?t.defaultPopupTemplate:null}function WZt(t,e){return A$e(t,{defaultPopupTemplateEnabled:e})!=null}const q3t=["3DObject","Point"],Qfe=u$e();let Lt=class extends wIe(USt(yIe(RIe(PIe(IIe(ete(gIe(Hi(DZ))))))))){constructor(...t){super(...t),this.featureReduction=null,this.rangeInfos=null,this.operationalLayerType="ArcGISSceneServiceLayer",this.type="scene",this.fields=null,this.floorInfo=null,this.outFields=null,this.nodePages=null,this.materialDefinitions=null,this.textureSetDefinitions=null,this.geometryDefinitions=null,this.serviceUpdateTimeStamp=null,this.excludeObjectIds=new Pt,this.definitionExpression=null,this.filter=null,this.path=null,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.priority=null,this.semantic=null,this.cachedDrawingInfo={color:!1},this.popupEnabled=!0,this.popupTemplate=null,this.objectIdField=null,this.globalIdField=null,this._fieldUsageInfo={},this.screenSizePerspectiveEnabled=!0}normalizeCtorArgs(t,e){return typeof t=="string"?{url:t,...e}:t}destroy(){this._set("renderer",null)}getField(t){return this.fieldsIndex.get(t)}getFieldDomain(t,e){const r=this.getFeatureType(e?.feature)?.domains?.[t];return r&&r.type!=="inherited"?r:this.getField(t)?.domain??null}getFeatureType(t){return t&&this.associatedLayer?this.associatedLayer.getFeatureType(t):null}get types(){return this.associatedLayer?.types??[]}get typeIdField(){return this.associatedLayer?.typeIdField??null}get templates(){return this.associatedLayer?.templates??null}get formTemplate(){return this.associatedLayer?.formTemplate??null}get fieldsIndex(){return new Jee(this.fields)}readNodePages(t,e,r){return e.layerType==="Point"&&(t=e.pointNodePages),t==null||typeof t!="object"?null:Jb.fromJSON(t,r)}set elevationInfo(t){this._set("elevationInfo",t),this.loaded&&this._validateElevationInfo()}get geometryType(){return W3t[this.profile]||"mesh"}set renderer(t){p5(t,this.fieldsIndex),this._set("renderer",t)}readCachedDrawingInfo(t){return t!=null&&typeof t=="object"||(t={}),t.color==null&&(t.color=!1),t}get capabilities(){const t=this.associatedLayer?.capabilities??kSt,{query:e,editing:{supportsGlobalId:r,supportsRollbackOnFailure:i,supportsUploadWithItemId:s,supportsGeometryUpdate:n,supportsReturnServiceEditsInSourceSpatialReference:o},data:{supportsZ:a,supportsM:l,isVersioned:c,supportsAttachment:h},operations:{supportsEditing:d,supportsAdd:f,supportsUpdate:m,supportsDelete:g,supportsQuery:_,supportsQueryAttachments:v,supportsAsyncConvert3D:b}}=t,T=t.operations.supportsChangeTracking,x=!!this.associatedLayer?.infoFor3D&&uce();return{query:e,editing:{supportsGlobalId:r,supportsReturnServiceEditsInSourceSpatialReference:o,supportsRollbackOnFailure:i,supportsGeometryUpdate:x&&n,supportsUploadWithItemId:s},data:{supportsAttachment:h,supportsZ:a,supportsM:l,isVersioned:c},operations:{supportsQuery:_,supportsQueryAttachments:v,supportsEditing:d&&T,supportsAdd:x&&f&&T,supportsDelete:x&&g&&T,supportsUpdate:m&&T,supportsAsyncConvert3D:b}}}get editingEnabled(){return this._isOverridden("editingEnabled")?this._get("editingEnabled"):this.userHasEditingPrivileges}set editingEnabled(t){this._overrideIfSome("editingEnabled",t)}get infoFor3D(){return this.associatedLayer?.infoFor3D??null}get defaultPopupTemplate(){return this.associatedLayer||this.attributeStorageInfo?this.createPopupTemplate():null}readObjectIdField(t,e){return!t&&e.fields&&e.fields.some(r=>(r.type==="esriFieldTypeOID"&&(t=r.name),!!t)),t||void 0}readGlobalIdField(t,e){return!t&&e.fields&&e.fields.some(r=>(r.type==="esriFieldTypeGlobalID"&&(t=r.name),!!t)),t||void 0}get displayField(){return this.associatedLayer?.displayField??null}readProfile(t,e){const r=e.store.profile;return r!=null&&Kfe[r]?Kfe[r]:(K.getLogger(this).error("Unknown or missing profile",{profile:r,layer:this}),"mesh-pyramids")}load(t){const e=t!=null?t.signal:null,r=this.loadFromPortal({supportedTypes:["Scene Service"]},t).catch(zo).then(()=>this._fetchService(e)).then(()=>Promise.all([this._fetchIndexAndUpdateExtent(this.nodePages,e),this._setAssociatedFeatureLayer(e),this._loadFilterGeometries()])).then(()=>this._validateElevationInfo()).then(()=>this._applyAssociatedLayerOverrides()).then(()=>this._populateFieldUsageInfo()).then(()=>h$e(this,{origin:"service"},e)).then(()=>p5(this.renderer,this.fieldsIndex)).then(()=>this.finishLoadEditablePortalLayer(t));return this.addResolvingPromise(r),Promise.resolve(this)}async beforeSave(){this.filter!=null&&(this.filter=this.filter.clone(),await this.load())}async _loadFilterGeometries(){if(this.filter)try{await this.filter.loadGeometries(this.spatialReference)}catch(t){K.getLogger(this).error("#_loadFilterGeometries()",this,"Failed to load filter geometries. Geometry filter will not be applied for this layer.",{error:t}),this.filter=null}}createQuery(){const t=new j0;return this.geometryType!=="mesh"&&(t.returnGeometry=!0,t.returnZ=!0),t.where=this.definitionExpression||"1=1",t.sqlFormat="standard",t.outFields=["*"],t}queryExtent(t,e){return this._getAssociatedLayerForQuery().then(r=>r.queryExtent(t||this.createQuery(),e))}queryFeatureCount(t,e){return this._getAssociatedLayerForQuery().then(r=>r.queryFeatureCount(t||this.createQuery(),e))}queryFeatures(t,e){return this._getAssociatedLayerForQuery().then(r=>r.queryFeatures(t||this.createQuery(),e)).then(r=>{if(r?.features)for(const i of r.features)i.layer=this,i.sourceLayer=this;return r})}async queryCachedAttributes(t,e){const r=o9e(this.fieldsIndex,await H3t(this,A$e(this)));return E$e(this.parsedUrl.path,this.attributeStorageInfo??[],t,e,r)}async queryCachedFeature(t,e){const r=await this.queryCachedAttributes(t,[e]);if(!r||r.length===0)throw new U("scenelayer:feature-not-in-cached-data","Feature not found in cached data");const i=new Bl;return i.attributes=r[0],i.layer=this,i.sourceLayer=this,i}queryObjectIds(t,e){return this._getAssociatedLayerForQuery().then(r=>r.queryObjectIds(t||this.createQuery(),e))}queryAttachments(t,e){return this._getAssociatedLayerForQuery().then(r=>r.queryAttachments(t,e))}getFieldUsageInfo(t){const e={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[t]||e:(K.getLogger(this).error("#getFieldUsageInfo()","Unavailable until layer is loaded"),e)}createPopupTemplate(t){return d$e(this,t)}_getAssociatedLayerForQuery(){const t=this.associatedLayer;return t?.loaded?Promise.resolve(t):this._loadAssociatedLayerForQuery()}async _loadAssociatedLayerForQuery(){if(await this.load(),!this.associatedLayer)throw new U("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});try{await this.associatedLayer.load()}catch(t){throw new U("scenelayer:query-not-available","SceneLayer associated feature layer could not be loaded",{layer:this,error:t})}return this.associatedLayer}hasCachedStatistics(t){return this.statisticsInfo!=null&&this.statisticsInfo.some(e=>e.name===t)}async queryCachedStatistics(t,e){if(await this.load(e),!this.statisticsInfo)throw new U("scenelayer:no-cached-statistics","Cached statistics are not available for this layer");const r=this.fieldsIndex.get(t);if(!r)throw new U("scenelayer:field-unexisting",`Field '${t}' does not exist on the layer`);for(const i of this.statisticsInfo)if(i.name===r.name){const s=Fc(this.parsedUrl.path,i.href);return ur(s,{query:{f:"json",token:this.apiKey},responseType:"json",signal:e?e.signal:null}).then(n=>n.data)}throw new U("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available")}async saveAs(t,e){return this._debouncedSaveOperations(nC.SAVE_AS,{...e,getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"},t)}async save(){const t={getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"};return this._debouncedSaveOperations(nC.SAVE,t)}async applyEdits(t,e){const{applyEdits:r}=await he(()=>import("./editingSupport-59a69552.js"),["./editingSupport-59a69552.js","./normalizeUtils-ca47990d.js","./normalizeUtilsCommon-448ddeb2.js"],import.meta.url);if(await this.load(),!this.associatedLayer)throw new U(`${this.type}-layer:not-editable`,"Service is not editable");return await this.associatedLayer.load(),r(this,this.associatedLayer.source,t,e)}async uploadAssets(t,e){if(await this.load(),this.associatedLayer==null)throw new U(`${this.type}-layer:not-editable`,"Service is not editable");return await this.associatedLayer.load(),this.associatedLayer.uploadAssets(t,e)}on(t,e){return super.on(t,e)}validateLayer(t){if(t.layerType&&!q3t.includes(t.layerType))throw new U("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:t.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new U("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});if(this.version.major>2)throw new U("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});function e(r,i){let s=!1,n=!1;if(r==null)s=!0,n=!0;else{const o=i&&i.isGeographic;switch(r){case"east-north-up":case"earth-centered":s=!0,n=o;break;case"vertex-reference-frame":s=!0,n=!o;break;default:s=!1}}if(!s)throw new U("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!n)throw new U("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.")}e(this.normalReferenceFrame,this.spatialReference)}_getTypeKeywords(){const t=[];if(this.profile==="points")t.push("Point");else{if(this.profile!=="mesh-pyramids")throw new U("scenelayer:unknown-profile","SceneLayer:save() encountered an unknown SceneLayer profile: "+this.profile);t.push("3DObject")}return t}_populateFieldUsageInfo(){if(this._fieldUsageInfo={},this.fields)for(const t of this.fields){const e=!(!this.attributeStorageInfo||!this.attributeStorageInfo.some(s=>s.name===t.name)),r=!!this.associatedLayer?.fields?.some(s=>s&&t.name===s.name),i={supportsLabelingInfo:e,supportsRenderer:e,supportsPopupTemplate:e||r,supportsLayerQuery:r};this._fieldUsageInfo[t.name]=i}}_applyAssociatedLayerOverrides(){this._applyAssociatedLayerFieldsOverrides(),this._applyAssociatedLayerPopupOverrides(),this._applyAssociatedLayerExtentOverride()}_applyAssociatedLayerFieldsOverrides(){if(!this.associatedLayer?.fields)return;let t=null;for(const e of this.associatedLayer.fields){const r=this.getField(e.name);r?(!r.domain&&e.domain&&(r.domain=e.domain.clone()),r.editable=e.editable,r.nullable=e.nullable,r.length=e.length):(t||(t=this.fields?this.fields.slice():[]),t.push(e.clone()))}t&&this._set("fields",t)}_applyAssociatedLayerPopupOverrides(){if(!this.associatedLayer)return;const t=["popupTemplate","popupEnabled"],e=ba(this);for(let r=0;r<t.length;r++){const i=t[r],s=this.originIdOf(i),n=this.associatedLayer.originIdOf(i);s<n&&(n===mr.SERVICE||n===mr.PORTAL_ITEM)&&e.setAtOrigin(i,this.associatedLayer[i],n)}}_applyAssociatedLayerExtentOverride(){const t=this.associatedLayer?.editingInfo?.lastEditDate,e=this.associatedLayer?.serverGens,r=this.associatedLayer?.getAtOrigin("fullExtent","service");!uce()||this.associatedLayer?.infoFor3D==null||!r||!VJ(this.associatedLayer?.url)||!t||this.serviceUpdateTimeStamp?.lastUpdate===t.getTime()||!this.serviceUpdateTimeStamp&&e?.minServerGen===e?.serverGen||ba(this).setAtOrigin("fullExtent",r.clone(),mr.SERVICE)}async _setAssociatedFeatureLayer(t){if(!["mesh-pyramids","points"].includes(this.profile))return;const e=new HCt(this.parsedUrl,this.portalItem,this.apiKey,t);try{this.associatedLayer=await e.fetch()}catch(r){ds(r)||this._logWarningOnPopupEnabled()}}async _logWarningOnPopupEnabled(){await d0(()=>this.popupEnabled&&this.popupTemplate!=null);const t=`this SceneLayer: ${this.title}`;this.attributeStorageInfo==null?K.getLogger(this).warn(`Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on ${t}`):K.getLogger(this).info(`Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on ${t}`)}_validateElevationInfo(){const t=this.elevationInfo;t&&(this.profile==="mesh-pyramids"&&t.mode==="relative-to-scene"&&K.getLogger(this).warn(".elevationInfo=","Mesh scene layers don't support relative-to-scene elevation mode"),t.featureExpressionInfo&&t.featureExpressionInfo.expression!=="0"&&K.getLogger(this).warn(".elevationInfo=","Scene layers do not support featureExpressionInfo"))}};u([p({types:{key:"type",base:c0,typeMap:{selection:nX}},json:{origins:{"web-scene":{name:"layerDefinition.featureReduction",write:!0},"portal-item":{name:"layerDefinition.featureReduction",write:!0}}}})],Lt.prototype,"featureReduction",void 0),u([p({type:[l_],json:{read:!1,origins:{"web-scene":{name:"layerDefinition.rangeInfos",write:!0},"portal-item":{name:"layerDefinition.rangeInfos",write:!0}}}})],Lt.prototype,"rangeInfos",void 0),u([p({json:{read:!1}})],Lt.prototype,"associatedLayer",void 0),u([p({type:["show","hide"]})],Lt.prototype,"listMode",void 0),u([p({type:["ArcGISSceneServiceLayer"]})],Lt.prototype,"operationalLayerType",void 0),u([p({json:{read:!1},readOnly:!0})],Lt.prototype,"type",void 0),u([p({...Qfe.fields,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],Lt.prototype,"fields",void 0),u([p()],Lt.prototype,"types",null),u([p()],Lt.prototype,"typeIdField",null),u([p()],Lt.prototype,"templates",null),u([p()],Lt.prototype,"formTemplate",null),u([p({readOnly:!0})],Lt.prototype,"fieldsIndex",null),u([p({type:XIe,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],Lt.prototype,"floorInfo",void 0),u([p(Qfe.outFields)],Lt.prototype,"outFields",void 0),u([p({type:Jb,readOnly:!0,json:{read:!1}})],Lt.prototype,"nodePages",void 0),u([Oe("service","nodePages",["nodePages","pointNodePages"])],Lt.prototype,"readNodePages",null),u([p({type:[fh],readOnly:!0})],Lt.prototype,"materialDefinitions",void 0),u([p({type:[WO],readOnly:!0})],Lt.prototype,"textureSetDefinitions",void 0),u([p({type:[YO],readOnly:!0})],Lt.prototype,"geometryDefinitions",void 0),u([p({readOnly:!0})],Lt.prototype,"serviceUpdateTimeStamp",void 0),u([p({readOnly:!0})],Lt.prototype,"attributeStorageInfo",void 0),u([p({readOnly:!0})],Lt.prototype,"statisticsInfo",void 0),u([p({type:Pt.ofType(Number),nonNullable:!0,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.excludeObjectIds",write:{enabled:!0}}})],Lt.prototype,"excludeObjectIds",void 0),u([p({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],Lt.prototype,"definitionExpression",void 0),u([p({type:i3t,json:{name:"layerDefinition.polygonFilter",write:{enabled:!0,allowNull:!0},origins:{service:{read:!1,write:!1}}}})],Lt.prototype,"filter",void 0),u([p({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],Lt.prototype,"path",void 0),u([p(EIe)],Lt.prototype,"elevationInfo",null),u([p({type:String})],Lt.prototype,"geometryType",null),u([p(sU)],Lt.prototype,"labelsVisible",void 0),u([p({type:[WC],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:{reader:a6},write:!1}},name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:a6},write:!0}})],Lt.prototype,"labelingInfo",void 0),u([p(SIe)],Lt.prototype,"legendEnabled",void 0),u([p({type:Number,json:{origins:{"web-document":{default:1,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}},read:{source:["opacity","layerDefinition.drawingInfo.transparency"],reader(t,e){if(typeof t=="number"&&t>=0&&t<=1)return t;const r=e.layerDefinition?.drawingInfo?.transparency;return r!==void 0?gE(r):void 0}}},"portal-item":{write:!0},service:{read:!1}}}})],Lt.prototype,"opacity",void 0),u([p({type:["Low","High"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],Lt.prototype,"priority",void 0),u([p({type:["Labels"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],Lt.prototype,"semantic",void 0),u([p({types:pIe,json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],Lt.prototype,"renderer",null),u([p({json:{read:!1}})],Lt.prototype,"cachedDrawingInfo",void 0),u([Oe("service","cachedDrawingInfo")],Lt.prototype,"readCachedDrawingInfo",null),u([p({readOnly:!0,json:{read:!1}})],Lt.prototype,"capabilities",null),u([p({type:Boolean,json:{read:!1}})],Lt.prototype,"editingEnabled",null),u([p({readOnly:!0,json:{write:!1,read:!1}})],Lt.prototype,"infoFor3D",null),u([p(iU)],Lt.prototype,"popupEnabled",void 0),u([p({type:Rv,json:{name:"popupInfo",write:!0}})],Lt.prototype,"popupTemplate",void 0),u([p({readOnly:!0,json:{read:!1}})],Lt.prototype,"defaultPopupTemplate",null),u([p({type:String,json:{read:!1}})],Lt.prototype,"objectIdField",void 0),u([Oe("service","objectIdField",["objectIdField","fields"])],Lt.prototype,"readObjectIdField",null),u([p({type:String,json:{read:!1}})],Lt.prototype,"globalIdField",void 0),u([Oe("service","globalIdField",["globalIdField","fields"])],Lt.prototype,"readGlobalIdField",null),u([p({readOnly:!0,type:String,json:{read:!1}})],Lt.prototype,"displayField",null),u([p({type:String,json:{read:!1}})],Lt.prototype,"profile",void 0),u([Oe("service","profile",["store.profile"])],Lt.prototype,"readProfile",null),u([p({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],Lt.prototype,"normalReferenceFrame",void 0),u([p(xIe)],Lt.prototype,"screenSizePerspectiveEnabled",void 0),Lt=u([P("esri.layers.SceneLayer")],Lt);const Kfe={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},W3t={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"},O$e=Lt,XZt=Object.freeze(Object.defineProperty({__proto__:null,default:O$e},Symbol.toStringTag,{value:"Module"})),Pi={ageClasses:[{minValue:1900,maxValue:1924,color:new ke([153,167,204])},{minValue:1925,maxValue:1949,color:new ke([149,184,214])},{minValue:1950,maxValue:1974,color:new ke([153,204,203])},{minValue:1975,maxValue:1999,color:new ke([153,204,179])},{minValue:2e3,maxValue:2024,color:new ke([175,206,152])}],defaultColor:new ke([230,230,230]),highlightOptions:{color:new ke([255,255,0]),fillOpacity:.4},buildingOptions:{minHeight:0,maxHeight:1500,minCnstrctYear:1900,maxCnstrctYear:2024},initPeriod:[!0,!0,!0,!0,!0],categories:[{value:"all",text:"Show all buildings"},{value:"info",text:"Only annotated buildings"},{value:"top",text:"Top 20 buildings"}],initCategory:"all",infoPointsUrl:"https://services2.arcgis.com/cFEFS0EWrhfDeVw9/ArcGIS/rest/services/Centroids_Manhattan_Information/FeatureServer/0",buildingsUrl:"https://tiles.arcgis.com/tiles/cFEFS0EWrhfDeVw9/arcgis/rest/services/Buildings_Manhattan/SceneServer",maxPhotoCount:10,maxAttributionLength:50};class X3t{constructor(e,r){this.layer=e,this.field=r,this.layer=e,this.field=r}createClassBreakInfos(e){return Pi.ageClasses.map((r,i)=>{const s=e[i]?r.color:Pi.defaultColor;return{minValue:r.minValue,maxValue:r.maxValue,symbol:new SE({symbolLayers:[new Vw({material:{color:s},edges:new Ive({size:1.2,color:[50,50,50,.2]})})]})}})}applyClassBreaksRenderer(e,r){const i=new SE({symbolLayers:[new Vw({material:{color:Pi.defaultColor}})]});this.layer.renderer=new Zee({field:this.field,defaultSymbol:i,classBreakInfos:this.createClassBreakInfos(e)}),this.applyCategory(r.selectedCategory)}applyCategory(e){const r=this.layer.renderer.clone();if(e==="all")r.visualVariables=[];else{const i=e==="info"?"WIKI":"TOP20";r.visualVariables=[new Yee({field:i,stops:[{value:0,opacity:.1},{value:1,opacity:1}]})]}this.layer.renderer=r}createUniqueValueRenderer(e,r){return new tU({field:e,uniqueValueInfos:[{value:r.value,symbol:new qf({symbolLayers:[new Hf({size:18,resource:{href:r.image}})],verticalOffset:{screenLength:80,maxWorldLength:100},callout:{type:"line",size:1,color:[50,50,50],border:{color:[255,255,255]}}})}]})}}function Y3t(t,e){ur(t,{responseType:"json"}).then(function(r){const i=[];for(let o=0;o<r.data.features.length;o++){var s=r.data.features[o];i.push({geometry:new tt({x:s.geometry.coordinates[0],y:s.geometry.coordinates[1],z:0}),attributes:{OBJECTID:s.properties.FID,Name:s.properties.Name}})}const n=new tP({fields:[{name:"OBJECTID",alias:"objectId",type:"oid"},{name:"Name",alias:"Name",type:"string"}],objectIdField:"OBJECTID",geometryType:"point",spatialReference:new qe({wkid:4326}),source:i,labelsVisible:!0,labelingInfo:[new WC({labelExpressionInfo:{expression:"$feature.Name"},symbol:new TP({symbolLayers:[new Pv({material:{color:"white"},text:s.properties.Name,font:{family:"sans-serif",weight:"bold"},size:12,halo:{color:[50,50,50,.8],size:1}})],verticalOffset:{screenLength:100,maxWorldLength:100},callout:{type:"line",size:2,color:[150,150,150],border:{color:[255,255,255]}}})})],renderer:new aI({symbol:new qf({symbolLayers:[new Hf({resource:{primitive:"circle"},size:1,material:{color:[255,255,255]}})]})})});e.add(n)})}function R$e(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Z3t(t){return t.length===1&&(t=J3t(t)),{left:function(e,r,i,s){for(i==null&&(i=0),s==null&&(s=e.length);i<s;){var n=i+s>>>1;t(e[n],r)<0?i=n+1:s=n}return i},right:function(e,r,i,s){for(i==null&&(i=0),s==null&&(s=e.length);i<s;){var n=i+s>>>1;t(e[n],r)>0?s=n:i=n+1}return i}}}function J3t(t){return function(e,r){return R$e(t(e),r)}}var Q3t=Z3t(R$e),K3t=Q3t.right,eY=Math.sqrt(50),tY=Math.sqrt(10),rY=Math.sqrt(2);function eAt(t,e,r){var i,s=-1,n,o,a;if(e=+e,t=+t,r=+r,t===e&&r>0)return[t];if((i=e<t)&&(n=t,t=e,e=n),(a=C4(t,e,r))===0||!isFinite(a))return[];if(a>0)for(t=Math.ceil(t/a),e=Math.floor(e/a),o=new Array(n=Math.ceil(e-t+1));++s<n;)o[s]=(t+s)*a;else for(t=Math.floor(t*a),e=Math.ceil(e*a),o=new Array(n=Math.ceil(t-e+1));++s<n;)o[s]=(t-s)/a;return i&&o.reverse(),o}function C4(t,e,r){var i=(e-t)/Math.max(0,r),s=Math.floor(Math.log(i)/Math.LN10),n=i/Math.pow(10,s);return s>=0?(n>=eY?10:n>=tY?5:n>=rY?2:1)*Math.pow(10,s):-Math.pow(10,-s)/(n>=eY?10:n>=tY?5:n>=rY?2:1)}function tAt(t,e,r){var i=Math.abs(e-t)/Math.max(0,r),s=Math.pow(10,Math.floor(Math.log(i)/Math.LN10)),n=i/s;return n>=eY?s*=10:n>=tY?s*=5:n>=rY&&(s*=2),e<t?-s:s}var h7=Array.prototype.slice;function rAt(t){return t}var d7=1,p7=2,eme=3,ZO=4,tme=1e-6;function iAt(t){return"translate("+(t+.5)+",0)"}function sAt(t){return"translate(0,"+(t+.5)+")"}function nAt(t){return function(e){return+t(e)}}function oAt(t){var e=Math.max(0,t.bandwidth()-1)/2;return t.round()&&(e=Math.round(e)),function(r){return+t(r)+e}}function aAt(){return!this.__axis}function lAt(t,e){var r=[],i=null,s=null,n=6,o=6,a=3,l=t===d7||t===ZO?-1:1,c=t===ZO||t===p7?"x":"y",h=t===d7||t===eme?iAt:sAt;function d(f){var m=i??(e.ticks?e.ticks.apply(e,r):e.domain()),g=s??(e.tickFormat?e.tickFormat.apply(e,r):rAt),_=Math.max(n,0)+a,v=e.range(),b=+v[0]+.5,T=+v[v.length-1]+.5,x=(e.bandwidth?oAt:nAt)(e.copy()),S=f.selection?f.selection():f,E=S.selectAll(".domain").data([null]),A=S.selectAll(".tick").data(m,e).order(),R=A.exit(),M=A.enter().append("g").attr("class","tick"),D=A.select("line"),k=A.select("text");E=E.merge(E.enter().insert("path",".tick").attr("class","domain").attr("stroke","#000")),A=A.merge(M),D=D.merge(M.append("line").attr("stroke","#000").attr(c+"2",l*n)),k=k.merge(M.append("text").attr("fill","#000").attr(c,l*_).attr("dy",t===d7?"0em":t===eme?"0.71em":"0.32em")),f!==S&&(E=E.transition(f),A=A.transition(f),D=D.transition(f),k=k.transition(f),R=R.transition(f).attr("opacity",tme).attr("transform",function(L){return isFinite(L=x(L))?h(L):this.getAttribute("transform")}),M.attr("opacity",tme).attr("transform",function(L){var N=this.parentNode.__axis;return h(N&&isFinite(N=N(L))?N:x(L))})),R.remove(),E.attr("d",t===ZO||t==p7?"M"+l*o+","+b+"H0.5V"+T+"H"+l*o:"M"+b+","+l*o+"V0.5H"+T+"V"+l*o),A.attr("opacity",1).attr("transform",function(L){return h(x(L))}),D.attr(c+"2",l*n),k.attr(c,l*_).text(g),S.filter(aAt).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",t===p7?"start":t===ZO?"end":"middle"),S.each(function(){this.__axis=x})}return d.scale=function(f){return arguments.length?(e=f,d):e},d.ticks=function(){return r=h7.call(arguments),d},d.tickArguments=function(f){return arguments.length?(r=f==null?[]:h7.call(f),d):r.slice()},d.tickValues=function(f){return arguments.length?(i=f==null?null:h7.call(f),d):i&&i.slice()},d.tickFormat=function(f){return arguments.length?(s=f,d):s},d.tickSize=function(f){return arguments.length?(n=o=+f,d):n},d.tickSizeInner=function(f){return arguments.length?(n=+f,d):n},d.tickSizeOuter=function(f){return arguments.length?(o=+f,d):o},d.tickPadding=function(f){return arguments.length?(a=+f,d):a},d}function cAt(t){return lAt(ZO,t)}var uAt={value:function(){}};function ute(){for(var t=0,e=arguments.length,r={},i;t<e;++t){if(!(i=arguments[t]+"")||i in r)throw new Error("illegal type: "+i);r[i]=[]}return new A4(r)}function A4(t){this._=t}function hAt(t,e){return t.trim().split(/^|\s+/).map(function(r){var i="",s=r.indexOf(".");if(s>=0&&(i=r.slice(s+1),r=r.slice(0,s)),r&&!e.hasOwnProperty(r))throw new Error("unknown type: "+r);return{type:r,name:i}})}A4.prototype=ute.prototype={constructor:A4,on:function(t,e){var r=this._,i=hAt(t+"",r),s,n=-1,o=i.length;if(arguments.length<2){for(;++n<o;)if((s=(t=i[n]).type)&&(s=dAt(r[s],t.name)))return s;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++n<o;)if(s=(t=i[n]).type)r[s]=rme(r[s],t.name,e);else if(e==null)for(s in r)r[s]=rme(r[s],t.name,null);return this},copy:function(){var t={},e=this._;for(var r in e)t[r]=e[r].slice();return new A4(t)},call:function(t,e){if((s=arguments.length-2)>0)for(var r=new Array(s),i=0,s,n;i<s;++i)r[i]=arguments[i+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(n=this._[t],i=0,s=n.length;i<s;++i)n[i].value.apply(e,r)},apply:function(t,e,r){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],s=0,n=i.length;s<n;++s)i[s].value.apply(e,r)}};function dAt(t,e){for(var r=0,i=t.length,s;r<i;++r)if((s=t[r]).name===e)return s.value}function rme(t,e,r){for(var i=0,s=t.length;i<s;++i)if(t[i].name===e){t[i]=uAt,t=t.slice(0,i).concat(t.slice(i+1));break}return r!=null&&t.push({name:e,value:r}),t}var iY="http://www.w3.org/1999/xhtml";const ime={svg:"http://www.w3.org/2000/svg",xhtml:iY,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function aU(t){var e=t+="",r=e.indexOf(":");return r>=0&&(e=t.slice(0,r))!=="xmlns"&&(t=t.slice(r+1)),ime.hasOwnProperty(e)?{space:ime[e],local:t}:t}function pAt(t){return function(){var e=this.ownerDocument,r=this.namespaceURI;return r===iY&&e.documentElement.namespaceURI===iY?e.createElement(t):e.createElementNS(r,t)}}function fAt(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function M$e(t){var e=aU(t);return(e.local?fAt:pAt)(e)}function mAt(){}function hte(t){return t==null?mAt:function(){return this.querySelector(t)}}function gAt(t){typeof t!="function"&&(t=hte(t));for(var e=this._groups,r=e.length,i=new Array(r),s=0;s<r;++s)for(var n=e[s],o=n.length,a=i[s]=new Array(o),l,c,h=0;h<o;++h)(l=n[h])&&(c=t.call(l,l.__data__,h,n))&&("__data__"in l&&(c.__data__=l.__data__),a[h]=c);return new Uu(i,this._parents)}function yAt(){return[]}function P$e(t){return t==null?yAt:function(){return this.querySelectorAll(t)}}function _At(t){typeof t!="function"&&(t=P$e(t));for(var e=this._groups,r=e.length,i=[],s=[],n=0;n<r;++n)for(var o=e[n],a=o.length,l,c=0;c<a;++c)(l=o[c])&&(i.push(t.call(l,l.__data__,c,o)),s.push(l));return new Uu(i,s)}var I$e=function(t){return function(){return this.matches(t)}};if(typeof document<"u"){var nA=document.documentElement;if(!nA.matches){var vAt=nA.webkitMatchesSelector||nA.msMatchesSelector||nA.mozMatchesSelector||nA.oMatchesSelector;I$e=function(t){return function(){return vAt.call(this,t)}}}}const $$e=I$e;function bAt(t){typeof t!="function"&&(t=$$e(t));for(var e=this._groups,r=e.length,i=new Array(r),s=0;s<r;++s)for(var n=e[s],o=n.length,a=i[s]=[],l,c=0;c<o;++c)(l=n[c])&&t.call(l,l.__data__,c,n)&&a.push(l);return new Uu(i,this._parents)}function L$e(t){return new Array(t.length)}function wAt(){return new Uu(this._enter||this._groups.map(L$e),this._parents)}function l6(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}l6.prototype={constructor:l6,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function xAt(t){return function(){return t}}var sme="$";function TAt(t,e,r,i,s,n){for(var o=0,a,l=e.length,c=n.length;o<c;++o)(a=e[o])?(a.__data__=n[o],i[o]=a):r[o]=new l6(t,n[o]);for(;o<l;++o)(a=e[o])&&(s[o]=a)}function SAt(t,e,r,i,s,n,o){var a,l,c={},h=e.length,d=n.length,f=new Array(h),m;for(a=0;a<h;++a)(l=e[a])&&(f[a]=m=sme+o.call(l,l.__data__,a,e),m in c?s[a]=l:c[m]=l);for(a=0;a<d;++a)m=sme+o.call(t,n[a],a,n),(l=c[m])?(i[a]=l,l.__data__=n[a],c[m]=null):r[a]=new l6(t,n[a]);for(a=0;a<h;++a)(l=e[a])&&c[f[a]]===l&&(s[a]=l)}function EAt(t,e){if(!t)return m=new Array(this.size()),c=-1,this.each(function(A){m[++c]=A}),m;var r=e?SAt:TAt,i=this._parents,s=this._groups;typeof t!="function"&&(t=xAt(t));for(var n=s.length,o=new Array(n),a=new Array(n),l=new Array(n),c=0;c<n;++c){var h=i[c],d=s[c],f=d.length,m=t.call(h,h&&h.__data__,c,i),g=m.length,_=a[c]=new Array(g),v=o[c]=new Array(g),b=l[c]=new Array(f);r(h,d,_,v,b,m,e);for(var T=0,x=0,S,E;T<g;++T)if(S=_[T]){for(T>=x&&(x=T+1);!(E=v[x])&&++x<g;);S._next=E||null}}return o=new Uu(o,i),o._enter=a,o._exit=l,o}function CAt(){return new Uu(this._exit||this._groups.map(L$e),this._parents)}function AAt(t){for(var e=this._groups,r=t._groups,i=e.length,s=r.length,n=Math.min(i,s),o=new Array(i),a=0;a<n;++a)for(var l=e[a],c=r[a],h=l.length,d=o[a]=new Array(h),f,m=0;m<h;++m)(f=l[m]||c[m])&&(d[m]=f);for(;a<i;++a)o[a]=e[a];return new Uu(o,this._parents)}function OAt(){for(var t=this._groups,e=-1,r=t.length;++e<r;)for(var i=t[e],s=i.length-1,n=i[s],o;--s>=0;)(o=i[s])&&(n&&n!==o.nextSibling&&n.parentNode.insertBefore(o,n),n=o);return this}function RAt(t){t||(t=MAt);function e(d,f){return d&&f?t(d.__data__,f.__data__):!d-!f}for(var r=this._groups,i=r.length,s=new Array(i),n=0;n<i;++n){for(var o=r[n],a=o.length,l=s[n]=new Array(a),c,h=0;h<a;++h)(c=o[h])&&(l[h]=c);l.sort(e)}return new Uu(s,this._parents).order()}function MAt(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function PAt(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function IAt(){var t=new Array(this.size()),e=-1;return this.each(function(){t[++e]=this}),t}function $At(){for(var t=this._groups,e=0,r=t.length;e<r;++e)for(var i=t[e],s=0,n=i.length;s<n;++s){var o=i[s];if(o)return o}return null}function LAt(){var t=0;return this.each(function(){++t}),t}function DAt(){return!this.node()}function NAt(t){for(var e=this._groups,r=0,i=e.length;r<i;++r)for(var s=e[r],n=0,o=s.length,a;n<o;++n)(a=s[n])&&t.call(a,a.__data__,n,s);return this}function FAt(t){return function(){this.removeAttribute(t)}}function UAt(t){return function(){this.removeAttributeNS(t.space,t.local)}}function kAt(t,e){return function(){this.setAttribute(t,e)}}function zAt(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function VAt(t,e){return function(){var r=e.apply(this,arguments);r==null?this.removeAttribute(t):this.setAttribute(t,r)}}function BAt(t,e){return function(){var r=e.apply(this,arguments);r==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,r)}}function GAt(t,e){var r=aU(t);if(arguments.length<2){var i=this.node();return r.local?i.getAttributeNS(r.space,r.local):i.getAttribute(r)}return this.each((e==null?r.local?UAt:FAt:typeof e=="function"?r.local?BAt:VAt:r.local?zAt:kAt)(r,e))}function D$e(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function jAt(t){return function(){this.style.removeProperty(t)}}function HAt(t,e,r){return function(){this.style.setProperty(t,e,r)}}function qAt(t,e,r){return function(){var i=e.apply(this,arguments);i==null?this.style.removeProperty(t):this.style.setProperty(t,i,r)}}function WAt(t,e,r){return arguments.length>1?this.each((e==null?jAt:typeof e=="function"?qAt:HAt)(t,e,r??"")):aC(this.node(),t)}function aC(t,e){return t.style.getPropertyValue(e)||D$e(t).getComputedStyle(t,null).getPropertyValue(e)}function XAt(t){return function(){delete this[t]}}function YAt(t,e){return function(){this[t]=e}}function ZAt(t,e){return function(){var r=e.apply(this,arguments);r==null?delete this[t]:this[t]=r}}function JAt(t,e){return arguments.length>1?this.each((e==null?XAt:typeof e=="function"?ZAt:YAt)(t,e)):this.node()[t]}function N$e(t){return t.trim().split(/^|\s+/)}function dte(t){return t.classList||new F$e(t)}function F$e(t){this._node=t,this._names=N$e(t.getAttribute("class")||"")}F$e.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function U$e(t,e){for(var r=dte(t),i=-1,s=e.length;++i<s;)r.add(e[i])}function k$e(t,e){for(var r=dte(t),i=-1,s=e.length;++i<s;)r.remove(e[i])}function QAt(t){return function(){U$e(this,t)}}function KAt(t){return function(){k$e(this,t)}}function eOt(t,e){return function(){(e.apply(this,arguments)?U$e:k$e)(this,t)}}function tOt(t,e){var r=N$e(t+"");if(arguments.length<2){for(var i=dte(this.node()),s=-1,n=r.length;++s<n;)if(!i.contains(r[s]))return!1;return!0}return this.each((typeof e=="function"?eOt:e?QAt:KAt)(r,e))}function rOt(){this.textContent=""}function iOt(t){return function(){this.textContent=t}}function sOt(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function nOt(t){return arguments.length?this.each(t==null?rOt:(typeof t=="function"?sOt:iOt)(t)):this.node().textContent}function oOt(){this.innerHTML=""}function aOt(t){return function(){this.innerHTML=t}}function lOt(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function cOt(t){return arguments.length?this.each(t==null?oOt:(typeof t=="function"?lOt:aOt)(t)):this.node().innerHTML}function uOt(){this.nextSibling&&this.parentNode.appendChild(this)}function hOt(){return this.each(uOt)}function dOt(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function pOt(){return this.each(dOt)}function fOt(t){var e=typeof t=="function"?t:M$e(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function mOt(){return null}function gOt(t,e){var r=typeof t=="function"?t:M$e(t),i=e==null?mOt:typeof e=="function"?e:hte(e);return this.select(function(){return this.insertBefore(r.apply(this,arguments),i.apply(this,arguments)||null)})}function yOt(){var t=this.parentNode;t&&t.removeChild(this)}function _Ot(){return this.each(yOt)}function vOt(){return this.parentNode.insertBefore(this.cloneNode(!1),this.nextSibling)}function bOt(){return this.parentNode.insertBefore(this.cloneNode(!0),this.nextSibling)}function wOt(t){return this.select(t?bOt:vOt)}function xOt(t){return arguments.length?this.property("__data__",t):this.node().__data__}var z$e={},Nr=null;if(typeof document<"u"){var TOt=document.documentElement;"onmouseenter"in TOt||(z$e={mouseenter:"mouseover",mouseleave:"mouseout"})}function SOt(t,e,r){return t=V$e(t,e,r),function(i){var s=i.relatedTarget;(!s||s!==this&&!(s.compareDocumentPosition(this)&8))&&t.call(this,i)}}function V$e(t,e,r){return function(i){var s=Nr;Nr=i;try{t.call(this,this.__data__,e,r)}finally{Nr=s}}}function EOt(t){return t.trim().split(/^|\s+/).map(function(e){var r="",i=e.indexOf(".");return i>=0&&(r=e.slice(i+1),e=e.slice(0,i)),{type:e,name:r}})}function COt(t){return function(){var e=this.__on;if(e){for(var r=0,i=-1,s=e.length,n;r<s;++r)n=e[r],(!t.type||n.type===t.type)&&n.name===t.name?this.removeEventListener(n.type,n.listener,n.capture):e[++i]=n;++i?e.length=i:delete this.__on}}}function AOt(t,e,r){var i=z$e.hasOwnProperty(t.type)?SOt:V$e;return function(s,n,o){var a=this.__on,l,c=i(e,n,o);if(a){for(var h=0,d=a.length;h<d;++h)if((l=a[h]).type===t.type&&l.name===t.name){this.removeEventListener(l.type,l.listener,l.capture),this.addEventListener(l.type,l.listener=c,l.capture=r),l.value=e;return}}this.addEventListener(t.type,c,r),l={type:t.type,name:t.name,value:e,listener:c,capture:r},a?a.push(l):this.__on=[l]}}function OOt(t,e,r){var i=EOt(t+""),s,n=i.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,c=a.length,h;l<c;++l)for(s=0,h=a[l];s<n;++s)if((o=i[s]).type===h.type&&o.name===h.name)return h.value}return}for(a=e?AOt:COt,r==null&&(r=!1),s=0;s<n;++s)this.each(a(i[s],e,r));return this}function ROt(t,e,r,i){var s=Nr;t.sourceEvent=Nr,Nr=t;try{return e.apply(r,i)}finally{Nr=s}}function B$e(t,e,r){var i=D$e(t),s=i.CustomEvent;typeof s=="function"?s=new s(e,r):(s=i.document.createEvent("Event"),r?(s.initEvent(e,r.bubbles,r.cancelable),s.detail=r.detail):s.initEvent(e,!1,!1)),t.dispatchEvent(s)}function MOt(t,e){return function(){return B$e(this,t,e)}}function POt(t,e){return function(){return B$e(this,t,e.apply(this,arguments))}}function IOt(t,e){return this.each((typeof e=="function"?POt:MOt)(t,e))}var G$e=[null];function Uu(t,e){this._groups=t,this._parents=e}function cI(){return new Uu([[document.documentElement]],G$e)}Uu.prototype=cI.prototype={constructor:Uu,select:gAt,selectAll:_At,filter:bAt,data:EAt,enter:wAt,exit:CAt,merge:AAt,order:OAt,sort:RAt,call:PAt,nodes:IAt,node:$At,size:LAt,empty:DAt,each:NAt,attr:GAt,style:WAt,property:JAt,classed:tOt,text:nOt,html:cOt,raise:hOt,lower:pOt,append:fOt,insert:gOt,remove:_Ot,clone:wOt,datum:xOt,on:OOt,dispatch:IOt};function X_(t){return typeof t=="string"?new Uu([[document.querySelector(t)]],[document.documentElement]):new Uu([[t]],G$e)}var $Ot=0;function nme(){this._="@"+(++$Ot).toString(36)}nme.prototype={constructor:nme,get:function(t){for(var e=this._;!(e in t);)if(!(t=t.parentNode))return;return t[e]},set:function(t,e){return t[this._]=e},remove:function(t){return this._ in t&&delete t[this._]},toString:function(){return this._}};function LOt(){for(var t=Nr,e;e=t.sourceEvent;)t=e;return t}function DOt(t,e){var r=t.ownerSVGElement||t;if(r.createSVGPoint){var i=r.createSVGPoint();return i.x=e.clientX,i.y=e.clientY,i=i.matrixTransform(t.getScreenCTM().inverse()),[i.x,i.y]}var s=t.getBoundingClientRect();return[e.clientX-s.left-t.clientLeft,e.clientY-s.top-t.clientTop]}function ome(t){var e=LOt();return e.changedTouches&&(e=e.changedTouches[0]),DOt(t,e)}function sY(){Nr.preventDefault(),Nr.stopImmediatePropagation()}function NOt(t){var e=t.document.documentElement,r=X_(t).on("dragstart.drag",sY,!0);"onselectstart"in e?r.on("selectstart.drag",sY,!0):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function FOt(t,e){var r=t.document.documentElement,i=X_(t).on("dragstart.drag",null);e&&(i.on("click.drag",sY,!0),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in r?i.on("selectstart.drag",null):(r.style.MozUserSelect=r.__noselect,delete r.__noselect)}function XC(t,e,r){t.prototype=e.prototype=r,r.constructor=t}function uI(t,e){var r=Object.create(t.prototype);for(var i in e)r[i]=e[i];return r}function Vv(){}var px=.7,lC=1/px,iE="\\s*([+-]?\\d+)\\s*",rP="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",hm="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",UOt=/^#([0-9a-f]{3})$/,kOt=/^#([0-9a-f]{6})$/,zOt=new RegExp("^rgb\\("+[iE,iE,iE]+"\\)$"),VOt=new RegExp("^rgb\\("+[hm,hm,hm]+"\\)$"),BOt=new RegExp("^rgba\\("+[iE,iE,iE,rP]+"\\)$"),GOt=new RegExp("^rgba\\("+[hm,hm,hm,rP]+"\\)$"),jOt=new RegExp("^hsl\\("+[rP,hm,hm]+"\\)$"),HOt=new RegExp("^hsla\\("+[rP,hm,hm,rP]+"\\)$"),ame={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};XC(Vv,fx,{displayable:function(){return this.rgb().displayable()},toString:function(){return this.rgb()+""}});function fx(t){var e;return t=(t+"").trim().toLowerCase(),(e=UOt.exec(t))?(e=parseInt(e[1],16),new ga(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1)):(e=kOt.exec(t))?lme(parseInt(e[1],16)):(e=zOt.exec(t))?new ga(e[1],e[2],e[3],1):(e=VOt.exec(t))?new ga(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=BOt.exec(t))?cme(e[1],e[2],e[3],e[4]):(e=GOt.exec(t))?cme(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=jOt.exec(t))?ume(e[1],e[2]/100,e[3]/100,1):(e=HOt.exec(t))?ume(e[1],e[2]/100,e[3]/100,e[4]):ame.hasOwnProperty(t)?lme(ame[t]):t==="transparent"?new ga(NaN,NaN,NaN,0):null}function lme(t){return new ga(t>>16&255,t>>8&255,t&255,1)}function cme(t,e,r,i){return i<=0&&(t=e=r=NaN),new ga(t,e,r,i)}function pte(t){return t instanceof Vv||(t=fx(t)),t?(t=t.rgb(),new ga(t.r,t.g,t.b,t.opacity)):new ga}function nY(t,e,r,i){return arguments.length===1?pte(t):new ga(t,e,r,i??1)}function ga(t,e,r,i){this.r=+t,this.g=+e,this.b=+r,this.opacity=+i}XC(ga,nY,uI(Vv,{brighter:function(t){return t=t==null?lC:Math.pow(lC,t),new ga(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=t==null?px:Math.pow(px,t),new ga(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return 0<=this.r&&this.r<=255&&0<=this.g&&this.g<=255&&0<=this.b&&this.b<=255&&0<=this.opacity&&this.opacity<=1},toString:function(){var t=this.opacity;return t=isNaN(t)?1:Math.max(0,Math.min(1,t)),(t===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(t===1?")":", "+t+")")}}));function ume(t,e,r,i){return i<=0?t=e=r=NaN:r<=0||r>=1?t=e=NaN:e<=0&&(t=NaN),new jf(t,e,r,i)}function qOt(t){if(t instanceof jf)return new jf(t.h,t.s,t.l,t.opacity);if(t instanceof Vv||(t=fx(t)),!t)return new jf;if(t instanceof jf)return t;t=t.rgb();var e=t.r/255,r=t.g/255,i=t.b/255,s=Math.min(e,r,i),n=Math.max(e,r,i),o=NaN,a=n-s,l=(n+s)/2;return a?(e===n?o=(r-i)/a+(r<i)*6:r===n?o=(i-e)/a+2:o=(e-r)/a+4,a/=l<.5?n+s:2-n-s,o*=60):a=l>0&&l<1?0:o,new jf(o,a,l,t.opacity)}function WOt(t,e,r,i){return arguments.length===1?qOt(t):new jf(t,e,r,i??1)}function jf(t,e,r,i){this.h=+t,this.s=+e,this.l=+r,this.opacity=+i}XC(jf,WOt,uI(Vv,{brighter:function(t){return t=t==null?lC:Math.pow(lC,t),new jf(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=t==null?px:Math.pow(px,t),new jf(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,r=this.l,i=r+(r<.5?r:1-r)*e,s=2*r-i;return new ga(f7(t>=240?t-240:t+120,s,i),f7(t,s,i),f7(t<120?t+240:t-120,s,i),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1}}));function f7(t,e,r){return(t<60?e+(r-e)*t/60:t<180?r:t<240?e+(r-e)*(240-t)/60:e)*255}var j$e=Math.PI/180,H$e=180/Math.PI,c6=18,q$e=.95047,W$e=1,X$e=1.08883,Y$e=4/29,sE=6/29,Z$e=3*sE*sE,XOt=sE*sE*sE;function fte(t){if(t instanceof Yg)return new Yg(t.l,t.a,t.b,t.opacity);if(t instanceof iv){var e=t.h*j$e;return new Yg(t.l,Math.cos(e)*t.c,Math.sin(e)*t.c,t.opacity)}t instanceof ga||(t=pte(t));var r=_7(t.r),i=_7(t.g),s=_7(t.b),n=m7((.4124564*r+.3575761*i+.1804375*s)/q$e),o=m7((.2126729*r+.7151522*i+.072175*s)/W$e),a=m7((.0193339*r+.119192*i+.9503041*s)/X$e);return new Yg(116*o-16,500*(n-o),200*(o-a),t.opacity)}function YOt(t,e,r,i){return arguments.length===1?fte(t):new Yg(t,e,r,i??1)}function Yg(t,e,r,i){this.l=+t,this.a=+e,this.b=+r,this.opacity=+i}XC(Yg,YOt,uI(Vv,{brighter:function(t){return new Yg(this.l+c6*(t??1),this.a,this.b,this.opacity)},darker:function(t){return new Yg(this.l-c6*(t??1),this.a,this.b,this.opacity)},rgb:function(){var t=(this.l+16)/116,e=isNaN(this.a)?t:t+this.a/500,r=isNaN(this.b)?t:t-this.b/200;return t=W$e*g7(t),e=q$e*g7(e),r=X$e*g7(r),new ga(y7(3.2404542*e-1.5371385*t-.4985314*r),y7(-.969266*e+1.8760108*t+.041556*r),y7(.0556434*e-.2040259*t+1.0572252*r),this.opacity)}}));function m7(t){return t>XOt?Math.pow(t,1/3):t/Z$e+Y$e}function g7(t){return t>sE?t*t*t:Z$e*(t-Y$e)}function y7(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function _7(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function ZOt(t){if(t instanceof iv)return new iv(t.h,t.c,t.l,t.opacity);t instanceof Yg||(t=fte(t));var e=Math.atan2(t.b,t.a)*H$e;return new iv(e<0?e+360:e,Math.sqrt(t.a*t.a+t.b*t.b),t.l,t.opacity)}function JOt(t,e,r,i){return arguments.length===1?ZOt(t):new iv(t,e,r,i??1)}function iv(t,e,r,i){this.h=+t,this.c=+e,this.l=+r,this.opacity=+i}XC(iv,JOt,uI(Vv,{brighter:function(t){return new iv(this.h,this.c,this.l+c6*(t??1),this.opacity)},darker:function(t){return new iv(this.h,this.c,this.l-c6*(t??1),this.opacity)},rgb:function(){return fte(this).rgb()}}));var J$e=-.14861,mte=1.78277,gte=-.29227,lU=-.90649,iP=1.97294,hme=iP*lU,dme=iP*mte,pme=mte*gte-lU*J$e;function QOt(t){if(t instanceof Ow)return new Ow(t.h,t.s,t.l,t.opacity);t instanceof ga||(t=pte(t));var e=t.r/255,r=t.g/255,i=t.b/255,s=(pme*i+hme*e-dme*r)/(pme+hme-dme),n=i-s,o=(iP*(r-s)-gte*n)/lU,a=Math.sqrt(o*o+n*n)/(iP*s*(1-s)),l=a?Math.atan2(o,n)*H$e-120:NaN;return new Ow(l<0?l+360:l,a,s,t.opacity)}function Cm(t,e,r,i){return arguments.length===1?QOt(t):new Ow(t,e,r,i??1)}function Ow(t,e,r,i){this.h=+t,this.s=+e,this.l=+r,this.opacity=+i}XC(Ow,Cm,uI(Vv,{brighter:function(t){return t=t==null?lC:Math.pow(lC,t),new Ow(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=t==null?px:Math.pow(px,t),new Ow(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=isNaN(this.h)?0:(this.h+120)*j$e,e=+this.l,r=isNaN(this.s)?0:this.s*e*(1-e),i=Math.cos(t),s=Math.sin(t);return new ga(255*(e+r*(J$e*i+mte*s)),255*(e+r*(gte*i+lU*s)),255*(e+r*(iP*i)),this.opacity)}}));function cU(t){return function(){return t}}function Q$e(t,e){return function(r){return t+r*e}}function KOt(t,e,r){return t=Math.pow(t,r),e=Math.pow(e,r)-t,r=1/r,function(i){return Math.pow(t+i*e,r)}}function eRt(t,e){var r=e-t;return r?Q$e(t,r>180||r<-180?r-360*Math.round(r/360):r):cU(isNaN(t)?e:t)}function tRt(t){return(t=+t)==1?nE:function(e,r){return r-e?KOt(e,r,t):cU(isNaN(e)?r:e)}}function nE(t,e){var r=e-t;return r?Q$e(t,r):cU(isNaN(t)?e:t)}const u6=function t(e){var r=tRt(e);function i(s,n){var o=r((s=nY(s)).r,(n=nY(n)).r),a=r(s.g,n.g),l=r(s.b,n.b),c=nE(s.opacity,n.opacity);return function(h){return s.r=o(h),s.g=a(h),s.b=l(h),s.opacity=c(h),s+""}}return i.gamma=t,i}(1);function rRt(t,e){var r=e?e.length:0,i=t?Math.min(r,t.length):0,s=new Array(i),n=new Array(r),o;for(o=0;o<i;++o)s[o]=uU(t[o],e[o]);for(;o<r;++o)n[o]=e[o];return function(a){for(o=0;o<i;++o)n[o]=s[o](a);return n}}function iRt(t,e){var r=new Date;return t=+t,e-=t,function(i){return r.setTime(t+e*i),r}}function ap(t,e){return t=+t,e-=t,function(r){return t+e*r}}function sRt(t,e){var r={},i={},s;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(s in e)s in t?r[s]=uU(t[s],e[s]):i[s]=e[s];return function(n){for(s in r)i[s]=r[s](n);return i}}var oY=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,v7=new RegExp(oY.source,"g");function nRt(t){return function(){return t}}function oRt(t){return function(e){return t(e)+""}}function K$e(t,e){var r=oY.lastIndex=v7.lastIndex=0,i,s,n,o=-1,a=[],l=[];for(t=t+"",e=e+"";(i=oY.exec(t))&&(s=v7.exec(e));)(n=s.index)>r&&(n=e.slice(r,n),a[o]?a[o]+=n:a[++o]=n),(i=i[0])===(s=s[0])?a[o]?a[o]+=s:a[++o]=s:(a[++o]=null,l.push({i:o,x:ap(i,s)})),r=v7.lastIndex;return r<e.length&&(n=e.slice(r),a[o]?a[o]+=n:a[++o]=n),a.length<2?l[0]?oRt(l[0].x):nRt(e):(e=l.length,function(c){for(var h=0,d;h<e;++h)a[(d=l[h]).i]=d.x(c);return a.join("")})}function uU(t,e){var r=typeof e,i;return e==null||r==="boolean"?cU(e):(r==="number"?ap:r==="string"?(i=fx(e))?(e=i,u6):K$e:e instanceof fx?u6:e instanceof Date?iRt:Array.isArray(e)?rRt:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?sRt:ap)(t,e)}function aRt(t,e){return t=+t,e-=t,function(r){return Math.round(t+e*r)}}var fme=180/Math.PI,aY={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function eLe(t,e,r,i,s,n){var o,a,l;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(l=t*r+e*i)&&(r-=t*l,i-=e*l),(a=Math.sqrt(r*r+i*i))&&(r/=a,i/=a,l/=a),t*i<e*r&&(t=-t,e=-e,l=-l,o=-o),{translateX:s,translateY:n,rotate:Math.atan2(e,t)*fme,skewX:Math.atan(l)*fme,scaleX:o,scaleY:a}}var oA,b7,mme,bD;function lRt(t){return t==="none"?aY:(oA||(oA=document.createElement("DIV"),b7=document.documentElement,mme=document.defaultView),oA.style.transform=t,t=mme.getComputedStyle(b7.appendChild(oA),null).getPropertyValue("transform"),b7.removeChild(oA),t=t.slice(7,-1).split(","),eLe(+t[0],+t[1],+t[2],+t[3],+t[4],+t[5]))}function cRt(t){return t==null||(bD||(bD=document.createElementNS("http://www.w3.org/2000/svg","g")),bD.setAttribute("transform",t),!(t=bD.transform.baseVal.consolidate()))?aY:(t=t.matrix,eLe(t.a,t.b,t.c,t.d,t.e,t.f))}function tLe(t,e,r,i){function s(c){return c.length?c.pop()+" ":""}function n(c,h,d,f,m,g){if(c!==d||h!==f){var _=m.push("translate(",null,e,null,r);g.push({i:_-4,x:ap(c,d)},{i:_-2,x:ap(h,f)})}else(d||f)&&m.push("translate("+d+e+f+r)}function o(c,h,d,f){c!==h?(c-h>180?h+=360:h-c>180&&(c+=360),f.push({i:d.push(s(d)+"rotate(",null,i)-2,x:ap(c,h)})):h&&d.push(s(d)+"rotate("+h+i)}function a(c,h,d,f){c!==h?f.push({i:d.push(s(d)+"skewX(",null,i)-2,x:ap(c,h)}):h&&d.push(s(d)+"skewX("+h+i)}function l(c,h,d,f,m,g){if(c!==d||h!==f){var _=m.push(s(m)+"scale(",null,",",null,")");g.push({i:_-4,x:ap(c,d)},{i:_-2,x:ap(h,f)})}else(d!==1||f!==1)&&m.push(s(m)+"scale("+d+","+f+")")}return function(c,h){var d=[],f=[];return c=t(c),h=t(h),n(c.translateX,c.translateY,h.translateX,h.translateY,d,f),o(c.rotate,h.rotate,d,f),a(c.skewX,h.skewX,d,f),l(c.scaleX,c.scaleY,h.scaleX,h.scaleY,d,f),c=h=null,function(m){for(var g=-1,_=f.length,v;++g<_;)d[(v=f[g]).i]=v.x(m);return d.join("")}}}var uRt=tLe(lRt,"px, ","px)","deg)"),hRt=tLe(cRt,", ",")",")");function rLe(t){return function e(r){r=+r;function i(s,n){var o=t((s=Cm(s)).h,(n=Cm(n)).h),a=nE(s.s,n.s),l=nE(s.l,n.l),c=nE(s.opacity,n.opacity);return function(h){return s.h=o(h),s.s=a(h),s.l=l(Math.pow(h,r)),s.opacity=c(h),s+""}}return i.gamma=e,i}(1)}rLe(eRt);var yte=rLe(nE),cC=0,JO=0,aA=0,iLe=1e3,h6,QO,d6=0,mx=0,hU=0,sP=typeof performance=="object"&&performance.now?performance:Date,sLe=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function dU(){return mx||(sLe(dRt),mx=sP.now()+hU)}function dRt(){mx=0}function p6(){this._call=this._time=this._next=null}p6.prototype=nLe.prototype={constructor:p6,restart:function(t,e,r){if(typeof t!="function")throw new TypeError("callback is not a function");r=(r==null?dU():+r)+(e==null?0:+e),!this._next&&QO!==this&&(QO?QO._next=this:h6=this,QO=this),this._call=t,this._time=r,lY()},stop:function(){this._call&&(this._call=null,this._time=1/0,lY())}};function nLe(t,e,r){var i=new p6;return i.restart(t,e,r),i}function pRt(){dU(),++cC;for(var t=h6,e;t;)(e=mx-t._time)>=0&&t._call.call(null,e),t=t._next;--cC}function gme(){mx=(d6=sP.now())+hU,cC=JO=0;try{pRt()}finally{cC=0,mRt(),mx=0}}function fRt(){var t=sP.now(),e=t-d6;e>iLe&&(hU-=e,d6=t)}function mRt(){for(var t,e=h6,r,i=1/0;e;)e._call?(i>e._time&&(i=e._time),t=e,e=e._next):(r=e._next,e._next=null,e=t?t._next=r:h6=r);QO=t,lY(i)}function lY(t){if(!cC){JO&&(JO=clearTimeout(JO));var e=t-mx;e>24?(t<1/0&&(JO=setTimeout(gme,t-sP.now()-hU)),aA&&(aA=clearInterval(aA))):(aA||(d6=sP.now(),aA=setInterval(fRt,iLe)),cC=1,sLe(gme))}}function yme(t,e,r){var i=new p6;return e=e==null?0:+e,i.restart(function(s){i.stop(),t(s+e)},e,r),i}var gRt=ute("start","end","interrupt"),yRt=[],oLe=0,_me=1,f6=2,w7=3,vme=4,cY=5,O4=6;function pU(t,e,r,i,s,n){var o=t.__transition;if(!o)t.__transition={};else if(r in o)return;_Rt(t,r,{name:e,index:i,group:s,on:gRt,tween:yRt,time:n.time,delay:n.delay,duration:n.duration,ease:n.ease,timer:null,state:oLe})}function _te(t,e){var r=zp(t,e);if(r.state>oLe)throw new Error("too late; already scheduled");return r}function zx(t,e){var r=zp(t,e);if(r.state>f6)throw new Error("too late; already started");return r}function zp(t,e){var r=t.__transition;if(!r||!(r=r[e]))throw new Error("transition not found");return r}function _Rt(t,e,r){var i=t.__transition,s;i[e]=r,r.timer=nLe(n,0,r.time);function n(c){r.state=_me,r.timer.restart(o,r.delay,r.time),r.delay<=c&&o(c-r.delay)}function o(c){var h,d,f,m;if(r.state!==_me)return l();for(h in i)if(m=i[h],m.name===r.name){if(m.state===w7)return yme(o);m.state===vme?(m.state=O4,m.timer.stop(),m.on.call("interrupt",t,t.__data__,m.index,m.group),delete i[h]):+h<e&&(m.state=O4,m.timer.stop(),delete i[h])}if(yme(function(){r.state===w7&&(r.state=vme,r.timer.restart(a,r.delay,r.time),a(c))}),r.state=f6,r.on.call("start",t,t.__data__,r.index,r.group),r.state===f6){for(r.state=w7,s=new Array(f=r.tween.length),h=0,d=-1;h<f;++h)(m=r.tween[h].value.call(t,t.__data__,r.index,r.group))&&(s[++d]=m);s.length=d+1}}function a(c){for(var h=c<r.duration?r.ease.call(null,c/r.duration):(r.timer.restart(l),r.state=cY,1),d=-1,f=s.length;++d<f;)s[d].call(null,h);r.state===cY&&(r.on.call("end",t,t.__data__,r.index,r.group),l())}function l(){r.state=O4,r.timer.stop(),delete i[e];for(var c in i)return;delete t.__transition}}function uY(t,e){var r=t.__transition,i,s,n=!0,o;if(r){e=e==null?null:e+"";for(o in r){if((i=r[o]).name!==e){n=!1;continue}s=i.state>f6&&i.state<cY,i.state=O4,i.timer.stop(),s&&i.on.call("interrupt",t,t.__data__,i.index,i.group),delete r[o]}n&&delete t.__transition}}function vRt(t){return this.each(function(){uY(this,t)})}function bRt(t,e){var r,i;return function(){var s=zx(this,t),n=s.tween;if(n!==r){i=r=n;for(var o=0,a=i.length;o<a;++o)if(i[o].name===e){i=i.slice(),i.splice(o,1);break}}s.tween=i}}function wRt(t,e,r){var i,s;if(typeof r!="function")throw new Error;return function(){var n=zx(this,t),o=n.tween;if(o!==i){s=(i=o).slice();for(var a={name:e,value:r},l=0,c=s.length;l<c;++l)if(s[l].name===e){s[l]=a;break}l===c&&s.push(a)}n.tween=s}}function xRt(t,e){var r=this._id;if(t+="",arguments.length<2){for(var i=zp(this.node(),r).tween,s=0,n=i.length,o;s<n;++s)if((o=i[s]).name===t)return o.value;return null}return this.each((e==null?bRt:wRt)(r,t,e))}function vte(t,e,r){var i=t._id;return t.each(function(){var s=zx(this,i);(s.value||(s.value={}))[e]=r.apply(this,arguments)}),function(s){return zp(s,i).value[e]}}function aLe(t,e){var r;return(typeof e=="number"?ap:e instanceof fx?u6:(r=fx(e))?(e=r,u6):K$e)(t,e)}function TRt(t){return function(){this.removeAttribute(t)}}function SRt(t){return function(){this.removeAttributeNS(t.space,t.local)}}function ERt(t,e,r){var i,s;return function(){var n=this.getAttribute(t);return n===r?null:n===i?s:s=e(i=n,r)}}function CRt(t,e,r){var i,s;return function(){var n=this.getAttributeNS(t.space,t.local);return n===r?null:n===i?s:s=e(i=n,r)}}function ARt(t,e,r){var i,s,n;return function(){var o,a=r(this);return a==null?void this.removeAttribute(t):(o=this.getAttribute(t),o===a?null:o===i&&a===s?n:n=e(i=o,s=a))}}function ORt(t,e,r){var i,s,n;return function(){var o,a=r(this);return a==null?void this.removeAttributeNS(t.space,t.local):(o=this.getAttributeNS(t.space,t.local),o===a?null:o===i&&a===s?n:n=e(i=o,s=a))}}function RRt(t,e){var r=aU(t),i=r==="transform"?hRt:aLe;return this.attrTween(t,typeof e=="function"?(r.local?ORt:ARt)(r,i,vte(this,"attr."+t,e)):e==null?(r.local?SRt:TRt)(r):(r.local?CRt:ERt)(r,i,e+""))}function MRt(t,e){function r(){var i=this,s=e.apply(i,arguments);return s&&function(n){i.setAttributeNS(t.space,t.local,s(n))}}return r._value=e,r}function PRt(t,e){function r(){var i=this,s=e.apply(i,arguments);return s&&function(n){i.setAttribute(t,s(n))}}return r._value=e,r}function IRt(t,e){var r="attr."+t;if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;var i=aU(t);return this.tween(r,(i.local?MRt:PRt)(i,e))}function $Rt(t,e){return function(){_te(this,t).delay=+e.apply(this,arguments)}}function LRt(t,e){return e=+e,function(){_te(this,t).delay=e}}function DRt(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?$Rt:LRt)(e,t)):zp(this.node(),e).delay}function NRt(t,e){return function(){zx(this,t).duration=+e.apply(this,arguments)}}function FRt(t,e){return e=+e,function(){zx(this,t).duration=e}}function URt(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?NRt:FRt)(e,t)):zp(this.node(),e).duration}function kRt(t,e){if(typeof e!="function")throw new Error;return function(){zx(this,t).ease=e}}function zRt(t){var e=this._id;return arguments.length?this.each(kRt(e,t)):zp(this.node(),e).ease}function VRt(t){typeof t!="function"&&(t=$$e(t));for(var e=this._groups,r=e.length,i=new Array(r),s=0;s<r;++s)for(var n=e[s],o=n.length,a=i[s]=[],l,c=0;c<o;++c)(l=n[c])&&t.call(l,l.__data__,c,n)&&a.push(l);return new A0(i,this._parents,this._name,this._id)}function BRt(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,r=t._groups,i=e.length,s=r.length,n=Math.min(i,s),o=new Array(i),a=0;a<n;++a)for(var l=e[a],c=r[a],h=l.length,d=o[a]=new Array(h),f,m=0;m<h;++m)(f=l[m]||c[m])&&(d[m]=f);for(;a<i;++a)o[a]=e[a];return new A0(o,this._parents,this._name,this._id)}function GRt(t){return(t+"").trim().split(/^|\s+/).every(function(e){var r=e.indexOf(".");return r>=0&&(e=e.slice(0,r)),!e||e==="start"})}function jRt(t,e,r){var i,s,n=GRt(e)?_te:zx;return function(){var o=n(this,t),a=o.on;a!==i&&(s=(i=a).copy()).on(e,r),o.on=s}}function HRt(t,e){var r=this._id;return arguments.length<2?zp(this.node(),r).on.on(t):this.each(jRt(r,t,e))}function qRt(t){return function(){var e=this.parentNode;for(var r in this.__transition)if(+r!==t)return;e&&e.removeChild(this)}}function WRt(){return this.on("end.remove",qRt(this._id))}function XRt(t){var e=this._name,r=this._id;typeof t!="function"&&(t=hte(t));for(var i=this._groups,s=i.length,n=new Array(s),o=0;o<s;++o)for(var a=i[o],l=a.length,c=n[o]=new Array(l),h,d,f=0;f<l;++f)(h=a[f])&&(d=t.call(h,h.__data__,f,a))&&("__data__"in h&&(d.__data__=h.__data__),c[f]=d,pU(c[f],e,r,f,c,zp(h,r)));return new A0(n,this._parents,e,r)}function YRt(t){var e=this._name,r=this._id;typeof t!="function"&&(t=P$e(t));for(var i=this._groups,s=i.length,n=[],o=[],a=0;a<s;++a)for(var l=i[a],c=l.length,h,d=0;d<c;++d)if(h=l[d]){for(var f=t.call(h,h.__data__,d,l),m,g=zp(h,r),_=0,v=f.length;_<v;++_)(m=f[_])&&pU(m,e,r,_,f,g);n.push(f),o.push(h)}return new A0(n,o,e,r)}var ZRt=cI.prototype.constructor;function JRt(){return new ZRt(this._groups,this._parents)}function QRt(t,e){var r,i,s;return function(){var n=aC(this,t),o=(this.style.removeProperty(t),aC(this,t));return n===o?null:n===r&&o===i?s:s=e(r=n,i=o)}}function KRt(t){return function(){this.style.removeProperty(t)}}function eMt(t,e,r){var i,s;return function(){var n=aC(this,t);return n===r?null:n===i?s:s=e(i=n,r)}}function tMt(t,e,r){var i,s,n;return function(){var o=aC(this,t),a=r(this);return a==null&&(a=(this.style.removeProperty(t),aC(this,t))),o===a?null:o===i&&a===s?n:n=e(i=o,s=a)}}function rMt(t,e,r){var i=(t+="")=="transform"?uRt:aLe;return e==null?this.styleTween(t,QRt(t,i)).on("end.style."+t,KRt(t)):this.styleTween(t,typeof e=="function"?tMt(t,i,vte(this,"style."+t,e)):eMt(t,i,e+""),r)}function iMt(t,e,r){function i(){var s=this,n=e.apply(s,arguments);return n&&function(o){s.style.setProperty(t,n(o),r)}}return i._value=e,i}function sMt(t,e,r){var i="style."+(t+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;return this.tween(i,iMt(t,e,r??""))}function nMt(t){return function(){this.textContent=t}}function oMt(t){return function(){var e=t(this);this.textContent=e??""}}function aMt(t){return this.tween("text",typeof t=="function"?oMt(vte(this,"text",t)):nMt(t==null?"":t+""))}function lMt(){for(var t=this._name,e=this._id,r=lLe(),i=this._groups,s=i.length,n=0;n<s;++n)for(var o=i[n],a=o.length,l,c=0;c<a;++c)if(l=o[c]){var h=zp(l,e);pU(l,t,r,c,o,{time:h.time+h.delay+h.duration,delay:0,duration:h.duration,ease:h.ease})}return new A0(i,this._parents,t,r)}var cMt=0;function A0(t,e,r,i){this._groups=t,this._parents=e,this._name=r,this._id=i}function lLe(){return++cMt}var t2=cI.prototype;A0.prototype={constructor:A0,select:XRt,selectAll:YRt,filter:VRt,merge:BRt,selection:JRt,transition:lMt,call:t2.call,nodes:t2.nodes,node:t2.node,size:t2.size,empty:t2.empty,each:t2.each,on:HRt,attr:RRt,attrTween:IRt,style:rMt,styleTween:sMt,text:aMt,remove:WRt,tween:xRt,delay:DRt,duration:URt,ease:zRt};function uMt(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var bte=3;(function t(e){e=+e;function r(i){return Math.pow(i,e)}return r.exponent=t,r})(bte);(function t(e){e=+e;function r(i){return 1-Math.pow(1-i,e)}return r.exponent=t,r})(bte);(function t(e){e=+e;function r(i){return((i*=2)<=1?Math.pow(i,e):2-Math.pow(2-i,e))/2}return r.exponent=t,r})(bte);var wte=1.70158;(function t(e){e=+e;function r(i){return i*i*((e+1)*i-e)}return r.overshoot=t,r})(wte);(function t(e){e=+e;function r(i){return--i*i*((e+1)*i+e)+1}return r.overshoot=t,r})(wte);(function t(e){e=+e;function r(i){return((i*=2)<1?i*i*((e+1)*i-e):(i-=2)*i*((e+1)*i+e)+2)/2}return r.overshoot=t,r})(wte);var uC=2*Math.PI,xte=1,Tte=.3;(function t(e,r){var i=Math.asin(1/(e=Math.max(1,e)))*(r/=uC);function s(n){return e*Math.pow(2,10*--n)*Math.sin((i-n)/r)}return s.amplitude=function(n){return t(n,r*uC)},s.period=function(n){return t(e,n)},s})(xte,Tte);(function t(e,r){var i=Math.asin(1/(e=Math.max(1,e)))*(r/=uC);function s(n){return 1-e*Math.pow(2,-10*(n=+n))*Math.sin((n+i)/r)}return s.amplitude=function(n){return t(n,r*uC)},s.period=function(n){return t(e,n)},s})(xte,Tte);(function t(e,r){var i=Math.asin(1/(e=Math.max(1,e)))*(r/=uC);function s(n){return((n=n*2-1)<0?e*Math.pow(2,10*n)*Math.sin((i-n)/r):2-e*Math.pow(2,-10*n)*Math.sin((i+n)/r))/2}return s.amplitude=function(n){return t(n,r*uC)},s.period=function(n){return t(e,n)},s})(xte,Tte);var hY={time:null,delay:0,duration:250,ease:uMt};function hMt(t,e){for(var r;!(r=t.__transition)||!(r=r[e]);)if(!(t=t.parentNode))return hY.time=dU(),hY;return r}function dMt(t){var e,r;t instanceof A0?(e=t._id,t=t._name):(e=lLe(),(r=hY).time=dU(),t=t==null?null:t+"");for(var i=this._groups,s=i.length,n=0;n<s;++n)for(var o=i[n],a=o.length,l,c=0;c<a;++c)(l=o[c])&&pU(l,t,e,c,o,r||hMt(l,e));return new A0(i,this._parents,t,e)}cI.prototype.interrupt=vRt;cI.prototype.transition=dMt;function bme(t){return function(){return t}}function pMt(t,e,r){this.target=t,this.type=e,this.selection=r}function wme(){Nr.stopImmediatePropagation()}function wD(){Nr.preventDefault(),Nr.stopImmediatePropagation()}var xme={name:"drag"},x7={name:"space"},r2={name:"handle"},i2={name:"center"},T7={name:"x",handles:["e","w"].map(m6),input:function(t,e){return t&&[[t[0],e[0][1]],[t[1],e[1][1]]]},output:function(t){return t&&[t[0][0],t[1][0]]}},R4={name:"y",handles:["n","s"].map(m6),input:function(t,e){return t&&[[e[0][0],t[0]],[e[1][0],t[1]]]},output:function(t){return t&&[t[0][1],t[1][1]]}},ig={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Tme={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},Sme={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},fMt={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},mMt={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};function m6(t){return{type:t}}function gMt(){return!Nr.button}function yMt(){var t=this.ownerSVGElement||this;return[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]}function S7(t){for(;!t.__brush;)if(!(t=t.parentNode))return;return t.__brush}function E7(t){return t[0][0]===t[1][0]||t[0][1]===t[1][1]}function _Mt(){return vMt(R4)}function vMt(t){var e=yMt,r=gMt,i=ute(o,"start","brush","end"),s=6,n;function o(f){var m=f.property("__brush",d).selectAll(".overlay").data([m6("overlay")]);m.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",ig.overlay).merge(m).each(function(){var _=S7(this).extent;X_(this).attr("x",_[0][0]).attr("y",_[0][1]).attr("width",_[1][0]-_[0][0]).attr("height",_[1][1]-_[0][1])}),f.selectAll(".selection").data([m6("selection")]).enter().append("rect").attr("class","selection").attr("cursor",ig.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var g=f.selectAll(".handle").data(t.handles,function(_){return _.type});g.exit().remove(),g.enter().append("rect").attr("class",function(_){return"handle handle--"+_.type}).attr("cursor",function(_){return ig[_.type]}),f.each(a).attr("fill","none").attr("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush touchstart.brush",h)}o.move=function(f,m){f.selection?f.on("start.brush",function(){l(this,arguments).beforestart().start()}).on("interrupt.brush end.brush",function(){l(this,arguments).end()}).tween("brush",function(){var g=this,_=g.__brush,v=l(g,arguments),b=_.selection,T=t.input(typeof m=="function"?m.apply(this,arguments):m,_.extent),x=uU(b,T);function S(E){_.selection=E===1&&E7(T)?null:x(E),a.call(g),v.brush()}return b&&T?S:S(1)}):f.each(function(){var g=this,_=arguments,v=g.__brush,b=t.input(typeof m=="function"?m.apply(g,_):m,v.extent),T=l(g,_).beforestart();uY(g),v.selection=b==null||E7(b)?null:b,a.call(g),T.start().brush().end()})};function a(){var f=X_(this),m=S7(this).selection;m?(f.selectAll(".selection").style("display",null).attr("x",m[0][0]).attr("y",m[0][1]).attr("width",m[1][0]-m[0][0]).attr("height",m[1][1]-m[0][1]),f.selectAll(".handle").style("display",null).attr("x",function(g){return g.type[g.type.length-1]==="e"?m[1][0]-s/2:m[0][0]-s/2}).attr("y",function(g){return g.type[0]==="s"?m[1][1]-s/2:m[0][1]-s/2}).attr("width",function(g){return g.type==="n"||g.type==="s"?m[1][0]-m[0][0]+s:s}).attr("height",function(g){return g.type==="e"||g.type==="w"?m[1][1]-m[0][1]+s:s})):f.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function l(f,m){return f.__brush.emitter||new c(f,m)}function c(f,m){this.that=f,this.args=m,this.state=f.__brush,this.active=0}c.prototype={beforestart:function(){return++this.active===1&&(this.state.emitter=this,this.starting=!0),this},start:function(){return this.starting&&(this.starting=!1,this.emit("start")),this},brush:function(){return this.emit("brush"),this},end:function(){return--this.active===0&&(delete this.state.emitter,this.emit("end")),this},emit:function(f){ROt(new pMt(o,f,t.output(this.state.selection)),i.apply,i,[f,this.that,this.args])}};function h(){if(Nr.touches){if(Nr.changedTouches.length<Nr.touches.length)return wD()}else if(n)return;if(!r.apply(this,arguments))return;var f=this,m=Nr.target.__data__.type,g=(Nr.metaKey?m="overlay":m)==="selection"?xme:Nr.altKey?i2:r2,_=t===R4?null:fMt[m],v=t===T7?null:mMt[m],b=S7(f),T=b.extent,x=b.selection,S=T[0][0],E,A,R=T[0][1],M,D,k=T[1][0],L,N,q=T[1][1],X,G,J,I,z,V=_&&v&&Nr.shiftKey,j,Y,Q=ome(f),te=Q,ge=l(f,arguments).beforestart();m==="overlay"?b.selection=x=[[E=t===R4?S:Q[0],M=t===T7?R:Q[1]],[L=t===R4?k:E,X=t===T7?q:M]]:(E=x[0][0],M=x[0][1],L=x[1][0],X=x[1][1]),A=E,D=M,N=L,G=X;var De=X_(f).attr("pointer-events","none"),at=De.selectAll(".overlay").attr("cursor",ig[m]);if(Nr.touches)De.on("touchmove.brush",Ce,!0).on("touchend.brush touchcancel.brush",Z,!0);else{var we=X_(Nr.view).on("keydown.brush",be,!0).on("keyup.brush",Fe,!0).on("mousemove.brush",Ce,!0).on("mouseup.brush",Z,!0);NOt(Nr.view)}wme(),uY(f),a.call(f),ge.start();function Ce(){var ce=ome(f);V&&!j&&!Y&&(Math.abs(ce[0]-te[0])>Math.abs(ce[1]-te[1])?Y=!0:j=!0),te=ce,z=!0,wD(),Me()}function Me(){var ce;switch(J=te[0]-Q[0],I=te[1]-Q[1],g){case x7:case xme:{_&&(J=Math.max(S-E,Math.min(k-L,J)),A=E+J,N=L+J),v&&(I=Math.max(R-M,Math.min(q-X,I)),D=M+I,G=X+I);break}case r2:{_<0?(J=Math.max(S-E,Math.min(k-E,J)),A=E+J,N=L):_>0&&(J=Math.max(S-L,Math.min(k-L,J)),A=E,N=L+J),v<0?(I=Math.max(R-M,Math.min(q-M,I)),D=M+I,G=X):v>0&&(I=Math.max(R-X,Math.min(q-X,I)),D=M,G=X+I);break}case i2:{_&&(A=Math.max(S,Math.min(k,E-J*_)),N=Math.max(S,Math.min(k,L+J*_))),v&&(D=Math.max(R,Math.min(q,M-I*v)),G=Math.max(R,Math.min(q,X+I*v)));break}}N<A&&(_*=-1,ce=E,E=L,L=ce,ce=A,A=N,N=ce,m in Tme&&at.attr("cursor",ig[m=Tme[m]])),G<D&&(v*=-1,ce=M,M=X,X=ce,ce=D,D=G,G=ce,m in Sme&&at.attr("cursor",ig[m=Sme[m]])),b.selection&&(x=b.selection),j&&(A=x[0][0],N=x[1][0]),Y&&(D=x[0][1],G=x[1][1]),(x[0][0]!==A||x[0][1]!==D||x[1][0]!==N||x[1][1]!==G)&&(b.selection=[[A,D],[N,G]],a.call(f),ge.brush())}function Z(){if(wme(),Nr.touches){if(Nr.touches.length)return;n&&clearTimeout(n),n=setTimeout(function(){n=null},500),De.on("touchmove.brush touchend.brush touchcancel.brush",null)}else FOt(Nr.view,z),we.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);De.attr("pointer-events","all"),at.attr("cursor",ig.overlay),b.selection&&(x=b.selection),E7(x)&&(b.selection=null,a.call(f)),ge.end()}function be(){switch(Nr.keyCode){case 16:{V=_&&v;break}case 18:{g===r2&&(_&&(L=N-J*_,E=A+J*_),v&&(X=G-I*v,M=D+I*v),g=i2,Me());break}case 32:{(g===r2||g===i2)&&(_<0?L=N-J:_>0&&(E=A-J),v<0?X=G-I:v>0&&(M=D-I),g=x7,at.attr("cursor",ig.selection),Me());break}default:return}wD()}function Fe(){switch(Nr.keyCode){case 16:{V&&(j=Y=V=!1,Me());break}case 18:{g===i2&&(_<0?L=N:_>0&&(E=A),v<0?X=G:v>0&&(M=D),g=r2,Me());break}case 32:{g===x7&&(Nr.altKey?(_&&(L=N-J*_,E=A+J*_),v&&(X=G-I*v,M=D+I*v),g=i2):(_<0?L=N:_>0&&(E=A),v<0?X=G:v>0&&(M=D),g=r2),at.attr("cursor",ig[m]),Me());break}default:return}wD()}}function d(){var f=this.__brush||{selection:null};return f.extent=e.apply(this,arguments),f.dim=t,f}return o.extent=function(f){return arguments.length?(e=typeof f=="function"?f:bme([[+f[0][0],+f[0][1]],[+f[1][0],+f[1][1]]]),o):e},o.filter=function(f){return arguments.length?(r=typeof f=="function"?f:bme(!!f),o):r},o.handleSize=function(f){return arguments.length?(s=+f,o):s},o.on=function(){var f=i.on.apply(i,arguments);return f===i?o:f},o}var dY=Math.PI,pY=2*dY,Lb=1e-6,bMt=pY-Lb;function Eme(){this._x0=this._y0=this._x1=this._y1=null,this._=""}Eme.prototype={constructor:Eme,moveTo:function(t,e){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,e){this._+="L"+(this._x1=+t)+","+(this._y1=+e)},quadraticCurveTo:function(t,e,r,i){this._+="Q"+ +t+","+ +e+","+(this._x1=+r)+","+(this._y1=+i)},bezierCurveTo:function(t,e,r,i,s,n){this._+="C"+ +t+","+ +e+","+ +r+","+ +i+","+(this._x1=+s)+","+(this._y1=+n)},arcTo:function(t,e,r,i,s){t=+t,e=+e,r=+r,i=+i,s=+s;var n=this._x1,o=this._y1,a=r-t,l=i-e,c=n-t,h=o-e,d=c*c+h*h;if(s<0)throw new Error("negative radius: "+s);if(this._x1===null)this._+="M"+(this._x1=t)+","+(this._y1=e);else if(d>Lb)if(!(Math.abs(h*a-l*c)>Lb)||!s)this._+="L"+(this._x1=t)+","+(this._y1=e);else{var f=r-n,m=i-o,g=a*a+l*l,_=f*f+m*m,v=Math.sqrt(g),b=Math.sqrt(d),T=s*Math.tan((dY-Math.acos((g+d-_)/(2*v*b)))/2),x=T/b,S=T/v;Math.abs(x-1)>Lb&&(this._+="L"+(t+x*c)+","+(e+x*h)),this._+="A"+s+","+s+",0,0,"+ +(h*f>c*m)+","+(this._x1=t+S*a)+","+(this._y1=e+S*l)}},arc:function(t,e,r,i,s,n){t=+t,e=+e,r=+r;var o=r*Math.cos(i),a=r*Math.sin(i),l=t+o,c=e+a,h=1^n,d=n?i-s:s-i;if(r<0)throw new Error("negative radius: "+r);this._x1===null?this._+="M"+l+","+c:(Math.abs(this._x1-l)>Lb||Math.abs(this._y1-c)>Lb)&&(this._+="L"+l+","+c),r&&(d<0&&(d=d%pY+pY),d>bMt?this._+="A"+r+","+r+",0,1,"+h+","+(t-o)+","+(e-a)+"A"+r+","+r+",0,1,"+h+","+(this._x1=l)+","+(this._y1=c):d>Lb&&(this._+="A"+r+","+r+",0,"+ +(d>=dY)+","+h+","+(this._x1=t+r*Math.cos(s))+","+(this._y1=e+r*Math.sin(s))))},rect:function(t,e,r,i){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)+"h"+ +r+"v"+ +i+"h"+-r+"Z"},toString:function(){return this._}};var mh="$";function g6(){}g6.prototype=cLe.prototype={constructor:g6,has:function(t){return mh+t in this},get:function(t){return this[mh+t]},set:function(t,e){return this[mh+t]=e,this},remove:function(t){var e=mh+t;return e in this&&delete this[e]},clear:function(){for(var t in this)t[0]===mh&&delete this[t]},keys:function(){var t=[];for(var e in this)e[0]===mh&&t.push(e.slice(1));return t},values:function(){var t=[];for(var e in this)e[0]===mh&&t.push(this[e]);return t},entries:function(){var t=[];for(var e in this)e[0]===mh&&t.push({key:e.slice(1),value:this[e]});return t},size:function(){var t=0;for(var e in this)e[0]===mh&&++t;return t},empty:function(){for(var t in this)if(t[0]===mh)return!1;return!0},each:function(t){for(var e in this)e[0]===mh&&t(this[e],e.slice(1),this)}};function cLe(t,e){var r=new g6;if(t instanceof g6)t.each(function(a,l){r.set(l,a)});else if(Array.isArray(t)){var i=-1,s=t.length,n;if(e==null)for(;++i<s;)r.set(i,t[i]);else for(;++i<s;)r.set(e(n=t[i],i,t),n)}else if(t)for(var o in t)r.set(o,t[o]);return r}function Cme(){}var I1=cLe.prototype;Cme.prototype={constructor:Cme,has:I1.has,add:function(t){return t+="",this[mh+t]=t,this},remove:I1.remove,clear:I1.clear,values:I1.keys,size:I1.size,empty:I1.empty,each:I1.each};var Ame={},C7={},A7=34,lA=10,O7=13;function uLe(t){return new Function("d","return {"+t.map(function(e,r){return JSON.stringify(e)+": d["+r+"]"}).join(",")+"}")}function wMt(t,e){var r=uLe(t);return function(i,s){return e(r(i),s,t)}}function xMt(t){var e=Object.create(null),r=[];return t.forEach(function(i){for(var s in i)s in e||r.push(e[s]=s)}),r}function hLe(t){var e=new RegExp('["'+t+`
\r]`),r=t.charCodeAt(0);function i(c,h){var d,f,m=s(c,function(g,_){if(d)return d(g,_-1);f=g,d=h?wMt(g,h):uLe(g)});return m.columns=f||[],m}function s(c,h){var d=[],f=c.length,m=0,g=0,_,v=f<=0,b=!1;c.charCodeAt(f-1)===lA&&--f,c.charCodeAt(f-1)===O7&&--f;function T(){if(v)return C7;if(b)return b=!1,Ame;var S,E=m,A;if(c.charCodeAt(E)===A7){for(;m++<f&&c.charCodeAt(m)!==A7||c.charCodeAt(++m)===A7;);return(S=m)>=f?v=!0:(A=c.charCodeAt(m++))===lA?b=!0:A===O7&&(b=!0,c.charCodeAt(m)===lA&&++m),c.slice(E+1,S-1).replace(/""/g,'"')}for(;m<f;){if((A=c.charCodeAt(S=m++))===lA)b=!0;else if(A===O7)b=!0,c.charCodeAt(m)===lA&&++m;else if(A!==r)continue;return c.slice(E,S)}return v=!0,c.slice(E,f)}for(;(_=T())!==C7;){for(var x=[];_!==Ame&&_!==C7;)x.push(_),_=T();h&&(x=h(x,g++))==null||d.push(x)}return d}function n(c,h){return h==null&&(h=xMt(c)),[h.map(l).join(t)].concat(c.map(function(d){return h.map(function(f){return l(d[f])}).join(t)})).join(`
`)}function o(c){return c.map(a).join(`
`)}function a(c){return c.map(l).join(t)}function l(c){return c==null?"":e.test(c+="")?'"'+c.replace(/"/g,'""')+'"':c}return{parse:i,parseRows:s,format:n,formatRows:o}}hLe(",");hLe("	");function TMt(t){var e=+this._x.call(null,t),r=+this._y.call(null,t);return dLe(this.cover(e,r),e,r,t)}function dLe(t,e,r,i){if(isNaN(e)||isNaN(r))return t;var s,n=t._root,o={data:i},a=t._x0,l=t._y0,c=t._x1,h=t._y1,d,f,m,g,_,v,b,T;if(!n)return t._root=o,t;for(;n.length;)if((_=e>=(d=(a+c)/2))?a=d:c=d,(v=r>=(f=(l+h)/2))?l=f:h=f,s=n,!(n=n[b=v<<1|_]))return s[b]=o,t;if(m=+t._x.call(null,n.data),g=+t._y.call(null,n.data),e===m&&r===g)return o.next=n,s?s[b]=o:t._root=o,t;do s=s?s[b]=new Array(4):t._root=new Array(4),(_=e>=(d=(a+c)/2))?a=d:c=d,(v=r>=(f=(l+h)/2))?l=f:h=f;while((b=v<<1|_)===(T=(g>=f)<<1|m>=d));return s[T]=n,s[b]=o,t}function SMt(t){var e,r,i=t.length,s,n,o=new Array(i),a=new Array(i),l=1/0,c=1/0,h=-1/0,d=-1/0;for(r=0;r<i;++r)isNaN(s=+this._x.call(null,e=t[r]))||isNaN(n=+this._y.call(null,e))||(o[r]=s,a[r]=n,s<l&&(l=s),s>h&&(h=s),n<c&&(c=n),n>d&&(d=n));for(h<l&&(l=this._x0,h=this._x1),d<c&&(c=this._y0,d=this._y1),this.cover(l,c).cover(h,d),r=0;r<i;++r)dLe(this,o[r],a[r],t[r]);return this}function EMt(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var r=this._x0,i=this._y0,s=this._x1,n=this._y1;if(isNaN(r))s=(r=Math.floor(t))+1,n=(i=Math.floor(e))+1;else if(r>t||t>s||i>e||e>n){var o=s-r,a=this._root,l,c;switch(c=(e<(i+n)/2)<<1|t<(r+s)/2){case 0:{do l=new Array(4),l[c]=a,a=l;while(o*=2,s=r+o,n=i+o,t>s||e>n);break}case 1:{do l=new Array(4),l[c]=a,a=l;while(o*=2,r=s-o,n=i+o,r>t||e>n);break}case 2:{do l=new Array(4),l[c]=a,a=l;while(o*=2,s=r+o,i=n-o,t>s||i>e);break}case 3:{do l=new Array(4),l[c]=a,a=l;while(o*=2,r=s-o,i=n-o,r>t||i>e);break}}this._root&&this._root.length&&(this._root=a)}else return this;return this._x0=r,this._y0=i,this._x1=s,this._y1=n,this}function CMt(){var t=[];return this.visit(function(e){if(!e.length)do t.push(e.data);while(e=e.next)}),t}function AMt(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function Ll(t,e,r,i,s){this.node=t,this.x0=e,this.y0=r,this.x1=i,this.y1=s}function OMt(t,e,r){var i,s=this._x0,n=this._y0,o,a,l,c,h=this._x1,d=this._y1,f=[],m=this._root,g,_;for(m&&f.push(new Ll(m,s,n,h,d)),r==null?r=1/0:(s=t-r,n=e-r,h=t+r,d=e+r,r*=r);g=f.pop();)if(!(!(m=g.node)||(o=g.x0)>h||(a=g.y0)>d||(l=g.x1)<s||(c=g.y1)<n))if(m.length){var v=(o+l)/2,b=(a+c)/2;f.push(new Ll(m[3],v,b,l,c),new Ll(m[2],o,b,v,c),new Ll(m[1],v,a,l,b),new Ll(m[0],o,a,v,b)),(_=(e>=b)<<1|t>=v)&&(g=f[f.length-1],f[f.length-1]=f[f.length-1-_],f[f.length-1-_]=g)}else{var T=t-+this._x.call(null,m.data),x=e-+this._y.call(null,m.data),S=T*T+x*x;if(S<r){var E=Math.sqrt(r=S);s=t-E,n=e-E,h=t+E,d=e+E,i=m.data}}return i}function RMt(t){if(isNaN(h=+this._x.call(null,t))||isNaN(d=+this._y.call(null,t)))return this;var e,r=this._root,i,s,n,o=this._x0,a=this._y0,l=this._x1,c=this._y1,h,d,f,m,g,_,v,b;if(!r)return this;if(r.length)for(;;){if((g=h>=(f=(o+l)/2))?o=f:l=f,(_=d>=(m=(a+c)/2))?a=m:c=m,e=r,!(r=r[v=_<<1|g]))return this;if(!r.length)break;(e[v+1&3]||e[v+2&3]||e[v+3&3])&&(i=e,b=v)}for(;r.data!==t;)if(s=r,!(r=r.next))return this;return(n=r.next)&&delete r.next,s?(n?s.next=n:delete s.next,this):e?(n?e[v]=n:delete e[v],(r=e[0]||e[1]||e[2]||e[3])&&r===(e[3]||e[2]||e[1]||e[0])&&!r.length&&(i?i[b]=r:this._root=r),this):(this._root=n,this)}function MMt(t){for(var e=0,r=t.length;e<r;++e)this.remove(t[e]);return this}function PMt(){return this._root}function IMt(){var t=0;return this.visit(function(e){if(!e.length)do++t;while(e=e.next)}),t}function $Mt(t){var e=[],r,i=this._root,s,n,o,a,l;for(i&&e.push(new Ll(i,this._x0,this._y0,this._x1,this._y1));r=e.pop();)if(!t(i=r.node,n=r.x0,o=r.y0,a=r.x1,l=r.y1)&&i.length){var c=(n+a)/2,h=(o+l)/2;(s=i[3])&&e.push(new Ll(s,c,h,a,l)),(s=i[2])&&e.push(new Ll(s,n,h,c,l)),(s=i[1])&&e.push(new Ll(s,c,o,a,h)),(s=i[0])&&e.push(new Ll(s,n,o,c,h))}return this}function LMt(t){var e=[],r=[],i;for(this._root&&e.push(new Ll(this._root,this._x0,this._y0,this._x1,this._y1));i=e.pop();){var s=i.node;if(s.length){var n,o=i.x0,a=i.y0,l=i.x1,c=i.y1,h=(o+l)/2,d=(a+c)/2;(n=s[0])&&e.push(new Ll(n,o,a,h,d)),(n=s[1])&&e.push(new Ll(n,h,a,l,d)),(n=s[2])&&e.push(new Ll(n,o,d,h,c)),(n=s[3])&&e.push(new Ll(n,h,d,l,c))}r.push(i)}for(;i=r.pop();)t(i.node,i.x0,i.y0,i.x1,i.y1);return this}function DMt(t){return arguments.length?(this._x=t,this):this._x}function NMt(t){return arguments.length?(this._y=t,this):this._y}function pLe(t,e,r,i,s,n){this._x=t,this._y=e,this._x0=r,this._y0=i,this._x1=s,this._y1=n,this._root=void 0}function Ome(t){for(var e={data:t.data},r=e;t=t.next;)r=r.next={data:t.data};return e}var ql=pLe.prototype;ql.copy=function(){var t=new pLe(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,r,i;if(!e)return t;if(!e.length)return t._root=Ome(e),t;for(r=[{source:e,target:t._root=new Array(4)}];e=r.pop();)for(var s=0;s<4;++s)(i=e.source[s])&&(i.length?r.push({source:i,target:e.target[s]=new Array(4)}):e.target[s]=Ome(i));return t};ql.add=TMt;ql.addAll=SMt;ql.cover=EMt;ql.data=CMt;ql.extent=AMt;ql.find=OMt;ql.remove=RMt;ql.removeAll=MMt;ql.root=PMt;ql.size=IMt;ql.visit=$Mt;ql.visitAfter=LMt;ql.x=DMt;ql.y=NMt;function y6(t,e){if((r=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var r,i=t.slice(0,r);return[i.length>1?i[0]+i.slice(2):i,+t.slice(r+1)]}function hC(t){return t=y6(Math.abs(t)),t?t[1]:NaN}function FMt(t,e){return function(r,i){for(var s=r.length,n=[],o=0,a=t[0],l=0;s>0&&a>0&&(l+a+1>i&&(a=Math.max(1,i-l)),n.push(r.substring(s-=a,s+a)),!((l+=a+1)>i));)a=t[o=(o+1)%t.length];return n.reverse().join(e)}}function UMt(t){return function(e){return e.replace(/[0-9]/g,function(r){return t[+r]})}}function kMt(t,e){t=t.toPrecision(e);e:for(var r=t.length,i=1,s=-1,n;i<r;++i)switch(t[i]){case".":s=n=i;break;case"0":s===0&&(s=i),n=i;break;case"e":break e;default:s>0&&(s=0);break}return s>0?t.slice(0,s)+t.slice(n+1):t}var fLe;function zMt(t,e){var r=y6(t,e);if(!r)return t+"";var i=r[0],s=r[1],n=s-(fLe=Math.max(-8,Math.min(8,Math.floor(s/3)))*3)+1,o=i.length;return n===o?i:n>o?i+new Array(n-o+1).join("0"):n>0?i.slice(0,n)+"."+i.slice(n):"0."+new Array(1-n).join("0")+y6(t,Math.max(0,e+n-1))[0]}function Rme(t,e){var r=y6(t,e);if(!r)return t+"";var i=r[0],s=r[1];return s<0?"0."+new Array(-s).join("0")+i:i.length>s+1?i.slice(0,s+1)+"."+i.slice(s+1):i+new Array(s-i.length+2).join("0")}const mLe={"":kMt,"%":function(t,e){return(t*100).toFixed(e)},b:function(t){return Math.round(t).toString(2)},c:function(t){return t+""},d:function(t){return Math.round(t).toString(10)},e:function(t,e){return t.toExponential(e)},f:function(t,e){return t.toFixed(e)},g:function(t,e){return t.toPrecision(e)},o:function(t){return Math.round(t).toString(8)},p:function(t,e){return Rme(t*100,e)},r:Rme,s:zMt,X:function(t){return Math.round(t).toString(16).toUpperCase()},x:function(t){return Math.round(t).toString(16)}};var VMt=/^(?:(.)?([<>=^]))?([+\-\( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?([a-z%])?$/i;function _6(t){return new Ste(t)}_6.prototype=Ste.prototype;function Ste(t){if(!(e=VMt.exec(t)))throw new Error("invalid format: "+t);var e,r=e[1]||" ",i=e[2]||">",s=e[3]||"-",n=e[4]||"",o=!!e[5],a=e[6]&&+e[6],l=!!e[7],c=e[8]&&+e[8].slice(1),h=e[9]||"";h==="n"?(l=!0,h="g"):mLe[h]||(h=""),(o||r==="0"&&i==="=")&&(o=!0,r="0",i="="),this.fill=r,this.align=i,this.sign=s,this.symbol=n,this.zero=o,this.width=a,this.comma=l,this.precision=c,this.type=h}Ste.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width==null?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision==null?"":"."+Math.max(0,this.precision|0))+this.type};function Mme(t){return t}var Pme=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function BMt(t){var e=t.grouping&&t.thousands?FMt(t.grouping,t.thousands):Mme,r=t.currency,i=t.decimal,s=t.numerals?UMt(t.numerals):Mme,n=t.percent||"%";function o(l){l=_6(l);var c=l.fill,h=l.align,d=l.sign,f=l.symbol,m=l.zero,g=l.width,_=l.comma,v=l.precision,b=l.type,T=f==="$"?r[0]:f==="#"&&/[boxX]/.test(b)?"0"+b.toLowerCase():"",x=f==="$"?r[1]:/[%p]/.test(b)?n:"",S=mLe[b],E=!b||/[defgprs%]/.test(b);v=v==null?b?6:12:/[gprs]/.test(b)?Math.max(1,Math.min(21,v)):Math.max(0,Math.min(20,v));function A(R){var M=T,D=x,k,L,N;if(b==="c")D=S(R)+D,R="";else{R=+R;var q=R<0;if(R=S(Math.abs(R),v),q&&+R==0&&(q=!1),M=(q?d==="("?d:"-":d==="-"||d==="("?"":d)+M,D=(b==="s"?Pme[8+fLe/3]:"")+D+(q&&d==="("?")":""),E){for(k=-1,L=R.length;++k<L;)if(N=R.charCodeAt(k),48>N||N>57){D=(N===46?i+R.slice(k+1):R.slice(k))+D,R=R.slice(0,k);break}}}_&&!m&&(R=e(R,1/0));var X=M.length+R.length+D.length,G=X<g?new Array(g-X+1).join(c):"";switch(_&&m&&(R=e(G+R,G.length?g-D.length:1/0),G=""),h){case"<":R=M+R+D+G;break;case"=":R=M+G+R+D;break;case"^":R=G.slice(0,X=G.length>>1)+M+R+D+G.slice(X);break;default:R=G+M+R+D;break}return s(R)}return A.toString=function(){return l+""},A}function a(l,c){var h=o((l=_6(l),l.type="f",l)),d=Math.max(-8,Math.min(8,Math.floor(hC(c)/3)))*3,f=Math.pow(10,-d),m=Pme[8+d/3];return function(g){return h(f*g)+m}}return{format:o,formatPrefix:a}}var xD,gLe,yLe;GMt({decimal:".",thousands:",",grouping:[3],currency:["$",""]});function GMt(t){return xD=BMt(t),gLe=xD.format,yLe=xD.formatPrefix,xD}function jMt(t){return Math.max(0,-hC(Math.abs(t)))}function HMt(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(hC(e)/3)))*3-hC(Math.abs(t)))}function qMt(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,hC(e)-hC(t))+1}function Bv(){return new v6}function v6(){this.reset()}v6.prototype={constructor:v6,reset:function(){this.s=this.t=0},add:function(t){Ime(TD,t,this.t),Ime(this,TD.s,this.s),this.s?this.t+=TD.t:this.s=TD.t},valueOf:function(){return this.s}};var TD=new v6;function Ime(t,e,r){var i=t.s=e+r,s=i-e,n=i-s;t.t=e-n+(r-s)}var fY=Math.PI,$me=fY*2;Bv();Bv();Bv();function Lme(t,e){return[t>fY?t-$me:t<-fY?t+$me:t,e]}Lme.invert=Lme;Bv();Bv();Bv();Bv();Bv();function Dme(){}Dme.prototype={constructor:Dme,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function Nme(t,e){return[t,e]}Nme.invert=Nme;function WMt(t){var e=0,r=t.children,i=r&&r.length;if(!i)e=1;else for(;--i>=0;)e+=r[i].value;t.value=e}function XMt(){return this.eachAfter(WMt)}function YMt(t){var e=this,r,i=[e],s,n,o;do for(r=i.reverse(),i=[];e=r.pop();)if(t(e),s=e.children,s)for(n=0,o=s.length;n<o;++n)i.push(s[n]);while(i.length);return this}function ZMt(t){for(var e=this,r=[e],i,s;e=r.pop();)if(t(e),i=e.children,i)for(s=i.length-1;s>=0;--s)r.push(i[s]);return this}function JMt(t){for(var e=this,r=[e],i=[],s,n,o;e=r.pop();)if(i.push(e),s=e.children,s)for(n=0,o=s.length;n<o;++n)r.push(s[n]);for(;e=i.pop();)t(e);return this}function QMt(t){return this.eachAfter(function(e){for(var r=+t(e.data)||0,i=e.children,s=i&&i.length;--s>=0;)r+=i[s].value;e.value=r})}function KMt(t){return this.eachBefore(function(e){e.children&&e.children.sort(t)})}function ePt(t){for(var e=this,r=tPt(e,t),i=[e];e!==r;)e=e.parent,i.push(e);for(var s=i.length;t!==r;)i.splice(s,0,t),t=t.parent;return i}function tPt(t,e){if(t===e)return t;var r=t.ancestors(),i=e.ancestors(),s=null;for(t=r.pop(),e=i.pop();t===e;)s=t,t=r.pop(),e=i.pop();return s}function rPt(){for(var t=this,e=[t];t=t.parent;)e.push(t);return e}function iPt(){var t=[];return this.each(function(e){t.push(e)}),t}function sPt(){var t=[];return this.eachBefore(function(e){e.children||t.push(e)}),t}function nPt(){var t=this,e=[];return t.each(function(r){r!==t&&e.push({source:r.parent,target:r})}),e}function _Le(t,e){var r=new nP(t),i=+t.value&&(r.value=t.value),s,n=[r],o,a,l,c;for(e==null&&(e=aPt);s=n.pop();)if(i&&(s.value=+s.data.value),(a=e(s.data))&&(c=a.length))for(s.children=new Array(c),l=c-1;l>=0;--l)n.push(o=s.children[l]=new nP(a[l])),o.parent=s,o.depth=s.depth+1;return r.eachBefore(cPt)}function oPt(){return _Le(this).eachBefore(lPt)}function aPt(t){return t.children}function lPt(t){t.data=t.data.data}function cPt(t){var e=0;do t.height=e;while((t=t.parent)&&t.height<++e)}function nP(t){this.data=t,this.depth=this.height=0,this.parent=null}nP.prototype=_Le.prototype={constructor:nP,count:XMt,each:YMt,eachAfter:JMt,eachBefore:ZMt,sum:QMt,sort:KMt,path:ePt,ancestors:rPt,descendants:iPt,leaves:sPt,links:nPt,copy:oPt};function vLe(t,e,r,i,s){for(var n=t.children,o,a=-1,l=n.length,c=t.value&&(i-e)/t.value;++a<l;)o=n[a],o.y0=r,o.y1=s,o.x0=e,o.x1=e+=o.value*c}Object.create(nP.prototype);function bLe(t,e,r,i,s){for(var n=t.children,o,a=-1,l=n.length,c=t.value&&(s-r)/t.value;++a<l;)o=n[a],o.x0=e,o.x1=i,o.y0=r,o.y1=r+=o.value*c}var wLe=(1+Math.sqrt(5))/2;function xLe(t,e,r,i,s,n){for(var o=[],a=e.children,l,c,h=0,d=0,f=a.length,m,g,_=e.value,v,b,T,x,S,E,A;h<f;){m=s-r,g=n-i;do v=a[d++].value;while(!v&&d<f);for(b=T=v,E=Math.max(g/m,m/g)/(_*t),A=v*v*E,S=Math.max(T/A,A/b);d<f;++d){if(v+=c=a[d].value,c<b&&(b=c),c>T&&(T=c),A=v*v*E,x=Math.max(T/A,A/b),x>S){v-=c;break}S=x}o.push(l={value:v,dice:m<g,children:a.slice(h,d)}),l.dice?vLe(l,r,i,s,_?i+=g*v/_:n):bLe(l,r,i,_?r+=m*v/_:s,n),_-=v,h=d}return o}(function t(e){function r(i,s,n,o,a){xLe(e,i,s,n,o,a)}return r.ratio=function(i){return t((i=+i)>1?i:1)},r})(wLe);(function t(e){function r(i,s,n,o,a){if((l=i._squarify)&&l.ratio===e)for(var l,c,h,d,f=-1,m,g=l.length,_=i.value;++f<g;){for(c=l[f],h=c.children,d=c.value=0,m=h.length;d<m;++d)c.value+=h[d].value;c.dice?vLe(c,s,n,o,n+=(a-n)*c.value/_):bLe(c,s,n,s+=(o-s)*c.value/_,a),_-=c.value}else i._squarify=l=xLe(e,i,s,n,o,a),l.ratio=e}return r.ratio=function(i){return t((i=+i)>1?i:1)},r})(wLe);var uPt=[].slice,hPt={};function Fme(t){this._size=t,this._call=this._error=null,this._tasks=[],this._data=[],this._waiting=this._active=this._ended=this._start=0}Fme.prototype={constructor:Fme,defer:function(t){if(typeof t!="function")throw new Error("invalid callback");if(this._call)throw new Error("defer after await");if(this._error!=null)return this;var e=uPt.call(arguments,1);return e.push(t),++this._waiting,this._tasks.push(e),TLe(this),this},abort:function(){return this._error==null&&Ete(this,new Error("abort")),this},await:function(t){if(typeof t!="function")throw new Error("invalid callback");if(this._call)throw new Error("multiple await");return this._call=function(e,r){t.apply(null,[e].concat(r))},b6(this),this},awaitAll:function(t){if(typeof t!="function")throw new Error("invalid callback");if(this._call)throw new Error("multiple await");return this._call=t,b6(this),this}};function TLe(t){if(!t._start)try{dPt(t)}catch(e){if(t._tasks[t._ended+t._active-1])Ete(t,e);else if(!t._data)throw e}}function dPt(t){for(;t._start=t._waiting&&t._active<t._size;){var e=t._ended+t._active,r=t._tasks[e],i=r.length-1,s=r[i];r[i]=pPt(t,e),--t._waiting,++t._active,r=s.apply(null,r),t._tasks[e]&&(t._tasks[e]=r||hPt)}}function pPt(t,e){return function(r,i){t._tasks[e]&&(--t._active,++t._ended,t._tasks[e]=null,t._error==null&&(r!=null?Ete(t,r):(t._data[e]=i,t._waiting?TLe(t):b6(t))))}}function Ete(t,e){var r=t._tasks.length,i;for(t._error=e,t._data=void 0,t._waiting=NaN;--r>=0;)if((i=t._tasks[r])&&(t._tasks[r]=null,i.abort))try{i.abort()}catch{}t._active=NaN,b6(t)}function b6(t){if(!t._active&&t._call){var e=t._data;t._data=void 0,t._call(t._error,e)}}function YC(){return Math.random()}(function t(e){function r(i,s){return i=i==null?0:+i,s=s==null?1:+s,arguments.length===1?(s=i,i=0):s-=i,function(){return e()*s+i}}return r.source=t,r})(YC);const fPt=function t(e){function r(i,s){var n,o;return i=i==null?0:+i,s=s==null?1:+s,function(){var a;if(n!=null)a=n,n=null;else do n=e()*2-1,a=e()*2-1,o=n*n+a*a;while(!o||o>1);return i+s*a*Math.sqrt(-2*Math.log(o)/o)}}return r.source=t,r}(YC);(function t(e){function r(){var i=fPt.source(e).apply(this,arguments);return function(){return Math.exp(i())}}return r.source=t,r})(YC);const mPt=function t(e){function r(i){return function(){for(var s=0,n=0;n<i;++n)s+=e();return s}}return r.source=t,r}(YC);(function t(e){function r(i){var s=mPt.source(e)(i);return function(){return s()/i}}return r.source=t,r})(YC);(function t(e){function r(i){return function(){return-Math.log(1-e())/i}}return r.source=t,r})(YC);var SLe=Array.prototype,gPt=SLe.map,Ume=SLe.slice;function yPt(t){return function(){return t}}function _Pt(t){return+t}var kme=[0,1];function ELe(t,e){return(e-=t=+t)?function(r){return(r-t)/e}:yPt(e)}function vPt(t){return function(e,r){var i=t(e=+e,r=+r);return function(s){return s<=e?0:s>=r?1:i(s)}}}function bPt(t){return function(e,r){var i=t(e=+e,r=+r);return function(s){return s<=0?e:s>=1?r:i(s)}}}function wPt(t,e,r,i){var s=t[0],n=t[1],o=e[0],a=e[1];return n<s?(s=r(n,s),o=i(a,o)):(s=r(s,n),o=i(o,a)),function(l){return o(s(l))}}function xPt(t,e,r,i){var s=Math.min(t.length,e.length)-1,n=new Array(s),o=new Array(s),a=-1;for(t[s]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++a<s;)n[a]=r(t[a],t[a+1]),o[a]=i(e[a],e[a+1]);return function(l){var c=K3t(t,l,1,s)-1;return o[c](n[c](l))}}function TPt(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp())}function SPt(t,e){var r=kme,i=kme,s=uU,n=!1,o,a,l;function c(){return o=Math.min(r.length,i.length)>2?xPt:wPt,a=l=null,h}function h(d){return(a||(a=o(r,i,n?vPt(t):t,s)))(+d)}return h.invert=function(d){return(l||(l=o(i,r,ELe,n?bPt(e):e)))(+d)},h.domain=function(d){return arguments.length?(r=gPt.call(d,_Pt),c()):r.slice()},h.range=function(d){return arguments.length?(i=Ume.call(d),c()):i.slice()},h.rangeRound=function(d){return i=Ume.call(d),s=aRt,c()},h.clamp=function(d){return arguments.length?(n=!!d,c()):n},h.interpolate=function(d){return arguments.length?(s=d,c()):s},c()}function EPt(t,e,r){var i=t[0],s=t[t.length-1],n=tAt(i,s,e??10),o;switch(r=_6(r??",f"),r.type){case"s":{var a=Math.max(Math.abs(i),Math.abs(s));return r.precision==null&&!isNaN(o=HMt(n,a))&&(r.precision=o),yLe(r,a)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(o=qMt(n,Math.max(Math.abs(i),Math.abs(s))))&&(r.precision=o-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(o=jMt(n))&&(r.precision=o-(r.type==="%")*2);break}}return gLe(r)}function CPt(t){var e=t.domain;return t.ticks=function(r){var i=e();return eAt(i[0],i[i.length-1],r??10)},t.tickFormat=function(r,i){return EPt(e(),r,i)},t.nice=function(r){r==null&&(r=10);var i=e(),s=0,n=i.length-1,o=i[s],a=i[n],l;return a<o&&(l=o,o=a,a=l,l=s,s=n,n=l),l=C4(o,a,r),l>0?(o=Math.floor(o/l)*l,a=Math.ceil(a/l)*l,l=C4(o,a,r)):l<0&&(o=Math.ceil(o*l)/l,a=Math.floor(a*l)/l,l=C4(o,a,r)),l>0?(i[s]=Math.floor(o/l)*l,i[n]=Math.ceil(a/l)*l,e(i)):l<0&&(i[s]=Math.ceil(o*l)/l,i[n]=Math.floor(a*l)/l,e(i)),t},t}function mY(){var t=SPt(ELe,ap);return t.copy=function(){return TPt(t,mY())},CPt(t)}var R7=new Date,M7=new Date;function Qo(t,e,r,i){function s(n){return t(n=new Date(+n)),n}return s.floor=s,s.ceil=function(n){return t(n=new Date(n-1)),e(n,1),t(n),n},s.round=function(n){var o=s(n),a=s.ceil(n);return n-o<a-n?o:a},s.offset=function(n,o){return e(n=new Date(+n),o==null?1:Math.floor(o)),n},s.range=function(n,o,a){var l=[],c;if(n=s.ceil(n),a=a==null?1:Math.floor(a),!(n<o)||!(a>0))return l;do l.push(c=new Date(+n)),e(n,a),t(n);while(c<n&&n<o);return l},s.filter=function(n){return Qo(function(o){if(o>=o)for(;t(o),!n(o);)o.setTime(o-1)},function(o,a){if(o>=o)if(a<0)for(;++a<=0;)for(;e(o,-1),!n(o););else for(;--a>=0;)for(;e(o,1),!n(o););})},r&&(s.count=function(n,o){return R7.setTime(+n),M7.setTime(+o),t(R7),t(M7),Math.floor(r(R7,M7))},s.every=function(n){return n=Math.floor(n),!isFinite(n)||!(n>0)?null:n>1?s.filter(i?function(o){return i(o)%n===0}:function(o){return s.count(0,o)%n===0}):s}),s}var gY=Qo(function(){},function(t,e){t.setTime(+t+e)},function(t,e){return e-t});gY.every=function(t){return t=Math.floor(t),!isFinite(t)||!(t>0)?null:t>1?Qo(function(e){e.setTime(Math.floor(e/t)*t)},function(e,r){e.setTime(+e+r*t)},function(e,r){return(r-e)/t}):gY};gY.range;var SD=1e3,Zg=6e4,w_=36e5,CLe=864e5,ALe=6048e5,APt=Qo(function(t){t.setTime(Math.floor(t/SD)*SD)},function(t,e){t.setTime(+t+e*SD)},function(t,e){return(e-t)/SD},function(t){return t.getUTCSeconds()});APt.range;var OPt=Qo(function(t){t.setTime(Math.floor(t/Zg)*Zg)},function(t,e){t.setTime(+t+e*Zg)},function(t,e){return(e-t)/Zg},function(t){return t.getMinutes()});OPt.range;var RPt=Qo(function(t){var e=t.getTimezoneOffset()*Zg%w_;e<0&&(e+=w_),t.setTime(Math.floor((+t-e)/w_)*w_+e)},function(t,e){t.setTime(+t+e*w_)},function(t,e){return(e-t)/w_},function(t){return t.getHours()});RPt.range;var Cte=Qo(function(t){t.setHours(0,0,0,0)},function(t,e){t.setDate(t.getDate()+e)},function(t,e){return(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*Zg)/CLe},function(t){return t.getDate()-1});Cte.range;function Vx(t){return Qo(function(e){e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)},function(e,r){e.setDate(e.getDate()+r*7)},function(e,r){return(r-e-(r.getTimezoneOffset()-e.getTimezoneOffset())*Zg)/ALe})}var OLe=Vx(0),w6=Vx(1),MPt=Vx(2),PPt=Vx(3),M4=Vx(4),IPt=Vx(5),$Pt=Vx(6);OLe.range;w6.range;MPt.range;PPt.range;M4.range;IPt.range;$Pt.range;var LPt=Qo(function(t){t.setDate(1),t.setHours(0,0,0,0)},function(t,e){t.setMonth(t.getMonth()+e)},function(t,e){return e.getMonth()-t.getMonth()+(e.getFullYear()-t.getFullYear())*12},function(t){return t.getMonth()});LPt.range;var gx=Qo(function(t){t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,e){t.setFullYear(t.getFullYear()+e)},function(t,e){return e.getFullYear()-t.getFullYear()},function(t){return t.getFullYear()});gx.every=function(t){return!isFinite(t=Math.floor(t))||!(t>0)?null:Qo(function(e){e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,r){e.setFullYear(e.getFullYear()+r*t)})};gx.range;var DPt=Qo(function(t){t.setUTCSeconds(0,0)},function(t,e){t.setTime(+t+e*Zg)},function(t,e){return(e-t)/Zg},function(t){return t.getUTCMinutes()});DPt.range;var NPt=Qo(function(t){t.setUTCMinutes(0,0,0)},function(t,e){t.setTime(+t+e*w_)},function(t,e){return(e-t)/w_},function(t){return t.getUTCHours()});NPt.range;var Ate=Qo(function(t){t.setUTCHours(0,0,0,0)},function(t,e){t.setUTCDate(t.getUTCDate()+e)},function(t,e){return(e-t)/CLe},function(t){return t.getUTCDate()-1});Ate.range;function Bx(t){return Qo(function(e){e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)},function(e,r){e.setUTCDate(e.getUTCDate()+r*7)},function(e,r){return(r-e)/ALe})}var RLe=Bx(0),x6=Bx(1),FPt=Bx(2),UPt=Bx(3),P4=Bx(4),kPt=Bx(5),zPt=Bx(6);RLe.range;x6.range;FPt.range;UPt.range;P4.range;kPt.range;zPt.range;var VPt=Qo(function(t){t.setUTCDate(1),t.setUTCHours(0,0,0,0)},function(t,e){t.setUTCMonth(t.getUTCMonth()+e)},function(t,e){return e.getUTCMonth()-t.getUTCMonth()+(e.getUTCFullYear()-t.getUTCFullYear())*12},function(t){return t.getUTCMonth()});VPt.range;var yx=Qo(function(t){t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,e){t.setUTCFullYear(t.getUTCFullYear()+e)},function(t,e){return e.getUTCFullYear()-t.getUTCFullYear()},function(t){return t.getUTCFullYear()});yx.every=function(t){return!isFinite(t=Math.floor(t))||!(t>0)?null:Qo(function(e){e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,r){e.setUTCFullYear(e.getUTCFullYear()+r*t)})};yx.range;function BPt(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function ED(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function cA(t){return{y:t,m:0,d:1,H:0,M:0,S:0,L:0}}function GPt(t){var e=t.dateTime,r=t.date,i=t.time,s=t.periods,n=t.days,o=t.shortDays,a=t.months,l=t.shortMonths,c=uA(s),h=hA(s),d=uA(n),f=hA(n),m=uA(o),g=hA(o),_=uA(a),v=hA(a),b=uA(l),T=hA(l),x={a:I,A:z,b:V,B:j,c:null,d:Gme,e:Gme,f:pIt,H:uIt,I:hIt,j:dIt,L:MLe,m:fIt,M:mIt,p:Y,Q:qme,s:Wme,S:gIt,u:yIt,U:_It,V:vIt,w:bIt,W:wIt,x:null,X:null,y:xIt,Y:TIt,Z:SIt,"%":Hme},S={a:Q,A:te,b:ge,B:De,c:null,d:jme,e:jme,f:OIt,H:EIt,I:CIt,j:AIt,L:PLe,m:RIt,M:MIt,p:at,Q:qme,s:Wme,S:PIt,u:IIt,U:$It,V:LIt,w:DIt,W:NIt,x:null,X:null,y:FIt,Y:UIt,Z:kIt,"%":Hme},E={a:k,A:L,b:N,B:q,c:X,d:Vme,e:Vme,f:oIt,H:Bme,I:Bme,j:rIt,L:nIt,m:tIt,M:iIt,p:D,Q:lIt,s:cIt,S:sIt,u:XPt,U:YPt,V:ZPt,w:WPt,W:JPt,x:G,X:J,y:KPt,Y:QPt,Z:eIt,"%":aIt};x.x=A(r,x),x.X=A(i,x),x.c=A(e,x),S.x=A(r,S),S.X=A(i,S),S.c=A(e,S);function A(we,Ce){return function(Me){var Z=[],be=-1,Fe=0,ce=we.length,$e,Xe,ft;for(Me instanceof Date||(Me=new Date(+Me));++be<ce;)we.charCodeAt(be)===37&&(Z.push(we.slice(Fe,be)),(Xe=zme[$e=we.charAt(++be)])!=null?$e=we.charAt(++be):Xe=$e==="e"?" ":"0",(ft=Ce[$e])&&($e=ft(Me,Xe)),Z.push($e),Fe=be+1);return Z.push(we.slice(Fe,be)),Z.join("")}}function R(we,Ce){return function(Me){var Z=cA(1900),be=M(Z,we,Me+="",0),Fe,ce;if(be!=Me.length)return null;if("Q"in Z)return new Date(Z.Q);if("p"in Z&&(Z.H=Z.H%12+Z.p*12),"V"in Z){if(Z.V<1||Z.V>53)return null;"w"in Z||(Z.w=1),"Z"in Z?(Fe=ED(cA(Z.y)),ce=Fe.getUTCDay(),Fe=ce>4||ce===0?x6.ceil(Fe):x6(Fe),Fe=Ate.offset(Fe,(Z.V-1)*7),Z.y=Fe.getUTCFullYear(),Z.m=Fe.getUTCMonth(),Z.d=Fe.getUTCDate()+(Z.w+6)%7):(Fe=Ce(cA(Z.y)),ce=Fe.getDay(),Fe=ce>4||ce===0?w6.ceil(Fe):w6(Fe),Fe=Cte.offset(Fe,(Z.V-1)*7),Z.y=Fe.getFullYear(),Z.m=Fe.getMonth(),Z.d=Fe.getDate()+(Z.w+6)%7)}else("W"in Z||"U"in Z)&&("w"in Z||(Z.w="u"in Z?Z.u%7:"W"in Z?1:0),ce="Z"in Z?ED(cA(Z.y)).getUTCDay():Ce(cA(Z.y)).getDay(),Z.m=0,Z.d="W"in Z?(Z.w+6)%7+Z.W*7-(ce+5)%7:Z.w+Z.U*7-(ce+6)%7);return"Z"in Z?(Z.H+=Z.Z/100|0,Z.M+=Z.Z%100,ED(Z)):Ce(Z)}}function M(we,Ce,Me,Z){for(var be=0,Fe=Ce.length,ce=Me.length,$e,Xe;be<Fe;){if(Z>=ce)return-1;if($e=Ce.charCodeAt(be++),$e===37){if($e=Ce.charAt(be++),Xe=E[$e in zme?Ce.charAt(be++):$e],!Xe||(Z=Xe(we,Me,Z))<0)return-1}else if($e!=Me.charCodeAt(Z++))return-1}return Z}function D(we,Ce,Me){var Z=c.exec(Ce.slice(Me));return Z?(we.p=h[Z[0].toLowerCase()],Me+Z[0].length):-1}function k(we,Ce,Me){var Z=m.exec(Ce.slice(Me));return Z?(we.w=g[Z[0].toLowerCase()],Me+Z[0].length):-1}function L(we,Ce,Me){var Z=d.exec(Ce.slice(Me));return Z?(we.w=f[Z[0].toLowerCase()],Me+Z[0].length):-1}function N(we,Ce,Me){var Z=b.exec(Ce.slice(Me));return Z?(we.m=T[Z[0].toLowerCase()],Me+Z[0].length):-1}function q(we,Ce,Me){var Z=_.exec(Ce.slice(Me));return Z?(we.m=v[Z[0].toLowerCase()],Me+Z[0].length):-1}function X(we,Ce,Me){return M(we,e,Ce,Me)}function G(we,Ce,Me){return M(we,r,Ce,Me)}function J(we,Ce,Me){return M(we,i,Ce,Me)}function I(we){return o[we.getDay()]}function z(we){return n[we.getDay()]}function V(we){return l[we.getMonth()]}function j(we){return a[we.getMonth()]}function Y(we){return s[+(we.getHours()>=12)]}function Q(we){return o[we.getUTCDay()]}function te(we){return n[we.getUTCDay()]}function ge(we){return l[we.getUTCMonth()]}function De(we){return a[we.getUTCMonth()]}function at(we){return s[+(we.getUTCHours()>=12)]}return{format:function(we){var Ce=A(we+="",x);return Ce.toString=function(){return we},Ce},parse:function(we){var Ce=R(we+="",BPt);return Ce.toString=function(){return we},Ce},utcFormat:function(we){var Ce=A(we+="",S);return Ce.toString=function(){return we},Ce},utcParse:function(we){var Ce=R(we,ED);return Ce.toString=function(){return we},Ce}}}var zme={"-":"",_:" ",0:"0"},Ea=/^\s*\d+/,jPt=/^%/,HPt=/[\\^$*+?|[\]().{}]/g;function rs(t,e,r){var i=t<0?"-":"",s=(i?-t:t)+"",n=s.length;return i+(n<r?new Array(r-n+1).join(e)+s:s)}function qPt(t){return t.replace(HPt,"\\$&")}function uA(t){return new RegExp("^(?:"+t.map(qPt).join("|")+")","i")}function hA(t){for(var e={},r=-1,i=t.length;++r<i;)e[t[r].toLowerCase()]=r;return e}function WPt(t,e,r){var i=Ea.exec(e.slice(r,r+1));return i?(t.w=+i[0],r+i[0].length):-1}function XPt(t,e,r){var i=Ea.exec(e.slice(r,r+1));return i?(t.u=+i[0],r+i[0].length):-1}function YPt(t,e,r){var i=Ea.exec(e.slice(r,r+2));return i?(t.U=+i[0],r+i[0].length):-1}function ZPt(t,e,r){var i=Ea.exec(e.slice(r,r+2));return i?(t.V=+i[0],r+i[0].length):-1}function JPt(t,e,r){var i=Ea.exec(e.slice(r,r+2));return i?(t.W=+i[0],r+i[0].length):-1}function QPt(t,e,r){var i=Ea.exec(e.slice(r,r+4));return i?(t.y=+i[0],r+i[0].length):-1}function KPt(t,e,r){var i=Ea.exec(e.slice(r,r+2));return i?(t.y=+i[0]+(+i[0]>68?1900:2e3),r+i[0].length):-1}function eIt(t,e,r){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(r,r+6));return i?(t.Z=i[1]?0:-(i[2]+(i[3]||"00")),r+i[0].length):-1}function tIt(t,e,r){var i=Ea.exec(e.slice(r,r+2));return i?(t.m=i[0]-1,r+i[0].length):-1}function Vme(t,e,r){var i=Ea.exec(e.slice(r,r+2));return i?(t.d=+i[0],r+i[0].length):-1}function rIt(t,e,r){var i=Ea.exec(e.slice(r,r+3));return i?(t.m=0,t.d=+i[0],r+i[0].length):-1}function Bme(t,e,r){var i=Ea.exec(e.slice(r,r+2));return i?(t.H=+i[0],r+i[0].length):-1}function iIt(t,e,r){var i=Ea.exec(e.slice(r,r+2));return i?(t.M=+i[0],r+i[0].length):-1}function sIt(t,e,r){var i=Ea.exec(e.slice(r,r+2));return i?(t.S=+i[0],r+i[0].length):-1}function nIt(t,e,r){var i=Ea.exec(e.slice(r,r+3));return i?(t.L=+i[0],r+i[0].length):-1}function oIt(t,e,r){var i=Ea.exec(e.slice(r,r+6));return i?(t.L=Math.floor(i[0]/1e3),r+i[0].length):-1}function aIt(t,e,r){var i=jPt.exec(e.slice(r,r+1));return i?r+i[0].length:-1}function lIt(t,e,r){var i=Ea.exec(e.slice(r));return i?(t.Q=+i[0],r+i[0].length):-1}function cIt(t,e,r){var i=Ea.exec(e.slice(r));return i?(t.Q=+i[0]*1e3,r+i[0].length):-1}function Gme(t,e){return rs(t.getDate(),e,2)}function uIt(t,e){return rs(t.getHours(),e,2)}function hIt(t,e){return rs(t.getHours()%12||12,e,2)}function dIt(t,e){return rs(1+Cte.count(gx(t),t),e,3)}function MLe(t,e){return rs(t.getMilliseconds(),e,3)}function pIt(t,e){return MLe(t,e)+"000"}function fIt(t,e){return rs(t.getMonth()+1,e,2)}function mIt(t,e){return rs(t.getMinutes(),e,2)}function gIt(t,e){return rs(t.getSeconds(),e,2)}function yIt(t){var e=t.getDay();return e===0?7:e}function _It(t,e){return rs(OLe.count(gx(t),t),e,2)}function vIt(t,e){var r=t.getDay();return t=r>=4||r===0?M4(t):M4.ceil(t),rs(M4.count(gx(t),t)+(gx(t).getDay()===4),e,2)}function bIt(t){return t.getDay()}function wIt(t,e){return rs(w6.count(gx(t),t),e,2)}function xIt(t,e){return rs(t.getFullYear()%100,e,2)}function TIt(t,e){return rs(t.getFullYear()%1e4,e,4)}function SIt(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+rs(e/60|0,"0",2)+rs(e%60,"0",2)}function jme(t,e){return rs(t.getUTCDate(),e,2)}function EIt(t,e){return rs(t.getUTCHours(),e,2)}function CIt(t,e){return rs(t.getUTCHours()%12||12,e,2)}function AIt(t,e){return rs(1+Ate.count(yx(t),t),e,3)}function PLe(t,e){return rs(t.getUTCMilliseconds(),e,3)}function OIt(t,e){return PLe(t,e)+"000"}function RIt(t,e){return rs(t.getUTCMonth()+1,e,2)}function MIt(t,e){return rs(t.getUTCMinutes(),e,2)}function PIt(t,e){return rs(t.getUTCSeconds(),e,2)}function IIt(t){var e=t.getUTCDay();return e===0?7:e}function $It(t,e){return rs(RLe.count(yx(t),t),e,2)}function LIt(t,e){var r=t.getUTCDay();return t=r>=4||r===0?P4(t):P4.ceil(t),rs(P4.count(yx(t),t)+(yx(t).getUTCDay()===4),e,2)}function DIt(t){return t.getUTCDay()}function NIt(t,e){return rs(x6.count(yx(t),t),e,2)}function FIt(t,e){return rs(t.getUTCFullYear()%100,e,2)}function UIt(t,e){return rs(t.getUTCFullYear()%1e4,e,4)}function kIt(){return"+0000"}function Hme(){return"%"}function qme(t){return+t}function Wme(t){return Math.floor(+t/1e3)}var s2,ILe,$Le;zIt({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function zIt(t){return s2=GPt(t),s2.format,s2.parse,ILe=s2.utcFormat,$Le=s2.utcParse,s2}var LLe="%Y-%m-%dT%H:%M:%S.%LZ";function VIt(t){return t.toISOString()}Date.prototype.toISOString||ILe(LLe);function BIt(t){var e=new Date(t);return isNaN(e)?null:e}+new Date("2000-01-01T00:00:00.000Z")||$Le(LLe);function Gv(t){return t.match(/.{6}/g).map(function(e){return"#"+e})}Gv("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf");Gv("393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6");Gv("3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9");Gv("1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5");yte(Cm(300,.5,0),Cm(-240,.5,1));yte(Cm(-100,.75,.35),Cm(80,1.5,.8));yte(Cm(260,.75,.35),Cm(80,1.5,.8));Cm();function fU(t){var e=t.length;return function(r){return t[Math.max(0,Math.min(e-1,Math.floor(r*e)))]}}fU(Gv("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725"));fU(Gv("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf"));fU(Gv("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4"));fU(Gv("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));var Xme=1e-12;function T6(){}function Yme(t,e,r){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+e)/6,(t._y0+4*t._y1+r)/6)}function Ote(t){this._context=t}Ote.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:Yme(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:Yme(this,t,e);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function DLe(t,e){this._basis=new Ote(t),this._beta=e}DLe.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var t=this._x,e=this._y,r=t.length-1;if(r>0)for(var i=t[0],s=e[0],n=t[r]-i,o=e[r]-s,a=-1,l;++a<=r;)l=a/r,this._basis.point(this._beta*t[a]+(1-this._beta)*(i+l*n),this._beta*e[a]+(1-this._beta)*(s+l*o));this._x=this._y=null,this._basis.lineEnd()},point:function(t,e){this._x.push(+t),this._y.push(+e)}};(function t(e){function r(i){return e===1?new Ote(i):new DLe(i,e)}return r.beta=function(i){return t(+i)},r})(.85);function S6(t,e,r){t._context.bezierCurveTo(t._x1+t._k*(t._x2-t._x0),t._y1+t._k*(t._y2-t._y0),t._x2+t._k*(t._x1-e),t._y2+t._k*(t._y1-r),t._x2,t._y2)}function Rte(t,e){this._context=t,this._k=(1-e)/6}Rte.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:S6(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2,this._x1=t,this._y1=e;break;case 2:this._point=3;default:S6(this,t,e);break}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};(function t(e){function r(i){return new Rte(i,e)}return r.tension=function(i){return t(+i)},r})(0);function Mte(t,e){this._context=t,this._k=(1-e)/6}Mte.prototype={areaStart:T6,areaEnd:T6,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:S6(this,t,e);break}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};(function t(e){function r(i){return new Mte(i,e)}return r.tension=function(i){return t(+i)},r})(0);function Pte(t,e){this._context=t,this._k=(1-e)/6}Pte.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:S6(this,t,e);break}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};(function t(e){function r(i){return new Pte(i,e)}return r.tension=function(i){return t(+i)},r})(0);function Ite(t,e,r){var i=t._x1,s=t._y1,n=t._x2,o=t._y2;if(t._l01_a>Xme){var a=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,l=3*t._l01_a*(t._l01_a+t._l12_a);i=(i*a-t._x0*t._l12_2a+t._x2*t._l01_2a)/l,s=(s*a-t._y0*t._l12_2a+t._y2*t._l01_2a)/l}if(t._l23_a>Xme){var c=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,h=3*t._l23_a*(t._l23_a+t._l12_a);n=(n*c+t._x1*t._l23_2a-e*t._l12_2a)/h,o=(o*c+t._y1*t._l23_2a-r*t._l12_2a)/h}t._context.bezierCurveTo(i,s,n,o,t._x2,t._y2)}function NLe(t,e){this._context=t,this._alpha=e}NLe.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var r=this._x2-t,i=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(r*r+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3;default:Ite(this,t,e);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};(function t(e){function r(i){return e?new NLe(i,e):new Rte(i,0)}return r.alpha=function(i){return t(+i)},r})(.5);function FLe(t,e){this._context=t,this._alpha=e}FLe.prototype={areaStart:T6,areaEnd:T6,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(t,e){if(t=+t,e=+e,this._point){var r=this._x2-t,i=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(r*r+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:Ite(this,t,e);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};(function t(e){function r(i){return e?new FLe(i,e):new Mte(i,0)}return r.alpha=function(i){return t(+i)},r})(.5);function ULe(t,e){this._context=t,this._alpha=e}ULe.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var r=this._x2-t,i=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(r*r+i*i,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Ite(this,t,e);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};(function t(e){function r(i){return e?new ULe(i,e):new Pte(i,0)}return r.alpha=function(i){return t(+i)},r})(.5);function Zme(t){return t<0?-1:1}function Jme(t,e,r){var i=t._x1-t._x0,s=e-t._x1,n=(t._y1-t._y0)/(i||s<0&&-0),o=(r-t._y1)/(s||i<0&&-0),a=(n*s+o*i)/(i+s);return(Zme(n)+Zme(o))*Math.min(Math.abs(n),Math.abs(o),.5*Math.abs(a))||0}function Qme(t,e){var r=t._x1-t._x0;return r?(3*(t._y1-t._y0)/r-e)/2:e}function P7(t,e,r){var i=t._x0,s=t._y0,n=t._x1,o=t._y1,a=(n-i)/3;t._context.bezierCurveTo(i+a,s+a*e,n-a,o-a*r,n,o)}function yY(t){this._context=t}yY.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:P7(this,this._t0,Qme(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){var r=NaN;if(t=+t,e=+e,!(t===this._x1&&e===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,P7(this,Qme(this,r=Jme(this,t,e)),r);break;default:P7(this,this._t0,r=Jme(this,t,e));break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e,this._t0=r}}};Object.create(yY.prototype).point=function(t,e){yY.prototype.point.call(this,e,t)};function E6(){this._=null}function mU(t){t.U=t.C=t.L=t.R=t.P=t.N=null}E6.prototype={constructor:E6,insert:function(t,e){var r,i,s;if(t){if(e.P=t,e.N=t.N,t.N&&(t.N.P=e),t.N=e,t.R){for(t=t.R;t.L;)t=t.L;t.L=e}else t.R=e;r=t}else this._?(t=Kme(this._),e.P=null,e.N=t,t.P=t.L=e,r=t):(e.P=e.N=null,this._=e,r=null);for(e.L=e.R=null,e.U=r,e.C=!0,t=e;r&&r.C;)i=r.U,r===i.L?(s=i.R,s&&s.C?(r.C=s.C=!1,i.C=!0,t=i):(t===r.R&&(dA(this,r),t=r,r=t.U),r.C=!1,i.C=!0,pA(this,i))):(s=i.L,s&&s.C?(r.C=s.C=!1,i.C=!0,t=i):(t===r.L&&(pA(this,r),t=r,r=t.U),r.C=!1,i.C=!0,dA(this,i))),r=t.U;this._.C=!1},remove:function(t){t.N&&(t.N.P=t.P),t.P&&(t.P.N=t.N),t.N=t.P=null;var e=t.U,r,i=t.L,s=t.R,n,o;if(i?s?n=Kme(s):n=i:n=s,e?e.L===t?e.L=n:e.R=n:this._=n,i&&s?(o=n.C,n.C=t.C,n.L=i,i.U=n,n!==s?(e=n.U,n.U=t.U,t=n.R,e.L=t,n.R=s,s.U=n):(n.U=e,e=n,t=n.R)):(o=t.C,t=n),t&&(t.U=e),!o){if(t&&t.C){t.C=!1;return}do{if(t===this._)break;if(t===e.L){if(r=e.R,r.C&&(r.C=!1,e.C=!0,dA(this,e),r=e.R),r.L&&r.L.C||r.R&&r.R.C){(!r.R||!r.R.C)&&(r.L.C=!1,r.C=!0,pA(this,r),r=e.R),r.C=e.C,e.C=r.R.C=!1,dA(this,e),t=this._;break}}else if(r=e.L,r.C&&(r.C=!1,e.C=!0,pA(this,e),r=e.L),r.L&&r.L.C||r.R&&r.R.C){(!r.L||!r.L.C)&&(r.R.C=!1,r.C=!0,dA(this,r),r=e.L),r.C=e.C,e.C=r.L.C=!1,pA(this,e),t=this._;break}r.C=!0,t=e,e=e.U}while(!t.C);t&&(t.C=!1)}}};function dA(t,e){var r=e,i=e.R,s=r.U;s?s.L===r?s.L=i:s.R=i:t._=i,i.U=s,r.U=i,r.R=i.L,r.R&&(r.R.U=r),i.L=r}function pA(t,e){var r=e,i=e.L,s=r.U;s?s.L===r?s.L=i:s.R=i:t._=i,i.U=s,r.U=i,r.L=i.R,r.L&&(r.L.U=r),i.R=r}function Kme(t){for(;t.L;)t=t.L;return t}function KO(t,e,r,i){var s=[null,null],n=Ja.push(s)-1;return s.left=t,s.right=e,r&&C6(s,t,e,r),i&&C6(s,e,t,i),wu[t.index].halfedges.push(n),wu[e.index].halfedges.push(n),s}function fA(t,e,r){var i=[e,r];return i.left=t,i}function C6(t,e,r,i){!t[0]&&!t[1]?(t[0]=i,t.left=e,t.right=r):t.left===r?t[1]=i:t[0]=i}function GIt(t,e,r,i,s){var n=t[0],o=t[1],a=n[0],l=n[1],c=o[0],h=o[1],d=0,f=1,m=c-a,g=h-l,_;if(_=e-a,!(!m&&_>0)){if(_/=m,m<0){if(_<d)return;_<f&&(f=_)}else if(m>0){if(_>f)return;_>d&&(d=_)}if(_=i-a,!(!m&&_<0)){if(_/=m,m<0){if(_>f)return;_>d&&(d=_)}else if(m>0){if(_<d)return;_<f&&(f=_)}if(_=r-l,!(!g&&_>0)){if(_/=g,g<0){if(_<d)return;_<f&&(f=_)}else if(g>0){if(_>f)return;_>d&&(d=_)}if(_=s-l,!(!g&&_<0)){if(_/=g,g<0){if(_>f)return;_>d&&(d=_)}else if(g>0){if(_<d)return;_<f&&(f=_)}return!(d>0)&&!(f<1)||(d>0&&(t[0]=[a+d*m,l+d*g]),f<1&&(t[1]=[a+f*m,l+f*g])),!0}}}}}function jIt(t,e,r,i,s){var n=t[1];if(n)return!0;var o=t[0],a=t.left,l=t.right,c=a[0],h=a[1],d=l[0],f=l[1],m=(c+d)/2,g=(h+f)/2,_,v;if(f===h){if(m<e||m>=i)return;if(c>d){if(!o)o=[m,r];else if(o[1]>=s)return;n=[m,s]}else{if(!o)o=[m,s];else if(o[1]<r)return;n=[m,r]}}else if(_=(c-d)/(f-h),v=g-_*m,_<-1||_>1)if(c>d){if(!o)o=[(r-v)/_,r];else if(o[1]>=s)return;n=[(s-v)/_,s]}else{if(!o)o=[(s-v)/_,s];else if(o[1]<r)return;n=[(r-v)/_,r]}else if(h<f){if(!o)o=[e,_*e+v];else if(o[0]>=i)return;n=[i,_*i+v]}else{if(!o)o=[i,_*i+v];else if(o[0]<e)return;n=[e,_*e+v]}return t[0]=o,t[1]=n,!0}function HIt(t,e,r,i){for(var s=Ja.length,n;s--;)(!jIt(n=Ja[s],t,e,r,i)||!GIt(n,t,e,r,i)||!(Math.abs(n[0][0]-n[1][0])>js||Math.abs(n[0][1]-n[1][1])>js))&&delete Ja[s]}function qIt(t){return wu[t.index]={site:t,halfedges:[]}}function WIt(t,e){var r=t.site,i=e.left,s=e.right;return r===s&&(s=i,i=r),s?Math.atan2(s[1]-i[1],s[0]-i[0]):(r===i?(i=e[1],s=e[0]):(i=e[0],s=e[1]),Math.atan2(i[0]-s[0],s[1]-i[1]))}function kLe(t,e){return e[+(e.left!==t.site)]}function XIt(t,e){return e[+(e.left===t.site)]}function YIt(){for(var t=0,e=wu.length,r,i,s,n;t<e;++t)if((r=wu[t])&&(n=(i=r.halfedges).length)){var o=new Array(n),a=new Array(n);for(s=0;s<n;++s)o[s]=s,a[s]=WIt(r,Ja[i[s]]);for(o.sort(function(l,c){return a[c]-a[l]}),s=0;s<n;++s)a[s]=i[o[s]];for(s=0;s<n;++s)i[s]=a[s]}}function ZIt(t,e,r,i){var s=wu.length,n,o,a,l,c,h,d,f,m,g,_,v,b=!0;for(n=0;n<s;++n)if(o=wu[n]){for(a=o.site,c=o.halfedges,l=c.length;l--;)Ja[c[l]]||c.splice(l,1);for(l=0,h=c.length;l<h;)g=XIt(o,Ja[c[l]]),_=g[0],v=g[1],d=kLe(o,Ja[c[++l%h]]),f=d[0],m=d[1],(Math.abs(_-f)>js||Math.abs(v-m)>js)&&(c.splice(l,0,Ja.push(fA(a,g,Math.abs(_-t)<js&&i-v>js?[t,Math.abs(f-t)<js?m:i]:Math.abs(v-i)<js&&r-_>js?[Math.abs(m-i)<js?f:r,i]:Math.abs(_-r)<js&&v-e>js?[r,Math.abs(f-r)<js?m:e]:Math.abs(v-e)<js&&_-t>js?[Math.abs(m-e)<js?f:t,e]:null))-1),++h);h&&(b=!1)}if(b){var T,x,S,E=1/0;for(n=0,b=null;n<s;++n)(o=wu[n])&&(a=o.site,T=a[0]-t,x=a[1]-e,S=T*T+x*x,S<E&&(E=S,b=o));if(b){var A=[t,e],R=[t,i],M=[r,i],D=[r,e];b.halfedges.push(Ja.push(fA(a=b.site,A,R))-1,Ja.push(fA(a,R,M))-1,Ja.push(fA(a,M,D))-1,Ja.push(fA(a,D,A))-1)}}for(n=0;n<s;++n)(o=wu[n])&&(o.halfedges.length||delete wu[n])}var zLe=[],$te;function JIt(){mU(this),this.x=this.y=this.arc=this.site=this.cy=null}function TS(t){var e=t.P,r=t.N;if(!(!e||!r)){var i=e.site,s=t.site,n=r.site;if(i!==n){var o=s[0],a=s[1],l=i[0]-o,c=i[1]-a,h=n[0]-o,d=n[1]-a,f=2*(l*d-c*h);if(!(f>=-r$t)){var m=l*l+c*c,g=h*h+d*d,_=(d*m-c*g)/f,v=(l*g-h*m)/f,b=zLe.pop()||new JIt;b.arc=t,b.site=s,b.x=_+o,b.y=(b.cy=v+a)+Math.sqrt(_*_+v*v),t.circle=b;for(var T=null,x=oP._;x;)if(b.y<x.y||b.y===x.y&&b.x<=x.x)if(x.L)x=x.L;else{T=x.P;break}else if(x.R)x=x.R;else{T=x;break}oP.insert(T,b),T||($te=b)}}}}function oE(t){var e=t.circle;e&&(e.P||($te=e.N),oP.remove(e),zLe.push(e),mU(e),t.circle=null)}var VLe=[];function QIt(){mU(this),this.edge=this.site=this.circle=null}function ege(t){var e=VLe.pop()||new QIt;return e.site=t,e}function I7(t){oE(t),aE.remove(t),VLe.push(t),mU(t)}function KIt(t){var e=t.circle,r=e.x,i=e.cy,s=[r,i],n=t.P,o=t.N,a=[t];I7(t);for(var l=n;l.circle&&Math.abs(r-l.circle.x)<js&&Math.abs(i-l.circle.cy)<js;)n=l.P,a.unshift(l),I7(l),l=n;a.unshift(l),oE(l);for(var c=o;c.circle&&Math.abs(r-c.circle.x)<js&&Math.abs(i-c.circle.cy)<js;)o=c.N,a.push(c),I7(c),c=o;a.push(c),oE(c);var h=a.length,d;for(d=1;d<h;++d)c=a[d],l=a[d-1],C6(c.edge,l.site,c.site,s);l=a[0],c=a[h-1],c.edge=KO(l.site,c.site,null,s),TS(l),TS(c)}function e$t(t){for(var e=t[0],r=t[1],i,s,n,o,a=aE._;a;)if(n=BLe(a,r)-e,n>js)a=a.L;else if(o=e-t$t(a,r),o>js){if(!a.R){i=a;break}a=a.R}else{n>-js?(i=a.P,s=a):o>-js?(i=a,s=a.N):i=s=a;break}qIt(t);var l=ege(t);if(aE.insert(i,l),!(!i&&!s)){if(i===s){oE(i),s=ege(i.site),aE.insert(l,s),l.edge=s.edge=KO(i.site,l.site),TS(i),TS(s);return}if(!s){l.edge=KO(i.site,l.site);return}oE(i),oE(s);var c=i.site,h=c[0],d=c[1],f=t[0]-h,m=t[1]-d,g=s.site,_=g[0]-h,v=g[1]-d,b=2*(f*v-m*_),T=f*f+m*m,x=_*_+v*v,S=[(v*T-m*x)/b+h,(f*x-_*T)/b+d];C6(s.edge,c,g,S),l.edge=KO(c,t,null,S),s.edge=KO(t,g,null,S),TS(i),TS(s)}}function BLe(t,e){var r=t.site,i=r[0],s=r[1],n=s-e;if(!n)return i;var o=t.P;if(!o)return-1/0;r=o.site;var a=r[0],l=r[1],c=l-e;if(!c)return a;var h=a-i,d=1/n-1/c,f=h/c;return d?(-f+Math.sqrt(f*f-2*d*(h*h/(-2*c)-l+c/2+s-n/2)))/d+i:(i+a)/2}function t$t(t,e){var r=t.N;if(r)return BLe(r,e);var i=t.site;return i[1]===e?i[0]:1/0}var js=1e-6,r$t=1e-12,aE,wu,oP,Ja;function i$t(t,e,r){return(t[0]-r[0])*(e[1]-t[1])-(t[0]-e[0])*(r[1]-t[1])}function s$t(t,e){return e[1]-t[1]||e[0]-t[0]}function tge(t,e){var r=t.sort(s$t).pop(),i,s,n;for(Ja=[],wu=new Array(t.length),aE=new E6,oP=new E6;;)if(n=$te,r&&(!n||r[1]<n.y||r[1]===n.y&&r[0]<n.x))(r[0]!==i||r[1]!==s)&&(e$t(r),i=r[0],s=r[1]),r=t.pop();else if(n)KIt(n.arc);else break;if(YIt(),e){var o=+e[0][0],a=+e[0][1],l=+e[1][0],c=+e[1][1];HIt(o,a,l,c),ZIt(o,a,l,c)}this.edges=Ja,this.cells=wu,aE=oP=Ja=wu=null}tge.prototype={constructor:tge,polygons:function(){var t=this.edges;return this.cells.map(function(e){var r=e.halfedges.map(function(i){return kLe(e,t[i])});return r.data=e.site.data,r})},triangles:function(){var t=[],e=this.edges;return this.cells.forEach(function(r,i){if(a=(n=r.halfedges).length)for(var s=r.site,n,o=-1,a,l,c=e[n[a-1]],h=c.left===s?c.right:c.left;++o<a;)l=h,c=e[n[o]],h=c.left===s?c.right:c.left,l&&h&&i<l.index&&i<h.index&&i$t(s,l,h)<0&&t.push([s.data,l.data,h.data])}),t},links:function(){return this.edges.filter(function(t){return t.right}).map(function(t){return{source:t.left.data,target:t.right.data}})},find:function(t,e,r){for(var i=this,s,n=i._found||0,o=i.cells.length,a;!(a=i.cells[n]);)if(++n>=o)return null;var l=t-a.site[0],c=e-a.site[1],h=l*l+c*c;do a=i.cells[s=n],n=null,a.halfedges.forEach(function(d){var f=i.edges[d],m=f.left;if(!((m===a.site||!m)&&!(m=f.right))){var g=t-m[0],_=e-m[1],v=g*g+_*_;v<h&&(h=v,n=m.index)}});while(n!==null);return i._found=s,r==null||h<=r*r?a.site:null}};function eR(t,e,r){this.k=t,this.x=e,this.y=r}eR.prototype={constructor:eR,scale:function(t){return t===1?this:new eR(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new eR(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};eR.prototype;class n$t{constructor(e,r,i){this.width=document.getElementById(e).clientWidth,this.height=document.getElementById(e).clientHeight,this.paddingLeft=90,this.paddingTop=20,this.paddingBottom=15;const s=X_("#"+e).append("svg").attr("height",this.height).attr("width",this.width+2),n=Pi.buildingOptions,o=mY().domain([n.minCnstrctYear-1,n.maxCnstrctYear]).range([this.paddingLeft,this.width]),a=mY().domain([0,n.maxHeight]).range([this.height-this.paddingBottom,this.paddingTop]),l=cAt(a).tickValues([0,500,1e3,1500]).tickFormat(g=>g===1500?g+" ft":g.toString()).tickPadding(10);function c(g,_,v,b){s.append("line").attr("x1",g).attr("y1",a(_)).attr("x2",o(v)).attr("y2",a(b)).style("stroke-dasharray","2, 2").style("stroke","#bbb")}c(this.paddingLeft,1e3,2025,1e3),c(this.paddingLeft,500,2025,500),c(this.paddingLeft,0,2025,0),c(this.paddingLeft,1408,2009,1408),s.append("image").attr("xlink:href","./img/world-trade-center.png").attr("y",30).attr("x",10).attr("height",this.height-43).attr("width",25);const h=s.append("g");h.append("rect").classed("top",!0).attr("x",o(2020)).attr("y",a(n.maxHeight)-9).attr("width",50).attr("height",6).attr("rx",5).attr("ry",0).attr("cursor","ns-resize").style("fill","#bbb"),h.append("rect").classed("bottom",!0).attr("x",o(2020)).attr("y",a(n.minHeight)-1).attr("width",50).attr("height",6).attr("rx",5).attr("ry",0).attr("cursor","ns-resize").style("fill","#bbb");const d=s.append("g").attr("transform","translate("+this.paddingLeft+", 0)").call(l),f=_Mt().extent([[0,this.paddingTop],[this.width,this.height-this.paddingBottom]]);d.call(f).call(f.move,[a(n.maxHeight),a(n.minHeight)]),s.select(".overlay").attr("display","none");const m=s.selectAll("circle").data(r).enter().append("circle").attr("r",4).attr("class",function(g){let _;return Pi.ageClasses.forEach(function(v,b){v.minValue<=g.attributes.cnstrct_yr&&g.attributes.cnstrct_yr<=v.maxValue&&(_=b)}),"construct-"+_}).classed("circle",!0).attr("id",function(g){return"id-"+g.attributes.objectid}).attr("fill",function(g){const v=Pi.ageClasses.filter(function(b){return b.minValue<=g.attributes.cnstrct_yr&&g.attributes.cnstrct_yr<=b.maxValue})[0].color.clone();return v.a=.7,v.toCss()}).attr("cx",function(g){return o(g.attributes.cnstrct_yr)}).attr("cy",function(g){return a(g.attributes.heightroof)}).on("click",function(g){i.selectedBuilding=g});s.append("text").attr("x",this.paddingLeft+2).attr("id","upper-indicator"),s.append("text").attr("x",this.paddingLeft+2).attr("id","lower-indicator"),f.on("brush",function(){h.select("rect.top").attr("y",Nr.selection[0]-9),h.select("rect.bottom").attr("y",Nr.selection[1]-1),s.select("#upper-indicator").attr("y",Nr.selection[0]-5).text(Math.round(a.invert(Nr.selection[0]))),s.select("#lower-indicator").attr("y",Nr.selection[1]+15).text(Math.round(a.invert(Nr.selection[1]))),i.filteredBuildings=[a.invert(Nr.selection[1]),a.invert(Nr.selection[0])]}),f.on("end",function(){s.select("#upper-indicator").text(""),s.select("#lower-indicator").text(""),Nr.selection||d.call(f).call(f.move,[a(1500),a(0)])}),this.circles=m,this.selectContainer=s.append("g")}select(e){const r=X_("#id-"+e.attributes.objectid);this.selectContainer.append("circle").attr("class","selectedGraphic").attr("r",8).attr("cx",parseInt(r.attr("cx"),10)).attr("cy",parseInt(r.attr("cy"),10)).attr("stroke-width",4).attr("stroke",Pi.highlightOptions.color.toCss()).attr("fill","none")}deselect(){this.selectContainer.selectAll(".selectedGraphic").remove()}updatePeriod(e){for(let r=0;r<e.length;r++){let i;e[r]?(i=Pi.ageClasses[r].color.clone(),i.a=.8):i=Pi.defaultColor,this.circles.filter(".construct-"+r).attr("fill",i.toCss(!0))}}updateFilter(e){this.circles.attr("display",function(r){return r.attributes.heightroof<e[0]||r.attributes.heightroof>e[1]?"none":"inline"})}applyCategory(e){if(e==="all")this.circles.attr("opacity",1).attr("r",4);else{const r=e==="info"?"wiki":"top20";this.circles.attr("opacity",function(i){return i.attributes[r]===1?1:.2}).attr("r",function(i){return i.attributes[r]===1?4:1})}}}class o$t{constructor(e,r){for(let s=0;s<Pi.initPeriod.length;s++){const n=document.createElement("button");n.id="period-"+s,n.innerHTML=Pi.ageClasses[s].minValue+" - "+Pi.ageClasses[s].maxValue,document.getElementById(e).appendChild(n),n.addEventListener("click",i(s))}function i(s){return function(){const n=[];for(let o=0;o<Pi.initPeriod.length;o++)n[o]=o!==s?r.selectedPeriod[o]:!r.selectedPeriod[o];r.selectedPeriod=n}}}update(e){for(let r=0;r<e.length;r++){const i=document.getElementById("period-"+r).style;i.backgroundColor=e[r]?Pi.ageClasses[r].color.toCss():Pi.defaultColor.toCss(),i.color=e[r]?"#fff":"#777"}}}function rge(t){return t!==null&&typeof t=="object"&&"constructor"in t&&t.constructor===Object}function Lte(t,e){t===void 0&&(t={}),e===void 0&&(e={}),Object.keys(e).forEach(r=>{typeof t[r]>"u"?t[r]=e[r]:rge(e[r])&&rge(t[r])&&Object.keys(e[r]).length>0&&Lte(t[r],e[r])})}const GLe={body:{},addEventListener(){},removeEventListener(){},activeElement:{blur(){},nodeName:""},querySelector(){return null},querySelectorAll(){return[]},getElementById(){return null},createEvent(){return{initEvent(){}}},createElement(){return{children:[],childNodes:[],style:{},setAttribute(){},getElementsByTagName(){return[]}}},createElementNS(){return{}},importNode(){return null},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""}};function Gx(){const t=typeof document<"u"?document:{};return Lte(t,GLe),t}const a$t={document:GLe,navigator:{userAgent:""},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""},history:{replaceState(){},pushState(){},go(){},back(){}},CustomEvent:function(){return this},addEventListener(){},removeEventListener(){},getComputedStyle(){return{getPropertyValue(){return""}}},Image(){},Date(){},screen:{},setTimeout(){},clearTimeout(){},matchMedia(){return{}},requestAnimationFrame(t){return typeof setTimeout>"u"?(t(),null):setTimeout(t,0)},cancelAnimationFrame(t){typeof setTimeout>"u"||clearTimeout(t)}};function Vu(){const t=typeof window<"u"?window:{};return Lte(t,a$t),t}function l$t(t){const e=t;Object.keys(e).forEach(r=>{try{e[r]=null}catch{}try{delete e[r]}catch{}})}function _Y(t,e){return e===void 0&&(e=0),setTimeout(t,e)}function A6(){return Date.now()}function c$t(t){const e=Vu();let r;return e.getComputedStyle&&(r=e.getComputedStyle(t,null)),!r&&t.currentStyle&&(r=t.currentStyle),r||(r=t.style),r}function u$t(t,e){e===void 0&&(e="x");const r=Vu();let i,s,n;const o=c$t(t);return r.WebKitCSSMatrix?(s=o.transform||o.webkitTransform,s.split(",").length>6&&(s=s.split(", ").map(a=>a.replace(",",".")).join(", ")),n=new r.WebKitCSSMatrix(s==="none"?"":s)):(n=o.MozTransform||o.OTransform||o.MsTransform||o.msTransform||o.transform||o.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,"),i=n.toString().split(",")),e==="x"&&(r.WebKitCSSMatrix?s=n.m41:i.length===16?s=parseFloat(i[12]):s=parseFloat(i[4])),e==="y"&&(r.WebKitCSSMatrix?s=n.m42:i.length===16?s=parseFloat(i[13]):s=parseFloat(i[5])),s||0}function CD(t){return typeof t=="object"&&t!==null&&t.constructor&&Object.prototype.toString.call(t).slice(8,-1)==="Object"}function h$t(t){return typeof window<"u"&&typeof window.HTMLElement<"u"?t instanceof HTMLElement:t&&(t.nodeType===1||t.nodeType===11)}function mu(){const t=Object(arguments.length<=0?void 0:arguments[0]),e=["__proto__","constructor","prototype"];for(let r=1;r<arguments.length;r+=1){const i=r<0||arguments.length<=r?void 0:arguments[r];if(i!=null&&!h$t(i)){const s=Object.keys(Object(i)).filter(n=>e.indexOf(n)<0);for(let n=0,o=s.length;n<o;n+=1){const a=s[n],l=Object.getOwnPropertyDescriptor(i,a);l!==void 0&&l.enumerable&&(CD(t[a])&&CD(i[a])?i[a].__swiper__?t[a]=i[a]:mu(t[a],i[a]):!CD(t[a])&&CD(i[a])?(t[a]={},i[a].__swiper__?t[a]=i[a]:mu(t[a],i[a])):t[a]=i[a])}}}return t}function AD(t,e,r){t.style.setProperty(e,r)}function jLe(t){let{swiper:e,targetPosition:r,side:i}=t;const s=Vu(),n=-e.translate;let o=null,a;const l=e.params.speed;e.wrapperEl.style.scrollSnapType="none",s.cancelAnimationFrame(e.cssModeFrameID);const c=r>n?"next":"prev",h=(f,m)=>c==="next"&&f>=m||c==="prev"&&f<=m,d=()=>{a=new Date().getTime(),o===null&&(o=a);const f=Math.max(Math.min((a-o)/l,1),0),m=.5-Math.cos(f*Math.PI)/2;let g=n+m*(r-n);if(h(g,r)&&(g=r),e.wrapperEl.scrollTo({[i]:g}),h(g,r)){e.wrapperEl.style.overflow="hidden",e.wrapperEl.style.scrollSnapType="",setTimeout(()=>{e.wrapperEl.style.overflow="",e.wrapperEl.scrollTo({[i]:g})}),s.cancelAnimationFrame(e.cssModeFrameID);return}e.cssModeFrameID=s.requestAnimationFrame(d)};d()}function Jf(t,e){return e===void 0&&(e=""),[...t.children].filter(r=>r.matches(e))}function HLe(t,e){e===void 0&&(e=[]);const r=document.createElement(t);return r.classList.add(...Array.isArray(e)?e:[e]),r}function d$t(t,e){const r=[];for(;t.previousElementSibling;){const i=t.previousElementSibling;e?i.matches(e)&&r.push(i):r.push(i),t=i}return r}function p$t(t,e){const r=[];for(;t.nextElementSibling;){const i=t.nextElementSibling;e?i.matches(e)&&r.push(i):r.push(i),t=i}return r}function Y_(t,e){return Vu().getComputedStyle(t,null).getPropertyValue(e)}function ige(t){let e=t,r;if(e){for(r=0;(e=e.previousSibling)!==null;)e.nodeType===1&&(r+=1);return r}}function f$t(t,e){const r=[];let i=t.parentElement;for(;i;)e?i.matches(e)&&r.push(i):r.push(i),i=i.parentElement;return r}function sge(t,e,r){const i=Vu();return r?t[e==="width"?"offsetWidth":"offsetHeight"]+parseFloat(i.getComputedStyle(t,null).getPropertyValue(e==="width"?"margin-right":"margin-top"))+parseFloat(i.getComputedStyle(t,null).getPropertyValue(e==="width"?"margin-left":"margin-bottom")):t.offsetWidth}let $7;function m$t(){const t=Vu(),e=Gx();return{smoothScroll:e.documentElement&&e.documentElement.style&&"scrollBehavior"in e.documentElement.style,touch:!!("ontouchstart"in t||t.DocumentTouch&&e instanceof t.DocumentTouch)}}function qLe(){return $7||($7=m$t()),$7}let L7;function g$t(t){let{userAgent:e}=t===void 0?{}:t;const r=qLe(),i=Vu(),s=i.navigator.platform,n=e||i.navigator.userAgent,o={ios:!1,android:!1},a=i.screen.width,l=i.screen.height,c=n.match(/(Android);?[\s\/]+([\d.]+)?/);let h=n.match(/(iPad).*OS\s([\d_]+)/);const d=n.match(/(iPod)(.*OS\s([\d_]+))?/),f=!h&&n.match(/(iPhone\sOS|iOS)\s([\d_]+)/),m=s==="Win32";let g=s==="MacIntel";const _=["1024x1366","1366x1024","834x1194","1194x834","834x1112","1112x834","768x1024","1024x768","820x1180","1180x820","810x1080","1080x810"];return!h&&g&&r.touch&&_.indexOf(`${a}x${l}`)>=0&&(h=n.match(/(Version)\/([\d.]+)/),h||(h=[0,1,"13_0_0"]),g=!1),c&&!m&&(o.os="android",o.android=!0),(h||f||d)&&(o.os="ios",o.ios=!0),o}function y$t(t){return t===void 0&&(t={}),L7||(L7=g$t(t)),L7}let D7;function _$t(){const t=Vu();let e=!1;function r(){const i=t.navigator.userAgent.toLowerCase();return i.indexOf("safari")>=0&&i.indexOf("chrome")<0&&i.indexOf("android")<0}if(r()){const i=String(t.navigator.userAgent);if(i.includes("Version/")){const[s,n]=i.split("Version/")[1].split(" ")[0].split(".").map(o=>Number(o));e=s<16||s===16&&n<2}}return{isSafari:e||r(),needPerspectiveFix:e,isWebView:/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(t.navigator.userAgent)}}function v$t(){return D7||(D7=_$t()),D7}function b$t(t){let{swiper:e,on:r,emit:i}=t;const s=Vu();let n=null,o=null;const a=()=>{!e||e.destroyed||!e.initialized||(i("beforeResize"),i("resize"))},l=()=>{!e||e.destroyed||!e.initialized||(n=new ResizeObserver(d=>{o=s.requestAnimationFrame(()=>{const{width:f,height:m}=e;let g=f,_=m;d.forEach(v=>{let{contentBoxSize:b,contentRect:T,target:x}=v;x&&x!==e.el||(g=T?T.width:(b[0]||b).inlineSize,_=T?T.height:(b[0]||b).blockSize)}),(g!==f||_!==m)&&a()})}),n.observe(e.el))},c=()=>{o&&s.cancelAnimationFrame(o),n&&n.unobserve&&e.el&&(n.unobserve(e.el),n=null)},h=()=>{!e||e.destroyed||!e.initialized||i("orientationchange")};r("init",()=>{if(e.params.resizeObserver&&typeof s.ResizeObserver<"u"){l();return}s.addEventListener("resize",a),s.addEventListener("orientationchange",h)}),r("destroy",()=>{c(),s.removeEventListener("resize",a),s.removeEventListener("orientationchange",h)})}function w$t(t){let{swiper:e,extendParams:r,on:i,emit:s}=t;const n=[],o=Vu(),a=function(h,d){d===void 0&&(d={});const f=o.MutationObserver||o.WebkitMutationObserver,m=new f(g=>{if(e.__preventObserver__)return;if(g.length===1){s("observerUpdate",g[0]);return}const _=function(){s("observerUpdate",g[0])};o.requestAnimationFrame?o.requestAnimationFrame(_):o.setTimeout(_,0)});m.observe(h,{attributes:typeof d.attributes>"u"?!0:d.attributes,childList:typeof d.childList>"u"?!0:d.childList,characterData:typeof d.characterData>"u"?!0:d.characterData}),n.push(m)},l=()=>{if(e.params.observer){if(e.params.observeParents){const h=f$t(e.el);for(let d=0;d<h.length;d+=1)a(h[d])}a(e.el,{childList:e.params.observeSlideChildren}),a(e.wrapperEl,{attributes:!1})}},c=()=>{n.forEach(h=>{h.disconnect()}),n.splice(0,n.length)};r({observer:!1,observeParents:!1,observeSlideChildren:!1}),i("init",l),i("destroy",c)}var x$t={on(t,e,r){const i=this;if(!i.eventsListeners||i.destroyed||typeof e!="function")return i;const s=r?"unshift":"push";return t.split(" ").forEach(n=>{i.eventsListeners[n]||(i.eventsListeners[n]=[]),i.eventsListeners[n][s](e)}),i},once(t,e,r){const i=this;if(!i.eventsListeners||i.destroyed||typeof e!="function")return i;function s(){i.off(t,s),s.__emitterProxy&&delete s.__emitterProxy;for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];e.apply(i,o)}return s.__emitterProxy=e,i.on(t,s,r)},onAny(t,e){const r=this;if(!r.eventsListeners||r.destroyed||typeof t!="function")return r;const i=e?"unshift":"push";return r.eventsAnyListeners.indexOf(t)<0&&r.eventsAnyListeners[i](t),r},offAny(t){const e=this;if(!e.eventsListeners||e.destroyed||!e.eventsAnyListeners)return e;const r=e.eventsAnyListeners.indexOf(t);return r>=0&&e.eventsAnyListeners.splice(r,1),e},off(t,e){const r=this;return!r.eventsListeners||r.destroyed||!r.eventsListeners||t.split(" ").forEach(i=>{typeof e>"u"?r.eventsListeners[i]=[]:r.eventsListeners[i]&&r.eventsListeners[i].forEach((s,n)=>{(s===e||s.__emitterProxy&&s.__emitterProxy===e)&&r.eventsListeners[i].splice(n,1)})}),r},emit(){const t=this;if(!t.eventsListeners||t.destroyed||!t.eventsListeners)return t;let e,r,i;for(var s=arguments.length,n=new Array(s),o=0;o<s;o++)n[o]=arguments[o];return typeof n[0]=="string"||Array.isArray(n[0])?(e=n[0],r=n.slice(1,n.length),i=t):(e=n[0].events,r=n[0].data,i=n[0].context||t),r.unshift(i),(Array.isArray(e)?e:e.split(" ")).forEach(l=>{t.eventsAnyListeners&&t.eventsAnyListeners.length&&t.eventsAnyListeners.forEach(c=>{c.apply(i,[l,...r])}),t.eventsListeners&&t.eventsListeners[l]&&t.eventsListeners[l].forEach(c=>{c.apply(i,r)})}),t}};function T$t(){const t=this;let e,r;const i=t.el;typeof t.params.width<"u"&&t.params.width!==null?e=t.params.width:e=i.clientWidth,typeof t.params.height<"u"&&t.params.height!==null?r=t.params.height:r=i.clientHeight,!(e===0&&t.isHorizontal()||r===0&&t.isVertical())&&(e=e-parseInt(Y_(i,"padding-left")||0,10)-parseInt(Y_(i,"padding-right")||0,10),r=r-parseInt(Y_(i,"padding-top")||0,10)-parseInt(Y_(i,"padding-bottom")||0,10),Number.isNaN(e)&&(e=0),Number.isNaN(r)&&(r=0),Object.assign(t,{width:e,height:r,size:t.isHorizontal()?e:r}))}function S$t(){const t=this;function e(L){return t.isHorizontal()?L:{width:"height","margin-top":"margin-left","margin-bottom ":"margin-right","margin-left":"margin-top","margin-right":"margin-bottom","padding-left":"padding-top","padding-right":"padding-bottom",marginRight:"marginBottom"}[L]}function r(L,N){return parseFloat(L.getPropertyValue(e(N))||0)}const i=t.params,{wrapperEl:s,slidesEl:n,size:o,rtlTranslate:a,wrongRTL:l}=t,c=t.virtual&&i.virtual.enabled,h=c?t.virtual.slides.length:t.slides.length,d=Jf(n,`.${t.params.slideClass}, swiper-slide`),f=c?t.virtual.slides.length:d.length;let m=[];const g=[],_=[];let v=i.slidesOffsetBefore;typeof v=="function"&&(v=i.slidesOffsetBefore.call(t));let b=i.slidesOffsetAfter;typeof b=="function"&&(b=i.slidesOffsetAfter.call(t));const T=t.snapGrid.length,x=t.slidesGrid.length;let S=i.spaceBetween,E=-v,A=0,R=0;if(typeof o>"u")return;typeof S=="string"&&S.indexOf("%")>=0?S=parseFloat(S.replace("%",""))/100*o:typeof S=="string"&&(S=parseFloat(S)),t.virtualSize=-S,d.forEach(L=>{a?L.style.marginLeft="":L.style.marginRight="",L.style.marginBottom="",L.style.marginTop=""}),i.centeredSlides&&i.cssMode&&(AD(s,"--swiper-centered-offset-before",""),AD(s,"--swiper-centered-offset-after",""));const M=i.grid&&i.grid.rows>1&&t.grid;M&&t.grid.initSlides(f);let D;const k=i.slidesPerView==="auto"&&i.breakpoints&&Object.keys(i.breakpoints).filter(L=>typeof i.breakpoints[L].slidesPerView<"u").length>0;for(let L=0;L<f;L+=1){D=0;let N;if(d[L]&&(N=d[L]),M&&t.grid.updateSlide(L,N,f,e),!(d[L]&&Y_(N,"display")==="none")){if(i.slidesPerView==="auto"){k&&(d[L].style[e("width")]="");const q=getComputedStyle(N),X=N.style.transform,G=N.style.webkitTransform;if(X&&(N.style.transform="none"),G&&(N.style.webkitTransform="none"),i.roundLengths)D=t.isHorizontal()?sge(N,"width",!0):sge(N,"height",!0);else{const J=r(q,"width"),I=r(q,"padding-left"),z=r(q,"padding-right"),V=r(q,"margin-left"),j=r(q,"margin-right"),Y=q.getPropertyValue("box-sizing");if(Y&&Y==="border-box")D=J+V+j;else{const{clientWidth:Q,offsetWidth:te}=N;D=J+I+z+V+j+(te-Q)}}X&&(N.style.transform=X),G&&(N.style.webkitTransform=G),i.roundLengths&&(D=Math.floor(D))}else D=(o-(i.slidesPerView-1)*S)/i.slidesPerView,i.roundLengths&&(D=Math.floor(D)),d[L]&&(d[L].style[e("width")]=`${D}px`);d[L]&&(d[L].swiperSlideSize=D),_.push(D),i.centeredSlides?(E=E+D/2+A/2+S,A===0&&L!==0&&(E=E-o/2-S),L===0&&(E=E-o/2-S),Math.abs(E)<1/1e3&&(E=0),i.roundLengths&&(E=Math.floor(E)),R%i.slidesPerGroup===0&&m.push(E),g.push(E)):(i.roundLengths&&(E=Math.floor(E)),(R-Math.min(t.params.slidesPerGroupSkip,R))%t.params.slidesPerGroup===0&&m.push(E),g.push(E),E=E+D+S),t.virtualSize+=D+S,A=D,R+=1}}if(t.virtualSize=Math.max(t.virtualSize,o)+b,a&&l&&(i.effect==="slide"||i.effect==="coverflow")&&(s.style.width=`${t.virtualSize+S}px`),i.setWrapperSize&&(s.style[e("width")]=`${t.virtualSize+S}px`),M&&t.grid.updateWrapperSize(D,m,e),!i.centeredSlides){const L=[];for(let N=0;N<m.length;N+=1){let q=m[N];i.roundLengths&&(q=Math.floor(q)),m[N]<=t.virtualSize-o&&L.push(q)}m=L,Math.floor(t.virtualSize-o)-Math.floor(m[m.length-1])>1&&m.push(t.virtualSize-o)}if(c&&i.loop){const L=_[0]+S;if(i.slidesPerGroup>1){const N=Math.ceil((t.virtual.slidesBefore+t.virtual.slidesAfter)/i.slidesPerGroup),q=L*i.slidesPerGroup;for(let X=0;X<N;X+=1)m.push(m[m.length-1]+q)}for(let N=0;N<t.virtual.slidesBefore+t.virtual.slidesAfter;N+=1)i.slidesPerGroup===1&&m.push(m[m.length-1]+L),g.push(g[g.length-1]+L),t.virtualSize+=L}if(m.length===0&&(m=[0]),S!==0){const L=t.isHorizontal()&&a?"marginLeft":e("marginRight");d.filter((N,q)=>!i.cssMode||i.loop?!0:q!==d.length-1).forEach(N=>{N.style[L]=`${S}px`})}if(i.centeredSlides&&i.centeredSlidesBounds){let L=0;_.forEach(q=>{L+=q+(S||0)}),L-=S;const N=L-o;m=m.map(q=>q<=0?-v:q>N?N+b:q)}if(i.centerInsufficientSlides){let L=0;if(_.forEach(N=>{L+=N+(S||0)}),L-=S,L<o){const N=(o-L)/2;m.forEach((q,X)=>{m[X]=q-N}),g.forEach((q,X)=>{g[X]=q+N})}}if(Object.assign(t,{slides:d,snapGrid:m,slidesGrid:g,slidesSizesGrid:_}),i.centeredSlides&&i.cssMode&&!i.centeredSlidesBounds){AD(s,"--swiper-centered-offset-before",`${-m[0]}px`),AD(s,"--swiper-centered-offset-after",`${t.size/2-_[_.length-1]/2}px`);const L=-t.snapGrid[0],N=-t.slidesGrid[0];t.snapGrid=t.snapGrid.map(q=>q+L),t.slidesGrid=t.slidesGrid.map(q=>q+N)}if(f!==h&&t.emit("slidesLengthChange"),m.length!==T&&(t.params.watchOverflow&&t.checkOverflow(),t.emit("snapGridLengthChange")),g.length!==x&&t.emit("slidesGridLengthChange"),i.watchSlidesProgress&&t.updateSlidesOffset(),!c&&!i.cssMode&&(i.effect==="slide"||i.effect==="fade")){const L=`${i.containerModifierClass}backface-hidden`,N=t.el.classList.contains(L);f<=i.maxBackfaceHiddenSlides?N||t.el.classList.add(L):N&&t.el.classList.remove(L)}}function E$t(t){const e=this,r=[],i=e.virtual&&e.params.virtual.enabled;let s=0,n;typeof t=="number"?e.setTransition(t):t===!0&&e.setTransition(e.params.speed);const o=a=>i?e.slides[e.getSlideIndexByData(a)]:e.slides[a];if(e.params.slidesPerView!=="auto"&&e.params.slidesPerView>1)if(e.params.centeredSlides)(e.visibleSlides||[]).forEach(a=>{r.push(a)});else for(n=0;n<Math.ceil(e.params.slidesPerView);n+=1){const a=e.activeIndex+n;if(a>e.slides.length&&!i)break;r.push(o(a))}else r.push(o(e.activeIndex));for(n=0;n<r.length;n+=1)if(typeof r[n]<"u"){const a=r[n].offsetHeight;s=a>s?a:s}(s||s===0)&&(e.wrapperEl.style.height=`${s}px`)}function C$t(){const t=this,e=t.slides,r=t.isElement?t.isHorizontal()?t.wrapperEl.offsetLeft:t.wrapperEl.offsetTop:0;for(let i=0;i<e.length;i+=1)e[i].swiperSlideOffset=(t.isHorizontal()?e[i].offsetLeft:e[i].offsetTop)-r-t.cssOverflowAdjustment()}function A$t(t){t===void 0&&(t=this&&this.translate||0);const e=this,r=e.params,{slides:i,rtlTranslate:s,snapGrid:n}=e;if(i.length===0)return;typeof i[0].swiperSlideOffset>"u"&&e.updateSlidesOffset();let o=-t;s&&(o=t),i.forEach(l=>{l.classList.remove(r.slideVisibleClass)}),e.visibleSlidesIndexes=[],e.visibleSlides=[];let a=r.spaceBetween;typeof a=="string"&&a.indexOf("%")>=0?a=parseFloat(a.replace("%",""))/100*e.size:typeof a=="string"&&(a=parseFloat(a));for(let l=0;l<i.length;l+=1){const c=i[l];let h=c.swiperSlideOffset;r.cssMode&&r.centeredSlides&&(h-=i[0].swiperSlideOffset);const d=(o+(r.centeredSlides?e.minTranslate():0)-h)/(c.swiperSlideSize+a),f=(o-n[0]+(r.centeredSlides?e.minTranslate():0)-h)/(c.swiperSlideSize+a),m=-(o-h),g=m+e.slidesSizesGrid[l];(m>=0&&m<e.size-1||g>1&&g<=e.size||m<=0&&g>=e.size)&&(e.visibleSlides.push(c),e.visibleSlidesIndexes.push(l),i[l].classList.add(r.slideVisibleClass)),c.progress=s?-d:d,c.originalProgress=s?-f:f}}function O$t(t){const e=this;if(typeof t>"u"){const h=e.rtlTranslate?-1:1;t=e&&e.translate&&e.translate*h||0}const r=e.params,i=e.maxTranslate()-e.minTranslate();let{progress:s,isBeginning:n,isEnd:o,progressLoop:a}=e;const l=n,c=o;if(i===0)s=0,n=!0,o=!0;else{s=(t-e.minTranslate())/i;const h=Math.abs(t-e.minTranslate())<1,d=Math.abs(t-e.maxTranslate())<1;n=h||s<=0,o=d||s>=1,h&&(s=0),d&&(s=1)}if(r.loop){const h=e.getSlideIndexByData(0),d=e.getSlideIndexByData(e.slides.length-1),f=e.slidesGrid[h],m=e.slidesGrid[d],g=e.slidesGrid[e.slidesGrid.length-1],_=Math.abs(t);_>=f?a=(_-f)/g:a=(_+g-m)/g,a>1&&(a-=1)}Object.assign(e,{progress:s,progressLoop:a,isBeginning:n,isEnd:o}),(r.watchSlidesProgress||r.centeredSlides&&r.autoHeight)&&e.updateSlidesProgress(t),n&&!l&&e.emit("reachBeginning toEdge"),o&&!c&&e.emit("reachEnd toEdge"),(l&&!n||c&&!o)&&e.emit("fromEdge"),e.emit("progress",s)}function R$t(){const t=this,{slides:e,params:r,slidesEl:i,activeIndex:s}=t,n=t.virtual&&r.virtual.enabled,o=l=>Jf(i,`.${r.slideClass}${l}, swiper-slide${l}`)[0];e.forEach(l=>{l.classList.remove(r.slideActiveClass,r.slideNextClass,r.slidePrevClass)});let a;if(n)if(r.loop){let l=s-t.virtual.slidesBefore;l<0&&(l=t.virtual.slides.length+l),l>=t.virtual.slides.length&&(l-=t.virtual.slides.length),a=o(`[data-swiper-slide-index="${l}"]`)}else a=o(`[data-swiper-slide-index="${s}"]`);else a=e[s];if(a){a.classList.add(r.slideActiveClass);let l=p$t(a,`.${r.slideClass}, swiper-slide`)[0];r.loop&&!l&&(l=e[0]),l&&l.classList.add(r.slideNextClass);let c=d$t(a,`.${r.slideClass}, swiper-slide`)[0];r.loop&&!c===0&&(c=e[e.length-1]),c&&c.classList.add(r.slidePrevClass)}t.emitSlidesClasses()}const I4=(t,e)=>{if(!t||t.destroyed||!t.params)return;const r=()=>t.isElement?"swiper-slide":`.${t.params.slideClass}`,i=e.closest(r());if(i){const s=i.querySelector(`.${t.params.lazyPreloaderClass}`);s&&s.remove()}},N7=(t,e)=>{if(!t.slides[e])return;const r=t.slides[e].querySelector('[loading="lazy"]');r&&r.removeAttribute("loading")},vY=t=>{if(!t||t.destroyed||!t.params)return;let e=t.params.lazyPreloadPrevNext;const r=t.slides.length;if(!r||!e||e<0)return;e=Math.min(e,r);const i=t.params.slidesPerView==="auto"?t.slidesPerViewDynamic():Math.ceil(t.params.slidesPerView),s=t.activeIndex;if(t.params.grid&&t.params.grid.rows>1){const o=s,a=[o-e];a.push(...Array.from({length:e}).map((l,c)=>o+i+c)),t.slides.forEach((l,c)=>{a.includes(l.column)&&N7(t,c)});return}const n=s+i-1;if(t.params.rewind||t.params.loop)for(let o=s-e;o<=n+e;o+=1){const a=(o%r+r)%r;(a<s||a>n)&&N7(t,a)}else for(let o=Math.max(s-e,0);o<=Math.min(n+e,r-1);o+=1)o!==s&&(o>n||o<s)&&N7(t,o)};function M$t(t){const{slidesGrid:e,params:r}=t,i=t.rtlTranslate?t.translate:-t.translate;let s;for(let n=0;n<e.length;n+=1)typeof e[n+1]<"u"?i>=e[n]&&i<e[n+1]-(e[n+1]-e[n])/2?s=n:i>=e[n]&&i<e[n+1]&&(s=n+1):i>=e[n]&&(s=n);return r.normalizeSlideIndex&&(s<0||typeof s>"u")&&(s=0),s}function P$t(t){const e=this,r=e.rtlTranslate?e.translate:-e.translate,{snapGrid:i,params:s,activeIndex:n,realIndex:o,snapIndex:a}=e;let l=t,c;const h=f=>{let m=f-e.virtual.slidesBefore;return m<0&&(m=e.virtual.slides.length+m),m>=e.virtual.slides.length&&(m-=e.virtual.slides.length),m};if(typeof l>"u"&&(l=M$t(e)),i.indexOf(r)>=0)c=i.indexOf(r);else{const f=Math.min(s.slidesPerGroupSkip,l);c=f+Math.floor((l-f)/s.slidesPerGroup)}if(c>=i.length&&(c=i.length-1),l===n){c!==a&&(e.snapIndex=c,e.emit("snapIndexChange")),e.params.loop&&e.virtual&&e.params.virtual.enabled&&(e.realIndex=h(l));return}let d;e.virtual&&s.virtual.enabled&&s.loop?d=h(l):e.slides[l]?d=parseInt(e.slides[l].getAttribute("data-swiper-slide-index")||l,10):d=l,Object.assign(e,{previousSnapIndex:a,snapIndex:c,previousRealIndex:o,realIndex:d,previousIndex:n,activeIndex:l}),e.initialized&&vY(e),e.emit("activeIndexChange"),e.emit("snapIndexChange"),o!==d&&e.emit("realIndexChange"),(e.initialized||e.params.runCallbacksOnInit)&&e.emit("slideChange")}function I$t(t){const e=this,r=e.params,i=t.closest(`.${r.slideClass}, swiper-slide`);let s=!1,n;if(i){for(let o=0;o<e.slides.length;o+=1)if(e.slides[o]===i){s=!0,n=o;break}}if(i&&s)e.clickedSlide=i,e.virtual&&e.params.virtual.enabled?e.clickedIndex=parseInt(i.getAttribute("data-swiper-slide-index"),10):e.clickedIndex=n;else{e.clickedSlide=void 0,e.clickedIndex=void 0;return}r.slideToClickedSlide&&e.clickedIndex!==void 0&&e.clickedIndex!==e.activeIndex&&e.slideToClickedSlide()}var $$t={updateSize:T$t,updateSlides:S$t,updateAutoHeight:E$t,updateSlidesOffset:C$t,updateSlidesProgress:A$t,updateProgress:O$t,updateSlidesClasses:R$t,updateActiveIndex:P$t,updateClickedSlide:I$t};function L$t(t){t===void 0&&(t=this.isHorizontal()?"x":"y");const e=this,{params:r,rtlTranslate:i,translate:s,wrapperEl:n}=e;if(r.virtualTranslate)return i?-s:s;if(r.cssMode)return s;let o=u$t(n,t);return o+=e.cssOverflowAdjustment(),i&&(o=-o),o||0}function D$t(t,e){const r=this,{rtlTranslate:i,params:s,wrapperEl:n,progress:o}=r;let a=0,l=0;const c=0;r.isHorizontal()?a=i?-t:t:l=t,s.roundLengths&&(a=Math.floor(a),l=Math.floor(l)),r.previousTranslate=r.translate,r.translate=r.isHorizontal()?a:l,s.cssMode?n[r.isHorizontal()?"scrollLeft":"scrollTop"]=r.isHorizontal()?-a:-l:s.virtualTranslate||(r.isHorizontal()?a-=r.cssOverflowAdjustment():l-=r.cssOverflowAdjustment(),n.style.transform=`translate3d(${a}px, ${l}px, ${c}px)`);let h;const d=r.maxTranslate()-r.minTranslate();d===0?h=0:h=(t-r.minTranslate())/d,h!==o&&r.updateProgress(t),r.emit("setTranslate",r.translate,e)}function N$t(){return-this.snapGrid[0]}function F$t(){return-this.snapGrid[this.snapGrid.length-1]}function U$t(t,e,r,i,s){t===void 0&&(t=0),e===void 0&&(e=this.params.speed),r===void 0&&(r=!0),i===void 0&&(i=!0);const n=this,{params:o,wrapperEl:a}=n;if(n.animating&&o.preventInteractionOnTransition)return!1;const l=n.minTranslate(),c=n.maxTranslate();let h;if(i&&t>l?h=l:i&&t<c?h=c:h=t,n.updateProgress(h),o.cssMode){const d=n.isHorizontal();if(e===0)a[d?"scrollLeft":"scrollTop"]=-h;else{if(!n.support.smoothScroll)return jLe({swiper:n,targetPosition:-h,side:d?"left":"top"}),!0;a.scrollTo({[d?"left":"top"]:-h,behavior:"smooth"})}return!0}return e===0?(n.setTransition(0),n.setTranslate(h),r&&(n.emit("beforeTransitionStart",e,s),n.emit("transitionEnd"))):(n.setTransition(e),n.setTranslate(h),r&&(n.emit("beforeTransitionStart",e,s),n.emit("transitionStart")),n.animating||(n.animating=!0,n.onTranslateToWrapperTransitionEnd||(n.onTranslateToWrapperTransitionEnd=function(f){!n||n.destroyed||f.target===this&&(n.wrapperEl.removeEventListener("transitionend",n.onTranslateToWrapperTransitionEnd),n.onTranslateToWrapperTransitionEnd=null,delete n.onTranslateToWrapperTransitionEnd,r&&n.emit("transitionEnd"))}),n.wrapperEl.addEventListener("transitionend",n.onTranslateToWrapperTransitionEnd))),!0}var k$t={getTranslate:L$t,setTranslate:D$t,minTranslate:N$t,maxTranslate:F$t,translateTo:U$t};function z$t(t,e){const r=this;r.params.cssMode||(r.wrapperEl.style.transitionDuration=`${t}ms`),r.emit("setTransition",t,e)}function WLe(t){let{swiper:e,runCallbacks:r,direction:i,step:s}=t;const{activeIndex:n,previousIndex:o}=e;let a=i;if(a||(n>o?a="next":n<o?a="prev":a="reset"),e.emit(`transition${s}`),r&&n!==o){if(a==="reset"){e.emit(`slideResetTransition${s}`);return}e.emit(`slideChangeTransition${s}`),a==="next"?e.emit(`slideNextTransition${s}`):e.emit(`slidePrevTransition${s}`)}}function V$t(t,e){t===void 0&&(t=!0);const r=this,{params:i}=r;i.cssMode||(i.autoHeight&&r.updateAutoHeight(),WLe({swiper:r,runCallbacks:t,direction:e,step:"Start"}))}function B$t(t,e){t===void 0&&(t=!0);const r=this,{params:i}=r;r.animating=!1,!i.cssMode&&(r.setTransition(0),WLe({swiper:r,runCallbacks:t,direction:e,step:"End"}))}var G$t={setTransition:z$t,transitionStart:V$t,transitionEnd:B$t};function j$t(t,e,r,i,s){t===void 0&&(t=0),e===void 0&&(e=this.params.speed),r===void 0&&(r=!0),typeof t=="string"&&(t=parseInt(t,10));const n=this;let o=t;o<0&&(o=0);const{params:a,snapGrid:l,slidesGrid:c,previousIndex:h,activeIndex:d,rtlTranslate:f,wrapperEl:m,enabled:g}=n;if(n.animating&&a.preventInteractionOnTransition||!g&&!i&&!s)return!1;const _=Math.min(n.params.slidesPerGroupSkip,o);let v=_+Math.floor((o-_)/n.params.slidesPerGroup);v>=l.length&&(v=l.length-1);const b=-l[v];if(a.normalizeSlideIndex)for(let x=0;x<c.length;x+=1){const S=-Math.floor(b*100),E=Math.floor(c[x]*100),A=Math.floor(c[x+1]*100);typeof c[x+1]<"u"?S>=E&&S<A-(A-E)/2?o=x:S>=E&&S<A&&(o=x+1):S>=E&&(o=x)}if(n.initialized&&o!==d&&(!n.allowSlideNext&&(f?b>n.translate&&b>n.minTranslate():b<n.translate&&b<n.minTranslate())||!n.allowSlidePrev&&b>n.translate&&b>n.maxTranslate()&&(d||0)!==o))return!1;o!==(h||0)&&r&&n.emit("beforeSlideChangeStart"),n.updateProgress(b);let T;if(o>d?T="next":o<d?T="prev":T="reset",f&&-b===n.translate||!f&&b===n.translate)return n.updateActiveIndex(o),a.autoHeight&&n.updateAutoHeight(),n.updateSlidesClasses(),a.effect!=="slide"&&n.setTranslate(b),T!=="reset"&&(n.transitionStart(r,T),n.transitionEnd(r,T)),!1;if(a.cssMode){const x=n.isHorizontal(),S=f?b:-b;if(e===0){const E=n.virtual&&n.params.virtual.enabled;E&&(n.wrapperEl.style.scrollSnapType="none",n._immediateVirtual=!0),E&&!n._cssModeVirtualInitialSet&&n.params.initialSlide>0?(n._cssModeVirtualInitialSet=!0,requestAnimationFrame(()=>{m[x?"scrollLeft":"scrollTop"]=S})):m[x?"scrollLeft":"scrollTop"]=S,E&&requestAnimationFrame(()=>{n.wrapperEl.style.scrollSnapType="",n._immediateVirtual=!1})}else{if(!n.support.smoothScroll)return jLe({swiper:n,targetPosition:S,side:x?"left":"top"}),!0;m.scrollTo({[x?"left":"top"]:S,behavior:"smooth"})}return!0}return n.setTransition(e),n.setTranslate(b),n.updateActiveIndex(o),n.updateSlidesClasses(),n.emit("beforeTransitionStart",e,i),n.transitionStart(r,T),e===0?n.transitionEnd(r,T):n.animating||(n.animating=!0,n.onSlideToWrapperTransitionEnd||(n.onSlideToWrapperTransitionEnd=function(S){!n||n.destroyed||S.target===this&&(n.wrapperEl.removeEventListener("transitionend",n.onSlideToWrapperTransitionEnd),n.onSlideToWrapperTransitionEnd=null,delete n.onSlideToWrapperTransitionEnd,n.transitionEnd(r,T))}),n.wrapperEl.addEventListener("transitionend",n.onSlideToWrapperTransitionEnd)),!0}function H$t(t,e,r,i){t===void 0&&(t=0),e===void 0&&(e=this.params.speed),r===void 0&&(r=!0),typeof t=="string"&&(t=parseInt(t,10));const s=this;let n=t;return s.params.loop&&(s.virtual&&s.params.virtual.enabled?n=n+s.virtual.slidesBefore:n=s.getSlideIndexByData(n)),s.slideTo(n,e,r,i)}function q$t(t,e,r){t===void 0&&(t=this.params.speed),e===void 0&&(e=!0);const i=this,{enabled:s,params:n,animating:o}=i;if(!s)return i;let a=n.slidesPerGroup;n.slidesPerView==="auto"&&n.slidesPerGroup===1&&n.slidesPerGroupAuto&&(a=Math.max(i.slidesPerViewDynamic("current",!0),1));const l=i.activeIndex<n.slidesPerGroupSkip?1:a,c=i.virtual&&n.virtual.enabled;if(n.loop){if(o&&!c&&n.loopPreventsSliding)return!1;i.loopFix({direction:"next"}),i._clientLeft=i.wrapperEl.clientLeft}return n.rewind&&i.isEnd?i.slideTo(0,t,e,r):i.slideTo(i.activeIndex+l,t,e,r)}function W$t(t,e,r){t===void 0&&(t=this.params.speed),e===void 0&&(e=!0);const i=this,{params:s,snapGrid:n,slidesGrid:o,rtlTranslate:a,enabled:l,animating:c}=i;if(!l)return i;const h=i.virtual&&s.virtual.enabled;if(s.loop){if(c&&!h&&s.loopPreventsSliding)return!1;i.loopFix({direction:"prev"}),i._clientLeft=i.wrapperEl.clientLeft}const d=a?i.translate:-i.translate;function f(b){return b<0?-Math.floor(Math.abs(b)):Math.floor(b)}const m=f(d),g=n.map(b=>f(b));let _=n[g.indexOf(m)-1];if(typeof _>"u"&&s.cssMode){let b;n.forEach((T,x)=>{m>=T&&(b=x)}),typeof b<"u"&&(_=n[b>0?b-1:b])}let v=0;if(typeof _<"u"&&(v=o.indexOf(_),v<0&&(v=i.activeIndex-1),s.slidesPerView==="auto"&&s.slidesPerGroup===1&&s.slidesPerGroupAuto&&(v=v-i.slidesPerViewDynamic("previous",!0)+1,v=Math.max(v,0))),s.rewind&&i.isBeginning){const b=i.params.virtual&&i.params.virtual.enabled&&i.virtual?i.virtual.slides.length-1:i.slides.length-1;return i.slideTo(b,t,e,r)}return i.slideTo(v,t,e,r)}function X$t(t,e,r){t===void 0&&(t=this.params.speed),e===void 0&&(e=!0);const i=this;return i.slideTo(i.activeIndex,t,e,r)}function Y$t(t,e,r,i){t===void 0&&(t=this.params.speed),e===void 0&&(e=!0),i===void 0&&(i=.5);const s=this;let n=s.activeIndex;const o=Math.min(s.params.slidesPerGroupSkip,n),a=o+Math.floor((n-o)/s.params.slidesPerGroup),l=s.rtlTranslate?s.translate:-s.translate;if(l>=s.snapGrid[a]){const c=s.snapGrid[a],h=s.snapGrid[a+1];l-c>(h-c)*i&&(n+=s.params.slidesPerGroup)}else{const c=s.snapGrid[a-1],h=s.snapGrid[a];l-c<=(h-c)*i&&(n-=s.params.slidesPerGroup)}return n=Math.max(n,0),n=Math.min(n,s.slidesGrid.length-1),s.slideTo(n,t,e,r)}function Z$t(){const t=this,{params:e,slidesEl:r}=t,i=e.slidesPerView==="auto"?t.slidesPerViewDynamic():e.slidesPerView;let s=t.clickedIndex,n;const o=t.isElement?"swiper-slide":`.${e.slideClass}`;if(e.loop){if(t.animating)return;n=parseInt(t.clickedSlide.getAttribute("data-swiper-slide-index"),10),e.centeredSlides?s<t.loopedSlides-i/2||s>t.slides.length-t.loopedSlides+i/2?(t.loopFix(),s=t.getSlideIndex(Jf(r,`${o}[data-swiper-slide-index="${n}"]`)[0]),_Y(()=>{t.slideTo(s)})):t.slideTo(s):s>t.slides.length-i?(t.loopFix(),s=t.getSlideIndex(Jf(r,`${o}[data-swiper-slide-index="${n}"]`)[0]),_Y(()=>{t.slideTo(s)})):t.slideTo(s)}else t.slideTo(s)}var J$t={slideTo:j$t,slideToLoop:H$t,slideNext:q$t,slidePrev:W$t,slideReset:X$t,slideToClosest:Y$t,slideToClickedSlide:Z$t};function Q$t(t){const e=this,{params:r,slidesEl:i}=e;if(!r.loop||e.virtual&&e.params.virtual.enabled)return;Jf(i,`.${r.slideClass}, swiper-slide`).forEach((n,o)=>{n.setAttribute("data-swiper-slide-index",o)}),e.loopFix({slideRealIndex:t,direction:r.centeredSlides?void 0:"next"})}function K$t(t){let{slideRealIndex:e,slideTo:r=!0,direction:i,setTranslate:s,activeSlideIndex:n,byController:o,byMousewheel:a}=t===void 0?{}:t;const l=this;if(!l.params.loop)return;l.emit("beforeLoopFix");const{slides:c,allowSlidePrev:h,allowSlideNext:d,slidesEl:f,params:m}=l;if(l.allowSlidePrev=!0,l.allowSlideNext=!0,l.virtual&&m.virtual.enabled){r&&(!m.centeredSlides&&l.snapIndex===0?l.slideTo(l.virtual.slides.length,0,!1,!0):m.centeredSlides&&l.snapIndex<m.slidesPerView?l.slideTo(l.virtual.slides.length+l.snapIndex,0,!1,!0):l.snapIndex===l.snapGrid.length-1&&l.slideTo(l.virtual.slidesBefore,0,!1,!0)),l.allowSlidePrev=h,l.allowSlideNext=d,l.emit("loopFix");return}const g=m.slidesPerView==="auto"?l.slidesPerViewDynamic():Math.ceil(parseFloat(m.slidesPerView,10));let _=m.loopedSlides||g;_%m.slidesPerGroup!==0&&(_+=m.slidesPerGroup-_%m.slidesPerGroup),l.loopedSlides=_;const v=[],b=[];let T=l.activeIndex;typeof n>"u"?n=l.getSlideIndex(l.slides.filter(R=>R.classList.contains(m.slideActiveClass))[0]):T=n;const x=i==="next"||!i,S=i==="prev"||!i;let E=0,A=0;if(n<_){E=Math.max(_-n,m.slidesPerGroup);for(let R=0;R<_-n;R+=1){const M=R-Math.floor(R/c.length)*c.length;v.push(c.length-M-1)}}else if(n>l.slides.length-_*2){A=Math.max(n-(l.slides.length-_*2),m.slidesPerGroup);for(let R=0;R<A;R+=1){const M=R-Math.floor(R/c.length)*c.length;b.push(M)}}if(S&&v.forEach(R=>{l.slides[R].swiperLoopMoveDOM=!0,f.prepend(l.slides[R]),l.slides[R].swiperLoopMoveDOM=!1}),x&&b.forEach(R=>{l.slides[R].swiperLoopMoveDOM=!0,f.append(l.slides[R]),l.slides[R].swiperLoopMoveDOM=!1}),l.recalcSlides(),m.slidesPerView==="auto"&&l.updateSlides(),m.watchSlidesProgress&&l.updateSlidesOffset(),r){if(v.length>0&&S)if(typeof e>"u"){const R=l.slidesGrid[T],D=l.slidesGrid[T+E]-R;a?l.setTranslate(l.translate-D):(l.slideTo(T+E,0,!1,!0),s&&(l.touches[l.isHorizontal()?"startX":"startY"]+=D))}else s&&l.slideToLoop(e,0,!1,!0);else if(b.length>0&&x)if(typeof e>"u"){const R=l.slidesGrid[T],D=l.slidesGrid[T-A]-R;a?l.setTranslate(l.translate-D):(l.slideTo(T-A,0,!1,!0),s&&(l.touches[l.isHorizontal()?"startX":"startY"]+=D))}else l.slideToLoop(e,0,!1,!0)}if(l.allowSlidePrev=h,l.allowSlideNext=d,l.controller&&l.controller.control&&!o){const R={slideRealIndex:e,slideTo:!1,direction:i,setTranslate:s,activeSlideIndex:n,byController:!0};Array.isArray(l.controller.control)?l.controller.control.forEach(M=>{!M.destroyed&&M.params.loop&&M.loopFix(R)}):l.controller.control instanceof l.constructor&&l.controller.control.params.loop&&l.controller.control.loopFix(R)}l.emit("loopFix")}function eLt(){const t=this,{params:e,slidesEl:r}=t;if(!e.loop||t.virtual&&t.params.virtual.enabled)return;t.recalcSlides();const i=[];t.slides.forEach(s=>{const n=typeof s.swiperSlideIndex>"u"?s.getAttribute("data-swiper-slide-index")*1:s.swiperSlideIndex;i[n]=s}),t.slides.forEach(s=>{s.removeAttribute("data-swiper-slide-index")}),i.forEach(s=>{r.append(s)}),t.recalcSlides(),t.slideTo(t.realIndex,0)}var tLt={loopCreate:Q$t,loopFix:K$t,loopDestroy:eLt};function rLt(t){const e=this;if(!e.params.simulateTouch||e.params.watchOverflow&&e.isLocked||e.params.cssMode)return;const r=e.params.touchEventsTarget==="container"?e.el:e.wrapperEl;e.isElement&&(e.__preventObserver__=!0),r.style.cursor="move",r.style.cursor=t?"grabbing":"grab",e.isElement&&requestAnimationFrame(()=>{e.__preventObserver__=!1})}function iLt(){const t=this;t.params.watchOverflow&&t.isLocked||t.params.cssMode||(t.isElement&&(t.__preventObserver__=!0),t[t.params.touchEventsTarget==="container"?"el":"wrapperEl"].style.cursor="",t.isElement&&requestAnimationFrame(()=>{t.__preventObserver__=!1}))}var sLt={setGrabCursor:rLt,unsetGrabCursor:iLt};function nLt(t,e){e===void 0&&(e=this);function r(i){if(!i||i===Gx()||i===Vu())return null;i.assignedSlot&&(i=i.assignedSlot);const s=i.closest(t);return!s&&!i.getRootNode?null:s||r(i.getRootNode().host)}return r(e)}function oLt(t){const e=this,r=Gx(),i=Vu(),s=e.touchEventsData;s.evCache.push(t);const{params:n,touches:o,enabled:a}=e;if(!a||!n.simulateTouch&&t.pointerType==="mouse"||e.animating&&n.preventInteractionOnTransition)return;!e.animating&&n.cssMode&&n.loop&&e.loopFix();let l=t;l.originalEvent&&(l=l.originalEvent);let c=l.target;if(n.touchEventsTarget==="wrapper"&&!e.wrapperEl.contains(c)||"which"in l&&l.which===3||"button"in l&&l.button>0||s.isTouched&&s.isMoved)return;const h=!!n.noSwipingClass&&n.noSwipingClass!=="",d=t.composedPath?t.composedPath():t.path;h&&l.target&&l.target.shadowRoot&&d&&(c=d[0]);const f=n.noSwipingSelector?n.noSwipingSelector:`.${n.noSwipingClass}`,m=!!(l.target&&l.target.shadowRoot);if(n.noSwiping&&(m?nLt(f,c):c.closest(f))){e.allowClick=!0;return}if(n.swipeHandler&&!c.closest(n.swipeHandler))return;o.currentX=l.pageX,o.currentY=l.pageY;const g=o.currentX,_=o.currentY,v=n.edgeSwipeDetection||n.iOSEdgeSwipeDetection,b=n.edgeSwipeThreshold||n.iOSEdgeSwipeThreshold;if(v&&(g<=b||g>=i.innerWidth-b))if(v==="prevent")t.preventDefault();else return;Object.assign(s,{isTouched:!0,isMoved:!1,allowTouchCallbacks:!0,isScrolling:void 0,startMoving:void 0}),o.startX=g,o.startY=_,s.touchStartTime=A6(),e.allowClick=!0,e.updateSize(),e.swipeDirection=void 0,n.threshold>0&&(s.allowThresholdMove=!1);let T=!0;c.matches(s.focusableElements)&&(T=!1,c.nodeName==="SELECT"&&(s.isTouched=!1)),r.activeElement&&r.activeElement.matches(s.focusableElements)&&r.activeElement!==c&&r.activeElement.blur();const x=T&&e.allowTouchMove&&n.touchStartPreventDefault;(n.touchStartForcePreventDefault||x)&&!c.isContentEditable&&l.preventDefault(),n.freeMode&&n.freeMode.enabled&&e.freeMode&&e.animating&&!n.cssMode&&e.freeMode.onTouchStart(),e.emit("touchStart",l)}function aLt(t){const e=Gx(),r=this,i=r.touchEventsData,{params:s,touches:n,rtlTranslate:o,enabled:a}=r;if(!a||!s.simulateTouch&&t.pointerType==="mouse")return;let l=t;if(l.originalEvent&&(l=l.originalEvent),!i.isTouched){i.startMoving&&i.isScrolling&&r.emit("touchMoveOpposite",l);return}const c=i.evCache.findIndex(A=>A.pointerId===l.pointerId);c>=0&&(i.evCache[c]=l);const h=i.evCache.length>1?i.evCache[0]:l,d=h.pageX,f=h.pageY;if(l.preventedByNestedSwiper){n.startX=d,n.startY=f;return}if(!r.allowTouchMove){l.target.matches(i.focusableElements)||(r.allowClick=!1),i.isTouched&&(Object.assign(n,{startX:d,startY:f,prevX:r.touches.currentX,prevY:r.touches.currentY,currentX:d,currentY:f}),i.touchStartTime=A6());return}if(s.touchReleaseOnEdges&&!s.loop){if(r.isVertical()){if(f<n.startY&&r.translate<=r.maxTranslate()||f>n.startY&&r.translate>=r.minTranslate()){i.isTouched=!1,i.isMoved=!1;return}}else if(d<n.startX&&r.translate<=r.maxTranslate()||d>n.startX&&r.translate>=r.minTranslate())return}if(e.activeElement&&l.target===e.activeElement&&l.target.matches(i.focusableElements)){i.isMoved=!0,r.allowClick=!1;return}if(i.allowTouchCallbacks&&r.emit("touchMove",l),l.targetTouches&&l.targetTouches.length>1)return;n.currentX=d,n.currentY=f;const m=n.currentX-n.startX,g=n.currentY-n.startY;if(r.params.threshold&&Math.sqrt(m**2+g**2)<r.params.threshold)return;if(typeof i.isScrolling>"u"){let A;r.isHorizontal()&&n.currentY===n.startY||r.isVertical()&&n.currentX===n.startX?i.isScrolling=!1:m*m+g*g>=25&&(A=Math.atan2(Math.abs(g),Math.abs(m))*180/Math.PI,i.isScrolling=r.isHorizontal()?A>s.touchAngle:90-A>s.touchAngle)}if(i.isScrolling&&r.emit("touchMoveOpposite",l),typeof i.startMoving>"u"&&(n.currentX!==n.startX||n.currentY!==n.startY)&&(i.startMoving=!0),i.isScrolling||r.zoom&&r.params.zoom&&r.params.zoom.enabled&&i.evCache.length>1){i.isTouched=!1;return}if(!i.startMoving)return;r.allowClick=!1,!s.cssMode&&l.cancelable&&l.preventDefault(),s.touchMoveStopPropagation&&!s.nested&&l.stopPropagation();let _=r.isHorizontal()?m:g,v=r.isHorizontal()?n.currentX-n.previousX:n.currentY-n.previousY;s.oneWayMovement&&(_=Math.abs(_)*(o?1:-1),v=Math.abs(v)*(o?1:-1)),n.diff=_,_*=s.touchRatio,o&&(_=-_,v=-v);const b=r.touchesDirection;r.swipeDirection=_>0?"prev":"next",r.touchesDirection=v>0?"prev":"next";const T=r.params.loop&&!s.cssMode;if(!i.isMoved){if(T&&r.loopFix({direction:r.swipeDirection}),i.startTranslate=r.getTranslate(),r.setTransition(0),r.animating){const A=new window.CustomEvent("transitionend",{bubbles:!0,cancelable:!0});r.wrapperEl.dispatchEvent(A)}i.allowMomentumBounce=!1,s.grabCursor&&(r.allowSlideNext===!0||r.allowSlidePrev===!0)&&r.setGrabCursor(!0),r.emit("sliderFirstMove",l)}let x;i.isMoved&&b!==r.touchesDirection&&T&&Math.abs(_)>=1&&(r.loopFix({direction:r.swipeDirection,setTranslate:!0}),x=!0),r.emit("sliderMove",l),i.isMoved=!0,i.currentTranslate=_+i.startTranslate;let S=!0,E=s.resistanceRatio;if(s.touchReleaseOnEdges&&(E=0),_>0?(T&&!x&&i.currentTranslate>(s.centeredSlides?r.minTranslate()-r.size/2:r.minTranslate())&&r.loopFix({direction:"prev",setTranslate:!0,activeSlideIndex:0}),i.currentTranslate>r.minTranslate()&&(S=!1,s.resistance&&(i.currentTranslate=r.minTranslate()-1+(-r.minTranslate()+i.startTranslate+_)**E))):_<0&&(T&&!x&&i.currentTranslate<(s.centeredSlides?r.maxTranslate()+r.size/2:r.maxTranslate())&&r.loopFix({direction:"next",setTranslate:!0,activeSlideIndex:r.slides.length-(s.slidesPerView==="auto"?r.slidesPerViewDynamic():Math.ceil(parseFloat(s.slidesPerView,10)))}),i.currentTranslate<r.maxTranslate()&&(S=!1,s.resistance&&(i.currentTranslate=r.maxTranslate()+1-(r.maxTranslate()-i.startTranslate-_)**E))),S&&(l.preventedByNestedSwiper=!0),!r.allowSlideNext&&r.swipeDirection==="next"&&i.currentTranslate<i.startTranslate&&(i.currentTranslate=i.startTranslate),!r.allowSlidePrev&&r.swipeDirection==="prev"&&i.currentTranslate>i.startTranslate&&(i.currentTranslate=i.startTranslate),!r.allowSlidePrev&&!r.allowSlideNext&&(i.currentTranslate=i.startTranslate),s.threshold>0)if(Math.abs(_)>s.threshold||i.allowThresholdMove){if(!i.allowThresholdMove){i.allowThresholdMove=!0,n.startX=n.currentX,n.startY=n.currentY,i.currentTranslate=i.startTranslate,n.diff=r.isHorizontal()?n.currentX-n.startX:n.currentY-n.startY;return}}else{i.currentTranslate=i.startTranslate;return}!s.followFinger||s.cssMode||((s.freeMode&&s.freeMode.enabled&&r.freeMode||s.watchSlidesProgress)&&(r.updateActiveIndex(),r.updateSlidesClasses()),s.freeMode&&s.freeMode.enabled&&r.freeMode&&r.freeMode.onTouchMove(),r.updateProgress(i.currentTranslate),r.setTranslate(i.currentTranslate))}function lLt(t){const e=this,r=e.touchEventsData,i=r.evCache.findIndex(x=>x.pointerId===t.pointerId);if(i>=0&&r.evCache.splice(i,1),["pointercancel","pointerout","pointerleave"].includes(t.type)&&!(t.type==="pointercancel"&&(e.browser.isSafari||e.browser.isWebView)))return;const{params:s,touches:n,rtlTranslate:o,slidesGrid:a,enabled:l}=e;if(!l||!s.simulateTouch&&t.pointerType==="mouse")return;let c=t;if(c.originalEvent&&(c=c.originalEvent),r.allowTouchCallbacks&&e.emit("touchEnd",c),r.allowTouchCallbacks=!1,!r.isTouched){r.isMoved&&s.grabCursor&&e.setGrabCursor(!1),r.isMoved=!1,r.startMoving=!1;return}s.grabCursor&&r.isMoved&&r.isTouched&&(e.allowSlideNext===!0||e.allowSlidePrev===!0)&&e.setGrabCursor(!1);const h=A6(),d=h-r.touchStartTime;if(e.allowClick){const x=c.path||c.composedPath&&c.composedPath();e.updateClickedSlide(x&&x[0]||c.target),e.emit("tap click",c),d<300&&h-r.lastClickTime<300&&e.emit("doubleTap doubleClick",c)}if(r.lastClickTime=A6(),_Y(()=>{e.destroyed||(e.allowClick=!0)}),!r.isTouched||!r.isMoved||!e.swipeDirection||n.diff===0||r.currentTranslate===r.startTranslate){r.isTouched=!1,r.isMoved=!1,r.startMoving=!1;return}r.isTouched=!1,r.isMoved=!1,r.startMoving=!1;let f;if(s.followFinger?f=o?e.translate:-e.translate:f=-r.currentTranslate,s.cssMode)return;if(s.freeMode&&s.freeMode.enabled){e.freeMode.onTouchEnd({currentPos:f});return}let m=0,g=e.slidesSizesGrid[0];for(let x=0;x<a.length;x+=x<s.slidesPerGroupSkip?1:s.slidesPerGroup){const S=x<s.slidesPerGroupSkip-1?1:s.slidesPerGroup;typeof a[x+S]<"u"?f>=a[x]&&f<a[x+S]&&(m=x,g=a[x+S]-a[x]):f>=a[x]&&(m=x,g=a[a.length-1]-a[a.length-2])}let _=null,v=null;s.rewind&&(e.isBeginning?v=s.virtual&&s.virtual.enabled&&e.virtual?e.virtual.slides.length-1:e.slides.length-1:e.isEnd&&(_=0));const b=(f-a[m])/g,T=m<s.slidesPerGroupSkip-1?1:s.slidesPerGroup;if(d>s.longSwipesMs){if(!s.longSwipes){e.slideTo(e.activeIndex);return}e.swipeDirection==="next"&&(b>=s.longSwipesRatio?e.slideTo(s.rewind&&e.isEnd?_:m+T):e.slideTo(m)),e.swipeDirection==="prev"&&(b>1-s.longSwipesRatio?e.slideTo(m+T):v!==null&&b<0&&Math.abs(b)>s.longSwipesRatio?e.slideTo(v):e.slideTo(m))}else{if(!s.shortSwipes){e.slideTo(e.activeIndex);return}e.navigation&&(c.target===e.navigation.nextEl||c.target===e.navigation.prevEl)?c.target===e.navigation.nextEl?e.slideTo(m+T):e.slideTo(m):(e.swipeDirection==="next"&&e.slideTo(_!==null?_:m+T),e.swipeDirection==="prev"&&e.slideTo(v!==null?v:m))}}function nge(){const t=this,{params:e,el:r}=t;if(r&&r.offsetWidth===0)return;e.breakpoints&&t.setBreakpoint();const{allowSlideNext:i,allowSlidePrev:s,snapGrid:n}=t,o=t.virtual&&t.params.virtual.enabled;t.allowSlideNext=!0,t.allowSlidePrev=!0,t.updateSize(),t.updateSlides(),t.updateSlidesClasses();const a=o&&e.loop;(e.slidesPerView==="auto"||e.slidesPerView>1)&&t.isEnd&&!t.isBeginning&&!t.params.centeredSlides&&!a?t.slideTo(t.slides.length-1,0,!1,!0):t.params.loop&&!o?t.slideToLoop(t.realIndex,0,!1,!0):t.slideTo(t.activeIndex,0,!1,!0),t.autoplay&&t.autoplay.running&&t.autoplay.paused&&(clearTimeout(t.autoplay.resizeTimeout),t.autoplay.resizeTimeout=setTimeout(()=>{t.autoplay&&t.autoplay.running&&t.autoplay.paused&&t.autoplay.resume()},500)),t.allowSlidePrev=s,t.allowSlideNext=i,t.params.watchOverflow&&n!==t.snapGrid&&t.checkOverflow()}function cLt(t){const e=this;e.enabled&&(e.allowClick||(e.params.preventClicks&&t.preventDefault(),e.params.preventClicksPropagation&&e.animating&&(t.stopPropagation(),t.stopImmediatePropagation())))}function uLt(){const t=this,{wrapperEl:e,rtlTranslate:r,enabled:i}=t;if(!i)return;t.previousTranslate=t.translate,t.isHorizontal()?t.translate=-e.scrollLeft:t.translate=-e.scrollTop,t.translate===0&&(t.translate=0),t.updateActiveIndex(),t.updateSlidesClasses();let s;const n=t.maxTranslate()-t.minTranslate();n===0?s=0:s=(t.translate-t.minTranslate())/n,s!==t.progress&&t.updateProgress(r?-t.translate:t.translate),t.emit("setTranslate",t.translate,!1)}function hLt(t){const e=this;I4(e,t.target),!(e.params.cssMode||e.params.slidesPerView!=="auto"&&!e.params.autoHeight)&&e.update()}let oge=!1;function dLt(){}const XLe=(t,e)=>{const r=Gx(),{params:i,el:s,wrapperEl:n,device:o}=t,a=!!i.nested,l=e==="on"?"addEventListener":"removeEventListener",c=e;s[l]("pointerdown",t.onTouchStart,{passive:!1}),r[l]("pointermove",t.onTouchMove,{passive:!1,capture:a}),r[l]("pointerup",t.onTouchEnd,{passive:!0}),r[l]("pointercancel",t.onTouchEnd,{passive:!0}),r[l]("pointerout",t.onTouchEnd,{passive:!0}),r[l]("pointerleave",t.onTouchEnd,{passive:!0}),(i.preventClicks||i.preventClicksPropagation)&&s[l]("click",t.onClick,!0),i.cssMode&&n[l]("scroll",t.onScroll),i.updateOnWindowResize?t[c](o.ios||o.android?"resize orientationchange observerUpdate":"resize observerUpdate",nge,!0):t[c]("observerUpdate",nge,!0),s[l]("load",t.onLoad,{capture:!0})};function pLt(){const t=this,e=Gx(),{params:r}=t;t.onTouchStart=oLt.bind(t),t.onTouchMove=aLt.bind(t),t.onTouchEnd=lLt.bind(t),r.cssMode&&(t.onScroll=uLt.bind(t)),t.onClick=cLt.bind(t),t.onLoad=hLt.bind(t),oge||(e.addEventListener("touchstart",dLt),oge=!0),XLe(t,"on")}function fLt(){XLe(this,"off")}var mLt={attachEvents:pLt,detachEvents:fLt};const age=(t,e)=>t.grid&&e.grid&&e.grid.rows>1;function gLt(){const t=this,{realIndex:e,initialized:r,params:i,el:s}=t,n=i.breakpoints;if(!n||n&&Object.keys(n).length===0)return;const o=t.getBreakpoint(n,t.params.breakpointsBase,t.el);if(!o||t.currentBreakpoint===o)return;const l=(o in n?n[o]:void 0)||t.originalParams,c=age(t,i),h=age(t,l),d=i.enabled;c&&!h?(s.classList.remove(`${i.containerModifierClass}grid`,`${i.containerModifierClass}grid-column`),t.emitContainerClasses()):!c&&h&&(s.classList.add(`${i.containerModifierClass}grid`),(l.grid.fill&&l.grid.fill==="column"||!l.grid.fill&&i.grid.fill==="column")&&s.classList.add(`${i.containerModifierClass}grid-column`),t.emitContainerClasses()),["navigation","pagination","scrollbar"].forEach(_=>{if(typeof l[_]>"u")return;const v=i[_]&&i[_].enabled,b=l[_]&&l[_].enabled;v&&!b&&t[_].disable(),!v&&b&&t[_].enable()});const f=l.direction&&l.direction!==i.direction,m=i.loop&&(l.slidesPerView!==i.slidesPerView||f);f&&r&&t.changeDirection(),mu(t.params,l);const g=t.params.enabled;Object.assign(t,{allowTouchMove:t.params.allowTouchMove,allowSlideNext:t.params.allowSlideNext,allowSlidePrev:t.params.allowSlidePrev}),d&&!g?t.disable():!d&&g&&t.enable(),t.currentBreakpoint=o,t.emit("_beforeBreakpoint",l),m&&r&&(t.loopDestroy(),t.loopCreate(e),t.updateSlides()),t.emit("breakpoint",l)}function yLt(t,e,r){if(e===void 0&&(e="window"),!t||e==="container"&&!r)return;let i=!1;const s=Vu(),n=e==="window"?s.innerHeight:r.clientHeight,o=Object.keys(t).map(a=>{if(typeof a=="string"&&a.indexOf("@")===0){const l=parseFloat(a.substr(1));return{value:n*l,point:a}}return{value:a,point:a}});o.sort((a,l)=>parseInt(a.value,10)-parseInt(l.value,10));for(let a=0;a<o.length;a+=1){const{point:l,value:c}=o[a];e==="window"?s.matchMedia(`(min-width: ${c}px)`).matches&&(i=l):c<=r.clientWidth&&(i=l)}return i||"max"}var _Lt={setBreakpoint:gLt,getBreakpoint:yLt};function vLt(t,e){const r=[];return t.forEach(i=>{typeof i=="object"?Object.keys(i).forEach(s=>{i[s]&&r.push(e+s)}):typeof i=="string"&&r.push(e+i)}),r}function bLt(){const t=this,{classNames:e,params:r,rtl:i,el:s,device:n}=t,o=vLt(["initialized",r.direction,{"free-mode":t.params.freeMode&&r.freeMode.enabled},{autoheight:r.autoHeight},{rtl:i},{grid:r.grid&&r.grid.rows>1},{"grid-column":r.grid&&r.grid.rows>1&&r.grid.fill==="column"},{android:n.android},{ios:n.ios},{"css-mode":r.cssMode},{centered:r.cssMode&&r.centeredSlides},{"watch-progress":r.watchSlidesProgress}],r.containerModifierClass);e.push(...o),s.classList.add(...e),t.emitContainerClasses()}function wLt(){const t=this,{el:e,classNames:r}=t;e.classList.remove(...r),t.emitContainerClasses()}var xLt={addClasses:bLt,removeClasses:wLt};function TLt(){const t=this,{isLocked:e,params:r}=t,{slidesOffsetBefore:i}=r;if(i){const s=t.slides.length-1,n=t.slidesGrid[s]+t.slidesSizesGrid[s]+i*2;t.isLocked=t.size>n}else t.isLocked=t.snapGrid.length===1;r.allowSlideNext===!0&&(t.allowSlideNext=!t.isLocked),r.allowSlidePrev===!0&&(t.allowSlidePrev=!t.isLocked),e&&e!==t.isLocked&&(t.isEnd=!1),e!==t.isLocked&&t.emit(t.isLocked?"lock":"unlock")}var SLt={checkOverflow:TLt},lge={init:!0,direction:"horizontal",oneWayMovement:!1,touchEventsTarget:"wrapper",initialSlide:0,speed:300,cssMode:!1,updateOnWindowResize:!0,resizeObserver:!0,nested:!1,createElements:!1,enabled:!0,focusableElements:"input, select, option, textarea, button, video, label",width:null,height:null,preventInteractionOnTransition:!1,userAgent:null,url:null,edgeSwipeDetection:!1,edgeSwipeThreshold:20,autoHeight:!1,setWrapperSize:!1,virtualTranslate:!1,effect:"slide",breakpoints:void 0,breakpointsBase:"window",spaceBetween:0,slidesPerView:1,slidesPerGroup:1,slidesPerGroupSkip:0,slidesPerGroupAuto:!1,centeredSlides:!1,centeredSlidesBounds:!1,slidesOffsetBefore:0,slidesOffsetAfter:0,normalizeSlideIndex:!0,centerInsufficientSlides:!1,watchOverflow:!0,roundLengths:!1,touchRatio:1,touchAngle:45,simulateTouch:!0,shortSwipes:!0,longSwipes:!0,longSwipesRatio:.5,longSwipesMs:300,followFinger:!0,allowTouchMove:!0,threshold:5,touchMoveStopPropagation:!1,touchStartPreventDefault:!0,touchStartForcePreventDefault:!1,touchReleaseOnEdges:!1,uniqueNavElements:!0,resistance:!0,resistanceRatio:.85,watchSlidesProgress:!1,grabCursor:!1,preventClicks:!0,preventClicksPropagation:!0,slideToClickedSlide:!1,loop:!1,loopedSlides:null,loopPreventsSliding:!0,rewind:!1,allowSlidePrev:!0,allowSlideNext:!0,swipeHandler:null,noSwiping:!0,noSwipingClass:"swiper-no-swiping",noSwipingSelector:null,passiveListeners:!0,maxBackfaceHiddenSlides:10,containerModifierClass:"swiper-",slideClass:"swiper-slide",slideActiveClass:"swiper-slide-active",slideVisibleClass:"swiper-slide-visible",slideNextClass:"swiper-slide-next",slidePrevClass:"swiper-slide-prev",wrapperClass:"swiper-wrapper",lazyPreloaderClass:"swiper-lazy-preloader",lazyPreloadPrevNext:0,runCallbacksOnInit:!0,_emitClasses:!1};function ELt(t,e){return function(i){i===void 0&&(i={});const s=Object.keys(i)[0],n=i[s];if(typeof n!="object"||n===null){mu(e,i);return}if(["navigation","pagination","scrollbar"].indexOf(s)>=0&&t[s]===!0&&(t[s]={auto:!0}),!(s in t&&"enabled"in n)){mu(e,i);return}t[s]===!0&&(t[s]={enabled:!0}),typeof t[s]=="object"&&!("enabled"in t[s])&&(t[s].enabled=!0),t[s]||(t[s]={enabled:!1}),mu(e,i)}}const F7={eventsEmitter:x$t,update:$$t,translate:k$t,transition:G$t,slide:J$t,loop:tLt,grabCursor:sLt,events:mLt,breakpoints:_Lt,checkOverflow:SLt,classes:xLt},U7={};class Th{constructor(){let e,r;for(var i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];s.length===1&&s[0].constructor&&Object.prototype.toString.call(s[0]).slice(8,-1)==="Object"?r=s[0]:[e,r]=s,r||(r={}),r=mu({},r),e&&!r.el&&(r.el=e);const o=Gx();if(r.el&&typeof r.el=="string"&&o.querySelectorAll(r.el).length>1){const h=[];return o.querySelectorAll(r.el).forEach(d=>{const f=mu({},r,{el:d});h.push(new Th(f))}),h}const a=this;a.__swiper__=!0,a.support=qLe(),a.device=y$t({userAgent:r.userAgent}),a.browser=v$t(),a.eventsListeners={},a.eventsAnyListeners=[],a.modules=[...a.__modules__],r.modules&&Array.isArray(r.modules)&&a.modules.push(...r.modules);const l={};a.modules.forEach(h=>{h({params:r,swiper:a,extendParams:ELt(r,l),on:a.on.bind(a),once:a.once.bind(a),off:a.off.bind(a),emit:a.emit.bind(a)})});const c=mu({},lge,l);return a.params=mu({},c,U7,r),a.originalParams=mu({},a.params),a.passedParams=mu({},r),a.params&&a.params.on&&Object.keys(a.params.on).forEach(h=>{a.on(h,a.params.on[h])}),a.params&&a.params.onAny&&a.onAny(a.params.onAny),Object.assign(a,{enabled:a.params.enabled,el:e,classNames:[],slides:[],slidesGrid:[],snapGrid:[],slidesSizesGrid:[],isHorizontal(){return a.params.direction==="horizontal"},isVertical(){return a.params.direction==="vertical"},activeIndex:0,realIndex:0,isBeginning:!0,isEnd:!1,translate:0,previousTranslate:0,progress:0,velocity:0,animating:!1,cssOverflowAdjustment(){return Math.trunc(this.translate/2**23)*2**23},allowSlideNext:a.params.allowSlideNext,allowSlidePrev:a.params.allowSlidePrev,touchEventsData:{isTouched:void 0,isMoved:void 0,allowTouchCallbacks:void 0,touchStartTime:void 0,isScrolling:void 0,currentTranslate:void 0,startTranslate:void 0,allowThresholdMove:void 0,focusableElements:a.params.focusableElements,lastClickTime:0,clickTimeout:void 0,velocities:[],allowMomentumBounce:void 0,startMoving:void 0,evCache:[]},allowClick:!0,allowTouchMove:a.params.allowTouchMove,touches:{startX:0,startY:0,currentX:0,currentY:0,diff:0},imagesToLoad:[],imagesLoaded:0}),a.emit("_swiper"),a.params.init&&a.init(),a}getSlideIndex(e){const{slidesEl:r,params:i}=this,s=Jf(r,`.${i.slideClass}, swiper-slide`),n=ige(s[0]);return ige(e)-n}getSlideIndexByData(e){return this.getSlideIndex(this.slides.filter(r=>r.getAttribute("data-swiper-slide-index")*1===e)[0])}recalcSlides(){const e=this,{slidesEl:r,params:i}=e;e.slides=Jf(r,`.${i.slideClass}, swiper-slide`)}enable(){const e=this;e.enabled||(e.enabled=!0,e.params.grabCursor&&e.setGrabCursor(),e.emit("enable"))}disable(){const e=this;e.enabled&&(e.enabled=!1,e.params.grabCursor&&e.unsetGrabCursor(),e.emit("disable"))}setProgress(e,r){const i=this;e=Math.min(Math.max(e,0),1);const s=i.minTranslate(),o=(i.maxTranslate()-s)*e+s;i.translateTo(o,typeof r>"u"?0:r),i.updateActiveIndex(),i.updateSlidesClasses()}emitContainerClasses(){const e=this;if(!e.params._emitClasses||!e.el)return;const r=e.el.className.split(" ").filter(i=>i.indexOf("swiper")===0||i.indexOf(e.params.containerModifierClass)===0);e.emit("_containerClasses",r.join(" "))}getSlideClasses(e){const r=this;return r.destroyed?"":e.className.split(" ").filter(i=>i.indexOf("swiper-slide")===0||i.indexOf(r.params.slideClass)===0).join(" ")}emitSlidesClasses(){const e=this;if(!e.params._emitClasses||!e.el)return;const r=[];e.slides.forEach(i=>{const s=e.getSlideClasses(i);r.push({slideEl:i,classNames:s}),e.emit("_slideClass",i,s)}),e.emit("_slideClasses",r)}slidesPerViewDynamic(e,r){e===void 0&&(e="current"),r===void 0&&(r=!1);const i=this,{params:s,slides:n,slidesGrid:o,slidesSizesGrid:a,size:l,activeIndex:c}=i;let h=1;if(s.centeredSlides){let d=n[c]?n[c].swiperSlideSize:0,f;for(let m=c+1;m<n.length;m+=1)n[m]&&!f&&(d+=n[m].swiperSlideSize,h+=1,d>l&&(f=!0));for(let m=c-1;m>=0;m-=1)n[m]&&!f&&(d+=n[m].swiperSlideSize,h+=1,d>l&&(f=!0))}else if(e==="current")for(let d=c+1;d<n.length;d+=1)(r?o[d]+a[d]-o[c]<l:o[d]-o[c]<l)&&(h+=1);else for(let d=c-1;d>=0;d-=1)o[c]-o[d]<l&&(h+=1);return h}update(){const e=this;if(!e||e.destroyed)return;const{snapGrid:r,params:i}=e;i.breakpoints&&e.setBreakpoint(),[...e.el.querySelectorAll('[loading="lazy"]')].forEach(o=>{o.complete&&I4(e,o)}),e.updateSize(),e.updateSlides(),e.updateProgress(),e.updateSlidesClasses();function s(){const o=e.rtlTranslate?e.translate*-1:e.translate,a=Math.min(Math.max(o,e.maxTranslate()),e.minTranslate());e.setTranslate(a),e.updateActiveIndex(),e.updateSlidesClasses()}let n;if(i.freeMode&&i.freeMode.enabled&&!i.cssMode)s(),i.autoHeight&&e.updateAutoHeight();else{if((i.slidesPerView==="auto"||i.slidesPerView>1)&&e.isEnd&&!i.centeredSlides){const o=e.virtual&&i.virtual.enabled?e.virtual.slides:e.slides;n=e.slideTo(o.length-1,0,!1,!0)}else n=e.slideTo(e.activeIndex,0,!1,!0);n||s()}i.watchOverflow&&r!==e.snapGrid&&e.checkOverflow(),e.emit("update")}changeDirection(e,r){r===void 0&&(r=!0);const i=this,s=i.params.direction;return e||(e=s==="horizontal"?"vertical":"horizontal"),e===s||e!=="horizontal"&&e!=="vertical"||(i.el.classList.remove(`${i.params.containerModifierClass}${s}`),i.el.classList.add(`${i.params.containerModifierClass}${e}`),i.emitContainerClasses(),i.params.direction=e,i.slides.forEach(n=>{e==="vertical"?n.style.width="":n.style.height=""}),i.emit("changeDirection"),r&&i.update()),i}changeLanguageDirection(e){const r=this;r.rtl&&e==="rtl"||!r.rtl&&e==="ltr"||(r.rtl=e==="rtl",r.rtlTranslate=r.params.direction==="horizontal"&&r.rtl,r.rtl?(r.el.classList.add(`${r.params.containerModifierClass}rtl`),r.el.dir="rtl"):(r.el.classList.remove(`${r.params.containerModifierClass}rtl`),r.el.dir="ltr"),r.update())}mount(e){const r=this;if(r.mounted)return!0;let i=e||r.params.el;if(typeof i=="string"&&(i=document.querySelector(i)),!i)return!1;i.swiper=r,i.parentNode&&i.parentNode.host&&(r.isElement=!0);const s=()=>`.${(r.params.wrapperClass||"").trim().split(" ").join(".")}`;let o=(()=>i&&i.shadowRoot&&i.shadowRoot.querySelector?i.shadowRoot.querySelector(s()):Jf(i,s())[0])();return!o&&r.params.createElements&&(o=HLe("div",r.params.wrapperClass),i.append(o),Jf(i,`.${r.params.slideClass}`).forEach(a=>{o.append(a)})),Object.assign(r,{el:i,wrapperEl:o,slidesEl:r.isElement?i.parentNode.host:o,hostEl:r.isElement?i.parentNode.host:i,mounted:!0,rtl:i.dir.toLowerCase()==="rtl"||Y_(i,"direction")==="rtl",rtlTranslate:r.params.direction==="horizontal"&&(i.dir.toLowerCase()==="rtl"||Y_(i,"direction")==="rtl"),wrongRTL:Y_(o,"display")==="-webkit-box"}),!0}init(e){const r=this;return r.initialized||r.mount(e)===!1||(r.emit("beforeInit"),r.params.breakpoints&&r.setBreakpoint(),r.addClasses(),r.updateSize(),r.updateSlides(),r.params.watchOverflow&&r.checkOverflow(),r.params.grabCursor&&r.enabled&&r.setGrabCursor(),r.params.loop&&r.virtual&&r.params.virtual.enabled?r.slideTo(r.params.initialSlide+r.virtual.slidesBefore,0,r.params.runCallbacksOnInit,!1,!0):r.slideTo(r.params.initialSlide,0,r.params.runCallbacksOnInit,!1,!0),r.params.loop&&r.loopCreate(),r.attachEvents(),[...r.el.querySelectorAll('[loading="lazy"]')].forEach(s=>{s.complete?I4(r,s):s.addEventListener("load",n=>{I4(r,n.target)})}),vY(r),r.initialized=!0,vY(r),r.emit("init"),r.emit("afterInit")),r}destroy(e,r){e===void 0&&(e=!0),r===void 0&&(r=!0);const i=this,{params:s,el:n,wrapperEl:o,slides:a}=i;return typeof i.params>"u"||i.destroyed||(i.emit("beforeDestroy"),i.initialized=!1,i.detachEvents(),s.loop&&i.loopDestroy(),r&&(i.removeClasses(),n.removeAttribute("style"),o.removeAttribute("style"),a&&a.length&&a.forEach(l=>{l.classList.remove(s.slideVisibleClass,s.slideActiveClass,s.slideNextClass,s.slidePrevClass),l.removeAttribute("style"),l.removeAttribute("data-swiper-slide-index")})),i.emit("destroy"),Object.keys(i.eventsListeners).forEach(l=>{i.off(l)}),e!==!1&&(i.el.swiper=null,l$t(i)),i.destroyed=!0),null}static extendDefaults(e){mu(U7,e)}static get extendedDefaults(){return U7}static get defaults(){return lge}static installModule(e){Th.prototype.__modules__||(Th.prototype.__modules__=[]);const r=Th.prototype.__modules__;typeof e=="function"&&r.indexOf(e)<0&&r.push(e)}static use(e){return Array.isArray(e)?(e.forEach(r=>Th.installModule(r)),Th):(Th.installModule(e),Th)}}Object.keys(F7).forEach(t=>{Object.keys(F7[t]).forEach(e=>{Th.prototype[e]=F7[t][e]})});Th.use([b$t,w$t]);function CLt(t,e,r,i){return t.params.createElements&&Object.keys(i).forEach(s=>{if(!r[s]&&r.auto===!0){let n=Jf(t.el,`.${i[s]}`)[0];n||(n=HLe("div",i[s]),n.className=i[s],t.el.append(n)),r[s]=n,e[s]=n}}),r}function ALt(t){let{swiper:e,extendParams:r,on:i,emit:s}=t;r({navigation:{nextEl:null,prevEl:null,hideOnClick:!1,disabledClass:"swiper-button-disabled",hiddenClass:"swiper-button-hidden",lockClass:"swiper-button-lock",navigationDisabledClass:"swiper-navigation-disabled"}}),e.navigation={nextEl:null,prevEl:null};const n=_=>(Array.isArray(_)||(_=[_].filter(v=>!!v)),_);function o(_){let v;return _&&typeof _=="string"&&e.isElement&&(v=e.el.querySelector(_),v)?v:(_&&(typeof _=="string"&&(v=[...document.querySelectorAll(_)]),e.params.uniqueNavElements&&typeof _=="string"&&v.length>1&&e.el.querySelectorAll(_).length===1&&(v=e.el.querySelector(_))),_&&!v?_:v)}function a(_,v){const b=e.params.navigation;_=n(_),_.forEach(T=>{T&&(T.classList[v?"add":"remove"](...b.disabledClass.split(" ")),T.tagName==="BUTTON"&&(T.disabled=v),e.params.watchOverflow&&e.enabled&&T.classList[e.isLocked?"add":"remove"](b.lockClass))})}function l(){const{nextEl:_,prevEl:v}=e.navigation;if(e.params.loop){a(v,!1),a(_,!1);return}a(v,e.isBeginning&&!e.params.rewind),a(_,e.isEnd&&!e.params.rewind)}function c(_){_.preventDefault(),!(e.isBeginning&&!e.params.loop&&!e.params.rewind)&&(e.slidePrev(),s("navigationPrev"))}function h(_){_.preventDefault(),!(e.isEnd&&!e.params.loop&&!e.params.rewind)&&(e.slideNext(),s("navigationNext"))}function d(){const _=e.params.navigation;if(e.params.navigation=CLt(e,e.originalParams.navigation,e.params.navigation,{nextEl:"swiper-button-next",prevEl:"swiper-button-prev"}),!(_.nextEl||_.prevEl))return;let v=o(_.nextEl),b=o(_.prevEl);Object.assign(e.navigation,{nextEl:v,prevEl:b}),v=n(v),b=n(b);const T=(x,S)=>{x&&x.addEventListener("click",S==="next"?h:c),!e.enabled&&x&&x.classList.add(..._.lockClass.split(" "))};v.forEach(x=>T(x,"next")),b.forEach(x=>T(x,"prev"))}function f(){let{nextEl:_,prevEl:v}=e.navigation;_=n(_),v=n(v);const b=(T,x)=>{T.removeEventListener("click",x==="next"?h:c),T.classList.remove(...e.params.navigation.disabledClass.split(" "))};_.forEach(T=>b(T,"next")),v.forEach(T=>b(T,"prev"))}i("init",()=>{e.params.navigation.enabled===!1?g():(d(),l())}),i("toEdge fromEdge lock unlock",()=>{l()}),i("destroy",()=>{f()}),i("enable disable",()=>{let{nextEl:_,prevEl:v}=e.navigation;_=n(_),v=n(v),[..._,...v].filter(b=>!!b).forEach(b=>b.classList[e.enabled?"remove":"add"](e.params.navigation.lockClass))}),i("click",(_,v)=>{let{nextEl:b,prevEl:T}=e.navigation;b=n(b),T=n(T);const x=v.target;if(e.params.navigation.hideOnClick&&!T.includes(x)&&!b.includes(x)){if(e.pagination&&e.params.pagination&&e.params.pagination.clickable&&(e.pagination.el===x||e.pagination.el.contains(x)))return;let S;b.length?S=b[0].classList.contains(e.params.navigation.hiddenClass):T.length&&(S=T[0].classList.contains(e.params.navigation.hiddenClass)),s(S===!0?"navigationShow":"navigationHide"),[...b,...T].filter(E=>!!E).forEach(E=>E.classList.toggle(e.params.navigation.hiddenClass))}});const m=()=>{e.el.classList.remove(...e.params.navigation.navigationDisabledClass.split(" ")),d(),l()},g=()=>{e.el.classList.add(...e.params.navigation.navigationDisabledClass.split(" ")),f()};Object.assign(e.navigation,{enable:m,disable:g,update:l,init:d,destroy:f})}async function OLt(t,e,r){r.popup.content="",r.closePopup();const i=e.name.trim()?e.name:"Building";let s=`
<p class='info'>
  <img src="https://raw.githubusercontent.com/Esri/Manhattan-skyscraper-explorer/master/img/height.png"> ${Math.round(e.heightroof)} feet
  <img src='https://raw.githubusercontent.com/Esri/Manhattan-skyscraper-explorer/master/img/construction.png'> ${e.cnstrct_yr}
</p>`,n;if(i!=="Building"){const f=await c();s+=f.extract??"",n=f.articleUrl}const{gallery:o,photoCount:a}=await h();s+=o??"";const l=document.createElement("div");l.innerHTML=s,await r.openPopup({title:i,content:l,location:t}),d({articleUrl:n,photoCount:a}),MLt(l);async function c(){const f=new URL("https://en.wikipedia.org/w/api.php");f.search=new URLSearchParams({action:"query",list:"search",srsearch:e.name,srwhat:"text",prop:"extracts|pageimages|imageinfo|pageterms|info",exintro:"1",explaintext:"1",exlimit:"20",pilimit:"20",piprop:"original",generator:"geosearch",ggscoord:`${t.latitude}|${t.longitude}`,ggsradius:"200",ggslimit:"20",origin:"*",format:"json"}).toString();const m=await ur(f,{responseType:"json"}),g=m.data.query.pages,_=m.data.query.search;let v=null,b=0;for(;!v&&b<_.length;){for(const S in g)if(g.hasOwnProperty(S)&&_[b].title===g[S].title){v=g[S];break}b++}if(!v)return{};const T=v.extract.length>200?v.extract.substring(0,v.extract.indexOf(".",200)+1):v.extract,x=`http://en.wikipedia.org/wiki/${encodeURIComponent(v.title)}`;return{extract:T,articleUrl:x}}async function h(){const f=new URL("https://api.flickr.com/services/rest/");f.search=new URLSearchParams({method:"flickr.photos.search",api_key:"099473f4030cba02455eb7db33704767",tags:"building",accuracy:"16",has_geo:"true",license:"2,3,4,5,6,7",lat:t.latitude.toString(),lon:t.longitude.toString(),radius:"0.1"}).toString();const g=(await ur(f,{responseType:"xml"})).data.getElementsByTagName("photo"),_=g.length;return _==0?{photoCount:_}:{gallery:RLt(Array.from(g).slice(0,Pi.maxPhotoCount)),photoCount:_}}function d({articleUrl:f,photoCount:m}){const g="wiki-action",_="flickr-action";r.popup.actions.removeAll(),f&&r.popup.actions.push(new cG({title:"Wikipedia",id:g,icon:"article"})),m>0&&r.popup.actions.push(new cG({title:"Photos",id:_,icon:"images"}));const v="info-widget-actions",b=r.popup.on("trigger-action",T=>{switch(T.action.id){case g:{window.open(f,"_blank");break}case _:{const x=new URL("https://www.flickr.com/search/");x.search=new URLSearchParams({tags:"building",accuracy:"16",has_geo:"true",lat:t.latitude.toString(),lon:t.longitude.toString(),radius:"0.1"}).toString(),window.open(x.toString(),"_blank");break}}r.popup.removeHandles(v),r.popup.addHandles(b,v)})}}function RLt(t){return`
<div class="swiper">
  <div class="swiper-wrapper">
    ${t.map(r=>{const i=`https://farm${r.getAttribute("farm")}.staticflickr.com/${r.getAttribute("server")}/${r.getAttribute("id")}_${r.getAttribute("secret")}.jpg`,s=`https://www.flickr.com/photos/${r.getAttribute("owner")}/${r.getAttribute("id")}/`;let n=r.getAttribute("title");return n.length>Pi.maxAttributionLength&&(n=n?.slice(0,Pi.maxAttributionLength-3)+"..."),`<div class="swiper-slide">
<div class="image" style="background-image: url('${i}')"></div>
<a class="attribution" href="${s}" target = "_blank"><b>${n}</b> courtesy of Flickr</a>
</div>`}).join(`
`)}
  </div>
  <div class="swiper-pagination"></div>
  <div class="swiper-button-prev"></div>
  <div class="swiper-button-next"></div>
</div>`}function MLt(t){const e=t.getElementsByClassName("swiper")[0],r=t.getElementsByClassName("swiper-button-prev")[0],i=t.getElementsByClassName("swiper-button-next")[0];new Th(e,{loop:!0,modules:[ALt],navigation:{prevEl:r,nextEl:i}})}const Es="esri-search",Et={base:`${Es} esri-widget`,loader:"esri-widget__loader",loaderText:"esri-widget__loader-text",loaderAnimation:"esri-widget__loader-animation",esriInput:"esri-input",hasMultipleSources:`${Es}--multiple-sources`,isLoading:`${Es}--loading`,isSearching:`${Es}--searching`,showSuggestions:`${Es}--show-suggestions`,showSources:`${Es}--sources`,showWarning:`${Es}--warning`,container:`${Es}__container`,input:`${Es}__input`,inputContainer:`${Es}__input-container`,form:`${Es}__form`,submitButton:`${Es}__submit-button`,sourcesButton:`${Es}__sources-button`,clearButton:`${Es}__clear-button`,sourceName:`${Es}__source-name`,suggestionsMenu:`${Es}__suggestions-menu`,suggestionList:`${Es}__suggestions-list`,suggestionListCurrentLocation:`${Es}__suggestions-list--current-location`,sourcesMenu:`${Es}__sources-menu`,source:`${Es}__source`,warningMenu:`${Es}__warning-menu`,warningMenuBody:`${Es}__warning-body`,warningMenuHeader:`${Es}__warning-header`,warningMenuText:`${Es}__warning-text`,noValueText:`${Es}__no-value-text`,esriWidgetDisabled:"esri-widget--disabled",button:"esri-widget--button",fallbackText:"esri-icon-font-fallback-text",header:"esri-widget__heading",locate:"esri-icon-locate-circled",menu:"esri-menu",menuList:"esri-menu__list",menuItem:"esri-menu__list-item",menuItemActive:"esri-menu__list-item--active",menuItemFocus:"esri-menu__list-item--focus",menuHeader:"esri-menu__header",loadingIcon:"esri-icon-loading-indicator esri-rotating",searchIcon:"esri-icon-search",dropdownIcon:"esri-icon-down-arrow esri-search__sources-button--down",dropupIcon:"esri-icon-up-arrow esri-search__sources-button--up",clearIcon:"esri-icon-close",noticeIcon:"esri-icon-notice-triangle",widgetIcon:"esri-icon-search",disabled:"esri-disabled"},$1="esri-search-result-renderer",sg={base:`${$1} esri-widget`,anchor:"esri-widget__anchor",showMoreResults:`${$1}__more-results--show-more-results`,moreResults:`${$1}__more-results`,moreResultsList:`${$1}__more-results-list`,moreResultsHeader:`${$1}__more-results-header`,moreResultsItem:`${$1}__more-results-item`,moreResultsListHeader:`${$1}__more-results-list-header`};let Tn=class extends t8(ue){constructor(e){super(e),this.autoNavigate=null,this.filter=null,this.getResults=null,this.getSuggestions=null,this.maxResults=null,this.maxSuggestions=null,this.minSuggestCharacters=null,this.outFields=null,this.placeholder="",this.popupEnabled=null,this.popupTemplate=null,this.prefix="",this.resultGraphicEnabled=null,this.resultSymbol=null,this.suggestionsEnabled=null,this.suffix="",this.withinViewEnabled=!1,this.zoomScale=null}};u([p()],Tn.prototype,"autoNavigate",void 0),u([p()],Tn.prototype,"filter",void 0),u([p()],Tn.prototype,"getResults",void 0),u([p()],Tn.prototype,"getSuggestions",void 0),u([p()],Tn.prototype,"maxResults",void 0),u([p()],Tn.prototype,"maxSuggestions",void 0),u([p()],Tn.prototype,"minSuggestCharacters",void 0),u([p()],Tn.prototype,"outFields",void 0),u([p()],Tn.prototype,"placeholder",void 0),u([p()],Tn.prototype,"popupEnabled",void 0),u([p()],Tn.prototype,"popupTemplate",void 0),u([p()],Tn.prototype,"prefix",void 0),u([p()],Tn.prototype,"resultGraphicEnabled",void 0),u([p()],Tn.prototype,"resultSymbol",void 0),u([p()],Tn.prototype,"suggestionsEnabled",void 0),u([p()],Tn.prototype,"suffix",void 0),u([p()],Tn.prototype,"withinViewEnabled",void 0),u([p()],Tn.prototype,"zoomScale",void 0),Tn=u([P("esri.widgets.Search.SearchSource")],Tn);const Dte=Tn,cge=K.getLogger("esri.widgets.Search.support.geometryUtils");function PLt(t,e){if(!e)return cge.error("missing-parameter: view is missing."),Promise.reject(new U("searchgeometryutils:missing-parameter","view is missing."));if(!t)return cge.error("missing-parameter: point is missing."),Promise.reject(new U("searchgeometryutils:missing-parameter","point is missing."));if(t.hasZ||e.type==="2d")return Promise.resolve(t);const r=e?.map?.ground;return r&&r.layers.length?r.queryElevation(t,{cache:e.basemapTerrain?.elevationQueryCache}).then(i=>i.geometry):Promise.resolve(t)}function uge(t){if(t==null)return null;switch(t.type){case"point":return t;case"extent":return t.center;case"polygon":return t.centroid;case"multipoint":return t.getPoint(0);case"polyline":return t.getPoint(0,0)}return null}function Nte(t,e,r){return t==null?null:t.type==="extent"?t:t.type==="multipoint"||t.type==="polygon"||t.type==="polyline"?t.extent:t.type==="point"?YLe(t,e,r):void 0}function bY(t,e,r){return t==null||e==null?null:YLe(t.center,e,r)}function YLe(t,e,r){const i=t.hasZ?t.z:void 0;return e?.map?(r!=null?jBe(e,r):e.extent).clone().centerAt(t).set({zmax:i,zmin:i}):new cr({xmin:t.x-.25,ymin:t.y-.25,xmax:t.x+.25,ymax:t.y+.25,spatialReference:t.spatialReference,zmin:i,zmax:i})}const ILt=/https?:\/\/services.*\.arcgis\.com/i,$Lt=/(?:\{([^}]+)\})/g,lE=K.getLogger("esri.widgets.Search.support.layerSearchUtils");function LLt(t,e){const{exactMatch:r=!1,location:i,maxResults:s,spatialReference:n,source:o,sourceIndex:a,suggestResult:l,view:c}=t,{layer:h,filter:d,zoomScale:f}=o,m=c?.scale,g=ZLe(o,c),_=e&&e.signal;return QLe(h).then(()=>{const v=h.popupTemplate;return v?v.getRequiredFields(h.fieldsIndex):null}).then(v=>{const{objectIdField:b,returnZ:T}=h,x=sDe(o);if(!Fte(h,x))throw lE.error("invalid-field: displayField is invalid."),new U("getResults():invalid-field","displayField is invalid.");const S=v&&v.length?v:[x],E=o.outFields||S,A=JLe(E);if(E.includes(b)||A||E.push(b),h.floorInfo?.floorField&&E.push(h.floorInfo.floorField),!(A||O6(h,E)))throw lE.error("invalid-field: outField is invalid."),new U("getResults():invalid-field","outField is invalid.");const R=h.createQuery(),{orderByFields:M}=o;if(M&&(R.orderByFields=M),n){R.outSpatialReference=n;const L=1/Ta(n);L&&(R.maxAllowableOffset=L)}const D=h.geometryType==="mesh"||h.geometryType==="multipatch",k=h.capabilities?.data?.supportsZ&&!D;if(R.returnZ=k&&T!==!1,R.returnGeometry=!0,R.multipatchOption=D?"xyFootprint":null,E&&(R.outFields=E),i)R.geometry=i;else if(l.key)R.objectIds=[l.key];else{const L=o.searchFields||[x];if(!O6(h,L))throw lE.error("invalid-field: search field is invalid."),new U("getResults():invalid-field","search field is invalid.");if(iDe(h)&&(R.num=s),g&&(R.geometry=g),!l.text?.trim())return[];const q=l.text,{prefix:X="",suffix:G=""}=o,J=nDe(`${X}${q}${G}`);rDe(h)&&eDe(h,L)&&!r&&q&&(R.fullText=tDe({text:q,searchFields:L}));const I=oDe({searchTerm:J,layer:h,searchFields:L,filter:d,exactMatch:r,query:R,type:"search"});if(R.where=I,!KLe(R))return[]}return h.queryFeatures(R,{signal:_}).then(L=>qLt(L,c,o,a,x,m,f))})}function DLt(t,e){const{source:r,spatialReference:i,view:s,suggestTerm:n,maxSuggestions:o,sourceIndex:a,exactMatch:l}=t,{layer:c,filter:h}=r,d=e&&e.signal,f=ZLe(r,s);return QLe(c).then(()=>{if(!iDe(c))return[];const m=sDe(r),g=r.searchFields||[m],_=[];r.suggestionTemplate?r.suggestionTemplate.replaceAll($Lt,(k,L)=>(_.push(L),k)):_.push(m);const v=JLe(_);_.includes(c.objectIdField)||v||_.push(c.objectIdField);const b=Fte(c,m),T=v||O6(c,_),x=O6(c,g);if(!b)throw lE.error("invalid-field: displayField is invalid."),new U("getSuggestions():invalid-field","displayField is invalid.");if(!T)throw lE.error("invalid-field: outField is invalid."),new U("getSuggestions():invalid-field","outField is invalid.");if(!x)throw lE.error("invalid-field: search field is invalid."),new U("getSuggestions():invalid-field","search field is invalid.");const S=c.createQuery(),{orderByFields:E}=r;if(E&&(S.orderByFields=E),S.outSpatialReference=i,S.returnGeometry=!1,S.num=o,S.outFields=_,f&&(S.geometry=f),!n.trim())return[];const{prefix:A="",suffix:R=""}=r,M=nDe(`${A}${n}${R}`);rDe(c)&&eDe(c,g)&&!l&&n&&(S.fullText=tDe({text:n,searchFields:g}));const D=oDe({searchTerm:M,layer:c,searchFields:g,filter:h,exactMatch:l,query:S,type:"suggest"});return S.where=D,KLe(S)?c.queryFeatures(S,{signal:d}).then(k=>jLt(k,r,a,m)):[]})}function ZLe(t,e){const{filter:r,withinViewEnabled:i}=t,s=e?.extent;return r?.geometry??(i&&s?s:void 0)}function JLe(t){return t&&t.includes("*")}async function QLe(t){t&&await t.load()}function KLe(t){return!(!t.fullText&&!t.where)}function eDe(t,e){const r=t?.indexes;return!r||!e?.length?!1:r.filter(i=>i.indexType==="FullText").some(i=>{const s=i.fields?.split(",").map(n=>n.trim().toLowerCase())||[];return e.every(n=>s.includes(n.toLowerCase()))})}function tDe({text:t,searchFields:e}){return t.trim().split(" ").filter(r=>!!r.trim()).map(r=>new HIe({onFields:e,searchTerm:r,searchType:"prefix"}))}function rDe(t){return t?.capabilities?.query?.supportsFullTextSearch??!1}function iDe(t){return t?.capabilities?.query?.supportsPagination??!1}function NLt(t){return t?.fieldsIndex?.fields?.find(e=>e.type==="string")?.name??""}function sDe(t){return t.displayField||t.layer.displayField||NLt(t.layer)}function O6(t,e){return!(!t||!e?.length)&&e.every(r=>Fte(t,r))}function Fte(t,e){return!!t.getField(e)}function FLt(t){for(let e=0;e<t.length;e++)if(t.charCodeAt(e)>255)return!0;return!1}function ULt(t,e,r){let i=null;const{codedValues:s}=t;return s&&s.some(n=>{const o=n.name,a=r?o:o.toLowerCase();return(r?e:e.toLowerCase())===a&&(i=n.code.toString(),!0)}),i}function nDe(t){return t.replaceAll("'","''")}function mA(t,e){const r=e?.where;return r?`(${t}) AND (${r})`:t}function kLt({currentTerm:t,field:e,filter:r,exactMatch:i,url:s,type:n}){const o=e?.type,a=e?.name;if(o==="string"||o==="date"||o==="global-id"){const l=ILt.test(s??""),c=l&&FLt(t)?"N":"";return mA(i&&n==="search"?`${a} = ${c}'${t}'`:l?`${a} LIKE ${c}${`'${t}%'`}`:`${`LOWER(${a})`} LIKE ${c}${`'${t.toLowerCase()}%'`}`,r)}if(o==="oid"||o==="small-integer"||o==="integer"||o==="single"||o==="double"){const l=Number(t);return isNaN(l)?null:mA(`${a} = ${l}`,r)}return mA(`${a} = ${t}`,r)}function zLt(t,e){return t?` OR (${e})`:`(${e})`}function oDe({searchTerm:t,layer:e,searchFields:r,filter:i,exactMatch:s,query:n,type:o}){const{definitionExpression:a,url:l}=e;let c="";return!n.fullText&&t&&r&&r.forEach(h=>{const d=e.getField(h),f=typeof e.getFieldDomain=="function"&&e.getFieldDomain(h),m=(f&&f.type==="coded-value"?ULt(f,t,s):null)||t||null;if(m!==null){const g=kLt({currentTerm:m,field:d,filter:i,exactMatch:s,url:l,type:o});g&&(c+=zLt(c,g))}}),a&&c?`(${a}) AND (${c})`:a||c}function VLt(t,e){let r=null;const{codedValues:i}=t;return i&&i.length&&i.some(s=>s.code===e&&(r=s.name,!0)),r}function BLt(t,e){return t[Object.keys(t).find(r=>r.toLowerCase()===e.toLowerCase())]}function aDe(t,e,r){const i=t.sourceLayer,{attributes:s}=t,n=typeof i.getFieldDomain=="function"&&i.getFieldDomain(r);if(e)return E1e(e,s);if(r&&s){const o=i.getField(r),a=BLt(s,r);return a==null?"":n&&n.type==="coded-value"?VLt(n,a)??"":o?.type==="date"?y0(new Date(a)):typeof a=="number"?a.toString():typeof a!="string"?"":a.trim()}return""}function GLt(t,e,r,i){const s=t.sourceLayer,{attributes:n}=t,{objectIdField:o}=s,a=o?n[o]:null;return{text:aDe(t,e.suggestionTemplate,i),key:a,sourceIndex:r}}function jLt(t,e,r,i){return t.features.map(s=>GLt(s,e,r,i))}function HLt(t,e,r,i,s,n,o){const a=t.clone(),l=t.sourceLayer,c=l?.objectIdField,h=c?t.attributes[c]:null,d=aDe(t,r.searchTemplate,s),f=Nte(a.geometry,e,n),m=typeof o=="number"?bY(ee(f),e,o):f,g=t.clone();return m!=null&&(g.geometry=Su.fromExtent(m)),{extent:m,target:g,feature:a,key:h,name:d,sourceIndex:i}}function qLt(t,e,r,i,s,n,o){return t.features.map(a=>HLt(a,e,r,i,s,n,o))}var wY;let qd=wY=class extends Dte{constructor(t){super(t),this.displayField=null,this.exactMatch=null,this.orderByFields=null,this.searchFields=null,this.searchTemplate=null,this.suggestionTemplate=null,this.getResults=(e,r)=>LLt({source:this,...e},r),this.getSuggestions=(e,r)=>DLt({source:this,...e},r)}set layer(t){this._set("layer",t),t&&t.load().catch(()=>{})}get name(){return this._getLayerTitle()??""}set name(t){this._overrideIfSome("name",t)}clone(){return new wY({autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?ee(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,displayField:this.displayField,exactMatch:this.exactMatch,layer:this.layer,searchFields:this.searchFields?ee(this.searchFields):null,suggestionTemplate:this.suggestionTemplate,zoomScale:this.zoomScale})}_getFirstStringField(){return this.layer.fieldsIndex?.fields.find(t=>t.type==="string")?.name??""}_getDisplayField(){return this.displayField||this.layer.displayField||this._getFirstStringField()}_getSearchFieldsString(){const{layer:t,searchFields:e}=this;return t.loaded?`: ${(e||[this._getDisplayField()]).map(r=>{const i=t.getField(r);return i&&i.alias||r}).join(", ")}`:""}_getLayerTitle(){const{layer:t}=this;if(!t)return;const{title:e}=t;return e?`${e}${this._getSearchFieldsString()}`:void 0}};u([p({json:{read:{source:"field.name"},write:{target:"field.name"}}})],qd.prototype,"displayField",void 0),u([p({json:{read:{source:"field.exactMatch"},write:{target:"field.exactMatch"}}})],qd.prototype,"exactMatch",void 0),u([p({value:null})],qd.prototype,"layer",null),u([p()],qd.prototype,"name",null),u([p({type:[String],json:{write:!0}})],qd.prototype,"orderByFields",void 0),u([p()],qd.prototype,"searchFields",void 0),u([p()],qd.prototype,"searchTemplate",void 0),u([p()],qd.prototype,"suggestionTemplate",void 0),qd=wY=u([P("esri.widgets.Search.LayerSearchSource")],qd);const Qb=qd;function WLt(t){return!!t&&typeof t.x=="number"&&typeof t.y=="number"}function XLt(t){return t&&typeof t.xmin=="number"&&typeof t.ymin=="number"&&typeof t.xmax=="number"&&typeof t.ymax=="number"}let c_=class extends ue{constructor(e){super(e),this.address=null,this.attributes=null,this.extent=null,this.location=null,this.score=null}};u([p({type:String,json:{write:!0}})],c_.prototype,"address",void 0),u([p({type:Object,json:{write:!0}})],c_.prototype,"attributes",void 0),u([p({type:cr,json:{write:!0}})],c_.prototype,"extent",void 0),u([p({type:tt,json:{write:!0}})],c_.prototype,"location",void 0),u([p({type:Number,json:{write:!0}})],c_.prototype,"score",void 0),c_=u([P("esri.rest.support.AddressCandidate")],c_);const lDe=c_,Ute={type:String,json:{read:{source:"token"},write:{target:"token"}}};let na=class extends ue{constructor(e){super(e),this.address=null,this.apiKey=null,this.categories=null,this.countryCode=null,this.forStorage=null,this.location=null,this.locationType=null,this.magicKey=null,this.maxLocations=null,this.outFields=null,this.outSpatialReference=null,this.searchExtent=null}};u([p({type:Object,json:{write:!0}})],na.prototype,"address",void 0),u([p(Ute)],na.prototype,"apiKey",void 0),u([p({type:[String],json:{read:{source:"category",reader:t=>t?t.split(","):null},write:{target:"category",writer:(t,e)=>{e.category=t?t.join(","):null}}}})],na.prototype,"categories",void 0),u([p({type:String,json:{write:!0}})],na.prototype,"countryCode",void 0),u([p({type:Boolean,json:{write:!0}})],na.prototype,"forStorage",void 0),u([p({type:tt,json:{write:{writer:(t,e)=>{e.location=t?t.clone().normalize():null}}}})],na.prototype,"location",void 0),u([p({type:String,json:{write:!0}})],na.prototype,"locationType",void 0),u([p({type:String,json:{write:!0}})],na.prototype,"magicKey",void 0),u([p({type:Number,json:{write:!0}})],na.prototype,"maxLocations",void 0),u([p({type:[String],json:{write:{writer:(t,e)=>{e.outFields=t?t.join(","):null}}}})],na.prototype,"outFields",void 0),u([p({type:qe,json:{read:{source:"outSR"},write:{target:"outSR"}}})],na.prototype,"outSpatialReference",void 0),u([p({type:cr,json:{write:{writer:(t,e)=>{const r=t?t.shiftCentralMeridian():null;e.searchExtent=r}}}})],na.prototype,"searchExtent",void 0),na=u([P("esri.rest.support.AddressToLocationsParameters")],na),na.from=ws(na);const cDe=na;async function YLt(t,e,r){e=cDe.from(e);const i=U9(t),{address:s,...n}=e.toJSON(),o={...s,...n,f:"json"},a=k9({...i.query,...o}),l=F9(a,r),c=`${i.path}/findAddressCandidates`;return ur(c,l).then(ZLt)}function ZLt({data:t}){if(!t)return[];const{candidates:e,spatialReference:r}=t;return e?e.map(i=>{if(!i)return;const{extent:s,location:n}=i,o=!s||XLt(s);return WLt(n)&&o?(s&&(s.spatialReference=r),n&&(n.spatialReference=r),lDe.fromJSON(i)):void 0}):[]}let Pg=class extends ue{constructor(e){super(e),this.apiKey=null,this.location=null,this.locationType=null,this.outSpatialReference=null}};u([p(Ute)],Pg.prototype,"apiKey",void 0),u([p({type:tt,json:{write:{writer:(t,e)=>{const r=t?t.clone().normalize():null,i=r!==void 0;e.location=i?r:null}}}})],Pg.prototype,"location",void 0),u([p({type:String,json:{write:!0}})],Pg.prototype,"locationType",void 0),u([p({type:qe,json:{read:{source:"outSR"},write:{target:"outSR"}}})],Pg.prototype,"outSpatialReference",void 0),Pg=u([P("esri.rest.support.LocationToAddressParameters")],Pg),Pg.from=ws(Pg);const uDe=Pg;async function JLt(t,e,r){e=uDe.from(e);const i=U9(t),s={...e.toJSON(),f:"json"},n=k9({...i.query,...s}),o=F9(n,r),a=`${i.path}/reverseGeocode`;return ur(a,o).then(QLt)}function QLt({data:t}){if(!t)return;const{address:e,location:r}=t,i=e&&e.Match_addr||"";return lDe.fromJSON({address:i,attributes:e||{},location:r,score:100})}let iS=class extends ue{constructor(e){super(e),this.isCollection=null,this.magicKey=null,this.text=null}};u([p({type:Boolean,json:{write:!0}})],iS.prototype,"isCollection",void 0),u([p({type:String,json:{write:!0}})],iS.prototype,"magicKey",void 0),u([p({type:String,json:{write:!0}})],iS.prototype,"text",void 0),iS=u([P("esri.rest.support.SuggestionCandidate")],iS);const KLt=iS;let nu=class extends ue{constructor(e){super(e),this.apiKey=null,this.categories=null,this.countryCode=null,this.location=null,this.maxSuggestions=null,this.outSpatialReference=null,this.searchExtent=null,this.text=null}};u([p(Ute)],nu.prototype,"apiKey",void 0),u([p({type:[String],json:{read:{source:"category",reader:t=>t?t.split(","):null},write:{target:"category",writer:(t,e)=>{e.category=t?t.join(","):null}}}})],nu.prototype,"categories",void 0),u([p({type:String,json:{write:!0}})],nu.prototype,"countryCode",void 0),u([p({type:tt,json:{write:{writer:(t,e)=>{e.location=t?t.clone().normalize():null}}}})],nu.prototype,"location",void 0),u([p({type:Number,json:{write:!0}})],nu.prototype,"maxSuggestions",void 0),u([p({type:qe,json:{read:{source:"outSR"},write:{target:"outSR"}}})],nu.prototype,"outSpatialReference",void 0),u([p({type:cr,json:{write:{writer:(t,e)=>{const r=t?t.shiftCentralMeridian():null;e.searchExtent=JSON.stringify(r)}}}})],nu.prototype,"searchExtent",void 0),u([p({type:String,json:{write:!0}})],nu.prototype,"text",void 0),nu=u([P("esri.rest.support.SuggestLocationsParameters")],nu),nu.from=ws(nu);const hDe=nu;async function eDt(t,e,r){const i=U9(t),s={...(e=hDe.from(e)).toJSON(),f:"json"},n=k9({...i.query,...s}),o=F9(n,r),a=`${i.path}/suggest`;return ur(a,o).then(tDt)}function tDt(t){const{data:e}=t;if(!e)return[];const{suggestions:r}=e;return r?r.map(i=>new KLt(i)):[]}const rDt="Single Line Input",iDt=3e5;function sDt(t,e){return t.location?cDt(t,e):uDt(t,e)}function dDe(t,e){if(e.localSearchDisabled)return null;const r=t?.scale;return typeof r=="number"&&r<=iDt?t?.extent?.center:null}async function nDt(t,e){const{source:r,spatialReference:i,view:s,suggestTerm:n,maxSuggestions:o,sourceIndex:a}=t,l=new hDe,{apiKey:c,url:h}=r,d=pDe(r,s),f=e&&e.signal;if(!h)return null;c&&(l.apiKey=c),r.categories&&(l.categories=r.categories),i&&(l.outSpatialReference=i);const m=dDe(s,r);if(m&&(l.location=m),!n.trim())return null;const{prefix:g="",suffix:_=""}=r,v=`${g}${n}${_}`;return l.text=v,d&&(l.searchExtent=d),l.maxSuggestions=o,r.countryCode&&(l.countryCode=r.countryCode),eDt(h,l,{signal:f}).then(b=>dDt(b,a))}function oDt(t){return!!t&&/(?:geocode\-api\.arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/i.test(t)}function aDt(t){return!!t&&/(?:\/servers\/[\da-z\.-]+\/rest\/services\/world\/geocodeserver).*/i.test(t)}function hge(t){return!!t&&/(?:arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/i.test(t)}const lDt="https://geocode-api.arcgis.com/arcgis/rest/services/World/GeocodeServer";async function cDt(t,e){const{source:r,spatialReference:i,location:s,sourceIndex:n,view:o}=t,{apiKey:a,url:l,zoomScale:c,defaultZoomScale:h}=r;if(l==null)return[];const d=o?.scale,f=e?.signal,m=new uDe;m.location=s,a&&(m.apiKey=a),i&&(m.outSpatialReference=i);try{return fDe([await JLt(l,m,{signal:f})],{sourceIndex:n,scale:d,view:o,zoomScale:c,defaultZoomScale:h})}catch{return[]}}function pDe(t,e){const{filter:r,withinViewEnabled:i}=t,s=e&&e.scale,n=e&&e.extent,o=r&&r.geometry;return Nte(o,e,s)||(i&&n?n:void 0)}async function uDt(t,e){const{source:r,suggestResult:i,spatialReference:s,view:n,maxResults:o,sourceIndex:a}=t,l=r&&r.zoomScale,c=r&&r.defaultZoomScale;if(!i.text?.trim())return null;const d=!i.key&&r.prefix?r.prefix:"",f=!i.key&&r.suffix?r.suffix:"",m=`${d}${i.text}${f}`,g=new cDe,{apiKey:_,url:v}=r,b=n&&n.scale,T=pDe(r,n),x=e&&e.signal;if(_&&(g.apiKey=_),!v)return null;r.categories&&(g.categories=r.categories),r.locationType&&(g.locationType=r.locationType),s&&(g.outSpatialReference=s);const S=dDe(n,r);S&&(g.location=S),g.maxLocations=o,T&&(g.searchExtent=T),r.countryCode&&(g.countryCode=r.countryCode);const{key:E}=i,A=`${E}`;return E&&(g.magicKey=A),g.address={},g.address[r.singleLineFieldName||rDt]=m,r.outFields&&(g.outFields=r.outFields),YLt(v,g,{signal:x}).then(R=>fDe(R,{key:A,scale:b,sourceIndex:a,view:n,zoomScale:l,defaultZoomScale:c}))}function hDt(t,e){return{text:t.text,key:t.magicKey,sourceIndex:e}}function dDt(t,e){return t.map(r=>hDt(r,e))}function pDt(t,e){const{key:r,scale:i,sourceIndex:s,view:n,zoomScale:o,defaultZoomScale:a}=e,{attributes:l,extent:c,location:h,address:d}=t,f=new Bl({geometry:h,attributes:l}),m=c||h,g=Nte(m,n,i),_=typeof o=="number"?bY(g,n,o):typeof a=="number"&&m?.type==="point"?bY(g,n,a):g,v=h?`${h.x},${h.y}`:"",b=d||v,T=f.clone();return _!=null&&(T.geometry=Su.fromExtent(_)),{extent:_,feature:f,target:T,key:r,name:b,sourceIndex:s}}function fDe(t,e){return t.filter(Boolean).map(r=>pDt(r,e))}var xY;const fDt="esri.widgets.Search.LocatorSearchSource";let Ha=xY=class extends Dte{constructor(t){super(t),this.apiKey=null,this.categories=null,this.countryCode=null,this.defaultZoomScale=null,this.localSearchDisabled=!1,this.locationType=null,this.name="",this.placeholder="",this.searchTemplate="",this.singleLineFieldName=null,this.suggestionsEnabled=null,this.url=null,this.zoomScale=null,this.getResults=(e,r)=>sDt({source:this,...e},r),this.getSuggestions=(e,r)=>nDt({source:this,...e},r)}clone(){return new xY({apiKey:this.apiKey,autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?ee(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,categories:this.categories?ee(this.categories):null,countryCode:this.countryCode,locationType:this.locationType,searchTemplate:this.searchTemplate,singleLineFieldName:this.singleLineFieldName,zoomScale:this.zoomScale})}};u([p()],Ha.prototype,"apiKey",void 0),u([p()],Ha.prototype,"categories",void 0),u([p()],Ha.prototype,"countryCode",void 0),u([p({json:{write:!0}})],Ha.prototype,"defaultZoomScale",void 0),u([p()],Ha.prototype,"localSearchDisabled",void 0),u([p()],Ha.prototype,"locationType",void 0),u([p({json:{write:!0}})],Ha.prototype,"name",void 0),u([p({json:{write:!0}})],Ha.prototype,"placeholder",void 0),u([p()],Ha.prototype,"searchTemplate",void 0),u([p({json:{write:!0}})],Ha.prototype,"singleLineFieldName",void 0),u([p({json:{read:{source:"suggest"},write:{target:"suggest"}}})],Ha.prototype,"suggestionsEnabled",void 0),u([p({json:{write:!0}})],Ha.prototype,"url",void 0),u([p({json:{write:!0}})],Ha.prototype,"zoomScale",void 0),Ha=xY=u([P(fDt)],Ha);const mDe=Ha,gDe=K.getLogger("esri.widgets.support.geolocationUtils"),mDt={maximumAge:0,timeout:15e3,enableHighAccuracy:!0};function gDt(){const t=ae("esri-geolocation");return t||gDe.warn("geolocation-unsupported","Geolocation unsupported."),t}function yDt(){const t=window.isSecureContext;return t||gDe.warn("insecure-context","Geolocation requires a secure origin."),t}function dge(){return gDt()&&yDt()}function _Dt(t){return t||(t=mDt),new Promise((r,i)=>{setTimeout(()=>i(new U("geolocation:timeout","getting the current geolocation position timed out")),15e3),navigator.geolocation.getCurrentPosition(r,i,t??void 0)})}function vDt(t,e){const{position:r,view:i}=t,s=bDt(r),n=s?.coords;if(!n)throw new U("geometry-service:no-coords","Geolocation has no coordinates");return xDt(wDt(n),i,e)}function bDt(t){const e=t&&t.coords||{},r={accuracy:e.accuracy,altitude:e.altitude,altitudeAccuracy:e.altitudeAccuracy,heading:e.heading,latitude:e.latitude,longitude:e.longitude,speed:e.speed};return t&&{coords:r,timestamp:t.timestamp}}function wDt({longitude:t,latitude:e,altitude:r}){return new tt({longitude:t,latitude:e,z:r||void 0,spatialReference:{wkid:4326}})}function xDt(t,e,r){if(!e)return Promise.resolve(t);const i=e.spatialReference;return i.isWGS84?Promise.resolve(t):i.isWebMercator?Promise.resolve(OS(t)):TDt(r).then(s=>{if(!s)throw new U("geometry-service:missing-url","Geometry service URL is missing");const n=new z9({geometries:[t],outSpatialReference:i});return pee(s,n,r).then(o=>o[0])})}function TDt(t){if(Gr.geometryServiceUrl)return Promise.resolve(Gr.geometryServiceUrl);const e=en.getDefault();return e.load(t).catch(()=>{}).then(()=>e.get("helperServices.geometry.url"))}function Na(t,e){return t.hasOwnProperty(e)&&t[e]!=null&&t[e]!==""}const SDt=()=>pZ("esri/widgets/Search/t9n/Search"),yDe="esri.widgets.Search.SearchViewModel",ng=K.getLogger(yDe),pge="highlight",$4=Pt.ofType({key:t=>t.layer?"layer":"locator",base:Dte,typeMap:{layer:Qb,locator:mDe}}),fge=qe.WGS84,EDt="esri/images/search/search-symbol-32.png",CDt=/<(?:.|\s)*?>/g,sS=-1;let gr=class extends XPe(Ts.EventedMixin(Te)){constructor(t){super(t),this._gotoController=null,this._searching=null,this._updatingPromise=null,this._createdFeatureLayers=[],this.autoNavigate=!0,this.autoSelect=!0,this.defaultPopupTemplate=null,this.defaultSources=new $4,this.defaultSymbols={point:new SP({url:jr(EDt),size:24,width:24,height:24}),polyline:new zu({color:[130,130,130,1],width:2}),polygon:new Iv({color:[235,235,235,.4],outline:{color:[130,130,130,1],width:2}})},this.includeDefaultSources=!0,this.maxInputLength=128,this.maxResults=6,this.maxSuggestions=6,this.messages=null,this.minSuggestCharacters=3,this.popupEnabled=!0,this.popupTemplate=null,this.portal=en.getDefault(),this.resultCount=null,this.resultGraphicEnabled=!0,this.resultGraphic=null,this.results=null,this.selectedSuggestion=null,this.searchAllEnabled=!0,this.selectedResult=null,this.sources=new $4,this.suggestionDelay=350,this.suggestionCount=null,this.suggestions=null,this.suggestionsEnabled=!0,this.view=null}initialize(){const t=async()=>{const e=await SDt();this.messages=e,this.defaultPopupTemplate=new Rv({title:e.searchResult,content:"{Match_addr}"})};t(),this.addHandles([le(()=>[this.includeDefaultSources,this.view,this.portal],()=>this._update(),Pr),uZ(t)])}destroy(){this.removeAllHandles(),this._destroyFeatureLayers(),this._abortGoTo(),this.clearGraphics()}get activeSource(){return this.allSources.at(this.activeSourceIndex)??null}get activeSourceIndex(){return this.allSources.length===1||!this.searchAllEnabled?0:sS}set activeSourceIndex(t){this._overrideIfSome("activeSourceIndex",t)}get allPlaceholder(){return this.messages?.allPlaceholder}set allPlaceholder(t){this._overrideIfSome("allPlaceholder",t)}get allSources(){const{sources:t,defaultSources:e,includeDefaultSources:r}=this,i=typeof r=="function"?r.call(null,{sources:t,defaultSources:e}):r?e.concat(t):t,s=this._get("allSources")||new $4;return s.removeAll(),s.addMany(i.filter(Boolean)),s}get locationEnabled(){return this._get("locationEnabled")||dge()}set locationEnabled(t){if(t===void 0)return void this._clearOverride("locationEnabled");const e=dge();if(t&&!e){const r=new U("locationEnabled:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});ng.error(r)}this._override("locationEnabled",!!t&&e)}get placeholder(){const{allSources:t,activeSourceIndex:e,allPlaceholder:r}=this;return e===sS?r??"":t.at(e)?.placeholder??""}set searchTerm(t){this._set("searchTerm",t||""),this.clearGraphics(),this.selectedSuggestion&&this.selectedSuggestion.text!==t&&this._set("selectedSuggestion",null),t===""&&this._clear()}get searchTerm(){return this._get("searchTerm")||""}get state(){return this._searching?"searching":this.updating?"loading":this.allSources.length===0?"disabled":"ready"}get updating(){return this._updatingPromise!=null}clear(){this.searchTerm=""}clearGraphics(){this._removeHighlight(),this._closePopup();const{view:t,resultGraphic:e}=this;t&&e&&t.graphics.remove(e),this._set("resultGraphic",null)}search(t,e){this.emit("search-start"),this.clearGraphics();const r=this._createSuggestionForSearch(t),i=(async()=>{try{await this.when();const s=await this._getResultsFromSources(r,e);if(e?.signal?.aborted)return null;const n={activeSourceIndex:this.activeSourceIndex,searchTerm:r.text??"",numResults:0,numErrors:0,errors:[],results:[]};this._formatResponse(n,s,r);const o=this._getFirstResult(n.results),a=r.location&&o?o.name:r.text,l=a?.replace(CDt,"");return this._set("searchTerm",l),(r.key&&typeof r.sourceIndex=="number"||r.location)&&this._set("selectedSuggestion",r),this._set("results",n.results),this._set("resultCount",n.results.reduce((c,h)=>c+(h.results?.length??0),0)),this.emit("search-complete",n),await this._selectFirstResult(o),n}finally{this._clearSearching()}})();return this._searching=i,i}async searchNearby(t){if(!this.locationEnabled){const r=new U("searchNearby:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});throw ng.error(r),r}const e=(async()=>{try{const r=await _Dt(),i=await vDt({position:r,view:this.view},t);return await this.search(i,t)}finally{this._clearSearching()}})();return this._searching=e,e}async select(t){if(this.clearGraphics(),!t){const M=new U("select:missing-parameter","Cannot select without a searchResult.",{searchResult:t});throw ng.error(M),M}const{view:e}=this,r=Na(t,"sourceIndex")?t.sourceIndex:this._getSourceIndexOfResult(t),i=r!=null?this.allSources.at(r):null;if(!i){const M=new U("select:missing-source","Cannot select without a source.",{source:i});throw ng.error(M),M}const s=i instanceof Qb?this._getLayerSourcePopupTemplate(i):i.popupTemplate,n=i.resultSymbol||this._getDefaultSymbol(t),o=Na(i,"resultGraphicEnabled")?i.resultGraphicEnabled:this.resultGraphicEnabled,a=Na(i,"autoNavigate")?i.autoNavigate:this.autoNavigate,l=(Na(i,"popupEnabled")?i.popupEnabled:this.popupEnabled)?s||this.popupTemplate||this.defaultPopupTemplate:null,{feature:c}=t;if(!c){const M=new U("select:missing-feature","Cannot select without a feature.",{feature:c});throw ng.error(M),M}const{attributes:h,geometry:d,layer:f,sourceLayer:m}=c,g=uge(d),_={layerViewQuery:this._getLayerView(c),elevationQuery:e&&g!=null?PLt(g,e).catch(()=>g):Promise.resolve(g)},v=await Ac(_),b=v.layerViewQuery.value,T=v.elevationQuery.value;n instanceof Ex&&(n.text=t.name);const x=e&&a?t.target||t.extent:null;await(x!=null?this._goToSearchResult(x):Promise.resolve());const E=b?c:new Bl({geometry:d,symbol:n,attributes:h,layer:f,sourceLayer:m,popupTemplate:l}),A=e?.popup,R=A&&E.getEffectivePopupTemplate(A.defaultPopupTemplateEnabled);return R&&await e.openPopup({features:[E],location:T}),b&&mxt(b)&&!R&&this._highlightFeature({graphic:E,layerView:b}),!b&&o&&e&&e.graphics.push(E),this._setResultFloor(t),this._set("selectedResult",t),this._set("resultGraphic",E),this.emit("select-result",{result:t,source:i,sourceIndex:r}),t}async suggest(t,e,r){const i=t||this.searchTerm;this.emit("suggest-start",{searchTerm:i}),await this._suggestTimer(e,r);const s=await this._suggestImmediate(i,r);return this._set("suggestions",s?.results),this._set("suggestionCount",s?.results.reduce((n,o)=>n+(o.results?.length??0),0)??null),this.emit("suggest-complete",s),s}async when(){await d0(()=>!this.updating)}async _update(){const{portal:t,view:e}=this;if(this.includeDefaultSources){const r=this._updatingPromise=Ac([t?.load(),e?.when()]);if(this.destroyed||(await r,r!==this._updatingPromise))return}await d0(()=>this.messages),this.destroyed||this._updateDefaultSources(),this._updatingPromise=null}_clearSearching(){this._searching=null}_convertHelperServices(){const t=this.portal?.helperServices?.geocode;return t?t.map(e=>{if(e.placefinding===!1)return;const r=Gr.apiKey&&hge(e.url)?{url:lDt}:null,i=mDe.fromJSON({...e,...r}),s=i.url;if(hge(s)||aDt(s)||oDt(s)){const n=i.outFields??["Addr_type","Match_addr","StAddr","City"],o=(i.placeholder||this.messages?.placeholder)??"",a=typeof i.defaultZoomScale=="number"?i.defaultZoomScale:2500;i.singleLineFieldName="SingleLine",i.outFields=n,i.placeholder=o,i.defaultZoomScale=a}return i.singleLineFieldName?i:void 0}).filter(Qf):[]}_destroyFeatureLayers(){this._createdFeatureLayers.forEach(t=>t?.destroy()),this._createdFeatureLayers=[]}_getLayerSources(t,e){const r=this.view?.map;return t.map(i=>{const s=r.findLayerById(i.id);if(!s)return;const n=this._getLayerJSON(i),o=Qb.fromJSON(n);return o.placeholder=e,this._getLayer(s,n).then(a=>{o.layer=a}),o}).filter(Qf).toArray()}_getTableSources(t,e){const r=this.view?.map;return t.map(i=>{if(!i.id)return;const s=r.findTableById(i.id);if(!s)return;const n=this._getLayerJSON(i),o=Qb.fromJSON(n);return o.placeholder=e,this._getLayer(s,n).then(a=>{o.layer=a}),o}).filter(Qf).toArray()}_convertApplicationProperties(){const t=this.view?.map,e=t?.applicationProperties?.viewing?.search;if(!e)return[];const{enabled:r,hintText:i,layers:s,tables:n}=e;return r?[...this._getLayerSources(s,i),...this._getTableSources(n,i)]:[]}async _getSubLayer(t,e){if(await t.load(),!t.allSublayers)throw new Error;const r=t.allSublayers.find(s=>s.id===e.subLayer);if(!r)throw new Error;const i=await r.createFeatureLayer?.();if(!i)throw new Error;return this._createdFeatureLayers.push(i),i}async _getBuildingSubLayer(t,e){await t.load();const r=t.allSublayers.find(i=>i.id===e.subLayer);if(r?.type!=="building-component")throw new Error;if(await r.load(),r.associatedLayer==null)throw new Error;return await r.associatedLayer.load(),r}async _getLayer(t,e){if(t.type==="feature"||t.type==="scene"||t.type==="csv"||t.type==="geojson"||t.type==="ogc-feature")return t;if(t.type==="map-image")try{return await this._getSubLayer(t,e)}catch{const i=new U("search:create-featurelayer","Could not create a FeatureLayer from the MapImageLayer",{layer:t});return ng.error(i),null}return t.type==="building-scene"?this._getBuildingSubLayer(t,e):null}_getLayerJSON(t){return typeof t.toJSON=="function"?t.toJSON():t}_updateDefaultSources(){const{defaultSources:t,includeDefaultSources:e}=this;this._destroyFeatureLayers(),t.removeAll(),e&&t.addMany([...this._convertApplicationProperties(),...this._convertHelperServices()])}_abortGoTo(){this._gotoController&&this._gotoController.abort(),this._gotoController=null}_clear(){this._abortGoTo(),this._set("resultCount",null),this._set("results",null),this._set("suggestions",null),this._set("suggestionCount",null),this._set("selectedResult",null),this._set("selectedSuggestion",null),this.emit("search-clear")}_closePopup(){const t=this.view?.popup,{resultGraphic:e}=this;if(!t||!e)return;const r="selectedFeature"in t,i=r?t.selectedFeature:null;r&&i&&i===e&&t.close()}_suggestTimer(t,e){const r=t??this.suggestionDelay;return uE(r,null,e&&e.signal)}_createLocationForSearch(t){return t instanceof Bl?uge(t.geometry):t instanceof tt?t:Array.isArray(t)&&t.length===2?new tt({longitude:t[0],latitude:t[1]}):null}_createSuggestionForSearch(t){if(t&&Na(t,"key")&&Na(t,"text")&&Na(t,"sourceIndex"))return t;const e=this._createLocationForSearch(t),r=typeof t=="string"?t:this.searchTerm,{selectedSuggestion:i,selectedResult:s}=this,n=!t&&i&&s,o=n&&i.key===s.key&&i.sourceIndex===s.sourceIndex,a=n&&i.location;return o||a?i:{location:e,text:e?"":r,sourceIndex:null,key:null}}_getFirstResult(t){let e=null;return t&&t.some(r=>{const{results:i}=r,s=i?.[0],n=!!s;return n&&(e=s),n}),e}async _selectFirstResult(t){return this.autoSelect&&t?this.select(t):null}async _suggestImmediate(t,e){await this.when();const r=await this._getSuggestionsFromSources(t,e);if(e?.signal?.aborted)return null;const i={activeSourceIndex:this.activeSourceIndex,searchTerm:t??"",numResults:0,numErrors:0,errors:[],results:[]};return this._formatResponse(i,r),i}_formatSourceResponse(t,e,r){const i=e?.value||[],s=e?.error,n=this.allSources.at(r);if(s){const o={sourceIndex:r,source:n,error:s};t.errors.push(o),ng.error(s),t.numErrors++}else{const o={sourceIndex:r,source:n,results:i};t.results.push(o),t.numResults+=i.length}}_formatResponse(t,e,r){if(e)if(t.activeSourceIndex===sS){const i=r&&Na(r,"sourceIndex")&&r.sourceIndex!==-1?r.sourceIndex:void 0;e.forEach((s,n)=>{const o=i!==void 0?i:n;this._formatSourceResponse(t,s,o)})}else this._formatSourceResponse(t,e[0],t.activeSourceIndex)}async _getResultsFromSources(t,e){const{allSources:r}=this,i=!t.location&&Na(t,"sourceIndex")?t.sourceIndex:this.activeSourceIndex,s=[];if(!r.length){const n=new U("search:no-sources-defined","At least one source is required.",{allSources:r});throw ng.error(n),n}return i===sS?r.forEach((n,o)=>{s.push(this._getResultsFromSource(t,o,e))}):s.push(this._getResultsFromSource(t,i,e)),Ac(s)}async _getSuggestionsFromSources(t,e){const{allSources:r,activeSourceIndex:i}=this,s=[];if(!r.length){const n=new U("suggest:no-sources-defined","At least one source is required.",{allSources:r});throw ng.error(n),n}return i===sS?r.forEach((n,o)=>{s.push(this._getSuggestionsFromSource(t,o,e))}):s.push(this._getSuggestionsFromSource(t,i,e)),Ac(s)}async _getResultsFromSource(t,e,r){const i=e!=null?this.allSources.at(e):null;if(!i)return null;const{location:s=null}=t,n=this.view?.spatialReference||fge,o=Na(i,"maxResults")?i.maxResults:this.maxResults,a=!!(i instanceof Qb&&Na(i,"exactMatch"))&&i.exactMatch,{view:l}=this;return i.getResults?.({view:l,sourceIndex:e,location:s,suggestResult:t,spatialReference:n,exactMatch:a,maxResults:o},r)}async _getSuggestionsFromSource(t,e,r){const i=this.allSources.at(e);if(!i)return null;t??(t="");const s=Na(i,"suggestionsEnabled")?i.suggestionsEnabled:this.suggestionsEnabled,n=t?.length,o=Na(i,"minSuggestCharacters")?i.minSuggestCharacters:this.minSuggestCharacters;if(s&&t.trim()&&n>=o){const a=this.view?.spatialReference||fge,l=Na(i,"maxSuggestions")?i.maxSuggestions:this.maxSuggestions,{view:c}=this,h=!!(i instanceof Qb&&Na(i,"exactMatch"))&&i.exactMatch;return i.getSuggestions?.({view:c,sourceIndex:e,suggestTerm:t,spatialReference:a,maxSuggestions:l,exactMatch:h},r)}return null}_getLayerSourcePopupTemplate(t){const{layer:e}=t;if(e)return Na(t,"popupTemplate")?t.popupTemplate:e.popupTemplate}_getSourceIndexOfResult(t){const e=this.results;if(!e)return null;let r=null;return e.some(i=>i.results.some(s=>s===t&&(r=i.sourceIndex,!0))),r}async _goToSearchResult(t){this._abortGoTo();const e=new AbortController;this._gotoController=e;const r={target:{target:t},options:{signal:e.signal}};t||(r.options.animate=!1),await this.callGoTo(r),this._gotoController=null}_getDefaultSymbol(t){const{defaultSymbols:e}=this,r=t.feature?.geometry;if(r==null)return null;switch(r.type){case"point":case"multipoint":return e.point;case"polyline":return e.polyline;case"extent":case"polygon":return e.polygon;default:return null}}_removeHighlight(){this.removeHandles(pge)}async _getLayerView(t){const{view:e}=this;if(!t||!e||t.layer?.type==="building-component"||t.layer?.type==="subtype-sublayer")return null;const{layer:r}=t;return r?(await e.when(),e.whenLayerView(r)):null}_highlightFeature(t){const{graphic:e,layerView:r}=t,{attributes:i,layer:s}=e,{objectIdField:n}=s,o=(n&&i?.[n])??null,a=r.highlight(o??e);this.addHandles(a,pge)}_setResultFloor(t){const{view:e}=this,r=t.feature?.attributes,i=t.feature?.sourceLayer;if(i&&"floorInfo"in i&&i?.floorInfo?.floorField&&r){const s=r[i.floorInfo.floorField];e?.emit("select-result-floor",s)}}};gr.ALL_INDEX=sS,u([p()],gr.prototype,"_searching",void 0),u([p()],gr.prototype,"_updatingPromise",void 0),u([p({readOnly:!0,value:null})],gr.prototype,"activeSource",null),u([p()],gr.prototype,"activeSourceIndex",null),u([p()],gr.prototype,"allPlaceholder",null),u([p({readOnly:!0})],gr.prototype,"allSources",null),u([p()],gr.prototype,"autoNavigate",void 0),u([p()],gr.prototype,"autoSelect",void 0),u([p()],gr.prototype,"defaultPopupTemplate",void 0),u([p({readOnly:!0})],gr.prototype,"defaultSources",void 0),u([p()],gr.prototype,"defaultSymbols",void 0),u([p()],gr.prototype,"includeDefaultSources",void 0),u([p()],gr.prototype,"locationEnabled",null),u([p()],gr.prototype,"maxInputLength",void 0),u([p()],gr.prototype,"maxResults",void 0),u([p()],gr.prototype,"maxSuggestions",void 0),u([p()],gr.prototype,"messages",void 0),u([p()],gr.prototype,"minSuggestCharacters",void 0),u([p({readOnly:!0})],gr.prototype,"placeholder",null),u([p()],gr.prototype,"popupEnabled",void 0),u([p({type:Rv})],gr.prototype,"popupTemplate",void 0),u([p({type:en})],gr.prototype,"portal",void 0),u([p()],gr.prototype,"resultCount",void 0),u([p()],gr.prototype,"resultGraphicEnabled",void 0),u([p({readOnly:!0})],gr.prototype,"resultGraphic",void 0),u([p({readOnly:!0})],gr.prototype,"results",void 0),u([p({readOnly:!0})],gr.prototype,"selectedSuggestion",void 0),u([p()],gr.prototype,"searchAllEnabled",void 0),u([p({readOnly:!0})],gr.prototype,"selectedResult",void 0),u([p()],gr.prototype,"searchTerm",null),u([p({type:$4})],gr.prototype,"sources",void 0),u([p({readOnly:!0})],gr.prototype,"state",null),u([p()],gr.prototype,"suggestionDelay",void 0),u([p()],gr.prototype,"suggestionCount",void 0),u([p({readOnly:!0})],gr.prototype,"suggestions",void 0),u([p()],gr.prototype,"suggestionsEnabled",void 0),u([p({readOnly:!0})],gr.prototype,"updating",null),u([p()],gr.prototype,"view",void 0),u([p()],gr.prototype,"clear",null),gr=u([P(yDe)],gr);const SS=gr;let u_=class extends kx{constructor(t,e){super(t,e),this.messages=null,this.showMoreResultsOpen=!1,this.viewModel=null}destroy(){this.viewModel=null}render(){const t={[sg.showMoreResults]:this.showMoreResultsOpen};return gt("div",{class:sg.base},gt("div",{key:"esri-search-renderer__container",class:this.classes(sg.moreResults,t)},this.renderSearchResultName(),this.renderMoreResults()))}renderMoreResults(){return gt("div",{key:"esri-search-renderer__more-results"},this.renderMoreResultsButton(),this.renderMoreResultsLists())}renderSearchResultName(){const t=this.viewModel?.selectedResult,e=t&&t.name||"";return gt("div",{key:"esri-search-renderer__result-name",class:sg.moreResultsItem},e)}renderMoreResultsLists(){const{viewModel:t}=this;if(!t)return[];const e=t.results;if((t.resultCount??0)<2)return null;const r=e?.map(i=>this.renderMoreResultsList(i));return gt("div",{key:"esri-search-renderer__more-results-container",class:sg.moreResultsList},r)}renderMoreResultsButton(){const{messages:t,viewModel:e}=this;return e?(e.resultCount??0)<2?null:gt("div",{key:"esri-search-renderer__more-results-button",class:sg.moreResultsItem},gt("a",{class:sg.anchor,href:"#",bind:this,onclick:this._showMoreResultsClick,onkeydown:this._showMoreResultsClick},this.showMoreResultsOpen?t.hideMoreResults:t.showMoreResults)):null}renderMoreResultsHeader(t,e){return gt("div",{key:`esri-search-result-renderer__header-${e}`,class:sg.moreResultsListHeader},t)}renderMoreResultsList(t){const{results:e}=t,r=e?.length??0,i=r>0,s=this.viewModel?.selectedResult,n=r===1&&e[0]===s,o=this._getSourceName(t.source,t.sourceIndex),a=(this.viewModel?.results?.length??0)>1&&!n?this.renderMoreResultsHeader(o,t.sourceIndex):null,l=i&&e.map((h,d)=>this.renderMoreResultsListItem(h,d)),c=i&&!n?gt("ul",{key:`esri-search-result-renderer__list-${t.sourceIndex}`},l):null;return i?gt("div",{key:`esri-search-result-renderer__results-${t.sourceIndex}`},a,c):null}renderMoreResultsListItem(t,e){return t!==this.get("viewModel.selectedResult")?gt("li",{key:`esri-search-result-renderer__list-item-${e}`},gt("a",{class:sg.anchor,href:"#",tabindex:"0",bind:this,"data-result":t,onclick:this._selectResultClick,onkeydown:this._selectResultClick},t.name)):null}_showMoreResultsClick(t){t.preventDefault(),this.showMoreResultsOpen=!this.showMoreResultsOpen;const e=this.get("viewModel.view.popup");e&&e.reposition()}_selectResultClick(t){t.preventDefault();const e=t.currentTarget["data-result"];this.viewModel?.select(e)}_getSourceName(t,e){return e===SS.ALL_INDEX?this.messages.all:t.name}};u([p(),hx("esri/widgets/Search/t9n/Search")],u_.prototype,"messages",void 0),u([p()],u_.prototype,"showMoreResultsOpen",void 0),u([p()],u_.prototype,"viewModel",void 0),u([sC()],u_.prototype,"_showMoreResultsClick",null),u([sC()],u_.prototype,"_selectResultClick",null),u_=u([P("esri.widgets.Search.SearchResultRenderer")],u_);const ADt=u_;function ODt(t){return e=>{e.hasOwnProperty("_delegatedEventNames")||(e._delegatedEventNames=e._delegatedEventNames?e._delegatedEventNames.slice():[]);const r=e._delegatedEventNames,i=Array.isArray(t)?t:RDt(t);r.push(...i)}}function RDt(t){return t.split(",").map(e=>e.trim())}const MDt=/<[a-z/][\s\S]*>/i,PDt=(t,e)=>{const r=BDe(e).split(/\s/),i=new RegExp(`(${r.join("|")})`,"gi");return t.replace(i,s=>`<strong>${s}</strong>`)};let yr=class extends kx{constructor(t,e){super(t,e),this._activeMenuItemIndex=-1,this._inputNode=null,this._menuItemCount=0,this._sourceMenuButtonNode=null,this._sourceListNode=null,this._suggestionListNode=null,this._searchResultRenderer=new ADt,this._suggestController=null,this._searchController=null,this._locateFailed=!1,this._container=null,this.activeMenu="none",this.disabled=!1,this.iconClass=Et.widgetIcon,this.icon=null,this.messages=null,this.messagesCommon=null,this.viewModel=new SS,this._clearActiveMenu=()=>{this.activeMenu="none"},this._removeActiveMenu=r=>{const i=r.relatedTarget;i&&this._container?.contains(i)||this._clearActiveMenu()},this.addHandles([le(()=>this.searchTerm,r=>{(r&&this.activeMenu==="warning"||!r&&!this.get("viewModel.selectedSuggestion.location"))&&this._clearActiveMenu()}),_a(()=>this.viewModel?.allSources,"change",()=>this._watchSourceChanges()),le(()=>this.activeMenu,()=>this._resetActiveMenuItemIndex(),Pr),le(()=>this.viewModel?.defaultPopupTemplate,r=>{r&&(r.content=this._renderSearchResultsContent.bind(this))},Pr)])}destroy(){this.removeAllHandles(),this._cancelSuggest(),this._cancelSearch(),this._searchResultRenderer=Ne(this._searchResultRenderer)}get displayedSearchTerm(){return`${this.viewModel.searchTerm}`.trim()}get inputId(){return this._buildId("input")}get suggestionsMenuId(){return this._buildId("suggest-menu")}get sourceMenuId(){return this._buildId("source-menu")}get sourceMenuButtonId(){return this._buildId("source-menu-button")}get activeSource(){return this.viewModel?.activeSource}get activeSourceIndex(){return this.viewModel.activeSourceIndex}set activeSourceIndex(t){this.viewModel.activeSourceIndex=t}get allPlaceholder(){return this.viewModel.allPlaceholder}set allPlaceholder(t){this.viewModel.allPlaceholder=t}get allSources(){return this.viewModel.allSources}get autoNavigate(){return this.viewModel.autoNavigate}set autoNavigate(t){this.viewModel.autoNavigate=t}get autoSelect(){return this.viewModel.autoSelect}set autoSelect(t){this.viewModel.autoSelect=t}get defaultSources(){return this.viewModel.defaultSources}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(t){this.viewModel.goToOverride=t}get includeDefaultSources(){return this.viewModel.includeDefaultSources}set includeDefaultSources(t){this.viewModel.includeDefaultSources=t}get label(){return this.messages?.widgetLabel??""}set label(t){this._overrideIfSome("label",t)}get locationEnabled(){return this.viewModel.locationEnabled}set locationEnabled(t){this.viewModel.locationEnabled=t}get maxResults(){return this.viewModel.maxResults}set maxResults(t){this.viewModel.maxResults=t}get maxSuggestions(){return this.viewModel.maxSuggestions}set maxSuggestions(t){this.viewModel.maxSuggestions=t}get minSuggestCharacters(){return this.viewModel.minSuggestCharacters}set minSuggestCharacters(t){this.viewModel.minSuggestCharacters=t}get popupEnabled(){return this.viewModel.popupEnabled}set popupEnabled(t){this.viewModel.popupEnabled=t}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(t){this.viewModel.popupTemplate=t}get portal(){return this.viewModel?.portal}set portal(t){this.viewModel&&(this.viewModel.portal=t)}get resultGraphic(){return this.viewModel.resultGraphic}set resultGraphic(t){this.viewModel.resultGraphic=t}get resultGraphicEnabled(){return this.viewModel.resultGraphicEnabled}set resultGraphicEnabled(t){this.viewModel.resultGraphicEnabled=t}get results(){return this.viewModel.results}get searchAllEnabled(){return this.viewModel.searchAllEnabled}set searchAllEnabled(t){this.viewModel.searchAllEnabled=t}get searchTerm(){return this.viewModel.searchTerm}set searchTerm(t){this.viewModel.searchTerm=t}get selectedResult(){return this.viewModel.selectedResult}get sources(){return this.viewModel.sources}set sources(t){this.viewModel.sources=t}get suggestions(){return this.viewModel.suggestions}get suggestionsEnabled(){return this.viewModel.suggestionsEnabled}set suggestionsEnabled(t){this.viewModel.suggestionsEnabled=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}clear(){this.viewModel.clear()}focus(){this._inputNode?.focus(),this.emit("search-focus")}blur(){this._inputNode?.blur(),this.emit("search-blur")}async search(t){this._clearActiveMenu(),this._cancelSuggest(),this._cancelSearch();const e=new AbortController,{signal:r}=e;this._searchController=e;try{const i=await this.viewModel.search(t,{signal:r});return this._searchController!==e?void 0:(this.activeMenu=i?.numResults?"none":"warning",this._searchController=null,i)}catch{return this._searchController!==e?void 0:(this._clearActiveMenu(),void(this._searchController=null))}}async suggest(t){this._cancelSuggest();const e=new AbortController,{signal:r}=e;this._suggestController=e;try{const i=await this.viewModel.suggest(t,null,{signal:r});return this._suggestController!==e?void 0:(this._suggestController=null,i?.numResults&&this._openSuggestionMenu(),this._scrollToTopSuggestion(),i)}catch{return this._suggestController!==e||(this._suggestController=null),null}}render(){const{state:t}=this.viewModel,e={[Et.disabled]:t==="disabled",[Et.esriWidgetDisabled]:this.disabled};return gt("div",{class:this.classes(Et.base,e)},t==="loading"?this.renderLoader():this.renderContainer())}renderSubmitButton(){const{messages:t,disabled:e}=this;return gt("button",{"aria-label":t.searchButtonTitle,bind:this,disabled:e,class:this.classes(Et.submitButton,Et.button),key:"esri-search__submit-button",onclick:this._handleSearchButtonClick,title:t.searchButtonTitle,type:"button"},gt("span",{"aria-hidden":"true",class:Et.searchIcon}))}renderWarningMenu(){return gt("div",{key:"esri-search__error-menu",class:this.classes(Et.menu,Et.warningMenu)},gt("div",{class:Et.warningMenuBody},this.renderWarning()))}renderSourceMenuButton(){const{messages:t,activeMenu:e,sourceMenuId:r,sourceMenuButtonId:i,disabled:s}=this,{activeSourceIndex:n,allSources:o}=this.viewModel;return o.length>1?gt("button",{id:i,key:"esri-search__source-menu-button",bind:this,disabled:s,"aria-label":t.searchIn,title:t.searchIn,"aria-haspopup":"true","aria-expanded":(e==="source").toString(),"aria-controls":r,class:this.classes(Et.sourcesButton,Et.button),onclick:this._handleSourcesMenuToggleClick,onfocus:this._handleSourcesMenuToggleFocus,afterCreate:XI,"data-node-ref":"_sourceMenuButtonNode",type:"button"},gt("span",{"aria-hidden":"true",class:Et.dropdownIcon}),gt("span",{"aria-hidden":"true",class:Et.dropupIcon}),gt("span",{class:Et.sourceName},this._getSourceName(n))):null}renderSourcesList(){const{allSources:t,searchAllEnabled:e}=this.viewModel,{_activeMenuItemIndex:r,activeMenu:i,sourceMenuId:s,sourceMenuButtonId:n}=this,o=i==="source"&&r>-1?this._buildId("source-item",r):null;return t.length>1?gt("ul",{"aria-activedescendant":o,"aria-labelledby":n,id:s,role:"menu",bind:this,afterCreate:XI,onkeydown:this._handleSourceMenuKeydown,onkeyup:this._handleSourceMenuKeyup,"data-node-ref":"_sourceListNode",class:Et.menuList,tabIndex:-1},e?this.renderSource(SS.ALL_INDEX):null,t.map((a,l)=>this.renderSource(l)).toArray()):null}renderSourcesMenu(){const{allSources:t}=this.viewModel;return t.length>1?gt("div",{key:"esri-search__source-menu",class:this.classes(Et.menu,Et.sourcesMenu)},this.renderSourcesList()):null}renderLoader(){const{messages:t,messagesCommon:e,disabled:r}=this;return gt("div",{class:Et.loader,key:"base-loader",tabIndex:r?-1:void 0},gt("span",{"aria-hidden":"true",class:Et.loaderAnimation}),gt("span",{class:Et.fallbackText},t.searchButtonTitle),gt("span",{class:Et.loaderText},e.loading))}renderContainer(){const{allSources:t,state:e}=this.viewModel,{activeMenu:r}=this,i={[Et.hasMultipleSources]:t.length>1,[Et.isLoading]:e==="loading",[Et.isSearching]:e==="searching",[Et.showWarning]:r==="warning",[Et.showSources]:r==="source",[Et.showSuggestions]:r==="suggestion"};return gt("div",{tabIndex:-1,afterCreate:s=>{this._container=s,s.addEventListener("focusout",this._removeActiveMenu)},afterRemoved:s=>{s.removeEventListener("focusout",this._removeActiveMenu)},class:this.classes(i,Et.container),key:"base-container"},this.renderSourceMenuButton(),this.renderSourcesMenu(),this.renderInputContainer(),this.renderSubmitButton(),this.renderWarningMenu())}renderClearButton(){return this.searchTerm?gt("button",{bind:this,disabled:this.disabled,class:this.classes(Et.clearButton,Et.button),key:"esri-search__clear-button",onclick:this._handleClearButtonClick,onfocus:this._clearActiveMenu,title:this.messages.clearButtonTitle,type:"button"},gt("span",{"aria-hidden":"true",class:Et.clearIcon})):null}renderLocationGroup(){const{messages:t,locationEnabled:e,displayedSearchTerm:r}=this,i=e&&!r,s=this.activeMenu==="suggestion"&&this._activeMenuItemIndex===0;return i?gt("ul",{role:"group",key:"esri-search__suggestion-list-current-location",class:this.classes(Et.menuList,Et.suggestionList,Et.suggestionListCurrentLocation)},gt("li",{bind:this,"data-current-location-item":!0,onclick:this._handleUseCurrentLocationClick,id:this._buildId("suggestion-item",0),"aria-selected":(this.activeMenu==="suggestion"&&this._activeMenuItemIndex===0).toString(),role:"option",class:this.classes(Et.menuItem,s?Et.menuItemFocus:null)},gt("span",{"aria-hidden":"true",class:Et.locate})," ",t.useCurrentLocation)):null}renderInput(){const{activeMenu:t,locationEnabled:e,displayedSearchTerm:r,messages:i,suggestionsMenuId:s,inputId:n,_activeMenuItemIndex:o,disabled:a}=this,{maxInputLength:l,placeholder:c,searchTerm:h,suggestionCount:d}=this.viewModel,f=!(!(e&&!r)&&!d),m=t==="suggestion"&&o>-1?this._buildId("suggestion-item",o):null;return gt("input",{"aria-activedescendant":m,"aria-autocomplete":"list","aria-expanded":(f&&t==="suggestion").toString(),"aria-controls":f?s:null,"aria-haspopup":"listbox","aria-label":i.searchButtonTitle,bind:this,disabled:a,placeholder:c,maxlength:l,autocomplete:"off",type:"text",class:this.classes(Et.esriInput,Et.input),value:h,id:n,role:"combobox",onkeyup:this._handleInputKeyup,onclick:this._openSuggestionMenu,oninput:this._handleInputPaste,onpaste:this._handleInputPaste,afterCreate:XI,"data-node-ref":"_inputNode",onfocus:this.focus,onblur:this.blur,title:h?"":c})}renderForm(){return gt("form",{key:"esri-search__form",bind:this,disabled:this.disabled,class:Et.form,onsubmit:this._formSubmit,role:"search"},this.renderInput())}renderSuggestList(t){const{sourceIndex:e}=t,{results:r}=t;return r?.length?gt("ul",{role:"group",key:`esri-search__suggestion-list-${e}`,class:this.classes(Et.menuList,Et.suggestionList)},r?.map(s=>this.renderSuggestion(s,this._menuItemCount++))):null}renderSuggestionsGroup(){const{suggestions:t}=this.viewModel;return t?t.map(e=>[this.renderSuggestionHeader(e),this.renderSuggestList(e)]):[]}renderSuggestionsMenu(){const{displayedSearchTerm:t,locationEnabled:e,suggestionsMenuId:r,inputId:i}=this,{suggestionCount:s}=this.viewModel,n=e&&!t||s;return this._menuItemCount=0,n?gt("div",{id:r,key:"esri-search__suggestions-menu",class:this.classes(Et.menu,Et.suggestionsMenu),role:"listbox","aria-labelledby":i,bind:this,afterCreate:XI,"data-node-ref":"_suggestionListNode"},this.renderLocationGroup(),this.renderSuggestionsGroup()):null}renderInputContainer(){return gt("div",{key:"esri-search__input-container",class:Et.inputContainer},this.renderForm(),this.renderSuggestionsMenu(),this.renderClearButton())}renderSuggestionHeader(t){const{allSources:e,activeSourceIndex:r}=this.viewModel,{sourceIndex:i}=t,s=t.results?.length,n=e.length>1&&r===SS.ALL_INDEX;return s&&n?gt("div",{key:`esri-search__suggestion-header-${i}`,class:Et.menuHeader},this._getSourceName(i)):null}renderSuggestion(t,e){const{_activeMenuItemIndex:r,viewModel:{searchTerm:i}}=this;if(!i)return;const s=this.activeMenu==="suggestion"&&r===e;return gt("li",{bind:this,id:this._buildId("suggestion-item",e),"aria-selected":(this.activeMenu==="suggestion"&&this._activeMenuItemIndex===e).toString(),onclick:this._handleSuggestionClick,key:`esri-search__suggestion_${e}`,"data-suggestion":t,role:"option",innerHTML:this._getSuggestResultHTML(t.text,i),class:this.classes(Et.menuItem,s?Et.menuItemFocus:null)})}renderSource(t){const{activeSourceIndex:e,searchAllEnabled:r}=this.viewModel,i={[Et.menuItemActive]:t===e,[Et.menuItemFocus]:this.activeMenu==="source"&&t===(r?this._activeMenuItemIndex-1:this._activeMenuItemIndex)},s=r?t+1:t;return gt("li",{bind:this,key:`esri-search__source-${t}`,id:this._buildId("source-item",s),"aria-checked":(t===e).toString(),onclick:this._handleSourceClick,"data-source-index":t,role:"menuitemradio",class:this.classes(Et.source,Et.menuItem,i)},this._getSourceName(t))}renderNoResultsWarning(t){const{messages:e}=this,r=t?E1e(e.noResultsFoundForValue,{value:`"${t}"`}):e.noResultsFound;return gt("div",{key:"esri-search__no_results"},gt("div",{class:Et.warningMenuHeader},e.noResults),gt("div",{class:Et.warningMenuText},r))}renderEmptySearchWarning(){const{messages:t}=this;return gt("div",{key:"esri-search__empty-search"},gt("span",{"aria-hidden":"true",class:Et.noticeIcon}),gt("span",{class:Et.noValueText},t.emptyValue))}renderLocateWarning(){const{messages:t}=this;return gt("div",{key:"esri-search__locate-error"},gt("span",{"aria-hidden":"true",class:Et.noticeIcon}),gt("span",{class:Et.noValueText},t.locateError))}renderWarning(){const{displayedSearchTerm:t,_locateFailed:e}=this,{viewModel:r}=this;return e?this.renderLocateWarning():r.selectedSuggestion?.location||t?this.renderNoResultsWarning(t):this.renderEmptySearchWarning()}_resetActiveMenuItemIndex(){this._activeMenuItemIndex=-1}_buildId(t,e){return`${this.id}-${t}${e===void 0?"":`-${e}`}`}_watchSourceChanges(){const{viewModel:{allSources:t}}=this,e="sources";this.removeHandles(e),t.forEach(r=>this.addHandles(le(()=>r.name,()=>this.scheduleRender()),e))}_handleSourcesMenuToggleFocus(){this.activeMenu!=="source"&&this._clearActiveMenu()}_handleSourcesMenuToggleClick(){const t=this.activeMenu==="source";this.activeMenu=t?"none":"source",this.renderNow(),this.activeMenu==="source"&&this._sourceListNode?.focus()}_handleClearButtonClick(){this.viewModel.clear(),this._focus()}_handleSearchButtonClick(){this.search()}_handleSuggestionClick(t){const e=mge(t.currentTarget);e&&(this._focus(),this.search(e))}_handleUseCurrentLocationClick(){this._useCurrentLocation()}_useCurrentLocation(){this._focus("none"),this._cancelSuggest(),this._cancelSearch();const t=new AbortController,{signal:e}=t;this._searchController=t,(async()=>{try{const r=await this.viewModel.searchNearby({signal:e});this.activeMenu=r?.numResults?"none":"warning"}catch{this._locateFailed=!0,this.activeMenu="warning"}finally{this._searchController=null}})()}_handleSourceClick(t){this._setSourceFromMenuItem(t.currentTarget)}_setSourceFromMenuItem(t){if(!t)return;const e=IDt(t);e!=null&&(this.viewModel.activeSourceIndex=e,this._clearActiveMenu(),this._sourceMenuButtonNode?.focus())}_cancelSuggest(){this._suggestController=zl(this._suggestController)}_cancelSearch(){this._searchController=zl(this._searchController),this._locateFailed=!1}_handleInputKeyup(t){const e=RD(t);if(t.ctrlKey||t.metaKey||e==="Copy"||e==="ArrowLeft"||e==="ArrowRight"||e==="Shift")return;if(e==="Tab"||e==="Escape"||t.shiftKey&&e==="Tab")return this._cancelSuggest(),void(e==="Escape"&&this._clearActiveMenu());const r=e==="Home"||e==="End"||e==="ArrowUp"||e==="ArrowDown";if(e==="Enter"&&this._activeMenuItemIndex<0)return void this._cancelSuggest();const i=this._suggestionListNode?.getElementsByTagName("li");if(i?.length){if(this.activeMenu!=="suggestion"&&this._openSuggestionMenu(),r)return t.preventDefault(),this._cancelSuggest(),void this._handleItemNavigation(e,i,this._suggestionListNode);const s=i[this._activeMenuItemIndex];if(e==="Enter"&&s){const n=mge(s);return void(n?(this._focus(),this.search(n)):$Dt(s)&&this._useCurrentLocation())}}this.viewModel.searchTerm&&this.suggest()}_handleItemNavigation(t,e,r){const i=this._activeMenuItemIndex;t==="Home"&&(this._activeMenuItemIndex=0),t==="End"&&(this._activeMenuItemIndex=e.length-1),t==="ArrowUp"&&(this._activeMenuItemIndex=this._activeMenuItemIndex<=0?e.length-1:this._activeMenuItemIndex-1),t==="ArrowDown"&&(this._activeMenuItemIndex=this._activeMenuItemIndex===e.length-1?0:this._activeMenuItemIndex+1),i!==this._activeMenuItemIndex&&r&&JGe(e[this._activeMenuItemIndex],r)}_scrollToTopSuggestion(){this._suggestionListNode&&(this._suggestionListNode.scrollTop=0)}_openSuggestionMenu(){this.activeMenu="suggestion"}_handleInputPaste(t){const e=t.target;this.viewModel.searchTerm!==e.value&&(this.viewModel.searchTerm=e.value),this.viewModel.searchTerm&&this.suggest()}_handleSourceMenuKeydown(t){const e=RD(t);if(Awe(e)){t.preventDefault();const r=this._sourceListNode?.getElementsByTagName("li"),i=r?.[this._activeMenuItemIndex];this._setSourceFromMenuItem(i)}else e!=="ArrowUp"&&e!=="ArrowDown"&&e!=="End"&&e!=="Home"||t.preventDefault()}_handleSourceMenuKeyup(t){const e=RD(t),r=e==="ArrowUp"||e==="ArrowDown"||e==="End"||e==="Home";if(r&&t.preventDefault(),e==="Escape")return this._clearActiveMenu(),void this._sourceMenuButtonNode?.focus();const i=this._sourceListNode?.getElementsByTagName("li");return i&&i.length!==0&&r?(this.activeMenu!=="source"&&(this.activeMenu="source"),void this._handleItemNavigation(e,i,this._sourceListNode?.parentElement)):void 0}_focus(t){this.focus(),t&&(this.activeMenu=t)}_formSubmit(t){t.preventDefault(),this._activeMenuItemIndex===-1&&this.search()}_getSourceName(t){const{messages:e}=this,r=this.viewModel,{allSources:i}=r,s=i.at(t);return t===SS.ALL_INDEX?e.all:s&&s.name||e.untitledSource}_getSuggestResultHTML(t,e){return t?MDt.test(t)?t:PDt(t,e):this.messages.untitledResult}_renderSearchResultsContent(){return this._searchResultRenderer.showMoreResultsOpen=!1,this._searchResultRenderer.viewModel=this.viewModel,this._searchResultRenderer}};function mge(t){return t?.["data-suggestion"]}function IDt(t){return t?.["data-source-index"]}function $Dt(t){return!!t?.["data-current-location-item"]}u([p()],yr.prototype,"_activeMenuItemIndex",void 0),u([p()],yr.prototype,"displayedSearchTerm",null),u([p({readOnly:!0})],yr.prototype,"inputId",null),u([p({readOnly:!0})],yr.prototype,"suggestionsMenuId",null),u([p({readOnly:!0})],yr.prototype,"sourceMenuId",null),u([p({readOnly:!0})],yr.prototype,"sourceMenuButtonId",null),u([p()],yr.prototype,"activeMenu",void 0),u([p({readOnly:!0})],yr.prototype,"activeSource",null),u([p()],yr.prototype,"activeSourceIndex",null),u([p()],yr.prototype,"allPlaceholder",null),u([p({readOnly:!0})],yr.prototype,"allSources",null),u([p()],yr.prototype,"autoNavigate",null),u([p()],yr.prototype,"autoSelect",null),u([p({readOnly:!0})],yr.prototype,"defaultSources",null),u([p()],yr.prototype,"disabled",void 0),u([p()],yr.prototype,"goToOverride",null),u([p()],yr.prototype,"iconClass",void 0),u([p()],yr.prototype,"icon",void 0),u([p()],yr.prototype,"includeDefaultSources",null),u([p()],yr.prototype,"label",null),u([p()],yr.prototype,"locationEnabled",null),u([p()],yr.prototype,"maxResults",null),u([p()],yr.prototype,"maxSuggestions",null),u([p(),hx("esri/widgets/Search/t9n/Search")],yr.prototype,"messages",void 0),u([p(),hx("esri/t9n/common")],yr.prototype,"messagesCommon",void 0),u([p()],yr.prototype,"minSuggestCharacters",null),u([p()],yr.prototype,"popupEnabled",null),u([p()],yr.prototype,"popupTemplate",null),u([p()],yr.prototype,"portal",null),u([p()],yr.prototype,"resultGraphic",null),u([p()],yr.prototype,"resultGraphicEnabled",null),u([p({readOnly:!0})],yr.prototype,"results",null),u([p()],yr.prototype,"searchAllEnabled",null),u([p()],yr.prototype,"searchTerm",null),u([p({readOnly:!0})],yr.prototype,"selectedResult",null),u([p()],yr.prototype,"sources",null),u([p({readOnly:!0})],yr.prototype,"suggestions",null),u([p()],yr.prototype,"suggestionsEnabled",null),u([p()],yr.prototype,"view",null),u([ODt(["search-complete","search-clear","search-start","select-result","suggest-start","suggest-complete"]),p({type:SS})],yr.prototype,"viewModel",void 0),yr=u([P("esri.widgets.Search")],yr);const LDt=yr;function _De(t){const e={};for(const r of Object.keys(t.attributes))e[r.toLowerCase()]=t.attributes[r];t.attributes=e}async function DDt(t){try{return await t}catch(e){if(!ds(e))throw e;return}}function NDt(t,e,r,i){const s=new LDt({view:t,sources:[new Qb({layer:e,outFields:["*"],autoNavigate:!0,searchFields:[r],displayField:r,exactMatch:!1,placeholder:"Ex: Empire State Building",popupEnabled:!1})],maxResults:10,resultGraphicEnabled:!1,includeDefaultSources:!1});s.on("select-result",function(n){const o=n.result.feature;_De(o),i.selectedBuilding=o}),t.ui.add(s,{position:"top-right"})}function FDt(){vDe().style.display="inline"}function UDt(){vDe().style.display="none"}function vDe(){return document.querySelector(".esri-component.esri-search.esri-widget")}function kDt(t,e){for(let i=0;i<Pi.categories.length;i++){const s=Pi.initCategory===Pi.categories[i].value?"selected":"",n=document.createElement("button");n.id="category-"+Pi.categories[i].value,n.value=Pi.categories[i].value,n.innerHTML=Pi.categories[i].text,n.className=s,n.addEventListener("click",o=>r(o)),document.getElementById(t).appendChild(n)}function r(i){const s=i.target;document.getElementById("category-"+e.selectedCategory).classList.remove("selected"),document.getElementById("category-"+s.value).classList.add("selected"),e.selectedCategory=s.value}}var zDt=Object.defineProperty,VDt=Object.getOwnPropertyDescriptor,hI=(t,e,r,i)=>{for(var s=i>1?void 0:i?VDt(e,r):e,n=t.length-1,o;n>=0;n--)(o=t[n])&&(s=(i?o(e,r,s):o(s))||s);return i&&s&&zDt(e,r,s),s};let _x=class extends Te{constructor(){super(...arguments),this.selectedPeriod=Pi.initPeriod,this.selectedBuilding=null,this.filteredBuildings=null,this.selectedCategory=Pi.initCategory}};hI([p()],_x.prototype,"selectedPeriod",2);hI([p()],_x.prototype,"selectedBuilding",2);hI([p()],_x.prototype,"filteredBuildings",2);hI([p()],_x.prototype,"selectedCategory",2);_x=hI([P("skyscraper-explorer.State")],_x);const L4={view:"viewDiv",timeline:"timeDiv",heightGraph:"heightDiv",categories:"categoryDiv"},lp=new _x;let TY,dC,gge,OD=null;const kte=new d_e({basemap:"gray",ground:"world-elevation"}),dm=new R2t({container:L4.view,map:kte,padding:{top:50},camera:{position:{x:-8.2408269778516665e6,y:496775695441402e-8,z:1472.4,spatialReference:new qe({wkid:3857})},heading:59,tilt:49},constraints:{tilt:{max:90,mode:"manual"}},highlightOptions:Pi.highlightOptions,popup:{dockEnabled:!0,dockOptions:{buttonEnabled:!1,breakpoint:!1},actions:[],autoOpenEnabled:!1},environment:{lighting:{ambientOcclusionEnabled:!0,directShadowsEnabled:!1}}});dm.ui.empty("top-left");const BDt=[Pi.buildingOptions.minHeight,Pi.buildingOptions.maxHeight],GDt=bDe(BDt),gU=new O$e({url:Pi.buildingsUrl,popupEnabled:!1,outFields:["*"],definitionExpression:GDt}),zte=new X3t(gU,"CNSTRCT_YR"),vx=new tP({url:Pi.infoPointsUrl,popupEnabled:!1,elevationInfo:{mode:"relative-to-scene"},outFields:["*"],returnZ:!1,featureReduction:{type:"selection"},renderer:zte.createUniqueValueRenderer("WIKI",{value:1,image:"./img/wiki.png"}),visible:!1});kte.addMany([gU,vx]);Y3t("./data/manhattan-boroughs.json",kte);NDt(dm,vx,"NAME",lp);const Vte=vx.createQuery();Vte.outFields=["OBJECTID","NAME","HEIGHTROOF","CNSTRCT_YR","WIKI","TOP20"];Vte.returnGeometry=!0;vx.queryFeatures(Vte).then(jDt).catch(console.error);function jDt(t){for(let e=0;e<t.features.length;e++)_De(t.features[e]);TY=t.features,kDt(L4.categories,lp),dC=new n$t(L4.heightGraph,TY,lp),gge=new o$t(L4.timeline,lp),le(()=>lp.selectedPeriod,e=>{zte.applyClassBreaksRenderer(e,lp),dC.updatePeriod(e),gge.update(e)},{initial:!0})}dm.whenLayerView(gU).then(t=>{let e;le(()=>lp.selectedBuilding,r=>{e?.abort(),e=new AbortController;const{signal:i}=e;DDt(HDt(r,t,i))})}).catch(console.error);async function HDt(t,e,r){if(OD&&(dC.deselect(),OD.remove(),OD=null,FDt()),t){UDt(),OLt(t.geometry,t.attributes,dm),dC.select(t),OD=e.highlight([t.attributes.objectid]),await dm.goTo(t.geometry,{duration:1e3,easing:"out-expo",signal:r}),await d0(()=>!e.updating,r);const i=new j0;i.outFields=["*"],i.objectIds=[t.attributes.objectid];const s=await e.queryExtent(i,{signal:r}),n=o=>{if(r.aborted)return;const a=document.getElementById("loading");o.extent!==null?(a.style.display="none",dm.goTo({target:o.extent.expand(3),tilt:60},{duration:1e3,easing:"out-expo",signal:r})):(a.style.display="inline",e.queryExtent(i,{signal:r}).then(l=>{window.setTimeout(()=>n(l),1e3)}))};n(s)}}Iu(()=>lp.filteredBuildings,function(t){const e=bDe(t);gU.definitionExpression=e,vx.definitionExpression=e,dC.updateFilter(t)});le(()=>lp.selectedCategory,t=>{zte.applyCategory(t),dC.applyCategory(t),t==="info"?vx.visible=!0:vx.visible=!1});dm.on("click",function(t){dm.hitTest(t).then(function(e){if(e.results.length===0)return;const r=e.results[0],i=r.type==="graphic"?r.graphic:null;if(i&&i.layer.title==="Buildings Manhattan wiki"){const s=qDt(i);s&&(lp.selectedBuilding=s)}})});le(()=>dm.popup?.visible,t=>{const e=!!dm.popup.content;!t&&e&&(lp.selectedBuilding=null)});function qDt(t){return TY.filter(function(r){return r.attributes.objectid===t.attributes.OBJECTID})[0]}document.getElementById("impressumLink").addEventListener("click",function(){document.getElementById("impressumContainer").style.display="inline"});document.getElementById("close").addEventListener("click",function(){document.getElementById("impressumContainer").style.display="none"});function bDe(t){return"HEIGHTROOF > "+t[0]+" AND HEIGHTROOF < "+t[1]+" AND CNSTRCT_YR >= 1900 AND CNSTRCT_YR <= 2024"}export{art as $,EMe as A,zvt as B,iTe as C,yF as D,UWe as E,Oat as F,Wot as G,Jot as H,Lee as I,zK as J,Kgt as K,Qgt as L,H9 as M,e0t as N,xF as O,jnt as P,b1t as Q,PMe as R,vqe as S,T1t as T,LMe as U,ovt as V,E1t as W,FMe as X,Tat as Y,Z9 as Z,uRe as _,eTe as a,zl as a$,F1t as a0,q1t as a1,ibt as a2,nbt as a3,abt as a4,Rot as a5,UMe as a6,z1t as a7,Sbt as a8,$ct as a9,o8e as aA,a8e as aB,MY as aC,gfe as aD,fZ as aE,FYt as aF,CDe as aG,tP as aH,Ac as aI,hw as aJ,en as aK,Ix as aL,zYt as aM,kYt as aN,CSt as aO,g4t as aP,gm as aQ,Iu as aR,tv as aS,T0e as aT,le as aU,Wr as aV,Pw as aW,Tq as aX,bgt as aY,Ls as aZ,vC as a_,uut as aa,qdt as ab,dpt as ac,opt as ad,tm as ae,$i as af,Pr as ag,Ne as ah,u as ai,p as aj,Su as ak,P as al,t8 as am,Kre as an,Te as ao,$Yt as ap,IYt as aq,Eo as ar,ee as as,U as at,i6e as au,t6e as av,K as aw,Pt as ax,Iw as ay,Bl as az,TTe as b,ur as b$,Mn as b0,he as b1,$R as b2,nl as b3,_a as b4,Q6 as b5,Yi as b6,cE as b7,WDt as b8,ku as b9,j0 as bA,zkt as bB,P7t as bC,$Zt as bD,WZt as bE,uce as bF,vt as bG,R3t as bH,RZt as bI,hEt as bJ,Iv as bK,ke as bL,qf as bM,Pv as bN,Ex as bO,St as bP,Kw as bQ,Sv as bR,Vt as bS,ZDt as bT,k7 as bU,vge as bV,FP as bW,e8 as bX,$S as bY,u0 as bZ,Yt as b_,Ks as ba,C as bb,We as bc,eC as bd,An as be,GK as bf,Nx as bg,Dt as bh,Ln as bi,Ei as bj,Qs as bk,qe as bl,mm as bm,pt as bn,_e as bo,ne as bp,O as bq,lM as br,mM as bs,uSt as bt,ds as bu,Mzt as bv,Pzt as bw,DZ as bx,tit as by,T0 as bz,CXe as c,u_e as c$,YEt as c0,ZEt as c1,JEt as c2,ae as c3,GIe as c4,U9 as c5,Hi as c6,tt as c7,Pe as c8,nt as c9,Ta as cA,mr as cB,bx as cC,jft as cD,jh as cE,B4e as cF,YCt as cG,Be as cH,K1e as cI,zbe as cJ,dBt as cK,ni as cL,MD as cM,Fit as cN,gn as cO,E5t as cP,xzt as cQ,zt as cR,Uc as cS,VSt as cT,DYt as cU,Wye as cV,a7e as cW,cw as cX,$w as cY,IZ as cZ,PZ as c_,ue as ca,qo as cb,Co as cc,MIe as cd,m4t as ce,h$e as cf,e6t as cg,gP as ch,cr as ci,R5 as cj,wE as ck,F6 as cl,$5e as cm,Uo as cn,L5e as co,D5e as cp,N5e as cq,ve as cr,bHe as cs,d0 as ct,r6t as cu,Fjt as cv,gee as cw,m8 as cx,B6 as cy,Ts as cz,mYe as d,i9e as d$,$Z as d0,U4t as d1,M4t as d2,SZt as d3,Wfe as d4,TZt as d5,y3t as d6,A$e as d7,o9e as d8,H3t as d9,zo as dA,agt as dB,tM as dC,Oe as dD,Ax as dE,TIe as dF,mN as dG,Yte as dH,bp as dI,BDe as dJ,xvt as dK,Tvt as dL,mvt as dM,OWt as dN,HF as dO,Dqt as dP,Evt as dQ,T5e as dR,Jee as dS,Wrt as dT,w9e as dU,Ust as dV,kst as dW,LZ as dX,LCe as dY,gzt as dZ,mzt as d_,N9e as da,b8 as db,gM as dc,Ox as dd,Qf as de,ej as df,Ms as dg,KG as dh,rj as di,A5 as dj,q1e as dk,y4t as dl,$M as dm,KFe as dn,us as dp,ZCe as dq,B0 as dr,gHe as ds,qNt as dt,yIe as du,RIe as dv,PIe as dw,ete as dx,lgt as dy,Gi as dz,EYe as e,PXt as e$,zZ as e0,i5t as e1,s5t as e2,e5t as e3,r5t as e4,fa as e5,r8e as e6,yzt as e7,xst as e8,HRe as e9,zu as eA,SP as eB,$v as eC,RCt as eD,gIe as eE,sEt as eF,jg as eG,cFt as eH,Im as eI,P0e as eJ,LCt as eK,$E as eL,Ki as eM,ip as eN,VJ as eO,_u as eP,wr as eQ,gC as eR,$Xt as eS,DXt as eT,IXt as eU,yPe as eV,XXt as eW,Xxt as eX,zXt as eY,Bxt as eZ,_Nt as e_,gA as ea,ci as eb,Qr as ec,wm as ed,Lc as ee,ls as ef,O5 as eg,Am as eh,d9t as ei,gAe as ej,PI as ek,$ze as el,BNt as em,n4t as en,mD as eo,Ofe as ep,Fc as eq,_C as er,iEt as es,ngt as et,IIe as eu,iM as ev,Gr as ew,AIe as ex,SIe as ey,Vc as ez,ust as f,WO as f$,YXt as f0,GVe as f1,ie as f2,ze as f3,xe as f4,$ge as f5,B7 as f6,X1e as f7,R7t as f8,c_e as f9,zr as fA,tp as fB,G1e as fC,Uae as fD,_c as fE,vu as fF,Op as fG,Y8t as fH,yP as fI,Xo as fJ,es as fK,dw as fL,G6 as fM,li as fN,ya as fO,m0 as fP,Di as fQ,TXt as fR,OB as fS,LYt as fT,cfe as fU,OSt as fV,d$e as fW,kSt as fX,E$e as fY,Jb as fZ,fh as f_,JR as fa,Av as fb,ov as fc,W5e as fd,A1e as fe,Ii as ff,y9 as fg,Cc as fh,bYt as fi,CP as fj,QE as fk,$r as fl,p0 as fm,eEt as fn,uE as fo,ol as fp,xre as fq,WNt as fr,MXt as fs,E4t as ft,wgt as fu,gFt as fv,M6 as fw,_je as fx,$u as fy,Zre as fz,uQ as g,EIe as g$,YO as g0,wSt as g1,pIe as g2,iU as g3,Rv as g4,u$e as g5,x3t as g6,Fx as g7,Hkt as g8,jkt as g9,mi as gA,de as gB,xs as gC,W7e as gD,mp as gE,Dp as gF,yw as gG,J5t as gH,eBe as gI,ks as gJ,vNt as gK,u5e as gL,pE as gM,JY as gN,ENe as gO,jr as gP,eW as gQ,tW as gR,S4t as gS,ite as gT,h8 as gU,uv as gV,ECt as gW,xCt as gX,pEt as gY,p5 as gZ,f_e as g_,xv as ga,Up as gb,qP as gc,cv as gd,h0t as ge,yxt as gf,FZ as gg,Eh as gh,eie as gi,g0 as gj,br as gk,_P as gl,il as gm,Hje as gn,x5e as go,Ekt as gp,wo as gq,wYt as gr,iSt as gs,nS as gt,aj as gu,Mkt as gv,x4t as gw,Akt as gx,Ic as gy,Kb as gz,bXe as h,gF as h$,sU as h0,WC as h1,a6 as h2,iX as h3,rU as h4,xIe as h5,ate as h6,c$e as h7,X8e as h8,W8e as h9,fp as hA,bs as hB,et as hC,pi as hD,Zft as hE,Ve as hF,BBe as hG,A_ as hH,Js as hI,Fi as hJ,So as hK,EQ as hL,yXt as hM,FGt as hN,Bft as hO,OS as hP,vA as hQ,oM as hR,uzt as hS,Sr as hT,Dc as hU,Nl as hV,w as hW,vs as hX,Fu as hY,rt as hZ,Ie as h_,y8e as ha,Vre as hb,ba as hc,USt as hd,_0 as he,nC as hf,zw as hg,x5t as hh,_R as hi,JG as hj,J_ as hk,MB as hl,Qre as hm,AS as hn,pm as ho,_p as hp,eP as hq,nte as hr,SSt as hs,TSt as ht,xSt as hu,F as hv,pe as hw,ji as hx,lr as hy,ri as hz,HCe as i,WOe as i$,Lm as i0,dt as i1,Or as i2,zc as i3,Se as i4,B as i5,gi as i6,Lr as i7,Rr as i8,Tr as i9,l9t as iA,c9t as iB,J5 as iC,kne as iD,VVe as iE,$n as iF,U1e as iG,rd as iH,sl as iI,pn as iJ,dJ as iK,B8t as iL,ma as iM,_m as iN,Fl as iO,ai as iP,gv as iQ,q7t as iR,j7t as iS,W7t as iT,g8 as iU,H7t as iV,Qct as iW,tut as iX,ki as iY,Kct as iZ,eut as i_,Mt as ia,V0 as ib,U8 as ic,Uv as id,jl as ie,d9 as ig,Bt as ih,Tm as ii,Cv as ij,kv as ik,m9 as il,jo as im,DK as io,p9 as ip,VC as iq,mot as ir,QJ as is,eK as it,G8t as iu,ex as iv,T9 as iw,Qa as ix,sZe as iy,Ok as iz,ax as j,wIe as j$,Bo as j0,I3t as j1,CZt as j2,PZt as j3,C4t as j4,QRe as j5,BTe as j6,vFe as j7,fE as j8,$kt as j9,xE as jA,C5t as jB,ws as jC,tNt as jD,nx as jE,UYt as jF,ZIe as jG,DY as jH,Bw as jI,Y2 as jJ,mEt as jK,lZt as jL,XIe as jM,Mw as jN,j4 as jO,cK as jP,yC as jQ,aI as jR,REt as jS,KSt as jT,G0 as jU,tU as jV,Zee as jW,rZt as jX,tZt as jY,eZt as jZ,XEt as j_,$_ as ja,HBe as jb,_ge as jc,O3t as jd,bF as je,Ni as jf,Nt as jg,Nh as jh,fe as ji,Nce as jj,_S as jk,J8t as jl,Ge as jm,zs as jn,xDe as jo,Pu as jp,JDt as jq,fNt as jr,s0e as js,OY as jt,ei as ju,Wh as jv,H1e as jw,EU as jx,Rie as jy,z4t as jz,M0t as k,X8 as k$,IEt as k0,LEt as k1,Jwe as k2,gEt as k3,yEt as k4,_Et as k5,bEt as k6,wEt as k7,xEt as k8,TEt as k9,BAe as kA,jAe as kB,qu as kC,FR as kD,Ew as kE,PAe as kF,nht as kG,Jct as kH,Wst as kI,NCe as kJ,w4t as kK,Yst as kL,Dut as kM,Rut as kN,Mut as kO,Fut as kP,Iut as kQ,$ut as kR,Ip as kS,Put as kT,wa as kU,Nut as kV,$P as kW,q8 as kX,mn as kY,Xst as kZ,Lut as k_,SEt as ka,EEt as kb,CEt as kc,AEt as kd,OEt as ke,l$e as kf,t6t as kg,$4e as kh,WXt as ki,qXt as kj,Mbt as kk,v7e as kl,H6 as km,CZ as kn,PU as ko,Vr as kp,OZt as kq,nr as kr,Oc as ks,iJ as kt,GXt as ku,YTt as kv,BXt as kw,ZXt as kx,VXt as ky,yne as kz,bnt as l,u7t as l$,Kh as l0,Nv as l1,HS as l2,al as l3,CT as l4,Ikt as l5,dEt as l6,r8 as l7,K4t as l8,Y4t as l9,E_ as lA,Qi as lB,$ as lC,ZNt as lD,cP as lE,aCe as lF,Hs as lG,OP as lH,QX as lI,eNt as lJ,wx as lK,k9 as lL,F9 as lM,cwe as lN,FNt as lO,vzt as lP,_zt as lQ,wEe as lR,Tkt as lS,Xye as lT,W1e as lU,Wf as lV,F7t as lW,Lq as lX,uNt as lY,Rpt as lZ,W4e as l_,J4t as la,Z4t as lb,Q4t as lc,cM as ld,Eu as le,n5t as lf,kEe as lg,k6 as lh,h0 as li,Xte as lj,qq as lk,G5t as ll,j0e as lm,H5t as ln,j5t as lo,se as lp,zf as lq,TM as lr,Wo as ls,eo as lt,Uf as lu,g5t as lv,X5t as lw,v2e as lx,Rx as ly,ed as lz,K0t as m,aP as m$,T7t as m0,c7t as m1,a7t as m2,oS as m3,Flt as m4,l7t as m5,jXt as m6,XTt as m7,kXt as m8,qTt as m9,B7t as mA,uZ as mB,_4t as mC,pZ as mD,on as mE,Ft as mF,Pve as mG,eze as mH,r4t as mI,hB as mJ,Xh as mK,Qd as mL,or as mM,Sc as mN,jJ as mO,GJ as mP,qr as mQ,iFt as mR,sBe as mS,hx as mT,kx as mU,gt as mV,E1e as mW,XI as mX,Tge as mY,HY as mZ,GNt as m_,FXt as ma,UXt as mb,HXt as mc,LXt as md,e2t as me,NXt as mf,P0 as mg,Jbe as mh,bBe as mi,Wt as mj,xXt as mk,la as ml,V7 as mm,Kje as mn,bM as mo,Ao as mp,rbe as mq,MBe as mr,lFt as ms,sr as mt,Ru as mu,At as mv,qi as mw,Fv as mx,Dv as my,b4t as mz,pMe as n,va as n$,q4e as n0,j6 as n1,s4t as n2,wge as n3,$c as n4,U0e as n5,QY as n6,VNt as n7,gre as n8,Kve as n9,AFe as nA,ye as nB,nqt as nC,aqt as nD,T5t as nE,Cze as nF,mb as nG,iqt as nH,U3t as nI,Y5 as nJ,ii as nK,A5t as nL,rkt as nM,CSe as nN,Ui as nO,kK as nP,Ar as nQ,Ou as nR,TB as nS,Yw as nT,B8 as nU,Bc as nV,z0 as nW,To as nX,st as nY,Fr as nZ,Re as n_,XY as na,Jh as nb,k0 as nc,Une as nd,Lu as ne,a9t as nf,$zt as ng,Qh as nh,UE as ni,uWe as nj,rQ as nk,O7e as nl,$x as nm,JHe as nn,Ah as no,He as np,fr as nq,q6 as nr,B4t as ns,v0 as nt,sv as nu,Jve as nv,TE as nw,jNt as nx,Q9 as ny,qX as nz,Pvt as o,RP as o$,Ti as o0,Bve as o1,lqt as o2,cqt as o3,hqt as o4,rJ as o5,da as o6,V7e as o7,c8 as o8,je as o9,Gae as oA,Jst as oB,Skt as oC,a_e as oD,T8e as oE,I4t as oF,SFe as oG,PFe as oH,$Ce as oI,cZ as oJ,l4t as oK,E3e as oL,Uot as oM,rl as oN,ll as oO,KS as oP,U2t as oQ,mw as oR,Nu as oS,R9 as oT,kt as oU,Gl as oV,Gc as oW,Sa as oX,id as oY,xu as oZ,Q5t as o_,Np as oa,kr as ob,Cr as oc,pXt as od,Qje as oe,CGt as of,NZt as og,FZt as oh,Gf as oi,AP as oj,Yye as ok,LEe as ol,dO as om,qbe as on,SXt as oo,V5 as op,sR as oq,Z_ as or,wzt as os,Fae as ot,Tzt as ou,V4t as ov,pzt as ow,MCe as ox,ICe as oy,OCe as oz,gMe as p,bo as p$,z8 as p0,NSe as p1,Z5t as p2,rtt as p3,Hl as p4,YWe as p5,Du as p6,m8t as p7,p8t as p8,f8t as p9,fB as pA,om as pB,wne as pC,IS as pD,Oo as pE,yn as pF,QG as pG,e4t as pH,KNt as pI,yt as pJ,Lse as pK,IY as pL,sit as pM,Fkt as pN,EJ as pO,f5t as pP,K5t as pQ,N5 as pR,Y1e as pS,N4t as pT,$se as pU,Pm as pV,T8 as pW,gJ as pX,Yh as pY,$p as pZ,jE as p_,k7e as pa,MS as pb,Dtt as pc,YE as pd,Q6e as pe,Tu as pf,Tit as pg,LH as ph,nK as pi,YYe as pj,P7e as pk,R7e as pl,Hg as pm,EY as pn,kYe as po,HNt as pp,xo as pq,sFt as pr,ibe as ps,JE as pt,pv as pu,Mc as pv,_7e as pw,tFt as px,rFt as py,Hw as pz,Lvt as q,Iee as q$,f9 as q0,PSe as q1,GSe as q2,ot as q3,tK as q4,hp as q5,S5t as q6,SJ as q7,rce as q8,X8t as q9,EE as qA,Fbe as qB,SBe as qC,w0 as qD,R8 as qE,JYe as qF,Y5t as qG,Tne as qH,Z8t as qI,lP as qJ,Mx as qK,fi as qL,oFt as qM,dE as qN,NVe as qO,rm as qP,s$e as qQ,e2 as qR,lEt as qS,Hve as qT,Age as qU,IDe as qV,v4t as qW,uJe as qX,GZt as qY,jZt as qZ,mXt as q_,wM as qa,$ve as qb,HCt as qc,NYt as qd,nv as qe,eFt as qf,J9 as qg,P5 as qh,uot as qi,vXt as qj,Nkt as qk,LE as ql,wXt as qm,bXt as qn,mP as qo,Pn as qp,D4t as qq,Ise as qr,bf as qs,yM as qt,AJ as qu,CE as qv,m5t as qw,AQe as qx,OJ as qy,P1e as qz,Nvt as r,Us as r$,UZt as r0,LZt as r1,DZt as r2,IZt as r3,bL as r4,HSe as r5,Q_t as r6,v3t as r7,M7e as r8,oqt as r9,Vw as rA,QIe as rB,Ive as rC,KYt as rD,Ypt as rE,bst as rF,_st as rG,Kkt as rH,Qkt as rI,x0 as rJ,Czt as rK,Kn as rL,Ho as rM,IGt as rN,IK as rO,Zo as rP,CNt as rQ,fu as rR,lD as rS,Dkt as rT,lj as rU,Rkt as rV,jit as rW,TP as rX,Cx as rY,Zpt as rZ,pK as r_,BZt as ra,b3t as rb,h7e as rc,ode as rd,JS as re,j8t as rf,OE as rg,b7e as rh,Fs as ri,$Oe as rj,w3t as rk,lw as rl,VZt as rm,AC as rn,zZt as ro,jt as rp,kCe as rq,zCe as rr,Vkt as rs,kZt as rt,MZt as ru,$ht as rv,F3 as rw,d8 as rx,EP as ry,SE as rz,xMe as s,Xbe as s$,mft as s0,z3e as s1,DAe as s2,iye as s3,kbe as s4,UN as s5,pBt as s6,qZt as s7,HZt as s8,RE as s9,vEe as sA,bEe as sB,o4t as sC,Tue as sD,rW as sE,wd as sF,BF as sG,$jt as sH,GF as sI,wc as sJ,xc as sK,nW as sL,iW as sM,oW as sN,sW as sO,Sue as sP,bbe as sQ,_xe as sR,Y6 as sS,xJ as sT,c5 as sU,qHe as sV,fxe as sW,O0 as sX,S8 as sY,yR as sZ,A8 as s_,tBe as sa,e0 as sb,qK as sc,M9 as sd,Kr as se,xqt as sf,UNt as sg,EZt as sh,RY as si,nNt as sj,EM as sk,sM as sl,Gkt as sm,lTe as sn,O_t as so,uqt as sp,B_ as sq,H7e as sr,M3t as ss,Vse as st,AZt as su,Yre as sv,Qft as sw,V6 as sx,qt as sy,ODe as sz,vMe as t,zN as t$,nFt as t0,eqe as t1,yHe as t2,Qrt as t3,F4t as t4,KDt as t5,Kjt as t6,L4t as t7,aEt as t8,Lkt as t9,A7t as tA,lnt as tB,O7t as tC,VCe as tD,n6 as tE,ONt as tF,cp as tG,eIe as tH,YR as tI,v6e as tJ,J8 as tK,o5 as tL,W6 as tM,q5e as tN,H5e as tO,i4t as tP,QNe as tQ,Ejt as tR,Ljt as tS,Z3e as tT,Wb as tU,Eue as tV,Sjt as tW,Ajt as tX,qb as tY,xjt as tZ,hV as t_,Tc as ta,sNt as tb,N2t as tc,mat as td,ou as te,xr as tf,fn as tg,qs as th,Ot as ti,Si as tj,Go as tk,ZQ as tl,vm as tm,ekt as tn,Rt as to,Ct as tp,Ke as tq,vYt as tr,fzt as ts,Ute as tt,jC as tu,Xee as tv,P2t as tw,I2t as tx,eU as ty,iIe as tz,_Te as u,qye as u$,Em as u0,kl as u1,Zh as u2,dCe as u3,Rh as u4,Mmt as u5,Pmt as u6,tR as u7,cSt as u8,K8e as u9,Rlt as uA,iee as uB,Iht as uC,see as uD,JAe as uE,nee as uF,QAe as uG,Cut as uH,Fq as uI,KEt as uJ,eCt as uK,tCt as uL,ect as uM,A4t as uN,uhe as uO,nhe as uP,b8e as uQ,ohe as uR,xhe as uS,ahe as uT,k4t as uU,phe as uV,Mhe as uW,Phe as uX,Ihe as uY,P4t as uZ,OZ as u_,Aze as ua,Szt as ub,bzt as uc,pVe as ud,EYt as ue,YG as uf,fz as ug,mz as uh,XDt as ui,YDt as uj,hzt as uk,zSt as ul,hv as um,RYt as un,Gye as uo,D0e as up,NRe as uq,oyt as ur,$Re as us,byt as ut,tb as uu,Aee as uv,Cee as uw,Bue as ux,iyt as uy,jue as uz,nWe as v,x5 as v$,O4t as v0,L8e as v1,E8e as v2,R4t as v3,$he as v4,$4t as v5,O5t as v6,h7t as v7,x7t as v8,whe as v9,f7t as vA,pAe as vB,d7t as vC,Ppt as vD,$lt as vE,UZ as vF,y0 as vG,EA as vH,qke as vI,Hke as vJ,jke as vK,F9e as vL,CA as vM,f4t as vN,Yke as vO,JXt as vP,hFt as vQ,WGe as vR,qGe as vS,ZZ as vT,f4 as vU,E7t as vV,I6 as vW,Zke as vX,Oxt as vY,RD as vZ,b5 as v_,Ehe as va,_7t as vb,y7t as vc,Apt as vd,v7t as ve,b7t as vf,zle as vg,Ble as vh,Vle as vi,m7t as vj,g7t as vk,the as vl,que as vm,Wue as vn,Xue as vo,fhe as vp,Vhe as vq,jhe as vr,rhe as vs,Bhe as vt,u8 as vu,fAe as vv,w7t as vw,Plt as vx,Ilt as vy,p7t as vz,Kxe as w,hM as w0,k9e as w1,rNt as w2,t5t as w3,cG as w4,ize as w5,fse as w6,M7t as w7,C7t as w8,KZ as w9,hBt as wA,yYt as wB,YYt as wC,uZt as wD,XZt as wE,XPe as wa,mxt as wb,dFt as wc,ODt as wd,sC as we,t4t as wf,QNt as wg,JNt as wh,X6 as wi,Vnt as wj,Lft as wk,Q_ as wl,qEe as wm,vxe as wn,WA as wo,PS as wp,bB as wq,cl as wr,hE as ws,AY as wt,qFt as wu,Dct as wv,tx as ww,q5t as wx,Ukt as wy,Rzt as wz,DWe as x,bR as y,Uvt as z};
