(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function r(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=r(s);fetch(s.href,n)}})();function u(t,e,r,i){var s,n=arguments.length,o=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(o=(n<3?s(o):n>3?s(e,r,o):s(e,r))||o);return n>3&&o&&Object.defineProperty(e,r,o),o}function lPt(t,e,r,i){function s(n){return n instanceof r?n:new r(function(o){o(n)})}return new(r||(r=Promise))(function(n,o){function a(h){try{c(i.next(h))}catch(p){o(p)}}function l(h){try{c(i.throw(h))}catch(p){o(p)}}function c(h){h.done?n(h.value):s(h.value).then(a,l)}c((i=i.apply(t,e||[])).next())})}const CIe="modulepreload",AIe=function(t,e){return new URL(t,e).href},oee={},ce=function(e,r,i){if(!r||r.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(r.map(n=>{if(n=AIe(n,i),n in oee)return;oee[n]=!0;const o=n.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!i)for(let h=s.length-1;h>=0;h--){const p=s[h];if(p.href===n&&(!o||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${n}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":CIe,o||(c.as="script",c.crossOrigin=""),c.href=n,document.head.appendChild(c),o)return new Promise((h,p)=>{c.addEventListener("load",h),c.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>e())};function OIe(t){return t&&t.release&&typeof t.release=="function"}function RIe(t){return t&&t.acquire&&typeof t.acquire=="function"}let Go=class wV{constructor(e,r,i,s=1,n=0){if(this._ctor=e,this._acquireFunction=r,this._releaseFunction=i,this.allocationSize=s,this._pool=new Array(n),this._initialSize=n,this._ctor)for(let o=0;o<n;o++)this._pool[o]=new this._ctor;this.allocationSize=Math.max(s,1)}destroy(){this.prune(0)}acquire(...e){let r;if(wV.test.disabled)r=new this._ctor;else{if(this._pool.length===0){const i=this.allocationSize;for(let s=0;s<i;s++)this._pool[s]=new this._ctor}r=this._pool.pop()}return this._acquireFunction?this._acquireFunction(r,...e):RIe(r)&&r.acquire(...e),r}release(e){e&&!wV.test.disabled&&(this._releaseFunction?this._releaseFunction(e):OIe(e)&&e.release(),this._pool.push(e))}prune(e=this._initialSize){if(!(e>=this._pool.length)){for(let r=e;r<this._pool.length;++r){const i=this._pool[r];this._dispose(i)}this._pool.length=e}}_dispose(e){e.dispose&&typeof e.dispose=="function"&&e.dispose()}};Go.test={disabled:!1};function MIe(t){t.length=0}let mc=class{constructor(e=50,r=50){this._pool=new Go(Array,void 0,MIe,r,e)}acquire(){return this._pool.acquire()}release(e){this._pool.release(e)}prune(){this._pool.prune(0)}static acquire(){return p8.acquire()}static release(e){return p8.release(e)}static prune(){p8.prune()}};const p8=new mc(100);function uPt(t){const e=[];return function*(){yield*e;for(const r of t)e.push(r),yield r}}function PIe(t,e){for(const r of t)if(r!=null&&e(r))return r}function xV(t){return t!=null&&typeof t[Symbol.iterator]=="function"}function vc(t,e){return t!=null?e(t):null}function hc(t,e){return R5(t,e),t}function R5(t,e){if(t==null)throw new Error(e??"value is None")}function $e(t){return t?.destroy(),null}function Ve(t){return t?.dispose(),null}function Ni(t){return t?.remove(),null}function Ll(t){return t?.abort(),null}function Bi(t){return t?.release(),null}function IIe(t,e,r){return t!=null&&e!=null?r!=null?r(t,e):t.equals(e):t===e}function UE(t){return null}function hPt(t,e){const r=new Array;for(const i of t)r.push(i!=null?e(i):null);return r}function dPt(t,e){for(const r of t)vc(r,e)}function pPt(t){return t}let Ii=class TV{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(r=>{e+=r.length}),e}add(e,r){if(xV(e)){const i=this._getOrCreateGroup(r);for(const s of e)this._isHandle(s)&&i.push(s)}else this._isHandle(e)&&this._getOrCreateGroup(r).push(e);return this}forEach(e,r){if(typeof e=="function")this._groups.forEach(i=>i.forEach(e));else{const i=this._getGroup(e);i&&r&&i.forEach(r)}}has(e){return this._groups.has(this._ensureGroupKey(e))}remove(e){if(typeof e!="string"&&xV(e)){for(const r of e)this.remove(r);return this}return this.has(e)?(this._removeAllFromGroup(this._getGroup(e)),this._groups.delete(this._ensureGroupKey(e)),this):this}removeAll(){return this._groups.forEach(e=>this._removeAllFromGroup(e)),this._groups.clear(),this}_isHandle(e){return e&&(!!e.remove||e instanceof TV)}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const r=[];return this._groups.set(this._ensureGroupKey(e),r),r}_getGroup(e){return this._groups.get(this._ensureGroupKey(e))}_ensureGroupKey(e){return e||"_default_"}_removeAllFromGroup(e){for(const r of e)r instanceof TV?r.removeAll():r.remove()}};const afe=Symbol("Accessor-beforeDestroy");function N2(t){return el(()=>t.forEach(e=>e!=null&&e.remove()))}function el(t){return{remove:()=>{t&&(t(),t=void 0)}}}function fPt(t){return el(t!=null?()=>t.destroy():void 0)}let fO=class v1{constructor(e=1){this._seed=e}set seed(e){this._seed=e??Math.random()*v1._m}getInt(){return this._seed=(v1._a*this._seed+v1._c)%v1._m,this._seed}getFloat(){return this.getInt()/(v1._m-1)}getIntRange(e,r){return Math.round(this.getFloatRange(e,r))}getFloatRange(e,r){const i=r-e;return e+this.getInt()/v1._m*i}};fO._m=2147483647,fO._a=48271,fO._c=0;const M5=1.5,$Ie=1/M5,LIe=.5;function P5(t,e){return e?t.filter((r,i,s)=>s.findIndex(e.bind(null,r))===i):t.filter((r,i,s)=>s.indexOf(r)===i)}function ry(t,e,r){if(t==null&&e==null)return!0;if(t==null||e==null||t.length!==e.length)return!1;if(r){for(let i=0;i<t.length;i++)if(!r(t[i],e[i]))return!1}else for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function tX(t,e){let r=t.length!==e.length;r&&(t.length=e.length);for(let i=0;i<e.length;++i)t[i]!==e[i]&&(t[i]=e[i],r=!0);return r}function DIe(t,e,r){let i,s;return r?(i=e.filter(n=>!t.some(o=>r(o,n))),s=t.filter(n=>!e.some(o=>r(o,n)))):(i=e.filter(n=>!t.includes(n)),s=t.filter(n=>!e.includes(n))),{added:i,removed:s}}function NIe(t){return t&&typeof t.length=="number"}function FIe(t,e){const r=t.length;if(r===0)return[];const i=[];for(let s=0;s<r;s+=e)i.push(t.slice(s,s+e));return i}const UIe=!!Array.prototype.fill;function mPt(t,e){if(UIe)return new Array(t).fill(e);const r=new Array(t);for(let i=0;i<t;i++)r[i]=e;return r}function kIe(t,e){e===void 0&&(e=t,t=0);const r=new Array(e-t);for(let i=t;i<e;i++)r[i-t]=i;return r}function lfe(t,e,r){const i=t.length;let s=0,n=i-1;for(;s<n;){const a=s+Math.floor((n-s)/2);e>t[a]?s=a+1:n=a}const o=t[s];return r?e>=t[i-1]?-1:o===e?s:s-1:o===e?s:-1}let cfe=class{constructor(){this.last=0}};const ufe=new cfe;function SV(t,e,r,i){i=i||ufe;const s=Math.max(0,i.last-10);for(let o=s;o<r;++o)if(t[o]===e)return i.last=o,o;const n=Math.min(s,r);for(let o=0;o<n;++o)if(t[o]===e)return i.last=o,o;return-1}function uR(t,e,r,i){const s=r??t.length,n=SV(t,e,s,i);if(n!==-1)return t[n]=t[s-1],r==null&&t.pop(),e}const td=new Set;function zIe(t,e,r=t.length,i=e.length,s,n){if(i===0||r===0)return r;td.clear();for(let a=0;a<i;++a)td.add(e[a]);s=s||ufe;const o=Math.max(0,s.last-10);for(let a=o;a<r;++a)if(td.has(t[a])&&(n&&n.push(t[a]),td.delete(t[a]),t[a]=t[r-1],--r,--a,td.size===0||r===0))return td.clear(),r;for(let a=0;a<o;++a)if(td.has(t[a])&&(n&&n.push(t[a]),td.delete(t[a]),t[a]=t[r-1],--r,--a,td.size===0||r===0))return td.clear(),r;return td.clear(),r}function VIe(t,e){let r=0;for(let i=0;i<t.length;++i){const s=t[i];e(s,i)&&(t[r]=s,r++)}t.length=r}function BIe(t){return t?(aee.seed=t,()=>aee.getFloat()):Math.random}function yPt(t,e){const r=BIe(e);for(let i=t.length-1;i>0;i--){const s=Math.floor(r()*(i+1)),n=t[i];t[i]=t[s],t[s]=n}return t}const aee=new fO;function rX(t,e){const r=t.indexOf(e);return r!==-1?(t.splice(r,1),e):null}function _Pt(t,e){const r=new Map,i=t.length;for(let s=0;s<i;s++){const n=t[s],o=e(n,s,t),a=r.get(o);a?a.push(n):r.set(o,[n])}return r}function jf(t,e){return t!=null}const GIe=[];let x_;function oe(t){return typeof x_[t]=="function"?x_[t]=x_[t](globalThis):x_[t]}x_=globalThis.dojoConfig?.has||globalThis.esriConfig?.has?{...globalThis.dojoConfig?.has,...globalThis.esriConfig?.has}:{},oe.add=(t,e,r,i)=>((i||x_[t]===void 0)&&(x_[t]=e),r&&oe(t)),oe.cache=x_,oe.add("esri-deprecation-warnings",!0),oe.add("esri-force-fullscreen-debug",!1),(()=>{oe.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const t=typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;if(oe.add("host-browser",t),oe.add("host-node",typeof globalThis.process=="object"&&globalThis.process.versions?.node&&globalThis.process.versions.v8),oe.add("dom",t),oe("host-browser")){const e=navigator,r=e.userAgent,i=e.appVersion,s=parseFloat(i);if(oe.add("wp",parseFloat(r.split("Windows Phone")[1])||void 0),oe.add("msapp",parseFloat(r.split("MSAppHost/")[1])||void 0),oe.add("khtml",i.includes("Konqueror")?s:void 0),oe.add("edge",parseFloat(r.split("Edge/")[1])||void 0),oe.add("opr",parseFloat(r.split("OPR/")[1])||void 0),oe.add("webkit",!oe("wp")&&!oe("edge")&&parseFloat(r.split("WebKit/")[1])||void 0),oe.add("chrome",!oe("edge")&&!oe("opr")&&parseFloat(r.split("Chrome/")[1])||void 0),oe.add("android",!oe("wp")&&parseFloat(r.split("Android ")[1])||void 0),oe.add("safari",!i.includes("Safari")||oe("wp")||oe("chrome")||oe("android")||oe("edge")||oe("opr")?void 0:parseFloat(i.split("Version/")[1])),oe.add("mac",i.includes("Macintosh")),!oe("wp")&&/(iPhone|iPod|iPad)/.test(r)){const n=RegExp.$1.replace(/P/,"p"),o=/OS ([\d_]+)/.test(r)?RegExp.$1:"1",a=parseFloat(o.replace(/_/,".").replaceAll("_",""));oe.add(n,a),oe.add("ios",a)}oe("webkit")||(!r.includes("Gecko")||oe("wp")||oe("khtml")||oe("edge")||oe.add("mozilla",s),oe("mozilla")&&oe.add("ff",parseFloat(r.split("Firefox/")[1]||r.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const t=navigator.userAgent,e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(t),r=/iPhone/i.test(t);e&&oe.add("esri-mobile",e),r&&oe.add("esri-iPhone",r),oe.add("esri-geolocation",!!navigator.geolocation)}oe.add("esri-wasm","WebAssembly"in globalThis),oe.add("esri-shared-array-buffer",()=>{const t="SharedArrayBuffer"in globalThis,e=globalThis.crossOriginIsolated===!1;return t&&!e}),oe.add("wasm-simd",()=>{const t=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(t))}),oe.add("esri-atomics","Atomics"in globalThis),oe.add("esri-workers","Worker"in globalThis),oe.add("web-feat:cache","caches"in globalThis),oe.add("esri-workers-arraybuffer-transfer",!oe("safari")||Number(oe("safari"))>=12),oe.add("workers-pool-size",8),oe.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),oe.add("featurelayer-simplify-payload-size-factors",[1,1,4]),oe.add("featurelayer-animation-enabled",!0),oe.add("featurelayer-snapshot-enabled",!0),oe.add("featurelayer-snapshot-point-min-threshold",8e4),oe.add("featurelayer-snapshot-point-max-threshold",4e5),oe.add("featurelayer-snapshot-point-coverage",.1),oe.add("featurelayer-advanced-symbols",!1),oe.add("featurelayer-pbf",!0),oe.add("featurelayer-pbf-statistics",!1),oe.add("feature-layers-workers",!0),oe.add("feature-polyline-generalization-factor",1),oe.add("mapview-transitions-duration",200),oe.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),oe.add("mapserver-pbf-version-support",10.81),oe.add("mapservice-popup-identify-max-tolerance",20),oe.add("heatmap-allow-raster-fallback",!1),oe.add("heatmap-force-raster",!1),oe("host-webworker")||oe("host-browser")&&(oe.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),oe.add("esri-image-decode",()=>{if("decode"in new Image){const t=new Image;return t.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void t.decode().then(()=>{oe.add("esri-image-decode",!0,!0,!0)}).catch(()=>{oe.add("esri-image-decode",!1,!0,!0)})}return!1}),oe.add("esri-url-encodes-apostrophe",()=>{const t=window.document.createElement("a");return t.href="?'",t.href.includes("?%27")}))})();function MA(t){return t instanceof ArrayBuffer}function iX(t){return t?.constructor?.name==="Int8Array"}function T_(t){return t?.constructor?.name==="Uint8Array"}function hfe(t){return t?.constructor?.name==="Uint8ClampedArray"}function I5(t){return t?.constructor?.name==="Int16Array"}function $5(t){return t?.constructor?.name==="Uint16Array"}function L5(t){return t?.constructor?.name==="Int32Array"}function D5(t){return t?.constructor?.name==="Uint32Array"}function kE(t){return t?.constructor?.name==="Float32Array"}function zE(t){return t?.constructor?.name==="Float64Array"}function vp(t){return!("buffer"in t)}function S_(t){return t!=null?vp(t)?8*t.length+12:t.byteLength+dfe:0}const dfe=145,Su=1024;function jIe(t){return zE(t)||kE(t)||L5(t)||I5(t)||iX(t)}function HIe(t){return zE(t)||kE(t)}function qIe(t){return zE(t)?179769e303:kE(t)?3402823e32:D5(t)?4294967295:$5(t)?65535:T_(t)||hfe(t)?255:L5(t)?2147483647:I5(t)?32767:iX(t)?127:256}function pfe(t,e){let r;if(e)for(r in t)t.hasOwnProperty(r)&&(t[r]===void 0?delete t[r]:t[r]instanceof Object&&pfe(t[r],!0));else for(r in t)t.hasOwnProperty(r)&&t[r]===void 0&&delete t[r];return t}function K(t){if(!t||typeof t!="object"||typeof t=="function")return t;const e=gfe(t);if(e!=null)return e;if(GN(t))return t.clone();if(ffe(t))return t.map(K);if(mfe(t))return t.clone();const r={};for(const i of Object.getOwnPropertyNames(t))r[i]=K(t[i]);return r}function EV(t){if(!t||typeof t!="object"||typeof t=="function"||"HTMLElement"in globalThis&&t instanceof HTMLElement)return t;const e=gfe(t);if(e!=null)return e;if(ffe(t)){let r=!0;const i=t.map(s=>{const n=EV(s);return s!=null&&n==null&&(r=!1),n});return r?i:null}if(GN(t))return t.clone();if(t instanceof File||t instanceof Blob)return t;if(!mfe(t)){const r=new(Object.getPrototypeOf(t)).constructor;for(const i of Object.getOwnPropertyNames(t)){const s=t[i],n=EV(s);if(s!=null&&n==null)return null;r[i]=n}return r}return null}function GN(t){return typeof t.clone=="function"}function ffe(t){return typeof t.map=="function"&&typeof t.forEach=="function"}function mfe(t){return typeof t.notifyChange=="function"&&typeof t.watch=="function"}function lee(t){if(Object.prototype.toString.call(t)!=="[object Object]")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}function gfe(t){if(iX(t)||T_(t)||hfe(t)||I5(t)||$5(t)||L5(t)||D5(t)||kE(t)||zE(t))return t.slice();if(t instanceof Date)return new Date(t.getTime());if(t instanceof ArrayBuffer)return t.slice(0,t.byteLength);if(t instanceof Map){const e=new Map;for(const[r,i]of t)e.set(r,K(i));return e}if(t instanceof Set){const e=new Set;for(const r of t)e.add(K(r));return e}return null}function sX(t,e){return t===e||typeof t=="number"&&isNaN(t)&&typeof e=="number"&&isNaN(e)||typeof(t||{}).getTime=="function"&&typeof(e||{}).getTime=="function"&&t.getTime()===e.getTime()||!1}function yfe(t,e){return t===e||(t==null||typeof t=="string"?t===e:typeof t=="number"?t===e||typeof e=="number"&&isNaN(t)&&isNaN(e):t instanceof Date?e instanceof Date&&t.getTime()===e.getTime():Array.isArray(t)?Array.isArray(e)&&ry(t,e):t instanceof Set?e instanceof Set&&XIe(t,e):t instanceof Map?e instanceof Map&&ZIe(t,e):!!lee(t)&&lee(e)&&WIe(t,e))}function WIe(t,e){if(t===null||e===null)return!1;const r=Object.keys(t);if(e===null||Object.keys(e).length!==r.length)return!1;for(const i of r)if(t[i]!==e[i]||!Object.prototype.hasOwnProperty.call(e,i))return!1;return!0}function XIe(t,e){if(t.size!==e.size)return!1;for(const r of t)if(!e.has(r))return!1;return!0}function ZIe(t,e){if(t.size!==e.size)return!1;for(const[r,i]of t){const s=e.get(r);if(s!==i||s===void 0&&!e.has(r))return!1}return!0}function ma(t){return t.__accessor__??null}function YIe(t,e){return t!=null&&t.metadatas&&t.metadatas[e]!=null}function UL(t,e,r){return r?jN(t,e,{policy:r,path:""}):jN(t,e,null)}function jN(t,e,r){return e?Object.keys(e).reduce((i,s)=>{const n=s;let o=null,a="merge";if(r&&(o=r.path?`${r.path}.${s}`:s,a=r.policy(o)),a==="replace"||a==="replace-arrays"&&Array.isArray(i[n]))return i[n]=e[n],i;if(i[n]===void 0)return i[n]=K(e[n]),i;let l=i[n],c=e[n];if(l===c)return i;if(Array.isArray(c)||Array.isArray(i))l=l?Array.isArray(l)?i[n]=l.concat():i[n]=[l]:i[n]=[],c&&(Array.isArray(c)||(c=[c]),c.forEach(h=>{l.includes(h)||l.push(h)}));else if(c&&typeof c=="object")if(r){const h=r.path;r.path=o,i[n]=jN(l,c,r),r.path=h}else i[n]=jN(l,c,null);else i.hasOwnProperty(s)&&!e.hasOwnProperty(s)||(i[n]=c);return i},t||{}):t}function _fe(t){return Array.isArray(t)?t:t.split(".")}function cee(t){return t.includes(",")?t.split(",").map(e=>e.trim()):[t.trim()]}function JIe(t){if(Array.isArray(t)){const e=[];for(const r of t)e.push(...cee(r));return e}return cee(t)}function vfe(t,e,r,i){const s=JIe(e);if(s.length!==1){const n=s.map(o=>i(t,o,r));return N2(n)}return i(t,s[0],r)}function nX(t){let e=!1;return()=>{e||(e=!0,t())}}function bfe(t,e){const r=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const s=parseInt(r,10);if(!isNaN(s))return Array.isArray(e)?e[s]:e.at(s)}const i=ma(e);return YIe(i,r)?i.get(r):e[r]}function wfe(t,e,r){if(t==null)return t;const i=bfe(e[r],t);return!i&&r<e.length-1?void 0:r===e.length-1?i:wfe(i,e,r+1)}function _M(t,e,r=0){return typeof e!="string"||e.includes(".")?wfe(t,_fe(e),r):bfe(e,t)}function HN(t,e){return _M(t,e)}function uee(t,e){return _M(e,t)!==void 0}function vM(t){let e=t.constructor.__accessorMetadata__;const r=Object.prototype.hasOwnProperty.call(t.constructor,"__accessorMetadata__");if(e){if(!r){e=Object.create(e);for(const i in e)e[i]=K(e[i]);Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0})}}else e={},Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0});return t.constructor.__accessorMetadata__}function bM(t,e){const r=vM(t);let i=r[e];return i||(i=r[e]={}),i}function QIe(t,e){return UL(t,e,e$e)}const KIe=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function e$e(t){return KIe.test(t)?"replace":"merge"}function xfe(t,e,r=!1){return Sfe(t,e,r)}function wM(t,e){if(e!=null)return e[t]||Tfe(t.split("."),!1,e)}function tl(t,e,r){const i=t.split("."),s=i.pop(),n=Tfe(i,!0,r);n&&s&&(n[s]=e)}function Tfe(t,e,r){let i=r;for(const s of t){if(i==null)return;if(!(s in i)){if(!e)return;i[s]={}}i=i[s]}return i}function Sfe(t,e,r){return e?Object.keys(e).reduce((i,s)=>{let n=i[s],o=e[s];return n===o?i:n===void 0?(i[s]=K(o),i):(Array.isArray(o)||Array.isArray(i)?(n=n?Array.isArray(n)?i[s]=n.concat():i[s]=[n]:i[s]=[],o&&(Array.isArray(o)||(o=[o]),r?o.forEach(a=>{n.includes(a)||n.push(a)}):i[s]=o.concat())):o&&typeof o=="object"?i[s]=Sfe(n,o,r):i.hasOwnProperty(s)&&!e.hasOwnProperty(s)||(i[s]=o),i)},t||{}):t}const Br={analysisTheme:{accentColor:[255,127,0],textColor:"white"},apiKey:void 0,applicationName:"",applicationUrl:globalThis.location?.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",userPrivilegesApplied:!1,portalUrl:"https://www.arcgis.com",routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(xfe(Br,globalThis.esriConfig,!0),delete Br.has),!Br.assetsPath){{const t="4.27";Br.assetsPath=`https://js.arcgis.com/${t}/@arcgis/core/assets`}Br.defaultAssetsPath=Br.assetsPath}const t$e=/\{([^\}]+)\}/g;function hee(t){return t??""}function N5(t,e){return t.replaceAll(t$e,typeof e=="object"?(r,i)=>hee(wM(i,e)):(r,i)=>hee(e(i)))}function r$e(t,e){return t.replaceAll(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,r=>e&&e.includes(r)?r:`\\${r}`)}function oX(t){let e=0;for(let r=0;r<t.length;r++)e=(e<<5)-e+t.charCodeAt(r),e|=0;return e}function vPt(t){return new DOMParser().parseFromString(t||"","text/html").body.innerText||""}function bPt(t,e){return new RegExp(`{${e}}`,"ig").test(t)}const dee={info:0,warn:1,error:2,none:3};let Q=class $a{constructor(e){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},e.level!=null&&(this.level=e.level),e.writer!=null&&(this.writer=e.writer),this._module=e.module,$a._loggers.set(this.module,this);const r=this.module.lastIndexOf(".");r!==-1&&(this._parent=$a.getLogger(this.module.slice(0,r)))}get module(){return this._module}get parent(){return this._parent}error(...e){this._log("error","always",...e)}warn(...e){this._log("warn","always",...e)}info(...e){this._log("info","always",...e)}errorOnce(...e){this._log("error","once",...e)}warnOnce(...e){this._log("warn","once",...e)}infoOnce(...e){this._log("info","once",...e)}errorOncePerTick(...e){this._log("error","oncePerTick",...e)}warnOncePerTick(...e){this._log("warn","oncePerTick",...e)}infoOncePerTick(...e){this._log("info","oncePerTick",...e)}get test(){const e=this;return{loggedMessages:e._loggedMessages,clearLoggedWarnings:()=>e._loggedMessages.warn.clear()}}static get test(){return{resetLoggers(e=new Map){const r=$a._loggers;return $a._loggers=e,r},set throttlingDisabled(e){$a._throttlingDisabled=e}}}static getLogger(e){return e=typeof e!="string"?e.declaredClass:e,$a._loggers.get(e)||new $a({module:e})}_log(e,r,...i){if(this._matchLevel(e)){if(r!=="always"&&!$a._throttlingDisabled){const s=this._argsToKey(i),n=this._loggedMessages[e].get(s);if(r==="once"&&n!=null||r==="oncePerTick"&&n&&n>=$a._tickCounter)return;this._loggedMessages[e].set(s,$a._tickCounter),$a._scheduleTickCounterIncrement()}for(const s of Br.log.interceptors)if(s(e,this.module,...i))return;this._inheritedWriter()(e,this.module,...i)}}_parentWithMember(e,r){let i=this;for(;i!=null;){const s=i[e];if(s!=null)return s;i=i.parent}return r}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(e,r,...i){console[e](`[${r}]`,...i)}_matchLevel(e){const r=Br.log.level||"warn";return dee[this._parentWithMember("level",r)]<=dee[e]}_argsToKey(...e){return oX(JSON.stringify(e,(i,s)=>typeof s!="object"||Array.isArray(s)?s:"[Object]"))}static _scheduleTickCounterIncrement(){$a._tickCounterScheduled||($a._tickCounterScheduled=!0,Promise.resolve().then(()=>{$a._tickCounter++,$a._tickCounterScheduled=!1}))}};Q._loggers=new Map,Q._tickCounter=0,Q._tickCounterScheduled=!1,Q._throttlingDisabled=!1;var $g;(function(t){t[t.INITIALIZING=0]="INITIALIZING",t[t.CONSTRUCTING=1]="CONSTRUCTING",t[t.CONSTRUCTED=2]="CONSTRUCTED"})($g||($g={}));let i$e=class{constructor(e,r){this._observers=e,this._observer=r}remove(){rX(this._observers,this._observer)}},Efe=class{constructor(){this._observers=null,this.destroyed=!1}observe(e){if(this.destroyed||e.destroyed)return s$e;this._observers==null&&(this._observers=[]);const r=this._observers;let i=!1,s=!1;const n=r.length;for(let o=0;o<n;++o){const a=r[o];if(a.destroyed)s=!0;else if(a===e){i=!0;break}}return i||(r.push(e),s&&this._removeDestroyedObservers()),new i$e(r,e)}_removeDestroyedObservers(){const e=this._observers;if(!e||e.length===0)return;const r=e.length;let i=0;for(let s=0;s<r;++s){for(;s+i<r&&e[s+i].destroyed;)++i;if(i>0){if(!(s+i<r))break;e[s]=e[s+i]}}e.length=r-i}destroy(){if(this.destroyed)return;this.destroyed=!0;const e=this._observers;if(e!=null){for(const r of e)r.onCommitted();this._observers=null}}};const s$e=el();var mr;(function(t){t[t.DEFAULTS=0]="DEFAULTS",t[t.COMPUTED=1]="COMPUTED",t[t.SERVICE=2]="SERVICE",t[t.PORTAL_ITEM=3]="PORTAL_ITEM",t[t.WEB_SCENE=4]="WEB_SCENE",t[t.WEB_MAP=5]="WEB_MAP",t[t.LINK_CHART=6]="LINK_CHART",t[t.USER=7]="USER"})(mr||(mr={}));const CV=mr.USER+1;function Fg(t){switch(t){case"defaults":return mr.DEFAULTS;case"service":return mr.SERVICE;case"portal-item":return mr.PORTAL_ITEM;case"web-scene":return mr.WEB_SCENE;case"web-map":return mr.WEB_MAP;case"link-chart":return mr.LINK_CHART;case"user":return mr.USER;default:return null}}function qN(t){switch(t){case mr.DEFAULTS:return"defaults";case mr.SERVICE:return"service";case mr.PORTAL_ITEM:return"portal-item";case mr.WEB_SCENE:return"web-scene";case mr.WEB_MAP:return"web-map";case mr.LINK_CHART:return"link-chart";case mr.USER:return"user"}return void 0}function n$e(t){return qN(t)}var Oi;(function(t){t[t.Dirty=1]="Dirty",t[t.Overriden=2]="Overriden",t[t.Computing=4]="Computing",t[t.NonNullable=8]="NonNullable",t[t.HasDefaultValue=16]="HasDefaultValue",t[t.DepTrackingInitialized=32]="DepTrackingInitialized",t[t.AutoTracked=64]="AutoTracked",t[t.ExplicitlyTracking=128]="ExplicitlyTracking"})(Oi||(Oi={}));const WN={onObservableAccessed:()=>{},onTrackingEnd:()=>{}},PA=[];let mO=WN;function Wt(t){mO.onObservableAccessed(t)}let kL=!1,zL=!1;function iy(t,e,r){if(kL)return aX(t,e,r);Cfe(t);const i=e.call(r);return Afe(),i}function o$e(t,e){return iy(WN,t,e)}function aX(t,e,r){const i=kL;kL=!0,Cfe(t);let s=null;try{s=e.call(r)}catch(n){zL&&Q.getLogger("esri.core.accessorSupport.tracking").error(n)}return Afe(),kL=i,s}function Cfe(t){mO=t,PA.push(t)}function Afe(){const t=PA.length;if(t>1){const e=PA.pop();mO=PA[t-2],e.onTrackingEnd()}else if(t===1){const e=PA.pop();mO=WN,e.onTrackingEnd()}else mO=WN}function Ofe(t,e){const r=e.observerObject;if(r.flags&Oi.DepTrackingInitialized)return;const i=zL;zL=!1,r.flags&Oi.AutoTracked?aX(e,e.metadata.get,t):Rfe(t,e),zL=i}const a$e=[];function Rfe(t,e){const r=e.observerObject;r.flags&Oi.ExplicitlyTracking||(r.flags|=Oi.ExplicitlyTracking,aX(e,()=>{const i=e.metadata.dependsOn||a$e;for(const s of i)if(typeof s!="string"||s.includes(".")){const n=_fe(s);for(let o=0,a=t;o<n.length&&a!=null&&typeof a=="object";++o)a=pee(a,n[o],o!==n.length-1)}else pee(t,s,!1)}),r.flags&=~Oi.ExplicitlyTracking)}function pee(t,e,r){const i=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const n=parseInt(i,10);if(!isNaN(n))return Array.isArray(t)?t[n]:t.at(n)}const s=ma(t);if(s){const n=s.propertiesByName.get(i);n&&(Wt(n.observerObject),Ofe(t,n))}return r?t[i]:void 0}let fee=class{constructor(e,r){this.propertyName=e,this.metadata=r,this.observerObject=new l$e,this._accessed=null,this._handles=null,this.observerObject.flags=Oi.Dirty|(r.nonNullable?Oi.NonNullable:0)|(r.hasOwnProperty("value")?Oi.HasDefaultValue:0)|(r.get===void 0?Oi.DepTrackingInitialized:0)|(r.dependsOn===void 0?Oi.AutoTracked:0)}destroy(){this.observerObject.destroy(),this._accessed=null,this._clearObservationHandles()}getComputed(e){const r=this.observerObject;Wt(r);const i=e.store,s=this.propertyName,n=r.flags,o=i.get(s);if(n&Oi.Computing||~n&Oi.Dirty&&i.has(s))return o;r.flags|=Oi.Computing;const a=e.host;let l;n&Oi.AutoTracked?l=iy(this,this.metadata.get,a):(Rfe(a,this),l=this.metadata.get.call(a)),i.set(s,l,mr.COMPUTED);const c=i.get(s);return c===o?r.flags&=~Oi.Dirty:o$e(this.commit,this),r.flags&=~Oi.Computing,c}onObservableAccessed(e){if(e===this.observerObject)return;let r=this._accessed;if(r==null)r=[],this._accessed=r;else if(r.includes(e))return;r.push(e)}onTrackingEnd(){this._clearObservationHandles();const e=this.observerObject;e.flags|=Oi.DepTrackingInitialized;const r=this._accessed;if(r==null||r.length===0)return;let i=this._handles;i==null&&(i=[],this._handles=i);for(let s=0;s<r.length;++s)i.push(r[s].observe(e));r.length=0}notifyChange(){const e=this.observerObject;e.onInvalidated(),e.onCommitted()}invalidate(){this.observerObject.onInvalidated()}commit(){const e=this.observerObject;e.flags&=~Oi.Dirty,e.onCommitted()}_clearObservationHandles(){const e=this._handles;if(e!==null){for(let r=0;r<e.length;++r)e[r].remove();e.length=0}}},l$e=class extends Efe{constructor(){super(...arguments),this.flags=0}onInvalidated(){~this.flags&Oi.Overriden&&(this.flags|=Oi.Dirty);const e=this._observers;if(e&&e.length>0)for(const r of e)r.onInvalidated()}onCommitted(){const e=this._observers;if(e&&e.length>0){const r=e.slice();for(const i of r)i.onCommitted()}}destroy(){this.flags&Oi.Dirty&&this.onCommitted(),super.destroy()}},c$e=class Mfe{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const r=new Mfe;return this._values.forEach((i,s)=>{e&&e.has(s)||r.set(s,K(i))}),r}get(e){return this._values.get(e)}originOf(){return mr.USER}keys(){return[...this._values.keys()]}set(e,r){this._values.set(e,r)}delete(e){this._values.delete(e)}has(e){return this._values.has(e)}forEach(e){this._values.forEach(e)}};function SP(t,e,r){return t!==void 0}function mee(t,e,r,i){return t!==void 0&&(!(r==null&&t.observerObject.flags&Oi.NonNullable)||(i.lifecycle,$g.INITIALIZING,!1))}function u$e(t){return t&&typeof t.destroy=="function"}Q.getLogger("esri.core.accessorSupport.Properties");let h$e=class{constructor(e){this.host=e,this.propertiesByName=new Map,this.ctorArgs=null,this.destroyed=!1,this.lifecycle=$g.INITIALIZING,this.store=new c$e,this._origin=mr.USER;const r=this.host.constructor.__accessorMetadata__;for(const i in r){const s=new fee(i,r[i]);this.propertiesByName.set(i,s)}this.metadatas=r}initialize(){this.lifecycle=$g.CONSTRUCTING}constructed(){this.lifecycle=$g.CONSTRUCTED}destroy(){this.destroyed=!0;for(const[e,r]of this.propertiesByName){if(r.metadata.autoDestroy){const i=this.internalGet(e);i&&u$e(i)&&(i.destroy(),~r.observerObject.flags&Oi.NonNullable&&this._internalSet(r,null))}r.destroy()}}get initialized(){return this.lifecycle!==$g.INITIALIZING}get(e){const r=this.propertiesByName.get(e);if(r.metadata.get)return r.getComputed(this);Wt(r.observerObject);const i=this.store;return i.has(e)?i.get(e):r.metadata.value}originOf(e){const r=this.store.originOf(e);if(r===void 0){const i=this.propertiesByName.get(e);if(i!==void 0&&i.observerObject.flags&Oi.HasDefaultValue)return"defaults"}return qN(r)}has(e){return!!this.propertiesByName.has(e)&&this.store.has(e)}keys(){return[...this.propertiesByName.keys()]}internalGet(e){const r=this.propertiesByName.get(e);if(SP(r))return this.store.has(e)?this.store.get(e):r.metadata.value}internalSet(e,r){const i=this.propertiesByName.get(e);SP(i)&&this._internalSet(i,r)}getDependsInfo(e,r,i){const s=this.propertiesByName.get(r);if(!SP(s))return"";const n=new Set,o=iy({onObservableAccessed:l=>n.add(l),onTrackingEnd:()=>{}},()=>s.metadata.get?.call(e));let a=`${i}${e.declaredClass.split(".").pop()}.${r}: ${o}
`;if(n.size===0)return a;i+="  ";for(const l of n)l instanceof fee&&(a+=`${i}${l.propertyName}: undefined
`);return a}setAtOrigin(e,r,i){const s=this.propertiesByName.get(e);if(SP(s))return this._setAtOrigin(s,r,i)}isOverridden(e){const r=this.propertiesByName.get(e);return r!==void 0&&!!(r.observerObject.flags&Oi.Overriden)}clearOverride(e){const r=this.propertiesByName.get(e),i=r?.observerObject;i&&i.flags&Oi.Overriden&&(i.flags&=~Oi.Overriden,r.notifyChange())}override(e,r){const i=this.propertiesByName.get(e);if(!mee(i,e,r,this))return;const s=i.metadata.cast;if(s){const n=this._cast(s,r),{valid:o,value:a}=n;if(f8.release(n),!o)return;r=a}i.observerObject.flags|=Oi.Overriden,this._internalSet(i,r)}set(e,r){const i=this.propertiesByName.get(e);if(!mee(i,e,r,this))return;const s=i.metadata.cast;if(s){const o=this._cast(s,r),{valid:a,value:l}=o;if(f8.release(o),!a)return;r=l}const n=i.metadata.set;n?n.call(this.host,r):this._internalSet(i,r)}setDefaultOrigin(e){this._origin=Fg(e)}getDefaultOrigin(){return qN(this._origin)}notifyChange(e){const r=this.propertiesByName.get(e);r!==void 0&&r.notifyChange()}invalidate(e){const r=this.propertiesByName.get(e);r!==void 0&&r.invalidate()}commit(e){const r=this.propertiesByName.get(e);r!==void 0&&r.commit()}_internalSet(e,r){const i=this.lifecycle!==$g.INITIALIZING?this._origin:mr.DEFAULTS;this._setAtOrigin(e,r,i)}_setAtOrigin(e,r,i){const s=this.store,n=e.propertyName;s.has(n,i)&&sX(r,s.get(n))&&~e.observerObject.flags&Oi.Overriden&&i===s.originOf(n)||(e.invalidate(),s.set(n,r,i),e.commit(),Ofe(this.host,e))}_cast(e,r){const i=f8.acquire();return i.valid=!0,i.value=r,e&&(i.value=e.call(this.host,r,i)),i}},d$e=class{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}};const f8=new Go(d$e);function p$e(t,e){return t.replaceAll(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,(r,i)=>i===""?"$":(wM(i,e)??"").toString())}let Pfe=class{constructor(e,r,i){this.name=e,this.details=i,this.message=(r&&p$e(r,i))??""}toString(){return"["+this.name+"]: "+this.message}},V=class Ife extends Pfe{constructor(e,r,i){super(e,r,i)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(e,r)=>{if(r&&typeof r=="object"&&typeof r.toJSON=="function")return r;try{return K(r)}catch{return"[object]"}}))}}catch(e){throw Q.getLogger("esri.core.Error").error(e),e}return{name:this.name,message:this.message,details:this.details}}static fromJSON(e){return new Ife(e.name,e.message,e.details)}};V.prototype.type="error";function XN(t,e,r){if(t&&e)if(typeof e=="object")for(const i of Object.getOwnPropertyNames(e))XN(t,i,e[i]);else{if(e.includes(".")){const s=e.split("."),n=s.splice(s.length-1,1)[0];return void XN(HN(t,s),n,r)}const i=t.__accessor__;i!=null&&f$e(e,i),t[e]=r}}function f$e(t,e){if(oe("esri-unknown-property-errors")&&!m$e(t,e))throw new V("set:unknown-property",g$e(t,e))}function m$e(t,e){return e.metadatas[t]!=null}function g$e(t,e){return"setting unknown property '"+t+"' on instance of "+e.host.declaredClass}let y$e;function _$e(){return y$e}let $fe=class extends Go{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=UE(this._set)}acquire(...e){const r=super.acquire(...e);return this._set.delete(r),r}release(e){e&&!this._set.has(e)&&(super.release(e),this._set.add(e))}_dispose(e){this._set.delete(e),super._dispose(e)}};const EP=[];function F2(t){EP.push(t),EP.length===1&&queueMicrotask(()=>{const e=EP.slice();EP.length=0;for(const r of e)r()})}let Ug=class{constructor(e,r=30){this.name=e,this._counter=0,this._samples=new Array(r)}record(e){e!=null&&(this._samples[++this._counter%this._samples.length]=e)}get median(){return this._samples.slice().sort((e,r)=>e-r)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((e,r)=>e+r,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}};var AV;(function(t){const e=(n,o,a,l)=>{let c=o,h=o;const p=a>>>1,f=n[c-1];for(;h<=p;){h=c<<1,h<a&&l(n[h-1],n[h])<0&&++h;const m=n[h-1];if(l(m,f)<=0)break;n[c-1]=m,c=h}n[c-1]=f},r=(n,o)=>n<o?-1:n>o?1:0;function i(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=r);for(let h=a>>>1;h>o;h--)e(n,h,a,l);const c=o+1;for(let h=a-1;h>o;h--){const p=n[o];n[o]=n[h],n[h]=p,e(n,c,h,l)}}function*s(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=r);for(let h=a>>>1;h>o;h--)e(n,h,a,l),yield;const c=o+1;for(let h=a-1;h>o;h--){const p=n[o];n[o]=n[h],n[h]=p,e(n,c,h,l),yield}}t.sort=i,t.iterableSort=s})(AV||(AV={}));const gee=AV,v$e=1.5,b$e=1.1;let Bt=class{constructor(e){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new cfe,e&&(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator&&(this._allocator=e.allocator),e.deallocator!==void 0&&(this._deallocator=e.deallocator),e.shrink&&(this._shrink=()=>yee(this)))}toArray(){return this.data.slice(0,this.length)}filter(e){const r=new Array;for(let i=0;i<this._length;i++){const s=this.data[i];e(s)&&r.push(s)}return r}at(e){if((e=Math.trunc(e)||0)<0&&(e+=this._length),!(e<0||e>=this._length))return this.data[e]}includes(e,r){const i=this.data.indexOf(e,r);return i!==-1&&i<this.length}get length(){return this._length}set length(e){if(e>this._length){if(this._allocator){for(;this._length<e;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=e}else{if(this._deallocator)for(let r=e;r<this._length;++r)this.data[r]=this._deallocator(this.data[r]);this._length=e,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(e){this.data[this._length++]=e}pushArray(e,r=e.length){for(let i=0;i<r;i++)this.data[this._length++]=e[i]}fill(e,r){for(let i=0;i<r;i++)this.data[this._length++]=e}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const e=this.data[this._length];return++this._length,e}unshift(e){this.data.unshift(e),this._length++,yee(this)}pop(){if(this.length===0)return;const e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}remove(e){const r=SV(this.data,e,this.length,this._hint);if(r!==-1)return this.data.splice(r,1),this.length=this.length-1,e}removeUnordered(e){return this.removeUnorderedIndex(SV(this.data,e,this.length,this._hint))}removeUnorderedIndex(e){if(!(e>=this.length||e<0))return this.swapElements(e,this.length-1),this.pop()}removeUnorderedMany(e,r=e.length,i){this.length=zIe(this.data,e,this.length,r,this._hint,i),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(e,r){if(e>=this.length||r>=this.length||e===r)return;const i=this.data[e];this.data[e]=this.data[r],this.data[r]=i}sort(e){gee.sort(this.data,0,this.length,e)}iterableSort(e){return gee.iterableSort(this.data,0,this.length,e)}some(e,r){for(let i=0;i<this.length;++i)if(e.call(r,this.data[i],i,this.data))return!0;return!1}find(e,r){for(let i=0;i<this.length;++i){const s=this.data[i];if(e.call(r,s,i))return s}}filterInPlace(e,r){let i=0;for(let s=0;s<this._length;++s){const n=this.data[s];e.call(r,n,s,this.data)&&(this.data[s]=this.data[i],this.data[i]=n,i++)}if(this._deallocator)for(let s=i;s<this._length;s++)this.data[s]=this._deallocator(this.data[s]);return this._length=i,this._shrink(),this}forAll(e,r){const i=this.length,s=this.data;for(let n=0;n<i;++n)e.call(r,s[n],n,s)}forEach(e,r){for(let i=0;i<this.length;++i)e.call(r,this.data[i],i,this.data)}map(e,r){const i=new Array(this.length);for(let s=0;s<this.length;++s)i[s]=e.call(r,this.data[s],s,this.data);return i}reduce(e,r){let i=r;for(let s=0;s<this.length;++s)i=e(i,this.data[s],s,this.data);return i}has(e){const r=this.length,i=this.data;for(let s=0;s<r;++s)if(i[s]===e)return!0;return!1}};function yee(t){t.data.length>v$e*t.length&&(t.data.length=Math.floor(t.length*b$e))}function w$e(t){return{setTimeout:(e,r)=>{const i=t.setTimeout(e,r);return{remove:()=>t.clearTimeout(i)}}}}const xM=w$e(globalThis);function F5(t){return t&&(typeof t.on=="function"||typeof t.addEventListener=="function")}function TM(t,e,r){if(!F5(t))throw new TypeError("target is not a Evented or EventTarget object");if("on"in t)return t.on(e,r);if(Array.isArray(e)){const i=e.slice();for(const s of i)t.addEventListener(s,r);return{remove(){for(const s of i)t.removeEventListener(s,r)}}}return t.addEventListener(e,r),{remove(){t.removeEventListener(e,r)}}}function Lfe(t,e,r){if(!F5(t))throw new TypeError("target is not a Evented or EventTarget object");if("once"in t)return t.once(e,r);const i=TM(t,e,s=>{i.remove(),r.call(t,s)});return{remove(){i.remove()}}}const x$e={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};function VL({key:t}){return x$e[t]||t}function kr(t="Aborted"){return new V("AbortError",t)}function Yt(t,e="Aborted"){if(An(t))throw kr(e)}function U5(t){return t!=null?"aborted"in t?t:t.signal:t}function An(t){const e=U5(t);return e!=null&&e.aborted}function Fo(t){if(us(t))throw t}function _ee(t){if(!us(t))throw t}function da(t,e){const r=U5(t);if(r!=null){if(!r.aborted)return Lfe(r,"abort",()=>e());e()}}function lX(t,e){const r=U5(t);if(r!=null)return Yt(r),Lfe(r,"abort",()=>e(kr()))}function Dfe(t,e){return U5(e)==null?t:new Promise((r,i)=>{let s=da(e,()=>i(kr()));const n=()=>s=Ni(s);t.then(n,n),t.then(r,i)})}function us(t){return t?.name==="AbortError"}async function OV(t){try{return await t}catch(e){if(!us(e))throw e;return}}async function PPt(t,e=Q.getLogger("esri")){try{return await t}catch(r){us(r)||e.error(r)}}async function bc(t){if(!t)return;if(typeof t.forEach!="function"){const r=Object.keys(t),i=r.map(o=>t[o]),s=await bc(i),n={};return r.map((o,a)=>n[o]=s[a]),n}const e=t;return Promise.allSettled(e).then(r=>Array.from(e,(i,s)=>{const n=r[s];return n.status==="fulfilled"?{promise:i,value:n.value}:{promise:i,error:n.reason}}))}async function RV(t){return(await bc(t)).filter(e=>!!e.value).map(e=>e.value)}function U2(t,e=void 0,r){const i=new AbortController;return da(r,()=>i.abort()),new Promise((s,n)=>{let o=setTimeout(()=>{o=0,s(e)},t);da(i,()=>{o&&(clearTimeout(o),n(kr()))})})}function Iu(t){return t&&typeof t.then=="function"}function MV(t){return Iu(t)?t:Promise.resolve(t)}function cX(t,e=-1){let r,i,s,n,o=null;const a=(...l)=>{if(r){i=l,n&&n.reject(kr()),n=xo();const f=n.promise;if(o){const m=o;o=null,m.abort()}return f}if(s=n||xo(),n=null,e>0){const f=new AbortController;r=MV(t(...l,f.signal));const m=r;U2(e).then(()=>{r===m&&(n?f.abort():o=f)})}else r=1,r=MV(t(...l));const c=()=>{const f=i;i=s=r=o=null,f!=null&&a(...f)},h=r,p=s;return h.then(c,c),h.then(p.resolve,p.reject),p.promise};return a}function xo(){let t,e;const r=new Promise((s,n)=>{t=s,e=n}),i=s=>{t(s)};return i.resolve=s=>t(s),i.reject=s=>e(s),i.timeout=(s,n)=>xM.setTimeout(()=>i.reject(n),s),i.promise=r,i}function IPt(t,e){return t.then(e,e)}async function vee(t){await Promise.resolve(),Yt(t)}function $Pt(t){return t}function Nfe(t){return 1e3*t}function uX(t){return .001*t}function T$e(){return performance.now()}let S$e=class{constructor(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1}},E$e=class{constructor(e){this.callback=e,this.isActive=!0}remove(){this.isActive=!1}},PV=0,IV=0;const wC={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},$V=["prepare","preRender","render","postRender","update","finish"],LV=[],fw=new Bt;let C$e=class{constructor(e){this._task=e}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}};const ZN={frameTasks:fw,willDispatch:!1,clearFrameTasks:A$e,dispatch:kfe,executeFrameTasks:R$e};function VE(t){const e=new E$e(t);return LV.push(e),ZN.willDispatch||(ZN.willDispatch=!0,F2(kfe)),e}function k2(t){const e=new S$e(t);return fw.push(e),YN==null&&(PV=performance.now(),YN=requestAnimationFrame(Ffe)),new C$e(e)}let YN=null;function A$e(t=!1){fw.forAll(e=>{e.removed=!0}),t&&Ufe()}function O$e(t){IV=Math.max(0,t)}function Ffe(){const t=performance.now();YN=null,YN=fw.length>0?requestAnimationFrame(Ffe):null,ZN.executeFrameTasks(t)}function R$e(t){const e=t-PV;PV=t;const r=IV>0?IV:1e3/60,i=Math.max(0,e-r);wC.time=t,wC.frameDuration=r-i;for(let s=0;s<$V.length;s++){const n=performance.now(),o=$V[s];fw.forAll(a=>{a.paused||a.removed||(s===0&&a.ticks++,a.phases[o]&&(wC.elapsedFrameTime=performance.now()-t,wC.deltaTime=a.ticks===0?0:e,a.phases[o]?.call(a,wC)))}),M$e[s].record(performance.now()-n)}Ufe(),P$e.record(performance.now()-t)}const CP=new Bt;function Ufe(){fw.forAll(t=>{t.removed&&CP.push(t)}),fw.removeUnorderedMany(CP.data,CP.length),CP.clear()}function kfe(){for(;LV.length;){const t=LV.shift();t.isActive&&t.callback()}ZN.willDispatch=!1}function FPt(t=1,e){const r=xo(),i=()=>{An(e)?r.reject(kr()):t===0?r():(--t,F2(()=>i()))};return i(),r.promise}const M$e=$V.map(t=>new Ug(t)),P$e=new Ug("total");function BL(t,e){for(const r of t.entries())if(e(r[0]))return!0;return!1}let I$e=0;const $$e=0;function Cc(){return++I$e}let k5=class{constructor(e){this._accessed=[],this._handles=[],this._observerObject=new L$e(e),bee.register(this,new WeakRef(this._observerObject),this)}destroy(){bee.unregister(this._observerObject),this._accessed.length=0,this._observerObject?.destroy(),this.clear()}onObservableAccessed(e){const r=this._accessed;r.includes(e)||r.push(e)}onTrackingEnd(){const e=this._handles,r=this._accessed,i=this._observerObject;for(let s=0;s<r.length;++s)e.push(r[s].observe(i));r.length=0}clear(){const e=this._handles;for(let r=0;r<e.length;++r)e[r].remove();e.length=0}},L$e=class{constructor(e){this._notify=e,this._invalidCount=0,this.destroyed=!1}onInvalidated(){this._invalidCount++}onCommitted(){if(this.destroyed)return;const e=this._invalidCount;if(e===1)return this._invalidCount=0,void this._notify();this._invalidCount=e>0?e-1:0}destroy(){this.destroyed=!0,this._notify=D$e}};const bee=new FinalizationRegistry(t=>{t.deref()?.destroy()});function D$e(){}let r2=!1;const JN=[];function zfe(t,e){let r=new k5(n),i=null,s=!1;function n(){if(!r||s)return;if(r2)return void Gfe(n);const a=i;r.clear(),r2=!0,s=!0,i=iy(r,t),s=!1,r2=!1,e(i,a),jfe()}function o(){r&&(r.destroy(),r=null,i=null)}return s=!0,i=iy(r,t),s=!1,{remove:o}}function Vfe(t,e){let r=new k5(s),i=null;function s(){e(i,o)}function n(){r&&(r.destroy(),r=null),i=null}function o(){return r?(r.clear(),i=iy(r,t),i):null}return o(),{remove:n}}function Bfe(t){let e=new k5(i),r=!1;function i(){e&&!r&&(r2?Gfe(i):(e.clear(),r2=!0,r=!0,iy(e,t),r=!1,r2=!1,jfe()))}function s(){e&&(e.destroy(),e=null)}return r=!0,iy(e,t),r=!1,{remove:s}}function Gfe(t){JN.includes(t)||JN.unshift(t)}function jfe(){for(;JN.length;)JN.pop()()}var gO;(function(t){t[t.Untracked=0]="Untracked",t[t.Tracked=1]="Tracked"})(gO||(gO={}));let hR=class{constructor(){this.uid=Cc(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(e,r,i,s,n){return this.pool.acquire(gO.Untracked,e,r,i,s,n,sX)}static acquireTracked(e,r,i,s){return this.pool.acquire(gO.Tracked,e,r,i,null,null,s)}notify(e,r){this.type===gO.Untracked?this.callback.call(this.target,e,r,this.path,this.target):this.callback.call(null,e,r,void 0,void 0)}acquire(e,r,i,s,n,o,a){this.uid=Cc(),this.removed=!1,this.type=e,this.oldValue=r,this.callback=i,this.getValue=s,this.target=n,this.path=o,this.equals=a}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=Cc(),this.removed=!0}};hR.pool=new $fe(hR);const GL=new mc,Gg=new Set;let QN;function KN(t){Gg.delete(t),Gg.add(t),QN||(QN=VE(U$e))}function N$e(t){if(t.removed)return;const e=t.oldValue,r=t.getValue();t.equals(e,r)||(t.oldValue=r,t.notify(r,e))}function F$e(t){for(const e of Gg.values())e.target===t&&(e.removed=!0)}function U$e(){let t=10;for(;QN&&t--;){QN=null;const e=k$e(),r=GL.acquire();for(const i of e){const s=i.uid;N$e(i),s===i.uid&&i.removed&&r.push(i)}for(const i of Gg)i.removed&&(r.push(i),Gg.delete(i));for(const i of r)hR.pool.release(i);GL.release(r),GL.release(e),DV.forEach(i=>i())}}function k$e(){const t=GL.acquire();t.length=Gg.size;let e=0;for(const r of Gg)t[e]=r,++e;return Gg.clear(),t}const DV=new Set;function Hfe(t){return DV.add(t),{remove(){DV.delete(t)}}}function z$e(t,e,r){let i=vfe(t,e,r,(s,n,o)=>{let a,l,c=Vfe(()=>_M(s,n),(h,p)=>{s.__accessor__.destroyed||a&&a.uid!==l?i.remove():(a||(a=hR.acquireUntracked(h,o,p,s,n),l=a.uid),KN(a))});return{remove:nX(()=>{c.remove(),a&&(a.uid!==l||a.removed||(a.removed=!0,KN(a)),a=null),i=c=null})}});return i}function V$e(t,e,r){const i=vfe(t,e,r,(s,n,o)=>{let a=!1;return zfe(()=>_M(s,n),(l,c)=>{s.__accessor__.destroyed?i.remove():a||(a=!0,sX(c,l)||o.call(s,l,c,n,s),a=!1)})});return i}function B$e(t,e,r,i=!1){return!t.__accessor__||t.__accessor__.destroyed?{remove(){}}:i?V$e(t,e,r):z$e(t,e,r)}function G$e(t,e,r){let i,s,n=Vfe(t,(o,a)=>{i&&i.uid!==s?n.remove():(i||(i=hR.acquireTracked(o,e,a,r),s=i.uid),KN(i))});return{remove:nX(()=>{n.remove(),i&&(i.uid!==s||i.removed||(i.removed=!0,KN(i)),i=null),n=null})}}function j$e(t,e,r){let i=!1;return zfe(t,(s,n)=>{i||(i=!0,r(n,s)||e(s,n),i=!1)})}function H$e(t,e,r=!1,i=yfe){return r?j$e(t,e,i):G$e(t,e,i)}function wee(t){return BL(Gg,e=>e.oldValue===t)}function ko(t,e){for(const[r,i]of t)if(e(i,r))return!0;return!1}function VPt(t,e){for(const[r,i]of t)if(e(i,r))return i;return null}function qfe(t,e,r){const i=t.get(e);if(i!==void 0)return i;const s=r();return t.set(e,s),s}const i2=Q.getLogger("esri.core.accessorSupport.ensureTypes");function q$e(t){return t==null?t:new Date(t)}function W$e(t){return t==null?t:!!t}function SM(t){return t==null?t:t.toString()}function yh(t){return t==null?t:(t=parseFloat(t),isNaN(t)?0:t)}function hX(t){return t==null?t:Math.round(parseFloat(t))}function Wfe(t){return t&&t.constructor&&t.constructor.__accessorMetadata__!==void 0}function e4(t,e){return e!=null&&t&&!(e instanceof t)}function Xfe(t){return t&&"isCollection"in t}function xee(t){return t&&t.Type?typeof t.Type=="function"?t.Type:t.Type.base:null}function X$e(t,e){if(!e||!e.constructor||!Xfe(e.constructor))return NV(t,e)?e:new t(e);const r=xee(t.prototype.itemType),i=xee(e.constructor.prototype.itemType);return r?i?r===i?e:r.prototype.isPrototypeOf(i.prototype)?new t(e):(NV(t,e),e):new t(e):e}function NV(t,e){return!!Wfe(e)&&(i2.error("Accessor#set","Assigning an instance of '"+(e.declaredClass||"unknown")+"' which is not a subclass of '"+z5(t)+"'"),!0)}function mw(t,e){return e==null?e:Xfe(t)?X$e(t,e):e4(t,e)?NV(t,e)?e:new t(e):e}function z5(t){return t&&t.prototype&&t.prototype.declaredClass||"unknown"}const Z$e=new WeakMap;function Y$e(t){switch(t){case Number:return yh;case Qi:return hX;case Boolean:return W$e;case String:return SM;case Date:return q$e;default:return qfe(Z$e,t,()=>mw.bind(null,t))}}function vs(t,e){const r=Y$e(t);return arguments.length===1?r:r(e)}function dR(t,e,r){return arguments.length===1?dR.bind(null,t):e&&(Array.isArray(e)?e.map(i=>t(i,r)):[t(e,r)])}function J$e(t,e){return arguments.length===1?dR(r=>vs(t,r)):dR(r=>vs(t,r),e)}function Zfe(t,e,r){return e!==0&&Array.isArray(r)?r.map(i=>Zfe(t,e-1,i)):t(r)}function t4(t,e,r){if(arguments.length===2)return n=>t4(t,e,n);if(!r)return r;r=Zfe(t,e,r);let i=e,s=r;for(;i>0&&Array.isArray(s);)i--,s=s[0];if(s!==void 0)for(let n=0;n<i;n++)r=[r];return r}function Q$e(t,e,r){return arguments.length===2?t4(i=>vs(t,i),e):t4(i=>vs(t,i),e,r)}function Yfe(t){return!!Array.isArray(t)&&!t.some(e=>{const r=typeof e;return!(r==="string"||r==="number"||r==="function"&&t.length>1)})}function FV(t,e){if(arguments.length===2)return FV(t).call(null,e);const r=new Set,i=t.filter(a=>typeof a!="function"),s=t.filter(a=>typeof a=="function");for(const a of t)typeof a!="string"&&typeof a!="number"||r.add(a);let n=null,o=null;return(a,l)=>{if(a==null)return a;const c=typeof a,h=c==="string"||c==="number";return h&&(r.has(a)||s.some(p=>c==="string"&&p===String||c==="number"&&p===Number))||c==="object"&&s.some(p=>!e4(a,p))?a:(h&&i.length?(n||(n=i.map(p=>typeof p=="string"?`'${p}'`:`${p}`).join(", ")),i2.error("Accessor#set",`'${a}' is not a valid value for this property, only the following values are valid: ${n}`)):typeof a=="object"&&s.length?(o||(o=s.map(p=>z5(p)).join(", ")),i2.error("Accessor#set",`'${a}' is not a valid value for this property, value must be one of ${o}`)):i2.error("Accessor#set",`'${a}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function bp(t,e){if(arguments.length===2)return bp(t).call(null,e);const r={},i=[],s=[];for(const l in t.typeMap){const c=t.typeMap[l];r[l]=vs(c),i.push(z5(c)),s.push(l)}const n=()=>`'${i.join("', '")}'`,o=()=>`'${s.join("', '")}'`,a=typeof t.key=="string"?l=>l[t.key]:t.key;return l=>{if(t.base&&!e4(t.base,l)||l==null)return l;const c=a(l)||t.defaultKeyValue,h=r[c];if(!h)return i2.error("Accessor#set",`Invalid property value, value needs to be one of ${n()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!e4(t.typeMap[c],l))return l;if(typeof t.key=="string"&&!Wfe(l)){const p={};for(const f in l)f!==t.key&&(p[f]=l[f]);return h(p)}return h(l)}}let Qi=class{};const GPt={native:t=>({type:"native",value:t}),array:t=>({type:"array",value:t}),oneOf:t=>({type:"one-of",values:t})};function K$e(t){if(!t||!("type"in t))return!1;switch(t.type){case"native":case"array":case"one-of":return!0}return!1}function Jfe(t){switch(t.type){case"native":return vs(t.value);case"array":return dR(Jfe(t.value));case"one-of":return eLe(t);default:return null}}function eLe(t){let e=null;return(r,i)=>kV(r,t)?r:(e==null&&(e=UV(t)),i2.error("Accessor#set",`Invalid property value, value needs to be of type ${e}`),i&&(i.valid=!1),null)}function UV(t){switch(t.type){case"native":switch(t.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case Qi:return"integer";case Date:return"date";default:return z5(t.value)}case"array":return`array of ${UV(t.value)}`;case"one-of":{const e=t.values.map(r=>UV(r));return`one of ${e.slice(0,e.length-1)} or ${e[e.length-1]}`}}return"unknown"}function kV(t,e){if(t==null)return!0;switch(e.type){case"native":switch(e.value){case Number:case Qi:return typeof t=="number";case Boolean:return typeof t=="boolean";case String:return typeof t=="string"}return t instanceof e.value;case"array":return!!Array.isArray(t)&&!t.some(r=>!kV(r,e.value));case"one-of":return e.values.some(r=>kV(t,r))}}function d(t={}){return(e,r)=>{if(e===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${e.name}.${r}. Accessor does not support static properties.`);const i=Object.getOwnPropertyDescriptor(e,r),s=bM(e,r);i&&(i.get||i.set?(s.get=i.get||s.get,s.set=i.set||s.set):"value"in i&&("value"in t&&Q.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${r}" on "${e.constructor.name}" already defined in the metadata`,t),s.value=t.value=i.value)),t.readOnly!=null&&(s.readOnly=t.readOnly);const n=t.aliasOf;if(n){const l=typeof n=="string"?n:n.source,c=typeof n=="string"?null:n.overridable===!0;let h;s.dependsOn=[l],s.get=function(){let p=HN(this,l);if(typeof p=="function"){h||(h=l.split(".").slice(0,-1).join("."));const f=HN(this,h);f&&(p=p.bind(f))}return p},s.readOnly||(s.set=c?function(p){this._override(r,p)}:function(p){XN(this,l,p)})}const o=t.type,a=t.types;s.cast||(o?s.cast=tLe(o):a&&(Array.isArray(a)?s.cast=dR(bp(a[0])):s.cast=bp(a))),QIe(s,t),t.range&&(s.cast=rLe(s.cast,t.range))}}function dX(t,e,r){const i=bM(t,r);i.json||(i.json={});let s=i.json;return e!==void 0&&(s.origins||(s.origins={}),s.origins[e]||(s.origins[e]={}),s=s.origins[e]),s}function tLe(t){let e=0,r=t;if(K$e(t))return Jfe(t);for(;Array.isArray(r)&&r.length===1&&typeof r[0]!="string"&&typeof r[0]!="number";)r=r[0],e++;const i=r;if(Yfe(i))return e===0?FV(i):t4(FV(i),e);if(e===1)return J$e(i);if(e>1)return Q$e(i,e);const s=t;return s.from?s.from:vs(s)}function rLe(t,e){return r=>{let i=+t(r);return e.step!=null&&(i=Math.round(i/e.step)*e.step),e.min!=null&&(i=Math.max(e.min,i)),e.max!=null&&(i=Math.min(e.max,i)),i}}function iLe(t){if(t.json&&t.json.origins){const e=t.json.origins,r={"web-document":["web-scene","web-map"]};for(const i in r)if(e[i]){const s=e[i];r[i].forEach(n=>{e[n]=s}),delete e[i]}}}let Nh=class extends Pfe{constructor(e,r,i){super(e,r,i)}};Nh.prototype.type="warning";function Qfe(t){return!!t&&t.prototype&&t.prototype.declaredClass&&t.prototype.declaredClass.indexOf("esri.core.Collection")===0}const zV=Q.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function Tee(t,e,r){t&&(!r&&!e.read||e.read?.reader||e.read?.enabled===!1||oLe(t)&&tl("read.reader",BE(t),e))}function BE(t){const e=t.ndimArray??0;if(e>1)return nLe(t);if(e===1)return See(t);if("type"in t&&eme(t.type)){const r=t.type.prototype?.itemType?.Type,i=See(typeof r=="function"?{type:r}:{types:r});return(s,n,o)=>{const a=i(s,n,o);return a&&new t.type(a)}}return pX(t)}function pX(t){return"type"in t?sLe(t.type):aLe(t.types)}function sLe(t){return t.prototype.read?(e,r,i)=>{if(e==null)return e;const s=typeof e;if(s!=="object")return void zV.error(`Expected JSON value of type 'object' to deserialize type '${t.prototype.declaredClass}', but got '${s}'`);const n=new t;return n.read(e,i),n}:t.fromJSON}function Kfe(t,e,r,i){return i!==0&&Array.isArray(e)?e.map(s=>Kfe(t,s,r,i-1)):t(e,void 0,r)}function nLe(t){const e=pX(t),r=Kfe.bind(null,e),i=t.ndimArray??0;return(s,n,o)=>{if(s==null)return s;s=r(s,o,i);let a=i,l=s;for(;a>0&&Array.isArray(l);)a--,l=l[0];if(l!==void 0)for(let c=0;c<a;c++)s=[s];return s}}function See(t){const e=pX(t);return(r,i,s)=>{if(r==null)return r;if(Array.isArray(r)){const o=[];for(const a of r){const l=e(a,void 0,s);l!==void 0&&o.push(l)}return o}const n=e(r,void 0,s);return n!==void 0?[n]:void 0}}function eme(t){if(!Qfe(t))return!1;const e=t.prototype.itemType;return!(!e||!e.Type)&&(typeof e.Type=="function"?fX(e.Type):tme(e.Type))}function oLe(t){return"types"in t?tme(t.types):fX(t.type)}function fX(t){return!Array.isArray(t)&&!!t&&t.prototype&&("read"in t.prototype||"fromJSON"in t||eme(t))}function tme(t){for(const e in t.typeMap)if(!fX(t.typeMap[e]))return!1;return!0}function aLe(t){let e=null;const r=t.errorContext??"type";return(i,s,n)=>{if(i==null)return i;const o=typeof i;if(o!=="object")return void zV.error(`Expected JSON value of type 'object' to deserialize, but got '${o}'`);e||(e=lLe(t));const a=t.key;if(typeof a!="string")return;const l=i[a],c=l?e[l]:t.defaultKeyValue?t.typeMap[t.defaultKeyValue]:void 0;if(!c){const p=`Type '${l||"unknown"}' is not supported`;return n&&n.messages&&i&&n.messages.push(new Nh(`${r}:unsupported`,p,{definition:i,context:n})),void zV.error(p)}const h=new c;return h.read(i,n),h}}function lLe(t){const e={};for(const r in t.typeMap){const i=t.typeMap[r],s=vM(i.prototype);if(typeof t.key=="function")continue;const n=s[t.key];if(!n)continue;n.json?.type&&Array.isArray(n.json.type)&&n.json.type.length===1&&typeof n.json.type[0]=="string"&&(e[n.json.type[0]]=i);const o=n.json?.write;if(!o||!o.writer){e[r]=i;continue}const a=o.target,l=typeof a=="string"?a:t.key,c={};o.writer(r,c,l),c[l]&&(e[c[l]]=i)}return e}function cLe(t){if(t.json||(t.json={}),Cee(t.json),Aee(t.json),Eee(t.json),t.json.origins)for(const e in t.json.origins)Cee(t.json.origins[e]),Aee(t.json.origins[e]),Eee(t.json.origins[e]);return!0}function Eee(t){t.name&&(t.read&&typeof t.read=="object"?t.read.source===void 0&&(t.read.source=t.name):t.read={source:t.name},t.write&&typeof t.write=="object"?t.write.target===void 0&&(t.write.target=t.name):t.write={target:t.name})}function Cee(t){typeof t.read=="boolean"?t.read={enabled:t.read}:typeof t.read=="function"?t.read={enabled:!0,reader:t.read}:t.read&&typeof t.read=="object"&&t.read.enabled===void 0&&(t.read.enabled=!0)}function Aee(t){typeof t.write=="boolean"?t.write={enabled:t.write}:typeof t.write=="function"?t.write={enabled:!0,writer:t.write}:t.write&&typeof t.write=="object"&&t.write.enabled===void 0&&(t.write.enabled=!0)}function Oee(t,e){if(!e.write||e.write.writer||e.write.enabled===!1&&!e.write.overridePolicy)return;const r=t?.ndimArray??0;t&&(r===1||"type"in t&&Qfe(t.type))?e.write.writer=dLe:r>1?e.write.writer=pLe(r):e.types?Array.isArray(e.types)?e.write.writer=hLe(e.types[0]):e.write.writer=uLe(e.types):e.write.writer=pR}function uLe(t){return(e,r,i,s)=>e?rme(e,t,s)?pR(e,r,i,s):void 0:pR(e,r,i,s)}function rme(t,e,r){for(const i in e.typeMap)if(t instanceof e.typeMap[i])return!0;if(r?.messages){const i=e.errorContext??"type",s=`Values of type '${(typeof e.key!="function"?t[e.key]:t.declaredClass)??"Unknown"}' cannot be written`;r&&r.messages&&t&&r.messages.push(new V(`${i}:unsupported`,s,{definition:t,context:r})),Q.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(s)}return!1}function hLe(t){return(e,r,i,s)=>!e||!Array.isArray(e)?pR(e,r,i,s):pR(e.filter(n=>rme(n,t,s)),r,i,s)}function pR(t,e,r,i){tl(r,r4(t,i),e)}function r4(t,e){return t&&typeof t.write=="function"?t.write({},e):t&&typeof t.toJSON=="function"?t.toJSON():typeof t=="number"?i4(t):t}function i4(t){return t===-1/0?-Number.MAX_VALUE:t===1/0?Number.MAX_VALUE:isNaN(t)?null:t}function dLe(t,e,r,i){let s;t===null?s=null:t&&typeof t.map=="function"?(s=t.map(n=>r4(n,i)),typeof s.toArray=="function"&&(s=s.toArray())):s=[r4(t,i)],tl(r,s,e)}function ime(t,e,r){return r!==0&&Array.isArray(t)?t.map(i=>ime(i,e,r-1)):r4(t,e)}function pLe(t){return(e,r,i,s)=>{let n;if(e===null)n=null;else{n=ime(e,s,t);let o=t,a=n;for(;o>0&&Array.isArray(a);)o--,a=a[0];if(a!==void 0)for(let l=0;l<o;l++)n=[n]}tl(i,n,r)}}function fLe(t,e){return mX(t,"any",e?.origin)}function VV(t,e){return mX(t,"read",e?.origin)}function sme(t,e){return mX(t,"write",e?.origin)}function mX(t,e,r){let i=t?.json;if(i?.origins&&r){let s;s=r==="link-chart"?i.origins[r]&&(e==="any"||e in i.origins[r])?i.origins[r]:i.origins["web-map"]:i.origins[r],s&&(e==="any"||e in s)&&(i=s)}return i}function mLe(t){const e=gLe(t);if(t.json.origins)for(const r in t.json.origins){const i=t.json.origins[r],s=i.types?yLe(i):e;Tee(s,i,!1),i.types&&!i.write&&t.json.write&&t.json.write.enabled&&(i.write={...t.json.write}),Oee(s,i)}Tee(e,t.json,!0),Oee(e,t.json)}function gLe(t){return t.json.types?BV(t.json):t.type?nme(t):BV(t)}function yLe(t){return t.type?nme(t):BV(t)}function nme(t){if(!t.type)return;let e=0,r=t.type;for(;Array.isArray(r)&&!Yfe(r);)r=r[0],e++;return{type:r,ndimArray:e}}function BV(t){if(!t.types)return;let e=0,r=t.types;for(;Array.isArray(r);)r=r[0],e++;return{types:r,ndimArray:e}}function _Le(t){cLe(t)&&(iLe(t),mLe(t))}const m8=new Set,g8=new Set;function P(t){return e=>{e.prototype.declaredClass=t,bLe(e);const r=[],i=[];let s=e.prototype;for(;s;)s.hasOwnProperty("initialize")&&!m8.has(s.initialize)&&(m8.add(s.initialize),r.push(s.initialize)),s.hasOwnProperty("destroy")&&!g8.has(s.destroy)&&(g8.add(s.destroy),i.push(s.destroy)),s=Object.getPrototypeOf(s);m8.clear(),g8.clear();class n extends e{constructor(...a){if(super(...a),this.constructor===n&&typeof this.postscript=="function"){if(r.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=r.length-1;l>=0;l--)r[l].call(this)}}),i.length){let l=!1;const c=this[afe];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0,c.call(this);for(let h=0;h<i.length;h++)i[h].call(this)}}})}this.postscript(...a)}}}return n.__accessorMetadata__=vM(e.prototype),n.prototype.declaredClass=t,n}}function vLe(t,e){return e.get==null?function(){const r=this.__accessor__,i=r.propertiesByName.get(t);if(i===void 0)return;Wt(i.observerObject);const s=r.store;return s.has(t)?s.get(t):i.metadata.value}:function(){const r=this.__accessor__,i=r.propertiesByName.get(t);if(i!==void 0)return i.getComputed(r)}}function bLe(t){const e=t.prototype,r=vM(e),i={};for(const s of Object.getOwnPropertyNames(r)){const n=r[s];_Le(n),i[s]={enumerable:!0,configurable:!0,get:vLe(s,n),set(o){const a=this.__accessor__;if(a!==void 0){if(!Object.isFrozen(this)){if(a.initialized&&n.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${s}' of ${this.declaredClass}`);if(a.lifecycle===$g.CONSTRUCTED&&n.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${s}' of ${this.declaredClass}`);a.set(s,o)}}else Object.defineProperty(this,s,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(t.prototype,i)}var ome,ame;function wLe(t){if(t==null)return{value:t};if(Array.isArray(t))return{type:[t[0]],value:null};switch(typeof t){case"object":return t.constructor?.__accessorMetadata__||t instanceof Date?{type:t.constructor,value:t}:t;case"boolean":return{type:Boolean,value:t};case"string":return{type:String,value:t};case"number":return{type:Number,value:t};case"function":return{type:t,value:null};default:return}}const T0=Symbol("Accessor-Handles"),GV=Symbol("Accessor-Initialized");let we=class lme{static createSubclass(e={}){if(Array.isArray(e))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:r,declaredClass:i,constructor:s}=e;delete e.declaredClass,delete e.properties,delete e.constructor;const n=this;class o extends n{constructor(...l){super(...l),this.inherited=null,s&&s.apply(this,l)}}vM(o.prototype);for(const a in e){const l=e[a];o.prototype[a]=typeof l=="function"?function(...c){const h=this.inherited;let p;this.inherited=function(...f){if(n.prototype[a])return n.prototype[a].apply(this,f)};try{p=l.apply(this,c)}catch(f){throw this.inherited=h,f}return this.inherited=h,p}:e[a]}for(const a in r){const l=wLe(r[a]);d(l)(o.prototype,a)}return P(i)(o)}constructor(...e){if(this[ome]=null,this[ame]=!1,this.constructor===lme)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");const r=new h$e(this);Object.defineProperty(this,"__accessor__",{enumerable:!1,value:r}),e.length>0&&this.normalizeCtorArgs&&(r.ctorArgs=this.normalizeCtorArgs.apply(this,e)),Ree.register(this,r.propertiesByName,this)}postscript(e){const r=this.__accessor__,i=r.ctorArgs||e;r.initialize(),i&&(this.set(i),r.ctorArgs=null),r.constructed(),this.initialize(),this[GV]=!0}initialize(){}[afe](){this[T0]=$e(this[T0])}destroy(){this.destroyed||(Ree.unregister(this),F$e(this),this.__accessor__.destroy(),_$e()?.onInstanceDestroy(this))}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[GV]}get destroyed(){return this.__accessor__&&this.__accessor__.destroyed||!1}commitProperty(e){this.get(e)}get(e){return HN(this,e)}hasOwnProperty(e){return this.__accessor__?this.__accessor__.has(e):Object.prototype.hasOwnProperty.call(this,e)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(e,r){return XN(this,e,r),this}watch(e,r,i){return B$e(this,e,r,i)}own(e){this.addHandles(e)}addHandles(e,r){if(this.destroyed){const s=Array.isArray(e)?e:[e];for(const n of s)n.remove();return}let i=this[T0];i==null&&(i=this[T0]=new Ii),i.add(e,r)}removeHandles(e){const r=this[T0];r?.remove(e)}removeAllHandles(){const e=this[T0];e?.removeAll()}hasHandles(e){const r=this[T0];return r!=null&&r.has(e)}_override(e,r){r===void 0?this.__accessor__.clearOverride(e):this.__accessor__.override(e,r)}_clearOverride(e){return this.__accessor__.clearOverride(e)}_overrideIfSome(e,r){r==null?this.__accessor__.clearOverride(e):this.__accessor__.override(e,r)}_isOverridden(e){return this.__accessor__.isOverridden(e)}notifyChange(e){this.__accessor__.notifyChange(e)}_get(e){return this.__accessor__.internalGet(e)}_set(e,r){return this.__accessor__.internalSet(e,r),this}};ome=T0,ame=GV;const Ree=new FinalizationRegistry(t=>{for(const e of t.values())e.destroy()});let jL=class cme{constructor(){this._emitter=new cme.EventEmitter(this)}emit(e,r){return this._emitter.emit(e,r)}on(e,r){return this._emitter.on(e,r)}once(e,r){return this._emitter.once(e,r)}hasEventListener(e){return this._emitter.hasEventListener(e)}};(function(t){class e{constructor(s=null){this._target=s,this._listenersMap=null}clear(){this._listenersMap?.clear(),this._listenersMap=null}destroy(){this.clear()}emit(s,n){const o=this._listenersMap&&this._listenersMap.get(s);if(!o)return!1;const a=this._target||this;return[...o].forEach(l=>{l.call(a,n)}),o.length>0}on(s,n){if(Array.isArray(s)){const a=s.map(l=>this.on(l,n));return N2(a)}if(s.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap||(this._listenersMap=new Map);const o=this._listenersMap.get(s)||[];return o.push(n),this._listenersMap.set(s,o),{remove:()=>{const a=this._listenersMap&&this._listenersMap.get(s)||[],l=a.indexOf(n);l>=0&&a.splice(l,1)}}}once(s,n){const o=this.on(s,a=>{o.remove(),n.call(null,a)});return o}hasEventListener(s){const n=this._listenersMap&&this._listenersMap.get(s);return n!=null&&n.length>0}}t.EventEmitter=e,t.EventedMixin=i=>{let s=class extends i{constructor(){super(...arguments),this._emitter=new e}destroy(){this._emitter.clear()}emit(n,o){return this._emitter.emit(n,o)}on(n,o){return this._emitter.on(n,o)}once(n,o){return this._emitter.once(n,o)}hasEventListener(n){return this._emitter.hasEventListener(n)}};return s=u([P("esri.core.Evented")],s),s};let r=class extends we{constructor(){super(...arguments),this._emitter=new jL.EventEmitter(this)}destroy(){this._emitter.clear()}emit(i,s){return this._emitter.emit(i,s)}on(i,s){return this._emitter.on(i,s)}once(i,s){return this._emitter.once(i,s)}hasEventListener(i){return this._emitter.hasEventListener(i)}};r=u([P("esri.core.Evented")],r),t.EventedAccessor=r})(jL||(jL={}));const ws=jL;var si;(function(t){t[t.ADD=1]="ADD",t[t.REMOVE=2]="REMOVE",t[t.MOVE=4]="MOVE"})(si||(si={}));function gX(t){return(e,r)=>{e[r]=t}}let V5=class extends Efe{notify(){const e=this._observers;if(e&&e.length>0){const r=e.slice();for(const i of r)i.onInvalidated(),i.onCommitted()}}};var Mg;let xLe=class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}};const Du=new Go(xLe,void 0,t=>{t.item=null,t.target=null,t.defaultPrevented=!1,t.cancellable=!1}),TLe=()=>{};function y8(t){return t?t instanceof vb?t.toArray():t.length?Array.prototype.slice.apply(t):[]:[]}function _8(t){if(t&&t.length)return t[0]}function SLe(t,e,r,i){const s=Math.min(t.length-r,e.length-i);let n=0;for(;n<s&&t[r+n]===e[i+n];)n++;return n}function ume(t,e,r,i){e&&e.forEach((s,n,o)=>{t.push(s),ume(t,r.call(i,s,n,o),r,i)})}const Vy=new Set,By=new Set,Gy=new Set,v8=new Map;let ELe=0,vb=Mg=class extends ws.EventedAccessor{static isCollection(t){return t!=null&&t instanceof Mg}constructor(t){super(t),this._chgListeners=[],this._notifications=null,this._timer=null,this._observable=new V5,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:ELe++})}normalizeCtorArgs(t){return t?Array.isArray(t)||t instanceof Mg?{items:t}:t:{}}destroy(){this._removeAllRaw()}*[Symbol.iterator](){yield*this.items}get items(){return Wt(this._observable),this._items}set items(t){this._emitBeforeChanges(si.ADD)||(this._splice(0,this.length,y8(t)),this._emitAfterChanges(si.ADD))}hasEventListener(t){return t==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(t)}on(t,e){if(t==="change"){const r=this._chgListeners,i={removed:!1,callback:e};return r.push(i),this._notifications&&this._notifications.push({listeners:r.slice(),items:this._items.slice(),changes:[]}),{remove(){this.remove=TLe,i.removed=!0,r.splice(r.indexOf(i),1)}}}return this._emitter.on(t,e)}once(t,e){const r=this.on(t,e);return{remove(){r.remove()}}}add(t,e){if(Wt(this._observable),this._emitBeforeChanges(si.ADD))return this;const r=this.getNextIndex(e??null);return this._splice(r,0,[t]),this._emitAfterChanges(si.ADD),this}addMany(t,e=this._items.length){if(Wt(this._observable),!t||!t.length)return this;if(this._emitBeforeChanges(si.ADD))return this;const r=this.getNextIndex(e);return this._splice(r,0,y8(t)),this._emitAfterChanges(si.ADD),this}at(t){if(Wt(this._observable),(t=Math.trunc(t)||0)<0&&(t+=this.length),!(t<0||t>=this.length))return this._items[t]}removeAll(){if(Wt(this._observable),!this.length||this._emitBeforeChanges(si.REMOVE))return[];const t=this._removeAllRaw();return this._emitAfterChanges(si.REMOVE),t}_removeAllRaw(){return this.length===0?[]:this._splice(0,this.length)||[]}clone(){return Wt(this._observable),this._createNewInstance({items:this._items.map(K)})}concat(...t){Wt(this._observable);const e=t.map(y8);return this._createNewInstance({items:this._items.concat(...e)})}drain(t,e){if(Wt(this._observable),!this.length||this._emitBeforeChanges(si.REMOVE))return;const r=this._splice(0,this.length),i=r.length;for(let s=0;s<i;s++)t.call(e,r[s],s,r);this._emitAfterChanges(si.REMOVE)}every(t,e){return Wt(this._observable),this._items.every(t,e)}filter(t,e){let r;return Wt(this._observable),r=arguments.length===2?this._items.filter(t,e):this._items.filter(t),this._createNewInstance({items:r})}find(t,e){return Wt(this._observable),this._items.find(t,e)}findIndex(t,e){return Wt(this._observable),this._items.findIndex(t,e)}flatten(t,e){Wt(this._observable);const r=[];return ume(r,this,t,e),new Mg(r)}forEach(t,e){return Wt(this._observable),this._items.forEach(t,e)}getItemAt(t){return Wt(this._observable),this._items[t]}getNextIndex(t){Wt(this._observable);const e=this.length;return(t=t??e)<0?t=0:t>e&&(t=e),t}includes(t,e=0){return Wt(this._observable),this._items.includes(t,e)}indexOf(t,e=0){return Wt(this._observable),this._items.indexOf(t,e)}join(t=","){return Wt(this._observable),this._items.join(t)}lastIndexOf(t,e=this.length-1){return Wt(this._observable),this._items.lastIndexOf(t,e)}map(t,e){Wt(this._observable);const r=this._items.map(t,e);return new Mg({items:r})}reorder(t,e=this.length-1){Wt(this._observable);const r=this.indexOf(t);if(r!==-1){if(e<0?e=0:e>=this.length&&(e=this.length-1),r!==e){if(this._emitBeforeChanges(si.MOVE))return t;this._splice(r,1),this._splice(e,0,[t]),this._emitAfterChanges(si.MOVE)}return t}}pop(){if(Wt(this._observable),!this.length||this._emitBeforeChanges(si.REMOVE))return;const t=_8(this._splice(this.length-1,1));return this._emitAfterChanges(si.REMOVE),t}push(...t){return Wt(this._observable),this._emitBeforeChanges(si.ADD)||(this._splice(this.length,0,t),this._emitAfterChanges(si.ADD)),this.length}reduce(t,e){Wt(this._observable);const r=this._items;return arguments.length===2?r.reduce(t,e):r.reduce(t)}reduceRight(t,e){Wt(this._observable);const r=this._items;return arguments.length===2?r.reduceRight(t,e):r.reduceRight(t)}remove(t){return Wt(this._observable),this.removeAt(this.indexOf(t))}removeAt(t){if(Wt(this._observable),t<0||t>=this.length||this._emitBeforeChanges(si.REMOVE))return;const e=_8(this._splice(t,1));return this._emitAfterChanges(si.REMOVE),e}removeMany(t){if(Wt(this._observable),!t||!t.length||this._emitBeforeChanges(si.REMOVE))return[];const e=t instanceof Mg?t.toArray():t,r=this._items,i=[],s=e.length;for(let n=0;n<s;n++){const o=e[n],a=r.indexOf(o);if(a>-1){const l=1+SLe(e,r,n+1,a+1),c=this._splice(a,l);c&&c.length>0&&i.push.apply(i,c),n+=l-1}}return this._emitAfterChanges(si.REMOVE),i}reverse(){if(Wt(this._observable),this._emitBeforeChanges(si.MOVE))return this;const t=this._splice(0,this.length);return t&&(t.reverse(),this._splice(0,0,t)),this._emitAfterChanges(si.MOVE),this}shift(){if(Wt(this._observable),!this.length||this._emitBeforeChanges(si.REMOVE))return;const t=_8(this._splice(0,1));return this._emitAfterChanges(si.REMOVE),t}slice(t=0,e=this.length){return Wt(this._observable),this._createNewInstance({items:this._items.slice(t,e)})}some(t,e){return Wt(this._observable),this._items.some(t,e)}sort(t){if(Wt(this._observable),!this.length||this._emitBeforeChanges(si.MOVE))return this;const e=this._splice(0,this.length);return arguments.length?e.sort(t):e.sort(),this._splice(0,0,e),this._emitAfterChanges(si.MOVE),this}splice(t,e,...r){Wt(this._observable);const i=(e?si.REMOVE:0)|(r.length?si.ADD:0);if(this._emitBeforeChanges(i))return[];const s=this._splice(t,e,r)||[];return this._emitAfterChanges(i),s}toArray(){return Wt(this._observable),this._items.slice()}toJSON(){return Wt(this._observable),this.toArray()}toLocaleString(){return Wt(this._observable),this._items.toLocaleString()}toString(){return Wt(this._observable),this._items.toString()}unshift(...t){return Wt(this._observable),!t.length||this._emitBeforeChanges(si.ADD)||(this._splice(0,0,t),this._emitAfterChanges(si.ADD)),this.length}_createNewInstance(t){return new this.constructor(t)}_splice(t,e,r){const i=this._items,s=this.itemType;let n,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=VE(()=>this._dispatchChange())),e){if(o=i.splice(t,e),this.hasEventListener("before-remove")){const a=Du.acquire();a.target=this,a.cancellable=!0;for(let l=0,c=o.length;l<c;l++)n=o[l],a.reset(n),this.emit("before-remove",a),a.defaultPrevented&&(o.splice(l,1),i.splice(t,0,n),t+=1,l-=1,c-=1);Du.release(a)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const a=Du.acquire();a.target=this,a.cancellable=!1;const l=o.length;for(let c=0;c<l;c++)a.reset(o[c]),this.emit("after-remove",a);Du.release(a)}}if(r&&r.length){if(s){const h=[];for(const p of r){const f=s.ensureType(p);f==null&&p!=null||h.push(f)}r=h}const a=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=t===this.length;if(a||l){const h=Du.acquire();h.target=this,h.cancellable=!0;const p=Du.acquire();p.target=this,p.cancellable=!1;for(const f of r)a?(h.reset(f),this.emit("before-add",h),h.defaultPrevented||(c?i.push(f):i.splice(t++,0,f),this._set("length",i.length),l&&(p.reset(f),this.emit("after-add",p)))):(c?i.push(f):i.splice(t++,0,f),this._set("length",i.length),p.reset(f),this.emit("after-add",p));Du.release(p),Du.release(h)}else{if(c)for(const h of r)i.push(h);else i.splice(t,0,...r);this._set("length",i.length)}}return(r&&r.length||o&&o.length)&&this._notifyChangeEvent(r,o),o}_emitBeforeChanges(t){let e=!1;if(this.hasEventListener("before-changes")){const r=Du.acquire();r.target=this,r.cancellable=!0,r.type=t,this.emit("before-changes",r),e=r.defaultPrevented,Du.release(r)}return e}_emitAfterChanges(t){if(this.hasEventListener("after-changes")){const e=Du.acquire();e.target=this,e.cancellable=!1,e.type=t,this.emit("after-changes",e),Du.release(e)}this._observable.notify()}_notifyChangeEvent(t,e){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:t,removed:e})}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),!this._notifications)return;const t=this._notifications;this._notifications=null;for(const e of t){const r=e.changes;Vy.clear(),By.clear(),Gy.clear();for(const{added:l,removed:c}of r){if(l)if(Gy.size===0&&By.size===0)for(const h of l)Vy.add(h);else for(const h of l)By.has(h)?(Gy.add(h),By.delete(h)):Gy.has(h)||Vy.add(h);if(c)if(Gy.size===0&&Vy.size===0)for(const h of c)By.add(h);else for(const h of c)Vy.has(h)?Vy.delete(h):(Gy.delete(h),By.add(h))}const i=mc.acquire();Vy.forEach(l=>{i.push(l)});const s=mc.acquire();By.forEach(l=>{s.push(l)});const n=this._items,o=e.items,a=mc.acquire();if(Gy.forEach(l=>{o.indexOf(l)!==n.indexOf(l)&&a.push(l)}),e.listeners&&(i.length||s.length||a.length)){const l={target:this,added:i,removed:s,moved:a},c=e.listeners.length;for(let h=0;h<c;h++){const p=e.listeners[h];p.removed||p.callback.call(this,l)}}mc.release(i),mc.release(s),mc.release(a)}Vy.clear(),By.clear(),Gy.clear()}};vb.ofType=t=>{if(!t)return Mg;if(v8.has(t))return v8.get(t);let e=null;if(typeof t=="function")e=t.prototype.declaredClass;else if(t.base)e=t.base.prototype.declaredClass;else for(const i in t.typeMap){const s=t.typeMap[i].prototype.declaredClass;e?e+=` | ${s}`:e=s}let r=class extends Mg{};return u([gX({Type:t,ensureType:typeof t=="function"?vs(t):bp(t)})],r.prototype,"itemType",void 0),r=u([P(`esri.core.Collection<${e}>`)],r),v8.set(t,r),r},u([d()],vb.prototype,"length",void 0),u([d()],vb.prototype,"items",null),vb=Mg=u([P("esri.core.Collection")],vb);const Pt=vb;function gw(t,e,r=Pt){return e||(e=new r),e===t||(e.removeAll(),CLe(t)?e.addMany(t):t&&e.add(t)),e}function hme(t){return t}function CLe(t){return t&&(Array.isArray(t)||"items"in t&&Array.isArray(t.items))}const Mee=new Set;function ALe(t,e,r=!1){r&&Mee.has(e)||(r&&Mee.add(e),t.warn(` DEPRECATED - ${e}`))}function rp(t,e,r={}){if(oe("esri-deprecation-warnings")){const{moduleName:i}=r;s4(t,`Property: ${(i?i+"::":"")+e}`,r)}}function s4(t,e,r={}){if(oe("esri-deprecation-warnings")){const{replacement:i,version:s,see:n,warnOnce:o}=r;let a=e;i&&(a+=`
	 Replacement: ${i}`),s&&(a+=`
	 Version: ${s}`),n&&(a+=`
	 See ${n} for more details.`),ALe(t,a,o)}}let OLe=class dme{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const r=new dme;return this._values.forEach((i,s)=>{e&&e.has(s)||r.set(s,K(i.value),i.origin)}),r}get(e,r){r=this._normalizeOrigin(r);const i=this._values.get(e);return r==null||i?.origin===r?i?.value:void 0}originOf(e){return this._values.get(e)?.origin??mr.USER}keys(e){e=this._normalizeOrigin(e);const r=[...this._values.keys()];return e==null?r:r.filter(i=>this._values.get(i)?.origin===e)}set(e,r,i){if((i=this._normalizeOrigin(i))===mr.DEFAULTS){const s=this._values.get(e);if(s&&s.origin!=null&&s.origin>i)return}this._values.set(e,new RLe(r,i))}delete(e,r){(r=this._normalizeOrigin(r))!=null&&this._values.get(e)?.origin!==r||this._values.delete(e)}has(e,r){return(r=this._normalizeOrigin(r))!=null?this._values.get(e)?.origin===r:this._values.has(e)}forEach(e){this._values.forEach(({value:r},i)=>e(r,i))}_normalizeOrigin(e){if(e!=null)return e===mr.DEFAULTS?e:mr.USER}},RLe=class{constructor(e,r){this.value=e,this.origin=r}};function pme(t,e,r){e.keys().forEach(s=>{r.set(s,e.get(s),mr.DEFAULTS)});const i=t.metadatas;Object.keys(i).forEach(s=>{t.internalGet(s)&&r.set(s,t.internalGet(s),mr.DEFAULTS)})}function MLe(t,e,r){if(!t||!t.read||t.read.enabled===!1||!t.read.source)return!1;const i=t.read.source;if(typeof i=="string"){if(i===e||i.includes(".")&&i.indexOf(e)===0&&uee(i,r))return!0}else for(const s of i)if(s===e||s.includes(".")&&s.indexOf(e)===0&&uee(s,r))return!0;return!1}function PLe(t){return t&&(!t.read||t.read.enabled!==!1&&!t.read.source)}function ILe(t,e,r,i,s){let n=VV(e[r],s);PLe(n)&&(t[r]=!0);for(const o of Object.getOwnPropertyNames(e))n=VV(e[o],s),MLe(n,r,i)&&(t[o]=!0)}function $Le(t,e,r,i){const s=r.metadatas,n=fLe(s[e],i),o=n?.default;if(o===void 0)return;const a=typeof o=="function"?o.call(t,e,i):o;a!==void 0&&r.set(e,a)}const fme={origin:"service"};function mme(t,e,r=fme){if(!e||typeof e!="object")return;const i=ma(t),s=i.metadatas,n={};for(const o of Object.getOwnPropertyNames(e))ILe(n,s,o,e,r);i.setDefaultOrigin(r.origin);for(const o of Object.getOwnPropertyNames(n)){const a=VV(s[o],r).read,l=a&&a.source;let c;c=l&&typeof l=="string"?_M(e,l):e[o],a&&a.reader&&(c=a.reader.call(t,c,e,r)),c!==void 0&&i.set(o,c)}if(!r||!r.ignoreDefaults){i.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(s))n[o]||$Le(t,o,i,r)}i.setDefaultOrigin("user")}function LLe(t,e,r,i=fme){const s={...i,messages:[]};r(s),s.messages?.forEach(n=>{n.type!=="warning"||t.loaded?i&&i.messages&&i.messages.push(n):t.loadWarnings.push(n)})}function DLe(t,e,r,i,s){const n={};return e.write?.writer?.call(t,i,n,r,s),n}function gme(t,e,r,i,s,n){if(!i||!i.write)return!1;const o=t.get(r);if(!s&&i.write.overridePolicy){const a=i.write.overridePolicy.call(t,o,r,n??void 0);a!==void 0&&(s=a)}if(s||(s=i.write),!s||s.enabled===!1)return!1;if((o===null&&!s.allowNull&&!s.writerEnsuresNonNull||o===void 0)&&s.isRequired){const a=new V("web-document-write:property-required",`Missing value for required property '${r}' on '${t.declaredClass}'`,{propertyName:r,target:t});return a&&n&&n.messages?n.messages.push(a):a&&!n&&Q.getLogger("esri.core.accessorSupport.write").error(a.name,a.message),!1}return!(o===void 0||o===null&&!s.allowNull&&!s.writerEnsuresNonNull||!s.alwaysWriteDefaults&&(!e.store.multipleOriginsSupported||e.store.originOf(r)===mr.DEFAULTS)&&NLe(t,r,n,i,o)||!s.ignoreOrigin&&n&&n.origin&&e.store.multipleOriginsSupported&&e.store.originOf(r)<Fg(n.origin))}function NLe(t,e,r,i,s){const n=i.default;if(n===void 0)return!1;if(i.defaultEquals!=null)return i.defaultEquals(s);if(typeof n=="function"){if(Array.isArray(s)){const o=n.call(t,e,r??void 0);return ry(o,s)}return!1}return n===s}function FLe(t,e,r,i){const s=ma(t),n=s.metadatas,o=sme(n[e],i);return!!o&&gme(t,s,e,o,r,i)}function yme(t,e,r){if(t&&typeof t.toJSON=="function"&&(!t.toJSON.isDefaultToJSON||!t.write))return UL(e,t.toJSON(r));const i=ma(t),s=i.metadatas;for(const n in s){const o=sme(s[n],r);if(!gme(t,i,n,o,void 0,r))continue;const a=t.get(n),l=DLe(t,o,o.write&&typeof o.write.target=="string"?o.write.target:n,a,r);Object.keys(l).length>0&&(e=UL(e,l),r?.resources?.pendingOperations?.length&&r.resources.pendingOperations.push(Promise.all(r.resources.pendingOperations).then(()=>UL(e,l,()=>"replace-arrays"))),r&&r.writtenProperties&&r.writtenProperties.push({target:t,propName:n,oldOrigin:n$e(i.store.originOf(n)),newOrigin:r.origin}))}return e}const GE=t=>{let e=class extends t{constructor(...r){super(...r);const i=ma(this),s=i.store,n=new OLe;i.store=n,pme(i,s,n)}read(r,i){mme(this,r,i)}write(r,i){return yme(this,r??{},i)}toJSON(r){return this.write({},r)}static fromJSON(r,i){return ULe.call(this,r,i)}};return e=u([P("esri.core.JSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function ULe(t,e){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const r=new this;return r.read(t,e),r}let le=class extends GE(we){};le=u([P("esri.core.JSONSupport")],le);var i_;(function(t){t[t.PENDING=0]="PENDING",t[t.RESOLVED=1]="RESOLVED",t[t.REJECTED=2]="REJECTED"})(i_||(i_={}));let kLe=class{constructor(){this._resolver=xo(),this._status=i_.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=i_.RESOLVED,this._cleanUp()},()=>{this._status=i_.REJECTED,this._cleanUp()}),this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(e){this._resolvingPromises.push(e),this._tryResolve()}isResolved(){return this._status===i_.RESOLVED}isRejected(){return this._status===i_.REJECTED}isFulfilled(){return this._status!==i_.PENDING}abort(){this._resolver.reject(kr())}_cleanUp(){this._allPromise=null,this._resolvingPromises=null}_tryResolve(){if(this.isFulfilled())return;const e=xo(),r=[...this._resolvingPromises,e.promise],i=this._allPromise=Promise.all(r);i.then(()=>{this.isFulfilled()||this._allPromise!==i||this._resolver.resolve()},s=>{this.isFulfilled()||this._allPromise!==i||us(s)||this._resolver.reject(s)}),e.resolve()}};const B5=t=>{let e=class extends t{constructor(...r){super(...r),this._promiseProps=new kLe,this.addResolvingPromise(Promise.resolve())}destroy(){this._promiseProps?.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(r,i){return this._promiseProps.promise.then(()=>this).then(r,i)}catch(r){return this.when(null,r)}addResolvingPromise(r){r&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in r?r.when():r)}};return e=u([P("esri.core.Promise")],e),e};let n4=class extends B5(we){};n4=u([P("esri.core.Promise")],n4);const zLe="not-loaded",VLe="loading",BLe="failed",Pee="loaded",_me=t=>{let e=class extends t{constructor(...r){super(...r),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(i=>{const s=this.load.bind(this);this.load=n=>{const o=new Promise((a,l)=>{const c=lX(n,l);this.destroyed&&l(new V("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this.when(a,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===zLe){this._set("loadStatus",VLe);const a=this._loadController=new AbortController;s({signal:a.signal}),da(a.signal,()=>{this._promiseProps.abort()})}return i(),o}})),this.when(()=>{this._set("loadStatus",Pee),this._loadController=null},i=>{this._set("loadStatus",BLe),this._set("loadError",i),this._loadController=null})}destroy(){this._loadController=Ll(this._loadController),this._set("loadError",null),this._set("loadWarnings",[])}get loaded(){return this.loadStatus===Pee}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){return this.isFulfilled()||(this._set("loadError",new V("load:cancelled","Cancelled")),this._loadController?.abort()),this}};return u([d({readOnly:!0})],e.prototype,"loaded",null),u([d({readOnly:!0})],e.prototype,"loadError",void 0),u([d({clonable:!1})],e.prototype,"loadStatus",void 0),u([d({type:[Nh],readOnly:!0})],e.prototype,"loadWarnings",null),e=u([P("esri.core.Loadable")],e),e};let IA=class extends _me(n4){};IA=u([P("esri.core.Loadable")],IA),function(t){function e(r){return!(!r||!r.load)}t.LoadableMixin=_me,t.isLoadable=e}(IA||(IA={}));const sy=IA;function G5(t,e,r){return bc(t.map((i,s)=>e.apply(r,[i,s])))}async function GLe(t,e,r){return(await bc(t.map((i,s)=>e.apply(r,[i,s])))).map(i=>i.value)}function yX(t){return{ok:!0,value:t}}function _X(t){return{ok:!1,error:t}}function jLe(t){return t!=null&&t.ok===!0?t.value:null}function HLe(t){return t!=null&&t.ok===!1?t.error:null}async function Eu(t){if(t==null)return{ok:!1,error:new Error("no promise provided")};try{return yX(await t)}catch(e){return _X(e)}}async function QPt(t){try{return yX(await t)}catch(e){return Fo(e),_X(e)}}function KPt(t){if(t.ok===!0)return t.value;throw t.error}function jE(t,e){return new S0(t,e)}let S0=class extends we{get value(){return jLe(this._result)}get error(){return HLe(this._result)}get finished(){return this._result!=null}constructor(e,r){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=Ll(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:i}=this._abortController;this.promise=e(i),this.promise.then(s=>{this._result=yX(s),this._cleanup()},s=>{this._result=_X(s),this._cleanup()}),this._abortHandle=da(r,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=Ni(this._abortHandle),this._abortController=null}};u([d()],S0.prototype,"value",null),u([d()],S0.prototype,"error",null),u([d()],S0.prototype,"finished",null),u([d()],S0.prototype,"promise",void 0),u([d()],S0.prototype,"_result",void 0),S0=u([P("esri.core.asyncUtils.ReactiveTask")],S0);async function vme(t,e){return await t.load(),qLe(t,e)}async function qLe(t,e){const r=[],i=(...n)=>{for(const o of n)o!=null&&(Array.isArray(o)?i(...o):Pt.isCollection(o)?o.forEach(a=>i(a)):sy.isLoadable(o)&&r.push(o))};e(i);let s=null;if(await GLe(r,async n=>{const o=await Eu(WLe(n)?n.loadAll():n.load());o.ok!==!1||s||(s=o)}),s)throw s.error;return t}function WLe(t){return"loadAll"in t&&typeof t.loadAll=="function"}const XLe=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,ZLe={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function Iee(t){const e=t?.match(XLe);if(!e)return null;const[,r,i,s]=e;if(!r)return null;let n=null,o=null,a=null;const{devext:l,qaext:c,www:h}=ZLe;if(i)if(n=r,s)switch(s.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qa":({customBaseUrl:o,portalHostname:a}=c);break;default:return null}else({customBaseUrl:o,portalHostname:a}=h);else switch(r.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qaext":({customBaseUrl:o,portalHostname:a}=c);break;case"www":({customBaseUrl:o,portalHostname:a}=h);break;default:return null}return{customBaseUrl:o,isPortal:!1,portalHostname:a,urlKey:n}}function YLe(t){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(t)}function JLe(t){const e=atob(t),r=new Uint8Array(e.length);for(let i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return r.buffer}const QLe=Q.getLogger("esri.core.urlUtils"),HE=Br.request,$ee="esri/config: esriConfig.request.proxyUrl is not set.",bme=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,wme=/^\s*http:/i,KLe=/^\s*https:/i,eDe=/^\s*file:/i,tDe=/:\d+$/,rDe=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,iDe=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),sDe=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");let s2=class{constructor(e=""){this.uri=e,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let r=this.uri.match(iDe);this.scheme=r[2]||(r[1]?"":null),this.authority=r[4]||(r[3]?"":null),this.path=r[5],this.query=r[7]||(r[6]?"":null),this.fragment=r[9]||(r[8]?"":null),this.authority!=null&&(r=this.authority.match(sDe),this.user=r[3]||null,this.password=r[4]||null,this.host=r[6]||r[7],this.port=r[9]||null)}toString(){return this.uri}};const AP={},nDe=new s2(Br.applicationUrl);let Za=nDe;const oDe=aDe();let vX=oDe;const bX=()=>Za,rIt=()=>vX;function aDe(){const t=Za.path,e=t.substring(0,t.lastIndexOf(t.split("/")[t.split("/").length-1]));return`${`${Za.scheme}://${Za.host}${Za.port!=null?`:${Za.port}`:""}`}${e}`}function To(t){if(!t)return null;const e={path:null,query:null},r=new s2(t),i=t.indexOf("?");return r.query===null?e.path=t:(e.path=t.substring(0,i),e.query=wX(r.query)),r.fragment&&(e.hash=r.fragment,r.query===null&&(e.path=e.path.substring(0,e.path.length-(r.fragment.length+1)))),e}function wX(t){const e=t.split("&"),r={};for(const i of e){if(!i)continue;const s=i.indexOf("=");let n,o;s<0?(n=decodeURIComponent(i),o=""):(n=decodeURIComponent(i.slice(0,s)),o=decodeURIComponent(i.slice(s+1)));let a=r[n];typeof a=="string"&&(a=r[n]=[a]),Array.isArray(a)?a.push(o):r[n]=o}return r}function Lee(t){return t&&typeof t=="object"&&"toJSON"in t&&typeof t.toJSON=="function"}function fR(t,e){return t?e&&typeof e=="function"?Object.keys(t).map(r=>encodeURIComponent(r)+"="+encodeURIComponent(e(r,t[r]))).join("&"):Object.keys(t).map(r=>{const i=t[r];if(i==null)return"";const s=encodeURIComponent(r)+"=",n=e&&e[r];return n?s+encodeURIComponent(n(i)):Array.isArray(i)?i.map(o=>Lee(o)?s+encodeURIComponent(JSON.stringify(o)):s+encodeURIComponent(o)).join("&"):Lee(i)?s+encodeURIComponent(JSON.stringify(i)):s+encodeURIComponent(i)}).filter(r=>r).join("&"):""}function lDe(t=!1){let e,r=HE.proxyUrl;if(typeof t=="string"){e=fDe(t);const i=j5(t);i&&(r=i.proxyUrl)}else e=!!t;if(!r)throw QLe.warn($ee),new V("urlutils:proxy-not-set",$ee);return e&&jV()&&(r=AX(r)),To(r)}function iIt(t){const e=j5(t);let r,i;if(e){const s=xX(e.proxyUrl);r=s.path,i=s.query?wX(s.query):null}if(r){const s=To(t);t=r+"?"+s.path;const n=fR({...i,...s.query});n&&(t=`${t}?${n}`)}return t}const xC={path:"",query:""};function xX(t){const e=t.indexOf("?");return e!==-1?(xC.path=t.slice(0,e),xC.query=t.slice(e+1)):(xC.path=t,xC.query=null),xC}function xme(t){return t=(t=a4(t=vDe(t=xX(t).path),!0)).toLowerCase()}function cDe(t){const e={proxyUrl:t.proxyUrl,urlPrefix:xme(t.urlPrefix)},r=HE.proxyRules,i=e.urlPrefix;let s=r.length;for(let n=0;n<r.length;n++){const o=r[n].urlPrefix;if(i.indexOf(o)===0){if(i.length===o.length)return-1;s=n;break}o.indexOf(i)===0&&(s=n+1)}return r.splice(s,0,e),s}function j5(t){const e=HE.proxyRules,r=xme(t);for(let i=0;i<e.length;i++)if(r.indexOf(e[i].urlPrefix)===0)return e[i]}function uDe(t,e){if(!t||!e)return!1;t=o4(t),e=o4(e);const r=Iee(t),i=Iee(e);return r!=null&&i!=null?r.portalHostname===i.portalHostname:r==null&&i==null&&z2(t,e,!0)}function Tme(t,e){return t=o4(t),e=o4(e),a4(t)===a4(e)}function o4(t){const e=(t=hp(t)).indexOf("/sharing");return e>0?t.substring(0,e):t.replace(/\/+$/,"")}function Sme(t){const e=i=>i==null||i instanceof RegExp&&i.test(t)||typeof i=="string"&&t.startsWith(i),r=HE.interceptors;if(r){for(const i of r)if(Array.isArray(i.urls)){if(i.urls.some(e))return i}else if(e(i.urls))return i}return null}function z2(t,e,r=!1){if(!t||!e)return!1;const i=qV(t),s=qV(e);return!(!r&&i.scheme!==s.scheme)&&i.host!=null&&s.host!=null&&i.host.toLowerCase()===s.host.toLowerCase()&&i.port===s.port}function TX(t){if(typeof t=="string"){if(!Ac(t))return!0;t=qV(t)}if(z2(t,Za))return!0;const e=HE.trustedServers||[];for(let r=0;r<e.length;r++){const i=hDe(e[r]);for(let s=0;s<i.length;s++)if(z2(t,i[s]))return!0}return!1}function hDe(t){return AP[t]||(CX(t)||nm(t)?AP[t]=[new s2(du(t))]:AP[t]=[new s2(`http://${t}`),new s2(`https://${t}`)]),AP[t]}function du(t,e=vX,r){return nm(t)?r&&r.preserveProtocolRelative?t:Za.scheme==="http"&&Za.authority===dp(t).slice(2)?`http:${t}`:`https:${t}`:CX(t)?t:Pc(t[0]==="/"?_De(e):e,t)}function SX(t,e=vX,r){if(t==null||!Ac(t))return t;const i=hp(t),s=i.toLowerCase(),n=hp(e).toLowerCase().replace(/\/+$/,""),o=r?hp(r).toLowerCase().replace(/\/+$/,""):null;if(o&&n.indexOf(o)!==0)return t;const a=(p,f,m)=>(m=p.indexOf(f,m))===-1?p.length:m;let l=a(s,"/",s.indexOf("//")+2),c=-1;for(;s.slice(0,l+1)===n.slice(0,l)+"/"&&(c=l+1,l!==s.length);)l=a(s,"/",l+1);if(c===-1||o&&c<o.length)return t;t=i.slice(c);const h=n.slice(c-1).replaceAll(/[^/]+/g,"").length;if(h>0)for(let p=0;p<h;p++)t=`../${t}`;else t=`./${t}`;return t}function hp(t){return t=xDe(t=wDe(t=bDe(t=du(t=t.trim()))))}function Pc(...t){const e=t.filter(jf);if(!e||!e.length)return;const r=[];if(Ac(e[0])){const s=e[0],n=s.indexOf("//");n!==-1&&(r.push(s.slice(0,n+1)),gDe(e[0])&&(r[0]+="/"),e[0]=s.slice(n+2))}else e[0][0]==="/"&&r.push("");const i=e.reduce((s,n)=>n?s.concat(n.split("/")):s,[]);for(let s=0;s<i.length;s++){const n=i[s];n===".."&&r.length>0&&r[r.length-1]!==".."?r.pop():(!n&&s===i.length-1||n&&(n!=="."||r.length===0))&&r.push(n)}return r.join("/")}function dp(t,e=!1){if(t==null||W_(t)||_m(t))return null;let r=t.indexOf("://");if(r===-1&&nm(t))r=2;else{if(r===-1)return null;r+=3}const i=t.indexOf("/",r);return i!==-1&&(t=t.slice(0,i)),e&&(t=a4(t,!0)),t}function Ac(t){return nm(t)||CX(t)}function W_(t){return t!=null&&t.slice(0,5)==="blob:"}function _m(t){return t!=null&&t.slice(0,5)==="data:"}function EX(t){const e=yw(t);return e&&e.isBase64?JLe(e.data):null}function sIt(t){return btoa(String.fromCharCode.apply(null,t)).replaceAll("+","-").replaceAll("/","_").replace(/=+$/,"")}const dDe=/^data:(.*?)(;base64)?,(.*)$/;function yw(t){const e=t.match(dDe);if(!e)return null;const[,r,i,s]=e;return{mediaType:r,isBase64:!!i,data:s}}function Eme(t){return t.isBase64?`data:${t.mediaType};base64,${t.data}`:`data:${t.mediaType},${t.data}`}function nIt(t){const e=EX(t);if(!e)return null;const r=yw(t);return new Blob([e],{type:r.mediaType})}function oIt(t,e){pDe(t,e)}function pDe(t,e){if(!t)return!1;const r=document.createElement("a");if(!("download"in r))return!1;const i=URL.createObjectURL(t);return r.download=e,r.href=i,r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i),!0}function nm(t){return t!=null&&t[0]==="/"&&t[1]==="/"}function CX(t){return t!=null&&bme.test(t)}function fDe(t){return t!=null&&KLe.test(t)||Za.scheme==="https"&&nm(t)}function mDe(t){return t!=null&&wme.test(t)||Za.scheme==="http"&&nm(t)}function gDe(t){return t!=null&&eDe.test(t)}function AX(t){return nm(t)?`https:${t}`:t.replace(wme,"https:")}function yDe(){return Za.scheme==="http"}function jV(){return Za.scheme==="https"}function a4(t,e=!1){return nm(t)?t.slice(2):(t=t.replace(bme,""),e&&t.length>1&&t[0]==="/"&&t[1]==="/"&&(t=t.slice(2)),t)}function _De(t){const e=t.indexOf("//"),r=t.indexOf("/",e+2);return r===-1?t:t.slice(0,r)}function OX(t){let e=0;if(Ac(t)){const i=t.indexOf("//");i!==-1&&(e=i+2)}const r=t.lastIndexOf("/");return r<e?t:t.slice(0,r+1)}function aIt(t,e){if(!t)return"";const r=To(t).path.replace(/\/+$/,""),i=r.substring(r.lastIndexOf("/")+1);if(!e?.length)return i;const s=new RegExp(`.(${e.join("|")})$`,"ig");return i.replace(s,"")}function vDe(t){return t&&t[t.length-1]==="/"?t:`${t}/`}function Cme(t){return t.replace(/\/+$/,"")}function bDe(t){if(/^https?:\/\//i.test(t)){const e=xX(t);t=(t=e.path.replaceAll(/\/{2,}/g,"/")).replace("/","//"),e.query&&(t+=`?${e.query}`)}return t}function wDe(t){return t.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function xDe(t){const e=HE.httpsDomains;if(!mDe(t))return t;const r=t.indexOf("/",7);let i;if(i=r===-1?t:t.slice(0,r),i=i.toLowerCase().slice(7),tDe.test(i)){if(!i.endsWith(":80"))return t;i=i.slice(0,-3),t=t.replace(":80","")}return yDe()&&i===Za.authority&&!rDe.test(t)||(jV()&&i===Za.authority||e&&e.some(s=>i===s||i.endsWith(`.${s}`))||jV()&&!j5(t))&&(t=AX(t)),t}function HV(t,e,r){if(!(e&&r&&t&&Ac(t)))return t;const i=t.indexOf("//"),s=t.indexOf("/",i+2),n=t.indexOf(":",i+2),o=Math.min(s<0?t.length:s,n<0?t.length:n);return t.slice(i+2,o).toLowerCase()!==e.toLowerCase()?t:`${t.slice(0,i+2)}${r}${t.slice(o)}`}function qV(t){return typeof t=="string"?new s2(du(t)):(t.scheme||(t.scheme=Za.scheme),t)}function Ame(t){return TDe.test(t)}function Ome(t,e){const r=To(t),i=Object.keys(r.query||{});return i.length>0&&e&&e.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${i.join(", ")}.`),r.path}function Rme(t,e,r){const i=To(t),s=i.query||{};return s[e]=String(r),`${i.path}?${fR(s)}`}function b8(t,e){const r=To(t),i=r.query||{};for(const n in e)i[n]=e[n];const s=fR(i);return s?`${r.path}?${s}`:r.path}function RX(t){if(t==null)return null;const e=t.match(Mme);return e?e[2]:null}function Dee(t){if(t==null)return null;const e=t.match(Mme);return e?{path:e[1],extension:e[2]}:{path:t,extension:null}}async function lIt(t){return typeof t=="string"?yw(t)??{data:t}:new Promise((e,r)=>{const i=new FileReader;i.readAsDataURL(t),i.onload=()=>e(yw(i.result)),i.onerror=s=>r(s)})}const Mme=/([^.]*)\.([^\/]*)$/,TDe=/(^data:image\/svg|\.svg$)/i;function ke(t,e,r){let i,s;return e===void 0?(s=t,i=[void 0]):typeof e!="string"?(s=t,i=[void 0],r=e):(s=e,i=Array.isArray(t)?t:[t]),(n,o)=>{const a=n.constructor.prototype;for(const l of i){const c=dX(n,l,s);c.write&&typeof c.write=="object"||(c.write={}),r&&(c.write.target=r),c.write.writer=a[o]}}}let $r=class{constructor(e,r={ignoreUnknown:!1,useNumericKeys:!1}){this._jsonToAPI=e,this._options=r,this.apiValues=[],this.jsonValues=[],this._apiToJSON=this._invertMap(e),this.apiValues=this._getKeysSorted(this._apiToJSON),this.jsonValues=this._getKeysSorted(this._jsonToAPI),this.read=i=>this.fromJSON(i),this.write=(i,s,n)=>{const o=this.toJSON(i);o!==void 0&&tl(n,o,s)},this.write.isJSONMapWriter=!0}toJSON(e){if(e==null)return null;if(this._apiToJSON.hasOwnProperty(e)){const r=this._apiToJSON[e];return this._options.useNumericKeys?+r:r}return this._options.ignoreUnknown?void 0:e}fromJSON(e){return e!=null&&this._jsonToAPI.hasOwnProperty(e)?this._jsonToAPI[e]:this._options.ignoreUnknown?void 0:e}_invertMap(e){const r={};for(const i in e)r[e[i]]=i;return r}_getKeysSorted(e){const r=[];for(const i in e)r.push(i);return r.sort(),r}};function il(){return function(t,e){return new $r(t,{ignoreUnknown:!0,...e})}}let MX=class{constructor(e,r,i,s){this.semiMajorAxis=e,this.flattening=r,this.outerAtmosphereRimWidth=i;const n=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*n,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=s||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}};const or=new MX(6378137,1/298.257223563,3e5,.006694379990137799),Hf=new MX(3396190,1/169.8944472236118,23e4),ny=new MX(1737400,0,0);var Eh;(function(t){t[t.CGCS2000=4490]="CGCS2000",t[t.GCSMARS2000=104971]="GCSMARS2000",t[t.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",t[t.GCSMOON2000=104903]="GCSMOON2000"})(Eh||(Eh={}));let g;const L={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5041:0,5042:0,5048:0,5167:0,5168:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,9793:0,9794:0,9869:0,9874:0,9875:0,9880:0,9943:0,9945:0,9947:0,9967:0,9972:0,9977:0,20042:0,20050:1,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22239:0,22240:0,22332:0,22337:0,22338:0,22391:0,22392:0,22639:0,22700:0,22739:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102731:0,102732:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2};for(g=2e3;g<=2045;g++)L[g]=0;for(g=2056;g<=2065;g++)L[g]=0;for(g=2067;g<=2135;g++)L[g]=0;for(g=2137;g<=2154;g++)L[g]=0;for(g=2161;g<=2170;g++)L[g]=0;for(g=2172;g<=2193;g++)L[g]=0;for(g=2195;g<=2198;g++)L[g]=0;for(g=2200;g<=2203;g++)L[g]=0;for(g=2205;g<=2217;g++)L[g]=0;for(g=2222;g<=2224;g++)L[g]=1;for(g=2225;g<=2250;g++)L[g]=2;for(g=2251;g<=2253;g++)L[g]=1;for(g=2257;g<=2264;g++)L[g]=2;for(g=2274;g<=2279;g++)L[g]=2;for(g=2280;g<=2282;g++)L[g]=1;for(g=2283;g<=2289;g++)L[g]=2;for(g=2290;g<=2292;g++)L[g]=0;for(g=2308;g<=2313;g++)L[g]=0;for(g=2315;g<=2491;g++)L[g]=0;for(g=2494;g<=2866;g++)L[g]=0;for(g=2867;g<=2869;g++)L[g]=1;for(g=2870;g<=2888;g++)L[g]=2;for(g=2891;g<=2895;g++)L[g]=2;for(g=2896;g<=2898;g++)L[g]=1;for(g=2902;g<=2908;g++)L[g]=2;for(g=2915;g<=2920;g++)L[g]=2;for(g=2921;g<=2923;g++)L[g]=1;for(g=2924;g<=2930;g++)L[g]=2;for(g=2931;g<=2962;g++)L[g]=0;for(g=2964;g<=2968;g++)L[g]=2;for(g=2969;g<=2973;g++)L[g]=0;for(g=2975;g<=2991;g++)L[g]=0;for(g=2995;g<=3051;g++)L[g]=0;for(g=3054;g<=3079;g++)L[g]=0;for(g=3081;g<=3088;g++)L[g]=0;for(g=3092;g<=3101;g++)L[g]=0;for(g=3106;g<=3138;g++)L[g]=0;for(g=3146;g<=3151;g++)L[g]=0;for(g=3153;g<=3166;g++)L[g]=0;for(g=3168;g<=3172;g++)L[g]=0;for(g=3174;g<=3203;g++)L[g]=0;for(g=3294;g<=3358;g++)L[g]=0;for(g=3367;g<=3403;g++)L[g]=0;for(g=3408;g<=3416;g++)L[g]=0;for(g=3417;g<=3438;g++)L[g]=2;for(g=3441;g<=3446;g++)L[g]=2;for(g=3447;g<=3450;g++)L[g]=0;for(g=3451;g<=3459;g++)L[g]=2;for(g=3460;g<=3478;g++)L[g]=0;for(g=3554;g<=3559;g++)L[g]=0;for(g=3560;g<=3570;g++)L[g]=2;for(g=3571;g<=3581;g++)L[g]=0;for(g=3594;g<=3597;g++)L[g]=0;for(g=3601;g<=3604;g++)L[g]=0;for(g=3637;g<=3639;g++)L[g]=0;for(g=3665;g<=3667;g++)L[g]=0;for(g=3693;g<=3695;g++)L[g]=0;for(g=3701;g<=3727;g++)L[g]=0;for(g=3728;g<=3739;g++)L[g]=2;for(g=3740;g<=3751;g++)L[g]=0;for(g=3753;g<=3760;g++)L[g]=2;for(g=3761;g<=3773;g++)L[g]=0;for(g=3775;g<=3777;g++)L[g]=0;for(g=3779;g<=3781;g++)L[g]=0;for(g=3783;g<=3785;g++)L[g]=0;for(g=3788;g<=3791;g++)L[g]=0;for(g=3797;g<=3802;g++)L[g]=0;for(g=3814;g<=3816;g++)L[g]=0;for(g=3825;g<=3829;g++)L[g]=0;for(g=3832;g<=3841;g++)L[g]=0;for(g=3844;g<=3852;g++)L[g]=0;for(g=3873;g<=3885;g++)L[g]=0;for(g=3890;g<=3893;g++)L[g]=0;for(g=3907;g<=3912;g++)L[g]=0;for(g=3942;g<=3950;g++)L[g]=0;for(g=3968;g<=3970;g++)L[g]=0;for(g=3973;g<=3976;g++)L[g]=0;for(g=3986;g<=3989;g++)L[g]=0;for(g=3994;g<=3997;g++)L[g]=0;for(g=4048;g<=4051;g++)L[g]=0;for(g=4056;g<=4063;g++)L[g]=0;for(g=4093;g<=4096;g++)L[g]=0;for(g=4390;g<=4398;g++)L[g]=0;for(g=4399;g<=4413;g++)L[g]=2;for(g=4418;g<=4433;g++)L[g]=2;for(g=4455;g<=4457;g++)L[g]=2;for(g=4484;g<=4489;g++)L[g]=0;for(g=4491;g<=4554;g++)L[g]=0;for(g=4568;g<=4589;g++)L[g]=0;for(g=4652;g<=4656;g++)L[g]=0;for(g=4766;g<=4800;g++)L[g]=0;for(g=5014;g<=5016;g++)L[g]=0;for(g=5069;g<=5072;g++)L[g]=0;for(g=5105;g<=5130;g++)L[g]=0;for(g=5173;g<=5188;g++)L[g]=0;for(g=5253;g<=5259;g++)L[g]=0;for(g=5269;g<=5275;g++)L[g]=0;for(g=5292;g<=5311;g++)L[g]=0;for(g=5329;g<=5331;g++)L[g]=0;for(g=5343;g<=5349;g++)L[g]=0;for(g=5355;g<=5357;g++)L[g]=0;for(g=5387;g<=5389;g++)L[g]=0;for(g=5459;g<=5463;g++)L[g]=0;for(g=5479;g<=5482;g++)L[g]=0;for(g=5518;g<=5520;g++)L[g]=0;for(g=5530;g<=5539;g++)L[g]=0;for(g=5550;g<=5552;g++)L[g]=0;for(g=5562;g<=5583;g++)L[g]=0;for(g=5623;g<=5625;g++)L[g]=2;for(g=5631;g<=5639;g++)L[g]=0;for(g=5649;g<=5653;g++)L[g]=0;for(g=5663;g<=5680;g++)L[g]=0;for(g=5682;g<=5685;g++)L[g]=0;for(g=5875;g<=5877;g++)L[g]=0;for(g=5896;g<=5899;g++)L[g]=0;for(g=5921;g<=5940;g++)L[g]=0;for(g=6050;g<=6125;g++)L[g]=0;for(g=6244;g<=6275;g++)L[g]=0;for(g=6328;g<=6348;g++)L[g]=0;for(g=6350;g<=6356;g++)L[g]=0;for(g=6366;g<=6372;g++)L[g]=0;for(g=6381;g<=6387;g++)L[g]=0;for(g=6393;g<=6404;g++)L[g]=0;for(g=6480;g<=6483;g++)L[g]=0;for(g=6511;g<=6514;g++)L[g]=0;for(g=6579;g<=6581;g++)L[g]=0;for(g=6619;g<=6624;g++)L[g]=0;for(g=6625;g<=6627;g++)L[g]=2;for(g=6628;g<=6632;g++)L[g]=0;for(g=6634;g<=6637;g++)L[g]=0;for(g=6669;g<=6692;g++)L[g]=0;for(g=6707;g<=6709;g++)L[g]=0;for(g=6720;g<=6723;g++)L[g]=0;for(g=6732;g<=6738;g++)L[g]=0;for(g=6931;g<=6933;g++)L[g]=0;for(g=6956;g<=6959;g++)L[g]=0;for(g=7005;g<=7007;g++)L[g]=0;for(g=7057;g<=7070;g++)L[g]=2;for(g=7074;g<=7082;g++)L[g]=0;for(g=7109;g<=7118;g++)L[g]=0;for(g=7119;g<=7127;g++)L[g]=1;for(g=7374;g<=7376;g++)L[g]=0;for(g=7528;g<=7586;g++)L[g]=0;for(g=7587;g<=7645;g++)L[g]=2;for(g=7692;g<=7696;g++)L[g]=0;for(g=7755;g<=7787;g++)L[g]=0;for(g=7791;g<=7795;g++)L[g]=0;for(g=7799;g<=7801;g++)L[g]=0;for(g=7803;g<=7805;g++)L[g]=0;for(g=7825;g<=7831;g++)L[g]=0;for(g=7845;g<=7859;g++)L[g]=0;for(g=8013;g<=8032;g++)L[g]=0;for(g=8065;g<=8068;g++)L[g]=1;for(g=8518;g<=8529;g++)L[g]=2;for(g=8533;g<=8536;g++)L[g]=2;for(g=8538;g<=8540;g++)L[g]=2;for(g=8677;g<=8679;g++)L[g]=0;for(g=8836;g<=8840;g++)L[g]=0;for(g=8857;g<=8859;g++)L[g]=0;for(g=8908;g<=8910;g++)L[g]=0;for(g=9154;g<=9159;g++)L[g]=0;for(g=9205;g<=9218;g++)L[g]=0;for(g=9271;g<=9273;g++)L[g]=0;for(g=9295;g<=9297;g++)L[g]=0;for(g=9356;g<=9360;g++)L[g]=0;for(g=9404;g<=9407;g++)L[g]=0;for(g=9476;g<=9482;g++)L[g]=0;for(g=9487;g<=9494;g++)L[g]=0;for(g=9697;g<=9699;g++)L[g]=0;for(g=9821;g<=9865;g++)L[g]=0;for(g=20002;g<=20032;g++)L[g]=0;for(g=20047;g<=20049;g++)L[g]=0;for(g=20062;g<=20092;g++)L[g]=0;for(g=20135;g<=20138;g++)L[g]=0;for(g=20248;g<=20258;g++)L[g]=0;for(g=20348;g<=20358;g++)L[g]=0;for(g=20436;g<=20440;g++)L[g]=0;for(g=20822;g<=20824;g++)L[g]=0;for(g=20904;g<=20932;g++)L[g]=0;for(g=20934;g<=20936;g++)L[g]=0;for(g=21004;g<=21032;g++)L[g]=0;for(g=21035;g<=21037;g++)L[g]=0;for(g=21095;g<=21097;g++)L[g]=0;for(g=21148;g<=21150;g++)L[g]=0;for(g=21207;g<=21264;g++)L[g]=0;for(g=21307;g<=21364;g++)L[g]=0;for(g=21413;g<=21423;g++)L[g]=0;for(g=21453;g<=21463;g++)L[g]=0;for(g=21473;g<=21483;g++)L[g]=0;for(g=21780;g<=21782;g++)L[g]=0;for(g=21891;g<=21894;g++)L[g]=0;for(g=21896;g<=21899;g++)L[g]=0;for(g=22171;g<=22177;g++)L[g]=0;for(g=22181;g<=22187;g++)L[g]=0;for(g=22191;g<=22197;g++)L[g]=0;for(g=22207;g<=22222;g++)L[g]=0;for(g=22234;g<=22236;g++)L[g]=0;for(g=22243;g<=22250;g++)L[g]=0;for(g=22262;g<=22265;g++)L[g]=0;for(g=22307;g<=22322;g++)L[g]=0;for(g=22348;g<=22357;g++)L[g]=0;for(g=22407;g<=22422;g++)L[g]=0;for(g=22462;g<=22465;g++)L[g]=0;for(g=22521;g<=22525;g++)L[g]=0;for(g=22607;g<=22622;g++)L[g]=0;for(g=22641;g<=22646;g++)L[g]=0;for(g=22648;g<=22657;g++)L[g]=0;for(g=22707;g<=22722;g++)L[g]=0;for(g=22762;g<=22765;g++)L[g]=0;for(g=22991;g<=22994;g++)L[g]=0;for(g=23028;g<=23038;g++)L[g]=0;for(g=23830;g<=23853;g++)L[g]=0;for(g=23866;g<=23872;g++)L[g]=0;for(g=23877;g<=23884;g++)L[g]=0;for(g=23886;g<=23894;g++)L[g]=0;for(g=23946;g<=23948;g++)L[g]=0;for(g=24311;g<=24313;g++)L[g]=0;for(g=24342;g<=24347;g++)L[g]=0;for(g=24370;g<=24374;g++)L[g]=10;for(g=24375;g<=24381;g++)L[g]=0;for(g=24718;g<=24721;g++)L[g]=0;for(g=24817;g<=24821;g++)L[g]=0;for(g=24877;g<=24882;g++)L[g]=0;for(g=24891;g<=24893;g++)L[g]=0;for(g=25391;g<=25395;g++)L[g]=0;for(g=25828;g<=25838;g++)L[g]=0;for(g=26191;g<=26195;g++)L[g]=0;for(g=26391;g<=26393;g++)L[g]=0;for(g=26701;g<=26722;g++)L[g]=0;for(g=26729;g<=26799;g++)L[g]=2;for(g=26801;g<=26803;g++)L[g]=2;for(g=26811;g<=26813;g++)L[g]=2;for(g=26847;g<=26870;g++)L[g]=2;for(g=26891;g<=26899;g++)L[g]=0;for(g=26901;g<=26923;g++)L[g]=0;for(g=26929;g<=26946;g++)L[g]=0;for(g=26948;g<=26998;g++)L[g]=0;for(g=27037;g<=27040;g++)L[g]=0;for(g=27205;g<=27232;g++)L[g]=0;for(g=27258;g<=27260;g++)L[g]=0;for(g=27391;g<=27398;g++)L[g]=0;for(g=27561;g<=27564;g++)L[g]=0;for(g=27571;g<=27574;g++)L[g]=0;for(g=27581;g<=27584;g++)L[g]=0;for(g=27591;g<=27594;g++)L[g]=0;for(g=28191;g<=28193;g++)L[g]=0;for(g=28348;g<=28358;g++)L[g]=0;for(g=28402;g<=28432;g++)L[g]=0;for(g=28462;g<=28492;g++)L[g]=0;for(g=29118;g<=29122;g++)L[g]=0;for(g=29168;g<=29172;g++)L[g]=0;for(g=29177;g<=29185;g++)L[g]=0;for(g=29187;g<=29195;g++)L[g]=0;for(g=29900;g<=29903;g++)L[g]=0;for(g=30161;g<=30179;g++)L[g]=0;for(g=30491;g<=30494;g++)L[g]=0;for(g=30729;g<=30732;g++)L[g]=0;for(g=31251;g<=31259;g++)L[g]=0;for(g=31265;g<=31268;g++)L[g]=0;for(g=31275;g<=31279;g++)L[g]=0;for(g=31281;g<=31297;g++)L[g]=0;for(g=31461;g<=31469;g++)L[g]=0;for(g=31491;g<=31495;g++)L[g]=0;for(g=31917;g<=31922;g++)L[g]=0;for(g=31965;g<=32e3;g++)L[g]=0;for(g=32001;g<=32003;g++)L[g]=2;for(g=32005;g<=32031;g++)L[g]=2;for(g=32033;g<=32060;g++)L[g]=2;for(g=32064;g<=32067;g++)L[g]=2;for(g=32074;g<=32077;g++)L[g]=2;for(g=32081;g<=32086;g++)L[g]=0;for(g=32107;g<=32130;g++)L[g]=0;for(g=32133;g<=32159;g++)L[g]=0;for(g=32164;g<=32167;g++)L[g]=2;for(g=32180;g<=32199;g++)L[g]=0;for(g=32201;g<=32260;g++)L[g]=0;for(g=32301;g<=32360;g++)L[g]=0;for(g=32601;g<=32662;g++)L[g]=0;for(g=32664;g<=32667;g++)L[g]=2;for(g=32701;g<=32761;g++)L[g]=0;for(g=53001;g<=53004;g++)L[g]=0;for(g=53008;g<=53019;g++)L[g]=0;for(g=53021;g<=53032;g++)L[g]=0;for(g=53034;g<=53037;g++)L[g]=0;for(g=53042;g<=53046;g++)L[g]=0;for(g=53074;g<=53080;g++)L[g]=0;for(g=54001;g<=54004;g++)L[g]=0;for(g=54008;g<=54019;g++)L[g]=0;for(g=54021;g<=54032;g++)L[g]=0;for(g=54034;g<=54037;g++)L[g]=0;for(g=54042;g<=54046;g++)L[g]=0;for(g=54048;g<=54053;g++)L[g]=0;for(g=54074;g<=54080;g++)L[g]=0;for(g=54098;g<=54101;g++)L[g]=0;for(g=102001;g<=102040;g++)L[g]=0;for(g=102042;g<=102063;g++)L[g]=0;for(g=102065;g<=102067;g++)L[g]=0;for(g=102070;g<=102117;g++)L[g]=0;for(g=102122;g<=102216;g++)L[g]=0;for(g=102221;g<=102377;g++)L[g]=0;for(g=102382;g<=102388;g++)L[g]=0;for(g=102389;g<=102398;g++)L[g]=2;for(g=102399;g<=102444;g++)L[g]=0;for(g=102445;g<=102447;g++)L[g]=2;for(g=102448;g<=102458;g++)L[g]=0;for(g=102459;g<=102468;g++)L[g]=2;for(g=102469;g<=102499;g++)L[g]=0;for(g=102500;g<=102519;g++)L[g]=1;for(g=102520;g<=102524;g++)L[g]=0;for(g=102525;g<=102529;g++)L[g]=2;for(g=102530;g<=102588;g++)L[g]=0;for(g=102590;g<=102598;g++)L[g]=0;for(g=102601;g<=102603;g++)L[g]=0;for(g=102605;g<=102628;g++)L[g]=0;for(g=102629;g<=102646;g++)L[g]=2;for(g=102648;g<=102700;g++)L[g]=2;for(g=102701;g<=102703;g++)L[g]=0;for(g=102707;g<=102730;g++)L[g]=2;for(g=102733;g<=102758;g++)L[g]=2;for(g=102767;g<=102900;g++)L[g]=0;for(g=102901;g<=102933;g++)L[g]=2;for(g=102934;g<=102950;g++)L[g]=13;for(g=102951;g<=102955;g++)L[g]=0;for(g=102961;g<=102963;g++)L[g]=0;for(g=102965;g<=102969;g++)L[g]=0;for(g=102971;g<=102973;g++)L[g]=0;for(g=102975;g<=102989;g++)L[g]=0;for(g=102990;g<=102992;g++)L[g]=1;for(g=102997;g<=103002;g++)L[g]=0;for(g=103003;g<=103008;g++)L[g]=2;for(g=103009;g<=103011;g++)L[g]=0;for(g=103012;g<=103014;g++)L[g]=2;for(g=103019;g<=103021;g++)L[g]=0;for(g=103022;g<=103024;g++)L[g]=2;for(g=103029;g<=103031;g++)L[g]=0;for(g=103032;g<=103034;g++)L[g]=2;for(g=103065;g<=103068;g++)L[g]=0;for(g=103074;g<=103076;g++)L[g]=0;for(g=103077;g<=103079;g++)L[g]=1;for(g=103080;g<=103082;g++)L[g]=0;for(g=103083;g<=103085;g++)L[g]=2;for(g=103090;g<=103093;g++)L[g]=0;for(g=103097;g<=103099;g++)L[g]=0;for(g=103100;g<=103102;g++)L[g]=2;for(g=103107;g<=103109;g++)L[g]=0;for(g=103110;g<=103112;g++)L[g]=2;for(g=103113;g<=103116;g++)L[g]=0;for(g=103117;g<=103120;g++)L[g]=2;for(g=103153;g<=103157;g++)L[g]=0;for(g=103158;g<=103162;g++)L[g]=2;for(g=103163;g<=103165;g++)L[g]=0;for(g=103166;g<=103168;g++)L[g]=1;for(g=103169;g<=103171;g++)L[g]=2;for(g=103186;g<=103188;g++)L[g]=0;for(g=103189;g<=103191;g++)L[g]=2;for(g=103192;g<=103195;g++)L[g]=0;for(g=103196;g<=103199;g++)L[g]=2;for(g=103200;g<=103224;g++)L[g]=0;for(g=103225;g<=103227;g++)L[g]=1;for(g=103232;g<=103237;g++)L[g]=0;for(g=103238;g<=103243;g++)L[g]=2;for(g=103244;g<=103246;g++)L[g]=0;for(g=103247;g<=103249;g++)L[g]=2;for(g=103254;g<=103256;g++)L[g]=0;for(g=103257;g<=103259;g++)L[g]=2;for(g=103264;g<=103266;g++)L[g]=0;for(g=103267;g<=103269;g++)L[g]=2;for(g=103300;g<=103375;g++)L[g]=0;for(g=103381;g<=103383;g++)L[g]=0;for(g=103384;g<=103386;g++)L[g]=1;for(g=103387;g<=103389;g++)L[g]=0;for(g=103390;g<=103392;g++)L[g]=2;for(g=103397;g<=103399;g++)L[g]=0;for(g=103400;g<=103471;g++)L[g]=2;for(g=103476;g<=103478;g++)L[g]=0;for(g=103479;g<=103481;g++)L[g]=2;for(g=103486;g<=103488;g++)L[g]=0;for(g=103489;g<=103491;g++)L[g]=2;for(g=103492;g<=103495;g++)L[g]=0;for(g=103496;g<=103499;g++)L[g]=2;for(g=103528;g<=103543;g++)L[g]=0;for(g=103544;g<=103548;g++)L[g]=2;for(g=103549;g<=103551;g++)L[g]=0;for(g=103552;g<=103554;g++)L[g]=1;for(g=103555;g<=103557;g++)L[g]=2;for(g=103558;g<=103560;g++)L[g]=0;for(g=103571;g<=103573;g++)L[g]=0;for(g=103574;g<=103576;g++)L[g]=2;for(g=103577;g<=103580;g++)L[g]=0;for(g=103581;g<=103583;g++)L[g]=2;for(g=103595;g<=103694;g++)L[g]=0;for(g=103696;g<=103699;g++)L[g]=0;for(g=103700;g<=103793;g++)L[g]=2;for(g=103794;g<=103890;g++)L[g]=0;for(g=103891;g<=103896;g++)L[g]=2;for(g=103900;g<=103971;g++)L[g]=2;for(g=103972;g<=103977;g++)L[g]=0;for(g=112e3;g<=112101;g++)L[g]=0;const SDe={102113:!0,102100:!0,3857:!0,3785:!0},EDe={4326:!0,3785:!0,3857:!0,102113:!0,102100:!0,104905:!0,104971:!0},Nee='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',OP=[-20037508342788905e-9,20037508342788905e-9],RP=[-20037508342787e-6,20037508342787e-6],Pme={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:OP,origin:RP,dx:1e-5},102100:{wkTemplate:Nee,valid:OP,origin:RP,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:OP,origin:RP,dx:1e-5},3857:{wkTemplate:Nee,valid:OP,origin:RP,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function Pn(t,e){return t===e||t!=null&&e!=null&&(t.wkid!=null||e.wkid!=null?t.wkid===e.wkid||_w(t)&&_w(e)||e.latestWkid!=null&&t.wkid===e.latestWkid||t.latestWkid!=null&&e.wkid===t.latestWkid:!(!t.wkt||!e.wkt)&&t.wkt.toUpperCase()===e.wkt.toUpperCase())}function Xb(t){return ua(t)&&t.wkid&&Pme[t.wkid]||null}function Ime(t){return!!ua(t)&&(t.wkid?L[t.wkid]==null:!!t.wkt&&!!/^\s*GEOGCS/i.test(t.wkt))}function mR(t){return!(vm(t)||bm(t))}function gR(t){return ua(t)&&t.wkid===4326}function $me(t){return ua(t)&&t.wkid===Eh.CGCS2000}function _w(t){return ua(t)&&t.wkid!=null&&SDe[t.wkid]===!0}function yR(t){return ua(t)&&t.wkid===32662}function PX(t){return t===Eh.GCSMARS2000||t===Eh.GCSMARS2000_SPHERE}function vm(t){return ua(t)&&t.wkid!=null&&PX(t.wkid)}function IX(t){return t===Eh.GCSMOON2000}function bm(t){return ua(t)&&t.wkid!=null&&IX(t.wkid)}function CDe(t){return ua(t)&&t.wkid!=null&&EDe[t.wkid]===!0}function ua(t){return t!=null&&(t.wkid!=null&&t.wkid>=2e3||t.wkt!=null)}const ADe={wkid:4326,wkt:N5(Pme[4326].wkTemplate,{Central_Meridian:"0.0"})},ODe={wkid:102100,latestWkid:3857},RDe={wkid:32662};function $X(t){return{wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${t.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`}}const Lme=$X(or),LX=$X(Hf),DX=$X(ny),Dme={wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${or.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`};function zr(t){return t!=null&&(vm(t)||Pn(t,LX))?Hf:t!=null&&(bm(t)||Pn(t,DX))?ny:or}function hIt(t){return PX(t)?Hf:IX(t)?ny:or}const NX=39.37,MDe=or.radius*Math.PI/200,Nme=/UNIT\[([^\]]+)\]\]$/i,Zb=L,Fme=/UNIT\[([^\]]+)\]/i,PDe=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),IDe=il()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),Dp=t=>t*t,jy=t=>t*t*t,_R={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:Dp(.001)},"square-centimeters":{inBaseUnits:Dp(.01)},"square-decimeters":{inBaseUnits:Dp(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:Dp(1e3)},"square-inches":{inBaseUnits:Dp(.0254)},"square-feet":{inBaseUnits:Dp(.3048)},"square-yards":{inBaseUnits:Dp(.9144)},"square-miles":{inBaseUnits:Dp(1609.344)},"square-us-feet":{inBaseUnits:Dp(1200/3937)},acres:{inBaseUnits:.0015625*Dp(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*jy(.001)},"cubic-centimeters":{inBaseUnits:1e3*jy(.01)},"cubic-decimeters":{inBaseUnits:1e3*jy(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*jy(1e3)},"cubic-inches":{inBaseUnits:1e3*jy(.0254)},"cubic-feet":{inBaseUnits:1e3*jy(.3048)},"cubic-yards":{inBaseUnits:1e3*jy(.9144)},"cubic-miles":{inBaseUnits:1e3*jy(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},$De=(()=>{const t={};for(const e in _R)for(const r in _R[e].units)t[r]=e;return t})();function LDe(t,e,r){return t*_R[r].units[e].inBaseUnits}function DDe(t,e,r){return t/_R[r].units[e].inBaseUnits}const NDe=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"];function WV(t){const e=$De[t];if(!e)throw new Error("unknown type");return e}function Fee(t,e=null){return e=e||WV(t),_R[e].baseUnit===t}function Do(t,e,r){if(e===r)return t;const i=WV(e);if(i!==WV(r))throw new Error("incompatible units");const s=Fee(e,i)?t:LDe(t,e,i);return Fee(r,i)?s:DDe(s,r,i)}function dIt(t,e,r){switch(r){case"metric":return FDe(t,e);case"imperial":return kDe(t,e);default:return r}}function pIt(t,e,r){switch(r){case"metric":return UDe(t,e);case"imperial":return zDe(t,e);default:return r}}function FDe(t,e){const r=Do(t,e,"meters");return Math.abs(r)<3e3?"meters":"kilometers"}function UDe(t,e){const r=Do(t,e,"meters");return Math.abs(r)<1e5?"meters":"kilometers"}function kDe(t,e){const r=Do(t,e,"feet");return Math.abs(r)<1e3?"feet":"miles"}function zDe(t,e){const r=Do(t,e,"feet");return Math.abs(r)<1e5?"feet":"miles"}function fIt(t,e){const r=Do(t,e,"square-meters");return Math.abs(r)<3e6?"square-meters":"square-kilometers"}function mIt(t,e){const r=Do(t,e,"square-feet");return Math.abs(r)<1e6?"square-feet":"square-miles"}function VDe(t,e,r){return Do(t,e,"meters")/(r*Math.PI/180)}function Ume(t){return IDe.fromJSON(t.toLowerCase())||null}function vR(t){if(t!=null&&!mR(t))return 1;const e=_a(t);return e>1e5?1:e}function BDe(t){return _a(t)>=zr(t).metersPerDegree?"meters":H5(t)}function _a(t,e=or.metersPerDegree){return GDe(t,!0)??e}function GDe(t,e=!1){const r=t!=null?t.wkid:null,i=t!=null?t.wkt:null;let s=null;if(r){if(PX(r))return Hf.metersPerDegree;if(IX(r))return ny.metersPerDegree;s=Zb.values[Zb[r]],!s&&e&&PDe.has(r)&&(s=MDe)}else i&&(Vme(i)?s=kee(Nme.exec(i),s):zme(i)&&(s=kee(Fme.exec(i),s)));return s}function Uee(t){return t.isGeographic?1:_a(t)}function kee(t,e){return t&&t[1]?kme(t[1]):e}function kme(t){return parseFloat(t.split(",")[1])}function H5(t){const e=t!=null?t.wkid:null,r=t!=null?t.wkt:null;let i=null;if(e)i=Zb.units[Zb[e]];else if(r){const s=Vme(r)?Nme:zme(r)?Fme:null;if(s){const n=s.exec(r);n&&n[1]&&(i=HDe(n[1]))}}return i!=null?Ume(i):null}function gIt(t){const e=H5(t);return e!=null&&NDe.includes(e)?e:null}function zme(t){return/^GEOCCS/i.test(t)}function Vme(t){return/^PROJCS/i.test(t)}const jDe=1e-7;function HDe(t){const e=/[\\"\\']{1}([^\\"\\']+)/.exec(t);let r=e&&e[1];if(!r||!Zb.units.includes(r)){const i=kme(t);r=null;const s=Zb.values;for(let n=0;n<s.length;++n)if(Math.abs(i-s[n])<jDe){r=Zb.units[n];break}}return r}function yIt(t){const e=H5(t);if(e==null)return null;switch(e){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}const qDe={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},WDe={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},XDe={esriDUDecimalDegrees:"degrees",esriDURadians:"radians"},ZDe=il()(qDe),YDe=il()(WDe),_It=il()(XDe);var tf;let bi=tf=class extends le{static fromJSON(t){if(!t)return null;if(t.wkid){if(t.wkid===102100)return tf.WebMercator;if(t.wkid===4326)return tf.WGS84}const e=new tf;return e.read(t),e}constructor(t){super(t),this.latestWkid=null,this.wkid=null,this.wkt=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}normalizeCtorArgs(t){return t&&typeof t=="object"?t:{[typeof t=="string"?"wkt":"wkid"]:t}}get isWGS84(){return gR(this)}get isWebMercator(){return _w(this)}get isGeographic(){return Ime(this)}get isWrappable(){return CDe(this)}get metersPerUnit(){return _a(this)}get unit(){return H5(this)||(this.isGeographic?"degrees":null)}writeWkt(t,e){this.wkid||(e.wkt=t)}clone(){if(this===tf.WGS84)return tf.WGS84;if(this===tf.WebMercator)return tf.WebMercator;const t=new tf;return this.wkid!=null?(t.wkid=this.wkid,this.latestWkid!=null&&(t.latestWkid=this.latestWkid),this.vcsWkid!=null&&(t.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(t.latestVcsWkid=this.latestVcsWkid)):this.wkt!=null&&(t.wkt=this.wkt),this.imageCoordinateSystem&&(t.imageCoordinateSystem=K(this.imageCoordinateSystem)),t}equals(t){if(t==null)return!1;if(this.imageCoordinateSystem||t.imageCoordinateSystem){if(this.imageCoordinateSystem==null||t.imageCoordinateSystem==null)return!1;const{id:e,referenceServiceName:r}=t.imageCoordinateSystem,{geodataXform:i}=t.imageCoordinateSystem,s=this.imageCoordinateSystem;return e==null||i?JSON.stringify(s)===JSON.stringify(t.imageCoordinateSystem):r?s.id===e&&s.referenceServiceName===r:s.id===e}return Pn(this,t)}toJSON(t){return this.write(void 0,t)}};bi.GCS_NAD_1927=null,bi.WGS84=null,bi.WebMercator=null,bi.PlateCarree=null,u([d({readOnly:!0})],bi.prototype,"isWGS84",null),u([d({readOnly:!0})],bi.prototype,"isWebMercator",null),u([d({readOnly:!0})],bi.prototype,"isGeographic",null),u([d({readOnly:!0})],bi.prototype,"isWrappable",null),u([d({type:Qi,json:{write:!0}})],bi.prototype,"latestWkid",void 0),u([d({readOnly:!0})],bi.prototype,"metersPerUnit",null),u([d({readOnly:!0})],bi.prototype,"unit",null),u([d({type:Qi,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt==null}}}}}}})],bi.prototype,"wkid",void 0),u([d({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid==null}}}}}}})],bi.prototype,"wkt",void 0),u([ke("wkt"),ke("web-scene","wkt")],bi.prototype,"writeWkt",null),u([d({type:Qi,json:{write:!0}})],bi.prototype,"vcsWkid",void 0),u([d({type:Qi,json:{write:!0}})],bi.prototype,"latestVcsWkid",void 0),u([d()],bi.prototype,"imageCoordinateSystem",void 0),bi=tf=u([P("esri.geometry.SpatialReference")],bi),bi.prototype.toJSON.isDefaultToJSON=!0,bi.GCS_NAD_1927=new bi({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),bi.WGS84=new bi(ADe),bi.WebMercator=new bi(ODe),bi.PlateCarree=new bi(RDe),Object.freeze&&(Object.freeze(bi.GCS_NAD_1927),Object.freeze(bi.WGS84),Object.freeze(bi.WebMercator));const je=bi,Bme="20230626",Gme="b81703b48e0b92e492f4cc6b739af02a9af50038",JDe="4.27";let FX=JDe;FX="4.27.6";const QDe={async request(t,e){const{default:r}=await ce(()=>Promise.resolve().then(()=>Zme),void 0,import.meta.url),i=t.options,s=i.responseType;i.signal=e?.signal,i.responseType=s==="native"||s==="native-request-init"?"native-request-init":s&&["blob","json","text"].includes(s)&&Sme(t.url)?.after?s:"array-buffer";const n=await r(t.url,i),o={data:n.data,httpStatus:n.httpStatus,ssl:n.ssl};switch(n.requestOptions?.responseType){case"native-request-init":return delete o.data.signal,o;case"blob":o.data=await o.data.arrayBuffer();break;case"json":o.data=new TextEncoder().encode(JSON.stringify(o.data)).buffer;break;case"text":o.data=new TextEncoder().encode(o.data).buffer}return{result:o,transferList:[o.data]}}};let Pi;function vIt(t){Pi=t}function bIt(t){const e=Pi?.findCredential(t);return e?.token?Rme(t,"token",e.token):t}oe("host-webworker");const KDe=["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"];function jme(t){const e=dp(t,!0);return!!e&&e.endsWith(".arcgis.com")&&!KDe.includes(e)&&!t.endsWith("/sharing/rest/generateToken")}function Hme(t,e,r=!1,i){return new Promise((s,n)=>{if(An(i))return void n(zee());let o=()=>{c(),n(new Error(`Unable to load ${e}`))},a=()=>{const h=t;c(),s(h)},l=()=>{if(!t)return;const h=t;c(),h.src="",n(zee())};const c=()=>{oe("esri-image-decode")||(t.removeEventListener("error",o),t.removeEventListener("load",a)),o=null,a=null,t=null,i?.removeEventListener("abort",l),l=null,r&&URL.revokeObjectURL(e)};i?.addEventListener("abort",l),oe("esri-image-decode")?t.decode().then(a,o):(t.addEventListener("error",o),t.addEventListener("load",a))})}function zee(){try{return new DOMException("Aborted","AbortError")}catch{const t=new Error;return t.name="AbortError",t}}const qme="Timeout exceeded";function eNe(){return new Error(qme)}function wIt(t){return typeof t=="object"&&!!t&&"message"in t&&t.message===qme}function tNe(t){Br.request.crossOriginNoCorsDomains||(Br.request.crossOriginNoCorsDomains={});const e=Br.request.crossOriginNoCorsDomains;for(let r of t)r=r.toLowerCase(),/^https?:\/\//.test(r)?e[dp(r)??""]=0:(e[dp("http://"+r)??""]=0,e[dp("https://"+r)??""]=0)}function rNe(t){const e=Br.request.crossOriginNoCorsDomains;if(e){let r=dp(t);if(r)return r=r.toLowerCase(),!z2(r,bX())&&e[r]<Date.now()-36e5}return!1}async function iNe(t){const e=Br.request.crossOriginNoCorsDomains,r=dp(t);e&&r&&(e[r.toLowerCase()]=Date.now());const i=To(t);t=i.path,i.query?.f==="json"&&(t+="?f=json");try{await fetch(t,{mode:"no-cors",credentials:"include"})}catch{}}async function hr(t,e){t instanceof URL&&(t=t.toString()),e?.query instanceof URLSearchParams&&(e.query=wX(e.query.toString().replaceAll("+"," ")));const r=_m(t),i=W_(t);i||r||(t=hp(t));const s={url:t,requestOptions:{...e}};let n=Sme(t);if(n){const c=await hNe(n,s);if(c!=null)return{data:c,getHeader:UX,httpStatus:200,requestOptions:s.requestOptions,url:s.url};n.after||n.error||(n=null)}if(t=s.url,(e=s.requestOptions).responseType==="image"&&(oe("host-webworker")||oe("host-node")))throw qf("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),s);if(e.method==="head"){if(e.body)throw qf("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),s);if(r||i)throw qf("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),s)}if(await lNe(),l4)return l4.execute(t,e);const o=new AbortController;da(e,()=>o.abort());const a={controller:o,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:n,params:s,redoRequest:!1,useIdentity:Gd.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},l=await pNe(a);return n?.after?.(l),l}let l4;const Gd=Br.request,Wme="FormData"in globalThis,sNe=[499,498,403,401],nNe=["COM_0056","COM_0057","SB_0008"],oNe=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],UX=()=>null,c4=Symbol();function aNe(t){const e=dp(t);e&&!hr._corsServers.includes(e)&&hr._corsServers.push(e)}function Vee(t){const e=dp(t);return!e||e.endsWith(".arcgis.com")||hr._corsServers.includes(e)||TX(e)}function qf(t,e,r,i){let s="Error";const n={url:r.url,requestOptions:r.requestOptions,getHeader:UX,ssl:!1};if(e instanceof V)return e.details?(e.details=K(e.details),e.details.url=r.url,e.details.requestOptions=r.requestOptions):e.details=n,e;if(e){const o=i&&(c=>i.headers.get(c)),a=i?.status,l=e.message;l&&(s=l),o&&(n.getHeader=o),n.httpStatus=(e.httpCode!=null?e.httpCode:e.code)||a||0,n.subCode=e.subcode,n.messageCode=e.messageCode,typeof e.details=="string"?n.messages=[e.details]:n.messages=e.details,n.raw=c4 in e?e[c4]:e}return us(e)?kr():new V(t,s,n)}async function lNe(){oe("host-webworker")?l4||(l4=await ce(()=>import("./request-a453e0ed.js"),[],import.meta.url)):hr._abortableFetch||(hr._abortableFetch=globalThis.fetch.bind(globalThis))}async function XV(){Pi||await ce(()=>import("./IdentityManager-38cc20d1.js"),["./IdentityManager-38cc20d1.js","./widget-22301485.js"],import.meta.url)}async function cNe(t){const e=t.params.url,r=t.params.requestOptions,i=t.controller.signal,s=r.body;let n=null,o=null;if(Wme&&"HTMLFormElement"in globalThis&&(s instanceof FormData?n=s:s instanceof HTMLFormElement&&(n=new FormData(s))),typeof s=="string"&&(o=s),t.fetchOptions={cache:r.cacheBust&&!("polyfill"in hr._abortableFetch)?"no-cache":"default",credentials:"same-origin",headers:r.headers||{},method:r.method==="head"?"HEAD":"GET",mode:"cors",priority:Gd.priority,redirect:"follow",signal:i},(n||o)&&(t.fetchOptions.body=n||o),r.authMode==="anonymous"&&(t.useIdentity=!1),t.hasToken=!!(/token=/i.test(e)||r.query?.token||n?.get("token")),!t.hasToken&&Br.apiKey&&jme(e)&&(r.query||(r.query={}),r.query.token=Br.apiKey,t.hasToken=!0),t.useIdentity&&!t.hasToken&&!t.credentialToken&&!Xme(e)&&!An(i)){let a;r.authMode==="immediate"?(await XV(),a=await Pi.getCredential(e,{signal:i}),t.credential=a):r.authMode==="no-prompt"?(await XV(),a=await Pi.getCredential(e,{prompt:!1,signal:i}).catch(()=>{}),t.credential=a):Pi&&(a=Pi.findCredential(e)),a&&(t.credentialToken=a.token,t.useSSL=!!a.ssl)}}function Xme(t){return oNe.some(e=>e.test(t))}async function uNe(t){let e=t.params.url;const r=t.params.requestOptions,i=t.fetchOptions??{},s=W_(e)||_m(e),n=r.responseType||"json",o=s?0:r.timeout!=null?r.timeout:Gd.timeout;let a=!1;if(!s){t.useSSL&&(e=AX(e)),r.cacheBust&&i.cache==="default"&&(e=Rme(e,"request.preventCache",Date.now()));let f={...r.query};t.credentialToken&&(f.token=t.credentialToken);let m=fR(f);oe("esri-url-encodes-apostrophe")&&(m=m.replaceAll("'","%27"));const y=e.length+1+m.length;let _;a=r.method==="delete"||r.method==="post"||r.method==="put"||!!r.body||y>Gd.maxUrlLength;const v=r.useProxy||!!j5(e);if(v){const b=lDe(e);_=b.path,!a&&_.length+1+y>Gd.maxUrlLength&&(a=!0),b.query&&(f={...b.query,...f})}if(i.method==="HEAD"&&(a||v)){if(a)throw y>Gd.maxUrlLength?qf("request:invalid-parameters",new Error("URL exceeds maximum length"),t.params):qf("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),t.params);if(v)throw qf("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),t.params)}a?(i.method=r.method==="delete"?"DELETE":r.method==="put"?"PUT":"POST",r.body?e=b8(e,f):(i.body=fR(f),i.headers||(i.headers={}),i.headers["Content-Type"]="application/x-www-form-urlencoded")):e=b8(e,f),v&&(t.useProxy=!0,e=`${_}?${e}`),f.token&&Wme&&i.body instanceof FormData&&!YLe(e)&&i.body.set("token",f.token),r.hasOwnProperty("withCredentials")?t.withCredentials=r.withCredentials:z2(e,bX())||(TX(e)||Pi&&Pi.findServerInfo(e)?.webTierAuth)&&(t.withCredentials=!0),t.withCredentials&&(i.credentials="include",rNe(e)&&await iNe(a?b8(e,f):e))}let l,c,h=0,p=!1;o>0&&(h=setTimeout(()=>{p=!0,t.controller.abort()},o));try{if(r.responseType==="native-request-init")c=i,c.url=e;else if(r.responseType!=="image"||i.cache!=="default"||i.method!=="GET"||a||dNe(r.headers)||!s&&!t.useProxy&&Gd.proxyUrl&&!Vee(e)){if(l=await hr._abortableFetch(e,i),t.useProxy||aNe(e),r.responseType==="native")c=l;else if(i.method!=="HEAD")if(l.ok){switch(n){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(h&&(clearTimeout(h),h=0),n==="json"||n==="xml"||n==="document")if(c)switch(n){case"json":c=JSON.parse(c);break;case"xml":c=Bee(c,"application/xml");break;case"document":c=Bee(c,"text/html")}else c=null;if(c){if(n==="array-buffer"||n==="blob"){const f=l.headers.get("Content-Type");if(f&&/application\/json|text\/plain/i.test(f)&&c[n==="blob"?"size":"byteLength"]<=750)try{const m=await new Response(c).json();m.error&&(c=m)}catch{}}n==="image"&&c instanceof Blob&&(c=await Gee(URL.createObjectURL(c),t,!0))}}else{c=await l.text();try{c=JSON.parse(c)}catch{}}}else c=await Gee(e,t)}catch(f){if(f.name==="AbortError")throw p?eNe():kr("Request canceled");if(!(!l&&f instanceof TypeError&&Gd.proxyUrl)||r.body||r.method==="delete"||r.method==="head"||r.method==="post"||r.method==="put"||t.useProxy||Vee(e))throw f;t.redoRequest=!0,cDe({proxyUrl:Gd.proxyUrl,urlPrefix:dp(e)??""})}finally{h&&clearTimeout(h)}return[l,c]}async function hNe(t,e){if(t.responseData!=null)return t.responseData;if(t.headers&&(e.requestOptions.headers={...e.requestOptions.headers,...t.headers}),t.query&&(e.requestOptions.query={...e.requestOptions.query,...t.query}),t.before){let r,i;try{i=await t.before(e)}catch(s){r=qf("request:interceptor",s,e)}if((i instanceof Error||i instanceof V)&&(r=qf("request:interceptor",i,e)),r)throw t.error&&t.error(r),r;return i}}function dNe(t){if(t){for(const e of Object.getOwnPropertyNames(t))if(t[e])return!0}return!1}function Bee(t,e){let r;try{r=new DOMParser().parseFromString(t,e)}catch{}if(!r||r.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return r}async function pNe(t){let e,r;await cNe(t);try{do[e,r]=await uNe(t);while(!await fNe(t,e,r))}catch(n){const o=qf("request:server",n,t.params,e);throw o.details.ssl=t.useSSL,t.interceptor?.error&&t.interceptor.error(o),o}const i=t.params.url;if(r&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(i)){if(!t.hasToken&&!t.credentialToken&&r.user?.username&&!TX(i)){const n=dp(i,!0);n&&Gd.trustedServers.push(n)}Array.isArray(r.authorizedCrossOriginNoCorsDomains)&&tNe(r.authorizedCrossOriginNoCorsDomains)}const s=t.credential;if(s&&Pi){let o=Pi.findServerInfo(s.server)?.owningSystemUrl;if(o){o=o.replace(/\/?$/,"/sharing");const a=Pi.findCredential(o,s.userId);a&&Pi._getIdenticalSvcIdx(o,a)===-1&&a.resources.unshift(o)}}return{data:r,getHeader:e?n=>e?.headers.get(n):UX,httpStatus:e?.status??200,requestOptions:t.params.requestOptions,ssl:t.useSSL,url:t.params.url}}async function fNe(t,e,r){if(t.redoRequest)return t.redoRequest=!1,!1;const i=t.params.requestOptions;if(!e||i.responseType==="native"||i.responseType==="native-request-init")return!0;let s,n;if(r&&(r.error?s=r.error:r.status==="error"&&Array.isArray(r.messages)&&(s={...r},s[c4]=r,s.details=r.messages)),!s&&!e.ok)throw s=new Error(`Unable to load ${e.url} status: ${e.status}`),s[c4]=r,s;let o,a=null;s&&(n=Number(s.code),a=s.hasOwnProperty("subcode")?Number(s.subcode):null,o=s.messageCode,o=o?.toUpperCase());const l=i.authMode;if(n===403&&(a===4||s.message?.toLowerCase().includes("ssl")&&!s.message.toLowerCase().includes("permission"))){if(!t.useSSL)return t.useSSL=!0,!1}else if(!t.hasToken&&t.useIdentity&&(l!=="no-prompt"||n===498)&&n!==void 0&&sNe.includes(n)&&!Xme(t.params.url)&&(n!==403||o&&!nNe.includes(o)&&(a==null||a===2&&t.credentialToken))){await XV();try{const c=await Pi.getCredential(t.params.url,{error:qf("request:server",s,t.params),prompt:l!=="no-prompt",signal:t.controller.signal,token:t.credentialToken});return t.credential=c,t.credentialToken=c.token,t.useSSL=t.useSSL||c.ssl,!1}catch(c){if(l==="no-prompt")return t.credential=void 0,t.credentialToken=void 0,!1;s=c}}if(s)throw s;return!0}function Gee(t,e,r=!1){const i=e.controller.signal,s=new Image;return e.withCredentials?s.crossOrigin="use-credentials":s.crossOrigin="anonymous",s.alt="",s.fetchPriority=Gd.priority,s.src=t,Hme(s,t,r,i)}hr._abortableFetch=null,hr._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"];const Zme=Object.freeze(Object.defineProperty({__proto__:null,default:hr},Symbol.toStringTag,{value:"Module"}));function Ae(t,e,r){let i,s;return e===void 0||Array.isArray(e)?(s=t,r=e,i=[void 0]):(s=e,i=Array.isArray(t)?t:[t]),(n,o)=>{const a=n.constructor.prototype;i.forEach(l=>{const c=dX(n,l,s);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=a[o],r&&(c.read.source=(c.read.source||[]).concat(r))})}}let rf=class extends le{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=je.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,r){if(e instanceof je)return e;if(e!=null){const i=new je;return i.read(e,r),i}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,r){this.cache[e]=r}};u([d()],rf.prototype,"type",void 0),u([d({readOnly:!0})],rf.prototype,"cache",null),u([d({readOnly:!0})],rf.prototype,"extent",null),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],rf.prototype,"hasM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],rf.prototype,"hasZ",void 0),u([d({type:je,json:{write:!0},value:je.WGS84})],rf.prototype,"spatialReference",void 0),u([Ae("spatialReference")],rf.prototype,"readSpatialReference",null),rf=u([P("esri.geometry.Geometry")],rf);const gv=rf,mNe=Object.prototype.toString;function gNe(t){const e="__accessorMetadata__"in t?vs(t):t;return function(...r){if(r.push(e),typeof r[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return yNe.apply(this,r)}}function yNe(t,e,r,i){bM(t,e).cast=i}function _Ne(t){return(e,r)=>{bM(e,t).cast=e[r]}}function wr(...t){if(t.length!==3||typeof t[1]!="string")return t.length===1&&mNe.call(t[0])==="[object Function]"?gNe(t[0]):t.length===1&&typeof t[0]=="string"?_Ne(t[0]):void 0}function vNe(t,e){const r=t.x-e.x,i=t.y-e.y,s=t.hasZ&&e.hasZ?t.z-e.z:0;return Math.sqrt(r*r+i*i+s*s)}const bNe=57.29577951308232,wNe=.017453292519943;function jee(t){return t*bNe}function Hee(t){return t*wNe}function qee(t){return t/or.radius}function u4(t){return Math.PI/2-2*Math.atan(Math.exp(-t/or.radius))}function ZV(t){return t.wkid!=null||t.wkt!=null}const w8=[0,0];function h4(t,e,r,i,s){const n=t,o=s;if(o.spatialReference=r,"x"in n&&"x"in o)[o.x,o.y]=e(n.x,n.y,w8,i);else if("xmin"in n&&"xmin"in o)[o.xmin,o.ymin]=e(n.xmin,n.ymin,w8,i),[o.xmax,o.ymax]=e(n.xmax,n.ymax,w8,i);else if("paths"in n&&"paths"in o||"rings"in n&&"rings"in o){const a="paths"in n?n.paths:n.rings,l=[];let c;for(let h=0;h<a.length;h++){const p=a[h];c=[],l.push(c);for(let f=0;f<p.length;f++)c.push(e(p[f][0],p[f][1],[0,0],i)),p[f].length>2&&c[f].push(p[f][2]),p[f].length>3&&c[f].push(p[f][3])}"paths"in o?o.paths=l:o.rings=l}else if("points"in n&&"points"in o){const a=n.points,l=[];for(let c=0;c<a.length;c++)l[c]=e(a[c][0],a[c][1],[0,0],i),a[c].length>2&&l[c].push(a[c][2]),a[c].length>3&&l[c].push(a[c][3]);o.points=l}return s}function z_(t,e){const r=t&&(ZV(t)?t:t.spatialReference),i=e&&(ZV(e)?e:e.spatialReference);return!(t&&"type"in t&&t.type==="mesh"||e&&"type"in e&&e.type==="mesh"||!r||!i)&&(!!Pn(i,r)||_w(i)&&gR(r)||_w(r)&&gR(i))}function rx(t,e){if(t==null)return null;const r=t.spatialReference,i=e&&(ZV(e)?e:e.spatialReference);return z_(r,i)?Pn(r,i)?K(t):_w(i)?h4(t,NS,je.WebMercator,!1,K(t)):gR(i)?h4(t,yO,je.WGS84,!1,K(t)):null:null}function NS(t,e,r=[0,0]){e>89.99999?e=89.99999:e<-89.99999&&(e=-89.99999);const i=Hee(e);return r[0]=Hee(t)*or.radius,r[1]=or.halfSemiMajorAxis*Math.log((1+Math.sin(i))/(1-Math.sin(i))),r}function yO(t,e,r=[0,0],i=!1){const s=jee(t/or.radius);return r[0]=i?s:s-360*Math.floor((s+180)/360),r[1]=jee(Math.PI/2-2*Math.atan(Math.exp(-e/or.radius))),r}function n2(t,e=!1,r=K(t)){return h4(t,NS,je.WebMercator,e,r)}function $A(t,e=!1,r=K(t)){return h4(t,yO,je.WGS84,e,r)}var HL;const TC=[0,0];function Wee(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let ml=HL=class extends gv{static copy(t,e){e._set("x",t._get("x")),e._set("y",t._get("y")),e._set("z",t._get("z")),e._set("m",t._get("m"));const r=t._get("spatialReference");e._set("spatialReference",Object.isFrozen(r)?r:r.clone())}constructor(...t){super(...t),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}normalizeCtorArgs(t,e,r,i,s){let n;if(Array.isArray(t))n=t,s=e,t=n[0],e=n[1],r=n[2],i=n[3];else if(t&&typeof t=="object"){if(n=t,t=n.x!=null?n.x:n.longitude,e=n.y!=null?n.y:n.latitude,r=n.z,i=n.m,(s=n.spatialReference)&&s.declaredClass!=="esri.geometry.SpatialReference"&&(s=new je(s)),n.longitude!=null||n.latitude!=null){if(n.longitude==null)Q.getLogger(this).warn(".longitude=","Latitude was defined without longitude");else if(n.latitude==null)Q.getLogger(this).warn(".latitude=","Longitude was defined without latitude");else if(!n.declaredClass&&s&&s.isWebMercator){const a=NS(n.longitude,n.latitude,TC);t=a[0],e=a[1]}}}else Wee(r)?(s=r,r=null):Wee(i)&&(s=i,i=null);const o={x:t,y:e};return o.x==null&&o.y!=null?Q.getLogger(this).warn(".y=","Y coordinate was defined without an X coordinate"):o.y==null&&o.x!=null&&Q.getLogger(this).warn(".x=","X coordinate was defined without a Y coordinate"),s!=null&&(o.spatialReference=s),r!=null&&(o.z=r),i!=null&&(o.m=i),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(t){t!==(this._get("m")!==void 0)&&(this._set("m",t?0:void 0),this._set("hasM",t))}get hasZ(){return this.z!==void 0}set hasZ(t){t!==(this._get("z")!==void 0)&&(this._set("z",t?0:void 0),this._set("hasZ",t))}get latitude(){const{spatialReference:t,x:e,y:r}=this;if(t){if(t.isWebMercator)return yO(e,r,TC)[1];if(t.isGeographic)return r}return null}set latitude(t){const{spatialReference:e,x:r}=this;t!=null&&e&&(e.isWebMercator?this._set("y",NS(r,t,TC)[1]):e.isGeographic&&this._set("y",t),this._set("latitude",t))}get longitude(){const{x:t,y:e,spatialReference:r}=this;if(r){if(r.isWebMercator)return yO(t,e,TC)[0];if(r.isGeographic)return t}return null}set longitude(t){const{y:e,spatialReference:r}=this;t!=null&&r&&(r.isWebMercator?this._set("x",NS(t,e,TC)[0]):r.isGeographic&&this._set("x",t),this._set("longitude",t))}writeX(t,e,r){e[r]=isNaN(t)?"NaN":t}readX(t){return typeof t=="string"?NaN:t}clone(){const t=new HL;return t.x=this.x,t.y=this.y,t.z=this.z,t.m=this.m,t.spatialReference=this.spatialReference,t}copy(t){return HL.copy(t,this),this}equals(t){if(t==null)return!1;const{x:e,y:r,z:i,m:s,spatialReference:n}=this,{z:o,m:a}=t;let{x:l,y:c,spatialReference:h}=t;if(!n.equals(h))if(n.isWebMercator&&h.isWGS84)[l,c]=NS(l,c),h=n;else{if(!n.isWGS84||!h.isWebMercator)return!1;[l,c]=yO(l,c),h=n}return e===l&&r===c&&i===o&&s===a&&n.wkid===h.wkid}offset(t,e,r){return this.x+=t,this.y+=e,r!=null&&(this.z=(this.z??0)+r),this}normalize(){if(!this.spatialReference)return this;const t=Xb(this.spatialReference);if(!t)return this;let e=this.x;const[r,i]=t.valid,s=2*i;let n;return e>i?(n=Math.ceil(Math.abs(e-i)/s),e-=n*s):e<r&&(n=Math.ceil(Math.abs(e-r)/s),e+=n*s),this._set("x",e),this}distance(t){return vNe(this,t)}toArray(){const t=this.hasZ,e=this.hasM;return t&&e?[this.x,this.y,this.z,this.m]:t?[this.x,this.y,this.z]:e?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(t){return this.write({},t)}};u([d({readOnly:!0})],ml.prototype,"cache",null),u([d({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],ml.prototype,"hasM",null),u([d({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],ml.prototype,"hasZ",null),u([d({type:Number})],ml.prototype,"latitude",null),u([d({type:Number})],ml.prototype,"longitude",null),u([d({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),wr(t=>isNaN(t)?t:yh(t))],ml.prototype,"x",void 0),u([ke("x")],ml.prototype,"writeX",null),u([Ae("x")],ml.prototype,"readX",null),u([d({type:Number,json:{write:!0}})],ml.prototype,"y",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],ml.prototype,"z",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],ml.prototype,"m",void 0),ml=HL=u([P("esri.geometry.Point")],ml),ml.prototype.toJSON.isDefaultToJSON=!0;const Ke=ml,x8=[0,0];function kX(t,e){return e!=null&&Ga(t,e.x,e.y,e.z)}function TIt(t,e){if(!e.points||e.points.length)return!1;for(const r of e.points)if(!V2(t,r))return!1;return!0}function xNe(t,e){const{xmin:r,ymin:i,zmin:s,xmax:n,ymax:o,zmax:a}=e;return t.hasZ&&e.hasZ?Ga(t,r,i,s)&&Ga(t,r,o,s)&&Ga(t,n,o,s)&&Ga(t,n,i,s)&&Ga(t,r,i,a)&&Ga(t,r,o,a)&&Ga(t,n,o,a)&&Ga(t,n,i,a):Ga(t,r,i)&&Ga(t,r,o)&&Ga(t,n,o)&&Ga(t,n,i)}function V2(t,e){return Ga(t,e[0],e[1])}function TNe(t,e){return Ga(t,e[0],e[1],e[2])}function Ga(t,e,r,i){return e>=t.xmin&&e<=t.xmax&&r>=t.ymin&&r<=t.ymax&&(i==null||!t.hasZ||i>=t.zmin&&i<=t.zmax)}function SNe(t,e){return x8[1]=e.y,x8[0]=e.x,ENe(t,x8)}function ENe(t,e){return Yme(t.rings,e)}function Yme(t,e){if(!t)return!1;if(CNe(t))return Xee(!1,t,e);let r=!1;for(let i=0,s=t.length;i<s;i++)r=Xee(r,t[i],e);return r}function CNe(t){return!Array.isArray(t[0][0])}function Xee(t,e,r){const[i,s]=r;let n=t,o=0;for(let a=0,l=e.length;a<l;a++){o++,o===l&&(o=0);const[c,h]=e[a],[p,f]=e[o];(h<s&&f>=s||f<s&&h>=s)&&c+(s-h)/(f-h)*(p-c)<i&&(n=!n)}return n}function ANe(t,e){return kX(t,e)}function ONe(t,e){const r=t.hasZ&&e.hasZ;let i,s,n;if(t.xmin<=e.xmin){if(i=e.xmin,t.xmax<i)return!1}else if(i=t.xmin,e.xmax<i)return!1;if(t.ymin<=e.ymin){if(s=e.ymin,t.ymax<s)return!1}else if(s=t.ymin,e.ymax<s)return!1;if(r&&e.hasZ){if(t.zmin<=e.zmin){if(n=e.zmin,t.zmax<n)return!1}else if(n=t.zmin,e.zmax<n)return!1}return!0}function RNe(t,e){const{points:r,hasZ:i}=e,s=i?TNe:V2;for(const n of r)if(s(t,n))return!0;return!1}const vw=[0,0],bw=[0,0],ww=[0,0],xw=[0,0],MNe=[vw,bw,ww,xw],Jme=[[ww,vw],[vw,bw],[bw,xw],[xw,ww]];function PNe(t,e){return INe(t,e.rings)}function INe(t,e){vw[0]=t.xmin,vw[1]=t.ymax,bw[0]=t.xmax,bw[1]=t.ymax,ww[0]=t.xmin,ww[1]=t.ymin,xw[0]=t.xmax,xw[1]=t.ymin;for(const r of MNe)if(Yme(e,r))return!0;for(const r of e){if(!r.length)continue;let i=r[0];if(V2(t,i))return!0;for(let s=1;s<r.length;s++){const n=r[s];if(V2(t,n)||Qme(i,n,Jme))return!0;i=n}}return!1}function $Ne(t,e){vw[0]=t.xmin,vw[1]=t.ymax,bw[0]=t.xmax,bw[1]=t.ymax,ww[0]=t.xmin,ww[1]=t.ymin,xw[0]=t.xmax,xw[1]=t.ymin;const r=e.paths;for(const i of r){if(!r.length)continue;let s=i[0];if(V2(t,s))return!0;for(let n=1;n<i.length;n++){const o=i[n];if(V2(t,o)||Qme(s,o,Jme))return!0;s=o}}return!1}const Oo=[0,0];function LNe(t){for(let e=0;e<t.length;e++){const r=t[e];for(let s=0;s<r.length-1;s++){const n=r[s],o=r[s+1];for(let a=e+1;a<t.length;a++)for(let l=0;l<t[a].length-1;l++){const c=t[a][l],h=t[a][l+1];if(YV(n,o,c,h,Oo)&&!(Oo[0]===n[0]&&Oo[1]===n[1]||Oo[0]===c[0]&&Oo[1]===c[1]||Oo[0]===o[0]&&Oo[1]===o[1]||Oo[0]===h[0]&&Oo[1]===h[1]))return!0}}const i=r.length;if(!(i<=4))for(let s=0;s<i-3;s++){let n=i-1;s===0&&(n=i-2);const o=r[s],a=r[s+1];for(let l=s+2;l<n;l++){const c=r[l],h=r[l+1];if(YV(o,a,c,h,Oo)&&!(Oo[0]===o[0]&&Oo[1]===o[1]||Oo[0]===c[0]&&Oo[1]===c[1]||Oo[0]===a[0]&&Oo[1]===a[1]||Oo[0]===h[0]&&Oo[1]===h[1]))return!0}}}return!1}function Qme(t,e,r){for(let i=0;i<r.length;i++)if(YV(t,e,r[i][0],r[i][1]))return!0;return!1}function YV(t,e,r,i,s){const[n,o]=t,[a,l]=e,[c,h]=r,[p,f]=i,m=p-c,y=n-c,_=a-n,v=f-h,b=o-h,T=l-o,x=v*_-m*T;if(x===0)return!1;const S=(m*b-v*y)/x,E=(_*b-T*y)/x;return S>=0&&S<=1&&E>=0&&E<=1&&(s&&(s[0]=n+S*(a-n),s[1]=o+S*(l-o)),!0)}function DNe(t){switch(t){case"esriGeometryEnvelope":case"extent":return ONe;case"esriGeometryMultipoint":case"multipoint":return RNe;case"esriGeometryPoint":case"point":return ANe;case"esriGeometryPolygon":case"polygon":return PNe;case"esriGeometryPolyline":case"polyline":return $Ne}}var Wu;function NNe(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}function Hy(t,e,r){return e==null?r:r==null?e:t(e,r)}let no=Wu=class extends gv{constructor(...t){super(...t),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(t,e,r,i,s){return NNe(t)?{spatialReference:t,xmin:0,ymin:0,xmax:0,ymax:0}:typeof t=="object"?(t.spatialReference=t.spatialReference==null?je.WGS84:t.spatialReference,t):{xmin:t,ymin:e,xmax:r,ymax:i,spatialReference:s??je.WGS84}}static fromBounds(t,e){return new Wu({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}static fromPoint(t){return new Wu({xmin:t.x,ymin:t.y,zmin:t.z,xmax:t.x,ymax:t.y,zmax:t.z,spatialReference:t.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const t=new Ke({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(t.z=.5*(this.zmin+this.zmax)),this.hasM&&(t.m=.5*(this.mmin+this.mmax)),t}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(t){const e=this.center;return t.z!=null&&this.hasZ?this.offset(t.x-e.x,t.y-e.y,t.z-e.z):this.offset(t.x-e.x,t.y-e.y)}clone(){const t=new Wu;return t.xmin=this.xmin,t.ymin=this.ymin,t.xmax=this.xmax,t.ymax=this.ymax,t.spatialReference=this.spatialReference,this.zmin!=null&&(t.zmin=this.zmin,t.zmax=this.zmax),this.mmin!=null&&(t.mmin=this.mmin,t.mmax=this.mmax),t}contains(t){if(!t)return!1;const e=this.spatialReference,r=t.spatialReference;return e&&r&&!e.equals(r)&&z_(e,r)&&(t=e.isWebMercator?n2(t):$A(t,!0)),t.type==="point"?kX(this,t):t.type==="extent"&&xNe(this,t)}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,r=t.spatialReference;return e&&r&&!e.equals(r)&&z_(e,r)&&(t=e.isWebMercator?n2(t):$A(t,!0)),this.xmin===t.xmin&&this.ymin===t.ymin&&this.zmin===t.zmin&&this.mmin===t.mmin&&this.xmax===t.xmax&&this.ymax===t.ymax&&this.zmax===t.zmax&&this.mmax===t.mmax}expand(t){const e=.5*(1-t),r=this.width*e,i=this.height*e;if(this.xmin+=r,this.ymin+=i,this.xmax-=r,this.ymax-=i,this.hasZ){const s=(this.zmax-this.zmin)*e;this.zmin+=s,this.zmax-=s}if(this.hasM){const s=(this.mmax-this.mmin)*e;this.mmin+=s,this.mmax-=s}return this}intersects(t){if(t==null)return!1;t.type==="mesh"&&(t=t.extent);const e=this.spatialReference,r=t.spatialReference;return e&&r&&!Pn(e,r)&&z_(e,r)&&(t=e.isWebMercator?n2(t):$A(t,!0)),DNe(t.type)(this,t)}normalize(){const t=this._normalize(!1,!0);return Array.isArray(t)?t:[t]}offset(t,e,r){return this.xmin+=t,this.ymin+=e,this.xmax+=t,this.ymax+=e,r!=null&&(this.zmin+=r,this.zmax+=r),this}shiftCentralMeridian(){return this._normalize(!0)}union(t){return this===t||(this.xmin=Math.min(this.xmin,t.xmin),this.ymin=Math.min(this.ymin,t.ymin),this.xmax=Math.max(this.xmax,t.xmax),this.ymax=Math.max(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=Hy(Math.min,this.zmin,t.zmin),this.zmax=Hy(Math.max,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=Hy(Math.min,this.mmin,t.mmin),this.mmax=Hy(Math.max,this.mmax,t.mmax))),this}intersection(t){return this===t?this:t!=null&&this.intersects(t)?(this.xmin=Math.max(this.xmin,t.xmin),this.ymin=Math.max(this.ymin,t.ymin),this.xmax=Math.min(this.xmax,t.xmax),this.ymax=Math.min(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=Hy(Math.max,this.zmin,t.zmin),this.zmax=Hy(Math.min,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=Hy(Math.max,this.mmin,t.mmin),this.mmax=Hy(Math.min,this.mmax,t.mmax)),this):null}toJSON(t){return this.write({},t)}_shiftCM(t=Xb(this.spatialReference)){if(!t||!this.spatialReference)return this;const e=this.spatialReference,r=this._getCM(t);if(r){const i=e.isWebMercator?$A(r):r;this.xmin-=r.x,this.xmax-=r.x,e.isWebMercator||(i.x=this._normalizeX(i.x,t).x),this.spatialReference=new je(N5((e.isWGS84?t.altTemplate:null)??t.wkTemplate,{Central_Meridian:i.x}))}return this}_getCM(t){let e=null;const[r,i]=t.valid,s=this.xmin,n=this.xmax;return s>=r&&s<=i&&n>=r&&n<=i||(e=this.center),e}_normalize(t,e,r){const i=this.spatialReference;if(!i)return this;const s=r??Xb(i);if(s==null)return this;const n=this._getParts(s).map(l=>l.extent);if(n.length<2)return n[0]||this;if(n.length>2)return t?this._shiftCM(s):this.set({xmin:s.valid[0],xmax:s.valid[1]});if(t)return this._shiftCM(s);if(e)return n;let o=!0,a=!0;return n.forEach(l=>{l.hasZ||(o=!1),l.hasM||(a=!1)}),{rings:n.map(l=>{const c=[[l.xmin,l.ymin],[l.xmin,l.ymax],[l.xmax,l.ymax],[l.xmax,l.ymin],[l.xmin,l.ymin]];if(o){const h=(l.zmax-l.zmin)/2;for(let p=0;p<c.length;p++)c[p].push(h)}if(a){const h=(l.mmax-l.mmin)/2;for(let p=0;p<c.length;p++)c[p].push(h)}return c}),hasZ:o,hasM:a,spatialReference:i}}_getParts(t){let e=this.cache._parts;if(!e){e=[];const{ymin:s,ymax:n,spatialReference:o}=this,a=this.width,l=this.xmin,c=this.xmax;let h;t=t||Xb(o);const[p,f]=t.valid;h=this._normalizeX(this.xmin,t);const m=h.x,y=h.frameId;h=this._normalizeX(this.xmax,t);const _=h.x,v=h.frameId,b=m===_&&a>0;if(a>2*f){const T=new Wu(l<c?m:_,s,f,n,o),x=new Wu(p,s,l<c?_:m,n,o),S=new Wu(0,s,f,n,o),E=new Wu(p,s,0,n,o),A=[],R=[];T.contains(S)&&A.push(y),T.contains(E)&&R.push(y),x.contains(S)&&A.push(v),x.contains(E)&&R.push(v);for(let M=y+1;M<v;M++)A.push(M),R.push(M);e.push({extent:T,frameIds:[y]},{extent:x,frameIds:[v]},{extent:S,frameIds:A},{extent:E,frameIds:R})}else m>_||b?e.push({extent:new Wu(m,s,f,n,o),frameIds:[y]},{extent:new Wu(p,s,_,n,o),frameIds:[v]}):e.push({extent:new Wu(m,s,_,n,o),frameIds:[y]});this.cache._parts=e}const r=this.hasZ,i=this.hasM;if(r||i){const s={};r&&(s.zmin=this.zmin,s.zmax=this.zmax),i&&(s.mmin=this.mmin,s.mmax=this.mmax);for(let n=0;n<e.length;n++)e[n].extent.set(s)}return e}_normalizeX(t,e){const[r,i]=e.valid,s=2*i;let n,o=0;return t>i?(n=Math.ceil(Math.abs(t-i)/s),t-=n*s,o=n):t<r&&(n=Math.ceil(Math.abs(t-r)/s),t+=n*s,o=-n),{x:t,frameId:o}}};u([d({readOnly:!0})],no.prototype,"cache",null),u([d({readOnly:!0})],no.prototype,"center",null),u([d({readOnly:!0})],no.prototype,"extent",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],no.prototype,"hasM",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],no.prototype,"hasZ",null),u([d({readOnly:!0})],no.prototype,"height",null),u([d({readOnly:!0})],no.prototype,"width",null),u([d({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],no.prototype,"xmin",void 0),u([d({type:Number,json:{write:!0}})],no.prototype,"ymin",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],no.prototype,"mmin",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],no.prototype,"zmin",void 0),u([d({type:Number,json:{write:!0}})],no.prototype,"xmax",void 0),u([d({type:Number,json:{write:!0}})],no.prototype,"ymax",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],no.prototype,"mmax",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],no.prototype,"zmax",void 0),no=Wu=u([P("esri.geometry.Extent")],no),no.prototype.toJSON.isDefaultToJSON=!0;const ur=no;let _O;const FNe=globalThis.esriConfig?.locale??globalThis.dojoConfig?.locale;function Kme(){return FNe??globalThis.navigator?.language??"en"}function pp(){return _O===void 0&&(_O=Kme()),_O}const vO=[];function zX(t){return vO.push(t),{remove(){vO.splice(vO.indexOf(t),1)}}}const JV=[];function VX(t){return JV.push(t),{remove(){vO.splice(JV.indexOf(t),1)}}}function UNe(){const t=Kme();_O!==t&&(_O=t,[...JV].forEach(e=>{e.call(null,t)}),[...vO].forEach(e=>{e.call(null,t)}))}globalThis.addEventListener?.("languagechange",UNe);let MP;function kNe(t){return MP&&!MP.destroyed||(MP=t()),MP}var QV;const zNe=new $r({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let Xu=QV=class extends we{constructor(t){super(t),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(t){t!=="asc"&&t!=="desc"||this._set("sortOrder",t)}clone(){return new QV({categories:this.categories?K(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(t,e){let r=[];this.categories&&(r=this.categories.map(o=>Array.isArray(o)?JSON.stringify(o):o));let i="";if(this.extent){const o=rx(this.extent,je.WGS84);o!=null&&(i=`${o.xmin},${o.ymin},${o.xmax},${o.ymax}`)}let s=this.query;!this.disableExtraQuery&&t.extraQuery&&(s="("+s+")"+t.extraQuery);const n={categories:r,bbox:i,q:s,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(n.sortField=this.sortField.split(",").map(o=>zNe.toJSON(o.trim())).join(","),n.sortOrder=this.sortOrder),{query:{...e,...n}}}};u([d()],Xu.prototype,"categories",void 0),u([d()],Xu.prototype,"disableExtraQuery",void 0),u([d({type:ur})],Xu.prototype,"extent",void 0),u([d()],Xu.prototype,"filter",void 0),u([d()],Xu.prototype,"num",void 0),u([d()],Xu.prototype,"query",void 0),u([d()],Xu.prototype,"sortField",void 0),u([d()],Xu.prototype,"sortOrder",null),u([d()],Xu.prototype,"start",void 0),Xu=QV=u([P("esri.portal.PortalQueryParams")],Xu);const Mf=Xu;let b1=class extends we{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};u([d()],b1.prototype,"nextQueryParams",void 0),u([d()],b1.prototype,"queryParams",void 0),u([d()],b1.prototype,"results",void 0),u([d()],b1.prototype,"total",void 0),b1=u([P("esri.portal.PortalQueryResult")],b1);const VNe=b1;let Km=class extends le{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new V("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};u([d({type:Date})],Km.prototype,"created",void 0),u([d()],Km.prototype,"id",void 0),u([d()],Km.prototype,"portal",void 0),u([d()],Km.prototype,"title",void 0),u([d({readOnly:!0})],Km.prototype,"url",null),u([d()],Km.prototype,"username",void 0),Km=u([P("esri.portal.PortalFolder")],Km);const BNe=Km;let oo=class extends le{constructor(e){super(e),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.tags=null,this.title=null}get thumbnailUrl(){const e=this.url,r=this.thumbnail;return e&&r&&this.portal?this.portal?.normalizeUrl(`${e}/info/${r}?f=json`):null}get url(){const e=this.get("portal.restUrl");return e?e+"/community/groups/"+this.id:null}fetchCategorySchema(e){return hc(this.portal).request(this.url+"/categorySchema",e).then(r=>{const i=r.categorySchema||[];return i.some(s=>s.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",e):i})}fetchMembers(e){return hc(this.portal).request(this.url+"/users",e)}getThumbnailUrl(e){let r=this.thumbnailUrl;return r&&e&&(r+=`&w=${e}`),r}toJSON(){throw new V("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}queryItems(e,r){let i=vs(Mf,e);const s=hc(this.portal);return parseFloat(s.currentVersion)>5?(i=i||new Mf,s.queryPortal(`/content/groups/${this.id}/search`,i,"PortalItem",r)):(i=i?i.clone():new Mf,i.query="group:"+this.id+(i.query?" "+i.query:""),s.queryItems(i,r))}_fetchCategorySchemaSet(e,r){const i=hc(this.portal);return i.fetchSelf(i.authMode,!0,r).then(s=>{const n=s.contentCategorySetsGroupQuery;if(n){const o=new Mf;return o.disableExtraQuery=!0,o.num=1,o.query=n,i.queryGroups(o,r)}throw new V("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(s=>{if(s.total){const n=s.results[0],o=new Mf;return o.num=1,o.query=`typekeywords:"${e}"`,n.queryItems(o,r)}throw new V("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(s=>s.total?s.results[0].fetchData("json",r).then(n=>{const o=n&&n.categorySchema;return o&&o.length?o:[]}):[])}};u([d()],oo.prototype,"access",void 0),u([d({type:Date})],oo.prototype,"created",void 0),u([d()],oo.prototype,"description",void 0),u([d()],oo.prototype,"id",void 0),u([d()],oo.prototype,"isInvitationOnly",void 0),u([d({type:Date})],oo.prototype,"modified",void 0),u([d()],oo.prototype,"owner",void 0),u([d()],oo.prototype,"portal",void 0),u([d()],oo.prototype,"snippet",void 0),u([d()],oo.prototype,"sortField",void 0),u([d()],oo.prototype,"sortOrder",void 0),u([d()],oo.prototype,"tags",void 0),u([d()],oo.prototype,"thumbnail",void 0),u([d({readOnly:!0})],oo.prototype,"thumbnailUrl",null),u([d()],oo.prototype,"title",void 0),u([d({readOnly:!0})],oo.prototype,"url",null),oo=u([P("esri.portal.PortalGroup")],oo);const KV=oo,GNe=Object.freeze(Object.defineProperty({__proto__:null,default:KV},Symbol.toStringTag,{value:"Module"}));var eB;let ds=eB=class extends le{constructor(...t){super(...t),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e?this.portal.normalizeUrl(`${t}/info/${e}?f=json`):null}get userContentUrl(){const t=this.get("portal.restUrl");return t?`${t}/content/users/${this.username}`:null}get url(){const t=this.get("portal.restUrl");return t?`${t}/community/users/${this.username}`:null}addItem(t){const e=t&&t.item,r=t&&t.data,i=t&&t.folder,s={method:"post"};e&&(s.query=e.createPostQuery(),r!=null&&(typeof r=="string"?s.query.text=r:typeof r=="object"&&(s.query.text=JSON.stringify(r))));let n=this.userContentUrl;return i&&(n+="/"+(typeof i=="string"?i:i.id)),this.portal.request(n+"/addItem",s).then(o=>(e.id=o.id,e.portal=this.portal,e.loaded?e.reload():e.load()))}deleteItem(t){let e=this.userContentUrl;return t.ownerFolder&&(e+="/"+t.ownerFolder),this.portal.request(e+`/items/${t.id}/delete`,{method:"post"}).then(()=>{t.id=null,t.portal=null})}deleteItems(t){const e=this.userContentUrl+"/deleteItems",r=t.map(i=>i.id);if(r.length){const i={method:"post",query:{items:r.join(",")}};return this.portal.request(e,i).then(()=>{t.forEach(s=>{s.id=null,s.portal=null})})}return Promise.resolve(void 0)}fetchFolders(){const t={query:{num:1}};return this.portal.request(this.userContentUrl??"",t).then(e=>{let r;return r=e&&e.folders?e.folders.map(i=>{const s=BNe.fromJSON(i);return s.portal=this.portal,s}):[],r})}fetchGroups(){return this.portal.request(this.url??"").then(t=>{let e;return e=t&&t.groups?t.groups.map(r=>{const i=KV.fromJSON(r);return i.portal=this.portal,i}):[],e})}fetchItems(t){const e=t??{};let r,i=this.userContentUrl??"";return e.folder&&(i+="/"+e.folder.id),ce(()=>Promise.resolve().then(()=>ege),void 0,import.meta.url).then(({default:s})=>{r=s;const n={folders:!1,num:e.num||10,start:e.start||1,sortField:e.sortField||"created",sortOrder:e.sortOrder||"asc"};return this.portal.request(i,{query:n})}).then(s=>{let n;return s&&s.items?(n=s.items.map(o=>{const a=r.fromJSON(o);return a.portal=this.portal,a}),Promise.all(n.map(o=>o.load())).catch(o=>o).then(()=>({items:n,nextStart:s.nextStart,total:s.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal.request(this.url+"/tags").then(t=>t.tags)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}queryFavorites(t){return this.favGroupId?(this._favGroup||(this._favGroup=new KV({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(t)):Promise.reject(new V("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new V("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new eB;return e.sourceJSON=t,e.read(t),e}};u([d()],ds.prototype,"access",void 0),u([d({type:Date})],ds.prototype,"created",void 0),u([d()],ds.prototype,"culture",void 0),u([d()],ds.prototype,"description",void 0),u([d()],ds.prototype,"email",void 0),u([d()],ds.prototype,"favGroupId",void 0),u([d()],ds.prototype,"fullName",void 0),u([d({type:Date})],ds.prototype,"modified",void 0),u([d()],ds.prototype,"orgId",void 0),u([d()],ds.prototype,"portal",void 0),u([d()],ds.prototype,"preferredView",void 0),u([d()],ds.prototype,"privileges",void 0),u([d()],ds.prototype,"region",void 0),u([d()],ds.prototype,"role",void 0),u([d()],ds.prototype,"roleId",void 0),u([d()],ds.prototype,"sourceJSON",void 0),u([d()],ds.prototype,"thumbnail",void 0),u([d({readOnly:!0})],ds.prototype,"thumbnailUrl",null),u([d()],ds.prototype,"units",void 0),u([d({readOnly:!0})],ds.prototype,"userContentUrl",null),u([d({readOnly:!0})],ds.prototype,"url",null),u([d()],ds.prototype,"username",void 0),u([d()],ds.prototype,"userType",void 0),ds=eB=u([P("esri.portal.PortalUser")],ds);const BX=ds,jNe=Object.freeze(Object.defineProperty({__proto__:null,default:BX},Symbol.toStringTag,{value:"Module"}));var eg;let PP;const Zee={PortalGroup:()=>ce(()=>Promise.resolve().then(()=>GNe),void 0,import.meta.url),PortalItem:()=>ce(()=>Promise.resolve().then(()=>ege),void 0,import.meta.url),PortalUser:()=>ce(()=>Promise.resolve().then(()=>jNe),void 0,import.meta.url)};let De=eg=class extends GE(sy){constructor(t){super(t),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.basemapGalleryGroupQuery3D=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=Br.portalUrl,this.urlKey=null,this.user=null,this.use3dBasemaps=!0,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(t){return typeof t=="string"?{url:t}:t}destroy(){Yee.unregister(this),this.defaultBasemap=$e(this.defaultBasemap),this.defaultDevBasemap=$e(this.defaultDevBasemap),this.defaultVectorBasemap=$e(this.defaultVectorBasemap),this._esriIdCredentialCreateHandle=Ni(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(t){if(t)for(const e of t)Br.request.trustedServers.includes(e)||Br.request.trustedServers.push(e);return t}readDefaultBasemap(t){return this._readBasemap(t)}readDefaultDevBasemap(t){return this._readBasemap(t)}readDefaultVectorBasemap(t){return this._readBasemap(t)}get extraQuery(){const t=!(this.user&&this.user.orgId)||this.canSearchPublic;return this.id&&!t?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let t=this.url;if(t){const e=t.indexOf("/sharing");t=e>0?t.substring(0,e):this.url.replace(/\/+$/,""),t+="/sharing/rest"}return t}get thumbnailUrl(){const t=this.restUrl,e=this.thumbnail;return t&&e?this._normalizeSSL(t+"/portals/self/resources/"+e):null}readUrlKey(t){return t&&t.toLowerCase()}readUser(t){let e=null;return t&&(e=BX.fromJSON(t),e.portal=this),e}load(t){const e=ce(()=>Promise.resolve().then(()=>y4e),void 0,import.meta.url).then(({default:r})=>{Yt(t),PP=r}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,t)).then(r=>{if(Pi){const i=Pi;this.credential=i.findCredential(this.restUrl),this.credential||this.authMode!==eg.AUTH_MODE_AUTO||(this._esriIdCredentialCreateHandle?.remove(),this._esriIdCredentialCreateHandle=i.on("credential-create",HNe(new WeakRef(this))),Yee.register(this,this._esriIdCredentialCreateHandle,this))}this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(e),Promise.resolve(this)}async createElevationLayers(){await this.load();const t=this._getHelperService("defaultElevationLayers"),e=(await ce(()=>import("./ElevationLayer-1b7a1abb.js"),["./ElevationLayer-1b7a1abb.js","./ArcGISCachedService-e0f0855c.js","./TileInfoTilemapCache-840af640.js","./TilemapCache-49fbf8a9.js"],import.meta.url)).default;return t?t.map(r=>new e({id:r.id,url:r.url})):[]}async fetchBasemaps(t,e){const r=await this._fetchBasemaps(t,e);if(e?.include3d===!0&&this.use3dBasemaps!==!1){const i=await this._fetchBasemaps3D(t,e);r.unshift(...i)}return r}fetchCategorySchema(t){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",t).then(e=>e.categorySchema):An(t)?Promise.reject(kr()):Promise.resolve([])}fetchFeaturedGroups(t){const e=this.featuredGroups,r=new Mf;if(r.num=100,r.sortField="title",e&&e.length){const i=[];for(const s of e)i.push(`(title:"${s.title}" AND owner:${s.owner})`);return r.query=i.join(" OR "),this.queryGroups(r,t).then(s=>s.results)}return An(t)?Promise.reject(kr()):Promise.resolve([])}fetchRegions(t){const e=this.user?.culture||this.culture||pp();return this.request(this.restUrl+"/portals/regions",{...t,query:{culture:e}})}fetchSettings(t){const e=this.user?.culture||this.culture||pp();return this.request(this.restUrl+"/portals/self/settings",{...t,query:{culture:e}})}static getDefault(){return kNe(()=>new eg)}queryGroups(t,e){return this.queryPortal("/community/groups",t,"PortalGroup",e)}queryItems(t,e){return this.queryPortal("/search",t,"PortalItem",e)}queryUsers(t,e){return t.sortField||(t.sortField="username"),this.queryPortal("/community/users",t,"PortalUser",e)}fetchSelf(t=this.authMode,e=!1,r){const i=this.restUrl+"/portals/self",s={authMode:t,query:{culture:pp().toLowerCase()},...r};return s.authMode==="auto"&&(s.authMode="no-prompt"),e&&(s.query.default=!0),this.request(i,s)}queryPortal(t,e,r,i){const s=vs(Mf,e),n=o=>this.request(this.restUrl+t,{...s.toRequestOptions(this),...i}).then(a=>{const l=s.clone();return l.start=a.nextStart,new VNe({nextQueryParams:l,queryParams:s,total:a.total,results:eg._resultsToTypedArray(o,{portal:this},a,i)})}).then(a=>Promise.all(a.results.map(l=>typeof l.when=="function"?l.when():a)).then(()=>a,l=>(Fo(l),a)));return r&&Zee[r]?Zee[r]().then(({default:o})=>(Yt(i),n(o))):n()}signIn(){if(this.authMode===eg.AUTH_MODE_ANONYMOUS)return Promise.reject(new V("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const t=e=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(e||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=e,this.fetchSelf("immediate"))):this.user&&this.credential===e?null:(this.credential=e,this.fetchSelf("immediate"))).then(r=>{r&&(this.sourceJSON=r,this.read(r))});return Pi?Pi.getCredential(this.restUrl).then(e=>t(e)):t(this.credential)}normalizeUrl(t){const e=this.credential&&this.credential.token;return this._normalizeSSL(e?t+(t.includes("?")?"&":"?")+"token="+e:t)}requestToTypedArray(t,e,r){return this.request(t,e).then(i=>{const s=eg._resultsToTypedArray(r,{portal:this},i);return Promise.all(s.map(n=>typeof n.when=="function"?n.when():i)).then(()=>s,()=>s)})}request(t,e={}){const r={f:"json",...e.query},{authMode:i=this.authMode===eg.AUTH_MODE_ANONYMOUS?"anonymous":"auto",body:s=null,cacheBust:n=!1,method:o="auto",responseType:a="json",signal:l}=e,c={authMode:i,body:s,cacheBust:n,method:o,query:r,responseType:a,timeout:0,signal:l};return hr(this._normalizeSSL(t),c).then(h=>h.data)}toJSON(){throw new V("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new eg({sourceJSON:t})}_getHelperService(t){const e=this.helperServices&&this.helperServices[t];if(!e)throw new V("portal:service-not-found",`The \`helperServices\` do not include an entry named "${t}"`);return e}async _fetchBasemaps(t,e){const r=new Mf;r.query=t||(Br.apiKey&&jme(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),r.disableExtraQuery=!0;const i=await this.queryGroups(r,e);if(!i.total)return[];const s=i.results[0];r.num=100,r.query='type:"Web Map" -type:"Web Application"',r.sortField=s.sortField||"name",r.sortOrder=s.sortOrder||"desc";const n=await s.queryItems(r,e);return n.total?n.results.filter(o=>o.type==="Web Map").map(o=>new PP({portalItem:o})):[]}async _fetchBasemaps3D(t,e){const r=t||this.basemapGalleryGroupQuery3D;if(!r)return[];const i=new Mf({query:r,disableExtraQuery:!0}),s=await this.queryGroups(i,e);if(!s.total)return[];const n=s.results[0];i.num=100,i.query='type:"Web Scene"',i.sortField=n.sortField||"name",i.sortOrder=n.sortOrder||"desc";const o=await n.queryItems(i,e);return o.total?o.results.filter(a=>a.type==="Web Scene").map(a=>new PP({portalItem:a})):[]}_normalizeSSL(t){return t.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(t){if(t){const e=PP.fromJSON(t);return e.portalItem={portal:this},e}return null}static _resultsToTypedArray(t,e,r,i){let s=[];if(r){const n=i!=null?i.signal:null;s=r.listings||r.notifications||r.userInvitations||r.tags||r.items||r.groups||r.comments||r.provisions||r.results||r.relatedItems||r,(t||e)&&(s=s.map(o=>{const a=Object.assign(t?t.fromJSON(o):o,e);return typeof a.load=="function"&&a.load(n),a}))}else s=[];return s}};De.AUTH_MODE_ANONYMOUS="anonymous",De.AUTH_MODE_AUTO="auto",De.AUTH_MODE_IMMEDIATE="immediate",u([d()],De.prototype,"access",void 0),u([d()],De.prototype,"allSSL",void 0),u([d()],De.prototype,"authMode",void 0),u([d()],De.prototype,"authorizedCrossOriginDomains",void 0),u([Ae("authorizedCrossOriginDomains")],De.prototype,"readAuthorizedCrossOriginDomains",null),u([d()],De.prototype,"basemapGalleryGroupQuery",void 0),u([d({json:{name:"3DBasemapGalleryGroupQuery"}})],De.prototype,"basemapGalleryGroupQuery3D",void 0),u([d()],De.prototype,"bingKey",void 0),u([d()],De.prototype,"canListApps",void 0),u([d()],De.prototype,"canListData",void 0),u([d()],De.prototype,"canListPreProvisionedItems",void 0),u([d()],De.prototype,"canProvisionDirectPurchase",void 0),u([d()],De.prototype,"canSearchPublic",void 0),u([d()],De.prototype,"canShareBingPublic",void 0),u([d()],De.prototype,"canSharePublic",void 0),u([d()],De.prototype,"canSignInArcGIS",void 0),u([d()],De.prototype,"canSignInIDP",void 0),u([d()],De.prototype,"colorSetsGroupQuery",void 0),u([d()],De.prototype,"commentsEnabled",void 0),u([d({type:Date})],De.prototype,"created",void 0),u([d()],De.prototype,"credential",void 0),u([d()],De.prototype,"culture",void 0),u([d()],De.prototype,"currentVersion",void 0),u([d()],De.prototype,"customBaseUrl",void 0),u([d()],De.prototype,"defaultBasemap",void 0),u([Ae("defaultBasemap")],De.prototype,"readDefaultBasemap",null),u([d()],De.prototype,"defaultDevBasemap",void 0),u([Ae("defaultDevBasemap")],De.prototype,"readDefaultDevBasemap",null),u([d({type:ur})],De.prototype,"defaultExtent",void 0),u([d()],De.prototype,"defaultVectorBasemap",void 0),u([Ae("defaultVectorBasemap")],De.prototype,"readDefaultVectorBasemap",null),u([d()],De.prototype,"description",void 0),u([d()],De.prototype,"devBasemapGalleryGroupQuery",void 0),u([d()],De.prototype,"eueiEnabled",void 0),u([d({readOnly:!0})],De.prototype,"extraQuery",null),u([d()],De.prototype,"featuredGroups",void 0),u([d()],De.prototype,"featuredItemsGroupQuery",void 0),u([d()],De.prototype,"galleryTemplatesGroupQuery",void 0),u([d()],De.prototype,"livingAtlasGroupQuery",void 0),u([d()],De.prototype,"hasCategorySchema",void 0),u([d()],De.prototype,"helpBase",void 0),u([d()],De.prototype,"helperServices",void 0),u([d()],De.prototype,"helpMap",void 0),u([d()],De.prototype,"homePageFeaturedContent",void 0),u([d()],De.prototype,"homePageFeaturedContentCount",void 0),u([d()],De.prototype,"httpPort",void 0),u([d()],De.prototype,"httpsPort",void 0),u([d()],De.prototype,"id",void 0),u([d()],De.prototype,"ipCntryCode",void 0),u([d({readOnly:!0})],De.prototype,"isOrganization",null),u([d()],De.prototype,"isPortal",void 0),u([d()],De.prototype,"isReadOnly",void 0),u([d({readOnly:!0})],De.prototype,"itemPageUrl",null),u([d()],De.prototype,"layerTemplatesGroupQuery",void 0),u([d()],De.prototype,"maxTokenExpirationMinutes",void 0),u([d({type:Date})],De.prototype,"modified",void 0),u([d()],De.prototype,"name",void 0),u([d()],De.prototype,"portalHostname",void 0),u([d()],De.prototype,"portalMode",void 0),u([d()],De.prototype,"portalProperties",void 0),u([d()],De.prototype,"region",void 0),u([d({readOnly:!0})],De.prototype,"restUrl",null),u([d()],De.prototype,"rotatorPanels",void 0),u([d()],De.prototype,"showHomePageDescription",void 0),u([d()],De.prototype,"sourceJSON",void 0),u([d()],De.prototype,"staticImagesUrl",void 0),u([d({json:{name:"2DStylesGroupQuery"}})],De.prototype,"stylesGroupQuery2d",void 0),u([d({json:{name:"stylesGroupQuery"}})],De.prototype,"stylesGroupQuery3d",void 0),u([d()],De.prototype,"supportsHostedServices",void 0),u([d()],De.prototype,"symbolSetsGroupQuery",void 0),u([d()],De.prototype,"templatesGroupQuery",void 0),u([d()],De.prototype,"thumbnail",void 0),u([d({readOnly:!0})],De.prototype,"thumbnailUrl",null),u([d()],De.prototype,"units",void 0),u([d()],De.prototype,"url",void 0),u([d()],De.prototype,"urlKey",void 0),u([Ae("urlKey")],De.prototype,"readUrlKey",null),u([d()],De.prototype,"user",void 0),u([Ae("user")],De.prototype,"readUser",null),u([d()],De.prototype,"use3dBasemaps",void 0),u([d()],De.prototype,"useStandardizedQuery",void 0),u([d()],De.prototype,"useVectorBasemaps",void 0),u([d()],De.prototype,"vectorBasemapGalleryGroupQuery",void 0),De=eg=u([P("esri.portal.Portal")],De);const Js=De,Yee=new FinalizationRegistry(t=>{t.remove()});function HNe(t){const e=Pi;return()=>{const r=t.deref();r&&e.findCredential(r.restUrl)&&r.signIn().catch(()=>{})}}const qNe=Q.getLogger("esri.assets");function WNe(t,e){return hr(Gr(t),e)}function Gr(t){if(!Br.assetsPath)throw qNe.errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new V("assets:path-not-set","config.assetsPath is not set");return Pc(Br.assetsPath,t)}let tg=class extends we{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e&&e.portalItem&&e.path?{...e,path:this._normalizePath(e.path,e.portalItem)}:e}set path(e){e!=null&&Ac(e)?Q.getLogger(this).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return this._normalizePath(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get cdnUrl(){return this.portalItem&&this.path?`${this.portalItem.itemCdnUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",r){const i=this.cdnUrl;if(i==null)throw new V("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(i,{responseType:e,query:{token:this.portalItem.apiKey},signal:r?.signal})}async update(e,r){const{addOrUpdateResource:i}=await ce(()=>Promise.resolve().then(()=>w3),void 0,import.meta.url);return i(this,"update",e,r)}hasPath(){return this.path!=null}_normalizePath(e,r){return e==null?e:(e=e.replace(/^\/+/,""),r!=null&&Ac(e)&&(e=SX(e,r.itemUrl)),e?.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};u([d()],tg.prototype,"portalItem",void 0),u([d({type:String,value:null})],tg.prototype,"path",null),u([wr("path")],tg.prototype,"_castPath",null),u([d({type:String,readOnly:!0})],tg.prototype,"url",null),u([d({type:String,readOnly:!0})],tg.prototype,"cdnUrl",null),u([d({type:String,readOnly:!0})],tg.prototype,"itemRelativeUrl",null),tg=u([P("esri.portal.PortalItemResource")],tg);const XNe=tg;let LA=class extends we{constructor(e){super(e),this.created=null,this.rating=null}};u([d()],LA.prototype,"created",void 0),u([d()],LA.prototype,"rating",void 0),LA=u([P("esri.portal.PortalRating")],LA);const T8=LA;var w1;const ZNe=new Set(["Map Service","Feature Service","Feature Collection","Scene Service","Image Service","Stream Service","Vector Tile Service","GeoJson","CSV","KML","WFS","WMTS","WMS","Feed"]),YNe=new Set(["KML","GeoJson","CSV"]);let lr=w1=class extends GE(sy){static from(t){return mw(w1,t)}constructor(t){super(t),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const t=this.type,e=this.typeKeywords||[];let r=t;return t==="Feature Service"||t==="Feature Collection"?r=e.includes("Table")?"Table":e.includes("Route Layer")?"Route Layer":e.includes("Markup")?"Markup":"Feature Layer":t==="Image Service"?r=e.includes("Elevation 3D Layer")?"Elevation Layer":e.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":t==="Scene Service"?r="Scene Layer":t==="Video Service"?r="Video Layer":t==="Scene Package"?r="Scene Layer Package":t==="Stream Service"?r="Feature Layer":t==="Geoprocessing Service"?r=e.includes("Web Tool")?"Tool":"Geoprocessing Service":t==="Geocoding Service"?r="Locator":t==="Geoenrichment Service"?r="GeoEnrichment Service":t==="Microsoft Powerpoint"?r="Microsoft PowerPoint":t==="GeoJson"?r="GeoJSON":t==="Globe Service"?r="Globe Layer":t==="Vector Tile Service"?r="Tile Layer":t==="netCDF"?r="NetCDF":t==="Map Service"?r=e.includes("Spatiotemporal")||!e.includes("Hosted Service")&&!e.includes("Tiled")||e.includes("Relational")?"Map Image Layer":"Tile Layer":t&&t.toLowerCase().includes("add in")?r=t.replaceAll(/(add in)/gi,"Add-In"):t==="datastore catalog service"?r="Big Data File Share":t==="Compact Tile Package"?r="Tile Package (tpkx)":t==="OGCFeatureServer"?r="OGC Feature Layer":t==="web mapping application"&&e.includes("configurableApp")?r="Instant App":t==="Insights Page"?r="Insights Report":t==="Excalibur Imagery Project"&&(r="Excalibur Project"),r}readExtent(t){return t&&t.length?new ur(t[0][0],t[0][1],t[1][0],t[1][1]):null}get iconUrl(){const t=this.type&&this.type.toLowerCase()||"",e=this.typeKeywords||[],r="esri/images/portal/",i="16";let s,n=!1,o=!1,a=!1,l=!1,c=!1,h=!1;return t.indexOf("service")>0||t==="feature collection"||t==="kml"||t==="wms"||t==="wmts"||t==="wfs"?(n=e.includes("Hosted Service"),t==="feature service"||t==="feature collection"||t==="kml"||t==="wfs"?(o=e.includes("Table"),a=e.includes("Route Layer"),l=e.includes("Markup"),c=e.includes("Spatiotemporal"),h=e.includes("UtilityNetwork"),s=c&&o?"spatiotemporaltable":o?"table":a?"routelayer":l?"markup":c?"spatiotemporal":n?"featureshosted":h?"utilitynetwork":"features"):s=t==="map service"||t==="wms"||t==="wmts"?n||e.includes("Tiled")||t==="wmts"?"maptiles":"mapimages":t==="scene service"?e.includes("Line")?"sceneweblayerline":e.includes("3DObject")?"sceneweblayermultipatch":e.includes("Point")?"sceneweblayerpoint":e.includes("IntegratedMesh")?"sceneweblayermesh":e.includes("PointCloud")?"sceneweblayerpointcloud":e.includes("Polygon")?"sceneweblayerpolygon":e.includes("Building")?"sceneweblayerbuilding":e.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":t==="image service"?e.includes("Elevation 3D Layer")?"elevationlayer":e.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":t==="stream service"?"streamlayer":t==="video service"?e.includes("Live Stream")?"livestreamvideolayer":"videolayer":t==="vector tile service"?"vectortile":t==="datastore catalog service"?"datastorecollection":t==="geocoding service"?"geocodeservice":t==="geoprocessing service"?e.includes("Web Tool")?"tool":"layers":t==="geodata service"?"geodataservice":"layers"):s=t==="web map"||t==="cityengine web scene"?"maps":t==="web scene"?e.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":t==="web mapping application"&&e.includes("configurableApp")?"instantapps":t==="web mapping application"||t==="mobile application"||t==="application"||t==="operation view"||t==="desktop application"?"apps":t==="map document"||t==="map package"||t==="published map"||t==="scene document"||t==="globe document"||t==="basemap package"||t==="mobile basemap package"||t==="mobile map package"||t==="project package"||t==="project template"||t==="pro map"||t==="layout"||t==="layer"&&e.includes("ArcGIS Pro")||t==="explorer map"&&e.indexOf("Explorer Document")?"mapsgray":t==="service definition"||t==="csv"||t==="shapefile"||t==="cad drawing"||t==="geojson"||t==="netcdf"||t==="administrative report"?"datafiles":t==="explorer add in"||t==="desktop add in"||t==="windows viewer add in"||t==="windows viewer configuration"?"appsgray":t==="360 vr experience"?"360vr":t==="arcgis pro add in"||t==="arcgis pro configuration"?"addindesktop":t==="rule package"||t==="file geodatabase"||t==="sqlite geodatabase"||t==="csv collection"||t==="kml collection"||t==="windows mobile package"||t==="map template"||t==="desktop application template"||t==="gml"||t==="arcpad package"||t==="code sample"||t==="form"||t==="document link"||t==="earth configuration"||t==="operations dashboard add in"||t==="rules package"||t==="image"||t==="workflow manager package"||t==="explorer map"&&e.includes("Explorer Mapping Application")||e.includes("Document")?"datafilesgray":t==="network analysis service"||t==="geoprocessing service"||t==="geodata service"||t==="geometry service"||t==="geoprocessing package"||t==="locator package"||t==="geoprocessing sample"||t==="workflow manager service"?"toolsgray":t==="layer"||t==="layer package"||t==="explorer layer"?"layersgray":t==="scene package"?"scenepackage":t==="mobile scene package"?"mobilescenepackage":t==="tile package"||t==="compact tile package"?"tilepackage":t==="task file"?"taskfile":t==="report template"?"report-template":t==="statistical data collection"?"statisticaldatacollection":t==="insights workbook"?"workbook":t==="insights model"?"insightsmodel":t==="insights page"?"insightspage":t==="insights theme"?"insightstheme":t==="hub initiative"?"hubinitiative":t==="hubpage"?"hubpage":t==="hub event"?"hubevent":t==="hub site application"?"hubsite":t==="hub project"?"hubproject":t==="relational database connection"?"relationaldatabaseconnection":t==="big data file share"?"datastorecollection":t==="image collection"?"imagecollection":t==="style"?"style":t==="desktop style"?"desktopstyle":t==="dashboard"?"dashboard":t==="raster function template"?"rasterprocessingtemplate":t==="vector tile package"?"vectortilepackage":t==="ortho mapping project"?"orthomappingproject":t==="ortho mapping template"?"orthomappingtemplate":t==="solution"?"solutions":t==="geopackage"?"geopackage":t==="deep learning package"?"deeplearningpackage":t==="real time analytic"?"realtimeanalytics":t==="big data analytic"?"bigdataanalytics":t==="feed"?"feed":t==="excalibur imagery project"?"excaliburimageryproject":t==="notebook"?"notebook":t==="storymap"?"storymap":t==="survey123 add in"?"survey123addin":t==="mission"?"mission":t==="mission report"?"missionreport":t==="quickcapture project"?"quickcaptureproject":t==="pro report"?"proreport":t==="pro report template"?"proreporttemplate":t==="urban model"?"urbanmodel":t==="web experience"?"experiencebuilder":t==="web experience template"?"webexperiencetemplate":t==="experience builder widget"?"experiencebuilderwidget":t==="experience builder widget package"?"experiencebuilderwidgetpackage":t==="workflow"?"workflow":t==="insights script"?"insightsscript":t==="kernel gateway connection"?"kernelgatewayconnection":t==="hub initiative template"?"hubinitiativetemplate":t==="storymap theme"?"storymaptheme":t==="knowledge graph"?"knowledgegraph":t==="native application"?"nativeapp":t==="native application installer"?"nativeappinstaller":t==="link chart"?"linkchart":t==="investigation"?"investigation":t==="ogcfeatureserver"?"features":t==="pro project"?"proproject":t==="insights workbook package"?"insightsworkbookpackage":t==="apache parquet"?"apacheparquet":t==="notebook code snippets"||t==="notebook code snippet library"?"notebookcodesnippets":t==="suitability model"?"suitabilitymodel":t==="esri classifier definition"?"classifierdefinition":t==="esri classification schema"?"classificationschema":t==="insights data engineering workbook"?"dataengineeringworkbook":t==="insights data engineering model"?"dataengineeringmodel":t==="deep learning studio project"?"deeplearningproject":t==="discussion"?"discussion":t==="allsource project"?"allsourceproject":t==="api key"?"apikey":t==="data pipeline"?"datapipelines":"maps",s?Gr(r+s+i+".png"):null}get isLayer(){return this.type!=null&&ZNe.has(this.type)}get itemCdnUrl(){let t=this.itemUrl;return t&&Pi&&!Pi.findCredential(t)&&(t=Pi._normalizeAGOLorgDomain(t),t=t.replace(/^https?:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com"),t=t.replace(/^https?:\/\/devext\.arcgis\.com/,"https://cdndev.arcgis.com"),t=t.replace(/^https?:\/\/qaext\.arcgis\.com/,"https://cdnqa.arcgis.com")),t}get itemPageUrl(){const t=this.portal?.itemPageUrl;return t&&this.id?`${t}?id=${this.id}`:null}get itemUrl(){const t=this.portal?.restUrl;return t&&this.id?`${t}/content/items/${this.id}`:null}get thumbnailUrl(){const t=this.itemUrl,e=this.thumbnail;return t&&e?this.portal?.normalizeUrl(`${t}/info/${e}?f=json`)??null:null}get userItemUrl(){const t=this.get("portal.restUrl");if(!t)return null;const e=this.owner||this.get("portal.user.username");return e?`${t}/content/users/${this.ownerFolder?`${e}/${this.ownerFolder}`:e}/items/${this.id}`:null}load(t){const e=this.portal??(this.portal=Js.getDefault()),r=e.load(t).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?e.request(this.itemUrl,{signal:t!=null?t.signal:null,query:{token:this.apiKey}}):{}).then(i=>{this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(r),Promise.resolve(this)}async addRating(t){const e={method:"post",query:{}};return t instanceof T8&&(t=t.rating),t==null||isNaN(t)||typeof t!="number"||(e.query.rating=t),this.portal?(await this.portal.request(this.itemUrl+"/addRating",e),new T8({rating:t,created:new Date})):null}clone(){const t={access:this.access,accessInformation:this.accessInformation,applicationProxies:K(this.applicationProxies),avgRating:this.avgRating,categories:K(this.categories),created:K(this.created),culture:this.culture,description:this.description,extent:K(this.extent),groupCategories:K(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:K(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:K(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:K(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:K(this.typeKeywords),url:this.url};this.loaded&&(t.loadStatus="loaded");const e=new w1({sourceJSON:this.sourceJSON}).set(t);return e._set("isOrgItem",this.isOrgItem),e}createPostQuery(){const t=this.toJSON();for(const r of["tags","typeKeywords","categories"])t[r]=t[r]?.join(", ");const{extent:e}=t;return e&&(t.extent=JSON.stringify(e)),t}async deleteRating(){await hc(this.portal).request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(t="json",e){return hc(this.portal).request(this.itemUrl+"/data",{responseType:t,...e,query:{token:this.apiKey}})}async fetchRating(t){const e=await hc(this.portal).request(this.itemUrl+"/rating",{query:{token:this.apiKey},...t});return e.rating!=null?(e.created=new Date(e.created),new T8(e)):null}fetchRelatedItems(t,e){return hc(this.portal).requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...t,token:this.apiKey},...e},w1)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}reload(){return hc(this.portal).request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then(t=>(this.sourceJSON=t,this.read(t),this))}update(t){return this.id?this.load().then(()=>hc(this.portal).signIn()).then(()=>{const e=t&&t.data,r={method:"post"};r.query=this.createPostQuery();for(const i in r.query)r.query[i]===null&&(r.query[i]="");return r.query.clearEmptyFields=!0,e!=null&&(typeof e=="string"?r.query.text=e:typeof e=="object"&&(r.query.text=JSON.stringify(e))),this.portal.request(`${this.userItemUrl}/update`,r).then(()=>this.reload())}):Promise.reject(new V("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(t){if(!this.id)throw new V("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:e,itemUrl:r}=this;await hc(e).signIn();const{copyResources:i,folder:s,tags:n,title:o}=t||{},a={method:"post",query:{copyPrivateResources:i==="all",folder:typeof s=="string"?s:s?.id,includeResources:!!i,tags:n?.join(","),title:o}},{itemId:l}=await e.request(`${r}/copy`,a);return new w1({id:l,portal:e})}updateThumbnail(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t.thumbnail,r=t.filename,i={method:"post"};if(typeof e=="string")_m(e)?i.query={data:e}:i.query={url:du(e)},r!=null&&(i.query.filename=r);else{const s=new FormData;r!=null?s.append("file",e,r):s.append("file",e),i.body=s}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,i).then(()=>this.reload())}):Promise.reject(new V("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(t={},e){const{fetchResources:r}=await ce(()=>Promise.resolve().then(()=>w3),void 0,import.meta.url);return r(this,t,e)}async addResource(t,e,r){const{addOrUpdateResource:i}=await ce(()=>Promise.resolve().then(()=>w3),void 0,import.meta.url);return t.portalItem=this,i(t,"add",e,r)}async removeResource(t,e){const{removeResource:r}=await ce(()=>Promise.resolve().then(()=>w3),void 0,import.meta.url);if(t.portalItem&&t.portalItem.itemUrl!==this.itemUrl)throw new V("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return r(this,t,e)}async removeAllResources(t){const{removeAllResources:e}=await ce(()=>Promise.resolve().then(()=>w3),void 0,import.meta.url);return e(this,t)}resourceFromPath(t){return new XNe({portalItem:this,path:t})}toJSON(){const t=this.extent,e={accessInformation:this.accessInformation,categories:K(this.categories),created:this.created&&this.created.getTime(),description:this.description,extent:t&&[[t.xmin,t.ymin],[t.xmax,t.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:this.modified&&this.modified.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:K(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:K(this.typeKeywords),url:this.url};return pfe(e)}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new w1({sourceJSON:t})}_getPostQuery(){const t=this.toJSON();for(const e in t)e==="tags"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="typeKeywords"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="extent"&&t[e]&&(t[e]=JSON.stringify(t[e]));return t}};u([d({type:["private","shared","org","public"]})],lr.prototype,"access",void 0),u([d()],lr.prototype,"accessInformation",void 0),u([d({type:String})],lr.prototype,"apiKey",void 0),u([d({json:{read:{source:"appProxies"}}})],lr.prototype,"applicationProxies",void 0),u([d()],lr.prototype,"avgRating",void 0),u([d()],lr.prototype,"categories",void 0),u([d({type:Date})],lr.prototype,"created",void 0),u([d()],lr.prototype,"culture",void 0),u([d()],lr.prototype,"description",void 0),u([d({readOnly:!0})],lr.prototype,"displayName",null),u([d({type:ur})],lr.prototype,"extent",void 0),u([Ae("extent")],lr.prototype,"readExtent",null),u([d()],lr.prototype,"groupCategories",void 0),u([d({readOnly:!0})],lr.prototype,"iconUrl",null),u([d()],lr.prototype,"id",void 0),u([d({readOnly:!0})],lr.prototype,"isLayer",null),u([d({type:Boolean,readOnly:!0})],lr.prototype,"isOrgItem",void 0),u([d()],lr.prototype,"itemControl",void 0),u([d({readOnly:!0})],lr.prototype,"itemPageUrl",null),u([d({readOnly:!0})],lr.prototype,"itemUrl",null),u([d()],lr.prototype,"licenseInfo",void 0),u([d({type:Date})],lr.prototype,"modified",void 0),u([d()],lr.prototype,"name",void 0),u([d()],lr.prototype,"numComments",void 0),u([d()],lr.prototype,"numRatings",void 0),u([d()],lr.prototype,"numViews",void 0),u([d()],lr.prototype,"owner",void 0),u([d()],lr.prototype,"ownerFolder",void 0),u([d({type:Js})],lr.prototype,"portal",void 0),u([d()],lr.prototype,"screenshots",void 0),u([d()],lr.prototype,"size",void 0),u([d()],lr.prototype,"snippet",void 0),u([d()],lr.prototype,"sourceJSON",void 0),u([d({type:String})],lr.prototype,"sourceUrl",void 0),u([d({type:String})],lr.prototype,"spatialReference",void 0),u([d()],lr.prototype,"tags",void 0),u([d()],lr.prototype,"thumbnail",void 0),u([d({readOnly:!0})],lr.prototype,"thumbnailUrl",null),u([d()],lr.prototype,"title",void 0),u([d()],lr.prototype,"type",void 0),u([d()],lr.prototype,"typeKeywords",void 0),u([d({type:String,json:{read(t,e){if(YNe.has(e.type)){const r=this.portal?.restUrl;t||(t=r&&this.id?`${r}/content/items/${this.id}/data`:null)}return t}}})],lr.prototype,"url",void 0),u([d({readOnly:!0})],lr.prototype,"userItemUrl",null),lr=w1=u([P("esri.portal.PortalItem")],lr);const Yb=lr,ege=Object.freeze(Object.defineProperty({__proto__:null,default:Yb},Symbol.toStringTag,{value:"Module"})),Jee=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,JNe={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function Qee(t){return t in JNe}const DA=[],o2=new Map;function Kee(t){for(const e of o2.keys())tge(t.pattern,e)&&o2.delete(e)}function QNe(t){return DA.includes(t)||(Kee(t),DA.unshift(t)),{remove(){const e=DA.indexOf(t);e>-1&&(DA.splice(e,1),Kee(t))}}}async function GX(t){const e=pp();o2.has(t)||o2.set(t,e4e(t,e));const r=o2.get(t);return r&&await t4e.add(r),r}function KNe(t){if(!Jee.test(t))return null;const e=Jee.exec(t);if(e===null)return null;const[,r,i]=e,s=r+(i?"-"+i.toUpperCase():"");return Qee(s)?s:Qee(r)?r:null}async function e4e(t,e){const r=[];for(const i of DA)if(tge(i.pattern,t))try{return await i.fetchMessageBundle(t,e)}catch(s){r.push(s)}throw r.length?new V("intl:message-bundle-error",`Errors occurred while loading "${t}"`,{errors:r}):new V("intl:no-message-bundle-loader",`No loader found for message bundle "${t}"`)}function tge(t,e){return typeof t=="string"?e.startsWith(t):t.test(e)}VX(()=>{o2.clear()});const t4e=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(t){return this._increase(),t.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=xo())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}};async function r4e(t){if(!t)return;const e=t.includes("-vector")?t.slice(0,t.indexOf("-vector")):t,r=await GX("esri/t9n/basemaps");return r[t]||r[e]}const tB={streets:{id:"streets",classic:!0,deprecated:!0,get thumbnailUrl(){return Gr("esri/images/basemap/streets.jpg")},baseMapLayers:[{id:"streets-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Street Map",showLegend:!1,visibility:!0,opacity:1}]},satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return Gr("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return Gr("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return Gr("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},topo:{id:"topo",classic:!0,deprecated:!0,get thumbnailUrl(){return Gr("esri/images/basemap/topo.jpg")},baseMapLayers:[{id:"topo-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Topo Map",showLegend:!1,visibility:!0,opacity:1}]},gray:{id:"gray",classic:!0,deprecated:!0,get thumbnailUrl(){return Gr("esri/images/basemap/gray.jpg")},baseMapLayers:[{id:"gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"dark-gray":{id:"dark-gray",classic:!0,deprecated:!0,get thumbnailUrl(){return Gr("esri/images/basemap/dark-gray.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"dark-gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return Gr("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"national-geographic":{id:"national-geographic",classic:!0,deprecated:!0,get thumbnailUrl(){return Gr("esri/images/basemap/national-geographic.jpg")},baseMapLayers:[{id:"national-geographic-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer",title:"NatGeo World Map",showLegend:!1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return Gr("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return Gr("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return Gr("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return Gr("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return Gr("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return Gr("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return Gr("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return Gr("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"arcgis-imagery":{get thumbnailUrl(){return Gr("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return Gr("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return Gr("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return Gr("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return Gr("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return Gr("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return Gr("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return Gr("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return Gr("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return Gr("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}};function RIt(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="feature"}function bO(t){const e=t?.type;return e==="base-tile"||e==="tile"||e==="elevation"||e==="imagery-tile"||e==="base-elevation"||e==="open-street-map"||e==="wcs"||e==="web-tile"||e==="wmts"||e==="vector-tile"}function B2(t){return t!=null&&"type"in t&&t.type==="group"}const MIt={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function rge(t){const e=t?.type;return e==="building-scene"||e==="integrated-mesh"||e==="point-cloud"||e==="scene"}function ete(t){return t?.type==="voxel"}function tte(t){return t?.type==="imagery-tile"}function ige(t){return t!=null&&t.parent!=null&&"declaredClass"in t.parent&&t.parent.declaredClass==="esri.Basemap"&&t.parent.baseLayers.includes(t)}function jX(t){return t?.type==="feature"&&!t.url&&t.source?.type==="memory"}function PIt(t){return t?.type==="feature"&&t.source?.type==="feature-layer"}function i4e(t){if(t.activeLayer){const e=t.activeLayer.tileMatrixSet;if(e)return e;const r=t.activeLayer.tileMatrixSets;if(r)return r}return null}async function sge(t,e){const r=Pi?.findServerInfo(t);if(r?.currentVersion!=null)return r.owningSystemUrl||null;const i=t.toLowerCase().indexOf("/rest/services");if(i===-1)return null;const s=`${t.substring(0,i)}/rest/info`,n=e!=null?e.signal:null,{data:o}=await hr(s,{query:{f:"json"},responseType:"json",signal:n});return o?.owningSystemUrl||null}function s4e(t){if(!("capabilities"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function n4e(t){return s4e(t)?"effectiveCapabilities"in t?t.effectiveCapabilities:t.capabilities:null}function o4e(t){if(!("editingEnabled"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}function a4e(t){return!!o4e(t)&&("effectiveEditingEnabled"in t?t.effectiveEditingEnabled:t.editingEnabled)}const l4e=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),c4e=new Set(["csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","map-image","map-notes","media","ogc-feature","route","stream","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function u4e(t){return t.layerContainerType==="basemap"?l4e:t.layerContainerType==="operational-layers"?c4e:null}function h4e(t,e){if(e.restrictedWebMapWriting){const r=u4e(e);return r==null||r.has(t.type)&&!jX(t)}return!0}function d4e(t,e){if(e)if(jX(t)){const r=wM("featureCollection.layers",e),i=r&&r[0]&&r[0].layerDefinition;i&&rte(t,i)}else t.type!=="group"&&rte(t,e)}function rte(t,e){"maxScale"in t&&(e.maxScale=i4(t.maxScale)??void 0),"minScale"in t&&(e.minScale=i4(t.minScale)??void 0)}function p4e(t,e){if(d4e(t,e),e&&("blendMode"in t&&(e.blendMode=t.blendMode,e.blendMode==="normal"&&delete e.blendMode),e.opacity=i4(t.opacity)??void 0,e.title=t.title||"Layer",e.visibility=t.visible,"legendEnabled"in t&&t.type!=="wmts"))if(jX(t)){const r=e.featureCollection;r&&(r.showLegend=t.legendEnabled)}else e.showLegend=t.legendEnabled}function ite(t,e,r){if(!("write"in t)||!t.write)return r&&r.messages&&r.messages.push(new V("layer:unsupported",`Layers (${t.title}, ${t.id}) of type '${t.declaredClass}' cannot be persisted`,{layer:t})),null;if(h4e(t,r)){const i={};return t.write(i,r)?i:null}return e!=null&&p4e(t,e=K(e)),e}var qL;let f4e=0;const nge="esri.Basemap";let Zu=qL=class extends GE(sy){constructor(t){super(t),this.id=null,this.portalItem=null,this.spatialReference=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+f4e++,this.baseLayers=new Pt,this.referenceLayers=new Pt;const e=i=>{i.parent&&i.parent!==this&&"remove"in i.parent&&i.parent.remove(i),i.parent=this,i.type==="elevation"&&Q.getLogger(this).error(`Layer '${i.title}, id:${i.id}' of type '${i.type}' is not supported as a basemap layer and will therefore be ignored.`)},r=i=>{i.parent=null};this.addHandles([this.baseLayers.on("after-add",i=>e(i.item)),this.referenceLayers.on("after-add",i=>e(i.item)),this.baseLayers.on("after-remove",i=>r(i.item)),this.referenceLayers.on("after-remove",i=>r(i.item))])}initialize(){this.when().catch(t=>{Q.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.baseLayers.removeAll();for(const r of t)r.destroy();const e=this.referenceLayers.removeAll();for(const r of e)r.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),this.portalItem?.destroy(),this.portalItem=null}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set baseLayers(t){this._set("baseLayers",gw(t,this._get("baseLayers")))}_writeBaseLayers(t,e,r){const i=[];t&&(r={...r,layerContainerType:"basemap"},this.baseLayers.forEach(s=>{const n=ite(s,r.webmap?r.webmap.getLayerJSONFromResourceInfo(s):null,r);n!=null&&i.push(n)}),this.referenceLayers.forEach(s=>{const n=ite(s,r.webmap?r.webmap.getLayerJSONFromResourceInfo(s):null,r);n!=null&&(s.type!=="scene"&&(n.isReference=!0),i.push(n))})),e.baseMapLayers=i}set referenceLayers(t){this._set("referenceLayers",gw(t,this._get("referenceLayers")))}writeTitle(t,e){e.title=t||"Basemap"}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return vme(this,t=>{t(this.baseLayers,this.referenceLayers)})}clone(){const t={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map(e=>GN(e)?e.clone():e),referenceLayers:this.referenceLayers.map(e=>GN(e)?e.clone():e)};return this.loaded&&(t.loadStatus="loaded"),new qL({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}write(t,e){return t=t||{},e&&e.origin||(e={origin:"web-map",...e}),super.write(t,e),!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(t.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(r=>{const i=K(r);return i.url&&nm(i.url)&&(i.url=`https:${i.url}`),i.templateUrl&&nm(i.templateUrl)&&(i.templateUrl=`https:${i.templateUrl}`),i})),t}async _loadFromSource(t){const{resourceInfo:e,portalItem:r}=this;Yt(t);const i=[];if(e){const s=e.context?e.context.url:null;if(i.push(this._loadLayersFromJSON(e.data,s,t)),e.data.id&&!e.data.title){const n=e.data.id;i.push(r4e(n).then(o=>{o&&this.read({title:o},e.context)}))}}else r&&i.push(this._loadFromItem(r,t));await Promise.all(i)}async _loadLayersFromJSON(t,e,r){const i=this.resourceInfo&&this.resourceInfo.context,s=this.portalItem&&this.portalItem.portal||i&&i.portal||null,n=g4e[i?.origin||""]??"web-map",{populateOperationalLayers:o}=await ce(()=>import("./layersCreator-14deabb8.js"),["./layersCreator-14deabb8.js","./lazyLayerLoader-1cc03bb8.js","./portalLayers-ce7e1338.js","./layersLoader-ca4cc2fe.js","./fetchService-f4a7481b.js","./jsonContext-cd374e12.js"],import.meta.url),a=[];if(Yt(r),t.baseMapLayers&&Array.isArray(t.baseMapLayers)){const l={context:{origin:n,url:e,portal:s,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},c=f=>n==="web-scene"&&f.layerType==="ArcGISSceneServiceLayer"||f.isReference,h=o(this.baseLayers,t.baseMapLayers.filter(f=>!c(f)),l);a.push(h);const p=o(this.referenceLayers,t.baseMapLayers.filter(c),l);a.push(p)}await bc(a)}async _loadFromItem(t,e){const r=await t.load(e),i=await r.fetchData("json",e),s=To(t.itemUrl??"");return this._set("resourceInfo",{data:i.baseMap??{},context:{origin:m4e[t.type||""]??"web-map",portal:t.portal||Js.getDefault(),url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:i.spatialReference},this.resourceInfo.context),this.read({title:t.title,thumbnailUrl:t.thumbnailUrl},{origin:"portal-item",portal:t.portal||Js.getDefault(),url:s}),this._loadLayersFromJSON(this.resourceInfo.data,s,e)}static fromId(t){const e=tB[t];if(!e)return null;if(e.deprecated){let r=null;t==="dark-gray"?r="dark-gray-vector":t==="gray"?r="gray-vector":t==="streets"?r="streets-vector":t==="topo"&&(r="topo-vector"),s4(Q.getLogger(nge),`The ${t} basemap has entered mature support and is no longer being updated.`,{replacement:r,see:"https://arcg.is/1iq8aD",warnOnce:!0})}return qL.fromJSON(e)}};u([d({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(t,e,r,i){this._writeBaseLayers(t,e,i)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:Pt}},writer(t,e,r,i){this._writeBaseLayers(t,e,i)}}}}}})],Zu.prototype,"baseLayers",null),u([d({type:String,json:{origins:{"web-scene":{write:!0}}}})],Zu.prototype,"id",void 0),u([d({type:Yb})],Zu.prototype,"portalItem",void 0),u([d()],Zu.prototype,"referenceLayers",null),u([d({readOnly:!0})],Zu.prototype,"resourceInfo",void 0),u([d({type:je})],Zu.prototype,"spatialReference",void 0),u([d()],Zu.prototype,"thumbnailUrl",void 0),u([d({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],Zu.prototype,"title",void 0),u([ke("title")],Zu.prototype,"writeTitle",null),Zu=qL=u([P(nge)],Zu);const m4e={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},g4e={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"},d4=Zu,y4e=Object.freeze(Object.defineProperty({__proto__:null,default:d4},Symbol.toStringTag,{value:"Module"})),p4={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function oge(t){return!!p4[t]||!!p4[t.toLowerCase()]}function HX(t){return p4[t]??p4[t.toLowerCase()]}function _4e(t){return[...HX(t)]}function S8(t,e,r){r<0&&++r,r>1&&--r;const i=6*r;return i<1?t+(e-t)*i:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}function age(t,e,r,i=1){const s=(t%360+360)%360/360,n=r<=.5?r*(e+1):r+e-r*e,o=2*r-n;return[Math.round(255*S8(o,n,s+1/3)),Math.round(255*S8(o,n,s)),Math.round(255*S8(o,n,s-1/3)),i]}function v4e(t){const e=t.length>5,r=e?8:4,i=(1<<r)-1,s=e?1:17,n=e?t.length===9:t.length===5;let o=+("0x"+t.substr(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return n&&(l=o&i,o>>=r,a[3]=s*l/255),l=o&i,o>>=r,a[2]=s*l,l=o&i,o>>=r,a[1]=s*l,l=o&i,o>>=r,a[0]=s*l,a}function O(){return[0,0,0]}function Fs(t){return[t[0],t[1],t[2]]}function Me(t,e,r){return[t,e,r]}function Wa(t){const e=O(),r=Math.min(3,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function qX(t,e){return new Float64Array(t,e,3)}function lge(){return O()}function cge(){return Me(1,1,1)}function uge(){return Me(1,0,0)}function hge(){return Me(0,1,0)}function WX(){return Me(0,0,1)}const Ka=lge(),kg=cge(),dge=uge(),pge=hge(),XX=WX();Object.freeze(Object.defineProperty({__proto__:null,ONES:kg,UNIT_X:dge,UNIT_Y:pge,UNIT_Z:XX,ZEROS:Ka,clone:Fs,create:O,createView:qX,fromArray:Wa,fromValues:Me,ones:cge,unitX:uge,unitY:hge,unitZ:WX,zeros:lge},Symbol.toStringTag,{value:"Module"}));let ZX=1e-6;function sl(){return ZX}function b4e(t){ZX=t}const EM=Math.random,w4e=Math.PI/180,x4e=180/Math.PI;function q5(t){return t*w4e}function T4e(t){return t*x4e}function S4e(t,e){return Math.abs(t-e)<=ZX*Math.max(1,Math.abs(t),Math.abs(e))}Object.freeze(Object.defineProperty({__proto__:null,RANDOM:EM,equals:S4e,getEpsilon:sl,setEpsilon:b4e,toDegree:T4e,toRadian:q5},Symbol.toStringTag,{value:"Module"}));function Oe(t){const e=t[0],r=t[1],i=t[2];return Math.sqrt(e*e+r*r+i*i)}function re(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function se(t,e,r,i){return t[0]=e,t[1]=r,t[2]=i,t}function ue(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function de(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function W5(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function f4(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function E4e(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function fge(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function m4(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t}function mge(t,e){return t[0]=Math.sign(e[0]),t[1]=Math.sign(e[1]),t[2]=Math.sign(e[2]),t}function YX(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function C4e(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function A4e(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function ie(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function Fb(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t}function fi(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2];return Math.sqrt(r*r+i*i+s*s)}function vo(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2];return r*r+i*i+s*s}function la(t){const e=t[0],r=t[1],i=t[2];return e*e+r*r+i*i}function pa(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function O4e(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function ye(t,e){const r=e[0],i=e[1],s=e[2];let n=r*r+i*i+s*s;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n),t}function fe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function ht(t,e,r){const i=e[0],s=e[1],n=e[2],o=r[0],a=r[1],l=r[2];return t[0]=s*l-n*a,t[1]=n*o-i*l,t[2]=i*a-s*o,t}function Hr(t,e,r,i){const s=e[0],n=e[1],o=e[2];return t[0]=s+i*(r[0]-s),t[1]=n+i*(r[1]-n),t[2]=o+i*(r[2]-o),t}function R4e(t,e,r,i,s,n){const o=n*n,a=o*(2*n-3)+1,l=o*(n-2)+n,c=o*(n-1),h=o*(3-2*n);return t[0]=e[0]*a+r[0]*l+i[0]*c+s[0]*h,t[1]=e[1]*a+r[1]*l+i[1]*c+s[1]*h,t[2]=e[2]*a+r[2]*l+i[2]*c+s[2]*h,t}function M4e(t,e,r,i,s,n){const o=1-n,a=o*o,l=n*n,c=a*o,h=3*n*a,p=3*l*o,f=l*n;return t[0]=e[0]*c+r[0]*h+i[0]*p+s[0]*f,t[1]=e[1]*c+r[1]*h+i[1]*p+s[1]*f,t[2]=e[2]*c+r[2]*h+i[2]*p+s[2]*f,t}function P4e(t,e){e=e||1;const r=EM,i=2*r()*Math.PI,s=2*r()-1,n=Math.sqrt(1-s*s)*e;return t[0]=Math.cos(i)*n,t[1]=Math.sin(i)*n,t[2]=s*e,t}function Fe(t,e,r){const i=e[0],s=e[1],n=e[2];return t[0]=r[0]*i+r[4]*s+r[8]*n+r[12],t[1]=r[1]*i+r[5]*s+r[9]*n+r[13],t[2]=r[2]*i+r[6]*s+r[10]*n+r[14],t}function wc(t,e,r){const i=e[0],s=e[1],n=e[2];return t[0]=i*r[0]+s*r[3]+n*r[6],t[1]=i*r[1]+s*r[4]+n*r[7],t[2]=i*r[2]+s*r[5]+n*r[8],t}function Oc(t,e,r){const i=r[0],s=r[1],n=r[2],o=r[3],a=e[0],l=e[1],c=e[2];let h=s*c-n*l,p=n*a-i*c,f=i*l-s*a,m=s*f-n*p,y=n*h-i*f,_=i*p-s*h;const v=2*o;return h*=v,p*=v,f*=v,m*=2,y*=2,_*=2,t[0]=a+h+m,t[1]=l+p+y,t[2]=c+f+_,t}function I4e(t,e,r,i){const s=[],n=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],n[0]=s[0],n[1]=s[1]*Math.cos(i)-s[2]*Math.sin(i),n[2]=s[1]*Math.sin(i)+s[2]*Math.cos(i),t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t}function $4e(t,e,r,i){const s=[],n=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],n[0]=s[2]*Math.sin(i)+s[0]*Math.cos(i),n[1]=s[1],n[2]=s[2]*Math.cos(i)-s[0]*Math.sin(i),t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t}function L4e(t,e,r,i){const s=[],n=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],n[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),n[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),n[2]=s[2],t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t}function gge(t,e){re(IP,t),re($P,e),ye(IP,IP),ye($P,$P);const r=fe(IP,$P);return r>1?0:r<-1?Math.PI:Math.acos(r)}const IP=O(),$P=O();function D4e(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function ha(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function X_(t,e){if(t===e)return!0;const r=t[0],i=t[1],s=t[2],n=e[0],o=e[1],a=e[2],l=sl();return Math.abs(r-n)<=l*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-o)<=l*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(s-a)<=l*Math.max(1,Math.abs(s),Math.abs(a))}function by(t,e,r){const i=r[0]-e[0],s=r[1]-e[1],n=r[2]-e[2];let o=i*i+s*s+n*n;return o>0?(o=1/Math.sqrt(o),t[0]=i*o,t[1]=s*o,t[2]=n*o,t):(t[0]=0,t[1]=0,t[2]=0,t)}const On=de,N4e=W5,F4e=f4,CM=fi,X5=vo,lc=Oe,rB=la,ste=Object.freeze(Object.defineProperty({__proto__:null,abs:m4,add:ue,angle:gge,bezier:M4e,ceil:E4e,copy:re,cross:ht,direction:by,dist:CM,distance:fi,div:F4e,divide:f4,dot:fe,equals:X_,exactEquals:ha,floor:fge,hermite:R4e,inverse:O4e,len:lc,length:Oe,lerp:Hr,max:C4e,min:YX,mul:N4e,multiply:W5,negate:pa,normalize:ye,random:P4e,rotateX:I4e,rotateY:$4e,rotateZ:L4e,round:A4e,scale:ie,scaleAndAdd:Fb,set:se,sign:mge,sqrDist:X5,sqrLen:rB,squaredDistance:vo,squaredLength:la,str:D4e,sub:On,subtract:de,transformMat3:wc,transformMat4:Fe,transformQuat:Oc},Symbol.toStringTag,{value:"Module"}));function Oh(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function xi(t,e,r,i,s){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t}function JX(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function yge(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function _ge(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function vge(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function U4e(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function k4e(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function z4e(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}function V4e(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}function B4e(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function Tw(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function G4e(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t}function bge(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2],n=e[3]-t[3];return Math.sqrt(r*r+i*i+s*s+n*n)}function g4(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2],n=e[3]-t[3];return r*r+i*i+s*s+n*n}function QX(t){const e=t[0],r=t[1],i=t[2],s=t[3];return Math.sqrt(e*e+r*r+i*i+s*s)}function KX(t){const e=t[0],r=t[1],i=t[2],s=t[3];return e*e+r*r+i*i+s*s}function j4e(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function H4e(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function wge(t,e){const r=e[0],i=e[1],s=e[2],n=e[3];let o=r*r+i*i+s*s+n*n;return o>0&&(o=1/Math.sqrt(o),t[0]=r*o,t[1]=i*o,t[2]=s*o,t[3]=n*o),t}function xge(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function Z5(t,e,r,i){const s=e[0],n=e[1],o=e[2],a=e[3];return t[0]=s+i*(r[0]-s),t[1]=n+i*(r[1]-n),t[2]=o+i*(r[2]-o),t[3]=a+i*(r[3]-a),t}function q4e(t,e){const r=EM;let i,s,n,o,a,l;e=e||1;do i=2*r()-1,s=2*r()-1,a=i*i+s*s;while(a>=1);do n=2*r()-1,o=2*r()-1,l=n*n+o*o;while(l>=1);const c=Math.sqrt((1-a)/l);return t[0]=e*i,t[1]=e*s,t[2]=e*n*c,t[3]=e*o*c,t}function mu(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3];return t[0]=r[0]*i+r[4]*s+r[8]*n+r[12]*o,t[1]=r[1]*i+r[5]*s+r[9]*n+r[13]*o,t[2]=r[2]*i+r[6]*s+r[10]*n+r[14]*o,t[3]=r[3]*i+r[7]*s+r[11]*n+r[15]*o,t}function W4e(t,e,r){const i=e[0],s=e[1],n=e[2],o=r[0],a=r[1],l=r[2],c=r[3],h=c*i+a*n-l*s,p=c*s+l*i-o*n,f=c*n+o*s-a*i,m=-o*i-a*s-l*n;return t[0]=h*c+m*-o+p*-l-f*-a,t[1]=p*c+m*-a+f*-o-h*-l,t[2]=f*c+m*-l+h*-a-p*-o,t[3]=e[3],t}function X4e(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function a2(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function y4(t,e){const r=t[0],i=t[1],s=t[2],n=t[3],o=e[0],a=e[1],l=e[2],c=e[3],h=sl();return Math.abs(r-o)<=h*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=h*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(s-l)<=h*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=h*Math.max(1,Math.abs(n),Math.abs(c))}const Z4e=yge,Y4e=_ge,J4e=vge,Q4e=bge,K4e=g4,eFe=QX,tFe=KX,Tge=Object.freeze(Object.defineProperty({__proto__:null,add:JX,ceil:U4e,copy:Oh,dist:Q4e,distance:bge,div:J4e,divide:vge,dot:xge,equals:y4,exactEquals:a2,floor:k4e,inverse:H4e,len:eFe,length:QX,lerp:Z5,max:V4e,min:z4e,mul:Y4e,multiply:_ge,negate:j4e,normalize:wge,random:q4e,round:B4e,scale:Tw,scaleAndAdd:G4e,set:xi,sqrDist:K4e,sqrLen:tFe,squaredDistance:g4,squaredLength:KX,str:X4e,sub:Z4e,subtract:yge,transformMat4:mu,transformQuat:W4e},Symbol.toStringTag,{value:"Module"})),nte=new Float32Array(1);function rFe(t){--t;for(let e=1;e<32;e<<=1)t|=t>>e;return t+1}function ve(t,e,r){return Math.min(Math.max(t,e),r)}function Sw(t){return(t&t-1)==0}function IIt(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function $It(t){return 10**Math.ceil(Math.LOG10E*Math.log(t))}function St(t,e,r){return t+(e-t)*r}function Ft(t){return t*Math.PI/180}function rl(t){return 180*t/Math.PI}function iB(t,e=1e-6){return(t<0?-1:1)/Math.max(Math.abs(t),e)}function In(t){return Math.acos(ve(t,-1,1))}function Fh(t){return Math.asin(ve(t,-1,1))}function l2(t,e,r=1e-6){return t===e?!0:!Number.isFinite(t)||!Number.isFinite(e)?!1:(t>e?t-e:e-t)<=r}const _4=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));function sB(t){return _4.setFloat64(0,t),_4.getBigInt64(0)}function iFe(t){return _4.setBigInt64(0,t),_4.getFloat64(0)}const WL=BigInt("1000000"),sFe=Sge(1);function Sge(t){const e=sB(t=Math.abs(t)),r=iFe(e<=WL?WL:e-WL);return Math.abs(t-r)}function LIt(t,e,r=sFe){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;if(r!=null&&Sge(Math.min(Math.abs(t),Math.abs(e)))<r)return Math.abs(t-e)<=r;const i=sB(t),s=sB(e);return i<0!=s<0?!1:!((i<s?s-i:i-s)>WL)}function nFe(t,e,r=1e-6){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;const i=Math.abs(t-e),s=Math.abs(t),n=Math.abs(e);if(t===0||e===0||s<1e-12&&n<1e-12){if(i>.01*r)return!1}else if(i/(s+n)>r)return!1;return!0}function oFe(t){return Ege(Math.max(-nB,Math.min(t,nB)))}function Ege(t){return nte[0]=t,nte[0]}function bR(t,e,r){const i=ve((r-t)/(e-t),0,1);return i*i*(3-2*i)}function ote(t,e){const r=Oe(t),i=Fh(t[2]/r),s=Math.atan2(t[1]/r,t[0]/r);return se(e,r,i,s),e}function DIt(t,e,r){return xi(t,e[0],e[1],e[2],e[3]*r)}function NIt(t){const e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[3]*t[3]+t[4]*t[4]+t[5]*t[5],i=t[6]*t[6]+t[7]*t[7]+t[8]*t[8];return!(l2(e,1)&&l2(r,1)&&l2(i,1))}const nB=Ege(34028234663852886e22);function LP(t){return ve(hX(t),0,255)}function DP(t,e,r){return t=Number(t),isNaN(t)?r:t<e?e:t>r?r:t}let XL=class Ko{static blendColors(e,r,i,s=new Ko){return s.r=Math.round(e.r+(r.r-e.r)*i),s.g=Math.round(e.g+(r.g-e.g)*i),s.b=Math.round(e.b+(r.b-e.b)*i),s.a=e.a+(r.a-e.a)*i,s._sanitize()}static fromRgb(e,r){const i=e.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(i){const s=i[2].split(/\s*,\s*/),n=i[1];if(n==="rgb"&&s.length===3||n==="rgba"&&s.length===4){const o=s[0];if(o.charAt(o.length-1)==="%"){const a=s.map(l=>2.56*parseFloat(l));return s.length===4&&(a[3]=parseFloat(s[3])),Ko.fromArray(a,r)}return Ko.fromArray(s.map(a=>parseFloat(a)),r)}if(n==="hsl"&&s.length===3||n==="hsla"&&s.length===4)return Ko.fromArray(age(parseFloat(s[0]),parseFloat(s[1])/100,parseFloat(s[2])/100,parseFloat(s[3])),r)}return null}static fromHex(e,r=new Ko){if(e.length!==4&&e.length!==7||e[0]!=="#")return null;const i=e.length===4?4:8,s=(1<<i)-1;let n=+("0x"+e.substr(1));return isNaN(n)?null:(["b","g","r"].forEach(o=>{const a=n&s;n>>=i,r[o]=i===4?17*a:a}),r.a=1,r)}static fromArray(e,r=new Ko){return r._set(Number(e[0]),Number(e[1]),Number(e[2]),Number(e[3])),isNaN(r.a)&&(r.a=1),r._sanitize()}static fromString(e,r){const i=oge(e)?HX(e):null;return i&&Ko.fromArray(i,r)||Ko.fromRgb(e,r)||Ko.fromHex(e,r)}static fromJSON(e){return e&&new Ko([e[0],e[1],e[2],e[3]/255])}static toUnitRGB(e){return e!=null?[e.r/255,e.g/255,e.b/255]:null}static toUnitRGBA(e){return e!=null?[e.r/255,e.g/255,e.b/255,e.a!=null?e.a:1]:null}constructor(e){this.r=255,this.g=255,this.b=255,this.a=1,e&&this.setColor(e)}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(e){return typeof e=="string"?Ko.fromString(e,this):Array.isArray(e)?Ko.fromArray(e,this):(this._set(e.r??0,e.g??0,e.b??0,e.a??1),e instanceof Ko||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(){const e=this.r.toString(16),r=this.g.toString(16),i=this.b.toString(16);return`#${e.length<2?"0"+e:e}${r.length<2?"0"+r:r}${i.length<2?"0"+i:i}`}toCss(e=!1){const r=this.r+", "+this.g+", "+this.b;return e?`rgba(${r}, ${this.a})`:`rgb(${r})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(e=Ko.AlphaMode.ALWAYS){const r=LP(this.r),i=LP(this.g),s=LP(this.b);return e===Ko.AlphaMode.ALWAYS||this.a!==1?[r,i,s,LP(255*this.a)]:[r,i,s]}clone(){return new Ko(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(e){return e!=null&&e.r===this.r&&e.g===this.g&&e.b===this.b&&e.a===this.a}_sanitize(){return this.r=Math.round(DP(this.r,0,255)),this.g=Math.round(DP(this.g,0,255)),this.b=Math.round(DP(this.b,0,255)),this.a=DP(this.a,0,1),this}_set(e,r,i,s){this.r=e,this.g=r,this.b=i,this.a=s}};XL.prototype.declaredClass="esri.Color",function(t){var e;(e=t.AlphaMode||(t.AlphaMode={}))[e.ALWAYS=0]="ALWAYS",e[e.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(XL||(XL={}));const Ne=XL;function FIt(t){}function aFe(t){return()=>t}function it(t,e={}){const r=t instanceof $r?t:new $r(t,e),i={type:e?.ignoreUnknown??1?r.apiValues:String,json:{type:r.jsonValues,read:!e?.readOnly&&{reader:r.read},write:{writer:r.write}}};return e?.readOnly!==void 0&&(i.readOnly=!!e.readOnly),e?.default!==void 0&&(i.json.default=e.default),e?.name!==void 0&&(i.json.name=e.name),e?.nonNullable!==void 0&&(i.nonNullable=e.nonNullable),d(i)}var oB;let ZL=oB=class extends le{constructor(t){super(t),this.type="none"}clone(){return new oB({type:this.type})}};u([it({none:"none",stayAbove:"stay-above"})],ZL.prototype,"type",void 0),ZL=oB=u([P("esri.ground.NavigationConstraint")],ZL);function Y5(t){const e=hX(100*(1-t));return Math.max(0,Math.min(e,100))}function G2(t){const e=1-t/100;return Math.max(0,Math.min(e,1))}var aB;let rg=aB=class extends GE(sy){constructor(t){super(t),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new Pt;const e=i=>{i.parent&&i.parent!==this&&"remove"in i.parent&&i.parent.remove(i),i.parent=this,i.type!=="elevation"&&i.type!=="base-elevation"&&Q.getLogger(this).error(`Layer '${i.title}, id:${i.id}' of type '${i.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},r=i=>{i.parent=null};this.addHandles([this.layers.on("after-add",i=>e(i.item)),this.layers.on("after-remove",i=>r(i.item))])}initialize(){this.when().catch(t=>{us(t)||Q.getLogger(this).error("#load()","Failed to load ground",t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.layers.removeAll();for(const e of t)e.destroy();this.layers.destroy()}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set layers(t){this._set("layers",gw(t,this._get("layers")))}writeLayers(t,e,r,i){const s=[];t&&(i={...i,layerContainerType:"ground"},t.forEach(n=>{if("write"in n){const o={};aFe(n)().write(o,i)&&s.push(o)}else i&&i.messages&&i.messages.push(new V("layer:unsupported",`Layers (${n.title}, ${n.id}) of type '${n.declaredClass}' cannot be persisted in the ground`,{layer:n}))})),e.layers=s}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return vme(this,t=>{t(this.layers)})}async queryElevation(t,e){await this.load({signal:e?.signal});const{ElevationQuery:r}=await ce(()=>import("./ElevationQuery-82a68817.js"),[],import.meta.url);Yt(e);const i=new r,s=this.layers.filter(ate).toArray();return i.queryAll(s,t,e)}async createElevationSampler(t,e){await this.load({signal:e?.signal});const{ElevationQuery:r}=await ce(()=>import("./ElevationQuery-82a68817.js"),[],import.meta.url);Yt(e);const i=new r,s=this.layers.filter(ate).toArray();return i.createSamplerAll(s,t,e)}clone(){const t={opacity:this.opacity,surfaceColor:K(this.surfaceColor),navigationConstraint:K(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(t.loadStatus="loaded"),new aB({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}_loadFromSource(t){const e=this.resourceInfo;return e?this._loadLayersFromJSON(e.data,e.context,t):Promise.resolve()}_loadLayersFromJSON(t,e,r){const i=e&&e.origin||"web-scene",s=e&&e.portal||null,n=e&&e.url||null;return ce(()=>import("./layersCreator-14deabb8.js"),["./layersCreator-14deabb8.js","./lazyLayerLoader-1cc03bb8.js","./portalLayers-ce7e1338.js","./layersLoader-ca4cc2fe.js","./fetchService-f4a7481b.js","./jsonContext-cd374e12.js"],import.meta.url).then(({populateOperationalLayers:o})=>{Yt(r);const a=[];if(t.layers&&Array.isArray(t.layers)){const l={context:{origin:i,url:n,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,t.layers,l))}return bc(a)}).then(()=>{})}};function lFe(t){return t&&"createElevationSampler"in t}function ate(t){return t.type==="elevation"||lFe(t)}u([d({json:{read:!1}})],rg.prototype,"layers",null),u([ke("layers")],rg.prototype,"writeLayers",null),u([d({readOnly:!0})],rg.prototype,"resourceInfo",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:Qi,read:{reader:G2,source:"transparency"},write:{writer:(t,e)=>{e.transparency=Y5(t)},target:"transparency"}}})],rg.prototype,"opacity",void 0),u([d({type:Ne,json:{type:[Qi],write:(t,e)=>{e.surfaceColor=t.toJSON().slice(0,3)}}})],rg.prototype,"surfaceColor",void 0),u([d({type:ZL,json:{write:!0}})],rg.prototype,"navigationConstraint",void 0),rg=aB=u([P("esri.Ground")],rg);const v4=rg;let NT=class extends Pt{constructor(e){super(e),this.getCollections=null}initialize(){this.own(Bfe(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const e=this.getCollections!=null?this.getCollections():null;if(e==null)return void this.removeAll();let r=0;for(const i of e)i!=null&&(r=this._processCollection(r,i));this.splice(r,this.length)}_createNewInstance(e){return new Pt(e)}_processCollection(e,r){if(!r)return e;const i=this.itemFilterFunction??(s=>!!s);for(const s of r)if(s){if(i(s)){const n=this.indexOf(s,e);n>=0?n!==e&&this.reorder(s,e):this.add(s,e),++e}if(this.getChildrenFunction){const n=this.getChildrenFunction(s);if(Array.isArray(n))for(const o of n)e=this._processCollection(e,o);else e=this._processCollection(e,n)}}return e}};u([d()],NT.prototype,"getCollections",void 0),u([d()],NT.prototype,"getChildrenFunction",void 0),u([d()],NT.prototype,"itemFilterFunction",void 0),NT=u([P("esri.core.CollectionFlattener")],NT);const wR=NT,cFe=[["binary","application/octet-stream","bin",""]];function uFe(t,e){return tZ(pFe(t,e))}function hFe(t,e){return tZ(fFe(t,e))}function kIt(t,e){return Cge(dFe(t,e))}function eZ(t){return[...cFe,...t]}function dFe(t,e){return eZ(e).find(r=>tZ(r)===t)}function pFe(t,e){return eZ(e).find(r=>Cge(r)===t)}function fFe(t,e){const r=t.toLowerCase();return eZ(e).find(i=>mFe(i).some(s=>r.endsWith(s)))}function tZ(t){return t?.[0]}function Cge(t){return t?.[1]}function mFe(t){return t?.[2].split(",")??[]}function zIt(t){return t.tables?.find(e=>e.role==="assetMaps")}function gFe(t){return!(!(t&&typeof t=="object"&&"loaded"in t&&t.loaded&&n4e(t)?.operations?.supportsEditing&&"type"in t)||"editingEnabled"in t&&!a4e(t)||t.type==="scene"&&!yFe(t))}function yFe(t){const e=t.infoFor3D;if(!e)return!0;const{supportedFormats:r,queryFormats:i}=e,s=uFe("model/gltf-binary",r)??hFe("glb",r);return s!=null&&i.includes(s)}const lte=Q.getLogger("esri.support.basemapUtils");function _Fe(){return{}}function vFe(t){for(const e in t){const r=t[e];r?.destroyed===!1&&r.destroy(),delete t[e]}}function bFe(t,e){let r;if(typeof t=="string"){if(!(t in tB)){const i=Object.entries(tB).filter(([s,n])=>Br.apiKey&&!n.classic||!Br.apiKey&&n.classic&&!n.deprecated).map(([s])=>`"${s}"`).join(", ");return lte.warn(`Unable to find basemap definition for: ${t}. Try one of these: ${i}`),null}e&&(r=e[t]),r||(r=d4.fromId(t),e&&(e[t]=r))}else r=vs(d4,t);return r?.destroyed&&(lte.warn("The provided basemap is already destroyed",{basemap:r}),r=null),r}function VIt(t,e){return t.basemap?.referenceLayers?.some(r=>r.uid===e)||t.basemap?.baseLayers?.some(r=>r.uid===e)}function wFe(t){return new wR({getCollections:()=>[t.tables,t.layers],getChildrenFunction:e=>{const r=[];return"tables"in e&&r.push(e.tables),"layers"in e&&r.push(e.layers),r},itemFilterFunction:e=>{const r=e.parent;return!!r&&"tables"in r&&r.tables.includes(e)}})}function E8(t){for(const e of t.values())e?.destroy();t.clear()}const cte={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function xFe(t){let e=null;if(typeof t=="string")if(t in cte){const r=cte[t];e=new v4({resourceInfo:{data:{layers:[r]}}})}else Q.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${t}. Try "world-elevation"`);else e=vs(v4,t);return e}function j2(t,e,r=!1){let{hasM:i,hasZ:s}=t;Array.isArray(e)?e.length!==4||i||s?e.length===3&&r&&!i?(s=!0,i=!1):e.length===3&&i&&s&&(i=!1,s=!1):(i=!0,s=!0):(s=!s&&e.hasZ&&(!i||e.hasM),i=!i&&e.hasM&&(!s||e.hasZ)),t.hasZ=s,t.hasM=i}var lB;function ute(t){return(e,r)=>e==null?r:r==null?e:t(e,r)}function TFe(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let E0=lB=class extends gv{constructor(...t){super(...t),this.points=[],this.type="multipoint"}normalizeCtorArgs(t,e){if(!t&&!e)return{};const r={};Array.isArray(t)?(r.points=t,r.spatialReference=e):TFe(t)?r.spatialReference=t:(t.points&&(r.points=t.points),t.spatialReference&&(r.spatialReference=t.spatialReference),t.hasZ&&(r.hasZ=t.hasZ),t.hasM&&(r.hasM=t.hasM));const i=r.points&&r.points[0];return i&&(r.hasZ===void 0&&r.hasM===void 0?(r.hasZ=i.length>2,r.hasM=!1):r.hasZ===void 0?r.hasZ=i.length>3:r.hasM===void 0&&(r.hasM=i.length>3)),r}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const t=this.points;if(!t.length)return null;const e=new ur,r=this.hasZ,i=this.hasM,s=r?3:2,n=t[0],o=ute(Math.min),a=ute(Math.max);let l,c,h,p,[f,m]=n,[y,_]=n;for(let v=0,b=t.length;v<b;v++){const T=t[v],[x,S]=T;if(f=o(f,x),m=o(m,S),y=a(y,x),_=a(_,S),r&&T.length>2){const E=T[2];l=o(l,E),h=a(h,E)}if(i&&T.length>s){const E=T[s];c=o(c,E),p=a(p,E)}}return e.xmin=f,e.ymin=m,e.xmax=y,e.ymax=_,e.spatialReference=this.spatialReference,r?(e.zmin=l,e.zmax=h):(e.zmin=void 0,e.zmax=void 0),i?(e.mmin=c,e.mmax=p):(e.mmin=void 0,e.mmax=void 0),e}writePoints(t,e){e.points=K(this.points)}addPoint(t){return j2(this,t),Array.isArray(t)?this.points.push(t):this.points.push(t.toArray()),this.notifyChange("points"),this}clone(){const t={points:K(this.points),spatialReference:this.spatialReference};return this.hasZ&&(t.hasZ=!0),this.hasM&&(t.hasM=!0),new lB(t)}getPoint(t){if(!this._validateInputs(t))return null;const e=this.points[t],r={x:e[0],y:e[1],spatialReference:this.spatialReference};let i=2;return this.hasZ&&(r.z=e[2],i=3),this.hasM&&(r.m=e[i]),new Ke(r)}removePoint(t){if(!this._validateInputs(t))return null;const e=new Ke(this.points.splice(t,1)[0],this.spatialReference);return this.notifyChange("points"),e}setPoint(t,e){return this._validateInputs(t)?(j2(this,e),Array.isArray(e)||(e=e.toArray()),this.points[t]=e,this.notifyChange("points"),this):this}toJSON(t){return this.write({},t)}_validateInputs(t){return t!=null&&t>=0&&t<this.points.length}};u([d({readOnly:!0})],E0.prototype,"cache",null),u([d()],E0.prototype,"extent",null),u([d({type:[[Number]],json:{write:{isRequired:!0}}})],E0.prototype,"points",void 0),u([ke("points")],E0.prototype,"writePoints",null),E0=lB=u([P("esri.geometry.Multipoint")],E0),E0.prototype.toJSON.isDefaultToJSON=!0;const AM=E0;function BIt(t){const e=[];for(t.reset();t.nextPath();){const r=[];for(;t.nextPoint();)r.push([t.x,t.y]);e.push(r)}return t.reset(),e}function SFe(t){const e=[];for(;t.nextPoint();)e.push([t.x,t.y]);return t.seekPathStart(),e}function J5(t,e){const r=e[0]-t[0],i=e[1]-t[1];if(t.length>2&&e.length>2){const s=t[2]-e[2];return Math.sqrt(r*r+i*i+s*s)}return Math.sqrt(r*r+i*i)}function Age(t,e,r){const i=t[0]+r*(e[0]-t[0]),s=t[1]+r*(e[1]-t[1]);return t.length>2&&e.length>2?[i,s,t[2]+r*(e[2]-t[2])]:[i,s]}function GIt(t,e,r,i){const[s,n]=e,[o,a]=r[i],[l,c]=r[i+1],h=l-o,p=c-a,f=h*h+p*p,m=(s-o)*h+(n-a)*p,y=Math.min(1,Math.max(0,m/f));return t[0]=o+h*y,t[1]=a+p*y,t}function jIt(t,e,r){let i,s,n,o,a=!1,l=1/0;for(r.reset();r.nextPath();)if(r.nextPoint())for(i=r.x,s=r.y;r.nextPoint();)n=r.x,o=r.y,s>e!=o>e&&t<(n-i)*(e-s)/(o-s)+i&&(a=!a),l=Math.min(l,EFe(t,e,i,s,n,o)),i=n,s=o;return l===0?0:(a?1:-1)*Math.sqrt(l)}function EFe(t,e,r,i,s,n){let o=r,a=i,l=s-o,c=n-a;if(l!==0||c!==0){const h=((t-o)*l+(e-a)*c)/(l*l+c*c);h>1?(o=s,a=n):h>0&&(o+=l*h,a+=c*h)}return l=t-o,c=e-a,l*l+c*c}function Oge(t,e){return Age(t,e,.5)}function Rge(t){const e=t.length;let r=0;for(let i=0;i<e-1;++i)r+=J5(t[i],t[i+1]);return r}function Mge(t,e){if(e<=0)return t[0];const r=t.length;let i=0;for(let s=0;s<r-1;++s){const n=J5(t[s],t[s+1]);if(e-i<n){const o=(e-i)/n;return Age(t[s],t[s+1],o)}i+=n}return t[r-1]}function Pge(t,e,r){const i=t.length;let s=0,n=0,o=0;for(let a=0;a<i;a++){const l=t[a],c=t[(a+1)%i];let h=2;s+=l[0]*c[1]-c[0]*l[1],l.length>2&&c.length>2&&r&&(n+=l[0]*c[2]-c[0]*l[2],h=3),l.length>h&&c.length>h&&e&&(o+=l[0]*c[h]-c[0]*l[h])}return s<=0&&n<=0&&o<=0}function CFe(t){const e=t.length;return e>2&&ry(t[0],t[e-1])}function HIt(t){if("rings"in t)for(const e of t.rings)CFe(e)||e.push(e[0].slice())}function qIt(t){if(!t||t.length<3)return 0;let e=0;const r=t.length-1;for(let i=0;i<r;i++)e+=(t[i][0]-t[i+1][0])*(t[i][1]+t[i+1][1]);return e+=(t[r][0]-t[0][0])*(t[r][1]+t[0][1]),-.5*e}function Ige(t){if(!t||t.numPoints<3)return 0;let e,r,i=0;if(t.seekPathStart(),!t.nextPoint())return 0;e=t.x,r=t.y;const s=e,n=r;for(;t.nextPoint();)i+=(e-t.x)*(r+t.y),e=t.x,r=t.y;return i+=(e-s)*(r+n),-.5*i}function WIt(t){return t?t.hasZ?[t.xmax-t.xmin/2,t.ymax-t.ymin/2,t.zmax-t.zmin/2]:[t.xmax-t.xmin/2,t.ymax-t.ymin/2]:null}function AFe(t){return t?$ge(t.rings,t.hasZ??!1):null}function $ge(t,e){if(!t||!t.length)return null;const r=[],i=[],s=e?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let n=0,o=t.length;n<o;n++){const a=Lge(t[n],e,s);a&&i.push(a)}if(i.sort((n,o)=>{let a=n[2]-o[2];return a===0&&e&&(a=n[4]-o[4]),a}),i.length&&(r[0]=i[0][0],r[1]=i[0][1],e&&(r[2]=i[0][3]),(r[0]<s[0]||r[0]>s[1]||r[1]<s[2]||r[1]>s[3]||e&&(r[2]<s[4]||r[2]>s[5]))&&(r.length=0)),!r.length){const n=t[0]&&t[0].length?OFe(t[0],e):null;if(!n)return null;r[0]=n[0],r[1]=n[1],e&&n.length>2&&(r[2]=n[2])}return r}function Lge(t,e,r){let i=0,s=0,n=0,o=0,a=0;const l=t.length?t[0][0]:0,c=t.length?t[0][1]:0,h=t.length&&e?t[0][2]:0;for(let f=0;f<t.length;f++){const m=t[f],y=t[(f+1)%t.length],[_,v,b]=m,T=_-l,x=v-c,[S,E,A]=y,R=S-l,M=E-c,D=T*M-R*x;if(o+=D,i+=(T+R)*D,s+=(x+M)*D,e&&m.length>2&&y.length>2){const k=b-h,$=A-h,N=T*$-R*k;n+=(k+$)*N,a+=N}_<r[0]&&(r[0]=_),_>r[1]&&(r[1]=_),v<r[2]&&(r[2]=v),v>r[3]&&(r[3]=v),e&&(b<r[4]&&(r[4]=b),b>r[5]&&(r[5]=b))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const p=[i/(6*o)+l,s/(6*o)+c,o];return e&&(r[4]===r[5]||a===0?(p[3]=(r[4]+r[5])/2,p[4]=0):(p[3]=n/(6*a)+h,p[4]=a)),p}function OFe(t,e){const r=e?[0,0,0]:[0,0],i=e?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;for(let l=0,c=t.length;l<c-1;l++){const h=t[l],p=t[l+1];if(h&&p){r[0]=h[0],r[1]=h[1],i[0]=p[0],i[1]=p[1],e&&h.length>2&&p.length>2&&(r[2]=h[2],i[2]=p[2]);const f=J5(r,i);if(f){s+=f;const m=Oge(h,p);n+=f*m[0],o+=f*m[1],e&&m.length>2&&(a+=f*m[2])}}}return s>0?e?[n/s,o/s,a/s]:[n/s,o/s]:t.length?t[0]:null}function RFe(t){const{hasZ:e,numPaths:r}=t;if(r===0)return null;const i=[],s=[],n=e?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(t.reset();t.nextPath();){const o=Lge(SFe(t),t.hasZ,n);o&&s.push(o)}if(s.sort((o,a)=>{let l=o[2]-a[2];return l===0&&e&&(l=o[4]-a[4]),l}),s.length&&(i[0]=s[0][0],i[1]=s[0][1],e&&(i[2]=s[0][3]),(i[0]<n[0]||i[0]>n[1]||i[1]<n[2]||i[1]>n[3]||e&&(i[2]<n[4]||i[2]>n[5]))&&(i.length=0)),!i.length){t.reset(),t.nextPath();const o=t.numPoints?MFe(t):null;if(!o)return null;i[0]=o[0],i[1]=o[1],e&&o.length>2&&(i[2]=o[2])}return i}function MFe(t){const{hasZ:e}=t,r=e?[0,0,0]:[0,0],i=e?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;if(t.nextPoint()){let l=t.x,c=t.y,h=t.z;for(;t.nextPoint();){const p=t.x,f=t.y,m=t.z;r[0]=l,r[1]=c,i[0]=p,i[1]=f,e&&(r[2]=h,i[2]=m);const y=J5(r,i);if(y){s+=y;const _=Oge(r,i);n+=y*_[0],o+=y*_[1],e&&_.length>2&&(a+=y*_[2])}l=p,c=f,h=m}}return s>0?e?[n/s,o/s,a/s]:[n/s,o/s]:t.numPoints?(t.seekPathStart(),t.nextPoint(),[t.x,t.y]):null}const PFe=1e-6;function XIt(t){let e=0;for(t.reset();t.nextPath();)e+=Ige(t);if(e<PFe){const s=RFe(t);return s?[s[0],s[1]]:null}const r=[0,0];if(t.reset(),!t.nextPath()||!t.nextPoint())return null;const i=[t.x,t.y];for(t.reset();t.nextPath();)$Fe(r,i,t);return r[0]*=1/e,r[1]*=1/e,r[0]+=i[0],r[1]+=i[1],r}const IFe=1/3;function $Fe(t,e,r){if(!t||!r||r.numPoints<3)return null;r.nextPoint();const i=r.x,s=r.y;r.nextPoint();let n,o=r.x-i,a=r.y-s,l=0,c=0;for(;r.nextPoint();)l=r.x-i,c=r.y-s,n=.5*IFe*(l*a-c*o),t[0]+=n*(o+l),t[1]+=n*(a+c),o=l,a=c;const h=Ige(r),p=[i,s];return p[0]-=e[0],p[1]-=e[1],p[0]*=h,p[1]*=h,t[0]+=p[0],t[1]+=p[1],t}function Vt(t=FFe){return[t[0],t[1],t[2],t[3]]}function ZIt(t){return[t[0],t[1],t[2],t[3]]}function oy(t,e){return t!==e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),t}function rZ(t,e,r,i,s=Vt()){return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function Dge(t,e=Vt()){return e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax,e}function Q5(t,e){return new ur({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}function c2(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function V_(t,e,r){if(e!=null)if("length"in e)hB(e)?(r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.max(t[2],e[2]),r[3]=Math.max(t[3],e[3])):e.length!==2&&e.length!==3||(r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.max(t[2],e[0]),r[3]=Math.max(t[3],e[1]));else switch(e.type){case"extent":r[0]=Math.min(t[0],e.xmin),r[1]=Math.min(t[1],e.ymin),r[2]=Math.max(t[2],e.xmax),r[3]=Math.max(t[3],e.ymax);break;case"point":r[0]=Math.min(t[0],e.x),r[1]=Math.min(t[1],e.y),r[2]=Math.max(t[2],e.x),r[3]=Math.max(t[3],e.y)}else oy(r,t)}function C8(t,e,r=t){const i=e.length;let s=t[0],n=t[1],o=t[2],a=t[3];for(let l=0;l<i;l++){const c=e[l];s=Math.min(s,c[0]),n=Math.min(n,c[1]),o=Math.max(o,c[0]),a=Math.max(a,c[1])}return r[0]=s,r[1]=n,r[2]=o,r[3]=a,r}function cB(t){for(let e=0;e<4;e++)if(!isFinite(t[e]))return!1;return!0}function pu(t){return t==null||t[0]>=t[2]?0:t[2]-t[0]}function wp(t){return t[1]>=t[3]?0:t[3]-t[1]}function Nge(t){return pu(t)*wp(t)}function iZ(t,e=[0,0]){return e[0]=(t[0]+t[2])/2,e[1]=(t[1]+t[3])/2,e}function Fge(t,e){return K5(t,e[0],e[1])}function hte(t,e){const r=e[3],i=.5*(t[0]+t[2]),s=Math.abs(e[0]-i),n=.5*(t[2]-t[0]);if(s>r+n)return!1;const o=.5*(t[1]+t[3]),a=.5*(t[3]-t[1]),l=Math.abs(e[1]-o);if(l>r+a)return!1;if(s<n||l<a)return!0;const c=s-n,h=l-a;return c*c+h*h<=r*r}function YIt(t,e,r){const i=t[0],s=t[1],n=t[2],o=t[3],{x:a,y:l}=e,{x:c,y:h}=r,p=(v,b)=>(h-l)*v+(a-c)*b+(c*l-a*h)<0,f=p(i,o),m=p(n,o),y=p(n,s),_=p(i,s);return!(f===m&&m===y&&y===_&&_===f||a<i&&c<i||a>n&&c>n||l>o&&h>o||l<s&&h<s)}function JIt(t,e){return K5(t,e.x,e.y)}function K5(t,e,r){return e>=t[0]&&r>=t[1]&&e<=t[2]&&r<=t[3]}function LFe(t,e,r){return e[0]>=t[0]-r&&e[1]>=t[1]-r&&e[0]<=t[2]+r&&e[1]<=t[3]+r}function OM(t,e){return Math.max(e[0],t[0])<=Math.min(e[2],t[2])&&Math.max(e[1],t[1])<=Math.min(e[3],t[3])}function dte(t,e){return e[0]>=t[0]&&e[2]<=t[2]&&e[1]>=t[1]&&e[3]<=t[3]}function uB(t,e,r){if(e==null)return oy(r,t);const i=e[0],s=e[1],n=e[2],o=e[3];return r[0]=ve(t[0],i,n),r[1]=ve(t[1],s,o),r[2]=ve(t[2],i,n),r[3]=ve(t[3],s,o),r}function DFe(t,e){const r=(t[0]+t[2])/2,i=(t[1]+t[3])/2,s=Math.max(Math.abs(e[0]-r)-pu(t)/2,0),n=Math.max(Math.abs(e[1]-i)-wp(t)/2,0);return Math.sqrt(s*s+n*n)}function b4(t,e,r,i=t){return i[0]=t[0]+e,i[1]=t[1]+r,i[2]=t[2]+e,i[3]=t[3]+r,i}function Ic(t){return t?oy(t,dB):Vt(dB)}function hB(t){return t!=null&&t.length===4}function NFe(t){return!(pu(t)!==0&&isFinite(t[0])||wp(t)!==0&&isFinite(t[1]))}function Jb(t,e){return hB(t)&&hB(e)?t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]:t===e}const QIt=[-1/0,-1/0,1/0,1/0],dB=[1/0,1/0,-1/0,-1/0],FFe=[0,0,0,0];function Uge(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function kge(t){return t.points!==void 0}function zge(t){return t.x!==void 0&&t.y!==void 0}function Vge(t){return t.paths!==void 0}function Bge(t){return t.rings!==void 0}function Gge(t){function e(r,i){return r==null?i:i==null?r:t(r,i)}return e}const E_=Gge(Math.min),C_=Gge(Math.max);function KIt(t,e){return Vge(e)?H2(t,e.paths,!1,!1):Bge(e)?H2(t,e.rings,!1,!1):kge(e)?sZ(t,e.points,!1,!1,!1,!1):Uge(e)?jge(t,e):(zge(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.x,t[3]=e.y),t)}function e$t(t){let e,r,i,s;for(t.reset(),e=i=1/0,r=s=-1/0;t.nextPath();){const n=UFe(t);e=Math.min(n[0],e),i=Math.min(n[1],i),r=Math.max(n[2],r),s=Math.max(n[3],s)}return Vt([e,i,r,s])}function UFe(t){let e,r,i,s;for(e=i=1/0,r=s=-1/0;t.nextPoint();)e=Math.min(t.x,e),i=Math.min(t.y,i),r=Math.max(t.x,r),s=Math.max(t.y,s);return Vt([e,i,r,s])}function t$t(t,e){return Vge(e)?H2(t,e.paths,!0,!1):Bge(e)?H2(t,e.rings,!0,!1):kge(e)?sZ(t,e.points,!0,!1,!0,!1):Uge(e)?jge(t,e,!0,!1,!0,!1):(zge(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.x,t[4]=e.y,t[5]=e.z),t)}function H2(t,e,r,i){const s=r?3:2;if(!e.length||!e[0].length)return null;let n,o,a,l,[c,h]=e[0][0],[p,f]=e[0][0];for(let m=0;m<e.length;m++){const y=e[m];for(let _=0;_<y.length;_++){const v=y[_],[b,T]=v;if(c=E_(c,b),h=E_(h,T),p=C_(p,b),f=C_(f,T),r&&v.length>2){const x=v[2];n=E_(n,x),o=C_(o,x)}if(i&&v.length>s){const x=v[s];a=E_(n,x),l=C_(o,x)}}}return r?i?(t[0]=c,t[1]=h,t[2]=n,t[3]=a,t[4]=p,t[5]=f,t[6]=o,t[7]=l,t.length=8,t):(t[0]=c,t[1]=h,t[2]=n,t[3]=p,t[4]=f,t[5]=o,t.length=6,t):i?(t[0]=c,t[1]=h,t[2]=a,t[3]=p,t[4]=f,t[5]=l,t.length=6,t):(t[0]=c,t[1]=h,t[2]=p,t[3]=f,t.length=4,t)}function jge(t,e,r,i,s,n){const o=e.xmin,a=e.xmax,l=e.ymin,c=e.ymax;let h=e.zmin,p=e.zmax,f=e.mmin,m=e.mmax;return s?(h=h||0,p=p||0,n?(f=f||0,m=m||0,t[0]=o,t[1]=l,t[2]=h,t[3]=f,t[4]=a,t[5]=c,t[6]=p,t[7]=m,t):(t[0]=o,t[1]=l,t[2]=h,t[3]=a,t[4]=c,t[5]=p,t)):n?(f=f||0,m=m||0,t[0]=o,t[1]=l,t[2]=f,t[3]=a,t[4]=c,t[5]=m,t):(t[0]=o,t[1]=l,t[2]=a,t[3]=c,t)}function sZ(t,e,r,i,s,n){const o=r?3:2,a=i&&n,l=r&&s;if(!e.length||!e[0].length)return null;let c,h,p,f,[m,y]=e[0],[_,v]=e[0];for(let b=0;b<e.length;b++){const T=e[b],[x,S]=T;if(m=E_(m,x),y=E_(y,S),_=C_(_,x),v=C_(v,S),l&&T.length>2){const E=T[2];c=E_(c,E),h=C_(h,E)}if(a&&T.length>o){const E=T[o];p=E_(c,E),f=C_(h,E)}}return s?(c=c||0,h=h||0,n?(p=p||0,f=f||0,t[0]=m,t[1]=y,t[2]=c,t[3]=p,t[4]=_,t[5]=v,t[6]=h,t[7]=f,t):(t[0]=m,t[1]=y,t[2]=c,t[3]=_,t[4]=v,t[5]=h,t)):n?(p=p||0,f=f||0,t[0]=m,t[1]=y,t[2]=p,t[3]=_,t[4]=v,t[5]=f,t):(t[0]=m,t[1]=y,t[2]=_,t[3]=v,t)}function kFe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function zFe(t){return t.points!==void 0}function VFe(t){return t.x!==void 0&&t.y!==void 0}function BFe(t){return t.paths!==void 0}function GFe(t){return t.rings!==void 0}const nZ=[];function Hge(t,e,r,i){return{xmin:t,ymin:e,xmax:r,ymax:i}}function qge(t,e,r,i,s,n){return{xmin:t,ymin:e,zmin:r,xmax:i,ymax:s,zmax:n}}function Wge(t,e,r,i,s,n){return{xmin:t,ymin:e,mmin:r,xmax:i,ymax:s,mmax:n}}function Xge(t,e,r,i,s,n,o,a){return{xmin:t,ymin:e,zmin:r,mmin:i,xmax:s,ymax:n,zmax:o,mmax:a}}function oZ(t,e=!1,r=!1){return e?r?Xge(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]):qge(t[0],t[1],t[2],t[3],t[4],t[5]):r?Wge(t[0],t[1],t[2],t[3],t[4],t[5]):Hge(t[0],t[1],t[2],t[3])}function r$t(t){return t?kFe(t)?t:VFe(t)?HFe(t):GFe(t)?Zge(t):BFe(t)?Yge(t):zFe(t)?jFe(t):null:null}function jFe(t){const{hasZ:e,hasM:r,points:i}=t;return oZ(sZ(nZ,i,e??!1,r??!1),e,r)}function HFe(t){const{x:e,y:r,z:i,m:s}=t,n=s!=null;return i!=null?n?Xge(e,r,i,s,e,r,i,s):qge(e,r,i,e,r,i):n?Wge(e,r,s,e,r,s):Hge(e,r,e,r)}function Zge(t){const{hasZ:e,hasM:r,rings:i}=t,s=H2(nZ,i,e??!1,r??!1);return s?oZ(s,e,r):null}function Yge(t){const{hasZ:e,hasM:r,paths:i}=t,s=H2(nZ,i,e??!1,r??!1);return s?oZ(s,e,r):null}var YL;function pte(t){return!Array.isArray(t[0])}let sf=YL=class extends gv{static fromExtent(t){const e=t.clone().normalize(),r=t.spatialReference;let i=!1,s=!1;for(const o of e)o.hasZ&&(i=!0),o.hasM&&(s=!0);const n={rings:e.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(i&&o.hasZ){const l=o.zmin+.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(s&&o.hasM){const l=o.mmin+.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a}),spatialReference:r};return i&&(n.hasZ=!0),s&&(n.hasM=!0),new YL(n)}constructor(...t){super(...t),this.rings=[],this.type="polygon"}normalizeCtorArgs(t,e){let r,i,s=null,n=null;return t&&!Array.isArray(t)?(s=t.rings??null,e||(t.spatialReference?e=t.spatialReference:t.rings||(e=t)),r=t.hasZ,i=t.hasM):s=t,s=s||[],e=e||je.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(r===void 0&&i===void 0?(r=n.length>2,i=n.length>3):r===void 0?r=i?n.length>3:n.length>2:i===void 0&&(i=r?n.length>3:n.length>2)),{rings:s,spatialReference:e,hasZ:r,hasM:i}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const t=AFe(this);if(!t||isNaN(t[0])||isNaN(t[1])||this.hasZ&&isNaN(t[2]))return null;const e=new Ke;return e.x=t[0],e.y=t[1],e.spatialReference=this.spatialReference,this.hasZ&&(e.z=t[2]),e}get extent(){const{spatialReference:t}=this,e=Zge(this);if(!e)return null;const r=new ur(e);return r.spatialReference=t,r}get isSelfIntersecting(){return LNe(this.rings)}writeRings(t,e){e.rings=K(this.rings)}addRing(t){if(!t)return;const e=this.rings,r=e.length;if(pte(t)){const i=[];for(let s=0,n=t.length;s<n;s++)i[s]=t[s].toArray();e[r]=i}else e[r]=t.concat();return this.notifyChange("rings"),this}clone(){const t=new YL;return t.spatialReference=this.spatialReference,t.rings=K(this.rings),t.hasZ=this.hasZ,t.hasM=this.hasM,t}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,r=t.spatialReference;if(e!=null!=(r!=null)||e!=null&&r!=null&&!e.equals(r)||this.rings.length!==t.rings.length)return!1;const i=([s,n,o,a],[l,c,h,p])=>s===l&&n===c&&(o==null&&h==null||o===h)&&(a==null&&p==null||a===p);for(let s=0;s<this.rings.length;s++){const n=this.rings[s],o=t.rings[s];if(!ry(n,o,i))return!1}return!0}contains(t){if(!t)return!1;const e=rx(t,this.spatialReference);return SNe(this,e??t)}isClockwise(t){let e;return e=pte(t)?t.map(r=>this.hasZ?this.hasM?[r.x,r.y,r.z,r.m]:[r.x,r.y,r.z]:[r.x,r.y]):t,Pge(e,this.hasM,this.hasZ)}getPoint(t,e){if(!this._validateInputs(t,e))return null;const r=this.rings[t][e],i=this.hasZ,s=this.hasM;return i&&!s?new Ke(r[0],r[1],r[2],void 0,this.spatialReference):s&&!i?new Ke(r[0],r[1],void 0,r[2],this.spatialReference):i&&s?new Ke(r[0],r[1],r[2],r[3],this.spatialReference):new Ke(r[0],r[1],this.spatialReference)}insertPoint(t,e,r){return this._validateInputs(t,e,!0)?(j2(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[t].splice(e,0,r),this.notifyChange("rings"),this):this}removePoint(t,e){if(!this._validateInputs(t,e))return null;const r=new Ke(this.rings[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("rings"),r}removeRing(t){if(!this._validateInputs(t,null))return null;const e=this.rings.splice(t,1)[0],r=this.spatialReference,i=e.map(s=>new Ke(s,r));return this.notifyChange("rings"),i}setPoint(t,e,r){return this._validateInputs(t,e)?(j2(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[t][e]=r,this.notifyChange("rings"),this):this}_validateInputs(t,e,r=!1){if(t==null||t<0||t>=this.rings.length)return!1;if(e!=null){const i=this.rings[t];if(r&&(e<0||e>i.length)||!r&&(e<0||e>=i.length))return!1}return!0}toJSON(t){return this.write({},t)}};u([d({readOnly:!0})],sf.prototype,"cache",null),u([d({readOnly:!0})],sf.prototype,"centroid",null),u([d({readOnly:!0})],sf.prototype,"extent",null),u([d({readOnly:!0})],sf.prototype,"isSelfIntersecting",null),u([d({type:[[[Number]]],json:{write:{isRequired:!0}}})],sf.prototype,"rings",void 0),u([ke("rings")],sf.prototype,"writeRings",null),sf=YL=u([P("esri.geometry.Polygon")],sf),sf.prototype.toJSON.isDefaultToJSON=!0;const yu=sf;var pB;function qFe(t){return!Array.isArray(t[0])}let C0=pB=class extends gv{constructor(...t){super(...t),this.paths=[],this.type="polyline"}normalizeCtorArgs(t,e){let r,i,s=null,n=null;return t&&!Array.isArray(t)?(s=t.paths??null,e||(t.spatialReference?e=t.spatialReference:t.paths||(e=t)),r=t.hasZ,i=t.hasM):s=t,s=s||[],e=e||je.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(r===void 0&&i===void 0?(r=n.length>2,i=!1):r===void 0?r=!i&&n.length>3:i===void 0&&(i=!r&&n.length>3)),{paths:s,spatialReference:e,hasZ:r,hasM:i}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:t}=this,e=Yge(this);if(!e)return null;const r=new ur(e);return r.spatialReference=t,r}writePaths(t,e){e.paths=K(this.paths)}addPath(t){if(!t)return;const e=this.paths,r=e.length;if(qFe(t)){const i=[];for(let s=0,n=t.length;s<n;s++)i[s]=t[s].toArray();e[r]=i}else e[r]=t.concat();return this.notifyChange("paths"),this}clone(){const t=new pB;return t.spatialReference=this.spatialReference,t.paths=K(this.paths),t.hasZ=this.hasZ,t.hasM=this.hasM,t}getPoint(t,e){if(!this._validateInputs(t,e))return null;const r=this.paths[t][e],i=this.hasZ,s=this.hasM;return i&&!s?new Ke(r[0],r[1],r[2],void 0,this.spatialReference):s&&!i?new Ke(r[0],r[1],void 0,r[2],this.spatialReference):i&&s?new Ke(r[0],r[1],r[2],r[3],this.spatialReference):new Ke(r[0],r[1],this.spatialReference)}insertPoint(t,e,r){return this._validateInputs(t,e,!0)?(j2(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[t].splice(e,0,r),this.notifyChange("paths"),this):this}removePath(t){if(!this._validateInputs(t,null))return null;const e=this.paths.splice(t,1)[0],r=this.spatialReference,i=e.map(s=>new Ke(s,r));return this.notifyChange("paths"),i}removePoint(t,e){if(!this._validateInputs(t,e))return null;const r=new Ke(this.paths[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("paths"),r}setPoint(t,e,r){return this._validateInputs(t,e)?(j2(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[t][e]=r,this.notifyChange("paths"),this):this}_validateInputs(t,e,r=!1){if(t==null||t<0||t>=this.paths.length)return!1;if(e!=null){const i=this.paths[t];if(r&&(e<0||e>i.length)||!r&&(e<0||e>=i.length))return!1}return!0}toJSON(t){return this.write({},t)}};u([d({readOnly:!0})],C0.prototype,"cache",null),u([d({readOnly:!0})],C0.prototype,"extent",null),u([d({type:[[[Number]]],json:{write:{isRequired:!0}}})],C0.prototype,"paths",void 0),u([ke("paths")],C0.prototype,"writePaths",null),C0=pB=u([P("esri.geometry.Polyline")],C0),C0.prototype.toJSON.isDefaultToJSON=!0;const e6=C0,Jge=il()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),fte=il()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function Qge(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function aZ(t){return t.points!==void 0}function lZ(t){return t.x!==void 0&&t.y!==void 0}function cZ(t){return t.paths!==void 0}function u2(t){return t.rings!==void 0}function Z_(t){return t==null?null:t instanceof gv?t:lZ(t)?Ke.fromJSON(t):cZ(t)?e6.fromJSON(t):u2(t)?yu.fromJSON(t):aZ(t)?AM.fromJSON(t):Qge(t)?ur.fromJSON(t):null}function uZ(t){return t?lZ(t)?"esriGeometryPoint":cZ(t)?"esriGeometryPolyline":u2(t)?"esriGeometryPolygon":Qge(t)?"esriGeometryEnvelope":aZ(t)?"esriGeometryMultipoint":null:null}const WFe={esriGeometryPoint:Ke,esriGeometryPolyline:e6,esriGeometryPolygon:yu,esriGeometryEnvelope:ur,esriGeometryMultipoint:AM};function XFe(t){return t&&WFe[t]||null}const ix={base:gv,key:"type",typeMap:{extent:ur,multipoint:AM,point:Ke,polyline:e6,polygon:yu}};bp(ix);let Kge=0;const t6=t=>{let e=class extends t{constructor(...r){super(...r),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+Kge++})}};return e=u([P("esri.core.Identifiable")],e),e},i$t=t=>{let e=class extends t{constructor(...r){super(...r),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Kge++})}};return e=u([P("esri.core.NumericIdentifiable")],e),e};let mte=class extends t6(class{}){};mte=u([P("esri.core.Identifiable")],mte);async function ZFe(t){const e="portalItem"in t?t:{portalItem:t},{fromItem:r}=await ce(()=>import("./portalLayers-ce7e1338.js"),["./portalLayers-ce7e1338.js","./lazyLayerLoader-1cc03bb8.js","./layersLoader-ca4cc2fe.js","./fetchService-f4a7481b.js","./jsonContext-cd374e12.js"],import.meta.url);try{return await r(e)}catch(i){const s=e&&e.portalItem,n=s&&s.id||"unset",o=s&&s.portal&&s.portal.url||Br.portalUrl;throw Q.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+o+"', id: '"+n+"')",i),i}}let YFe=0,ao=class extends ws.EventedMixin(t6(sy)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new ur(-180,-90,180,90,je.WGS84),this.id=Date.now().toString(16)+"-layer-"+YFe++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=je.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static async fromArcGISServerUrl(e){const r=typeof e=="string"?{url:e}:e;return(await ce(()=>import("./arcgisLayers-dd299013.js"),["./arcgisLayers-dd299013.js","./fetchService-f4a7481b.js","./lazyLayerLoader-1cc03bb8.js"],import.meta.url)).fromUrl(r)}static fromPortalItem(e){return ZFe(e)}initialize(){this.when().catch(e=>{us(e)||Q.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})})}destroy(){if(this.parent){const e=this,r=this.parent;"layers"in r&&r.layers.includes(e)?r.layers.remove(e):"tables"in r&&r.tables.includes(e)?r.tables.remove(e):"baseLayers"in r&&r.baseLayers.includes(e)?r.baseLayers.remove(e):"baseLayers"in r&&r.referenceLayers.includes(e)&&r.referenceLayers.remove(e)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){return To(this.url)}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await hr(e,{query:{f:"json"},responseType:"json"})).data;throw new V("layer:no-attribution-data","Layer does not have attribution data")}};u([d({type:String})],ao.prototype,"attributionDataUrl",void 0),u([d({type:ur})],ao.prototype,"fullExtent",void 0),u([d({readOnly:!0})],ao.prototype,"hasAttributionData",null),u([d({type:String,clonable:!1})],ao.prototype,"id",void 0),u([d({type:Boolean,nonNullable:!0})],ao.prototype,"legendEnabled",void 0),u([d({type:["show","hide","hide-children"]})],ao.prototype,"listMode",void 0),u([d({type:Number,range:{min:0,max:1},nonNullable:!0})],ao.prototype,"opacity",void 0),u([d({clonable:!1})],ao.prototype,"parent",void 0),u([d({readOnly:!0})],ao.prototype,"parsedUrl",null),u([d({type:Boolean})],ao.prototype,"popupEnabled",void 0),u([d({type:Boolean})],ao.prototype,"attributionVisible",void 0),u([d({type:je})],ao.prototype,"spatialReference",void 0),u([d({type:String})],ao.prototype,"title",void 0),u([d({readOnly:!0,json:{read:!1}})],ao.prototype,"type",void 0),u([d()],ao.prototype,"url",void 0),u([d({type:Boolean,nonNullable:!0})],ao.prototype,"visible",void 0),ao=u([P("esri.layers.Layer")],ao);const hZ=ao;function fB(t,e,r){let i,s;if(t)for(let n=0,o=t.length;n<o;n++){if(i=t.at(n),i?.[e]===r)return i;if(i?.type==="group"&&(s=fB(i.layers,e,r),s))return s}}const JFe=t=>{let e=class extends t{constructor(...r){super(...r),this.layers=new Pt;const i=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},s=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||Q.getLogger(this).error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},n=o=>{o.parent=null,this.layerRemoved(o)};this.addHandles([this.layers.on("before-add",o=>i(o.item)),this.layers.on("after-add",o=>s(o.item)),this.layers.on("after-remove",o=>n(o.item))])}destroy(){const r=this.layers.toArray();for(const i of r)i.destroy();this.layers.destroy()}set layers(r){this._set("layers",gw(r,this._get("layers")))}add(r,i){const s=this.layers;if(i=s.getNextIndex(i),r instanceof hZ){const n=r;n.parent===this?this.reorder(n,i):s.add(n,i)}else Iu(r)?r.then(n=>{this.destroyed||this.add(n,i)}):Q.getLogger(this).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(r,i){const s=this.layers;let n=s.getNextIndex(i);r.slice().forEach(o=>{o.parent!==this?(s.add(o,n),n+=1):this.reorder(o,n)})}findLayerById(r){return fB(this.layers,"id",r)}findLayerByUid(r){return fB(this.layers,"uid",r)}remove(r){return this.layers.remove(r)}removeMany(r){return this.layers.removeMany(r)}removeAll(){return this.layers.removeAll()}reorder(r,i){return this.layers.reorder(r,i)}layerAdded(r){}layerRemoved(r){}};return u([d()],e.prototype,"layers",null),e=u([P("esri.support.LayersMixin")],e),e};function mB(t,e,r){if(t)for(let i=0,s=t.length;i<s;i++){const n=t.at(i);if(n[e]===r)return n;if(n?.type==="group"){const o=mB(n.tables,e,r);if(o)return o}}}const QFe=t=>{let e=class extends t{constructor(...r){super(...r),this.tables=new Pt,this.addHandles([this.tables.on("after-add",i=>{const s=i.item;s.parent&&s.parent!==this&&"tables"in s.parent&&s.parent.tables.remove(s),s.parent=this,s.type!=="feature"&&Q.getLogger(this).error(`Layer 'title:${s.title}, id:${s.id}' of type '${s.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",i=>{i.item.parent=null})])}destroy(){const r=this.tables.removeAll();for(const i of r)i.destroy();this.tables.destroy()}set tables(r){this._set("tables",gw(r,this._get("tables")))}findTableById(r){return mB(this.tables,"id",r)}findTableByUid(r){return mB(this.tables,"uid",r)}};return u([d()],e.prototype,"tables",null),e=u([P("esri.support.TablesMixin")],e),e};let nf=class extends QFe(JFe(ws.EventedMixin(we))){constructor(e){super(e),this.allLayers=new wR({getCollections:()=>[this.basemap?.baseLayers,this.ground?.layers,this.layers,this.basemap?.referenceLayers],getChildrenFunction:r=>"layers"in r?r.layers:null}),this.allTables=wFe(this),this.basemap=null,this.editableLayers=new wR({getCollections:()=>[this.allLayers],itemFilterFunction:gFe}),this.ground=new v4,this._basemapCache=_Fe()}destroy(){this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.ground?.destroy(),this.basemap?.destroy(),vFe(this._basemapCache),this._basemapCache=null}castBasemap(e){return bFe(e,this._basemapCache)}castGround(e){return xFe(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(r=>r.id===e)}findTableById(e){return this.allTables.find(r=>r.id===e)}};u([d({readOnly:!0,dependsOn:[]})],nf.prototype,"allLayers",void 0),u([d({readOnly:!0})],nf.prototype,"allTables",void 0),u([d({type:d4})],nf.prototype,"basemap",void 0),u([wr("basemap")],nf.prototype,"castBasemap",null),u([d({readOnly:!0})],nf.prototype,"editableLayers",void 0),u([d({type:v4,nonNullable:!0})],nf.prototype,"ground",void 0),u([wr("ground")],nf.prototype,"castGround",null),nf=u([P("esri.Map")],nf);const eye=nf;function ae(t,e,r={}){return dZ(t,e,r,tye)}function Cu(t,e,r={}){return dZ(t,e,r,rye)}function dZ(t,e,r={},i){let s=null;const n=r.once?(o,a)=>{i(o)&&(Ni(s),e(o,a))}:(o,a)=>{i(o)&&e(o,a)};if(s=H$e(t,n,r.sync,r.equals),r.initial){const o=t();n(o,o)}return s}function fa(t,e,r,i={}){let s=null,n=null,o=null;function a(){s&&n&&(n.remove(),i.onListenerRemove?.(s),s=null,n=null)}function l(h){i.once&&i.once&&Ni(o),r(h)}const c=ae(t,(h,p)=>{a(),F5(h)&&(s=h,n=TM(h,e,l),i.onListenerAdd?.(h))},{sync:i.sync,initial:!0});return o=el(()=>{c.remove(),a()}),o}function ay(t,e){return KFe(t,rye,e)}function KFe(t,e,r){if(An(r))return Promise.reject(kr());const i=t();if(e?.(i))return Promise.resolve(i);let s=null;function n(){s=Ni(s)}return new Promise((o,a)=>{s=N2([da(r,()=>{n(),a(kr())}),dZ(t,l=>{n(),o(l)},{sync:!1,once:!0},e??tye)])})}function tye(t){return!0}function rye(t){return!!t}const qr={sync:!0},Pr={initial:!0},Is={sync:!0,initial:!0},ji=t=>{let e=class extends t{clone(){const r=hc(ma(this),"unable to clone instance of non-accessor class"),i=r.metadatas,s=r.store,n={},o=new Map;for(const l in i){const c=i[l],h=s?.originOf(l),p=c.clonable;if(c.readOnly||p===!1||h!==mr.USER&&h!==mr.DEFAULTS&&h!==mr.WEB_MAP&&h!==mr.WEB_SCENE)continue;const f=this[l];let m=null;m=typeof p=="function"?p(f):p==="reference"?f:EV(f),f!=null&&m==null||(h===mr.DEFAULTS?o.set(l,m):n[l]=m)}const a=new(Object.getPrototypeOf(this)).constructor(n);if(o.size){const l=ma(a)?.store;if(l)for(const[c,h]of o)l.set(c,h,mr.DEFAULTS)}return a}};return e=u([P("esri.core.Clonable")],e),e};let gte=class extends ji(we){};gte=u([P("esri.core.Clonable")],gte);var q2;function e5e(t,e){switch(t.type){case"range":{const r="range"in t?t.range[0]:t.minValue,i="range"in t?t.range[1]:t.maxValue;if(r!=null&&+e<r||i!=null&&+e>i)return q2.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(t.codedValues==null||t.codedValues.every(r=>r==null||r.code!==e))return q2.INVALID_CODED_VALUE}return null}(function(t){t.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",t.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(q2||(q2={}));const t5e=Q.getLogger("esri.support.arcadeOnDemand");let A8;function Y_(){return A8||(A8=(async()=>{const t=await ce(()=>import("./arcadeUtils-cbdaad7d.js").then(e=>e.az),["./arcadeUtils-cbdaad7d.js","./arcadeTimeUtils-03a03f3e.js","./executionError-e8d36121.js","./number-deec457a.js","./hash-6f442295.js"],import.meta.url);return{arcade:t.arcade,arcadeUtils:t,Dictionary:t.Dictionary,Feature:t.arcadeFeature}})()),A8}const r5e=(t,e,r)=>pZ.create(t,e,r,null,["$feature"],[]),i5e=(t,e,r)=>pZ.create(t,e,r,null,["$feature","$view"],[]),s5e=(t,e,r,i)=>pZ.create(t,e,r,i,["$feature","$view"],[]);let pZ=class iye{constructor(e,r,i,s,n,o,a){this.services=null,this.script=e,this.evaluate=s;const l=Array.isArray(o)?o:o.fields;this.fields=l,this._syntaxTree=i,this._arcade=r,this._arcadeFeature=n,this._spatialReference=a,this._referencesGeometry=r.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(e,r,i,s,n,o){const{arcade:a,Feature:l,Dictionary:c}=await Y_(),h=je.fromJSON(r);let p;try{p=a.parseScript(e,o)}catch(M){return t5e.error(new V("arcade-bad-expression","Failed to parse arcade script",{script:e,error:M})),null}const f=n.reduce((M,D)=>({...M,[D]:null}),{});let m=null;s!=null&&(m=new c(s),m.immutable=!0,f.$config=null);const y=a.scriptUsesGeometryEngine(p),_=y&&a.enableGeometrySupport(),v=a.scriptUsesFeatureSet(p)&&a.enableFeatureSetSupport(),b=a.scriptIsAsync(p),T=b&&a.enableAsyncSupport(),x={vars:f,spatialReference:h,useAsync:!!T};await Promise.all([_,v,T]);const S=new Set;await a.loadDependentModules(S,p,null,b,y);const E=new c;E.immutable=!1,E.setField("scale",0);const A=a.compileScript(p,x),R=(M,D)=>("$view"in M&&M.$view&&(E.setField("scale",typeof M.$view=="object"&&"scale"in M.$view?M.$view.scale:void 0),M.$view=E),m&&(M.$config=m),A({vars:M,spatialReference:h,services:D}));return new iye(e,a,p,R,new l,i,h)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}};const n5e=/^([0-9_])/,o5e=/[^a-z0-9_\u0080-\uffff]+/gi;function a5e(t){return t==null?null:t.trim().replaceAll(o5e,"_").replace(n5e,"F$1")||null}const l5e=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],c5e=["field","normalizationField"];function w4(t,e){if(t!=null&&e!=null){for(const r of Array.isArray(t)?t:[t])if(yte(l5e,r,e),"visualVariables"in r&&r.visualVariables)for(const i of r.visualVariables)yte(c5e,i,e)}}function yte(t,e,r){if(t)for(const i of t){const s=wM(i,e),n=s&&typeof s!="function"&&r.get(s);n&&tl(i,n.name,e)}}function sye(t,e){if(t!=null&&e?.fields?.length)if("startField"in t){const r=e.get(t.startField),i=e.get(t.endField);t.startField=r?.name??null,t.endField=i?.name??null}else{const r=e.get(t.startTimeField),i=e.get(t.endTimeField);t.startTimeField=r?.name??null,t.endTimeField=i?.name??null}}const O8=new Set;function r6(t,e){return t&&e?(O8.clear(),xR(O8,t,e),Array.from(O8).sort()):[]}function xR(t,e,r){if(r)if(e?.fields?.length)if(r.includes("*"))for(const{name:i}of e.fields)t.add(i);else for(const i of r)_u(t,e,i);else{if(r.includes("*"))return t.clear(),void t.add("*");for(const i of r)i!=null&&t.add(i)}}function _u(t,e,r){if(typeof r=="string")if(e){const i=e.get(r);i&&t.add(i.name)}else t.add(r)}function u5e(t,e){return e==null||t==null?[]:e.includes("*")?(t.fields??[]).map(r=>r.name):e}async function Dl(t,e,r){if(!r)return;const{arcadeUtils:i}=await Y_(),s=i.extractFieldNames(r,e?.fields?.map(n=>n.name));for(const n of s)_u(t,e,n)}async function nye(t,e,r){if(r&&r!=="1=1"){const{WhereClause:i}=await ce(()=>import("./WhereClause-e2c9f470.js").then(n=>n.W),["./WhereClause-e2c9f470.js","./executionError-e8d36121.js"],import.meta.url),s=i.create(r,e);if(!s.isStandardized)throw new V("fieldUtils:collectFilterFields","Where clause is not standardized",{where:r});xR(t,e,s.fieldNames)}}function h5e({displayField:t,fields:e}){return t||(e&&e.length?R8(e,"name-or-title")||R8(e,"unique-identifier")||R8(e,"type-or-category")||d5e(e):null)}function d5e(t){for(const e of t){if(!e||!e.name)continue;const r=e.name.toLowerCase();if(r.includes("name")||r.includes("title"))return e.name}return null}function R8(t,e){for(const r of t)if(r&&r.valueType&&r.valueType===e)return r.name;return null}async function l$t(t,e){if(!e)return;const r=e.elevationInfo?.featureExpressionInfo;return r?r.collectRequiredFields(t,e.fieldsIndex):void 0}function p5e(t,e,r){r.onStatisticExpression?Dl(t,e,r.onStatisticExpression.expression):t.add(r.onStatisticField)}async function c$t(t,e,r){if(!e||!r||!("fields"in r))return;const i=[],s=r.popupTemplate;i.push(f5e(t,e,s)),r.fields&&i.push(...r.fields.map(async n=>p5e(t,e.fieldsIndex,n))),await Promise.all(i)}async function f5e(t,e,r){const i=[];r?.expressionInfos&&i.push(...r.expressionInfos.map(n=>Dl(t,e.fieldsIndex,n.expression)));const s=r?.content;if(Array.isArray(s))for(const n of s)n.type==="expression"&&n.expressionInfo&&i.push(Dl(t,e.fieldsIndex,n.expressionInfo.expression));await Promise.all(i)}async function u$t(t,e,r){e&&(e.timeInfo&&r!=null&&r.timeExtent&&xR(t,e.fieldsIndex,[e.timeInfo.startField,e.timeInfo.endField]),e.floorInfo&&xR(t,e.fieldsIndex,[e.floorInfo.floorField]),r!=null&&r.where!=null&&await nye(t,e.fieldsIndex,r.where))}async function h$t(t,e,r){e&&r&&await Promise.all(r.map(i=>m5e(t,e,i)))}async function m5e(t,e,r){e&&r&&(r.valueExpression?await Dl(t,e.fieldsIndex,r.valueExpression):r.field&&_u(t,e.fieldsIndex,r.field))}function g5e(t){return t?r6(t.fieldsIndex,oye(t)):[]}function y5e(t){if(!t)return[];const e=t.geometryFieldsInfo;return e?r6(t.fieldsIndex,[e.shapeAreaField,e.shapeLengthField]):[]}const _5e=["oid","global-id","guid"],v5e=["oid","global-id"],b5e=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i];function w5e(t){const e=new Set;aye(t).forEach(i=>e.add(i)),y5e(t).forEach(i=>e.add(i.toLowerCase()));const r=t&&"infoFor3D"in t?t.infoFor3D:void 0;return r&&(Object.values(r.assetMapFieldRoles).forEach(i=>e.add(i.toLowerCase())),Object.values(r.transformFieldRoles).forEach(i=>e.add(i.toLowerCase()))),Array.from(e)}function oye(t){if(!t)return[];const e="editFieldsInfo"in t&&t.editFieldsInfo;if(!e)return[];const{creationDateField:r,creatorField:i,editDateField:s,editorField:n}=e;return[r,i,s,n].filter(Boolean)}function aye(t){return oye(t).map(e=>e.toLowerCase())}function x5e(t,e){return t.editable&&!_5e.includes(t.type)&&!aye(e).includes(t.name?.toLowerCase()??"")}function T5e(t,e){const r=t.name?.toLowerCase()??"";return!(e?.objectIdField!=null&&r===e.objectIdField.toLowerCase()||e?.globalIdField!=null&&r===e.globalIdField.toLowerCase()||w5e(e).includes(r)||v5e.includes(t.type)||b5e.some(i=>i.test(r)))}async function d$t(t,e){const{labelingInfo:r,fieldsIndex:i}=e;r&&r.length&&await Promise.all(r.map(s=>S5e(t,i,s)))}async function S5e(t,e,r){if(!r)return;const i=r.getLabelExpression(),s=r.where;if(i.type==="arcade")await Dl(t,e,i.expression);else{const n=i.expression.match(/{[^}]*}/g);n&&n.forEach(o=>{_u(t,e,o.slice(1,-1))})}await nye(t,e,s)}function E5e(t){const e=t.defaultValue;return e!==void 0&&uye(t,e)?e:t.nullable?null:void 0}function lye(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function C5e(t){return t===null||lye(t)}const fZ="isInteger"in Number?Number.isInteger:t=>typeof t=="number"&&isFinite(t)&&Math.floor(t)===t;function A5e(t){return t===null||fZ(t)}function cye(t){return t!=null&&typeof t=="string"}function O5e(t){return t===null||cye(t)}function R5e(){return!0}function uye(t,e){let r;switch(t.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":r=t.nullable?A5e:fZ;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":r=t.nullable?C5e:lye;break;case"string":case"esriFieldTypeString":r=t.nullable?O5e:cye;break;default:r=R5e}return arguments.length===1?r:r(e)}const M5e=["integer","small-integer","single","double"],P5e=new Set([...M5e,"esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]),I5e=["date","date-only","time-only","timestamp-offset"],$5e=new Set([...I5e,"esriFieldTypeDate","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]);function mZ(t){return t!=null&&P5e.has(t.type)}function p$t(t){return t!=null&&(t.type==="string"||t.type==="esriFieldTypeString")}function f$t(t){return t!=null&&$5e.has(t.type)}var x4,T4;function m$t(t){return t==null||typeof t=="number"&&isNaN(t)?null:t}function g$t(t,e){return t==null||t.nullable&&e===null?null:mZ(t)&&!L5e(t.type,Number(e))?x4.OUT_OF_RANGE:uye(t,e)?t.domain?e5e(t.domain,e):null:T4.INVALID_TYPE}function L5e(t,e){const r=typeof t=="string"?hye(t):t;if(!r)return!1;const i=r.min,s=r.max;return r.isInteger?fZ(e)&&e>=i&&e<=s:e>=i&&e<=s}function hye(t){switch(t){case"esriFieldTypeSmallInteger":case"small-integer":return D5e;case"esriFieldTypeInteger":case"integer":return N5e;case"esriFieldTypeBigInteger":case"big-integer":return F5e;case"esriFieldTypeSingle":case"single":return U5e;case"esriFieldTypeDouble":case"double":return k5e}}(function(t){t.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(x4||(x4={})),function(t){t.INVALID_TYPE="type-validation-error::invalid-type"}(T4||(T4={}));const D5e={min:-32768,max:32767,isInteger:!0},N5e={min:-2147483648,max:2147483647,isInteger:!0},F5e={min:-Number.MAX_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,isInteger:!0},U5e={min:-34e37,max:12e37,isInteger:!1},k5e={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};function y$t(t,e,r){switch(t){case q2.INVALID_CODED_VALUE:return`Value ${r} is not in the coded domain - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case q2.VALUE_OUT_OF_RANGE:return`Value ${r} is out of the range of valid values - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case T4.INVALID_TYPE:return`Value ${r} is not a valid value for the field type - field: ${e.name}, type: ${e.type}, nullable: ${e.nullable}`;case x4.OUT_OF_RANGE:{const{min:i,max:s}=hye(e.type);return`Value ${r} is out of range for the number type - field: ${e.name}, type: ${e.type}, value range is ${i} to ${s}`}}}function _$t(t,e){return!z5e(t,e,null)}function z5e(t,e,r){if(!e||!e.attributes||!t){if(r!=null)for(const n of t??[])r.add(n);return!0}const i=e.attributes;let s=!1;for(const n of t)if(!(n in i)){if(s=!0,r==null)break;r.add(n)}return s}function V5e(t){return!!t&&["raster.itempixelvalue","raster.servicepixelvalue"].some(e=>t.toLowerCase().startsWith(e))}let JL=class extends le{constructor(e){super(e),this.type=null}};u([d({type:["attachments","custom","fields","media","text","expression","relationship"],readOnly:!0,json:{read:!1,write:!0}})],JL.prototype,"type",void 0),JL=u([P("esri.popup.content.Content")],JL);const yv=JL;var gB;let x1=gB=class extends yv{constructor(t){super(t),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new gB({description:this.description,displayType:this.displayType,title:this.title})}};u([d({type:String,json:{write:!0}})],x1.prototype,"description",void 0),u([d({type:["auto","preview","list"],json:{write:!0}})],x1.prototype,"displayType",void 0),u([d({type:String,json:{write:!0}})],x1.prototype,"title",void 0),u([d({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],x1.prototype,"type",void 0),x1=gB=u([P("esri.popup.content.AttachmentsContent")],x1);const TR=x1;var yB;let T1=yB=class extends yv{constructor(t){super(t),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new yB({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?K(this.outFields):null})}};u([d()],T1.prototype,"creator",void 0),u([d()],T1.prototype,"destroyer",void 0),u([d()],T1.prototype,"outFields",void 0),u([d({type:["custom"],readOnly:!0})],T1.prototype,"type",void 0),T1=yB=u([P("esri.popup.content.CustomContent")],T1);const B5e=T1;var _B;let FT=_B=class extends le{constructor(t){super(t),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new _B({title:this.title,expression:this.expression})}};u([d({type:String,json:{write:!0}})],FT.prototype,"title",void 0),u([d({type:String,json:{write:!0}})],FT.prototype,"expression",void 0),u([d({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],FT.prototype,"returnType",void 0),FT=_B=u([P("esri.popup.ElementExpressionInfo")],FT);const G5e=FT;var vB;let NA=vB=class extends yv{constructor(t){super(t),this.expressionInfo=null,this.type="expression"}clone(){return new vB({expressionInfo:this.expressionInfo?.clone()})}};u([d({type:G5e,json:{write:!0}})],NA.prototype,"expressionInfo",void 0),u([d({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],NA.prototype,"type",void 0),NA=vB=u([P("esri.popup.content.ExpressionContent")],NA);const gZ=NA;class sx extends Error{}class j5e extends sx{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class H5e extends sx{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class q5e extends sx{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class FA extends sx{}class dye extends sx{constructor(e){super(`Invalid unit ${e}`)}}class _h extends sx{}class qy extends sx{constructor(){super("Zone is an abstract class")}}const We="numeric",xp="short",vu="long",S4={year:We,month:We,day:We},pye={year:We,month:xp,day:We},W5e={year:We,month:xp,day:We,weekday:xp},fye={year:We,month:vu,day:We},mye={year:We,month:vu,day:We,weekday:vu},gye={hour:We,minute:We},yye={hour:We,minute:We,second:We},_ye={hour:We,minute:We,second:We,timeZoneName:xp},vye={hour:We,minute:We,second:We,timeZoneName:vu},bye={hour:We,minute:We,hourCycle:"h23"},wye={hour:We,minute:We,second:We,hourCycle:"h23"},xye={hour:We,minute:We,second:We,hourCycle:"h23",timeZoneName:xp},Tye={hour:We,minute:We,second:We,hourCycle:"h23",timeZoneName:vu},Sye={year:We,month:We,day:We,hour:We,minute:We},Eye={year:We,month:We,day:We,hour:We,minute:We,second:We},Cye={year:We,month:xp,day:We,hour:We,minute:We},Aye={year:We,month:xp,day:We,hour:We,minute:We,second:We},X5e={year:We,month:xp,day:We,weekday:xp,hour:We,minute:We},Oye={year:We,month:vu,day:We,hour:We,minute:We,timeZoneName:xp},Rye={year:We,month:vu,day:We,hour:We,minute:We,second:We,timeZoneName:xp},Mye={year:We,month:vu,day:We,weekday:vu,hour:We,minute:We,timeZoneName:vu},Pye={year:We,month:vu,day:We,weekday:vu,hour:We,minute:We,second:We,timeZoneName:vu};class RM{get type(){throw new qy}get name(){throw new qy}get ianaName(){return this.name}get isUniversal(){throw new qy}offsetName(e,r){throw new qy}formatOffset(e,r){throw new qy}offset(e){throw new qy}equals(e){throw new qy}get isValid(){throw new qy}}let M8=null;class i6 extends RM{static get instance(){return M8===null&&(M8=new i6),M8}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:r,locale:i}){return $ye(e,r,i)}formatOffset(e,r){return xO(this.offset(e),r)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}}let QL={};function Z5e(t){return QL[t]||(QL[t]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),QL[t]}const Y5e={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function J5e(t,e){const r=t.format(e).replace(/\u200E/g,""),i=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(r),[,s,n,o,a,l,c,h]=i;return[o,s,n,a,l,c,h]}function Q5e(t,e){const r=t.formatToParts(e),i=[];for(let s=0;s<r.length;s++){const{type:n,value:o}=r[s],a=Y5e[n];n==="era"?i[a]=o:ni(a)||(i[a]=parseInt(o,10))}return i}let NP={};class ly extends RM{static create(e){return NP[e]||(NP[e]=new ly(e)),NP[e]}static resetCache(){NP={},QL={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=ly.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:r,locale:i}){return $ye(e,r,i,this.name)}formatOffset(e,r){return xO(this.offset(e),r)}offset(e){const r=new Date(e);if(isNaN(r))return NaN;const i=Z5e(this.name);let[s,n,o,a,l,c,h]=i.formatToParts?Q5e(i,r):J5e(i,r);a==="BC"&&(s=-Math.abs(s)+1);const f=vZ({year:s,month:n,day:o,hour:l===24?0:l,minute:c,second:h,millisecond:0});let m=+r;const y=m%1e3;return m-=y>=0?y:1e3+y,(f-m)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}}let _te={};function K5e(t,e={}){const r=JSON.stringify([t,e]);let i=_te[r];return i||(i=new Intl.ListFormat(t,e),_te[r]=i),i}let bB={};function wB(t,e={}){const r=JSON.stringify([t,e]);let i=bB[r];return i||(i=new Intl.DateTimeFormat(t,e),bB[r]=i),i}let xB={};function e6e(t,e={}){const r=JSON.stringify([t,e]);let i=xB[r];return i||(i=new Intl.NumberFormat(t,e),xB[r]=i),i}let TB={};function t6e(t,e={}){const{base:r,...i}=e,s=JSON.stringify([t,i]);let n=TB[s];return n||(n=new Intl.RelativeTimeFormat(t,e),TB[s]=n),n}let UA=null;function r6e(){return UA||(UA=new Intl.DateTimeFormat().resolvedOptions().locale,UA)}function i6e(t){const e=t.indexOf("-x-");e!==-1&&(t=t.substring(0,e));const r=t.indexOf("-u-");if(r===-1)return[t];{let i,s;try{i=wB(t).resolvedOptions(),s=t}catch{const l=t.substring(0,r);i=wB(l).resolvedOptions(),s=l}const{numberingSystem:n,calendar:o}=i;return[s,n,o]}}function s6e(t,e,r){return(r||e)&&(t.includes("-u-")||(t+="-u"),r&&(t+=`-ca-${r}`),e&&(t+=`-nu-${e}`)),t}function n6e(t){const e=[];for(let r=1;r<=12;r++){const i=br.utc(2016,r,1);e.push(t(i))}return e}function o6e(t){const e=[];for(let r=1;r<=7;r++){const i=br.utc(2016,11,13+r);e.push(t(i))}return e}function FP(t,e,r,i,s){const n=t.listingMode(r);return n==="error"?null:n==="en"?i(e):s(e)}function a6e(t){return t.numberingSystem&&t.numberingSystem!=="latn"?!1:t.numberingSystem==="latn"||!t.locale||t.locale.startsWith("en")||new Intl.DateTimeFormat(t.intl).resolvedOptions().numberingSystem==="latn"}class l6e{constructor(e,r,i){this.padTo=i.padTo||0,this.floor=i.floor||!1;const{padTo:s,floor:n,...o}=i;if(!r||Object.keys(o).length>0){const a={useGrouping:!1,...i};i.padTo>0&&(a.minimumIntegerDigits=i.padTo),this.inf=e6e(e,a)}}format(e){if(this.inf){const r=this.floor?Math.floor(e):e;return this.inf.format(r)}else{const r=this.floor?Math.floor(e):_Z(e,3);return Zn(r,this.padTo)}}}class c6e{constructor(e,r,i){this.opts=i,this.originalZone=void 0;let s;if(this.opts.timeZone)this.dt=e;else if(e.zone.type==="fixed"){const o=-1*(e.offset/60),a=o>=0?`Etc/GMT+${o}`:`Etc/GMT${o}`;e.offset!==0&&ly.create(a).valid?(s=a,this.dt=e):(s="UTC",this.dt=e.offset===0?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else e.zone.type==="system"?this.dt=e:e.zone.type==="iana"?(this.dt=e,s=e.zone.name):(s="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const n={...this.opts};n.timeZone=n.timeZone||s,this.dtf=wB(r,n)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(r=>{if(r.type==="timeZoneName"){const i=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...r,value:i}}else return r}):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class u6e{constructor(e,r,i){this.opts={style:"long",...i},!r&&Iye()&&(this.rtf=t6e(e,i))}format(e,r){return this.rtf?this.rtf.format(e,r):A6e(r,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,r){return this.rtf?this.rtf.formatToParts(e,r):[]}}class Ms{static fromOpts(e){return Ms.create(e.locale,e.numberingSystem,e.outputCalendar,e.defaultToEN)}static create(e,r,i,s=!1){const n=e||Wn.defaultLocale,o=n||(s?"en-US":r6e()),a=r||Wn.defaultNumberingSystem,l=i||Wn.defaultOutputCalendar;return new Ms(o,a,l,n)}static resetCache(){UA=null,bB={},xB={},TB={}}static fromObject({locale:e,numberingSystem:r,outputCalendar:i}={}){return Ms.create(e,r,i)}constructor(e,r,i,s){const[n,o,a]=i6e(e);this.locale=n,this.numberingSystem=r||o||null,this.outputCalendar=i||a||null,this.intl=s6e(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=s,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=a6e(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),r=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&r?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:Ms.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,r=!1,i=!0){return FP(this,e,i,Nye,()=>{const s=r?{month:e,day:"numeric"}:{month:e},n=r?"format":"standalone";return this.monthsCache[n][e]||(this.monthsCache[n][e]=n6e(o=>this.extract(o,s,"month"))),this.monthsCache[n][e]})}weekdays(e,r=!1,i=!0){return FP(this,e,i,kye,()=>{const s=r?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},n=r?"format":"standalone";return this.weekdaysCache[n][e]||(this.weekdaysCache[n][e]=o6e(o=>this.extract(o,s,"weekday"))),this.weekdaysCache[n][e]})}meridiems(e=!0){return FP(this,void 0,e,()=>zye,()=>{if(!this.meridiemCache){const r={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[br.utc(2016,11,13,9),br.utc(2016,11,13,19)].map(i=>this.extract(i,r,"dayperiod"))}return this.meridiemCache})}eras(e,r=!0){return FP(this,e,r,Vye,()=>{const i={era:e};return this.eraCache[e]||(this.eraCache[e]=[br.utc(-40,1,1),br.utc(2017,1,1)].map(s=>this.extract(s,i,"era"))),this.eraCache[e]})}extract(e,r,i){const s=this.dtFormatter(e,r),n=s.formatToParts(),o=n.find(a=>a.type.toLowerCase()===i);return o?o.value:null}numberFormatter(e={}){return new l6e(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,r={}){return new c6e(e,this.intl,r)}relFormatter(e={}){return new u6e(this.intl,this.isEnglish(),e)}listFormatter(e={}){return K5e(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}}let P8=null;class Qa extends RM{static get utcInstance(){return P8===null&&(P8=new Qa(0)),P8}static instance(e){return e===0?Qa.utcInstance:new Qa(e)}static parseSpecifier(e){if(e){const r=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(r)return new Qa(n6(r[1],r[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${xO(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${xO(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,r){return xO(this.fixed,r)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}}class h6e extends RM{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function p_(t,e){if(ni(t)||t===null)return e;if(t instanceof RM)return t;if(d6e(t)){const r=t.toLowerCase();return r==="default"?e:r==="local"||r==="system"?i6.instance:r==="utc"||r==="gmt"?Qa.utcInstance:Qa.parseSpecifier(r)||ly.create(t)}else return Qb(t)?Qa.instance(t):typeof t=="object"&&t.offset&&typeof t.offset=="number"?t:new h6e(t)}let vte=()=>Date.now(),bte="system",wte=null,xte=null,Tte=null,Ste=60,Ete;class Wn{static get now(){return vte}static set now(e){vte=e}static set defaultZone(e){bte=e}static get defaultZone(){return p_(bte,i6.instance)}static get defaultLocale(){return wte}static set defaultLocale(e){wte=e}static get defaultNumberingSystem(){return xte}static set defaultNumberingSystem(e){xte=e}static get defaultOutputCalendar(){return Tte}static set defaultOutputCalendar(e){Tte=e}static get twoDigitCutoffYear(){return Ste}static set twoDigitCutoffYear(e){Ste=e%100}static get throwOnInvalid(){return Ete}static set throwOnInvalid(e){Ete=e}static resetCaches(){Ms.resetCache(),ly.resetCache()}}function ni(t){return typeof t>"u"}function Qb(t){return typeof t=="number"}function s6(t){return typeof t=="number"&&t%1===0}function d6e(t){return typeof t=="string"}function p6e(t){return Object.prototype.toString.call(t)==="[object Date]"}function Iye(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function f6e(t){return Array.isArray(t)?t:[t]}function Cte(t,e,r){if(t.length!==0)return t.reduce((i,s)=>{const n=[e(s),s];return i&&r(i[0],n[0])===i[0]?i:n},null)[1]}function m6e(t,e){return e.reduce((r,i)=>(r[i]=t[i],r),{})}function W2(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function zg(t,e,r){return s6(t)&&t>=e&&t<=r}function g6e(t,e){return t-e*Math.floor(t/e)}function Zn(t,e=2){const r=t<0;let i;return r?i="-"+(""+-t).padStart(e,"0"):i=(""+t).padStart(e,"0"),i}function s_(t){if(!(ni(t)||t===null||t===""))return parseInt(t,10)}function Fv(t){if(!(ni(t)||t===null||t===""))return parseFloat(t)}function yZ(t){if(!(ni(t)||t===null||t==="")){const e=parseFloat("0."+t)*1e3;return Math.floor(e)}}function _Z(t,e,r=!1){const i=10**e;return(r?Math.trunc:Math.round)(t*i)/i}function MM(t){return t%4===0&&(t%100!==0||t%400===0)}function wO(t){return MM(t)?366:365}function E4(t,e){const r=g6e(e-1,12)+1,i=t+(e-r)/12;return r===2?MM(i)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][r-1]}function vZ(t){let e=Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond);return t.year<100&&t.year>=0&&(e=new Date(e),e.setUTCFullYear(t.year,t.month-1,t.day)),+e}function C4(t){const e=(t+Math.floor(t/4)-Math.floor(t/100)+Math.floor(t/400))%7,r=t-1,i=(r+Math.floor(r/4)-Math.floor(r/100)+Math.floor(r/400))%7;return e===4||i===3?53:52}function SB(t){return t>99?t:t>Wn.twoDigitCutoffYear?1900+t:2e3+t}function $ye(t,e,r,i=null){const s=new Date(t),n={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};i&&(n.timeZone=i);const o={timeZoneName:e,...n},a=new Intl.DateTimeFormat(r,o).formatToParts(s).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function n6(t,e){let r=parseInt(t,10);Number.isNaN(r)&&(r=0);const i=parseInt(e,10)||0,s=r<0||Object.is(r,-0)?-i:i;return r*60+s}function Lye(t){const e=Number(t);if(typeof t=="boolean"||t===""||Number.isNaN(e))throw new _h(`Invalid unit value ${t}`);return e}function A4(t,e){const r={};for(const i in t)if(W2(t,i)){const s=t[i];if(s==null)continue;r[e(i)]=Lye(s)}return r}function xO(t,e){const r=Math.trunc(Math.abs(t/60)),i=Math.trunc(Math.abs(t%60)),s=t>=0?"+":"-";switch(e){case"short":return`${s}${Zn(r,2)}:${Zn(i,2)}`;case"narrow":return`${s}${r}${i>0?`:${i}`:""}`;case"techie":return`${s}${Zn(r,2)}${Zn(i,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function o6(t){return m6e(t,["hour","minute","second","millisecond"])}const y6e=["January","February","March","April","May","June","July","August","September","October","November","December"],Dye=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],_6e=["J","F","M","A","M","J","J","A","S","O","N","D"];function Nye(t){switch(t){case"narrow":return[..._6e];case"short":return[...Dye];case"long":return[...y6e];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const Fye=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],Uye=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],v6e=["M","T","W","T","F","S","S"];function kye(t){switch(t){case"narrow":return[...v6e];case"short":return[...Uye];case"long":return[...Fye];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const zye=["AM","PM"],b6e=["Before Christ","Anno Domini"],w6e=["BC","AD"],x6e=["B","A"];function Vye(t){switch(t){case"narrow":return[...x6e];case"short":return[...w6e];case"long":return[...b6e];default:return null}}function T6e(t){return zye[t.hour<12?0:1]}function S6e(t,e){return kye(e)[t.weekday-1]}function E6e(t,e){return Nye(e)[t.month-1]}function C6e(t,e){return Vye(e)[t.year<0?0:1]}function A6e(t,e,r="always",i=!1){const s={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},n=["hours","minutes","seconds"].indexOf(t)===-1;if(r==="auto"&&n){const p=t==="days";switch(e){case 1:return p?"tomorrow":`next ${s[t][0]}`;case-1:return p?"yesterday":`last ${s[t][0]}`;case 0:return p?"today":`this ${s[t][0]}`}}const o=Object.is(e,-0)||e<0,a=Math.abs(e),l=a===1,c=s[t],h=i?l?c[1]:c[2]||c[1]:l?s[t][0]:t;return o?`${a} ${h} ago`:`in ${a} ${h}`}function Ate(t,e){let r="";for(const i of t)i.literal?r+=i.val:r+=e(i.val);return r}const O6e={D:S4,DD:pye,DDD:fye,DDDD:mye,t:gye,tt:yye,ttt:_ye,tttt:vye,T:bye,TT:wye,TTT:xye,TTTT:Tye,f:Sye,ff:Cye,fff:Oye,ffff:Mye,F:Eye,FF:Aye,FFF:Rye,FFFF:Pye};class Ya{static create(e,r={}){return new Ya(e,r)}static parseFormat(e){let r=null,i="",s=!1;const n=[];for(let o=0;o<e.length;o++){const a=e.charAt(o);a==="'"?(i.length>0&&n.push({literal:s||/^\s+$/.test(i),val:i}),r=null,i="",s=!s):s||a===r?i+=a:(i.length>0&&n.push({literal:/^\s+$/.test(i),val:i}),i=a,r=a)}return i.length>0&&n.push({literal:s||/^\s+$/.test(i),val:i}),n}static macroTokenToFormatOpts(e){return O6e[e]}constructor(e,r){this.opts=r,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,r){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...r}).format()}formatDateTime(e,r={}){return this.loc.dtFormatter(e,{...this.opts,...r}).format()}formatDateTimeParts(e,r={}){return this.loc.dtFormatter(e,{...this.opts,...r}).formatToParts()}formatInterval(e,r={}){return this.loc.dtFormatter(e.start,{...this.opts,...r}).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,r={}){return this.loc.dtFormatter(e,{...this.opts,...r}).resolvedOptions()}num(e,r=0){if(this.opts.forceSimple)return Zn(e,r);const i={...this.opts};return r>0&&(i.padTo=r),this.loc.numberFormatter(i).format(e)}formatDateTimeFromString(e,r){const i=this.loc.listingMode()==="en",s=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",n=(m,y)=>this.loc.extract(e,m,y),o=m=>e.isOffsetFixed&&e.offset===0&&m.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,m.format):"",a=()=>i?T6e(e):n({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(m,y)=>i?E6e(e,m):n(y?{month:m}:{month:m,day:"numeric"},"month"),c=(m,y)=>i?S6e(e,m):n(y?{weekday:m}:{weekday:m,month:"long",day:"numeric"},"weekday"),h=m=>{const y=Ya.macroTokenToFormatOpts(m);return y?this.formatWithSystemDefault(e,y):m},p=m=>i?C6e(e,m):n({era:m},"era"),f=m=>{switch(m){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return o({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return o({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return a();case"d":return s?n({day:"numeric"},"day"):this.num(e.day);case"dd":return s?n({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return s?n({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return s?n({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return s?n({month:"numeric"},"month"):this.num(e.month);case"MM":return s?n({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return s?n({year:"numeric"},"year"):this.num(e.year);case"yy":return s?n({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return s?n({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return s?n({year:"numeric"},"year"):this.num(e.year,6);case"G":return p("short");case"GG":return p("long");case"GGGGG":return p("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return h(m)}};return Ate(Ya.parseFormat(r),f)}formatDurationFromString(e,r){const i=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},s=l=>c=>{const h=i(c);return h?this.num(l.get(h),c.length):c},n=Ya.parseFormat(r),o=n.reduce((l,{literal:c,val:h})=>c?l:l.concat(h),[]),a=e.shiftTo(...o.map(i).filter(l=>l));return Ate(n,s(a))}}class ip{constructor(e,r){this.reason=e,this.explanation=r}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const Bye=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function qE(...t){const e=t.reduce((r,i)=>r+i.source,"");return RegExp(`^${e}$`)}function WE(...t){return e=>t.reduce(([r,i,s],n)=>{const[o,a,l]=n(e,s);return[{...r,...o},a||i,l]},[{},null,1]).slice(0,2)}function XE(t,...e){if(t==null)return[null,null];for(const[r,i]of e){const s=r.exec(t);if(s)return i(s)}return[null,null]}function Gye(...t){return(e,r)=>{const i={};let s;for(s=0;s<t.length;s++)i[t[s]]=s_(e[r+s]);return[i,null,r+s]}}const jye=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,R6e=`(?:${jye.source}?(?:\\[(${Bye.source})\\])?)?`,bZ=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,Hye=RegExp(`${bZ.source}${R6e}`),wZ=RegExp(`(?:T${Hye.source})?`),M6e=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,P6e=/(\d{4})-?W(\d\d)(?:-?(\d))?/,I6e=/(\d{4})-?(\d{3})/,$6e=Gye("weekYear","weekNumber","weekDay"),L6e=Gye("year","ordinal"),D6e=/(\d{4})-(\d\d)-(\d\d)/,qye=RegExp(`${bZ.source} ?(?:${jye.source}|(${Bye.source}))?`),N6e=RegExp(`(?: ${qye.source})?`);function h2(t,e,r){const i=t[e];return ni(i)?r:s_(i)}function F6e(t,e){return[{year:h2(t,e),month:h2(t,e+1,1),day:h2(t,e+2,1)},null,e+3]}function ZE(t,e){return[{hours:h2(t,e,0),minutes:h2(t,e+1,0),seconds:h2(t,e+2,0),milliseconds:yZ(t[e+3])},null,e+4]}function PM(t,e){const r=!t[e]&&!t[e+1],i=n6(t[e+1],t[e+2]),s=r?null:Qa.instance(i);return[{},s,e+3]}function IM(t,e){const r=t[e]?ly.create(t[e]):null;return[{},r,e+1]}const U6e=RegExp(`^T?${bZ.source}$`),k6e=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function z6e(t){const[e,r,i,s,n,o,a,l,c]=t,h=e[0]==="-",p=l&&l[0]==="-",f=(m,y=!1)=>m!==void 0&&(y||m&&h)?-m:m;return[{years:f(Fv(r)),months:f(Fv(i)),weeks:f(Fv(s)),days:f(Fv(n)),hours:f(Fv(o)),minutes:f(Fv(a)),seconds:f(Fv(l),l==="-0"),milliseconds:f(yZ(c),p)}]}const V6e={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function xZ(t,e,r,i,s,n,o){const a={year:e.length===2?SB(s_(e)):s_(e),month:Dye.indexOf(r)+1,day:s_(i),hour:s_(s),minute:s_(n)};return o&&(a.second=s_(o)),t&&(a.weekday=t.length>3?Fye.indexOf(t)+1:Uye.indexOf(t)+1),a}const B6e=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function G6e(t){const[,e,r,i,s,n,o,a,l,c,h,p]=t,f=xZ(e,s,i,r,n,o,a);let m;return l?m=V6e[l]:c?m=0:m=n6(h,p),[f,new Qa(m)]}function j6e(t){return t.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const H6e=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,q6e=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,W6e=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function Ote(t){const[,e,r,i,s,n,o,a]=t;return[xZ(e,s,i,r,n,o,a),Qa.utcInstance]}function X6e(t){const[,e,r,i,s,n,o,a]=t;return[xZ(e,a,r,i,s,n,o),Qa.utcInstance]}const Z6e=qE(M6e,wZ),Y6e=qE(P6e,wZ),J6e=qE(I6e,wZ),Q6e=qE(Hye),Wye=WE(F6e,ZE,PM,IM),K6e=WE($6e,ZE,PM,IM),eUe=WE(L6e,ZE,PM,IM),tUe=WE(ZE,PM,IM);function rUe(t){return XE(t,[Z6e,Wye],[Y6e,K6e],[J6e,eUe],[Q6e,tUe])}function iUe(t){return XE(j6e(t),[B6e,G6e])}function sUe(t){return XE(t,[H6e,Ote],[q6e,Ote],[W6e,X6e])}function nUe(t){return XE(t,[k6e,z6e])}const oUe=WE(ZE);function aUe(t){return XE(t,[U6e,oUe])}const lUe=qE(D6e,N6e),cUe=qE(qye),uUe=WE(ZE,PM,IM);function hUe(t){return XE(t,[lUe,Wye],[cUe,uUe])}const dUe="Invalid Duration",Xye={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},pUe={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...Xye},Nu=146097/400,Sx=146097/4800,fUe={years:{quarters:4,months:12,weeks:Nu/7,days:Nu,hours:Nu*24,minutes:Nu*24*60,seconds:Nu*24*60*60,milliseconds:Nu*24*60*60*1e3},quarters:{months:3,weeks:Nu/28,days:Nu/4,hours:Nu*24/4,minutes:Nu*24*60/4,seconds:Nu*24*60*60/4,milliseconds:Nu*24*60*60*1e3/4},months:{weeks:Sx/7,days:Sx,hours:Sx*24,minutes:Sx*24*60,seconds:Sx*24*60*60,milliseconds:Sx*24*60*60*1e3},...Xye},S1=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],mUe=S1.slice(0).reverse();function Wy(t,e,r=!1){const i={values:r?e.values:{...t.values,...e.values||{}},loc:t.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||t.conversionAccuracy,matrix:e.matrix||t.matrix};return new hi(i)}function gUe(t){return t<0?Math.floor(t):Math.ceil(t)}function Zye(t,e,r,i,s){const n=t[s][r],o=e[r]/n,a=Math.sign(o)===Math.sign(i[s]),l=!a&&i[s]!==0&&Math.abs(o)<=1?gUe(o):Math.trunc(o);i[s]+=l,e[r]-=l*n}function yUe(t,e){mUe.reduce((r,i)=>ni(e[i])?r:(r&&Zye(t,e,r,e,i),i),null)}function _Ue(t){const e={};for(const[r,i]of Object.entries(t))i!==0&&(e[r]=i);return e}class hi{constructor(e){const r=e.conversionAccuracy==="longterm"||!1;let i=r?fUe:pUe;e.matrix&&(i=e.matrix),this.values=e.values,this.loc=e.loc||Ms.create(),this.conversionAccuracy=r?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=i,this.isLuxonDuration=!0}static fromMillis(e,r){return hi.fromObject({milliseconds:e},r)}static fromObject(e,r={}){if(e==null||typeof e!="object")throw new _h(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new hi({values:A4(e,hi.normalizeUnit),loc:Ms.fromObject(r),conversionAccuracy:r.conversionAccuracy,matrix:r.matrix})}static fromDurationLike(e){if(Qb(e))return hi.fromMillis(e);if(hi.isDuration(e))return e;if(typeof e=="object")return hi.fromObject(e);throw new _h(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,r){const[i]=nUe(e);return i?hi.fromObject(i,r):hi.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,r){const[i]=aUe(e);return i?hi.fromObject(i,r):hi.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,r=null){if(!e)throw new _h("need to specify a reason the Duration is invalid");const i=e instanceof ip?e:new ip(e,r);if(Wn.throwOnInvalid)throw new q5e(i);return new hi({invalid:i})}static normalizeUnit(e){const r={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!r)throw new dye(e);return r}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,r={}){const i={...r,floor:r.round!==!1&&r.floor!==!1};return this.isValid?Ya.create(this.loc,i).formatDurationFromString(this,e):dUe}toHuman(e={}){const r=S1.map(i=>{const s=this.values[i];return ni(s)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:i.slice(0,-1)}).format(s)}).filter(i=>i);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(r)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=_Z(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const r=this.toMillis();if(r<0||r>=864e5)return null;e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e};const i=this.shiftTo("hours","minutes","seconds","milliseconds");let s=e.format==="basic"?"hhmm":"hh:mm";(!e.suppressSeconds||i.seconds!==0||i.milliseconds!==0)&&(s+=e.format==="basic"?"ss":":ss",(!e.suppressMilliseconds||i.milliseconds!==0)&&(s+=".SSS"));let n=i.toFormat(s);return e.includePrefix&&(n="T"+n),n}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.as("milliseconds")}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const r=hi.fromDurationLike(e),i={};for(const s of S1)(W2(r.values,s)||W2(this.values,s))&&(i[s]=r.get(s)+this.get(s));return Wy(this,{values:i},!0)}minus(e){if(!this.isValid)return this;const r=hi.fromDurationLike(e);return this.plus(r.negate())}mapUnits(e){if(!this.isValid)return this;const r={};for(const i of Object.keys(this.values))r[i]=Lye(e(this.values[i],i));return Wy(this,{values:r},!0)}get(e){return this[hi.normalizeUnit(e)]}set(e){if(!this.isValid)return this;const r={...this.values,...A4(e,hi.normalizeUnit)};return Wy(this,{values:r})}reconfigure({locale:e,numberingSystem:r,conversionAccuracy:i,matrix:s}={}){const o={loc:this.loc.clone({locale:e,numberingSystem:r}),matrix:s,conversionAccuracy:i};return Wy(this,o)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return yUe(this.matrix,e),Wy(this,{values:e},!0)}rescale(){if(!this.isValid)return this;const e=_Ue(this.normalize().shiftToAll().toObject());return Wy(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(o=>hi.normalizeUnit(o));const r={},i={},s=this.toObject();let n;for(const o of S1)if(e.indexOf(o)>=0){n=o;let a=0;for(const c in i)a+=this.matrix[c][o]*i[c],i[c]=0;Qb(s[o])&&(a+=s[o]);const l=Math.trunc(a);r[o]=l,i[o]=(a*1e3-l*1e3)/1e3;for(const c in s)S1.indexOf(c)>S1.indexOf(o)&&Zye(this.matrix,s,c,r,o)}else Qb(s[o])&&(i[o]=s[o]);for(const o in i)i[o]!==0&&(r[n]+=o===n?i[o]:i[o]/this.matrix[n][o]);return Wy(this,{values:r},!0).normalize()}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const r of Object.keys(this.values))e[r]=this.values[r]===0?0:-this.values[r];return Wy(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function r(i,s){return i===void 0||i===0?s===void 0||s===0:i===s}for(const i of S1)if(!r(this.values[i],e.values[i]))return!1;return!0}}const Ex="Invalid Interval";function vUe(t,e){return!t||!t.isValid?tn.invalid("missing or invalid start"):!e||!e.isValid?tn.invalid("missing or invalid end"):e<t?tn.invalid("end before start",`The end of an interval must be after its start, but you had start=${t.toISO()} and end=${e.toISO()}`):null}class tn{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,r=null){if(!e)throw new _h("need to specify a reason the Interval is invalid");const i=e instanceof ip?e:new ip(e,r);if(Wn.throwOnInvalid)throw new H5e(i);return new tn({invalid:i})}static fromDateTimes(e,r){const i=CC(e),s=CC(r),n=vUe(i,s);return n??new tn({start:i,end:s})}static after(e,r){const i=hi.fromDurationLike(r),s=CC(e);return tn.fromDateTimes(s,s.plus(i))}static before(e,r){const i=hi.fromDurationLike(r),s=CC(e);return tn.fromDateTimes(s.minus(i),s)}static fromISO(e,r){const[i,s]=(e||"").split("/",2);if(i&&s){let n,o;try{n=br.fromISO(i,r),o=n.isValid}catch{o=!1}let a,l;try{a=br.fromISO(s,r),l=a.isValid}catch{l=!1}if(o&&l)return tn.fromDateTimes(n,a);if(o){const c=hi.fromISO(s,r);if(c.isValid)return tn.after(n,c)}else if(l){const c=hi.fromISO(i,r);if(c.isValid)return tn.before(a,c)}}return tn.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds"){if(!this.isValid)return NaN;const r=this.start.startOf(e),i=this.end.startOf(e);return Math.floor(i.diff(r,e).get(e))+(i.valueOf()!==this.end.valueOf())}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:r}={}){return this.isValid?tn.fromDateTimes(e||this.s,r||this.e):this}splitAt(...e){if(!this.isValid)return[];const r=e.map(CC).filter(o=>this.contains(o)).sort(),i=[];let{s}=this,n=0;for(;s<this.e;){const o=r[n]||this.e,a=+o>+this.e?this.e:o;i.push(tn.fromDateTimes(s,a)),s=a,n+=1}return i}splitBy(e){const r=hi.fromDurationLike(e);if(!this.isValid||!r.isValid||r.as("milliseconds")===0)return[];let{s:i}=this,s=1,n;const o=[];for(;i<this.e;){const a=this.start.plus(r.mapUnits(l=>l*s));n=+a>+this.e?this.e:a,o.push(tn.fromDateTimes(i,n)),i=n,s+=1}return o}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const r=this.s>e.s?this.s:e.s,i=this.e<e.e?this.e:e.e;return r>=i?null:tn.fromDateTimes(r,i)}union(e){if(!this.isValid)return this;const r=this.s<e.s?this.s:e.s,i=this.e>e.e?this.e:e.e;return tn.fromDateTimes(r,i)}static merge(e){const[r,i]=e.sort((s,n)=>s.s-n.s).reduce(([s,n],o)=>n?n.overlaps(o)||n.abutsStart(o)?[s,n.union(o)]:[s.concat([n]),o]:[s,o],[[],null]);return i&&r.push(i),r}static xor(e){let r=null,i=0;const s=[],n=e.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),o=Array.prototype.concat(...n),a=o.sort((l,c)=>l.time-c.time);for(const l of a)i+=l.type==="s"?1:-1,i===1?r=l.time:(r&&+r!=+l.time&&s.push(tn.fromDateTimes(r,l.time)),r=null);return tn.merge(s)}difference(...e){return tn.xor([this].concat(e)).map(r=>this.intersection(r)).filter(r=>r&&!r.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()}  ${this.e.toISO()})`:Ex}toLocaleString(e=S4,r={}){return this.isValid?Ya.create(this.s.loc.clone(r),e).formatInterval(this):Ex}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:Ex}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:Ex}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:Ex}toFormat(e,{separator:r="  "}={}){return this.isValid?`${this.s.toFormat(e)}${r}${this.e.toFormat(e)}`:Ex}toDuration(e,r){return this.isValid?this.e.diff(this.s,e,r):hi.invalid(this.invalidReason)}mapEndpoints(e){return tn.fromDateTimes(e(this.s),e(this.e))}}class UP{static hasDST(e=Wn.defaultZone){const r=br.now().setZone(e).set({month:12});return!e.isUniversal&&r.offset!==r.set({month:6}).offset}static isValidIANAZone(e){return ly.isValidZone(e)}static normalizeZone(e){return p_(e,Wn.defaultZone)}static months(e="long",{locale:r=null,numberingSystem:i=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||Ms.create(r,i,n)).months(e)}static monthsFormat(e="long",{locale:r=null,numberingSystem:i=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||Ms.create(r,i,n)).months(e,!0)}static weekdays(e="long",{locale:r=null,numberingSystem:i=null,locObj:s=null}={}){return(s||Ms.create(r,i,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:r=null,numberingSystem:i=null,locObj:s=null}={}){return(s||Ms.create(r,i,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return Ms.create(e).meridiems()}static eras(e="short",{locale:r=null}={}){return Ms.create(r,null,"gregory").eras(e)}static features(){return{relative:Iye()}}}function Rte(t,e){const r=s=>s.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),i=r(e)-r(t);return Math.floor(hi.fromMillis(i).as("days"))}function bUe(t,e,r){const i=[["years",(l,c)=>c.year-l.year],["quarters",(l,c)=>c.quarter-l.quarter+(c.year-l.year)*4],["months",(l,c)=>c.month-l.month+(c.year-l.year)*12],["weeks",(l,c)=>{const h=Rte(l,c);return(h-h%7)/7}],["days",Rte]],s={},n=t;let o,a;for(const[l,c]of i)r.indexOf(l)>=0&&(o=l,s[l]=c(t,e),a=n.plus(s),a>e?(s[l]--,t=n.plus(s)):t=a);return[t,s,a,o]}function wUe(t,e,r,i){let[s,n,o,a]=bUe(t,e,r);const l=e-s,c=r.filter(p=>["hours","minutes","seconds","milliseconds"].indexOf(p)>=0);c.length===0&&(o<e&&(o=s.plus({[a]:1})),o!==s&&(n[a]=(n[a]||0)+l/(o-s)));const h=hi.fromObject(n,i);return c.length>0?hi.fromMillis(l,i).shiftTo(...c).plus(h):h}const TZ={arab:"[-]",arabext:"[-]",bali:"[-]",beng:"[-]",deva:"[-]",fullwide:"[-]",gujr:"[-]",hanidec:"[|||||||||]",khmr:"[-]",knda:"[-]",laoo:"[-]",limb:"[-]",mlym:"[-]",mong:"[-]",mymr:"[-]",orya:"[-]",tamldec:"[-]",telu:"[-]",thai:"[-]",tibt:"[-]",latn:"\\d"},Mte={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},xUe=TZ.hanidec.replace(/[\[|\]]/g,"").split("");function TUe(t){let e=parseInt(t,10);if(isNaN(e)){e="";for(let r=0;r<t.length;r++){const i=t.charCodeAt(r);if(t[r].search(TZ.hanidec)!==-1)e+=xUe.indexOf(t[r]);else for(const s in Mte){const[n,o]=Mte[s];i>=n&&i<=o&&(e+=i-n)}}return parseInt(e,10)}else return e}function rd({numberingSystem:t},e=""){return new RegExp(`${TZ[t||"latn"]}${e}`)}const SUe="missing Intl.DateTimeFormat.formatToParts support";function Ci(t,e=r=>r){return{regex:t,deser:([r])=>e(TUe(r))}}const EUe=String.fromCharCode(160),Yye=`[ ${EUe}]`,Jye=new RegExp(Yye,"g");function CUe(t){return t.replace(/\./g,"\\.?").replace(Jye,Yye)}function Pte(t){return t.replace(/\./g,"").replace(Jye," ").toLowerCase()}function id(t,e){return t===null?null:{regex:RegExp(t.map(CUe).join("|")),deser:([r])=>t.findIndex(i=>Pte(r)===Pte(i))+e}}function Ite(t,e){return{regex:t,deser:([,r,i])=>n6(r,i),groups:e}}function kP(t){return{regex:t,deser:([e])=>e}}function AUe(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function OUe(t,e){const r=rd(e),i=rd(e,"{2}"),s=rd(e,"{3}"),n=rd(e,"{4}"),o=rd(e,"{6}"),a=rd(e,"{1,2}"),l=rd(e,"{1,3}"),c=rd(e,"{1,6}"),h=rd(e,"{1,9}"),p=rd(e,"{2,4}"),f=rd(e,"{4,6}"),m=v=>({regex:RegExp(AUe(v.val)),deser:([b])=>b,literal:!0}),_=(v=>{if(t.literal)return m(v);switch(v.val){case"G":return id(e.eras("short",!1),0);case"GG":return id(e.eras("long",!1),0);case"y":return Ci(c);case"yy":return Ci(p,SB);case"yyyy":return Ci(n);case"yyyyy":return Ci(f);case"yyyyyy":return Ci(o);case"M":return Ci(a);case"MM":return Ci(i);case"MMM":return id(e.months("short",!0,!1),1);case"MMMM":return id(e.months("long",!0,!1),1);case"L":return Ci(a);case"LL":return Ci(i);case"LLL":return id(e.months("short",!1,!1),1);case"LLLL":return id(e.months("long",!1,!1),1);case"d":return Ci(a);case"dd":return Ci(i);case"o":return Ci(l);case"ooo":return Ci(s);case"HH":return Ci(i);case"H":return Ci(a);case"hh":return Ci(i);case"h":return Ci(a);case"mm":return Ci(i);case"m":return Ci(a);case"q":return Ci(a);case"qq":return Ci(i);case"s":return Ci(a);case"ss":return Ci(i);case"S":return Ci(l);case"SSS":return Ci(s);case"u":return kP(h);case"uu":return kP(a);case"uuu":return Ci(r);case"a":return id(e.meridiems(),0);case"kkkk":return Ci(n);case"kk":return Ci(p,SB);case"W":return Ci(a);case"WW":return Ci(i);case"E":case"c":return Ci(r);case"EEE":return id(e.weekdays("short",!1,!1),1);case"EEEE":return id(e.weekdays("long",!1,!1),1);case"ccc":return id(e.weekdays("short",!0,!1),1);case"cccc":return id(e.weekdays("long",!0,!1),1);case"Z":case"ZZ":return Ite(new RegExp(`([+-]${a.source})(?::(${i.source}))?`),2);case"ZZZ":return Ite(new RegExp(`([+-]${a.source})(${i.source})?`),2);case"z":return kP(/[a-z_+-/]{1,256}?/i);case" ":return kP(/[^\S\n\r]/);default:return m(v)}})(t)||{invalidReason:SUe};return _.token=t,_}const RUe={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function MUe(t,e){const{type:r,value:i}=t;if(r==="literal"){const o=/^\s+$/.test(i);return{literal:!o,val:o?" ":i}}const s=e[r];let n=RUe[r];if(typeof n=="object"&&(n=n[s]),n)return{literal:!1,val:n}}function PUe(t){return[`^${t.map(r=>r.regex).reduce((r,i)=>`${r}(${i.source})`,"")}$`,t]}function IUe(t,e,r){const i=t.match(e);if(i){const s={};let n=1;for(const o in r)if(W2(r,o)){const a=r[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(s[a.token.val[0]]=a.deser(i.slice(n,n+l))),n+=l}return[i,s]}else return[i,{}]}function $Ue(t){const e=n=>{switch(n){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let r=null,i;return ni(t.z)||(r=ly.create(t.z)),ni(t.Z)||(r||(r=new Qa(t.Z)),i=t.Z),ni(t.q)||(t.M=(t.q-1)*3+1),ni(t.h)||(t.h<12&&t.a===1?t.h+=12:t.h===12&&t.a===0&&(t.h=0)),t.G===0&&t.y&&(t.y=-t.y),ni(t.u)||(t.S=yZ(t.u)),[Object.keys(t).reduce((n,o)=>{const a=e(o);return a&&(n[a]=t[o]),n},{}),r,i]}let I8=null;function LUe(){return I8||(I8=br.fromMillis(1555555555555)),I8}function DUe(t,e){if(t.literal)return t;const r=Ya.macroTokenToFormatOpts(t.val),i=e0e(r,e);return i==null||i.includes(void 0)?t:i}function Qye(t,e){return Array.prototype.concat(...t.map(r=>DUe(r,e)))}function Kye(t,e,r){const i=Qye(Ya.parseFormat(r),t),s=i.map(o=>OUe(o,t)),n=s.find(o=>o.invalidReason);if(n)return{input:e,tokens:i,invalidReason:n.invalidReason};{const[o,a]=PUe(s),l=RegExp(o,"i"),[c,h]=IUe(e,l,a),[p,f,m]=h?$Ue(h):[null,null,void 0];if(W2(h,"a")&&W2(h,"H"))throw new FA("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:i,regex:l,rawMatches:c,matches:h,result:p,zone:f,specificOffset:m}}}function NUe(t,e,r){const{result:i,zone:s,specificOffset:n,invalidReason:o}=Kye(t,e,r);return[i,s,n,o]}function e0e(t,e){return t?Ya.create(e,t).formatDateTimeParts(LUe()).map(s=>MUe(s,t)):null}const t0e=[0,31,59,90,120,151,181,212,243,273,304,334],r0e=[0,31,60,91,121,152,182,213,244,274,305,335];function Rh(t,e){return new ip("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${t}, which is invalid`)}function i0e(t,e,r){const i=new Date(Date.UTC(t,e-1,r));t<100&&t>=0&&i.setUTCFullYear(i.getUTCFullYear()-1900);const s=i.getUTCDay();return s===0?7:s}function s0e(t,e,r){return r+(MM(t)?r0e:t0e)[e-1]}function n0e(t,e){const r=MM(t)?r0e:t0e,i=r.findIndex(n=>n<e),s=e-r[i];return{month:i+1,day:s}}function EB(t){const{year:e,month:r,day:i}=t,s=s0e(e,r,i),n=i0e(e,r,i);let o=Math.floor((s-n+10)/7),a;return o<1?(a=e-1,o=C4(a)):o>C4(e)?(a=e+1,o=1):a=e,{weekYear:a,weekNumber:o,weekday:n,...o6(t)}}function $te(t){const{weekYear:e,weekNumber:r,weekday:i}=t,s=i0e(e,1,4),n=wO(e);let o=r*7+i-s-3,a;o<1?(a=e-1,o+=wO(a)):o>n?(a=e+1,o-=wO(e)):a=e;const{month:l,day:c}=n0e(a,o);return{year:a,month:l,day:c,...o6(t)}}function $8(t){const{year:e,month:r,day:i}=t,s=s0e(e,r,i);return{year:e,ordinal:s,...o6(t)}}function Lte(t){const{year:e,ordinal:r}=t,{month:i,day:s}=n0e(e,r);return{year:e,month:i,day:s,...o6(t)}}function FUe(t){const e=s6(t.weekYear),r=zg(t.weekNumber,1,C4(t.weekYear)),i=zg(t.weekday,1,7);return e?r?i?!1:Rh("weekday",t.weekday):Rh("week",t.week):Rh("weekYear",t.weekYear)}function UUe(t){const e=s6(t.year),r=zg(t.ordinal,1,wO(t.year));return e?r?!1:Rh("ordinal",t.ordinal):Rh("year",t.year)}function o0e(t){const e=s6(t.year),r=zg(t.month,1,12),i=zg(t.day,1,E4(t.year,t.month));return e?r?i?!1:Rh("day",t.day):Rh("month",t.month):Rh("year",t.year)}function a0e(t){const{hour:e,minute:r,second:i,millisecond:s}=t,n=zg(e,0,23)||e===24&&r===0&&i===0&&s===0,o=zg(r,0,59),a=zg(i,0,59),l=zg(s,0,999);return n?o?a?l?!1:Rh("millisecond",s):Rh("second",i):Rh("minute",r):Rh("hour",e)}const L8="Invalid DateTime",Dte=864e13;function zP(t){return new ip("unsupported zone",`the zone "${t.name}" is not supported`)}function D8(t){return t.weekData===null&&(t.weekData=EB(t.c)),t.weekData}function SC(t,e){const r={ts:t.ts,zone:t.zone,c:t.c,o:t.o,loc:t.loc,invalid:t.invalid};return new br({...r,...e,old:r})}function l0e(t,e,r){let i=t-e*60*1e3;const s=r.offset(i);if(e===s)return[i,e];i-=(s-e)*60*1e3;const n=r.offset(i);return s===n?[i,s]:[t-Math.min(s,n)*60*1e3,Math.max(s,n)]}function Nte(t,e){t+=e*60*1e3;const r=new Date(t);return{year:r.getUTCFullYear(),month:r.getUTCMonth()+1,day:r.getUTCDate(),hour:r.getUTCHours(),minute:r.getUTCMinutes(),second:r.getUTCSeconds(),millisecond:r.getUTCMilliseconds()}}function KL(t,e,r){return l0e(vZ(t),e,r)}function Fte(t,e){const r=t.o,i=t.c.year+Math.trunc(e.years),s=t.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,n={...t.c,year:i,month:s,day:Math.min(t.c.day,E4(i,s))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},o=hi.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),a=vZ(n);let[l,c]=l0e(a,r,t.zone);return o!==0&&(l+=o,c=t.zone.offset(l)),{ts:l,o:c}}function EC(t,e,r,i,s,n){const{setZone:o,zone:a}=r;if(t&&Object.keys(t).length!==0||e){const l=e||a,c=br.fromObject(t,{...r,zone:l,specificOffset:n});return o?c:c.setZone(a)}else return br.invalid(new ip("unparsable",`the input "${s}" can't be parsed as ${i}`))}function VP(t,e,r=!0){return t.isValid?Ya.create(Ms.create("en-US"),{allowZ:r,forceSimple:!0}).formatDateTimeFromString(t,e):null}function N8(t,e){const r=t.c.year>9999||t.c.year<0;let i="";return r&&t.c.year>=0&&(i+="+"),i+=Zn(t.c.year,r?6:4),e?(i+="-",i+=Zn(t.c.month),i+="-",i+=Zn(t.c.day)):(i+=Zn(t.c.month),i+=Zn(t.c.day)),i}function Ute(t,e,r,i,s,n){let o=Zn(t.c.hour);return e?(o+=":",o+=Zn(t.c.minute),(t.c.second!==0||!r)&&(o+=":")):o+=Zn(t.c.minute),(t.c.second!==0||!r)&&(o+=Zn(t.c.second),(t.c.millisecond!==0||!i)&&(o+=".",o+=Zn(t.c.millisecond,3))),s&&(t.isOffsetFixed&&t.offset===0&&!n?o+="Z":t.o<0?(o+="-",o+=Zn(Math.trunc(-t.o/60)),o+=":",o+=Zn(Math.trunc(-t.o%60))):(o+="+",o+=Zn(Math.trunc(t.o/60)),o+=":",o+=Zn(Math.trunc(t.o%60)))),n&&(o+="["+t.zone.ianaName+"]"),o}const c0e={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},kUe={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},zUe={ordinal:1,hour:0,minute:0,second:0,millisecond:0},u0e=["year","month","day","hour","minute","second","millisecond"],VUe=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],BUe=["year","ordinal","hour","minute","second","millisecond"];function kte(t){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[t.toLowerCase()];if(!e)throw new dye(t);return e}function zte(t,e){const r=p_(e.zone,Wn.defaultZone),i=Ms.fromObject(e),s=Wn.now();let n,o;if(ni(t.year))n=s;else{for(const c of u0e)ni(t[c])&&(t[c]=c0e[c]);const a=o0e(t)||a0e(t);if(a)return br.invalid(a);const l=r.offset(s);[n,o]=KL(t,l,r)}return new br({ts:n,zone:r,loc:i,o})}function Vte(t,e,r){const i=ni(r.round)?!0:r.round,s=(o,a)=>(o=_Z(o,i||r.calendary?0:2,!0),e.loc.clone(r).relFormatter(r).format(o,a)),n=o=>r.calendary?e.hasSame(t,o)?0:e.startOf(o).diff(t.startOf(o),o).get(o):e.diff(t,o).get(o);if(r.unit)return s(n(r.unit),r.unit);for(const o of r.units){const a=n(o);if(Math.abs(a)>=1)return s(a,o)}return s(t>e?-0:0,r.units[r.units.length-1])}function Bte(t){let e={},r;return t.length>0&&typeof t[t.length-1]=="object"?(e=t[t.length-1],r=Array.from(t).slice(0,t.length-1)):r=Array.from(t),[e,r]}class br{constructor(e){const r=e.zone||Wn.defaultZone;let i=e.invalid||(Number.isNaN(e.ts)?new ip("invalid input"):null)||(r.isValid?null:zP(r));this.ts=ni(e.ts)?Wn.now():e.ts;let s=null,n=null;if(!i)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(r))[s,n]=[e.old.c,e.old.o];else{const a=r.offset(this.ts);s=Nte(this.ts,a),i=Number.isNaN(s.year)?new ip("invalid input"):null,s=i?null:s,n=i?null:a}this._zone=r,this.loc=e.loc||Ms.create(),this.invalid=i,this.weekData=null,this.c=s,this.o=n,this.isLuxonDateTime=!0}static now(){return new br({})}static local(){const[e,r]=Bte(arguments),[i,s,n,o,a,l,c]=r;return zte({year:i,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},e)}static utc(){const[e,r]=Bte(arguments),[i,s,n,o,a,l,c]=r;return e.zone=Qa.utcInstance,zte({year:i,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},e)}static fromJSDate(e,r={}){const i=p6e(e)?e.valueOf():NaN;if(Number.isNaN(i))return br.invalid("invalid input");const s=p_(r.zone,Wn.defaultZone);return s.isValid?new br({ts:i,zone:s,loc:Ms.fromObject(r)}):br.invalid(zP(s))}static fromMillis(e,r={}){if(Qb(e))return e<-Dte||e>Dte?br.invalid("Timestamp out of range"):new br({ts:e,zone:p_(r.zone,Wn.defaultZone),loc:Ms.fromObject(r)});throw new _h(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,r={}){if(Qb(e))return new br({ts:e*1e3,zone:p_(r.zone,Wn.defaultZone),loc:Ms.fromObject(r)});throw new _h("fromSeconds requires a numerical input")}static fromObject(e,r={}){e=e||{};const i=p_(r.zone,Wn.defaultZone);if(!i.isValid)return br.invalid(zP(i));const s=Wn.now(),n=ni(r.specificOffset)?i.offset(s):r.specificOffset,o=A4(e,kte),a=!ni(o.ordinal),l=!ni(o.year),c=!ni(o.month)||!ni(o.day),h=l||c,p=o.weekYear||o.weekNumber,f=Ms.fromObject(r);if((h||a)&&p)throw new FA("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(c&&a)throw new FA("Can't mix ordinal dates with month/day");const m=p||o.weekday&&!h;let y,_,v=Nte(s,n);m?(y=VUe,_=kUe,v=EB(v)):a?(y=BUe,_=zUe,v=$8(v)):(y=u0e,_=c0e);let b=!1;for(const M of y){const D=o[M];ni(D)?b?o[M]=_[M]:o[M]=v[M]:b=!0}const T=m?FUe(o):a?UUe(o):o0e(o),x=T||a0e(o);if(x)return br.invalid(x);const S=m?$te(o):a?Lte(o):o,[E,A]=KL(S,n,i),R=new br({ts:E,zone:i,o:A,loc:f});return o.weekday&&h&&e.weekday!==R.weekday?br.invalid("mismatched weekday",`you can't specify both a weekday of ${o.weekday} and a date of ${R.toISO()}`):R}static fromISO(e,r={}){const[i,s]=rUe(e);return EC(i,s,r,"ISO 8601",e)}static fromRFC2822(e,r={}){const[i,s]=iUe(e);return EC(i,s,r,"RFC 2822",e)}static fromHTTP(e,r={}){const[i,s]=sUe(e);return EC(i,s,r,"HTTP",r)}static fromFormat(e,r,i={}){if(ni(e)||ni(r))throw new _h("fromFormat requires an input string and a format");const{locale:s=null,numberingSystem:n=null}=i,o=Ms.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0}),[a,l,c,h]=NUe(o,e,r);return h?br.invalid(h):EC(a,l,i,`format ${r}`,e,c)}static fromString(e,r,i={}){return br.fromFormat(e,r,i)}static fromSQL(e,r={}){const[i,s]=hUe(e);return EC(i,s,r,"SQL",e)}static invalid(e,r=null){if(!e)throw new _h("need to specify a reason the DateTime is invalid");const i=e instanceof ip?e:new ip(e,r);if(Wn.throwOnInvalid)throw new j5e(i);return new br({invalid:i})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,r={}){const i=e0e(e,Ms.fromObject(r));return i?i.map(s=>s?s.val:null).join(""):null}static expandFormat(e,r={}){return Qye(Ya.parseFormat(e),Ms.fromObject(r)).map(s=>s.val).join("")}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?D8(this).weekYear:NaN}get weekNumber(){return this.isValid?D8(this).weekNumber:NaN}get weekday(){return this.isValid?D8(this).weekday:NaN}get ordinal(){return this.isValid?$8(this.c).ordinal:NaN}get monthShort(){return this.isValid?UP.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?UP.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?UP.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?UP.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}get isInLeapYear(){return MM(this.year)}get daysInMonth(){return E4(this.year,this.month)}get daysInYear(){return this.isValid?wO(this.year):NaN}get weeksInWeekYear(){return this.isValid?C4(this.weekYear):NaN}resolvedLocaleOptions(e={}){const{locale:r,numberingSystem:i,calendar:s}=Ya.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:r,numberingSystem:i,outputCalendar:s}}toUTC(e=0,r={}){return this.setZone(Qa.instance(e),r)}toLocal(){return this.setZone(Wn.defaultZone)}setZone(e,{keepLocalTime:r=!1,keepCalendarTime:i=!1}={}){if(e=p_(e,Wn.defaultZone),e.equals(this.zone))return this;if(e.isValid){let s=this.ts;if(r||i){const n=e.offset(this.ts),o=this.toObject();[s]=KL(o,n,e)}return SC(this,{ts:s,zone:e})}else return br.invalid(zP(e))}reconfigure({locale:e,numberingSystem:r,outputCalendar:i}={}){const s=this.loc.clone({locale:e,numberingSystem:r,outputCalendar:i});return SC(this,{loc:s})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const r=A4(e,kte),i=!ni(r.weekYear)||!ni(r.weekNumber)||!ni(r.weekday),s=!ni(r.ordinal),n=!ni(r.year),o=!ni(r.month)||!ni(r.day),a=n||o,l=r.weekYear||r.weekNumber;if((a||s)&&l)throw new FA("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(o&&s)throw new FA("Can't mix ordinal dates with month/day");let c;i?c=$te({...EB(this.c),...r}):ni(r.ordinal)?(c={...this.toObject(),...r},ni(r.day)&&(c.day=Math.min(E4(c.year,c.month),c.day))):c=Lte({...$8(this.c),...r});const[h,p]=KL(c,this.o,this.zone);return SC(this,{ts:h,o:p})}plus(e){if(!this.isValid)return this;const r=hi.fromDurationLike(e);return SC(this,Fte(this,r))}minus(e){if(!this.isValid)return this;const r=hi.fromDurationLike(e).negate();return SC(this,Fte(this,r))}startOf(e){if(!this.isValid)return this;const r={},i=hi.normalizeUnit(e);switch(i){case"years":r.month=1;case"quarters":case"months":r.day=1;case"weeks":case"days":r.hour=0;case"hours":r.minute=0;case"minutes":r.second=0;case"seconds":r.millisecond=0;break}if(i==="weeks"&&(r.weekday=1),i==="quarters"){const s=Math.ceil(this.month/3);r.month=(s-1)*3+1}return this.set(r)}endOf(e){return this.isValid?this.plus({[e]:1}).startOf(e).minus(1):this}toFormat(e,r={}){return this.isValid?Ya.create(this.loc.redefaultToEN(r)).formatDateTimeFromString(this,e):L8}toLocaleString(e=S4,r={}){return this.isValid?Ya.create(this.loc.clone(r),e).formatDateTime(this):L8}toLocaleParts(e={}){return this.isValid?Ya.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:r=!1,suppressMilliseconds:i=!1,includeOffset:s=!0,extendedZone:n=!1}={}){if(!this.isValid)return null;const o=e==="extended";let a=N8(this,o);return a+="T",a+=Ute(this,o,r,i,s,n),a}toISODate({format:e="extended"}={}){return this.isValid?N8(this,e==="extended"):null}toISOWeekDate(){return VP(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:r=!1,includeOffset:i=!0,includePrefix:s=!1,extendedZone:n=!1,format:o="extended"}={}){return this.isValid?(s?"T":"")+Ute(this,o==="extended",r,e,i,n):null}toRFC2822(){return VP(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return VP(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?N8(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:r=!1,includeOffsetSpace:i=!0}={}){let s="HH:mm:ss.SSS";return(r||e)&&(i&&(s+=" "),r?s+="z":e&&(s+="ZZ")),VP(this,s,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():L8}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const r={...this.c};return e.includeConfig&&(r.outputCalendar=this.outputCalendar,r.numberingSystem=this.loc.numberingSystem,r.locale=this.loc.locale),r}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,r="milliseconds",i={}){if(!this.isValid||!e.isValid)return hi.invalid("created by diffing an invalid DateTime");const s={locale:this.locale,numberingSystem:this.numberingSystem,...i},n=f6e(r).map(hi.normalizeUnit),o=e.valueOf()>this.valueOf(),a=o?this:e,l=o?e:this,c=wUe(a,l,n,s);return o?c.negate():c}diffNow(e="milliseconds",r={}){return this.diff(br.now(),e,r)}until(e){return this.isValid?tn.fromDateTimes(this,e):this}hasSame(e,r){if(!this.isValid)return!1;const i=e.valueOf(),s=this.setZone(e.zone,{keepLocalTime:!0});return s.startOf(r)<=i&&i<=s.endOf(r)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const r=e.base||br.fromObject({},{zone:this.zone}),i=e.padding?this<r?-e.padding:e.padding:0;let s=["years","months","days","hours","minutes","seconds"],n=e.unit;return Array.isArray(e.unit)&&(s=e.unit,n=void 0),Vte(r,this.plus(i),{...e,numeric:"always",units:s,unit:n})}toRelativeCalendar(e={}){return this.isValid?Vte(e.base||br.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(br.isDateTime))throw new _h("min requires all arguments be DateTimes");return Cte(e,r=>r.valueOf(),Math.min)}static max(...e){if(!e.every(br.isDateTime))throw new _h("max requires all arguments be DateTimes");return Cte(e,r=>r.valueOf(),Math.max)}static fromFormatExplain(e,r,i={}){const{locale:s=null,numberingSystem:n=null}=i,o=Ms.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0});return Kye(o,e,r)}static fromStringExplain(e,r,i={}){return br.fromFormatExplain(e,r,i)}static get DATE_SHORT(){return S4}static get DATE_MED(){return pye}static get DATE_MED_WITH_WEEKDAY(){return W5e}static get DATE_FULL(){return fye}static get DATE_HUGE(){return mye}static get TIME_SIMPLE(){return gye}static get TIME_WITH_SECONDS(){return yye}static get TIME_WITH_SHORT_OFFSET(){return _ye}static get TIME_WITH_LONG_OFFSET(){return vye}static get TIME_24_SIMPLE(){return bye}static get TIME_24_WITH_SECONDS(){return wye}static get TIME_24_WITH_SHORT_OFFSET(){return xye}static get TIME_24_WITH_LONG_OFFSET(){return Tye}static get DATETIME_SHORT(){return Sye}static get DATETIME_SHORT_WITH_SECONDS(){return Eye}static get DATETIME_MED(){return Cye}static get DATETIME_MED_WITH_SECONDS(){return Aye}static get DATETIME_MED_WITH_WEEKDAY(){return X5e}static get DATETIME_FULL(){return Oye}static get DATETIME_FULL_WITH_SECONDS(){return Rye}static get DATETIME_HUGE(){return Mye}static get DATETIME_HUGE_WITH_SECONDS(){return Pye}}function CC(t){if(br.isDateTime(t))return t;if(t&&t.valueOf&&Qb(t.valueOf()))return br.fromJSDate(t);if(t&&typeof t=="object")return br.fromObject(t);throw new _h(`Unknown datetime argument: ${t}, of type ${typeof t}`)}const GUe={year:void 0,month:void 0,day:void 0,weekday:void 0},jUe={hour:void 0,minute:void 0,second:void 0},HUe={timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone},SZ={timeZone:"Etc/UTC"},Np={year:"numeric",month:"numeric",day:"numeric"},AC={year:"numeric",month:"long",day:"numeric"},OC={year:"numeric",month:"short",day:"numeric"},RC={year:"numeric",month:"long",weekday:"long",day:"numeric"},Yu={hour:"numeric",minute:"numeric"},sd={...Yu,second:"numeric"},YE={"short-date":Np,"short-date-short-time":{...Np,...Yu},"short-date-short-time-24":{...Np,...Yu,hour12:!1},"short-date-long-time":{...Np,...sd},"short-date-long-time-24":{...Np,...sd,hour12:!1},"short-date-le":Np,"short-date-le-short-time":{...Np,...Yu},"short-date-le-short-time-24":{...Np,...Yu,hour12:!1},"short-date-le-long-time":{...Np,...sd},"short-date-le-long-time-24":{...Np,...sd,hour12:!1},"long-month-day-year":AC,"long-month-day-year-short-time":{...AC,...Yu},"long-month-day-year-short-time-24":{...AC,...Yu,hour12:!1},"long-month-day-year-long-time":{...AC,...sd},"long-month-day-year-long-time-24":{...AC,...sd,hour12:!1},"day-short-month-year":OC,"day-short-month-year-short-time":{...OC,...Yu},"day-short-month-year-short-time-24":{...OC,...Yu,hour12:!1},"day-short-month-year-long-time":{...OC,...sd},"day-short-month-year-long-time-24":{...OC,...sd,hour12:!1},"long-date":RC,"long-date-short-time":{...RC,...Yu},"long-date-short-time-24":{...RC,...Yu,hour12:!1},"long-date-long-time":{...RC,...sd},"long-date-long-time-24":{...RC,...sd,hour12:!1},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":Yu,"long-time":sd},qUe=il()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"}),h0e={ar:"ar-u-nu-latn-ca-gregory"};let CB=new WeakMap,d0e=YE["short-date-short-time"];function WUe(t){const e=t||d0e;let r=CB.get(e);if(!r){const i=pp(),s=h0e[i]||i;r=new Intl.DateTimeFormat(s,e),CB.set(e,r)}return r}function kA(t){return YE[t]}function cy(t,e){return WUe(e).format(t)}function XUe(t,e=YE["short-date"]){return cy(new Date(t),{...e,...SZ,...jUe})}function ZUe(t,e=YE["short-time"]){return cy(new Date(`1970-01-01T${t}Z`),{...e,...SZ,...GUe})}function YUe(t,e=YE["short-date-short-time"]){const r=br.fromISO(t,{setZone:!0}),i=pp(),s=h0e[i]??i;return r.toLocaleString({...HUe,...e},{locale:s})}VX(()=>{CB=new WeakMap,d0e=YE["short-date-short-time"]});const JUe={ar:"ar-u-nu-latn"};let eD=new WeakMap,p0e={};function QUe(t){const e=t||p0e;if(!eD.has(e)){const r=pp(),i=JUe[pp()]||r;eD.set(e,new Intl.NumberFormat(i,t))}return eD.get(e)}function KUe(t={}){const e={};return t.digitSeparator!=null&&(e.useGrouping=t.digitSeparator),t.places!=null&&(e.minimumFractionDigits=e.maximumFractionDigits=t.places),e}function X2(t,e){return Object.is(t,-0)&&(t=0),QUe(e).format(t)}VX(()=>{eD=new WeakMap,p0e={}});let UT=class extends ji(le){constructor(e){super(e),this.dateFormat=null,this.digitSeparator=!1,this.places=null}formatNumber(e){return X2(e,KUe(this))}formatDate(e,r=!1){return this.dateFormat?cy(e,{...kA(this.dateFormat),...r&&SZ}):this.formatNumber(e)}formatDateOnly(e){const r=(this.dateFormat&&kA(this.dateFormat))??void 0;return XUe(e,r)}formatTimeOnly(e){const r=(this.dateFormat&&kA(this.dateFormat))??void 0;return ZUe(e,r)}formatTimestamp(e){const r=(this.dateFormat&&kA(this.dateFormat))??void 0;return YUe(e,r)}formatRasterPixelValue(e){return e.includes("-")?e:e.trim().includes(",")?this._formatDelimitedString(e,",",", "):e.trim().includes(";")?this._formatDelimitedString(e,";","; "):e.trim().includes(" ")?this._formatDelimitedString(e," "," "):this.formatNumber(Number(e))}_formatDelimitedString(e,r,i){return e&&r&&i?e.trim().split(r).map(s=>this.formatNumber(Number(s))).join(i):e}};u([it(qUe)],UT.prototype,"dateFormat",void 0),u([d({type:Boolean,json:{write:!0}})],UT.prototype,"digitSeparator",void 0),u([d({type:Qi,json:{write:!0}})],UT.prototype,"places",void 0),UT=u([P("esri.popup.support.FieldInfoFormat")],UT);const zA=UT;var AB;let gd=AB=class extends le{constructor(t){super(t),this.fieldName=null,this.format=null,this.isEditable=!0,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new AB({fieldName:this.fieldName,format:this.format?K(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};u([d({type:String,json:{write:!0}})],gd.prototype,"fieldName",void 0),u([d({type:zA,json:{write:!0}})],gd.prototype,"format",void 0),u([d({type:Boolean,json:{write:{alwaysWriteDefaults:!0},default:!0}})],gd.prototype,"isEditable",void 0),u([d({type:String,json:{write:!0}})],gd.prototype,"label",void 0),u([it(new $r({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],gd.prototype,"stringFieldOption",void 0),u([d({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],gd.prototype,"statisticType",void 0),u([d({type:String,json:{write:!0}})],gd.prototype,"tooltip",void 0),u([d({type:Boolean,json:{write:!0}})],gd.prototype,"visible",void 0),gd=AB=u([P("esri.popup.FieldInfo")],gd);const EZ=gd;var OB;let ig=OB=class extends yv{constructor(t){super(t),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(t,e){e.fieldInfos=t&&t.map(r=>r.toJSON())}clone(){return new OB(K({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};u([d({type:Object,json:{write:!0}})],ig.prototype,"attributes",void 0),u([d({type:String,json:{write:!0}})],ig.prototype,"description",void 0),u([d({type:[EZ]})],ig.prototype,"fieldInfos",void 0),u([ke("fieldInfos")],ig.prototype,"writeFieldInfos",null),u([d({type:String,json:{write:!0}})],ig.prototype,"title",void 0),u([d({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],ig.prototype,"type",void 0),ig=OB=u([P("esri.popup.content.FieldsContent")],ig);const SR=ig;let E1=class extends le{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};u([d({type:String,json:{write:!0}})],E1.prototype,"altText",void 0),u([d({type:String,json:{write:!0}})],E1.prototype,"caption",void 0),u([d({type:String,json:{write:!0}})],E1.prototype,"title",void 0),u([d({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],E1.prototype,"type",void 0),E1=u([P("esri.popup.content.mixins.MediaInfo")],E1);const CZ=E1;var RB;let kT=RB=class extends we{constructor(t){super(t),this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new RB({fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};u([d()],kT.prototype,"fieldName",void 0),u([d()],kT.prototype,"tooltip",void 0),u([d()],kT.prototype,"value",void 0),kT=RB=u([P("esri.popup.content.support.ChartMediaInfoValueSeries")],kT);const e8e=kT;var MB;let C1=MB=class extends le{constructor(t){super(t),this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new MB({fields:K(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};u([d({type:[String],json:{write:!0}})],C1.prototype,"fields",void 0),u([d({type:String,json:{write:!0}})],C1.prototype,"normalizeField",void 0),u([d({type:[e8e],json:{read:!1}})],C1.prototype,"series",void 0),u([d({type:String,json:{write:!0}})],C1.prototype,"tooltipField",void 0),C1=MB=u([P("esri.popup.content.support.ChartMediaInfoValue")],C1);const t8e=C1;let VA=class extends CZ{constructor(e){super(e),this.type=null,this.value=null}};u([d({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],VA.prototype,"type",void 0),u([d({type:t8e,json:{write:!0}})],VA.prototype,"value",void 0),VA=u([P("esri.popup.content.mixins.ChartMediaInfo")],VA);const a6=VA,l6=il()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var PB;let tD=PB=class extends a6{constructor(t){super(t),this.type="bar-chart"}clone(){return new PB({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:l6.write}})],tD.prototype,"type",void 0),tD=PB=u([P("esri.popup.content.BarChartMediaInfo")],tD);const f0e=tD;var IB;let rD=IB=class extends a6{constructor(t){super(t),this.type="column-chart"}clone(){return new IB({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:l6.write}})],rD.prototype,"type",void 0),rD=IB=u([P("esri.popup.content.ColumnChartMediaInfo")],rD);const m0e=rD;var $B;let BA=$B=class extends le{constructor(t){super(t),this.linkURL=null,this.sourceURL=null}clone(){return new $B({linkURL:this.linkURL,sourceURL:this.sourceURL})}};u([d({type:String,json:{write:!0}})],BA.prototype,"linkURL",void 0),u([d({type:String,json:{write:!0}})],BA.prototype,"sourceURL",void 0),BA=$B=u([P("esri.popup.content.support.ImageMediaInfoValue")],BA);const r8e=BA;var LB;let zT=LB=class extends CZ{constructor(t){super(t),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new LB({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};u([d({type:Number,json:{write:!0}})],zT.prototype,"refreshInterval",void 0),u([d({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],zT.prototype,"type",void 0),u([d({type:r8e,json:{write:!0}})],zT.prototype,"value",void 0),zT=LB=u([P("esri.popup.content.ImageMediaInfo")],zT);const g0e=zT;var DB;let iD=DB=class extends a6{constructor(t){super(t),this.type="line-chart"}clone(){return new DB({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:l6.write}})],iD.prototype,"type",void 0),iD=DB=u([P("esri.popup.content.LineChartMediaInfo")],iD);const y0e=iD;var NB;let sD=NB=class extends a6{constructor(t){super(t),this.type="pie-chart"}clone(){return new NB({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:l6.write}})],sD.prototype,"type",void 0),sD=NB=u([P("esri.popup.content.PieChartMediaInfo")],sD);const _0e=sD,v0e={base:CZ,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":f0e,"column-chart":m0e,"line-chart":y0e,"pie-chart":_0e,image:g0e}};var FB;let yd=FB=class extends yv{constructor(t){super(t),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(t){return t&&t.map(e=>e.type==="image"?g0e.fromJSON(e):e.type==="barchart"?f0e.fromJSON(e):e.type==="columnchart"?m0e.fromJSON(e):e.type==="linechart"?y0e.fromJSON(e):e.type==="piechart"?_0e.fromJSON(e):void 0).filter(Boolean)}writeMediaInfos(t,e){e.mediaInfos=t&&t.map(r=>r.toJSON())}clone(){return new FB(K({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};u([d()],yd.prototype,"activeMediaInfoIndex",void 0),u([d({type:Object,json:{write:!0}})],yd.prototype,"attributes",void 0),u([d({type:String,json:{write:!0}})],yd.prototype,"description",void 0),u([d({types:[v0e]})],yd.prototype,"mediaInfos",void 0),u([Ae("mediaInfos")],yd.prototype,"readMediaInfos",null),u([ke("mediaInfos")],yd.prototype,"writeMediaInfos",null),u([d({type:String,json:{write:!0}})],yd.prototype,"title",void 0),u([d({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],yd.prototype,"type",void 0),yd=FB=u([P("esri.popup.content.MediaContent")],yd);const O4=yd;var UB;let GA=UB=class extends le{constructor(t){super(t),this.field=null,this.order=null}clone(){return new UB({field:this.field,order:this.order})}};u([d({type:String,json:{write:!0}})],GA.prototype,"field",void 0),u([d({type:["asc","desc"],json:{write:!0}})],GA.prototype,"order",void 0),GA=UB=u([P("esri.popup.support.RelatedRecordsInfoFieldOrder")],GA);const AZ=GA;let of=class extends ji(yv){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};u([d({type:String,json:{write:!0}})],of.prototype,"description",void 0),u([d({type:Number,json:{type:Qi,write:!0}})],of.prototype,"displayCount",void 0),u([d({type:["list"],json:{write:!0}})],of.prototype,"displayType",void 0),u([d({type:[AZ],json:{write:!0}})],of.prototype,"orderByFields",void 0),u([d({type:Number,json:{type:Qi,write:!0}})],of.prototype,"relationshipId",void 0),u([d({type:String,json:{write:!0}})],of.prototype,"title",void 0),u([d({type:["relationship"],readOnly:!0,json:{read:!1,write:!0}})],of.prototype,"type",void 0),of=u([P("esri.popup.content.RelationshipContent")],of);const R4=of;var kB;let jA=kB=class extends yv{constructor(t){super(t),this.text=null,this.type="text"}clone(){return new kB({text:this.text})}};u([d({type:String,json:{write:!0}})],jA.prototype,"text",void 0),u([d({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],jA.prototype,"type",void 0),jA=kB=u([P("esri.popup.content.TextContent")],jA);const M4=jA,i8e={base:null,key:"type",typeMap:{attachment:TR,media:O4,text:M4,expression:gZ,field:SR,relationship:R4}};var zB;let A1=zB=class extends le{constructor(t){super(t),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new zB({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([d({type:String,json:{write:!0}})],A1.prototype,"name",void 0),u([d({type:String,json:{write:!0}})],A1.prototype,"title",void 0),u([d({type:String,json:{write:!0}})],A1.prototype,"expression",void 0),u([d({type:["string","number"],json:{write:!0}})],A1.prototype,"returnType",void 0),A1=zB=u([P("esri.popup.ExpressionInfo")],A1);const s8e=A1;var VB;let HA=VB=class extends le{constructor(t){super(t),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new VB({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};u([d({type:Boolean,json:{write:!0}})],HA.prototype,"returnTopmostRaster",void 0),u([d({type:Boolean,json:{write:!0}})],HA.prototype,"showNoDataRecords",void 0),HA=VB=u([P("esri.popup.LayerOptions")],HA);const n8e=HA;var BB;let qA=BB=class extends le{constructor(t){super(t),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new BB({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?K(this.orderByFields):null})}};u([d({type:Boolean,json:{write:!0}})],qA.prototype,"showRelatedRecords",void 0),u([d({type:[AZ],json:{write:!0}})],qA.prototype,"orderByFields",void 0),qA=BB=u([P("esri.popup.RelatedRecordsInfo")],qA);const o8e=qA;var GB;let Ju=GB=class extends t6(we){constructor(t){super(t),this.active=!1,this.className=null,this.disabled=!1,this.icon=null,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new GB({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};u([d()],Ju.prototype,"active",void 0),u([d()],Ju.prototype,"className",void 0),u([d()],Ju.prototype,"disabled",void 0),u([d()],Ju.prototype,"icon",void 0),u([d()],Ju.prototype,"id",void 0),u([d()],Ju.prototype,"indicator",void 0),u([d()],Ju.prototype,"title",void 0),u([d()],Ju.prototype,"type",void 0),u([d()],Ju.prototype,"visible",void 0),Ju=GB=u([P("esri.support.actions.ActionBase")],Ju);const OZ=Ju;var jB;let nD=jB=class extends OZ{constructor(t){super(t),this.image=null,this.type="button"}clone(){return new jB({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};u([d()],nD.prototype,"image",void 0),nD=jB=u([P("esri.support.Action.ActionButton")],nD);const HB=nD;var qB;let WA=qB=class extends OZ{constructor(t){super(t),this.image=null,this.type="toggle",this.value=!1}clone(){return new qB({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};u([d()],WA.prototype,"image",void 0),u([d()],WA.prototype,"value",void 0),WA=qB=u([P("esri.support.Action.ActionToggle")],WA);const a8e=WA,l8e="esri.PopupTemplate",c8e=Q.getLogger(l8e),MC="relationships/",Gte="expression/",u8e=Pt.ofType({key:"type",defaultKeyValue:"button",base:OZ,typeMap:{button:HB,toggle:a8e}}),h8e={base:yv,key:"type",typeMap:{media:O4,custom:B5e,text:M4,attachments:TR,fields:SR,expression:gZ,relationship:R4}},d8e=["attachments","fields","media","text","expression","relationship"];let lo=class extends ji(le){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map(r=>bp(h8e,r)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||Iu(e)?e:(c8e.error("content error","unsupported content value",{value:e}),null)}readContent(e,r){const{popupElements:i}=r;return Array.isArray(i)&&i.length>0?this._readPopupInfoElements(r.description,r.mediaInfos,i):this._readPopupInfo(r)}writeContent(e,r,i,s){typeof e!="string"?Array.isArray(e)&&(r.popupElements=e.filter(n=>d8e.includes(n.type)).map(n=>n&&n.toJSON(s)),r.popupElements.forEach(n=>{n.type==="attachments"?this._writeAttachmentContent(r):n.type==="media"?this._writeMediaContent(n,r):n.type==="text"?this._writeTextContent(n,r):n.type==="relationship"&&this._writeRelationshipContent(n,r)})):r.description=e}writeFieldInfos(e,r,i,s){const{content:n}=this,o=Array.isArray(n)?n:null;if(e){const a=o?o.filter(c=>c.type==="fields"):[],l=a.length&&a.every(c=>c.fieldInfos?.length);r.fieldInfos=e.filter(Boolean).map(c=>{const h=c.toJSON(s);return l&&(h.visible=!1),h})}if(o)for(const a of o)a.type==="fields"&&this._writeFieldsContent(a,r)}writeLayerOptions(e,r,i,s){r[i]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(s)}writeTitle(e,r){r.title=e||""}async collectRequiredFields(e,r){const i=this.expressionInfos||[];await this._collectExpressionInfoFields(e,r,[...i,...this._getContentExpressionInfos(this.content,i)]),xR(e,r,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const r=new Set;return await this.collectRequiredFields(r,e),[...r].sort()}_writeFieldsContent(e,r){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const i=K(e.fieldInfos);Array.isArray(r.fieldInfos)?i.forEach(s=>{const n=r.fieldInfos.find(o=>o.fieldName.toLowerCase()===s.fieldName.toLowerCase());n?n.visible=!0:r.fieldInfos.push(s)}):r.fieldInfos=i}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,r){const i=e.orderByFields?.map(n=>this._toFieldOrderJSON(n,e.relationshipId))||[],s=[...r.relatedRecordsInfo?.orderByFields||[],...i];r.relatedRecordsInfo={showRelatedRecords:!0,...s?.length&&{orderByFields:s}}}_writeTextContent(e,r){!r.description&&e.text&&(r.description=e.text)}_writeMediaContent(e,r){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const i=K(e.mediaInfos);Array.isArray(r.mediaInfos)?r.mediaInfos=[...r.mediaInfos,...i]:r.mediaInfos=i}_readPopupInfoElements(e,r,i){const s={description:!1,mediaInfos:!1};return i.map(n=>n.type==="media"?(n.mediaInfos||!r||s.mediaInfos||(n.mediaInfos=r,s.mediaInfos=!0),O4.fromJSON(n)):n.type==="text"?(n.text||!e||s.description||(n.text=e,s.description=!0),M4.fromJSON(n)):n.type==="attachments"?TR.fromJSON(n):n.type==="fields"?SR.fromJSON(n):n.type==="expression"?gZ.fromJSON(n):n.type==="relationship"?R4.fromJSON(n):void 0).filter(Boolean)}_toRelationshipContent(e){const{field:r,order:i}=e;if(!r?.startsWith(MC))return null;const s=r.replace(MC,"").split("/");if(s.length!==2)return null;const n=parseInt(s[0],10),o=s[1];return typeof n=="number"&&o?R4.fromJSON({relationshipId:n,orderByFields:[{field:o,order:i}]}):null}_toFieldOrderJSON(e,r){const{order:i,field:s}=e;return{field:`${MC}${r}/${s}`,order:i}}_readPopupInfo({description:e,mediaInfos:r,showAttachments:i,relatedRecordsInfo:s={showRelatedRecords:!1}}){const n=[];e?n.push(new M4({text:e})):n.push(new SR),Array.isArray(r)&&r.length&&n.push(O4.fromJSON({mediaInfos:r})),i&&n.push(TR.fromJSON({displayType:"auto"}));const{showRelatedRecords:o,orderByFields:a}=s;return o&&a?.length&&a.forEach(l=>{const c=this._toRelationshipContent(l);c&&n.push(c)}),n.length?n:e}_getContentElementFields(e){const r=e?.type;if(r==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(r==="custom")return e.outFields||[];if(r==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos??this.fieldInfos)];if(r==="media"){const i=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...i.reduce((s,n)=>[...s,...this._getMediaInfoFields(n)],[])]}return r==="text"?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:r,title:i,value:s}=e,n=s||{},{fields:o,normalizeField:a,tooltipField:l,sourceURL:c,linkURL:h}=n,p=[...this._extractFieldNames(i),...this._extractFieldNames(r),...this._extractFieldNames(c),...this._extractFieldNames(h),...o??[]];return a&&p.push(a),l&&p.push(l),p}_getContentExpressionInfos(e,r){return Array.isArray(e)?e.reduce((i,s)=>[...i,...s.type==="expression"&&s.expressionInfo?[s.expressionInfo]:[]],r):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((r,i)=>[...r,...this._getContentElementFields(i)],[]):[]}async _collectExpressionInfoFields(e,r,i){i&&await Promise.all(i.map(s=>Dl(e,r,s.expression)))}_getFieldInfoFields(e){return e?e.filter(r=>r.visible===void 0||!!r.visible).map(r=>r.fieldName).filter(r=>!r.startsWith(MC)&&!r.startsWith(Gte)):[]}_getActionsFields(e){return e?e.toArray().reduce((r,i)=>[...r,...this._getActionFields(i)],[]):[]}_getActionFields(e){const{className:r,title:i,type:s}=e,n=s==="button"||s==="toggle"?e.image:"";return[...this._extractFieldNames(i),...this._extractFieldNames(r),...this._extractFieldNames(n)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){if(!e||typeof e!="string")return[];const r=/{[^}]*}/g,i=e.match(r);if(!i)return[];const s=/\{(\w+):.+\}/,n=i.filter(o=>!(o.indexOf(`{${MC}`)===0||o.indexOf(`{${Gte}`)===0)).map(o=>o.replace(s,"{$1}"));return n?n.map(o=>o.slice(1,-1)):[]}};u([d({type:u8e})],lo.prototype,"actions",void 0),u([d()],lo.prototype,"content",void 0),u([wr("content")],lo.prototype,"castContent",null),u([Ae("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],lo.prototype,"readContent",null),u([ke("content",{popupElements:{type:Pt.ofType(i8e)},showAttachments:{type:Boolean},mediaInfos:{type:Pt.ofType(v0e)},description:{type:String},relatedRecordsInfo:{type:o8e}})],lo.prototype,"writeContent",null),u([d({type:[s8e],json:{write:!0}})],lo.prototype,"expressionInfos",void 0),u([d({type:[EZ]})],lo.prototype,"fieldInfos",void 0),u([ke("fieldInfos")],lo.prototype,"writeFieldInfos",null),u([d({type:n8e})],lo.prototype,"layerOptions",void 0),u([ke("layerOptions")],lo.prototype,"writeLayerOptions",null),u([d({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],lo.prototype,"lastEditInfoEnabled",void 0),u([d()],lo.prototype,"outFields",void 0),u([d()],lo.prototype,"overwriteActions",void 0),u([d()],lo.prototype,"returnGeometry",void 0),u([d({json:{type:String}})],lo.prototype,"title",void 0),u([ke("title")],lo.prototype,"writeTitle",null),lo=u([P("esri.PopupTemplate")],lo);const _v=lo,jte=new $r({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let p8e=0,VT=class extends le{constructor(e){super(e),this.id="sym"+p8e++,this.type=null,this.color=new Ne([0,0,0,1])}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,r){}hash(){return JSON.stringify(this.toJSON())}clone(){}};u([d({type:jte.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:jte.write}}})],VT.prototype,"type",void 0),u([d({type:Ne,json:{write:{allowNull:!0}}})],VT.prototype,"color",void 0),u([Ae("color")],VT.prototype,"readColor",null),VT=u([P("esri.symbols.Symbol")],VT);const Dc=VT;var WB;let A0=WB=class extends Dc{constructor(t){super(t),this.data=null,this.type="cim"}readData(t,e){return e}writeData(t,e){Object.assign(e,t)}async collectRequiredFields(t,e){if(this.data?.type==="CIMSymbolReference"){const r=this.data.primitiveOverrides;if(r){const i=r.map(s=>{const n=s.valueExpressionInfo;return Dl(t,e,n.expression)});await Promise.all(i)}}}clone(){return new WB({data:K(this.data)})}hash(){return oX(JSON.stringify(this.data)).toString()}};u([d({json:{write:!1}})],A0.prototype,"color",void 0),u([d({json:{write:!0}})],A0.prototype,"data",void 0),u([Ae("data",["symbol"])],A0.prototype,"readData",null),u([ke("data",{})],A0.prototype,"writeData",null),u([it({CIMSymbolReference:"cim"},{readOnly:!0})],A0.prototype,"type",void 0),A0=WB=u([P("esri.symbols.CIMSymbol")],A0);const JE=A0;let BT=class extends le{constructor(e){super(e),this.enabled=!0,this.type=null,this.ignoreDrivers=!1}writeEnabled(e,r,i){e||(r[i]=e)}};u([d({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],BT.prototype,"enabled",void 0),u([ke("enabled")],BT.prototype,"writeEnabled",null),u([d({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],BT.prototype,"type",void 0),BT=u([P("esri.symbols.Symbol3DLayer")],BT);const wm=BT,f8e=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,m8e="screenUtils.toPt: input not recognized!",b0e=96;function _o(t){return t?t/72*b0e:0}function Uh(t){return t?72*t/b0e:0}function Kr(t){if(typeof t=="string"){const e=t.match(f8e);if(e){const r=Number(e[1]),i=e[3]&&e[3].toLowerCase(),s=t.charAt(0)==="-",n=i==="px"?Uh(r):r;return s?-n:n}return console.warn(m8e),null}return t}function kh(t=0,e=0){return{x:t,y:e}}function Ji(t=0,e=0){return[t,e]}function w0e(t=0,e=0){return[t,e]}function jo(t=0,e=0,r=0){return[t,e,r]}function A$t(t){return t}function O$t(t){return t}function R$t(t){return t}function Pf(t,e){return e?(e[0]=t.x,e[1]=t.y,e.length>2&&(e[2]=0),e):[t.x,t.y]}function g8e(t,e){const r=e.transparency!=null?G2(e.transparency):1,i=e.color;return i&&Array.isArray(i)?new Ne([i[0]||0,i[1]||0,i[2]||0,r]):null}function y8e(t,e){e.color=t.toJSON().slice(0,3);const r=Y5(t.a);r!==0&&(e.transparency=r)}const wy={type:Ne,json:{type:[Qi],default:null,read:{source:["color","transparency"],reader:g8e},write:{target:{color:{type:[Qi]},transparency:{type:Qi}},writer:y8e}}},om={type:Number,cast:Kr,json:{write:!0}};let O1=class extends le{constructor(e){super(e),this.color=new Ne([0,0,0,1]),this.extensionLength=0,this.size=Uh(1)}clone(){}cloneProperties(){return{color:K(this.color),size:this.size,extensionLength:this.extensionLength}}};u([d({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],O1.prototype,"type",void 0),u([d(wy)],O1.prototype,"color",void 0),u([d({...om,json:{write:{overridePolicy:t=>({enabled:!!t})}}})],O1.prototype,"extensionLength",void 0),u([d(om)],O1.prototype,"size",void 0),O1=u([P("esri.symbols.edges.Edges3D")],O1);const RZ=O1;var XB;let oD=XB=class extends RZ{constructor(t){super(t),this.type="sketch"}clone(){return new XB(this.cloneProperties())}};u([it({sketch:"sketch"},{readOnly:!0})],oD.prototype,"type",void 0),oD=XB=u([P("esri.symbols.edges.SketchEdges3D")],oD);const _8e=oD;var ZB;let aD=ZB=class extends RZ{constructor(t){super(t),this.type="solid"}clone(){return new ZB(this.cloneProperties())}};u([it({solid:"solid"},{readOnly:!0})],aD.prototype,"type",void 0),aD=ZB=u([P("esri.symbols.support.SolidEdges3D")],aD);const x0e=aD,T0e={types:{key:"type",base:RZ,typeMap:{solid:x0e,sketch:_8e}},json:{write:!0}};var YB;let bu=YB=class extends le{constructor(t){super(t),this.color=null}clone(){const t={color:this.color!=null?this.color.clone():null};return new YB(t)}};u([d(wy)],bu.prototype,"color",void 0),bu=YB=u([P("esri.symbols.support.Symbol3DMaterial")],bu);var JB;let O0=JB=class extends wm{constructor(t){super(t),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new JB({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};u([it({Extrude:"extrude"},{readOnly:!0})],O0.prototype,"type",void 0),u([d({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],O0.prototype,"size",void 0),u([d({type:bu,json:{write:!0}})],O0.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],O0.prototype,"castShadows",void 0),u([d(T0e)],O0.prototype,"edges",void 0),O0=JB=u([P("esri.symbols.ExtrudeSymbol3DLayer")],O0);const S0e=O0;let XA=class extends Dc{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};u([it({esriSLS:"simple-line"},{readOnly:!0})],XA.prototype,"type",void 0),u([d({type:Number,cast:Kr,json:{write:!0}})],XA.prototype,"width",void 0),XA=u([P("esri.symbols.LineSymbol")],XA);const v8e=XA,b8e=["begin","end","begin-end"],E0e=["arrow","circle","square","diamond","cross","x"];var QB;let af=QB=class extends le{constructor(t){super(t),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(t,e,r,i){e[r]=i?.origin==="web-map"?"arrow":t}set color(t){this._set("color",t)}readColor(t){return t&&t[0]!=null?[t[0],t[1],t[2],t[3]/255]:t}writeColor(t,e,r,i){i?.origin==="web-map"||(e[r]=t)}clone(){return new QB({color:K(this.color),placement:this.placement,style:this.style})}hash(){return`${this.placement}.${this.color?.hash()}.${this.style}`}};u([d({type:["begin","end","begin-end"],json:{write:!0}})],af.prototype,"placement",void 0),u([it({"line-marker":"line-marker"},{readOnly:!0}),d({json:{origins:{"web-map":{write:!1}}}})],af.prototype,"type",void 0),u([d({type:E0e})],af.prototype,"style",void 0),u([ke("style")],af.prototype,"writeStyle",null),u([d({type:Ne,value:null,json:{write:{allowNull:!0}}})],af.prototype,"color",null),u([Ae("color")],af.prototype,"readColor",null),u([ke("color")],af.prototype,"writeColor",null),af=QB=u([P("esri.symbols.LineSymbolMarker")],af);const w8e=af;var KB;const F8=new $r({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let sg=KB=class extends v8e{constructor(...t){super(...t),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(t,e,r,i,s,n){if(t&&typeof t!="string")return t;const o={};return t!=null&&(o.style=t),e!=null&&(o.color=e),r!=null&&(o.width=Kr(r)),i!=null&&(o.cap=i),s!=null&&(o.join=s),n!=null&&(o.miterLimit=Kr(n)),o}clone(){return new KB({color:K(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:this.marker?.clone()})}hash(){return`${super.hash()}.${this.color?.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${this.marker?.hash()}`}};u([it({esriSLS:"simple-line"},{readOnly:!0})],sg.prototype,"type",void 0),u([d({type:F8.apiValues,json:{read:F8.read,write:F8.write}})],sg.prototype,"style",void 0),u([d({type:["butt","round","square"],json:{write:{overridePolicy:(t,e,r)=>({enabled:t!=="round"&&(r==null||r.origin==null)})}}})],sg.prototype,"cap",void 0),u([d({type:["miter","round","bevel"],json:{write:{overridePolicy:(t,e,r)=>({enabled:t!=="round"&&(r==null||r.origin==null)})}}})],sg.prototype,"join",void 0),u([d({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":w8e}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],sg.prototype,"marker",void 0),u([d({type:Number,json:{read:!1,write:!1}})],sg.prototype,"miterLimit",void 0),sg=KB=u([P("esri.symbols.SimpleLineSymbol")],sg);const $u=sg;let ZA=class extends Dc{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};u([d({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":$u}},json:{default:null,write:!0}})],ZA.prototype,"outline",void 0),u([d({type:["simple-fill","picture-fill"],readOnly:!0})],ZA.prototype,"type",void 0),ZA=u([P("esri.symbols.FillSymbol")],ZA);const C0e=ZA;let lD=class extends le{constructor(e){super(e)}clone(){}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],lD.prototype,"type",void 0),lD=u([P("esri.symbols.patterns.LinePattern3D")],lD);const A0e=lD,x8e=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var eG;const T8e=il()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let YA=eG=class extends A0e{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new eG(t)}};u([d({type:["style"]})],YA.prototype,"type",void 0),u([it(T8e),d({type:x8e})],YA.prototype,"style",void 0),YA=eG=u([P("esri.symbols.patterns.LineStylePattern3D")],YA);const MZ=YA;let cD=class extends le{constructor(e){super(e)}clone(){}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],cD.prototype,"type",void 0),cD=u([P("esri.symbols.patterns.Pattern3D")],cD);const O0e=cD,S8e=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var tG;let JA=tG=class extends O0e{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new tG(t)}};u([d({type:["style"]})],JA.prototype,"type",void 0),u([d({type:S8e,json:{read:!0,write:!0}})],JA.prototype,"style",void 0),JA=tG=u([P("esri.symbols.patterns.StylePattern3D")],JA);const R0e=JA,E8e={types:{key:"type",base:O0e,typeMap:{style:R0e}},json:{write:!0}},M0e={types:{key:"type",base:A0e,typeMap:{style:MZ}},json:{write:!0}},TO=new Ne("white");new Ne("black");const C8e=new Ne([255,255,255,0]);function A8e(t){return t.r===0&&t.g===0&&t.b===0}var rG;let SO=rG=class extends bu{constructor(t){super(t),this.colorMixMode=null}clone(){const t={color:this.color!=null?this.color.clone():null,colorMixMode:this.colorMixMode};return new rG(t)}};u([it({multiply:"multiply",replace:"replace",tint:"tint"})],SO.prototype,"colorMixMode",void 0),SO=rG=u([P("esri.symbols.support.Symbol3DFillMaterial")],SO);function pn(t=D0e){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function Ew(t,e,r,i,s,n,o=pn()){return o[0]=t,o[1]=e,o[2]=r,o[3]=i,o[4]=s,o[5]=n,o}function D$t(t,e){const r=isFinite(t[2])||isFinite(t[5]);return new ur(r?{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],zmin:t[2],zmax:t[5],spatialReference:e}:{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],spatialReference:e})}function Z2(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[3]),t[4]=Math.max(t[4],e[4]),t[5]=Math.max(t[5],e[5])}function O8e(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[3]=Math.max(t[3],e[2]),t[4]=Math.max(t[4],e[3])}function am(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[0]),t[4]=Math.max(t[4],e[1]),t[5]=Math.max(t[5],e[2])}function gu(t,e,r=0,i=e.length/3){let s=t[0],n=t[1],o=t[2],a=t[3],l=t[4],c=t[5];for(let h=0;h<i;h++)s=Math.min(s,e[r+3*h]),n=Math.min(n,e[r+3*h+1]),o=Math.min(o,e[r+3*h+2]),a=Math.max(a,e[r+3*h]),l=Math.max(l,e[r+3*h+1]),c=Math.max(c,e[r+3*h+2]);t[0]=s,t[1]=n,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function U8(t,e,r){const i=e.length;let s=t[0],n=t[1],o=t[2],a=t[3],l=t[4],c=t[5];if(r)for(let h=0;h<i;h++){const p=e[h];s=Math.min(s,p[0]),n=Math.min(n,p[1]),o=Math.min(o,p[2]),a=Math.max(a,p[0]),l=Math.max(l,p[1]),c=Math.max(c,p[2])}else for(let h=0;h<i;h++){const p=e[h];s=Math.min(s,p[0]),n=Math.min(n,p[1]),a=Math.max(a,p[0]),l=Math.max(l,p[1])}t[0]=s,t[1]=n,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function R8e(t){for(let e=0;e<6;e++)if(!isFinite(t[e]))return!1;return!0}function nx(t){return t[0]>=t[3]?0:t[3]-t[0]}function ox(t){return t[1]>=t[4]?0:t[4]-t[1]}function vv(t){return t[2]>=t[5]?0:t[5]-t[2]}function P0e(t){const e=nx(t),r=vv(t),i=ox(t);return Math.sqrt(e*e+r*r+i*i)}function sp(t,e=[0,0,0]){return e[0]=t[0]+nx(t)/2,e[1]=t[1]+ox(t)/2,e[2]=t[2]+vv(t)/2,e}function BP(t,e=[0,0,0]){return e[0]=nx(t),e[1]=ox(t),e[2]=vv(t),e}function PZ(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[0]<=t[3]&&e[1]<=t[4]&&e[2]<=t[5]}function N$t(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[3]<=t[3]&&e[4]<=t[4]&&e[5]<=t[5]}function M8e(t,e){return Math.max(e[0],t[0])<=Math.min(e[3],t[3])&&Math.max(e[1],t[1])<=Math.min(e[4],t[4])&&Math.max(e[2],t[2])<=Math.min(e[5],t[5])}function np(t,e){return e==null||M8e(t,e)}function I0e(t,e,r,i,s=t){return s[0]=t[0]+e,s[1]=t[1]+r,s[2]=t[2]+i,s[3]=t[3]+e,s[4]=t[4]+r,s[5]=t[5]+i,s}function F$t(t,e,r=t){const i=t[0]+nx(t)/2,s=t[1]+ox(t)/2,n=t[2]+vv(t)/2;return r[0]=i+(t[0]-i)*e,r[1]=s+(t[1]-s)*e,r[2]=n+(t[2]-n)*e,r[3]=i+(t[3]-i)*e,r[4]=s+(t[4]-s)*e,r[5]=n+(t[5]-n)*e,r}function $0e(t,e,r=t){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r!==t&&(r[3]=t[3],r[4]=t[4],r[5]=t[5]),r}function L0e(t,e,r=t){return r[3]=e[0],r[4]=e[1],r[5]=e[2],r!==t&&(r[0]=t[0],r[1]=t[1],r[2]=t[2]),t}function c6(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Si(t){return t?c6(t,Hte):pn(Hte)}function IZ(t,e){return e||(e=Vt()),e[0]=t[0],e[1]=t[1],e[2]=t[3],e[3]=t[4],e}function U$t(t,e){return t[0]=e[0],t[1]=e[1],t[2]=Number.NEGATIVE_INFINITY,t[3]=e[2],t[4]=e[3],t[5]=Number.POSITIVE_INFINITY,t}function P8e(t,e,r,i,s){return t[0]=e,t[1]=r,t[2]=Number.NEGATIVE_INFINITY,t[3]=i,t[4]=s,t[5]=Number.POSITIVE_INFINITY,t}function iG(t){return t.length===6}function $Z(t){return nx(t)===0&&ox(t)===0&&vv(t)===0}function k$t(t,e,r){if(t==null||e==null)return t===e;if(!iG(t)||!iG(e))return!1;if(r){for(let i=0;i<t.length;i++)if(!r(t[i],e[i]))return!1}else for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function I8e(t,e,r,i,s,n){return Ew(t,e,r,i,s,n,$8e)}const z$t=[-1/0,-1/0,-1/0,1/0,1/0,1/0],Hte=[1/0,1/0,1/0,-1/0,-1/0,-1/0],D0e=[0,0,0,0,0,0],$8e=pn();function k8(t,{isPrimitive:e,width:r,depth:i,height:s}){const n=e?10:1;if(r==null&&s==null&&i==null)return[n*t[0],n*t[1],n*t[2]];const o=Me(r,i,s);let a;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/t[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=t[l]*a);return o}const L8e=Ew(-.5,-.5,-.5,.5,.5,.5),D8e=Ew(-.5,-.5,0,.5,.5,1),N8e=Ew(-.5,-.5,0,.5,.5,.5);function F8e(t){switch(t){case"sphere":case"cube":case"diamond":return L8e;case"cylinder":case"cone":case"inverted-cone":return D8e;case"tetrahedron":return N8e;default:return}}const LZ=["butt","square","round"],U8e=[...LZ,"none"],N0e=["miter","bevel","round"];var sG;let R1=sG=class extends le{constructor(t){super(t),this.color=new Ne([0,0,0,1]),this.size=Uh(1),this.pattern=null,this.patternCap="butt"}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size,pattern:this.pattern!=null?this.pattern.clone():null,patternCap:this.patternCap};return new sG(t)}};u([d(wy)],R1.prototype,"color",void 0),u([d(om)],R1.prototype,"size",void 0),u([d(M0e)],R1.prototype,"pattern",void 0),u([d({type:LZ,json:{default:"butt",write:{overridePolicy(){return{enabled:this.pattern!=null}}}}})],R1.prototype,"patternCap",void 0),R1=sG=u([P("esri.symbols.support.Symbol3DOutline")],R1);var uD;let ng=uD=class extends wm{constructor(t){super(t),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const t={edges:this.edges!=null?this.edges.clone():null,enabled:this.enabled,material:this.material!=null?this.material.clone():null,pattern:this.pattern!=null?this.pattern.clone():null,castShadows:this.castShadows,outline:this.outline!=null?this.outline.clone():null};return new uD(t)}static fromSimpleFillSymbol(t){const e=t.outline&&t.outline.style&&t.outline.style!=="inside-frame"&&t.outline.style!=="solid"?new MZ({style:t.outline.style}):null,r={size:t.outline?.width??0,color:(t.outline?.color??TO).clone(),pattern:e};return e&&t.outline?.cap&&(r.patternCap=t.outline.cap),new uD({material:new SO({color:(t.color??C8e).clone()}),pattern:t.style&&t.style!=="solid"?new R0e({style:t.style}):null,outline:r})}};u([it({Fill:"fill"},{readOnly:!0})],ng.prototype,"type",void 0),u([d({type:SO,json:{write:!0}})],ng.prototype,"material",void 0),u([d(E8e)],ng.prototype,"pattern",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],ng.prototype,"castShadows",void 0),u([d({type:R1,json:{write:!0}})],ng.prototype,"outline",void 0),u([d(T0e)],ng.prototype,"edges",void 0),ng=uD=u([P("esri.symbols.FillSymbol3DLayer")],ng);const Cw=ng,k8e=["none","underline","line-through"],z8e=["normal","italic","oblique"],V8e=["normal","lighter","bold","bolder"],F0e={type:Number,cast:t=>{const e=yh(t);return e===0?1:ve(e,.1,4)},nonNullable:!0},B8e=["left","right","center"],G8e=["baseline","top","middle","bottom"],U0e={type:B8e,nonNullable:!0},k0e={type:G8e,nonNullable:!0},V$t=8;var nG;let og=nG=class extends le{constructor(t){super(t),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(t){return Kr(t)}clone(){return new nG({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};u([d({type:k8e,json:{default:"none",write:!0}})],og.prototype,"decoration",void 0),u([d({type:String,json:{write:!0}})],og.prototype,"family",void 0),u([d({type:Number,json:{write:{overridePolicy:(t,e,r)=>({enabled:!r||!r.textSymbol3D})}}})],og.prototype,"size",void 0),u([wr("size")],og.prototype,"castSize",null),u([d({type:z8e,json:{default:"normal",write:!0}})],og.prototype,"style",void 0),u([d({type:V8e,json:{default:"normal",write:!0}})],og.prototype,"weight",void 0),og=nG=u([P("esri.symbols.Font")],og);const u6=og;function uy(t,e){const r=e&&e.url&&e.url.path;if(t&&r&&(t=du(t,r,{preserveProtocolRelative:!0}),e.portalItem&&e.readResourcePaths)){const i=SX(t,e.portalItem.itemUrl);i!=null&&j8e.test(i)&&e.readResourcePaths.push(e.portalItem.resourceFromPath(i).path)}return oG(t,e&&e.portal)}function hy(t,e,r=Y2.YES){if(t==null)return t;!Ac(t)&&e&&e.blockedRelativeUrls&&e.blockedRelativeUrls.push(t);let i=du(t);if(e){const s=e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.rootPath||e.url&&e.url.path;if(s){const n=oG(s,e.portal),o=oG(i,e.portal);i=SX(o,n,n),i!=null&&i!==o&&i!==t&&e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.writtenUrls.push(i)}}return i=G0e(i,e?.portal),Ac(i)&&(i=hp(i)),e?.resources&&e?.portalItem&&!Ac(i)&&!_m(i)&&r===Y2.YES&&e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(i),compress:!1}),i}function h6(t,e,r){return uy(t,r)}function J_(t,e,r,i){const s=hy(t,i);s!==void 0&&(e[r]=s)}const z0e=/\/items\/([^\/]+)\/resources\/(.*)/,j8e=/^\.\/resources\//;function V0e(t){return(t?.match(z0e)??null)?.[1]??null}function B0e(t){const e=t?.match(z0e)??null;if(e==null)return null;const r=e[2],i=r.lastIndexOf("/");if(i===-1){const{path:o,extension:a}=Dee(r);return{prefix:null,filename:o,extension:a}}const{path:s,extension:n}=Dee(r.slice(i+1));return{prefix:r.slice(0,i),filename:s,extension:n}}function G0e(t,e){return e&&!e.isPortal&&e.urlKey&&e.customBaseUrl?HV(t,`${e.urlKey}.${e.customBaseUrl}`,e.portalHostname):t}function oG(t,e){if(!e||e.isPortal||!e.urlKey||!e.customBaseUrl)return t;const r=`${e.urlKey}.${e.customBaseUrl}`,i=bX();return z2(i,`${i.scheme}://${r}`)?HV(t,e.portalHostname,r):HV(t,r,e.portalHostname)}var Y2;(function(t){t[t.YES=0]="YES",t[t.NO=1]="NO"})(Y2||(Y2={}));const H8e=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return Y2},ensureMainOnlineDomain:G0e,fromJSON:uy,itemIdFromResourceUrl:V0e,prefixAndFilenameFromResourceUrl:B0e,read:h6,toJSON:hy,write:J_},Symbol.toStringTag,{value:"Module"}));var aG;const q8e=il()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let M1=aG=class extends le{constructor(t){super(t)}readHref(t,e,r){return t?uy(t,r):e.dataURI}writeHref(t,e,r,i){t&&(_m(t)?e.dataURI=t:(e.href=hy(t,i),Ac(e.href)&&(e.href=hp(e.href))))}clone(){return new aG({href:this.href,primitive:this.primitive})}};u([d({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],M1.prototype,"href",void 0),u([Ae("href")],M1.prototype,"readHref",null),u([ke("href",{href:{type:String},dataURI:{type:String}})],M1.prototype,"writeHref",null),u([it(q8e)],M1.prototype,"primitive",void 0),M1=aG=u([P("esri.symbols.support.IconSymbol3DLayerResource")],M1);const W8e="circle";var lG;let FS=lG=class extends we{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new lG({x:this.x,y:this.y})}};u([d({type:Number})],FS.prototype,"x",void 0),u([d({type:Number})],FS.prototype,"y",void 0),FS=lG=u([P("esri.symbols.support.Symbol3DAnchorPosition2D")],FS);var cG;let QA=cG=class extends le{constructor(t){super(t),this.color=new Ne([0,0,0,1]),this.size=Uh(1)}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size};return new cG(t)}};u([d(wy)],QA.prototype,"color",void 0),u([d(om)],QA.prototype,"size",void 0),QA=cG=u([P("esri.symbols.support.Symbol3DIconOutline")],QA);var GT;const j0e="esri.symbols.IconSymbol3DLayer";let lf=GT=class extends wm{constructor(t){super(t),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null}clone(){return new GT({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:this.material!=null?this.material.clone():null,outline:this.outline!=null?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(t){const e=t.color||TO,r=qte(t),i=t.outline&&t.outline.width>0?{size:t.outline.width,color:(t.outline.color||TO).clone()}:null;return new GT({size:t.size,resource:{primitive:Z8e(t.style)},material:{color:e},outline:i,anchor:r?"relative":void 0,anchorPosition:r})}static fromPictureMarkerSymbol(t){const e=!t.color||A8e(t.color)?TO:t.color,r=qte(t);return new GT({size:t.width<=t.height?t.height:t.width,resource:{href:t.url},material:{color:e.clone()},anchor:r?"relative":void 0,anchorPosition:r})}static fromCIMSymbol(t){return new GT({resource:{href:Eme({mediaType:"application/json",data:JSON.stringify(t.data)})}})}};function qte(t){const e="width"in t?t.width:t.size,r="height"in t?t.height:t.size,i=Wte(t.xoffset),s=Wte(t.yoffset);return(i||s)&&e&&r?{x:-i/e,y:s/r}:null}function Wte(t){return isFinite(t)?t:0}u([d({type:bu,json:{write:!0}})],lf.prototype,"material",void 0),u([d({type:M1,json:{write:!0}})],lf.prototype,"resource",void 0),u([it({Icon:"icon"},{readOnly:!0})],lf.prototype,"type",void 0),u([d(om)],lf.prototype,"size",void 0),u([it({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),d({json:{default:"center"}})],lf.prototype,"anchor",void 0),u([d({type:FS,json:{type:[Number],read:{reader:t=>new FS({x:t[0],y:t[1]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],lf.prototype,"anchorPosition",void 0),u([d({type:QA,json:{write:!0}})],lf.prototype,"outline",void 0),lf=GT=u([P(j0e)],lf);const X8e={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function Z8e(t){return X8e[t]||(Q.getLogger(j0e).warn(`${t} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const Ff=lf;let P1=class extends ji(le){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return e!=null&&e.placement===this.placement&&e.style===this.style&&(this.color==null&&e.color==null||this.color!=null&&e.color!=null&&this.color.toJSON()===e.color.toJSON())}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],P1.prototype,"type",void 0),u([d({type:b8e,json:{default:"begin-end",write:!0}})],P1.prototype,"placement",void 0),u([d({type:E0e,json:{default:"arrow",write:!0}})],P1.prototype,"style",void 0),u([d({type:Ne,json:{type:[Qi],default:null,write:!0}})],P1.prototype,"color",void 0),P1=u([P("esri.symbols.LineStyleMarker3D")],P1);const uG=P1;var hD;let cf=hD=class extends wm{constructor(t){super(t),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=Uh(1),this.pattern=null,this.marker=null}clone(){const t={enabled:this.enabled,material:this.material!=null?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:this.pattern!=null?this.pattern.clone():null,marker:this.marker!=null?this.marker.clone():null};return new hD(t)}static fromSimpleLineSymbol(t){const e={enabled:!0,size:t.width??Uh(1),cap:t.cap||"butt",join:t.join||"miter",pattern:t.style&&t.style!=="inside-frame"?new MZ({style:t.style}):null,material:new bu({color:(t.color||TO).clone()}),marker:t.marker?new uG({placement:t.marker.placement,style:t.marker.style,color:t.marker.color?.clone()??null}):null};return new hD(e)}};u([d({type:bu,json:{write:!0}})],cf.prototype,"material",void 0),u([it({Line:"line"},{readOnly:!0})],cf.prototype,"type",void 0),u([d({type:N0e,json:{write:!0,default:"miter"}})],cf.prototype,"join",void 0),u([d({type:LZ,json:{write:!0,default:"butt"}})],cf.prototype,"cap",void 0),u([d(om)],cf.prototype,"size",void 0),u([d(M0e)],cf.prototype,"pattern",void 0),u([d({types:{key:"type",base:uG,typeMap:{style:uG}},json:{write:!0}})],cf.prototype,"marker",void 0),cf=hD=u([P("esri.symbols.LineSymbol3DLayer")],cf);const $M=cf;var hG;const Y8e=il()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let KA=hG=class extends le{clone(){return new hG({href:this.href,primitive:this.primitive})}};u([d({type:String,json:{read:h6,write:J_}})],KA.prototype,"href",void 0),u([it(Y8e)],KA.prototype,"primitive",void 0),KA=hG=u([P("esri.symbols.support.ObjectSymbol3DLayerResource")],KA);const H0e="sphere";var dG;let bb=dG=class extends we{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new dG({x:this.x,y:this.y,z:this.z})}};u([d({type:Number})],bb.prototype,"x",void 0),u([d({type:Number})],bb.prototype,"y",void 0),u([d({type:Number})],bb.prototype,"z",void 0),bb=dG=u([P("esri.symbols.support.Symbol3DAnchorPosition3D")],bb);var pG;let La=pG=class extends wm{constructor(t){super(t),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new pG({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,resource:this.resource&&this.resource.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};u([d({type:bu,json:{write:!0}})],La.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],La.prototype,"castShadows",void 0),u([d({type:KA,json:{write:!0}})],La.prototype,"resource",void 0),u([it({Object:"object"},{readOnly:!0})],La.prototype,"type",void 0),u([d({type:Number,json:{write:!0}})],La.prototype,"width",void 0),u([d({type:Number,json:{write:!0}})],La.prototype,"height",void 0),u([d({type:Number,json:{write:!0}})],La.prototype,"depth",void 0),u([it({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),d({json:{default:"origin"}})],La.prototype,"anchor",void 0),u([d({type:bb,json:{type:[Number],read:{reader:t=>new bb({x:t[0],y:t[1],z:t[2]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y,t.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],La.prototype,"anchorPosition",void 0),u([d({type:Number,json:{write:!0}})],La.prototype,"heading",void 0),u([d({type:Number,json:{write:!0}})],La.prototype,"tilt",void 0),u([d({type:Number,json:{write:!0}})],La.prototype,"roll",void 0),u([d({readOnly:!0})],La.prototype,"isPrimitive",null),La=pG=u([P("esri.symbols.ObjectSymbol3DLayer")],La);const DZ=La;var fG;let gl=fG=class extends wm{constructor(t){super(t),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(t,e){return t??(e.height==null&&e.size!=null?e.size:void 0)}readHeight(t,e){return t??(e.width==null&&e.size!=null?e.size:void 0)}clone(){return new fG({enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};u([d({type:bu,json:{write:!0}})],gl.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],gl.prototype,"castShadows",void 0),u([it({Path:"path"},{readOnly:!0})],gl.prototype,"type",void 0),u([d({type:["circle","quad"],json:{write:!0,default:"circle"}})],gl.prototype,"profile",void 0),u([d({type:N0e,json:{write:!0,default:"miter"}})],gl.prototype,"join",void 0),u([d({type:U8e,json:{write:!0,default:"butt"}})],gl.prototype,"cap",void 0),u([d({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],gl.prototype,"width",void 0),u([Ae("width",["width","size","height"])],gl.prototype,"readWidth",null),u([d({type:Number,json:{write:!0}})],gl.prototype,"height",void 0),u([Ae("height",["height","size","width"])],gl.prototype,"readHeight",null),u([d({type:["center","bottom","top"],json:{write:!0,default:"center"}})],gl.prototype,"anchor",void 0),u([d({type:["heading","all"],json:{write:!0,default:"all"}})],gl.prototype,"profileRotation",void 0),gl=fG=u([P("esri.symbols.PathSymbol3DLayer")],gl);const NZ=gl;var mG;let US=mG=class extends le{constructor(){super(...arguments),this.color=new Ne([0,0,0,1]),this.size=0}clone(){const t={color:K(this.color),size:this.size};return new mG(t)}};u([d(wy)],US.prototype,"color",void 0),u([d(om)],US.prototype,"size",void 0),US=mG=u([P("esri.symbols.support.Symbol3DHalo")],US);let EO=class extends ji(le){constructor(e){super(e),this.color=null}};u([d(wy)],EO.prototype,"color",void 0),EO=u([P("esri.symbols.support.Symbol3DTextBackground")],EO);var dD;let Yl=dD=class extends wm{constructor(t){super(t),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(t){t!=null&&this._userSize!=null&&(t.size=this._userSize),this._set("font",t)}writeFont(t,e,r,i){const s={...i,textSymbol3D:!0};e.font=t.write({},s),delete e.font.size}get size(){return this._userSize!=null?this._userSize:this.font!=null&&this.font.size!=null?this.font.size:9}set size(t){this._userSize=t,this.font!=null&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const t=new dD({enabled:this.enabled,font:this.font&&K(this.font),halo:this.halo&&K(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:this.material!=null?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:K(this.background)});return t._userSize=this._userSize,t}static fromTextSymbol(t){return new dD({font:t.font!=null?t.font.clone():new u6,halo:J8e(t.haloColor,t.haloSize),horizontalAlignment:t.horizontalAlignment,lineHeight:t.lineHeight,material:t.color?new bu({color:t.color.clone()}):null,text:t.text,verticalAlignment:t.verticalAlignment,background:t.backgroundColor?new EO({color:t.backgroundColor.clone()}):null})}};function J8e(t,e){return t&&e!=null&&e>0?new US({color:K(t),size:e}):null}u([d({type:u6,json:{write:!0}})],Yl.prototype,"font",null),u([ke("font")],Yl.prototype,"writeFont",null),u([d({type:US,json:{write:!0}})],Yl.prototype,"halo",void 0),u([d({...U0e,json:{default:"center",write:!0}})],Yl.prototype,"horizontalAlignment",void 0),u([d({...F0e,json:{default:1,write:!0}})],Yl.prototype,"lineHeight",void 0),u([d({type:bu,json:{write:!0}})],Yl.prototype,"material",void 0),u([d({type:EO,json:{write:!0}})],Yl.prototype,"background",void 0),u([d(om)],Yl.prototype,"size",null),u([d({type:String,json:{write:!0}})],Yl.prototype,"text",void 0),u([it({Text:"text"},{readOnly:!0})],Yl.prototype,"type",void 0),u([d({...k0e,json:{default:"baseline",write:!0}})],Yl.prototype,"verticalAlignment",void 0),Yl=dD=u([P("esri.symbols.TextSymbol3DLayer")],Yl);const bv=Yl;var gG;let R0=gG=class extends wm{constructor(t){super(t),this.color=yG.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new gG({color:K(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};u([d({type:Ne,nonNullable:!0,json:{type:[Qi],write:(t,e,r)=>e[r]=t.toArray(Ne.AlphaMode.UNLESS_OPAQUE),default:()=>yG.clone(),defaultEquals:t=>t.toCss(!0)===yG.toCss(!0)}})],R0.prototype,"color",void 0),u([it({Water:"water"},{readOnly:!0})],R0.prototype,"type",void 0),u([d({type:["small","medium","large"],json:{write:!0,default:"medium"}})],R0.prototype,"waterbodySize",void 0),u([d({type:Number,json:{write:!0,default:null}})],R0.prototype,"waveDirection",void 0),u([d({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],R0.prototype,"waveStrength",void 0),R0=gG=u([P("esri.symbols.WaterSymbol3DLayer")],R0);const yG=new Ne([0,119,190]),q0e=R0;var _G;let I1=_G=class extends we{constructor(t){super(t),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new _G({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};u([d({type:String})],I1.prototype,"name",void 0),u([d({type:String})],I1.prototype,"styleUrl",void 0),u([d({type:String})],I1.prototype,"styleName",void 0),u([d({type:Js})],I1.prototype,"portal",void 0),I1=_G=u([P("esri.symbols.support.StyleOrigin")],I1);const ER=I1;var vG;let Kb=vG=class extends we{constructor(){super(...arguments),this.url=""}clone(){return new vG({url:this.url})}};u([d({type:String})],Kb.prototype,"url",void 0),Kb=vG=u([P("esri.symbols.support.Thumbnail")],Kb);const W0e={icon:Ff,object:DZ,line:$M,path:NZ,fill:Cw,extrude:S0e,text:bv,water:q0e},Q8e=Pt.ofType({base:wm,key:"type",typeMap:W0e,errorContext:"symbol-layer"});let uf=class extends Dc{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const r=this.__accessor__&&this.__accessor__.metadatas&&this.__accessor__.metadatas.symbolLayers,i=r&&r.type||Pt;this._set("symbolLayers",new i)}get color(){return null}set color(e){this.constructed&&Q.getLogger(this).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){gw(e,this._get("symbolLayers"))}readStyleOrigin(e,r,i){if(e.styleUrl&&e.name){const s=uy(e.styleUrl,i);return new ER({styleUrl:s,name:e.name})}if(e.styleName&&e.name)return new ER({portal:i&&i.portal||Js.getDefault(),styleName:e.styleName,name:e.name});i&&i.messages&&i.messages.push(new Nh("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:i,definition:e}))}writeStyleOrigin(e,r,i,s){if(e.styleUrl&&e.name){let n=hy(e.styleUrl,s);Ac(n)&&(n=hp(n)),r.styleOrigin={styleUrl:n,name:e.name}}else e.styleName&&e.name&&(e.portal&&s&&s.portal&&!Tme(e.portal.restUrl,s.portal.restUrl)?s&&s.messages&&s.messages.push(new Nh("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):r.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof wm||e&&W0e[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};u([d({json:{read:!1,write:!1}})],uf.prototype,"color",null),u([d({type:Q8e,nonNullable:!0,json:{write:!0}}),wr(hme)],uf.prototype,"symbolLayers",null),u([d({type:ER})],uf.prototype,"styleOrigin",void 0),u([Ae("styleOrigin")],uf.prototype,"readStyleOrigin",null),u([ke("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],uf.prototype,"writeStyleOrigin",null),u([d({type:Kb,json:{read:!1}})],uf.prototype,"thumbnail",void 0),u([d({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],uf.prototype,"type",void 0),uf=u([P("esri.symbols.Symbol3D")],uf);const QE=uf;let e3=class extends le{constructor(e){super(e),this.visible=!0}clone(){}};u([d({type:["line"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],e3.prototype,"type",void 0),u([d({readOnly:!0})],e3.prototype,"visible",void 0),e3=u([P("esri.symbols.callouts.Callout3D")],e3);const X0e=e3;var bG;let pD=bG=class extends le{constructor(){super(...arguments),this.color=new Ne("white")}clone(){return new bG({color:K(this.color)})}};u([d(wy)],pD.prototype,"color",void 0),pD=bG=u([P("esri.symbols.callouts.LineCallout3DBorder")],pD);const Z0e=pD;Object.freeze(Object.defineProperty({__proto__:null,default:Z0e},Symbol.toStringTag,{value:"Module"}));var wG;let M0=wG=class extends X0e{constructor(t){super(t),this.type="line",this.color=new Ne([0,0,0,1]),this.size=Uh(1),this.border=null}get visible(){return this.size>0&&this.color!=null&&this.color.a>0}clone(){return new wG({color:K(this.color),size:this.size,border:K(this.border)})}};u([it({line:"line"},{readOnly:!0})],M0.prototype,"type",void 0),u([d(wy)],M0.prototype,"color",void 0),u([d(om)],M0.prototype,"size",void 0),u([d({type:Z0e,json:{write:!0}})],M0.prototype,"border",void 0),u([d({readOnly:!0})],M0.prototype,"visible",null),M0=wG=u([P("esri.symbols.callouts.LineCallout3D")],M0);const K8e=M0;function FZ(t){if(!t)return!1;const e=t.verticalOffset;return!!e&&!(e.screenLength<=0||e.maxWorldLength!=null&&e.maxWorldLength<=0)}function Y0e(t){if(!t||!t.supportsCallout||!t.supportsCallout())return!1;const e=t.callout;return!!e&&!!e.visible&&!!FZ(t)}function UZ(t){return t.type==="point-3d"||t.type==="label-3d"}function J0e(t){return t.horizontalAlignment==="center"}const Q0e={types:{key:"type",base:X0e,typeMap:{line:K8e}},json:{write:!0}};var xG;let jT=xG=class extends le{constructor(t){super(t),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new xG({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};u([d(om)],jT.prototype,"screenLength",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0,default:0}})],jT.prototype,"minWorldLength",void 0),u([d({type:Number,json:{write:!0}})],jT.prototype,"maxWorldLength",void 0),jT=xG=u([P("esri.symbols.support.Symbol3DVerticalOffset")],jT);const K0e=jT;var fD;const e_e=Pt.ofType({base:null,key:"type",typeMap:{text:bv}});let P0=fD=class extends QE{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new e_e,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return Y0e(this)}hasVisibleVerticalOffset(){return FZ(this)}clone(){return new fD({styleOrigin:K(this.styleOrigin),symbolLayers:K(this.symbolLayers),thumbnail:K(this.thumbnail),callout:K(this.callout),verticalOffset:K(this.verticalOffset)})}static fromTextSymbol(t){return new fD({symbolLayers:[bv.fromTextSymbol(t)]})}};u([d({type:K0e,json:{write:!0}})],P0.prototype,"verticalOffset",void 0),u([d(Q0e)],P0.prototype,"callout",void 0),u([d({json:{read:!1,write:!1}})],P0.prototype,"styleOrigin",void 0),u([d({type:e_e})],P0.prototype,"symbolLayers",void 0),u([it({LabelSymbol3D:"label-3d"},{readOnly:!0})],P0.prototype,"type",void 0),P0=fD=u([P("esri.symbols.LabelSymbol3D")],P0);const LM=P0;var mD;const t_e=Pt.ofType({base:null,key:"type",typeMap:{line:$M,path:NZ}}),e9e=Pt.ofType({base:null,key:"type",typeMap:{line:$M,path:NZ}});let t3=mD=class extends QE{constructor(t){super(t),this.symbolLayers=new t_e,this.type="line-3d"}clone(){return new mD({styleOrigin:K(this.styleOrigin),symbolLayers:K(this.symbolLayers),thumbnail:K(this.thumbnail)})}static fromSimpleLineSymbol(t){return new mD({symbolLayers:[$M.fromSimpleLineSymbol(t)]})}};u([d({type:t_e,json:{type:e9e}})],t3.prototype,"symbolLayers",void 0),u([it({LineSymbol3D:"line-3d"},{readOnly:!0})],t3.prototype,"type",void 0),t3=mD=u([P("esri.symbols.LineSymbol3D")],t3);const d6=t3;let I0=class extends Dc{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};u([d({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],I0.prototype,"angle",void 0),u([d({type:["simple-marker","picture-marker"],readOnly:!0})],I0.prototype,"type",void 0),u([d({type:Number,cast:Kr,json:{write:!0}})],I0.prototype,"xoffset",void 0),u([d({type:Number,cast:Kr,json:{write:!0}})],I0.prototype,"yoffset",void 0),u([d({type:Number,cast:t=>t==="auto"?t:Kr(t),json:{write:!0}})],I0.prototype,"size",void 0),I0=u([P("esri.symbols.MarkerSymbol")],I0);const r_e=I0;var gD;const i_e=Pt.ofType({base:null,key:"type",typeMap:{fill:Cw}});let r3=gD=class extends QE{constructor(t){super(t),this.symbolLayers=new i_e,this.type="mesh-3d"}clone(){return new gD({styleOrigin:K(this.styleOrigin),symbolLayers:K(this.symbolLayers),thumbnail:K(this.thumbnail)})}static fromSimpleFillSymbol(t){return new gD({symbolLayers:[Cw.fromSimpleFillSymbol(t)]})}};u([d({type:i_e})],r3.prototype,"symbolLayers",void 0),u([it({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],r3.prototype,"type",void 0),r3=gD=u([P("esri.symbols.MeshSymbol3D")],r3);const J2=r3;function t9e(t,e,r){return e.imageData?Eme({mediaType:e.contentType||"image/png",isBase64:!0,data:e.imageData}):s_e(e.url,r)}function s_e(t,e){return i9e(e)&&!Ac(t)&&e?.layer?.parsedUrl?Pc(e.layer.parsedUrl.path,"images",t):uy(t,e)}function r9e(t,e,r,i){if(_m(t)){const s=yw(t);if(!s)return;e.contentType=s.mediaType,e.imageData=s.data,r&&r.imageData===e.imageData&&r.url&&J_(r.url,e,"url",i)}else J_(t,e,"url",i)}const n_e={json:{read:{source:["imageData","url"],reader:t9e},write:{writer(t,e,r,i){r9e(t,e,this.source,i)}}}},o_e={readOnly:!0,json:{read:{source:["imageData","url"],reader(t,e,r){const i={};return e.imageData&&(i.imageData=e.imageData),e.contentType&&(i.contentType=e.contentType),e.url&&(i.url=s_e(e.url,r)),i}}}};function i9e(t){return!(t==null||t.origin!=="service"&&t.origin!=="portal-item"||t.layer?.type!=="feature"&&t.layer?.type!=="stream")}var TG;let Qu=TG=class extends C0e{constructor(...t){super(...t),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(t,e,r,i){if(t&&typeof t!="string"&&t.imageData==null)return t;const s={};return t&&(s.url=t),e&&(s.outline=e),r!=null&&(s.width=Kr(r)),i!=null&&(s.height=Kr(i)),s}clone(){const t=new TG({color:K(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return t._set("source",K(this.source)),t}hash(){return`${super.hash()}.${this.color?.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};u([it({esriPFS:"picture-fill"},{readOnly:!0})],Qu.prototype,"type",void 0),u([d(n_e)],Qu.prototype,"url",void 0),u([d({type:Number,json:{write:!0}})],Qu.prototype,"xscale",void 0),u([d({type:Number,json:{write:!0}})],Qu.prototype,"yscale",void 0),u([d({type:Number,cast:Kr,json:{write:!0}})],Qu.prototype,"width",void 0),u([d({type:Number,cast:Kr,json:{write:!0}})],Qu.prototype,"height",void 0),u([d({type:Number,cast:Kr,json:{write:!0}})],Qu.prototype,"xoffset",void 0),u([d({type:Number,cast:Kr,json:{write:!0}})],Qu.prototype,"yoffset",void 0),u([d(o_e)],Qu.prototype,"source",void 0),Qu=TG=u([P("esri.symbols.PictureFillSymbol")],Qu);const a_e=Qu;var SG;let _d=SG=class extends r_e{constructor(...t){super(...t),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string"&&t.imageData==null)return t;const i={};return t&&(i.url=t),e!=null&&(i.width=Kr(e)),r!=null&&(i.height=Kr(r)),i}readHeight(t,e){return e.size||t}readWidth(t,e){return e.size||t}clone(){const t=new SG({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return t._set("source",K(this.source)),t}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};u([d({json:{write:!1}})],_d.prototype,"color",void 0),u([it({esriPMS:"picture-marker"},{readOnly:!0})],_d.prototype,"type",void 0),u([d(n_e)],_d.prototype,"url",void 0),u([d(o_e)],_d.prototype,"source",void 0),u([d({type:Number,cast:Kr,json:{write:!0}})],_d.prototype,"height",void 0),u([Ae("height",["height","size"])],_d.prototype,"readHeight",null),u([d({type:Number,cast:Kr,json:{write:!0}})],_d.prototype,"width",void 0),u([d({json:{write:!1}})],_d.prototype,"size",void 0),_d=SG=u([P("esri.symbols.PictureMarkerSymbol")],_d);const DM=_d;var $1;const l_e=Pt.ofType({base:null,key:"type",typeMap:{icon:Ff,object:DZ,text:bv}});let L1=$1=class extends QE{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.symbolLayers=new l_e,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const t of this.symbolLayers.items)switch(t.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return Y0e(this)}hasVisibleVerticalOffset(){return FZ(this)}clone(){return new $1({verticalOffset:K(this.verticalOffset),callout:K(this.callout),styleOrigin:K(this.styleOrigin),symbolLayers:K(this.symbolLayers),thumbnail:K(this.thumbnail)})}static fromSimpleMarkerSymbol(t){return new $1({symbolLayers:[Ff.fromSimpleMarkerSymbol(t)]})}static fromPictureMarkerSymbol(t){return new $1({symbolLayers:[Ff.fromPictureMarkerSymbol(t)]})}static fromCIMSymbol(t){if(t.data?.symbol?.type!=="CIMPointSymbol")return null;const r=t.data.symbol;return new $1(r?.callout?{symbolLayers:[Ff.fromCIMSymbol(t)],callout:{type:"line",size:.5,color:[0,0,0]},verticalOffset:{screenLength:40}}:{symbolLayers:[Ff.fromCIMSymbol(t)]})}static fromTextSymbol(t){return new $1({symbolLayers:[bv.fromTextSymbol(t)]})}};u([d({type:K0e,json:{write:!0}})],L1.prototype,"verticalOffset",void 0),u([d(Q0e)],L1.prototype,"callout",void 0),u([d({type:l_e,json:{origins:{"web-scene":{write:!0}}}})],L1.prototype,"symbolLayers",void 0),u([it({PointSymbol3D:"point-3d"},{readOnly:!0})],L1.prototype,"type",void 0),L1=$1=u([P("esri.symbols.PointSymbol3D")],L1);const Uf=L1;var i3;const c_e=Pt.ofType({base:null,key:"type",typeMap:{extrude:S0e,fill:Cw,icon:Ff,line:$M,object:DZ,text:bv,water:q0e}});let s3=i3=class extends QE{constructor(t){super(t),this.symbolLayers=new c_e,this.type="polygon-3d"}clone(){return new i3({styleOrigin:K(this.styleOrigin),symbolLayers:K(this.symbolLayers),thumbnail:K(this.thumbnail)})}static fromJSON(t){const e=new i3;if(e.read(t),e.symbolLayers.length===2&&e.symbolLayers.at(0).type==="fill"&&e.symbolLayers.at(1).type==="line"){const r=e.symbolLayers.at(0),i=e.symbolLayers.at(1);!i.enabled||t.symbolLayers&&t.symbolLayers[1]&&t.symbolLayers[1].enable===!1||(r.outline={size:i.size,color:i.material!=null?i.material.color:null}),e.symbolLayers.removeAt(1)}return e}static fromSimpleFillSymbol(t){return new i3({symbolLayers:[Cw.fromSimpleFillSymbol(t)]})}};u([d({type:c_e,json:{write:!0}})],s3.prototype,"symbolLayers",void 0),u([it({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],s3.prototype,"type",void 0),s3=i3=u([P("esri.symbols.PolygonSymbol3D")],s3);const NM=s3;var EG;const z8=new $r({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let D1=EG=class extends C0e{constructor(...t){super(...t),this.color=new Ne([0,0,0,.25]),this.outline=new $u,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string")return t;const i={};return t&&(i.style=t),e&&(i.outline=e),r&&(i.color=r),i}clone(){return new EG({color:K(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};u([d()],D1.prototype,"color",void 0),u([d()],D1.prototype,"outline",void 0),u([it({esriSFS:"simple-fill"},{readOnly:!0})],D1.prototype,"type",void 0),u([d({type:z8.apiValues,json:{read:z8.read,write:z8.write}})],D1.prototype,"style",void 0),D1=EG=u([P("esri.symbols.SimpleFillSymbol")],D1);const wv=D1;var CG;const V8=new $r({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let hf=CG=class extends r_e{constructor(...t){super(...t),this.color=new Ne([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new $u}normalizeCtorArgs(t,e,r,i){if(t&&typeof t!="string")return t;const s={};return t&&(s.style=t),e!=null&&(s.size=Kr(e)),r&&(s.outline=r),i&&(s.color=i),s}writeColor(t,e){t&&this.style!=="x"&&this.style!=="cross"&&(e.color=t.toJSON()),t===null&&(e.color=null)}set path(t){this.style="path",this._set("path",t)}clone(){return new CG({angle:this.angle,color:K(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${this.outline?.hash()}`}};u([d()],hf.prototype,"color",void 0),u([ke("color")],hf.prototype,"writeColor",null),u([it({esriSMS:"simple-marker"},{readOnly:!0})],hf.prototype,"type",void 0),u([d()],hf.prototype,"size",void 0),u([d({type:V8.apiValues,json:{read:V8.read,write:V8.write}})],hf.prototype,"style",void 0),u([d({type:String,json:{write:!0}})],hf.prototype,"path",null),u([d({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":$u}},json:{default:null,write:!0}})],hf.prototype,"outline",void 0),hf=CG=u([P("esri.symbols.SimpleMarkerSymbol")],hf);const xv=hf;var AG;let Ss=AG=class extends Dc{constructor(...t){super(...t),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new u6,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string")return t;const i={};return t&&(i.text=t),e&&(i.font=e),r&&(i.color=r),i}writeLineWidth(t,e,r,i){i&&typeof i!="string"?i.origin:e[r]=t}castLineWidth(t){return Kr(t)}writeLineHeight(t,e,r,i){i&&typeof i!="string"?i.origin:e[r]=t}clone(){return new AG({angle:this.angle,backgroundColor:K(this.backgroundColor),borderLineColor:K(this.borderLineColor),borderLineSize:this.borderLineSize,color:K(this.color),font:this.font&&this.font.clone(),haloColor:K(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${this.backgroundColor&&this.backgroundColor.hash()}.${this.borderLineColor}.${this.borderLineSize}.${this.color?.hash()}.${this.font&&this.font.hash()}.${this.haloColor&&this.haloColor.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};u([d({type:Ne,json:{write:!0}})],Ss.prototype,"backgroundColor",void 0),u([d({type:Ne,json:{write:!0}})],Ss.prototype,"borderLineColor",void 0),u([d({type:Number,json:{write:!0},cast:Kr})],Ss.prototype,"borderLineSize",void 0),u([d({type:u6,json:{write:!0}})],Ss.prototype,"font",void 0),u([d({...U0e,json:{write:!0}})],Ss.prototype,"horizontalAlignment",void 0),u([d({type:Boolean,json:{write:!0}})],Ss.prototype,"kerning",void 0),u([d({type:Ne,json:{write:!0}})],Ss.prototype,"haloColor",void 0),u([d({type:Number,cast:Kr,json:{write:!0}})],Ss.prototype,"haloSize",void 0),u([d({type:Boolean,json:{write:!0}})],Ss.prototype,"rightToLeft",void 0),u([d({type:Boolean,json:{write:!0}})],Ss.prototype,"rotated",void 0),u([d({type:String,json:{write:!0}})],Ss.prototype,"text",void 0),u([it({esriTS:"text"},{readOnly:!0})],Ss.prototype,"type",void 0),u([d({...k0e,json:{write:!0}})],Ss.prototype,"verticalAlignment",void 0),u([d({type:Number,cast:Kr,json:{write:!0}})],Ss.prototype,"xoffset",void 0),u([d({type:Number,cast:Kr,json:{write:!0}})],Ss.prototype,"yoffset",void 0),u([d({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],Ss.prototype,"angle",void 0),u([d({type:Number,json:{write:!0}})],Ss.prototype,"width",void 0),u([d({type:Number})],Ss.prototype,"lineWidth",void 0),u([ke("lineWidth")],Ss.prototype,"writeLineWidth",null),u([wr("lineWidth")],Ss.prototype,"castLineWidth",null),u([d(F0e)],Ss.prototype,"lineHeight",void 0),u([ke("lineHeight")],Ss.prototype,"writeLineHeight",null),Ss=AG=u([P("esri.symbols.TextSymbol")],Ss);const ax=Ss;var OG;let vd=OG=class extends Dc{constructor(t){super(t),this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const t=this.portal!=null?this.portal:Js.getDefault(),e=t.user?t.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${e}:${t.url}`}read(t,e){this.portal=e?.portal,super.read(t,e)}clone(){return new OG({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(t){return this._fetchSymbol("webRef",t)}fetchCIMSymbol(t){return this._fetchSymbol("cimRef",t)}async _fetchSymbol(t,e){const r=e!=null?e.cache:null,i=r?this._fetchCacheKey:null;if(r!=null){const a=i&&r.get(i);if(a)return a.clone()}const{resolveWebStyleSymbol:s}=await ce(()=>Promise.resolve().then(()=>Apt),void 0,import.meta.url);Yt(e);const n=s(this,{portal:this.portal},t,e);n.catch(a=>{Q.getLogger(this).error("#fetchSymbol()","Failed to create symbol from style",a)});const o=await n;return t==="webRef"&&o.type==="point-3d"||t==="cimRef"&&o.type==="cim"?(r?.set(i,o.clone()),o):null}};u([d({json:{write:!1}})],vd.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],vd.prototype,"styleName",void 0),u([d({type:Js,json:{write:!1}})],vd.prototype,"portal",void 0),u([d({type:String,json:{read:h6,write:J_}})],vd.prototype,"styleUrl",void 0),u([d({type:Kb,json:{read:!1}})],vd.prototype,"thumbnail",void 0),u([d({type:String,json:{write:!0}})],vd.prototype,"name",void 0),u([it({styleSymbolReference:"web-style"},{readOnly:!0})],vd.prototype,"type",void 0),u([d()],vd.prototype,"_fetchCacheKey",null),vd=OG=u([P("esri.symbols.WebStyleSymbol")],vd);const lx=vd;function p6(t){if(!t)return!1;switch(t.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function Aw(t){if(!t)return!1;switch(t.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const ew={base:Dc,key:"type",typeMap:{"simple-fill":wv,"picture-fill":a_e,"picture-marker":DM,"simple-line":$u,"simple-marker":xv,text:ax,"label-3d":LM,"line-3d":d6,"mesh-3d":J2,"point-3d":Uf,"polygon-3d":NM,"web-style":lx,cim:JE},errorContext:"symbol"},s9e={base:Dc,key:"type",typeMap:{"picture-marker":DM,"simple-marker":xv,text:ax,"web-style":lx,cim:JE},errorContext:"symbol"},n9e=BE({types:ew}),u_e={base:Dc,key:"type",typeMap:{"simple-fill":wv,"picture-fill":a_e,"picture-marker":DM,"simple-line":$u,"simple-marker":xv,text:ax,"line-3d":d6,"mesh-3d":J2,"point-3d":Uf,"polygon-3d":NM,"web-style":lx,cim:JE},errorContext:"symbol"},o9e={base:Dc,key:"type",typeMap:{text:ax,"label-3d":LM},errorContext:"symbol"},Xte={base:Dc,key:"type",typeMap:{"line-3d":d6,"mesh-3d":J2,"point-3d":Uf,"polygon-3d":NM,"web-style":lx,cim:JE},errorContext:"symbol"},a9e={base:Dc,key:"type",typeMap:{"label-3d":LM},errorContext:"symbol"},h_e=bp(ew);var RG;let n3=RG=class extends le{constructor(t){super(t),this.minValue=0,this.maxValue=0}clone(){return new RG({minValue:this.minValue,maxValue:this.maxValue})}};u([d({type:Number,json:{write:!0}})],n3.prototype,"minValue",void 0),u([d({type:Number,json:{write:!0}})],n3.prototype,"maxValue",void 0),n3=RG=u([P("esri.renderer.support.AuthoringInfoClassBreakInfo")],n3);var MG;let n_=MG=class extends le{constructor(t){super(t),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=[]}clone(){return new MG({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:K(this.classBreakInfos)})}};u([d({type:String,json:{write:!0}})],n_.prototype,"field",void 0),u([d({type:String,json:{write:!0}})],n_.prototype,"normalizationField",void 0),u([d({type:String,json:{write:!0}})],n_.prototype,"label",void 0),u([d({type:[n3],json:{write:!0}})],n_.prototype,"classBreakInfos",void 0),n_=MG=u([P("esri.renderers.support.AuthoringInfoFieldInfo")],n_);var PG;const GP=new $r({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),jP=new $r({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),Zte={key:t=>typeof t=="number"?"number":"string",typeMap:{number:Number,string:String},base:null},Yte=["high-to-low","above-and-below","centered-on","extremes"],Jte=[...new Set(["high-to-low","above-and-below","centered-on","extremes","90-10","above","below","high-to-low","above-and-below","90-10","above","below"])],Qte=["seconds","minutes","hours","days","months","years"];let Jl=PG=class extends le{constructor(t){super(t),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(t){return typeof t=="string"||typeof t=="number"?t:null}castStartTime(t){return typeof t=="string"||typeof t=="number"?t:null}get style(){return this.type==="color"?this._get("style"):null}set style(t){this._set("style",t)}get theme(){return this.type==="color"||this.type==="size"?this._get("theme")||"high-to-low":null}set theme(t){this._set("theme",t)}clone(){return new PG({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};u([d({types:Zte,json:{write:!0}})],Jl.prototype,"endTime",void 0),u([wr("endTime")],Jl.prototype,"castEndTime",null),u([d({type:String,json:{write:!0}})],Jl.prototype,"field",void 0),u([d({type:Number,json:{write:!0}})],Jl.prototype,"maxSliderValue",void 0),u([d({type:Number,json:{write:!0}})],Jl.prototype,"minSliderValue",void 0),u([d({types:Zte,json:{write:!0}})],Jl.prototype,"startTime",void 0),u([wr("startTime")],Jl.prototype,"castStartTime",null),u([d({type:GP.apiValues,value:null,json:{type:GP.jsonValues,read:GP.read,write:GP.write}})],Jl.prototype,"style",null),u([d({type:Jte,value:null,json:{type:Jte,origins:{"web-scene":{type:Yte,write:{writer:(t,e)=>{Yte.includes(t)&&(e.theme=t)}}}},write:!0}})],Jl.prototype,"theme",null),u([d({type:jP.apiValues,json:{type:jP.jsonValues,read:jP.read,write:jP.write}})],Jl.prototype,"type",void 0),u([d({type:Qte,json:{type:Qte,write:!0}})],Jl.prototype,"units",void 0),Jl=PG=u([P("esri.renderers.support.AuthoringInfoVisualVariable")],Jl);const l9e=Jl;let yD=class extends le{constructor(e){super(e),this.type=null}};u([d({readOnly:!0,json:{read:!1,write:!0}})],yD.prototype,"type",void 0),yD=u([P("esri.rest.support.ColorRamp")],yD);const kZ=yD;var IG;let N1=IG=class extends kZ{constructor(t){super(t),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new IG({fromColor:K(this.fromColor),toColor:K(this.toColor),algorithm:this.algorithm})}};u([it({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],N1.prototype,"algorithm",void 0),u([d({type:Ne,json:{type:[Qi],write:!0}})],N1.prototype,"fromColor",void 0),u([d({type:Ne,json:{type:[Qi],write:!0}})],N1.prototype,"toColor",void 0),u([d({type:["algorithmic"]})],N1.prototype,"type",void 0),N1=IG=u([P("esri.rest.support.AlgorithmicColorRamp")],N1);const zZ=N1;var $G;let o3=$G=class extends kZ{constructor(t){super(t),this.colorRamps=null,this.type="multipart"}clone(){return new $G({colorRamps:K(this.colorRamps)})}};u([d({type:[zZ],json:{write:!0}})],o3.prototype,"colorRamps",void 0),u([d({type:["multipart"]})],o3.prototype,"type",void 0),o3=$G=u([P("esri.rest.support.MultipartColorRamp")],o3);const d_e=o3,c9e={key:"type",base:kZ,typeMap:{algorithmic:zZ,multipart:d_e}};function u9e(t){return t&&t.type?t.type==="algorithmic"?zZ.fromJSON(t):t.type==="multipart"?d_e.fromJSON(t):null:null}var LG;const Uv=new $r({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),HP=new $r({pieChart:"pie-chart",classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),Kte=new $r({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),ere=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"],h9e=["high-to-low","above-and-below","above","below","90-10"],d9e=["flow-line","wave-front"],p9e=["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"];let qs=LG=class extends le{constructor(t){super(t),this.colorRamp=null,this.fadeRatio=null,this.isAutoGenerated=!1,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const t=this._get("classificationMethod"),e=this.type;return e&&e!=="relationship"?e==="class-breaks-size"||e==="class-breaks-color"?t||"manual":null:t}set classificationMethod(t){this._set("classificationMethod",t)}readColorRamp(t){return t?u9e(t):void 0}get fields(){return this.type&&this.type!=="predominance"?null:this._get("fields")}set fields(t){this._set("fields",t)}get field1(){return this.type&&this.type!=="relationship"?null:this._get("field1")}set field1(t){this._set("field1",t)}get field2(){return this.type&&this.type!=="relationship"?null:this._get("field2")}set field2(t){this._set("field2",t)}get flowTheme(){return this.type==="flow"?this._get("flowTheme"):null}set flowTheme(t){this._set("flowTheme",t)}get focus(){return this.type&&this.type!=="relationship"?null:this._get("focus")}set focus(t){this._set("focus",t)}get numClasses(){return this.type&&this.type!=="relationship"?null:this._get("numClasses")}set numClasses(t){this._set("numClasses",t)}get statistics(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("statistics"):null}set statistics(t){this._set("statistics",t)}get standardDeviationInterval(){const t=this.type;return t&&t!=="relationship"&&t!=="class-breaks-size"&&t!=="class-breaks-color"||this.classificationMethod&&this.classificationMethod!=="standard-deviation"?null:this._get("standardDeviationInterval")}set standardDeviationInterval(t){this._set("standardDeviationInterval",t)}get type(){return this._get("type")}set type(t){let e=t;t==="classed-size"?e="class-breaks-size":t==="classed-color"&&(e="class-breaks-color"),this._set("type",e)}get univariateSymbolStyle(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(t){this._set("univariateSymbolStyle",t)}get univariateTheme(){return this.type==="univariate-color-size"?this._get("univariateTheme"):null}set univariateTheme(t){this._set("univariateTheme",t)}clone(){return new LG({classificationMethod:this.classificationMethod,colorRamp:K(this.colorRamp),fadeRatio:K(this.fadeRatio),fields:this.fields&&this.fields.slice(0),field1:K(this.field1),field2:K(this.field2),isAutoGenerated:this.isAutoGenerated,focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(t=>t.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};u([d({type:Uv.apiValues,value:null,json:{type:Uv.jsonValues,read:Uv.read,write:Uv.write,origins:{"web-document":{default:"manual",type:Uv.jsonValues,read:Uv.read,write:Uv.write}}}})],qs.prototype,"classificationMethod",null),u([d({types:c9e,json:{write:!0}})],qs.prototype,"colorRamp",void 0),u([Ae("colorRamp")],qs.prototype,"readColorRamp",null),u([d({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],qs.prototype,"fadeRatio",void 0),u([d({type:[String],value:null,json:{write:!0}})],qs.prototype,"fields",null),u([d({type:n_,value:null,json:{write:!0}})],qs.prototype,"field1",null),u([d({type:n_,value:null,json:{write:!0}})],qs.prototype,"field2",null),u([d({type:d9e,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],qs.prototype,"flowTheme",null),u([d({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],qs.prototype,"focus",null),u([d({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],qs.prototype,"isAutoGenerated",void 0),u([d({type:Number,value:null,json:{type:Qi,write:!0}})],qs.prototype,"numClasses",null),u([d({type:ere,json:{type:ere,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],qs.prototype,"lengthUnit",void 0),u([d({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],qs.prototype,"maxSliderValue",void 0),u([d({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],qs.prototype,"minSliderValue",void 0),u([d({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],qs.prototype,"statistics",null),u([d({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],qs.prototype,"standardDeviationInterval",null),u([d({type:HP.apiValues,value:null,json:{type:HP.jsonValues,read:HP.read,write:HP.write,origins:{"web-scene":{type:Kte.jsonValues,write:{writer:Kte.write,overridePolicy:t=>({enabled:t!=="flow"})}}}}})],qs.prototype,"type",null),u([d({type:[l9e],json:{write:!0}})],qs.prototype,"visualVariables",void 0),u([d({type:p9e,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],qs.prototype,"univariateSymbolStyle",null),u([d({type:h9e,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],qs.prototype,"univariateTheme",null),qs=LG=u([P("esri.renderers.support.AuthoringInfo")],qs);const VZ=qs,B8=new $r({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let a3=class extends le{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const r=new Set;return await this.collectRequiredFields(r,e),Array.from(r).sort()}getSymbol(e,r){}async getSymbolAsync(e,r){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};u([d({type:VZ,json:{write:!0}})],a3.prototype,"authoringInfo",void 0),u([d({type:B8.apiValues,readOnly:!0,json:{type:B8.jsonValues,read:!1,write:{writer:B8.write,ignoreOrigin:!0}}})],a3.prototype,"type",void 0),a3=u([P("esri.renderers.Renderer")],a3);const xy=a3;function f9e(t){return t.match(m9e)?.[1]?.replace(/\\'/g,"'")??null}const m9e=/^hash\(\$feature\['((\\'|[^'])+)'\]\) \* 8\.381e-8$/;var DG;let d2=DG=class extends le{constructor(){super(...arguments),this.title=null}clone(){return new DG({title:this.title})}};u([d({type:String,json:{write:!0}})],d2.prototype,"title",void 0),d2=DG=u([P("esri.renderers.support.LegendOptions")],d2);var NG;let _D=NG=class extends d2{constructor(){super(...arguments),this.showLegend=null}clone(){return new NG({title:this.title,showLegend:this.showLegend})}};u([d({type:Boolean,json:{write:!0}})],_D.prototype,"showLegend",void 0),_D=NG=u([P("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],_D);const p_e=_D,G8=new $r({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let bd=class extends le{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return e==null?e:typeof e=="function"?(Q.getLogger(this).error(".field: field must be a string value"),null):SM(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};u([d()],bd.prototype,"index",void 0),u([d({type:G8.apiValues,readOnly:!0,json:{read:G8.read,write:G8.write}})],bd.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],bd.prototype,"field",void 0),u([wr("field")],bd.prototype,"castField",null),u([d({type:String,json:{write:!0}})],bd.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],bd.prototype,"valueExpressionTitle",void 0),u([d({readOnly:!0})],bd.prototype,"arcadeRequired",null),u([d({type:p_e,json:{write:!0}})],bd.prototype,"legendOptions",void 0),bd=u([P("esri.renderers.visualVariables.VisualVariable")],bd);const FM=bd;var FG;let F1=FG=class extends le{constructor(t){super(t),this.color=null,this.label=null,this.value=null}writeValue(t,e,r){e[r]=t??0}clone(){return new FG({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};u([d({type:Ne,json:{type:[Qi],write:!0}})],F1.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],F1.prototype,"label",void 0),u([d({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],F1.prototype,"value",void 0),u([ke("value")],F1.prototype,"writeValue",null),F1=FG=u([P("esri.renderers.visualVariables.support.ColorStop")],F1);const g9e=F1;var UG;let U1=UG=class extends FM{constructor(t){super(t),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,r)=>e.value-r.value),this._set("stops",t)}clone(){return new UG({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(t=>t.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};u([d({readOnly:!0})],U1.prototype,"cache",null),u([d({type:["color"],json:{type:["colorInfo"]}})],U1.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],U1.prototype,"normalizationField",void 0),u([d({type:[g9e],json:{write:!0}})],U1.prototype,"stops",null),U1=UG=u([P("esri.renderers.visualVariables.ColorVariable")],U1);const f_e=U1;var kG;let $0=kG=class extends le{constructor(t){super(t),this.label=null,this.opacity=null,this.value=null}readOpacity(t,e){return G2(e.transparency)}writeOpacity(t,e,r){e[r]=Y5(t)}clone(){return new kG({label:this.label,opacity:this.opacity,value:this.value})}};u([d({type:String,json:{write:!0}})],$0.prototype,"label",void 0),u([d({type:Number,json:{type:Qi,write:{target:"transparency"}}})],$0.prototype,"opacity",void 0),u([Ae("opacity",["transparency"])],$0.prototype,"readOpacity",null),u([ke("opacity")],$0.prototype,"writeOpacity",null),u([d({type:Number,json:{write:!0}})],$0.prototype,"value",void 0),$0=kG=u([P("esri.renderers.visualVariables.support.OpacityStop")],$0);const y9e=$0;var zG;let k1=zG=class extends FM{constructor(t){super(t),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,r)=>e.value-r.value),this._set("stops",t)}clone(){return new zG({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(t=>t.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};u([d({readOnly:!0})],k1.prototype,"cache",null),u([d({type:["opacity"],json:{type:["transparencyInfo"]}})],k1.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],k1.prototype,"normalizationField",void 0),u([d({type:[y9e],json:{write:!0}})],k1.prototype,"stops",null),k1=zG=u([P("esri.renderers.visualVariables.OpacityVariable")],k1);const BZ=k1;var VG;let ag=VG=class extends FM{constructor(t){super(t),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(t,e,r,i){if(i&&i.messages){const s=`visualVariables[${this.index}]`;i.messages.push(new V("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:s+".valueExpressionTitle",context:i}))}}clone(){return new VG({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions&&this.legendOptions.clone()})}};u([d({readOnly:!0})],ag.prototype,"cache",null),u([d({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],ag.prototype,"axis",void 0),u([d({type:["rotation"],json:{type:["rotationInfo"]}})],ag.prototype,"type",void 0),u([d({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],ag.prototype,"rotationType",void 0),u([d({type:String,json:{write:!0}})],ag.prototype,"valueExpressionTitle",void 0),u([ke("web-scene","valueExpressionTitle")],ag.prototype,"writeValueExpressionTitleWebScene",null),ag=VG=u([P("esri.renderers.visualVariables.RotationVariable")],ag);const m_e=ag;var BG;let HT=BG=class extends le{constructor(t){super(t),this.label=null,this.size=null,this.value=null}clone(){return new BG({label:this.label,size:this.size,value:this.value})}};u([d({type:String,json:{write:!0}})],HT.prototype,"label",void 0),u([d({type:Number,cast:Kr,json:{write:!0}})],HT.prototype,"size",void 0),u([d({type:Number,json:{write:!0}})],HT.prototype,"value",void 0),HT=BG=u([P("esri.renderers.visualVariables.support.SizeStop")],HT);const qT=HT;var GG;let vD=GG=class extends p_e{constructor(){super(...arguments),this.customValues=null}clone(){return new GG({title:this.title,showLegend:this.showLegend,customValues:this.customValues&&this.customValues.slice(0)})}};u([d({type:[Number],json:{write:!0}})],vD.prototype,"customValues",void 0),vD=GG=u([P("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],vD);const _9e=vD;var jg,mo;function A_(t){return t&&t.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function CR(t){return t!=null&&!isNaN(t)&&isFinite(t)}function g_e(t){return t.valueExpression?jg.Expression:t.field&&typeof t.field=="string"?jg.Field:jg.Unknown}function v9e(t,e){const r=e||g_e(t),i=t.valueUnit||"unknown";return r===jg.Unknown?mo.Constant:t.stops?mo.Stops:t.minSize!=null&&t.maxSize!=null&&t.minDataValue!=null&&t.maxDataValue!=null?mo.ClampedLinear:i==="unknown"?t.minSize!=null&&t.minDataValue!=null?t.minSize&&t.minDataValue?mo.Proportional:mo.Additive:mo.Identity:mo.RealWorldSize}(function(t){t.Unknown="unknown",t.Expression="expression",t.Field="field"})(jg||(jg={})),function(t){t.Unknown="unknown",t.Stops="stops",t.ClampedLinear="clamped-linear",t.Proportional="proportional",t.Additive="additive",t.Constant="constant",t.Identity="identity",t.RealWorldSize="real-world-size"}(mo||(mo={}));var jG;function b9e(t){if(!t)return null;const e={};for(const r in t){const i=Z_(t[r]);i&&(e[r]=i)}return Object.keys(e).length!==0?e:null}function w9e(t){if(t==null)return null;const e={};for(const r in t){const i=t[r];i&&(e[r]=i.toJSON())}return Object.keys(e).length!==0?e:null}let Ql=jG=class extends ji(le){constructor(...t){super(...t),this.isAggregate=!1,this.layer=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:Cc(),configurable:!0})}normalizeCtorArgs(t,e,r,i){return t&&!t.declaredClass?t:{geometry:t,symbol:e,attributes:r,popupTemplate:i}}set aggregateGeometries(t){const e=this._get("aggregateGeometries");JSON.stringify(e)!==JSON.stringify(t)&&this._set("aggregateGeometries",t)}set attributes(t){const e=this._get("attributes");e!==t&&(this._set("attributes",t),this._notifyLayer("attributes",e,t))}set geometry(t){const e=this._get("geometry");e!==t&&(this._set("geometry",t),this._notifyLayer("geometry",e,t))}set symbol(t){const e=this._get("symbol");e!==t&&(this._set("symbol",t),this._notifyLayer("symbol",e,t))}set visible(t){const e=this._get("visible");e!==t&&(this._set("visible",t),this._notifyLayer("visible",e,t))}cloneShallow(){return new jG({aggregateGeometries:this.aggregateGeometries,attributes:this.attributes,geometry:this.geometry,isAggregate:this.isAggregate,layer:this.layer,popupTemplate:this.popupTemplate,sourceLayer:this.sourceLayer,symbol:this.symbol,visible:this.visible})}getEffectivePopupTemplate(t=!1){if(this.popupTemplate)return this.popupTemplate;for(const e of[this.sourceLayer,this.layer])if(e){if("popupTemplate"in e&&e.popupTemplate)return e.popupTemplate;if(t&&"defaultPopupTemplate"in e&&e.defaultPopupTemplate!=null)return e.defaultPopupTemplate}return null}getAttribute(t){return this.attributes?.[t]}setAttribute(t,e){if(this.attributes){const r=this.getAttribute(t);this.attributes[t]=e,this._notifyLayer("attributes",r,e,t)}else this.attributes={[t]:e},this._notifyLayer("attributes",void 0,e,t)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{aggregateGeometries:w9e(this.aggregateGeometries),geometry:this.geometry!=null?this.geometry.toJSON():null,symbol:this.symbol!=null?this.symbol.toJSON():null,attributes:{...this.attributes},popupTemplate:this.popupTemplate&&this.popupTemplate.toJSON()}}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}notifyMeshTransformChanged(t={}){const{geometry:e}=this;if(e?.type==="mesh"){const r={origin:e.origin,transform:e.transform};this._notifyLayer("origin-transform",r,r,t.action)}}_notifyLayer(t,e,r,i){if(!this.layer||!("graphicChanged"in this.layer))return;const s={graphic:this,property:t,oldValue:e,newValue:r};t==="origin-transform"&&(s.action=i),t==="attributes"&&(s.attributeName=i),this.layer.graphicChanged(s)}};u([d({value:null,json:{read:b9e}})],Ql.prototype,"aggregateGeometries",null),u([d({value:null})],Ql.prototype,"attributes",null),u([d({value:null,types:ix,json:{read:Z_}})],Ql.prototype,"geometry",null),u([d({type:Boolean})],Ql.prototype,"isAggregate",void 0),u([d({clonable:"reference"})],Ql.prototype,"layer",void 0),u([d({type:_v})],Ql.prototype,"popupTemplate",void 0),u([d({clonable:"reference"})],Ql.prototype,"sourceLayer",void 0),u([d({value:null,types:ew})],Ql.prototype,"symbol",null),u([d({type:Boolean,value:!0})],Ql.prototype,"visible",null),Ql=jG=u([P("esri.Graphic")],Ql),function(t){t.generateUID=Cc}(Ql||(Ql={}));const Nl=Ql,Q2={unknown:1,inches:Do(1,"meters","inches"),feet:Do(1,"meters","feet"),"us-feet":Do(1,"meters","us-feet"),yards:Do(1,"meters","yards"),miles:Do(1,"meters","miles"),"nautical-miles":Do(1,"meters","nautical-miles"),millimeters:Do(1,"meters","millimeters"),centimeters:Do(1,"meters","centimeters"),decimeters:Do(1,"meters","decimeters"),meters:Do(1,"meters","meters"),kilometers:Do(1,"meters","kilometers"),"decimal-degrees":1/VDe(1,"meters",or.radius)},Q_=Q.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),tre=new Nl,bD=Math.PI,y_e=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function __e(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(y=>y.type==="color"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void Q_.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const s=typeof e=="number",n=s?null:e,o=n&&n.attributes;let a=s?e:null;const l=i.field,{ipData:c,hasExpression:h}=i.cache;let p=i.cache.compiledFunc;if(!l&&!h){const y=i.stops;return y&&y[0]&&y[0].color}if(typeof a!="number")if(h){if(r==null||r.arcade==null)return void Q_.error("Use of arcade expressions requires an arcade context");const y={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},_=r.arcade.arcadeUtils,v=_.getViewInfo(y),b=_.createExecContext(n,v);if(!p){const T=_.createSyntaxTree(i.valueExpression);p=_.createFunction(T),i.cache.compiledFunc=p}a=_.executeFunction(p,b)}else o&&(a=o[l]);const f=i.normalizationField,m=o!=null&&f!=null?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const y=jZ(a,c);if(y){const _=y[0],v=y[1],b=_===v?i.stops[_].color:Ne.blendColors(i.stops[_].color,i.stops[v].color,y[2],r?.color);return new Ne(b)}}}function v_e(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(y=>y.type==="opacity"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void Q_.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const s=typeof e=="number",n=s?null:e,o=n&&n.attributes;let a=s?e:null;const l=i.field,{ipData:c,hasExpression:h}=i.cache;let p=i.cache.compiledFunc;if(!l&&!h){const y=i.stops;return y&&y[0]&&y[0].opacity}if(typeof a!="number")if(h){if(r==null||r.arcade==null)return void Q_.error("Use of arcade expressions requires an arcade context");const y={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},_=r.arcade.arcadeUtils,v=_.getViewInfo(y),b=_.createExecContext(n,v);if(!p){const T=_.createSyntaxTree(i.valueExpression);p=_.createFunction(T),i.cache.compiledFunc=p}a=_.executeFunction(p,b)}else o&&(a=o[l]);const f=i.normalizationField,m=o!=null&&f!=null?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const y=jZ(a,c);if(y){const _=y[0],v=y[1];if(_===v)return i.stops[_].opacity;{const b=i.stops[_].opacity;return b+(i.stops[v].opacity-b)*y[2]}}}}function b_e(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(m=>m.type==="rotation"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void Q_.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const s=i.axis||"heading",n=s==="heading"&&i.rotationType==="arithmetic"?90:0,o=s==="heading"&&i.rotationType==="arithmetic"?-1:1,a=typeof e=="number"?null:e,l=a&&a.attributes,c=i.field,{hasExpression:h}=i.cache;let p=i.cache.compiledFunc,f=0;if(!c&&!h)return f;if(h){if(r==null||r.arcade==null)return void Q_.error("Use of arcade expressions requires an arcade context");const m={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},y=r.arcade.arcadeUtils,_=y.getViewInfo(m),v=y.createExecContext(a,_);if(!p){const b=y.createSyntaxTree(i.valueExpression);p=y.createFunction(b),i.cache.compiledFunc=p}f=y.executeFunction(p,v)}else l&&(f=l[c]||0);return f=typeof f!="number"||isNaN(f)?null:n+o*f,f}function x9e(t,e,r){const i=typeof e=="number",s=i?null:e,n=s&&s.attributes;let o=i?e:null;const{isScaleDriven:a}=t.cache;let l=t.cache.compiledFunc;if(a){const h=r?.scale,p=r?.view;o=h==null||p==="3d"?T9e(t):h}else if(!i)switch(t.inputValueType){case jg.Expression:{if(r==null||r.arcade==null)return void Q_.error("Use of arcade expressions requires an arcade context");const h={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},p=r.arcade.arcadeUtils,f=p.getViewInfo(h),m=p.createExecContext(s,f);if(!l){const y=p.createSyntaxTree(t.valueExpression);l=p.createFunction(y),t.cache.compiledFunc=l}o=p.executeFunction(l,m);break}case jg.Field:n&&(o=n[t.field]);break;case jg.Unknown:o=null}if(!CR(o))return null;if(i||!t.normalizationField)return o;const c=n?parseFloat(n[t.normalizationField]):null;return CR(c)&&c!==0?o/c:null}function T9e(t){let e=null,r=null;const i=t.stops;return i?(e=i[0].value,r=i[i.length-1].value):(e=t.minDataValue||0,r=t.maxDataValue||0),(e+r)/2}function f6(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(n=>n.type==="size"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void Q_.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const s=x_e(x9e(i,e,r),i,e,r,i.cache.ipData);return s==null||isNaN(s)?0:s}function Rc(t,e,r){return t==null?null:A_(t)?f6(t,e,r):CR(t)?t:null}function w_e(t,e,r){return CR(r)&&t>r?r:CR(e)&&t<e?e:t}function S9e(t,e,r,i){return t+((Rc(e.minSize,r,i)||e.minDataValue)??0)}function E9e(t,e,r){const i=t.stops;let s=i&&i.length&&i[0].size;return s==null&&(s=t.minSize),Rc(s,e,r)}function C9e(t,e,r,i){const s=(t-e.minDataValue)/(e.maxDataValue-e.minDataValue),n=Rc(e.minSize,r,i),o=Rc(e.maxSize,r,i),a=i?.shape;if(t<=e.minDataValue)return n;if(t>=e.maxDataValue)return o;if(n==null||o==null)return null;if(e.scaleBy==="area"&&a){const l=a==="circle",c=l?bD*(n/2)**2:n*n,h=c+s*((l?bD*(o/2)**2:o*o)-c);return l?2*Math.sqrt(h/bD):Math.sqrt(h)}return n+s*(o-n)}function A9e(t,e,r,i){const s=i?.shape,n=t/e.minDataValue,o=Rc(e.minSize,r,i),a=Rc(e.maxSize,r,i);let l=null;return l=s==="circle"?2*Math.sqrt(n*(o/2)**2):s==="square"||s==="diamond"||s==="image"?Math.sqrt(n*o**2):n*o,w_e(l,o,a)}function O9e(t,e,r,i,s){const[n,o,a]=jZ(t,s);if(n===o)return Rc(e.stops?.[n].size,r,i);{const l=Rc(e.stops?.[n].size,r,i);return l+(Rc(e.stops?.[o].size,r,i)-l)*a}}function R9e(t,e,r,i){const s=(i!=null&&i.resolution?i.resolution:1)*Q2[e.valueUnit],n=Rc(e.minSize,r,i),o=Rc(e.maxSize,r,i),{valueRepresentation:a}=e;let l=null;return l=a==="area"?2*Math.sqrt(t/bD)/s:a==="radius"||a==="distance"?2*t/s:t/s,w_e(l,n,o)}function x_e(t,e,r,i,s){switch(e.transformationType){case mo.Additive:return S9e(t,e,r,i);case mo.Constant:return E9e(e,r,i);case mo.ClampedLinear:return C9e(t,e,r,i);case mo.Proportional:return A9e(t,e,r,i);case mo.Stops:return O9e(t,e,r,i,s);case mo.RealWorldSize:return R9e(t,e,r,i);case mo.Identity:return t;case mo.Unknown:return null}}function M9e(t,e,r){const{isScaleDriven:i}=t.cache;if(!(i&&r==="3d"||e))return null;const s={scale:e,view:r};let n=Rc(t.minSize,tre,s),o=Rc(t.maxSize,tre,s);if(n!=null||o!=null){if(n>o){const a=o;o=n,n=a}return{minSize:n,maxSize:o}}}function GZ(t,e,r){if(!t.visualVariables)return;const i=[],s=[],n=[],o=[],a=[];for(const l of t.visualVariables)switch(l.type){case"color":s.push(l);break;case"opacity":n.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return s.forEach(l=>{const c=__e(l,e,r);i.push({variable:l,value:c})}),n.forEach(l=>{const c=v_e(l,e,r);i.push({variable:l,value:c})}),a.forEach(l=>{const c=b_e(l,e,r);i.push({variable:l,value:c})}),o.forEach(l=>{const c=f6(l,e,r);i.push({variable:l,value:c})}),i.filter(l=>l.value!=null)}function jZ(t,e){if(!e)return;let r=0,i=e.length-1;return e.some((s,n)=>t<s?(i=n,!0):(r=n,!1)),[r,i,(t-e[r])/(e[i]-e[r])]}function P9e(t,e,r){const i=["proportional","proportional","proportional"];for(const s of t){const n=s.useSymbolValue?"symbol-value":f6(s,e,r);switch(s.axis){case"width":i[0]=n;break;case"depth":i[1]=n;break;case"height":i[2]=n;break;case"width-and-depth":i[0]=n,i[1]=n;break;case"all":case void 0:case null:i[0]=n,i[1]=n,i[2]=n;break;default:s.axis}}return i}const Y$t=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:P9e,getColor:__e,getOpacity:v_e,getRotationAngle:b_e,getSize:f6,getSizeForValue:x_e,getSizeFromNumberOrVariable:Rc,getSizeRangeAtScale:M9e,getVisualVariableValues:GZ,viewScaleRE:y_e},Symbol.toStringTag,{value:"Module"}));var HG;const qP=new $r({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),qG=new $r({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function rre(t){if(t!=null)return typeof t=="string"||typeof t=="number"?Kr(t):t.type==="size"?A_(t)?t:(delete(t={...t}).type,new ui(t)):void 0}function ire(t,e,r){if(typeof t!="object")return t;const i=new ui;return i.read(t,r),i}let ui=HG=class extends FM{constructor(t){super(t),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:this.valueExpression!=null&&y_e.test(this.valueExpression)}}set expression(t){Q.getLogger(this).warn("'expression' is deprecated since version 4.2. Use 'valueExpression' instead. The only supported expression is 'view.scale'."),t==="view.scale"?(this.valueExpression="$view.scale",this._set("expression",t)):this._set("expression",null)}set index(t){A_(this.maxSize)&&(this.maxSize.index=`visualVariables[${t}].maxSize`),A_(this.minSize)&&(this.minSize.index=`visualVariables[${t}].minSize`),this._set("index",t)}get inputValueType(){return g_e(this)}set maxDataValue(t){t&&this.stops&&(Q.getLogger(this).warn("cannot set maxDataValue when stops is not null."),t=null),this._set("maxDataValue",t)}set maxSize(t){t&&this.stops&&(Q.getLogger(this).warn("cannot set maxSize when stops is not null."),t=null),this._set("maxSize",t)}castMaxSize(t){return rre(t)}readMaxSize(t,e,r){return ire(t,e,r)}set minDataValue(t){t&&this.stops&&(Q.getLogger(this).warn("cannot set minDataValue when stops is not null."),t=null),this._set("minDataValue",t)}set minSize(t){t&&this.stops&&(Q.getLogger(this).warn("cannot set minSize when stops is not null."),t=null),this._set("minSize",t)}castMinSize(t){return rre(t)}readMinSize(t,e,r){return ire(t,e,r)}get arcadeRequired(){return!!this.valueExpression||this.minSize!=null&&typeof this.minSize=="object"&&this.minSize.arcadeRequired||this.maxSize!=null&&typeof this.maxSize=="object"&&this.maxSize.arcadeRequired}set stops(t){this.minDataValue==null&&this.maxDataValue==null&&this.minSize==null&&this.maxSize==null?t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,r)=>e.value-r.value):t&&(Q.getLogger(this).warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),t=null),this._set("stops",t)}get transformationType(){return v9e(this,this.inputValueType)}readValueExpression(t,e){return t||e.expression&&"$view.scale"}writeValueExpressionWebScene(t,e,r,i){if(t==="$view.scale"){if(i&&i.messages){const s=this.index,n=typeof s=="string"?s:`visualVariables[${s}]`;i.messages.push(new V("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:n+".valueExpression",context:i}))}}else e[r]=t}readValueUnit(t){return t?qG.read(t):null}clone(){return new HG({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:A_(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:A_(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(t=>t.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone()})}flipSizes(){if(this.transformationType===mo.ClampedLinear){const{minSize:t,maxSize:e}=this;return this.minSize=e,this.maxSize=t,this}if(this.transformationType===mo.Stops){const t=this.stops;if(!t)return this;const e=t.map(i=>i.size).reverse(),r=t.length;for(let i=0;i<r;i++)t[i].size=e[i];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};u([d({readOnly:!0})],ui.prototype,"cache",null),u([d({type:qP.apiValues,json:{type:qP.jsonValues,origins:{"web-map":{read:!1}},read:qP.read,write:qP.write}})],ui.prototype,"axis",void 0),u([d({type:String,value:null,json:{read:!1}})],ui.prototype,"expression",null),u([d()],ui.prototype,"index",null),u([d({type:String,readOnly:!0})],ui.prototype,"inputValueType",null),u([d({type:_9e,json:{write:!0}})],ui.prototype,"legendOptions",void 0),u([d({type:Number,value:null,json:{write:!0}})],ui.prototype,"maxDataValue",null),u([d({type:Number,value:null,json:{write:!0}})],ui.prototype,"maxSize",null),u([wr("maxSize")],ui.prototype,"castMaxSize",null),u([Ae("maxSize")],ui.prototype,"readMaxSize",null),u([d({type:Number,value:null,json:{write:!0}})],ui.prototype,"minDataValue",null),u([d({type:Number,value:null,json:{write:!0}})],ui.prototype,"minSize",null),u([wr("minSize")],ui.prototype,"castMinSize",null),u([Ae("minSize")],ui.prototype,"readMinSize",null),u([d({type:String,json:{write:!0}})],ui.prototype,"normalizationField",void 0),u([d({readOnly:!0})],ui.prototype,"arcadeRequired",null),u([d({type:String})],ui.prototype,"scaleBy",void 0),u([d({type:[qT],value:null,json:{write:!0}})],ui.prototype,"stops",null),u([d({type:["outline"],json:{write:!0}})],ui.prototype,"target",void 0),u([d({type:String,readOnly:!0})],ui.prototype,"transformationType",null),u([d({type:["size"],json:{type:["sizeInfo"]}})],ui.prototype,"type",void 0),u([d({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],ui.prototype,"useSymbolValue",void 0),u([d({type:String,json:{write:!0}})],ui.prototype,"valueExpression",void 0),u([Ae("valueExpression",["valueExpression","expression"])],ui.prototype,"readValueExpression",null),u([ke("web-scene","valueExpression")],ui.prototype,"writeValueExpressionWebScene",null),u([d({type:["radius","diameter","area","width","distance"],json:{write:!0}})],ui.prototype,"valueRepresentation",void 0),u([d({type:qG.apiValues,json:{write:qG.write,origins:{"web-map":{read:!1},"web-scene":{write:!0},"portal-item":{write:!0}}}})],ui.prototype,"valueUnit",void 0),u([Ae("valueUnit")],ui.prototype,"readValueUnit",null),ui=HG=u([P("esri.renderers.visualVariables.SizeVariable")],ui);const m6=ui,I9e={color:f_e,size:m6,opacity:BZ,rotation:m_e},$9e=new $r({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),L9e=/^\[([^\]]+)\]$/i;let wD=class extends we{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),(e=e&&e.filter(r=>!!r))&&e.length){for(const r of e)switch(r.type){case"color":this.colorVariables.push(r);break;case"opacity":this.opacityVariables.push(r);break;case"rotation":this.rotationVariables.push(r);break;case"size":this.sizeVariables.push(r)}this.sizeVariables.length&&this.sizeVariables.some(r=>!!r.target)&&e.sort((r,i)=>{let s=null;return s=r.target===i.target?0:r.target?1:-1,s});for(let r=0;r<e.length;r++)e[r].index=r;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,r,i){const{rotationExpression:s,rotationType:n}=r,o=s&&s.match(L9e),a=o&&o[1];if(a&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:n,field:a})),e)return e.map(l=>{const c=$9e.read(l.type),h=I9e[c];h||(Q.getLogger(this).warn(`Unknown variable type: ${c}`),i&&i.messages&&i.messages.push(new Nh("visual-variable:unsupported",`visualVariable of type '${c}' is not supported`,{definition:l,context:i})));const p=new h;return p.read(l,i),p})}writeVariables(e,r){const i=[];for(const s of e){const n=s.toJSON(r);n&&i.push(n)}return i}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};u([d()],wD.prototype,"visualVariables",null),wD=u([P("esri.renderers.visualVariables.VisualVariableFactory")],wD);const D9e=wD,N9e={base:FM,key:"type",typeMap:{opacity:BZ,color:f_e,rotation:m_e,size:m6}},KE=t=>{let e=class extends t{constructor(){super(...arguments),this._vvFactory=new D9e}set visualVariables(r){this._vvFactory.visualVariables=r,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(r,i,s){return this._vvFactory.readVariables(r,i,s)}writeVisualVariables(r,i,s,n){i[s]=this._vvFactory.writeVariables(r,n)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const r of this.visualVariables)if(r.arcadeRequired)return!0;return!1}hasVisualVariables(r,i){return r?this.getVisualVariablesForType(r,i).length>0:this.getVisualVariablesForType("size",i).length>0||this.getVisualVariablesForType("color",i).length>0||this.getVisualVariablesForType("opacity",i).length>0||this.getVisualVariablesForType("rotation",i).length>0}getVisualVariablesForType(r,i){const s=this.visualVariables;return s?s.filter(n=>n.type===r&&(typeof i=="string"?n.target===i:i!==!1||!n.target)):[]}async collectVVRequiredFields(r,i){let s=[];this.visualVariables&&(s=s.concat(this.visualVariables));for(const n of s)n&&(n.field&&_u(r,i,n.field),n.normalizationField&&_u(r,i,n.normalizationField),n.valueExpression&&(F9e(n.valueExpression,r,i)||await Dl(r,i,n.valueExpression)))}};return u([d({types:[N9e],value:null,json:{write:!0}})],e.prototype,"visualVariables",null),u([Ae("visualVariables",["visualVariables","rotationType","rotationExpression"])],e.prototype,"readVisualVariables",null),u([ke("visualVariables")],e.prototype,"writeVisualVariables",null),e=u([P("esri.renderers.mixins.VisualVariablesMixin")],e),e};function F9e(t,e,r){const i=f9e(t);return i!=null&&(_u(e,r,i),!0)}const PC={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function U9e(t,e=PC){if(!t)return{symbol:null};const{retainId:r=PC.retainId,ignoreDrivers:i=PC.ignoreDrivers,hasLabelingContext:s=PC.hasLabelingContext,retainCIM:n=PC.retainCIM}=e;let o=null;if(Aw(t)||t instanceof lx)o=t.clone();else if(t.type==="cim"){const a=t.data?.symbol?.type;if(a!=="CIMPointSymbol")return{error:new V("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${a||"unknown"}' is unsupported in 3D`,{symbol:t})};o=n?t.clone():Uf.fromCIMSymbol(t)}else if(t instanceof $u)o=d6.fromSimpleLineSymbol(t);else if(t instanceof xv)o=Uf.fromSimpleMarkerSymbol(t);else if(t instanceof DM)o=Uf.fromPictureMarkerSymbol(t);else if(t instanceof wv)o=e.geometryType&&e.geometryType==="mesh"?J2.fromSimpleFillSymbol(t):NM.fromSimpleFillSymbol(t);else{if(!(t instanceof ax))return{error:new V("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${t.type||t.declaredClass}' is unsupported in 3D`,{symbol:t})};o=s?LM.fromTextSymbol(t):Uf.fromTextSymbol(t)}return r&&o&&o.type!=="cim"&&(o.id=t.id),i&&Aw(o)&&o.symbolLayers.forEach(a=>a.ignoreDrivers=!0),{symbol:o}}function P4(t,e,r,i){const s=T_e(t,{},{context:i,isLabelSymbol:!1});s!=null&&(e[r]=s)}function sre(t,e,r,i){const s=T_e(t,{},{context:i,isLabelSymbol:!0});s!=null&&(e[r]=s)}function nre(t){return t instanceof QE||t instanceof lx}function T_e(t,e,r){if(t==null)return null;const{context:i,isLabelSymbol:s}=r,n=i?.origin,o=i?.messages;if(n==="web-scene"&&!nre(t)){const a=U9e(t,{retainCIM:!0,hasLabelingContext:s});return a.symbol!=null?a.symbol.write(e,i):(o?.push(new V("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:t,context:i,error:a.error})),null)}return(n==="web-map"||n==="portal-item"&&!rge(i?.layer))&&nre(t)?(o?.push(new V("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:t,context:i})),null):t.write(e,i)}function S_e(t,e){return n9e(t,null,e)}const eC={types:u_e,json:{write:{writer:P4},origins:{"web-scene":{types:Xte,write:{writer:P4},read:{reader:BE({types:Xte})}}}}},E_e={types:{base:Dc,key:"type",typeMap:{"simple-fill":ew.typeMap["simple-fill"],"picture-fill":ew.typeMap["picture-fill"],"polygon-3d":ew.typeMap["polygon-3d"]}},json:{write:{writer:P4},origins:{"web-scene":{type:NM,write:{writer:P4}}}}},xD={cast:t=>t==null||typeof t=="string"||typeof t=="number"?t:`${t}`,json:{type:String,write:{writer:(t,e)=>{e.value=t?.toString()}}}};var WG;let L0=WG=class extends le{constructor(t){super(t),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new WG({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const t=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${t}`}};u([d({type:String,json:{write:!0}})],L0.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],L0.prototype,"label",void 0),u([d({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],L0.prototype,"minValue",void 0),u([d({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],L0.prototype,"maxValue",void 0),u([d(eC)],L0.prototype,"symbol",void 0),L0=WG=u([P("esri.renderers.support.ClassBreakInfo")],L0);const I4=L0;var XG;const C_e="log",TD="percent-of-total",SD="field",WP=new $r({esriNormalizeByLog:C_e,esriNormalizeByPercentOfTotal:TD,esriNormalizeByField:SD}),k9e=vs(I4);let Fn=XG=class extends KE(xy){constructor(t){super(t),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(t,e,r){if(!Array.isArray(t))return;let i=e.minValue;return t.map(s=>{const n=new I4;return n.read(s,r),n.minValue==null&&(n.minValue=i),n.maxValue==null&&(n.maxValue=n.minValue),i=n.maxValue,n})}writeClassBreakInfos(t,e,r,i){const s=t.map(n=>n.write({},i));this._areClassBreaksConsecutive()&&s.forEach(n=>delete n.classMinValue),e[r]=s}castField(t){return t==null?t:typeof t=="function"?(Q.getLogger(this).error(".field: field must be a string value"),null):SM(t)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let t=this._get("normalizationType");const e=!!this.normalizationField,r=this.normalizationTotal!=null;return e||r?(t=e&&SD||r&&TD||null,e&&r&&Q.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):t!==SD&&t!==TD||(t=null),t}set normalizationType(t){this._set("normalizationType",t)}addClassBreakInfo(t,e,r){let i=null;i=typeof t=="number"?new I4({minValue:t,maxValue:e,symbol:h_e(r)}):k9e(K(t)),this.classBreakInfos.push(i),this.classBreakInfos.length===1&&this.notifyChange("minValue")}removeClassBreakInfo(t,e){const r=this.classBreakInfos.length;for(let i=0;i<r;i++){const s=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(s[0]===t&&s[1]===e){this.classBreakInfos.splice(i,1);break}}}getBreakIndex(t,e){return!this.valueExpression||e!=null&&e.arcade!=null||Q.getLogger(this).warn(""),this.valueExpression?this._getBreakIndexForExpression(t,e):this._getBreakIndexForField(t)}async getClassBreakInfo(t,e){let r=e;!this.valueExpression||e!=null&&e.arcade!=null||(r={...r,arcade:await Y_()});const i=this.getBreakIndex(t,r);return i!==-1?this.classBreakInfos[i]:null}getSymbol(t,e){if(this.valueExpression&&(e==null||e.arcade==null))return void Q.getLogger(this).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const r=this.getBreakIndex(t,e);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}async getSymbolAsync(t,e){let r=e;if(this.valueExpression&&(e==null||e.arcade==null)){const s=await Y_(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),r={...r,arcade:s}}const i=this.getBreakIndex(t,r);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}getSymbols(){const t=[];return this.classBreakInfos.forEach(e=>{e.symbol&&t.push(e.symbol)}),this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),r=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${t}.${e}.${this.classBreakInfos.reduce((i,s)=>i+s.getMeshHash(),"")}.${r}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new XG({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol&&this.backgroundFillSymbol.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:K(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:K(this.visualVariables),legendOptions:K(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}async collectRequiredFields(t,e){const r=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(r)}async collectSymbolFields(t,e){const r=[...this.getSymbols().map(i=>i.collectRequiredFields(t,e)),Dl(t,e,this.valueExpression)];_u(t,e,this.field),_u(t,e,this.normalizationField),await Promise.all(r)}_getBreakIndexForExpression(t,e){const{viewingMode:r,scale:i,spatialReference:s,arcade:n}=e??{},{valueExpression:o}=this;let a=this._compiledValueExpression.valueExpression===o?this._compiledValueExpression.compiledFunction:null;const l=n.arcadeUtils;if(!a){const h=l.createSyntaxTree(o);a=l.createFunction(h),this._compiledValueExpression.compiledFunction=a}this._compiledValueExpression.valueExpression=o;const c=l.executeFunction(a,l.createExecContext(t,l.getViewInfo({viewingMode:r,scale:i,spatialReference:s})));return this._getBreakIndexfromInfos(c)}_getBreakIndexForField(t){const e=this.field,r=t.attributes,i=this.normalizationType;let s=parseFloat(r[e]);if(i){const n=this.normalizationTotal,o=parseFloat(this.normalizationField?r[this.normalizationField]:void 0);if(i===C_e)s=Math.log(s)*Math.LOG10E;else if(i!==TD||n==null||isNaN(n)){if(i===SD&&!isNaN(o)){if(isNaN(s)||isNaN(o))return-1;s/=o}}else s=s/n*100}return this._getBreakIndexfromInfos(s)}_getBreakIndexfromInfos(t){const e=this.isMaxInclusive;if(t!=null&&typeof t=="number"&&!isNaN(t))for(let r=0;r<this.classBreakInfos.length;r++){const i=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(i[0]<=t&&(e?t<=i[1]:t<i[1]))return r}return-1}_areClassBreaksConsecutive(){const t=this.classBreakInfos,e=t.length;for(let r=1;r<e;r++)if(t[r-1].maxValue!==t[r].minValue)return!1;return!0}};u([d(E_e)],Fn.prototype,"backgroundFillSymbol",void 0),u([d({type:[I4]})],Fn.prototype,"classBreakInfos",void 0),u([Ae("classBreakInfos")],Fn.prototype,"readClassBreakInfos",null),u([ke("classBreakInfos")],Fn.prototype,"writeClassBreakInfos",null),u([d({type:String,json:{write:!0}})],Fn.prototype,"defaultLabel",void 0),u([d(eC)],Fn.prototype,"defaultSymbol",void 0),u([d({type:String,json:{write:!0}})],Fn.prototype,"field",void 0),u([wr("field")],Fn.prototype,"castField",null),u([d({type:Boolean})],Fn.prototype,"isMaxInclusive",void 0),u([d({type:d2,json:{write:!0}})],Fn.prototype,"legendOptions",void 0),u([d({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return this.classBreakInfos.length!==0&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],Fn.prototype,"minValue",null),u([d({type:String,json:{write:!0}})],Fn.prototype,"normalizationField",void 0),u([d({type:Number,cast:t=>yh(t),json:{write:!0}})],Fn.prototype,"normalizationTotal",void 0),u([d({type:WP.apiValues,value:null,json:{type:WP.jsonValues,read:WP.read,write:WP.write}})],Fn.prototype,"normalizationType",null),u([it({classBreaks:"class-breaks"})],Fn.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Fn.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],Fn.prototype,"valueExpressionTitle",void 0),Fn=XG=u([P("esri.renderers.ClassBreaksRenderer")],Fn);const HZ=Fn,ED=-3;var Pg;(function(t){t[t.ALL=0]="ALL",t[t.SOME=1]="SOME"})(Pg||(Pg={}));let z9e=class{constructor(e,r,i){this.name=e,this._storage=r,this.id=V9e+++":",this.size=0,this.maxSize=0,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),i&&(this._storage.registerRemoveFunc(this.id,i),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get sizeAll(){return this._storage.size}resetHitRate(){this._hit=this._miss=0}put(e,r,i,s=0){this._storage.put(this,e,r,i,s)}get(e){const r=this._storage.get(this,e);return r===void 0?++this._miss:++this._hit,r}pop(e){const r=this._storage.pop(this,e);return r===void 0?++this._miss:++this._hit,r}updateSize(e,r,i){this._storage.updateSize(this,e,r,i)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}},A_e=class{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new Bt,this._users=new Bt}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,r){this._removeFuncs.push([e,r])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace(r=>r[0]!==e)}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,0),this._checkSizeLimits()}put(e,r,i,s,n){r=e.id+r;const o=this._db.get(r);if(o&&(this._size-=o.size,e.size-=o.size,this._db.delete(r),o.entry!==i&&this._notifyRemove(r,o.entry,Pg.ALL)),s>this._maxSize)return void this._notifyRemove(r,i,Pg.ALL);if(i===void 0)return void console.warn("Refusing to cache undefined entry ");if(!s||s<0)return void console.warn("Refusing to cache entry with invalid size "+s);const a=1+Math.max(n,ED)-ED;this._db.set(r,{entry:i,size:s,lifetime:a,lives:a}),this._size+=s,e.size+=s,this._checkSizeLimits()}updateSize(e,r,i,s){r=e.id+r;const n=this._db.get(r);if(n&&n.entry===i){for(this._size-=n.size,e.size-=n.size;s>this._maxSize;){const o=this._notifyRemove(r,i,Pg.SOME);if(!(o!=null&&o>0))return void this._db.delete(r);s=o}n.size=s,this._size+=s,e.size+=s,this._checkSizeLimits()}}pop(e,r){r=e.id+r;const i=this._db.get(r);if(i)return this._size-=i.size,e.size-=i.size,this._db.delete(r),++this._hit,i.entry;++this._miss}get(e,r){r=e.id+r;const i=this._db.get(r);if(i!==void 0)return this._db.delete(r),i.lives=i.lifetime,this._db.set(r,i),++this._hit,i.entry;++this._miss}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},r={},i=new Array;this._db.forEach((o,a)=>{const l=o.lifetime;i[l]=(i[l]||0)+o.size,this._users.forAll(c=>{const{id:h,name:p}=c;if(a.startsWith(h)){const f=r[p]||0;r[p]=f+o.size}})});const s={};this._users.forAll(o=>{const a=o.name;if("hitRate"in o&&typeof o.hitRate=="number"&&!isNaN(o.hitRate)&&o.hitRate>0){const l=r[a]||0;r[a]=l,s[a]=Math.round(100*o.hitRate)+"%"}else s[a]="0%"});const n=Object.keys(r);n.sort((o,a)=>r[a]-r[o]),n.forEach(o=>e[o]=Math.round(r[o]/2**20)+"MB / "+s[o]);for(let o=i.length-1;o>=0;--o){const a=i[o];a&&(e["Priority "+(o+ED-1)]=Math.round(a/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll(e=>e.resetHitRate())}clear(e){const r=e.id;this._db.forEach((i,s)=>{s.startsWith(r)&&(this._size-=i.size,this._db.delete(s),this._notifyRemove(s,i.entry,Pg.ALL))}),e.size=0}clearAll(){this._db.forEach((e,r)=>this._notifyRemove(r,e.entry,Pg.ALL)),this._users.forEach(e=>e.size=0),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,r,i){let s;return this._removeFuncs.some(n=>{if(e.startsWith(n[0])){const o=n[1](r,i);return typeof o=="number"&&(s=o),!0}return!1}),s}_checkSizeLimits(){if(this._size>this._maxSize){for(const[e,r]of this._db)if(this._purgeItem(e,r),this._size<=.9*this.maxSize)return}this._users.forEach(e=>{if(e.maxSize>0&&e.size>e.maxSize){for(const[r,i]of this._db)if(r.startsWith(e.id)&&(this._purgeItem(r,i,e),e.size<=.9*e.maxSize))return}})}_purgeItem(e,r,i=this._users.find(s=>e.startsWith(s.id))){if(this._db.delete(e),r.lives<=1){this._size-=r.size,i&&(i.size-=r.size);const s=this._notifyRemove(e,r.entry,Pg.SOME);s!=null&&s>0&&(this._size+=s,i&&(i.size+=s),r.lives=r.lifetime,r.size=s,this._db.set(e,r))}else--r.lives,this._db.set(e,r)}},V9e=0,O_e=class{constructor(e,r){this._storage=new A_e,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this),r&&this._storage.registerRemoveFunc("",r)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,r,i=1){this._storage.put(this,e,r,i,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}},Ow=class{constructor(e,r,i=""){this.major=e,this.minor=r,this._context=i}lessThan(e,r){return this.major<e||e===this.major&&this.minor<r}since(e,r){return!this.lessThan(e,r)}validate(e){if(this.major!==e.major){const r=this._context&&this._context+":",i=this._context&&this._context+" ";throw new V(r+"unsupported-version",`Required major ${i}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new Ow(this.major,this.minor,this._context)}static parse(e,r=""){const[i,s]=e.split("."),n=/^\s*\d+\s*$/;if(!i||!i.match||!n.test(i))throw new V((r&&r+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!s||!s.match||!n.test(s))throw new V((r&&r+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});const o=parseInt(i,10),a=parseInt(s,10);return new Ow(o,a,r)}};function B9e(t){return t.type==="date"||t.type==="esriFieldTypeDate"||t.type==="date-only"||t.type==="esriFieldTypeDateOnly"||t.type==="timestamp-offset"||t.type==="esriFieldTypeTimestampOffset"}function ore(t){return t.type==="oid"||t.type==="esriFieldTypeOID"}function are(t){return t.type==="global-id"||t.type==="esriFieldTypeGlobalID"}let qZ=class{constructor(e=[]){if(this.fields=[],this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this.dateFields=[],this.numericFields=[],this._requiredFields=null,!e)return;this.fields=e;const r=[];for(const i of e){const s=i?.name,n=cre(i?.name);if(s&&n){const o=lre(s);this._fieldsMap.set(s,i),this._fieldsMap.set(o,i),this._normalizedFieldsMap.set(n,i),r.push(o),B9e(i)?(this.dateFields.push(i),this._dateFieldsSet.add(i)):mZ(i)&&(this._numericFieldsSet.add(i),this.numericFields.push(i)),ore(i)||are(i)||(i.editable=i.editable==null||!!i.editable,i.nullable=i.nullable==null||!!i.nullable)}}r.sort(),this.uid=r.join(",")}destroy(){this._fieldsMap.clear()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)ore(e)||are(e)||e.nullable||E5e(e)!==void 0||this._requiredFields.push(e)}return this._requiredFields}has(e){return this.get(e)!=null}get(e){if(!e)return;let r=this._fieldsMap.get(e);return r||(r=this._fieldsMap.get(lre(e))??this._normalizedFieldsMap.get(cre(e)),r&&this._fieldsMap.set(e,r),r)}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){const r=this.get(e);if(r)return r.name??void 0}};function lre(t){return t.trim().toLowerCase()}function cre(t){return a5e(t)?.toLowerCase()??""}const ure="esri.renderers.support.DictionaryLoader",G9e={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};let WZ=class{constructor(e,r,i){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new O_e(100),this._dictionaryVersion=null,this._fieldIndex=null,this._dictionaryPromise=null,this.url=e,this.config=r,this.fieldMap=i}getSymbolFields(){return this._symbolFields}async getSymbolAsync(e,r){let i;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(r));try{i=await this._dictionaryPromise}catch(y){if(us(y))return this._dictionaryPromise=null,null}const s=this._dictionaryVersion&&this._dictionaryVersion.since(4,0),n={};if(this.fieldMap)for(const y of this._symbolFields){const _=this._getFieldName(this.fieldMap[y]);n[y]=_?s?e.attributes[_]:""+e.attributes[_]:""}let o=null;try{o=i?.(n,r)}catch{return null}if(!o||typeof o!="string")return null;const a=oX(o).toString(),l=this._symbolCache.get(a);if(l)return l.catch(()=>{this._symbolCache.pop(a)}),l;const c=o.split(";"),h=[],p=[];for(const y of c)if(y)if(y.includes("po:")){const _=y.substr(3).split("|");if(_.length===3){const v=_[0],b=_[1];let T=_[2];if(b==="DashTemplate")T=T.split(" ").map(x=>Number(x));else if(b==="Color"){const x=new Ne(T).toRgba();T=[x[0],x[1],x[2],255*x[3]]}else T=Number(T);p.push({primitiveName:v,propertyName:b,value:T})}}else if(y.includes("|")){for(const _ of y.split("|"))if(this._itemNames.has(_)){h.push(_);break}}else this._itemNames.has(y)&&h.push(y);const f=e.geometry==null||!e.geometry.hasZ&&e.geometry.type==="point",m=this._cimPartsToCIMSymbol(h,p,f,r);return this._symbolCache.put(a,m,1),m}async fetchResources(e){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void Q.getLogger(ure).error("no valid URL!");const r=hr(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:e!=null?e.signal:null}),[{data:i}]=await Promise.all([r,Y_()]);if(!i)throw this._dictionaryPromise=null,new V("esri.renderers.DictionaryRenderer","Bad dictionary data!");const{authoringInfo:s,dictionary_version:n,expression:o,itemsNames:a}=i,l=o;let c=!1;n&&(this._dictionaryVersion=Ow.parse(n),c=this._dictionaryVersion.since(4,0)),this._refSymbolUrlTemplate=this.url+"/"+i.cimRefTemplateUrl,this._itemNames=new Set(a),this._symbolFields=s.symbol;const h={};if(this.config){const m=this.config;for(const y in m)h[y]=m[y]}if(s.configuration)for(const m of s.configuration)h.hasOwnProperty(m.name)||(h[m.name]=m.value);const p=[];if(e!=null&&e.fields&&this.fieldMap)for(const m of this._symbolFields){const y=this.fieldMap[m],_=e.fields.filter(v=>v.name.toLowerCase()===y?.toLowerCase());_.length>0&&p.push({..._[0],type:c?_[0].type:"esriFieldTypeString"})}p.length>0&&(this._fieldIndex=new qZ(p));const f=s5e(l,e!=null?e.spatialReference:null,p,h).then(m=>{const y={scale:0};return(_,v)=>{if(m==null)return null;const b=m.repurposeFeature({geometry:null,attributes:_});return y.scale=v!=null?v.scale??void 0:void 0,m.evaluate({$feature:b,$view:y},m.services)}}).catch(m=>(Q.getLogger(ure).error("Creating dictinoary expression failed:",m),null));return this._dictionaryPromise=f,f}async _cimPartsToCIMSymbol(e,r,i,s){const n=new Array(e.length);for(let l=0;l<e.length;l++)n[l]=this._getSymbolPart(e[l],s);const o=await Promise.all(n),a=this.fieldMap;if(a)for(const l of o)R_e(l,a);return new JE({data:this._combineSymbolParts(o,r,i)})}async _getSymbolPart(e,r){if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then(n=>n.data);const i=this._refSymbolUrlTemplate.replaceAll(/\{itemName\}/gi,e),s=hr(i,{responseType:"json",query:{f:"json"},...r});this._ongoingRequests.set(e,s);try{return(await s).data}catch(n){throw this._ongoingRequests.delete(e),n}}_combineSymbolParts(e,r,i){if(!e||e.length===0)return null;const s={...e[0]};if(e.length>1){s.symbolLayers=[];for(const n of e){const o=n;s.symbolLayers.unshift(...o.symbolLayers)}}return i&&(s.callout=G9e),{type:"CIMSymbolReference",symbol:s,primitiveOverrides:r}}_getFieldName(e){if(this._fieldIndex!==null){const r=this._fieldIndex.get(e);return r?r.name:e}return e}};function R_e(t,e){if(!t)return;const r=t.symbolLayers;if(!r)return;let i=r.length;for(;i--;){const s=r[i];s&&s.enable!==!1&&s.type==="CIMVectorMarker"&&j9e(s,e)}}function j9e(t,e){const r=t.markerGraphics;if(r)for(const i of r){if(!i)continue;const s=i.symbol;if(s)switch(s.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":R_e(s,e);break;case"CIMTextSymbol":s.fieldMap=e}}}const sLt=Object.freeze(Object.defineProperty({__proto__:null,DictionaryLoader:WZ},Symbol.toStringTag,{value:"Module"}));var ZG;let wd=ZG=class extends KE(xy){constructor(t){super(t),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new WZ(this.url,this.config,this.fieldMap)}writeData(t,e){t&&(e.scalingExpressionInfo={expression:t,returnType:"number"})}writeVisualVariables(t,e,r,i){i?.origin||super.writeVisualVariables(t,e,r,i)}clone(){return new ZG({config:K(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:K(this.fieldMap),url:K(this.url),visualVariables:K(this.visualVariables)})}async getSymbolAsync(t,e){return this._loader.getSymbolAsync(t,e)}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e),this.scaleExpression&&await Dl(t,e,this.scaleExpression);for(const r in this.fieldMap){const i=this.fieldMap[r];e.has(i)&&t.add(i)}}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};u([d({type:WZ})],wd.prototype,"_loader",null),u([d({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],wd.prototype,"config",void 0),u([d({type:Object,json:{write:!0}})],wd.prototype,"fieldMap",void 0),u([d({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],wd.prototype,"scaleExpression",void 0),u([ke("scaleExpression")],wd.prototype,"writeData",null),u([d({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(t){return{enabled:!!t&&!!this.scaleExpression}}}}})],wd.prototype,"scaleExpressionTitle",void 0),u([d({type:String,json:{write:!0}})],wd.prototype,"url",void 0),u([ke("visualVariables")],wd.prototype,"writeVisualVariables",null),wd=ZG=u([P("esri.renderers.DictionaryRenderer")],wd);const H9e=wd;var YG;let lg=YG=class extends le{constructor(t){super(t),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(t){return t==null?t:typeof t=="function"?(Q.getLogger(this).error(".field: field must be a string value"),null):SM(t)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new YG({color:this.color&&this.color.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([d({type:Ne,json:{type:[Number],write:!0}})],lg.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],lg.prototype,"field",void 0),u([wr("field")],lg.prototype,"castField",null),u([d({type:String,json:{write:!0}})],lg.prototype,"label",void 0),u([d({type:String,json:{write:!0}})],lg.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],lg.prototype,"valueExpressionTitle",void 0),lg=YG=u([P("esri.renderers.support.AttributeColorInfo")],lg);const M_e=lg;var JG;let CD=JG=class extends le{constructor(){super(...arguments),this.unit=null}clone(){return new JG({unit:this.unit})}};u([d({type:String,json:{write:!0}})],CD.prototype,"unit",void 0),CD=JG=u([P("esri.renderers.support.DotDensityLegendOptions")],CD);const q9e=CD;var QG;let Kl=QG=class extends KE(xy){constructor(t){super(t),this.attributes=null,this.backgroundColor=new Ne([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new $u,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(t){if(this.referenceScale==null)return this.dotValue;const e=t/this.referenceScale*this.dotValue;return e<1?1:e}getSymbol(){return new wv({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){return this.attributes?.reduce((t,e)=>t+e.getAttributeHash(),"")??""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new QG({attributes:K(this.attributes),backgroundColor:K(this.backgroundColor),dotBlendingEnabled:K(this.dotBlendingEnabled),dotShape:K(this.dotShape),dotSize:K(this.dotSize),dotValue:K(this.dotValue),legendOptions:K(this.legendOptions),outline:K(this.outline),referenceScale:K(this.referenceScale),visualVariables:K(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}getControllerHash(){return`${this.attributes?.map(e=>e.field||e.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e);for(const r of this.attributes??[])r.valueExpression&&await Dl(t,e,r.valueExpression),r.field&&t.add(r.field)}};u([d({type:[M_e],json:{write:!0}})],Kl.prototype,"attributes",void 0),u([d({type:Ne,json:{write:!0}})],Kl.prototype,"backgroundColor",void 0),u([d({type:Boolean,json:{write:!0}})],Kl.prototype,"dotBlendingEnabled",void 0),u([d({type:String,json:{write:!1}})],Kl.prototype,"dotShape",void 0),u([d({type:Number,json:{write:!0}})],Kl.prototype,"dotSize",void 0),u([d({type:q9e,json:{write:!0}})],Kl.prototype,"legendOptions",void 0),u([d({type:$u,json:{default:null,write:!0}})],Kl.prototype,"outline",void 0),u([d({type:Number,json:{write:!0}})],Kl.prototype,"dotValue",void 0),u([d({type:Number,json:{write:!0}})],Kl.prototype,"referenceScale",void 0),u([d({type:Number,json:{write:!0}})],Kl.prototype,"seed",void 0),u([it({dotDensity:"dot-density"})],Kl.prototype,"type",void 0),Kl=QG=u([P("esri.renderers.DotDensityRenderer")],Kl);const W9e=Kl;var KG;let l3=KG=class extends le{constructor(t){super(t),this.color=null,this.ratio=null}clone(){return new KG({color:this.color,ratio:this.ratio})}};u([d({type:Ne,json:{type:[Qi],default:null,write:!0}})],l3.prototype,"color",void 0),u([d({type:Number,json:{write:!0}})],l3.prototype,"ratio",void 0),l3=KG=u([P("esri.renderers.support.HeatmapColorStop")],l3);const AD=l3;let WT=class extends ji(le){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};u([d({type:String,json:{write:!0}})],WT.prototype,"minLabel",void 0),u([d({type:String,json:{write:!0}})],WT.prototype,"maxLabel",void 0),u([d({type:String,json:{write:!0}})],WT.prototype,"title",void 0),WT=u([P("esri.renderers.support.HeatmapLegendOptions")],WT);function Xt(){return[0,0,0,0]}function UM(t){return[t[0],t[1],t[2],t[3]]}function Nt(t,e,r,i){return[t,e,r,i]}function XZ(t){const e=Xt(),r=Math.min(4,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function P_e(t,e){return new Float64Array(t,e,4)}function I_e(){return Xt()}function $_e(){return Nt(1,1,1,1)}function L_e(){return Nt(1,0,0,0)}function D_e(){return Nt(0,1,0,0)}function N_e(){return Nt(0,0,1,0)}function F_e(){return Nt(0,0,0,1)}const Wf=I_e(),Ch=$_e(),X9e=L_e(),Z9e=D_e(),Y9e=N_e(),J9e=F_e();Object.freeze(Object.defineProperty({__proto__:null,ONES:Ch,UNIT_W:J9e,UNIT_X:X9e,UNIT_Y:Z9e,UNIT_Z:Y9e,ZEROS:Wf,clone:UM,create:Xt,createView:P_e,fromArray:XZ,fromValues:Nt,ones:$_e,unitW:F_e,unitX:L_e,unitY:D_e,unitZ:N_e,zeros:I_e},Symbol.toStringTag,{value:"Module"}));const ZZ=2.4;function Q9e(t){return Uh(t*ZZ)}function K9e(t){return _o(t)/ZZ}function eke(t,e,r,i){let{color:s,ratio:n}=e,{color:o,ratio:a}=r;a===n&&(a===1?n-=1e-6:a+=1e-6);const l=ve((i-n)/(a-n),0,1);Z5(t,s.toArray(),o.toArray(),l)}function oLt(t){const r=new Uint8ClampedArray(2048);if(t=t.filter(({ratio:a})=>a>=0&&a<=1).sort((a,l)=>a.ratio-l.ratio).map(({color:a,ratio:l})=>({color:a,ratio:Math.max(l,.001)})),t.length<1)return r;let i=t[0],s=t[0],n=1;const o=Xt();for(let a=0;a<512;a++){const l=(a+.5)/512;for(;l>s.ratio&&n<t.length;)i=s,s=t[n++];eke(o,i,s,l),r.set(o,4*a)}return r}function aLt(t,e,r,i){const{radius:s,fieldOffset:n,field:o}=e,a=Math.round(_o(s)),l=new Float64Array(r*i);let c,h=Number.NEGATIVE_INFINITY;const p=rke(o,n),f=new Set;for(const m of t){const y=m.getCursor();for(;y.next();){const _=y.getObjectId();if(f.has(_))continue;f.add(_);const v=y.readLegacyPointGeometry(),b=128;if(v.x<-b||v.x>=r+b||v.y<-b||v.y>i+b)continue;const T=+p(y),x=Math.max(0,Math.round(v.x)-a),S=Math.max(0,Math.round(v.y)-a),E=Math.min(i,Math.round(v.y)+a),A=Math.min(r,Math.round(v.x)+a);for(let R=S;R<E;R++)for(let M=x;M<A;M++){const D=R*r+M,k=tke(v.x-M,v.y-R,a);c=l[D]+=k*T,c>h&&(h=c)}}}return{matrix:l.buffer,max:h}}function tke(t,e,r){const i=Math.sqrt(t**2+e**2)/r;return i>1?0:3/(Math.PI*r**2)*(1-i**2)**2}function lLt(t,e){return typeof t=="function"?t:t?typeof e=="string"?r=>-1*+r[t]:r=>+r[t]+e:()=>1}function rke(t,e){return t!=null?typeof e=="string"?r=>-1*+r.readAttribute(t):r=>+r.readAttribute(t)+e:r=>1}var e7;const U_e="esri.renderers.HeatmapRenderer",ike=Q.getLogger(U_e);function hre(t){if(t!=null){const{maxDensity:e,minDensity:r,radius:i}=t;if(e!=null||r!=null||i!=null){const{blurRadius:s,maxPixelIntensity:n,minPixelIntensity:o,...a}=t;return a}}return t}let co=e7=class extends xy{constructor(t){super(t),this.authoringInfo=null,this.colorStops=[new AD({ratio:0,color:new Ne("rgba(255, 140, 0, 0)")}),new AD({ratio:.75,color:new Ne("rgba(255, 140, 0, 1)")}),new AD({ratio:.9,color:new Ne("rgba(255, 0,   0, 1)")})],this.field=null,this.fieldOffset=0,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null,this._warnedProps={blurRadius:!1,maxPixelIntensity:!1,minPixelIntensity:!1}}normalizeCtorArgs(t){return hre(t)}get blurRadius(){return K9e(this.radius)}set blurRadius(t){const e=this.maxPixelIntensity,r=this.minPixelIntensity;this._set("radius",Q9e(t)),this._warnAboutDeprecatedGaussianBlurProp("blurRadius","radius"),this._set("maxDensity",e*this._pixelIntensityToDensity),this._set("minDensity",r*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(t){this._set("maxDensity",t*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("maxPixelIntensity","maxDensity")}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(t){this._set("minDensity",t*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("minPixelIntensity","minDensity")}get _pixelIntensityToDensity(){return 24/(ZZ**2*this.blurRadius**4)}_warnAboutDeprecatedGaussianBlurProp(t,e){this._warnedProps[t]||ma(this).getDefaultOrigin()==="user"&&(this._warnedProps[t]=!0,VE(()=>{rp(ike,t,{replacement:`${String(e)} (suggested value: ${this._get(e)})`,version:"4.24"})}))}read(t,e){t=hre(t),super.read(t,e)}getSymbol(){return new xv}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}async collectRequiredFields(t,e){const r=this.field,i=this.valueExpression;r&&typeof r=="string"&&await _u(t,e,r),i&&typeof i=="string"&&await Dl(t,e,i)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new e7({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:K(this.colorStops),field:this.field,legendOptions:K(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([d({type:VZ,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],co.prototype,"authoringInfo",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],co.prototype,"blurRadius",null),u([d({type:[AD],json:{write:!0}})],co.prototype,"colorStops",void 0),u([d({type:String,json:{write:!0}})],co.prototype,"field",void 0),u([d({type:Number,json:{write:{overridePolicy:(t,e,r)=>({enabled:r==null})},origins:{"web-scene":{write:!1}}}})],co.prototype,"fieldOffset",void 0),u([d({type:WT,json:{write:!0}})],co.prototype,"legendOptions",void 0),u([d({type:Number,json:{write:!0}})],co.prototype,"maxDensity",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],co.prototype,"maxPixelIntensity",null),u([d({type:Number,json:{write:!0}})],co.prototype,"minDensity",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],co.prototype,"minPixelIntensity",null),u([d({type:Number,cast:Kr,json:{write:!0}})],co.prototype,"radius",void 0),u([d({type:Number,range:{min:0},json:{default:0,write:!0}})],co.prototype,"referenceScale",void 0),u([it({heatmap:"heatmap"})],co.prototype,"type",void 0),u([d({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],co.prototype,"valueExpression",void 0),u([d({type:String})],co.prototype,"valueExpressionTitle",void 0),u([d({readOnly:!0})],co.prototype,"_pixelIntensityToDensity",null),co=e7=u([P(U_e)],co);const k_e=co;let wb=class extends ji(le){constructor(){super(...arguments),this.color=new Ne([0,0,0,0]),this.label=null,this.threshold=0}};u([d({type:Ne,json:{write:!0}})],wb.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],wb.prototype,"label",void 0),u([d({type:Number,range:{min:0,max:1},json:{write:!0}})],wb.prototype,"threshold",void 0),wb=u([P("esri.renderers.support.OthersCategory")],wb);let OD=class extends ji(le){constructor(){super(...arguments),this.title=null}};u([d({type:String,json:{write:!0}})],OD.prototype,"title",void 0),OD=u([P("esri.renderers.support.PieChartLegendOptions")],OD);let Wc=class extends KE(ji(xy)){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new Ne([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new wb,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart"}getSymbol(){return new xv({size:this.size?this.size/2+(this.outline?.width||0):0})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter(jf)}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,r)=>e+r.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,r)=>e+JSON.stringify(r),"")}async collectRequiredFields(e,r){await this.collectVVRequiredFields(e,r);for(const i of this.attributes)i.valueExpression&&await Dl(e,r,i.valueExpression),i.field&&e.add(i.field)}};u([d({type:[M_e],json:{write:!0}})],Wc.prototype,"attributes",void 0),u([d({type:wv,json:{default:null,write:!0}})],Wc.prototype,"backgroundFillSymbol",void 0),u([d({type:Ne,json:{write:!0}})],Wc.prototype,"defaultColor",void 0),u([d({type:String,json:{write:!0}})],Wc.prototype,"defaultLabel",void 0),u([d({type:Number,range:{min:0,max:1},json:{write:!0}})],Wc.prototype,"holePercentage",void 0),u([d({type:wb,json:{write:!0}})],Wc.prototype,"othersCategory",void 0),u([d({type:OD,json:{write:!0}})],Wc.prototype,"legendOptions",void 0),u([d({type:$u,json:{default:null,write:!0}})],Wc.prototype,"outline",void 0),u([d({type:Number,cast:Kr,json:{write:!0}})],Wc.prototype,"size",void 0),u([it({pieChart:"pie-chart"})],Wc.prototype,"type",void 0),Wc=u([P("esri.renderers.PieChartRenderer")],Wc);const ske=Wc;var t7;let z1=t7=class extends KE(xy){constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(t,e){await Promise.all([this.collectSymbolFields(t,e),this.collectVVRequiredFields(t,e)])}async collectSymbolFields(t,e){await Promise.all(this.getSymbols().map(r=>r.collectRequiredFields(t,e)))}getSymbol(t,e){return this.symbol}async getSymbolAsync(t,e){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((t,e)=>t+JSON.stringify(e),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new t7({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:K(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}};u([d({type:String,json:{write:!0}})],z1.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],z1.prototype,"label",void 0),u([d(eC)],z1.prototype,"symbol",void 0),u([it({simple:"simple"})],z1.prototype,"type",void 0),z1=t7=u([P("esri.renderers.SimpleRenderer")],z1);const kM=z1,nke=["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"];function r7(t){return t instanceof we}function dre(t){return t instanceof Pt?Object.keys(t.items):r7(t)?ma(t).keys():t?Object.keys(t):[]}function XP(t,e){return t instanceof Pt?t.items[e]:t[e]}function oke(t,e){return!(!Array.isArray(t)||!Array.isArray(e))&&t.length!==e.length}function CO(t){return t?t.declaredClass:null}function z_e(t,e){const r=t.diff;if(r&&typeof r=="function")return r(t,e);const i=dre(t),s=dre(e);if(i.length===0&&s.length===0)return;if(!i.length||!s.length||oke(t,e))return{type:"complete",oldValue:t,newValue:e};const n=s.filter(p=>!i.includes(p)),o=i.filter(p=>!s.includes(p)),a=i.filter(p=>s.includes(p)&&XP(t,p)!==XP(e,p)).concat(n,o).sort(),l=CO(t);if(l&&nke.includes(l)&&a.length)return{type:"complete",oldValue:t,newValue:e};let c;const h=r7(t)&&r7(e);for(const p of a){const f=XP(t,p),m=XP(e,p);let y;if((h||typeof f!="function"&&typeof m!="function")&&f!==m&&(f!=null||m!=null)){if(r&&r[p]&&typeof r[p]=="function")y=r[p]?.(f,m);else if(f instanceof Date&&m instanceof Date){if(f.getTime()===m.getTime())continue;y={type:"complete",oldValue:f,newValue:m}}else y=typeof f=="object"&&typeof m=="object"&&CO(f)===CO(m)?z_e(f,m):{type:"complete",oldValue:f,newValue:m};y!=null&&(c!=null?c.diff[p]=y:c={type:"partial",diff:{[p]:y}})}}return c}function ake(t,e){if(t==null)return!1;const r=e.split(".");let i=t;for(const s of r){if(i.type==="complete")return!0;if(i.type!=="partial")return!1;{const n=i.diff[s];if(!n)return!1;i=n}}return!0}function dLt(t,e){for(const r of e)if(ake(t,r))return!0;return!1}function lke(t,e){if(typeof t!="function"&&typeof e!="function"&&(t!=null||e!=null))return t==null||e==null||typeof t=="object"&&typeof e=="object"&&CO(t)!==CO(e)?{type:"complete",oldValue:t,newValue:e}:z_e(t,e)}function ZP(t){if(t==null)return!0;switch(t.type){case"complete":return!1;case"collection":{const e=t;for(const r of e.added)if(!ZP(r))return!1;for(const r of e.removed)if(!ZP(r))return!1;for(const r of e.changed)if(!ZP(r))return!1;return!0}case"partial":for(const e in t.diff)if(!ZP(t.diff[e]))return!1;return!0}}let XT=class extends ji(le){constructor(e){super(e),this.value=null,this.value2=null,this.value3=null}};u([d(xD)],XT.prototype,"value",void 0),u([d(xD)],XT.prototype,"value2",void 0),u([d(xD)],XT.prototype,"value3",void 0),XT=u([P("esri.renderers.support.UniqueValue")],XT);const p2=XT;let D0=class extends ji(le){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.values=null}castValues(e){if(e==null)return null;const r=typeof(e=Array.isArray(e)?e:[e])[0];return r==="string"||r==="number"?e.map(i=>new p2({value:i})):r==="object"?e[0]instanceof p2?e:e.map(i=>new p2(i)):null}};u([d({type:String,json:{write:!0}})],D0.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],D0.prototype,"label",void 0),u([d(eC)],D0.prototype,"symbol",void 0),u([d({type:[p2],json:{type:[[String]],read:{reader:t=>t?t.map(e=>new p2({value:e[0],value2:e[1],value3:e[2]})):null},write:{writer:(t,e)=>{const r=[];for(const i of t){const s=[i.value,i.value2,i.value3].filter(jf).map(n=>n.toString());r.push(s)}e.values=r}}}})],D0.prototype,"values",void 0),u([wr("values")],D0.prototype,"castValues",null),D0=u([P("esri.renderers.support.UniqueValueClass")],D0);const V_e=D0;let c3=class extends ji(le){constructor(e){super(e),this.heading=null,this.classes=null}};u([d({type:String,json:{write:!0}})],c3.prototype,"heading",void 0),u([d({type:[V_e],json:{write:!0}})],c3.prototype,"classes",void 0),c3=u([P("esri.renderers.support.UniqueValueGroup")],c3);const i7=c3;var s7;let V1=s7=class extends le{constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new s7({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const t=JSON.stringify(this.symbol&&this.symbol.toJSON());return`${this.value}.${t}`}};u([d({type:String,json:{write:!0}})],V1.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],V1.prototype,"label",void 0),u([d(eC)],V1.prototype,"symbol",void 0),u([d(xD)],V1.prototype,"value",void 0),V1=s7=u([P("esri.renderers.support.UniqueValueInfo")],V1);const AO=V1,cke=()=>!!oe("enable-feature:force-wosr"),gLt=()=>!!oe("enable-feature:direct-3d-object-feature-layer-display"),uke=()=>oe.add("enable-feature:direct-3d-object-feature-layer-display",!0,!0,!0),hke=()=>oe.add("enable-feature:direct-3d-object-feature-layer-display",!1,!0,!0),yLt=()=>!!oe("enable-i3s-patching"),dke=()=>oe.add("enable-i3s-patching",!0,!0,!0),pke=()=>oe.add("enable-i3s-patching",!1,!0,!0),pre=()=>!!oe("enable-feature:SceneLayer-editing"),fke=(t="i3s-patching")=>{switch(pke(),hke(),oe.add("enable-feature:SceneLayer-editing",!0,!0,!0),t){case"feature-layer-view":uke();break;case"i3s-patching":dke()}};fke("i3s-patching");let j8={};async function mke(t,e){try{return{data:(await JZ(t,e)).data,baseUrl:OX(t),styleUrl:t}}catch(r){return Fo(r),null}}function gke(t,e,r){const i=e.portal!=null?e.portal:Js.getDefault();let s;const n=`${i.url} - ${i.user&&i.user.username} - ${t}`;return j8[n]||(j8[n]=yke(t,i,r).then(o=>(s=o,o.fetchData())).then(o=>({data:o,baseUrl:s.itemUrl??"",styleName:t}))),j8[n]}function yke(t,e,r){return e.load(r).then(()=>{const i=new Mf({disableExtraQuery:!0,query:`owner:${fre} AND type:${mre} AND typekeywords:"${t}"`});return e.queryItems(i,r)}).then(({results:i})=>{let s=null;const n=t.toLowerCase();if(i&&Array.isArray(i)){for(const o of i)if(o.typeKeywords?.some(l=>l.toLowerCase()===n)&&o.type===mre&&o.owner===fre){s=o;break}}if(!s)throw new V("symbolstyleutils:style-not-found",`The style '${t}' could not be found`,{styleName:t});return s.load(r)})}function YZ(t,e,r){return t&&t.styleUrl!=null?mke(t.styleUrl,r):t&&t.styleName!=null?gke(t.styleName,e,r):Promise.reject(new V("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function B_e(t){return t===null||t.type==="CIMSymbolReference"?t:{type:"CIMSymbolReference",symbol:t}}function G_e(t,e,r=["gltf"]){if(e==="cimRef")return t.cimRef;if(t.formatInfos&&!cke())for(const i of r){const s=t.formatInfos.find(n=>n.type===i);if(s)return s.href}return t.webRef}function JZ(t,e){const r={responseType:"json",query:{f:"json"},...e};return hr(hp(t),r)}const fre="esri_en",mre="Style",_ke="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json";var u3;const j_e="esri.renderers.UniqueValueRenderer",Xy=Q.getLogger(j_e),gre="uvInfos-watcher",yre="uvGroups-watcher",vke=",",bke=vs(AO);function wke(t){const{field1:e,field2:r,field3:i,fieldDelimiter:s,uniqueValueInfos:n,valueExpression:o}=t,a=!(!e||!r);return[{classes:(n??[]).map(l=>{const{symbol:c,label:h,value:p,description:f}=l,[m,y,_]=a?p?.toString()?.split(s||"")||[]:[p],v=[];return(e||o)&&v.push(m),r&&v.push(y),i&&v.push(_),{symbol:c,label:h,values:[v],description:f}})}]}let Es=u3=class extends KE(xy){constructor(t){super(t),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this._isInfosSource=null,this.type="unique-value",this.backgroundFillSymbol=null,this.orderByClassesEnabled=!1,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(e,r){if(!e&&!r)return;if(!e||!r)return{type:"complete",oldValue:e,newValue:r};let i=!1;const s={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let n=0;n<r.length;n++){const o=e.find(a=>a.value===r[n].value);o?lke(o,r[n])?(s.changed.push({type:"complete",oldValue:o,newValue:r[n]}),i=!0):s.unchanged.push({oldValue:o,newValue:r[n]}):(s.added.push(r[n]),i=!0)}for(let n=0;n<e.length;n++)r.find(o=>o.value===e[n].value)||(s.removed.push(e[n]),i=!0);return i?s:void 0}},this._set("uniqueValueInfos",[]),this._set("uniqueValueGroups",[])}get _cache(){return{compiledFunc:null}}set field(t){this._set("field",t),this._updateFieldDelimiter(),this._updateUniqueValues()}castField(t){return t==null||typeof t=="function"?t:SM(t)}writeField(t,e,r,i){typeof t=="string"?e[r]=t:i&&i.messages?i.messages.push(new V("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):Xy.error(".field: cannot write field to JSON since it's not a string value")}set field2(t){this._set("field2",t),this._updateFieldDelimiter(),this._updateUniqueValues()}set field3(t){this._set("field3",t),this._updateUniqueValues()}set valueExpression(t){this._set("valueExpression",t),this._updateUniqueValues()}set defaultSymbol(t){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",t)}set fieldDelimiter(t){this._set("fieldDelimiter",t),this._updateUniqueValues()}readPortal(t,e,r){return r.portal||Js.getDefault()}readStyleOrigin(t,e,r){if(e.styleName)return Object.freeze({styleName:e.styleName});if(e.styleUrl){const i=uy(e.styleUrl,r);return Object.freeze({styleUrl:i})}}writeStyleOrigin(t,e,r,i){t.styleName?e.styleName=t.styleName:t.styleUrl&&(e.styleUrl=hy(t.styleUrl,i))}set uniqueValueGroups(t){this.styleOrigin?Xy.error("#uniqueValueGroups=","Cannot modify unique value groups of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueGroups",t),this._updateInfosFromGroups(),this._isInfosSource=!1,this._watchUniqueValueGroups())}set uniqueValueInfos(t){this.styleOrigin?Xy.error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos())}addUniqueValueInfo(t,e){if(this.styleOrigin)return void Xy.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let r;r=typeof t=="object"?bke(t):new AO({value:t,symbol:h_e(e)}),this.uniqueValueInfos?.push(r),this._valueInfoMap[r.value]=r,this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}removeUniqueValueInfo(t){if(this.styleOrigin)return void Xy.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");const e=this.uniqueValueInfos;if(e){for(let r=0;r<e.length;r++)if(e[r].value===t+""){delete this._valueInfoMap[t],e.splice(r,1);break}}this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}async getUniqueValueInfo(t,e){let r=e;return!this.valueExpression||e!=null&&e.arcade!=null||(r={...r,arcade:await Y_()}),this._getUniqueValueInfo(t,r)}getSymbol(t,e){if(this.valueExpression&&(e==null||e.arcade==null))return void Xy.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const r=this._getUniqueValueInfo(t,e);return r&&r.symbol||this.defaultSymbol}async getSymbolAsync(t,e){let r=e;if(this.valueExpression&&(r==null||r.arcade==null)){const s=await Y_(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),r={...r,arcade:s}}const i=this._getUniqueValueInfo(t,r);return i&&i.symbol||this.defaultSymbol}getSymbols(){const t=[];for(const e of this.uniqueValueInfos??[])e.symbol&&t.push(e.symbol);return this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),r=this.uniqueValueInfos?.reduce((i,s)=>i+s.getMeshHash(),"");return`${t}.${e}.${r}.${`${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}`}.${this.valueExpression}`}clone(){const t=new u3({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:K(this.defaultSymbol),orderByClassesEnabled:this.orderByClassesEnabled,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:K(this.visualVariables),legendOptions:K(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),backgroundFillSymbol:K(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(t._isDefaultSymbolDerived=!0),t._set("portal",this.portal);const e=K(this.uniqueValueInfos),r=K(this.uniqueValueGroups);return this.styleOrigin&&(t._set("styleOrigin",Object.freeze(K(this.styleOrigin))),Object.freeze(e),Object.freeze(r)),t._set("uniqueValueInfos",e),t._updateValueInfoMap(),t._set("uniqueValueGroups",r),t._isInfosSource=this._isInfosSource,t._watchUniqueValueInfosAndGroups(),t}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(t,e){const r=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(r)}async collectSymbolFields(t,e){const r=[...this.getSymbols().map(i=>i.collectRequiredFields(t,e)),Dl(t,e,this.valueExpression)];_u(t,e,this.field),_u(t,e,this.field2),_u(t,e,this.field3),await Promise.all(r)}populateFromStyle(){return YZ(this.styleOrigin,{portal:this.portal}).then(t=>{const e=[];return this._valueInfoMap={},t&&t.data&&Array.isArray(t.data.items)&&t.data.items.forEach(r=>{const i=new lx({styleUrl:t.styleUrl,styleName:t.styleName,portal:this.portal,name:r.name});this.defaultSymbol||r.name!==t.data.defaultItem||(this.defaultSymbol=i,this._isDefaultSymbolDerived=!0);const s=new AO({value:r.name,symbol:i});e.push(s),this._valueInfoMap[r.name]=s}),this._set("uniqueValueInfos",Object.freeze(e)),this._updateGroupsFromInfos(!0),this._isInfosSource=null,this._watchUniqueValueInfos(),!this.defaultSymbol&&this.uniqueValueInfos?.length&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateFieldDelimiter(){this.field&&this.field2&&!this.fieldDelimiter&&this._set("fieldDelimiter",vke)}_updateUniqueValues(){this._isInfosSource!=null&&(this._isInfosSource?this._updateGroupsFromInfos():this._updateInfosFromGroups())}_updateValueInfoMap(){this._valueInfoMap={};const{uniqueValueInfos:t}=this;if(t)for(const e of t)this._valueInfoMap[e.value+""]=e}_watchUniqueValueInfosAndGroups(){this._watchUniqueValueInfos(),this._watchUniqueValueGroups()}_watchUniqueValueInfos(){this.removeHandles(gre);const{uniqueValueInfos:t}=this;if(t){const e=[];for(const r of t)e.push(ae(()=>({symbol:r.symbol,value:r.value,label:r.label,description:r.description}),(i,s)=>{i!==s&&(this._updateGroupsFromInfos(),this._isInfosSource=!0)},{sync:!0}));this.addHandles(e,gre)}}_watchUniqueValueGroups(){this.removeHandles(yre);const{uniqueValueGroups:t}=this;if(t){const e=[];for(const r of t){e.push(ae(()=>({classes:r.classes}),(i,s)=>{i!==s&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}));for(const i of r.classes??[])e.push(ae(()=>({symbol:i.symbol,values:i.values,label:i.label,description:i.description}),(s,n)=>{s!==n&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}))}this.addHandles(e,yre)}}_updateInfosFromGroups(){if(!this.uniqueValueGroups)return this._set("uniqueValueInfos",null),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const t=[],{field:e,field2:r,field3:i,fieldDelimiter:s,uniqueValueGroups:n,valueExpression:o}=this;if(!e&&!o)return this._set("uniqueValueInfos",t),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const a=!(!e||!r);for(const l of n)for(const c of l.classes??[]){const{symbol:h,label:p,values:f,description:m}=c;for(const y of f??[]){const{value:_,value2:v,value3:b}=y,T=[_];r&&T.push(v),i&&T.push(b);const x=a?T.join(s||""):T[0];t.push(new AO({symbol:h,label:p,value:x,description:m}))}}this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._watchUniqueValueInfos()}_updateGroupsFromInfos(t=!1){if(!this.uniqueValueInfos)return this._set("uniqueValueGroups",null),void this._watchUniqueValueGroups();const{field:e,field2:r,valueExpression:i,fieldDelimiter:s,uniqueValueInfos:n}=this;if(!e&&!i||!n.length)return this._set("uniqueValueGroups",[]),void this._watchUniqueValueGroups();const o=!(!e||!r),a=n.map(c=>{const{symbol:h,label:p,value:f,description:m}=c,[y,_,v]=o?f?.toString()?.split(s||"")||[]:[f];return new V_e({symbol:h,label:p,description:m,values:[new p2({value:y,value2:_,value3:v})]})}),l=[new i7({classes:a})];t&&Object.freeze(l),this._set("uniqueValueGroups",l),this._watchUniqueValueGroups()}_getUniqueValueInfo(t,e){return this.valueExpression?this._getUnqiueValueInfoForExpression(t,e):this._getUnqiueValueInfoForFields(t)}_getUnqiueValueInfoForExpression(t,e){const{viewingMode:r,scale:i,spatialReference:s,arcade:n}=e??{};let o=this._cache.compiledFunc;const a=n.arcadeUtils;if(!o){const c=a.createSyntaxTree(this.valueExpression);o=a.createFunction(c),this._cache.compiledFunc=o}const l=a.executeFunction(o,a.createExecContext(t,a.getViewInfo({viewingMode:r,scale:i,spatialReference:s})));return this._valueInfoMap[l+""]}_getUnqiueValueInfoForFields(t){const e=this.field,r=t.attributes;let i;if(typeof e!="function"&&this.field2){const s=this.field2,n=this.field3,o=[];e&&o.push(r[e]),s&&o.push(r[s]),n&&o.push(r[n]),i=o.join(this.fieldDelimiter||"")}else typeof e=="function"?i=e(t):e&&(i=r[e]);return this._valueInfoMap[i+""]}static fromPortalStyle(t,e){const r=new u3(e&&e.properties);r._set("styleOrigin",Object.freeze({styleName:t})),r._set("portal",e&&e.portal||Js.getDefault());const i=r.populateFromStyle();return i.catch(s=>{Xy.error(`#fromPortalStyle('${t}'[, ...])`,"Failed to create unique value renderer from style name",s)}),i}static fromStyleUrl(t,e){const r=new u3(e&&e.properties);r._set("styleOrigin",Object.freeze({styleUrl:t}));const i=r.populateFromStyle();return i.catch(s=>{Xy.error(`#fromStyleUrl('${t}'[, ...])`,"Failed to create unique value renderer from style URL",s)}),i}};u([d({readOnly:!0})],Es.prototype,"_cache",null),u([it({uniqueValue:"unique-value"})],Es.prototype,"type",void 0),u([d(E_e)],Es.prototype,"backgroundFillSymbol",void 0),u([d({value:null,json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],Es.prototype,"field",null),u([wr("field")],Es.prototype,"castField",null),u([ke("field")],Es.prototype,"writeField",null),u([d({type:String,value:null,json:{write:!0}})],Es.prototype,"field2",null),u([d({type:String,value:null,json:{write:!0}})],Es.prototype,"field3",null),u([d({type:Boolean,json:{name:"drawInClassOrder",default:!1,write:!0,origins:{"web-scene":{write:!1}}}})],Es.prototype,"orderByClassesEnabled",void 0),u([d({type:String,value:null,json:{write:!0}})],Es.prototype,"valueExpression",null),u([d({type:String,json:{write:!0}})],Es.prototype,"valueExpressionTitle",void 0),u([d({type:d2,json:{write:!0}})],Es.prototype,"legendOptions",void 0),u([d({type:String,json:{write:!0}})],Es.prototype,"defaultLabel",void 0),u([d(xfe({...eC},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],Es.prototype,"defaultSymbol",null),u([d({type:String,value:null,json:{write:!0}})],Es.prototype,"fieldDelimiter",null),u([d({type:Js,readOnly:!0})],Es.prototype,"portal",void 0),u([Ae("portal",["styleName"])],Es.prototype,"readPortal",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],Es.prototype,"styleOrigin",void 0),u([Ae("styleOrigin",["styleName","styleUrl"])],Es.prototype,"readStyleOrigin",null),u([ke("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],Es.prototype,"writeStyleOrigin",null),u([d({type:[i7],json:{read:{source:["uniqueValueGroups","uniqueValueInfos"],reader:(t,e,r)=>(e.uniqueValueGroups||wke(e)).map(i=>i7.fromJSON(i,r))},write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],Es.prototype,"uniqueValueGroups",null),u([d({type:[AO],json:{read:!1,write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],Es.prototype,"uniqueValueInfos",null),Es=u3=u([P(j_e)],Es);const g6=Es,y6={key:"type",base:xy,typeMap:{heatmap:k_e,simple:kM,"unique-value":g6,"class-breaks":HZ,"dot-density":W9e,dictionary:H9e,"pie-chart":ske},errorContext:"renderer"},H_e={key:"type",base:xy,typeMap:{simple:kM,"unique-value":g6,"class-breaks":HZ,heatmap:k_e},errorContext:"renderer"};function _Lt(t,e){return AR(t,null,e)}const xke=BE({types:y6});function AR(t,e,r){return t?t&&(t.styleName||t.styleUrl)&&t.type!=="uniqueValue"?(r&&r.messages&&r.messages.push(new Nh("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+t.type+"'",{definition:t,context:r})),null):xke(t,e,r):null}let Tke=class q_e{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(CV),this._values=new Map,this.multipleOriginsSupported=!0}clone(e){const r=new q_e,i=this._originStores[mr.DEFAULTS];i&&i.forEach((s,n)=>{r.set(n,K(s),mr.DEFAULTS)});for(let s=mr.SERVICE;s<CV;s++){const n=this._originStores[s];n&&n.forEach((o,a)=>{e&&e.has(a)||r.set(a,K(o),s)})}return r}get(e,r){const i=r===void 0?this._values:this._originStores[r];return i?i.get(e):void 0}keys(e){const r=e==null?this._values:this._originStores[e];return r?[...r.keys()]:[]}set(e,r,i=mr.USER){let s=this._originStores[i];if(s||(s=new Map,this._originStores[i]=s),s.set(e,r),!this._values.has(e)||this._propertyOriginMap.get(e)<=i){const n=this._values.get(e);return this._values.set(e,r),this._propertyOriginMap.set(e,i),n!==r}return!1}delete(e,r=mr.USER){const i=this._originStores[r];if(!i)return;const s=i.get(e);if(i.delete(e),this._values.has(e)&&this._propertyOriginMap.get(e)===r){this._values.delete(e);for(let n=r-1;n>=0;n--){const o=this._originStores[n];if(o&&o.has(e)){this._values.set(e,o.get(e)),this._propertyOriginMap.set(e,n);break}}}return s}has(e,r){const i=r===void 0?this._values:this._originStores[r];return!!i&&i.has(e)}revert(e,r){for(;r>0&&!this.has(e,r);)--r;const i=this._originStores[r],s=i&&i.get(e),n=this._values.get(e);return this._values.set(e,s),this._propertyOriginMap.set(e,r),n!==s}originOf(e){return this._propertyOriginMap.get(e)||mr.DEFAULTS}forEach(e){this._values.forEach(e)}};const W_e=t=>{let e=class extends t{constructor(...r){super(...r);const i=ma(this),s=i.store,n=new Tke;i.store=n,pme(i,s,n)}read(r,i){mme(this,r,i)}getAtOrigin(r,i){const s=H8(this),n=Fg(i);if(typeof r=="string")return s.get(r,n);const o={};return r.forEach(a=>{o[a]=s.get(a,n)}),o}originOf(r){return qN(this.originIdOf(r))}originIdOf(r){return H8(this).originOf(r)}revert(r,i){const s=H8(this),n=Fg(i),o=ma(this);let a;a=typeof r=="string"?r==="*"?s.keys(n):[r]:r,a.forEach(l=>{o.invalidate(l),s.revert(l,n),o.commit(l)})}};return e=u([P("esri.core.ReadOnlyMultiOriginJSONSupport")],e),e};function H8(t){return ma(t).store}let _re=class extends W_e(we){};_re=u([P("esri.core.ReadOnlyMultiOriginJSONSupport")],_re);const Ske=t=>{let e=class extends t{constructor(...r){super(...r)}clear(r,i="user"){return q8(this).delete(r,Fg(i))}write(r,i){return yme(this,r=r||{},i),r}setAtOrigin(r,i,s){ma(this).setAtOrigin(r,i,Fg(s))}removeOrigin(r){const i=q8(this),s=Fg(r),n=i.keys(s);for(const o of n)i.originOf(o)===s&&i.set(o,i.get(o,s),mr.USER)}updateOrigin(r,i){const s=q8(this),n=Fg(i),o=this.get(r);for(let a=n+1;a<CV;++a)s.delete(r,a);s.set(r,o,n)}toJSON(r){return this.write({},r)}};return e=u([P("esri.core.WriteableMultiOriginJSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function q8(t){return ma(t).store}const QZ=t=>{let e=class extends Ske(W_e(t)){constructor(...r){super(...r)}};return e=u([P("esri.core.MultiOriginJSONSupport")],e),e};let vre=class extends QZ(we){};vre=u([P("esri.core.MultiOriginJSONSupport")],vre);async function Eke(t,e){const{WhereClause:r}=await ce(()=>import("./WhereClause-e2c9f470.js").then(i=>i.W),["./WhereClause-e2c9f470.js","./executionError-e8d36121.js"],import.meta.url);return r.create(t,e)}function Cke(t,e){return t!=null?e!=null?`(${t}) AND (${e})`:t:e}var n7;let B1=n7=class extends le{constructor(t){super(t),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new n7({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([d({type:String,json:{write:!0}})],B1.prototype,"expression",void 0),u([d({type:String,json:{write:!0}})],B1.prototype,"name",void 0),u([d({type:["boolean","date","number","string"],json:{write:!0}})],B1.prototype,"returnType",void 0),u([d({type:String,json:{write:!0}})],B1.prototype,"title",void 0),B1=n7=u([P("esri.form.ExpressionInfo")],B1);const Ake=B1;let G1=class extends le{constructor(e){super(e),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};u([d({type:String,json:{write:!0}})],G1.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],G1.prototype,"label",void 0),u([d()],G1.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],G1.prototype,"visibilityExpression",void 0),G1=u([P("esri.form.elements.Element")],G1);const K2=G1;var o7;let RD=o7=class extends le{constructor(t){super(t),this.type=null}clone(){return new o7({type:this.type})}};u([d({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],RD.prototype,"type",void 0),RD=o7=u([P("esri.form.elements.inputs.AttachmentInput")],RD);const Oke=RD;var a7;let j1=a7=class extends K2{constructor(t){super(t),this.attachmentKeyword=null,this.editable=!0,this.input=null,this.type="attachment"}clone(){return new a7({attachmentKeyword:this.attachmentKeyword,description:this.description,editable:this.editable,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};u([d({type:String,json:{write:!0}})],j1.prototype,"attachmentKeyword",void 0),u([d({type:Boolean,json:{write:!0}})],j1.prototype,"editable",void 0),u([d({type:Oke,json:{read:{source:"inputType"},write:{target:"inputType"}}})],j1.prototype,"input",void 0),u([d({type:["attachment"],json:{read:!1,write:!0}})],j1.prototype,"type",void 0),j1=a7=u([P("esri.form.elements.AttachmentElement")],j1);const bre=j1;let MD=class extends le{constructor(e){super(e),this.type=null}};u([d()],MD.prototype,"type",void 0),MD=u([P("esri.form.elements.inputs.Input")],MD);const tC=MD;let h3=class extends tC{constructor(e){super(e),this.maxLength=null,this.minLength=0}};u([d({type:Number,json:{write:!0}})],h3.prototype,"maxLength",void 0),u([d({type:Number,json:{write:!0}})],h3.prototype,"minLength",void 0),h3=u([P("esri.form.elements.inputs.TextInput")],h3);const KZ=h3;var l7;let PD=l7=class extends KZ{constructor(t){super(t),this.type="barcode-scanner"}clone(){return new l7({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["barcode-scanner"],json:{read:!1,write:!0}})],PD.prototype,"type",void 0),PD=l7=u([P("esri.form.elements.inputs.BarcodeScannerInput")],PD);const Rke=PD;var c7;let ZT=c7=class extends tC{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="combo-box"}clone(){return new c7({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};u([d({type:String,json:{write:!0}})],ZT.prototype,"noValueOptionLabel",void 0),u([d({type:Boolean,json:{write:!0}})],ZT.prototype,"showNoValueOption",void 0),u([d({type:["combo-box"],json:{read:!1,write:!0}})],ZT.prototype,"type",void 0),ZT=c7=u([P("esri.form.elements.inputs.ComboBoxInput")],ZT);const Mke=ZT;var u7;function wre(t){return t!=null?new Date(t):null}function xre(t){return t?t.getTime():null}let xd=u7=class extends tC{constructor(t){super(t),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(t,e){return wre(e.max)}writeMax(t,e){e.max=xre(t)}readMin(t,e){return wre(e.min)}writeMin(t,e){e.min=xre(t)}clone(){return new u7({includeTime:this.includeTime,max:this.max,min:this.min})}};u([d({type:Boolean,json:{write:!0}})],xd.prototype,"includeTime",void 0),u([d({type:Date,json:{type:Number,write:!0}})],xd.prototype,"max",void 0),u([Ae("max")],xd.prototype,"readMax",null),u([ke("max")],xd.prototype,"writeMax",null),u([d({type:Date,json:{type:Number,write:!0}})],xd.prototype,"min",void 0),u([Ae("min")],xd.prototype,"readMin",null),u([ke("min")],xd.prototype,"writeMin",null),u([d({type:["datetime-picker"],json:{read:!1,write:!0}})],xd.prototype,"type",void 0),xd=u7=u([P("esri.form.elements.inputs.DateTimePickerInput")],xd);const Pke=xd;var h7;let YT=h7=class extends tC{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="radio-buttons"}clone(){return new h7({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};u([d({type:String,json:{write:!0}})],YT.prototype,"noValueOptionLabel",void 0),u([d({type:Boolean,json:{write:!0}})],YT.prototype,"showNoValueOption",void 0),u([d({type:["radio-buttons"],json:{read:!1,write:!0}})],YT.prototype,"type",void 0),YT=h7=u([P("esri.form.elements.inputs.RadioButtonsInput")],YT);const Ike=YT;var d7;let JT=d7=class extends tC{constructor(t){super(t),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new d7({offValue:this.offValue,onValue:this.onValue})}};u([d({type:[String,Number],json:{write:!0}})],JT.prototype,"offValue",void 0),u([d({type:[String,Number],json:{write:!0}})],JT.prototype,"onValue",void 0),u([d({type:["switch"],json:{read:!1,write:!0}})],JT.prototype,"type",void 0),JT=d7=u([P("esri.form.elements.inputs.SwitchInput")],JT);const $ke=JT;var p7;let ID=p7=class extends KZ{constructor(t){super(t),this.type="text-area"}clone(){return new p7({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["text-area"],json:{read:!1,write:!0}})],ID.prototype,"type",void 0),ID=p7=u([P("esri.form.elements.inputs.TextAreaInput")],ID);const Lke=ID;var f7;let $D=f7=class extends KZ{constructor(t){super(t),this.type="text-box"}clone(){return new f7({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["text-box"],json:{read:!1,write:!0}})],$D.prototype,"type",void 0),$D=f7=u([P("esri.form.elements.inputs.TextBoxInput")],$D);const Dke=$D,Nke={base:tC,key:"type",typeMap:{"barcode-scanner":Rke,"combo-box":Mke,"datetime-picker":Pke,"radio-buttons":Ike,switch:$ke,"text-area":Lke,"text-box":Dke}};var m7;let d3=m7=class extends le{constructor(t){super(t),this.name=null,this.code=null}clone(){return new m7({name:this.name,code:this.code})}};u([d({type:String,json:{write:!0}})],d3.prototype,"name",void 0),u([d({type:[String,Number],json:{write:!0}})],d3.prototype,"code",void 0),d3=m7=u([P("esri.layers.support.CodedValue")],d3);const Fke=new $r({inherited:"inherited",codedValue:"coded-value",range:"range"});let p3=class extends le{constructor(e){super(e),this.name=null,this.type=null}};u([d({type:String,json:{write:!0}})],p3.prototype,"name",void 0),u([it(Fke)],p3.prototype,"type",void 0),p3=u([P("esri.layers.support.Domain")],p3);const _6=p3;var g7;let f3=g7=class extends _6{constructor(t){super(t),this.codedValues=null,this.type="coded-value"}getName(t){let e=null;if(this.codedValues){const r=String(t);this.codedValues.some(i=>(String(i.code)===r&&(e=i.name),!!e))}return e}clone(){return new g7({codedValues:K(this.codedValues),name:this.name})}};u([d({type:[d3],json:{write:!0}})],f3.prototype,"codedValues",void 0),u([it({codedValue:"coded-value"})],f3.prototype,"type",void 0),f3=g7=u([P("esri.layers.support.CodedValueDomain")],f3);const X_e=f3;var y7;let LD=y7=class extends _6{constructor(t){super(t),this.type="inherited"}clone(){return new y7}};u([it({inherited:"inherited"})],LD.prototype,"type",void 0),LD=y7=u([P("esri.layers.support.InheritedDomain")],LD);const Z_e=LD;var _7;let QT=_7=class extends _6{constructor(t){super(t),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new _7({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};u([d({type:Number,json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range&&e.range[1]},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(t,e,r){e[r]=[this.minValue||0,t]}}}})],QT.prototype,"maxValue",void 0),u([d({type:Number,json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range&&e.range[0]},write:{target:"range",writer(t,e,r){e[r]=[t,this.maxValue||0]}}}})],QT.prototype,"minValue",void 0),u([it({range:"range"})],QT.prototype,"type",void 0),QT=_7=u([P("esri.layers.support.RangeDomain")],QT);const Y_e=QT,J_e={key:"type",base:_6,typeMap:{range:Y_e,"coded-value":X_e,inherited:Z_e}};function eY(t){if(!t||!t.type)return null;switch(t.type){case"range":return Y_e.fromJSON(t);case"codedValue":return X_e.fromJSON(t);case"inherited":return Z_e.fromJSON(t)}return null}var v7;const Q_e="esri.form.elements.FieldElement",Tre=Q.getLogger(Q_e);let Ku=v7=class extends K2{constructor(t){super(t),this.domain=null,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}get editable(){return rp(Tre,"editable",{replacement:"editableExpression",version:"4.26",warnOnce:!0}),this._get("editable")??!0}set editable(t){rp(Tre,"editable",{replacement:"editableExpression",version:"4.26",warnOnce:!0}),this._set("editable",t)}clone(){return new v7({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};u([d({types:J_e,json:{read:{reader:eY},write:!0}})],Ku.prototype,"domain",void 0),u([d({type:Boolean,json:{write:!0}})],Ku.prototype,"editable",null),u([d({type:String,json:{write:!0}})],Ku.prototype,"editableExpression",void 0),u([d({type:String,json:{write:!0}})],Ku.prototype,"fieldName",void 0),u([d({type:String,json:{write:!0}})],Ku.prototype,"hint",void 0),u([d({types:Nke,json:{read:{source:"inputType"},write:{target:"inputType"}}})],Ku.prototype,"input",void 0),u([d({type:String,json:{write:!0}})],Ku.prototype,"requiredExpression",void 0),u([d({type:String,json:{read:!1,write:!0}})],Ku.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Ku.prototype,"valueExpression",void 0),Ku=v7=u([P(Q_e)],Ku);const Sre=Ku;var b7;let cg=b7=class extends K2{constructor(t){super(t),this.displayCount=null,this.displayType="list",this.editableExpression=null,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new b7({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editableExpression:this.editableExpression,label:this.label,orderByFields:K(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};u([d({type:Number,json:{write:!0}})],cg.prototype,"displayCount",void 0),u([d({type:["list"],json:{write:!0}})],cg.prototype,"displayType",void 0),u([d({type:String,json:{write:!0}})],cg.prototype,"editableExpression",void 0),u([d({type:[AZ],json:{write:!0}})],cg.prototype,"orderByFields",void 0),u([d({type:Number,json:{write:!0}})],cg.prototype,"relationshipId",void 0),u([d({type:["relationship"],json:{read:!1,write:!0}})],cg.prototype,"type",void 0),cg=b7=u([P("esri.form.elements.RelationshipElement")],cg);const Ere=cg;function K_e(t){return{typesWithGroup:{base:K2,key:"type",typeMap:{attachment:bre,field:Sre,group:t,relationship:Ere}},typesWithoutGroup:{base:K2,key:"type",typeMap:{attachment:bre,field:Sre,relationship:Ere}}}}function eve(t,e,r=!0){if(!t)return null;const i=r?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(s=>i[s.type]).map(s=>i[s.type].fromJSON(s))}function tve(t,e,r=!0){if(!t)return null;const i=r?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(s=>i[s.type]).map(s=>s.toJSON())}function rve(t,e,r=!0){return t?t.map(i=>bp(r?e.typesWithGroup:e.typesWithoutGroup,i)):null}var w7;let Sf=w7=class extends K2{constructor(t){super(t),this.elements=null,this.initialState="expanded",this.type="group"}castElements(t){return rve(t,W8,!1)}readElements(t,e){return eve(e.formElements,W8,!1)}writeElements(t,e){e.formElements=tve(t,W8,!1)}clone(){return new w7({description:this.description,elements:K(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};u([d({json:{write:!0}})],Sf.prototype,"elements",void 0),u([wr("elements")],Sf.prototype,"castElements",null),u([Ae("elements",["formElements"])],Sf.prototype,"readElements",null),u([ke("elements")],Sf.prototype,"writeElements",null),u([d({type:["collapsed","expanded"],json:{write:!0}})],Sf.prototype,"initialState",void 0),u([d({type:String,json:{read:!1,write:!0}})],Sf.prototype,"type",void 0),Sf=w7=u([P("esri.form.elements.GroupElement")],Sf);const W8=K_e(Sf),Uke=Sf;var x7;const X8=K_e(Uke);let Td=x7=class extends le{constructor(t){super(t),this.description=null,this.elements=null,this.expressionInfos=null,this.preserveFieldValuesWhenHidden=!1,this.title=null}castElements(t){return rve(t,X8)}readElements(t,e){return eve(e.formElements,X8)}writeElements(t,e){e.formElements=tve(t,X8)}clone(){return new x7({description:this.description,expressionInfos:K(this.expressionInfos),elements:K(this.elements),title:this.title,preserveFieldValuesWhenHidden:this.preserveFieldValuesWhenHidden})}};u([d({type:String,json:{write:!0}})],Td.prototype,"description",void 0),u([d({json:{write:!0}})],Td.prototype,"elements",void 0),u([wr("elements")],Td.prototype,"castElements",null),u([Ae("elements",["formElements"])],Td.prototype,"readElements",null),u([ke("elements")],Td.prototype,"writeElements",null),u([d({type:[Ake],json:{write:!0}})],Td.prototype,"expressionInfos",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Td.prototype,"preserveFieldValuesWhenHidden",void 0),u([d({type:String,json:{write:!0}})],Td.prototype,"title",void 0),Td=x7=u([P("esri.form.FormTemplate")],Td);const kke=Td;let Xf=class extends we{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._handles=new Ii,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll(),this._handles.destroy()}add(e,r,i={}){return this._installWatch(e,r,i,ae)}addWhen(e,r,i={}){return this._installWatch(e,r,i,Cu)}addOnCollectionChange(e,r,{initial:i=!1,final:s=!1}={}){const n=++this._handleId;return this._handles.add([fa(e,"after-changes",this._createSyncUpdatingCallback(),qr),fa(e,"change",r,{onListenerAdd:i?o=>r({added:o.toArray(),removed:[]}):void 0,onListenerRemove:s?o=>r({added:[],removed:o.toArray()}):void 0})],n),el(()=>this._handles.remove(n))}addPromise(e){if(e==null)return e;const r=++this._handleId;this._handles.add({remove:()=>{this._pendingPromises.delete(e)&&(this._pendingPromises.size!==0||this._handles.has(YP)||this._set("updating",!1))}},r),this._pendingPromises.add(e),this._set("updating",!0);const i=()=>this._handles.remove(r);return e.then(i,i),e}removeAll(){this._pendingPromises.clear(),this._handles.removeAll(),this._set("updating",!1)}_installWatch(e,r,i={},s){const n=++this._handleId;i.sync||this._installSyncUpdatingWatch(e,n);const o=s(e,r,i);return this._handles.add(o,n),el(()=>this._handles.remove(n))}_installSyncUpdatingWatch(e,r){const i=this._createSyncUpdatingCallback(),s=ae(e,i,{sync:!0,equals:()=>!1});return this._handles.add(s,r),s}_createSyncUpdatingCallback(){return()=>{this._handles.remove(YP),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this._handles.add(VE(()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this._handles.remove(YP))}),YP)}}};u([d({readOnly:!0})],Xf.prototype,"updating",void 0),Xf=u([P("esri.core.support.WatchUpdatingTracking")],Xf);const YP=-42,v6=t=>{let e=class extends t{constructor(){super(...arguments),this._handles=new Ii,this._updatingHandles=new Xf}destroy(){this.destroyed||(this._handles.destroy(),this._updatingHandles.destroy())}get handles(){return this._handles}get updatingHandles(){return this._updatingHandles}};return u([d({readOnly:!0})],e.prototype,"handles",null),u([d({readOnly:!0})],e.prototype,"updatingHandles",null),e=u([P("esri.core.HandleOwner")],e),e};let OR=class extends v6(we){};OR=u([P("esri.core.HandleOwner")],OR);let T7=class{constructor(e=r=>r.values().next().value){this._peeker=e,this._observable=new V5,this._items=new Set}get length(){return Wt(this._observable),this._items.size}clear(){this.length!==0&&(this._items.clear(),this._observable.notify())}last(){if(this.length===0)return;let e;for(e of this._items);return e}peek(){if(this.length!==0)return this._peeker(this._items)}push(e){this.contains(e)||(this._items.add(e),this._observable.notify())}contains(e){return Wt(this._observable),this._items.has(e)}pop(){if(this.length===0)return;const e=this.peek();return this._items.delete(e),this._observable.notify(),e}popLast(){if(this.length===0)return;const e=this.last();return this._items.delete(e),this._observable.notify(),e}remove(e){this.contains(e)&&(this._items.delete(e),this._observable.notify())}filter(e){const r=this.length;return this._items.forEach(i=>{e(i)||this._items.delete(i)}),r!==this._items.size&&this._observable.notify(),this}*[Symbol.iterator](){Wt(this._observable),yield*this._items}};const zke={statsWorker:()=>ce(()=>import("./statsWorker-2f623e7d.js"),["./statsWorker-2f623e7d.js","./utils-d7352455.js","./generateRendererUtils-9a953fca.js"],import.meta.url),geometryEngineWorker:()=>ce(()=>import("./geometryEngineWorker-88885427.js"),["./geometryEngineWorker-88885427.js","./geometryEngineJSON-3dabcf6b.js","./geometryEngineBase-c1c9526a.js","./json-48e3ea08.js"],import.meta.url),CSVSourceWorker:()=>ce(()=>import("./CSVSourceWorker-cd694f3b.js"),["./CSVSourceWorker-cd694f3b.js","./json-48e3ea08.js","./FeatureStore-03e4c7a5.js","./BoundsStore-5abd2f82.js","./PooledRBush-46c91161.js","./quickselect-08f30851.js","./optimizedFeatureQueryEngineAdapter-fb0f5985.js","./centroid-3dcadaf5.js","./QueryEngine-25cd666d.js","./normalizeUtils-30f603dc.js","./normalizeUtilsCommon-d91de345.js","./WhereClause-e2c9f470.js","./executionError-e8d36121.js","./QueryEngineCapabilities-42e44ded.js","./utils-d7352455.js","./generateRendererUtils-9a953fca.js","./number-deec457a.js","./clientSideDefaults-2812b73b.js"],import.meta.url),EdgeProcessingWorker:()=>ce(()=>import("./EdgeProcessingWorker-dc28ceba.js"),[],import.meta.url),ElevationSamplerWorker:()=>ce(()=>import("./ElevationSamplerWorker-31496987.js"),["./ElevationSamplerWorker-31496987.js","./PooledRBush-46c91161.js","./quickselect-08f30851.js","./georeference-d7c2d407.js","./MeshGeoreferencedRelativeVertexSpace-1e75ad47.js","./MeshLocalVertexSpace-1b5af9eb.js"],import.meta.url),FeatureServiceSnappingSourceWorker:()=>ce(()=>import("./FeatureServiceSnappingSourceWorker-63d4b6f7.js"),["./FeatureServiceSnappingSourceWorker-63d4b6f7.js","./FeatureStore-03e4c7a5.js","./BoundsStore-5abd2f82.js","./PooledRBush-46c91161.js","./quickselect-08f30851.js","./optimizedFeatureQueryEngineAdapter-fb0f5985.js","./centroid-3dcadaf5.js","./QueryEngine-25cd666d.js","./normalizeUtils-30f603dc.js","./normalizeUtilsCommon-d91de345.js","./WhereClause-e2c9f470.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-d7352455.js","./generateRendererUtils-9a953fca.js","./symbologySnappingCandidates-ab858d8a.js","./pbfQueryUtils-dc012b8b.js","./pbf-62deeddb.js","./query-226efcbe.js"],import.meta.url),GeoJSONSourceWorker:()=>ce(()=>import("./GeoJSONSourceWorker-a2b7a573.js"),["./GeoJSONSourceWorker-a2b7a573.js","./FeatureStore-03e4c7a5.js","./BoundsStore-5abd2f82.js","./PooledRBush-46c91161.js","./quickselect-08f30851.js","./optimizedFeatureQueryEngineAdapter-fb0f5985.js","./centroid-3dcadaf5.js","./QueryEngine-25cd666d.js","./normalizeUtils-30f603dc.js","./normalizeUtilsCommon-d91de345.js","./WhereClause-e2c9f470.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-d7352455.js","./generateRendererUtils-9a953fca.js","./geojson-774c2352.js","./clientSideDefaults-2812b73b.js","./sourceUtils-011e3f59.js"],import.meta.url),LercWorker:()=>ce(()=>import("./LercWorker-ed1f2d30.js"),[],import.meta.url),MemorySourceWorker:()=>ce(()=>import("./MemorySourceWorker-d495a9a6.js"),["./MemorySourceWorker-d495a9a6.js","./objectIdUtils-967fafff.js","./FeatureStore-03e4c7a5.js","./BoundsStore-5abd2f82.js","./PooledRBush-46c91161.js","./quickselect-08f30851.js","./optimizedFeatureQueryEngineAdapter-fb0f5985.js","./centroid-3dcadaf5.js","./QueryEngine-25cd666d.js","./normalizeUtils-30f603dc.js","./normalizeUtilsCommon-d91de345.js","./WhereClause-e2c9f470.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-d7352455.js","./generateRendererUtils-9a953fca.js","./clientSideDefaults-2812b73b.js","./sourceUtils-011e3f59.js"],import.meta.url),PBFDecoderWorker:()=>ce(()=>import("./PBFDecoderWorker-97f2b8d0.js"),["./PBFDecoderWorker-97f2b8d0.js","./pbfQueryUtils-dc012b8b.js","./pbf-62deeddb.js"],import.meta.url),Pipeline:()=>ce(()=>import("./Pipeline-06139339.js").then(t=>t.P),["./Pipeline-06139339.js","./QueryEngine-25cd666d.js","./normalizeUtils-30f603dc.js","./normalizeUtilsCommon-d91de345.js","./WhereClause-e2c9f470.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-d7352455.js","./generateRendererUtils-9a953fca.js","./StreamFeatureManager-af4e8b54.js","./quickselect-08f30851.js","./arcadeTimeUtils-03a03f3e.js","./centroid-3dcadaf5.js","./ogcFeatureUtils-743f14e4.js","./geojson-774c2352.js","./clientSideDefaults-2812b73b.js","./query-226efcbe.js","./pbfQueryUtils-dc012b8b.js","./pbf-62deeddb.js","./createConnection-a3bb5643.js","./definitions-128afd1b.js","./TileInfoView-876674a7.js","./number-e491b09e.js","./geohashUtils-77d8429b.js"],import.meta.url),PointCloudWorker:()=>ce(()=>import("./PointCloudWorker-8f317210.js"),["./PointCloudWorker-8f317210.js","./PointCloudWorkerUtil-d5050fe2.js","./PointCloudUniqueValueRenderer-957e7fdd.js"],import.meta.url),RasterWorker:()=>ce(()=>import("./RasterWorker-ff57d1cb.js"),["./RasterWorker-ff57d1cb.js","./dataUtils-e563b343.js","./colorUtils-c0f43caf.js","./utils-4622a50a.js","./rasterProjectionHelper-c683c451.js"],import.meta.url),SceneLayerSnappingSourceWorker:()=>ce(()=>import("./SceneLayerSnappingSourceWorker-5945b500.js"),[],import.meta.url),SceneLayerWorker:()=>ce(()=>import("./SceneLayerWorker-541768aa.js").then(t=>t.a),["./SceneLayerWorker-541768aa.js","./MeshGeoreferencedRelativeVertexSpace-1e75ad47.js","./MeshLocalVertexSpace-1b5af9eb.js","./I3SNode-578bf5fe.js"],import.meta.url),WFSSourceWorker:()=>ce(()=>import("./WFSSourceWorker-cb59aabf.js"),["./WFSSourceWorker-cb59aabf.js","./FeatureStore-03e4c7a5.js","./BoundsStore-5abd2f82.js","./PooledRBush-46c91161.js","./quickselect-08f30851.js","./optimizedFeatureQueryEngineAdapter-fb0f5985.js","./centroid-3dcadaf5.js","./QueryEngine-25cd666d.js","./normalizeUtils-30f603dc.js","./normalizeUtilsCommon-d91de345.js","./WhereClause-e2c9f470.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-d7352455.js","./generateRendererUtils-9a953fca.js","./geojson-774c2352.js","./sourceUtils-011e3f59.js","./wfsUtils-8beeb20b.js","./xmlUtils-444cb4c0.js"],import.meta.url),WorkerTileHandler:()=>ce(()=>import("./WorkerTileHandler-119830dc.js"),["./WorkerTileHandler-119830dc.js","./TileClipper-ae6eca9e.js","./StyleRepository-d49b90c1.js","./colorUtils-c0f43caf.js","./definitions-128afd1b.js","./Rect-98da58d6.js","./pbf-62deeddb.js","./TurboLine-93ea8fde.js","./BidiEngine-9a40f2f4.js"],import.meta.url)};var Uo;(function(t){t[t.HANDSHAKE=0]="HANDSHAKE",t[t.OPEN=1]="OPEN",t[t.OPENED=2]="OPENED",t[t.RESPONSE=3]="RESPONSE",t[t.INVOKE=4]="INVOKE",t[t.ABORT=5]="ABORT",t[t.CLOSE=6]="CLOSE",t[t.OPEN_PORT=7]="OPEN_PORT",t[t.ON=8]="ON"})(Uo||(Uo={}));let Vke=0;function ive(){return Vke++}function Bke(t){return t&&typeof t=="object"&&("result"in t||"transferList"in t)}function RR(t){return t?typeof t=="string"?JSON.stringify({name:"message",message:t}):t.toJSON?JSON.stringify(t):JSON.stringify({name:t.name,message:t.message,details:t.details||{stack:t.stack}}):null}function tY(t,e,r,i){if(e.type===Uo.OPEN_PORT)return void t.postMessage(e,[e.port]);if(e.type!==Uo.INVOKE&&e.type!==Uo.RESPONSE)return void t.postMessage(e);let s;if(Bke(r)?(s=Cre(r.transferList),e.data=r.result):(s=Cre(i),e.data=r),s){if(oe("ff")){for(const n of s)if("byteLength"in n&&n.byteLength>267386880){const o="Worker call with large ArrayBuffer would crash Firefox";switch(e.type){case Uo.INVOKE:throw o;case Uo.RESPONSE:return void tY(t,{type:Uo.RESPONSE,jobId:e.jobId,error:RR(o)})}}}t.postMessage(e,s)}else t.postMessage(e)}function MR(t){if(!t)return null;const e=t.data;return e?typeof e=="string"?JSON.parse(e):e:null}function Cre(t){if(!t||!t.length)return null;if(oe("esri-workers-arraybuffer-transfer"))return t;const e=t.filter(r=>!Gke(r));return e.length?e:null}function Gke(t){return t instanceof ArrayBuffer||t?.constructor?.name==="ArrayBuffer"}const{CLOSE:Are,ABORT:Ore,INVOKE:Rre,RESPONSE:IC,OPEN_PORT:Mre,ON:jke}=Uo,Hke=2;let qke=class{constructor(e){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=e,this._timer=null,this._process=this._process.bind(this)}push(e){e.type===Uo.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}},K_=class KT{static connect(e){const r=new MessageChannel;let i;i=typeof e=="function"?new e:"default"in e&&typeof e.default=="function"?new e.default:e;const s=new KT(r.port1,{channel:r,client:i},()=>null);return typeof i=="object"&&"remoteClient"in i&&(i.remoteClient=s),KT.clients.set(s,i),r.port2}static loadWorker(e){const r=zke[e];return r?r():Promise.resolve(null)}constructor(e,r,i){this._port=e,this._getNextJob=i,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new qke(s=>this._onInvokeMessage(s)),this._client=r.client,this._onMessage=this._onMessage.bind(this),this._channel=r.channel,this._schedule=r.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:Are}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,r,i){const s=i?.signal,n=i?.transferList;if(!this._port)return Promise.reject(new V("worker:port-closed",`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:r}));const o=ive();return new Promise((a,l)=>{if(An(s))return this._processWork(),void l(kr());const c=da(s,()=>{const p=this._outJobs.get(o);p&&(this._outJobs.delete(o),this._processWork(),Ni(p.abortHandle),this._post({type:Ore,jobId:o}),l(kr()))}),h={resolve:a,reject:l,abortHandle:c,debugInfo:e};this._outJobs.set(o,h),this._post({type:Rre,jobId:o,methodName:e,abortable:s!=null},r,n)})}on(e,r){const i=new MessageChannel;function s(n){r(n.data)}return this._port.postMessage({type:Uo.ON,eventType:e,port:i.port2},[i.port2]),i.port1.addEventListener("message",s),i.port1.start(),{remove(){i.port1.postMessage({type:Uo.CLOSE}),i.port1.close(),i.port1.removeEventListener("message",s)}}}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:Mre,port:e.port2}),e.port1}_processWork(){if(this._outJobs.size>=Hke)return;const e=this._getNextJob();if(!e)return;const{methodName:r,data:i,invokeOptions:s,resolver:n}=e;this.invoke(r,i,s).then(o=>n.resolve(o)).catch(o=>n.reject(o))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(e=>{Ni(e.abortHandle),e.reject(kr(`Worker closing, aborting job calling '${e.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=null,this._client=null,this._schedule=null}_onMessage(e){this._schedule!=null?this._schedule(()=>this._processMessage(e)):this._processMessage(e)}_processMessage(e){const r=MR(e);if(r)switch(r.type){case IC:this._onResponseMessage(r);break;case Rre:this._invokeQueue.push(r);break;case Ore:this._onAbortMessage(r);break;case Are:this._onCloseMessage();break;case Mre:this._onOpenPortMessage(r);break;case jke:this._onOnMessage(r)}}_onAbortMessage(e){const r=this._inJobs,i=e.jobId,s=r.get(i);this._invokeQueue.push(e),s&&(s.controller&&s.controller.abort(),r.delete(i))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&KT.clients.get(this)===e&&e.destroy(),KT.clients.delete(this),e?.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:r,jobId:i,data:s,abortable:n}=e,o=n?new AbortController:null,a=this._inJobs;let l,c=this._client,h=c[r];try{if(!h&&r&&r.includes(".")){const p=r.split(".");for(let f=0;f<p.length-1;f++)c=c[p[f]],h=c[p[f+1]]}if(typeof h!="function")throw new TypeError(`${r} is not a function`);l=h.call(c,s,{client:this,signal:o?o.signal:null})}catch(p){return void this._post({type:IC,jobId:i,error:RR(p)})}Iu(l)?(a.set(i,{controller:o,promise:l}),l.then(p=>{a.has(i)&&(a.delete(i),this._post({type:IC,jobId:i},p))},p=>{a.has(i)&&(a.delete(i),us(p)||this._post({type:IC,jobId:i,error:RR(p||{message:`Error encountered at method ${r}`})}))})):this._post({type:IC,jobId:i},l)}_onOpenPortMessage(e){new KT(e.port,{client:this._client},()=>null)}_onOnMessage(e){const{port:r}=e,i=this._client.on(e.eventType,n=>{r.postMessage(n)}),s=TM(e.port,"message",n=>{MR(n)?.type===Uo.CLOSE&&(s.remove(),i.remove(),r.close())})}_onResponseMessage(e){const{jobId:r,error:i,data:s}=e,n=this._outJobs;if(!n.has(r))return;const o=n.get(r);n.delete(r),this._processWork(),Ni(o.abortHandle),i?o.reject(V.fromJSON(JSON.parse(i))):o.resolve(s)}_post(e,r,i){return tY(this._port,e,r,i)}};K_.kernelInfo={buildDate:Bme,fullVersion:FX,revision:Gme},K_.clients=new Map;let Wke=class{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new T7}destroy(){this.close()}get closed(){return!this._clients||!this._clients.length}open(e,r){return new Promise((i,s)=>{let n=!0;const o=a=>{Yt(r.signal),n&&(n=!1,a())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let a=0;a<e.length;++a){const l=e[a];Iu(l)?this._clientPromises[a]=l.then(c=>(this._clients[a]=new K_(c,r,()=>this._ongoingJobsQueue.pop()??null),o(i),this._clients[a]),()=>(o(s),null)):(this._clients[a]=new K_(l,r,()=>this._ongoingJobsQueue.pop()??null),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(i))}})}broadcast(e,r,i){const s=new Array(this._clientPromises.length);for(let n=0;n<this._clientPromises.length;++n){const o=this._clientPromises[n];s[n]=o.then(a=>a?.invoke(e,r,i))}return s}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.resolver.reject(kr(`Worker closing, aborting job calling '${e.methodName}'`));for(const r of this._clientPromises)r.then(i=>i?.close());this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0}invoke(e,r,i){let s;Array.isArray(i)?(Q.getLogger("esri.core.workers.Connection").warn("invoke()","The transferList parameter is deprecated, use the options object instead"),s={transferList:i}):s=i;const n=xo();this._ongoingJobsQueue.push({methodName:e,data:r,invokeOptions:s,resolver:n});for(let o=0;o<this._clientPromises.length;o++){const a=this._clients[o];a?a.jobAdded():this._clientPromises[o].then(l=>l?.jobAdded())}return n.promise}on(e,r){return Promise.all(this._clientPromises).then(()=>N2(this._clients.map(i=>i.on(e,r))))}openPorts(){return new Promise(e=>{const r=new Array(this._clientPromises.length);let i=r.length;for(let s=0;s<this._clientPromises.length;++s)this._clientPromises[s].then(n=>{n&&(r[s]=n.openPort()),--i==0&&e(r)})})}get test(){return{numClients:this._clients.length}}};const sve=Q.getLogger("esri.intl.substitute");function nve(t,e,r={}){const{format:i={}}=r;return N5(t,s=>Xke(s,e,i))}function Xke(t,e,r){let i,s;const n=t.indexOf(":");if(n===-1?i=t.trim():(i=t.slice(0,n).trim(),s=t.slice(n+1).trim()),!i)return"";const o=wM(i,e);if(o==null)return"";const a=(s?r?.[s]:null)??r?.[i];return a?Zke(o,a):s?Yke(o,s):rY(o)}function Zke(t,e){switch(e.type){case"date":return cy(t,e.intlOptions);case"number":return X2(t,e.intlOptions);default:return sve.warn("missing format descriptor for key {key}"),rY(t)}}function Yke(t,e){switch(e.toLowerCase()){case"dateformat":return cy(t);case"numberformat":return X2(t);default:return sve.warn(`inline format is unsupported since 4.12: ${e}`),/^(dateformat|datestring)/i.test(e)?cy(t):/^numberformat/i.test(e)?X2(t):rY(t)}}function rY(t){switch(typeof t){case"string":return t;case"number":return X2(t);case"boolean":return""+t;default:return t instanceof Date?cy(t):""}}async function Jke(t,e,r,i){const s=e.exec(r);if(!s)throw new V("esri-intl:invalid-bundle",`Bundle id "${r}" is not compatible with the pattern "${e}"`);const n=s[1]?`${s[1]}/`:"",o=s[2],a=KNe(i),l=`${n}${o}.json`,c=a?`${n}${o}_${a}.json`:l;let h;try{h=await Pre(t(c))}catch(p){if(c===l)throw new V("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:p});try{h=await Pre(t(l))}catch(f){throw new V("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:f})}}return h}async function Pre(t){if(Ire.fetchBundleAsset!=null)return Ire.fetchBundleAsset(t);const e=await hr(t,{responseType:"text"});return JSON.parse(e.data)}let Qke=class{constructor({base:e="",pattern:r,location:i=new URL(window.location.href)}){let s;s=typeof i=="string"?n=>new URL(n,new URL(i,window.location.href)).href:i instanceof URL?n=>new URL(n,i).href:i,this.pattern=typeof r=="string"?new RegExp(`^${r}`):r,this.getAssetUrl=s,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)/)?(.*)$`)}fetchMessageBundle(e,r){return Jke(this.getAssetUrl,this.matcher,e,r)}};function Kke(t){return new Qke(t)}const Ire={};QNe(Kke({pattern:"esri/",location:Gr}));const eze={};function tze(t){const e={async:t.async,isDebug:t.isDebug,locale:t.locale,baseUrl:t.baseUrl,has:{...t.has},map:{...t.map},packages:t.packages&&t.packages.concat()||[],paths:{...t.paths}};return t.hasOwnProperty("async")||(e.async=!0),t.hasOwnProperty("isDebug")||(e.isDebug=!1),t.baseUrl||(e.baseUrl=eze.baseUrl),e}let rze=class{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(r=>{this[r]=(...i)=>e[r](...i)})}},DD=class{constructor(){this._dispatcher=new rze,this._workerPostMessage({type:Uo.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){F2(()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))})}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,r,i){this._dispatcher.addEventListener(e,r,i)}removeEventListener(e,r,i){this._dispatcher.removeEventListener(e,r,i)}_workerPostMessage(e){F2(()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))})}async _workerMessageHandler(e){const r=MR(e);if(r&&r.type===Uo.OPEN){const{modulePath:i,jobId:s}=r;let n=await K_.loadWorker(i);n||(n=await ce(()=>import(i),[],import.meta.url));const o=K_.connect(n);this._workerPostMessage({type:Uo.OPENED,jobId:s,data:o})}}};const S7=Q.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:ize}=Uo,sze='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,s)=>{if(t){if(t.aborted)return s(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:ABORT,jobId:n}),s(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:s}),self.postMessage({type:INVOKE,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,fullVersion:r}=configuration.kernelInfo,{revision:t,fullVersion:n,version:s}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS Maps SDK for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\\nModules version: ${r}\\nAssets version: ${n??s}\\nAssets path: ${esriConfig.assetsPath}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case OPEN:let n;function t(e){const o=n.connect(e);self.postMessage({type:OPENED,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case RESPONSE:if(outgoing.has(r)){const s=outgoing.get(r);outgoing.delete(r),o.error?s.reject(JSON.parse(o.error)):s.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let JP,QP;const $re="Failed to create Worker. Fallback to execute module in main thread";async function nze(){if(!oe("esri-workers")||(oe("mozilla"),0))return Lre(new DD);if(!JP&&!QP)try{const e=sze.split('"{CONFIGURATION}"').join(`'${oze()}'`);JP=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){QP=e||{}}let t;if(JP)try{t=new Worker(JP,{name:"esri-worker-"+aze++})}catch{S7.warn($re,QP),t=new DD}else S7.warn($re,QP),t=new DD;return Lre(t)}async function Lre(t){return new Promise(e=>{function r(s){const n=MR(s);n&&n.type===ize&&(t.removeEventListener("message",r),t.removeEventListener("error",i),e(t))}function i(s){s.preventDefault(),t.removeEventListener("message",r),t.removeEventListener("error",i),S7.warn("Failed to create Worker. Fallback to execute module in main thread",s),(t=new DD).addEventListener("message",r),t.addEventListener("error",i)}t.addEventListener("message",r),t.addEventListener("error",i)})}function oze(){let t;if(Br.default!=null){const s={...Br};delete s.default,t=JSON.parse(JSON.stringify(s))}else t=JSON.parse(JSON.stringify(Br));t.assetsPath=du(t.assetsPath),t.defaultAssetsPath=t.defaultAssetsPath?du(t.defaultAssetsPath):void 0,t.request.interceptors=[],t.log.interceptors=[],t.locale=pp(),t.has={"esri-csp-restrictions":oe("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":oe("esri-2d-update-debug"),"esri-2d-log-updating":oe("esri-2d-log-updating"),"featurelayer-pbf":oe("featurelayer-pbf"),"featurelayer-simplify-thresholds":oe("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":oe("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":oe("featurelayer-simplify-mobile-factor"),"esri-atomics":oe("esri-atomics"),"esri-shared-array-buffer":oe("esri-shared-array-buffer"),"esri-tiles-debug":oe("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":oe("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":oe("feature-polyline-generalization-factor"),"host-webworker":1,"polylabel-placement-enabled":oe("polylabel-placement-enabled")},t.workers.loaderUrl&&(t.workers.loaderUrl=du(t.workers.loaderUrl)),t.workers.workerPath?t.workers.workerPath=du(t.workers.workerPath):t.workers.workerPath=du(Gr("esri/core/workers/RemoteClient.js")),t.workers.useDynamicImport=!1;const e=Br.workers.loaderConfig,r=tze({baseUrl:e?.baseUrl,locale:pp(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...e?.has},map:{...e?.map},paths:{...e?.paths},packages:e?.packages||[]});return JSON.stringify({esriConfig:t,loaderConfig:r,kernelInfo:{buildDate:Bme,fullVersion:FX,revision:Gme}})}let aze=0;const{ABORT:Dre,INVOKE:lze,OPEN:cze,OPENED:uze,RESPONSE:$C}=Uo;let hze=class ove{static async create(e){const r=await nze();return new ove(r,e)}constructor(e,r){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=r,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",i=>{i.preventDefault(),Q.getLogger("esri.core.workers.WorkerOwner").error(i)})}terminate(){this.worker.terminate()}async open(e,r={}){const{signal:i}=r,s=ive();return new Promise((n,o)=>{const a={resolve:n,reject:o,abortHandle:lX(i,()=>{this._outJobs.delete(s),this._post({type:Dre,jobId:s})})};this._outJobs.set(s,a),this._post({type:cze,jobId:s,modulePath:e})})}_onMessage(e){const r=MR(e);if(r)switch(r.type){case uze:this._onOpenedMessage(r);break;case $C:this._onResponseMessage(r);break;case Dre:this._onAbortMessage(r);break;case lze:this._onInvokeMessage(r)}}_onAbortMessage(e){const r=this._inJobs,i=e.jobId,s=r.get(i);s&&(s.controller&&s.controller.abort(),r.delete(i))}_onInvokeMessage(e){const{methodName:r,jobId:i,data:s,abortable:n}=e,o=n?new AbortController:null,a=this._inJobs,l=QDe[r];let c;try{if(typeof l!="function")throw new TypeError(`${r} is not a function`);c=l.call(null,s,{signal:o?o.signal:null})}catch(h){return void this._post({type:$C,jobId:i,error:RR(h)})}Iu(c)?(a.set(i,{controller:o,promise:c}),c.then(h=>{a.has(i)&&(a.delete(i),this._post({type:$C,jobId:i},h))},h=>{a.has(i)&&(a.delete(i),h||(h={message:"Error encountered at method"+r}),us(h)||this._post({type:$C,jobId:i,error:RR(h||{message:`Error encountered at method ${r}`})}))})):this._post({type:$C,jobId:i},c)}_onOpenedMessage(e){const{jobId:r,data:i}=e,s=this._outJobs.get(r);s&&(this._outJobs.delete(r),Ni(s.abortHandle),s.resolve(i))}_onResponseMessage(e){const{jobId:r,error:i,data:s}=e,n=this._outJobs.get(r);n&&(this._outJobs.delete(r),Ni(n.abortHandle),i?n.reject(V.fromJSON(JSON.parse(i))):n.resolve(s))}_post(e,r,i){return tY(this.worker,e,r,i)}};const Nre=oe("host-browser")?Math.min(navigator.hardwareConcurrency-1,oe("workers-pool-size")):0;let Ub=oe("esri-mobile")?Math.min(Nre,3):Nre;Ub||(Ub=oe("safari")&&oe("mac")?7:2);let Fre=0;const ND=[];function dze(){lve()}async function KP(t,e){const r=new Wke;return await r.open(t,e),r}async function ave(t,e={}){if(typeof t!="string")throw new V("workers:undefined-module","modulePath is missing");let r=e.strategy||"distributed";if(oe("host-webworker")&&!oe("esri-workers")&&(r="local"),r==="local"){let i=await K_.loadWorker(t);i||(i=await ce(()=>import(t),[],import.meta.url)),Yt(e.signal);const s=e.client||i;return KP([K_.connect(i)],{...e,client:s})}if(await lve(),Yt(e.signal),r==="dedicated"){const i=Fre++%Ub;return KP([await ND[i].open(t,e)],e)}if(e.maxNumWorkers&&e.maxNumWorkers>0){const i=Math.min(e.maxNumWorkers,Ub);if(i<Ub){const s=new Array(i);for(let n=0;n<i;++n){const o=Fre++%Ub;s[n]=ND[o].open(t,e)}return KP(s,e)}}return KP(ND.map(i=>i.open(t,e)),e)}let eI=null;async function lve(){if(eI)return eI;new AbortController;const t=[];for(let e=0;e<Ub;e++){const r=hze.create(e).then(i=>(ND[e]=i,i));t.push(r)}return eI=Promise.all(t),eI}function Ure(t,e,r){if(t.hasM==null||t.hasZ)for(const i of e)for(const s of i)s.length>2&&(s[2]*=r)}function pze(t,e,r){if(!t&&!e||!r)return;const i=vR(r);kre(t,r,i),kre(e,r,i)}function kre(t,e,r){if(t)for(const i of t)fze(i.geometry,e,r)}function fze(t,e,r){if(t==null||!t.spatialReference||Pn(t.spatialReference,e))return;const i=vR(t.spatialReference)/r;if(i!==1){if("x"in t)t.z!=null&&(t.z*=i);else if("rings"in t)Ure(t,t.rings,i);else if("paths"in t)Ure(t,t.paths,i);else if("points"in t&&(t.hasM==null||t.hasZ))for(const s of t.points)s.length>2&&(s[2]*=i)}}function cve(t,e,r){if(e==null||r==null||r.vcsWkid||Pn(e,r))return null;const i=vR(e)/vR(r);if(i===1)return null;switch(t){case"point":case"esriGeometryPoint":return s=>mze(s,i);case"polyline":case"esriGeometryPolyline":return s=>yze(s,i);case"polygon":case"esriGeometryPolygon":return s=>gze(s,i);case"multipoint":case"esriGeometryMultipoint":return s=>_ze(s,i);case"extent":case"esriGeometryEnvelope":return s=>vze(s,i);default:return null}}function mze(t,e){t&&t.z!=null&&(t.z*=e)}function gze(t,e){if(t)for(const r of t.rings)for(const i of r)i.length>2&&(i[2]*=e)}function yze(t,e){if(t)for(const r of t.paths)for(const i of r)i.length>2&&(i[2]*=e)}function _ze(t,e){if(t)for(const r of t.points)r.length>2&&(r[2]*=e)}function vze(t,e){t&&t.zmin!=null&&t.zmax!=null&&(t.zmin*=e,t.zmax*=e)}function zre(t,e,r){if(!r||!r.features||!r.hasZ)return;const i=cve(r.geometryType,e,t.outSpatialReference);if(i!=null)for(const s of r.features)i(s.geometry)}const bze=new $r({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml",esriFieldTypeBigInteger:"big-integer",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"});var E7;const wze=new $r({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let Da=E7=class extends le{constructor(t){super(t),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=-1,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(t,{description:e}){let r=null;try{r=e?JSON.parse(e):null}catch{}return r?.value??null}readValueType(t,{description:e}){let r=null;try{r=e?JSON.parse(e):null}catch{}return r?wze.fromJSON(r.fieldValueType):null}clone(){return new E7({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};u([d({type:String,json:{write:!0}})],Da.prototype,"alias",void 0),u([d({type:[String,Number],json:{write:{allowNull:!0}}})],Da.prototype,"defaultValue",void 0),u([d()],Da.prototype,"description",void 0),u([Ae("description")],Da.prototype,"readDescription",null),u([d({types:J_e,json:{read:{reader:eY},write:!0}})],Da.prototype,"domain",void 0),u([d({type:Boolean,json:{write:!0}})],Da.prototype,"editable",void 0),u([d({type:Qi,json:{write:!0}})],Da.prototype,"length",void 0),u([d({type:String,json:{write:!0}})],Da.prototype,"name",void 0),u([d({type:Boolean,json:{write:!0}})],Da.prototype,"nullable",void 0),u([it(bze)],Da.prototype,"type",void 0),u([d()],Da.prototype,"valueType",void 0),u([Ae("valueType",["description"])],Da.prototype,"readValueType",null),u([d({type:Boolean,json:{read:!1}})],Da.prototype,"visible",void 0),Da=E7=u([P("esri.layers.support.Field")],Da);const b6=Da;var C7;const A7=new $r({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let Ro=C7=class extends le{constructor(t){super(t),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(t,e){const r=je.fromJSON(e.spatialReference),i=[];for(let s=0;s<t.length;s++){const n=t[s],o=Nl.fromJSON(n),a=n.geometry&&n.geometry.spatialReference;o.geometry==null||a||(o.geometry.spatialReference=r);const l=n.aggregateGeometries,c=o.aggregateGeometries;if(l&&c!=null)for(const h in c){const p=c[h],f=l[h],m=f?.spatialReference;p==null||m||(p.spatialReference=r)}i.push(o)}return i}writeGeometryType(t,e,r,i){if(t)return void A7.write(t,e,r,i);const{features:s}=this;if(s){for(const n of s)if(n&&n.geometry!=null)return void A7.write(n.geometry.type,e,r,i)}}readQueryGeometry(t,e){if(!t)return null;const r=!!t.spatialReference,i=Z_(t);return i&&!r&&e.spatialReference&&(i.spatialReference=je.fromJSON(e.spatialReference)),i}writeSpatialReference(t,e){if(t)return void(e.spatialReference=t.toJSON());const{features:r}=this;if(r){for(const i of r)if(i&&i.geometry!=null&&i.geometry.spatialReference)return void(e.spatialReference=i.geometry.spatialReference.toJSON())}}clone(){return new C7(this.cloneProperties())}cloneProperties(){return K({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(t){const e=this.write();if(e.features&&Array.isArray(t)&&t.length>0)for(let r=0;r<e.features.length;r++){const i=e.features[r];if(i.geometry){const s=t&&t[r];i.geometry=s&&s.toJSON()||i.geometry}}return e}quantize(t){const{scale:[e,r],translate:[i,s]}=t,n=c=>Math.round((c-i)/e),o=c=>Math.round((s-c)/r),a=this.features,l=this._getQuantizationFunction(this.geometryType,n,o);for(let c=0,h=a.length;c<h;c++)l?.(a[c].geometry)||(a.splice(c,1),c--,h--);return this.transform=t,this}unquantize(){const{geometryType:t,features:e,transform:r}=this;if(!r)return this;const{translate:[i,s],scale:[n,o]}=r,a=f=>f*n+i,l=f=>s-f*o;let c=null,h=null;if(this.hasZ&&r?.scale?.[2]!=null){const{translate:[,,f],scale:[,,m]}=r;c=y=>y*m+f}if(this.hasM&&r?.scale?.[3]!=null){const{translate:[,,,f],scale:[,,,m]}=r;h=y=>y==null?y:y*m+f}const p=this._getHydrationFunction(t,a,l,c,h);for(const{geometry:f}of e)f!=null&&p&&p(f);return this.transform=null,this}_quantizePoints(t,e,r){let i,s;const n=[];for(let o=0,a=t.length;o<a;o++){const l=t[o];if(o>0){const c=e(l[0]),h=r(l[1]);c===i&&h===s||(n.push([c-i,h-s]),i=c,s=h)}else i=e(l[0]),s=r(l[1]),n.push([i,s])}return n.length>0?n:null}_getQuantizationFunction(t,e,r){return t==="point"?i=>(i.x=e(i.x),i.y=r(i.y),i):t==="polyline"||t==="polygon"?i=>{const s=u2(i)?i.rings:i.paths,n=[];for(let o=0,a=s.length;o<a;o++){const l=s[o],c=this._quantizePoints(l,e,r);c&&n.push(c)}return n.length>0?(u2(i)?i.rings=n:i.paths=n,i):null}:t==="multipoint"?i=>{const s=this._quantizePoints(i.points,e,r);return s&&s.length>0?(i.points=s,i):null}:t==="extent"?i=>i:null}_getHydrationFunction(t,e,r,i,s){return t==="point"?n=>{n.x=e(n.x),n.y=r(n.y),i&&(n.z=i(n.z))}:t==="polyline"||t==="polygon"?n=>{const o=u2(n)?n.rings:n.paths;let a,l;for(let c=0,h=o.length;c<h;c++){const p=o[c];for(let f=0,m=p.length;f<m;f++){const y=p[f];f>0?(a+=y[0],l+=y[1]):(a=y[0],l=y[1]),y[0]=e(a),y[1]=r(l)}}if(i&&s)for(let c=0,h=o.length;c<h;c++){const p=o[c];for(let f=0,m=p.length;f<m;f++){const y=p[f];y[2]=i(y[2]),y[3]=s(y[3])}}else if(i)for(let c=0,h=o.length;c<h;c++){const p=o[c];for(let f=0,m=p.length;f<m;f++){const y=p[f];y[2]=i(y[2])}}else if(s)for(let c=0,h=o.length;c<h;c++){const p=o[c];for(let f=0,m=p.length;f<m;f++){const y=p[f];y[2]=s(y[2])}}}:t==="extent"?n=>{n.xmin=e(n.xmin),n.ymin=r(n.ymin),n.xmax=e(n.xmax),n.ymax=r(n.ymax),i&&n.zmax!=null&&n.zmin!=null&&(n.zmax=i(n.zmax),n.zmin=i(n.zmin)),s&&n.mmax!=null&&n.mmin!=null&&(n.mmax=s(n.mmax),n.mmin=s(n.mmin))}:t==="multipoint"?n=>{const o=n.points;let a,l;for(let c=0,h=o.length;c<h;c++){const p=o[c];c>0?(a+=p[0],l+=p[1]):(a=p[0],l=p[1]),p[0]=e(a),p[1]=r(l)}if(i&&s)for(let c=0,h=o.length;c<h;c++){const p=o[c];p[2]=i(p[2]),p[3]=s(p[3])}else if(i)for(let c=0,h=o.length;c<h;c++){const p=o[c];p[2]=i(p[2])}else if(s)for(let c=0,h=o.length;c<h;c++){const p=o[c];p[2]=s(p[2])}}:null}};u([d({type:String,json:{write:!0}})],Ro.prototype,"displayFieldName",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Ro.prototype,"exceededTransferLimit",void 0),u([d({type:[Nl],json:{write:!0}})],Ro.prototype,"features",void 0),u([Ae("features")],Ro.prototype,"readFeatures",null),u([d({type:[b6],json:{write:!0}})],Ro.prototype,"fields",void 0),u([d({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:A7.read}}})],Ro.prototype,"geometryType",void 0),u([ke("geometryType")],Ro.prototype,"writeGeometryType",null),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Ro.prototype,"hasM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Ro.prototype,"hasZ",void 0),u([d({types:ix,json:{write:!0}})],Ro.prototype,"queryGeometry",void 0),u([Ae("queryGeometry")],Ro.prototype,"readQueryGeometry",null),u([d({type:je,json:{write:!0}})],Ro.prototype,"spatialReference",void 0),u([ke("spatialReference")],Ro.prototype,"writeSpatialReference",null),u([d({json:{write:!0}})],Ro.prototype,"transform",void 0),Ro=C7=u([P("esri.rest.support.FeatureSet")],Ro),Ro.prototype.toJSON.isDefaultToJSON=!0;const uve=Ro;let xze=0;const hve="esri.layers.graphics.sources.MemorySource",Z8=Q.getLogger(hve);let Eg=class extends sy.LoadableMixin(B5(v6(Pt))){constructor(e){super(e),this._idToClientGraphic=null,this.type="memory"}load(e){const r=e!=null?e.signal:null;return this.addResolvingPromise(this._startWorker(r)),Promise.resolve(this)}destroy(){this._connection?.close(),this._connection=null}get _workerGeometryType(){const e=this.layer?.geometryType;return e?this._geometryTypeRequiresClientGraphicMapping(e)?"polygon":e:null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}async queryFeatures(e,r={}){await this.load(r);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,r);zre(e,this.layer.spatialReference,i);const s=uve.fromJSON(i);if(!this._requiresClientGraphicMapping())return s;const n=this.layer.objectIdField;for(const o of s.features){const a=o.attributes[n],l=this._idToClientGraphic.get(a);l&&(o.geometry=l.geometry)}return s.geometryType=this.layer.geometryType,s}async queryFeaturesJSON(e,r={}){if(this._requiresClientGraphicMapping())throw new V("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");await this.load(r);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,r);return zre(e,this.layer.spatialReference,i),i}queryFeatureCount(e,r={}){return this.load(r).then(()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,r))}queryObjectIds(e,r={}){return this.load(r).then(()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,r))}queryExtent(e,r={}){return this.load(r).then(()=>this._connection.invoke("queryExtent",e?e.toJSON():null,r)).then(i=>({count:i.count,extent:ur.fromJSON(i.extent)}))}querySnapping(e,r={}){return this.load(r).then(()=>this._connection.invoke("querySnapping",e,r))}async _applyEdits(e){if(!this._connection)throw new V("feature-layer-source:edit-failure","Memory source not loaded");const r=this.layer.objectIdField;let i=null;const s=[],n=[];await Promise.all([this._prepareClientMapping(e.addFeatures,null),this._prepareClientMapping(e.updateFeatures,null)]);const o=h=>"objectId"in h&&h.objectId!=null?h.objectId:"attributes"in h&&h.attributes[r]!=null?h.attributes[r]:null;if(e.addFeatures&&(i=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const h of e.deleteFeatures){const p=o(h);p!=null&&s.push(p)}const a=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures){for(const h of e.updateFeatures)if(n.push(this._serializeFeature(h)),a){const p=o(h);p!=null&&a.set(p,h)}}pze(i?i.features:null,n,this.layer.spatialReference);const{fullExtent:l,featureEditResults:c}=await this._connection.invoke("applyEdits",{adds:i?i.features:[],updates:n,deletes:s});return this.fullExtent=l,i&&i.finish(c.uidToObjectId),this._updateClientGraphicIds(a,c),this._createEditsResult(c)}async _prepareClientMapping(e,r){if(this._layerOrSourceGeometryType!=="mesh"||e==null)return;const i=[];for(const{geometry:s}of e)s==null||s.type!=="mesh"||s.hasExtent||s.loaded||i.push(s.load({signal:r}));i.length&&await Promise.all(i)}_updateClientGraphicIds(e,r){if(this._idToClientGraphic){if(e)for(const i of r.updateResults){if(!i.success)continue;const s=e.get(i.objectId);s!=null&&this._addIdToClientGraphic(s)}for(const i of r.deleteResults)i.success&&this._idToClientGraphic.delete(i.objectId)}}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const r=e.success===!0?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:r?new V("feature-layer-source:edit-failure",r.description,{code:r.code}):null}}_prepareAddFeatures(e){const r=new Map,i=new Array(e.length);let s=null;for(let o=0;o<e.length;o++){const a=e[o],l=this._serializeFeature(a);s||a.geometry==null||(s=a.geometry.type),i[o]=l,r.set(`${l.uid}`,a)}const n=this;return{features:i,inferredGeometryType:s,finish(o){const a=n.sourceJSON.objectIdField;for(const l in o){const c=o[l],h=r.get(l);h&&(h.attributes||(h.attributes={}),c===-1?delete h.attributes[a]:h.attributes[a]=c,n._addIdToClientGraphic(h))}}}}_addIdToClientGraphic(e){if(!this._idToClientGraphic)return;const r=this.sourceJSON.objectIdField,i=e.attributes&&e.attributes[r];i!=null&&this._idToClientGraphic.set(i,e)}get _layerOrSourceGeometryType(){return this.layer?.geometryType??this.sourceJSON?.geometryType}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this._layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return e==="mesh"||e==="multipatch"||e==="extent"}_serializeFeature(e){const{attributes:r}=e,i=this._geometryForSerialization(e),s=(xze++).toString();return i?{uid:s,geometry:i.toJSON(),attributes:r}:{uid:s,attributes:r}}_geometryForSerialization(e){const{geometry:r}=e;return r==null?null:this._geometryRequiresClientGraphicMapping(r)?r.extent?yu.fromExtent(r.extent):null:r}async _startWorker(e){this._connection=await ave("MemorySourceWorker",{strategy:oe("feature-layers-workers")?"dedicated":"local",signal:e});const{fields:r,spatialReference:i,objectIdField:s,hasM:n,hasZ:o,timeInfo:a}=this.layer,l=this.layer.originOf("spatialReference")==="defaults";await this._prepareClientMapping(this.items,e);const c=this._prepareAddFeatures(this.items);this.handles.add(this.on("before-changes",m=>{Z8.error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),m.preventDefault()}));const h={features:c.features,fields:r&&r.map(m=>m.toJSON()),geometryType:fte.toJSON(this._workerGeometryType),hasM:this._layerOrSourceGeometryType!=="mesh"&&n,hasZ:this._layerOrSourceGeometryType==="mesh"||o,objectIdField:s,spatialReference:l?null:i&&i.toJSON(),timeInfo:a?a.toJSON():null},p=await this._connection.invoke("load",h,{signal:e});for(const m of p.warnings)Z8.warn(m.message,{layer:this.layer,warning:m});p.featureErrors.length&&Z8.warn(`Encountered ${p.featureErrors.length} validation errors while loading features`,p.featureErrors);const f=p.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(c.inferredGeometryType)&&(f.geometryType=fte.toJSON(c.inferredGeometryType)),this.sourceJSON=f,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),c.finish(p.assignedObjectIds)}};u([gX({Type:Nl,ensureType:vs(Nl)})],Eg.prototype,"itemType",void 0),u([d()],Eg.prototype,"type",void 0),u([d({constructOnly:!0})],Eg.prototype,"layer",void 0),u([d({readOnly:!0})],Eg.prototype,"_workerGeometryType",null),u([d()],Eg.prototype,"sourceJSON",void 0),Eg=u([P(hve)],Eg);function Tze(t){return"portalItem"in t}const dve=t=>{let e=class extends t{get apiKey(){return this._isOverridden("apiKey")?this._get("apiKey"):Tze(this)?this.portalItem?.apiKey:null}set apiKey(r){r!=null?this._override("apiKey",r):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return u([d({type:String})],e.prototype,"apiKey",null),e=u([P("esri.layers.mixins.APIKeyMixin")],e),e},pve={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},fve=Object.values(pve),mve=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${fve.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),Sze=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${fve.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),Eze=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function LLt(t){return!!mve.test(t)}function cx(t){if(t==null)return null;const e=To(t),r=e.path.match(mve)||e.path.match(Sze);if(!r)return null;const[,i,s,n,o]=r,a=s.indexOf("/");return{title:w6(a!==-1?s.slice(a+1):s),serverType:pve[n.toLowerCase()],sublayer:o!=null&&o!==""?parseInt(o,10):null,url:{path:i}}}function Cze(t){const e=To(t).path.match(Eze);return e?{serviceUrl:e[1],sublayerId:Number(e[2])}:null}function w6(t){return(t=t.replaceAll(/\s*[/_]+\s*/g," "))[0].toUpperCase()+t.slice(1)}function gve(t,e){const r=[];if(t){const i=cx(t);i!=null&&i.title&&r.push(i.title)}if(e){const i=w6(e);r.push(i)}if(r.length===2){if(r[0].toLowerCase().includes(r[1].toLowerCase()))return r[0];if(r[1].toLowerCase().includes(r[0].toLowerCase()))return r[1]}return r.join(" - ")}function iY(t){if(!t)return!1;const e=".arcgis.com/",r="//services",i="//tiles",s="//features",n=(t=t.toLowerCase()).includes(e),o=t.includes(r)||t.includes(i)||t.includes(s);return n&&o}function Aze(t,e){return t&&Cme(Ome(t,e))}function yve(t){let{url:e}=t;if(!e)return{url:e};e=Ome(e,t.logger);const r=To(e),i=cx(r.path);let s;if(i!=null)i.sublayer!=null&&t.layer.layerId==null&&(s=i.sublayer),e=i.url.path;else if(t.nonStandardUrlAllowed){const n=Cze(r.path);n!=null&&(e=n.serviceUrl,s=n.sublayerId)}return{url:Cme(e),layerId:s}}function _ve(t,e,r,i,s){J_(e,i,"url",s),i.url&&t.layerId!=null&&(i.url=Pc(i.url,r,t.layerId.toString()))}function DLt(t){if(!t)return!1;const e=t.toLowerCase(),r=e.includes("/services/"),i=e.includes("/mapserver/wmsserver"),s=e.includes("/imageserver/wmsserver"),n=e.includes("/wmsserver");return r&&(i||s||n)}const vve=t=>{let e=class extends t{get title(){if(this._get("title")&&this.originOf("title")!=="defaults")return this._get("title");if(this.url){const r=cx(this.url);if(r!=null&&r.title)return r.title}return this._get("title")||""}set title(r){this._set("title",r)}set url(r){this._set("url",Aze(r,Q.getLogger(this)))}};return u([d()],e.prototype,"title",null),u([d({type:String})],e.prototype,"url",null),e=u([P("esri.layers.mixins.ArcGISService")],e),e};function x6(){const t=new Float32Array(16);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Oze(t){const e=new Float32Array(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Rze(t,e,r,i,s,n,o,a,l,c,h,p,f,m,y,_){const v=new Float32Array(16);return v[0]=t,v[1]=e,v[2]=r,v[3]=i,v[4]=s,v[5]=n,v[6]=o,v[7]=a,v[8]=l,v[9]=c,v[10]=h,v[11]=p,v[12]=f,v[13]=m,v[14]=y,v[15]=_,v}function Mze(t,e){return new Float32Array(t,e,16)}const Pze=x6();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:Pze,clone:Oze,create:x6,createView:Mze,fromValues:Rze},Symbol.toStringTag,{value:"Module"}));function Us(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function xm(t,e,r,i,s,n,o,a,l,c,h,p,f,m,y,_,v){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t[4]=n,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t[9]=h,t[10]=p,t[11]=f,t[12]=m,t[13]=y,t[14]=_,t[15]=v,t}function zh(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function $c(t,e){if(t===e){const r=e[1],i=e[2],s=e[3],n=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=n,t[11]=e[14],t[12]=s,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function rC(t,e){return Mn(t,e)||zh(t),t}function Mn(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],m=e[11],y=e[12],_=e[13],v=e[14],b=e[15],T=r*a-i*o,x=r*l-s*o,S=r*c-n*o,E=i*l-s*a,A=i*c-n*a,R=s*c-n*l,M=h*_-p*y,D=h*v-f*y,k=h*b-m*y,$=p*v-f*_,N=p*b-m*_,H=f*b-m*v;let Z=T*H-x*N+S*$+E*k-A*D+R*M;return Z?(Z=1/Z,t[0]=(a*H-l*N+c*$)*Z,t[1]=(s*N-i*H-n*$)*Z,t[2]=(_*R-v*A+b*E)*Z,t[3]=(f*A-p*R-m*E)*Z,t[4]=(l*k-o*H-c*D)*Z,t[5]=(r*H-s*k+n*D)*Z,t[6]=(v*S-y*R-b*x)*Z,t[7]=(h*R-f*S+m*x)*Z,t[8]=(o*N-a*k+c*M)*Z,t[9]=(i*k-r*N-n*M)*Z,t[10]=(y*A-_*S+b*T)*Z,t[11]=(p*S-h*A-m*T)*Z,t[12]=(a*D-o*$-l*M)*Z,t[13]=(r*$-i*D+s*M)*Z,t[14]=(_*x-y*E-v*T)*Z,t[15]=(h*E-p*x+f*T)*Z,t):null}function Ize(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],m=e[11],y=e[12],_=e[13],v=e[14],b=e[15];return t[0]=a*(f*b-m*v)-p*(l*b-c*v)+_*(l*m-c*f),t[1]=-(i*(f*b-m*v)-p*(s*b-n*v)+_*(s*m-n*f)),t[2]=i*(l*b-c*v)-a*(s*b-n*v)+_*(s*c-n*l),t[3]=-(i*(l*m-c*f)-a*(s*m-n*f)+p*(s*c-n*l)),t[4]=-(o*(f*b-m*v)-h*(l*b-c*v)+y*(l*m-c*f)),t[5]=r*(f*b-m*v)-h*(s*b-n*v)+y*(s*m-n*f),t[6]=-(r*(l*b-c*v)-o*(s*b-n*v)+y*(s*c-n*l)),t[7]=r*(l*m-c*f)-o*(s*m-n*f)+h*(s*c-n*l),t[8]=o*(p*b-m*_)-h*(a*b-c*_)+y*(a*m-c*p),t[9]=-(r*(p*b-m*_)-h*(i*b-n*_)+y*(i*m-n*p)),t[10]=r*(a*b-c*_)-o*(i*b-n*_)+y*(i*c-n*a),t[11]=-(r*(a*m-c*p)-o*(i*m-n*p)+h*(i*c-n*a)),t[12]=-(o*(p*v-f*_)-h*(a*v-l*_)+y*(a*f-l*p)),t[13]=r*(p*v-f*_)-h*(i*v-s*_)+y*(i*f-s*p),t[14]=-(r*(a*v-l*_)-o*(i*v-s*_)+y*(i*l-s*a)),t[15]=r*(a*f-l*p)-o*(i*f-s*p)+h*(i*l-s*a),t}function $ze(t){const e=t[0],r=t[1],i=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=t[9],p=t[10],f=t[11],m=t[12],y=t[13],_=t[14],v=t[15];return(e*o-r*n)*(p*v-f*_)-(e*a-i*n)*(h*v-f*y)+(e*l-s*n)*(h*_-p*y)+(r*a-i*o)*(c*v-f*m)-(r*l-s*o)*(c*_-p*m)+(i*l-s*a)*(c*y-h*m)}function oi(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],p=e[8],f=e[9],m=e[10],y=e[11],_=e[12],v=e[13],b=e[14],T=e[15];let x=r[0],S=r[1],E=r[2],A=r[3];return t[0]=x*i+S*a+E*p+A*_,t[1]=x*s+S*l+E*f+A*v,t[2]=x*n+S*c+E*m+A*b,t[3]=x*o+S*h+E*y+A*T,x=r[4],S=r[5],E=r[6],A=r[7],t[4]=x*i+S*a+E*p+A*_,t[5]=x*s+S*l+E*f+A*v,t[6]=x*n+S*c+E*m+A*b,t[7]=x*o+S*h+E*y+A*T,x=r[8],S=r[9],E=r[10],A=r[11],t[8]=x*i+S*a+E*p+A*_,t[9]=x*s+S*l+E*f+A*v,t[10]=x*n+S*c+E*m+A*b,t[11]=x*o+S*h+E*y+A*T,x=r[12],S=r[13],E=r[14],A=r[15],t[12]=x*i+S*a+E*p+A*_,t[13]=x*s+S*l+E*f+A*v,t[14]=x*n+S*c+E*m+A*b,t[15]=x*o+S*h+E*y+A*T,t}function Fl(t,e,r){const i=r[0],s=r[1],n=r[2];if(e===t)t[12]=e[0]*i+e[4]*s+e[8]*n+e[12],t[13]=e[1]*i+e[5]*s+e[9]*n+e[13],t[14]=e[2]*i+e[6]*s+e[10]*n+e[14],t[15]=e[3]*i+e[7]*s+e[11]*n+e[15];else{const o=e[0],a=e[1],l=e[2],c=e[3],h=e[4],p=e[5],f=e[6],m=e[7],y=e[8],_=e[9],v=e[10],b=e[11];t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=h,t[5]=p,t[6]=f,t[7]=m,t[8]=y,t[9]=_,t[10]=v,t[11]=b,t[12]=o*i+h*s+y*n+e[12],t[13]=a*i+p*s+_*n+e[13],t[14]=l*i+f*s+v*n+e[14],t[15]=c*i+m*s+b*n+e[15]}return t}function T6(t,e,r){const i=r[0],s=r[1],n=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function xc(t,e,r,i){let s,n,o,a,l,c,h,p,f,m,y,_,v,b,T,x,S,E,A,R,M,D,k,$,N=i[0],H=i[1],Z=i[2],G=Math.sqrt(N*N+H*H+Z*Z);return G<sl()?null:(G=1/G,N*=G,H*=G,Z*=G,s=Math.sin(r),n=Math.cos(r),o=1-n,a=e[0],l=e[1],c=e[2],h=e[3],p=e[4],f=e[5],m=e[6],y=e[7],_=e[8],v=e[9],b=e[10],T=e[11],x=N*N*o+n,S=H*N*o+Z*s,E=Z*N*o-H*s,A=N*H*o-Z*s,R=H*H*o+n,M=Z*H*o+N*s,D=N*Z*o+H*s,k=H*Z*o-N*s,$=Z*Z*o+n,t[0]=a*x+p*S+_*E,t[1]=l*x+f*S+v*E,t[2]=c*x+m*S+b*E,t[3]=h*x+y*S+T*E,t[4]=a*A+p*R+_*M,t[5]=l*A+f*R+v*M,t[6]=c*A+m*R+b*M,t[7]=h*A+y*R+T*M,t[8]=a*D+p*k+_*$,t[9]=l*D+f*k+v*$,t[10]=c*D+m*k+b*$,t[11]=h*D+y*k+T*$,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function eE(t,e,r){const i=Math.sin(r),s=Math.cos(r),n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=e[9],p=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=n*s+c*i,t[5]=o*s+h*i,t[6]=a*s+p*i,t[7]=l*s+f*i,t[8]=c*s-n*i,t[9]=h*s-o*i,t[10]=p*s-a*i,t[11]=f*s-l*i,t}function S6(t,e,r){const i=Math.sin(r),s=Math.cos(r),n=e[0],o=e[1],a=e[2],l=e[3],c=e[8],h=e[9],p=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s-c*i,t[1]=o*s-h*i,t[2]=a*s-p*i,t[3]=l*s-f*i,t[8]=n*i+c*s,t[9]=o*i+h*s,t[10]=a*i+p*s,t[11]=l*i+f*s,t}function tE(t,e,r){const i=Math.sin(r),s=Math.cos(r),n=e[0],o=e[1],a=e[2],l=e[3],c=e[4],h=e[5],p=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s+c*i,t[1]=o*s+h*i,t[2]=a*s+p*i,t[3]=l*s+f*i,t[4]=c*s-n*i,t[5]=h*s-o*i,t[6]=p*s-a*i,t[7]=f*s-l*i,t}function zM(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function Lze(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Au(t,e,r){if(e===0)return zh(t);let i,s,n,o=r[0],a=r[1],l=r[2],c=Math.sqrt(o*o+a*a+l*l);return c<sl()?null:(c=1/c,o*=c,a*=c,l*=c,i=Math.sin(e),s=Math.cos(e),n=1-s,t[0]=o*o*n+s,t[1]=a*o*n+l*i,t[2]=l*o*n-a*i,t[3]=0,t[4]=o*a*n-l*i,t[5]=a*a*n+s,t[6]=l*a*n+o*i,t[7]=0,t[8]=o*l*n+a*i,t[9]=a*l*n-o*i,t[10]=l*l*n+s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function bve(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Dze(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function wve(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function xve(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=i+i,l=s+s,c=n+n,h=i*a,p=i*l,f=i*c,m=s*l,y=s*c,_=n*c,v=o*a,b=o*l,T=o*c;return t[0]=1-(m+_),t[1]=p+T,t[2]=f-b,t[3]=0,t[4]=p-T,t[5]=1-(h+_),t[6]=y+v,t[7]=0,t[8]=f+b,t[9]=y-v,t[10]=1-(h+m),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function Nze(t,e){const r=Fze,i=-e[0],s=-e[1],n=-e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],p=i*i+s*s+n*n+o*o;return p>0?(r[0]=2*(a*o+h*i+l*n-c*s)/p,r[1]=2*(l*o+h*s+c*i-a*n)/p,r[2]=2*(c*o+h*n+a*s-l*i)/p):(r[0]=2*(a*o+h*i+l*n-c*s),r[1]=2*(l*o+h*s+c*i-a*n),r[2]=2*(c*o+h*n+a*s-l*i)),xve(t,e,r),t}const Fze=O();function O7(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function Tve(t,e){const r=e[0],i=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],h=e[10];return t[0]=Math.sqrt(r*r+i*i+s*s),t[1]=Math.sqrt(n*n+o*o+a*a),t[2]=Math.sqrt(l*l+c*c+h*h),t}function Uze(t,e){const r=e[0]+e[5]+e[10];let i=0;return r>0?(i=2*Math.sqrt(r+1),t[3]=.25*i,t[0]=(e[6]-e[9])/i,t[1]=(e[8]-e[2])/i,t[2]=(e[1]-e[4])/i):e[0]>e[5]&&e[0]>e[10]?(i=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/i,t[0]=.25*i,t[1]=(e[1]+e[4])/i,t[2]=(e[8]+e[2])/i):e[5]>e[10]?(i=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/i,t[0]=(e[1]+e[4])/i,t[1]=.25*i,t[2]=(e[6]+e[9])/i):(i=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/i,t[0]=(e[8]+e[2])/i,t[1]=(e[6]+e[9])/i,t[2]=.25*i),t}function kze(t,e,r,i){const s=e[0],n=e[1],o=e[2],a=e[3],l=s+s,c=n+n,h=o+o,p=s*l,f=s*c,m=s*h,y=n*c,_=n*h,v=o*h,b=a*l,T=a*c,x=a*h,S=i[0],E=i[1],A=i[2];return t[0]=(1-(y+v))*S,t[1]=(f+x)*S,t[2]=(m-T)*S,t[3]=0,t[4]=(f-x)*E,t[5]=(1-(p+v))*E,t[6]=(_+b)*E,t[7]=0,t[8]=(m+T)*A,t[9]=(_-b)*A,t[10]=(1-(p+y))*A,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function zze(t,e,r,i,s){const n=e[0],o=e[1],a=e[2],l=e[3],c=n+n,h=o+o,p=a+a,f=n*c,m=n*h,y=n*p,_=o*h,v=o*p,b=a*p,T=l*c,x=l*h,S=l*p,E=i[0],A=i[1],R=i[2],M=s[0],D=s[1],k=s[2],$=(1-(_+b))*E,N=(m+S)*E,H=(y-x)*E,Z=(m-S)*A,G=(1-(f+b))*A,J=(v+T)*A,I=(y+x)*R,z=(v-T)*R,F=(1-(f+_))*R;return t[0]=$,t[1]=N,t[2]=H,t[3]=0,t[4]=Z,t[5]=G,t[6]=J,t[7]=0,t[8]=I,t[9]=z,t[10]=F,t[11]=0,t[12]=r[0]+M-($*M+Z*D+I*k),t[13]=r[1]+D-(N*M+G*D+z*k),t[14]=r[2]+k-(H*M+J*D+F*k),t[15]=1,t}function Vze(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=r+r,a=i+i,l=s+s,c=r*o,h=i*o,p=i*a,f=s*o,m=s*a,y=s*l,_=n*o,v=n*a,b=n*l;return t[0]=1-p-y,t[1]=h+b,t[2]=f-v,t[3]=0,t[4]=h-b,t[5]=1-c-y,t[6]=m+_,t[7]=0,t[8]=f+v,t[9]=m-_,t[10]=1-c-p,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Sve(t,e,r,i,s,n,o){const a=1/(r-e),l=1/(s-i),c=1/(n-o);return t[0]=2*n*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*n*l,t[6]=0,t[7]=0,t[8]=(r+e)*a,t[9]=(s+i)*l,t[10]=(o+n)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*n*2*c,t[15]=0,t}function Bze(t,e,r,i,s){const n=1/Math.tan(e/2);let o;return t[0]=n/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(o=1/(i-s),t[10]=(s+i)*o,t[14]=2*s*i*o):(t[10]=-1,t[14]=-2*i),t}function Gze(t,e,r,i){const s=Math.tan(e.upDegrees*Math.PI/180),n=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(s+n);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(o-a)*l*.5,t[9]=(s-n)*c*.5,t[10]=i/(r-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*r/(r-i),t[15]=0,t}function Eve(t,e,r,i,s,n,o){const a=1/(e-r),l=1/(i-s),c=1/(n-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+r)*a,t[13]=(s+i)*l,t[14]=(o+n)*c,t[15]=1,t}function E6(t,e,r,i){const s=e[0],n=e[1],o=e[2];let a=s-r[0],l=n-r[1],c=o-r[2];const h=sl();if(Math.abs(a)<h&&Math.abs(l)<h&&Math.abs(c)<h)return void zh(t);let p=1/Math.sqrt(a*a+l*l+c*c);a*=p,l*=p,c*=p;const f=i[0],m=i[1],y=i[2];let _=m*c-y*l,v=y*a-f*c,b=f*l-m*a;p=Math.sqrt(_*_+v*v+b*b),p?(p=1/p,_*=p,v*=p,b*=p):(_=0,v=0,b=0);let T=l*b-c*v,x=c*_-a*b,S=a*v-l*_;p=Math.sqrt(T*T+x*x+S*S),p?(p=1/p,T*=p,x*=p,S*=p):(T=0,x=0,S=0),t[0]=_,t[1]=T,t[2]=a,t[3]=0,t[4]=v,t[5]=x,t[6]=l,t[7]=0,t[8]=b,t[9]=S,t[10]=c,t[11]=0,t[12]=-(_*s+v*n+b*o),t[13]=-(T*s+x*n+S*o),t[14]=-(a*s+l*n+c*o),t[15]=1}function Cve(t,e,r,i){const s=e[0],n=e[1],o=e[2],a=i[0],l=i[1],c=i[2];let h=s-r[0],p=n-r[1],f=o-r[2],m=h*h+p*p+f*f;m>0&&(m=1/Math.sqrt(m),h*=m,p*=m,f*=m);let y=l*f-c*p,_=c*h-a*f,v=a*p-l*h;return m=y*y+_*_+v*v,m>0&&(m=1/Math.sqrt(m),y*=m,_*=m,v*=m),t[0]=y,t[1]=_,t[2]=v,t[3]=0,t[4]=p*v-f*_,t[5]=f*y-h*v,t[6]=h*_-p*y,t[7]=0,t[8]=h,t[9]=p,t[10]=f,t[11]=0,t[12]=s,t[13]=n,t[14]=o,t[15]=1,t}function jze(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function Hze(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2+t[9]**2+t[10]**2+t[11]**2+t[12]**2+t[13]**2+t[14]**2+t[15]**2)}function qze(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function Ave(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function Wze(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function Xze(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t[9]=e[9]+r[9]*i,t[10]=e[10]+r[10]*i,t[11]=e[11]+r[11]*i,t[12]=e[12]+r[12]*i,t[13]=e[13]+r[13]*i,t[14]=e[14]+r[14]*i,t[15]=e[15]+r[15]*i,t}function Ove(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function sY(t,e){if(t===e)return!0;const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=t[9],f=t[10],m=t[11],y=t[12],_=t[13],v=t[14],b=t[15],T=e[0],x=e[1],S=e[2],E=e[3],A=e[4],R=e[5],M=e[6],D=e[7],k=e[8],$=e[9],N=e[10],H=e[11],Z=e[12],G=e[13],J=e[14],I=e[15],z=sl();return Math.abs(r-T)<=z*Math.max(1,Math.abs(r),Math.abs(T))&&Math.abs(i-x)<=z*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(s-S)<=z*Math.max(1,Math.abs(s),Math.abs(S))&&Math.abs(n-E)<=z*Math.max(1,Math.abs(n),Math.abs(E))&&Math.abs(o-A)<=z*Math.max(1,Math.abs(o),Math.abs(A))&&Math.abs(a-R)<=z*Math.max(1,Math.abs(a),Math.abs(R))&&Math.abs(l-M)<=z*Math.max(1,Math.abs(l),Math.abs(M))&&Math.abs(c-D)<=z*Math.max(1,Math.abs(c),Math.abs(D))&&Math.abs(h-k)<=z*Math.max(1,Math.abs(h),Math.abs(k))&&Math.abs(p-$)<=z*Math.max(1,Math.abs(p),Math.abs($))&&Math.abs(f-N)<=z*Math.max(1,Math.abs(f),Math.abs(N))&&Math.abs(m-H)<=z*Math.max(1,Math.abs(m),Math.abs(H))&&Math.abs(y-Z)<=z*Math.max(1,Math.abs(y),Math.abs(Z))&&Math.abs(_-G)<=z*Math.max(1,Math.abs(_),Math.abs(G))&&Math.abs(v-J)<=z*Math.max(1,Math.abs(v),Math.abs(J))&&Math.abs(b-I)<=z*Math.max(1,Math.abs(b),Math.abs(I))}function nY(t){const e=sl(),r=t[0],i=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],h=t[10];return Math.abs(1-(r*r+n*n+l*l))<=e&&Math.abs(1-(i*i+o*o+c*c))<=e&&Math.abs(1-(s*s+a*a+h*h))<=e}function C6(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[8]===0&&t[9]===0&&t[10]===1}const Zze=oi,Yze=Ave;Object.freeze(Object.defineProperty({__proto__:null,add:qze,adjoint:Ize,copy:Us,determinant:$ze,equals:sY,exactEquals:Ove,frob:Hze,fromQuat:Vze,fromQuat2:Nze,fromRotation:Au,fromRotationTranslation:xve,fromRotationTranslationScale:kze,fromRotationTranslationScaleOrigin:zze,fromScaling:Lze,fromTranslation:zM,fromXRotation:bve,fromYRotation:Dze,fromZRotation:wve,frustum:Sve,getRotation:Uze,getScaling:Tve,getTranslation:O7,hasIdentityRotation:C6,identity:zh,invert:Mn,invertOrIdentity:rC,isOrthoNormal:nY,lookAt:E6,mul:Zze,multiply:oi,multiplyScalar:Wze,multiplyScalarAndAdd:Xze,ortho:Eve,perspective:Bze,perspectiveFromFieldOfView:Gze,rotate:xc,rotateX:eE,rotateY:S6,rotateZ:tE,scale:T6,set:xm,str:jze,sub:Yze,subtract:Ave,targetTo:Cve,translate:Fl,transpose:$c},Symbol.toStringTag,{value:"Module"}));const Jze=(t,e)=>{const r=xm(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1);return $c(r,r)},Qze=(t,e)=>{const r=xm(t,e,0,0,.5-.5*e,0,e,0,.5-.5*e,0,0,e,.5-.5*e,0,0,0,1);return $c(r,r)},Kze=(t,e)=>{const r=1-e,i=xm(t,.2126+.7874*r,.7152-.7152*r,.0722-.0722*r,0,.2126-.2126*r,.7152+.2848*r,.0722-.0722*r,0,.2126-.2126*r,.7152-.7152*r,.0722+.9278*r,0,0,0,0,1);return $c(i,i)},eVe=(t,e)=>{const r=Math.sin(e*Math.PI/180),i=Math.cos(e*Math.PI/180),s=xm(t,.213+.787*i-.213*r,.715-.715*i-.715*r,.072-.072*i+.928*r,0,.213-.213*i+.143*r,.715+.285*i+.14*r,.072-.072*i-.283*r,0,.213-.213*i-.787*r,.715-.715*i+.715*r,.072+.928*i+.072*r,0,0,0,0,1);return $c(s,s)},tVe=(t,e)=>{const r=1-2*e,i=xm(t,r,0,0,e,0,r,0,e,0,0,r,e,0,0,0,1);return $c(i,i)},rVe=(t,e)=>{const r=xm(t,.213+.787*e,.715-.715*e,.072-.072*e,0,.213-.213*e,.715+.285*e,.072-.072*e,0,.213-.213*e,.715-.715*e,.072+.928*e,0,0,0,0,1);return $c(r,r)},iVe=(t,e)=>{const r=1-e,i=xm(t,.393+.607*r,.769-.769*r,.189-.189*r,0,.349-.349*r,.686+.314*r,.168-.168*r,0,.272-.272*r,.534-.534*r,.131+.869*r,0,0,0,0,1);return $c(i,i)};let Rve=class Mve{constructor(e,r,i){this.strength=e,this.radius=r,this.threshold=i,this.type="bloom"}interpolate(e,r,i){this.strength=dc(e.strength,r.strength,i),this.radius=dc(e.radius,r.radius,i),this.threshold=dc(e.threshold,r.threshold,i)}clone(){return new Mve(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:OO(this.radius),strength:this.strength,threshold:this.threshold}}},Pve=class Ive{constructor(e){this.radius=e,this.type="blur"}interpolate(e,r,i){this.radius=Math.round(dc(e.radius,r.radius,i))}clone(){return new Ive(this.radius)}toJSON(){return{type:"blur",radius:OO(this.radius)}}},R7=class $ve{constructor(e,r){this.type=e,this.amount=r,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,r,i){this.amount=dc(e.amount,r.amount,i),this._updateMatrix()}clone(){return new $ve(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const e=this._colorMatrix||x6();switch(this.type){case"brightness":this._colorMatrix=Jze(e,this.amount);break;case"contrast":this._colorMatrix=Qze(e,this.amount);break;case"grayscale":this._colorMatrix=Kze(e,this.amount);break;case"invert":this._colorMatrix=tVe(e,this.amount);break;case"saturate":this._colorMatrix=rVe(e,this.amount);break;case"sepia":this._colorMatrix=iVe(e,this.amount)}}},Lve=class Dve{constructor(e,r,i,s){this.offsetX=e,this.offsetY=r,this.blurRadius=i,this.color=s,this.type="drop-shadow"}interpolate(e,r,i){this.offsetX=dc(e.offsetX,r.offsetX,i),this.offsetY=dc(e.offsetY,r.offsetY,i),this.blurRadius=dc(e.blurRadius,r.blurRadius,i),this.color[0]=Math.round(dc(e.color[0],r.color[0],i)),this.color[1]=Math.round(dc(e.color[1],r.color[1],i)),this.color[2]=Math.round(dc(e.color[2],r.color[2],i)),this.color[3]=dc(e.color[3],r.color[3],i)}clone(){return new Dve(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const e=[...this.color];return e[3]*=255,{type:"drop-shadow",xoffset:OO(this.offsetX),yoffset:OO(this.offsetY),blurRadius:OO(this.blurRadius),color:e}}},Nve=class Fve{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,r,i){this.angle=dc(e.angle,r.angle,i),this._updateMatrix()}clone(){return new Fve(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const e=this._colorMatrix||x6();this._colorMatrix=eVe(e,this.angle)}},Uve=class kve{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,r,i){this.amount=dc(e.amount,r.amount,i)}clone(){return new kve(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}};function dc(t,e,r){return t+(e-t)*r}function OO(t){return Math.round(1e3*Uh(t))/1e3}function sVe(t){switch(t.type){case"grayscale":case"sepia":case"invert":return new R7(t.type,0);case"saturate":case"brightness":case"contrast":return new R7(t.type,1);case"opacity":return new Uve(1);case"hue-rotate":return new Nve(0);case"blur":return new Pve(0);case"drop-shadow":return new Lve(0,0,0,[...HX("transparent")]);case"bloom":return new Rve(0,0,1)}}var NLt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function VM(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function nVe(t,e){const r=t.length>e.length?t:e;return(t.length>e.length?e:t).every((i,s)=>i.type===r[s].type)}function oVe(t,e){const r=t.length>e.length?t:e,i=t.length>e.length?e:t;for(let s=i.length;s<r.length;s++)i.push(sVe(r[s]))}function aVe(t){const e=t[0];return!!e&&"type"in e}var Vre,Bre,M7={exports:{}};M7.exports,Bre=function(){function t(s,n){function o(){this.constructor=s}o.prototype=n.prototype,s.prototype=new o}function e(s,n,o,a){var l=Error.call(this,s);return Object.setPrototypeOf&&Object.setPrototypeOf(l,e.prototype),l.expected=n,l.found=o,l.location=a,l.name="SyntaxError",l}function r(s,n,o){return o=o||" ",s.length>n?s:(n-=s.length,s+(o+=o.repeat(n)).slice(0,n))}function i(s,n){var o,a={},l=(n=n!==void 0?n:{}).grammarSource,c={start:Mm},h=Mm,p="none",f=")",m=",",y="(",_="%",v="px",b="cm",T="mm",x="in",S="pt",E="pc",A="deg",R="rad",M="grad",D="turn",k="#",$=".",N="e",H=/^[ \t\n\r]/,Z=/^[a-z\-]/,G=/^[0-9a-fA-F]/,J=/^[+\-]/,I=/^[0-9]/,z=nl("none"),F=Dn("none",!1),j=Dn(")",!1),W=Dn(",",!1),Y=nl("whitespace"),te=Mv([" ","	",`
`,"\r"],!1,!1),me=nl("function"),Le=Dn("(",!1),dt=nl("identifier"),st=Mv([["a","z"],"-"],!1,!1),Xe=nl("percentage"),yt=Dn("%",!1),ge=nl("length"),Ce=Dn("px",!1),bt=Dn("cm",!1),_e=Dn("mm",!1),Be=Dn("in",!1),qe=Dn("pt",!1),ft=Dn("pc",!1),Se=nl("angle"),Re=Dn("deg",!1),pt=Dn("rad",!1),Ut=Dn("grad",!1),ir=Dn("turn",!1),gi=nl("number"),ot=nl("color"),at=Dn("#",!1),wt=Mv([["0","9"],["a","f"],["A","F"]],!1,!1),Jt=Mv(["+","-"],!1,!1),sr=Mv([["0","9"]],!1,!1),Wr=Dn(".",!1),yi=Dn("e",!1),Qt=function(){return[]},_i=function(q,pe){return{type:"function",name:q,parameters:pe||[]}},ki=function(q,pe){return pe.length>0?bC(q,pe,3):[q]},jr=function(q){return{type:"quantity",value:q.value,unit:q.unit}},Er=function(q){return{type:"color",colorType:q.type,value:q.value}},qi=function(q){return q},xs=function(){return zl()},Dr=function(q){return{value:q,unit:"%"}},ii=function(q){return{value:q,unit:"px"}},Xr=function(q){return{value:q,unit:"cm"}},_r=function(q){return{value:q,unit:"mm"}},ci=function(q){return{value:q,unit:"in"}},js=function(q){return{value:q,unit:"pt"}},eo=function(q){return{value:q,unit:"pc"}},to=function(q){return{value:q,unit:"deg"}},mn=function(q){return{value:q,unit:"rad"}},gn=function(q){return{value:q,unit:"grad"}},Wi=function(q){return{value:q,unit:"turn"}},yn=function(q){return{value:q,unit:null}},Zr=function(){return{type:"hex",value:zl()}},$n=function(q){return{type:"function",value:q}},Ao=function(){return{type:"named",value:zl()}},ba=function(){return parseFloat(zl())},ne=0,Ei=0,Kh=[{line:1,column:1}],Ln=0,ed=[],tt=0;if("startRule"in n){if(!(n.startRule in c))throw new Error(`Can't start parsing from rule "`+n.startRule+'".');h=c[n.startRule]}function zl(){return s.substring(Ei,ne)}function Dn(q,pe){return{type:"literal",text:q,ignoreCase:pe}}function Mv(q,pe,Ee){return{type:"class",parts:q,inverted:pe,ignoreCase:Ee}}function Pv(){return{type:"end"}}function nl(q){return{type:"other",description:q}}function Rm(q){var pe,Ee=Kh[q];if(Ee)return Ee;for(pe=q-1;!Kh[pe];)pe--;for(Ee={line:(Ee=Kh[pe]).line,column:Ee.column};pe<q;)s.charCodeAt(pe)===10?(Ee.line++,Ee.column=1):Ee.column++,pe++;return Kh[q]=Ee,Ee}function Iv(q,pe,Ee){var dr=Rm(q),Hs=Rm(pe),vi={source:l,start:{offset:q,line:dr.line,column:dr.column},end:{offset:pe,line:Hs.line,column:Hs.column}};return Ee&&l&&typeof l.offset=="function"&&(vi.start=l.offset(vi.start),vi.end=l.offset(vi.end)),vi}function Kt(q){ne<Ln||(ne>Ln&&(Ln=ne,ed=[]),ed.push(q))}function Fy(q,pe,Ee){return new e(e.buildMessage(q,pe),q,pe,Ee)}function Mm(){var q;return(q=Uy())===a&&(q=wa()),q}function Uy(){var q,pe;return tt++,q=ne,ts(),s.substr(ne,4)===p?(pe=p,ne+=4):(pe=a,tt===0&&Kt(F)),pe!==a?(ts(),Ei=q,q=Qt()):(ne=q,q=a),tt--,q===a&&tt===0&&Kt(z),q}function wa(){var q,pe;if(q=[],(pe=Vl())!==a)for(;pe!==a;)q.push(pe),pe=Vl();else q=a;return q}function Vl(){var q,pe,Ee,dr;return q=ne,ts(),(pe=ky())!==a?(ts(),(Ee=Lp())===a&&(Ee=null),ts(),s.charCodeAt(ne)===41?(dr=f,ne++):(dr=a,tt===0&&Kt(j)),dr!==a?(ts(),Ei=q,q=_i(pe,Ee)):(ne=q,q=a)):(ne=q,q=a),q}function Lp(){var q,pe,Ee,dr,Hs,vi,xa,Nv;if(q=ne,(pe=Nn())!==a){for(Ee=[],dr=ne,Hs=ts(),s.charCodeAt(ne)===44?(vi=m,ne++):(vi=a,tt===0&&Kt(W)),vi===a&&(vi=null),xa=ts(),(Nv=Nn())!==a?dr=Hs=[Hs,vi,xa,Nv]:(ne=dr,dr=a);dr!==a;)Ee.push(dr),dr=ne,Hs=ts(),s.charCodeAt(ne)===44?(vi=m,ne++):(vi=a,tt===0&&Kt(W)),vi===a&&(vi=null),xa=ts(),(Nv=Nn())!==a?dr=Hs=[Hs,vi,xa,Nv]:(ne=dr,dr=a);Ei=q,q=ki(pe,Ee)}else ne=q,q=a;return q}function Nn(){var q,pe;return q=ne,(pe=Lv())===a&&(pe=Tx())===a&&(pe=Dv())===a&&(pe=zy()),pe!==a&&(Ei=q,pe=jr(pe)),(q=pe)===a&&(q=ne,(pe=TP())!==a&&(Ei=q,pe=Er(pe)),q=pe),q}function ts(){var q,pe;for(tt++,q=[],H.test(s.charAt(ne))?(pe=s.charAt(ne),ne++):(pe=a,tt===0&&Kt(te));pe!==a;)q.push(pe),H.test(s.charAt(ne))?(pe=s.charAt(ne),ne++):(pe=a,tt===0&&Kt(te));return tt--,pe=a,tt===0&&Kt(Y),q}function ky(){var q,pe,Ee;return tt++,q=ne,(pe=$v())!==a?(s.charCodeAt(ne)===40?(Ee=y,ne++):(Ee=a,tt===0&&Kt(Le)),Ee!==a?(Ei=q,q=qi(pe)):(ne=q,q=a)):(ne=q,q=a),tt--,q===a&&(pe=a,tt===0&&Kt(me)),q}function $v(){var q,pe,Ee;if(tt++,q=ne,pe=[],Z.test(s.charAt(ne))?(Ee=s.charAt(ne),ne++):(Ee=a,tt===0&&Kt(st)),Ee!==a)for(;Ee!==a;)pe.push(Ee),Z.test(s.charAt(ne))?(Ee=s.charAt(ne),ne++):(Ee=a,tt===0&&Kt(st));else pe=a;return pe!==a&&(Ei=q,pe=xs()),tt--,(q=pe)===a&&(pe=a,tt===0&&Kt(dt)),q}function Lv(){var q,pe,Ee;return tt++,q=ne,ts(),(pe=ol())!==a?(s.charCodeAt(ne)===37?(Ee=_,ne++):(Ee=a,tt===0&&Kt(yt)),Ee!==a?(Ei=q,q=Dr(pe)):(ne=q,q=a)):(ne=q,q=a),tt--,q===a&&tt===0&&Kt(Xe),q}function Tx(){var q,pe,Ee;return tt++,q=ne,ts(),(pe=ol())!==a?(s.substr(ne,2)===v?(Ee=v,ne+=2):(Ee=a,tt===0&&Kt(Ce)),Ee!==a?(Ei=q,q=ii(pe)):(ne=q,q=a)):(ne=q,q=a),q===a&&(q=ne,ts(),(pe=ol())!==a?(s.substr(ne,2)===b?(Ee=b,ne+=2):(Ee=a,tt===0&&Kt(bt)),Ee!==a?(Ei=q,q=Xr(pe)):(ne=q,q=a)):(ne=q,q=a),q===a&&(q=ne,ts(),(pe=ol())!==a?(s.substr(ne,2)===T?(Ee=T,ne+=2):(Ee=a,tt===0&&Kt(_e)),Ee!==a?(Ei=q,q=_r(pe)):(ne=q,q=a)):(ne=q,q=a),q===a&&(q=ne,ts(),(pe=ol())!==a?(s.substr(ne,2)===x?(Ee=x,ne+=2):(Ee=a,tt===0&&Kt(Be)),Ee!==a?(Ei=q,q=ci(pe)):(ne=q,q=a)):(ne=q,q=a),q===a&&(q=ne,ts(),(pe=ol())!==a?(s.substr(ne,2)===S?(Ee=S,ne+=2):(Ee=a,tt===0&&Kt(qe)),Ee!==a?(Ei=q,q=js(pe)):(ne=q,q=a)):(ne=q,q=a),q===a&&(q=ne,ts(),(pe=ol())!==a?(s.substr(ne,2)===E?(Ee=E,ne+=2):(Ee=a,tt===0&&Kt(ft)),Ee!==a?(Ei=q,q=eo(pe)):(ne=q,q=a)):(ne=q,q=a)))))),tt--,q===a&&tt===0&&Kt(ge),q}function Dv(){var q,pe,Ee;return tt++,q=ne,(pe=ol())!==a?(s.substr(ne,3)===A?(Ee=A,ne+=3):(Ee=a,tt===0&&Kt(Re)),Ee!==a?(Ei=q,q=to(pe)):(ne=q,q=a)):(ne=q,q=a),q===a&&(q=ne,(pe=ol())!==a?(s.substr(ne,3)===R?(Ee=R,ne+=3):(Ee=a,tt===0&&Kt(pt)),Ee!==a?(Ei=q,q=mn(pe)):(ne=q,q=a)):(ne=q,q=a),q===a&&(q=ne,(pe=ol())!==a?(s.substr(ne,4)===M?(Ee=M,ne+=4):(Ee=a,tt===0&&Kt(Ut)),Ee!==a?(Ei=q,q=gn(pe)):(ne=q,q=a)):(ne=q,q=a),q===a&&(q=ne,(pe=ol())!==a?(s.substr(ne,4)===D?(Ee=D,ne+=4):(Ee=a,tt===0&&Kt(ir)),Ee!==a?(Ei=q,q=Wi(pe)):(ne=q,q=a)):(ne=q,q=a)))),tt--,q===a&&(pe=a,tt===0&&Kt(Se)),q}function zy(){var q,pe;return tt++,q=ne,ts(),(pe=ol())!==a?(Ei=q,q=yn(pe)):(ne=q,q=a),tt--,q===a&&tt===0&&Kt(gi),q}function TP(){var q,pe,Ee,dr;if(tt++,q=ne,s.charCodeAt(ne)===35?(pe=k,ne++):(pe=a,tt===0&&Kt(at)),pe!==a){if(Ee=[],G.test(s.charAt(ne))?(dr=s.charAt(ne),ne++):(dr=a,tt===0&&Kt(wt)),dr!==a)for(;dr!==a;)Ee.push(dr),G.test(s.charAt(ne))?(dr=s.charAt(ne),ne++):(dr=a,tt===0&&Kt(wt));else Ee=a;Ee!==a?(Ei=q,q=Zr()):(ne=q,q=a)}else ne=q,q=a;return q===a&&(q=ne,(pe=Vl())!==a&&(Ei=q,pe=$n(pe)),(q=pe)===a&&(q=ne,(pe=$v())!==a&&(Ei=q,pe=Ao()),q=pe)),tt--,q===a&&(pe=a,tt===0&&Kt(ot)),q}function ol(){var q,pe,Ee,dr,Hs,vi,xa;for(q=ne,J.test(s.charAt(ne))?(s.charAt(ne),ne++):tt===0&&Kt(Jt),pe=ne,Ee=[],I.test(s.charAt(ne))?(dr=s.charAt(ne),ne++):(dr=a,tt===0&&Kt(sr));dr!==a;)Ee.push(dr),I.test(s.charAt(ne))?(dr=s.charAt(ne),ne++):(dr=a,tt===0&&Kt(sr));if(s.charCodeAt(ne)===46?(dr=$,ne++):(dr=a,tt===0&&Kt(Wr)),dr!==a){if(Hs=[],I.test(s.charAt(ne))?(vi=s.charAt(ne),ne++):(vi=a,tt===0&&Kt(sr)),vi!==a)for(;vi!==a;)Hs.push(vi),I.test(s.charAt(ne))?(vi=s.charAt(ne),ne++):(vi=a,tt===0&&Kt(sr));else Hs=a;Hs!==a?pe=Ee=[Ee,dr,Hs]:(ne=pe,pe=a)}else ne=pe,pe=a;if(pe===a)if(pe=[],I.test(s.charAt(ne))?(Ee=s.charAt(ne),ne++):(Ee=a,tt===0&&Kt(sr)),Ee!==a)for(;Ee!==a;)pe.push(Ee),I.test(s.charAt(ne))?(Ee=s.charAt(ne),ne++):(Ee=a,tt===0&&Kt(sr));else pe=a;if(pe!==a){if(Ee=ne,s.charCodeAt(ne)===101?(dr=N,ne++):(dr=a,tt===0&&Kt(yi)),dr!==a){if(J.test(s.charAt(ne))?(Hs=s.charAt(ne),ne++):(Hs=a,tt===0&&Kt(Jt)),Hs===a&&(Hs=null),vi=[],I.test(s.charAt(ne))?(xa=s.charAt(ne),ne++):(xa=a,tt===0&&Kt(sr)),xa!==a)for(;xa!==a;)vi.push(xa),I.test(s.charAt(ne))?(xa=s.charAt(ne),ne++):(xa=a,tt===0&&Kt(sr));else vi=a;vi!==a?Ee=dr=[dr,Hs,vi]:(ne=Ee,Ee=a)}else ne=Ee,Ee=a;Ee===a&&(Ee=null),Ei=q,q=ba()}else ne=q,q=a;return q}function vC(q,pe){return q.map(function(Ee){return Ee[pe]})}function bC(q,pe,Ee){return[q].concat(vC(pe,Ee))}if((o=h())!==a&&ne===s.length)return o;throw o!==a&&ne<s.length&&Kt(Pv()),Fy(ed,Ln<s.length?s.charAt(Ln):null,Ln<s.length?Iv(Ln,Ln+1):Iv(Ln,Ln))}return t(e,Error),e.prototype.format=function(s){var n="Error: "+this.message;if(this.location){var o,a=null;for(o=0;o<s.length;o++)if(s[o].source===this.location.source){a=s[o].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,c=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(l):l,h=this.location.source+":"+c.line+":"+c.column;if(a){var p=this.location.end,f=r("",c.line.toString().length," "),m=a[l.line-1],y=(l.line===p.line?p.column:m.length+1)-l.column||1;n+=`
 --> `+h+`
`+f+` |
`+c.line+" | "+m+`
`+f+" | "+r("",l.column-1," ")+r("",y,"^")}else n+=`
 at `+h}return n},e.buildMessage=function(s,n){var o={literal:function(m){return'"'+l(m.text)+'"'},class:function(m){var y=m.parts.map(function(_){return Array.isArray(_)?c(_[0])+"-"+c(_[1]):c(_)});return"["+(m.inverted?"^":"")+y.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(m){return m.description}};function a(m){return m.charCodeAt(0).toString(16).toUpperCase()}function l(m){return m.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+a(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+a(y)})}function c(m){return m.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+a(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+a(y)})}function h(m){return o[m.type](m)}function p(m){var y,_,v=m.map(h);if(v.sort(),v.length>0){for(y=1,_=1;y<v.length;y++)v[y-1]!==v[y]&&(v[_]=v[y],_++);v.length=_}switch(v.length){case 1:return v[0];case 2:return v[0]+" or "+v[1];default:return v.slice(0,-1).join(", ")+", or "+v[v.length-1]}}function f(m){return m?'"'+l(m)+'"':"end of input"}return"Expected "+p(s)+" but "+f(n)+" found."},{SyntaxError:e,parse:i}},(Vre=M7).exports&&(Vre.exports=Bre());var lVe=M7.exports;function zve(t){if(!t||t.length===0)return null;if(typeof t=="string"){const r=Gre(t);return r&&r.length!==0?r:null}const e=t.map(r=>{if(!Number.isFinite(r.scale)||r.scale<=0)throw new V("effect:invalid-scale","scale must be finite and greater than 0",{stop:r});return{scale:r.scale,effects:Gre(r.value)}});e.sort((r,i)=>i.effects.length-r.effects.length);for(let r=0;r<e.length-1;r++){if(!nVe(e[r].effects,e[r+1].effects))throw new V("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:e[r].effects,b:e[r+1].effects});oVe(e[r].effects,e[r+1].effects)}return e.sort((r,i)=>i.scale-r.scale),e}function Gre(t){let e;if(!t)return[];try{e=lVe.parse(t)}catch(r){throw new V("effect:invalid-syntax","Invalid effect syntax",{value:t,error:r})}return e.map(r=>cVe(r))}function cVe(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return uVe(t);case"opacity":return hVe(t);case"hue-rotate":return dVe(t);case"blur":return pVe(t);case"drop-shadow":return fVe(t);case"bloom":return mVe(t)}}catch(e){throw e.details.filter=t,e}throw new V("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}function uVe(t){let e=1;return iC(t.parameters,1),t.parameters.length===1&&(e=jd(t.parameters[0])),new R7(t.name,e)}function hVe(t){let e=1;return iC(t.parameters,1),t.parameters.length===1&&(e=jd(t.parameters[0])),new Uve(e)}function dVe(t){let e=0;return iC(t.parameters,1),t.parameters.length===1&&(e=wVe(t.parameters[0])),new Nve(e)}function pVe(t){let e=0;return iC(t.parameters,1),t.parameters.length===1&&(e=lY(t.parameters[0]),BM(e,t.parameters[0])),new Pve(e)}function fVe(t){const e=[];let r=null;for(const i of t.parameters)if(i.type==="color"){if(e.length&&Object.freeze(e),r)throw new V("effect:type-error","Accepts only one color",{});r=xVe(i)}else{const s=lY(i);if(Object.isFrozen(e))throw new V("effect:type-error","<length> parameters not consecutive",{lengths:e});e.push(s),e.length===3&&BM(s,i)}if(e.length<2||e.length>3)throw new V("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${e.length}}`,{lengths:e});return new Lve(e[0],e[1],e[2]||0,r||Vve("black"))}function mVe(t){let e=1,r=0,i=0;return iC(t.parameters,3),t.parameters[0]&&(e=jd(t.parameters[0])),t.parameters[1]&&(r=lY(t.parameters[1]),BM(r,t.parameters[1])),t.parameters[2]&&(i=jd(t.parameters[2])),new Rve(e,r,i)}function iC(t,e){if(t.length>e)throw new V("effect:type-error",`Function supports up to ${e} parameters, Actual: ${t.length}`,{parameters:t})}function A6(t){if(t.type==="color")return"<color>";if(t.unit){if(t.unit in aY)return"<length>";if(t.unit in oY)return"<angle>";if(t.unit==="%")return"<percentage>"}return"<double>"}function BM(t,e){if(t<0)throw new V("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:e})}function gVe(t){if(t.type!=="quantity"||t.unit!==null)throw new V("effect:type-error",`Expected <double>, Actual: ${A6(t)}`,{term:t})}function yVe(t){if(t.type!=="quantity"||t.unit!==null&&t.unit!=="%")throw new V("effect:type-error",`Expected <double> or <percentage>, Actual: ${A6(t)}`,{term:t})}const oY={deg:1,grad:.9,rad:180/Math.PI,turn:360};function _Ve(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&oY[t.unit]!=null))throw new V("effect:type-error",`Expected <angle>, Actual: ${A6(t)}`,{term:t})}const aY={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function vVe(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&aY[t.unit]!=null))throw new V("effect:type-error",`Expected <length>, Actual: ${A6(t)}`,{term:t})}function jd(t){yVe(t);const e=t.value;return BM(e,t),t.unit==="%"?.01*e:e}function bVe(t){return gVe(t),BM(t.value,t),t.value}function wVe(t){return _Ve(t),t.value*oY[t.unit]||0}function lY(t){return vVe(t),t.value*aY[t.unit]||0}function xVe(t){switch(t.colorType){case"hex":return v4e(t.value);case"named":return Vve(t.value);case"function":return EVe(t.value)}}function Vve(t){if(!oge(t))throw new V("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return _4e(t)}const TVe=/^rgba?/i,SVe=/^hsla?/i;function EVe(t){if(iC(t.parameters,4),TVe.test(t.name))return[jd(t.parameters[0]),jd(t.parameters[1]),jd(t.parameters[2]),t.parameters[3]?jd(t.parameters[3]):1];if(SVe.test(t.name))return age(bVe(t.parameters[0]),jd(t.parameters[1]),jd(t.parameters[2]),t.parameters[3]?jd(t.parameters[3]):1);throw new V("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}function cY(t,e,r){try{return AVe(t)}catch(i){r?.messages?.push(i)}return null}function uY(t,e,r,i){try{const s=CVe(t);tl(r,s,e)}catch(s){i.messages&&i.messages.push(s)}}function CVe(t){const e=zve(t);return e?aVe(e)?e.map(r=>r.toJSON()):e.map(({scale:r,effects:i})=>({scale:r,value:i.map(s=>s.toJSON())})):null}function AVe(t){if(!t||t.length===0)return null;if(OVe(t)){const e=[];for(const r of t)e.push({scale:r.scale,value:jre(r.value)});return e}return jre(t)}function OVe(t){const e=t[0];return!!e&&"scale"in e}function jre(t){if(!t||!t.length)return"";const e=[];for(const r of t){let i=[];switch(r.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":i=[Pm(r,"amount")];break;case"blur":i=[Pm(r,"radius","pt")];break;case"hue-rotate":i=[Pm(r,"angle","deg")];break;case"drop-shadow":i=[Pm(r,"xoffset","pt"),Pm(r,"yoffset","pt"),Pm(r,"blurRadius","pt"),RVe(r,"color")];break;case"bloom":i=[Pm(r,"strength"),Pm(r,"radius","pt"),Pm(r,"threshold")]}const s=`${r.type}(${i.filter(Boolean).join(" ")})`;zve(s),e.push(s)}return e.join(" ")}function Pm(t,e,r){if(t[e]==null)throw new V("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});return r?t[e]+r:""+t[e]}function RVe(t,e){if(t[e]==null)throw new V("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});const r=t[e];return`rgba(${r[0]||0}, ${r[1]||0}, ${r[2]||0}, ${r[3]/255||0})`}const Hre={read:{reader:cY},write:{allowNull:!0,writer:uY}},MVe=t=>{let e=class extends t{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return u([d({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}})],e.prototype,"blendMode",void 0),u([d({json:{read:!1,write:!1,origins:{"web-map":Hre,"portal-item":Hre}}})],e.prototype,"effect",void 0),e=u([P("esri.layers.mixins.BlendLayer")],e),e},PVe=t=>{let e=class extends t{constructor(){super(...arguments),this.customParameters=null}};return u([d({type:Object,json:{write:{overridePolicy:r=>({enabled:!!(r&&Object.keys(r).length>0)})}}})],e.prototype,"customParameters",void 0),e=u([P("esri.layers.mixins.CustomParametersMixin")],e),e},Bve=new ws.EventEmitter;function FLt(t,e,r=!1){const i=xo();return r=e==null||r,Bve.emit("apply-edits",{serviceUrl:t,layerId:e,mayReceiveServiceEdits:r,result:i.promise}),i}const Gve="esri.layers.mixins.EditBusLayer",jve=Symbol(Gve);function ULt(t){return t!=null&&typeof t=="object"&&jve in t}const Hve=t=>{var e;let r=class extends t{constructor(...i){super(...i),this[e]=!0,this.when().then(()=>{this.own([Bve.on("apply-edits",s=>{const{serviceUrl:n,layerId:o,mayReceiveServiceEdits:a,result:l}=s,c=n===this.url,h=o!=null&&this.layerId!=null&&o===this.layerId;if(!c||!h&&!a)return;const p=l.then(f=>{if(h&&(f.addedFeatures.length||f.updatedFeatures.length||f.deletedFeatures.length||f.addedAttachments.length||f.updatedAttachments.length||f.deletedAttachments.length))return this.emit("edits",K(f)),f;const m=f.editedFeatures?.find(({layerId:y})=>y===this.layerId);if(m){const{adds:y,updates:_,deletes:v}=m.editedFeatures,b={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:y?y.map(({attributes:T})=>({objectId:this.objectIdField&&T[this.objectIdField],globalId:this.globalIdField&&T[this.globalIdField]})):[],deletedFeatures:v?v.map(({attributes:T})=>({objectId:this.objectIdField&&T[this.objectIdField],globalId:this.globalIdField&&T[this.globalIdField]})):[],updatedFeatures:_?_.map(({current:{attributes:T}})=>({objectId:this.objectIdField&&T[this.objectIdField],globalId:this.globalIdField&&T[this.globalIdField]})):[],editedFeatures:K(f.editedFeatures),exceededTransferLimit:!1};return this.emit("edits",b),b}return{edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:K(f.editedFeatures),exceededTransferLimit:!1}});this.emit("apply-edits",{result:p})})])},()=>{})}};return e=jve,r=u([P(Gve)],r),r},qre={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8},IVe={milliseconds:{getter:"getMilliseconds",setter:"setMilliseconds",multiplier:1},seconds:{getter:"getSeconds",setter:"setSeconds",multiplier:1},minutes:{getter:"getMinutes",setter:"setMinutes",multiplier:1},hours:{getter:"getHours",setter:"setHours",multiplier:1},days:{getter:"getDate",setter:"setDate",multiplier:1},weeks:{getter:"getDate",setter:"setDate",multiplier:7},months:{getter:"getMonth",setter:"setMonth",multiplier:1},years:{getter:"getFullYear",setter:"setFullYear",multiplier:1},decades:{getter:"getFullYear",setter:"setFullYear",multiplier:10},centuries:{getter:"getFullYear",setter:"setFullYear",multiplier:100}};function $Ve(t,e){const r=new Date(t,e+1,1);return r.setDate(0),r.getDate()}function tw(t,e,r){const i=new Date(t.getTime());if(e&&r){const s=IVe[r],{getter:n,setter:o,multiplier:a}=s;if(r==="months"){const l=$Ve(i.getFullYear(),i.getMonth()+e);i.getDate()>l&&i.setDate(l)}i[o](i[n]()+e*a)}return i}function Wre(t,e){switch(e){case"milliseconds":return new Date(t.getTime());case"seconds":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds());case"minutes":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes());case"hours":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours());case"days":return new Date(t.getFullYear(),t.getMonth(),t.getDate());case"weeks":return new Date(t.getFullYear(),t.getMonth(),t.getDate()-t.getDay());case"months":return new Date(t.getFullYear(),t.getMonth(),1);case"years":return new Date(t.getFullYear(),0,1);case"decades":return new Date(t.getFullYear()-t.getFullYear()%10,0,1);case"centuries":return new Date(t.getFullYear()-t.getFullYear()%100,0,1);default:return new Date}}function LVe(t,e,r){return t===0?0:t*qre[e]/qre[r]}var Sd;let tu=Sd=class extends le{static get allTime(){return Xre}static get empty(){return DVe}constructor(t){super(t),this.end=null,this.start=null}readEnd(t,e){return e.end!=null?new Date(e.end):null}writeEnd(t,e){e.end=t?t.getTime():null}get isAllTime(){return this.equals(Sd.allTime)}get isEmpty(){return this.equals(Sd.empty)}readStart(t,e){return e.start!=null?new Date(e.start):null}writeStart(t,e){e.start=t?t.getTime():null}clone(){return new Sd({end:this.end,start:this.start})}equals(t){if(!t)return!1;const e=this.start!=null?this.start.getTime():this.start,r=this.end!=null?this.end.getTime():this.end,i=t.start!=null?t.start.getTime():t.start,s=t.end!=null?t.end.getTime():t.end;return e===i&&r===s}expandTo(t){if(this.isEmpty||this.isAllTime)return this.clone();const e=vc(this.start,i=>Wre(i,t)),r=vc(this.end,i=>{const s=Wre(i,t);return i.getTime()===s.getTime()?s:tw(s,1,t)});return new Sd({start:e,end:r})}intersection(t){if(!t)return this.clone();if(this.isEmpty||t.isEmpty)return Sd.empty;if(this.isAllTime)return t.clone();if(t.isAllTime)return this.clone();const e=this.start?.getTime()??-1/0,r=this.end?.getTime()??1/0,i=t.start?.getTime()??-1/0,s=t.end?.getTime()??1/0;let n,o;if(i>=e&&i<=r?n=i:e>=i&&e<=s&&(n=e),r>=i&&r<=s?o=r:s>=e&&s<=r&&(o=s),n!=null&&o!=null&&!isNaN(n)&&!isNaN(o)){const a=new Sd;return a.start=n===-1/0?null:new Date(n),a.end=o===1/0?null:new Date(o),a}return Sd.empty}offset(t,e){if(this.isEmpty||this.isAllTime)return this.clone();const r=new Sd,{start:i,end:s}=this;return i!=null&&(r.start=tw(i,t,e)),s!=null&&(r.end=tw(s,t,e)),r}union(t){if(!t||t.isEmpty)return this.clone();if(this.isEmpty)return t.clone();if(this.isAllTime||t.isAllTime)return Xre.clone();const e=this.start!=null&&t.start!=null?new Date(Math.min(this.start.getTime(),t.start.getTime())):null,r=this.end!=null&&t.end!=null?new Date(Math.max(this.end.getTime(),t.end.getTime())):null;return new Sd({start:e,end:r})}};u([d({type:Date,json:{write:{allowNull:!0}}})],tu.prototype,"end",void 0),u([Ae("end")],tu.prototype,"readEnd",null),u([ke("end")],tu.prototype,"writeEnd",null),u([d({readOnly:!0,json:{read:!1}})],tu.prototype,"isAllTime",null),u([d({readOnly:!0,json:{read:!1}})],tu.prototype,"isEmpty",null),u([d({type:Date,json:{write:{allowNull:!0}}})],tu.prototype,"start",void 0),u([Ae("start")],tu.prototype,"readStart",null),u([ke("start")],tu.prototype,"writeStart",null),tu=Sd=u([P("esri.TimeExtent")],tu);const Xre=new tu,DVe=new tu({start:void 0,end:void 0}),Tm=tu;var P7;let eS=P7=class extends le{constructor(t){super(t),this.type="map-layer"}clone(){const{mapLayerId:t,gdbVersion:e}=this;return new P7({mapLayerId:t,gdbVersion:e})}};u([it({mapLayer:"map-layer"})],eS.prototype,"type",void 0),u([d({type:Qi,json:{write:!0}})],eS.prototype,"mapLayerId",void 0),u([d({type:String,json:{write:!0}})],eS.prototype,"gdbVersion",void 0),eS=P7=u([P("esri.layers.support.source.MapLayerSource")],eS);var I7;let ug=I7=class extends le{constructor(t){super(t),this.type="query-table"}clone(){const{workspaceId:t,query:e,oidFields:r,spatialReference:i,geometryType:s}=this,n={workspaceId:t,query:e,oidFields:r,spatialReference:i?.clone()??void 0,geometryType:s};return new I7(n)}};u([it({queryTable:"query-table"})],ug.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],ug.prototype,"workspaceId",void 0),u([d({type:String,json:{write:!0}})],ug.prototype,"query",void 0),u([d({type:String,json:{write:!0}})],ug.prototype,"oidFields",void 0),u([d({type:je,json:{write:!0}})],ug.prototype,"spatialReference",void 0),u([it(Jge)],ug.prototype,"geometryType",void 0),ug=I7=u([P("esri.layers.support.source.QueryTableDataSource")],ug);var $7;let tS=$7=class extends le{constructor(t){super(t),this.type="raster"}clone(){const{workspaceId:t,dataSourceName:e}=this;return new $7({workspaceId:t,dataSourceName:e})}};u([it({raster:"raster"})],tS.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],tS.prototype,"dataSourceName",void 0),u([d({type:String,json:{write:!0}})],tS.prototype,"workspaceId",void 0),tS=$7=u([P("esri.layers.support.source.RasterDataSource")],tS);var L7;let H1=L7=class extends le{constructor(t){super(t),this.type="table"}clone(){const{workspaceId:t,gdbVersion:e,dataSourceName:r}=this;return new L7({workspaceId:t,gdbVersion:e,dataSourceName:r})}};u([it({table:"table"})],H1.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],H1.prototype,"workspaceId",void 0),u([d({type:String,json:{write:!0}})],H1.prototype,"gdbVersion",void 0),u([d({type:String,json:{write:!0}})],H1.prototype,"dataSourceName",void 0),H1=L7=u([P("esri.layers.support.source.TableDataSource")],H1);var D7,N7;const NVe=il()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let Xc=D7=class extends le{constructor(t){super(t),this.type="join-table"}readLeftTableSource(t,e,r){return Zre()(t,e,r)}castLeftTableSource(t){return bp(F7(),t)}readRightTableSource(t,e,r){return Zre()(t,e,r)}castRightTableSource(t){return bp(F7(),t)}clone(){const{leftTableKey:t,rightTableKey:e,leftTableSource:r,rightTableSource:i,joinType:s}=this,n={leftTableKey:t,rightTableKey:e,leftTableSource:r?.clone()??void 0,rightTableSource:i?.clone()??void 0,joinType:s};return new D7(n)}};u([it({joinTable:"join-table"})],Xc.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Xc.prototype,"leftTableKey",void 0),u([d({type:String,json:{write:!0}})],Xc.prototype,"rightTableKey",void 0),u([d({json:{write:!0}})],Xc.prototype,"leftTableSource",void 0),u([Ae("leftTableSource")],Xc.prototype,"readLeftTableSource",null),u([wr("leftTableSource")],Xc.prototype,"castLeftTableSource",null),u([d({json:{write:!0}})],Xc.prototype,"rightTableSource",void 0),u([Ae("rightTableSource")],Xc.prototype,"readRightTableSource",null),u([wr("rightTableSource")],Xc.prototype,"castRightTableSource",null),u([it(NVe)],Xc.prototype,"joinType",void 0),Xc=D7=u([P("esri.layers.support.source.JoinTableDataSource")],Xc);let Y8=null;function Zre(){return Y8||(Y8=BE({types:F7()})),Y8}let J8=null;function F7(){return J8||(J8={key:"type",base:null,typeMap:{"data-layer":Hd,"map-layer":eS}}),J8}const FVe={key:"type",base:null,typeMap:{"join-table":Xc,"query-table":ug,raster:tS,table:H1}};let Hd=N7=class extends le{constructor(t){super(t),this.type="data-layer"}clone(){const{fields:t,dataSource:e}=this;return new N7({fields:t,dataSource:e})}};u([it({dataLayer:"data-layer"})],Hd.prototype,"type",void 0),u([d({type:[b6],json:{write:!0}})],Hd.prototype,"fields",void 0),u([d({types:FVe,json:{write:!0}})],Hd.prototype,"dataSource",void 0),Hd=N7=u([P("esri.layers.support.source.DataLayerSource")],Hd),Hd.from=vs(Hd);let q1=class extends ji(le){constructor(e){super(e),this.onFields=null,this.operator=null,this.searchTerm=null,this.searchType=null}};u([d({type:[String],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.onFields!=null&&this.onFields.length>0}}}}})],q1.prototype,"onFields",void 0),u([d({type:String,json:{write:!0}})],q1.prototype,"operator",void 0),u([d({type:String,json:{write:!0}})],q1.prototype,"searchTerm",void 0),u([d({type:String,json:{write:!0}})],q1.prototype,"searchType",void 0),q1=u([P("esri.rest.support.FullTextSearch")],q1);const qve=q1;var U7;const Yre=new $r({upperLeft:"upper-left",lowerLeft:"lower-left"});let W1=U7=class extends le{constructor(t){super(t),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new U7(K({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};u([d({type:ur,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],W1.prototype,"extent",void 0),u([d({type:["view","edit"],json:{write:!0}})],W1.prototype,"mode",void 0),u([d({type:String,json:{read:Yre.read,write:Yre.write}})],W1.prototype,"originPosition",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],W1.prototype,"tolerance",void 0),W1=U7=u([P("esri.rest.support.QuantizationParameters")],W1);const UVe=W1;var k7;const Jre=new $r({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let Ed=k7=class extends le{constructor(t){super(t),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(t,e){this.statisticType!=="percentile-continuous"&&this.statisticType!=="percentile-discrete"||(e.statisticParameters=K(t))}clone(){return new k7({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:K(this.statisticParameters)})}};u([d({type:Number,json:{write:!0}})],Ed.prototype,"maxPointCount",void 0),u([d({type:Number,json:{write:!0}})],Ed.prototype,"maxRecordCount",void 0),u([d({type:Number,json:{write:!0}})],Ed.prototype,"maxVertexCount",void 0),u([d({type:String,json:{write:!0}})],Ed.prototype,"onStatisticField",void 0),u([d({type:String,json:{write:!0}})],Ed.prototype,"outStatisticFieldName",void 0),u([d({type:String,json:{read:{source:"statisticType",reader:Jre.read},write:{target:"statisticType",writer:Jre.write}}})],Ed.prototype,"statisticType",void 0),u([d({type:Object})],Ed.prototype,"statisticParameters",void 0),u([ke("statisticParameters")],Ed.prototype,"writeStatisticParameters",null),Ed=k7=u([P("esri.rest.support.StatisticDefinition")],Ed);const kVe=Ed;var f2;const zVe=new $r({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),VVe=new $r({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let $t=f2=class extends le{static from(t){return mw(f2,t)}constructor(t){super(t),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.fullText=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}castDatumTransformation(t){return typeof t=="number"||typeof t=="object"?t:null}writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeParameterValues(t,e){if(t){const r={};for(const i in t){const s=t[i];Array.isArray(s)?r[i]=s.map(n=>n instanceof Date?n.getTime():n):s instanceof Date?r[i]=s.getTime():r[i]=s}e.parameterValues=r}}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,e.where="1=1"}writeWhere(t,e){e.where=t||"1=1"}clone(){return new f2(K({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,fullText:this.fullText,formatOf3DObjects:this.formatOf3DObjects,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:this.historicMoment!=null?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};$t.MAX_MAX_RECORD_COUNT_FACTOR=5,u([d({json:{write:!0}})],$t.prototype,"aggregateIds",void 0),u([d({type:Boolean,json:{write:!0}})],$t.prototype,"cacheHint",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],$t.prototype,"compactGeometryEnabled",void 0),u([d({json:{write:!0}})],$t.prototype,"datumTransformation",void 0),u([wr("datumTransformation")],$t.prototype,"castDatumTransformation",null),u([d({type:Boolean,json:{default:!1,write:!0}})],$t.prototype,"defaultSpatialReferenceEnabled",void 0),u([d({type:Number,json:{write:{overridePolicy:t=>({enabled:t>0})}}})],$t.prototype,"distance",void 0),u([d({type:Hd,json:{write:!0}})],$t.prototype,"dynamicDataSource",void 0),u([d({type:String,json:{write:!0}})],$t.prototype,"formatOf3DObjects",void 0),u([d({type:[qve],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.fullText!=null&&this.fullText.length>0}}}}})],$t.prototype,"fullText",void 0),u([d({type:String,json:{write:!0}})],$t.prototype,"gdbVersion",void 0),u([d({types:ix,json:{read:Z_,write:!0}})],$t.prototype,"geometry",void 0),u([d({type:Number,json:{write:!0}})],$t.prototype,"geometryPrecision",void 0),u([d({type:[String],json:{write:!0}})],$t.prototype,"groupByFieldsForStatistics",void 0),u([d({type:String,json:{write:!0}})],$t.prototype,"having",void 0),u([d({type:Date})],$t.prototype,"historicMoment",void 0),u([ke("historicMoment")],$t.prototype,"writeHistoricMoment",null),u([d({type:Number,json:{write:!0}})],$t.prototype,"maxAllowableOffset",void 0),u([d({type:Number,cast:t=>t<1?1:t>f2.MAX_MAX_RECORD_COUNT_FACTOR?f2.MAX_MAX_RECORD_COUNT_FACTOR:t,json:{write:{overridePolicy:t=>({enabled:t>1})}}})],$t.prototype,"maxRecordCountFactor",void 0),u([d({type:["xyFootprint"],json:{write:!0}})],$t.prototype,"multipatchOption",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],$t.prototype,"num",void 0),u([d({json:{write:!0}})],$t.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],$t.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],$t.prototype,"outFields",void 0),u([d({type:je,json:{name:"outSR",write:!0}})],$t.prototype,"outSpatialReference",void 0),u([d({type:[kVe],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.outStatistics!=null&&this.outStatistics.length>0}}}}})],$t.prototype,"outStatistics",void 0),u([d({json:{write:!0}})],$t.prototype,"parameterValues",void 0),u([ke("parameterValues")],$t.prototype,"writeParameterValues",null),u([d({type:Ke,json:{write:!0}})],$t.prototype,"pixelSize",void 0),u([d({type:UVe,json:{write:!0}})],$t.prototype,"quantizationParameters",void 0),u([d({type:[Object],json:{write:!0}})],$t.prototype,"rangeValues",void 0),u([d({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:this.spatialRelationship==="relation"}}}}})],$t.prototype,"relationParameter",void 0),u([d({type:String,json:{write:!0}})],$t.prototype,"resultType",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],$t.prototype,"returnCentroid",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],$t.prototype,"returnDistinctValues",void 0),u([d({type:Boolean,json:{default:!0,write:!0}})],$t.prototype,"returnExceededLimitFeatures",void 0),u([d({type:Boolean,json:{write:!0}})],$t.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],$t.prototype,"returnQueryGeometry",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],$t.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],$t.prototype,"returnZ",void 0),u([d({type:je,json:{write:!0}})],$t.prototype,"sourceSpatialReference",void 0),u([it(zVe,{ignoreUnknown:!1,name:"spatialRel"})],$t.prototype,"spatialRelationship",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],$t.prototype,"start",void 0),u([ke("start"),ke("num")],$t.prototype,"writeStart",null),u([d({type:String,json:{write:!0}})],$t.prototype,"sqlFormat",void 0),u([d({type:String,json:{write:!0}})],$t.prototype,"text",void 0),u([d({type:Tm,json:{write:!0}})],$t.prototype,"timeExtent",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],$t.prototype,"timeReferenceUnknownClient",void 0),u([it(VVe,{ignoreUnknown:!1}),d({json:{write:{overridePolicy(t){return{enabled:!!t&&this.distance!=null&&this.distance>0}}}}})],$t.prototype,"units",void 0),u([d({type:String,json:{write:{overridePolicy(t){return{enabled:t!=null||this.start!=null&&this.start>0}}}}})],$t.prototype,"where",void 0),u([ke("where")],$t.prototype,"writeWhere",null),$t=f2=u([P("esri.rest.support.Query")],$t);const Ty=$t;var z7;const Q8=new $r({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),K8=new $r({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let df=z7=class extends le{constructor(t){super(t),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(t={}){const{where:e,geometry:r,spatialRelationship:i,timeExtent:s,objectIds:n,units:o,distance:a}=this;return new Ty({geometry:K(r),objectIds:K(n),spatialRelationship:i,timeExtent:K(s),where:e,units:o,distance:a,...t})}clone(){const{where:t,geometry:e,spatialRelationship:r,timeExtent:i,objectIds:s,units:n,distance:o}=this;return new z7({geometry:K(e),objectIds:K(s),spatialRelationship:r,timeExtent:K(i),where:t,units:n,distance:o})}};u([d({type:String,json:{write:!0}})],df.prototype,"where",void 0),u([d({types:ix,json:{write:!0}})],df.prototype,"geometry",void 0),u([d({type:Q8.apiValues,json:{name:"spatialRel",read:{reader:Q8.read},write:{allowNull:!1,writer:Q8.write,overridePolicy(){return{enabled:this.geometry!=null}}}}})],df.prototype,"spatialRelationship",void 0),u([d({type:Number,json:{write:{overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],df.prototype,"distance",void 0),u([d({type:[Number],json:{write:!0}})],df.prototype,"objectIds",void 0),u([d({type:K8.apiValues,json:{read:K8.read,write:{writer:K8.write,overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],df.prototype,"units",void 0),u([d({type:Tm,json:{write:!0}})],df.prototype,"timeExtent",void 0),df=z7=u([P("esri.layers.support.FeatureFilter")],df);const BVe=df;var V7;const Qre={read:{reader:cY},write:{writer:uY,overridePolicy(){return{allowNull:this.excludedEffect!=null,isRequired:this.excludedEffect==null}}}},Kre={read:{reader:cY},write:{writer:uY,overridePolicy(){return{allowNull:this.includedEffect!=null,isRequired:this.includedEffect==null}}}},eie={name:"showExcludedLabels",default:!0};let X1=V7=class extends le{constructor(t){super(t),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(t,e){const r=super.write(t,e);if(e?.origin){if(r.filter){const i=Object.keys(r.filter);if(i.length>1||i[0]!=="where")return e.messages?.push(new V("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:e.layer,effect:this})),null}if("showExcludedLabels"in r)return e.messages?.push(new V("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:e.layer,effect:this})),null}return r}clone(){return new V7({filter:this.filter!=null?this.filter.clone():null,includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};u([d({type:BVe,json:{write:{allowNull:!0,writer(t,e,r,i){const s=t?.write({},i);s&&Object.keys(s).length!==0?tl(r,s,e):tl(r,null,e)}}}})],X1.prototype,"filter",void 0),u([d({json:{write:!0,origins:{"web-map":Qre,"portal-item":Qre}}})],X1.prototype,"includedEffect",void 0),u([d({json:{write:!0,origins:{"web-map":Kre,"portal-item":Kre}}})],X1.prototype,"excludedEffect",void 0),u([d({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":eie,"portal-item":eie}}})],X1.prototype,"excludedLabelsVisible",void 0),X1=V7=u([P("esri.layers.support.FeatureEffect")],X1);const GVe=X1,tie={write:{allowNull:!0}},jVe=t=>{let e=class extends t{constructor(){super(...arguments),this.featureEffect=null}};return u([d({type:GVe,json:{origins:{"web-map":tie,"portal-item":tie}}})],e.prototype,"featureEffect",void 0),e=u([P("esri.layers.mixins.FeatureEffectLayer")],e),e};var m3;const $4=il()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),Wve=$4.jsonValues.slice();uR(Wve,"orthometric");const RO=il()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let Cd=m3=class extends le{constructor(t){super(t),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(t,e,r){return $4.write(t,e,r)}readHeightModel(t,e,r){return $4.read(t)||(r&&r.messages&&r.messages.push(HVe(t,{context:r})),null)}readHeightUnit(t,e,r){return RO.read(t)||(r&&r.messages&&r.messages.push(rie(t,{context:r})),null)}readHeightUnitService(t,e,r){return Ume(t)||RO.read(t)||(r&&r.messages&&r.messages.push(rie(t,{context:r})),null)}readVertCRS(t,e){return e.vertCRS||e.ellipsoid||e.geoid}clone(){return new m3({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(t){return!!t&&(this===t||this.heightModel===t.heightModel&&this.heightUnit===t.heightUnit&&this.vertCRS===t.vertCRS)}static deriveUnitFromSR(t,e){const r=BDe(e);return new m3({heightModel:t.heightModel,heightUnit:r,vertCRS:t.vertCRS})}write(t,e){return e={origin:"web-scene",...e},super.write(t,e)}static fromJSON(t){if(!t)return null;const e=new m3;return e.read(t,{origin:"web-scene"}),e}};function rie(t,e){return new Nh("height-unit:unsupported",`Height unit of value '${t}' is not supported`,e)}function HVe(t,e){return new Nh("height-model:unsupported",`Height model of value '${t}' is not supported`,e)}u([d({type:$4.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:Wve,default:"ellipsoidal"}}}})],Cd.prototype,"heightModel",void 0),u([ke("web-scene","heightModel")],Cd.prototype,"writeHeightModel",null),u([Ae(["web-scene","service"],"heightModel")],Cd.prototype,"readHeightModel",null),u([d({type:RO.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:RO.jsonValues,write:RO.write}}}})],Cd.prototype,"heightUnit",void 0),u([Ae("web-scene","heightUnit")],Cd.prototype,"readHeightUnit",null),u([Ae("service","heightUnit")],Cd.prototype,"readHeightUnitService",null),u([d({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],Cd.prototype,"vertCRS",void 0),u([Ae("service","vertCRS",["vertCRS","ellipsoid","geoid"])],Cd.prototype,"readVertCRS",null),Cd=m3=u([P("esri.geometry.HeightModelInfo")],Cd);const ux=Cd;function qVe(t){if(!t)return t;const{start:e,end:r}=t;return new Tm({start:e!=null?tw(e,-e.getTimezoneOffset(),"minutes"):e,end:r!=null?tw(r,-r.getTimezoneOffset(),"minutes"):r})}function WVe(t){if(!t)return t;const{start:e,end:r}=t;return new Tm({start:e!=null?tw(e,e.getTimezoneOffset(),"minutes"):e,end:r!=null?tw(r,r.getTimezoneOffset(),"minutes"):r})}var B7;let g3=B7=class extends le{constructor(t){super(t)}async collectRequiredFields(t,e){return Dl(t,e,this.expression)}clone(){return new B7({expression:this.expression,title:this.title})}equals(t){return this.expression===t.expression&&this.title===t.title}};u([d({type:String,json:{write:!0}})],g3.prototype,"expression",void 0),u([d({type:String,json:{write:!0}})],g3.prototype,"title",void 0),g3=B7=u([P("esri.layers.support.FeatureExpressionInfo")],g3);const iie=g3;function XVe(t){return!!t&&Q2[t]!=null}function ZVe(t){return 1/(Q2[t]||1)}function YVe(){const t=Object.keys(Q2);return t.sort(),t}const JVe=YVe();var G7;const tI=il()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),sie=new $r({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let hg=G7=class extends le{constructor(t){super(t),this.offset=null}readFeatureExpressionInfo(t,e){return t??(e.featureExpression&&e.featureExpression.value===0?{expression:"0"}:void 0)}writeFeatureExpressionInfo(t,e,r,i){e[r]=t.write({},i),t.expression==="0"&&(e.featureExpression={value:0})}get mode(){const{offset:t,featureExpressionInfo:e}=this;return this._isOverridden("mode")?this._get("mode"):t!=null||e?"relative-to-ground":"on-the-ground"}set mode(t){this._override("mode",t)}set unit(t){this._set("unit",t)}write(t,e){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(t,e):null}clone(){return new G7({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(t){return this.mode===t.mode&&this.offset===t.offset&&this.unit===t.unit&&IIe(this.featureExpressionInfo,t.featureExpressionInfo)}};u([d({type:iie,json:{write:!0}})],hg.prototype,"featureExpressionInfo",void 0),u([Ae("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],hg.prototype,"readFeatureExpressionInfo",null),u([ke("featureExpressionInfo",{featureExpressionInfo:{type:iie},"featureExpression.value":{type:[0]}})],hg.prototype,"writeFeatureExpressionInfo",null),u([d({type:tI.apiValues,nonNullable:!0,json:{type:tI.jsonValues,read:tI.read,write:{writer:tI.write,isRequired:!0}}})],hg.prototype,"mode",null),u([d({type:Number,json:{write:!0}})],hg.prototype,"offset",void 0),u([d({type:JVe,json:{type:String,read:sie.read,write:sie.write}})],hg.prototype,"unit",null),hg=G7=u([P("esri.layers.support.ElevationInfo")],hg);const QVe=hg,Xve={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:!0}},O6={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(t,e)=>!e.disablePopup},write:{enabled:!0,writer(t,e,r){e[r]=!t}}}},R6={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:!0}},Zve={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:J_}}},Yve={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},Jve={value:null,type:QVe,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function zLt(t){return{type:t,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const Qve={write:!0,read:!0},j7={type:Number,json:{origins:{"web-document":Qve,"portal-item":{write:!0}}}},KVe={...j7,json:{...j7.json,origins:{"web-document":{...Qve,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(t,e,r)=>r&&r.origin!=="service"||!e.drawingInfo||e.drawingInfo.transparency===void 0?e.layerDefinition&&e.layerDefinition.drawingInfo&&e.layerDefinition.drawingInfo.transparency!==void 0?G2(e.layerDefinition.drawingInfo.transparency):void 0:G2(e.drawingInfo.transparency)}}},VLt={type:Tm,readOnly:!0,get(){if(!this.layer?.timeInfo)return null;const{datesInUnknownTimezone:t,timeOffset:e,useViewTime:r}=this.layer,i=this.view?.timeExtent;let s=this.layer.timeExtent;t&&(s=WVe(s));let n=r?i&&s?i.intersection(s):i||s:s;if(!n||n.isEmpty||n.isAllTime)return n;e&&(n=n.offset(-e.value,e.unit)),t&&(n=qVe(n));const o=this._get("timeExtent");return n.equals(o)?o:n}},BLt={type:ur,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(t,e)=>{const r=ur.fromJSON(t);return e.spatialReference!=null&&typeof e.spatialReference=="object"&&(r.spatialReference=je.fromJSON(e.spatialReference)),r}}}},read:!1}},Kve={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},eBe={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}},tBe={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}},e1e={json:{write:{ignoreOrigin:!0},origins:{"web-map":{read:!1,write:!1}}}},nie=new Map([["AUS Central Standard Time","Australia/Darwin"],["AUS Eastern Standard Time","Australia/Sydney"],["Afghanistan Standard Time","Asia/Kabul"],["Alaskan Standard Time","America/Anchorage"],["Aleutian Standard Time","America/Adak"],["Altai Standard Time","Asia/Barnaul"],["Arab Standard Time","Asia/Riyadh"],["Arabian Standard Time","Asia/Dubai"],["Arabic Standard Time","Asia/Baghdad"],["Argentina Standard Time","America/Buenos_Aires"],["Astrakhan Standard Time","Europe/Astrakhan"],["Atlantic Standard Time","America/Halifax"],["Aus Central W. Standard Time","Australia/Eucla"],["Azerbaijan Standard Time","Asia/Baku"],["Azores Standard Time","Atlantic/Azores"],["Bahia Standard Time","America/Bahia"],["Bangladesh Standard Time","Asia/Dhaka"],["Belarus Standard Time","Europe/Minsk"],["Bougainville Standard Time","Pacific/Bougainville"],["Canada Central Standard Time","America/Regina"],["Cape Verde Standard Time","Atlantic/Cape_Verde"],["Caucasus Standard Time","Asia/Yerevan"],["Cen. Australia Standard Time","Australia/Adelaide"],["Central America Standard Time","America/Guatemala"],["Central Asia Standard Time","Asia/Almaty"],["Central Brazilian Standard Time","America/Cuiaba"],["Central Europe Standard Time","Europe/Budapest"],["Central European Standard Time","Europe/Warsaw"],["Central Pacific Standard Time","Pacific/Guadalcanal"],["Central Standard Time","America/Chicago"],["Central Standard Time (Mexico)","America/Mexico_City"],["Chatham Islands Standard Time","Pacific/Chatham"],["China Standard Time","Asia/Shanghai"],["Cuba Standard Time","America/Havana"],["Dateline Standard Time","Etc/GMT+12"],["E. Africa Standard Time","Africa/Nairobi"],["E. Australia Standard Time","Australia/Brisbane"],["E. Europe Standard Time","Europe/Chisinau"],["E. South America Standard Time","America/Sao_Paulo"],["Easter Island Standard Time","Pacific/Easter"],["Eastern Standard Time","America/New_York"],["Eastern Standard Time (Mexico)","America/Cancun"],["Egypt Standard Time","Africa/Cairo"],["Ekaterinburg Standard Time","Asia/Yekaterinburg"],["FLE Standard Time","Europe/Kiev"],["Fiji Standard Time","Pacific/Fiji"],["GMT Standard Time","Europe/London"],["GTB Standard Time","Europe/Bucharest"],["Georgian Standard Time","Asia/Tbilisi"],["Greenland Standard Time","America/Godthab"],["Greenwich Standard Time","Atlantic/Reykjavik"],["Haiti Standard Time","America/Port-au-Prince"],["Hawaiian Standard Time","Pacific/Honolulu"],["India Standard Time","Asia/Calcutta"],["Iran Standard Time","Asia/Tehran"],["Israel Standard Time","Asia/Jerusalem"],["Jordan Standard Time","Asia/Amman"],["Kaliningrad Standard Time","Europe/Kaliningrad"],["Korea Standard Time","Asia/Seoul"],["Libya Standard Time","Africa/Tripoli"],["Line Islands Standard Time","Pacific/Kiritimati"],["Lord Howe Standard Time","Australia/Lord_Howe"],["Magadan Standard Time","Asia/Magadan"],["Magallanes Standard Time","America/Punta_Arenas"],["Marquesas Standard Time","Pacific/Marquesas"],["Mauritius Standard Time","Indian/Mauritius"],["Middle East Standard Time","Asia/Beirut"],["Montevideo Standard Time","America/Montevideo"],["Morocco Standard Time","Africa/Casablanca"],["Mountain Standard Time","America/Denver"],["Mountain Standard Time (Mexico)","America/Mazatlan"],["Myanmar Standard Time","Asia/Rangoon"],["N. Central Asia Standard Time","Asia/Novosibirsk"],["Namibia Standard Time","Africa/Windhoek"],["Nepal Standard Time","Asia/Katmandu"],["New Zealand Standard Time","Pacific/Auckland"],["Newfoundland Standard Time","America/St_Johns"],["Norfolk Standard Time","Pacific/Norfolk"],["North Asia East Standard Time","Asia/Irkutsk"],["North Asia Standard Time","Asia/Krasnoyarsk"],["North Korea Standard Time","Asia/Pyongyang"],["Omsk Standard Time","Asia/Omsk"],["Pacific SA Standard Time","America/Santiago"],["Pacific Standard Time","America/Los_Angeles"],["Pacific Standard Time (Mexico)","America/Tijuana"],["Pakistan Standard Time","Asia/Karachi"],["Paraguay Standard Time","America/Asuncion"],["Qyzylorda Standard Time","Asia/Qyzylorda"],["Romance Standard Time","Europe/Paris"],["Russia Time Zone 10","Asia/Srednekolymsk"],["Russia Time Zone 11","Asia/Kamchatka"],["Russia Time Zone 3","Europe/Samara"],["Russian Standard Time","Europe/Moscow"],["SA Eastern Standard Time","America/Cayenne"],["SA Pacific Standard Time","America/Bogota"],["SA Western Standard Time","America/La_Paz"],["SE Asia Standard Time","Asia/Bangkok"],["Saint Pierre Standard Time","America/Miquelon"],["Sakhalin Standard Time","Asia/Sakhalin"],["Samoa Standard Time","Pacific/Apia"],["Sao Tome Standard Time","Africa/Sao_Tome"],["Saratov Standard Time","Europe/Saratov"],["Singapore Standard Time","Asia/Singapore"],["South Africa Standard Time","Africa/Johannesburg"],["South Sudan Standard Time","Africa/Juba"],["Sri Lanka Standard Time","Asia/Colombo"],["Sudan Standard Time","Africa/Khartoum"],["Syria Standard Time","Asia/Damascus"],["Taipei Standard Time","Asia/Taipei"],["Tasmania Standard Time","Australia/Hobart"],["Tocantins Standard Time","America/Araguaina"],["Tokyo Standard Time","Asia/Tokyo"],["Tomsk Standard Time","Asia/Tomsk"],["Tonga Standard Time","Pacific/Tongatapu"],["Transbaikal Standard Time","Asia/Chita"],["Turkey Standard Time","Europe/Istanbul"],["Turks And Caicos Standard Time","America/Grand_Turk"],["US Eastern Standard Time","America/Indianapolis"],["US Mountain Standard Time","America/Phoenix"],["UTC","Etc/GMT"],["UTC+01","Etc/GMT-1"],["UTC+02","Etc/GMT-2"],["UTC+03","Etc/GMT-3"],["UTC+04","Etc/GMT-4"],["UTC+05","Etc/GMT-5"],["UTC+06","Etc/GMT-6"],["UTC+07","Etc/GMT-7"],["UTC+08","Etc/GMT-8"],["UTC+09","Etc/GMT-9"],["UTC+10","Etc/GMT-10"],["UTC+11","Etc/GMT-11"],["UTC+12","Etc/GMT-12"],["UTC+13","Etc/GMT-13"],["UTC+14","Etc/GMT-14"],["UTC-01","Etc/GMT+1"],["UTC-02","Etc/GMT+2"],["UTC-03","Etc/GMT+3"],["UTC-04","Etc/GMT+4"],["UTC-05","Etc/GMT+5"],["UTC-06","Etc/GMT+6"],["UTC-07","Etc/GMT+7"],["UTC-08","Etc/GMT+8"],["UTC-09","Etc/GMT+9"],["UTC-10","Etc/GMT+10"],["UTC-11","Etc/GMT+11"],["UTC-12","Etc/GMT+12"],["Ulaanbaatar Standard Time","Asia/Ulaanbaatar"],["Venezuela Standard Time","America/Caracas"],["Vladivostok Standard Time","Asia/Vladivostok"],["Volgograd Standard Time","Europe/Volgograd"],["W. Australia Standard Time","Australia/Perth"],["W. Central Africa Standard Time","Africa/Lagos"],["W. Europe Standard Time","Europe/Berlin"],["W. Mongolia Standard Time","Asia/Hovd"],["West Asia Standard Time","Asia/Tashkent"],["West Bank Standard Time","Asia/Hebron"],["West Pacific Standard Time","Pacific/Port_Moresby"],["Yakutsk Standard Time","Asia/Yakutsk"],["Yukon Standard Time","America/Whitehorse"]]);function rBe(t,e="system"){if(!t||!nie.has(t.timeZone))return e;const r=nie.get(t.timeZone);return sBe(t.timeZone)||t.respectsDaylightSaving?r:iBe(r)}function iBe(t){const e=br.local().setZone(t),r=Math.min(e.set({month:1,day:1}).offset,e.set({month:5}).offset);return r===0?"Etc/UTC":`Etc/GMT${Qa.instance(-r).formatOffset(0,"narrow")}`}function sBe(t){return t.startsWith("UTC")}let N0=class extends ji(le){constructor(e){super(e),this.legacy=null,this.timeZone="system"}readLegacy(e,r){const{timeZone:i,respectsDaylightSaving:s}=r;return{timeZone:i,respectsDaylightSaving:s}}readTimeZone(e,r){return"timeZoneIANA"in r?r.timeZoneIANA:rBe(r)}writeTimeZone(e,r){r.timeZoneIANA=e}equals(e){return e!=null&&this.timeZone!=null&&e.timeZone!=null&&this.timeZone===e.timeZone}};u([d()],N0.prototype,"legacy",void 0),u([Ae("legacy",["timeZone"])],N0.prototype,"readLegacy",null),u([d({type:String,nonNullable:!0})],N0.prototype,"timeZone",void 0),u([Ae("timeZone",["timeZone","timeZoneIANA","respectsDaylightSaving"])],N0.prototype,"readTimeZone",null),u([ke("timeZone")],N0.prototype,"writeTimeZone",null),N0=u([P("esri.time.TimeReference")],N0);const rE=N0;let dg=class extends ji(le){constructor(e){super(e),this.creatorField=null,this.creationDateField=null,this.editorField=null,this.editDateField=null,this.realm=null,this.dateFieldsTimeReference=null}};u([d()],dg.prototype,"creatorField",void 0),u([d()],dg.prototype,"creationDateField",void 0),u([d()],dg.prototype,"editorField",void 0),u([d()],dg.prototype,"editDateField",void 0),u([d()],dg.prototype,"realm",void 0),u([d({type:rE})],dg.prototype,"dateFieldsTimeReference",void 0),dg=u([P("esri.layers.support.EditFieldsInfo")],dg);const nBe=dg;let Ef=class extends ji(le){constructor(e){super(e)}};u([d({constructOnly:!0,json:{write:!0}})],Ef.prototype,"name",void 0),u([d({constructOnly:!0,json:{write:!0}})],Ef.prototype,"fields",void 0),u([d({constructOnly:!0,json:{write:!0}})],Ef.prototype,"isAscending",void 0),u([d({constructOnly:!0,json:{write:!0}})],Ef.prototype,"indexType",void 0),u([d({constructOnly:!0,json:{write:!0}})],Ef.prototype,"isUnique",void 0),u([d({constructOnly:!0,json:{write:!0}})],Ef.prototype,"description",void 0),Ef=u([P("esri.layers.support.FeatureIndex")],Ef);var H7;let Mo=H7=class extends le{constructor(t){super(t),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new H7(K({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};u([d({type:[String],json:{write:!0}})],Mo.prototype,"attachmentTypes",void 0),u([d({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],Mo.prototype,"attachmentsWhere",void 0),u([d({type:Boolean,json:{write:!0}})],Mo.prototype,"cacheHint",void 0),u([d({type:[String],json:{write:!0}})],Mo.prototype,"keywords",void 0),u([d({type:[Number],json:{write:!0}})],Mo.prototype,"globalIds",void 0),u([d({json:{write:!0}})],Mo.prototype,"name",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],Mo.prototype,"num",void 0),u([d({type:[Number],json:{write:!0}})],Mo.prototype,"objectIds",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Mo.prototype,"returnMetadata",void 0),u([d({type:[Number],json:{write:!0}})],Mo.prototype,"size",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],Mo.prototype,"start",void 0),u([ke("start"),ke("num")],Mo.prototype,"writeStart",null),u([d({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],Mo.prototype,"where",void 0),Mo=H7=u([P("esri.rest.support.AttachmentQuery")],Mo),Mo.from=vs(Mo);const oBe=Mo;var q7;let ks=q7=class extends le{constructor(t){super(t),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,this.start>0&&this.where==null&&(e.definitionExpression="1=1")}clone(){return new q7(K({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};u([d({type:Boolean,json:{write:!0}})],ks.prototype,"cacheHint",void 0),u([d({type:Hd,json:{write:!0}})],ks.prototype,"dynamicDataSource",void 0),u([d({type:String,json:{write:!0}})],ks.prototype,"gdbVersion",void 0),u([d({type:Number,json:{write:!0}})],ks.prototype,"geometryPrecision",void 0),u([d({type:Date})],ks.prototype,"historicMoment",void 0),u([ke("historicMoment")],ks.prototype,"_writeHistoricMoment",null),u([d({type:Number,json:{write:!0}})],ks.prototype,"maxAllowableOffset",void 0),u([d({type:[Number],json:{write:!0}})],ks.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],ks.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],ks.prototype,"outFields",void 0),u([d({type:je,json:{read:{source:"outSR"},write:{target:"outSR"}}})],ks.prototype,"outSpatialReference",void 0),u([d({json:{write:!0}})],ks.prototype,"relationshipId",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],ks.prototype,"start",void 0),u([ke("start"),ke("num")],ks.prototype,"writeStart",null),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],ks.prototype,"num",void 0),u([d({json:{write:!0}})],ks.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],ks.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],ks.prototype,"returnZ",void 0),u([d({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],ks.prototype,"where",void 0),ks=q7=u([P("esri.rest.support.RelationshipQuery")],ks),ks.from=vs(ks);const hY=ks,qLt=Object.freeze(Object.defineProperty({__proto__:null,default:hY},Symbol.toStringTag,{value:"Module"})),W7=new $r({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function aBe(t,e,r,i){const s=await Tv(t);if(await dY(t,e,i),!s.addAttachment)throw new V(i,"Layer source does not support addAttachment capability");return s.addAttachment(e,r)}function dY(t,e,r){const{attributes:i}=e,{objectIdField:s}=t;return t.get("capabilities.data.supportsAttachment")?e?i?s&&i[s]?Promise.resolve():Promise.reject(new V(r,`feature is missing the identifying attribute ${s}`)):Promise.reject(new V(r,"'attributes' are required on a feature to query attachments")):Promise.reject(new V(r,"A feature is required to add/delete/update attachments")):Promise.reject(new V(r,"this layer doesn't support attachments"))}async function lBe(t,e,r,i,s){const n=await Tv(t);if(await dY(t,e,s),!n.updateAttachment)throw new V(s,"Layer source does not support updateAttachment capability");return n.updateAttachment(e,r,i)}async function cBe(t,e,r){const{applyEdits:i}=await ce(()=>import("./editingSupport-4dcb91cb.js"),["./editingSupport-4dcb91cb.js","./normalizeUtils-30f603dc.js","./normalizeUtilsCommon-d91de345.js"],import.meta.url),s=await t.load();return i(s,s.source,e,r)}async function uBe(t,e,r){const{uploadAssets:i}=await ce(()=>import("./editingSupport-4dcb91cb.js"),["./editingSupport-4dcb91cb.js","./normalizeUtils-30f603dc.js","./normalizeUtilsCommon-d91de345.js"],import.meta.url),s=await t.load();return i(s,s.source,e,r)}async function hBe(t,e,r,i){const s=await Tv(t);if(await dY(t,e,i),!s.deleteAttachments)throw new V(i,"Layer source does not support deleteAttachments capability");return s.deleteAttachments(e,r)}async function dBe(t,e,r){const i=(await t.load({signal:e?.signal})).source;if(!i.fetchRecomputedExtents)throw new V(r,"Layer source does not support fetchUpdates capability");return i.fetchRecomputedExtents(e)}async function pBe(t,e,r,i){e=oBe.from(e),await t.load();const s=t.source,n=t.capabilities;if(!n?.data?.supportsAttachment)throw new V(i,"this layer doesn't support attachments");const{attachmentTypes:o,objectIds:a,globalIds:l,num:c,size:h,start:p,where:f}=e;if(!n?.operations?.supportsQueryAttachments&&(o?.length>0||l?.length>0||h?.length>0||c||p||f))throw new V(i,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",e);if(!(a?.length||l?.length||f))throw new V(i,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",e);if(!s.queryAttachments)throw new V(i,"Layer source does not support queryAttachments capability",e);return s.queryAttachments(e)}async function fBe(t,e,r,i){const s=await Tv(t);if(!s.queryObjectIds)throw new V(i,"Layer source does not support queryObjectIds capability");return s.queryObjectIds(Ty.from(e)??t.createQuery(),r)}async function mBe(t,e,r,i){const s=await Tv(t);if(!s.queryFeatureCount)throw new V(i,"Layer source does not support queryFeatureCount capability");return s.queryFeatureCount(Ty.from(e)??t.createQuery(),r)}async function gBe(t,e,r,i){const s=await Tv(t);if(!s.queryExtent)throw new V(i,"Layer source does not support queryExtent capability");return s.queryExtent(Ty.from(e)??t.createQuery(),r)}async function yBe(t,e,r,i){const s=await Tv(t);if(!s.queryRelatedFeatures)throw new V(i,"Layer source does not support queryRelatedFeatures capability");return s.queryRelatedFeatures(hY.from(e),r)}async function _Be(t,e,r,i){const s=await Tv(t);if(!s.queryRelatedFeaturesCount)throw new V(i,"Layer source does not support queryRelatedFeaturesCount capability");return s.queryRelatedFeaturesCount(hY.from(e),r)}async function vBe(t){const e=t.source;if(e?.refresh)try{const{dataChanged:r,updates:i}=await e.refresh();if(i!=null&&(t.sourceJSON={...t.sourceJSON,...i},t.read(i,{origin:"service",url:t.parsedUrl})),r)return!0}catch{}if(t.definitionExpression)try{return(await Eke(t.definitionExpression,t.fieldsIndex)).hasDateFunctions}catch{}return!1}function bBe(t){const e=new Ty,r=t.get("capabilities.data"),i=t.get("capabilities.query");e.historicMoment=t.historicMoment,e.gdbVersion=t.gdbVersion,e.returnGeometry=!0,i&&(e.compactGeometryEnabled=i.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=i.supportsDefaultSpatialReference),r&&(r.supportsZ&&t.returnZ!=null&&(e.returnZ=t.returnZ),r.supportsM&&t.returnM!=null&&(e.returnM=t.returnM)),e.outFields=["*"];const{timeOffset:s,timeExtent:n}=t;return e.timeExtent=s!=null&&n!=null?n.offset(-s.value,s.unit):n||null,e.multipatchOption=t.geometryType==="multipatch"?"xyFootprint":null,e}function t1e(t){const{globalIdField:e,fields:r}=t;if(e)return e;if(r){for(const i of r)if(i.type==="esriFieldTypeGlobalID")return i.name}}function r1e(t){const{objectIdField:e,fields:r}=t;if(e)return e;if(r){for(const i of r)if(i.type==="esriFieldTypeOID")return i.name}}function wBe(t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}async function Tv(t){return(await t.load()).source}async function xBe(t,e){if(!Pi||Pi.findCredential(t))return;let r;try{const i=await sge(t,e);i&&(r=await Pi.checkSignInStatus(`${i}/sharing`))}catch{}if(r)try{const i=e!=null?e.signal:null;await Pi.getCredential(t,{signal:i})}catch{}}async function TBe(t,e){const r=t.parsedUrl?.path;r&&SBe(t)&&await xBe(r,e)}function SBe(t){const e=t.editFieldsInfo;return!(!e?.creatorField&&!e?.editorField)||(t.userHasUpdateItemPrivileges?t.hasUpdateItemRestrictions:!!t.userHasFullEditingPrivileges&&t.hasFullEditingRestrictions)}function EBe(t){return!t.sourceJSON?.isMultiServicesView&&(t.userHasUpdateItemPrivileges||t.editingEnabled)}const e9=BE({types:u_e});function pY(t,e){if(t.defaultSymbol)return t.types&&t.types.length?new g6({defaultSymbol:e9(t.defaultSymbol,t,e),field:t.typeIdField,uniqueValueInfos:t.types.map(r=>({id:r.id,symbol:e9(r.symbol,r,e)}))}):new kM({symbol:e9(t.defaultSymbol,t,e)})}let rS=class extends ji(le){constructor(e){super(e),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};u([d({type:String,json:{read:{source:"shapeAreaFieldName"}}})],rS.prototype,"shapeAreaField",void 0),u([d({type:String,json:{read:{source:"shapeLengthFieldName"}}})],rS.prototype,"shapeLengthField",void 0),u([d({type:String,json:{read:t=>ZDe.read(t)||YDe.read(t)}})],rS.prototype,"units",void 0),rS=u([P("esri.layers.support.GeometryFieldsInfo")],rS);const CBe=rS;var X7;let iS=X7=class extends le{constructor(t){super(t),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new Pt}clone(){return new X7({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};u([d({type:String,json:{write:!0}})],iS.prototype,"floorField",void 0),u([d({json:{read:!1,write:!1}})],iS.prototype,"viewAllMode",void 0),u([d({json:{read:!1,write:!1}})],iS.prototype,"viewAllLevelIds",void 0),iS=X7=u([P("esri.layers.support.LayerFloorInfo")],iS);const i1e=iS,oie=new $r({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),aie=new $r({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let eh=class extends ji(le){constructor(e){super(e),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};u([d({json:{read:oie.read,write:oie.write}})],eh.prototype,"cardinality",void 0),u([d({json:{read:!0,write:!0}})],eh.prototype,"composite",void 0),u([d({json:{read:!0,write:!0}})],eh.prototype,"id",void 0),u([d({json:{read:!0,write:!0}})],eh.prototype,"keyField",void 0),u([d({json:{read:!0,write:!0}})],eh.prototype,"keyFieldInRelationshipTable",void 0),u([d({json:{read:!0,write:!0}})],eh.prototype,"name",void 0),u([d({json:{read:!0,write:!0}})],eh.prototype,"relatedTableId",void 0),u([d({json:{read:!0,write:!0}})],eh.prototype,"relationshipTableId",void 0),u([d({json:{read:aie.read,write:aie.write}})],eh.prototype,"role",void 0),eh=u([P("esri.layers.support.Relationship")],eh);const ABe=eh,OBe={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"};function kt(t,e,r){return!!s1e(t,e,r)}function rI(t,e,r){return s1e(t,e,r)}function s1e(t,e,r){return t&&t.hasOwnProperty(e)?t[e]:r}function RBe(t){const e=t?.supportedSpatialAggregationStatistics?.map(r=>r.toLowerCase());return{envelope:!!e?.includes("envelopeaggregate"),centroid:!!e?.includes("centroidaggregate"),convexHull:!!e?.includes("convexhullaggregate")}}function GM(t,e){return!!t?.supportedOperationsWithCacheHint?.map(i=>i.toLowerCase())?.includes(e.toLowerCase())}function n1e(t,e){return{analytics:MBe(t),attachment:PBe(t),data:IBe(t),metadata:$Be(t),operations:LBe(t.capabilities,t,e),query:DBe(t,e),queryRelated:NBe(t),queryTopFeatures:FBe(t),editing:UBe(t)}}function MBe(t){return{supportsCacheHint:GM(t.advancedQueryCapabilities,"queryAnalytics")}}function PBe(t){const e=t.attachmentProperties,r={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:GM(t.advancedQueryCapabilities,"queryAttachments"),supportsResize:kt(t,"supportsAttachmentsResizing",!1)};return e&&Array.isArray(e)&&e.forEach(i=>{const s=OBe[i.name];s&&(r[s]=!!i.isEnabled)}),r}function IBe(t){return{isVersioned:kt(t,"isDataVersioned",!1),supportsAttachment:kt(t,"hasAttachments",!1),supportsM:kt(t,"hasM",!1),supportsZ:kt(t,"hasZ",!1)}}function $Be(t){return{supportsAdvancedFieldProperties:kt(t,"supportsFieldDescriptionProperty",!1)}}function LBe(t,e,r){const i=t?t.toLowerCase().split(",").map(f=>f.trim()):[],s=r?cx(r):null,n=i.includes(s!=null&&s.serverType==="MapServer"?"data":"query"),o=i.includes("editing")&&!e.datesInUnknownTimezone;let a=o&&i.includes("create"),l=o&&i.includes("delete"),c=o&&i.includes("update");const h=i.includes("changetracking"),p=e.advancedQueryCapabilities;return o&&!(a||l||c)&&(a=l=c=!0),{supportsCalculate:kt(e,"supportsCalculate",!1),supportsTruncate:kt(e,"supportsTruncate",!1),supportsValidateSql:kt(e,"supportsValidateSql",!1),supportsAdd:a,supportsDelete:l,supportsEditing:o,supportsChangeTracking:h,supportsQuery:n,supportsQueryAnalytics:kt(p,"supportsQueryAnalytic",!1),supportsQueryAttachments:kt(p,"supportsQueryAttachments",!1),supportsQueryTopFeatures:kt(p,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:kt(e,"supportsAttachmentsResizing",!1),supportsSync:i.includes("sync"),supportsUpdate:c,supportsExceedsLimitStatistics:kt(e,"supportsExceedsLimitStatistics",!1),supportsAsyncConvert3D:kt(e,"supportsAsyncConvert3D",!1)}}function DBe(t,e){const r=t.advancedQueryCapabilities,i=t.ownershipBasedAccessControlForFeatures,s=t.archivingInfo,n=t.currentVersion,o=e?.includes("MapServer"),a=!o||n>=oe("mapserver-pbf-version-support"),l=iY(e),c=new Set((t.supportedQueryFormats??"").split(",").map(h=>h.toLowerCase().trim()));return{supportsStatistics:kt(r,"supportsStatistics",t.supportsStatistics),supportsPercentileStatistics:kt(r,"supportsPercentileStatistics",!1),supportsSpatialAggregationStatistics:kt(r,"supportsSpatialAggregationStatistics",!1),supportedSpatialAggregationStatistics:RBe(r),supportsCentroid:kt(r,"supportsReturningGeometryCentroid",!1),supportsDistance:kt(r,"supportsQueryWithDistance",!1),supportsDistinct:kt(r,"supportsDistinct",t.supportsAdvancedQueries),supportsExtent:kt(r,"supportsReturningQueryExtent",!1),supportsGeometryProperties:kt(r,"supportsReturningGeometryProperties",!1),supportsHavingClause:kt(r,"supportsHavingClause",!1),supportsOrderBy:kt(r,"supportsOrderBy",t.supportsAdvancedQueries),supportsPagination:kt(r,"supportsPagination",!1),supportsQuantization:kt(t,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:kt(t,"supportsQuantizationEditMode",!1),supportsQueryGeometry:kt(t,"supportsReturningQueryGeometry",!1),supportsResultType:kt(r,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:kt(r,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:kt(r,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:kt(t,"useStandardizedQueries",!1),supportsTopFeaturesQuery:kt(r,"supportsTopFeaturesQuery",!1),supportsQueryByOthers:kt(i,"allowOthersToQuery",!0),supportsHistoricMoment:kt(s,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:a&&c.has("pbf"),supportsDisjointSpatialRelationship:kt(r,"supportsDisjointSpatialRel",!1),supportsCacheHint:kt(r,"supportsQueryWithCacheHint",!1)||GM(r,"query"),supportsDefaultSpatialReference:kt(r,"supportsDefaultSR",!1),supportsCompactGeometry:l,supportsFullTextSearch:kt(r,"supportsFullTextSearch",!1),maxRecordCountFactor:rI(t,"maxRecordCountFactor",void 0),maxRecordCount:rI(t,"maxRecordCount",void 0),standardMaxRecordCount:rI(t,"standardMaxRecordCount",void 0),tileMaxRecordCount:rI(t,"tileMaxRecordCount",void 0)}}function NBe(t){const e=t.advancedQueryCapabilities,r=kt(e,"supportsAdvancedQueryRelated",!1);return{supportsPagination:kt(e,"supportsQueryRelatedPagination",!1),supportsCount:r,supportsOrderBy:r,supportsCacheHint:GM(e,"queryRelated")}}function FBe(t){return{supportsCacheHint:GM(t.advancedQueryCapabilities,"queryTopFilter")}}function UBe(t){const e=t.ownershipBasedAccessControlForFeatures,r=t?t.advancedEditingCapabilities:void 0;return{supportsGeometryUpdate:kt(t,"allowGeometryUpdates",!0),supportsGlobalId:kt(t,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:kt(t,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:kt(t,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:kt(t,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:kt(t,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:kt(e,"allowAnonymousToDelete",!0),supportsDeleteByOthers:kt(e,"allowOthersToDelete",!0),supportsUpdateByAnonymous:kt(e,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:kt(e,"allowOthersToUpdate",!0),supportsAsyncApplyEdits:kt(r,"supportsAsyncApplyEdits",!1)}}const kBe=t=>{let e=class extends t{constructor(){super(...arguments),this.capabilities=null,this.copyright=null,this.dateFieldsTimeReference=null,this.datesInUnknownTimezone=!1,this.displayField=null,this.definitionExpression=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.floorInfo=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.isTable=!1,this.layerId=void 0,this.minScale=0,this.maxScale=0,this.globalIdField=null,this.objectIdField=null,this.preferredTimeReference=null,this.relationships=null,this.sourceJSON=null,this.returnM=void 0,this.returnZ=void 0,this.serviceDefinitionExpression=null,this.serviceItemId=null,this.spatialReference=je.WGS84,this.subtypeField=null,this.trackIdField=null,this.indexes=new(Pt.ofType(Ef)),this.version=void 0}readCapabilitiesFromService(r,i){return n1e(i,this.url)}get effectiveCapabilities(){const r=this.capabilities;if(!r)return null;const i=K(r),{operations:s,editing:n}=i;return this.sourceJSON?.isMultiServicesView?(this.userHasUpdateItemPrivileges&&(s.supportsQuery=!0),i):this.userHasUpdateItemPrivileges?(s.supportsAdd=s.supportsDelete=s.supportsEditing=s.supportsQuery=s.supportsUpdate=n.supportsDeleteByOthers=n.supportsGeometryUpdate=n.supportsUpdateByOthers=!0,i):(this.userHasFullEditingPrivileges&&s.supportsEditing&&(s.supportsAdd=s.supportsDelete=s.supportsUpdate=n.supportsGeometryUpdate=!0),i)}get hasFullEditingRestrictions(){const r=this.capabilities;if(!r||this.sourceJSON?.isMultiServicesView)return!1;const{operations:i,editing:s}=r;return i.supportsEditing&&!(i.supportsAdd&&i.supportsDelete&&i.supportsUpdate&&s.supportsGeometryUpdate)}get hasUpdateItemRestrictions(){const r=this.capabilities;if(!r)return!1;const{operations:i,editing:s}=r;return this.sourceJSON?.isMultiServicesView?!i.supportsQuery:!(i.supportsAdd&&i.supportsDelete&&i.supportsEditing&&i.supportsQuery&&i.supportsUpdate&&s.supportsDeleteByOthers&&s.supportsGeometryUpdate&&s.supportsUpdateByOthers)}readEditingInfo(r,i){const{editingInfo:s}=i;return s?{lastEditDate:s.lastEditDate!=null?new Date(s.lastEditDate):null}:null}readIsTableFromService(r,i){return i.type==="Table"}readMinScale(r,i){return i.effectiveMinScale||r||0}readMaxScale(r,i){return i.effectiveMaxScale||r||0}readGlobalIdFieldFromService(r,i){return t1e(i)}readObjectIdFieldFromService(r,i){return r1e(i)}readServiceDefinitionExpression(r,i){return i.definitionQuery||i.definitionExpression}set url(r){const i=yve({layer:this,url:r,nonStandardUrlAllowed:!0,logger:Q.getLogger(this)});this._set("url",i.url),i.layerId!=null&&this._set("layerId",i.layerId)}writeUrl(r,i,s,n){_ve(this,r,null,i,n)}readVersion(r,i){return wBe(i)}};return u([d({readOnly:!0,json:{read:!1,origins:{service:{read:{source:["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"]}}}}})],e.prototype,"capabilities",void 0),u([Ae("service","capabilities")],e.prototype,"readCapabilitiesFromService",null),u([d({readOnly:!0})],e.prototype,"effectiveCapabilities",null),u([d({readOnly:!0})],e.prototype,"hasFullEditingRestrictions",null),u([d({readOnly:!0})],e.prototype,"hasUpdateItemRestrictions",null),u([d({type:String,json:{origins:{service:{read:{source:"copyrightText"}}}}})],e.prototype,"copyright",void 0),u([d({type:rE})],e.prototype,"dateFieldsTimeReference",void 0),u([d({type:Boolean})],e.prototype,"datesInUnknownTimezone",void 0),u([d({type:String,json:{origins:{service:{read:{source:"displayField"}}}}})],e.prototype,"displayField",void 0),u([d({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],e.prototype,"definitionExpression",void 0),u([d({readOnly:!0,type:nBe})],e.prototype,"editFieldsInfo",void 0),u([d({readOnly:!0})],e.prototype,"editingInfo",void 0),u([Ae("editingInfo")],e.prototype,"readEditingInfo",null),u([d((()=>{const r=K(Jve),i=r.json.origins;return i["web-map"]={read:!1,write:!1},i["portal-item"]={read:!1,write:!1},r})())],e.prototype,"elevationInfo",void 0),u([d({type:i1e,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],e.prototype,"floorInfo",void 0),u([d({type:ur,json:{origins:{service:{read:{source:"extent"}}}}})],e.prototype,"fullExtent",void 0),u([d()],e.prototype,"gdbVersion",void 0),u([d({readOnly:!0,type:CBe,json:{read:{source:"geometryProperties"}}})],e.prototype,"geometryFieldsInfo",void 0),u([d({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:W7.read}}}})],e.prototype,"geometryType",void 0),u([d({type:Boolean,json:{origins:{service:{read:!0}}}})],e.prototype,"hasM",void 0),u([d({type:Boolean,json:{origins:{service:{read:!0}}}})],e.prototype,"hasZ",void 0),u([d({readOnly:!0,type:ux})],e.prototype,"heightModelInfo",void 0),u([d({type:Date})],e.prototype,"historicMoment",void 0),u([d({readOnly:!0})],e.prototype,"isTable",void 0),u([Ae("service","isTable",["type"])],e.prototype,"readIsTableFromService",null),u([d({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],e.prototype,"layerId",void 0),u([d(eBe)],e.prototype,"minScale",void 0),u([Ae("service","minScale",["minScale","effectiveMinScale"])],e.prototype,"readMinScale",null),u([d(tBe)],e.prototype,"maxScale",void 0),u([Ae("service","maxScale",["maxScale","effectiveMaxScale"])],e.prototype,"readMaxScale",null),u([d({type:String})],e.prototype,"globalIdField",void 0),u([Ae("service","globalIdField",["globalIdField","fields"])],e.prototype,"readGlobalIdFieldFromService",null),u([d({type:String})],e.prototype,"objectIdField",void 0),u([Ae("service","objectIdField",["objectIdField","fields"])],e.prototype,"readObjectIdFieldFromService",null),u([d({type:rE})],e.prototype,"preferredTimeReference",void 0),u([d({type:[ABe],readOnly:!0})],e.prototype,"relationships",void 0),u([d()],e.prototype,"sourceJSON",void 0),u([d({type:Boolean})],e.prototype,"returnM",void 0),u([d({type:Boolean})],e.prototype,"returnZ",void 0),u([d({readOnly:!0})],e.prototype,"serviceDefinitionExpression",void 0),u([Ae("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],e.prototype,"readServiceDefinitionExpression",null),u([d({type:String,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],e.prototype,"serviceItemId",void 0),u([d({type:je,json:{origins:{service:{read:{source:"extent.spatialReference"}}}}})],e.prototype,"spatialReference",void 0),u([d({type:String,readOnly:!0,json:{origins:{service:{read:!0}}}})],e.prototype,"subtypeField",void 0),u([d({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],e.prototype,"trackIdField",void 0),u([d({readOnly:!0,json:{write:!1}})],e.prototype,"serverGens",void 0),u([d({type:Pt.ofType(Ef),readOnly:!0})],e.prototype,"indexes",void 0),u([d(Zve)],e.prototype,"url",null),u([ke("url")],e.prototype,"writeUrl",null),u([d({json:{origins:{service:{read:!0}},read:!1}})],e.prototype,"version",void 0),u([Ae("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],e.prototype,"readVersion",null),e=u([P("esri.layers.mixins.FeatureLayerBase")],e),e};let sS=class extends ji(le){constructor(e){super(e),this.expression=null,this.title=null,this.returnType=null}};u([d({type:String,json:{write:!0}})],sS.prototype,"expression",void 0),u([d({type:String,json:{write:!0}})],sS.prototype,"title",void 0),u([d({type:String,json:{write:!0}})],sS.prototype,"returnType",void 0),sS=u([P("esri.layers.support.ExpressionInfo")],sS);const fY=sS;var Z7;let pg=Z7=class extends le{constructor(t){super(t),this.isAutoGenerated=!1,this.name=null,this.alias=null,this.onStatisticField=null,this.onStatisticExpression=null,this.statisticType=null}clone(){return new Z7({name:this.name,alias:this.alias,isAutoGenerated:this.isAutoGenerated,onStatisticExpression:K(this.onStatisticExpression),onStatisticField:this.onStatisticField,statisticType:this.statisticType})}};u([d({type:Boolean,json:{write:!0}})],pg.prototype,"isAutoGenerated",void 0),u([d({type:String,json:{write:!0}})],pg.prototype,"name",void 0),u([d({type:String,json:{write:!0}})],pg.prototype,"alias",void 0),u([d({type:String,json:{write:!0}})],pg.prototype,"onStatisticField",void 0),u([d({type:fY,json:{write:!0}})],pg.prototype,"onStatisticExpression",void 0),u([d({type:String,json:{write:!0}})],pg.prototype,"statisticType",void 0),pg=Z7=u([P("esri.layers.support.AggregateField")],pg);const Rw=pg;let Hg=class extends le{constructor(){super(...arguments),this.type=null}};u([d({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],Hg.prototype,"type",void 0),Hg=u([P("esri.layers.support.FeatureReduction")],Hg);const mY="__begin__",gY="__end__",zBe=new RegExp(mY,"ig"),VBe=new RegExp(gY,"ig"),lie=new RegExp("^"+mY,"i"),cie=new RegExp(gY+"$","i"),L4='"',BBe=L4+" + ",GBe=" + "+L4;function jBe(t){return t.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}function HBe(t){return t.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")}function M6(t){const e={expression:"",type:"none"};return t.labelExpressionInfo?t.labelExpressionInfo.value?(e.expression=t.labelExpressionInfo.value,e.type="conventional"):t.labelExpressionInfo.expression&&(e.expression=t.labelExpressionInfo.expression,e.type="arcade"):t.labelExpression!=null&&(e.expression=jBe(t.labelExpression),e.type="conventional"),e}function qBe(t){const e=M6(t);if(!e)return null;switch(e.type){case"conventional":return Y7(e.expression);case"arcade":return e.expression}return null}function WBe(t){const e=M6(t);if(!e)return null;switch(e.type){case"conventional":return ZBe(e.expression);case"arcade":return yY(e.expression)}return null}function Y7(t){let e;return t?(e=N5(t,r=>mY+'$feature["'+r+'"]'+gY),e=lie.test(e)?e.replace(lie,""):L4+e,e=cie.test(e)?e.replace(cie,""):e+L4,e=e.replaceAll(zBe,BBe).replaceAll(VBe,GBe)):e='""',e}const XBe=/^\s*\{([^}]+)\}\s*$/i;function ZBe(t){const e=t?.match(XBe);return e&&e[1].trim()||null}const YBe=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,JBe=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,QBe=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function yY(t){if(!t)return null;let e=YBe.exec(t)||JBe.exec(t);return e?e[1]||e[3]:(e=QBe.exec(t),e?e[2]:null)}var J7;let F0=J7=class extends le{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(t,e){return e.value?Y7(e.value):t}writeExpression(t,e,r){this.value!=null&&(t=Y7(this.value)),t!=null&&(e[r]=t)}clone(){return new J7({expression:this.expression,title:this.title,value:this.value})}};u([d({type:String,json:{write:{writerEnsuresNonNull:!0}}})],F0.prototype,"expression",void 0),u([Ae("expression",["expression","value"])],F0.prototype,"readExpression",null),u([ke("expression")],F0.prototype,"writeExpression",null),u([d({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],F0.prototype,"title",void 0),u([d({json:{read:!1,write:!1}})],F0.prototype,"value",void 0),F0=J7=u([P("esri.layers.support.LabelExpressionInfo")],F0);const o1e=F0,a1e=[252,146,31,255],JLt=[153,153,153,255],KBe={type:"esriSMS",style:"esriSMSCircle",size:6,color:a1e,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},eGe={type:"esriSLS",style:"esriSLSSolid",width:.75,color:a1e},tGe={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},rGe={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},iGe={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},sGe={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},nGe={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},QLt=xv.fromJSON(KBe),KLt=$u.fromJSON(eGe),eDt=wv.fromJSON(tGe),oGe=ax.fromJSON(rGe);xv.fromJSON(iGe);$u.fromJSON(sGe);wv.fromJSON(nGe);var Q7;const iI=new $r({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function sI(t,e,r){return{enabled:!rge(r?.layer)}}function l1e(t){return!t||t.origin!=="service"&&t.layer?.type!=="map-image"}function aGe(t){return t?.type==="map-image"}function c1e(t){return!!aGe(t)&&!!t.capabilities?.exportMap?.supportsArcadeExpressionForLabeling}function lGe(t){return l1e(t)||c1e(t?.layer)}let Ks=Q7=class extends le{static evaluateWhere(t,e){const r=(i,s,n)=>{switch(s){case"=":return i==n;case"<>":return i!=n;case">":return i>n;case">=":return i>=n;case"<":return i<n;case"<=":return i<=n}return!1};try{if(t==null)return!0;const i=t.split(" ");if(i.length===3)return r(e[i[0]],i[1],i[2]);if(i.length===7){const s=r(e[i[0]],i[1],i[2]),n=i[3],o=r(e[i[4]],i[5],i[6]);switch(n){case"AND":return s&&o;case"OR":return s||o}}return!1}catch{console.log("Error.: can't parse = "+t)}}constructor(t){super(t),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=oGe,this.useCodedValues=void 0,this.where=null}readLabelExpression(t,e){const r=e.labelExpressionInfo;if(!r||!r.value&&!r.expression)return t}writeLabelExpression(t,e,r){if(this.labelExpressionInfo){if(this.labelExpressionInfo.value!=null)t=HBe(this.labelExpressionInfo.value);else if(this.labelExpressionInfo.expression!=null){const i=yY(this.labelExpressionInfo.expression);i&&(t="["+i+"]")}}t!=null&&(e[r]=t)}writeLabelExpressionInfo(t,e,r,i){if(t==null&&this.labelExpression!=null&&l1e(i))t=new o1e({expression:this.getLabelExpressionArcade()});else if(!t)return;const s=t.toJSON(i);s.expression&&(e[r]=s)}writeMaxScale(t,e){(t||this.minScale)&&(e.maxScale=t)}writeMinScale(t,e){(t||this.maxScale)&&(e.minScale=t)}getLabelExpression(){return M6(this)}getLabelExpressionArcade(){return qBe(this)}getLabelExpressionSingleField(){return WBe(this)}hash(){return JSON.stringify(this)}clone(){return new Q7({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:K(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:K(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};u([d({type:String,json:{write:!0}})],Ks.prototype,"name",void 0),u([d({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1},"portal-item":{default:!1,write:{overridePolicy:sI}}}}})],Ks.prototype,"allowOverrun",void 0),u([d({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1},"portal-item":{default:"static",write:{overridePolicy:sI}}}}})],Ks.prototype,"deconflictionStrategy",void 0),u([d({type:String,json:{write:{overridePolicy(t,e,r){return this.labelExpressionInfo&&r?.origin==="service"&&c1e(r.layer)?{enabled:!1}:{allowNull:!0}}}}})],Ks.prototype,"labelExpression",void 0),u([Ae("labelExpression")],Ks.prototype,"readLabelExpression",null),u([ke("labelExpression")],Ks.prototype,"writeLabelExpression",null),u([d({type:o1e,json:{write:{overridePolicy:(t,e,r)=>lGe(r)?{allowNull:!0}:{enabled:!1}}}})],Ks.prototype,"labelExpressionInfo",void 0),u([ke("labelExpressionInfo")],Ks.prototype,"writeLabelExpressionInfo",null),u([d({type:iI.apiValues,json:{type:iI.jsonValues,read:iI.read,write:iI.write}})],Ks.prototype,"labelPlacement",void 0),u([d({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],Ks.prototype,"labelPosition",void 0),u([d({type:Number})],Ks.prototype,"maxScale",void 0),u([ke("maxScale")],Ks.prototype,"writeMaxScale",null),u([d({type:Number})],Ks.prototype,"minScale",void 0),u([ke("minScale")],Ks.prototype,"writeMinScale",null),u([d({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:sI}}}}})],Ks.prototype,"repeatLabel",void 0),u([d({type:Number,cast:Kr,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:sI}}}}})],Ks.prototype,"repeatLabelDistance",void 0),u([d({types:o9e,json:{origins:{"web-scene":{types:a9e,write:sre,default:null}},write:sre,default:null}})],Ks.prototype,"symbol",void 0),u([d({type:Boolean,json:{write:!0}})],Ks.prototype,"useCodedValues",void 0),u([d({type:String,json:{write:!0}})],Ks.prototype,"where",void 0),Ks=Q7=u([P("esri.layers.support.LabelClass")],Ks);const sC=Ks;var K7;const cGe="esri.layers.support.FeatureReductionBinning";let yl=K7=class extends Hg{constructor(t){super(t),this.type="binning",this.binType="geohash",this.fixedBinLevel=3,this.labelingInfo=null,this.labelsVisible=!0,this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.fields=[],this.renderer=null}writeFields(t,e,r){const i=t.filter(s=>s.statisticType!=="avg_angle").map(s=>s.toJSON());tl(r,i,e)}readRenderer(t,e,r){const i=e.drawingInfo?.renderer;return i?AR(i,e,r)??void 0:pY(e,r)}clone(){return new K7({fields:K(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:K(this.labelingInfo),labelsVisible:this.labelsVisible,maxScale:this.maxScale,popupEnabled:this.popupEnabled,popupTemplate:K(this.popupTemplate),renderer:K(this.renderer)})}};u([it({binning:"binning"})],yl.prototype,"type",void 0),u([it({geohash:"geohash"})],yl.prototype,"binType",void 0),u([d({type:Number,range:{min:1,max:9},json:{write:!0}})],yl.prototype,"fixedBinLevel",void 0),u([d({type:[sC],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],yl.prototype,"labelingInfo",void 0),u([d(R6)],yl.prototype,"labelsVisible",void 0),u([d({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],yl.prototype,"maxScale",void 0),u([d(O6)],yl.prototype,"popupEnabled",void 0),u([d({type:_v,json:{name:"popupInfo",write:!0}})],yl.prototype,"popupTemplate",void 0),u([d({type:[Rw],json:{write:!0}})],yl.prototype,"fields",void 0),u([ke("fields")],yl.prototype,"writeFields",null),u([d({types:y6,json:{write:{target:"drawingInfo.renderer"}}})],yl.prototype,"renderer",void 0),u([Ae("renderer",["drawingInfo.renderer"])],yl.prototype,"readRenderer",null),yl=K7=u([P(cGe)],yl);const u1e=yl;var ej;const uGe="esri.layers.support.FeatureReductionCluster";function uie(t){return t.type==="simple"&&!t.visualVariables?.length}let Un=ej=class extends le{constructor(t){super(t),this.type="cluster",this.clusterRadius=Kr("80px"),this.clusterMinSize=Kr("12px"),this.clusterMaxSize=Kr("50px"),this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=null}readRenderer(t,e,r){const i=e.drawingInfo?.renderer;return i?.authoringInfo?.isAutoGenerated?null:i?uie(i)?null:AR(i,e,r)??void 0:pY(e,r)}readSymbol(t,e,r){const i=e.drawingInfo?.renderer;return i?.authoringInfo?.isAutoGenerated?null:i&&uie(i)?AR(i,e,r)?.symbol:null}writeSymbol(t,e,r,i){const s=this.renderer?.authoringInfo?.isAutoGenerated;if(!this.renderer||s){const n=new kM({symbol:t});e.drawingInfo={renderer:n.write({},i)}}}writeFields(t,e,r){const i=t.filter(s=>s.statisticType!=="avg_angle").map(s=>s.toJSON());tl(r,i,e)}readFields(t,e,r){return t.filter(i=>!i.isAutoGenerated).map(i=>Rw.fromJSON(i))}clone(){return new ej({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:K(this.labelingInfo),labelsVisible:this.labelsVisible,fields:K(this.fields),maxScale:this.maxScale,renderer:K(this.renderer),symbol:K(this.symbol),popupEnabled:this.popupEnabled,popupTemplate:K(this.popupTemplate)})}};u([d({type:["cluster"],readOnly:!0,json:{write:!0}})],Un.prototype,"type",void 0),u([d({type:Number,cast:t=>t==="auto"?t:Kr(t),json:{write:!0}})],Un.prototype,"clusterRadius",void 0),u([d({type:Number,cast:Kr,json:{write:!0}})],Un.prototype,"clusterMinSize",void 0),u([d({type:Number,cast:Kr,json:{write:!0}})],Un.prototype,"clusterMaxSize",void 0),u([d({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],Un.prototype,"maxScale",void 0),u([d(O6)],Un.prototype,"popupEnabled",void 0),u([d({type:_v,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],Un.prototype,"popupTemplate",void 0),u([d({types:y6,json:{write:{target:"drawingInfo.renderer"}}})],Un.prototype,"renderer",void 0),u([Ae("renderer",["drawingInfo.renderer"])],Un.prototype,"readRenderer",null),u([d({types:s9e})],Un.prototype,"symbol",void 0),u([Ae("symbol",["drawingInfo.renderer"])],Un.prototype,"readSymbol",null),u([ke("symbol")],Un.prototype,"writeSymbol",null),u([d({type:[sC],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],Un.prototype,"labelingInfo",void 0),u([d(R6)],Un.prototype,"labelsVisible",void 0),u([d({type:[Rw],json:{write:!0}})],Un.prototype,"fields",void 0),u([ke("fields")],Un.prototype,"writeFields",null),u([Ae("fields")],Un.prototype,"readFields",null),Un=ej=u([P(uGe)],Un);const h1e=Un;var tj;let FD=tj=class extends Hg{constructor(t){super(t),this.type="selection"}clone(){return new tj}};u([d({type:["selection"]})],FD.prototype,"type",void 0),FD=tj=u([P("esri.layers.support.FeatureReductionSelection")],FD);const rj=FD,hie={key:"type",base:Hg,typeMap:{cluster:h1e,binning:u1e}},hGe={types:{key:"type",base:Hg,typeMap:{selection:rj,cluster:h1e,binning:u1e}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:hie},"portal-item":{types:hie},"web-scene":{types:{key:"type",base:Hg,typeMap:{selection:rj}}}}}},Cx={Base64:0,Hex:1,String:2,Raw:3},m2=8,d1e=(1<<m2)-1;function O_(t,e){const r=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(r>>16)<<16|65535&r}function dGe(t){const e=[];for(let r=0,i=t.length*m2;r<i;r+=m2)e[r>>5]|=(t.charCodeAt(r/m2)&d1e)<<r%32;return e}function pGe(t){const e=[];for(let r=0,i=32*t.length;r<i;r+=m2)e.push(String.fromCharCode(t[r>>5]>>>r%32&d1e));return e.join("")}function fGe(t){const e="0123456789abcdef",r=[];for(let i=0,s=4*t.length;i<s;i++)r.push(e.charAt(t[i>>2]>>i%4*8+4&15)+e.charAt(t[i>>2]>>i%4*8&15));return r.join("")}function mGe(t){const e="=",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=[];for(let s=0,n=4*t.length;s<n;s+=3){const o=(t[s>>2]>>s%4*8&255)<<16|(t[s+1>>2]>>(s+1)%4*8&255)<<8|t[s+2>>2]>>(s+2)%4*8&255;for(let a=0;a<4;a++)8*s+6*a>32*t.length?i.push(e):i.push(r.charAt(o>>6*(3-a)&63))}return i.join("")}function gGe(t,e){return t<<e|t>>>32-e}function P6(t,e,r,i,s,n){return O_(gGe(O_(O_(e,t),O_(i,n)),s),r)}function Ta(t,e,r,i,s,n,o){return P6(e&r|~e&i,t,e,s,n,o)}function Sa(t,e,r,i,s,n,o){return P6(e&i|r&~i,t,e,s,n,o)}function Ea(t,e,r,i,s,n,o){return P6(e^r^i,t,e,s,n,o)}function Ca(t,e,r,i,s,n,o){return P6(r^(e|~i),t,e,s,n,o)}function yGe(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;let r=1732584193,i=-271733879,s=-1732584194,n=271733878;for(let o=0;o<t.length;o+=16){const a=r,l=i,c=s,h=n;r=Ta(r,i,s,n,t[o],7,-680876936),n=Ta(n,r,i,s,t[o+1],12,-389564586),s=Ta(s,n,r,i,t[o+2],17,606105819),i=Ta(i,s,n,r,t[o+3],22,-1044525330),r=Ta(r,i,s,n,t[o+4],7,-176418897),n=Ta(n,r,i,s,t[o+5],12,1200080426),s=Ta(s,n,r,i,t[o+6],17,-1473231341),i=Ta(i,s,n,r,t[o+7],22,-45705983),r=Ta(r,i,s,n,t[o+8],7,1770035416),n=Ta(n,r,i,s,t[o+9],12,-1958414417),s=Ta(s,n,r,i,t[o+10],17,-42063),i=Ta(i,s,n,r,t[o+11],22,-1990404162),r=Ta(r,i,s,n,t[o+12],7,1804603682),n=Ta(n,r,i,s,t[o+13],12,-40341101),s=Ta(s,n,r,i,t[o+14],17,-1502002290),i=Ta(i,s,n,r,t[o+15],22,1236535329),r=Sa(r,i,s,n,t[o+1],5,-165796510),n=Sa(n,r,i,s,t[o+6],9,-1069501632),s=Sa(s,n,r,i,t[o+11],14,643717713),i=Sa(i,s,n,r,t[o],20,-373897302),r=Sa(r,i,s,n,t[o+5],5,-701558691),n=Sa(n,r,i,s,t[o+10],9,38016083),s=Sa(s,n,r,i,t[o+15],14,-660478335),i=Sa(i,s,n,r,t[o+4],20,-405537848),r=Sa(r,i,s,n,t[o+9],5,568446438),n=Sa(n,r,i,s,t[o+14],9,-1019803690),s=Sa(s,n,r,i,t[o+3],14,-187363961),i=Sa(i,s,n,r,t[o+8],20,1163531501),r=Sa(r,i,s,n,t[o+13],5,-1444681467),n=Sa(n,r,i,s,t[o+2],9,-51403784),s=Sa(s,n,r,i,t[o+7],14,1735328473),i=Sa(i,s,n,r,t[o+12],20,-1926607734),r=Ea(r,i,s,n,t[o+5],4,-378558),n=Ea(n,r,i,s,t[o+8],11,-2022574463),s=Ea(s,n,r,i,t[o+11],16,1839030562),i=Ea(i,s,n,r,t[o+14],23,-35309556),r=Ea(r,i,s,n,t[o+1],4,-1530992060),n=Ea(n,r,i,s,t[o+4],11,1272893353),s=Ea(s,n,r,i,t[o+7],16,-155497632),i=Ea(i,s,n,r,t[o+10],23,-1094730640),r=Ea(r,i,s,n,t[o+13],4,681279174),n=Ea(n,r,i,s,t[o],11,-358537222),s=Ea(s,n,r,i,t[o+3],16,-722521979),i=Ea(i,s,n,r,t[o+6],23,76029189),r=Ea(r,i,s,n,t[o+9],4,-640364487),n=Ea(n,r,i,s,t[o+12],11,-421815835),s=Ea(s,n,r,i,t[o+15],16,530742520),i=Ea(i,s,n,r,t[o+2],23,-995338651),r=Ca(r,i,s,n,t[o],6,-198630844),n=Ca(n,r,i,s,t[o+7],10,1126891415),s=Ca(s,n,r,i,t[o+14],15,-1416354905),i=Ca(i,s,n,r,t[o+5],21,-57434055),r=Ca(r,i,s,n,t[o+12],6,1700485571),n=Ca(n,r,i,s,t[o+3],10,-1894986606),s=Ca(s,n,r,i,t[o+10],15,-1051523),i=Ca(i,s,n,r,t[o+1],21,-2054922799),r=Ca(r,i,s,n,t[o+8],6,1873313359),n=Ca(n,r,i,s,t[o+15],10,-30611744),s=Ca(s,n,r,i,t[o+6],15,-1560198380),i=Ca(i,s,n,r,t[o+13],21,1309151649),r=Ca(r,i,s,n,t[o+4],6,-145523070),n=Ca(n,r,i,s,t[o+11],10,-1120210379),s=Ca(s,n,r,i,t[o+2],15,718787259),i=Ca(i,s,n,r,t[o+9],21,-343485551),r=O_(r,a),i=O_(i,l),s=O_(s,c),n=O_(n,h)}return[r,i,s,n]}function p1e(t,e=Cx.Hex){const r=e||Cx.Base64,i=yGe(dGe(t),t.length*m2);switch(r){case Cx.Raw:return i;case Cx.Hex:return fGe(i);case Cx.String:return pGe(i);case Cx.Base64:return mGe(i)}}var ij;let y3=ij=class extends m6{writeLevels(t,e,r){for(const i in t){const s=this.levels[i];return void(e.stops=s)}}clone(){return new ij({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:A_(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:A_(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(t=>t.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone(),levels:K(this.levels)})}};u([d()],y3.prototype,"levels",void 0),u([ke("levels")],y3.prototype,"writeLevels",null),y3=ij=u([P("esri.views.2d.engine.LevelDependentSizeVariable")],y3);const _Ge=Q.getLogger("esri.views.2d.layers.support.clusterUtils");oe.add("esri-cluster-arcade-enabled",!0);const vGe=oe("esri-cluster-arcade-enabled"),bGe=(t,e,r,i,s)=>{const n=e.clone();if(!SGe(n))return n;if(n.authoringInfo||(n.authoringInfo=new VZ),n.authoringInfo.isAutoGenerated=!0,"visualVariables"in n){const o=(n.visualVariables||[]).filter(l=>l.valueExpression!=="$view.scale"),a=wGe(o);o.forEach(l=>{l.type==="rotation"?l.field?l.field=kv(t,l.field,"avg_angle","number"):l.valueExpression&&(l.field=LC(t,l.valueExpression,"avg_angle","number"),l.valueExpression=null):l.normalizationField?(l.field=kv(t,l.field,"avg_norm","number",l.normalizationField),l.normalizationField=null):l.field?l.field=kv(t,l.field,"avg","number"):l.valueExpression&&(l.field=LC(t,l.valueExpression,"avg","number"),l.valueExpression=null)}),a==null&&!xGe(o)&&s&&(o.push(TGe(r,i)),n.dynamicClusterSize=!0),n.visualVariables=o}switch(n.type){case"simple":break;case"pie-chart":for(const o of n.attributes)o.field?o.field=kv(t,o.field,"sum","number"):o.valueExpression&&(o.field=LC(t,o.valueExpression,"sum","number"),o.valueExpression=null);break;case"unique-value":n.field?n.field=kv(t,n.field,"mode","string"):n.valueExpression&&(n.field=LC(t,n.valueExpression,"mode","string"),n.valueExpression=null);break;case"class-breaks":n.normalizationField?(n.field=kv(t,n.field,"avg_norm","number",n.normalizationField),n.normalizationField=null):n.field?n.field=kv(t,n.field,"avg","number"):n.valueExpression&&(n.field=LC(t,n.valueExpression,"avg","number"),n.valueExpression=null)}return n},wGe=t=>{for(const e of t)if(e.type==="size")return e;return null},xGe=t=>{for(const e of t)if(e.field==="cluster_count")return!0;return!1},TGe=(t,e)=>{const r=[new qT({value:0,size:0}),new qT({value:1})];if(e==null)return new m6({field:"cluster_count",stops:[...r,new qT({value:2,size:0})]});const i=Object.keys(e).reduce((s,n)=>({...s,[n]:[...r,new qT({value:Math.max(2,e[n].minValue),size:t.clusterMinSize}),new qT({value:Math.max(3,e[n].maxValue),size:t.clusterMaxSize})]}),{});return new y3({field:"cluster_count",levels:i})},SGe=t=>{const e=r=>_Ge.error(new V("Unsupported-renderer",r,{renderer:t}));if(!t)return!1;switch(t.type){case"unique-value":if(t.field2||t.field3)return e("FeatureReductionCluster does not support multi-field UniqueValueRenderers"),!1;break;case"class-breaks":if(t.normalizationField){const r=t.normalizationType;if(r!=="field")return e(`FeatureReductionCluster does not support a normalizationType of ${r}`),!1}break;case"simple":case"pie-chart":break;default:return e(`FeatureReductionCluster does not support renderers of type ${t.type}`),!1}if(!vGe){if("valueExpression"in t&&t.valueExpression)return e("FeatureReductionCluster does not currently support renderer.valueExpression. Support will be added in a future release"),!1;if(("visualVariables"in t&&t.visualVariables||[]).some(r=>!(!("valueExpression"in r)||!r.valueExpression)))return e("FeatureReductionCluster does not currently support visualVariables with a valueExpression. Support will be added in a future release"),!1}return!0};function EGe(t,e,r){switch(t){case"sum":return`cluster_sum_${e}`;case"avg":case"avg_angle":return`cluster_avg_${e}`;case"mode":return`cluster_type_${e}`;case"avg_norm":{const i=r,s="field",n=e.toLowerCase()+",norm:"+s+","+i.toLowerCase();return"cluster_avg_"+p1e(n)}}}function LC(t,e,r,i){const s=p1e(e),n=r==="mode"?`cluster_type_${s}`:r==="sum"?`cluster_sum_${s}`:`cluster_avg_${s}`;return t.some(o=>o.name===n)||t.push(new Rw({name:n,isAutoGenerated:!0,onStatisticExpression:new fY({expression:e,returnType:i}),statisticType:r})),n}function kv(t,e,r,i,s){if(e==="cluster_count"||t.some(o=>o.name===e))return e;const n=EGe(r,e,s);return t.some(o=>o.name===n)||(r==="avg_norm"?t.push(new Rw({name:n,isAutoGenerated:!0,onStatisticExpression:new fY({expression:`$feature.${e} / $feature.${s}`,returnType:i}),statisticType:"avg"})):t.push(new Rw({name:n,isAutoGenerated:!0,onStatisticField:e,statisticType:r}))),n}const CGe=t=>{let e=class extends t{constructor(...r){super(...r),this.own(this.watch("renderer",()=>{if(this.featureReduction){const i=this._normalizeFeatureReduction(this.featureReduction);this._set("featureReduction",i)}},!0))}set featureReduction(r){const i=this._normalizeFeatureReduction(r);this._set("featureReduction",i)}set renderer(r){}_normalizeFeatureReduction(r){if(r?.type!=="cluster")return r;const i=r.clone(),s=[new Rw({name:"cluster_count",isAutoGenerated:!0,statisticType:"count"})],n=(i.fields??[]).filter(a=>!a.isAutoGenerated);if(r.renderer&&!r.renderer.authoringInfo?.isAutoGenerated)return i.fields=[...s,...n],i;if(r.symbol)return i.fields=[...s,...n],i.renderer=null,i;if(!this.renderer)return r;const o=bGe(s,this.renderer,r,null,!1);return i.fields=[...s,...n],i.renderer=o,i}};return u([d(hGe)],e.prototype,"featureReduction",null),e=u([P("esri.layers.mixins.FeatureReductionLayer")],e),e},die={ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CSV:!0,GeoRSS:!0,GeoJSON:!0,GroupLayer:!0,KML:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},pie={ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0},fie={ArcGISFeatureLayer:!0},AGe={"web-scene/operational-layers":{ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,GroupLayer:!0,IntegratedMeshLayer:!0,OGCFeatureLayer:!0,PointCloudLayer:!0,WebTiledLayer:!0,CSV:!0,GeoJSON:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,KML:!0,RasterDataLayer:!0,Voxel:!0,LineOfSightLayer:!0},"web-scene/basemap":{ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,WebTiledLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,ArcGISImageServiceLayer:!0,WMS:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-map/operational-layers":die,"web-map/basemap":pie,"web-map/tables":fie,"link-chart/operational-layers":{...die,LinkChartLayer:!0},"link-chart/basemap":pie,"link-chart/tables":fie,"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISSceneServiceLayer:!0,PointCloudLayer:!0,BuildingSceneLayer:!0,IntegratedMeshLayer:!0,OrientedImageryLayer:!0}},f1e=t=>{let e=class extends t{constructor(){super(...arguments),this.title=null}writeListMode(r,i,s,n){(n&&n.layerContainerType==="ground"||r&&FLe(this,s,{},n))&&(i[s]=r)}writeOperationalLayerType(r,i,s,n){!r||n&&n.layerContainerType==="tables"||(i.layerType=r)}writeTitle(r,i){i.title=r??"Layer"}read(r,i){i&&(i.layer=this),LLe(this,r,s=>super.read(r,s),i)}write(r,i){if(i?.origin){const o=`${i.origin}/${i.layerContainerType||"operational-layers"}`;let l=!!AGe[o]?.[this.operationalLayerType];if(this.operationalLayerType==="ArcGISTiledElevationServiceLayer"&&o==="web-scene/operational-layers"&&(l=!1),this.operationalLayerType==="ArcGISDimensionLayer"&&o==="web-map/operational-layers"&&(l=!1),!l)return i.messages?.push(new V("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${o}'`,{layer:this})),null}const s=super.write(r,{...i,layer:this}),n=!!i&&!!i.messages&&!!i.messages.filter(o=>o instanceof V&&o.name==="web-document-write:property-required").length;return W_(s?.url)?(i?.messages?.push(new V("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&n?null:s}beforeSave(){}};return u([d({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],e.prototype,"id",void 0),u([d(e1e)],e.prototype,"listMode",void 0),u([ke("listMode")],e.prototype,"writeListMode",null),u([d({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1}}}})],e.prototype,"operationalLayerType",void 0),u([ke("operationalLayerType")],e.prototype,"writeOperationalLayerType",null),u([d(j7)],e.prototype,"opacity",void 0),u([d({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],e.prototype,"title",void 0),u([ke("title"),ke(["web-scene"],"title")],e.prototype,"writeTitle",null),u([d({type:Boolean,json:{name:"visibility"}})],e.prototype,"visible",void 0),e=u([P("esri.layers.mixins.OperationalLayer")],e),e};var sj;const t9=new $r({asc:"ascending",desc:"descending"});let nS=sj=class extends le{constructor(t){super(t),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new sj({field:this.field,valueExpression:this.valueExpression,order:this.order})}};u([d({type:String,json:{write:!0}})],nS.prototype,"field",void 0),u([d({type:String,json:{write:!0}})],nS.prototype,"valueExpression",void 0),u([d({type:t9.apiValues,json:{read:t9.read,write:t9.write}})],nS.prototype,"order",void 0),nS=sj=u([P("esri.layers.support.OrderByInfo")],nS);const m1e=nS;function OGe(t,e,r){if(!t)return null;const i=t.find(n=>!!n.field);if(!i)return null;const s=new m1e;return s.read(i,r),[s]}function RGe(t,e,r,i){const s=t.find(n=>!!n.field);s&&tl(r,[s.toJSON()],e)}const MGe=t=>{let e=class extends t{constructor(){super(...arguments),this.orderBy=null}};return u([d({type:[m1e],json:{origins:{"web-scene":{write:!1,read:!1}},read:{source:"layerDefinition.orderBy",reader:OGe},write:{target:"layerDefinition.orderBy",writer:RGe}}})],e.prototype,"orderBy",void 0),e=u([P("esri.layers.mixins.OrderedLayer")],e),e};let r9,ee=null;function g1e(){return!!ee}function PGe(){return!!oe("esri-wasm")}function y1e(){return r9||(r9=ce(()=>import("./pe-wasm-05c57bb1.js"),[],import.meta.url).then(t=>t.p).then(({default:t})=>t({locateFile:e=>Gr(`esri/geometry/support/${e}`)})).then(t=>{v1e(t)}),r9)}var nj,Os,oj;(function(t){function e(n,o,a){ee.ensureCache.prepare();const l=xb(a),c=a===l,h=ee.ensureFloat64(l),p=ee._pe_geog_to_proj(ee.getPointer(n),o,h);return p&&f_(a,o,h,c),p}function r(n,o,a,l){switch(l){case Os.PE_TRANSFORM_P_TO_G:return i(n,o,a);case Os.PE_TRANSFORM_G_TO_P:return e(n,o,a)}return 0}function i(n,o,a){return s(n,o,a,0)}function s(n,o,a,l){ee.ensureCache.prepare();const c=xb(a),h=a===c,p=ee.ensureFloat64(c),f=ee._pe_proj_to_geog_center(ee.getPointer(n),o,p,l);return f&&f_(a,o,p,h),f}t.geogToProj=e,t.projGeog=r,t.projToGeog=i,t.projToGeogCenter=s})(nj||(nj={})),function(t){function e(){t.PE_BUFFER_MAX=ee.PeDefs.prototype.PE_BUFFER_MAX,t.PE_NAME_MAX=ee.PeDefs.prototype.PE_NAME_MAX,t.PE_MGRS_MAX=ee.PeDefs.prototype.PE_MGRS_MAX,t.PE_USNG_MAX=ee.PeDefs.prototype.PE_USNG_MAX,t.PE_DD_MAX=ee.PeDefs.prototype.PE_DD_MAX,t.PE_DDM_MAX=ee.PeDefs.prototype.PE_DDM_MAX,t.PE_DMS_MAX=ee.PeDefs.prototype.PE_DMS_MAX,t.PE_UTM_MAX=ee.PeDefs.prototype.PE_UTM_MAX,t.PE_PARM_MAX=ee.PeDefs.prototype.PE_PARM_MAX,t.PE_TYPE_NONE=ee.PeDefs.prototype.PE_TYPE_NONE,t.PE_TYPE_GEOGCS=ee.PeDefs.prototype.PE_TYPE_GEOGCS,t.PE_TYPE_PROJCS=ee.PeDefs.prototype.PE_TYPE_PROJCS,t.PE_TYPE_GEOGTRAN=ee.PeDefs.prototype.PE_TYPE_GEOGTRAN,t.PE_TYPE_COORDSYS=ee.PeDefs.prototype.PE_TYPE_COORDSYS,t.PE_TYPE_UNIT=ee.PeDefs.prototype.PE_TYPE_UNIT,t.PE_TYPE_LINUNIT=ee.PeDefs.prototype.PE_TYPE_LINUNIT,t.PE_STR_OPTS_NONE=ee.PeDefs.prototype.PE_STR_OPTS_NONE,t.PE_STR_AUTH_NONE=ee.PeDefs.prototype.PE_STR_AUTH_NONE,t.PE_STR_AUTH_TOP=ee.PeDefs.prototype.PE_STR_AUTH_TOP,t.PE_STR_NAME_CANON=ee.PeDefs.prototype.PE_STR_NAME_CANON,t.PE_PARM_X0=ee.PeDefs.prototype.PE_PARM_X0,t.PE_PARM_ND=ee.PeDefs.prototype.PE_PARM_ND,t.PE_TRANSFORM_1_TO_2=ee.PeDefs.prototype.PE_TRANSFORM_1_TO_2,t.PE_TRANSFORM_2_TO_1=ee.PeDefs.prototype.PE_TRANSFORM_2_TO_1,t.PE_TRANSFORM_P_TO_G=ee.PeDefs.prototype.PE_TRANSFORM_P_TO_G,t.PE_TRANSFORM_G_TO_P=ee.PeDefs.prototype.PE_TRANSFORM_G_TO_P,t.PE_HORIZON_RECT=ee.PeDefs.prototype.PE_HORIZON_RECT,t.PE_HORIZON_POLY=ee.PeDefs.prototype.PE_HORIZON_POLY,t.PE_HORIZON_LINE=ee.PeDefs.prototype.PE_HORIZON_LINE,t.PE_HORIZON_DELTA=ee.PeDefs.prototype.PE_HORIZON_DELTA}t.init=e}(Os||(Os={})),function(t){const e={},r={},i=m=>{if(m){const y=m.getType();switch(y){case Os.PE_TYPE_GEOGCS:m=ee.castObject(m,ee.PeGeogcs);break;case Os.PE_TYPE_PROJCS:m=ee.castObject(m,ee.PeProjcs);break;case Os.PE_TYPE_GEOGTRAN:m=ee.castObject(m,ee.PeGeogtran);break;default:y&Os.PE_TYPE_UNIT&&(m=ee.castObject(m,ee.PeUnit))}}return m};function s(){ee.PeFactory.prototype.initialize(null)}function n(m){return o(Os.PE_TYPE_COORDSYS,m)}function o(m,y){let _=null,v=e[m];if(v||(v={},e[m]=v),v.hasOwnProperty(String(y)))_=v[y];else{const b=ee.PeFactory.prototype.factoryByType(m,y);ee.compare(b,ee.NULL)||(_=b,v[y]=_)}return _=i(_),_}function a(m,y){let _=null,v=r[m];if(v||(v={},r[m]=v),v.hasOwnProperty(y))_=v[y];else{const b=ee.PeFactory.prototype.fromString(m,y);ee.compare(b,ee.NULL)||(_=b,v[y]=_)}return _=i(_),_}function l(m){return o(Os.PE_TYPE_GEOGCS,m)}function c(m){return o(Os.PE_TYPE_GEOGTRAN,m)}function h(m){return ee.PeFactory.prototype.getCode(m)}function p(m){return o(Os.PE_TYPE_PROJCS,m)}function f(m){return o(Os.PE_TYPE_UNIT,m)}t.initialize=s,t.coordsys=n,t.factoryByType=o,t.fromString=a,t.geogcs=l,t.geogtran=c,t.getCode=h,t.projcs=p,t.unit=f}(oj||(oj={}));let _1e=null;var D4,aj,lj,cj,N4,uj,F4,U4,hj;function v1e(t){function e(n,o,a){n[o]=a(n[o])}ee=t,Os.init(),D4.init(),N4.init(),F4.init(),U4.init(),_1e=class extends ee.PeGCSExtent{destroy(){ee.destroy(this)}};const r=[ee.PeDatum,ee.PeGeogcs,ee.PeGeogtran,ee.PeObject,ee.PeParameter,ee.PePrimem,ee.PeProjcs,ee.PeSpheroid,ee.PeUnit];for(const n of r)e(n.prototype,"getName",o=>function(){return o.call(this,new Array(Os.PE_NAME_MAX))});for(const n of[ee.PeGeogtran,ee.PeProjcs])e(n.prototype,"getParameters",o=>function(){const a=new Array(Os.PE_PARM_MAX);let l=o.call(this);for(let c=0;c<a.length;c++){const h=ee.getValue(l,"*");a[c]=h?ee.wrapPointer(h,ee.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return a});e(ee.PeHorizon.prototype,"getCoord",n=>function(){const o=this.getSize();if(!o)return null;const a=[];return f_(a,o,n.call(this)),a}),e(ee.PeGTlistExtendedEntry.prototype,"getEntries",n=>{const o=ee._pe_getPeGTlistExtendedGTsSize();return function(){let a=null;const l=n.call(this);if(!ee.compare(l,ee.NULL)){a=[l];const c=this.getSteps();if(c>1){const h=ee.getPointer(l);for(let p=1;p<c;p++)a.push(ee.wrapPointer(h+o*p,ee.PeGTlistExtendedGTs))}}return a}});const i=ee._pe_getPeHorizonSize(),s=n=>function(){let o=this._cache;if(o||(o=new Map,this._cache=o),o.has(n))return o.get(n);let a=null;const l=n.call(this);if(!ee.compare(l,ee.NULL)){a=[l];const c=l.getNump();if(c>1){const h=ee.getPointer(l);for(let p=1;p<c;p++)a.push(ee.wrapPointer(h+i*p,ee.PeHorizon))}}return o.set(n,a),a};e(ee.PeProjcs.prototype,"horizonGcsGenerate",s),e(ee.PeProjcs.prototype,"horizonPcsGenerate",s),ee.PeObject.prototype.toString=function(n=Os.PE_STR_OPTS_NONE){ee.ensureCache.prepare();const o=ee.getPointer(this),a=ee.ensureInt8(new Array(Os.PE_BUFFER_MAX));return ee.UTF8ToString(ee._pe_object_to_string_ext(o,n,a))}}function Im(t){if(!t)return;const e=ee.getClass(t);if(!e)return;const r=ee.getCache(e);if(!r)return;const i=ee.getPointer(t);i&&delete r[i]}function nI(t,e){const r=[],i=new Array(e);for(let s=0;s<t;s++)r.push(ee.ensureInt8(i));return r}function xb(t){let e;return Array.isArray(t[0])?(e=[],t.forEach(r=>{e.push(r[0],r[1])})):e=t,e}function f_(t,e,r,i=!1){if(i)for(let s=0;s<2*e;s++)t[s]=ee.getValue(r+s*Float64Array.BYTES_PER_ELEMENT,"double");else{const s=t.length===0;for(let n=0;n<e;n++)s&&(t[n]=new Array(2)),t[n][0]=ee.getValue(r,"double"),t[n][1]=ee.getValue(r+Float64Array.BYTES_PER_ELEMENT,"double"),r+=2*Float64Array.BYTES_PER_ELEMENT}}(function(t){let e;function r(){t.PE_GTLIST_OPTS_COMMON=ee.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,e=ee._pe_getPeGTlistExtendedEntrySize()}function i(s,n,o,a,l,c){let h=null;const p=new ee.PeInteger(c);try{const f=ee.PeGTlistExtended.prototype.getGTlist(s,n,o,a,l,p);if((c=p.val)&&(h=[f],c>1)){const m=ee.getPointer(f);for(let y=1;y<c;y++)h.push(ee.wrapPointer(m+e*y,ee.PeGTlistExtendedEntry))}}finally{ee.destroy(p)}return h}t.init=r,t.getGTlist=i})(D4||(D4={})),function(t){function e(r){if(r&&r.length){for(const i of r)Im(i),i.getEntries().forEach(s=>{Im(s);const n=s.getGeogtran();Im(n),n.getParameters().forEach(Im),[n.getGeogcs1(),n.getGeogcs2()].forEach(o=>{Im(o);const a=o.getDatum();Im(a),Im(a.getSpheroid()),Im(o.getPrimem()),Im(o.getUnit())})});ee.PeGTlistExtendedEntry.prototype.Delete(r[0])}}t.destroy=e}(aj||(aj={})),function(t){function e(r,i,s,n,o){ee.ensureCache.prepare();const a=xb(s),l=s===a,c=ee.ensureFloat64(a);let h=0;n&&(h=ee.ensureFloat64(n));const p=ee._pe_geog_to_geog(ee.getPointer(r),i,c,h,o);return p&&f_(s,i,c,l),p}t.geogToGeog=e}(lj||(lj={})),function(t){const e=(c,h,p,f,m,y)=>{let _,v;switch(ee.ensureCache.prepare(),c){case"dd":_=ee._pe_geog_to_dd,v=Os.PE_DD_MAX;break;case"ddm":_=ee._pe_geog_to_ddm,v=Os.PE_DDM_MAX;break;case"dms":_=ee._pe_geog_to_dms,v=Os.PE_DMS_MAX}let b=0;h&&(b=ee.getPointer(h));const T=xb(f),x=ee.ensureFloat64(T),S=nI(p,v),E=_(b,p,x,m,ee.ensureInt32(S));if(E)for(let A=0;A<p;A++)y[A]=ee.UTF8ToString(S[A]);return E},r=(c,h,p,f,m)=>{let y;switch(ee.ensureCache.prepare(),c){case"dd":y=ee._pe_dd_to_geog;break;case"ddm":y=ee._pe_ddm_to_geog;break;case"dms":y=ee._pe_dms_to_geog}let _=0;h&&(_=ee.getPointer(h));const v=f.map(S=>ee.ensureString(S)),b=ee.ensureInt32(v),T=ee.ensureFloat64(new Array(2*p)),x=y(_,p,b,T);return x&&f_(m,p,T),x};function i(c,h,p,f,m){return e("dms",c,h,p,f,m)}function s(c,h,p,f){return r("dms",c,h,p,f)}function n(c,h,p,f,m){return e("ddm",c,h,p,f,m)}function o(c,h,p,f){return r("ddm",c,h,p,f)}function a(c,h,p,f,m){return e("dd",c,h,p,f,m)}function l(c,h,p,f){return r("dd",c,h,p,f)}t.geogToDms=i,t.dmsToGeog=s,t.geogToDdm=n,t.ddmToGeog=o,t.geogToDd=a,t.ddToGeog=l}(cj||(cj={})),function(t){function e(){t.PE_MGRS_STYLE_NEW=ee.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,t.PE_MGRS_STYLE_OLD=ee.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,t.PE_MGRS_STYLE_AUTO=ee.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,t.PE_MGRS_180_ZONE_1_PLUS=ee.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,t.PE_MGRS_ADD_SPACES=ee.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function r(s,n,o,a,l,c,h){ee.ensureCache.prepare();let p=0;s&&(p=ee.getPointer(s));const f=xb(o),m=ee.ensureFloat64(f),y=nI(n,Os.PE_MGRS_MAX),_=ee.ensureInt32(y),v=ee._pe_geog_to_mgrs_extended(p,n,m,a,l,c,_);if(v)for(let b=0;b<n;b++)h[b]=ee.UTF8ToString(y[b]);return v}function i(s,n,o,a,l){ee.ensureCache.prepare();let c=0;s&&(c=ee.getPointer(s));const h=o.map(y=>ee.ensureString(y)),p=ee.ensureInt32(h),f=ee.ensureFloat64(new Array(2*n)),m=ee._pe_mgrs_to_geog_extended(c,n,p,a,f);return m&&f_(l,n,f),m}t.init=e,t.geogToMgrsExtended=r,t.mgrsToGeogExtended=i}(N4||(N4={})),function(t){function e(i,s,n,o,a,l,c){ee.ensureCache.prepare();let h=0;i&&(h=ee.getPointer(i));const p=xb(n),f=ee.ensureFloat64(p),m=nI(s,Os.PE_MGRS_MAX),y=ee.ensureInt32(m),_=ee._pe_geog_to_usng(h,s,f,o,a,l,y);if(_)for(let v=0;v<s;v++)c[v]=ee.UTF8ToString(m[v]);return _}function r(i,s,n,o){ee.ensureCache.prepare();let a=0;i&&(a=ee.getPointer(i));const l=n.map(f=>ee.ensureString(f)),c=ee.ensureInt32(l),h=ee.ensureFloat64(new Array(2*s)),p=ee._pe_usng_to_geog(a,s,c,h);return p&&f_(o,s,h),p}t.geogToUsng=e,t.usngToGeog=r}(uj||(uj={})),function(t){function e(){t.PE_UTM_OPTS_NONE=ee.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,t.PE_UTM_OPTS_ADD_SPACES=ee.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,t.PE_UTM_OPTS_NS=ee.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function r(s,n,o,a,l){ee.ensureCache.prepare();let c=0;s&&(c=ee.getPointer(s));const h=xb(o),p=ee.ensureFloat64(h),f=nI(n,Os.PE_UTM_MAX),m=ee.ensureInt32(f),y=ee._pe_geog_to_utm(c,n,p,a,m);if(y)for(let _=0;_<n;_++)l[_]=ee.UTF8ToString(f[_]);return y}function i(s,n,o,a,l){ee.ensureCache.prepare();let c=0;s&&(c=ee.getPointer(s));const h=o.map(y=>ee.ensureString(y)),p=ee.ensureInt32(h),f=ee.ensureFloat64(new Array(2*n)),m=ee._pe_utm_to_geog(c,n,p,a,f);return m&&f_(l,n,f),m}t.init=e,t.geogToUtm=r,t.utmToGeog=i}(F4||(F4={})),function(t){const e=new Map;function r(){t.PE_PCSINFO_OPTION_NONE=ee.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,t.PE_PCSINFO_OPTION_DOMAIN=ee.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,t.PE_POLE_OUTSIDE_BOUNDARY=ee.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,t.PE_POLE_POINT=ee.PePCSInfo.prototype.PE_POLE_POINT}function i(s,n=t.PE_PCSINFO_OPTION_DOMAIN){let o=null,a=null;return e.has(s)&&(a=e.get(s),a[n]&&(o=a[n])),o||(o=ee.PePCSInfo.prototype.generate(s,n),a||(a=[],e.set(s,a)),a[n]=o),o}t.init=r,t.generate=i}(U4||(U4={})),function(t){function e(){return ee.PeVersion.prototype.version_string()}t.versionString=e}(hj||(hj={}));const IGe=Object.freeze(Object.defineProperty({__proto__:null,get PeCSTransformations(){return nj},get PeDefs(){return Os},get PeFactory(){return oj},get PeGCSExtent(){return _1e},get PeGTTransformations(){return lj},get PeGTlistExtended(){return D4},get PeGTlistExtendedEntry(){return aj},get PeNotationDms(){return cj},get PeNotationMgrs(){return N4},get PeNotationUsng(){return uj},get PeNotationUtm(){return F4},get PePCSInfo(){return U4},get PeVersion(){return hj},_init:v1e,get _pe(){return ee},isLoaded:g1e,isSupported:PGe,load:y1e},Symbol.toStringTag,{value:"Module"})),tDt=Math.PI/180,rDt=/SPHEROID\[([^\]]+)]/i,Zy=or.radius,nd=or.eccentricitySquared,$Ge={a1:Zy*nd,a2:Zy*nd*Zy*nd,a3:Zy*nd*nd/2,a4:Zy*nd*Zy*nd*2.5,a5:Zy*nd+Zy*nd*nd/2,a6:1-nd},iDt={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:or.radius,f:or.flattening},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:ny.radius,f:ny.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:Hf.radius,f:Hf.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:Hf.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};let oI=0,i9=class dj{static fromGE(e){const r=new dj;return r._wkt=e.wkt,r._wkid=e.wkid,r._isInverse=e.isInverse,r}constructor(e){this.uid=oI++,e?(this._wkt=e.wkt!=null?e.wkt:null,this._wkid=e.wkid!=null?e.wkid:-1,this._isInverse=e.isInverse!=null&&e.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}get wkt(){return this._wkt}set wkt(e){this._wkt=e,this.uid=oI++}get wkid(){return this._wkid}set wkid(e){this._wkid=e,this.uid=oI++}get isInverse(){return this._isInverse}set isInverse(e){this._isInverse=e,this.uid=oI++}getInverse(){const e=new dj;return e._wkt=this.wkt,e._wkid=this._wkid,e._isInverse=!this.isInverse,e}},k4=class _3{static cacheKey(e,r){return[e.wkid!==void 0&&e.wkid!==null?e.wkid.toString():"-1",e.wkt!==void 0&&e.wkt!==null?e.wkt.toString():"",r.wkid!==void 0&&r.wkid!==null?r.wkid.toString():"-1",r.wkt!==void 0&&r.wkt!==null?r.wkt.toString():""].join(",")}static fromGE(e){const r=new _3;let i="";for(const s of e.steps){const n=i9.fromGE(s);r.steps.push(n),i+=n.uid.toString()+","}return r._cachedProjection={},r._gtlistentry=null,r._chain=i,r}constructor(e){if(this.steps=[],this._cachedProjection={},this._chain="",this._gtlistentry=null,e&&e.steps)for(const r of e.steps)r instanceof i9?this.steps.push(r):this.steps.push(new i9({wkid:r.wkid,wkt:r.wkt,isInverse:r.isInverse}))}getInverse(){const e=new _3;e.steps=[];for(let r=this.steps.length-1;r>=0;r--){const i=this.steps[r];e.steps.push(i.getInverse())}return e}getGTListEntry(){let e="";for(const r of this.steps)e+=r.uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=e),this._gtlistentry}assignCachedGe(e,r,i){this._cachedProjection[_3.cacheKey(e,r)]=i}getCachedGeTransformation(e,r){let i="";for(const n of this.steps)i+=n.uid.toString()+",";i!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=i);const s=this._cachedProjection[_3.cacheKey(e,r)];return s===void 0?null:s}},fp=null,ev=null,MO=null,UD={};const b1e=new V5;function I6(){return!!fp&&g1e()}function PR(t){return MO==null&&(MO=Promise.all([y1e(),ce(()=>import("./geometryEngineBase-c1c9526a.js"),[],import.meta.url).then(e=>e.g),ce(()=>import("./hydrated-bc13ab24.js"),[],import.meta.url)])),MO.then(([,e,{hydratedAdapter:r}])=>{Yt(t),ev=r,fp=e.default,fp._enableProjection(IGe),b1e.notify()})}function hx(t,e,r=null,i=null){return Array.isArray(t)?t.length===0?[]:pj(ev,t,t[0].spatialReference,e,r,i):pj(ev,[t],t.spatialReference,e,r,i)[0]}function pj(t,e,r,i,s=null,n=null){if(r==null||i==null)return e;if(lm(r,i,s))return e.map(o=>_Y(o,r,i));if(s==null){const o=k4.cacheKey(r,i);UD[o]!==void 0?s=UD[o]:((s=x1e(r,i,void 0))==null&&(s=new k4),UD[o]=s)}if(fp==null||t==null)throw new $6;return n!=null?fp._project(t,e,r,i,s,n):fp._project(t,e,r,i,s)}function LGe(t,e){const r=w1e([t],e);return r.pending!=null?{pending:r.pending,geometry:null}:r.geometries!=null?{pending:null,geometry:r.geometries[0]}:{pending:null,geometry:null}}function w1e(t,e){if(!I6()){for(const r of t)if(r!=null&&!Pn(r.spatialReference,e)&&ua(r.spatialReference)&&ua(e)&&!lm(r.spatialReference,e))return Wt(b1e),{pending:PR(),geometries:null}}return{pending:null,geometries:t.map(r=>r==null?null:Pn(r.spatialReference,e)?r:ua(r.spatialReference)&&ua(e)?T1e(r,e):null)}}function x1e(t,e,r=null){if(t==null||e==null)return null;if(fp==null||ev==null)throw new $6;const i=fp._getTransformation(ev,t,e,r,r?.spatialReference);return i!==null?k4.fromGE(i):null}function DGe(t,e,r=null){if(fp==null||ev==null)throw new $6;const i=fp._getTransformationBySuitability(ev,t,e,r,r?.spatialReference);if(i!==null){const s=[];for(const n of i)s.push(k4.fromGE(n));return s}return[]}class $6 extends V{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}var X;function NGe(){fp=null,ev=null,MO=null,UD={}}(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",t[t.WGS84=2]="WGS84",t[t.WEB_MERCATOR=3]="WEB_MERCATOR",t[t.WGS84_ECEF=4]="WGS84_ECEF",t[t.CGCS2000=5]="CGCS2000",t[t.WGS84_COMPARABLE_LON_LAT=6]="WGS84_COMPARABLE_LON_LAT",t[t.SPHERICAL_MARS_PCPF=7]="SPHERICAL_MARS_PCPF",t[t.GCSMARS2000=8]="GCSMARS2000",t[t.SPHERICAL_MOON_PCPF=9]="SPHERICAL_MOON_PCPF",t[t.GCSMOON2000=10]="GCSMOON2000",t[t.LON_LAT=11]="LON_LAT",t[t.PLATE_CARREE=12]="PLATE_CARREE"})(X||(X={}));const FGe={get loadPromise(){return MO}};function T1e(t,e){try{const r=hx(t,e);if(r==null)return null;"xmin"in t&&"xmin"in r&&(r.zmin=t.zmin,r.zmax=t.zmax);const i=cve(r.type,t.spatialReference,e);return i?.(r),r}catch(r){if(!(r instanceof $6))throw r;return null}}function lm(t,e,r){return!r&&(!!Pn(t,e)||ua(t)&&ua(e)&&!!xY(t,e,SY))}async function S1e(t,e,r,i){if(I6())return vee(i);if(Array.isArray(t)){for(const{source:s,dest:n,geographicTransformation:o}of t)if(!lm(s,n,o))return PR(i)}else if(!lm(t,e,r))return PR(i);return vee(i)}function UGe(t,e){switch(xY(t,e,SY)){case Ai:return"copy3";case M_:return"wgs84ToSphericalECEF";case Mw:return"wgs84ToWebMercator";case R_:return"wgs84ToPlateCarree";case I_:return"wgs84ToWGS84ECEF";case rw:return"webMercatorToWGS84";case N1e:return"webMercatorToSphericalECEF";case F1e:return"webMercatorToWGS84ECEF";case U1e:return"webMercatorToPlateCarree";case $_:return"wgs84ECEFToWGS84";case B1e:return"wgs84ECEFToSphericalECEF";case G1e:return"wgs84ECEFToWebMercator";case P_:return"sphericalECEFToWGS84";case z1e:return"sphericalECEFToWebMercator";case _j:return"sphericalMarsPCPFToMars2000";case yj:return"sphericalMoonPCPFToMoon2000";case V1e:return"sphericalECEFToWGS84ECEF";case gj:return"mars2000ToSphericalPCPF";case mj:return"moon2000ToSphericalPCPF";default:return null}}function _Y(t,e,r){return t?"x"in t?C1e(t,e,new Ke,r,0):"xmin"in t?P1e(t,e,new ur,r,0):"rings"in t?M1e(t,e,new yu,r,0):"paths"in t?O1e(t,e,new e6,r,0):"points"in t?A1e(t,e,new AM,r,0):null:null}function E1e(t,e,r=e.spatialReference,i=0){return r!=null&&t.spatialReference!=null&&C1e(t,t.spatialReference,e,r,i)!=null}function C1e(t,e,r,i,s){Vr[0]=t.x,Vr[1]=t.y;const n=t.z;return Vr[2]=n!==void 0?n:s,li(Vr,e,0,Vr,i,0,1)?(r.x=Vr[0],r.y=Vr[1],r.spatialReference=i,n===void 0?(r.z=void 0,r.hasZ=!1):(r.z=Vr[2],r.hasZ=!0),t.m===void 0?(r.m=void 0,r.hasM=!1):(r.m=t.m,r.hasM=!0),r):null}function kGe(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&A1e(t,t.spatialReference,e,r,i)!=null}function A1e(t,e,r,i,s){const{points:n,hasZ:o,hasM:a}=t,l=[],c=n.length,h=[];for(const p of n)h.push(p[0],p[1],o?p[2]:s);if(!li(h,e,0,h,i,0,c))return null;for(let p=0;p<c;++p){const f=3*p,m=h[f],y=h[f+1];o&&a?l.push([m,y,h[f+2],n[p][3]]):o?l.push([m,y,h[f+2]]):a?l.push([m,y,n[p][2]]):l.push([m,y])}return r.points=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r}function zGe(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&O1e(t,t.spatialReference,e,r,i)!=null}function O1e(t,e,r,i,s){const{paths:n,hasZ:o,hasM:a}=t,l=[];return L1e(n,o??!1,a??!1,e,l,i,s)?(r.paths=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r):null}function VGe({hasZ:t,spatialReference:e,paths:r},i,s=0){const n=cm(e,nC),o=Mh[n][X.WGS84_COMPARABLE_LON_LAT];if(o==null)return!1;const a=t?l=>l:l=>se(Vr,l[0],l[1],s);for(const l of r){const c=[];for(const h of l){const p=[0,0,s];o(a(h),0,p,0),c.push(p)}i.push(c)}return!0}function BGe({hasZ:t,spatialReference:e,rings:r},i,s=0){const n=cm(e,nC),o=Mh[n][X.WGS84_COMPARABLE_LON_LAT];if(o==null)return!1;const a=t?l=>l:l=>se(Vr,l[0],l[1],s);for(const l of r){const c=[];for(const h of l){const p=[0,0,s];o(a(h),0,p,0),c.push(p)}i.push(c)}return!0}function R1e(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&M1e(t,t.spatialReference,e,r,i)!=null}function M1e(t,e,r,i,s){const{rings:n,hasZ:o,hasM:a}=t,l=[];return L1e(n,o??!1,a??!1,e,l,i,s)?(r.rings=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r):null}function GGe(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&P1e(t,t.spatialReference,e,r,i)!=null}function P1e(t,e,r,i,s){const{xmin:n,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:h}=t;return fj(n,o,c?t.zmin:s,e,Vr,i)?(r.xmin=Vr[0],r.ymin=Vr[1],c&&(r.zmin=Vr[2]),fj(a,l,c?t.zmax:s,e,Vr,i)?(r.xmax=Vr[0],r.ymax=Vr[1],c&&(r.zmax=Vr[2]),h&&(r.mmin=t.mmin,r.mmax=t.mmax),r.spatialReference=i,r):null):null}function dy(t,e,r){if(e==null||r==null)return null;const i=new Ke({spatialReference:r});return li(t,e,0,Vr,r,0,1)?(i.x=Vr[0],i.y=Vr[1],i.z=Vr[2],i):null}function vY(t,e,r){return li(t,e,0,Vr,r.spatialReference,0,1)?(r.x=Vr[0],r.y=Vr[1],r.z=Vr[2],r):null}function So(t,e,r,i=0){Vr[0]=t.x,Vr[1]=t.y;const s=t.z;return Vr[2]=s!==void 0?s:i,li(Vr,t.spatialReference,0,e,r,0,1)}function fj(t,e,r,i,s,n){return ss[0]=t,ss[1]=e,ss[2]=r,li(ss,i,0,s,n,0,1)}function Zs(t,e,r,i){return!(e==null||i==null||t.length<2)&&(t.length===2&&(ss[0]=t[0],ss[1]=t[1],ss[2]=0,t=ss),li(t,e,0,r,i,0,1))}function I1e(t,e){Vr[0]=t.x,Vr[1]=t.y;const r=t.z;return Vr[2]=r!==void 0?r:0,$1e(Vr,t.spatialReference,e)}function $1e(t,e,r){return jGe(t,e,r)}function jGe(t,e,r){if(e==null)return!1;const i=cm(e,nC),s=Mh[i][X.WGS84_COMPARABLE_LON_LAT];return s!=null&&(s(t,0,ss,0),r!==ss&&(r[0]=ss[0],r[1]=ss[1],r.length>2&&(r[2]=ss[2])),!0)}function li(t,e,r,i,s,n,o=1){const a=xY(e,s,SY);if(a==null)return!1;if(a===Ai){if(t===i&&r===n)return!0;const c=r+3*o;for(let h=r,p=n;h<c;h++,p++)i[p]=t[h];return!0}const l=r+3*o;for(let c=r,h=n;c<l;c+=3,h+=3)a(t,c,i,h);return!0}function HGe(t,e,r,i,s){re(Vr,t),ue(aI,t,e),Zs(Vr,r,Vr,s),Zs(aI,r,aI,s),de(i,aI,Vr),ye(i,i)}function L1e(t,e,r,i,s,n,o=0){const a=new Array;for(const c of t)for(const h of c)a.push(h[0],h[1],e?h[2]:o);if(!li(a,i,0,a,n,0,a.length/3))return!1;let l=0;s.length=0;for(const c of t){const h=new Array;for(const p of c)e&&r?h.push([a[l++],a[l++],a[l++],p[3]]):e?h.push([a[l++],a[l++],a[l++]]):r?(h.push([a[l++],a[l++],p[2]]),l++):(h.push([a[l++],a[l++]]),l++);s.push(h)}return!0}function qGe(t,e,r,i){if(e==null||i==null)return!1;const s=j1e(e,i,e7e);if(s.projector===Ai)return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],!0;if(s.projector==null)return!1;const{source:n,dest:o}=s;if(o.spatialReferenceId===X.WEB_MERCATOR){const a=Mh[n.spatialReferenceId][X.WGS84];return a!=null&&(a(t,0,Vd,0),Mw(Vd,0,r,0),r[3]=mie(Vd[1],t[2],t[3],or.radius),!0)}if(n.spatialReferenceId!==X.WGS84&&n.spatialReferenceId!==X.CGCS2000||o.spatialReferenceId!==X.PLATE_CARREE){s.projector(t,0,r,0);const a=n.metersPerUnit??1,l=o.metersPerUnit??1;r[3]=t[3]*a/l}else{const a=Mh[n.spatialReferenceId][X.SPHERICAL_ECEF],l=Mh[X.SPHERICAL_ECEF][X.PLATE_CARREE];let c=t[3];a!=null&&l!=null&&(c=mie(t[1],t[2],t[3],or.radius)),s.projector(t,0,r,0),r[3]=c}return!0}function mie(t,e,r,i){const s=i+e;if(s<i/2||r>s)return Number.MAX_VALUE;const n=Math.abs(op*t)+Math.asin(r/s);return n>=Math.PI/2?Number.MAX_VALUE:r/Math.cos(n)}function jM(t,e,r,i){return t!=null&&(Pn(e,i)?(oy(r,t),!0):(ss[0]=t[0],ss[1]=t[1],ss[2]=0,!!li(ss,e,0,ss,i,0,1)&&(r[0]=ss[0],r[1]=ss[1],ss[0]=t[2],ss[1]=t[3],ss[2]=0,!!li(ss,e,0,ss,i,0,1)&&(r[2]=ss[0],r[3]=ss[1],!0))))}function WGe(t,e,r,i){if(e==null||i==null)return!1;const s=cm(e,nC),n=cm(i,H1e);if(s===n&&s!==X.UNKNOWN||Pn(e,i))return r[0]=1,r[1]=1,r[2]=1,!0;if(s===X.SPHERICAL_ECEF){const o=Oe(t),a=o/Math.sqrt(t[0]*t[0]+t[1]*t[1]),l=o/or.radius;if(n===X.WEB_MERCATOR)return r[0]=a*l,r[1]=a*l,r[2]=1,!0;if(n===X.WGS84||n===X.CGCS2000){const c=PO;return r[0]=c*a*l,r[1]=c*l,r[2]=1,!0}}else if(s===X.PLATE_CARREE){if(n===X.WGS84||n===X.CGCS2000)return r[0]=PO,r[1]=PO,r[2]=1,!0;if(n===X.WEB_MERCATOR){const o=t[1]/or.radius;return r[0]=1,r[1]=1/Math.cos(o),r[2]=1,!0}}return!1}function Pl(t,e,r,i){if(t==null||i==null)return!1;const s=cm(t,nC),n=cm(i,H1e);if(s===n&&!gie(n)&&(s!==X.UNKNOWN||Pn(t,i)))return zM(r,e),!0;if(gie(n)){const o=Mh[s][X.LON_LAT],a=Mh[X.LON_LAT][n];return o!=null&&a!=null&&(o(e,0,Vd,0),a(Vd,0,Yy,0),bY(op*Vd[0],op*Vd[1],r),r[12]=Yy[0],r[13]=Yy[1],r[14]=Yy[2],!0)}if((n===X.WEB_MERCATOR||n===X.PLATE_CARREE)&&(s===X.WGS84||s===X.CGCS2000&&n===X.PLATE_CARREE||s===X.SPHERICAL_ECEF||s===X.WEB_MERCATOR)){const o=Mh[s][X.LON_LAT],a=Mh[X.LON_LAT][n];return o!=null&&a!=null&&(o(e,0,Vd,0),a(Vd,0,Yy,0),s===X.SPHERICAL_ECEF?D1e(op*Vd[0],op*Vd[1],r):zh(r),r[12]=Yy[0],r[13]=Yy[1],r[14]=Yy[2],!0)}return!1}function gie(t){return t===X.SPHERICAL_ECEF||t===X.SPHERICAL_MARS_PCPF||t===X.SPHERICAL_MOON_PCPF}function bY(t,e,r){const i=Math.sin(t),s=Math.cos(t),n=Math.sin(e),o=Math.cos(e),a=r;return a[0]=-i,a[4]=-n*s,a[8]=o*s,a[12]=0,a[1]=s,a[5]=-n*i,a[9]=o*i,a[13]=0,a[2]=0,a[6]=o,a[10]=n,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function D1e(t,e,r){return bY(t,e,r),$c(r,r),r}function cm(t,e){return t?e.spatialReference===t?e.spatialReferenceId:(e.spatialReference=t,"metersPerUnit"in e&&(e.metersPerUnit=_a(t,1)),t.wkt===Lme.wkt?e.spatialReferenceId=X.SPHERICAL_ECEF:gR(t)?e.spatialReferenceId=X.WGS84:_w(t)?e.spatialReferenceId=X.WEB_MERCATOR:yR(t)?e.spatialReferenceId=X.PLATE_CARREE:t.wkt===Dme.wkt?e.spatialReferenceId=X.WGS84_ECEF:t.wkid===Eh.CGCS2000?e.spatialReferenceId=X.CGCS2000:t.wkt===LX.wkt?e.spatialReferenceId=X.SPHERICAL_MARS_PCPF:t.wkt===DX.wkt?e.spatialReferenceId=X.SPHERICAL_MOON_PCPF:vm(t)?e.spatialReferenceId=X.GCSMARS2000:bm(t)?e.spatialReferenceId=X.GCSMOON2000:e.spatialReferenceId=X.UNKNOWN):X.UNKNOWN}function Ai(t,e,r,i){t!==r&&(r[i++]=t[e++],r[i++]=t[e++],r[i]=t[e])}function rw(t,e,r,i){r[i++]=iE*(t[e++]/or.radius),r[i++]=iE*(Math.PI/2-2*Math.atan(Math.exp(-t[e++]/or.radius))),r[i]=t[e]}function N1e(t,e,r,i){rw(t,e,r,i),M_(r,i,r,i)}function F1e(t,e,r,i){rw(t,e,r,i),I_(r,i,r,i)}function L6(t,e,r,i,s){const n=.4999999*Math.PI,o=ve(op*t[e+1],-n,n),a=Math.sin(o);r[i++]=op*t[e]*s.radius,r[i++]=s.halfSemiMajorAxis*Math.log((1+a)/(1-a)),r[i]=t[e+2]}function Mw(t,e,r,i){L6(t,e,r,i,or)}const yie=or.radius*Math.PI/180,PO=180/(or.radius*Math.PI);function R_(t,e,r,i){r[i]=t[e]*yie,r[i+1]=t[e+1]*yie,r[i+2]=t[e+2]}function kb(t,e,r,i){r[i]=t[e]*PO,r[i+1]=t[e+1]*PO,r[i+2]=t[e+2]}function U1e(t,e,r,i){rw(t,e,r,i),R_(r,i,r,i)}function XGe(t,e,r,i){$_(t,e,r,i),R_(r,i,r,i)}function ZGe(t,e,r,i){P_(t,e,r,i),R_(r,i,r,i)}function YGe(t,e,r,i){kb(t,e,r,i),M_(r,i,r,i)}function JGe(t,e,r,i){kb(t,e,r,i),Mw(r,i,r,i)}function QGe(t,e,r,i){kb(t,e,r,i),I_(r,i,r,i)}function tv(t){if(t==null)return!1;const e=cm(t,nC);return!!Mh[e][X.WGS84_COMPARABLE_LON_LAT]}function k1e(t,e,r,i){const s=Math.cos(r);t[0]=Math.cos(e)*s*i,t[1]=Math.sin(e)*s*i,t[2]=Math.sin(r)*i}function wY(t,e,r,i,s){const n=s+t[e+2],o=op*t[e+1],a=op*t[e],l=Math.cos(o);r[i++]=Math.cos(a)*l*n,r[i++]=Math.sin(a)*l*n,r[i]=Math.sin(o)*n}function mj(t,e,r,i){wY(t,e,r,i,ny.radius)}function gj(t,e,r,i){wY(t,e,r,i,Hf.radius)}function M_(t,e,r,i){wY(t,e,r,i,or.radius)}function D6(t,e,r,i,s){const n=t[e],o=t[e+1],a=t[e+2],l=Math.sqrt(n*n+o*o+a*a),c=Fh(a/(l===0?1:l)),h=Math.atan2(o,n);r[i++]=iE*h,r[i++]=iE*c,r[i]=l-s}function yj(t,e,r,i){D6(t,e,r,i,ny.radius)}function _j(t,e,r,i){D6(t,e,r,i,Hf.radius)}function P_(t,e,r,i){D6(t,e,r,i,or.radius)}function z1e(t,e,r,i){P_(t,e,r,i),Mw(r,i,r,i)}function V1e(t,e,r,i){P_(t,e,r,i),I_(r,i,r,i)}function KGe(t,e,r,i,s){const n=op*t[e],o=op*t[e+1],a=t[e+2],l=Math.sin(o),c=Math.cos(o),h=s.radius/Math.sqrt(1-s.eccentricitySquared*l*l);r[i++]=(h+a)*c*Math.cos(n),r[i++]=(h+a)*c*Math.sin(n),r[i++]=(h*(1-s.eccentricitySquared)+a)*l}function I_(t,e,r,i){KGe(t,e,r,i,or)}function $_(t,e,r,i){const s=$Ge,n=t[e],o=t[e+1],a=t[e+2];let l,c,h,p,f,m,y,_,v,b,T,x,S,E,A,R,M,D,k,$,N;l=Math.abs(a),c=n*n+o*o,h=Math.sqrt(c),p=c+a*a,f=Math.sqrt(p),$=Math.atan2(o,n),m=a*a/p,y=c/p,E=s.a2/f,A=s.a3-s.a4/f,y>.3?(_=l/f*(1+y*(s.a1+E+m*A)/f),k=Math.asin(_),b=_*_,v=Math.sqrt(1-b)):(v=h/f*(1-m*(s.a5-E-y*A)/f),k=Math.acos(v),b=1-v*v,_=Math.sqrt(b)),T=1-or.eccentricitySquared*b,x=or.radius/Math.sqrt(T),S=s.a6*x,E=h-x*v,A=l-S*_,M=v*E+_*A,R=v*A-_*E,D=R/(S/T+M),k+=D,N=M+R*D/2,a<0&&(k=-k),r[i++]=iE*$,r[i++]=iE*k,r[i]=N}function B1e(t,e,r,i){$_(t,e,r,i),M_(r,i,r,i)}function G1e(t,e,r,i){$_(t,e,r,i),Mw(r,i,r,i)}const Mh={[X.WGS84]:{[X.CGCS2000]:null,[X.GCSMARS2000]:null,[X.GCSMOON2000]:null,[X.LON_LAT]:Ai,[X.WGS84_COMPARABLE_LON_LAT]:Ai,[X.SPHERICAL_ECEF]:M_,[X.SPHERICAL_MARS_PCPF]:null,[X.SPHERICAL_MOON_PCPF]:null,[X.UNKNOWN]:null,[X.WEB_MERCATOR]:Mw,[X.PLATE_CARREE]:R_,[X.WGS84]:Ai,[X.WGS84_ECEF]:I_},[X.CGCS2000]:{[X.CGCS2000]:Ai,[X.GCSMARS2000]:null,[X.GCSMOON2000]:null,[X.LON_LAT]:Ai,[X.WGS84_COMPARABLE_LON_LAT]:Ai,[X.SPHERICAL_ECEF]:M_,[X.SPHERICAL_MARS_PCPF]:null,[X.SPHERICAL_MOON_PCPF]:null,[X.UNKNOWN]:null,[X.WEB_MERCATOR]:null,[X.PLATE_CARREE]:R_,[X.WGS84]:null,[X.WGS84_ECEF]:I_},[X.GCSMARS2000]:{[X.CGCS2000]:null,[X.GCSMARS2000]:Ai,[X.GCSMOON2000]:null,[X.LON_LAT]:Ai,[X.WGS84_COMPARABLE_LON_LAT]:null,[X.SPHERICAL_ECEF]:null,[X.SPHERICAL_MARS_PCPF]:gj,[X.SPHERICAL_MOON_PCPF]:null,[X.UNKNOWN]:null,[X.WEB_MERCATOR]:null,[X.PLATE_CARREE]:null,[X.WGS84]:null,[X.WGS84_ECEF]:null},[X.GCSMOON2000]:{[X.CGCS2000]:null,[X.GCSMARS2000]:null,[X.GCSMOON2000]:Ai,[X.LON_LAT]:Ai,[X.WGS84_COMPARABLE_LON_LAT]:null,[X.SPHERICAL_ECEF]:null,[X.SPHERICAL_MARS_PCPF]:null,[X.SPHERICAL_MOON_PCPF]:mj,[X.UNKNOWN]:null,[X.WEB_MERCATOR]:null,[X.PLATE_CARREE]:null,[X.WGS84]:null,[X.WGS84_ECEF]:null},[X.WEB_MERCATOR]:{[X.CGCS2000]:null,[X.GCSMARS2000]:null,[X.GCSMOON2000]:null,[X.LON_LAT]:rw,[X.WGS84_COMPARABLE_LON_LAT]:rw,[X.SPHERICAL_ECEF]:N1e,[X.SPHERICAL_MARS_PCPF]:null,[X.SPHERICAL_MOON_PCPF]:null,[X.UNKNOWN]:null,[X.WEB_MERCATOR]:Ai,[X.PLATE_CARREE]:U1e,[X.WGS84]:rw,[X.WGS84_ECEF]:F1e},[X.WGS84_ECEF]:{[X.CGCS2000]:$_,[X.GCSMARS2000]:null,[X.GCSMOON2000]:null,[X.LON_LAT]:$_,[X.WGS84_COMPARABLE_LON_LAT]:$_,[X.SPHERICAL_ECEF]:B1e,[X.SPHERICAL_MARS_PCPF]:null,[X.SPHERICAL_MOON_PCPF]:null,[X.UNKNOWN]:null,[X.WEB_MERCATOR]:G1e,[X.PLATE_CARREE]:XGe,[X.WGS84]:$_,[X.WGS84_ECEF]:Ai},[X.SPHERICAL_ECEF]:{[X.CGCS2000]:P_,[X.GCSMARS2000]:null,[X.GCSMOON2000]:null,[X.LON_LAT]:P_,[X.WGS84_COMPARABLE_LON_LAT]:P_,[X.SPHERICAL_ECEF]:Ai,[X.SPHERICAL_MARS_PCPF]:null,[X.SPHERICAL_MOON_PCPF]:null,[X.UNKNOWN]:null,[X.WEB_MERCATOR]:z1e,[X.PLATE_CARREE]:ZGe,[X.WGS84]:P_,[X.WGS84_ECEF]:V1e},[X.SPHERICAL_MARS_PCPF]:{[X.CGCS2000]:null,[X.GCSMARS2000]:_j,[X.GCSMOON2000]:null,[X.LON_LAT]:_j,[X.WGS84_COMPARABLE_LON_LAT]:null,[X.SPHERICAL_ECEF]:null,[X.SPHERICAL_MARS_PCPF]:Ai,[X.SPHERICAL_MOON_PCPF]:null,[X.UNKNOWN]:null,[X.WEB_MERCATOR]:null,[X.PLATE_CARREE]:null,[X.WGS84]:null,[X.WGS84_ECEF]:null},[X.SPHERICAL_MOON_PCPF]:{[X.CGCS2000]:null,[X.GCSMARS2000]:null,[X.GCSMOON2000]:yj,[X.LON_LAT]:yj,[X.WGS84_COMPARABLE_LON_LAT]:null,[X.SPHERICAL_ECEF]:null,[X.SPHERICAL_MARS_PCPF]:null,[X.SPHERICAL_MOON_PCPF]:Ai,[X.UNKNOWN]:null,[X.WEB_MERCATOR]:null,[X.PLATE_CARREE]:null,[X.WGS84]:null,[X.WGS84_ECEF]:null},[X.UNKNOWN]:{[X.CGCS2000]:null,[X.GCSMARS2000]:null,[X.GCSMOON2000]:null,[X.LON_LAT]:null,[X.WGS84_COMPARABLE_LON_LAT]:null,[X.SPHERICAL_ECEF]:null,[X.SPHERICAL_MARS_PCPF]:null,[X.SPHERICAL_MOON_PCPF]:null,[X.UNKNOWN]:Ai,[X.WEB_MERCATOR]:null,[X.PLATE_CARREE]:null,[X.WGS84]:null,[X.WGS84_ECEF]:null},[X.LON_LAT]:{[X.CGCS2000]:Ai,[X.GCSMARS2000]:Ai,[X.GCSMOON2000]:Ai,[X.LON_LAT]:Ai,[X.WGS84_COMPARABLE_LON_LAT]:Ai,[X.SPHERICAL_ECEF]:M_,[X.SPHERICAL_MARS_PCPF]:gj,[X.SPHERICAL_MOON_PCPF]:mj,[X.UNKNOWN]:null,[X.WEB_MERCATOR]:Mw,[X.PLATE_CARREE]:R_,[X.WGS84]:Ai,[X.WGS84_ECEF]:I_},[X.WGS84_COMPARABLE_LON_LAT]:{[X.CGCS2000]:null,[X.GCSMARS2000]:null,[X.GCSMOON2000]:null,[X.LON_LAT]:Ai,[X.WGS84_COMPARABLE_LON_LAT]:Ai,[X.SPHERICAL_ECEF]:M_,[X.SPHERICAL_MARS_PCPF]:null,[X.SPHERICAL_MOON_PCPF]:null,[X.UNKNOWN]:null,[X.WEB_MERCATOR]:null,[X.PLATE_CARREE]:R_,[X.WGS84]:Ai,[X.WGS84_ECEF]:I_},[X.PLATE_CARREE]:{[X.CGCS2000]:kb,[X.GCSMARS2000]:null,[X.GCSMOON2000]:null,[X.LON_LAT]:kb,[X.WGS84_COMPARABLE_LON_LAT]:kb,[X.SPHERICAL_ECEF]:YGe,[X.SPHERICAL_MARS_PCPF]:null,[X.SPHERICAL_MOON_PCPF]:null,[X.UNKNOWN]:null,[X.WEB_MERCATOR]:JGe,[X.PLATE_CARREE]:Ai,[X.WGS84]:kb,[X.WGS84_ECEF]:QGe}};function xY(t,e,r=TY()){return t==null||e==null?null:j1e(t,e,r).projector}function j1e(t,e,r){if(t==null||e==null||r.source.spatialReference===t&&r.dest.spatialReference===e)return r;const i=cm(t,r.source),s=cm(e,r.dest);return i===X.UNKNOWN&&s===X.UNKNOWN?Pn(t,e)?r.projector=Ai:r.projector=null:r.projector=Mh[i][s],r}function TY(){return{source:{spatialReference:null,spatialReferenceId:X.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:X.UNKNOWN,metersPerUnit:1},projector:Ai}}const nC={spatialReference:null,spatialReferenceId:X.UNKNOWN},H1e={spatialReference:null,spatialReferenceId:X.UNKNOWN},SY=TY(),e7e=TY(),op=Ft(1),iE=rl(1),ss=O(),Vd=O(),Yy=O(),Vr=O(),aI=O(),sDt=Object.freeze(Object.defineProperty({__proto__:null,canProjectToWGS84ComparableLonLat:tv,canProjectWithoutEngine:lm,computeENUToSphericalPCPFLocalRotation:bY,computeSphericalPCPFToENULocalRotation:D1e,computeTranslationToOriginAndRotation:Pl,getProjectorName:UGe,getTransformation:x1e,getTransformations:DGe,initializeProjection:S1e,isLoaded:I6,load:PR,localLinearScaleFactors:WGe,lonLatToSphericalPCPF:k1e,lonLatToWebMercatorComparable:L6,project:hx,projectBoundingRect:jM,projectBoundingSphere:qGe,projectBuffer:li,projectDirection:HGe,projectExtent:GGe,projectMany:pj,projectMultipoint:kGe,projectOrLoad:LGe,projectOrLoadMany:w1e,projectPoint:E1e,projectPointToVector:So,projectPointToWGS84ComparableLonLat:I1e,projectPolygon:R1e,projectPolygonToWGS84ComparableLonLat:BGe,projectPolyline:zGe,projectPolylineToWGS84ComparableLonLat:VGe,projectVectorToDehydratedPoint:vY,projectVectorToPoint:dy,projectVectorToVector:Zs,projectVectorToWGS84ComparableLonLat:$1e,projectWithoutEngine:_Y,projectXYZToVector:fj,sphericalPCPFtoLonLatElevation:D6,test:FGe,tryProjectWithZConversion:T1e,unload:NGe},Symbol.toStringTag,{value:"Module"}));async function t7e(t){const e=t.spatialReference;if(e.isWGS84)return t.clone();if(e.isWebMercator)return $A(t);const r=je.WGS84;return await S1e(e,r),hx(t,r)}function nDt(t,e){if(!q1e(t,e)){const r=t.typeKeywords;r?r.push(e):t.typeKeywords=[e]}}function q1e(t,e){return!!t.typeKeywords?.includes(e)}function oDt(t){return q1e(t,r7e.HOSTED_SERVICE)}function aDt(t,e){const r=t.typeKeywords;if(r){const i=r.indexOf(e);i>-1&&r.splice(i,1)}}async function lDt(t){const e=t.clone().normalize();let r;if(e.length>1)for(const i of e)r?i.width>r.width&&(r=i):r=i;else r=e[0];return t7e(r)}const r7e={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table",HOSTED_SERVICE:"Hosted Service"};function _ie(t){const{portal:e,isOrgItem:r,itemControl:i}=t,s=e.user?.privileges;let n=!s||s.includes("features:user:edit"),o=!!r&&!!s?.includes("features:user:fullEdit");const a=i==="update"||i==="admin";return a?o=n=!0:o&&(n=!0),{features:{edit:n,fullEdit:o},content:{updateItem:a}}}const W1e=t=>{let e=class extends t{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=$e(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(r){r!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",r))}readPortalItem(r,i,s){if(i.itemId)return new Yb({id:i.itemId,portal:s&&s.portal})}writePortalItem(r,i){r&&r.id&&(i.itemId=r.id)}async loadFromPortal(r,i){if(this.portalItem&&this.portalItem.id)try{const{load:s}=await ce(()=>import("./layersLoader-ca4cc2fe.js"),["./layersLoader-ca4cc2fe.js","./fetchService-f4a7481b.js","./jsonContext-cd374e12.js"],import.meta.url);return Yt(i),await s({instance:this,supportedTypes:r.supportedTypes,validateItem:r.validateItem,supportsData:r.supportsData,layerModuleTypeMap:r.layerModuleTypeMap},i)}catch(s){throw us(s)||Q.getLogger(this).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})
  ${s}`),s}}async finishLoadEditablePortalLayer(r){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(r).catch(i=>(Fo(i),!0)))}async _setUserPrivileges(r,i){if(!Br.userPrivilegesApplied)return this.finishLoadEditablePortalLayer(i);if(this.url)try{const{features:{edit:s,fullEdit:n},content:{updateItem:o}}=await this._fetchUserPrivileges(r,i);this._set("userHasEditingPrivileges",s),this._set("userHasFullEditingPrivileges",n),this._set("userHasUpdateItemPrivileges",o)}catch(s){Fo(s)}}async _fetchUserPrivileges(r,i){let s=this.portalItem;if(!r||!s||!s.loaded||s.sourceUrl)return this._fetchFallbackUserPrivileges(i);const n=r===s.id;if(n&&s.portal.user)return _ie(s);let o,a;if(n)o=s.portal.url;else try{o=await sge(this.url,i)}catch(p){Fo(p)}if(!o||!uDe(o,s.portal.url))return this._fetchFallbackUserPrivileges(i);try{const p=i!=null?i.signal:null;a=await Pi?.getCredential(`${o}/sharing`,{prompt:!1,signal:p})}catch(p){Fo(p)}const l=!0,c=!1,h=!1;if(!a)return{features:{edit:l,fullEdit:c},content:{updateItem:h}};try{if(n?await s.reload():(s=new Yb({id:r,portal:{url:o}}),await s.load(i)),s.portal.user)return _ie(s)}catch(p){Fo(p)}return{features:{edit:l,fullEdit:c},content:{updateItem:h}}}async _fetchFallbackUserPrivileges(r){let i=!0;try{i=await this._fetchUserHasEditingPrivileges(r)}catch(s){Fo(s)}return{features:{edit:i,fullEdit:!1},content:{updateItem:!1}}}async _fetchUserHasEditingPrivileges(r){const i=this.url?Pi?.findCredential(this.url):null;if(!i)return!0;const s=lI.credential===i?lI.user:await this._fetchEditingUser(r);return lI.credential=i,lI.user=s,s==null||s.privileges==null||s.privileges.includes("features:user:edit")}async _fetchEditingUser(r){const i=this.portalItem?.portal?.user;if(i)return i;const s=Pi.findServerInfo(this.url??"");if(!s?.owningSystemUrl)return null;const n=`${s.owningSystemUrl}/sharing/rest`,o=Js.getDefault();if(o&&o.loaded&&hp(o.restUrl)===hp(n))return o.user;const a=`${n}/community/self`,l=r!=null?r.signal:null,c=await Eu(hr(a,{authMode:"no-prompt",query:{f:"json"},signal:l}));return c.ok?BX.fromJSON(c.value.data):null}read(r,i){i&&(i.layer=this),super.read(r,i)}write(r,i){const s=i&&i.portal,n=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||Js.getDefault());return s&&n&&!Tme(n.restUrl,s.restUrl)?(i.messages&&i.messages.push(new V("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(r,{...i,layer:this})}};return u([d({type:Yb})],e.prototype,"portalItem",null),u([Ae("web-document","portalItem",["itemId"])],e.prototype,"readPortalItem",null),u([ke("web-document","portalItem",{itemId:{type:String}})],e.prototype,"writePortalItem",null),u([d({clonable:!1})],e.prototype,"resourceReferences",void 0),u([d({type:Boolean,readOnly:!0})],e.prototype,"userHasEditingPrivileges",void 0),u([d({type:Boolean,readOnly:!0})],e.prototype,"userHasFullEditingPrivileges",void 0),u([d({type:Boolean,readOnly:!0})],e.prototype,"userHasUpdateItemPrivileges",void 0),e=u([P("esri.layers.mixins.PortalLayer")],e),e},lI={credential:null,user:null};let v3=class extends we{constructor(){super(...arguments),this.updating=!1,this.status="unknown"}};u([d()],v3.prototype,"updating",void 0),u([d()],v3.prototype,"status",void 0),v3=u([P("esri.layers.support.PublishingInfo")],v3);const i7e=v3,X1e="esri.layers.mixins.PublishableLayer",s7e=Symbol(X1e),n7e=t=>{var e;let r=class extends t{constructor(){super(...arguments),this[e]=!0}get publishingInfo(){if(this.destroyed)return null;const i=this._get("publishingInfo");if(i)return i;const s=new i7e;return this._checkPublishingStatus(s),s}_checkPublishingStatus(i){let o=0;const a=async c=>{let h;i.updating=!0;try{h=await this.fetchPublishingStatus()}catch{h="unavailable"}h!=="published"&&h!=="unavailable"||(i.status==="publishing"&&this.refresh(),l.remove()),i.status=h,i.updating=!1,l.removed||(o=setTimeout(a,c,c+125))},l={removed:!1,remove(){this.removed=!0,clearTimeout(o)}};this.when().catch(()=>l.remove()),a(250),this.own(l)}};return e=s7e,u([d({readOnly:!0,clonable:!1})],r.prototype,"publishingInfo",null),r=u([P(X1e)],r),r},IR=new Pt,IO=new WeakMap;function o7e(t){Z1e(t)&&IR.push(t)}function a7e(t){Z1e(t)&&IR.includes(t)&&IR.remove(t)}function Z1e(t){return t!=null&&typeof t=="object"&&"refreshInterval"in t&&"refresh"in t}function Y1e(t,e){return Number.isFinite(t)&&Number.isFinite(e)?e<=0?t:Y1e(e,t%e):0}let s9=0,cI=0;function l7e(){const t=Date.now();for(const e of IR)e.refreshInterval&&t-(IO.get(e)??0)+5>=6e4*e.refreshInterval&&(IO.set(e,t),e.refresh(t))}Bfe(()=>{const t=Date.now();let e=0;for(const r of IR)e=Y1e(Math.round(6e4*r.refreshInterval),e),r.refreshInterval?IO.get(r)||IO.set(r,t):IO.delete(r);if(e!==cI){if(cI=e,clearInterval(s9),cI===0)return void(s9=0);s9=setInterval(l7e,cI)}});function c7e(t){return t!=null&&typeof t=="object"&&"refreshTimestamp"in t&&"refresh"in t}const u7e=t=>{let e=class extends t{constructor(...r){super(...r),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=cX(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||o7e(this)},()=>{})}destroy(){a7e(this)}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(r=Date.now()){OV(this._debounceHasDataChanged()).then(i=>{i&&this._set("refreshTimestamp",r),this.emit("refresh",{dataChanged:i})},i=>{Q.getLogger(this).error(i),this.emit("refresh",{dataChanged:!1,error:i})})}async hasDataChanged(){return!0}};return u([d({type:Number,cast:r=>r>=.1?r:r<=0?0:.1,json:{write:!0}})],e.prototype,"refreshInterval",void 0),u([d({readOnly:!0})],e.prototype,"refreshTimestamp",void 0),u([d()],e.prototype,"refreshParameters",null),e=u([P("esri.layers.mixins.RefreshableLayer")],e),e},J1e=t=>{let e=class extends t{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const r={minScale:this.minScale,maxScale:this.maxScale},i=this.parent;i&&"effectiveScaleRange"in i&&h7e(r,i.effectiveScaleRange);const s=this._get("effectiveScaleRange");return s&&s.minScale===r.minScale&&s.maxScale===r.maxScale?s:r}};return u([d({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"minScale",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"maxScale",void 0),u([d({readOnly:!0})],e.prototype,"effectiveScaleRange",null),e=u([P("esri.layers.mixins.ScaleRangeLayer")],e),e};function h7e(t,e){return t.minScale=t.minScale>0?e.minScale>0?Math.min(t.minScale,e.minScale):t.minScale:e.minScale,t.maxScale=t.maxScale>0?e.maxScale>0?Math.max(t.maxScale,e.maxScale):t.maxScale:e.maxScale,t}const Q1e=il()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0});let b3=class extends ji(le){constructor(e){super(e),this.unit="milliseconds",this.value=0}toMilliseconds(){return LVe(this.value,this.unit,"milliseconds")}};u([it(Q1e,{nonNullable:!0})],b3.prototype,"unit",void 0),u([d({type:Number,json:{write:!0},nonNullable:!0})],b3.prototype,"value",void 0),b3=u([P("esri.TimeInterval")],b3);const z4=b3;function vie(t,e){return z4.fromJSON({value:t,unit:e})}let Na=class extends ji(le){constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeReference=null,this.trackIdField=null,this.useTime=!0}readFullTimeExtent(e,r){if(!r.timeExtent||!Array.isArray(r.timeExtent)||r.timeExtent.length!==2)return null;const i=new Date(r.timeExtent[0]),s=new Date(r.timeExtent[1]);return new Tm({start:i,end:s})}writeFullTimeExtent(e,r){e&&e.start!=null&&e.end!=null?r.timeExtent=[e.start.getTime(),e.end.getTime()]:r.timeExtent=null}readInterval(e,r){return r.timeInterval&&r.timeIntervalUnits?vie(r.timeInterval,r.timeIntervalUnits):r.defaultTimeInterval&&r.defaultTimeIntervalUnits?vie(r.defaultTimeInterval,r.defaultTimeIntervalUnits):null}writeInterval(e,r){r.timeInterval=e?.toJSON().value??null,r.timeIntervalUnits=e?.toJSON().unit??null}};u([d({type:Boolean,json:{name:"exportOptions.timeDataCumulative",write:!0}})],Na.prototype,"cumulative",void 0),u([d({type:String,json:{name:"endTimeField",write:{enabled:!0,allowNull:!0}}})],Na.prototype,"endField",void 0),u([d({type:Tm,json:{write:{enabled:!0,allowNull:!0}}})],Na.prototype,"fullTimeExtent",void 0),u([Ae("fullTimeExtent",["timeExtent"])],Na.prototype,"readFullTimeExtent",null),u([ke("fullTimeExtent")],Na.prototype,"writeFullTimeExtent",null),u([d({type:Boolean,json:{write:!0}})],Na.prototype,"hasLiveData",void 0),u([d({type:z4,json:{write:{enabled:!0,allowNull:!0}}})],Na.prototype,"interval",void 0),u([Ae("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],Na.prototype,"readInterval",null),u([ke("interval")],Na.prototype,"writeInterval",null),u([d({type:String,json:{name:"startTimeField",write:{enabled:!0,allowNull:!0}}})],Na.prototype,"startField",void 0),u([d({type:rE,json:{write:{enabled:!0,allowNull:!0}}})],Na.prototype,"timeReference",void 0),u([d({type:String,json:{write:{enabled:!0,allowNull:!0}}})],Na.prototype,"trackIdField",void 0),u([d({type:Boolean,json:{name:"exportOptions.useTime",write:!0}})],Na.prototype,"useTime",void 0),Na=u([P("esri.layers.support.TimeInfo")],Na);const K1e=Na,d7e=t=>{let e=class extends t{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(r,i){const s=i.timeInfo.exportOptions;if(!s)return null;const n=s.timeOffset,o=Q1e.fromJSON(s.timeOffsetUnits);return n&&o?new z4({value:n,unit:o}):null}set timeInfo(r){sye(r,this.fieldsIndex),this._set("timeInfo",r)}};return u([d({type:Tm,json:{write:!1}})],e.prototype,"timeExtent",void 0),u([d({type:z4})],e.prototype,"timeOffset",void 0),u([Ae("service","timeOffset",["timeInfo.exportOptions"])],e.prototype,"readOffset",null),u([d({value:null,type:K1e,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],e.prototype,"timeInfo",null),u([d({type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation"},origins:{"web-scene":{read:!1,write:!1}}}})],e.prototype,"useViewTime",void 0),e=u([P("esri.layers.mixins.TemporalLayer")],e),e},bie=new $r({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let U0=class extends ji(le){constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};u([d({json:{write:!0}})],U0.prototype,"name",void 0),u([d({json:{write:!0}})],U0.prototype,"description",void 0),u([d({json:{read:bie.read,write:bie.write}})],U0.prototype,"drawingTool",void 0),u([d({json:{write:!0}})],U0.prototype,"prototype",void 0),u([d({json:{write:!0}})],U0.prototype,"thumbnail",void 0),U0=u([P("esri.layers.support.FeatureTemplate")],U0);const EY=U0;let fg=class extends ji(le){constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const r={};for(const i of Object.keys(e))r[i]=eY(e[i]);return r}writeDomains(e,r){const i={};for(const s of Object.keys(e))e[s]&&(i[s]=e[s]?.toJSON());r.domains=i}};u([d({json:{write:!0}})],fg.prototype,"id",void 0),u([d({json:{write:!0}})],fg.prototype,"name",void 0),u([d({json:{write:!0}})],fg.prototype,"domains",void 0),u([Ae("domains")],fg.prototype,"readDomains",null),u([ke("domains")],fg.prototype,"writeDomains",null),u([d({type:[EY],json:{write:!0}})],fg.prototype,"templates",void 0),fg=u([P("esri.layers.support.FeatureType")],fg);const ebe=fg;function tbe(){return{fields:{type:[b6],value:null},fieldsIndex:{readOnly:!0,get(){return new qZ(this.fields||[])}},outFields:{type:[String],json:{read:!1},set:function(t){this._userOutFields=t,this.notifyChange("outFields")},get:function(){const t=this._userOutFields;if(!t||!t.length)return null;if(t.includes("*"))return["*"];if(!this.fields)return t;for(const e of t)this.fieldsIndex?.has(e)||Q.getLogger("esri.layers.support.fieldProperties").error("field-attributes-layer:invalid-field",`Invalid field ${e} found in outFields`,{layer:this,outFields:t});return r6(this.fieldsIndex,t)}}}}const n9=Q.getLogger("esri.layers.support.labelingInfo"),p7e=/\[([^\[\]]+)\]/gi;function V4(t,e,r){return t?t.map(i=>{const s=new sC;if(s.read(i,r),s.labelExpression){const n=e.fields||e.layerDefinition&&e.layerDefinition.fields||this.fields;s.labelExpression=s.labelExpression.replaceAll(p7e,(o,a)=>`[${f7e(a,n)}]`)}return s}):null}function f7e(t,e){if(!e)return t;const r=t.toLowerCase();for(let i=0;i<e.length;i++){const s=e[i].name;if(s.toLowerCase()===r)return s}return t}const m7e={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along"],esriGeometryMultipoint:null};function fDt(t,e){const r=K(t);return r.some(i=>g7e(i,e))?[]:r}function g7e(t,e){const r=t.labelPlacement,i=m7e[e];if(!t.symbol)return n9.warn("No ILabelClass symbol specified."),!0;if(!i)return n9.error(new V("labeling:unsupported-geometry-type",`Unable to create labels for layer, geometry type '${e}' is not supported`)),!0;if(!i.includes(r)){const s=i[0];r&&n9.warn(`Found invalid label placement type ${r} for ${e}. Defaulting to ${s}`),t.labelPlacement=s}return!1}const Ad=[];function y7e(t,e){if(iY(t.url??""))return!0;const{wkid:r}=e;for(const i of Ad){if((t.version??0)>=i[0])return!0;if(typeof i[1]=="function"&&(i[1]=i[1]()),i[1].has(r))return!1}return!0}Ad.push([10.91,()=>{const t=new Set([9709,9716,9741,9761,9766]);for(let e=9712;e<=9713;e++)t.add(e);for(let e=9748;e<=9749;e++)t.add(e);for(let e=20904;e<=20932;e++)t.add(e);for(let e=21004;e<=21032;e++)t.add(e);for(let e=21207;e<=21264;e++)t.add(e);for(let e=21307;e<=21364;e++)t.add(e);for(let e=102759;e<=102760;e++)t.add(e);for(let e=102901;e<=102955;e++)t.add(e);return t}]),Ad.push([10.9,()=>{const t=new Set([9300,9354,9364,9367,9373,9377,9387,9456,9473,9498,9678,9680,29874,103599,103872,104028]);for(let e=9356;e<=9360;e++)t.add(e);for(let e=9404;e<=9407;e++)t.add(e);for(let e=9476;e<=9482;e++)t.add(e);for(let e=9487;e<=9494;e++)t.add(e);for(let e=9697;e<=9699;e++)t.add(e);return t}]),Ad.push([10.81,()=>{const t=new Set([9265,9333,103598,103699]);for(let e=9248;e<=9254;e++)t.add(e);for(let e=9271;e<=9273;e++)t.add(e);for(let e=9284;e<=9285;e++)t.add(e);for(let e=21453;e<=21463;e++)t.add(e);return t}]),Ad.push([10.8,()=>{const t=new Set([8088,8395,8428,8433,8531,8687,8692,8694,8699,8900,9003,9006,9009,9012,9017,9191]);for(let e=8035;e<=8036;e++)t.add(e);for(let e=8455;e<=8456;e++)t.add(e);for(let e=8518;e<=8529;e++)t.add(e);for(let e=8533;e<=8536;e++)t.add(e);for(let e=8538;e<=8540;e++)t.add(e);for(let e=8677;e<=8679;e++)t.add(e);for(let e=8902;e<=8903;e++)t.add(e);for(let e=8907;e<=8910;e++)t.add(e);for(let e=8949;e<=8951;e++)t.add(e);for(let e=8972;e<=8987;e++)t.add(e);for(let e=9039;e<=9040;e++)t.add(e);for(let e=9068;e<=9069;e++)t.add(e);for(let e=9140;e<=9141;e++)t.add(e);for(let e=9148;e<=9150;e++)t.add(e);for(let e=9153;e<=9159;e++)t.add(e);for(let e=9205;e<=9218;e++)t.add(e);for(let e=9221;e<=9222;e++)t.add(e);for(let e=54098;e<=54101;e++)t.add(e);return t}]),Ad.push([10.71,()=>{const t=new Set([6316]);for(let e=8351;e<=8353;e++)t.add(e);for(let e=9294;e<=9297;e++)t.add(e);for(let e=22619;e<=22621;e++)t.add(e);for(let e=103586;e<=103594;e++)t.add(e);return t}]),Ad.push([10.7,()=>{const t=new Set([8387,8391,8427,8545,8682,8685,8818,31370,104022,104024,104975]);for(let e=8065;e<=8068;e++)t.add(e);for(let e=8082;e<=8083;e++)t.add(e);for(let e=8379;e<=8385;e++)t.add(e);for(let e=8836;e<=8840;e++)t.add(e);for(let e=8857;e<=8860;e++)t.add(e);for(let e=53035;e<=53037;e++)t.add(e);for(let e=54090;e<=54091;e++)t.add(e);for(let e=102498;e<=102499;e++)t.add(e);return t}]),Ad.push([10.61,()=>new Set([102497])]),Ad.push([10.6,()=>{const t=new Set([7803,7805,7887,8086,8232,8237,8240,8246,8249,8252,8255,9019,9391]);for(let e=7755;e<=7787;e++)t.add(e);for(let e=7791;e<=7795;e++)t.add(e);for(let e=7799;e<=7801;e++)t.add(e);for(let e=7825;e<=7831;e++)t.add(e);for(let e=7877;e<=7878;e++)t.add(e);for(let e=7882;e<=7883;e++)t.add(e);for(let e=7991;e<=7992;e++)t.add(e);for(let e=8042;e<=8043;e++)t.add(e);for(let e=8058;e<=8059;e++)t.add(e);for(let e=8311;e<=8348;e++)t.add(e);for(let e=9060;e<=9067;e++)t.add(e);for(let e=102562;e<=102568;e++)t.add(e);for(let e=102799;e<=102900;e++)t.add(e);return t}]),Ad.push([10.51,()=>{const t=new Set([7683,7881,7886,7899,8888,9e3]);for(let e=8013;e<=8032;e++)t.add(e);for(let e=9053;e<=9057;e++)t.add(e);for(let e=104017;e<=104018;e++)t.add(e);for(let e=104971;e<=104974;e++)t.add(e);return t}]),Ad.push([10.5,()=>{const t=new Set([6962,7035,7037,7039,7041,7084,7086,7133,7798,102399]);for(let e=4087;e<=4088;e++)t.add(e);for(let e=5896;e<=5899;e++)t.add(e);for(let e=7005;e<=7007;e++)t.add(e);for(let e=7057;e<=7070;e++)t.add(e);for(let e=7073;e<=7082;e++)t.add(e);for(let e=7109;e<=7128;e++)t.add(e);for(let e=7844;e<=7859;e++)t.add(e);return t}]);async function rbe(t,e,r){const i=t&&t.getAtOrigin&&t.getAtOrigin("renderer",e.origin);if(i&&i.type==="unique-value"&&i.styleOrigin){const s=await Eu(i.populateFromStyle());if(Yt(r),s.ok===!1){const n=s.error;e&&e.messages&&e.messages.push(new Nh("renderer:style-reference",`Failed to create unique value renderer from style reference: ${n.message}`,{error:n,context:e})),t.clear("renderer",e?.origin)}}}var vj;let oS=vj=class extends le{constructor(t){super(t),this.groupByFields=void 0,this.topCount=void 0,this.orderByFields=void 0}clone(){return new vj({groupByFields:this.groupByFields,topCount:this.topCount,orderByFields:this.orderByFields})}};u([d({type:[String],json:{write:!0}})],oS.prototype,"groupByFields",void 0),u([d({type:Number,json:{write:!0}})],oS.prototype,"topCount",void 0),u([d({type:[String],json:{write:!0}})],oS.prototype,"orderByFields",void 0),oS=vj=u([P("esri.rest.support.TopFilter")],oS);const _7e=oS;var bj;const wie=new $r({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),xie=new $r({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let ps=bj=class extends le{constructor(t){super(t),this.cacheHint=void 0,this.distance=void 0,this.geometry=null,this.geometryPrecision=void 0,this.maxAllowableOffset=void 0,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.resultType=null,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.start=void 0,this.spatialRelationship="intersects",this.timeExtent=null,this.topFilter=void 0,this.units=null,this.where="1=1"}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new bj(K({cacheHint:this.cacheHint,distance:this.distance,geometry:this.geometry,geometryPrecision:this.geometryPrecision,maxAllowableOffset:this.maxAllowableOffset,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,resultType:this.resultType,returnGeometry:this.returnGeometry,returnZ:this.returnZ,returnM:this.returnM,start:this.start,spatialRelationship:this.spatialRelationship,timeExtent:this.timeExtent,topFilter:this.topFilter,units:this.units,where:this.where}))}};u([d({type:Boolean,json:{write:!0}})],ps.prototype,"cacheHint",void 0),u([d({type:Number,json:{write:{overridePolicy:t=>({enabled:t>0})}}})],ps.prototype,"distance",void 0),u([d({types:ix,json:{read:Z_,write:!0}})],ps.prototype,"geometry",void 0),u([d({type:Number,json:{write:!0}})],ps.prototype,"geometryPrecision",void 0),u([d({type:Number,json:{write:!0}})],ps.prototype,"maxAllowableOffset",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],ps.prototype,"num",void 0),u([d({json:{write:!0}})],ps.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],ps.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],ps.prototype,"outFields",void 0),u([d({type:je,json:{read:{source:"outSR"},write:{target:"outSR"}}})],ps.prototype,"outSpatialReference",void 0),u([d({type:String,json:{write:!0}})],ps.prototype,"resultType",void 0),u([d({json:{write:!0}})],ps.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],ps.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],ps.prototype,"returnZ",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],ps.prototype,"start",void 0),u([ke("start"),ke("num")],ps.prototype,"writeStart",null),u([d({type:String,json:{read:{source:"spatialRel",reader:wie.read},write:{target:"spatialRel",writer:wie.write}}})],ps.prototype,"spatialRelationship",void 0),u([d({type:Tm,json:{write:!0}})],ps.prototype,"timeExtent",void 0),u([d({type:_7e,json:{write:!0}})],ps.prototype,"topFilter",void 0),u([d({type:String,json:{read:xie.read,write:{writer:xie.write,overridePolicy(t){return{enabled:t!=null&&this.distance!=null&&this.distance>0}}}}})],ps.prototype,"units",void 0),u([d({type:String,json:{write:!0}})],ps.prototype,"where",void 0),ps=bj=u([P("esri.rest.support.TopFeaturesQuery")],ps),ps.from=vs(ps);const uI=ps;function ibe({displayField:t,editFieldsInfo:e,fields:r,objectIdField:i,title:s},n){if(!r)return null;const o=x7e({editFieldsInfo:e,fields:r,objectIdField:i},n);if(!o.length)return null;const a=E7e({titleBase:s,fields:r,displayField:t}),l=S7e();return new _v({title:a,content:l,fieldInfos:o})}const v7e=(t,e)=>e.visibleFieldNames?e.visibleFieldNames.has(t.name):T5e(t,e);function b7e(t,e){const r=t;return e&&(t=t.filter(i=>!e.includes(i.type))),t===r&&(t=t.slice()),t.sort(w7e),t}function w7e(t,e){return t.type==="oid"?-1:e.type==="oid"?1:Tie(t)?-1:Tie(e)?1:(t.alias||t.name).toLocaleLowerCase().localeCompare((e.alias||e.name).toLocaleLowerCase())}function x7e(t,e){const r=e?.visibleFieldNames;return b7e(t.fields??[],e?.ignoreFieldTypes||C7e).map(i=>new EZ({fieldName:i.name,isEditable:x5e(i,t),label:i.alias,format:T7e(i),visible:v7e(i,{...t,visibleFieldNames:r})}))}function T7e(t){switch(t.type){case"small-integer":case"integer":case"single":return new zA({digitSeparator:!0,places:0});case"double":return new zA({digitSeparator:!0,places:2});case"date":return new zA({dateFormat:"long-month-day-year"});default:return t.type==="string"&&V5e(t.name)?new zA({digitSeparator:!0,places:0}):null}}function S7e(){return[new SR,new TR]}function E7e(t){const e=h5e(t),{titleBase:r}=t;return e?`${r}: {${e.trim()}}`:r??""}function Tie(t){return(t.name&&t.name.toLowerCase())==="name"?!0:(t.alias&&t.alias.toLowerCase())==="name"}const C7e=["geometry","blob","raster","guid","xml"],al="FeatureLayer",sbe="esri.layers.FeatureLayer",A7e=Q.getLogger(sbe);function hI(t,e){return new V("layer:unsupported",`Layer (${t.title}, ${t.id}) of type '${t.declaredClass}' ${e}`,{layer:t})}function Sie(t){return t&&t instanceof Pt}const o9=tbe();function a9(t,e,r){const i=!!r?.writeLayerSchema;return{enabled:i,ignoreOrigin:i}}let _t=class extends kBe(CGe(jVe(n7e(Hve(MVe(MGe(d7e(J1e(u7e(vve(f1e(W1e(QZ(PVe(dve(ji(hZ))))))))))))))))){constructor(...e){super(...e),this._handles=new Ii,this.charts=null,this.copyright=null,this.displayField=null,this.dynamicDataSource=null,this.fields=null,this.fieldsIndex=null,this.formTemplate=null,this.fullExtent=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.spatialReference=je.WGS84,this.subtypeCode=null,this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.type="feature",this.typeIdField=null,this.types=null,this.visible=!0}destroy(){this.source?.destroy(),this._handles=$e(this._handles)}normalizeCtorArgs(e,r){return typeof e=="string"?{url:e,...r}:e}load(e){const r=e!=null?e.signal:null;if(this.portalItem?.loaded&&this.source)return this.addResolvingPromise(this.createGraphicsSource(r).then(s=>this.initLayerProperties(s))),Promise.resolve(this);const i=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection"]},e).catch(Fo).then(async()=>{if(this.url&&this.layerId==null&&/FeatureServer|MapServer\/*$/i.test(this.url)){const s=await this._fetchFirstLayerId(r);s!=null&&(this.layerId=s)}if(!this.url&&!this._hasMemorySource())throw new V("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this.initLayerProperties(await this.createGraphicsSource(r))}).then(()=>this._setUserPrivileges(this.serviceItemId,e)).then(()=>TBe(this,e));return this.addResolvingPromise(i),Promise.resolve(this)}readCapabilities(e,r){return r=r.layerDefinition||r,n1e(r,this.url)}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")??0)+1}get editingEnabled(){return!(this.loaded&&!this.capabilities?.operations.supportsEditing)&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)}set editingEnabled(e){this._overrideIfSome("editingEnabled",e)}readEditingEnabled(e,r){return this._readEditingEnabled(r,!1)}readEditingEnabledFromWebMap(e,r,i){return this._readEditingEnabled(r,!0,i)}writeEditingEnabled(e,r){this._writeEditingEnabled(e,r,!1)}writeEditingEnabledToWebMap(e,r,i,s){this._writeEditingEnabled(e,r,!0,s)}get effectiveEditingEnabled(){return EBe(this)}readIsTable(e,r){return(r=r?.layerDefinition??r).type==="Table"||!r.geometryType}writeIsTable(e,r,i,s){s?.writeLayerSchema&&tl(i,e?"Table":"Feature Layer",r)}readGlobalIdField(e,r){return t1e(r.layerDefinition||r)}readObjectIdField(e,r){return r1e(r.layerDefinition||r)}get parsedUrl(){const e=To(this.url);return e!=null&&(this.dynamicDataSource!=null?e.path=Pc(e.path,"dynamicLayer"):this.layerId!=null&&(e.path=Pc(e.path,this.layerId.toString()))),e}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){w4(e,this.fieldsIndex),this._set("renderer",e)}readRenderer(e,r,i){r=r.layerDefinition||r;const s=r.drawingInfo?.renderer;if(s){const n=AR(s,r,i)??void 0;return n||A7e.error("Failed to create renderer",{rendererDefinition:r.drawingInfo.renderer,layer:this,context:i}),n}return pY(r,i)}set source(e){const r=this._get("source");r!==e&&(Sie(r)&&this._resetMemorySource(r),Sie(e)&&this._initMemorySource(e),this._set("source",e))}castSource(e){return e?Array.isArray(e)||e instanceof Pt?new Eg({layer:this,items:e}):e:null}readSource(e,r){const i=uve.fromJSON(r.featureSet);return new Eg({layer:this,items:i?.features??[]})}readTemplates(e,r){const i=r.editFieldsInfo,s=i&&i.creatorField,n=i&&i.editorField;return e=e&&e.map(o=>EY.fromJSON(o)),this._fixTemplates(e,s),this._fixTemplates(e,n),e}readTitle(e,r){const i=r.layerDefinition?.name??r.name,s=r.title||r.layerDefinition&&r.layerDefinition.title;if(i){const n=this.portalItem&&this.portalItem.title;if(this.sublayerTitleMode==="item-title")return this.url?gve(this.url,i):i;let o=i;if(!o&&this.url){const a=cx(this.url);a!=null&&(o=a.title)}return o?(this.sublayerTitleMode==="item-title-and-service-name"&&n&&n!==o&&(o=n+" - "+o),w6(o)):void 0}if(this.sublayerTitleMode==="item-title"&&s)return s}readTitleFromWebMap(e,r){return r.title||r.layerDefinition&&r.layerDefinition.name}readTypeIdField(e,r){let i=(r=r.layerDefinition||r).typeIdField;if(i&&r.fields){i=i.toLowerCase();const s=r.fields.find(n=>n.name.toLowerCase()===i);s&&(i=s.name)}return i}readTypes(e,r){e=(r=r.layerDefinition||r).types;const i=r.editFieldsInfo,s=i&&i.creatorField,n=i&&i.editorField;return e&&e.map(o=>(o=ebe.fromJSON(o),this._fixTemplates(o.templates,s),this._fixTemplates(o.templates,n),o))}readVisible(e,r){return r.layerDefinition&&r.layerDefinition.defaultVisibility!=null?!!r.layerDefinition.defaultVisibility:r.visibility!=null?!!r.visibility:void 0}async addAttachment(e,r){return aBe(this,e,r,al)}async updateAttachment(e,r,i){return lBe(this,e,r,i,al)}async applyEdits(e,r){return cBe(this,e,r)}async uploadAssets(e,r){return uBe(this,e,r)}on(e,r){return super.on(e,r)}createPopupTemplate(e){return ibe(this,e)}async createGraphicsSource(e){if(this._hasMemorySource()&&this.source)return this.source.load({signal:e});const{default:r}=await Dfe(ce(()=>import("./FeatureLayerSource-58e16400.js"),["./FeatureLayerSource-58e16400.js","./MeshGeoreferencedRelativeVertexSpace-1e75ad47.js","./External-c7058636.js","./editingSupport-4dcb91cb.js","./normalizeUtils-30f603dc.js","./normalizeUtilsCommon-d91de345.js","./clientSideDefaults-2812b73b.js","./QueryEngineCapabilities-42e44ded.js","./QueryTask-311aacff.js","./executeForIds-a3ed391b.js","./query-226efcbe.js","./pbfQueryUtils-dc012b8b.js","./pbf-62deeddb.js","./executeQueryJSON-cda20e09.js","./executeQueryPBF-f3de30b2.js"],import.meta.url),e);return new r({layer:this}).load({signal:e})}createQuery(){const e=bBe(this);e.dynamicDataSource=this.dynamicDataSource;const r=this.subtypeCode!=null?`${this.subtypeField} = ${this.subtypeCode}`:null,i=Cke(this.definitionExpression,r);return e.where=i||"1=1",e}async deleteAttachments(e,r){return hBe(this,e,r,al)}async fetchRecomputedExtents(e){return dBe(this,e,al)}getFeatureType(e){const{typeIdField:r,types:i}=this;if(!r||!e)return null;const s=e.attributes?e.attributes[r]:void 0;if(s==null)return null;let n=null;return i?.some(o=>{const{id:a}=o;return a!=null&&(a.toString()===s.toString()&&(n=o),!!n)}),n}getFieldDomain(e,r){const i=r?.feature,s=this.getFeatureType(i);if(s){const n=s.domains&&s.domains[e];if(n&&n.type!=="inherited")return n}return this._getLayerDomain(e)}getField(e){return this.fieldsIndex.get(e)}async queryAttachments(e,r){return pBe(this,e,r,al)}async queryFeatures(e,r){const i=await this.load(),s=await i.source.queryFeatures(Ty.from(e)??i.createQuery(),r);if(s?.features)for(const n of s.features)n.layer=n.sourceLayer=i;return s}async queryObjectIds(e,r){return fBe(this,e,r,al)}async queryFeatureCount(e,r){return mBe(this,e,r,al)}async queryExtent(e,r){return gBe(this,e,r,al)}async queryRelatedFeatures(e,r){return yBe(this,e,r,al)}async queryRelatedFeaturesCount(e,r){return _Be(this,e,r,al)}async queryTopFeatures(e,r){const{source:i,capabilities:s}=await this.load();if(!i.queryTopFeatures||!s?.query?.supportsTopFeaturesQuery)throw new V(al,"Layer source does not support queryTopFeatures capability");const n=await i.queryTopFeatures(uI.from(e),r);if(n?.features)for(const o of n.features)o.layer=o.sourceLayer=this;return n}async queryTopObjectIds(e,r){const{source:i,capabilities:s}=await this.load();if(!i.queryTopObjectIds||!s?.query.supportsTopFeaturesQuery)throw new V(al,"Layer source does not support queryTopObjectIds capability");return i.queryTopObjectIds(uI.from(e),r)}async queryTopFeaturesExtent(e,r){const{source:i,capabilities:s}=await this.load();if(!i.queryTopExtents||!s?.query?.supportsTopFeaturesQuery)throw new V(al,"Layer source does not support queryTopExtents capability");return i.queryTopExtents(uI.from(e),r)}async queryTopFeatureCount(e,r){const{source:i,capabilities:s}=await this.load();if(!i.queryTopCount||!s?.query?.supportsTopFeaturesQuery)throw new V(al,"Layer source does not support queryFeatureCount capability");return i.queryTopCount(uI.from(e),r)}read(e,r){const i=e.featureCollection;if(i){const s=i.layers;s&&s.length===1&&(super.read(s[0],r),i.showLegend!=null&&super.read({showLegend:i.showLegend},r))}super.read(e,r),r&&r.origin==="service"&&(this.revert(["objectIdField","fields","timeInfo"],"service"),this.spatialReference||this.revert(["spatialReference"],"service"))}write(e,r){r={...r,origin:r?.origin??void 0,writeLayerSchema:r?.writeLayerSchema??this._hasMemorySource()};const{origin:i,layerContainerType:s,messages:n}=r;if(this.dynamicDataSource)return n?.push(hI(this,"using a dynamic data source cannot be written to web scenes, web maps and feature service items")),null;if(this.isTable){if(i==="web-scene"||i==="web-map"&&s!=="tables")return n?.push(hI(this,"using a table source cannot be written to web scenes and web maps")),null;if(this._hasMemorySource())return n?.push(hI(this,"using an in-memory table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&i==="web-map"&&s==="tables")return n?.push(hI(this,"using a non-table source cannot be written to tables in web maps")),null;return super.write(e,r)}clone(){if(this._hasMemorySource())throw new V(al,`FeatureLayer (title: ${this.title}, id: ${this.id}) created using in-memory source cannot be cloned`);return super.clone()}serviceSupportsSpatialReference(e){return!!this.loaded&&(this.source?.type==="memory"||y7e(this,e))}async save(e){const{save:r}=await ce(()=>import("./featureLayerUtils-202cf2d4.js"),["./featureLayerUtils-202cf2d4.js","./fetchService-f4a7481b.js","./jsonContext-cd374e12.js"],import.meta.url);return r(this,e)}async saveAs(e,r){const{saveAs:i}=await ce(()=>import("./featureLayerUtils-202cf2d4.js"),["./featureLayerUtils-202cf2d4.js","./fetchService-f4a7481b.js","./jsonContext-cd374e12.js"],import.meta.url);return i(this,e,r)}_readEditingEnabled(e,r,i){let s=e.layerDefinition?.capabilities;return s?this._hasEditingCapability(s):(s=e.capabilities,r&&i?.origin==="web-map"&&!this._hasMemorySource()&&s?this._hasEditingCapability(s):void 0)}_hasEditingCapability(e){return e.toLowerCase().split(",").map(r=>r.trim()).includes("editing")}_writeEditingEnabled(e,r,i,s){if(!e){const n=this.capabilities?.operations?.supportsSync?"Query,Sync":"Query";tl("layerDefinition.capabilities",n,r),i&&!s?.writeLayerSchema&&(r.capabilities=n)}}_getLayerDomain(e){const r=this.fieldsIndex.get(e);return r?r.domain:null}_fetchFirstLayerId(e){return hr(this.url,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:e}).then(r=>{const i=r.data;if(i)return Array.isArray(i.layers)&&i.layers.length>0?i.layers[0].id:Array.isArray(i.tables)&&i.tables.length>0?i.tables[0].id:void 0})}async initLayerProperties(e){return this._set("source",e),e.sourceJSON&&(this.sourceJSON=e.sourceJSON,this.read(e.sourceJSON,{origin:"service",portalItem:this.portalItem,portal:this.portalItem?.portal,url:this.parsedUrl})),this._verifySource(),this._verifyFields(),w4(this.renderer,this.fieldsIndex),sye(this.timeInfo,this.fieldsIndex),rbe(this,{origin:"service"})}async hasDataChanged(){return vBe(this)}async fetchPublishingStatus(){const e=this.source;return e?.fetchPublishingStatus?e.fetchPublishingStatus():"unavailable"}_verifyFields(){const e=this.parsedUrl?.path??"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+e+")"),this.isTable||this._hasMemorySource()||e.search(/\/FeatureServer\//i)!==-1||this.fields?.some(r=>r.type==="geometry")||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+e+")")}_fixTemplates(e,r){e&&e.forEach(i=>{const s=i.prototype&&i.prototype.attributes;s&&r&&delete s[r]})}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new V("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new V("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(e){e.forEach(r=>{r.layer=this,r.sourceLayer=this}),this._handles.add([e.on("after-add",r=>{r.item.layer=this,r.item.sourceLayer=this}),e.on("after-remove",r=>{r.item.layer=null,r.item.sourceLayer=null})],"fl-source")}_resetMemorySource(e){e.forEach(r=>{r.layer=null,r.sourceLayer=null}),this._handles.remove("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}};u([Ae("service","capabilities")],_t.prototype,"readCapabilities",null),u([d({json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],_t.prototype,"charts",void 0),u([d({readOnly:!0})],_t.prototype,"createQueryVersion",null),u([d({json:{read:{source:"layerDefinition.copyrightText"}}})],_t.prototype,"copyright",void 0),u([d({json:{read:{source:"layerDefinition.displayField"}}})],_t.prototype,"displayField",void 0),u([d({types:ew,readOnly:!0})],_t.prototype,"defaultSymbol",void 0),u([d({type:Hd})],_t.prototype,"dynamicDataSource",void 0),u([d({type:Boolean})],_t.prototype,"editingEnabled",null),u([Ae(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],_t.prototype,"readEditingEnabled",null),u([Ae("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],_t.prototype,"readEditingEnabledFromWebMap",null),u([ke(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],_t.prototype,"writeEditingEnabled",null),u([ke("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],_t.prototype,"writeEditingEnabledToWebMap",null),u([d({readOnly:!0})],_t.prototype,"effectiveEditingEnabled",null),u([d({...o9.fields,json:{read:{source:"layerDefinition.fields"},origins:{service:{name:"fields"},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:a9}}}}})],_t.prototype,"fields",void 0),u([d(o9.fieldsIndex)],_t.prototype,"fieldsIndex",void 0),u([d({type:kke,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],_t.prototype,"formTemplate",void 0),u([d({json:{read:{source:"layerDefinition.extent"}}})],_t.prototype,"fullExtent",void 0),u([d({json:{origins:{"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:a9,writer(t,e,r){const i=t?W7.toJSON(t):null;i&&tl(r,i,e)}}}},read:{source:"layerDefinition.geometryType",reader:W7.read}}})],_t.prototype,"geometryType",void 0),u([d({json:{read:{source:"layerDefinition.hasM"}}})],_t.prototype,"hasM",void 0),u([d({json:{read:{source:"layerDefinition.hasZ"}}})],_t.prototype,"hasZ",void 0),u([d(Kve)],_t.prototype,"id",void 0),u([d({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],_t.prototype,"infoFor3D",void 0),u([d({json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],_t.prototype,"isTable",void 0),u([Ae("service","isTable",["type","geometryType"]),Ae("isTable",["layerDefinition.type","layerDefinition.geometryType"])],_t.prototype,"readIsTable",null),u([ke("web-map","isTable")],_t.prototype,"writeIsTable",null),u([d(R6)],_t.prototype,"labelsVisible",void 0),u([d({type:[sC],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:V4},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:V4},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],_t.prototype,"labelingInfo",void 0),u([d((()=>{const t=K(KVe);return t.json.origins["portal-item"]={write:{target:"layerDefinition.drawingInfo.transparency",writer(e,r,i){tl(i,Y5(e),r)}}},t})())],_t.prototype,"opacity",void 0),u([d(Yve)],_t.prototype,"legendEnabled",void 0),u([d({type:["show","hide"],json:(()=>{const t=K(e1e.json);return t.origins["portal-item"]={read:!1,write:!1},t})()})],_t.prototype,"listMode",void 0),u([Ae("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],_t.prototype,"readGlobalIdField",null),u([d({json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:a9}}}}})],_t.prototype,"objectIdField",void 0),u([Ae("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],_t.prototype,"readObjectIdField",null),u([d({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],_t.prototype,"operationalLayerType",void 0),u([d(o9.outFields)],_t.prototype,"outFields",void 0),u([d({readOnly:!0})],_t.prototype,"parsedUrl",null),u([d({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],_t.prototype,"path",void 0),u([d(O6)],_t.prototype,"popupEnabled",void 0),u([d({type:_v,json:{name:"popupInfo",write:!0}})],_t.prototype,"popupTemplate",void 0),u([d({readOnly:!0})],_t.prototype,"defaultPopupTemplate",null),u([d({types:y6,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:H_e,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:(t,e,r)=>({ignoreOrigin:r?.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(t,e,r)=>({ignoreOrigin:r?.writeLayerSchema})}}})],_t.prototype,"renderer",null),u([Ae("service","renderer",["drawingInfo.renderer","defaultSymbol"]),Ae("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],_t.prototype,"readRenderer",null),u([d((()=>{const t=K(Xve);return t.json.origins["portal-item"]={read:!1,write:!1},t})())],_t.prototype,"screenSizePerspectiveEnabled",void 0),u([d({clonable:!1})],_t.prototype,"source",null),u([wr("source")],_t.prototype,"castSource",null),u([Ae("portal-item","source",["featureSet"]),Ae("web-map","source",["featureSet"])],_t.prototype,"readSource",null),u([d({json:{read:{source:"layerDefinition.extent.spatialReference"}}})],_t.prototype,"spatialReference",void 0),u([d({type:Number})],_t.prototype,"subtypeCode",void 0),u([d({type:[EY]})],_t.prototype,"templates",void 0),u([Ae("templates",["editFieldsInfo","creatorField","editorField","templates"])],_t.prototype,"readTemplates",null),u([d({type:K1e})],_t.prototype,"timeInfo",void 0),u([d()],_t.prototype,"title",void 0),u([Ae("service","title",["name"]),Ae("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],_t.prototype,"readTitle",null),u([Ae("web-map","title",["layerDefinition.name","title"])],_t.prototype,"readTitleFromWebMap",null),u([d({type:String})],_t.prototype,"sublayerTitleMode",void 0),u([d({json:{read:!1}})],_t.prototype,"type",void 0),u([d({type:String})],_t.prototype,"typeIdField",void 0),u([Ae("service","typeIdField"),Ae("typeIdField",["layerDefinition.typeIdField"])],_t.prototype,"readTypeIdField",null),u([d({type:[ebe]})],_t.prototype,"types",void 0),u([Ae("service","types",["types"]),Ae("types",["layerDefinition.types"])],_t.prototype,"readTypes",null),u([d({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],_t.prototype,"visible",void 0),u([Ae("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],_t.prototype,"readVisible",null),_t=u([P(sbe)],_t);const $R=_t,gDt=Object.freeze(Object.defineProperty({__proto__:null,default:$R},Symbol.toStringTag,{value:"Module"}));function nbe(t){return t&&"getAtOrigin"in t&&"originOf"in t}function Eie(t){t&&t.writtenProperties&&t.writtenProperties.forEach(({target:e,propName:r,newOrigin:i})=>{nbe(e)&&i&&e.originOf(r)!==i&&e.updateOrigin(r,i)})}async function O7e(t,e,r,i,s,n){let o=null;if(r!=null){const c=`${t}/nodepages/`,h=c+Math.floor(r.rootIndex/r.nodesPerPage);try{return{type:"page",rootPage:(await hr(h,{query:{f:"json",token:i},responseType:"json",signal:n})).data,rootIndex:r.rootIndex,pageSize:r.nodesPerPage,lodMetric:r.lodSelectionMetricType,urlPrefix:c}}catch(p){s?.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",h,p),o=p}}if(!e)return null;const a=`${t}/nodes/`,l=a+(e&&e.split("/").pop());try{return{type:"node",rootNode:(await hr(l,{query:{f:"json",token:i},responseType:"json",signal:n})).data,urlPrefix:a}}catch(c){throw new V("sceneservice:root-node-missing","Root node missing.",{pageError:o,nodeError:c,url:l})}}let R7e=null;function M7e(){return R7e}const P7e="randomUUID"in crypto;function N6(){if(P7e)return crypto.randomUUID();const t=crypto.getRandomValues(new Uint16Array(8));t[3]=4095&t[3]|16384,t[4]=16383&t[4]|32768;const e=r=>t[r].toString(16).padStart(4,"0");return e(0)+e(1)+"-"+e(2)+"-"+e(3)+"-"+e(4)+"-"+e(5)+e(6)+e(7)}function yDt(){return`{${N6()}}`}async function I7e(t,e={},r){await t.load(r);const i=Pc(t.itemUrl,"resources"),{start:s=1,num:n=10,sortOrder:o="asc",sortField:a="created"}=e,l={query:{start:s,num:n,sortOrder:o,sortField:a,token:t.apiKey},signal:r?.signal},c=await t.portal.request(i,l);return{total:c.total,nextStart:c.nextStart,resources:c.resources.map(({created:h,size:p,resource:f})=>({created:new Date(h),size:p,resource:t.resourceFromPath(f)}))}}async function $7e(t,e,r,i){if(!t.hasPath())throw new V(`portal-item-resource-${e}:invalid-path`,"Resource does not have a valid path");const s=t.portalItem;await s.load(i);const n=Pc(s.userItemUrl,e==="add"?"addResources":"updateResources"),[o,a]=obe(t.path),l=await abe(r),c=new FormData;return o&&o!=="."&&c.append("resourcesPrefix",o),i!=null&&i.compress&&c.append("compress","true"),c.append("fileName",a),c.append("file",l,a),c.append("f","json"),i!=null&&i.access&&c.append("access",i.access),await s.portal.request(n,{method:"post",body:c,signal:i?.signal}),t}async function L7e(t,e,r){if(!e.hasPath())throw new V("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await t.load(r);const i=Pc(t.userItemUrl,"removeResources");await t.portal.request(i,{method:"post",query:{resource:e.path},signal:r?.signal}),e.portalItem=null}async function D7e(t,e){await t.load(e);const r=Pc(t.userItemUrl,"removeResources");return t.portal.request(r,{method:"post",query:{deleteAll:!0},signal:e?.signal})}function obe(t){const e=t.lastIndexOf("/");return e===-1?[".",t]:[t.slice(0,e),t.slice(e+1)]}function CY(t){const[e,r]=N7e(t),[i,s]=obe(e);return[i,s,r]}function N7e(t){const e=RX(t);return e==null?[t,""]:[t.slice(0,t.length-e.length-1),`.${e}`]}async function abe(t){return t instanceof Blob?t:(await hr(t.url,{responseType:"blob"})).data}function F7e(t,e){if(!t.hasPath())return null;const[r,,i]=CY(t.path);return t.portalItem.resourceFromPath(Pc(r,e+i))}function lbe(t,e){if(!t.hasPath())return null;const[r,,i]=CY(t.path);return t.portalItem.resourceFromPath(Pc(r,e+i))}const w3=Object.freeze(Object.defineProperty({__proto__:null,addOrUpdateResource:$7e,contentToBlob:abe,fetchResources:I7e,getSiblingOfSameType:F7e,getSiblingOfSameTypeI:lbe,removeAllResources:D7e,removeResource:L7e,splitPrefixFileNameAndExtension:CY},Symbol.toStringTag,{value:"Module"}));async function Cie(t,e,r){if(!e||!e.resources)return;const i=e.portalItem===t.portalItem?new Set(t.paths):new Set;t.paths.length=0,t.portalItem=e.portalItem;const s=new Set(e.resources.toKeep.map(c=>c.resource.path)),n=new Set,o=[];s.forEach(c=>{i.delete(c),t.paths.push(c)});for(const c of e.resources.toUpdate)if(i.delete(c.resource.path),s.has(c.resource.path)||n.has(c.resource.path)){const{resource:h,content:p,finish:f,error:m}=c,y=lbe(h,N6());t.paths.push(y.path),o.push(Aie({resource:y,content:p,compress:c.compress,finish:f,error:m},r))}else t.paths.push(c.resource.path),o.push(U7e(c,r)),n.add(c.resource.path);for(const c of e.resources.toAdd)o.push(Aie(c,r)),t.paths.push(c.resource.path);if(i.forEach(c=>{if(e.portalItem){const h=e.portalItem.resourceFromPath(c);o.push(h.portalItem.removeResource(h).catch(()=>{}))}}),o.length===0)return;const a=await bc(o);Yt(r);const l=a.filter(c=>"error"in c).map(c=>c.error);if(l.length>0)throw new V("save:resources","Failed to save one or more resources",{errors:l})}async function Aie(t,e){const r={...e??{},compress:t.compress},i=await Eu(t.resource.portalItem.addResource(t.resource,t.content,r));if(i.ok!==!0)throw t.error?.(i.error),i.error;t.finish?.(t.resource)}async function U7e(t,e){const r=await Eu(t.resource.update(t.content,e));if(r.ok!==!0)throw t.error?.(r.error),r.error;t.finish?.(t.resource)}const cbe="esri.layers.mixins.SceneService",Ax=Q.getLogger(cbe),k7e=t=>{let e=class extends t{constructor(){super(...arguments),this.spatialReference=null,this.fullExtent=null,this.heightModelInfo=null,this.minScale=0,this.maxScale=0,this.version={major:Number.NaN,minor:Number.NaN,versionString:""},this.copyright=null,this.sublayerTitleMode="item-title",this.title=null,this.layerId=null,this.indexInfo=null,this._debouncedSaveOperations=cX(async(r,i,s)=>{switch(r){case sE.SAVE:return this._save(i);case sE.SAVE_AS:return this._saveAs(s,i)}})}readSpatialReference(r,i){return this._readSpatialReference(i)}_readSpatialReference(r){if(r.spatialReference!=null)return je.fromJSON(r.spatialReference);{const i=r.store,s=i.indexCRS||i.geographicCRS,n=s&&parseInt(s.substring(s.lastIndexOf("/")+1,s.length),10);return n!=null?new je(n):null}}readFullExtent(r,i,s){if(r!=null&&typeof r=="object"){const a=r.spatialReference==null?{...r,spatialReference:this._readSpatialReference(i)}:r;return ur.fromJSON(a,s)}const n=i.store,o=this._readSpatialReference(i);return o==null||n==null||n.extent==null||!Array.isArray(n.extent)||n.extent.some(a=>a<l9)?null:new ur({xmin:n.extent[0],ymin:n.extent[1],xmax:n.extent[2],ymax:n.extent[3],spatialReference:o})}parseVersionString(r){const i={major:Number.NaN,minor:Number.NaN,versionString:r},s=r.split(".");return s.length>=2&&(i.major=parseInt(s[0],10),i.minor=parseInt(s[1],10)),i}readVersion(r,i){const s=i.store,n=s.version!=null?s.version.toString():"";return this.parseVersionString(n)}readTitlePortalItem(r){return this.sublayerTitleMode!=="item-title"?void 0:r}readTitleService(r,i){const s=this.portalItem&&this.portalItem.title;if(this.sublayerTitleMode==="item-title")return gve(this.url,i.name);let n=i.name;if(!n&&this.url){const o=cx(this.url);o!=null&&(n=o.title)}return this.sublayerTitleMode==="item-title-and-service-name"&&s&&(n=s+" - "+n),w6(n)}set url(r){const i=yve({layer:this,url:r,nonStandardUrlAllowed:!1,logger:Ax});this._set("url",i.url),i.layerId!=null&&this._set("layerId",i.layerId)}writeUrl(r,i,s,n){_ve(this,r,"layers",i,n)}get parsedUrl(){const r=this._get("url"),i=To(r);return this.layerId!=null&&(i.path=`${i.path}/layers/${this.layerId}`),i}async _fetchIndexAndUpdateExtent(r,i){this.indexInfo=O7e(this.parsedUrl.path,this.rootNode,r,this.apiKey,Ax,i),this.fullExtent==null||this.fullExtent.hasZ||this._updateExtent(await this.indexInfo)}_updateExtent(r){if(r?.type==="page"){const i=r.rootIndex%r.pageSize,s=r.rootPage?.nodes?.[i];if(s==null||s.obb==null||s.obb.center==null||s.obb.halfSize==null)throw new V("sceneservice:invalid-node-page","Invalid node page.");if(s.obb.center[0]<l9||this.fullExtent==null||this.fullExtent.hasZ)return;const n=s.obb.halfSize,o=s.obb.center[2],a=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);this.fullExtent.zmin=o-a,this.fullExtent.zmax=o+a}else if(r?.type==="node"){const i=r.rootNode?.mbs;if(!Array.isArray(i)||i.length!==4||i[0]<l9)return;const s=i[2],n=i[3],{fullExtent:o}=this;o&&(o.zmin=s-n,o.zmax=s+n)}}async _fetchService(r){if(this.url==null)throw new V("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(this.layerId==null&&/SceneServer\/*$/i.test(this.url)){const i=await this._fetchFirstLayerId(r);i!=null&&(this.layerId=i)}return this._fetchServiceLayer(r)}async _fetchFirstLayerId(r){const i=await hr(this.url,{query:{f:"json",token:this.apiKey},responseType:"json",signal:r});if(i.data&&Array.isArray(i.data.layers)&&i.data.layers.length>0)return i.data.layers[0].id}async _fetchServiceLayer(r){const i=await hr(this.parsedUrl?.path??"",{query:{f:"json",token:this.apiKey},responseType:"json",signal:r});i.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));let s=!1;if(i.data.layerType&&i.data.layerType==="Voxel"&&(s=!0),s)return this._fetchVoxelServiceLayer();const n=i.data;this.read(n,this._getServiceContext()),this.validateLayer(n)}async _fetchVoxelServiceLayer(r){const i=(await hr(this.parsedUrl?.path+"/layer",{query:{f:"json",token:this.apiKey},responseType:"json",signal:r})).data;this.read(i,this._getServiceContext()),this.validateLayer(i)}_getServiceContext(){return{origin:"service",portalItem:this.portalItem,portal:this.portalItem?.portal,url:this.parsedUrl}}async _ensureLoadBeforeSave(){await this.load(),"beforeSave"in this&&typeof this.beforeSave=="function"&&await this.beforeSave()}validateLayer(r){}_updateTypeKeywords(r,i,s){r.typeKeywords||(r.typeKeywords=[]);const n=i.getTypeKeywords();for(const o of n)r.typeKeywords.push(o);r.typeKeywords&&(r.typeKeywords=r.typeKeywords.filter((o,a,l)=>l.indexOf(o)===a),s===$O.newItem&&(r.typeKeywords=r.typeKeywords.filter(o=>o!=="Hosted Service")))}async _saveAs(r,i){const s={...Oie,...i};let n=Yb.from(r);n||(Ax.error("_saveAs(): requires a portal item parameter"),await Promise.reject(new V("sceneservice:portal-item-required","_saveAs() requires a portal item to save to"))),n.id&&(n=n.clone(),n.id=null);const o=n.portal||Js.getDefault();await this._ensureLoadBeforeSave(),n.type=dI,n.portal=o;const a={origin:"portal-item",url:null,messages:[],portal:o,portalItem:n,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},l={layers:[this.write({},a)]};return await Promise.all(a.resources.pendingOperations??[]),await this._validateAgainstJSONSchema(l,a,s),n.url=this.url,n.title||(n.title=this.title),this._updateTypeKeywords(n,s,$O.newItem),await o.signIn(),await o.user?.addItem({item:n,folder:s&&s.folder,data:l}),await Cie(this.resourceReferences,a,null),this.portalItem=n,Eie(a),a.portalItem=n,n}async _save(r){const i={...Oie,...r};if(!this.portalItem)throw Ax.error("_save(): requires the .portalItem property to be set"),new V("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService");if(this.portalItem.type!==dI)throw Ax.error("_save(): Non-matching portal item type. Got "+this.portalItem.type+", expected "+dI),new V("sceneservice:portal-item-wrong-type",`Portal item needs to have type "${dI}"`);await this._ensureLoadBeforeSave();const s={origin:"portal-item",url:this.portalItem.itemUrl&&To(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||Js.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},n={layers:[this.write({},s)]};return await Promise.all(s.resources.pendingOperations??[]),await this._validateAgainstJSONSchema(n,s,i),this.portalItem.url=this.url,this.portalItem.title||(this.portalItem.title=this.title),this._updateTypeKeywords(this.portalItem,i,$O.existingItem),await this.portalItem.update({data:n}),await Cie(this.resourceReferences,s,null),Eie(s),this.portalItem}async _validateAgainstJSONSchema(r,i,s){let n=i.messages?.filter(c=>c.type==="error").map(c=>new V(c.name,c.message,c.details))??[];s?.validationOptions?.ignoreUnsupported&&(n=n.filter(c=>c.name!=="layer:unsupported"&&c.name!=="symbol:unsupported"&&c.name!=="symbol-layer:unsupported"&&c.name!=="property:unsupported"&&c.name!=="url:unsupported"&&c.name!=="scenemodification:unsupported"));const o=s?.validationOptions,a=o?.enabled,l=M7e();if(a&&l){const c=(await l()).validate(r,s.portalItemLayerType);if(c.length>0){const h=`Layer item did not validate:
${c.join(`
`)}`;if(Ax.error(`_validateAgainstJSONSchema(): ${h}`),o.failPolicy==="throw"){const p=c.map(f=>new V("sceneservice:schema-validation",f)).concat(n);throw new V("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{combined:p})}}}if(n.length>0)throw new V("sceneservice:save","Failed to save SceneService due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:n})}};return u([d(Kve)],e.prototype,"id",void 0),u([d({type:je})],e.prototype,"spatialReference",void 0),u([Ae("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],e.prototype,"readSpatialReference",null),u([d({type:ur})],e.prototype,"fullExtent",void 0),u([Ae("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],e.prototype,"readFullExtent",null),u([d({readOnly:!0,type:ux})],e.prototype,"heightModelInfo",void 0),u([d({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],e.prototype,"minScale",void 0),u([d({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],e.prototype,"maxScale",void 0),u([d({readOnly:!0})],e.prototype,"version",void 0),u([Ae("version",["store.version"])],e.prototype,"readVersion",null),u([d({type:String,json:{read:{source:"copyrightText"}}})],e.prototype,"copyright",void 0),u([d({type:String,json:{read:!1}})],e.prototype,"sublayerTitleMode",void 0),u([d({type:String})],e.prototype,"title",void 0),u([Ae("portal-item","title")],e.prototype,"readTitlePortalItem",null),u([Ae("service","title",["name"])],e.prototype,"readTitleService",null),u([d({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],e.prototype,"layerId",void 0),u([d(Zve)],e.prototype,"url",null),u([ke("url")],e.prototype,"writeUrl",null),u([d()],e.prototype,"parsedUrl",null),u([d({readOnly:!0})],e.prototype,"store",void 0),u([d({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],e.prototype,"rootNode",void 0),e=u([P(cbe)],e),e},l9=-1e38;var $O;(function(t){t[t.existingItem=0]="existingItem",t[t.newItem=1]="newItem"})($O||($O={}));const dI="Scene Service",Oie={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}};var sE;(function(t){t[t.SAVE=0]="SAVE",t[t.SAVE_AS=1]="SAVE_AS"})(sE||(sE={}));const z7e={analytics:{supportsCacheHint:!1},attachment:{supportsContentType:!1,supportsExifInfo:!1,supportsKeywords:!1,supportsName:!1,supportsSize:!1,supportsCacheHint:!1,supportsResize:!1},data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsAsyncApplyEdits:!1},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1,supportsAsyncConvert3D:!1},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},query:{maxRecordCount:0,maxRecordCountFactor:0,standardMaxRecordCount:0,supportsCacheHint:!1,supportsCentroid:!1,supportsCompactGeometry:!1,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsSqlExpression:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsStatistics:!1,tileMaxRecordCount:0}};let V7e=class{constructor(e,r,i,s){this._parsedUrl=e,this._portalItem=r,this._apiKey=i,this.signal=s,this._rootDocument=null;const n=this._parsedUrl?.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i);n&&(this._urlParts={root:n[1],layerId:parseInt(n[2],10)})}async fetch(){if(!this._urlParts)return null;const e=this._portalItem??await this._portalItemFromServiceItemId();if(e==null)return this._loadFromUrl();const r=await this._findAndLoadRelatedPortalItem(e);return r==null?null:this._loadFeatureLayerFromPortalItem(r)}async fetchPortalItem(){if(!this._urlParts)return null;const e=this._portalItem??await this._portalItemFromServiceItemId();return e==null?null:this._findAndLoadRelatedPortalItem(e)}async _fetchRootDocument(){if(this._rootDocument!=null)return this._rootDocument;if(this._urlParts==null)return this._rootDocument={},{};const e={query:{f:"json",token:this._apiKey},responseType:"json",signal:this.signal},r=`${this._urlParts.root}/SceneServer`;try{const i=await hr(r,e);this._rootDocument=i.data}catch{this._rootDocument={}}return this._rootDocument}async _fetchServiceOwningPortalUrl(){const e=this._parsedUrl?.path,r=e?Pi?.findServerInfo(e):null;if(r?.owningSystemUrl)return r.owningSystemUrl;const i=e?e.replace(/(.*\/rest)\/.*/i,"$1")+"/info":null;try{const s=(await hr(i,{query:{f:"json"},responseType:"json",signal:this.signal})).data.owningSystemUrl;if(s)return s}catch(s){Fo(s)}return null}async _findAndLoadRelatedPortalItem(e){try{return(await e.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:this.signal})).find(r=>r.type==="Feature Service")||null}catch(r){return Fo(r),null}}async _loadFeatureLayerFromPortalItem(e){await e.load({signal:this.signal});const r=await this._findMatchingAssociatedSublayerUrl(e.url??"");return new $R({url:r,portalItem:e}).load({signal:this.signal})}async _loadFromUrl(){const e=await this._findMatchingAssociatedSublayerUrl(`${this._urlParts?.root}/FeatureServer`);return new $R({url:e}).load({signal:this.signal})}async _findMatchingAssociatedSublayerUrl(e){const r=e.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1"),i=this._urlParts?.layerId,s=this._fetchRootDocument(),n=p=>{const f={query:{f:"json"},responseType:"json",authMode:p,signal:this.signal};return hr(r,f)},o=n("anonymous").catch(()=>n("no-prompt")),[a,l]=await Promise.all([o,s]),c=l&&l.layers,h=a.data&&a.data.layers;if(!Array.isArray(h))throw new Error("expected layers array");if(Array.isArray(c)){for(let p=0;p<Math.min(c.length,h.length);p++)if(c[p].id===i)return`${r}/${h[p].id}`}else if(i!=null&&i<h.length)return`${r}/${h[i].id}`;throw new Error("could not find matching associated sublayer")}async _portalItemFromServiceItemId(){const e=(await this._fetchRootDocument()).serviceItemId;if(!e)return null;const r=new Yb({id:e,apiKey:this._apiKey}),i=await this._fetchServiceOwningPortalUrl();i!=null&&(r.portal=new Js({url:i}));try{return r.load({signal:this.signal})}catch(s){return Fo(s),null}}},Tb=class extends le{constructor(){super(...arguments),this.nodesPerPage=null,this.rootIndex=0,this.lodSelectionMetricType=null}};u([d({type:Number})],Tb.prototype,"nodesPerPage",void 0),u([d({type:Number})],Tb.prototype,"rootIndex",void 0),u([d({type:String})],Tb.prototype,"lodSelectionMetricType",void 0),Tb=u([P("esri.layer.support.I3SNodePageDefinition")],Tb);let Vg=class extends le{constructor(){super(...arguments),this.factor=1}};u([d({type:Number,json:{read:{source:"textureSetDefinitionId"}}})],Vg.prototype,"id",void 0),u([d({type:Number})],Vg.prototype,"factor",void 0),Vg=u([P("esri.layer.support.I3SMaterialTexture")],Vg);let k0=class extends le{constructor(){super(...arguments),this.baseColorFactor=[1,1,1,1],this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.metallicFactor=1,this.roughnessFactor=1}};u([d({type:[Number]})],k0.prototype,"baseColorFactor",void 0),u([d({type:Vg})],k0.prototype,"baseColorTexture",void 0),u([d({type:Vg})],k0.prototype,"metallicRoughnessTexture",void 0),u([d({type:Number})],k0.prototype,"metallicFactor",void 0),u([d({type:Number})],k0.prototype,"roughnessFactor",void 0),k0=u([P("esri.layer.support.I3SMaterialPBRMetallicRoughness")],k0);let th=class extends le{constructor(){super(...arguments),this.alphaMode="opaque",this.alphaCutoff=.25,this.doubleSided=!1,this.cullFace="none",this.normalTexture=null,this.occlusionTexture=null,this.emissiveTexture=null,this.emissiveFactor=null,this.pbrMetallicRoughness=null}};u([it({opaque:"opaque",mask:"mask",blend:"blend"})],th.prototype,"alphaMode",void 0),u([d({type:Number})],th.prototype,"alphaCutoff",void 0),u([d({type:Boolean})],th.prototype,"doubleSided",void 0),u([it({none:"none",back:"back",front:"front"})],th.prototype,"cullFace",void 0),u([d({type:Vg})],th.prototype,"normalTexture",void 0),u([d({type:Vg})],th.prototype,"occlusionTexture",void 0),u([d({type:Vg})],th.prototype,"emissiveTexture",void 0),u([d({type:[Number]})],th.prototype,"emissiveFactor",void 0),u([d({type:k0})],th.prototype,"pbrMetallicRoughness",void 0),th=u([P("esri.layer.support.I3SMaterialDefinition")],th);let x3=class extends le{};u([d({type:String,json:{read:{source:["name","index"],reader:(t,e)=>t??`${e.index}`}}})],x3.prototype,"name",void 0),u([it({jpg:"jpg",png:"png",dds:"dds","ktx-etc2":"ktx-etc2",ktx2:"ktx2",basis:"basis"})],x3.prototype,"format",void 0),x3=u([P("esri.layer.support.I3STextureFormat")],x3);let T3=class extends le{constructor(){super(...arguments),this.atlas=!1}};u([d({type:[x3]})],T3.prototype,"formats",void 0),u([d({type:Boolean})],T3.prototype,"atlas",void 0),T3=u([P("esri.layer.support.I3STextureSetDefinition")],T3);let qd=class extends le{};u([it({Float32:"Float32",UInt64:"UInt64",UInt32:"UInt32",UInt16:"UInt16",UInt8:"UInt8"})],qd.prototype,"type",void 0),u([d({type:Number})],qd.prototype,"component",void 0),qd=u([P("esri.layer.support.I3SGeometryAttribute")],qd);let S3=class extends le{};u([it({draco:"draco"})],S3.prototype,"encoding",void 0),u([d({type:[String]})],S3.prototype,"attributes",void 0),S3=u([P("esri.layer.support.I3SGeometryCompressedAttributes")],S3);let od=class extends le{constructor(){super(...arguments),this.offset=0}};u([d({type:Number})],od.prototype,"offset",void 0),u([d({type:qd})],od.prototype,"position",void 0),u([d({type:qd})],od.prototype,"normal",void 0),u([d({type:qd})],od.prototype,"uv0",void 0),u([d({type:qd})],od.prototype,"color",void 0),u([d({type:qd})],od.prototype,"uvRegion",void 0),u([d({type:qd})],od.prototype,"featureId",void 0),u([d({type:qd})],od.prototype,"faceRange",void 0),u([d({type:S3})],od.prototype,"compressedAttributes",void 0),od=u([P("esri.layer.support.I3SGeometryBuffer")],od);let E3=class extends le{};u([it({triangle:"triangle"})],E3.prototype,"topology",void 0),u([d()],E3.prototype,"geometryBuffers",void 0),E3=u([P("esri.layer.support.I3SGeometryDefinition")],E3);let z0=class extends le{constructor(){super(...arguments),this.name=null,this.field=null,this.currentRangeExtent=null,this.fullRangeExtent=null,this.type="rangeInfo"}};u([d({type:String,json:{read:!0,write:!0}})],z0.prototype,"name",void 0),u([d({type:String,json:{read:!0,write:!0}})],z0.prototype,"field",void 0),u([d({type:[Number],json:{read:!0,write:!0}})],z0.prototype,"currentRangeExtent",void 0),u([d({type:[Number],json:{read:!0,write:!0}})],z0.prototype,"fullRangeExtent",void 0),u([d({type:["rangeInfo"],readOnly:!0,json:{read:!1,write:!0}})],z0.prototype,"type",void 0),z0=u([P("esri.layers.support.RangeInfo")],z0);function wj(t){return AY[B7e(t)]||j7e}function B7e(t){return t instanceof Blob?t.type:G7e(t.url)}function G7e(t){const e=RX(t);return xj[e]||ube}const AY={},ube="text/plain",j7e=AY[ube],xj={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(const t in xj)AY[xj[t]]=t;function H7e(t){const e=t?.origins??[void 0];return(r,i)=>{const s=q7e(t,r,i);for(const n of e){const o=dX(r,n,i);for(const a in s)o[a]=s[a]}}}function q7e(t,e,r){if(t?.type==="resource")return W7e(t,e,r);switch(t?.type??"other"){case"other":return{read:!0,write:!0};case"url":{const{read:i,write:s}=H8e;return{read:i,write:s}}}}function W7e(t,e,r){const i=bM(e,r);return{type:String,read:(s,n,o)=>{const a=h6(s,n,o);return i.type===String?a:typeof i.type=="function"?new i.type({url:a}):void 0},write:{writer(s,n,o,a){if(!a||!a.resources)return typeof s=="string"?void(n[o]=hy(s,a)):void(n[o]=s.write({},a));const l=J7e(s),c=hy(l,{...a,verifyItemRelativeUrls:a&&a.verifyItemRelativeUrls?{writtenUrls:a.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},Y2.NO),h=i.type!==String&&(!nbe(this)||a&&a.origin&&this.originIdOf(r)>Fg(a.origin)),p={object:this,propertyName:r,value:s,targetUrl:c,dest:n,targetPropertyName:o,context:a,params:t};a&&a.portalItem&&c&&!Ac(c)?h?X7e(p):Z7e(p):a&&a.portalItem&&(c==null||V0e(c)!=null||W_(c)||h)?hbe(p):n[o]=c}}}}function hbe(t){const{targetUrl:e,params:r,value:i,context:s,dest:n,targetPropertyName:o}=t;if(!s.portalItem)return;const a=B0e(e),l=a?.filename??N6(),c=r?.prefix??a?.prefix,h=pbe(i,e,s),p=Pc(c,l),f=`${p}.${wj(h)}`,m=s.portalItem.resourceFromPath(f);W_(e)&&s.resources&&s.resources.pendingOperations.push(Y7e(e).then(_=>{m.path=`${p}.${wj(_)}`,n[o]=m.itemRelativeUrl}).catch(()=>{}));const y=r?.compress??!1;s.resources&&dbe({...t,resource:m,content:h,compress:y,updates:s.resources.toAdd}),n[o]=m.itemRelativeUrl}function X7e(t){const{context:e,targetUrl:r,params:i,value:s,dest:n,targetPropertyName:o}=t;if(!e.portalItem)return;const a=e.portalItem.resourceFromPath(r),l=pbe(s,r,e),c=wj(l),h=RX(a.path),p=i?.compress??!1;c===h?(e.resources&&dbe({...t,resource:a,content:l,compress:p,updates:e.resources.toUpdate}),n[o]=r):hbe(t)}function Z7e({context:t,targetUrl:e,dest:r,targetPropertyName:i}){t.portalItem&&t.resources&&(t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(e),compress:!1}),r[i]=e)}function dbe({object:t,propertyName:e,updates:r,resource:i,content:s,compress:n}){r.push({resource:i,content:s,compress:n,finish:o=>{Q7e(t,e,o)}})}function pbe(t,e,r){return typeof t=="string"?{url:e}:new Blob([JSON.stringify(t.toJSON(r))],{type:"application/json"})}async function Y7e(t){const e=(await ce(()=>Promise.resolve().then(()=>Zme),void 0,import.meta.url)).default,{data:r}=await e(t,{responseType:"blob"});return r}function J7e(t){return t==null?null:typeof t=="string"?t:t.url}function Q7e(t,e,r){typeof t[e]=="string"?t[e]=r.url:t[e].url=r.url}var kD;let Tj=kD=class extends GE(Pt.ofType(yu)){constructor(t){super(t)}clone(){return new kD(this.items.map(t=>t.clone()))}write(t,e){return this.toJSON(e)}toJSON(t){const e=t?.layer?.spatialReference;return e?this.toArray().map(r=>{if(!e.equals(r.spatialReference)){if(!lm(r.spatialReference,e))return t&&t.messages&&t.messages.push(new Nh("scenefilter:unsupported","Scene filters with incompatible spatial references are not supported",{modification:this,spatialReference:t.layer.spatialReference,context:t})),null;const s=new yu;R1e(r,s,e),r=s}const i=r.toJSON(t);return delete i.spatialReference,i}).filter(r=>r!=null):(t?.messages&&t.messages.push(new Nh("scenefilter:unsupported","Writing Scene filters without context layer is not supported",{modification:this,spatialReference:t.layer.spatialReference,context:t})),this.toArray().map(r=>r.toJSON(t)))}static fromJSON(t,e){const r=new kD;return t.forEach(i=>r.add(yu.fromJSON(i,e))),r}};Tj=kD=u([P("esri.layers.support.PolygonCollection")],Tj);const zD=Tj;var Sj;let aS=Sj=class extends le{constructor(t){super(t),this.spatialRelationship="disjoint",this.geometries=new zD,this._geometriesSource=null,this._handles=new Ii}initialize(){this._handles.add(fa(()=>this.geometries,"after-changes",()=>this.geometries=this.geometries,qr))}destroy(){this._handles.destroy()}readGeometries(t,e,r){Array.isArray(t)?this.geometries=zD.fromJSON(t,r):this._geometriesSource={url:uy(t,r),context:r}}async loadGeometries(t,e){if(this._geometriesSource==null)return;const{url:r,context:i}=this._geometriesSource,s=await hr(r,{responseType:"json",signal:e?.signal}),n=t.toJSON(),o=s.data.map(a=>({...a,spatialReference:n}));this.geometries=zD.fromJSON(o,i),this._geometriesSource=null}clone(){const t=new Sj({geometries:K(this.geometries),spatialRelationship:this.spatialRelationship});return t._geometriesSource=this._geometriesSource,t}};u([d({type:["disjoint","contains"],nonNullable:!0,json:{write:!0}})],aS.prototype,"spatialRelationship",void 0),u([d({type:zD,nonNullable:!0,json:{write:!0}}),H7e({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries"})],aS.prototype,"geometries",void 0),u([Ae(["web-scene","portal-item"],"geometries")],aS.prototype,"readGeometries",null),aS=Sj=u([P("esri.layers.support.SceneFilter")],aS);const K7e=aS;function Vh(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function eje(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function OY(t,e,r,i,s,n,o,a,l,c){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t[4]=n,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t}function RY(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Bh(t,e){if(t===e){const r=e[1],i=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=i,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function dx(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=h*o-a*c,f=-h*n+a*l,m=c*n-o*l;let y=r*p+i*f+s*m;return y?(y=1/y,t[0]=p*y,t[1]=(-h*i+s*c)*y,t[2]=(a*i-s*o)*y,t[3]=f*y,t[4]=(h*r-s*l)*y,t[5]=(-a*r+s*n)*y,t[6]=m*y,t[7]=(-c*r+i*l)*y,t[8]=(o*r-i*n)*y,t):null}function tje(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8];return t[0]=o*h-a*c,t[1]=s*c-i*h,t[2]=i*a-s*o,t[3]=a*l-n*h,t[4]=r*h-s*l,t[5]=s*n-r*a,t[6]=n*c-o*l,t[7]=i*l-r*c,t[8]=r*o-i*n,t}function rje(t){const e=t[0],r=t[1],i=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*(c*n-o*l)+r*(-c*s+o*a)+i*(l*s-n*a)}function nE(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],p=e[8],f=r[0],m=r[1],y=r[2],_=r[3],v=r[4],b=r[5],T=r[6],x=r[7],S=r[8];return t[0]=f*i+m*o+y*c,t[1]=f*s+m*a+y*h,t[2]=f*n+m*l+y*p,t[3]=_*i+v*o+b*c,t[4]=_*s+v*a+b*h,t[5]=_*n+v*l+b*p,t[6]=T*i+x*o+S*c,t[7]=T*s+x*a+S*h,t[8]=T*n+x*l+S*p,t}function B4(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],p=e[8],f=r[0],m=r[1];return t[0]=i,t[1]=s,t[2]=n,t[3]=o,t[4]=a,t[5]=l,t[6]=f*i+m*o+c,t[7]=f*s+m*a+h,t[8]=f*n+m*l+p,t}function MY(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],p=e[8],f=Math.sin(r),m=Math.cos(r);return t[0]=m*i+f*o,t[1]=m*s+f*a,t[2]=m*n+f*l,t[3]=m*o-f*i,t[4]=m*a-f*s,t[5]=m*l-f*n,t[6]=c,t[7]=h,t[8]=p,t}function PY(t,e,r){const i=r[0],s=r[1],n=r[2];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=n*e[6],t[7]=n*e[7],t[8]=n*e[8],t}function ije(t,e,r){const i=r[0],s=r[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t}function sje(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function nje(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=-r,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function oje(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function aje(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function F6(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=r+r,a=i+i,l=s+s,c=r*o,h=i*o,p=i*a,f=s*o,m=s*a,y=s*l,_=n*o,v=n*a,b=n*l;return t[0]=1-p-y,t[3]=h-b,t[6]=f+v,t[1]=h+b,t[4]=1-c-y,t[7]=m-_,t[2]=f-v,t[5]=m+_,t[8]=1-c-p,t}function fbe(t,e){const r=e[0],i=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],h=e[10],p=h*o-a*c,f=-h*n+a*l,m=c*n-o*l,y=r*p+i*f+s*m;if(!y)return null;const _=1/y;return t[0]=p*_,t[1]=(-h*i+s*c)*_,t[2]=(a*i-s*o)*_,t[3]=f*_,t[4]=(h*r-s*l)*_,t[5]=(-a*r+s*n)*_,t[6]=m*_,t[7]=(-c*r+i*l)*_,t[8]=(o*r-i*n)*_,t}function rv(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],m=e[11],y=e[12],_=e[13],v=e[14],b=e[15],T=r*a-i*o,x=r*l-s*o,S=r*c-n*o,E=i*l-s*a,A=i*c-n*a,R=s*c-n*l,M=h*_-p*y,D=h*v-f*y,k=h*b-m*y,$=p*v-f*_,N=p*b-m*_,H=f*b-m*v;let Z=T*H-x*N+S*$+E*k-A*D+R*M;return Z?(Z=1/Z,t[0]=(a*H-l*N+c*$)*Z,t[1]=(l*k-o*H-c*D)*Z,t[2]=(o*N-a*k+c*M)*Z,t[3]=(s*N-i*H-n*$)*Z,t[4]=(r*H-s*k+n*D)*Z,t[5]=(i*k-r*N-n*M)*Z,t[6]=(_*R-v*A+b*E)*Z,t[7]=(v*S-y*R-b*x)*Z,t[8]=(y*A-_*S+b*T)*Z,t):null}function lje(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function cje(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function uje(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2)}function hje(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t}function mbe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}function dje(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t}function pje(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t}function fje(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function mje(t,e){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=e[0],f=e[1],m=e[2],y=e[3],_=e[4],v=e[5],b=e[6],T=e[7],x=e[8],S=sl();return Math.abs(r-p)<=S*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(i-f)<=S*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(s-m)<=S*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(n-y)<=S*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(o-_)<=S*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(a-v)<=S*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(l-b)<=S*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(c-T)<=S*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(h-x)<=S*Math.max(1,Math.abs(h),Math.abs(x))}function IY(t){const e=sl(),r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8];return Math.abs(1-(r*r+n*n+l*l))<=e&&Math.abs(1-(i*i+o*o+c*c))<=e&&Math.abs(1-(s*s+a*a+h*h))<=e}const gje=nE,yje=mbe;Object.freeze(Object.defineProperty({__proto__:null,add:hje,adjoint:tje,copy:eje,determinant:rje,equals:mje,exactEquals:fje,frob:uje,fromMat2d:aje,fromMat4:Vh,fromQuat:F6,fromRotation:nje,fromScaling:oje,fromTranslation:sje,identity:RY,invert:dx,isOrthoNormal:IY,mul:gje,multiply:nE,multiplyScalar:dje,multiplyScalarAndAdd:pje,normalFromMat4:rv,normalFromMat4Legacy:fbe,projection:lje,rotate:MY,scale:PY,scaleByVec2:ije,set:OY,str:cje,sub:yje,subtract:mbe,translate:B4,transpose:Bh},Symbol.toStringTag,{value:"Module"}));function Ui(){return[1,0,0,0,1,0,0,0,1]}function gbe(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]}function _je(t,e,r,i,s,n,o,a,l){return[t,e,r,i,s,n,o,a,l]}function ybe(t,e){return new Float64Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:gbe,create:Ui,createView:ybe,fromValues:_je},Symbol.toStringTag,{value:"Module"}));function be(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function oE(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}function $Y(t,e,r,i,s,n,o,a,l,c,h,p,f,m,y,_){return[t,e,r,i,s,n,o,a,l,c,h,p,f,m,y,_]}function _be(t,e){return new Float64Array(t,e,16)}const un=be();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:un,clone:oE,create:be,createView:_be,fromValues:$Y},Symbol.toStringTag,{value:"Module"}));function Xh(){return[0,0,0,1]}function vje(t){return[t[0],t[1],t[2],t[3]]}function bje(t,e,r,i){return[t,e,r,i]}function vbe(t,e){return new Float64Array(t,e,4)}const wje=Xh();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:wje,clone:vje,create:Xh,createView:vbe,fromValues:bje},Symbol.toStringTag,{value:"Module"}));function xje(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function G4(t,e,r){r*=.5;const i=Math.sin(r);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(r),t}function LY(t,e){const r=2*Math.acos(e[3]),i=Math.sin(r/2);return i>sl()?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=1,t[1]=0,t[2]=0),r}function U6(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=r[0],l=r[1],c=r[2],h=r[3];return t[0]=i*h+o*a+s*c-n*l,t[1]=s*h+o*l+n*a-i*c,t[2]=n*h+o*c+i*l-s*a,t[3]=o*h-i*a-s*l-n*c,t}function Tje(t,e,r){r*=.5;const i=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+o*a,t[1]=s*l+n*a,t[2]=n*l-s*a,t[3]=o*l-i*a,t}function Sje(t,e,r){r*=.5;const i=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l-n*a,t[1]=s*l+o*a,t[2]=n*l+i*a,t[3]=o*l-s*a,t}function Eje(t,e,r){r*=.5;const i=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+s*a,t[1]=s*l-i*a,t[2]=n*l+o*a,t[3]=o*l-n*a,t}function Cje(t,e){const r=e[0],i=e[1],s=e[2];return t[0]=r,t[1]=i,t[2]=s,t[3]=Math.sqrt(Math.abs(1-r*r-i*i-s*s)),t}function VD(t,e,r,i){const s=e[0],n=e[1],o=e[2],a=e[3];let l,c,h,p,f,m=r[0],y=r[1],_=r[2],v=r[3];return c=s*m+n*y+o*_+a*v,c<0&&(c=-c,m=-m,y=-y,_=-_,v=-v),1-c>sl()?(l=Math.acos(c),h=Math.sin(l),p=Math.sin((1-i)*l)/h,f=Math.sin(i*l)/h):(p=1-i,f=i),t[0]=p*s+f*m,t[1]=p*n+f*y,t[2]=p*o+f*_,t[3]=p*a+f*v,t}function Aje(t){const e=EM,r=e(),i=e(),s=e(),n=Math.sqrt(1-r),o=Math.sqrt(r);return t[0]=n*Math.sin(2*Math.PI*i),t[1]=n*Math.cos(2*Math.PI*i),t[2]=o*Math.sin(2*Math.PI*s),t[3]=o*Math.cos(2*Math.PI*s),t}function Oje(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=r*r+i*i+s*s+n*n,a=o?1/o:0;return t[0]=-r*a,t[1]=-i*a,t[2]=-s*a,t[3]=n*a,t}function um(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function bbe(t,e){const r=e[0]+e[4]+e[8];let i;if(r>0)i=Math.sqrt(r+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[3*s+s]&&(s=2);const n=(s+1)%3,o=(s+2)%3;i=Math.sqrt(e[3*s+s]-e[3*n+n]-e[3*o+o]+1),t[s]=.5*i,i=.5/i,t[3]=(e[3*n+o]-e[3*o+n])*i,t[n]=(e[3*n+s]+e[3*s+n])*i,t[o]=(e[3*o+s]+e[3*s+o])*i}return t}function Rje(t,e,r,i){const s=.5*Math.PI/180;e*=s,r*=s,i*=s;const n=Math.sin(e),o=Math.cos(e),a=Math.sin(r),l=Math.cos(r),c=Math.sin(i),h=Math.cos(i);return t[0]=n*l*h-o*a*c,t[1]=o*a*h+n*l*c,t[2]=o*l*c-n*a*h,t[3]=o*l*h+n*a*c,t}function Mje(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}const HM=Oh,Pje=xi,Ije=JX,$je=U6,Lje=Tw,Dje=xge,Nje=Z5,wbe=QX,Fje=wbe,xbe=KX,Uje=xbe,DY=wge,kje=a2,zje=y4;function Vje(t,e,r){const i=fe(e,r);return i<-.999999?(ht(Fp,Bje,e),lc(Fp)<1e-6&&ht(Fp,Gje,e),ye(Fp,Fp),G4(t,Fp,Math.PI),t):i>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(ht(Fp,e,r),t[0]=Fp[0],t[1]=Fp[1],t[2]=Fp[2],t[3]=1+i,DY(t,t))}const Fp=O(),Bje=Me(1,0,0),Gje=Me(0,1,0);function jje(t,e,r,i,s,n){return VD(Rie,e,s,n),VD(Mie,r,i,n),VD(t,Rie,Mie,2*n*(1-n)),t}const Rie=Xh(),Mie=Xh();function Hje(t,e,r,i){const s=qje;return s[0]=r[0],s[3]=r[1],s[6]=r[2],s[1]=i[0],s[4]=i[1],s[7]=i[2],s[2]=-e[0],s[5]=-e[1],s[8]=-e[2],DY(t,bbe(t,s))}const qje=Ui();Object.freeze(Object.defineProperty({__proto__:null,add:Ije,calculateW:Cje,conjugate:um,copy:HM,dot:Dje,equals:zje,exactEquals:kje,fromEuler:Rje,fromMat3:bbe,getAxisAngle:LY,identity:xje,invert:Oje,len:Fje,length:wbe,lerp:Nje,mul:$je,multiply:U6,normalize:DY,random:Aje,rotateX:Tje,rotateY:Sje,rotateZ:Eje,rotationTo:Vje,scale:Lje,set:Pje,setAxes:Hje,setAxisAngle:G4,slerp:VD,sqlerp:jje,sqrLen:Uje,squaredLength:xbe,str:Mje},Symbol.toStringTag,{value:"Module"}));function Tbe(){const t=new Float32Array(4);return t[3]=1,t}function Sbe(t){const e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Wje(t,e,r,i){const s=new Float32Array(4);return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function Ebe(t,e){return new Float32Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:Sbe,create:Tbe,createView:Ebe,fromValues:Wje},Symbol.toStringTag,{value:"Module"}));const Xje=new je(Lme),Pie=new je(LX),Iie=new je(DX),MDt=new je(Dme);function hm(t){return t&&(vm(t)||Pn(t,Pie))?Pie:t&&(bm(t)||Pn(t,Iie))?Iie:Xje}const Rs=!0,zb={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};function NY(t,e,r){return{identifier:String.fromCharCode.apply(null,new Uint8Array(t,r+zb.identifierOffset,zb.identifierLength)),version:e.getUint16(r+zb.versionOffset,Rs),checksum:e.getUint32(r+zb.checksumOffset,Rs)}}const ec={sizeLo:0,sizeHi:4,minX:8,minY:16,minZ:24,maxX:32,maxY:40,maxZ:48,errorX:56,errorY:64,errorZ:72,count:80,reserved:84,byteCount:88};function Zje(t,e){return{sizeLo:t.getUint32(e+ec.sizeLo,Rs),sizeHi:t.getUint32(e+ec.sizeHi,Rs),minX:t.getFloat64(e+ec.minX,Rs),minY:t.getFloat64(e+ec.minY,Rs),minZ:t.getFloat64(e+ec.minZ,Rs),maxX:t.getFloat64(e+ec.maxX,Rs),maxY:t.getFloat64(e+ec.maxY,Rs),maxZ:t.getFloat64(e+ec.maxZ,Rs),errorX:t.getFloat64(e+ec.errorX,Rs),errorY:t.getFloat64(e+ec.errorY,Rs),errorZ:t.getFloat64(e+ec.errorZ,Rs),count:t.getUint32(e+ec.count,Rs),reserved:t.getUint32(e+ec.reserved,Rs)}}function PDt(t){const e=new DataView(t,0);let r=0;const{identifier:i,version:s}=NY(t,e,r);if(r+=zb.byteCount,i!=="LEPCC     ")throw new V("lepcc-decode-error","Bad identifier");if(s>1)throw new V("lepcc-decode-error","Unknown version");const n=Zje(e,r);if(r+=ec.byteCount,n.sizeHi*2**32+n.sizeLo!==t.byteLength)throw new V("lepcc-decode-error","Bad size");const o=new Float64Array(3*n.count),a=[],l=[],c=[],h=[];if(r=pI(t,r,a),r=pI(t,r,l),r=pI(t,r,c),r=pI(t,r,h),r!==t.byteLength)throw new V("lepcc-decode-error","Bad length");let p=0,f=0;for(let m=0;m<a.length;m++){f+=a[m];let y=0;for(let _=0;_<l[m];_++){y+=c[p];const v=h[p];o[3*p]=Math.min(n.maxX,n.minX+2*n.errorX*y),o[3*p+1]=Math.min(n.maxY,n.minY+2*n.errorY*f),o[3*p+2]=Math.min(n.maxZ,n.minZ+2*n.errorZ*v),p++}}return{errorX:n.errorX,errorY:n.errorY,errorZ:n.errorZ,result:o}}function pI(t,e,r){const i=[];e=Ej(t,e,i);const s=[];for(let n=0;n<i.length;n++){s.length=0,e=Ej(t,e,s);for(let o=0;o<s.length;o++)r.push(s[o]+i[n])}return e}function Ej(t,e,r){const i=new DataView(t,e),s=i.getUint8(0),n=31&s,o=!!(32&s),a=(192&s)>>6;let l=0;if(a===0)l=i.getUint32(1,Rs),e+=5;else if(a===1)l=i.getUint16(1,Rs),e+=3;else{if(a!==2)throw new V("lepcc-decode-error","Bad count type");l=i.getUint8(1),e+=2}if(o)throw new V("lepcc-decode-error","LUT not implemented");const c=Math.ceil(l*n/8),h=new Uint8Array(t,e,c);let p=0,f=0,m=0;const y=-1>>>32-n;for(let _=0;_<l;_++){for(;f<n;)p|=h[m]<<f,f+=8,m+=1;r[_]=p&y,p>>>=n,f-=n,f+n>32&&(p|=h[m-1]>>8-f)}return e+m}const Z1={sizeLo:0,sizeHi:4,count:8,colorMapCount:12,lookupMethod:14,compressionMethod:15,byteCount:16};function Yje(t,e){return{sizeLo:t.getUint32(e+Z1.sizeLo,Rs),sizeHi:t.getUint32(e+Z1.sizeHi,Rs),count:t.getUint32(e+Z1.count,Rs),colorMapCount:t.getUint16(e+Z1.colorMapCount,Rs),lookupMethod:t.getUint8(e+Z1.lookupMethod),compressionMethod:t.getUint8(e+Z1.compressionMethod)}}function Jje(t){const e=new DataView(t,0);let r=0;const{identifier:i,version:s}=NY(t,e,r);if(r+=zb.byteCount,i!=="ClusterRGB")throw new V("lepcc-decode-error","Bad identifier");if(s>1)throw new V("lepcc-decode-error","Unknown version");const n=Yje(e,r);if(r+=Z1.byteCount,n.sizeHi*2**32+n.sizeLo!==t.byteLength)throw new V("lepcc-decode-error","Bad size");if((n.lookupMethod===2||n.lookupMethod===1)&&n.compressionMethod===0){if(3*n.colorMapCount+n.count+r!==t.byteLength||n.colorMapCount>256)throw new V("lepcc-decode-error","Bad count");const o=new Uint8Array(t,r,3*n.colorMapCount),a=new Uint8Array(t,r+3*n.colorMapCount,n.count),l=new Uint8Array(3*n.count);for(let c=0;c<n.count;c++){const h=a[c];l[3*c]=o[3*h],l[3*c+1]=o[3*h+1],l[3*c+2]=o[3*h+2]}return l}if(n.lookupMethod===0&&n.compressionMethod===0){if(3*n.count+r!==t.byteLength||n.colorMapCount!==0)throw new V("lepcc-decode-error","Bad count");return new Uint8Array(t,r).slice()}if(n.lookupMethod<=2&&n.compressionMethod===1){if(r+3!==t.byteLength||n.colorMapCount!==1)throw new V("lepcc-decode-error","Bad count");const o=e.getUint8(r),a=e.getUint8(r+1),l=e.getUint8(r+2),c=new Uint8Array(3*n.count);for(let h=0;h<n.count;h++)c[3*h]=o,c[3*h+1]=a,c[3*h+2]=l;return c}throw new V("lepcc-decode-error","Bad method "+n.lookupMethod+","+n.compressionMethod)}const Y1={sizeLo:0,sizeHi:4,count:8,scaleFactor:12,bitsPerPoint:14,reserved:15,byteCount:16};function Qje(t,e){return{sizeLo:t.getUint32(e+Y1.sizeLo,Rs),sizeHi:t.getUint32(e+Y1.sizeHi,Rs),count:t.getUint32(e+Y1.count,Rs),scaleFactor:t.getUint16(e+Y1.scaleFactor,Rs),bitsPerPoint:t.getUint8(e+Y1.bitsPerPoint),reserved:t.getUint8(e+Y1.reserved)}}function Kje(t){const e=new DataView(t,0);let r=0;const{identifier:i,version:s}=NY(t,e,r);if(r+=zb.byteCount,i!=="Intensity ")throw new V("lepcc-decode-error","Bad identifier");if(s>1)throw new V("lepcc-decode-error","Unknown version");const n=Qje(e,r);if(r+=Y1.byteCount,n.sizeHi*2**32+n.sizeLo!==t.byteLength)throw new V("lepcc-decode-error","Bad size");const o=new Uint16Array(n.count);if(n.bitsPerPoint===8){if(n.count+r!==t.byteLength)throw new V("lepcc-decode-error","Bad size");const a=new Uint8Array(t,r,n.count);for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}else if(n.bitsPerPoint===16){if(2*n.count+r!==t.byteLength)throw new V("lepcc-decode-error","Bad size");const a=new Uint16Array(t,r,n.count);for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}else{const a=[];if(Ej(t,r,a)!==t.byteLength)throw new V("lepcc-decode-error","Bad size");for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}return o}var C;(function(t){t.POSITION="position",t.NORMAL="normal",t.NORMALCOMPRESSED="normalCompressed",t.UV0="uv0",t.AUXPOS1="auxpos1",t.AUXPOS2="auxpos2",t.COLOR="color",t.SYMBOLCOLOR="symbolColor",t.SIZE="size",t.TANGENT="tangent",t.OFFSET="offset",t.SUBDIVISIONFACTOR="subdivisionFactor",t.COLORFEATUREATTRIBUTE="colorFeatureAttribute",t.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",t.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",t.DISTANCETOSTART="distanceToStart",t.UVMAPSPACE="uvMapSpace",t.BOUNDINGRECT="boundingRect",t.UVREGION="uvRegion",t.PROFILERIGHT="profileRight",t.PROFILEUP="profileUp",t.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",t.FEATUREVALUE="featureValue",t.MODELORIGINHI="modelOriginHi",t.MODELORIGINLO="modelOriginLo",t.MODEL="model",t.MODELNORMAL="modelNormal",t.INSTANCECOLOR="instanceColor",t.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",t.LOCALTRANSFORM="localTransform",t.GLOBALTRANSFORM="globalTransform",t.BOUNDINGSPHERE="boundingSphere",t.MODELORIGIN="modelOrigin",t.MODELSCALEFACTORS="modelScaleFactors",t.FEATUREATTRIBUTE="featureAttribute",t.STATE="state",t.LODLEVEL="lodLevel",t.POSITION0="position0",t.POSITION1="position1",t.NORMALA="normalA",t.NORMALB="normalB",t.COMPONENTINDEX="componentIndex",t.VARIANTOFFSET="variantOffset",t.VARIANTSTROKE="variantStroke",t.VARIANTEXTENSION="variantExtension",t.U8PADDING="u8padding",t.U16PADDING="u16padding",t.SIDENESS="sideness",t.START="start",t.END="end",t.UP="up",t.EXTRUDE="extrude",t.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",t.INSTANCEOBJECTANDLAYERIDCOLOR="instanceObjectAndLayerIdColor"})(C||(C={}));const Cj=Q.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");function eHe(t,e,r){let i="",s=0;for(;s<r;){const n=t[e+s];if(n<128)i+=String.fromCharCode(n),s++;else if(n>=192&&n<224){if(s+1>=r)throw new V("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");const o=(31&n)<<6|63&t[e+s+1];i+=String.fromCharCode(o),s+=2}else if(n>=224&&n<240){if(s+2>=r)throw new V("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const o=(15&n)<<12|(63&t[e+s+1])<<6|63&t[e+s+2];i+=String.fromCharCode(o),s+=3}else{if(!(n>=240&&n<248))throw new V("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");{if(s+3>=r)throw new V("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const o=(7&n)<<18|(63&t[e+s+1])<<12|(63&t[e+s+2])<<6|63&t[e+s+3];if(o>=65536){const a=55296+(o-65536>>10),l=56320+(1023&o);i+=String.fromCharCode(a,l)}else i+=String.fromCharCode(o);s+=4}}}return i}function Cbe(t,e){const r={byteOffset:0,byteCount:0,fields:Object.create(null)};let i=0;for(let s=0;s<e.length;s++){const n=e[s],o=n.valueType||n.type,a=cHe[o];r.fields[n.property]=a(t,i),i+=k6[o].BYTES_PER_ELEMENT}return r.byteCount=i,r}function tHe(t,e,r){return Abe(t,e,r).map(i=>{const s=i?Date.parse(i):null;return s&&!Number.isNaN(s)?s:null})}function Abe(t,e,r){const i=[];let s,n,o=0;for(n=0;n<t;n+=1){if(s=e[n],s>0){if(i.push(eHe(r,o,s-1)),r[o+s-1]!==0)throw new V("string-array-error","Invalid string array: missing null termination.")}else i.push(null);o+=s}return i}function $ie(t,e){return new k6[e.valueType](t,e.byteOffset,e.count*e.valuesPerElement)}function rHe(t,e){return new Uint8Array(t,e.byteOffset,e.byteCount)}function iHe(t,e,r){const i=e.header!=null?Cbe(t,e.header):{byteOffset:0,byteCount:0,fields:{count:r}},s={header:i,byteOffset:i.byteCount,byteCount:0,entries:Object.create(null)};let n=i.byteCount;for(let o=0;o<e.ordering.length;o++){const a=e.ordering[o],l=K(e[a]);if(l.count=i.fields.count??0,l.valueType==="String"){if(l.byteOffset=n,l.byteCount=i.fields[a+"ByteCount"],l.encoding!=="UTF-8")throw new V("unsupported-encoding","Unsupported String encoding.",{encoding:l.encoding});if(l.timeEncoding&&l.timeEncoding!=="ECMA_ISO8601")throw new V("unsupported-time-encoding","Unsupported time encoding.",{timeEncoding:l.timeEncoding})}else{if(!Rbe(l.valueType))throw new V("unsupported-value-type","Unsupported binary valueType",{valueType:l.valueType});{const c=BD(l.valueType);n+=n%c!=0?c-n%c:0,l.byteOffset=n,l.byteCount=c*l.valuesPerElement*l.count}}n+=l.byteCount??0,s.entries[a]=l}return s.byteCount=n-s.byteOffset,s}function Obe(t,e,r){if(e!==t&&Cj.error(`Invalid ${r} buffer size
 expected: ${t}, actual: ${e})`),e<t)throw new V("buffer-too-small","Binary buffer is too small",{expectedSize:t,actualSize:e})}function sHe(t){return{isDraco:!1,isLegacy:!1,color:t.color!=null,normal:t.normal!=null,uv0:t.uv0!=null,uvRegion:t.uvRegion!=null,featureIndex:t.faceRange!=null&&t.featureId!=null}}function IDt(t,e){const r=Cbe(t,e&&e.header);let i=r.byteCount;const s={isDraco:!1,header:r,byteOffset:r.byteCount,byteCount:0,vertexAttributes:{}},n=r.fields,o=n.vertexCount!=null?n.vertexCount:n.count;for(const c of e.ordering){if(!e.vertexAttributes[c])continue;const h={...e.vertexAttributes[c],byteOffset:i,count:o},p=aHe[c]||"_"+c;s.vertexAttributes[p]=h,i+=BD(h.valueType)*h.valuesPerElement*o}const a=n.faceCount;if(e.faces&&a){s.faces={};for(const c of e.ordering){if(!e.faces[c])continue;const h={...e.faces[c],byteOffset:i,count:a};s.faces[c]=h,i+=BD(h.valueType)*h.valuesPerElement*a}}const l=n.featureCount;if(e.featureAttributes&&e.featureAttributeOrder&&l){s.featureAttributes={};for(const c of e.featureAttributeOrder){if(!e.featureAttributes[c])continue;const h={...e.featureAttributes[c],byteOffset:i,count:l};s.featureAttributes[c]=h,i+=(h.valueType==="UInt64"?8:BD(h.valueType))*h.valuesPerElement*l}}return Obe(i,t.byteLength,"geometry"),s.byteCount=i-s.byteOffset,s}function $Dt(t,e){return!t||!t.compressedAttributes||t.compressedAttributes.encoding!=="draco"?t?sHe(t):nHe(e):oHe(t.compressedAttributes.attributes)}function nHe(t){const e={isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const r of t.ordering)if(t.vertexAttributes[r])switch(r){case"position":break;case"normal":e.normal=!0;break;case"color":e.color=!0;break;case"uv0":e.uv0=!0;break;case"region":e.uvRegion=!0}return t.featureAttributes&&t.featureAttributeOrder&&(e.featureIndex=!0),e}function oHe(t){const e={isDraco:!0,isLegacy:!1,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const r of t)switch(r){case"position":break;case"normal":e.normal=!0;break;case"uv0":e.uv0=!0;break;case"color":e.color=!0;break;case"uv-region":e.uvRegion=!0;break;case"feature-index":e.featureIndex=!0}return e}const aHe={position:C.POSITION,normal:C.NORMAL,color:C.COLOR,uv0:C.UV0,region:C.UVREGION};function lHe(t,e,r){if(t.encoding==="lepcc-rgb")return Jje(e);if(t.encoding==="lepcc-intensity")return Kje(e);if(t.encoding!=null&&t.encoding!=="")throw new V("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");t["attributeByteCounts "]&&!t.attributeByteCounts&&(Cj.warn("Warning: Trailing space in 'attributeByteCounts '."),t.attributeByteCounts=t["attributeByteCounts "]),t.ordering[0]==="ObjectIds"&&t.hasOwnProperty("objectIds")&&(Cj.warn("Warning: Case error in objectIds"),t.ordering[0]="objectIds");const i=iHe(e,t,r);Obe(i.byteOffset+i.byteCount,e.byteLength,"attribute");const s=i.entries.attributeValues||i.entries.objectIds;if(s){if(s.valueType==="String"){const n=i.entries.attributeByteCounts,o=$ie(e,n),a=rHe(e,s);return s.timeEncoding?tHe(n.count,o,a):Abe(n.count,o,a)}return $ie(e,s)}throw new V("bad-attribute-storage-info","Bad attributeStorageInfo specification.")}const k6={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},cHe={Float32:(t,e)=>new DataView(t,0).getFloat32(e,!0),Float64:(t,e)=>new DataView(t,0).getFloat64(e,!0),UInt8:(t,e)=>new DataView(t,0).getUint8(e),Int8:(t,e)=>new DataView(t,0).getInt8(e),UInt16:(t,e)=>new DataView(t,0).getUint16(e,!0),Int16:(t,e)=>new DataView(t,0).getInt16(e,!0),UInt32:(t,e)=>new DataView(t,0).getUint32(e,!0),Int32:(t,e)=>new DataView(t,0).getInt32(e,!0)};function Rbe(t){return k6.hasOwnProperty(t)}function BD(t){return Rbe(t)?k6[t].BYTES_PER_ELEMENT:0}function uHe(t,e,r,i){const s=hHe(t,e,r),n=be();return Pl(r,s,n,i),n}const Mbe=1,Lie=5-Mbe;function hHe(t,e,r){const i=O(),s=t[3],n=2**(Math.ceil(Math.log(s)*Math.LOG2E/Lie)*Lie+Mbe);if(r.isGeographic){const l=n/zr(r).radius*180/Math.PI,c=Math.round(t[1]/l),h=Math.max(-90,Math.min(90,c*l)),p=l/Math.cos((Math.abs(h)-l/2)/180*Math.PI),f=Math.round(t[0]/p)*p;i[0]=f,i[1]=h}else{const l=Math.round(t[0]/n),c=Math.round(t[1]/n);i[0]=l*n,i[1]=c*n}const o=t[2]+e,a=Math.round(o/n);return i[2]=a*n,i}function dHe(t){return t.type==="fill"}function pHe(t){return t.type==="extrude"}var Ht;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.TRANSPARENT=1]="TRANSPARENT",t[t.OPAQUE=2]="OPAQUE"})(Ht||(Ht={}));function fHe(t){return t&&t.enabled&&(pHe(t)||dHe(t))&&t.edges!=null}function mHe(t){return t&&t.enabled&&t.edges||null}function Pbe(t,e){return Ibe(mHe(t),e)}function Ibe(t,e){if(t==null)return null;const r=t.color!=null?XZ(Ne.toUnitRGBA(t.color)):Nt(0,0,0,0),i=_o(t.size),s=_o(t.extensionLength);switch(t.type){case"solid":return $be({color:r,size:i,extensionLength:s,...e});case"sketch":return gHe({color:r,size:i,extensionLength:s,...e});default:return}}function $be(t){return{...yHe,...t,type:"solid"}}function gHe(t){return{..._He,...t,type:"sketch"}}const yHe={color:Nt(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:Ht.OPAQUE,hasSlicePlane:!1},_He={color:Nt(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:Ht.OPAQUE,hasSlicePlane:!1};var Bs;function Lbe(t){switch(t){case"multiply":default:return Bs.Multiply;case"ignore":return Bs.Ignore;case"replace":return Bs.Replace;case"tint":return Bs.Tint}}function Dbe(t,e,r){if(t==null||e===Bs.Ignore)return r[0]=255,r[1]=255,r[2]=255,void(r[3]=255);const i=ve(Math.round(t[3]*j4),0,j4),s=i===0||e===Bs.Tint?0:e===Bs.Replace?vHe:bHe;r[0]=ve(Math.round(t[0]*Ox),0,Ox),r[1]=ve(Math.round(t[1]*Ox),0,Ox),r[2]=ve(Math.round(t[2]*Ox),0,Ox),r[3]=i+s}(function(t){t[t.Multiply=1]="Multiply",t[t.Ignore=2]="Ignore",t[t.Replace=3]="Replace",t[t.Tint=4]="Tint"})(Bs||(Bs={}));const Ox=255,j4=85,vHe=j4,bHe=2*j4;function os(){return new Float32Array(3)}function H4(t){const e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Jr(t,e,r){const i=new Float32Array(3);return i[0]=t,i[1]=e,i[2]=r,i}function Nbe(t,e){return new Float32Array(t,e,3)}function FY(){return os()}function Fbe(){return Jr(1,1,1)}function Ube(){return Jr(1,0,0)}function kbe(){return Jr(0,1,0)}function zbe(){return Jr(0,0,1)}const wHe=FY(),xHe=Fbe(),THe=Ube(),SHe=kbe(),EHe=zbe();Object.freeze(Object.defineProperty({__proto__:null,ONES:xHe,UNIT_X:THe,UNIT_Y:SHe,UNIT_Z:EHe,ZEROS:wHe,clone:H4,create:os,createView:Nbe,fromValues:Jr,ones:Fbe,unitX:Ube,unitY:kbe,unitZ:zbe,zeros:FY},Symbol.toStringTag,{value:"Module"}));var Tc;(function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"})(Tc||(Tc={}));let Sy=class{constructor(e){this._allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&F2(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*Die);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,Die));e++)this._items.push(this._allocator())}};const Die=1024;var q4;(function(t){t[t.KILOBYTES=1024]="KILOBYTES",t[t.MEGABYTES=1048576]="MEGABYTES",t[t.GIGABYTES=1073741824]="GIGABYTES"})(q4||(q4={}));function Ge(){return[0,0]}function C3(t){return[t[0],t[1]]}function fr(t,e){return[t,e]}function Vbe(t){const e=Ge(),r=Math.min(2,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function Bbe(t,e){return new Float64Array(t,e,2)}function Gbe(){return Ge()}function jbe(){return fr(1,1)}function Hbe(){return fr(1,0)}function qbe(){return fr(0,1)}const Tp=Gbe(),CHe=jbe(),Wbe=Hbe(),AHe=qbe();Object.freeze(Object.defineProperty({__proto__:null,ONES:CHe,UNIT_X:Wbe,UNIT_Y:AHe,ZEROS:Tp,clone:C3,create:Ge,createView:Bbe,fromArray:Vbe,fromValues:fr,ones:jbe,unitX:Hbe,unitY:qbe,zeros:Gbe},Symbol.toStringTag,{value:"Module"}));let oC=class J1{constructor(e,r,i){this._itemByteSize=e,this._itemCreate=r,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(i/this._itemByteSize)}get(){this._itemsPtr===0&&F2(()=>this._reset());const e=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=e;){const r=new ArrayBuffer(this._itemsPerBuffer*this._itemByteSize);for(let i=0;i<this._itemsPerBuffer;++i)this._items.push(this._itemCreate(r,i*this._itemByteSize));this._buffers.push(r)}return this._items[this._itemsPtr++]}_reset(){const e=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>e;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(e=Rx){return new J1(16,Bbe,e)}static createVec3f64(e=Rx){return new J1(24,qX,e)}static createVec4f64(e=Rx){return new J1(32,P_e,e)}static createMat3f64(e=Rx){return new J1(72,ybe,e)}static createMat4f64(e=Rx){return new J1(128,_be,e)}static createQuatf64(e=Rx){return new J1(32,vbe,e)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this._itemByteSize}}};const Rx=4*q4.KILOBYTES,DDt=oC.createVec2f64(),ze=oC.createVec3f64(),UY=oC.createVec4f64();oC.createMat3f64();const kY=oC.createMat4f64(),NDt=oC.createQuatf64();function Jn(t){return t?Nie(Fs(t.origin),Fs(t.direction)):Nie(O(),O())}function Nie(t,e){return{origin:t,direction:e}}function FDt(t,e){return ry(t.origin,e.origin)&&ry(t.direction,e.direction)}function Ou(t,e){const r=PHe.get();return r.origin=t,r.direction=e,r}function W4(t,e=Jn()){return Xbe(t.origin,t.direction,e)}function OHe(t,e,r=Jn()){return re(r.origin,t),de(r.direction,e,t),r}function Xbe(t,e,r=Jn()){return re(r.origin,t),re(r.direction,e),r}function RHe(t,e){const r=ht(ze.get(),ye(ze.get(),t.direction),de(ze.get(),e,t.origin));return fe(r,r)}function MHe(t,e,r){const i=fe(t.direction,de(r,e,t.origin));return ue(r,t.origin,ie(r,t.direction,i)),r}const PHe=new Sy(()=>Jn());function LO(t,e){return fe(t,e)/Oe(t)}function z6(t,e){const r=fe(t,e)/(Oe(t)*Oe(e));return-In(r)}function Zbe(t,e,r){ye(fI,t),ye(c9,e);const i=fe(fI,c9),s=In(i),n=ht(fI,fI,c9);return fe(n,r)<0?2*Math.PI-s:s}const fI=O(),c9=O(),Ybe=bs();function bs(){return Xt()}function aE(t,e=bs()){return Oh(e,t)}function Jbe(t,e){return Nt(t[0],t[1],t[2],e)}function IHe(t){return t}function $He(t){t[0]=t[1]=t[2]=t[3]=0}function V6(t,e){return t[0]=t[1]=t[2]=0,t[3]=e,t}function qg(t){return t[3]}function LHe(t){return t}function Qbe(t,e,r,i){return Nt(t,e,r,i)}function DHe(t,e,r){return t!==r&&re(r,t),r[3]=t[3]+e,r}function NHe(t,e,r){return Q.getLogger("esri.geometry.support.sphere").error("sphere.setExtent is not yet supported"),t===r?r:aE(t,r)}function Sv(t,e,r){if(e==null)return!1;const{origin:i,direction:s}=e,n=FHe;n[0]=i[0]-t[0],n[1]=i[1]-t[1],n[2]=i[2]-t[2];const o=s[0]*s[0]+s[1]*s[1]+s[2]*s[2];if(o===0)return!1;const a=2*(s[0]*n[0]+s[1]*n[1]+s[2]*n[2]),l=a*a-4*o*(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]-t[3]*t[3]);if(l<0)return!1;const c=Math.sqrt(l);let h=(-a-c)/(2*o);const p=(-a+c)/(2*o);return(h<0||p<h&&p>0)&&(h=p),!(h<0)&&(r&&(r[0]=i[0]+s[0]*h,r[1]=i[1]+s[1]*h,r[2]=i[2]+s[2]*h),!0)}const FHe=O();function Aj(t,e){return Sv(t,e,null)}function UHe(t,e,r){if(Sv(t,e,r))return r;const i=aC(t,e,ze.get());return ue(r,e.origin,ie(ze.get(),e.direction,fi(e.origin,i)/Oe(e.direction))),r}function aC(t,e,r){const i=ze.get(),s=kY.get();ht(i,e.origin,e.direction);const n=qg(t);ht(r,i,e.origin),ie(r,r,1/Oe(r)*n);const o=twe(t,e.origin),a=z6(e.origin,r);return Au(s,a+o,i),Fe(r,r,s),r}function kHe(t,e,r){return Sv(t,e,r)?r:(MHe(e,t,r),Kbe(t,r,r))}function Kbe(t,e,r){const i=de(ze.get(),e,t),s=ie(ze.get(),i,t[3]/Oe(i));return ue(r,s,t)}function ewe(t,e){const r=de(ze.get(),e,t),i=la(r),s=t[3]*t[3];return Math.sqrt(Math.abs(i-s))}function twe(t,e){const r=de(ze.get(),e,t),i=Oe(r),s=qg(t),n=s+Math.abs(s-i);return In(s/n)}const u9=O();function rwe(t,e,r,i){const s=de(u9,e,t);switch(r){case Tc.X:{const n=ote(s,u9)[2];return se(i,-Math.sin(n),Math.cos(n),0)}case Tc.Y:{const n=ote(s,u9),o=n[1],a=n[2],l=Math.sin(o);return se(i,-l*Math.cos(a),-l*Math.sin(a),Math.cos(o))}case Tc.Z:return ye(i,s);default:return}}function iwe(t,e){const r=de(Oj,e,t);return Oe(r)-t[3]}function zHe(t,e,r,i){const s=iwe(t,e),n=rwe(t,e,Tc.Z,Oj),o=ie(Oj,n,r-s);return ue(i,e,o)}function VHe(t,e){const r=vo(t,e),i=qg(t);return r<=i*i}function BHe(t,e,r=bs()){const i=fi(t,e),s=t[3],n=e[3];return i+n<s?(Oh(r,t),r):i+s<n?(Oh(r,e),r):(Hr(r,t,e,(i+n-s)/(2*i)),r[3]=(i+s+n)/2,r)}const Oj=O(),B6=bs(),GHe=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:Ybe,altitudeAt:iwe,angleToSilhouette:twe,axisAt:rwe,clear:$He,closestPoint:kHe,closestPointOnSilhouette:aC,containsPoint:VHe,copy:aE,create:bs,distanceToSilhouette:ewe,elevate:DHe,fromCenterAndRadius:Jbe,fromRadius:V6,fromValues:Qbe,getCenter:LHe,getRadius:qg,intersectRay:Sv,intersectRayClosestSilhouette:UHe,intersectsRay:Aj,projectPoint:Kbe,setAltitudeAt:zHe,setExtent:NHe,tmpSphere:B6,union:BHe,wrap:IHe},Symbol.toStringTag,{value:"Module"}));function lE(t){const e=t[0]*t[0]+t[4]*t[4]+t[8]*t[8],r=t[1]*t[1]+t[5]*t[5]+t[9]*t[9],i=t[2]*t[2]+t[6]*t[6]+t[10]*t[10];return Math.sqrt(Math.max(e,r,i))}function jHe(t,e){const r=Math.sqrt(e[0]*e[0]+e[4]*e[4]+e[8]*e[8]),i=Math.sqrt(e[1]*e[1]+e[5]*e[5]+e[9]*e[9]),s=Math.sqrt(e[2]*e[2]+e[6]*e[6]+e[10]*e[10]);return se(t,r,i,s),t}function UDt(t,e,r){r=r||t;const i=fe(t,e);se(r,t[0]-i*e[0],t[1]-i*e[1],t[2]-i*e[2]),ye(r,r)}function kDt(t,e,r){Math.abs(t[0])>Math.abs(t[1])?se(e,0,1,0):se(e,1,0,0),ht(r,t,e),ye(e,e),ht(e,r,t),ye(r,r)}function mI(t,e,r,i,s,n){const o=t+(e-t)*s;return o+(r+(i-r)*s-o)*n}function HHe(t,e,r,i=O()){const s=Oe(t),n=Oe(e),o=fe(t,e)/(s*n);if(o<.9999999999999999){const a=Math.acos(o),l=((1-r)*s+r*n)/Math.sin(a),c=l/s*Math.sin((1-r)*a),h=l/n*Math.sin(r*a);return ie(Vb,t,c),ie(Bb,e,h),ue(i,Vb,Bb)}return Hr(i,t,e,r)}function zDt(t,e,r,i=O(),s=O()){const n=Oe(t),o=Oe(e),a=fe(t,e)/(n*o);if(a<.9999999999999999){const l=Math.acos(a),c=Math.sin(l),h=Math.sin(r*l),p=Math.sin((1-r)*l),f=(1-r)*n+r*o;{const m=f/c,y=m/o*h;ie(Vb,t,m/n*p),ie(Bb,e,y),ue(i,Vb,Bb)}{const m=1/n*(-Math.cos((1-r)*l)*l*f+p*(-n+o));ie(Vb,t,m);const y=1/o*(Math.cos(r*l)*l*f+h*(-n+o));ie(Bb,e,y),ue(s,Vb,Bb),ie(s,s,1/c)}return s}return Hr(i,t,e,r),de(s,e,t),ye(s,s),s}function GD(t,e,r){t=ye(Vb,t),e=ye(Bb,e);const i=In(fe(t,e));if(r){const s=ht(qHe,t,e);if(fe(s,r)<0)return-i}return i}function jD(t){const e=t.length;return r=>{if(r<=t[0][0])return t[0][1];if(r>=t[e-1][0])return t[e-1][1];let i=1;for(;r>t[i][0];)i++;const s=t[i-1][0],n=t[i][0],o=(n-r)/(n-s);return o*t[i-1][1]+(1-o)*t[i][1]}}function VDt(t,e,r,i){de(Fie,e,t),de(Uie,r,t),ht(i,Fie,Uie),ye(i,i),i[3]=-fe(t,i)}const Fie=O(),Uie=O(),qHe=O(),Vb=O(),Bb=O();function Nr(t=A3){return[t[0],t[1],t[2],t[3]]}function WHe(t=A3[0],e=A3[1],r=A3[2],i=A3[3]){return zY(t,e,r,i,UY.get())}function G6(t,e){return zY(e[0],e[1],e[2],e[3],t)}function zY(t,e,r,i,s=Nr()){return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function swe(t,e,r){return re(r,t),r[3]=e,r}function qM(t,e,r){const i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=Math.abs(i-1)>1e-5&&i>1e-12?1/Math.sqrt(i):1;return r[0]=e[0]*s,r[1]=e[1]*s,r[2]=e[2]*s,r[3]=-(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]),r}function oa(t,e,r,i=Nr()){const s=r[0]-e[0],n=r[1]-e[1],o=r[2]-e[2],a=t[0]-e[0],l=t[1]-e[1],c=t[2]-e[2],h=n*c-o*l,p=o*a-s*c,f=s*l-n*a,m=h*h+p*p+f*f,y=Math.abs(m-1)>1e-5&&m>1e-12?1/Math.sqrt(m):1;return i[0]=h*y,i[1]=p*y,i[2]=f*y,i[3]=-(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]),i}function nwe(t,e,r,i,s){const n=t.length/3;if(n<3)return!1;se(DC,t[3*r],t[3*r+1],t[3*r+2]);let o=i,a=!1;for(;o<n-1&&!a;){const l=3*o;se(Mx,t[l],t[l+1],t[l+2]),o++,a=!ha(DC,Mx)}if(!a)return!1;for(o=Math.max(o,s),a=!1;o<n&&!a;){const l=3*o;se(Sb,t[l],t[l+1],t[l+2]),o++,de(gI,DC,Mx),ye(gI,gI),de(yI,Mx,Sb),ye(yI,yI),a=!ha(DC,Sb)&&!ha(Mx,Sb)&&Math.abs(fe(gI,yI))<XHe}return a?(oa(DC,Mx,Sb,e),!0):(r!==0||i!==1||s!==2)&&nwe(t,e,0,1,2)}const XHe=.99619469809,DC=O(),Mx=O(),Sb=O(),gI=O(),yI=O();function Rj(t,e,r){return e!==t&&G6(t,e),t[3]=-fe(t,r),t}function Mj(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function LR(t,e,r,i){return ht(Sb,e,t),qM(r,Sb,i)}function BDt(t,e,r,i){return j6(t,e,de(ze.get(),r,e),eqe,i)}function px(t,e,r){return e!=null&&j6(t,e.origin,e.direction,tqe,r)}function ZHe(t,e,r){return j6(t,e.origin,e.vector,Zf.NONE,r)}function YHe(t,e,r){return j6(t,e.origin,e.vector,Zf.CLAMP,r)}function owe(t,e){return pi(t,e)>=0}function JHe(t,e){const r=fe(t,e.ray.direction),i=-pi(t,e.ray.origin);if(i<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return i>0;if((i<0||r<0)&&!(i<0&&r<0))return!0;const s=i/r;return r>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1}function QHe(t,e){const r=fe(t,e.ray.direction),i=-pi(t,e.ray.origin);if(r>-1e-6&&r<1e-6)return i>0;const s=i/r;return r>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1}function KHe(t,e,r){const i=ie(ze.get(),t,-t[3]),s=Pj(t,de(ze.get(),e,i),ze.get());return ue(r,s,i),r}function Pj(t,e,r){const i=ie(ze.get(),t,fe(t,e));return de(r,e,i),r}function pi(t,e){return fe(t,e)+t[3]}function j6(t,e,r,i,s){const n=fe(t,r);if(n===0)return!1;let o=-(fe(t,e)+t[3])/n;return i&Zf.CLAMP&&(o=ve(o,0,1)),!(!(i&Zf.INFINITE_MIN)&&o<0||!(i&Zf.INFINITE_MAX)&&o>1)&&(ue(s,e,ie(s,r,o)),!0)}function GDt(t){return t}const A3=[0,0,1,0];var Zf;(function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.INFINITE_MIN=4]="INFINITE_MIN",t[t.INFINITE_MAX=8]="INFINITE_MAX"})(Zf||(Zf={}));const eqe=Zf.INFINITE_MIN|Zf.INFINITE_MAX,tqe=Zf.INFINITE_MAX;var Ue;function kie(t){return t==="global"?Ue.Global:Ue.Local}function h9(t){return t===Ue.Global?"global":"local"}(function(t){t[t.Global=1]="Global",t[t.Local=2]="Local"})(Ue||(Ue={}));let He=class{constructor(e,r,i=!1,s=r){this.data=e,this.size=r,this.exclusive=i,this.stride=s}};const cE=1e-6,NC=[0,0,0],_I=[0,0,0];function rqe(t,e){const{data:r,size:i}=t,s=r.length/i;if(s<=0)return;const n=new hqe(t);HD(NC,n.minProj,n.maxProj),Eb(NC,NC,.5),vh(_I,n.maxProj,n.minProj);const o=Ij(_I),a=new dqe;a.quality=o,s<14&&(t=new He(new Float64Array(n.buffer,112,42),3));const l=[0,0,0],c=[0,0,0],h=[0,0,0],p=[0,0,0],f=[0,0,0],m=[0,0,0],y=[0,0,0];switch(iqe(n,t,y,l,c,h,p,f,m,a)){case 1:return void Gie(NC,_I,e);case 2:return void uqe(t,p,e)}sqe(t,y,l,c,h,p,f,m,a),awe(t,a.b0,a.b1,a.b2,y2,_2);const _=[0,0,0];vh(_,_2,y2),a.quality=Ij(_),a.quality<o?lwe(a.b0,a.b1,a.b2,y2,_2,_,e):Gie(NC,_I,e)}function iqe(t,e,r,i,s,n,o,a,l,c){return nqe(t,i,s),$j(i,s)<cE?1:(vh(o,i,s),Lo(o,o),oqe(e,i,o,n)<cE?2:(vh(a,s,n),Lo(a,a),vh(l,n,i),Lo(l,l),bh(r,a,o),Lo(r,r),Q1(e,r,o,a,l,c),0))}const FC=[0,0,0],UC=[0,0,0],Fu=[0,0,0],Uu=[0,0,0],ku=[0,0,0],Jy=[0,0,0],Qy=[0,0,0],Ky=[0,0,0];function sqe(t,e,r,i,s,n,o,a,l){aqe(t,e,r,FC,UC),FC[0]!==void 0&&(vh(Fu,FC,r),Lo(Fu,Fu),vh(Uu,FC,i),Lo(Uu,Uu),vh(ku,FC,s),Lo(ku,ku),bh(Jy,Uu,n),Lo(Jy,Jy),bh(Qy,ku,o),Lo(Qy,Qy),bh(Ky,Fu,a),Lo(Ky,Ky),Q1(t,Jy,n,Uu,Fu,l),Q1(t,Qy,o,ku,Uu,l),Q1(t,Ky,a,Fu,ku,l)),UC[0]!==void 0&&(vh(Fu,UC,r),Lo(Fu,Fu),vh(Uu,UC,i),Lo(Uu,Uu),vh(ku,UC,s),Lo(ku,ku),bh(Jy,Uu,n),Lo(Jy,Jy),bh(Qy,ku,o),Lo(Qy,Qy),bh(Ky,Fu,a),Lo(Ky,Ky),Q1(t,Jy,n,Uu,Fu,l),Q1(t,Qy,o,ku,Uu,l),Q1(t,Ky,a,Fu,ku,l))}function nqe(t,e,r){let i=$j(t.maxVert[0],t.minVert[0]),s=0;for(let n=1;n<7;++n){const o=$j(t.maxVert[n],t.minVert[n]);o>i&&(i=o,s=n)}Sc(e,t.minVert[s]),Sc(r,t.maxVert[s])}const zu=[0,0,0];function oqe(t,e,r,i){const{data:s,size:n}=t;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<s.length;l+=n){zu[0]=s[l]-e[0],zu[1]=s[l+1]-e[1],zu[2]=s[l+2]-e[2];const c=r[0]*zu[0]+r[1]*zu[1]+r[2]*zu[2],h=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],p=zu[0]*zu[0]+zu[1]*zu[1]+zu[2]*zu[2]-c*c/h;p>o&&(o=p,a=l)}return Sc(i,s,a),o}const Tn=[0,0];function aqe(t,e,r,i,s){cqe(t,e,Tn,s,i);const n=uwe(r,e);Tn[1]-cE<=n&&(i[0]=void 0),Tn[0]+cE>=n&&(s[0]=void 0)}const zie=[0,0,0],Vie=[0,0,0],Bie=[0,0,0],Px=[0,0,0],Ix=[0,0,0],vI=[0,0,0];function Q1(t,e,r,i,s,n){if(cwe(e)<cE)return;bh(zie,r,e),bh(Vie,i,e),bh(Bie,s,e),g2(t,e,Tn),Ix[1]=Tn[0],Px[1]=Tn[1],vI[1]=Px[1]-Ix[1];const o=[r,i,s],a=[zie,Vie,Bie];for(let l=0;l<3;++l){g2(t,o[l],Tn),Ix[0]=Tn[0],Px[0]=Tn[1],g2(t,a[l],Tn),Ix[2]=Tn[0],Px[2]=Tn[1],vI[0]=Px[0]-Ix[0],vI[2]=Px[2]-Ix[2];const c=Ij(vI);c<n.quality&&(Sc(n.b0,o[l]),Sc(n.b1,e),Sc(n.b2,a[l]),n.quality=c)}}const lqe=[0,0,0];function g2(t,e,r){const{data:i,size:s}=t;r[0]=Number.POSITIVE_INFINITY,r[1]=Number.NEGATIVE_INFINITY;for(let n=0;n<i.length;n+=s){const o=i[n]*e[0]+i[n+1]*e[1]+i[n+2]*e[2];r[0]=Math.min(r[0],o),r[1]=Math.max(r[1],o)}}function cqe(t,e,r,i,s){const{data:n,size:o}=t;Sc(i,n),Sc(s,i),r[0]=uwe(lqe,e),r[1]=r[0];for(let a=o;a<n.length;a+=o){const l=n[a]*e[0]+n[a+1]*e[1]+n[a+2]*e[2];l<r[0]&&(r[0]=l,Sc(i,n,a)),l>r[1]&&(r[1]=l,Sc(s,n,a))}}function Gie(t,e,r){Sc(r.center,t),Eb(r.halfSize,e,.5),r.quaternion[0]=0,r.quaternion[1]=0,r.quaternion[2]=0,r.quaternion[3]=1}const $m=[0,0,0],$x=[0,0,0],kC=[0,0,0],y2=[0,0,0],_2=[0,0,0],jie=[0,0,0];function uqe(t,e,r){Sc($m,e),Math.abs(e[0])>Math.abs(e[1])&&Math.abs(e[0])>Math.abs(e[2])?$m[0]=0:Math.abs(e[1])>Math.abs(e[2])?$m[1]=0:$m[2]=0,cwe($m)<cE&&($m[0]=$m[1]=$m[2]=1),bh($x,e,$m),Lo($x,$x),bh(kC,e,$x),Lo(kC,kC),awe(t,e,$x,kC,y2,_2),vh(jie,_2,y2),lwe(e,$x,kC,y2,_2,jie,r)}function awe(t,e,r,i,s,n){g2(t,e,Tn),s[0]=Tn[0],n[0]=Tn[1],g2(t,r,Tn),s[1]=Tn[0],n[1]=Tn[1],g2(t,i,Tn),s[2]=Tn[0],n[2]=Tn[1]}const bI=[0,0,0],Up=[1,0,0,0,1,0,0,0,1],Lx=[0,0,0];function lwe(t,e,r,i,s,n,o){Up[0]=t[0],Up[1]=t[1],Up[2]=t[2],Up[3]=e[0],Up[4]=e[1],Up[5]=e[2],Up[6]=r[0],Up[7]=r[1],Up[8]=r[2],pqe(o.quaternion,Up),HD(Lx,i,s),Eb(Lx,Lx,.5),Eb(o.center,t,Lx[0]),Eb(bI,e,Lx[1]),HD(o.center,o.center,bI),Eb(bI,r,Lx[2]),HD(o.center,o.center,bI),Eb(o.halfSize,n,.5)}const Uc=7;let hqe=class{constructor(e){this.minVert=new Array(Uc),this.maxVert=new Array(Uc);const r=64*Uc;this.buffer=new ArrayBuffer(r);let i=0;this.minProj=new Float64Array(this.buffer,i,Uc),i+=8*Uc,this.maxProj=new Float64Array(this.buffer,i,Uc),i+=8*Uc;for(let l=0;l<Uc;++l)this.minVert[l]=new Float64Array(this.buffer,i,3),i+=24;for(let l=0;l<Uc;++l)this.maxVert[l]=new Float64Array(this.buffer,i,3),i+=24;for(let l=0;l<Uc;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const s=new Array(Uc),n=new Array(Uc),{data:o,size:a}=e;for(let l=0;l<o.length;l+=a){let c=o[l];c<this.minProj[0]&&(this.minProj[0]=c,s[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,n[0]=l),c=o[l+1],c<this.minProj[1]&&(this.minProj[1]=c,s[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,n[1]=l),c=o[l+2],c<this.minProj[2]&&(this.minProj[2]=c,s[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,n[2]=l),c=o[l]+o[l+1]+o[l+2],c<this.minProj[3]&&(this.minProj[3]=c,s[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,n[3]=l),c=o[l]+o[l+1]-o[l+2],c<this.minProj[4]&&(this.minProj[4]=c,s[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,n[4]=l),c=o[l]-o[l+1]+o[l+2],c<this.minProj[5]&&(this.minProj[5]=c,s[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,n[5]=l),c=o[l]-o[l+1]-o[l+2],c<this.minProj[6]&&(this.minProj[6]=c,s[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,n[6]=l)}for(let l=0;l<Uc;++l){let c=s[l];Sc(this.minVert[l],o,c),c=n[l],Sc(this.maxVert[l],o,c)}}},dqe=class{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}};function Ij(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function HD(t,e,r){t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2]}function vh(t,e,r){t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2]}function Eb(t,e,r){t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r}function Sc(t,e,r=0){t[0]=e[r],t[1]=e[r+1],t[2]=e[r+2]}function bh(t,e,r){const i=e[0],s=e[1],n=e[2],o=r[0],a=r[1],l=r[2];t[0]=s*l-n*a,t[1]=n*o-i*l,t[2]=i*a-s*o}function Lo(t,e){const r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(r>0){const i=1/Math.sqrt(r);t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}}function cwe(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function $j(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2];return r*r+i*i+s*s}function uwe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function pqe(t,e){const r=e[0]+e[4]+e[8];if(r>0){let i=Math.sqrt(r+1);t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i}else{let i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);const s=(i+1)%3,n=(i+2)%3;let o=Math.sqrt(e[3*i+i]-e[3*s+s]-e[3*n+n]+1);t[i]=.5*o,o=.5/o,t[3]=(e[3*s+n]-e[3*n+s])*o,t[s]=(e[3*s+i]+e[3*i+s])*o,t[n]=(e[3*n+i]+e[3*i+n])*o}}const iw=Xh(),ja=O(),Lj=O(),fqe=Ui();let WDt=class{constructor(e){const o=e*56;this.buffer=new ArrayBuffer(o),this.obbs=new Array(e);for(let a=0;a<e;a++)this.obbs[a]={center:qX(this.buffer,56*a+0),halfSize:Nbe(this.buffer,56*a+24),quaternion:Ebe(this.buffer,56*a+36)}}};function VY(t=[0,0,0],e=[-1,-1,-1],r=Xh()){return{center:Fs(t),halfSize:H4(e),quaternion:Sbe(r)}}function Hie(t){return VY(t.center,t.halfSize,t.quaternion)}function ZDt(t,e){re(e.center,t.center),re(e.halfSize,t.halfSize),HM(e.quaternion,t.quaternion)}function hwe(t,e){return e=e||VY(),rqe(t,e),e}function K1(t,e){const r=pi(e,t.center),i=H6(t,e);return r>i?1:r<-i?-1:0}function YDt(t,e){return ja[0]=t.center[0]-e[0],ja[1]=t.center[1]-e[1],ja[2]=t.center[2]-e[2],um(iw,t.quaternion),Oc(ja,ja,iw),m4(ja,ja),YX(Lj,ja,t.halfSize),X5(Lj,ja)<e[3]*e[3]}function JDt(t,e){e||(e=pn());const r=F6(fqe,t.quaternion),i=t.halfSize[0]*Math.abs(r[0])+t.halfSize[1]*Math.abs(r[3])+t.halfSize[2]*Math.abs(r[6]),s=t.halfSize[0]*Math.abs(r[1])+t.halfSize[1]*Math.abs(r[4])+t.halfSize[2]*Math.abs(r[7]),n=t.halfSize[0]*Math.abs(r[2])+t.halfSize[1]*Math.abs(r[5])+t.halfSize[2]*Math.abs(r[8]);return e[0]=t.center[0]-i,e[1]=t.center[1]-s,e[2]=t.center[2]-n,e[3]=t.center[0]+i,e[4]=t.center[1]+s,e[5]=t.center[2]+n,e}function QDt(t,e){return pi(e,t.center)-H6(t,e)}function KDt(t,e){return pi(e,t.center)+H6(t,e)}function eNt(t,e){return K1(t,e[0])<=0&&K1(t,e[1])<=0&&K1(t,e[2])<=0&&K1(t,e[3])<=0&&K1(t,e[4])<=0&&K1(t,e[5])<=0}function tNt(t,e,r,i=0){um(iw,t.quaternion),de(ja,e,t.center);const s=Oc(ja,ja,iw),n=Oc(Lj,r,iw);let o=-1/0,a=1/0;for(let l=0;l<3;l++)if(Math.abs(n[l])>1e-6){const c=(i+t.halfSize[l]-s[l])/n[l],h=(-i-t.halfSize[l]-s[l])/n[l];o=Math.max(o,Math.min(c,h)),a=Math.min(a,Math.max(c,h))}else if(s[l]>t.halfSize[l]+i||s[l]<-t.halfSize[l]-i)return!1;return o<=a}(()=>{const t=new Int8Array(162);let e=0;const r=i=>{for(let s=0;s<i.length;s++)t[e+s]=i[s];e+=6};return r([6,2,3,1,5,4]),r([0,2,3,1,5,4]),r([0,2,3,7,5,4]),r([0,1,3,2,6,4]),r([0,1,3,2,0,0]),r([0,1,5,7,3,2]),r([0,1,3,7,6,4]),r([0,1,3,7,6,2]),r([0,1,5,7,6,2]),r([0,1,5,4,6,2]),r([0,1,5,4,0,0]),r([0,1,3,7,5,4]),r([0,2,6,4,0,0]),r([0,0,0,0,0,0]),r([1,3,7,5,0,0]),r([2,3,7,6,4,0]),r([2,3,7,6,0,0]),r([2,3,1,5,7,6]),r([0,1,5,7,6,2]),r([0,1,5,7,6,4]),r([0,1,3,7,6,4]),r([4,5,7,6,2,0]),r([4,5,7,6,0,0]),r([4,5,1,3,7,6]),r([0,2,3,7,5,4]),r([6,2,3,7,5,4]),r([6,2,3,1,5,4]),t})();function H6(t,e){um(iw,t.quaternion),Oc(ja,e,iw);const r=t.halfSize;return Math.abs(ja[0]*r[0])+Math.abs(ja[1]*r[1])+Math.abs(ja[2]*r[2])}function dwe(t,e){for(let r=0;r<8;++r){const i=e[r];i[0]=1&r?-t.halfSize[0]:t.halfSize[0],i[1]=2&r?-t.halfSize[1]:t.halfSize[1],i[2]=4&r?-t.halfSize[2]:t.halfSize[2],Oc(i,i,t.quaternion),ue(i,i,t.center)}}function mqe(t){return lc(t.halfSize)}function gqe(t,e,r,i,s){if(HM(s.quaternion,t.quaternion),i===Ue.Global){um(wI,t.quaternion),Oc(e0,t.center,wI),m4(Dx,e0),YX(Nx,Dx,t.halfSize),On(Nx,Dx,Nx);const n=Oe(Nx);ue(Nx,Dx,t.halfSize);const o=Oe(Nx);if(n<r)re(s.center,t.center),se(e0,r,r,r),ue(s.halfSize,t.halfSize,e0);else{const a=o>0?1+e/o:1,l=n>0?1+r/n:1,c=(l+a)/2,h=(l-a)/2;ie(s.halfSize,Dx,h),Fb(s.halfSize,s.halfSize,t.halfSize,c),ie(s.center,Dx,c),Fb(s.center,s.center,t.halfSize,h),mge(e0,e0),W5(s.center,s.center,e0),Oc(s.center,s.center,s.quaternion)}}else{const n=se(e0,0,0,1);Fb(s.center,t.center,n,(r+e)/2),um(wI,t.quaternion),Oc(n,n,wI),m4(n,n),Fb(s.halfSize,t.halfSize,n,(r-e)/2)}return s}const e0=O(),Dx=O(),Nx=O(),wI=Xh();function pwe(t){return t?parseInt(t.substring(t.lastIndexOf("/")+1,t.length),10):void 0}function rNt(t){if(oe("disable-feature:i3s-draco")||!t)return!1;for(const e of t)for(const r of e.geometryBuffers)if(r.compressedAttributes?.encoding==="draco")return!0;return!1}function iNt(t,e,r,i){r.traverse(e,s=>{const n=s.mbs;return(n!=null&&yqe(t,n))!==Gb.OUTSIDE&&(i(s),!0)})}function sNt(t,e,r){let i=0,s=0;for(let n=0;n<e.length&&i<t.length;n++)t[i]===e[n]&&(r(n)&&(t[s]=t[i],s++),i++);t.length=s}function nNt(t,e,r){let i=0,s=0;for(;i<r.length;)lfe(t,r[i])>=0===e&&(r[s]=r[i],s++),i++;r.length=s}const zC=Vt();function oNt(t,e){if(e.rotationScale[1]===0&&e.rotationScale[2]===0&&e.rotationScale[3]===0&&e.rotationScale[5]===0&&e.rotationScale[6]===0&&e.rotationScale[7]===0)return zC[0]=(t[0]-e.position[0])/e.rotationScale[0],zC[1]=(t[1]-e.position[1])/e.rotationScale[4],zC[2]=(t[2]-e.position[0])/e.rotationScale[0],zC[3]=(t[3]-e.position[1])/e.rotationScale[4],zC}var Gb;function yqe(t,e){const r=e[0],i=e[1],s=e[3],n=t[0]-r,o=r-t[2],a=t[1]-i,l=i-t[3],c=Math.max(n,o,0),h=Math.max(a,l,0),p=c*c+h*h;return p>s*s?Gb.OUTSIDE:p>0?Gb.INTERSECTS_CENTER_OUTSIDE:-Math.max(n,o,a,l)>s?Gb.INSIDE:Gb.INTERSECTS_CENTER_INSIDE}function _qe(t,e,r){const i=[],s=r&&r.missingFields,n=r&&r.originalFields;for(const o of t){const a=o.toLowerCase();let l=!1;for(const c of e)if(a===c.name.toLowerCase()){i.push(c.name),l=!0,n&&n.push(o);break}!l&&s&&s.push(o)}return i}async function aNt(t,e,r,i,s){if(e.length===0)return[];const n=t.attributeStorageInfo;if(t.associatedLayer!=null)try{return await bqe(t.associatedLayer,e,r,i)}catch(o){if(t.associatedLayer.loaded)throw o}if(n){const o=vqe(e,r,s);if(o==null)throw new V("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const a=t.parsedUrl.path;return(await Promise.all(o.map(l=>wqe(a,n,l.node,l.indices,i).then(c=>{for(let h=0;h<l.graphics.length;h++){const p=l.graphics[h],f=c[h];if(p.attributes)for(const m in p.attributes)m in f||(f[m]=p.attributes[m]);p.attributes=f}return l.graphics})))).flat()}throw new V("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available")}function vqe(t,e,r){const i=new Map,s=[],n=r();for(const o of t){const a=o.attributes[e];for(let l=0;l<n.length;l++){const c=n[l],h=c.featureIds.indexOf(a);if(h>=0){let p=i.get(c.node);p||(p={node:c.node,indices:[],graphics:[]},s.push(p),i.set(c.node,p)),p.indices.push(h),p.graphics.push(o);for(let f=l;f>0;f--)n[f]=n[f-1];n[0]=c;break}}}return s}async function bqe(t,e,r,i){e.sort((l,c)=>l.attributes[r]-c.attributes[r]);const s=e.map(l=>l.attributes[r]),n=[],o=_qe(i,t.fields,{originalFields:n}),a=await fwe(t,s,o);for(let l=0;l<e.length;l++){const c=e[l],h=a[l],p={};if(c.attributes)for(const f in c.attributes)p[f]=c.attributes[f];for(let f=0;f<n.length;f++)p[n[f]]=h[o[f]];c.attributes=p}return e}function fwe(t,e,r){const i=t.capabilities.query.maxRecordCount;if(i!=null&&e.length>i){const n=FIe(e,i);return Promise.all(n.map(o=>fwe(t,o,r))).then(o=>o.flat())}const s=new Ty({objectIds:e,outFields:r,orderByFields:[t.objectIdField]});return t.queryFeatures(s).then(n=>{if(n&&n.features&&n.features.length===e.length)return n.features.map(o=>o.attributes);throw new V("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer")})}function wqe(t,e,r,i,s){return mwe(t,e,r.resources.attributes,i,s)}function mwe(t,e,r,i,s){const n=[];for(const o of e)if(o&&s.includes(o.name)){const a=`${t}/nodes/${r}/attributes/${o.key}/0`;n.push({url:a,storageInfo:o})}return bc(n.map(o=>hr(o.url,{responseType:"array-buffer"}).then(a=>lHe(o.storageInfo,a.data)))).then(o=>{const a=[];for(const l of i){const c={};for(let h=0;h<o.length;h++){const p=o[h].value;p!=null&&(c[n[h].storageInfo.name]=Sqe(p,l))}a.push(c)}return a})}(function(t){t[t.OUTSIDE=0]="OUTSIDE",t[t.INTERSECTS_CENTER_OUTSIDE=1]="INTERSECTS_CENTER_OUTSIDE",t[t.INTERSECTS_CENTER_INSIDE=2]="INTERSECTS_CENTER_INSIDE",t[t.INSIDE=3]="INSIDE"})(Gb||(Gb={}));const xqe=-32768,Tqe=-(2**31);function Sqe(t,e){if(!t)return null;const r=t[e];return I5(t)?r===xqe?null:r:L5(t)?r===Tqe?null:r:r!=r?null:r}function Eqe(t){const e=t.store,r=e.indexCRS||e.geographicCRS,i=r===void 0?e.indexWKT:void 0;if(i){if(!t.spatialReference)throw new V("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference","Found indeWKT in the scene layer store but no layer spatial reference",{});if(i!==t.spatialReference.wkt)throw new V("layerview:store-spatial-reference-wkt-index-incompatible","The indeWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const s=r?new je(pwe(r)):t.spatialReference;return s.equals(t.spatialReference)?t.spatialReference:s}function Cqe(t){const e=t.store,r=e.vertexCRS||e.projectedCRS,i=r===void 0?e.vertexWKT:void 0;if(i){if(!t.spatialReference)throw new V("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference","Found vertexWKT in the scene layer store but no layer spatial reference",{});if(i!==t.spatialReference.wkt)throw new V("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const s=r?new je(pwe(r)):t.spatialReference;return s.equals(t.spatialReference)?t.spatialReference:s}function lNt(t,e){return e==null?"@null":e===hm(e)?"@ECEF":t.equals(e)?"":e.wkid!=null?"@"+e.wkid:null}function Dj(t,e,r){if(!lm(t,e))throw new V("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if(r==="local"&&!Aqe(t,e))throw new V("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{})}function cNt(t,e,r){if(t.serviceUpdateTimeStamp?.lastUpdate!==e.serviceUpdateTimeStamp?.lastUpdate||!r.isEmpty||vc(t.associatedLayer,i=>i.url)!==vc(e.associatedLayer,i=>i.url))throw new V("layerview:recycle-failed")}function Aqe(t,e){return t.equals(e)||t.isWGS84&&e.isWebMercator||t.isWebMercator&&e.isWGS84}function Oqe(t,e,r){const i=Eqe(t),s=Cqe(t);Dj(i,e,r),Dj(s,e,r)}function Rqe(t){return(t.geometryType==null||t.geometryType==="triangles")&&(t.topology==null||t.topology==="PerAttributeArray")&&t.vertexAttributes!=null&&t.vertexAttributes.position!=null}function uNt(t){if(t.store==null||t.store.defaultGeometrySchema==null||!Rqe(t.store.defaultGeometrySchema))throw new V("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:t.parsedUrl.path})}function hNt(t,e){Oqe(t,e.spatialReference,e.viewingMode)}function Mqe(t){return t.geometryType!=null&&t.geometryType==="points"&&(t.topology==null||t.topology==="PerAttributeArray")&&(t.encoding==null||t.encoding===""||t.encoding==="lepcc-xyz")&&t.vertexAttributes!=null&&t.vertexAttributes.position!=null}function dNt(t){if(t.store==null||t.store.defaultGeometrySchema==null||!Mqe(t.store.defaultGeometrySchema))throw new V("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{})}function pNt(t,e){Dj(t.spatialReference,e.spatialReference,e.viewingMode)}function Pqe(t){return t.type==="simple"||t.type==="class-breaks"||t.type==="unique-value"}function Iqe(t){return t.type==="mesh-3d"}function fNt(t){if(t==null||!Pqe(t)||(t.type==="unique-value"||t.type==="class-breaks")&&t.defaultSymbol==null)return!0;const e=t.getSymbols();if(e.length===0)return!0;for(const r of e){if(!Iqe(r)||r.symbolLayers.length===0)return!0;for(const i of r.symbolLayers.items)if(i.type!=="fill"||i.material==null||i.material.color==null||i.material.colorMixMode!=="replace")return!0}return!1}const mNt=$be({color:[0,0,0,0],opacity:0});class $qe{constructor(){this.edgeMaterial=null,this.material=null,this.castShadows=!0}}function gNt(t){const e=new $qe;let r=!1,i=!1;for(const s of t.symbolLayers.items)if(s.type==="fill"&&s.enabled){const n=s.material,o=s.edges;if(n!=null&&!r){const a=n.color,l=Lbe(n.colorMixMode);e.material=a!=null?{color:[a.r/255,a.g/255,a.b/255],alpha:a.a,colorMixMode:l}:{color:[1,1,1],alpha:1,colorMixMode:Bs.Multiply},e.castShadows=s.castShadows,r=!0}o==null||i||(e.edgeMaterial=Ibe(o,{}),i=!0)}return e.material||(e.material={color:[1,1,1],alpha:1,colorMixMode:Bs.Multiply}),e}function yNt(t,e){return(0|t)+(0|e)|0}function Lqe(t,e,r,i,s=0){i===hm(i)?e.isGeographic?zqe(t,r,e,s):kqe(t,r,e,s):e.isWGS84&&(i.isWebMercator||yR(i))?Dqe(e,t,i,r,s):e.isWebMercator&&yR(i)?Uqe(e,t,i,r,s):t===r?(r.center[2]+=s,li(r.center,e,0,r.center,i,0,1)):(se(r.center,t.center[0],t.center[1],t.center[2]+s),li(r.center,e,0,r.center,i,0,1),HM(r.quaternion,t.quaternion),re(r.halfSize,t.halfSize))}function Dqe(t,e,r,i,s){re(m_,e.center),m_[2]+=s;const n=hm(r);li(m_,t,0,m_,n,0,1),gwe(n,e,m_,r,i)}const qD=new Array(24),Nqe=new He(qD,3,!0),qie=O(),m_=O(),Fqe=Ui();function Uqe(t,e,r,i,s){re(m_,e.center),m_[2]+=s,gwe(t,e,m_,r,i)}function gwe(t,e,r,i,s){const n=F6(Fqe,e.quaternion);for(let o=0;o<8;++o){for(let a=0;a<3;++a)qie[a]=e.halfSize[a]*(o&1<<a?-1:1);for(let a=0;a<3;++a){let l=r[a];for(let c=0;c<3;++c)l+=qie[c]*n[3*c+a];qD[3*o+a]=l}}li(qD,t,0,qD,i,0,8),hwe(Nqe,s)}function kqe(t,e,r,i){dwe(t,Nj),se(e.center,t.center[0],t.center[1],t.center[2]+i),Pl(r,e.center,kc,hm(r)),se(e.center,kc[12],kc[13],kc[14]);const s=2*Math.sqrt(1+kc[0]+kc[5]+kc[10]);Cg[0]=(kc[6]-kc[9])/s,Cg[1]=(kc[8]-kc[2])/s,Cg[2]=(kc[1]-kc[4])/s,Cg[3]=.25*s,U6(e.quaternion,Cg,t.quaternion),um(Cg,e.quaternion);let n=0,o=0,a=0;for(const l of Nj)l[2]+=i,li(l,r,0,l,hm(r),0,1),On(Mr,l,e.center),Oc(Mr,Mr,Cg),n=Math.max(n,Math.abs(Mr[0])),o=Math.max(o,Math.abs(Mr[1])),a=Math.max(a,Math.abs(Mr[2]));se(e.halfSize,n,o,a)}function zqe(t,e,r,i){const s=zr(r),n=1+Math.max(0,i)/(s.radius+t.center[2]);se(e.center,t.center[0],t.center[1],t.center[2]+i),li(e.center,r,0,e.center,hm(r),0,1),HM(e.quaternion,t.quaternion),um(Cg,t.quaternion),se(Mr,0,0,1),Oc(Mr,Mr,Cg),se(Mr,t.halfSize[0]*Math.abs(Mr[0]),t.halfSize[1]*Math.abs(Mr[1]),t.halfSize[2]*Math.abs(Mr[2])),ie(Mr,Mr,s.inverseFlattening),ue(e.halfSize,t.halfSize,Mr),ie(e.halfSize,e.halfSize,n)}function _Nt(t,e,r,i,s,n){if(!n||n.length===0||e==null||!t.mbs)return null;const o=uHe(t.mbs,s,r,e);Mn(TI,o);let a=null;const l=()=>{if(!a)if(a=Nj,Ic(xI),t.serviceObb!=null){Lqe(t.serviceObb,r,Wie,e,s),dwe(Wie,a);for(const m of a)Fe(m,m,TI),c2(xI,m)}else{const m=t.mbs;if(!m)return;const y=m[3];Zs(m,r,Mr,e),Fe(Mr,Mr,TI),Mr[2]+=s;for(let _=0;_<8;++_){const v=1&_?y:-y,b=2&_?y:-y,T=4&_?y:-y,x=a[_];re(x,[Mr[0]+v,Mr[1]+b,Mr[2]+T]),c2(xI,x)}}};let c=1/0,h=-1/0;const p=m=>{if(m.type!=="replace")return;const y=m.geometry;if(!y?.hasZ)return;Ic(d9);const _=y.spatialReference||i,v=y.rings.reduce((b,T)=>T.reduce((x,S)=>(Zs(S,_,Mr,e),Fe(Mr,Mr,TI),c2(d9,Mr),Math.min(Mr[2],x)),b),1/0);l(),OM(xI,d9)&&(c=Math.min(c,v),h=Math.max(h,v))};if(n.forEach(m=>p(m)),c===1/0)return null;const f=(m,y,_)=>{Fe(Mr,_,o),m[y]=Mr[0],m[y+1]=Mr[1],m[y+2]=Mr[2],y+=24,_[2]=c,Fe(Mr,_,o),m[y]=Mr[0],m[y+1]=Mr[1],m[y+2]=Mr[2],y+=24,_[2]=h,Fe(Mr,_,o),m[y]=Mr[0],m[y+1]=Mr[1],m[y+2]=Mr[2]};for(let m=0;m<8;++m)f(Xie.data,3*m,a[m]);return hwe(Xie)}function vNt(t){return t!=null&&t.halfSize[0]>=0}function bNt(t){return t[3]>=0}function wNt(t){t!=null&&(t.halfSize[0]=-1)}function xNt(t){t!=null&&(t[3]=-1)}const kc=be(),Cg=Tbe(),Nj=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],d9=Vt(),xI=Vt(),Wie=VY(),Mr=O(),Xie={data:new Array(72),size:3,exclusive:!0,stride:3},TI=be();async function Vqe(t,e=t.popupTemplate){if(e==null)return[];const r=await e.getRequiredFields(t.fieldsIndex),{lastEditInfoEnabled:i}=e,{objectIdField:s,typeIdField:n,globalIdField:o,relationships:a}=t;if(r.includes("*"))return["*"];const l=i?await g5e(t):[],c=r6(t.fieldsIndex,[...r,...l]);return n&&c.push(n),c&&s&&t.fieldsIndex?.has(s)&&!c.includes(s)&&c.push(s),c&&o&&t.fieldsIndex?.has(o)&&!c.includes(o)&&c.push(o),a&&a.forEach(h=>{const{keyField:p}=h;c&&p&&t.fieldsIndex?.has(p)&&!c.includes(p)&&c.push(p)}),c}function ywe(t,e){return t.popupTemplate?t.popupTemplate:e!=null&&e.defaultPopupTemplateEnabled&&t.defaultPopupTemplate!=null?t.defaultPopupTemplate:null}function TNt(t,e){return ywe(t,{defaultPopupTemplateEnabled:e})!=null}const Bqe=["3DObject","Point"],Zie=tbe();let Lt=class extends Hve(k7e(vve(f1e(W1e(J1e(QZ(dve(ji(hZ))))))))){constructor(...e){super(...e),this.featureReduction=null,this.rangeInfos=null,this.operationalLayerType="ArcGISSceneServiceLayer",this.type="scene",this.fields=null,this.floorInfo=null,this.outFields=null,this.nodePages=null,this.materialDefinitions=null,this.textureSetDefinitions=null,this.geometryDefinitions=null,this.serviceUpdateTimeStamp=null,this.excludeObjectIds=new Pt,this.definitionExpression=null,this.filter=null,this.path=null,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.priority=null,this.semantic=null,this.cachedDrawingInfo={color:!1},this.popupEnabled=!0,this.popupTemplate=null,this.objectIdField=null,this.globalIdField=null,this._fieldUsageInfo={},this.screenSizePerspectiveEnabled=!0}normalizeCtorArgs(e,r){return typeof e=="string"?{url:e,...r}:e}destroy(){this._set("renderer",null)}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,r){const i=this.getFeatureType(r?.feature)?.domains?.[e];return i&&i.type!=="inherited"?i:this.getField(e)?.domain??null}getFeatureType(e){return e&&this.associatedLayer?this.associatedLayer.getFeatureType(e):null}get types(){return this.associatedLayer?.types??[]}get typeIdField(){return this.associatedLayer?.typeIdField??null}get templates(){return this.associatedLayer?.templates??null}get formTemplate(){return this.associatedLayer?.formTemplate??null}get fieldsIndex(){return new qZ(this.fields)}readNodePages(e,r,i){return r.layerType==="Point"&&(e=r.pointNodePages),e==null||typeof e!="object"?null:Tb.fromJSON(e,i)}set elevationInfo(e){this._set("elevationInfo",e),this.loaded&&this._validateElevationInfo()}get geometryType(){return Gqe[this.profile]||"mesh"}set renderer(e){w4(e,this.fieldsIndex),this._set("renderer",e)}readCachedDrawingInfo(e){return e!=null&&typeof e=="object"||(e={}),e.color==null&&(e.color=!1),e}get capabilities(){const e=this.associatedLayer?.capabilities??z7e,{query:r,editing:{supportsGlobalId:i,supportsRollbackOnFailure:s,supportsUploadWithItemId:n,supportsGeometryUpdate:o,supportsReturnServiceEditsInSourceSpatialReference:a},data:{supportsZ:l,supportsM:c,isVersioned:h,supportsAttachment:p},operations:{supportsEditing:f,supportsAdd:m,supportsUpdate:y,supportsDelete:_,supportsQuery:v,supportsQueryAttachments:b,supportsAsyncConvert3D:T}}=e,x=e.operations.supportsChangeTracking,S=!!this.associatedLayer?.infoFor3D&&pre();return{query:r,editing:{supportsGlobalId:i,supportsReturnServiceEditsInSourceSpatialReference:a,supportsRollbackOnFailure:s,supportsGeometryUpdate:S&&o,supportsUploadWithItemId:n},data:{supportsAttachment:p,supportsZ:l,supportsM:c,isVersioned:h},operations:{supportsQuery:v,supportsQueryAttachments:b,supportsEditing:f&&x,supportsAdd:S&&m&&x,supportsDelete:S&&_&&x,supportsUpdate:y&&x,supportsAsyncConvert3D:T}}}get editingEnabled(){return this._isOverridden("editingEnabled")?this._get("editingEnabled"):this.userHasEditingPrivileges}set editingEnabled(e){this._overrideIfSome("editingEnabled",e)}get infoFor3D(){return this.associatedLayer?.infoFor3D??null}get defaultPopupTemplate(){return this.associatedLayer||this.attributeStorageInfo?this.createPopupTemplate():null}readObjectIdField(e,r){return!e&&r.fields&&r.fields.some(i=>(i.type==="esriFieldTypeOID"&&(e=i.name),!!e)),e||void 0}readGlobalIdField(e,r){return!e&&r.fields&&r.fields.some(i=>(i.type==="esriFieldTypeGlobalID"&&(e=i.name),!!e)),e||void 0}get displayField(){return this.associatedLayer?.displayField??null}readProfile(e,r){const i=r.store.profile;return i!=null&&Yie[i]?Yie[i]:(Q.getLogger(this).error("Unknown or missing profile",{profile:i,layer:this}),"mesh-pyramids")}load(e){const r=e!=null?e.signal:null,i=this.loadFromPortal({supportedTypes:["Scene Service"]},e).catch(Fo).then(()=>this._fetchService(r)).then(()=>Promise.all([this._fetchIndexAndUpdateExtent(this.nodePages,r),this._setAssociatedFeatureLayer(r),this._loadFilterGeometries()])).then(()=>this._validateElevationInfo()).then(()=>this._applyAssociatedLayerOverrides()).then(()=>this._populateFieldUsageInfo()).then(()=>rbe(this,{origin:"service"},r)).then(()=>w4(this.renderer,this.fieldsIndex)).then(()=>this.finishLoadEditablePortalLayer(e));return this.addResolvingPromise(i),Promise.resolve(this)}async beforeSave(){this.filter!=null&&(this.filter=this.filter.clone(),await this.load())}async _loadFilterGeometries(){if(this.filter)try{await this.filter.loadGeometries(this.spatialReference)}catch(e){Q.getLogger(this).error("#_loadFilterGeometries()",this,"Failed to load filter geometries. Geometry filter will not be applied for this layer.",{error:e}),this.filter=null}}createQuery(){const e=new Ty;return this.geometryType!=="mesh"&&(e.returnGeometry=!0,e.returnZ=!0),e.where=this.definitionExpression||"1=1",e.sqlFormat="standard",e.outFields=["*"],e}queryExtent(e,r){return this._getAssociatedLayerForQuery().then(i=>i.queryExtent(e||this.createQuery(),r))}queryFeatureCount(e,r){return this._getAssociatedLayerForQuery().then(i=>i.queryFeatureCount(e||this.createQuery(),r))}queryFeatures(e,r){return this._getAssociatedLayerForQuery().then(i=>i.queryFeatures(e||this.createQuery(),r)).then(i=>{if(i?.features)for(const s of i.features)s.layer=this,s.sourceLayer=this;return i})}async queryCachedAttributes(e,r){const i=u5e(this.fieldsIndex,await Vqe(this,ywe(this)));return mwe(this.parsedUrl.path,this.attributeStorageInfo??[],e,r,i)}async queryCachedFeature(e,r){const i=await this.queryCachedAttributes(e,[r]);if(!i||i.length===0)throw new V("scenelayer:feature-not-in-cached-data","Feature not found in cached data");const s=new Nl;return s.attributes=i[0],s.layer=this,s.sourceLayer=this,s}queryObjectIds(e,r){return this._getAssociatedLayerForQuery().then(i=>i.queryObjectIds(e||this.createQuery(),r))}queryAttachments(e,r){return this._getAssociatedLayerForQuery().then(i=>i.queryAttachments(e,r))}getFieldUsageInfo(e){const r={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[e]||r:(Q.getLogger(this).error("#getFieldUsageInfo()","Unavailable until layer is loaded"),r)}createPopupTemplate(e){return ibe(this,e)}_getAssociatedLayerForQuery(){const e=this.associatedLayer;return e?.loaded?Promise.resolve(e):this._loadAssociatedLayerForQuery()}async _loadAssociatedLayerForQuery(){if(await this.load(),!this.associatedLayer)throw new V("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});try{await this.associatedLayer.load()}catch(e){throw new V("scenelayer:query-not-available","SceneLayer associated feature layer could not be loaded",{layer:this,error:e})}return this.associatedLayer}hasCachedStatistics(e){return this.statisticsInfo!=null&&this.statisticsInfo.some(r=>r.name===e)}async queryCachedStatistics(e,r){if(await this.load(r),!this.statisticsInfo)throw new V("scenelayer:no-cached-statistics","Cached statistics are not available for this layer");const i=this.fieldsIndex.get(e);if(!i)throw new V("scenelayer:field-unexisting",`Field '${e}' does not exist on the layer`);for(const s of this.statisticsInfo)if(s.name===i.name){const n=Pc(this.parsedUrl.path,s.href);return hr(n,{query:{f:"json",token:this.apiKey},responseType:"json",signal:r?r.signal:null}).then(o=>o.data)}throw new V("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available")}async saveAs(e,r){return this._debouncedSaveOperations(sE.SAVE_AS,{...r,getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"},e)}async save(){const e={getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"};return this._debouncedSaveOperations(sE.SAVE,e)}async applyEdits(e,r){const{applyEdits:i}=await ce(()=>import("./editingSupport-4dcb91cb.js"),["./editingSupport-4dcb91cb.js","./normalizeUtils-30f603dc.js","./normalizeUtilsCommon-d91de345.js"],import.meta.url);if(await this.load(),!this.associatedLayer)throw new V(`${this.type}-layer:not-editable`,"Service is not editable");return await this.associatedLayer.load(),i(this,this.associatedLayer.source,e,r)}async uploadAssets(e,r){if(await this.load(),this.associatedLayer==null)throw new V(`${this.type}-layer:not-editable`,"Service is not editable");return await this.associatedLayer.load(),this.associatedLayer.uploadAssets(e,r)}on(e,r){return super.on(e,r)}validateLayer(e){if(e.layerType&&!Bqe.includes(e.layerType))throw new V("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:e.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new V("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});if(this.version.major>2)throw new V("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});function r(i,s){let n=!1,o=!1;if(i==null)n=!0,o=!0;else{const a=s&&s.isGeographic;switch(i){case"east-north-up":case"earth-centered":n=!0,o=a;break;case"vertex-reference-frame":n=!0,o=!a;break;default:n=!1}}if(!n)throw new V("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!o)throw new V("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.")}r(this.normalReferenceFrame,this.spatialReference)}_getTypeKeywords(){const e=[];if(this.profile==="points")e.push("Point");else{if(this.profile!=="mesh-pyramids")throw new V("scenelayer:unknown-profile","SceneLayer:save() encountered an unknown SceneLayer profile: "+this.profile);e.push("3DObject")}return e}_populateFieldUsageInfo(){if(this._fieldUsageInfo={},this.fields)for(const e of this.fields){const r=!(!this.attributeStorageInfo||!this.attributeStorageInfo.some(n=>n.name===e.name)),i=!!this.associatedLayer?.fields?.some(n=>n&&e.name===n.name),s={supportsLabelingInfo:r,supportsRenderer:r,supportsPopupTemplate:r||i,supportsLayerQuery:i};this._fieldUsageInfo[e.name]=s}}_applyAssociatedLayerOverrides(){this._applyAssociatedLayerFieldsOverrides(),this._applyAssociatedLayerPopupOverrides(),this._applyAssociatedLayerExtentOverride()}_applyAssociatedLayerFieldsOverrides(){if(!this.associatedLayer?.fields)return;let e=null;for(const r of this.associatedLayer.fields){const i=this.getField(r.name);i?(!i.domain&&r.domain&&(i.domain=r.domain.clone()),i.editable=r.editable,i.nullable=r.nullable,i.length=r.length):(e||(e=this.fields?this.fields.slice():[]),e.push(r.clone()))}e&&this._set("fields",e)}_applyAssociatedLayerPopupOverrides(){if(!this.associatedLayer)return;const e=["popupTemplate","popupEnabled"],r=ma(this);for(let i=0;i<e.length;i++){const s=e[i],n=this.originIdOf(s),o=this.associatedLayer.originIdOf(s);n<o&&(o===mr.SERVICE||o===mr.PORTAL_ITEM)&&r.setAtOrigin(s,this.associatedLayer[s],o)}}_applyAssociatedLayerExtentOverride(){const e=this.associatedLayer?.editingInfo?.lastEditDate,r=this.associatedLayer?.serverGens,i=this.associatedLayer?.getAtOrigin("fullExtent","service");!pre()||this.associatedLayer?.infoFor3D==null||!i||!iY(this.associatedLayer?.url)||!e||this.serviceUpdateTimeStamp?.lastUpdate===e.getTime()||!this.serviceUpdateTimeStamp&&r?.minServerGen===r?.serverGen||ma(this).setAtOrigin("fullExtent",i.clone(),mr.SERVICE)}async _setAssociatedFeatureLayer(e){if(!["mesh-pyramids","points"].includes(this.profile))return;const r=new V7e(this.parsedUrl,this.portalItem,this.apiKey,e);try{this.associatedLayer=await r.fetch()}catch(i){us(i)||this._logWarningOnPopupEnabled()}}async _logWarningOnPopupEnabled(){await ay(()=>this.popupEnabled&&this.popupTemplate!=null);const e=`this SceneLayer: ${this.title}`;this.attributeStorageInfo==null?Q.getLogger(this).warn(`Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on ${e}`):Q.getLogger(this).info(`Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on ${e}`)}_validateElevationInfo(){const e=this.elevationInfo;e&&(this.profile==="mesh-pyramids"&&e.mode==="relative-to-scene"&&Q.getLogger(this).warn(".elevationInfo=","Mesh scene layers don't support relative-to-scene elevation mode"),e.featureExpressionInfo&&e.featureExpressionInfo.expression!=="0"&&Q.getLogger(this).warn(".elevationInfo=","Scene layers do not support featureExpressionInfo"))}};u([d({types:{key:"type",base:Hg,typeMap:{selection:rj}},json:{origins:{"web-scene":{name:"layerDefinition.featureReduction",write:!0},"portal-item":{name:"layerDefinition.featureReduction",write:!0}}}})],Lt.prototype,"featureReduction",void 0),u([d({type:[z0],json:{read:!1,origins:{"web-scene":{name:"layerDefinition.rangeInfos",write:!0},"portal-item":{name:"layerDefinition.rangeInfos",write:!0}}}})],Lt.prototype,"rangeInfos",void 0),u([d({json:{read:!1}})],Lt.prototype,"associatedLayer",void 0),u([d({type:["show","hide"]})],Lt.prototype,"listMode",void 0),u([d({type:["ArcGISSceneServiceLayer"]})],Lt.prototype,"operationalLayerType",void 0),u([d({json:{read:!1},readOnly:!0})],Lt.prototype,"type",void 0),u([d({...Zie.fields,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],Lt.prototype,"fields",void 0),u([d()],Lt.prototype,"types",null),u([d()],Lt.prototype,"typeIdField",null),u([d()],Lt.prototype,"templates",null),u([d()],Lt.prototype,"formTemplate",null),u([d({readOnly:!0})],Lt.prototype,"fieldsIndex",null),u([d({type:i1e,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],Lt.prototype,"floorInfo",void 0),u([d(Zie.outFields)],Lt.prototype,"outFields",void 0),u([d({type:Tb,readOnly:!0,json:{read:!1}})],Lt.prototype,"nodePages",void 0),u([Ae("service","nodePages",["nodePages","pointNodePages"])],Lt.prototype,"readNodePages",null),u([d({type:[th],readOnly:!0})],Lt.prototype,"materialDefinitions",void 0),u([d({type:[T3],readOnly:!0})],Lt.prototype,"textureSetDefinitions",void 0),u([d({type:[E3],readOnly:!0})],Lt.prototype,"geometryDefinitions",void 0),u([d({readOnly:!0})],Lt.prototype,"serviceUpdateTimeStamp",void 0),u([d({readOnly:!0})],Lt.prototype,"attributeStorageInfo",void 0),u([d({readOnly:!0})],Lt.prototype,"statisticsInfo",void 0),u([d({type:Pt.ofType(Number),nonNullable:!0,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.excludeObjectIds",write:{enabled:!0}}})],Lt.prototype,"excludeObjectIds",void 0),u([d({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],Lt.prototype,"definitionExpression",void 0),u([d({type:K7e,json:{name:"layerDefinition.polygonFilter",write:{enabled:!0,allowNull:!0},origins:{service:{read:!1,write:!1}}}})],Lt.prototype,"filter",void 0),u([d({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],Lt.prototype,"path",void 0),u([d(Jve)],Lt.prototype,"elevationInfo",null),u([d({type:String})],Lt.prototype,"geometryType",null),u([d(R6)],Lt.prototype,"labelsVisible",void 0),u([d({type:[sC],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:{reader:V4},write:!1}},name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:V4},write:!0}})],Lt.prototype,"labelingInfo",void 0),u([d(Yve)],Lt.prototype,"legendEnabled",void 0),u([d({type:Number,json:{origins:{"web-document":{default:1,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}},read:{source:["opacity","layerDefinition.drawingInfo.transparency"],reader(t,e){if(typeof t=="number"&&t>=0&&t<=1)return t;const r=e.layerDefinition?.drawingInfo?.transparency;return r!==void 0?G2(r):void 0}}},"portal-item":{write:!0},service:{read:!1}}}})],Lt.prototype,"opacity",void 0),u([d({type:["Low","High"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],Lt.prototype,"priority",void 0),u([d({type:["Labels"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],Lt.prototype,"semantic",void 0),u([d({types:H_e,json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],Lt.prototype,"renderer",null),u([d({json:{read:!1}})],Lt.prototype,"cachedDrawingInfo",void 0),u([Ae("service","cachedDrawingInfo")],Lt.prototype,"readCachedDrawingInfo",null),u([d({readOnly:!0,json:{read:!1}})],Lt.prototype,"capabilities",null),u([d({type:Boolean,json:{read:!1}})],Lt.prototype,"editingEnabled",null),u([d({readOnly:!0,json:{write:!1,read:!1}})],Lt.prototype,"infoFor3D",null),u([d(O6)],Lt.prototype,"popupEnabled",void 0),u([d({type:_v,json:{name:"popupInfo",write:!0}})],Lt.prototype,"popupTemplate",void 0),u([d({readOnly:!0,json:{read:!1}})],Lt.prototype,"defaultPopupTemplate",null),u([d({type:String,json:{read:!1}})],Lt.prototype,"objectIdField",void 0),u([Ae("service","objectIdField",["objectIdField","fields"])],Lt.prototype,"readObjectIdField",null),u([d({type:String,json:{read:!1}})],Lt.prototype,"globalIdField",void 0),u([Ae("service","globalIdField",["globalIdField","fields"])],Lt.prototype,"readGlobalIdField",null),u([d({readOnly:!0,type:String,json:{read:!1}})],Lt.prototype,"displayField",null),u([d({type:String,json:{read:!1}})],Lt.prototype,"profile",void 0),u([Ae("service","profile",["store.profile"])],Lt.prototype,"readProfile",null),u([d({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],Lt.prototype,"normalReferenceFrame",void 0),u([d(Xve)],Lt.prototype,"screenSizePerspectiveEnabled",void 0),Lt=u([P("esri.layers.SceneLayer")],Lt);const Yie={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},Gqe={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"},_we=Lt,ENt=Object.freeze(Object.defineProperty({__proto__:null,default:_we},Symbol.toStringTag,{value:"Module"}));let iv=class{constructor(e,r){this.min=e,this.max=r,this.range=r-e}ndiff(e,r=0){return Math.ceil((e-r)/this.range)*this.range+r}_normalize(e,r,i,s=0,n=!1){return(i-=s)<e?i+=this.ndiff(e-i):i>r&&(i-=this.ndiff(i-r)),n&&i===r&&(i=e),i+s}normalize(e,r=0,i=!1){return this._normalize(this.min,this.max,e,r,i)}clamp(e,r=0){return ve(e-r,this.min,this.max)+r}monotonic(e,r,i){return e<r?r:r+this.ndiff(e-r,i)}minimalMonotonic(e,r,i){return this._normalize(e,e+this.range,r,i)}center(e,r,i){return r=this.monotonic(e,r,i),this.normalize((e+r)/2,i)}diff(e,r,i){return this.monotonic(e,r,i)-e}shortestSignedDiff(e,r){e=this.normalize(e);const i=(r=this.normalize(r))-e,s=r<e?this.minimalMonotonic(e,r)-e:r-this.minimalMonotonic(r,e);return Math.abs(i)<Math.abs(s)?i:s}contains(e,r,i){return r=this.minimalMonotonic(e,r),(i=this.minimalMonotonic(e,i))>e&&i<r}};function BY(t){for(const e in t){const r=t[e];r instanceof Function&&(t[e]=r.bind(t))}return t}const jqe=BY(new iv(0,2*Math.PI)),sv=BY(new iv(-Math.PI,Math.PI)),GY=BY(new iv(0,360));let mg=class extends ji(le){constructor(...e){super(...e),this.position=new Ke([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(e,r,i,s){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const n={position:e};return r!=null&&(n.heading=r),i!=null&&(n.tilt=i),s!=null&&(n.fov=s),n}return e}writePosition(e,r,i,s){const n=e.clone();n.x=yh(e.x||0),n.y=yh(e.y||0),n.z=e.hasZ?yh(e.z||0):e.z,r[i]=n.write({},s)}readPosition(e,r){const i=new Ke;return i.read(e,r),i.x=yh(i.x||0),i.y=yh(i.y||0),i.z=i.hasZ?yh(i.z||0):i.z,i}equals(e){return e!=null&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}};u([d({type:Ke,json:{write:{isRequired:!0}}})],mg.prototype,"position",void 0),u([ke("position")],mg.prototype,"writePosition",null),u([Ae("position")],mg.prototype,"readPosition",null),u([d({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),wr(t=>GY.normalize(yh(t)))],mg.prototype,"heading",void 0),u([d({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),wr(t=>ve(yh(t),-180,180))],mg.prototype,"tilt",void 0),u([d({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],mg.prototype,"fov",void 0),mg=u([P("esri.Camera")],mg);const Gh=mg;var Fj;let V0=Fj=class extends le{constructor(t){super(t),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(t){return(t%=360)<0&&(t+=360),t}clone(){return new Fj({rotation:this.rotation,scale:this.scale,targetGeometry:this.targetGeometry!=null?this.targetGeometry.clone():null,camera:this.camera!=null?this.camera.clone():null})}};function p9(){return{enabled:!this.camera}}u([d({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:p9}}}}})],V0.prototype,"rotation",void 0),u([wr("rotation")],V0.prototype,"castRotation",null),u([d({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:p9}}}}})],V0.prototype,"scale",void 0),u([d({types:ix,json:{read:Z_,write:!0,origins:{"web-scene":{read:Z_,write:{overridePolicy:p9}}}}})],V0.prototype,"targetGeometry",void 0),u([d({type:Gh,json:{write:!0}})],V0.prototype,"camera",void 0),V0=Fj=u([P("esri.Viewpoint")],V0);const Sp=V0;function q6(t){return typeof t=="string"?document.getElementById(t):t??null}function vwe(t){for(;t.hasChildNodes();)t.removeChild(t.firstChild)}function Jie(t,e){const r=e.parentNode;r&&r.insertBefore(t,e)}function Qie(t,e){for(;;){const r=t.firstChild;if(!r)break;e.appendChild(r)}}let DO=class extends v6(Pt){constructor(e){super(e),this.handles.add([this.on("before-add",r=>{r.item==null&&r.preventDefault()}),this.on("after-add",r=>this._own(r.item)),this.on("after-remove",r=>this._release(r.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(Pt.ofType(this.itemType.Type))(e):new Pt(e)}};function Uj(t,e){return{type:t,cast:hme,set(r){const i=gw(r,this._get(e),t);i.owner=this,this._set(e,i)}}}u([d()],DO.prototype,"owner",null),DO=u([P("esri.core.support.OwningCollection")],DO);function Op(t){return t?{origin:Fs(t.origin),vector:Fs(t.vector)}:{origin:O(),vector:O()}}function Hqe(t,e){const r=Wqe.get();return r.origin=t,r.vector=e,r}function RNt(t,e=Op()){return qqe(t.origin,t.vector,e)}function qqe(t,e,r=Op()){return re(r.origin,t),re(r.vector,e),r}function sw(t,e,r=Op()){return re(r.origin,t),de(r.vector,e,t),r}function jY(t,e){const r=de(ze.get(),e,t.origin),i=fe(t.vector,r),s=fe(t.vector,t.vector),n=ve(i/s,0,1),o=de(ze.get(),ie(ze.get(),t.vector,n),r);return fe(o,o)}function MNt(t,e,r){return kj(t,e,0,1,r)}function PNt(t,e,r){return ue(r,t.origin,ie(r,t.vector,e))}function kj(t,e,r,i,s){const{vector:n,origin:o}=t,a=de(ze.get(),e,o),l=fe(n,a)/la(n);return ie(s,n,ve(l,r,i)),ue(s,s,t.origin)}function INt(t,e){if(wwe(t,Hqe(e.origin,e.direction),!1,X4)){const{tA:r,pB:i,distance2:s}=X4;if(r>=0&&r<=1)return s;if(r<0)return vo(t.origin,i);if(r>1)return vo(ue(ze.get(),t.origin,t.vector),i)}return null}function bwe(t,e,r){return!!wwe(t,e,!0,X4)&&(re(r,X4.pA),!0)}function wwe(t,e,r,i){const n=t.origin,o=ue(ze.get(),n,t.vector),a=e.origin,l=ue(ze.get(),a,e.vector),c=ze.get(),h=ze.get();if(c[0]=n[0]-a[0],c[1]=n[1]-a[1],c[2]=n[2]-a[2],h[0]=l[0]-a[0],h[1]=l[1]-a[1],h[2]=l[2]-a[2],Math.abs(h[0])<1e-6&&Math.abs(h[1])<1e-6&&Math.abs(h[2])<1e-6)return!1;const p=ze.get();if(p[0]=o[0]-n[0],p[1]=o[1]-n[1],p[2]=o[2]-n[2],Math.abs(p[0])<1e-6&&Math.abs(p[1])<1e-6&&Math.abs(p[2])<1e-6)return!1;const f=c[0]*h[0]+c[1]*h[1]+c[2]*h[2],m=h[0]*p[0]+h[1]*p[1]+h[2]*p[2],y=c[0]*p[0]+c[1]*p[1]+c[2]*p[2],_=h[0]*h[0]+h[1]*h[1]+h[2]*h[2],v=(p[0]*p[0]+p[1]*p[1]+p[2]*p[2])*_-m*m;if(Math.abs(v)<1e-6)return!1;let b=(f*m-y*_)/v,T=(f+m*b)/_;r&&(b=ve(b,0,1),T=ve(T,0,1));const x=ze.get(),S=ze.get();return x[0]=n[0]+b*p[0],x[1]=n[1]+b*p[1],x[2]=n[2]+b*p[2],S[0]=a[0]+T*h[0],S[1]=a[1]+T*h[1],S[2]=a[2]+T*h[2],i.tA=b,i.tB=T,i.pA=x,i.pB=S,i.distance2=vo(x,S),!0}const X4={tA:0,tB:0,pA:O(),pB:O(),distance2:0},Wqe=new Sy(()=>Op()),f9=Q.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");let Xqe=class{constructor(){this.plane=Nr(),this.origin=O(),this.basis1=O(),this.basis2=O()}};const xwe=Xqe;function Ey(t=$we){return{plane:Nr(t.plane),origin:Fs(t.origin),basis1:Fs(t.basis1),basis2:Fs(t.basis2)}}function Zqe(t,e,r){const i=aWe.get();return i.origin=t,i.basis1=e,i.basis2=r,i.plane=WHe(0,0,0,0),W6(i),i}function fx(t,e=Ey()){return HY(t.origin,t.basis1,t.basis2,e)}function Yqe(t,e){re(e.origin,t.origin),re(e.basis1,t.basis1),re(e.basis2,t.basis2),G6(e.plane,t.plane)}function HY(t,e,r,i=Ey()){return re(i.origin,t),re(i.basis1,e),re(i.basis2,r),W6(i),nWe(i,"fromValues()"),i}function W6(t){LR(t.basis2,t.basis1,t.origin,t.plane)}function Twe(t,e,r){t!==r&&fx(t,r);const i=ie(ze.get(),py(t),e);return ue(r.origin,r.origin,i),r.plane[3]-=e,r}function Jqe(t,e,r){return Swe(e,r),Twe(r,ZY(t,t.origin),r),r}function Swe(t,e=Ey()){const r=(t[2]-t[0])/2,i=(t[3]-t[1])/2;return se(e.origin,t[0]+r,t[1]+i,0),se(e.basis1,r,0,0),se(e.basis2,0,i,0),zY(0,0,1,0,e.plane),e}function qY(t,e,r){return!!px(t.plane,e,r)&&Pwe(t,r)}function Qqe(t,e,r){if(qY(t,e,r))return r;const i=Ewe(t,e,ze.get());return ue(r,e.origin,ie(ze.get(),e.direction,fi(e.origin,i)/Oe(e.direction))),r}function Ewe(t,e,r){const i=Z4.get();Iwe(t,e,i,Z4.get());let s=Number.POSITIVE_INFINITY;for(const n of JY){const o=YY(t,n,X6.get()),a=ze.get();if(ZHe(i,o,a)){const l=by(ze.get(),e.origin,a),c=Math.abs(In(fe(e.direction,l)));c<s&&(s=c,re(r,a))}}return s===Number.POSITIVE_INFINITY?Cwe(t,e,r):r}function Cwe(t,e,r){if(qY(t,e,r))return r;const i=Z4.get(),s=Z4.get();Iwe(t,e,i,s);let n=Number.POSITIVE_INFINITY;for(const o of JY){const a=YY(t,o,X6.get()),l=ze.get();if(YHe(i,a,l)){const c=RHe(e,l);if(!owe(s,l))continue;c<n&&(n=c,re(r,l))}}return WY(t,e.origin)<n&&Awe(t,e.origin,r),r}function Awe(t,e,r){const i=KHe(t.plane,e,ze.get()),s=kj(Kie(t,t.basis1),i,-1,1,ze.get()),n=kj(Kie(t,t.basis2),i,-1,1,ze.get());return de(r,ue(ze.get(),s,n),t.origin),r}function Owe(t,e,r){const{origin:i,basis1:s,basis2:n}=t,o=de(ze.get(),e,i),a=LO(s,o),l=LO(n,o),c=LO(py(t),o);return se(r,a,l,c)}function WY(t,e){const r=Owe(t,e,ze.get()),{basis1:i,basis2:s}=t,n=Oe(i),o=Oe(s),a=Math.max(Math.abs(r[0])-n,0),l=Math.max(Math.abs(r[1])-o,0),c=r[2];return a*a+l*l+c*c}function Kqe(t,e){return Math.sqrt(WY(t,e))}function eWe(t,e){let r=Number.NEGATIVE_INFINITY;for(const i of JY){const s=YY(t,i,X6.get()),n=jY(s,e);n>r&&(r=n)}return Math.sqrt(r)}function XY(t,e){return owe(t.plane,e)&&Pwe(t,e)}function tWe(t,e,r,i){return sWe(t,r,i)}function ZY(t,e){const r=-t.plane[3];return LO(py(t),e)-r}function rWe(t,e,r,i){const s=ZY(t,e),n=ie(oWe,py(t),r-s);return ue(i,e,n),i}function Rwe(t,e){return ha(t.basis1,e.basis1)&&ha(t.basis2,e.basis2)&&ha(t.origin,e.origin)}function Mwe(t,e,r){return t!==r&&fx(t,r),Mn(Fx,e),$c(Fx,Fx),Fe(r.basis1,t.basis1,Fx),Fe(r.basis2,t.basis2,Fx),Fe(r.plane,t.plane,Fx),Fe(r.origin,t.origin,e),Rj(r.plane,r.plane,r.origin),r}function iWe(t,e,r,i){return t!==i&&fx(t,i),Au(m9,e,r),Fe(i.basis1,t.basis1,m9),Fe(i.basis2,t.basis2,m9),W6(i),i}function py(t){return t.plane}function sWe(t,e,r){switch(e){case Tc.X:re(r,t.basis1),ye(r,r);break;case Tc.Y:re(r,t.basis2),ye(r,r);break;case Tc.Z:re(r,py(t))}return r}function Pwe(t,e){const r=de(ze.get(),e,t.origin),i=la(t.basis1),s=la(t.basis2),n=fe(t.basis1,r),o=fe(t.basis2,r);return-n-i<0&&n-i<0&&-o-s<0&&o-s<0}function Kie(t,e){const r=X6.get();return re(r.origin,t.origin),re(r.vector,e),r}function YY(t,e,r){const{basis1:i,basis2:s,origin:n}=t,o=ie(ze.get(),i,e.origin[0]),a=ie(ze.get(),s,e.origin[1]);ue(r.origin,o,a),ue(r.origin,r.origin,n);const l=ie(ze.get(),i,e.direction[0]),c=ie(ze.get(),s,e.direction[1]);return ie(r.vector,ue(l,l,c),2),r}function nWe(t,e){Math.abs(fe(t.basis1,t.basis2)/(Oe(t.basis1)*Oe(t.basis2)))>1e-6&&f9.warn(e,"Provided basis vectors are not perpendicular"),Math.abs(fe(t.basis1,py(t)))>1e-6&&f9.warn(e,"Basis vectors and plane normal are not perpendicular"),Math.abs(-fe(py(t),t.origin)-t.plane[3])>1e-6&&f9.warn(e,"Plane offset is not consistent with plane origin")}function Iwe(t,e,r,i){const s=py(t);LR(s,e.direction,e.origin,r),LR(r,s,e.origin,i)}const $we={plane:Nr(),origin:Me(0,0,0),basis1:Me(1,0,0),basis2:Me(0,1,0)},Z4=new Sy(Nr),X6=new Sy(Op),oWe=O(),aWe=new Sy(()=>Ey()),JY=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],Fx=be(),m9=be(),lWe=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:xwe,UP:$we,altitudeAt:ZY,axisAt:tWe,closestPoint:Cwe,closestPointOnSilhouette:Ewe,copy:fx,copyWithoutVerify:Yqe,create:Ey,distance:Kqe,distance2:WY,distanceToSilhouette:eWe,elevate:Twe,equals:Rwe,extrusionContainsPoint:XY,fromAABoundingRect:Swe,fromValues:HY,intersectRay:qY,intersectRayClosestSilhouette:Qqe,normal:py,projectPoint:Awe,projectPointLocal:Owe,rotate:iWe,setAltitudeAt:rWe,setExtent:Jqe,transform:Mwe,updateUnboundedPlane:W6,wrap:Zqe},Symbol.toStringTag,{value:"Module"}));function cWe(t){const{value:e,operations:r}=t;return{operations:r,value:r.create(e)}}function uWe(t,e,r){return t.operations.setExtent(t.value,e,r.value),r}function hWe(t){return{operations:t,value:t.create()}}function Lwe(t,e,r=hWe(t)){return r.operations=t,t.copy(e,r.value),r}function dWe(t){return Lwe(GHe,Qbe(0,0,0,zr(t).radius))}const ese=2**50;function pWe(){return Lwe(lWe,HY([0,0,0],[ese,0,0],[0,ese,0]))}function fWe(t,e,r){return t.operations.axisAt(t.value,e,Tc.Z,r)}function mWe(t,e,r,i){return t.operations.axisAt(t.value,e,r,i)}function gWe(t,e,r){return t.operations.intersectRay(t.value,e,r)}function yWe(t,e,r){return t.operations.intersectRayClosestSilhouette(t.value,e,r)}function _We(t,e){return t.operations.altitudeAt(t.value,e)}function Dwe(t,e,r,i){return t.operations.setAltitudeAt(t.value,e,r,i)}function vWe(t,e,r,i){return e!==i&&Us(i,e),se(Ux,i[12],i[13],i[14]),Dwe(t,Ux,r,Ux),i[12]=Ux[0],i[13]=Ux[1],i[14]=Ux[2],i}function g9(t,e,r){return t.operations.elevate(t.value,e,r.value)}const Ux=O();function tse(t,e,r,i,s){return s[0]=fe(t,e),s[1]=fe(t,r),s[2]=fe(t,i),s}function zj(t,e,r,i,s){re(r,t),re(SI,e),ye(SI,SI),ht(i,SI,r),ht(s,i,r)}function bWe(t,e){return t?hm(e):e.isGeographic?je.PlateCarree:e}const SI=O(),QY=96;function LNt(t,e){const r=e||t.extent,i=t.width,s=_a(r&&r.spatialReference);return r&&i?r.width/i*s*NX*QY:0}function Nwe(t,e){return t/(_a(e)*NX*QY)}function wWe(t){return t/(NX*QY)}function xWe(t,e){const r=t.extent,i=t.width-(t.padding?t.padding.left+t.padding.right:0),s=Nwe(e,r.spatialReference);return r.clone().expand(s*i/r.width)}const TWe="OBJECTID";let uE=class extends DO{constructor(e){super(e),this.handles.add(this.on("before-add",r=>{r.item!=null&&r.item.parent===this.owner&&(Q.getLogger(this).warn("Analysis inside the collection must be unique. Not adding this element again."),r.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};uE=u([P("esri.support.AnalysesCollection")],uE);const WD={widthBreakpoint:{getValue(t){const e=t.viewSize[0],r=t.breakpoints,i=this.values;return e<=r.xsmall?i.xsmall:e<=r.small?i.small:e<=r.medium?i.medium:e<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(t){const e=t.viewSize[1],r=t.breakpoints,i=this.values;return e<=r.xsmall?i.xsmall:e<=r.small?i.small:e<=r.medium?i.medium:e<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(t){const e=t.viewSize,r=e[0],i=e[1],s=this.values;return i>=r?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},y9={xsmall:544,small:768,medium:992,large:1200};function SWe(t){const e=t;return e&&e.xsmall<e.small&&e.small<e.medium&&e.medium<e.large}function _9(t,e){return e?WD[t].valueToClassName[e].split(" "):[]}const EWe=t=>{let e=class extends t{constructor(...r){super(...r),this._breakpointsHandles=new Ii,this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=y9}initialize(){this._breakpointsHandles.add(ae(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),Pr))}destroy(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=$e(this._breakpointsHandles))}set breakpoints(r){if(r===this._get("breakpoints"))return;const i=SWe(r);if(!i){const s=JSON.stringify(y9,null,2);console.warn("provided breakpoints are not valid, using defaults:"+s)}r=i?r:y9,this._set("breakpoints",{...r})}_updateClassNames(){if(!this.container)return;const r=mc.acquire(),i=mc.acquire();let s,n=!1;for(s in WD){const o=this[s],a=WD[s].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(n=!0,this[s]=a,_9(s,o).forEach(l=>i.push(l)),_9(s,a).forEach(l=>r.push(l)))}n&&(this._applyClassNameChanges(r,i),mc.release(r),mc.release(i))}_applyClassNameChanges(r,i){const s=this.container;s&&(i.forEach(n=>s.classList.remove(n)),r.forEach(n=>s.classList.add(n)))}_removeActiveClassNames(){const r=this.container;if(!r)return;let i;for(i in WD)_9(i,this[i]).forEach(s=>r.classList.remove(s))}};return u([d()],e.prototype,"breakpoints",null),u([d()],e.prototype,"orientation",void 0),u([d()],e.prototype,"widthBreakpoint",void 0),u([d()],e.prototype,"heightBreakpoint",void 0),e=u([P("esri.views.BreakpointsOwner")],e),e};/*!
 * @esri/arcgis-html-sanitizer - v3.0.1 - Tue Nov 15 2022 09:46:54 GMT-0800 (Pacific Standard Time)
 * Copyright (c) 2022 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2018 Zongmin Lei() <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 */var CWe=function(t){if(typeof t!="object"||t===null||Object.prototype.toString.call(t)!=="[object Object]")return!1;var e=Object.getPrototypeOf(t);if(e===null)return!0;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},Cb={exports:{}},Qs={},DR={exports:{}},mx={};function Fwe(){var t={};return t["align-content"]=!1,t["align-items"]=!1,t["align-self"]=!1,t["alignment-adjust"]=!1,t["alignment-baseline"]=!1,t.all=!1,t["anchor-point"]=!1,t.animation=!1,t["animation-delay"]=!1,t["animation-direction"]=!1,t["animation-duration"]=!1,t["animation-fill-mode"]=!1,t["animation-iteration-count"]=!1,t["animation-name"]=!1,t["animation-play-state"]=!1,t["animation-timing-function"]=!1,t.azimuth=!1,t["backface-visibility"]=!1,t.background=!0,t["background-attachment"]=!0,t["background-clip"]=!0,t["background-color"]=!0,t["background-image"]=!0,t["background-origin"]=!0,t["background-position"]=!0,t["background-repeat"]=!0,t["background-size"]=!0,t["baseline-shift"]=!1,t.binding=!1,t.bleed=!1,t["bookmark-label"]=!1,t["bookmark-level"]=!1,t["bookmark-state"]=!1,t.border=!0,t["border-bottom"]=!0,t["border-bottom-color"]=!0,t["border-bottom-left-radius"]=!0,t["border-bottom-right-radius"]=!0,t["border-bottom-style"]=!0,t["border-bottom-width"]=!0,t["border-collapse"]=!0,t["border-color"]=!0,t["border-image"]=!0,t["border-image-outset"]=!0,t["border-image-repeat"]=!0,t["border-image-slice"]=!0,t["border-image-source"]=!0,t["border-image-width"]=!0,t["border-left"]=!0,t["border-left-color"]=!0,t["border-left-style"]=!0,t["border-left-width"]=!0,t["border-radius"]=!0,t["border-right"]=!0,t["border-right-color"]=!0,t["border-right-style"]=!0,t["border-right-width"]=!0,t["border-spacing"]=!0,t["border-style"]=!0,t["border-top"]=!0,t["border-top-color"]=!0,t["border-top-left-radius"]=!0,t["border-top-right-radius"]=!0,t["border-top-style"]=!0,t["border-top-width"]=!0,t["border-width"]=!0,t.bottom=!1,t["box-decoration-break"]=!0,t["box-shadow"]=!0,t["box-sizing"]=!0,t["box-snap"]=!0,t["box-suppress"]=!0,t["break-after"]=!0,t["break-before"]=!0,t["break-inside"]=!0,t["caption-side"]=!1,t.chains=!1,t.clear=!0,t.clip=!1,t["clip-path"]=!1,t["clip-rule"]=!1,t.color=!0,t["color-interpolation-filters"]=!0,t["column-count"]=!1,t["column-fill"]=!1,t["column-gap"]=!1,t["column-rule"]=!1,t["column-rule-color"]=!1,t["column-rule-style"]=!1,t["column-rule-width"]=!1,t["column-span"]=!1,t["column-width"]=!1,t.columns=!1,t.contain=!1,t.content=!1,t["counter-increment"]=!1,t["counter-reset"]=!1,t["counter-set"]=!1,t.crop=!1,t.cue=!1,t["cue-after"]=!1,t["cue-before"]=!1,t.cursor=!1,t.direction=!1,t.display=!0,t["display-inside"]=!0,t["display-list"]=!0,t["display-outside"]=!0,t["dominant-baseline"]=!1,t.elevation=!1,t["empty-cells"]=!1,t.filter=!1,t.flex=!1,t["flex-basis"]=!1,t["flex-direction"]=!1,t["flex-flow"]=!1,t["flex-grow"]=!1,t["flex-shrink"]=!1,t["flex-wrap"]=!1,t.float=!1,t["float-offset"]=!1,t["flood-color"]=!1,t["flood-opacity"]=!1,t["flow-from"]=!1,t["flow-into"]=!1,t.font=!0,t["font-family"]=!0,t["font-feature-settings"]=!0,t["font-kerning"]=!0,t["font-language-override"]=!0,t["font-size"]=!0,t["font-size-adjust"]=!0,t["font-stretch"]=!0,t["font-style"]=!0,t["font-synthesis"]=!0,t["font-variant"]=!0,t["font-variant-alternates"]=!0,t["font-variant-caps"]=!0,t["font-variant-east-asian"]=!0,t["font-variant-ligatures"]=!0,t["font-variant-numeric"]=!0,t["font-variant-position"]=!0,t["font-weight"]=!0,t.grid=!1,t["grid-area"]=!1,t["grid-auto-columns"]=!1,t["grid-auto-flow"]=!1,t["grid-auto-rows"]=!1,t["grid-column"]=!1,t["grid-column-end"]=!1,t["grid-column-start"]=!1,t["grid-row"]=!1,t["grid-row-end"]=!1,t["grid-row-start"]=!1,t["grid-template"]=!1,t["grid-template-areas"]=!1,t["grid-template-columns"]=!1,t["grid-template-rows"]=!1,t["hanging-punctuation"]=!1,t.height=!0,t.hyphens=!1,t.icon=!1,t["image-orientation"]=!1,t["image-resolution"]=!1,t["ime-mode"]=!1,t["initial-letters"]=!1,t["inline-box-align"]=!1,t["justify-content"]=!1,t["justify-items"]=!1,t["justify-self"]=!1,t.left=!1,t["letter-spacing"]=!0,t["lighting-color"]=!0,t["line-box-contain"]=!1,t["line-break"]=!1,t["line-grid"]=!1,t["line-height"]=!1,t["line-snap"]=!1,t["line-stacking"]=!1,t["line-stacking-ruby"]=!1,t["line-stacking-shift"]=!1,t["line-stacking-strategy"]=!1,t["list-style"]=!0,t["list-style-image"]=!0,t["list-style-position"]=!0,t["list-style-type"]=!0,t.margin=!0,t["margin-bottom"]=!0,t["margin-left"]=!0,t["margin-right"]=!0,t["margin-top"]=!0,t["marker-offset"]=!1,t["marker-side"]=!1,t.marks=!1,t.mask=!1,t["mask-box"]=!1,t["mask-box-outset"]=!1,t["mask-box-repeat"]=!1,t["mask-box-slice"]=!1,t["mask-box-source"]=!1,t["mask-box-width"]=!1,t["mask-clip"]=!1,t["mask-image"]=!1,t["mask-origin"]=!1,t["mask-position"]=!1,t["mask-repeat"]=!1,t["mask-size"]=!1,t["mask-source-type"]=!1,t["mask-type"]=!1,t["max-height"]=!0,t["max-lines"]=!1,t["max-width"]=!0,t["min-height"]=!0,t["min-width"]=!0,t["move-to"]=!1,t["nav-down"]=!1,t["nav-index"]=!1,t["nav-left"]=!1,t["nav-right"]=!1,t["nav-up"]=!1,t["object-fit"]=!1,t["object-position"]=!1,t.opacity=!1,t.order=!1,t.orphans=!1,t.outline=!1,t["outline-color"]=!1,t["outline-offset"]=!1,t["outline-style"]=!1,t["outline-width"]=!1,t.overflow=!1,t["overflow-wrap"]=!1,t["overflow-x"]=!1,t["overflow-y"]=!1,t.padding=!0,t["padding-bottom"]=!0,t["padding-left"]=!0,t["padding-right"]=!0,t["padding-top"]=!0,t.page=!1,t["page-break-after"]=!1,t["page-break-before"]=!1,t["page-break-inside"]=!1,t["page-policy"]=!1,t.pause=!1,t["pause-after"]=!1,t["pause-before"]=!1,t.perspective=!1,t["perspective-origin"]=!1,t.pitch=!1,t["pitch-range"]=!1,t["play-during"]=!1,t.position=!1,t["presentation-level"]=!1,t.quotes=!1,t["region-fragment"]=!1,t.resize=!1,t.rest=!1,t["rest-after"]=!1,t["rest-before"]=!1,t.richness=!1,t.right=!1,t.rotation=!1,t["rotation-point"]=!1,t["ruby-align"]=!1,t["ruby-merge"]=!1,t["ruby-position"]=!1,t["shape-image-threshold"]=!1,t["shape-outside"]=!1,t["shape-margin"]=!1,t.size=!1,t.speak=!1,t["speak-as"]=!1,t["speak-header"]=!1,t["speak-numeral"]=!1,t["speak-punctuation"]=!1,t["speech-rate"]=!1,t.stress=!1,t["string-set"]=!1,t["tab-size"]=!1,t["table-layout"]=!1,t["text-align"]=!0,t["text-align-last"]=!0,t["text-combine-upright"]=!0,t["text-decoration"]=!0,t["text-decoration-color"]=!0,t["text-decoration-line"]=!0,t["text-decoration-skip"]=!0,t["text-decoration-style"]=!0,t["text-emphasis"]=!0,t["text-emphasis-color"]=!0,t["text-emphasis-position"]=!0,t["text-emphasis-style"]=!0,t["text-height"]=!0,t["text-indent"]=!0,t["text-justify"]=!0,t["text-orientation"]=!0,t["text-overflow"]=!0,t["text-shadow"]=!0,t["text-space-collapse"]=!0,t["text-transform"]=!0,t["text-underline-position"]=!0,t["text-wrap"]=!0,t.top=!1,t.transform=!1,t["transform-origin"]=!1,t["transform-style"]=!1,t.transition=!1,t["transition-delay"]=!1,t["transition-duration"]=!1,t["transition-property"]=!1,t["transition-timing-function"]=!1,t["unicode-bidi"]=!1,t["vertical-align"]=!1,t.visibility=!1,t["voice-balance"]=!1,t["voice-duration"]=!1,t["voice-family"]=!1,t["voice-pitch"]=!1,t["voice-range"]=!1,t["voice-rate"]=!1,t["voice-stress"]=!1,t["voice-volume"]=!1,t.volume=!1,t["white-space"]=!1,t.widows=!1,t.width=!0,t["will-change"]=!1,t["word-break"]=!0,t["word-spacing"]=!0,t["word-wrap"]=!0,t["wrap-flow"]=!1,t["wrap-through"]=!1,t["writing-mode"]=!1,t["z-index"]=!1,t}function AWe(t,e,r){}function OWe(t,e,r){}var RWe=/javascript\s*\:/img;function MWe(t,e){return RWe.test(e)?"":e}mx.whiteList=Fwe();mx.getDefaultWhiteList=Fwe;mx.onAttr=AWe;mx.onIgnoreAttr=OWe;mx.safeAttrValue=MWe;var PWe={indexOf:function(t,e){var r,i;if(Array.prototype.indexOf)return t.indexOf(e);for(r=0,i=t.length;r<i;r++)if(t[r]===e)return r;return-1},forEach:function(t,e,r){var i,s;if(Array.prototype.forEach)return t.forEach(e,r);for(i=0,s=t.length;i<s;i++)e.call(r,t[i],i,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(t){return String.prototype.trimRight?t.trimRight():t.replace(/(\s*$)/g,"")}},VC=PWe;function IWe(t,e){t=VC.trimRight(t),t[t.length-1]!==";"&&(t+=";");var r=t.length,i=!1,s=0,n=0,o="";function a(){if(!i){var h=VC.trim(t.slice(s,n)),p=h.indexOf(":");if(p!==-1){var f=VC.trim(h.slice(0,p)),m=VC.trim(h.slice(p+1));if(f){var y=e(s,o.length,f,m,h);y&&(o+=y+"; ")}}}s=n+1}for(;n<r;n++){var l=t[n];if(l==="/"&&t[n+1]==="*"){var c=t.indexOf("*/",n+2);if(c===-1)break;n=c+1,s=n+1,i=!1}else l==="("?i=!0:l===")"?i=!1:l===";"?i||a():l===`
`&&a()}return VC.trim(o)}var $We=IWe,EI=mx,LWe=$We;function rse(t){return t==null}function DWe(t){var e={};for(var r in t)e[r]=t[r];return e}function Uwe(t){t=DWe(t||{}),t.whiteList=t.whiteList||EI.whiteList,t.onAttr=t.onAttr||EI.onAttr,t.onIgnoreAttr=t.onIgnoreAttr||EI.onIgnoreAttr,t.safeAttrValue=t.safeAttrValue||EI.safeAttrValue,this.options=t}Uwe.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,r=e.options,i=r.whiteList,s=r.onAttr,n=r.onIgnoreAttr,o=r.safeAttrValue,a=LWe(t,function(l,c,h,p,f){var m=i[h],y=!1;if(m===!0?y=m:typeof m=="function"?y=m(p):m instanceof RegExp&&(y=m.test(p)),y!==!0&&(y=!1),p=o(h,p),!!p){var _={position:c,sourcePosition:l,source:f,isWhite:y};if(y){var v=s(h,p,_);return rse(v)?h+":"+p:v}else{var v=n(h,p,_);if(!rse(v))return v}}});return a};var NWe=Uwe;(function(t,e){var r=mx,i=NWe;function s(o,a){var l=new i(a);return l.process(o)}e=t.exports=s,e.FilterCSS=i;for(var n in r)e[n]=r[n]})(DR,DR.exports);var KY={indexOf:function(t,e){var r,i;if(Array.prototype.indexOf)return t.indexOf(e);for(r=0,i=t.length;r<i;r++)if(t[r]===e)return r;return-1},forEach:function(t,e,r){var i,s;if(Array.prototype.forEach)return t.forEach(e,r);for(i=0,s=t.length;i<s;i++)e.call(r,t[i],i,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(t){var e=/\s|\n|\t/,r=e.exec(t);return r?r.index:-1}},FWe=DR.exports.FilterCSS,UWe=DR.exports.getDefaultWhiteList,Y4=KY;function kwe(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var zwe=new FWe;function kWe(t,e,r){}function zWe(t,e,r){}function VWe(t,e,r){}function BWe(t,e,r){}function Vwe(t){return t.replace(jWe,"&lt;").replace(HWe,"&gt;")}function GWe(t,e,r,i){if(r=Wwe(r),e==="href"||e==="src"){if(r=Y4.trim(r),r==="#")return"#";if(!(r.substr(0,7)==="http://"||r.substr(0,8)==="https://"||r.substr(0,7)==="mailto:"||r.substr(0,4)==="tel:"||r.substr(0,11)==="data:image/"||r.substr(0,6)==="ftp://"||r.substr(0,2)==="./"||r.substr(0,3)==="../"||r[0]==="#"||r[0]==="/"))return""}else if(e==="background"){if(CI.lastIndex=0,CI.test(r))return""}else if(e==="style"){if(ise.lastIndex=0,ise.test(r)||(sse.lastIndex=0,sse.test(r)&&(CI.lastIndex=0,CI.test(r))))return"";i!==!1&&(i=i||zwe,r=i.process(r))}return r=Xwe(r),r}var jWe=/</g,HWe=/>/g,qWe=/"/g,WWe=/&quot;/g,XWe=/&#([a-zA-Z0-9]*);?/gim,ZWe=/&colon;?/gim,YWe=/&newline;?/gim,CI=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,ise=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,sse=/u\s*r\s*l\s*\(.*/gi;function Bwe(t){return t.replace(qWe,"&quot;")}function Gwe(t){return t.replace(WWe,'"')}function jwe(t){return t.replace(XWe,function(r,i){return i[0]==="x"||i[0]==="X"?String.fromCharCode(parseInt(i.substr(1),16)):String.fromCharCode(parseInt(i,10))})}function Hwe(t){return t.replace(ZWe,":").replace(YWe," ")}function qwe(t){for(var e="",r=0,i=t.length;r<i;r++)e+=t.charCodeAt(r)<32?" ":t.charAt(r);return Y4.trim(e)}function Wwe(t){return t=Gwe(t),t=jwe(t),t=Hwe(t),t=qwe(t),t}function Xwe(t){return t=Bwe(t),t=Vwe(t),t}function JWe(){return""}function QWe(t,e){typeof e!="function"&&(e=function(){});var r=!Array.isArray(t);function i(o){return r?!0:Y4.indexOf(t,o)!==-1}var s=[],n=!1;return{onIgnoreTag:function(o,a,l){if(i(o))if(l.isClosing){var c="[/removed]",h=l.position+c.length;return s.push([n!==!1?n:l.position,h]),n=!1,c}else return n||(n=l.position),"[removed]";else return e(o,a,l)},remove:function(o){var a="",l=0;return Y4.forEach(s,function(c){a+=o.slice(l,c[0]),l=c[1]}),a+=o.slice(l),a}}}function KWe(t){for(var e="",r=0;r<t.length;){var i=t.indexOf("<!--",r);if(i===-1){e+=t.slice(r);break}e+=t.slice(r,i);var s=t.indexOf("-->",i);if(s===-1)break;r=s+3}return e}function eXe(t){var e=t.split("");return e=e.filter(function(r){var i=r.charCodeAt(0);return i===127?!1:i<=31?i===10||i===13:!0}),e.join("")}Qs.whiteList=kwe();Qs.getDefaultWhiteList=kwe;Qs.onTag=kWe;Qs.onIgnoreTag=zWe;Qs.onTagAttr=VWe;Qs.onIgnoreTagAttr=BWe;Qs.safeAttrValue=GWe;Qs.escapeHtml=Vwe;Qs.escapeQuote=Bwe;Qs.unescapeQuote=Gwe;Qs.escapeHtmlEntities=jwe;Qs.escapeDangerHtml5Entities=Hwe;Qs.clearNonPrintableCharacter=qwe;Qs.friendlyAttrValue=Wwe;Qs.escapeAttrValue=Xwe;Qs.onIgnoreTagStripAll=JWe;Qs.StripTagBody=QWe;Qs.stripCommentTag=KWe;Qs.stripBlankChar=eXe;Qs.cssFilter=zwe;Qs.getDefaultCSSWhiteList=UWe;var Z6={},o_=KY;function tXe(t){var e=o_.spaceIndex(t),r;return e===-1?r=t.slice(1,-1):r=t.slice(1,e+1),r=o_.trim(r).toLowerCase(),r.slice(0,1)==="/"&&(r=r.slice(1)),r.slice(-1)==="/"&&(r=r.slice(0,-1)),r}function rXe(t){return t.slice(0,2)==="</"}function iXe(t,e,r){var i="",s=0,n=!1,o=!1,a=0,l=t.length,c="",h="";e:for(a=0;a<l;a++){var p=t.charAt(a);if(n===!1){if(p==="<"){n=a;continue}}else if(o===!1){if(p==="<"){i+=r(t.slice(s,a)),n=a,s=a;continue}if(p===">"){i+=r(t.slice(s,n)),h=t.slice(n,a+1),c=tXe(h),i+=e(n,i.length,c,h,rXe(h)),s=a+1,n=!1;continue}if(p==='"'||p==="'")for(var f=1,m=t.charAt(a-f);m.trim()===""||m==="=";){if(m==="="){o=p;continue e}m=t.charAt(a-++f)}}else if(p===o){o=!1;continue}}return s<t.length&&(i+=r(t.substr(s))),i}var sXe=/[^a-zA-Z0-9\\_:.-]/gim;function nXe(t,e){var r=0,i=0,s=[],n=!1,o=t.length;function a(f,m){if(f=o_.trim(f),f=f.replace(sXe,"").toLowerCase(),!(f.length<1)){var y=e(f,m||"");y&&s.push(y)}}for(var l=0;l<o;l++){var c=t.charAt(l),h,p;if(n===!1&&c==="="){n=t.slice(r,l),r=l+1,i=t.charAt(r)==='"'||t.charAt(r)==="'"?r:aXe(t,l+1);continue}if(n!==!1&&l===i){if(p=t.indexOf(c,l+1),p===-1)break;h=o_.trim(t.slice(i+1,p)),a(n,h),n=!1,l=p,r=l+1;continue}if(/\s|\n|\t/.test(c))if(t=t.replace(/\s|\n|\t/g," "),n===!1)if(p=oXe(t,l),p===-1){h=o_.trim(t.slice(r,l)),a(h),n=!1,r=l+1;continue}else{l=p-1;continue}else if(p=lXe(t,l-1),p===-1){h=o_.trim(t.slice(r,l)),h=nse(h),a(n,h),n=!1,r=l+1;continue}else continue}return r<t.length&&(n===!1?a(t.slice(r)):a(n,nse(o_.trim(t.slice(r))))),o_.trim(s.join(" "))}function oXe(t,e){for(;e<t.length;e++){var r=t[e];if(r!==" ")return r==="="?e:-1}}function aXe(t,e){for(;e<t.length;e++){var r=t[e];if(r!==" ")return r==="'"||r==='"'?e:-1}}function lXe(t,e){for(;e>0;e--){var r=t[e];if(r!==" ")return r==="="?e:-1}}function cXe(t){return t[0]==='"'&&t[t.length-1]==='"'||t[0]==="'"&&t[t.length-1]==="'"}function nse(t){return cXe(t)?t.substr(1,t.length-2):t}Z6.parseTag=iXe;Z6.parseAttr=nXe;var uXe=DR.exports.FilterCSS,Bd=Qs,Zwe=Z6,hXe=Zwe.parseTag,dXe=Zwe.parseAttr,XD=KY;function AI(t){return t==null}function pXe(t){var e=XD.spaceIndex(t);if(e===-1)return{html:"",closing:t[t.length-2]==="/"};t=XD.trim(t.slice(e+1,-1));var r=t[t.length-1]==="/";return r&&(t=XD.trim(t.slice(0,-1))),{html:t,closing:r}}function fXe(t){var e={};for(var r in t)e[r]=t[r];return e}function mXe(t){var e={};for(var r in t)Array.isArray(t[r])?e[r.toLowerCase()]=t[r].map(function(i){return i.toLowerCase()}):e[r.toLowerCase()]=t[r];return e}function Ywe(t){t=fXe(t||{}),t.stripIgnoreTag&&(t.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),t.onIgnoreTag=Bd.onIgnoreTagStripAll),t.whiteList||t.allowList?t.whiteList=mXe(t.whiteList||t.allowList):t.whiteList=Bd.whiteList,t.onTag=t.onTag||Bd.onTag,t.onTagAttr=t.onTagAttr||Bd.onTagAttr,t.onIgnoreTag=t.onIgnoreTag||Bd.onIgnoreTag,t.onIgnoreTagAttr=t.onIgnoreTagAttr||Bd.onIgnoreTagAttr,t.safeAttrValue=t.safeAttrValue||Bd.safeAttrValue,t.escapeHtml=t.escapeHtml||Bd.escapeHtml,this.options=t,t.css===!1?this.cssFilter=!1:(t.css=t.css||{},this.cssFilter=new uXe(t.css))}Ywe.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,r=e.options,i=r.whiteList,s=r.onTag,n=r.onIgnoreTag,o=r.onTagAttr,a=r.onIgnoreTagAttr,l=r.safeAttrValue,c=r.escapeHtml,h=e.cssFilter;r.stripBlankChar&&(t=Bd.stripBlankChar(t)),r.allowCommentTag||(t=Bd.stripCommentTag(t));var p=!1;r.stripIgnoreTagBody&&(p=Bd.StripTagBody(r.stripIgnoreTagBody,n),n=p.onIgnoreTag);var f=hXe(t,function(m,y,_,v,b){var T={sourcePosition:m,position:y,isClosing:b,isWhite:Object.prototype.hasOwnProperty.call(i,_)},x=s(_,v,T);if(!AI(x))return x;if(T.isWhite){if(T.isClosing)return"</"+_+">";var S=pXe(v),E=i[_],A=dXe(S.html,function(R,M){var D=XD.indexOf(E,R)!==-1,k=o(_,R,M,D);return AI(k)?D?(M=l(_,R,M,h),M?R+'="'+M+'"':R):(k=a(_,R,M,D),AI(k)?void 0:k):k});return v="<"+_,A&&(v+=" "+A),S.closing&&(v+=" /"),v+=">",v}else return x=n(_,v,T),AI(x)?c(v):x},c);return p&&(f=p.remove(f)),f};var gXe=Ywe;(function(t,e){var r=Qs,i=Z6,s=gXe;function n(a,l){var c=new s(l);return c.process(a)}e=t.exports=n,e.filterXSS=n,e.FilterXSS=s,function(){for(var a in r)e[a]=r[a];for(var l in i)e[l]=i[l]}();function o(){return typeof self<"u"&&typeof DedicatedWorkerGlobalScope<"u"&&self instanceof DedicatedWorkerGlobalScope}o()&&(self.filterXSS=t.exports)})(Cb,Cb.exports);var yXe=function(){function t(e,r){var i=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(n,o,a,l){return n==="a"&&o==="href"||(n==="img"||n==="source")&&o==="src"?i.sanitizeUrl(a):Cb.exports.safeAttrValue(n,o,a,l)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"};var s;e&&!r?s=e:e&&r?(s=Object.create(this.arcgisFilterOptions),Object.keys(e).forEach(function(n){n==="whiteList"?s.whiteList=i._extendObjectOfArrays([i.arcgisWhiteList,e.whiteList||{}]):s[n]=e[n]})):(s=Object.create(this.arcgisFilterOptions),s.whiteList=this.arcgisWhiteList),this.xssFilterOptions=s,this._xssFilter=new Cb.exports.FilterXSS(s)}return t.prototype.sanitize=function(e,r){switch(r===void 0&&(r={}),typeof e){case"number":return isNaN(e)||!isFinite(e)?null:e;case"boolean":return e;case"string":return this._xssFilter.process(e);case"object":return this._iterateOverObject(e,r);default:return r.allowUndefined&&typeof e>"u"?void 0:null}},t.prototype.sanitizeUrl=function(e,r){var i=(r??{}).isProtocolRequired,s=i===void 0?!0:i,n=this._trim(e.substring(0,e.indexOf(":"))),o=e==="/",a=/^#/.test(e),l=n&&this.allowedProtocols.indexOf(n.toLowerCase())>-1;return o||a||l?Cb.exports.escapeAttrValue(e):!n&&!s?Cb.exports.escapeAttrValue("https://".concat(e)):""},t.prototype.sanitizeHTMLAttribute=function(e,r,i,s){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(e,r,i,s):Cb.exports.safeAttrValue(e,r,i,s)},t.prototype.validate=function(e,r){r===void 0&&(r={});var i=this.sanitize(e,r);return{isValid:e===i,sanitized:i}},t.prototype.encodeHTML=function(e){var r=this;return String(e).replace(/[&<>"'\/]/g,function(i){return r._entityMap[i]})},t.prototype.encodeAttrValue=function(e){var r=/^[a-zA-Z0-9]$/;return String(e).replace(/[\x00-\xFF]/g,function(i,s){return r.test(i)?i:"&#x".concat(Number(e.charCodeAt(s)).toString(16),";")})},t.prototype._extendObjectOfArrays=function(e){var r={};return e.forEach(function(i){Object.keys(i).forEach(function(s){Array.isArray(i[s])&&Array.isArray(r[s])?r[s]=r[s].concat(i[s]):r[s]=i[s]})}),r},t.prototype._iterateOverObject=function(e,r){var i=this;r===void 0&&(r={});try{var s=!1,n=void 0;if(Array.isArray(e))n=e.reduce(function(a,l){var c=i.validate(l,r);return c.isValid?a.concat([l]):(s=!0,a.concat([c.sanitized]))},[]);else if(CWe(e)){var o=Object.keys(e);n=o.reduce(function(a,l){var c=e[l],h=i.validate(c,r);return h.isValid?a[l]=c:(s=!0,a[l]=h.sanitized),a},{})}else return r.allowUndefined&&typeof e>"u"?void 0:null;return s?n:e}catch{return null}},t.prototype._trim=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},t}();const Y6=new Map;function Jwe(){Y6.clear()}function _Xe(t){return Y6.get(t)}function vXe(t,e){Y6.set(t,e)}function v9(t){Y6.delete(t)}var Pw,hE,bXe=function(t){if("WebkitTransition"in t.style)Pw="webkitTransitionEnd",hE="webkitAnimationEnd";else{if(!("transition"in t.style))throw new Error("Your browser is not supported!");Pw="transitionend",hE="animationend"}},Qwe=function(t){Pw||bXe(t)},wXe=function(t,e){return e===void 0&&(e=t+"-active"),function(r){Qwe(r);var i=!1,s=function(n){i||(i=!0,r.removeEventListener(Pw,s),r.removeEventListener(hE,s),r.classList.remove(t),r.classList.remove(e))};r.classList.add(t),r.addEventListener(Pw,s),r.addEventListener(hE,s),requestAnimationFrame(function(){r.classList.add(e)})}},xXe=function(t,e){return e===void 0&&(e=t+"-active"),function(r,i){Qwe(r);var s=!1,n=function(o){s||(s=!0,r.removeEventListener(Pw,n),r.removeEventListener(hE,n),i())};r.classList.add(t),r.addEventListener(Pw,n),r.addEventListener(hE,n),requestAnimationFrame(function(){r.classList.add(e)})}};const TXe=Q.getLogger("esri.widgets.support.widgetUtils");function SXe(t){const e=mc.acquire();for(let i=0;i<arguments.length;i++){const s=arguments[i],n=typeof s;if(n==="string")e.push(s);else if(Array.isArray(s))e.push.apply(e,s);else if(n==="object")for(const o in s)s[o]&&e.push(o)}const r=e.join(" ");return mc.release(e),r}(()=>{const t=new Map,e=new ResizeObserver(i=>{Jwe();for(const s of i)t.get(s.target)?.(s)}),r=(i,s,n)=>(t.has(i)&&TXe.error("Already observing element",i),t.set(i,s),e.observe(i,n),el(()=>{e.unobserve(i),t.delete(i)}));return(i,s,n)=>{let o=null;return ae(()=>typeof i=="function"?i():i,a=>{o?.remove(),a&&(o=r(a,s,n))},Is)}})();function EXe(t){const e=t?.closest("[dir]");return e!==null&&e instanceof HTMLElement&&e.dir==="rtl"||document.dir==="rtl"}function NNt(t){const e="data-node-ref";this[t.getAttribute(e)]=null}function OI(t){const e="data-node-ref";this[t.getAttribute(e)]=t}function FNt(t,e){return(t==="enter"?wXe:xXe)(e)}const CXe=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],AXe=CXe.reduce((t,e)=>(t[e]=[],t),{}),OXe=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],Kwe=new yXe({whiteList:AXe,onTagAttr:(t,e,r)=>{const i=`${e}="${r}"`;if(OXe.includes(e))return i},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function RXe(t,e){const r=t.getBoundingClientRect(),i=e.getBoundingClientRect(),s=r.top+r.height,n=i.top+i.height,o=r.top,a=i.top;(s>n||o<a)&&t.scrollIntoView({block:"end"})}function exe(t){return t==="Enter"||t===" "}const txe="http://www.w3.org/",J6=`${txe}2000/svg`,rxe=`${txe}1999/xlink`;let ose=[],eJ=(t,e)=>{let r={};return Object.keys(t).forEach(i=>{r[i]=t[i]}),e&&Object.keys(e).forEach(i=>{r[i]=e[i]}),r},tJ=(t,e)=>t.vnodeSelector===e.vnodeSelector&&(t.properties&&e.properties?t.properties.key===e.properties.key&&t.properties.bind===e.properties.bind:!t.properties&&!e.properties),ixe=t=>{if(typeof t!="string")throw new Error("Style values must be strings")},MXe=(t,e,r)=>{if(e.vnodeSelector!==""){for(let i=r;i<t.length;i++)if(tJ(t[i],e))return i}return-1},b9=(t,e,r,i)=>{let s=t[e];if(s.vnodeSelector==="")return;let n=s.properties;if(!(n&&(n.key===void 0?n.bind:n.key))){for(let o=0;o<t.length;o++)if(o!==e){let a=t[o];if(tJ(a,s))throw new Error(`${r.vnodeSelector} had a ${s.vnodeSelector} child ${i==="added"?i:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},PXe=t=>{if(t.properties){let e=t.properties.enterAnimation;e&&e(t.domNode,t.properties)}},Vj=[],Bj=!1,sxe=t=>{(t.children||[]).forEach(sxe),t.properties&&t.properties.afterRemoved&&t.properties.afterRemoved.apply(t.properties.bind||t.properties,[t.domNode])},ase=()=>{Bj=!1,Vj.forEach(sxe),Vj.length=0},lse=t=>{Vj.push(t),Bj||(Bj=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(ase,{timeout:16}):setTimeout(ase,16))},cse=t=>{let e=t.domNode;if(t.properties){let r=t.properties.exitAnimation;if(r)return e.style.pointerEvents="none",void r(e,()=>{e.parentNode&&(e.parentNode.removeChild(e),lse(t))},t.properties)}e.parentNode&&(e.parentNode.removeChild(e),lse(t))},IXe=(t,e,r)=>{if(!e)return;let i=r.eventHandlerInterceptor,s=Object.keys(e),n=s.length;for(let o=0;o<n;o++){let a=s[o],l=e[a];if(a==="className")throw new Error('Property "className" is not supported, use "class".');if(a==="class")Gj(t,l,!0);else if(a==="classes"){let c=Object.keys(l),h=c.length;for(let p=0;p<h;p++){let f=c[p];l[f]&&t.classList.add(f)}}else if(a==="styles"){let c=Object.keys(l),h=c.length;for(let p=0;p<h;p++){let f=c[p],m=l[f];m&&(ixe(m),r.styleApplyer(t,f,m))}}else if(a!=="key"&&l!=null){let c=typeof l;c==="function"?(a.lastIndexOf("on",0)===0&&(i&&(l=i(a,l,t,e)),a==="oninput"&&function(){let h=l;l=function(p){h.apply(this,[p]),p.target["oninput-value"]=p.target.value}}()),t[a]=l):r.namespace===J6?a==="href"?t.setAttributeNS(rxe,a,l):t.setAttribute(a,l):c==="string"&&a!=="value"?a==="innerHTML"?t[a]=Kwe.sanitize(l):nxe(t)&&a in t?t[a]=l:t.setAttribute(a,l):t[a]=l}}};function nxe(t){if(!(t instanceof Element&&t.tagName.includes("-")))return!1;const e=window.customElements.get(t.tagName.toLowerCase());return!!e&&t instanceof e}let J4,$Xe=(t,e,r)=>{if(e)for(let i of e)kS(i,t,void 0,r)},oxe=(t,e,r)=>{$Xe(t,e.children,r),e.text&&(t.textContent=e.text),IXe(t,e.properties,r),e.properties&&e.properties.afterCreate&&e.properties.afterCreate.apply(e.properties.bind||e.properties,[t,r,e.vnodeSelector,e.properties,e.children])},kS=(t,e,r,i)=>{let s,n=0,o=t.vnodeSelector,a=e.ownerDocument;if(o==="")s=t.domNode=a.createTextNode(t.text),r!==void 0?e.insertBefore(s,r):e.appendChild(s);else{for(let l=0;l<=o.length;++l){let c=o.charAt(l);if(l===o.length||c==="."||c==="#"){let h=o.charAt(n-1),p=o.slice(n,l);h==="."?s.classList.add(p):h==="#"?s.id=p:(p==="svg"&&(i=eJ(i,{namespace:J6})),i.namespace!==void 0?s=t.domNode=a.createElementNS(i.namespace,p):(s=t.domNode=t.domNode||a.createElement(p),p==="input"&&t.properties&&t.properties.type!==void 0&&s.setAttribute("type",t.properties.type)),r!==void 0?e.insertBefore(s,r):s.parentNode!==e&&e.appendChild(s)),n=l+1}}oxe(s,t,i)}},Gj=(t,e,r)=>{e&&e.split(" ").forEach(i=>{i&&t.classList.toggle(i,r)})},LXe=(t,e,r,i)=>{if(!r)return;let s=!1,n=Object.keys(r),o=n.length;for(let a=0;a<o;a++){let l=n[a],c=r[l],h=e[l];if(l==="class")h!==c&&(Gj(t,h,!1),Gj(t,c,!0));else if(l==="classes"){let p=t.classList,f=Object.keys(c),m=f.length;for(let y=0;y<m;y++){let _=f[y],v=!!c[_];v!==!!h[_]&&(s=!0,v?p.add(_):p.remove(_))}}else if(l==="styles"){let p=Object.keys(c),f=p.length;for(let m=0;m<f;m++){let y=p[m],_=c[y];_!==h[y]&&(s=!0,_?(ixe(_),i.styleApplyer(t,y,_)):i.styleApplyer(t,y,""))}}else if(c||typeof h!="string"||(c=""),l==="value"){let p=t[l];p!==c&&(t["oninput-value"]?p===t["oninput-value"]:c!==h)&&(t[l]=c,t["oninput-value"]=void 0),c!==h&&(s=!0)}else if(c!==h){let p=typeof c;p==="function"&&i.eventHandlerInterceptor||(i.namespace===J6?l==="href"?t.setAttributeNS(rxe,l,c):t.setAttribute(l,c):p==="string"?l==="innerHTML"?t[l]=Kwe.sanitize(c):l==="role"&&c===""?t.removeAttribute(l):nxe(t)&&l in t?t[l]=c:t.setAttribute(l,c):t[l]!==c&&(t[l]=c),s=!0)}}return s},DXe=(t,e,r,i,s)=>{if(r===i)return!1;i=i||ose;let n,o=(r=r||ose).length,a=i.length,l=0,c=0,h=!1;for(;c<a;){let p=l<o?r[l]:void 0,f=i[c];if(p!==void 0&&tJ(p,f))h=J4(p,f,s)||h,l++;else{let m=MXe(r,f,l+1);if(m>=0){for(n=l;n<m;n++)cse(r[n]),b9(r,n,t,"removed");h=J4(r[m],f,s)||h,l=m+1}else kS(f,e,l<o?r[l].domNode:void 0,s),PXe(f),b9(i,c,t,"added")}c++}if(o>l)for(n=l;n<o;n++)cse(r[n]),b9(r,n,t,"removed");return h};J4=(t,e,r)=>{let i=t.domNode,s=!1;if(t===e)return!1;let n=!1;if(e.vnodeSelector===""){if(e.text!==t.text){let o=i.ownerDocument.createTextNode(e.text);return i.parentNode.replaceChild(o,i),e.domNode=o,s=!0,s}e.domNode=i}else e.vnodeSelector.lastIndexOf("svg",0)===0&&(r=eJ(r,{namespace:J6})),t.text!==e.text&&(n=!0,e.text===void 0?i.removeChild(i.firstChild):i.textContent=e.text),e.domNode=i,n=DXe(e,i,t.children,e.children,r)||n,n=LXe(i,t.properties,e.properties,r)||n,e.properties&&e.properties.afterUpdate&&e.properties.afterUpdate.apply(e.properties.bind||e.properties,[i,r,e.vnodeSelector,e.properties,e.children]);return n&&e.properties&&e.properties.updateAnimation&&e.properties.updateAnimation(i,e.properties,t.properties),s};let BC=(t,e)=>({getLastRender:()=>t,update:r=>{if(t.vnodeSelector!==r.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let i=t;t=r,J4(i,r,e)},domNode:t.domNode});const NXe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,r)=>{e.charAt(0)==="-"?t.style.setProperty(e,r):t.style[e]=r}};let lS=t=>eJ(NXe,t),L_={create:(t,e)=>(e=lS(e),kS(t,document.createElement("div"),void 0,e),BC(t,e)),append:(t,e,r)=>(r=lS(r),kS(e,t,void 0,r),BC(e,r)),insertBefore:(t,e,r)=>(r=lS(r),kS(e,t.parentNode,t,r),BC(e,r)),merge:(t,e,r)=>(r=lS(r),e.domNode=t,oxe(t,e,r),BC(e,r)),replace:(t,e,r)=>(r=lS(r),kS(e,t.parentNode,t,r),t.parentNode.removeChild(t),BC(e,r))},axe,FXe=(t,e)=>{let r=[];for(;t&&t!==e;)r.push(t),t=t.parentNode;return r};axe=Array.prototype.find?(t,e)=>t.find(e):(t,e)=>t.filter(e)[0];let UXe=(t,e)=>{let r=t;return e.forEach(i=>{r=r&&r.children?axe(r.children,s=>s.domNode===i):void 0}),r},kXe=(t,e,r)=>{let i=function(s){r("domEvent",s);let n=e(),o=FXe(s.currentTarget,n.domNode);o.reverse();let a,l=UXe(n.getLastRender(),o);return t.scheduleRender(),l&&(a=l.properties[`on${s.type}`].apply(l.properties.bind||this,arguments)),r("domEventProcessed",s),a};return(s,n,o,a)=>i},use=t=>{let e,r,i=lS(t),s=i.performanceLogger,n=!0,o=!1,a=[],l=[],c=(p,f,m)=>{let y,_=()=>y;i.eventHandlerInterceptor=kXe(e,_,s),y=p(f,m(),i),a.push(y),l.push(m)},h=()=>{if(r=void 0,n){n=!1,s("renderStart",void 0);for(let p=0;p<a.length;p++){let f=l[p]();s("rendered",void 0),a[p].update(f),s("patched",void 0)}s("renderDone",void 0),n=!0}};return e={renderNow:h,scheduleRender:()=>{r||o||(r=requestAnimationFrame(h))},stop:()=>{r&&(cancelAnimationFrame(r),r=void 0),o=!0},resume:()=>{o=!1,n=!0,e.scheduleRender()},append:(p,f)=>{c(L_.append,p,f)},insertBefore:(p,f)=>{c(L_.insertBefore,p,f)},merge:(p,f)=>{c(L_.merge,p,f)},replace:(p,f)=>{c(L_.replace,p,f)},detach:p=>{for(let f=0;f<l.length;f++)if(l[f]===p)return l.splice(f,1),a.splice(f,1)[0];throw new Error("renderFunction was not found")}},e},B0=class extends we{constructor(){super(...arguments),this.items=new Pt,this._watchUpdatingTracking=new Xf,this._callbacks=new Map,this._projector=use(),this._hiddenProjector=use()}get needsRender(){return this.items.length>0}get updating(){return this._watchUpdatingTracking?.updating??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,r=>{for(const i of r.added){const s=()=>i.render();this._callbacks.set(i,s),this._projector.append(this.surface,s)}for(const i of r.removed){const s=this._projector.detach(this._callbacks.get(i));this.surface.removeChild(s.domNode),this._callbacks.delete(i)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const r=this._hiddenSurface,i=this._hiddenProjector;let s;const n=()=>(s=e.render(),s);i.append(r,n),i.renderNow();const o={left:0,top:0,right:0,bottom:0};if(s&&s.domNode){const a=s.domNode.getBoundingClientRect();o.left=a.left,o.top=a.top,o.right=a.right,o.bottom=a.bottom}for(i.detach(n);r.firstChild;)r.removeChild(r.firstChild);return o}overlaps(e,r){const i=this.computeBoundingRect(e),s=this.computeBoundingRect(r);return Math.max(i.left,s.left)<=Math.min(i.right,s.right)&&Math.max(i.top,s.top)<=Math.min(i.bottom,s.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e){if(!this.items.some(i=>i.visible))return;const r=e.getContext("2d");r.save(),r.font=this._fontString(),this.items.forEach(i=>{r.save(),i.renderCanvas(r),r.restore()}),r.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};u([d({readOnly:!0})],B0.prototype,"surface",void 0),u([d({readOnly:!0})],B0.prototype,"items",void 0),u([d({readOnly:!0})],B0.prototype,"needsRender",null),u([d({readOnly:!0})],B0.prototype,"_watchUpdatingTracking",void 0),u([d({readOnly:!0})],B0.prototype,"updating",null),B0=u([P("esri.views.overlay.ViewOverlay")],B0);const hse=B0,w9=[0,0];function zXe(t){const e=(t.ownerDocument||window.document).defaultView,r=t.getBoundingClientRect();return w9[0]=r.left+(e?.pageXOffset??0),w9[1]=r.top+(e?.pageYOffset??0),w9}function dse(t){t&&(vwe(t),t.parentNode&&t.parentNode.removeChild(t))}function VXe(t){const e=document.createElement("div");return t.appendChild(e),e}const GC=16,RI=750,BXe=512,GXe=2,jXe=t=>{let e=class extends t{constructor(...r){super(...r),this._freqInfo={freq:GC,time:RI},this._overlayRenderTaskHandle=null,this.height=0,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([ae(()=>this.cursor,i=>{const{surface:s}=this;s&&s.setAttribute("data-cursor",i)}),ae(()=>this.navigating,i=>{const{surface:s}=this;s&&s.setAttribute("data-navigating",i.toString())})])}initialize(){this.addHandles([ae(()=>this.ui,(r,i)=>this._handleUIChange(r,i),Pr),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui=$e(this.ui),this.container=null)}get container(){return this._get("container")??null}set container(r){const i=this._get("container"),s=q6(r);if(s||typeof r!="string"||Q.getLogger(this).error("#container",`element with id '${r}' not found`),i===s)return;if(this._stopMeasuring(),i&&(i.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(dse(this.root),this._set("root",null)),this.userContent&&(Qie(this.userContent,i),dse(this.userContent),this._set("userContent",null))),!s)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);s.classList.add("esri-view");const n=document.createElement("div");n.className="esri-view-user-storage",Qie(s,n),s.appendChild(n),this._set("userContent",n);const o=document.createElement("div");o.className="esri-view-root",s.insertBefore(o,s.firstChild),this._set("root",o);const a=document.createElement("div");a.className="esri-view-surface",a.setAttribute("role","application"),a.tabIndex=0,o.appendChild(a),this._set("surface",a);const l=new hse;o.appendChild(l.surface),this._set("overlay",l),this.addHandles(ae(()=>l.needsRender,c=>{c&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=k2({render:()=>this.overlay?.render()}):this._overlayRenderTaskHandle=Ni(this._overlayRenderTaskHandle)})),this.forceDOMReadyCycle(),this._set("container",s),this._startMeasuring()}get focused(){const r=document.activeElement===this.surface;return document.hasFocus()&&r}get size(){return[this.width,this.height]}blur(){this.surface?.blur()}focus(){this.surface?.focus()}pageToContainer(r,i,s){const n=this.position;return r-=n?n[0]:0,i-=n?n[1]:0,s?(s[0]=r,s[1]=i):s=[r,i],s}containerToPage(r,i,s){const n=this.position;return r+=n?n[0]:0,i+=n?n[1]:0,s?(s[0]=r,s[1]=i):s=[r,i],s}_handleUIChange(r,i){this.removeHandles("ui"),i&&i!==r&&i.destroy(),r&&(r.view=this,this.addHandles(ae(()=>this.root,s=>{r.container=s?VXe(s):null},Pr),"ui")),this._set("ui",r)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const r=this._freqInfo;r.freq=GC,r.time=RI,this.addHandles([(()=>{const i=()=>{r.freq=GC,r.time=RI};return window.addEventListener("resize",i),{remove(){window.removeEventListener("resize",i)}}})(),k2({prepare:i=>{const s=this._measure(),n=this._freqInfo;if(n.time+=i.deltaTime,s&&(n.freq=GC,this._get("resizing")||this._set("resizing",!0)),n.time<n.freq)return;n.time=0;const o=this._position();n.freq=o||s?GC:Math.min(RI,n.freq*GXe),!s&&n.freq>=BXe&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const r=this.container,i=r?r.clientWidth:0,s=r?r.clientHeight:0;if(i===0||s===0)return this.suspended||this._set("suspended",!0),!1;const n=this.width,o=this.height;return i===n&&s===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",i),this._set("height",s),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:n,oldHeight:o,width:i,height:s}),!0)}_position(){const r=this.container,i=this.position,s=r&&zXe(r);return!!s&&(!i||s[0]!==i[0]||s[1]!==i[1])&&(this._set("position",[s[0],s[1]]),!0)}forceDOMReadyCycle(){}};return u([d()],e.prototype,"container",null),u([d({readOnly:!0})],e.prototype,"focused",null),u([d({readOnly:!0})],e.prototype,"height",void 0),u([d({type:hse})],e.prototype,"overlay",void 0),u([d({readOnly:!0})],e.prototype,"position",void 0),u([d({readOnly:!0})],e.prototype,"resizing",void 0),u([d({readOnly:!0})],e.prototype,"root",void 0),u([d({value:null,readOnly:!0})],e.prototype,"size",null),u([d({readOnly:!0})],e.prototype,"surface",void 0),u([d({readOnly:!0})],e.prototype,"suspended",void 0),u([d()],e.prototype,"ui",void 0),u([d({readOnly:!0})],e.prototype,"userContent",void 0),u([d({readOnly:!0})],e.prototype,"width",void 0),u([d()],e.prototype,"widthBreakpoint",void 0),e=u([P("esri.views.DOMContainer")],e),e},rJ=Q.getLogger("esri.layers.support.ElevationSampler");let lxe=class{queryElevation(e){return cxe(e.clone(),this)}on(){return ZXe}projectIfRequired(e,r){return uxe(e,r)}},HXe=class extends lxe{get spatialReference(){return this.extent.spatialReference}constructor(e,r,i){super(),this.tile=e,this.noDataValue=i;const s=e.tile.extent;this.extent=Q5(s,r.spatialReference),this.extent.zmin=e.zmin,this.extent.zmax=e.zmax,this._aaExtent=s;const n=_a(r.spatialReference),o=r.lodAt(e.tile.level).resolution*n;this.demResolution={min:o,max:o}}contains(e){const r=this.projectIfRequired(e,this.spatialReference);return r!=null&&this.containsAt(r.x,r.y)}containsAt(e,r){return K5(this._aaExtent,e,r)}elevationAt(e,r){if(!this.containsAt(e,r)){const i=this.extent,s=`${i.xmin}, ${i.ymin}, ${i.xmax}, ${i.ymax}`;return rJ.warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler extent (${s})`),this.noDataValue}return this.tile.sample(e,r)??this.noDataValue}},VNt=class extends lxe{get spatialReference(){return this.extent.spatialReference}constructor(e,r,i){let s;super(),typeof r=="number"?(this.noDataValue=r,s=null):(s=r,this.noDataValue=i),this.samplers=s?e.map(o=>new HXe(o,s,this.noDataValue)):e;const n=this.samplers[0];if(n){this.extent=n.extent.clone();const{min:o,max:a}=n.demResolution;this.demResolution={min:o,max:a};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=Q5(Vt(),s.spatialReference),this.demResolution={min:0,max:0}}elevationAt(e,r){for(const i of this.samplers)if(i.containsAt(e,r))return i.elevationAt(e,r);return rJ.warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler`),this.noDataValue}};function cxe(t,e){const r=uxe(t,e.spatialReference);if(!r)return null;switch(t.type){case"point":qXe(t,r,e);break;case"polyline":WXe(t,r,e);break;case"multipoint":XXe(t,r,e)}return t}function uxe(t,e){if(t==null)return null;const r=t.spatialReference;if(r.equals(e))return t;const i=rx(t,e);return i||rJ.error(`Cannot project geometry spatial reference (wkid:${r.wkid}) to elevation sampler spatial reference (wkid:${e.wkid})`),i}function qXe(t,e,r){t.z=r.elevationAt(e.x,e.y)}function WXe(t,e,r){If.spatialReference=e.spatialReference;const i=t.hasM&&!t.hasZ;for(let s=0;s<t.paths.length;s++){const n=t.paths[s],o=e.paths[s];for(let a=0;a<n.length;a++){const l=n[a],c=o[a];If.x=c[0],If.y=c[1],i&&(l[3]=l[2]),l[2]=r.elevationAt(If.x,If.y)}}t.hasZ=!0}function XXe(t,e,r){If.spatialReference=e.spatialReference;const i=t.hasM&&!t.hasZ;for(let s=0;s<t.points.length;s++){const n=t.points[s],o=e.points[s];If.x=o[0],If.y=o[1],i&&(n[3]=n[2]),n[2]=r.elevationAt(If.x,If.y)}t.hasZ=!0}const If=new Ke,ZXe={remove(){}};var jj;let pf=jj=class extends le{constructor(t){super(t),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new jj({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],pf.prototype,"cols",void 0),u([d({type:Qi,json:{write:!0}})],pf.prototype,"level",void 0),u([d({type:String,json:{write:!0}})],pf.prototype,"levelValue",void 0),u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],pf.prototype,"origin",void 0),u([d({type:Number,json:{write:!0}})],pf.prototype,"resolution",void 0),u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],pf.prototype,"rows",void 0),u([d({type:Number,json:{write:!0}})],pf.prototype,"scale",void 0),pf=jj=u([P("esri.layers.support.LOD")],pf);const Zd=pf;let YXe=class{constructor(e,r,i,s,n=void 0){this.id=e,this.level=r,this.row=i,this.col=s,this.extent=n}};var G0;const pse=new $r({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let ea=G0=class extends le{static create(t={}){const{resolutionFactor:e=1,scales:r,size:i=256,spatialReference:s=je.WebMercator,numLODs:n=24}=t;if(!ua(s)){const p=[];if(r)for(let f=0;f<r.length;f++){const m=r[f];p.push(new Zd({level:f,scale:m,resolution:m}))}else{let f=5e-4;for(let m=n-1;m>=0;m--)p.unshift(new Zd({level:m,scale:f,resolution:f})),f*=2}return new G0({dpi:96,lods:p,origin:new Ke(0,0,s),size:[i,i],spatialReference:s})}const o=Xb(s),a=t.origin?new Ke({x:t.origin.x,y:t.origin.y,spatialReference:s}):new Ke(o?{x:o.origin[0],y:o.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),l=96,c=1/(_a(s)*39.37*l),h=[];if(r)for(let p=0;p<r.length;p++){const f=r[p],m=f*c;h.push(new Zd({level:p,scale:f,resolution:m}))}else{let p=Ime(s)?512/i*5916575275917094e-7:256/i*591657527591555e-6;const f=Math.ceil(n/e);h.push(new Zd({level:0,scale:p,resolution:p*c}));for(let m=1;m<f;m++){const y=p/2**e,_=y*c;h.push(new Zd({level:m,scale:y,resolution:_})),p=y}}return new G0({dpi:l,lods:h,origin:a,size:[i,i],spatialReference:s})}constructor(t){super(t),this.dpi=96,this.format=null,this.origin=null,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:t,origin:e}=this;if(t&&e){const r=Xb(t);return t.isWrappable&&!!r&&Math.abs(r.origin[0]-e.x)<=r.dx}return!1}readOrigin(t,e){return Ke.fromJSON({spatialReference:e.spatialReference,...t})}set lods(t){let e=0,r=0;const i=[],s=this._levelToLOD={};t&&(e=-1/0,r=1/0,t.forEach(n=>{i.push(n.scale),e=n.scale>e?n.scale:e,r=n.scale<r?n.scale:r,s[n.level]=n})),this._set("scales",i),this._set("lods",t),this._initializeUpsampleLevels()}readSize(t,e){return[e.cols,e.rows]}writeSize(t,e){e.cols=t[0],e.rows=t[1]}zoomToScale(t){const e=this.scales;if(t<=0)return e[0];if(t>=e.length-1)return e[e.length-1];const r=Math.floor(t),i=r+1;return e[r]/(e[r]/e[i])**(t-r)}scaleToZoom(t){const e=this.scales,r=e.length-1;let i=0;for(;i<r;i++){const s=e[i],n=e[i+1];if(s<=t)return i;if(n===t)return i+1;if(s>t&&n<t)return i+Math.log(s/t)/Math.log(s/n)}return i}snapScale(t,e=.95){const r=this.scaleToZoom(t);return r%Math.floor(r)>=e?this.zoomToScale(Math.ceil(r)):this.zoomToScale(Math.floor(r))}tileAt(t,e,r,i){const s=this.lodAt(t);if(!s)return null;let n,o;if(typeof e=="number")n=e,o=r;else if(Pn(e.spatialReference,this.spatialReference))n=e.x,o=e.y,i=r;else{const c=rx(e,this.spatialReference);if(c==null)return null;n=c.x,o=c.y,i=r}const a=s.resolution*this.size[0],l=s.resolution*this.size[1];return i||(i=new YXe(null,0,0,0,Vt())),i.level=t,i.row=Math.floor((this.origin.y-o)/l+.001),i.col=Math.floor((n-this.origin.x)/a+.001),this.updateTileInfo(i),i}updateTileInfo(t,e=G0.ExtrapolateOptions.NONE){let r=this.lodAt(t.level);if(!r&&e===G0.ExtrapolateOptions.POWER_OF_TWO){const o=this.lods[this.lods.length-1];o.level<t.level&&(r=o)}if(!r)return;const i=t.level-r.level,s=r.resolution*this.size[0]/2**i,n=r.resolution*this.size[1]/2**i;t.id=`${t.level}/${t.row}/${t.col}`,t.extent||(t.extent=Vt()),t.extent[0]=this.origin.x+t.col*s,t.extent[1]=this.origin.y-(t.row+1)*n,t.extent[2]=t.extent[0]+s,t.extent[3]=t.extent[1]+n}upsampleTile(t){const e=this._upsampleLevels[t.level];return!(!e||e.parentLevel===-1)&&(t.level=e.parentLevel,t.row=Math.floor(t.row/e.factor+.001),t.col=Math.floor(t.col/e.factor+.001),this.updateTileInfo(t),!0)}getTileBounds(t,e){const r=this.lodAt(e.level);if(r==null)return null;const{resolution:i}=r,s=i*this.size[0],n=i*this.size[1];return t[0]=this.origin.x+e.col*s,t[1]=this.origin.y-(e.row+1)*n,t[2]=t[0]+s,t[3]=t[1]+n,t}lodAt(t){return this._levelToLOD?.[t]??null}clone(){return G0.fromJSON(this.write({}))}getOrCreateCompatible(t,e){if(this.size[0]===256&&this.size[1]===256)return t===256?this:null;const r=[],i=this.lods.length;for(let s=0;s<i;s++){const n=this.lods[s],o=n.resolution*e;r.push(new Zd({level:n.level,scale:n.scale,resolution:o}))}return new G0({size:[t,t],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:r})}_initializeUpsampleLevels(){const t=this.lods;this._upsampleLevels=[];let e=null;for(let r=0;r<t.length;r++){const i=t[r];this._upsampleLevels[i.level]={parentLevel:e?e.level:-1,factor:e?e.resolution/i.resolution:0},e=i}}};u([d({type:Number,json:{write:!0}})],ea.prototype,"compressionQuality",void 0),u([d({type:Number,json:{write:!0}})],ea.prototype,"dpi",void 0),u([d({type:String,json:{read:pse.read,write:pse.write,origins:{"web-scene":{read:!1,write:!1}}}})],ea.prototype,"format",void 0),u([d({readOnly:!0})],ea.prototype,"isWrappable",null),u([d({type:Ke,json:{write:!0}})],ea.prototype,"origin",void 0),u([Ae("origin")],ea.prototype,"readOrigin",null),u([d({type:[Zd],value:null,json:{write:!0}})],ea.prototype,"lods",null),u([d({readOnly:!0})],ea.prototype,"scales",void 0),u([d({cast:t=>Array.isArray(t)?t:typeof t=="number"?[t,t]:[256,256]})],ea.prototype,"size",void 0),u([Ae("size",["rows","cols"])],ea.prototype,"readSize",null),u([ke("size",{cols:{type:Qi},rows:{type:Qi}})],ea.prototype,"writeSize",null),u([d({type:je,json:{write:!0}})],ea.prototype,"spatialReference",void 0),ea=G0=u([P("esri.layers.support.TileInfo")],ea),function(t){var e;(e=t.ExtrapolateOptions||(t.ExtrapolateOptions={}))[e.NONE=0]="NONE",e[e.POWER_OF_TWO=1]="POWER_OF_TWO"}(ea||(ea={}));const ZD=ea,JXe=12;let gc=class _l{constructor(e){const r=_l.checkUnsupported(e);if(r!=null)throw r;const i=e;this.spatialReference=i.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=tv(this.spatialReference)||vm(this.spatialReference)||bm(this.spatialReference),this.origin=[i.origin.x,i.origin.y],this.pixelSize=i.size[0],this.dpi=i.dpi;const s=i.lods.reduce((c,h,p)=>(h.level<c.min&&(c.min=h.level,c.minIndex=p),c.max=Math.max(c.max,h.level),c),{min:1/0,minIndex:0,max:-1/0}),n=i.lods[s.minIndex],o=2**n.level;let a=n.resolution*o,l=n.scale*o;this.levels=new Array(s.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:l,tileSize:[a*i.size[0],a*i.size[1]]},a/=2,l/=2}clone(){return new _l(this.toTileInfo())}toTileInfo(){return new ZD({dpi:this.dpi,origin:new Ke({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((e,r)=>new Zd({level:r,scale:e.scale,resolution:e.resolution}))})}getExtent(e,r,i,s){const n=this.levels[e],o=n.tileSize[0],a=n.tileSize[1];s[0]=this.origin[0]+i*o,s[2]=this.origin[0]+(i+1)*o,s[3]=this.origin[1]-r*a,s[1]=this.origin[1]-(r+1)*a}convertExtentToRadians(e,r){this._isWebMercator?(r[0]=qee(e[0]),r[1]=u4(e[1]),r[2]=qee(e[2]),r[3]=u4(e[3])):this._isGCS&&(r[0]=Ft(e[0]),r[1]=Ft(e[1]),r[2]=Ft(e[2]),r[3]=Ft(e[3]))}getExtentGeometry(e,r,i,s=new ur){return this.getExtent(e,r,i,kp),s.spatialReference=this.spatialReference,s.xmin=kp[0],s.ymin=kp[1],s.xmax=kp[2],s.ymax=kp[3],s.zmin=void 0,s.zmax=void 0,s}ensureMaxLod(e){if(e==null)return!1;let r=!1;for(;this.levels.length<=e;){const i=this.levels[this.levels.length-1],s=i.resolution/2;this.levels.push({resolution:s,scale:i.scale/2,tileSize:[s*this.pixelSize,s*this.pixelSize]}),r=!0}return r}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const r=this.levels[0].scale;return e>=r?0:Math.log(r/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e){if(!(e instanceof _l)){if(_l.checkUnsupported(e))return!1;e=new _l(e)}if(!e.spatialReference.equals(this.spatialReference)||e.pixelSize!==this.pixelSize)return!1;const r=Math.min(this.levels.length,e.levels.length)-1,i=this.levels[r].resolution;let s=.5*i;return!l2(e.origin[0],this.origin[0],s)||!l2(e.origin[1],this.origin[1],s)?!1:(s=.5*i/2**r/this.pixelSize*JXe,l2(i,e.levels[r].resolution,s))}rootTilesInExtent(e,r=null,i=1/0){const s=new Array,n=this.levels[0].tileSize;if(e==null||n[0]===0||n[1]===0)return s;_l.computeRowColExtent(e,n,this.origin,kp);let o=kp[1],a=kp[3],l=kp[0],c=kp[2];const h=c-l,p=a-o;if(h*p>i){const f=Math.floor(Math.sqrt(i));p>f&&(o=o+Math.floor(.5*p)-Math.floor(.5*f),a=o+f),h>f&&(l=l+Math.floor(.5*h)-Math.floor(.5*f),c=l+f)}for(let f=o;f<a;f++)for(let m=l;m<c;m++)s.push([0,f,m]);return r!=null&&(r[0]=this.origin[0]+l*n[0],r[1]=this.origin[1]-a*n[1],r[2]=this.origin[0]+c*n[0],r[3]=this.origin[1]-o*n[1]),s}static computeRowColExtent(e,r,i,s){const n=.001*(e[2]-e[0]+(e[3]-e[1]));s[0]=Math.max(0,Math.floor((e[0]+n-i[0])/r[0])),s[2]=Math.max(0,Math.ceil((e[2]-n-i[0])/r[0])),s[1]=Math.max(0,Math.floor((i[1]-e[3]+n)/r[1])),s[3]=Math.max(0,Math.ceil((i[1]-e[1]-n)/r[1]))}static isPowerOfTwo(e){const r=e.lods,i=r[0].resolution*2**r[0].level;return!r.some(s=>!nFe(s.resolution,i/2**s.level))}static hasGapInLevels(e){const r=e.lods.map(i=>i.level);r.sort((i,s)=>i-s);for(let i=1;i<r.length;i++)if(r[i]!==r[0]+i)return!0;return!1}static tileSizeSupported(e){const r=e.size[1];return r===e.size[0]&&(r&r-1)==0&&r>=128&&r<=512}static hasOriginPerLODs(e){const r=e.origin;return e.lods.some(i=>i.origin!=null&&(i.origin[0]!==r.x||i.origin[1]!==r.y))}static getMissingTileInfoError(){return new V("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(e){return e==null?iJ():e.lods.length<1?new V("tilingscheme:generic","Tiling scheme must have at least one level"):_l.isPowerOfTwo(e)?_l.hasGapInLevels(e)?new V("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):_l.tileSizeSupported(e)?_l.hasOriginPerLODs(e)?new V("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new V("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new V("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,r){const i=e[2]-e[0],s=e[3]-e[1],n=_a(r),o=1.2*Math.max(i,s),a=256,l=96,c=.0254,h=new _l(new ZD({size:[a,a],origin:new Ke({x:e[0]-.5*(o-i),y:e[3]+.5*(o-s)}),lods:[new Zd({level:0,resolution:o/a,scale:1/(a/l*c/(o*n))})],spatialReference:r}));return h.ensureMaxLod(20),h}static makeWebMercatorAuxiliarySphere(e){const r=new _l(_l.WebMercatorAuxiliarySphereTileInfo);return r.ensureMaxLod(e),r}static makeGCSWithTileSize(e,r=256,i=16){const s=256/r,n=new _l(new ZD({size:[r,r],origin:new Ke({x:-180,y:90,spatialReference:e}),spatialReference:e,lods:[new Zd({level:0,resolution:.703125*s,scale:295497598570834e-6*s})]}));return n.ensureMaxLod(i),n}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}};function iJ(){return new V("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}gc.WebMercatorAuxiliarySphereTileInfo=new ZD({size:[256,256],origin:new Ke({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:je.WebMercator}),spatialReference:je.WebMercator,lods:[new Zd({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),gc.WebMercatorAuxiliarySphere=gc.makeWebMercatorAuxiliarySphere(19);const kp=Vt(),zS=64,O3=512,QXe=2.5,NR=oFe(nB/10),hxe=2,dxe=Vt();gc.WebMercatorAuxiliarySphere.getExtent(0,0,0,dxe);const KXe=Vt([-180,-90,180,90]),eZe="Cannot extend surface to encompass all layers because it would result in too many root tiles.",tZe="Surface extent is too large for tile resolution at level 0.",rZe=3;let iZe=rZe;function Hj(t){return t<4?3:iZe}let j0=class extends ws.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=NR}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if(e==null||e.extent==null||e.spatialReference==null)return null;const r=Q5(e.extent,e.spatialReference);return r.zmin=e.visibleElevationBounds.min,r.zmax=e.visibleElevationBounds.max,r}get spatialReference(){return this.view.basemapTerrain?.spatialReference??je.WGS84}elevationAt(e,r){if(this.extent==null||!Ga(this.extent,e,r)){const i=this.extent!=null?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return Q.getLogger(this).warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler extent (${i})`),this.noDataValue}return this.view.elevationProvider?.getElevation(e,r,0,this.spatialReference,"ground")??this.noDataValue}queryElevation(e){return cxe(e.clone(),this)}};u([d({readOnly:!0})],j0.prototype,"demResolution",void 0),u([d({readOnly:!0})],j0.prototype,"extent",null),u([d({readOnly:!0})],j0.prototype,"noDataValue",void 0),u([d()],j0.prototype,"spatialReference",null),u([d({constructOnly:!0})],j0.prototype,"view",void 0),j0=u([P("esri.views.support.GroundViewElevationSampler")],j0);const sZe=j0;let H0=class extends we{constructor(e){super(e),this.view=null,this.layerViews=new Pt}initialize(){this.addHandles(Cu(()=>this.view?.map?.ground,e=>e.load())),this.addHandles(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this.removeAllHandles(),this._set("view",null);for(const e of this.layerViews)e.destroy();this.layerViews.length=0}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new sZe({view:this.view}):null:null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.removeHandles("updating"),this.addHandles(this.layerViews.map(e=>ae(()=>e.updating,()=>this._updateUpdating(),qr)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};u([d({readOnly:!0})],H0.prototype,"elevationSampler",null),u([d({type:Boolean,readOnly:!0})],H0.prototype,"updating",null),u([d({constructOnly:!0})],H0.prototype,"view",void 0),u([d({type:Pt,readOnly:!0})],H0.prototype,"layerViews",void 0),u([d({readOnly:!0})],H0.prototype,"suspended",null),H0=u([P("esri.views.GroundView")],H0);const nZe=H0;let fy=class{constructor(e,r){this._owner=r,this._properties={},this._afterDispatchHandle=null;for(const i in e){const s=e[i],n=new $fe(s,void 0,void 0,2,2);this._properties[i]={pool:n,acquired:[]}}this._afterDispatchHandle=Hfe(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const e in this._properties){const r=this._properties[e];for(const i of r.acquired)wee(i)||r.pool.release(i);r.pool.destroy(),r.pool=null,r.acquired=null}this._properties=null,this._owner=null}get(e){const r=this._owner._get(e),i=this._properties[e];let s=i.pool.acquire();for(i.acquired.push(s);s===r;)i.acquired.push(s),s=i.pool.acquire();return s}_release(){for(const e in this._properties){const r=this._properties[e];let i=0;for(const s of r.acquired)wee(s)?r.acquired[i++]=s:r.pool.release(s);r.acquired.length=i}}};const oZe=oe("mac")?"Meta":"Ctrl",Q6={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let t=48;t<58;t++)Q6[t]=String.fromCharCode(t);for(let t=1;t<25;t++)Q6[111+t]=`F${t}`;for(let t=65;t<91;t++)Q6[t]=[String.fromCharCode(t+32),String.fromCharCode(t)];function aZe(t){if(t.key!==void 0)return VL(t);const e=Q6[t.keyCode];return Array.isArray(e)?t.shiftKey?e[1]:e[0]:e}function lZe(t){switch(t){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}let cZe=class{constructor(e,r=[]){this.eventType=e,this.keyModifiers=r}matches(e){if(e.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const r=e.modifiers;for(const i of this.keyModifiers)if(!r.has(i))return!1;return!0}};const fse=Q.getLogger("esri.views.input.InputHandler");let Co=class{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const r=this._incoming[e];for(const i of r)this._incomingEventMatches.push(i.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(e=>e.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager?fse.error("This InputHandler has already been registered with an InputManager"):(e.setEventCallback(r=>this._handleEvent(r)),e.setUninstallCallback(()=>this._onUninstall()),this._manager=e)}onUninstall(){}registerIncoming(e,r,i){let s;typeof r=="function"?(i=r,s=[]):s=r||[];const n=typeof e=="string"?new cZe(e,s):e,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=h=>{const p=this._incoming[h.match.eventType];if(p){const f=p.indexOf(h);p.splice(f,1),o(),this._manager&&this._manager.updateDependencies()}},l=new uZe(n,i,{onPause:a,onRemove:a,onResume:h=>{const p=this._incoming[h.match.eventType];p&&!p.includes(h)&&(p.push(h),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[n.eventType];return c||(c=[],this._incoming[n.eventType]=c),c.push(l),o(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(e){if(this._outgoing[e])throw new Error("There is already a callback registered for this outgoing InputEvent: "+e);const r=new hZe(e,{onEmit:(i,s,n,o)=>{this._manager?.emit(i.eventType,s,n,o)},onRemove:i=>{delete this._outgoing[i.eventType],this._manager?.updateDependencies()}});return this._outgoing[e]=r,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),r}startCapturingPointer(e){this._manager?.setPointerCapture(e,!0)}stopCapturingPointer(e){this._manager?.setPointerCapture(e,!1)}refreshHasPendingInputs(){this._manager?.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):fse.error("This InputHandler is not registered with an InputManager")}_handleEvent(e){const r=this._incoming[e.type];if(r){for(const i of r)if(i.match.matches(e)&&(i.callback?.(e),e.shouldStopPropagation()))break}}},uZe=class{constructor(e,r,i){this.match=e,this._callback=r,this._handler=i}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}},hZe=class{constructor(e,r){this.eventType=e,this._removed=!1,this._handler=r}emit(e,r,i){this._removed||this._handler.onEmit(this,e,r,i)}remove(){this._removed=!0,this._handler.onRemove(this)}},dZe=class extends Co{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",r=>{this._update(r.data)})}_update(e){const r=e.native.pointerType==="touch"?"touch":"mouse",{x:i,y:s}=e;r===this._value&&this._x===i&&this._y===s||(this._value=r,this._x=i,this._y=s,this._onChange(r,i,s))}},pZe=class{constructor(e,r){this._observable=new V5,this._value=e,this._equalityFunction=r}get value(){return Wt(this._observable),this._value}set value(e){this._equalityFunction(e,this._value)||(this._value=e,this._observable.notify())}mutate(e){e(this._value),this._observable.notify()}};function FR(t,e=yfe){return new pZe(t,e)}let fZe=class extends Co{get multiTouchActive(){return this._multiTouchActive.value}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=FR(!1),this._onPointerAdd=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.add(e.native.pointerId),this._update())},this._onPointerRemove=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.delete(e.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.value=this._activeTouchPointerIds.size>1}},rh=class extends we{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=oZe,this._latestPointerType="mouse",this._propertiesPool=new fy({latestPointerLocation:yZe},this),this.latestPointerLocation=null,this._paused=!1,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const r of e)this.uninstallHandlers(r);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}get updating(){return this.hasPendingInputs||this._paused}installHandlers(e,r,i=B_.INTERNAL){if(this._nameToGroup[e])return void Q.getLogger(this).error("There is already an InputHandler group registered under the name `"+e+"`");if(r.length===0)return void Q.getLogger(this).error("Can't register a group of zero handlers");const s={name:e,handlers:r.map(n=>({handler:n,active:!0,removed:!1,priorityIndex:0,groupPriority:i,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=s;for(let n=s.handlers.length-1;n>=0;n--){const o=s.handlers[n];this._handlers.push(o),o.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(a,l,c,h,p)=>{this._emitInputEvent(o.priorityIndex+1,a,l,c,p,h)},setPointerCapture:(a,l)=>{this._setPointerCapture(s,o,a,l)},setEventCallback:a=>{o.eventCallback=a},setUninstallCallback:a=>{o.uninstallCallback=a},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const r=this._nameToGroup[e];r?(r.handlers.forEach(i=>{i.removed=!0,i.uninstallCallback?.()}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):Q.getLogger(this).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,r=new Set;this._handlersPriority=[];for(let i=this._handlers.length-1;i>=0;i--){const s=this._handlers[i];s.priorityIndex=i,this._handlersPriority.push(s)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let i=this._handlersPriority.length-1;i>=0;i--){const s=this._handlersPriority[i];s.priorityIndex=i;let n=s.handler.hasSideEffects;if(!n){for(const o of s.handler.outgoingEventTypes)if(e.has(o)){n=!0;break}}if(n)for(const o of s.handler.incomingEventMatches){e.add(o.eventType);for(const a of o.keyModifiers)lZe(a)||r.add(a)}s.active=n}this._sourceEvents=e,this._keyModifiers=r,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,r,i){this._latestPointerType=e;const s=this._get("latestPointerLocation");if(s==null||s.x!==r||s.y!==i){const n=this._propertiesPool.get("latestPointerLocation");n.x=r,n.y=i,this._set("latestPointerLocation",n)}}_onEventReceived(e,r){if(e==="pointer-capture-lost"){const n=r;this._pointerCaptures.delete(n.native.pointerId)}this._updateKeyModifiers(e,r);const i=this.test.timestamp!=null?this.test.timestamp:r.native?r.native.timestamp:void 0,s=r.native?r.native.cancelable:void 0;this._emitInputEventFromSource(e,r,i,s)}_updateKeyModifiers(e,r){if(!r)return;let i=!1;const s=()=>{if(!i){const a=new Set;this._activeKeyModifiers.forEach(l=>{a.add(l)}),this._activeKeyModifiers=a,i=!0}},n=(a,l)=>{l&&!this._activeKeyModifiers.has(a)?(s(),this._activeKeyModifiers.add(a)):!l&&this._activeKeyModifiers.has(a)&&(s(),this._activeKeyModifiers.delete(a))};if(e==="key-down"||e==="key-up"){const a=r.key;this._keyModifiers.has(a)&&n(a,e==="key-down")}const o=r.native;n("Alt",!(!o||!o.altKey)),n("Ctrl",!(!o||!o.ctrlKey)),n("Shift",!(!o||!o.shiftKey)),n("Meta",!(!o||!o.metaKey)),n("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new dZe((e,r,i)=>this._setLatestPointer(e,r,i)),this._multiTouchHandler=new fZe,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],B_.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,B_.INTERNAL)}_setPointerCapture(e,r,i,s){const n=e.name+"-"+r.priorityIndex,o=this._pointerCaptures.get(i.pointerId)||new Set;this._pointerCaptures.set(i.pointerId,o),s?(o.add(n),o.size===1&&this.eventSource&&this.eventSource.setPointerCapture(i,!0)):o.has(n)&&(o.delete(n),o.size===0&&(this._pointerCaptures.delete(i.pointerId),this.eventSource&&this.eventSource.setPointerCapture(i,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,r,i,s){this._emitInputEvent(0,e,r,i,s)}_emitInputEvent(e,r,i,s,n,o){const a=s!==void 0?s:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),l=n!==void 0&&n,c={event:new mZe(r,i,a,o||this._activeKeyModifiers,l),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(c):this._doNewPropagation(c)}_doNewPropagation(e){this._currentPropagation={events:new T7,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){this._paused=!1;const e=this._currentPropagation;if(e){for(;e.events.length>0;){const{event:r,priorityIndex:i}=e.events.pop(),s=r.data&&r.data.eventId;if(!(s!=null&&this._stoppedPropagationEventIds.has(s)))for(e.currentHandler=this._handlersPriority[i];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!r.shouldStopPropagation()&&e.currentHandler.eventCallback?.(r),r.shouldStopPropagation()){s!=null&&this._stoppedPropagationEventIds.add(s);break}if(r.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:r,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const r=new T7;r.push(e);const i=this._currentPropagation;if(i){for(;i.events.length;)r.push(i.events.pop());i.events=r,i.currentHandler=null,this._paused=!0}}_compareHandlerPriority(e,r){if(e.handler.hasSideEffects!==r.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==r.groupPriority)return e.groupPriority>r.groupPriority?-1:1;for(const i of e.handler.incomingEventMatches)for(const s of r.handler.incomingEventMatches){if(i.eventType!==s.eventType)continue;const n=i.keyModifiers.filter(o=>s.keyModifiers.includes(o));if(n.length===i.keyModifiers.length!=(n.length===s.keyModifiers.length))return i.keyModifiers.length>s.keyModifiers.length?-1:1}return e.priorityIndex>r.priorityIndex?-1:1}_sortHandlersPriority(e){const r=[];for(const i of e){let s=0;for(;s<r.length&&this._compareHandlerPriority(i,r[s])>=0;)s++;r.splice(s,0,i)}return r}get debug(){const e=r=>{const i=this._setPointerCapture;this._setPointerCapture=()=>{},r(),this._setPointerCapture=i};return{injectEvent:(r,i)=>{e(()=>{this._onEventReceived(r,i)})},disablePointerCapture:e}}};u([d({readOnly:!0})],rh.prototype,"hasPendingInputs",null),u([d({constructOnly:!0})],rh.prototype,"eventSource",void 0),u([d({constructOnly:!0})],rh.prototype,"recognizers",void 0),u([d()],rh.prototype,"_latestPointerType",void 0),u([d()],rh.prototype,"latestPointerType",null),u([d()],rh.prototype,"multiTouchActive",null),u([d({readOnly:!0})],rh.prototype,"latestPointerLocation",void 0),u([d()],rh.prototype,"_paused",void 0),u([d({readOnly:!0})],rh.prototype,"updating",null),rh=u([P("esri.views.input.InputManager")],rh);let mZe=class{constructor(e,r,i,s,n){this.type=e,this.data=r,this.timestamp=i,this.modifiers=s,this.cancelable=n,this._propagationState=a_.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=a_.STOPPED}shouldStopPropagation(){return(this._propagationState&a_.STOPPED)!=0}async(e){this._propagationState|=a_.PAUSED;const r=(i,s)=>{this._propagationState&=~a_.PAUSED;const n=this._resumeCallback;if(this._resumeCallback=null,n&&n(),s)throw i;return i};return(typeof e=="function"?e():e).then(i=>r(i,!1),i=>r(i,!0))}shouldPausePropagation(e){return!!(this._propagationState&a_.PAUSED)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}};var a_;(function(t){t[t.NONE=0]="NONE",t[t.STOPPED=1]="STOPPED",t[t.PAUSED=2]="PAUSED"})(a_||(a_={}));const B_={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};let gZe=class{};const yZe=gZe;function zp(t){return t!=null&&"open"in t&&"declaredClass"in t}function mse(t){return t!=null&&"declaredClass"in t&&"dockOptions"in t}const _Ze=t=>{let e=class extends t{constructor(){super(...arguments),this._popupSetupTask=null,this.popup={},this.popupEnabled=!0}initialize(){this.addHandles([ae(()=>[this.ui,this.popup],([r,i],s)=>{const n="popup",o="manual";if(s){const[a,l]=s;a&&zp(l)&&(l.view=null,mse(l)&&a.remove(l,n))}r&&zp(i)&&(i.view=this,mse(i)&&r.add(i,{key:n,position:o,internal:!0}))},Pr),this.on("click",r=>{this.popup&&this.popupEnabled&&(r.pointerType!=="mouse"||r.button===0)&&(!zp(this.popup)&&"autoOpenEnabled"in this.popup&&this.popup.autoOpenEnabled===!1||(zp(this.popup)?this.popup.viewModel.handleViewClick(r):r.async(async()=>{await this.setupPopup(),zp(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(r)})))},B_.WIDGET)]),ay(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{ce(()=>import("./Popup-2f181d7d.js").then(r=>r.a0),["./Popup-2f181d7d.js","./unitFormatUtils-092d1121.js","./AttachmentInfo-33825618.js","./widget-22301485.js","./executeQueryJSON-cda20e09.js","./query-226efcbe.js","./normalizeUtils-30f603dc.js","./normalizeUtilsCommon-d91de345.js","./pbfQueryUtils-dc012b8b.js","./pbf-62deeddb.js"],import.meta.url)})}destroy(){this.destroyed||this.closePopup()}async openPopup(r){zp(this.popup)&&this.popup.open(r);try{if(await this.setupPopup(),!this.popup)return void Q.getLogger(this).error(new V("view:null-popup","Popup is null and can't be opened"));this.popup.open(r)}catch{}}closePopup(){this._popupSetupTask?.abort(),zp(this.popup)&&this.popup.close()}async fetchPopupFeatures(r,i){await this.when();const{location:s,queryArea:n,layerViewsAndGraphics:o,clientOnlyGraphics:a}=await this._prepareFetchPopupFeatures(r,i),l=Promise.resolve(a),c=this._queryLayerPopupFeatures(n,o,i),h=c.map(p=>p.promise);return{location:s,clientOnlyGraphics:a,allGraphicsPromise:RV([l,...h]).then(p=>Array.from(new Set(p.flat()))),promisesPerLayerView:c}}async setupPopup(){if(this._popupSetupTask?.abort(),this.popup&&!zp(this.popup))return this._popupSetupTask=jE(async r=>{const{default:i}=await ce(()=>import("./Popup-2f181d7d.js").then(n=>n.a0),["./Popup-2f181d7d.js","./unitFormatUtils-092d1121.js","./AttachmentInfo-33825618.js","./widget-22301485.js","./executeQueryJSON-cda20e09.js","./query-226efcbe.js","./normalizeUtils-30f603dc.js","./normalizeUtilsCommon-d91de345.js","./pbfQueryUtils-dc012b8b.js","./pbf-62deeddb.js"],import.meta.url);if(Yt(r),!this.popup||zp(this.popup))return;const s=this.popup;delete s.open,delete s.close,this.popup=new i(s)}),this._popupSetupTask.promise}_queryLayerPopupFeatures(r,i,s){return i.map(({layerView:n,graphics:o})=>{const a={clientGraphics:o,event:s?.event,signal:s?.signal,defaultPopupTemplateEnabled:s!=null&&!!s.defaultPopupTemplateEnabled},l=n.fetchPopupFeatures(r,a);return{layerView:n,promise:l}})}_isValidPopupGraphic(r,i){return r&&!!r.getEffectivePopupTemplate(i!=null&&i.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(r,i){const{clientGraphics:s,queryArea:n,location:o}=await this._popupHitTestGraphics(r,i),a=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:l,clientOnlyGraphics:c}=this._graphicsPerFetchPopupLayerView(s,a);return{clientOnlyGraphics:c,layerViewsAndGraphics:l,queryArea:n,location:o}}async _popupHitTestGraphics(r,i){const s=await this.popupHitTest(r),n=s.results,o=s.mapPoint,a=n.filter(c=>c.type==="graphic"&&this._isValidPopupGraphic(c.graphic,i)),l=a.length?a[0].mapPoint:null;return{clientGraphics:a.map(c=>c.graphic),queryArea:o,location:o||l}}_getFetchPopupLayerViews(){const r=[];return this.allLayerViews.forEach(i=>{this._isValidPopupLayerView(i)&&r.push(i)}),this.graphicsView!=null&&this._isValidPopupLayerView(this.graphicsView)&&r.push(this.graphicsView),r.reverse()}_isValidPopupLayerView(r){return r!=null&&(!("layer"in r)||!r.suspended)&&"fetchPopupFeatures"in r}_graphicsPerFetchPopupLayerView(r,i){const s=[],n=new Map,o=i.map(a=>{const l=[];return"layer"in a?n.set(a.layer,l):n.set(a.graphics,l),{layerView:a,graphics:l}});for(const a of r){const l=n.get(a.layer)||n.get(a.sourceLayer)||null;l?l.push(a):s.push(a)}return{layerViewsAndGraphics:o,clientOnlyGraphics:s}}};return u([d({cast(r){return!r||zp(r)||typeof r=="object"&&(r.open=i=>(s4(Q.getLogger(this),"view.popup is no longer created by default. view.popup.open() will stop working when the popup isn't created",{replacement:"Use view.openPopup() instead.",version:"4.27"}),this.openPopup(i)),r.close=()=>(s4(Q.getLogger(this),"view.popup is no longer created by default. view.popup.close() will stop working when the popup isn't created",{replacement:"Use view.closePopup() instead.",version:"4.27"}),this.closePopup())),r}})],e.prototype,"popup",void 0),u([d()],e.prototype,"popupEnabled",void 0),e=u([P("esri.views.PopupView")],e),e};let NO=class extends DO{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};u([gX({Type:Nl,ensureType:vs(Nl)})],NO.prototype,"itemType",void 0),NO=u([P("esri.support.GraphicsCollection")],NO);let q0=class extends we{constructor(e){super(e),this.view=null,this.baseLayerViews=new Pt,this.referenceLayerViews=new Pt,this._loadingHandle=ae(()=>this.view?.map?.basemap,r=>{r&&r.load().catch(()=>{})},Pr)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null);for(const e of this.baseLayerViews)e.destroy();this.baseLayerViews.length=0;for(const e of this.referenceLayerViews)e.destroy();this.referenceLayerViews.length=0}get suspended(){return!this.view||this.view.suspended}get updating(){if(this.view&&this.view.suspended)return!1;const e=this.view?.map?.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(r=>r.updating)||this.referenceLayerViews.some(r=>r.updating))}};u([d({constructOnly:!0})],q0.prototype,"view",void 0),u([d({readOnly:!0})],q0.prototype,"baseLayerViews",void 0),u([d({readOnly:!0})],q0.prototype,"referenceLayerViews",void 0),u([d({readOnly:!0})],q0.prototype,"suspended",null),u([d({type:Boolean,readOnly:!0})],q0.prototype,"updating",null),q0=u([P("esri.views.BasemapView")],q0);function vZe(t){return"tryRecycleWith"in t}let bZe=class{constructor(e,r,i){this.layer=e,this.view=r,this.layerViewImporter=i,this._controller=new AbortController,this._deferred=xo(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,da(this._controller.signal,()=>{const s=new V("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(s)})}tryRecycle(e){if(!this.done||!this.layerView||!vZe(this.layerView))return null;const r=this.layer.type,i=this._controller.signal;for(let s=0;s<e.length;s++){const n=e[s];if(n.type!==r)continue;const o=this.layerView.tryRecycleWith(n,{signal:i});if(o){e.splice(s,1),this.layer=n;const a=this.layerView,l=a.view;return this.promise=Promise.race([o.then(()=>(Yt(this._controller.signal),n.emit("layerview-destroy",{view:l,layerView:a}),l.emit("layerview-destroy",{view:l,layerView:a}),n.emit("layerview-create",{view:l,layerView:a}),l.emit("layerview-create",{view:l,layerView:a}),a)),new Promise((c,h)=>da(this._controller.signal,()=>h(kr())))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:e}=this;if(e){const{layer:r,view:i}=this;r.emit("layerview-destroy",{view:i,layerView:e}),i.emit("layerview-destroy",{layer:r,layerView:e})}this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null,this._map=null}async start(){if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:r,view:i}=this;this._map=i.map;try{let s,n;if(await r.load({signal:e}),"prefetchResources"in r&&await r.prefetchResources?.({signal:e}),xZe(r))s=await r.createLayerView(i,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(r))throw new V("layer:view-not-supported","No layerview implementation was found");const l=await this.layerViewImporter.importLayerView(r);Yt(e),s="default"in l?new l.default({layer:r,view:i}):new l({layer:r,view:i})}const o=()=>{n=Ni(n),s.destroyed||s.destroy(),s.layer=null,s.parent=null,s.view=null,this.done=!0};n=da(e,o),Yt(e);try{await s.when()}catch(l){throw o(),l}if(!this._map?.allLayers?.includes(r))return o(),void this._deferred.reject(new V("view:no-layerview-for-layer","The layer has been removed from the map",{layer:r}));this.layerView=s,r.emit("layerview-create",{view:i,layerView:s}),i.emit("layerview-create",{layer:r,layerView:s}),this.done=!0,this._deferred.resolve(s)}catch(s){r.emit("layerview-create-error",{view:i,error:s}),i.emit("layerview-create-error",{layer:r,error:s}),this.done=!0,this._deferred.reject(new V("layerview:create-error","layerview creation failed",{layer:r,error:s}))}}},ih=class extends we{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new Xf,this.supportsGround=!0,this._preloadLayerViewModules=()=>{const r=this.view.map?.allLayers;if(r)for(const i of r)this.layerViewImporter.hasLayerViewModule(i)&&this.layerViewImporter.importLayerView(i)},this._reschedule=()=>this.destroyed?Promise.reject():(this._workPromise==null&&(this._workPromise=xo(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(VE(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{if(this.destroyed)return;const r=this.view.map;if(this._map!==r&&(this.clear(),this._map=r),this._workPromise==null)return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const i=new Set,s=[],n=this.view.ready,o=l=>{if(l!=null){for(const c of l)if(c){i.add(c);const h=this._layerLayerViewInfoMap.get(c);h&&n?h.start():h||this._recyclingInfoMap.has(c)||s.push(c),"layers"in c&&c.layers&&o(c.layers)}}};for(const l of this._rootCollectionNames)o(this.get(l));for(const[l,c]of this._layerLayerViewInfoMap)if(!i.has(l)){this._layerLayerViewInfoMap.delete(c.layer);const h=c.tryRecycle(s);h?(this.notifyChange("updating"),this._recyclingInfoMap.set(c.layer,c),h.then(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(c.layer),this._layerLayerViewInfoMap.set(c.layer,c),this._reschedule()}).catch(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(c.layer),c.destroy(),this._reschedule()})):c.destroy()}for(const[l,c]of this._recyclingInfoMap)i.has(l)||(this.notifyChange("updating"),this._recyclingInfoMap.delete(c.layer),c.destroy());for(const l of s)this._createLayerView(l);this._refreshCollections();const a=[r?.ground?.layers,r?.basemap?.baseLayers,r?.basemap?.referenceLayers,r?.layers].filter(l=>!!l);i.forEach(l=>"layers"in l&&a.push(l.layers)),this.addHandles(a.map(l=>this._watchUpdatingTracking.addOnCollectionChange(()=>l,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.own([fa(()=>this.view?.map?.allLayers,"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),ae(()=>{const e=this.view,r=e?.map;return[r?.basemap,r?.ground,r?.layers,e?.ready]},()=>this._reschedule(),Is)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),E8(this._recyclingInfoMap),E8(this._layerLayerViewInfoMap),this._watchUpdatingTracking.destroy(),this._map=null,this._workPromise!=null&&(this._workPromise.reject(kr()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return this._workPromise!=null||this._watchUpdatingTracking.updating||ko(this._layerLayerViewInfoMap,e=>!e.done)||this._recyclingInfoMap.size>0}get updatingRemaining(){let e=0;for(const r of this._layerLayerViewInfoMap.values())r.done||++e;return e}clear(){this.destroyed||(E8(this._layerLayerViewInfoMap),this._refreshCollections())}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new V("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,r]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(e),this.get(r),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,r,i){if(!e||!r)return void(r&&r.removeAll());let s=0;for(const n of e){const o=this._layerLayerViewInfoMap.get(n);if(!o||!o.layerView)continue;const a=o.layerView;a.layer=n,a.parent=i,r.at(s)!==a&&r.splice(s,0,a),n.layers&&this._populateLayerViewsOwners(n.layers,a.layerViews,a),s+=1}s<r.length&&r.splice(s,r.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const r=new bZe(e,this.view,this.layerViewImporter);r.promise.then(()=>this._refreshCollections(),i=>{i&&(us(i)||i.name==="cancelled:layerview-create")||Q.getLogger(this).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:i}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,r),this.view.ready&&r.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};u([d()],ih.prototype,"_workPromise",void 0),u([d({readOnly:!0})],ih.prototype,"_watchUpdatingTracking",void 0),u([d({readOnly:!0})],ih.prototype,"_layersToLayerViews",null),u([d({readOnly:!0})],ih.prototype,"_rootCollectionNames",null),u([d()],ih.prototype,"layerViewImporter",void 0),u([d()],ih.prototype,"supportsGround",void 0),u([d({readOnly:!0})],ih.prototype,"updating",null),u([d({readOnly:!0})],ih.prototype,"updatingRemaining",null),u([d({constructOnly:!0})],ih.prototype,"view",void 0),ih=u([P("esri.views.LayerViewManager")],ih);const wZe=ih;function xZe(t){return"createLayerView"in t&&t.createLayerView!=null}let Zc=class extends we{constructor(e){super(e),this.factor=1.5,this.offset=kh(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};u([d({type:Number})],Zc.prototype,"factor",void 0),u([d({nonNullable:!0})],Zc.prototype,"offset",void 0),u([d()],Zc.prototype,"position",void 0),u([d({type:Number,range:{min:0}})],Zc.prototype,"size",void 0),u([d()],Zc.prototype,"maskUrl",void 0),u([d()],Zc.prototype,"maskEnabled",void 0),u([d()],Zc.prototype,"overlayUrl",void 0),u([d()],Zc.prototype,"overlayEnabled",void 0),u([d({readOnly:!0})],Zc.prototype,"version",null),u([d({type:Boolean})],Zc.prototype,"visible",void 0),Zc=u([P("esri.views.Magnifier")],Zc);const pxe=Zc;let TZe=class{constructor(){this._tasks=new Array,this._running=FR(!1)}get length(){return this._tasks.length}get running(){return this._running.value}destroy(){this.cancelAll()}runTask(e){for(;!e.done&&this._process(e);)e.madeProgress()}push(e,r,i){return this._running.value=!0,new Promise((s,n)=>this._tasks.push(new gse(s,n,e,r,i)))}unshift(e,r,i){return this._running.value=!0,new Promise((s,n)=>this._tasks.unshift(new gse(s,n,e,r,i)))}_process(e){if(this._tasks.length===0)return!1;const r=this._tasks.shift();try{const i=An(r.signal);if(i&&!r.abortCallback)r.reject(kr());else{const s=i?r.abortCallback?.(kr()):r.callback(e);Iu(s)?s.then(r.resolve,r.reject):r.resolve(s)}}catch(i){r.reject(i)}return this._running.value=this._tasks.length>0,!0}cancelAll(){const e=kr();for(const r of this._tasks)if(r.abortCallback){const i=r.abortCallback(e);r.resolve(i)}else r.reject(e);this._tasks.length=0,this._running.value=!1}},gse=class{constructor(e,r,i,s=void 0,n=void 0){this.resolve=e,this.reject=r,this.callback=i,this.signal=s,this.abortCallback=n}},R3=class extends we{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};u([d()],R3.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),u([d()],R3.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),R3=u([P("esri.views.support.DebugFlags")],R3);const SZe=new R3;var Fr;(function(t){t[t.ANIMATING=0]="ANIMATING",t[t.INTERACTING=1]="INTERACTING",t[t.IDLE=2]="IDLE"})(Fr||(Fr={}));function EZe(){return new Q4.Scheduler}var Wo,vt;(function(t){t[t.YIELD=1]="YIELD"})(Wo||(Wo={})),function(t){t.RESOURCE_CONTROLLER_IMMEDIATE="immediate",t.RESOURCE_CONTROLLER="schedule",t.SLIDE="slide",t.STREAM_DATA_LOADER="stream loader",t.ELEVATION_QUERY="elevation query",t.TERRAIN_SURFACE="terrain",t.SURFACE_GEOMETRY_UPDATES="surface geometry updates",t.LOD_RENDERER="LoD renderer",t.GRAPHICS_CORE="Graphics3D",t.I3S_CONTROLLER="I3S",t.POINT_CLOUD_LAYER="point cloud",t.FEATURE_TILE_FETCHER="feature fetcher",t.OVERLAY="overlay",t.STAGE="stage",t.GRAPHICS_DECONFLICTOR="graphics deconflictor",t.FILTER_VISIBILITY="Graphics3D filter visibility",t.SCALE_VISIBILITY="Graphics3D scale visibility",t.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",t.POINT_OF_INTEREST_FREQUENT="POI frequent",t.POINT_OF_INTEREST_INFREQUENT="POI infrequent",t.LABELER="labeler",t.FEATURE_QUERY_ENGINE="feature query",t.FEATURE_TILE_TREE="feature tile tree",t.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",t.ELEVATION_ALIGNMENT="elevation alignment",t.TEXT_TEXTURE_ATLAS="text texture atlas",t.TEXTURE_UNLOAD="texture unload",t.LINE_OF_SIGHT_TOOL="line of sight tool",t.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",t.ELEVATION_PROFILE="elevation profile",t.SNAPPING="snapping",t.SHADOW_ACCUMULATOR="shadow accumulator",t.CLOUDS_GENERATOR="clouds generator",t[t.NONE=0]="NONE",t[t.TEST_PRIO=1]="TEST_PRIO"}(vt||(vt={}));const Af=0,yse=new Map([[vt.RESOURCE_CONTROLLER_IMMEDIATE,Af],[vt.RESOURCE_CONTROLLER,4],[vt.SLIDE,Af],[vt.STREAM_DATA_LOADER,Af],[vt.ELEVATION_QUERY,Af],[vt.TERRAIN_SURFACE,1],[vt.SURFACE_GEOMETRY_UPDATES,1],[vt.LOD_RENDERER,2],[vt.GRAPHICS_CORE,2],[vt.I3S_CONTROLLER,2],[vt.POINT_CLOUD_LAYER,2],[vt.FEATURE_TILE_FETCHER,2],[vt.OVERLAY,4],[vt.STAGE,4],[vt.GRAPHICS_DECONFLICTOR,4],[vt.FILTER_VISIBILITY,4],[vt.SCALE_VISIBILITY,4],[vt.FRUSTUM_VISIBILITY,4],[vt.CLOUDS_GENERATOR,4],[vt.POINT_OF_INTEREST_FREQUENT,6],[vt.POINT_OF_INTEREST_INFREQUENT,30],[vt.LABELER,8],[vt.FEATURE_QUERY_ENGINE,8],[vt.FEATURE_TILE_TREE,16],[vt.FEATURE_TILE_TREE_ACTIVE,Af],[vt.ELEVATION_ALIGNMENT,12],[vt.TEXT_TEXTURE_ATLAS,12],[vt.TEXTURE_UNLOAD,12],[vt.LINE_OF_SIGHT_TOOL,16],[vt.LINE_OF_SIGHT_TOOL_INTERACTIVE,Af],[vt.SNAPPING,Af],[vt.SHADOW_ACCUMULATOR,30]]);function _se(t){return yse.has(t)?yse.get(t):typeof t=="number"?t:1}const vse=6.5,bse=1,CZe=30,wse=1e3/30,xse=100,Tse=.9;var Q4,zv;(function(t){class e{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(n=>n.needsUpdate)}constructor(){this._updating=FR(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new Ug("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new i,this._state=Fr.INTERACTING,this._tasks=new Bt,this._runQueue=new Bt,this._load=0,this._idleStateCallbacks=new Bt,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=ae(()=>SZe.SCHEDULER_LOG_SLOW_TASKS,o=>this._debug=o,Pr);for(const o of Object.keys(vt))this.performanceInfo.tasks.set(vt[o],new Ug(vt[o]));const n=this;this._test={FRAME_SAFETY_BUDGET:vse,INTERACTING_BUDGET:wse,IDLE_BUDGET:xse,get availableBudget(){return n._budget.budget},usedBudget:0,getBudget:()=>n._budget,setBudget:o=>n._budget=o,updateTask:o=>this._updateTask(o),getState:o=>this._getState(o),getRuntime:o=>this._getRuntime(o),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(n=>n.remove()),this._tasks.clear(),Ni(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(n){this._updatingChanged(),n&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())}))}registerTask(n,o){const a=_se(n),l=new r(this,n,o,a);return this._tasks.push(l),this._updatingChanged(),this.performanceInfo.tasks.has(n)||this.performanceInfo.tasks.set(n,new Ug(n)),l}registerIdleStateCallbacks(n,o){const a={idleBegin:n,idleEnd:o};this._idleStateCallbacks.push(a),this.state===Fr.IDLE&&this._idleUpdatesStartFired&&a.idleBegin();const l=this;return{remove:()=>this._removeIdleStateCallbacks(a),set idleBegin(c){l._idleUpdatesStartFired&&(a.idleEnd(),l._state===Fr.IDLE&&c()),a.idleBegin=c},set idleEnd(c){a.idleEnd=c}}}get load(){return this._load}set state(n){this._state!==n&&(this._state=n,this.state!==Fr.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(o=>o.idleEnd())))}get state(){return this._state}updateBudget(n){this._test.usedBudget=0,++this._frameNumber;let o=vse,a=n.frameDuration,l=bse;switch(this.state){case Fr.IDLE:o=0,a=Math.max(xse,n.frameDuration),l=CZe;break;case Fr.INTERACTING:a=Math.max(wse,n.frameDuration);case Fr.ANIMATING:}return a=a-n.elapsedFrameTime-o,this.state!==Fr.IDLE&&a<bse&&!this._forceTask?(this._forceTask=!0,!1):(a=Math.max(a,l),this._budget.reset(a,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case Fr.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(n=>n.idleBegin())),this._runIdle();break;case Fr.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(n){this._idleUpdatesStartFired&&n.idleEnd(),this._idleStateCallbacks.removeUnordered(n)}removeTask(n){this._tasks.removeUnordered(n),this._runQueue.removeUnordered(n),this._updatingChanged()}_updateTask(n){this._tasks.forAll(o=>{o.name===n&&o.setPriority(n)})}_getState(n){if(this._runQueue.some(a=>a.name===n))return zv.SCHEDULED;let o=zv.IDLE;return this._tasks.forAll(a=>{a.name===n&&a.needsUpdate&&(a.schedulePriority<=1?o=zv.READY:o!==zv.READY&&(o=zv.WAITING))}),o}_getRuntime(n){let o=0;return this._tasks.forAll(a=>{a.name===n&&(o+=a.runtime)}),o}_resetRuntimes(){this._tasks.forAll(n=>n.runtime=0)}_getRunning(){const n=new Map;if(this._tasks.forAll(a=>{a.needsUpdate&&n.set(a.name,(n.get(a.name)||0)+1)}),n.size===0)return null;let o="";return n.forEach((a,l)=>{o+=a>1?` ${a}x ${l}`:` ${l}`}),o}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const n=this._tasks.reduce((o,a)=>a.needsUpdate?++o:o,0);this._load=this._load*Tse+n*(1-Tse)}_schedule(){for(this._runQueue.filterInPlace(n=>!!n.needsUpdate||(n.schedulePriority=n.basePriority,!1)),this._tasks.forAll(n=>{n.basePriority===Af&&n.needsUpdate&&!this._runQueue.includes(n)&&n.blockFrame!==this._frameNumber&&this._runQueue.unshift(n)});this._runQueue.length===0;){let n=!1,o=0;if(this._tasks.forAll(a=>{a.needsUpdate&&a.schedulePriority!==0&&a.basePriority!==Af&&a.blockFrame!==this._frameNumber&&(n=!0,o=Math.max(o,a.basePriority),a.schedulePriority===1?(a.schedulePriority=0,this._runQueue.push(a)):--a.schedulePriority)}),!n)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const n=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const o=this._budget.now(),a=this._runQueue.pop();this._budget.resetProgress();try{a.task.runTask(this._budget)===Wo.YIELD&&(a.blockFrame=this._frameNumber)}catch(c){Q.getLogger("esri.views.support.Scheduler").error(`Exception in task "${a.name}"`,c)}!this._budget.hasProgressed&&a.blockFrame!==this._frameNumber&&a.needsUpdate&&(a.name,vt.I3S_CONTROLLER,a.blockFrame=this._frameNumber),a.schedulePriority=a.basePriority;const l=this._budget.now()-o;if(a.runtime+=l,this._frameTaskTimes.set(a.priority,this._frameTaskTimes.get(a.priority)+l),this._debug&&l>2*this._budget.budget&&console.log("Task",a.name,"used",l,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-n)}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-n)}_startFrameTaskTimes(){for(const n of Object.keys(vt))this._frameTaskTimes.set(vt[n],0)}_recordFrameTaskTimes(n){this._frameTaskTimes.forEach((o,a)=>this.performanceInfo.tasks.get(a).record(o)),this.performanceInfo.total.record(n)}get test(){return this._test}}t.Scheduler=e;class r{get task(){return this._task.value}get updating(){return this._queue.running}constructor(n,o,a,l){this._scheduler=n,this.name=o,this._basePriority=l,this.blockFrame=0,this.runtime=0,this._queue=new TZe,this._handles=new Ii,this.schedulePriority=this._basePriority,this._task=FR(a??this._queue),this._handles.add(Cu(()=>this.task.running,c=>n.taskRunningChanged(c)))}remove(){this.processQueue(Ja),this._scheduler.removeTask(this),this.schedule=dE.schedule,this.reschedule=dE.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(n){this.name=n;const o=_se(n);this._basePriority!==Af&&this.schedulePriority===0||(this.schedulePriority=o),this._basePriority=o}get priority(){return this.name}set priority(n){this.setPriority(n)}get needsUpdate(){return this.updating||this.task.running}schedule(n,o,a){return this._queue.push(n,o,a)}reschedule(n,o,a){return this._queue.unshift(n,o,a)}processQueue(n){this._queue.runTask(n)}}class i{constructor(){this._begin=typeof performance<"u"?performance.now():0,this._budget=0,this._state=Fr.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(n){return!this.done&&(n()===!0&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(n){this._enabled=n}reset(n,o){this._begin=this.now(),this._budget=n,this._state=o,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}t.Budget=i})(Q4||(Q4={})),function(t){t.SCHEDULED="s",t.READY="r",t.WAITING="w",t.IDLE="i"}(zv||(zv={}));const Ja=(()=>{const t=new Q4.Budget;return t.enabled=!1,t})();let AZe=class{remove(){}processQueue(){}schedule(e,r,i){try{if(An(r)){const s=kr();return i?Promise.resolve(i(s)):Promise.reject(s)}return MV(e(Ja))}catch(s){return Promise.reject(s)}}reschedule(e,r,i){return this.schedule(e,r,i)}};const dE=new AZe;let VS=class extends we{constructor(e,r){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=r?.registerTask(vt.TEXTURE_UNLOAD)??dE}normalizeCtorArgs(){return{}}destroy(){super.destroy(),this._frameTask?.remove(),this._textureRequests?.forEach(e=>this._releaseTextureRequest(e)),this._textureRequests?.clear()}get updating(){return this._frameTask.updating}fromData(e,r,i){const s=this.makeUid(e);let n=this._textureRequests.get(s);if(!n){const o=new fxe(i);o.texture=r(),this._stage?.add(o.texture),this._stage?.loadImmediate(o.texture),this._textureRequests.set(s,o),n=o}return n.referenceCount++,{uid:s,texture:n.texture,release:()=>this._release(s)}}_release(e){const r=this._textureRequests.get(e);r?(r.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),r.referenceCount--,r.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(e){if(!this._textureRequests)return;const r=this._textureRequests.get(e);!r||r.referenceCount>0||(this._releaseTextureRequest(r),this._textureRequests.delete(e))}_releaseTextureRequest(e){e.onRemove&&e.onRemove(),e.texture?this._stage?.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,r=null){return r!=null?`${e}.${r}px`:e}};u([d()],VS.prototype,"_frameTask",void 0),u([d()],VS.prototype,"updating",null),VS=u([P("esri.views.3d.support.TextureCollection")],VS);let fxe=class{constructor(e){this.onRemove=e,this.referenceCount=0}};var Sse;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right"})(Sse||(Sse={}));const mxe=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],gxe={};function yxe(t){return!!gxe[t]}function OZe(t){for(const e of t)if(!yxe(e))return!1;return!0}mxe.forEach(t=>{gxe[t]=!0});let RZe=class{constructor(e){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this._handlers.forEach(({handler:r,priority:i},s)=>this.inputManager?.installHandlers(s,[r],i))}disconnect(){this.inputManager&&this._handlers.forEach((e,r)=>this.inputManager?.uninstallHandlers(r)),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(e,r,i,s){const n=Array.isArray(e)?e:e.split(",");if(!OZe(n))return n.some(yxe)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(r)?a=r:(o=r,a=[]),typeof i=="function"?o=i:s=i,s=s??B_.DEFAULT;const l=this._createUniqueGroupName(),c=new MZe(this.view,n,a,o);this._handlers.set(l,{handler:c,priority:s});for(const h of n){const p=this._handlerCounts.get(h)||0;this._handlerCounts.set(h,p+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],s),{remove:()=>this._removeHandler(l,n)}}hasHandler(e){return!!this._handlerCounts.get(e)}_removeHandler(e,r){if(this._handlers.has(e)){this._handlers.delete(e);for(const i of r){const s=this._handlerCounts.get(i);s===void 0?console.error("Trying to remove handler for event that has no handlers registered: ",i):s===1?this._handlerCounts.delete(i):this._handlerCounts.set(i,s-1)}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},MZe=class extends Co{constructor(e,r,i,s){super(!0),this._latestDragStart=void 0,this.view=e;for(const n of r)switch(n){case"click":this.registerIncoming("click",i,o=>s(this._wrapClick(o)));break;case"double-click":this.registerIncoming("double-click",i,o=>s(this._wrapDoubleClick(o)));break;case"immediate-click":this.registerIncoming("immediate-click",i,o=>s(this._wrapImmediateClick(o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",i,o=>s(this._wrapImmediateDoubleClick(o)));break;case"hold":this.registerIncoming("hold",i,o=>s(this._wrapHold(o)));break;case"drag":this.registerIncoming("drag",i,o=>{const a=this._wrapDrag(o);a&&s(a)});break;case"key-down":this.registerIncoming("key-down",i,o=>s(this._wrapKeyDown(o)));break;case"key-up":this.registerIncoming("key-up",i,o=>s(this._wrapKeyUp(o)));break;case"pointer-down":this.registerIncoming("pointer-down",i,o=>s(this._wrapPointer(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",i,o=>s(this._wrapPointer(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",i,o=>s(this._wrapPointer(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",i,o=>s(this._wrapPointerDrag(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",i,o=>s(this._wrapMouseWheel(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",i,o=>s(this._wrapPointer(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",i,o=>s(this._wrapPointer(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",i,o=>{s(this._wrapGamepad(o))});break;case"focus":this.registerIncoming("focus",i,o=>{s(this._wrapFocus(o))});break;case"blur":this.registerIncoming("blur",i,o=>{s(this._wrapBlur(o))})}}_wrapFocus(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:r=>e.async(r),preventDefault:()=>e.preventDefault()}}_wrapBlur(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:r=>e.async(r),preventDefault:()=>e.preventDefault()}}_wrapClick(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:h}=e;return{type:"click",pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:h,screenPoint:kh(n,o),mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}_wrapDoubleClick(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:h}=e;return{type:"double-click",pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:h,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}_wrapImmediateClick(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:h,timestamp:p}=e;return{type:"immediate-click",pointerId:c,pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:p,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}_wrapImmediateDoubleClick(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:h,timestamp:p}=e;return{type:"immediate-double-click",pointerId:c,pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:p,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}_wrapHold(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a}=e.data,{cancelable:l,timestamp:c}=e;return{type:"hold",pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:c,mapPoint:this._getMapPoint(n,o),cancelable:l,stopPropagation:()=>e.stopPropagation(),async:h=>e.async(h),preventDefault:()=>e.preventDefault()}}_getMapPoint(e,r){return this.view.toMap(kh(e,r),{exclude:[]})}_wrapDrag(e){const r=e.data,{x:i,y:s}=r.center,{action:n,pointerType:o,button:a}=r;if(n==="start"&&(this._latestDragStart=r),!this._latestDragStart)return;const l=r.pointer.native,c=r.buttons,{cancelable:h,timestamp:p}=e,f={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return n==="end"&&(this._latestDragStart=void 0),{type:"drag",action:n,x:i,y:s,origin:f,pointerType:o,button:a,buttons:c,radius:r.radius,angle:rl(r.angle),native:l,timestamp:p,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}_wrapKeyDown(e){const{key:r,repeat:i,native:s}=e.data,{cancelable:n,timestamp:o}=e;return{type:"key-down",key:r,repeat:i,native:s,timestamp:o,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:a=>e.async(a),preventDefault:()=>e.preventDefault()}}_wrapKeyUp(e){const{key:r,native:i}=e.data,{cancelable:s,timestamp:n}=e;return{type:"key-up",key:r,native:i,timestamp:n,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:o=>e.async(o),preventDefault:()=>e.preventDefault()}}_wrapPointer(e,r){const{x:i,y:s,button:n,buttons:o,native:a,eventId:l}=e.data,c=a.pointerId,h=a.pointerType,{cancelable:p,timestamp:f}=e;return{type:r,x:i,y:s,pointerId:c,pointerType:h,button:n,buttons:o,native:a,timestamp:f,eventId:l,cancelable:p,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}_wrapPointerDrag(e){const{x:r,y:i,buttons:s,native:n,eventId:o}=e.data.currentEvent,{button:a}=e.data.startEvent,l=e.data.startEvent.native.pointerId,c=e.data.startEvent.native.pointerType,h=e.data.action,p={x:e.data.startEvent.x,y:e.data.startEvent.y},{cancelable:f,timestamp:m}=e;return{type:"pointer-drag",x:r,y:i,pointerId:l,pointerType:c,button:a,buttons:s,action:h,origin:p,native:n,timestamp:m,eventId:o,cancelable:f,stopPropagation:()=>e.stopPropagation(),async:y=>e.async(y),preventDefault:()=>e.preventDefault()}}_wrapMouseWheel(e){const{cancelable:r,data:i,timestamp:s}=e,{x:n,y:o,deltaY:a,native:l}=i;return{type:"mouse-wheel",x:n,y:o,deltaY:a,native:l,timestamp:s,cancelable:r,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}_wrapGamepad(e){const{action:r,state:i,device:s}=e.data,{cancelable:n,timestamp:o}=e,{buttons:a,axes:l}=i;return{type:"gamepad",device:s,timestamp:o,action:r,buttons:a,axes:l,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}};var UR,Ese,Cse;(function(t){t[t.USER=0]="USER",t[t.MANAGER=1]="MANAGER"})(UR||(UR={})),function(t){t[t.None=0]="None",t[t.Unfocused=1]="Unfocused",t[t.Focused=2]="Focused",t[t.Unselected=4]="Unselected",t[t.Selected=8]="Selected",t[t.All=15]="All"}(Ese||(Ese={})),function(t){t[t.None=0]="None",t[t.Custom1=16]="Custom1",t[t.Custom2=32]="Custom2",t[t.Custom3=64]="Custom3",t[t.Custom4=128]="Custom4",t[t.Custom5=256]="Custom5",t[t.Custom6=512]="Custom6",t[t.Custom7=1024]="Custom7",t[t.Custom8=2048]="Custom8",t[t.Custom9=4096]="Custom9",t[t.Custom10=8192]="Custom10",t[t.Custom11=16384]="Custom11",t[t.Custom12=32768]="Custom12",t[t.All=65520]="All"}(Cse||(Cse={}));function PZe(t){return[t.on("before-add",e=>{const r=e.item;if(r==null||t.includes(r))return Q.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void e.preventDefault();r.onAdd()}),t.on("after-remove",e=>{const r=e.item;r.active&&(r.view.activeTool=null),r.destroy()})]}function qj(t){return t.visible&&t.getEditableFlag!=null&&t.getEditableFlag(UR.USER)&&t.getEditableFlag(UR.MANAGER)}function ff(t){return kh(t.x,t.y)}function g4t(t){return Ji(t.x,t.y)}function _xe(t,e){const r=(t instanceof HTMLElement?t:t.surface)?.getBoundingClientRect();return r?kh(e.clientX-r.left,e.clientY-r.top):kh(0,0)}function Ase(t,e){return e instanceof Event?_xe(t,e):ff(e)}function Ose(t){if(t instanceof Event)return!0;if(typeof t=="object"&&"type"in t)switch(t.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}let IZe=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}hasFocusedManipulators(){return this._grabbedManipulators.size>0||this._draggedManipulators.size>0}handleInputEvent(e,r){const i=()=>e.stopPropagation();switch(e.type){case"pointer-move":Rse(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(i(),e.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!Mse(e))break;const s=ff(e),n=this._intersect(s,e.pointerType,r.forEachTool);if(n==null)break;const o=n.manipulator,a=n.tool;o==null||a==null||!o.interactive||o.grabbable&&o.grabbableForEvent(e)||!o.grabbing||o.dragging||this._ungrabManipulatorBeforeDragging(o,e,r),o!=null&&a!=null&&o.interactive&&o.grabbable&&o.grabbableForEvent(e)&&!o.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:o,tool:a,start:s,pointerType:e.pointerType}),this._grabbedManipulators.size===1&&r.activeTool==null&&(this._revertToNullActiveTool=!0,r.setActiveTool(n.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:s}),i());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,r);break;case"pointer-drag":{if(!Mse(e))break;const s=this._grabbedManipulators.get(e.pointerId),n=vc(s,({manipulator:h})=>h),o=vc(s,({tool:h})=>h);if(n==null||o==null)break;const a=ff(e);a.x=ve(a.x,0,r.view.width),a.y=ve(a.y,0,r.view.height);const l=s.start,c=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":e.action!=="update"&&this._grabbedManipulators.size!==1||(n.dragging=!0,c?n.events.emit("drag",{action:"update",start:l,screenPoint:a}):n.events.emit("drag",{action:"start",start:l,screenPoint:a,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:o,manipulator:n,start:l}));break;case"end":n.dragging=!1,c&&n.events.emit("drag",{action:"end",start:l,screenPoint:a}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,r)}i();break}case"immediate-click":{const s=ff(e),n=this._intersect(s,e.pointerType,r.forEachTool);if($Ze(e)||r.forEachTool(c=>{if((n==null||n.tool!==c||c.automaticManipulatorSelection)&&c.manipulators){let h=!1;c.manipulators.forEach(({manipulator:p})=>{p.selected&&(p.selected=!1,h=!0)}),h&&c.onManipulatorSelectionChanged&&c.onManipulatorSelectionChanged()}}),n==null)break;const{manipulator:o,tool:a}=n;if(!o.interactive)break;o.selectable&&a.automaticManipulatorSelection&&(o.selected=!o.selected,a.onManipulatorSelectionChanged&&a.onManipulatorSelectionChanged());const l=e.native.shiftKey;o.events.emit("immediate-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:l,stopPropagation:i});break}case"click":{const s=ff(e),n=this._intersect(s,e.pointerType,r.forEachTool),o=n!=null?n.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit(e.type,{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a}),i();break}case"double-click":{const s=ff(e),n=this._intersect(s,e.pointerType,r.forEachTool),o=n!=null?n.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:i});break}case"immediate-double-click":{const s=ff(e),n=this._intersect(s,e.pointerType,r.forEachTool),o=n!=null?n.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:i});break}}this._onFocusChange(r.forEachTool)}_ungrabManipulatorBeforeDragging(e,r,i){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:r.pointerType,screenPoint:ff(r)}),this._grabbedManipulators.forEach(({manipulator:s},n)=>{s===e&&this._grabbedManipulators.delete(n)}),this._afterManipulatorUngrab(i.setActiveTool)}_handlePointerEnd(e,r){const i=vc(this._grabbedManipulators.get(e.pointerId),({manipulator:s})=>s);i!=null&&i.grabbing&&(i.grabbing=!1,i.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:ff(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorUngrab(r.setActiveTool))}_cursorFromMap(e){let r=null;return ko(e,({manipulator:i})=>!(i==null||!i.interactive)&&(i.grabbing&&i.grabCursor?(r=i.grabCursor,!0):!!i.cursor&&(r=i.cursor,!0))),r}_onFocusChange(e){this._updateCursor(),this._updateFocusedManipulatorTools(e)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const r=new Set,i=new Set;this._grabbedManipulators.forEach(({tool:s})=>{r.add(s)}),this._hoveredManipulators.forEach(({tool:s})=>{i.add(s)}),e(s=>{s.hasGrabbedManipulators=r.has(s),s.hasHoveredManipulators=i.has(s);const n=this._grabbedManipulators.values(),o=PIe(n,({tool:a})=>a===s);s.firstGrabbedManipulator=o!=null?o.manipulator:null})}clearPointers(e,{forEachTool:r,setActiveTool:i},s=!0,n){const o=(a,l)=>a===e&&(n==null||n===l);this._grabbedManipulators.forEach(({tool:a,manipulator:l,pointerType:c},h)=>{o(a,l)&&(this._grabbedManipulators.delete(h),l.grabbing=!1,l.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:c}))}),this._draggedManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._draggedManipulators.delete(c),l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}),s&&this._hoveredManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._hoveredManipulators.delete(c),l.hovering=!1)}),this._afterManipulatorUngrab(i),this._onFocusChange(r)}_intersect(e,r,i){let s=null;return i(n=>{if(n.manipulators==null||!qj(n))return!1;const o=n.manipulators.intersect(e,r);return o!=null&&(s={tool:n,manipulator:o},!0)}),s}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach((r,i)=>{this._updateHoveredStateForPointerAtScreenPosition(kh(r.x,r.y),i,r.pointerType,e)})}handleHoverEvent(e,r){e.type!=="pointer-up"&&e.type!=="immediate-click"&&e.type!=="pointer-move"||!Rse(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(ff(e),e.pointerId,e.pointerType,r)}_updateHoveredStateForPointerAtScreenPosition(e,r,i,s){let n=this._intersect(e,i,s);const o=vc(this._hoveredManipulators.get(r),({manipulator:a})=>a);n==null||n.manipulator.interactive||(n=null),n!=null&&o===n.manipulator||(o!=null&&(o.hovering=!1),n!=null?(n.manipulator.hovering=!0,this._hoveredManipulators.set(r,n)):this._hoveredManipulators.delete(r),this._onFocusChange(s))}_afterManipulatorUngrab(e){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}};function Rse(t){return t==="mouse"}function Mse(t){return t.pointerType!=="mouse"||t.button===0}function $Ze(t){return!!t.native.shiftKey}const Pse="attached",x9="tools",LZe=1e3;let Od=class extends OR{constructor(e){super(e),this._clock=xM,this._manipulatorState=new IZe,this.tools=new Pt,this.cursor=null,this._interacting=!1,this._interactingTimeout=null,this._forEachTool=r=>{for(const i of this.tools.items)if(r(i))return}}initialize(){this.handles.add([this.view.on(mxe,e=>{this._handleInputEvent(e)},B_.TOOL),...PZe(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.detach(),this.handles.removeAll()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(e!=null&&!this.view.ready)return void Q.getLogger(this).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const r=this.activeTool;this._set("activeTool",e),r?.deactivate(),e?.activate(),this._removeIncompleteTools(e);for(const i of this.tools){this._updateToolEditableFlag(i);const s=qj(i);this.activeTool!=null&&s||this._manipulatorState.clearPointers(i,this._manipulatorStateEventArgs,!s)}this._updateCursor()}get updating(){return this.updatingHandles.updating||this.tools.some(e=>e.updating)||(this.textures?.updating??!1)}get interacting(){return this._interacting}_clearInteractingTimeout(){this._interactingTimeout=Ni(this._interactingTimeout)}_startInteractingTimeout(){this._clearInteractingTimeout(),this._interactingTimeout=this._clock.setTimeout(()=>this._interacting=!1,LZe)}attach(){this.view.type==="3d"?(this._set("textures",new VS(this.view._stage,this.view.resourceController.scheduler)),this.handles.add([ae(()=>{const{state:e}=this.view;return"camera"in e&&e.camera},()=>this._forEachManipulator(e=>e.onViewChange())),this.view.elevationProvider?.on("elevation-change",e=>this._forEachManipulator(r=>r.onElevationChange(e))),el(()=>this._set("textures",$e(this.textures)))],Pse)):this.handles.add(ae(()=>this.view.extent,()=>this._forEachManipulator(e=>e.onViewChange())))}detach(){this.activeTool=null,this.tools.removeAll(),this.handles.remove(Pse),this._clearInteractingTimeout(),this._interacting=!1}_forEachManipulator(e){this._forEachTool(r=>{r.manipulators&&r.manipulators.forEach(({manipulator:i})=>e(i,r))})}_handleInputEvent(e){let r=!1;const i={...e,stopPropagation:()=>{r=!0,e.stopPropagation()}};this.activeTool!=null?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(i):this._forEachTool(s=>{!r&&s.visible&&s.handleInputEvent(i)}),!r&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(i,this._manipulatorStateEventArgs),r||this.activeTool==null||this.activeTool.handleInputEventAfter(i),this._manipulatorState.handleHoverEvent(i,this._forEachTool),this._updateCursor(),e.type==="pointer-move"&&(this._manipulatorState.hasFocusedManipulators()||this.activeTool)&&(this._interacting=!0,this._startInteractingTimeout())}_refreshToolWatchers(){this.handles.remove(x9),this._forEachTool(e=>{if(e instanceof we){const r=ae(()=>[e.cursor,e.visible,e.editable],()=>{qj(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.handles.add(r,x9)}e.manipulators&&this.handles.add([e.manipulators.on("after-remove",r=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,r.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],x9)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){e.setEditableFlag?.(UR.MANAGER,this.activeTool==null||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;e==null&&this._forEachTool(r=>!(r.cursor==null||!r.visible)&&(e=r.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(r=>(e==null||r!==e)&&!r.created&&r.removeIncompleteOnCancel).forEach(r=>{this.tools.remove(r)})}get test(){return{setClock:e=>this._clock=e}}};u([d({constructOnly:!0,nonNullable:!0})],Od.prototype,"view",void 0),u([d({readOnly:!0,nonNullable:!0})],Od.prototype,"textures",void 0),u([d({value:null})],Od.prototype,"activeTool",null),u([d({readOnly:!0,type:Pt})],Od.prototype,"tools",void 0),u([d({readOnly:!0})],Od.prototype,"cursor",void 0),u([d({readOnly:!0})],Od.prototype,"updating",null),u([d()],Od.prototype,"_interacting",void 0),u([d({readOnly:!0})],Od.prototype,"interacting",null),Od=u([P("esri.views.ToolViewManager")],Od);let cS=class extends we{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":DZe.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return NZe[this.deviceType]}};u([d({nonNullable:!0,readOnly:!0})],cS.prototype,"nativeIndex",void 0),u([d({type:String,readOnly:!0})],cS.prototype,"deviceType",null),u([d({type:Number,readOnly:!0})],cS.prototype,"axisThreshold",null),cS=u([P("esri.views.input.gamepad.GamepadInputDevice")],cS);const DZe=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),NZe={standard:.15,spacemouse:.025,unknown:0},sJ=cS;let M3=class extends we{constructor(...e){super(...e),this.devices=new Pt,this.enabledFocusMode="document"}};u([d({type:Pt.ofType(sJ),readOnly:!0})],M3.prototype,"devices",void 0),u([d({type:["document","view","none"]})],M3.prototype,"enabledFocusMode",void 0),M3=u([P("esri.views.input.gamepad.GamepadSettings")],M3);const FZe=M3;let YD=class extends we{constructor(){super(...arguments),this.gamepad=new FZe}};u([d({readOnly:!0})],YD.prototype,"gamepad",void 0),YD=u([P("esri.views.input.Input")],YD);const UZe=YD;let W0=class extends we{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};u([d({type:Boolean,nonNullable:!0})],W0.prototype,"enabled",void 0),u([d({type:sJ})],W0.prototype,"device",void 0),u([d({type:["pan","zoom"],nonNullable:!0})],W0.prototype,"mode",void 0),u([d({type:["forward-down","forward-up"],nonNullable:!0})],W0.prototype,"tiltDirection",void 0),u([d({type:Number,nonNullable:!0})],W0.prototype,"velocityFactor",void 0),W0=u([P("esri.views.navigation.gamepad.GamepadSettings")],W0);const vxe=W0;let eb=class extends we{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new vxe,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};u([d({type:Boolean})],eb.prototype,"browserTouchPanEnabled",void 0),u([d({type:vxe,nonNullable:!0})],eb.prototype,"gamepad",void 0),u([d({type:Boolean})],eb.prototype,"momentumEnabled",void 0),u([d({type:Boolean})],eb.prototype,"mouseWheelZoomEnabled",void 0),eb=u([P("esri.views.navigation.Navigation")],eb);const bxe=eb;function S4t(t,e,r){const i=wxe(t),s=e,n=kZe(i,s,r);if(i){const o=ux.deriveUnitFromSR(i,t.spatialReference).heightUnit;if(!r&&o!==i.heightUnit){const a=new V("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o});return new V("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:i,error:a})}}if(!zZe(t)||n===cc.Unsupported)return new V("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:i});switch(n){case cc.Units:{const o=i?.heightUnit||"unknown",a=s?.heightUnit||"unknown",l=new V("layerview:incompatible-height-unit",`The vertical units of the layer (${o}) must match the vertical units of the scene (${a})`,{layerUnit:o,sceneUnit:a});return new V("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:s,error:l})}case cc.HeightModel:{const o=i?.heightModel||"unknown",a=s?.heightModel||"unknown",l=new V("layerview:incompatible-height-model",`The height model of the layer (${o}) must match the height model of the scene (${a})`,{layerHeightModel:o,sceneHeightModel:a});return new V("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:s,error:l})}case cc.CRS:{const o=i?.vertCRS||"unknown",a=s?.vertCRS||"unknown",l=new V("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${o}) must match the vertical datum of the scene (${a})`,{layerDatum:o,sceneDatum:a});return new V("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:s,error:l})}}return null}function kZe(t,e,r){if(!Ise(t)||!Ise(e))return cc.Unsupported;if(t==null||e==null)return cc.Ok;if(!r&&t.heightUnit!==e.heightUnit)return cc.Units;if(t.heightModel!==e.heightModel)return cc.HeightModel;switch(t.heightModel){case"gravity-related-height":return cc.Ok;case"ellipsoidal":return t.vertCRS===e.vertCRS?cc.Ok:cc.CRS;default:return cc.Unsupported}}var cc;function Ise(t){return t==null||t.heightModel!=null&&t.heightUnit!=null}function zZe(t){return"heightModelInfo"in t&&t.heightModelInfo!=null||t.spatialReference!=null||!Sxe(t)}function wxe(t){const e=t.url?cx(t.url):void 0;return!(t.spatialReference?.vcsWkid==null&&e!=null&&e.serverType==="ImageServer")&&xxe(t)&&t.heightModelInfo?t.heightModelInfo:Sxe(t)?ux.deriveUnitFromSR(BZe,t.spatialReference):null}function xxe(t){return"heightModelInfo"in t}function Txe(t){if(t.type==="unknown"||!("capabilities"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function Sxe(t){return Txe(t)?!!(t.capabilities&&t.capabilities.data&&t.capabilities.data.supportsZ):Exe(t)}function VZe(t){return t.layers!=null||Exe(t)||Txe(t)||xxe(t)}function Exe(t){switch(t.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(t){t[t.Ok=0]="Ok",t[t.Units=1]="Units",t[t.HeightModel=2]="HeightModel",t[t.CRS=3]="CRS",t[t.Unsupported=4]="Unsupported"})(cc||(cc={}));const BZe=new ux({heightModel:"gravity-related-height"});let Wj,T9=null;async function GZe(t){T9||(T9=ce(()=>Promise.resolve().then(()=>Ngt),void 0,import.meta.url).then(e=>Wj=e)),await T9,Yt(t)}async function Cxe(t,e,r,i){if(!t)return null;const s=t.spatialReference;return I6()||lm(s,e)?hx(t,e):Wj?Wj.projectGeometry(t,e,r,i):(await Promise.race([GZe(i),PR(i)]),Cxe(t,e,r,i))}let zi=class extends we{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=Ll(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return this.userSpatialReference!=null?this.userSpatialReference:this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return this.userSpatialReference==null||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){const e=this.map?.(),r=[];return this.priorityCollection!=null&&r.push(this.priorityCollection),r.push({parent:e?.basemap,layers:e?.basemap?.baseLayers},{layers:e?.layers},{parent:e?.ground,layers:e?.ground?.layers},{parent:e?.basemap,layers:e?.basemap?.referenceLayers}),r}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};const{layers:e,updating:r}=this._allLayers;let i=null;for(const n of e){const o=this._getSupportedSpatialReferences(n);if(o.length>0){const a=this._narrowDownSpatialReferenceCandidates(i,o);a!=null&&(i=a)}if(i!=null&&i.length===1)break}if(r&&(i==null||i.length!==1))return{updating:!0};const s=this._pickSpatialReferenceCandidate(i);return{spatialReference:s!=null?s.spatialReference:null,viewingMode:s!=null?s.viewingMode:null,updating:!1}}get _tileInfoTask(){if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:r}=this._collectLayers([{parent:this.map?.()?.basemap,layers:this.map?.()?.basemap?.baseLayers},{layers:this.map?.()?.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const i=e[0].tileInfo;return{tileInfo:i&&i.spatialReference.equals(this.spatialReference)?i:null,updating:!1}}return{updating:r}}get _heightModelInfoTask(){if(!this.required.heightModelInfo||this.suspended&&this._get("_heightModelInfoTask")?.heightModelInfo)return this._get("_heightModelInfoTask")??{updating:!1};const{layers:e,updating:r}=this._allLayers;for(const i of e)if(VZe(i)){const s=wxe(i);if(s)return{heightModelInfo:s,vcsWkid:i.spatialReference?.vcsWkid,latestVcsWkid:i.spatialReference?.latestVcsWkid,updating:!1}}return{updating:r}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,r=e.updating,i=[];for(const s of e.layers){const n="fullExtents"in s&&s.fullExtents||(s.fullExtent!=null?[s.fullExtent]:[]),o=this.requiresExtentInSpatialReference?null:n[0],a=n.find(l=>l.spatialReference.equals(this.spatialReference))??o;if(a)return{candidates:[{extent:a,layer:s}],updating:!1};if(this._getSupportedSpatialReferences(s).length>0)for(const l of n)i.push({extent:l,layer:s})}return{candidates:i,updating:r}}get _extentTask(){const{candidates:e,updating:r}=this._extentCandidatesTask;if(r)return{updating:r};if(e==null||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const i=this._pickExtentCandidate(e),s=this.spatialReference;return i.extent.equals(this._projectExtentTask.input)&&s.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:this._projectExtentTask.task!=null&&!this._projectExtentTask.task.finished}:(this._projectExtentTask.task!=null&&(this._projectExtentTask.task=Ll(this._projectExtentTask.task)),this._projectExtentTask={input:i.extent.clone(),output:null,spatialReference:s.clone(),task:jE(async n=>{try{const o=await Cxe(i.extent,s,"portalItem"in i.layer?i.layer.portalItem:void 0,n);this._projectExtentTask={...this._projectExtentTask,task:null,output:o}}catch{if(An(n))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,r){if(e==null)return r;const i=[],s=(n,o)=>n!=null?o!=null?n===o&&n:n:o;for(const n of e)for(const o of r){if(!n.spatialReference.equals(o.spatialReference))continue;const a=s(n.viewingMode,o.viewingMode);if(a!==!1){i.push({spatialReference:n.spatialReference,viewingMode:a});break}}return i.length>0?i:null}_pickSpatialReferenceCandidate(e){const r=this.defaultSpatialReference;return e==null||e.length<1?r!=null?{spatialReference:r,viewingMode:null}:null:(r!=null&&e.length>1&&e.some(({spatialReference:i})=>i.equals(r))&&(e=e.filter(({spatialReference:i})=>i.equals(r))),e.length>1&&e.some(({viewingMode:i})=>i!==Ue.Local)&&(e=e.filter(({viewingMode:i})=>i!==Ue.Local)),e[0])}_getSupportedSpatialReferences(e){const r="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(r.length===0)return[];const i=[];for(const s of r){const n=this.getSpatialReferenceSupport({spatialReference:s,layer:e});if(n!=null){const o=n.constraints!=null?n.constraints:[{spatialReference:s,viewingMode:null}];for(const{spatialReference:a,viewingMode:l}of o)this.requiresExtentInSpatialReference&&this.userSpatialReference!=null&&!a.equals(this.userSpatialReference)||i.push({spatialReference:a,viewingMode:l})}}return i}_pickExtentCandidate(e){const r=this.spatialReference;return e.find(({extent:i})=>r.equals(i.spatialReference))||e[0]}_collectLayers(e){if(this._loadMaybe(this.map?.())!=="loaded")return{layers:[],updating:!0};const r=new jZe;for(const i of e)if(this._collectCollection(i,r),r.preloading===this.sourcePreloadCount)break;return{layers:r.layers,updating:r.updating}}_collectCollection(e,r){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return r.updating=!0,void++r.preloading;case"failed":return}for(const i of e.layers){switch(this._loadMaybe(i)){case"failed":continue;case"loading":r.updating=!0,++r.preloading;break;case"loaded":r.updating||r.layers.push(i),"layers"in i&&this._collectCollection({layers:i.layers},r)}if(r.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(r=>{us(r)||console.log(r)}),"loading"):e.loadStatus:"loaded"}};u([d()],zi.prototype,"required",void 0),u([d({constructOnly:!0})],zi.prototype,"map",void 0),u([d({constructOnly:!0})],zi.prototype,"getSpatialReferenceSupport",void 0),u([d()],zi.prototype,"defaultSpatialReference",void 0),u([d()],zi.prototype,"userSpatialReference",void 0),u([d()],zi.prototype,"sourcePreloadCount",void 0),u([d()],zi.prototype,"priorityCollection",void 0),u([d()],zi.prototype,"requiresExtentInSpatialReference",void 0),u([d()],zi.prototype,"suspended",void 0),u([d({readOnly:!0})],zi.prototype,"ready",null),u([d({readOnly:!0})],zi.prototype,"heightModelInfoReady",null),u([d({readOnly:!0})],zi.prototype,"spatialReference",null),u([d({readOnly:!0})],zi.prototype,"extent",null),u([d({readOnly:!0})],zi.prototype,"heightModelInfo",null),u([d({readOnly:!0})],zi.prototype,"vcsWkid",null),u([d({readOnly:!0})],zi.prototype,"latestVcsWkid",null),u([d({readOnly:!0})],zi.prototype,"viewingMode",null),u([d({readOnly:!0})],zi.prototype,"tileInfo",null),u([d({readOnly:!0})],zi.prototype,"mapCollections",null),u([d({readOnly:!0})],zi.prototype,"_allLayers",null),u([d({readOnly:!0})],zi.prototype,"_spatialReferenceTask",null),u([d({readOnly:!0})],zi.prototype,"_tileInfoTask",null),u([d({readOnly:!0})],zi.prototype,"_heightModelInfoTask",null),u([d({readOnly:!0})],zi.prototype,"_extentCandidatesTask",null),u([d()],zi.prototype,"_extentTask",null),u([d()],zi.prototype,"_projectExtentTask",void 0),zi=u([P("esri.views.support.DefaultsFromMap")],zi);let jZe=class{constructor(){this.layers=new Array,this.preloading=-1,this.updating=!1}};var P3;let It=P3=class extends v6(ws.EventedMixin(B5(we))){constructor(t){super(t),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new wR({getCollections:()=>[this.basemapView?.baseLayerViews,this.groundView?.layerViews,this.layerViews,this.basemapView?.referenceLayerViews],getChildrenFunction:qZe}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new NO,this.analyses=new uE,this.typeSpecificPreconditionsReady=!0,this.layerViews=new Pt,this.magnifier=new pxe,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.timeReference=new rE,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new UZe,this.navigation=new bxe,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new RZe(this),this.persistableViewModels=new Pt,this._isValid=!1,this._readyCycleForced=!1,this._currentSpatialReference=null,this.handles.add(ae(()=>this.preconditionsReady,e=>{e?(this._currentSpatialReference=this.spatialReference,P3.views.add(this)):(this._currentSpatialReference=null,P3.views.remove(this)),this.notifyChange("spatialReference"),!e&&this.ready?(this.toolViewManager?.detach(),this.analysisViewManager!=null&&this.analysisViewManager.detach(),this.layerViewManager?.clear(),this._teardown()):e&&!this.ready&&(this._startup(),this.analysisViewManager!=null&&this.analysisViewManager.attach(),this.toolViewManager.attach())},qr))}initialize(){this.addResolvingPromise(this.validate().then(()=>(this._isValid=!0,ay(()=>this.ready)))),this.basemapView=new q0({view:this}),this.layerViewManager=new wZe({view:this,layerViewImporter:{importLayerView:t=>this.importLayerView(t),hasLayerViewModule:t=>this.hasLayerViewModule(t)},supportsGround:this.supportsGround}),this.toolViewManager=new Od({view:this}),this._setupSpatialReferenceLogger(),this.handles.add([ae(()=>this.initialExtentRequired,t=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:t},{sync:!0,initial:!0}),ae(()=>this.ready,t=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=t,this.defaultsFromMap.userSpatialReference=t?this.spatialReference:this._userSpatialReference)},{sync:!0}),ae(()=>this._userSpatialReference,t=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=t)},{sync:!0,initial:!0})])}_setupSpatialReferenceLogger(){let t=null;this.handles.add([ae(()=>this.defaultsFromMap?.ready,e=>{const r=this.map?.allLayers.length>0;if(e&&!this.spatialReference&&r){if(t!=null)return;const i=el(()=>t=Ll(t));t=jE(async s=>{try{await U2(this.spatialReferenceWarningDelay,null,s)}catch{return}finally{t=null}Q.getLogger(this).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.handles.add(i,"spatial-reference-logger-task")}else this.handles.remove("spatial-reference-logger-task")},{sync:!0})])}destroy(){this.destroyed||(P3.views.remove(this),this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=$e(this.graphics),this.analyses=$e(this.analyses),this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),$e(this.analysisViewManager),this.toolViewManager=$e(this.toolViewManager),this.layerViewManager=$e(this.layerViewManager),this.basemapView=$e(this.basemapView),this.groundView?.destroy(),this.layerViews?.forEach(t=>t.destroy()),this.layerViews.length=0,this.invalidate(),this._emitter.clear(),this.handles.removeAll(),this.map=$e(this.map))}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return Q.getLogger(this).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){return this.toolViewManager?.activeTool}set activeTool(t){this.toolViewManager&&(this.toolViewManager.activeTool=t)}get animation(){return this._get("animation")}set animation(t){this._set("animation",t)}get center(){return null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new zi({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:t=>this.getSpatialReferenceSupport(t),...this._defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(t){this._set("extent",t)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||sy.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._currentSpatialReference&&!this.defaultsFromMap?.ready||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(t){t!==this._get("map")&&(t?.destroyed&&(Q.getLogger(this).warn("#map","The provided map is already destroyed",{map:t}),t=null),sy.isLoadable(t)&&t.load().catch(()=>{}),this.constructed&&!this.destroyed&&(this.forceReadyCycle(),this._currentSpatialReference=null),this._set("map",t))}get spatialReference(){let t=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return t&&this.defaultsFromMap?.required?.heightModelInfo&&(t=t.clone(),t.vcsWkid=this.defaultsFromMap.vcsWkid,t.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),t}set spatialReference(t){const e=!Pn(t,this._get("spatialReference"));this._set("_userSpatialReference",t),e&&(this._set("spatialReference",t),this._spatialReferenceChanged(t))}_spatialReferenceChanged(t){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get tools(){return this.toolViewManager?.tools}get initialExtent(){return this.defaultsFromMap?.extent}get cursor(){const t=this.toolViewManager?this.toolViewManager.cursor:null;return t??(this._cursor||"default")}set cursor(t){this._cursor=t,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(t){return this.layerViewManager?.whenLayerView(t)??Promise.reject()}getDefaultSpatialReference(){return this.defaultsFromMap?.spatialReference}getDefaultHeightModelInfo(){return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??this.defaultsFromMap?.heightModelInfo??null}importLayerView(t){throw new V("importLayerView() not implemented")}hasLayerViewModule(t){return!1}async validate(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(t){return this.getSpatialReferenceSupport({spatialReference:t})!=null}when(t,e){return this.isResolved()&&!this.ready&&Q.getLogger(this).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(t,e)}forceReadyCycle(){this.ready&&(Cu(()=>this.destroyed||this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(t){this.toolViewManager.tools.add(t),this.activeTool=t}tryFatalErrorRecovery(){this.fatalError=null}};It.views=new Pt,u([d()],It.prototype,"_userSpatialReference",void 0),u([d()],It.prototype,"activeTool",null),u([d({readOnly:!0})],It.prototype,"allLayerViews",void 0),u([d()],It.prototype,"groundView",void 0),u([d()],It.prototype,"animation",null),u([d()],It.prototype,"basemapView",void 0),u([d()],It.prototype,"center",null),u([d({readOnly:!0})],It.prototype,"_defaultsFromMapSettings",null),u([d()],It.prototype,"defaultsFromMap",null),u([d()],It.prototype,"fatalError",void 0),u([d({type:ur})],It.prototype,"extent",null),u([d(Uj(NO,"graphics"))],It.prototype,"graphics",void 0),u([d(Uj(uE,"analyses"))],It.prototype,"analyses",void 0),u([d({readOnly:!0,type:ux})],It.prototype,"heightModelInfo",null),u([d({readOnly:!0})],It.prototype,"interacting",null),u([d({readOnly:!0})],It.prototype,"navigating",null),u([d({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],It.prototype,"preconditionsReady",null),u([d({readOnly:!0})],It.prototype,"typeSpecificPreconditionsReady",void 0),u([d({type:Pt,readOnly:!0})],It.prototype,"layerViews",void 0),u([d()],It.prototype,"resolution",null),u([d({type:pxe})],It.prototype,"magnifier",void 0),u([d({value:null,type:eye})],It.prototype,"map",null),u([d()],It.prototype,"padding",void 0),u([d({readOnly:!0})],It.prototype,"ready",void 0),u([d({type:je})],It.prototype,"spatialReference",null),u([d()],It.prototype,"spatialReferenceWarningDelay",void 0),u([d()],It.prototype,"stationary",null),u([d({readOnly:!0})],It.prototype,"supportsGround",void 0),u([d({type:Tm})],It.prototype,"timeExtent",void 0),u([d({type:rE,nonNullable:!0})],It.prototype,"timeReference",void 0),u([d()],It.prototype,"tools",null),u([d()],It.prototype,"toolViewManager",void 0),u([d({readOnly:!0})],It.prototype,"type",void 0),u([d({type:Number})],It.prototype,"scale",void 0),u([d({readOnly:!0})],It.prototype,"updating",void 0),u([d({readOnly:!0})],It.prototype,"initialExtentRequired",void 0),u([d({readOnly:!0})],It.prototype,"initialExtent",null),u([d()],It.prototype,"cursor",null),u([d({readOnly:!0})],It.prototype,"input",void 0),u([d({type:bxe,nonNullable:!0})],It.prototype,"navigation",void 0),u([d()],It.prototype,"layerViewManager",void 0),u([d()],It.prototype,"analysisViewManager",void 0),u([d()],It.prototype,"width",void 0),u([d()],It.prototype,"height",void 0),u([d({readOnly:!0})],It.prototype,"resizing",void 0),u([d({value:null,readOnly:!0})],It.prototype,"size",null),u([d({readOnly:!0})],It.prototype,"suspended",void 0),u([d({readOnly:!0})],It.prototype,"viewEvents",void 0),u([d({readOnly:!0})],It.prototype,"persistableViewModels",void 0),u([d()],It.prototype,"_isValid",void 0),u([d()],It.prototype,"_readyCycleForced",void 0),u([d()],It.prototype,"_currentSpatialReference",void 0),It=P3=u([P("esri.views.View")],It);const HZe=It;function qZe(t){return t.layerViews}let X0=class extends n4{constructor(e){super(e),this.state="running",this.target=null,this._resolver=null}initialize(){this._resolver=xo(),this.addResolvingPromise(this._resolver.promise)}get done(){return this.state==="finished"||this.state==="stopped"}stop(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),this._resolver?.reject(new V("ViewAnimation stopped")))}finish(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),this._resolver?.resolve())}update(e,r){r||(r=Iu(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",r)}};u([d({readOnly:!0})],X0.prototype,"done",null),u([d({readOnly:!0,type:String})],X0.prototype,"state",void 0),u([d()],X0.prototype,"target",void 0),X0=u([P("esri.views.ViewAnimation")],X0),function(t){t.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(X0||(X0={}));const pE=X0,jC=()=>ce(()=>import("./TileLayerView3D-caf854a5.js"),["./TileLayerView3D-caf854a5.js","./LayerView3D-37676199.js","./TiledLayerView3D-1e45b21b.js","./LayerView-a0977cc5.js","./RefreshableLayerView-8347ec95.js","./MapServiceLayerViewHelper-2711483e.js","./floorFilterUtils-73949d2d.js","./normalizeUtils-30f603dc.js","./normalizeUtilsCommon-d91de345.js","./sublayerUtils-df46f33f.js","./drapedUtils-bcda2fa9.js"],import.meta.url),$se=()=>ce(()=>import("./ElevationLayerView3D-86ac62eb.js"),["./ElevationLayerView3D-86ac62eb.js","./LayerView3D-37676199.js","./TiledLayerView3D-1e45b21b.js","./LayerView-a0977cc5.js"],import.meta.url),Lse={"base-dynamic":()=>ce(()=>import("./BaseDynamicLayerView3D-358267e3.js"),["./BaseDynamicLayerView3D-358267e3.js","./DynamicLayerView3D-53c5044f.js","./LayerView3D-37676199.js","./projectExtentUtils-36315f43.js","./ImageMaterial-6510b823.js","./LayerView-a0977cc5.js","./RefreshableLayerView-8347ec95.js"],import.meta.url),"base-elevation":$se,"base-tile":jC,"bing-maps":jC,"building-scene":()=>ce(()=>import("./BuildingSceneLayerView3D-d690069c.js"),["./BuildingSceneLayerView3D-d690069c.js","./BuildingGroupSublayer-417fdfa6.js","./BuildingComponentSublayer-0e2d1e60.js","./WhereClause-e2c9f470.js","./executionError-e8d36121.js","./I3SMeshView3D-6f548258.js","./I3SOverrides-2ae274f6.js","./I3SNode-578bf5fe.js","./meshFeatureSet-a13fd090.js","./MeshGeoreferencedRelativeVertexSpace-1e75ad47.js","./MeshLocalVertexSpace-1b5af9eb.js","./georeference-d7c2d407.js","./External-c7058636.js","./FeatureLayerView3D-491e1beb.js","./FeatureLayerViewBase3D-17b907f9.js","./FeatureLikeLayerView3D-b1bdacd2.js","./dehydratedFeatureComparison-99482a2b.js","./queryForSymbologySnapping-06aa6620.js","./elevationInfoUtils-5cd9d27e.js","./hash-6f442295.js","./Graphics3DObjectStates-df225fb7.js","./optimizedFeatureQueryEngineAdapter-fb0f5985.js","./centroid-3dcadaf5.js","./PooledRBush-46c91161.js","./quickselect-08f30851.js","./floorFilterUtils-73949d2d.js","./QueryEngine-25cd666d.js","./normalizeUtils-30f603dc.js","./normalizeUtilsCommon-d91de345.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-d7352455.js","./generateRendererUtils-9a953fca.js","./FeatureStore-03e4c7a5.js","./BoundsStore-5abd2f82.js","./projectExtentUtils-36315f43.js","./LayerView3D-37676199.js","./query-226efcbe.js","./pbfQueryUtils-dc012b8b.js","./pbf-62deeddb.js","./EventedSet-3977ef56.js","./LayerView-a0977cc5.js","./RefreshableLayerView-8347ec95.js","./SceneModification-08fc7c84.js","./SceneLayerWorker-541768aa.js","./I3SQueryFeatureStore-70a9a8d5.js","./DefinitionExpressionSceneLayerView-d7752e84.js"],import.meta.url),csv:()=>ce(()=>import("./CSVLayerView3D-3abdfa48.js"),["./CSVLayerView3D-3abdfa48.js","./FeatureLayerViewBase3D-17b907f9.js","./FeatureLikeLayerView3D-b1bdacd2.js","./dehydratedFeatureComparison-99482a2b.js","./queryForSymbologySnapping-06aa6620.js","./elevationInfoUtils-5cd9d27e.js","./hash-6f442295.js","./Graphics3DObjectStates-df225fb7.js","./optimizedFeatureQueryEngineAdapter-fb0f5985.js","./centroid-3dcadaf5.js","./PooledRBush-46c91161.js","./quickselect-08f30851.js","./floorFilterUtils-73949d2d.js","./QueryEngine-25cd666d.js","./normalizeUtils-30f603dc.js","./normalizeUtilsCommon-d91de345.js","./WhereClause-e2c9f470.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-d7352455.js","./generateRendererUtils-9a953fca.js","./FeatureStore-03e4c7a5.js","./BoundsStore-5abd2f82.js","./projectExtentUtils-36315f43.js","./LayerView3D-37676199.js","./query-226efcbe.js","./pbfQueryUtils-dc012b8b.js","./pbf-62deeddb.js","./EventedSet-3977ef56.js","./LayerView-a0977cc5.js","./RefreshableLayerView-8347ec95.js"],import.meta.url),dimension:()=>ce(()=>import("./DimensionLayerView3D-4b3a75cd.js"),["./DimensionLayerView3D-4b3a75cd.js","./LayerView3D-37676199.js","./LayerView-a0977cc5.js"],import.meta.url),elevation:$se,feature:()=>ce(()=>import("./FeatureLayerView3D-491e1beb.js"),["./FeatureLayerView3D-491e1beb.js","./FeatureLayerViewBase3D-17b907f9.js","./FeatureLikeLayerView3D-b1bdacd2.js","./dehydratedFeatureComparison-99482a2b.js","./queryForSymbologySnapping-06aa6620.js","./elevationInfoUtils-5cd9d27e.js","./hash-6f442295.js","./Graphics3DObjectStates-df225fb7.js","./optimizedFeatureQueryEngineAdapter-fb0f5985.js","./centroid-3dcadaf5.js","./PooledRBush-46c91161.js","./quickselect-08f30851.js","./floorFilterUtils-73949d2d.js","./QueryEngine-25cd666d.js","./normalizeUtils-30f603dc.js","./normalizeUtilsCommon-d91de345.js","./WhereClause-e2c9f470.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-d7352455.js","./generateRendererUtils-9a953fca.js","./FeatureStore-03e4c7a5.js","./BoundsStore-5abd2f82.js","./projectExtentUtils-36315f43.js","./LayerView3D-37676199.js","./query-226efcbe.js","./pbfQueryUtils-dc012b8b.js","./pbf-62deeddb.js","./EventedSet-3977ef56.js","./LayerView-a0977cc5.js","./RefreshableLayerView-8347ec95.js"],import.meta.url),geojson:()=>ce(()=>import("./GeoJSONLayerView3D-9fb04949.js"),["./GeoJSONLayerView3D-9fb04949.js","./FeatureLayerViewBase3D-17b907f9.js","./FeatureLikeLayerView3D-b1bdacd2.js","./dehydratedFeatureComparison-99482a2b.js","./queryForSymbologySnapping-06aa6620.js","./elevationInfoUtils-5cd9d27e.js","./hash-6f442295.js","./Graphics3DObjectStates-df225fb7.js","./optimizedFeatureQueryEngineAdapter-fb0f5985.js","./centroid-3dcadaf5.js","./PooledRBush-46c91161.js","./quickselect-08f30851.js","./floorFilterUtils-73949d2d.js","./QueryEngine-25cd666d.js","./normalizeUtils-30f603dc.js","./normalizeUtilsCommon-d91de345.js","./WhereClause-e2c9f470.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-d7352455.js","./generateRendererUtils-9a953fca.js","./FeatureStore-03e4c7a5.js","./BoundsStore-5abd2f82.js","./projectExtentUtils-36315f43.js","./LayerView3D-37676199.js","./query-226efcbe.js","./pbfQueryUtils-dc012b8b.js","./pbf-62deeddb.js","./EventedSet-3977ef56.js","./LayerView-a0977cc5.js","./RefreshableLayerView-8347ec95.js"],import.meta.url),graphics:()=>ce(()=>import("./GraphicsLayerView3D-2ae80f4f.js"),["./GraphicsLayerView3D-2ae80f4f.js","./LayerView3D-37676199.js","./queryForSymbologySnapping-06aa6620.js","./elevationInfoUtils-5cd9d27e.js","./GraphicsProcessor-1d636e72.js","./Graphics3DObjectStates-df225fb7.js","./optimizedFeatureQueryEngineAdapter-fb0f5985.js","./centroid-3dcadaf5.js","./PooledRBush-46c91161.js","./quickselect-08f30851.js","./projectExtentUtils-36315f43.js","./LayerView-a0977cc5.js"],import.meta.url),group:()=>ce(()=>import("./GroupLayerView-4b67f322.js"),["./GroupLayerView-4b67f322.js","./LayerView-a0977cc5.js"],import.meta.url),imagery:()=>ce(()=>import("./ImageryLayerView3D-232cacf2.js"),["./ImageryLayerView3D-232cacf2.js","./DynamicLayerView3D-53c5044f.js","./LayerView3D-37676199.js","./projectExtentUtils-36315f43.js","./ImageMaterial-6510b823.js","./LayerView-a0977cc5.js","./RefreshableLayerView-8347ec95.js"],import.meta.url),"integrated-mesh":()=>ce(()=>import("./IntegratedMeshLayerView3D-2f4d4da6.js"),["./IntegratedMeshLayerView3D-2f4d4da6.js","./I3SMeshView3D-6f548258.js","./I3SOverrides-2ae274f6.js","./I3SNode-578bf5fe.js","./meshFeatureSet-a13fd090.js","./MeshGeoreferencedRelativeVertexSpace-1e75ad47.js","./MeshLocalVertexSpace-1b5af9eb.js","./georeference-d7c2d407.js","./External-c7058636.js","./FeatureLayerView3D-491e1beb.js","./FeatureLayerViewBase3D-17b907f9.js","./FeatureLikeLayerView3D-b1bdacd2.js","./dehydratedFeatureComparison-99482a2b.js","./queryForSymbologySnapping-06aa6620.js","./elevationInfoUtils-5cd9d27e.js","./hash-6f442295.js","./Graphics3DObjectStates-df225fb7.js","./optimizedFeatureQueryEngineAdapter-fb0f5985.js","./centroid-3dcadaf5.js","./PooledRBush-46c91161.js","./quickselect-08f30851.js","./floorFilterUtils-73949d2d.js","./QueryEngine-25cd666d.js","./normalizeUtils-30f603dc.js","./normalizeUtilsCommon-d91de345.js","./WhereClause-e2c9f470.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-d7352455.js","./generateRendererUtils-9a953fca.js","./FeatureStore-03e4c7a5.js","./BoundsStore-5abd2f82.js","./projectExtentUtils-36315f43.js","./LayerView3D-37676199.js","./query-226efcbe.js","./pbfQueryUtils-dc012b8b.js","./pbf-62deeddb.js","./EventedSet-3977ef56.js","./LayerView-a0977cc5.js","./RefreshableLayerView-8347ec95.js","./SceneModification-08fc7c84.js","./SceneLayerWorker-541768aa.js"],import.meta.url),"line-of-sight":()=>ce(()=>import("./LineOfSightLayerView3D-2c485c0d.js"),["./LineOfSightLayerView3D-2c485c0d.js","./LayerView3D-37676199.js","./LayerView-a0977cc5.js"],import.meta.url),"map-image":()=>ce(()=>import("./MapImageLayerView3D-ca3abd0d.js"),["./MapImageLayerView3D-ca3abd0d.js","./DynamicLayerView3D-53c5044f.js","./LayerView3D-37676199.js","./projectExtentUtils-36315f43.js","./ImageMaterial-6510b823.js","./LayerView-a0977cc5.js","./RefreshableLayerView-8347ec95.js","./ExportImageParameters-63439772.js","./floorFilterUtils-73949d2d.js","./sublayerUtils-df46f33f.js","./MapServiceLayerViewHelper-2711483e.js","./normalizeUtils-30f603dc.js","./normalizeUtilsCommon-d91de345.js","./drapedUtils-bcda2fa9.js"],import.meta.url),media:()=>ce(()=>import("./MediaLayerView3D-eff35cf1.js"),["./MediaLayerView3D-eff35cf1.js","./MediaElementView-e2e80621.js","./normalizeUtilsSync-2da08523.js","./normalizeUtilsCommon-d91de345.js","./LayerView3D-37676199.js","./ImageMaterial-6510b823.js","./LayerView-a0977cc5.js"],import.meta.url),"ogc-feature":()=>ce(()=>import("./OGCFeatureLayerView3D-11293548.js"),["./OGCFeatureLayerView3D-11293548.js","./FeatureLayerViewBase3D-17b907f9.js","./FeatureLikeLayerView3D-b1bdacd2.js","./dehydratedFeatureComparison-99482a2b.js","./queryForSymbologySnapping-06aa6620.js","./elevationInfoUtils-5cd9d27e.js","./hash-6f442295.js","./Graphics3DObjectStates-df225fb7.js","./optimizedFeatureQueryEngineAdapter-fb0f5985.js","./centroid-3dcadaf5.js","./PooledRBush-46c91161.js","./quickselect-08f30851.js","./floorFilterUtils-73949d2d.js","./QueryEngine-25cd666d.js","./normalizeUtils-30f603dc.js","./normalizeUtilsCommon-d91de345.js","./WhereClause-e2c9f470.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-d7352455.js","./generateRendererUtils-9a953fca.js","./FeatureStore-03e4c7a5.js","./BoundsStore-5abd2f82.js","./projectExtentUtils-36315f43.js","./LayerView3D-37676199.js","./query-226efcbe.js","./pbfQueryUtils-dc012b8b.js","./pbf-62deeddb.js","./EventedSet-3977ef56.js","./LayerView-a0977cc5.js","./RefreshableLayerView-8347ec95.js"],import.meta.url),"open-street-map":jC,"oriented-imagery":()=>ce(()=>import("./FeatureLayerView3D-491e1beb.js"),["./FeatureLayerView3D-491e1beb.js","./FeatureLayerViewBase3D-17b907f9.js","./FeatureLikeLayerView3D-b1bdacd2.js","./dehydratedFeatureComparison-99482a2b.js","./queryForSymbologySnapping-06aa6620.js","./elevationInfoUtils-5cd9d27e.js","./hash-6f442295.js","./Graphics3DObjectStates-df225fb7.js","./optimizedFeatureQueryEngineAdapter-fb0f5985.js","./centroid-3dcadaf5.js","./PooledRBush-46c91161.js","./quickselect-08f30851.js","./floorFilterUtils-73949d2d.js","./QueryEngine-25cd666d.js","./normalizeUtils-30f603dc.js","./normalizeUtilsCommon-d91de345.js","./WhereClause-e2c9f470.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-d7352455.js","./generateRendererUtils-9a953fca.js","./FeatureStore-03e4c7a5.js","./BoundsStore-5abd2f82.js","./projectExtentUtils-36315f43.js","./LayerView3D-37676199.js","./query-226efcbe.js","./pbfQueryUtils-dc012b8b.js","./pbf-62deeddb.js","./EventedSet-3977ef56.js","./LayerView-a0977cc5.js","./RefreshableLayerView-8347ec95.js"],import.meta.url),"point-cloud":()=>ce(()=>import("./PointCloudLayerView3D-434d45bd.js").then(t=>t.P),["./PointCloudLayerView3D-434d45bd.js","./LayerView3D-37676199.js","./PointCloudWorkerUtil-d5050fe2.js","./PointCloudUniqueValueRenderer-957e7fdd.js","./PopupSceneLayerView-1c2b1064.js","./LayerView-a0977cc5.js"],import.meta.url),voxel:()=>ce(()=>import("./VoxelLayerView3D-df4c8e8d.js"),["./VoxelLayerView3D-df4c8e8d.js","./LayerView3D-37676199.js","./PopupSceneLayerView-1c2b1064.js","./LayerView-a0977cc5.js"],import.meta.url),route:()=>ce(()=>import("./RouteLayerView3D-e877b3c2.js"),["./RouteLayerView3D-e877b3c2.js","./Stop-d1d7b443.js","./LayerView3D-37676199.js","./GraphicsProcessor-1d636e72.js","./Graphics3DObjectStates-df225fb7.js","./optimizedFeatureQueryEngineAdapter-fb0f5985.js","./centroid-3dcadaf5.js","./PooledRBush-46c91161.js","./quickselect-08f30851.js","./projectExtentUtils-36315f43.js","./EventedSet-3977ef56.js","./LayerView-a0977cc5.js"],import.meta.url),scene:t=>t.profile==null||t.profile==="mesh-pyramids"?ce(()=>import("./SceneLayerView3D-0701aa80.js"),["./SceneLayerView3D-0701aa80.js","./I3SOverrides-2ae274f6.js","./I3SNode-578bf5fe.js","./meshFeatureSet-a13fd090.js","./MeshGeoreferencedRelativeVertexSpace-1e75ad47.js","./MeshLocalVertexSpace-1b5af9eb.js","./georeference-d7c2d407.js","./External-c7058636.js","./FeatureLayerView3D-491e1beb.js","./FeatureLayerViewBase3D-17b907f9.js","./FeatureLikeLayerView3D-b1bdacd2.js","./dehydratedFeatureComparison-99482a2b.js","./queryForSymbologySnapping-06aa6620.js","./elevationInfoUtils-5cd9d27e.js","./hash-6f442295.js","./Graphics3DObjectStates-df225fb7.js","./optimizedFeatureQueryEngineAdapter-fb0f5985.js","./centroid-3dcadaf5.js","./PooledRBush-46c91161.js","./quickselect-08f30851.js","./floorFilterUtils-73949d2d.js","./QueryEngine-25cd666d.js","./normalizeUtils-30f603dc.js","./normalizeUtilsCommon-d91de345.js","./WhereClause-e2c9f470.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-d7352455.js","./generateRendererUtils-9a953fca.js","./FeatureStore-03e4c7a5.js","./BoundsStore-5abd2f82.js","./projectExtentUtils-36315f43.js","./LayerView3D-37676199.js","./query-226efcbe.js","./pbfQueryUtils-dc012b8b.js","./pbf-62deeddb.js","./EventedSet-3977ef56.js","./LayerView-a0977cc5.js","./RefreshableLayerView-8347ec95.js","./I3SMeshView3D-6f548258.js","./SceneModification-08fc7c84.js","./SceneLayerWorker-541768aa.js","./SceneLayerView-e0797e21.js","./DefinitionExpressionSceneLayerView-d7752e84.js","./I3SQueryFeatureStore-70a9a8d5.js","./PopupSceneLayerView-1c2b1064.js"],import.meta.url):ce(()=>import("./SceneLayerGraphicsView3D-b54ed5df.js"),["./SceneLayerGraphicsView3D-b54ed5df.js","./I3SOverrides-2ae274f6.js","./I3SNode-578bf5fe.js","./meshFeatureSet-a13fd090.js","./MeshGeoreferencedRelativeVertexSpace-1e75ad47.js","./MeshLocalVertexSpace-1b5af9eb.js","./georeference-d7c2d407.js","./External-c7058636.js","./FeatureLayerView3D-491e1beb.js","./FeatureLayerViewBase3D-17b907f9.js","./FeatureLikeLayerView3D-b1bdacd2.js","./dehydratedFeatureComparison-99482a2b.js","./queryForSymbologySnapping-06aa6620.js","./elevationInfoUtils-5cd9d27e.js","./hash-6f442295.js","./Graphics3DObjectStates-df225fb7.js","./optimizedFeatureQueryEngineAdapter-fb0f5985.js","./centroid-3dcadaf5.js","./PooledRBush-46c91161.js","./quickselect-08f30851.js","./floorFilterUtils-73949d2d.js","./QueryEngine-25cd666d.js","./normalizeUtils-30f603dc.js","./normalizeUtilsCommon-d91de345.js","./WhereClause-e2c9f470.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-d7352455.js","./generateRendererUtils-9a953fca.js","./FeatureStore-03e4c7a5.js","./BoundsStore-5abd2f82.js","./projectExtentUtils-36315f43.js","./LayerView3D-37676199.js","./query-226efcbe.js","./pbfQueryUtils-dc012b8b.js","./pbf-62deeddb.js","./EventedSet-3977ef56.js","./LayerView-a0977cc5.js","./RefreshableLayerView-8347ec95.js","./SceneLayerView-e0797e21.js","./DefinitionExpressionSceneLayerView-d7752e84.js","./PopupSceneLayerView-1c2b1064.js"],import.meta.url),stream:()=>ce(()=>import("./StreamLayerView3D-07bbc853.js"),["./StreamLayerView3D-07bbc853.js","./StreamFeatureManager-af4e8b54.js","./createConnection-a3bb5643.js","./query-226efcbe.js","./normalizeUtils-30f603dc.js","./normalizeUtilsCommon-d91de345.js","./pbfQueryUtils-dc012b8b.js","./pbf-62deeddb.js","./EventedSet-3977ef56.js","./FeatureLikeLayerView3D-b1bdacd2.js","./dehydratedFeatureComparison-99482a2b.js","./queryForSymbologySnapping-06aa6620.js","./elevationInfoUtils-5cd9d27e.js","./hash-6f442295.js","./Graphics3DObjectStates-df225fb7.js","./optimizedFeatureQueryEngineAdapter-fb0f5985.js","./centroid-3dcadaf5.js","./PooledRBush-46c91161.js","./quickselect-08f30851.js","./floorFilterUtils-73949d2d.js","./QueryEngine-25cd666d.js","./WhereClause-e2c9f470.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-d7352455.js","./generateRendererUtils-9a953fca.js","./FeatureStore-03e4c7a5.js","./BoundsStore-5abd2f82.js","./projectExtentUtils-36315f43.js","./LayerView3D-37676199.js","./LayerView-a0977cc5.js"],import.meta.url),tile:jC,"imagery-tile":()=>ce(()=>import("./ImageryTileLayerView3D-9cac07d5.js"),["./ImageryTileLayerView3D-9cac07d5.js","./LayerView3D-37676199.js","./TiledLayerView3D-1e45b21b.js","./rasterProjectionHelper-c683c451.js","./LayerView-a0977cc5.js","./RefreshableLayerView-8347ec95.js","./drapedUtils-bcda2fa9.js"],import.meta.url),"vector-tile":()=>ce(()=>import("./VectorTileLayerView3D-68c4e7c9.js"),["./VectorTileLayerView3D-68c4e7c9.js","./Rect-98da58d6.js","./pbf-62deeddb.js","./rasterizingUtils-148c6894.js","./TileInfoView-876674a7.js","./definitions-128afd1b.js","./number-e491b09e.js","./GeometryUtils-0258f920.js","./StyleRepository-d49b90c1.js","./colorUtils-c0f43caf.js","./TileClipper-ae6eca9e.js","./LayerView3D-37676199.js","./TiledLayerView3D-1e45b21b.js","./LayerView-a0977cc5.js"],import.meta.url),wcs:()=>ce(()=>import("./ImageryTileLayerView3D-9cac07d5.js"),["./ImageryTileLayerView3D-9cac07d5.js","./LayerView3D-37676199.js","./TiledLayerView3D-1e45b21b.js","./rasterProjectionHelper-c683c451.js","./LayerView-a0977cc5.js","./RefreshableLayerView-8347ec95.js","./drapedUtils-bcda2fa9.js"],import.meta.url),"web-tile":jC,wfs:()=>ce(()=>import("./WFSLayerView3D-d5c14067.js"),["./WFSLayerView3D-d5c14067.js","./FeatureLayerViewBase3D-17b907f9.js","./FeatureLikeLayerView3D-b1bdacd2.js","./dehydratedFeatureComparison-99482a2b.js","./queryForSymbologySnapping-06aa6620.js","./elevationInfoUtils-5cd9d27e.js","./hash-6f442295.js","./Graphics3DObjectStates-df225fb7.js","./optimizedFeatureQueryEngineAdapter-fb0f5985.js","./centroid-3dcadaf5.js","./PooledRBush-46c91161.js","./quickselect-08f30851.js","./floorFilterUtils-73949d2d.js","./QueryEngine-25cd666d.js","./normalizeUtils-30f603dc.js","./normalizeUtilsCommon-d91de345.js","./WhereClause-e2c9f470.js","./executionError-e8d36121.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-d7352455.js","./generateRendererUtils-9a953fca.js","./FeatureStore-03e4c7a5.js","./BoundsStore-5abd2f82.js","./projectExtentUtils-36315f43.js","./LayerView3D-37676199.js","./query-226efcbe.js","./pbfQueryUtils-dc012b8b.js","./pbf-62deeddb.js","./EventedSet-3977ef56.js","./LayerView-a0977cc5.js","./RefreshableLayerView-8347ec95.js"],import.meta.url),wms:()=>ce(()=>import("./WMSLayerView3D-9f99f3d4.js"),["./WMSLayerView3D-9f99f3d4.js","./DynamicLayerView3D-53c5044f.js","./LayerView3D-37676199.js","./projectExtentUtils-36315f43.js","./ImageMaterial-6510b823.js","./LayerView-a0977cc5.js","./RefreshableLayerView-8347ec95.js","./ExportWMSImageParameters-23c3fbb7.js"],import.meta.url),wmts:()=>ce(()=>import("./WMTSLayerView3D-21192cca.js"),["./WMTSLayerView3D-21192cca.js","./LayerView3D-37676199.js","./TiledLayerView3D-1e45b21b.js","./LayerView-a0977cc5.js","./RefreshableLayerView-8347ec95.js"],import.meta.url),"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null,video:null};function WZe(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",r=e.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new V(`${r}:view-not-supported`,`${e} is not supported in 3D`)}const Dse={hasLayerViewModule:t=>Lse[t.type]!=null,importLayerView:t=>{const e=Lse[t.type];if(e==null)throw WZe(t);return e(t)}},Nse="analyses-owner-handles";var BS,Ab;(function(t){t[t.PENDING=0]="PENDING",t[t.CREATED=1]="CREATED"})(BS||(BS={})),function(t){t[t.ADDED=0]="ADDED",t[t.REMOVED=1]="REMOVED"}(Ab||(Ab={}));let tb=class extends OR{constructor(e){super(e),this._allAnalysisViews=new Pt,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=Fse(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(kr("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(kr()),this._attachedToViewResolver=Fse()}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const r=this._items.get(e);if(r==null||r.state.list===Ab.REMOVED)throw new V("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return r.createAnalysisViewTask.promise}_connectOwners(){this.handles.add(this._connectAnalysesCollection(this.view.analyses),Nse)}_disconnectOwners(){this.handles.remove(Nse),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const s of e)this._addAnalysis(s);const r=e.on("after-add",s=>this._addAnalysis(s.item)),i=e.on("after-remove",s=>this._removeAnalysis(s.item));return{remove:()=>{r.remove(),i.remove();for(const s of e)this._removeAnalysis(s)}}}_addAnalysis(e){const r=this._items.get(e);if(r==null){const i={state:{view:BS.PENDING,list:Ab.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,i),i.createAnalysisViewTask=jE(s=>this._createAnalysisViewPromise(i,s))}else r.state.list=Ab.ADDED}_removeAnalysis(e){const r=this._items.get(e);r!=null?(r.state.list=Ab.REMOVED,this._scheduleUpdate()):Q.getLogger(this).error("Trying to remove analysis which was not added")}_scheduleUpdate(){this._scheduledUpdateHandle==null&&(this._scheduledUpdateHandle=VE(()=>this._update()))}_update(){this._scheduledUpdateHandle=Ni(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===Ab.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case BS.PENDING:e.createAnalysisViewTask=Ll(e.createAnalysisViewTask);break;case BS.CREATED:e.view!=null&&(this._allAnalysisViews.remove(e.view),e.view=$e(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,r){const i=e.analysis,s=i.type,n=this._analysisModules[s];if(this._creatingViewCount+=1,n.module==null)try{n.module=await this._loadAnalysisModule(s)}catch(a){throw this._creatingViewCount-=1,a}if(An(r))throw this._creatingViewCount-=1,kr("AnalysisView creation aborted");const o=new n.module.default({analysis:i,view:this.view});try{await o.when()}catch(a){throw this._creatingViewCount-=1,a}if(An(r))throw this._creatingViewCount-=1,o.destroy(),kr("AnalysisView creation aborted");return e.view=o,e.state.view=BS.CREATED,this._allAnalysisViews.add(o),this._creatingViewCount-=1,o}_loadAnalysisModule(e){switch(e){case"area-measurement":return ce(()=>import("./AreaMeasurementAnalysisView3D-d72f3f7f.js").then(r=>r.A),["./AreaMeasurementAnalysisView3D-d72f3f7f.js","./UnitNormalizer-e9c3d9ea.js","./Segment-c54f3ffd.js","./unitFormatUtils-092d1121.js","./LineVisualElement-94455a83.js","./elevationInfoUtils-5cd9d27e.js","./geometryEngine-6e18cfbc.js","./geometryEngineBase-c1c9526a.js","./hydrated-bc13ab24.js","./EditGeometryOperations-767061eb.js"],import.meta.url);case"dimension":return ce(()=>import("./DimensionAnalysisView3D-0343a33f.js").then(r=>r.D),["./DimensionAnalysisView3D-0343a33f.js","./LineVisualElement-94455a83.js","./LengthDimension-c402a7cc.js","./Segment-c54f3ffd.js","./unitFormatUtils-092d1121.js","./elevationInfoUtils-5cd9d27e.js","./analysisViewUtils-3cff21a1.js","./ImageMaterial-6510b823.js","./Factory-226bb5ef.js","./RightAngleQuadVisualElement-9d15901a.js","./VisualElementResources-1492c044.js","./PointVisualElement-92e959a5.js","./EditGeometryOperations-767061eb.js","./dehydratedFeatureComparison-99482a2b.js"],import.meta.url);case"direct-line-measurement":return ce(()=>import("./DirectLineMeasurementAnalysisView3D-e9fa0381.js").then(r=>r.D),["./DirectLineMeasurementAnalysisView3D-e9fa0381.js","./UnitNormalizer-e9c3d9ea.js","./Segment-c54f3ffd.js","./unitFormatUtils-092d1121.js","./LineVisualElement-94455a83.js","./elevationInfoUtils-5cd9d27e.js","./geometryEngine-6e18cfbc.js","./geometryEngineBase-c1c9526a.js","./hydrated-bc13ab24.js","./RightAngleQuadVisualElement-9d15901a.js","./VisualElementResources-1492c044.js"],import.meta.url);case"line-of-sight":return ce(()=>import("./LineOfSightAnalysisView3D-c07340d3.js"),["./LineOfSightAnalysisView3D-c07340d3.js","./LineVisualElement-94455a83.js","./LineOfSightAnalysisTarget-ca580b80.js","./elevationInfoUtils-5cd9d27e.js","./analysisViewUtils-3cff21a1.js","./ImageMaterial-6510b823.js","./PointVisualElement-92e959a5.js","./VisualElementResources-1492c044.js"],import.meta.url);case"slice":return ce(()=>import("./SliceAnalysisView3D-447ca2a4.js").then(r=>r.S),["./SliceAnalysisView3D-447ca2a4.js","./LineVisualElement-94455a83.js","./BuildingComponentSublayer-0e2d1e60.js","./analysisViewUtils-3cff21a1.js","./ImageMaterial-6510b823.js","./Factory-226bb5ef.js"],import.meta.url)}}};function Fse(){const t=xo();return t.promise.catch(()=>{}),t}u([d()],tb.prototype,"updating",null),u([d({constructOnly:!0})],tb.prototype,"view",void 0),u([d()],tb.prototype,"_allAnalysisViews",void 0),u([d()],tb.prototype,"_creatingViewCount",void 0),tb=u([P("esri.views.3d.analysis.AnalysisViewManager3D")],tb);const XZe=tb;let gg=class extends we{constructor(e){super(e),this.collision=new I3,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===Ue.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==Ue.Local?this._set("altitude",e):Q.getLogger(this).warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?ve(e,this.altitude.min,this.altitude.max):e}clampTilt(e,r){if(!this.tilt)return r;const i=this.tilt(e);return ve(r,i.min,i.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===Ue.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(r,i=S9)=>(i.min=No.min,i.max=e,i)}_createDefaultTiltLocal(){const e=this.collision.enabled?jD([[4e3,No.max],[1e4,Ft(88)],[6e6,Ft(88)]]):()=>No.max;return(r,i=S9)=>(i.min=No.min,i.max=e(r),i)}_createDefaultTiltGlobal(){const e=this.collision.enabled?jD([[4e3,No.max],[5e4,Ft(88)],[6e6,Ft(88)],[2e7,No.min]]):jD([[3e5,No.max],[3e6,Ft(88)],[6e6,Ft(88)],[2e7,No.min]]);return(r,i=S9)=>(i.min=No.min,i.max=e(r),i)}};function ZZe(t){return{min:-2e5,max:4*t.radius}}u([d()],gg.prototype,"altitude",null),u([d({readOnly:!0})],gg.prototype,"collision",void 0),u([d()],gg.prototype,"distance",void 0),u([d({readOnly:!0})],gg.prototype,"minimumPoiDistance",void 0),u([d()],gg.prototype,"tilt",void 0),u([d({constructOnly:!0})],gg.prototype,"mode",void 0),gg=u([P("esri.views.3d.state.Constraints")],gg);const Use=ZZe(or),No={min:Ft(.5),max:Ft(179.5)},S9={min:0,max:0};let I3=class extends we{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};u([d({type:Boolean})],I3.prototype,"enabled",void 0),u([d({type:Number})],I3.prototype,"elevationMargin",void 0),I3=u([P("esri.views.3d.state.Constraints.CollisionConstraint")],I3);let GS=class extends we{constructor(){super(...arguments),this.min=Use.min,this.max=Use.max}};u([d({type:Number})],GS.prototype,"min",void 0),u([d({type:Number})],GS.prototype,"max",void 0),GS=u([P("esri.views.3d.constraints.AltitudeConstraint")],GS);let Ag=class extends we{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,r){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==r&&this._set("far",r))}};u([d({type:Number,value:1e-8})],Ag.prototype,"near",null),u([wr("near")],Ag.prototype,"castNear",null),u([d({type:Number,value:1e-8})],Ag.prototype,"far",null),u([wr("far")],Ag.prototype,"castFar",null),u([d({type:["auto","manual"]})],Ag.prototype,"mode",void 0),Ag=u([P("esri.views.3d.constraints.ClipDistanceConstraint")],Ag);const Xj={min:rl(No.min),max:rl(No.max)};let Ob=class extends we{constructor(){super(...arguments),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return ve(e,Xj.min,Xj.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};u([d({type:["auto","manual"]})],Ob.prototype,"mode",void 0),u([d({type:Number,value:Xj.max})],Ob.prototype,"max",null),u([wr("max")],Ob.prototype,"castMax",null),Ob=u([P("esri.views.3d.constraints.TiltConstraint")],Ob);let Rb=class extends we{constructor(){super(...arguments),this.tilt=new Ob,this.altitude=new GS,this.clipDistance=new Ag}};u([d({type:Ob})],Rb.prototype,"tilt",void 0),u([d({type:GS})],Rb.prototype,"altitude",void 0),u([d({type:Ag})],Rb.prototype,"clipDistance",void 0),Rb=u([P("esri.views.3d.constraints.Constraints")],Rb);var Zj;let sh=Zj=class extends le{constructor(t){super(t),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(t,e){return e.datetime!=null&&new Date(e.datetime)||null}writeDate(t,e,r){e[r]=t.getTime()}readDirectShadowsEnabled(t,e){return!!e.directShadows}writedirectShadowsEnabled(t,e,r){t&&(e[r]=t)}writeDisplayUTCOffset(t,e){t!=null&&(e.displayUTCOffset=t)}clone(){return new Zj(this.cloneConstructProperties())}cloneConstructProperties(){const t={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(t.date=new Date(this.date.getTime())),t}};u([d({readOnly:!0,type:["sun"],json:{write:!0}})],sh.prototype,"type",void 0),u([d({type:Date,json:{type:Number,write:{target:"datetime"}}})],sh.prototype,"date",void 0),u([Ae("date",["datetime"])],sh.prototype,"readDate",null),u([ke("date")],sh.prototype,"writeDate",null),u([d({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],sh.prototype,"directShadowsEnabled",void 0),u([Ae("directShadowsEnabled",["directShadows"])],sh.prototype,"readDirectShadowsEnabled",null),u([ke("directShadowsEnabled")],sh.prototype,"writedirectShadowsEnabled",null),u([d({type:Number,json:{write:!0}})],sh.prototype,"displayUTCOffset",void 0),u([ke("displayUTCOffset")],sh.prototype,"writeDisplayUTCOffset",null),sh=Zj=u([P("esri.webscene.SunLighting")],sh);const kR=sh;var uS;const Axe="esri.views.3d.environment.SunLighting",MI=Q.getLogger(Axe);let mf=uS=class extends ws.EventedMixin(kR){constructor(t){super(t),this.cameraTrackingEnabled=!0,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const e=new Date().getFullYear(),r=new Date("March 15, "+e+" 12:00:00 UTC");this._set("defaultDate",r),this._set("date",r)}get ambientOcclusionEnabled(){return rp(MI,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(t){rp(MI,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._set("ambientOcclusionEnabled",t)}get waterReflectionEnabled(){return rp(MI,"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"}),this._get("waterReflectionEnabled")??!1}set waterReflectionEnabled(t){rp(MI,"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"}),this._set("waterReflectionEnabled",t)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(t){return new uS(t.cloneConstructProperties())}set defaultDate(t){const e=this._get("date")===this._get("defaultDate");t=new Date(t.getTime()),this._set("defaultDate",t),e&&this._set("date",t)}set date(t){t!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(t.getTime())))}autoUpdate(t,e){const r=uS.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=e.hours,this.positionTimezoneInfo.minutes=e.minutes,this.positionTimezoneInfo.seconds=e.seconds;let i=null;t!=null&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(t.getTime())?(i=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(i=this.date&&this.date.getTime(),this._set("date",new Date(t.getTime()))));const s=uS.calculateTimezoneOffset(this.positionTimezoneInfo);if(r!==s&&(PI.target=this,PI.timezoneOffset=s,this.emit("timezone-will-change",PI),PI.target=null),t!=null)return isNaN(t.getTime())||i!==t.getTime()}clone(){const t=this._get("date")===this._get("defaultDate"),e=new uS({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled});return t&&e._set("date",e._get("defaultDate")),e.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,e.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,e.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,e.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,e}cloneWithWebsceneLighting(t){const e=this.clone();return t.date!=null&&(e.date=t.date),e.directShadowsEnabled=t.directShadowsEnabled,e.displayUTCOffset=t.displayUTCOffset,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};u([d({type:Boolean})],mf.prototype,"cameraTrackingEnabled",void 0),u([d({type:Boolean})],mf.prototype,"ambientOcclusionEnabled",null),u([d({type:Boolean})],mf.prototype,"waterReflectionEnabled",null),u([d({type:Date})],mf.prototype,"defaultDate",null),u([d({type:Date})],mf.prototype,"date",null),mf=uS=u([P(Axe)],mf),function(t){function e({hours:r,minutes:i,seconds:s}){return Math.round(r+i/60+s/3600)}t.calculateTimezoneOffset=e}(mf||(mf={}));const PI={target:null,timezoneOffset:0},Z0=mf;var Yj;let $3=Yj=class extends le{constructor(t){super(t),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new Yj(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};u([d({readOnly:!0,type:["virtual"],json:{write:!0}})],$3.prototype,"type",void 0),u([d({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],$3.prototype,"directShadowsEnabled",void 0),$3=Yj=u([P("esri.webscene.VirtualLighting")],$3);const K6=$3;var JD;const Oxe="esri.views.3d.environment.VirtualLighting",II=Q.getLogger(Oxe);let hS=JD=class extends ws.EventedMixin(K6){constructor(t){super(t),this.cameraTrackingEnabled=!0}get ambientOcclusionEnabled(){return rp(II,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(t){rp(II,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._set("ambientOcclusionEnabled",t)}get waterReflectionEnabled(){return rp(II,"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"}),this._get("waterReflectionEnabled")??!1}set waterReflectionEnabled(t){rp(II,"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"}),this._set("waterReflectionEnabled",t)}clone(){return new JD({...this.cloneConstructProperties(),cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(t){return new JD(t.cloneConstructProperties())}cloneWithWebsceneLighting(t){const e=this.clone();return e.directShadowsEnabled=t.directShadowsEnabled,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};u([d({type:Boolean})],hS.prototype,"ambientOcclusionEnabled",null),u([d({type:Boolean})],hS.prototype,"waterReflectionEnabled",null),u([d({type:Boolean})],hS.prototype,"cameraTrackingEnabled",void 0),hS=JD=u([P(Oxe)],hS);const L3=hS,YZe={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:Z0,virtual:L3}};var Jj;let FO=Jj=class extends we{set quality(t){["low","high"].includes(t)&&this._set("quality",t)}clone(){return new Jj({quality:this.quality})}};u([d({type:["low","high"],value:"low"})],FO.prototype,"quality",null),FO=Jj=u([P("esri.views.3d.environment.SceneViewAtmosphere")],FO);var Qj;let D3=Qj=class extends le{constructor(t){super(t),this.type="sunny",this.cloudCover=.5}clone(){return new Qj({cloudCover:this.cloudCover})}};u([it({sunny:"sunny"})],D3.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],D3.prototype,"cloudCover",void 0),D3=Qj=u([P("esri.views.3d.environment.SunnyWeather")],D3);const Kj=D3;var eH;let N3=eH=class extends le{constructor(t){super(t),this.type="cloudy",this.cloudCover=.5}clone(){return new eH({cloudCover:this.cloudCover})}};u([it({cloudy:"cloudy"})],N3.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],N3.prototype,"cloudCover",void 0),N3=eH=u([P("esri.views.3d.environment.CloudyWeather")],N3);const JZe=N3;var tH;let F3=tH=class extends le{constructor(t){super(t),this.type="foggy",this.fogStrength=.5}clone(){return new tH({fogStrength:this.fogStrength})}};u([it({foggy:"foggy"})],F3.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],F3.prototype,"fogStrength",void 0),F3=tH=u([P("esri.views.3d.environment.FoggyWeather")],F3);const QZe=F3;var rH;let dS=rH=class extends le{constructor(t){super(t),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new rH({cloudCover:this.cloudCover,precipitation:this.precipitation})}};u([it({rainy:"rainy"})],dS.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],dS.prototype,"cloudCover",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],dS.prototype,"precipitation",void 0),dS=rH=u([P("esri.views.3d.environment.RainyWeather")],dS);const KZe=dS;var iH;let rb=iH=class extends le{constructor(t){super(t),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new iH({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};u([it({snowy:"snowy"})],rb.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],rb.prototype,"cloudCover",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],rb.prototype,"precipitation",void 0),u([d({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],rb.prototype,"snowCover",void 0),rb=iH=u([P("esri.views.3d.environment.SnowyWeather")],rb);const eYe=rb,Rxe={key:"type",base:Kj,typeMap:{sunny:Kj,cloudy:JZe,rainy:KZe,snowy:eYe,foggy:QZe}},tYe=Object.keys(Rxe.typeMap);function rYe(t,e){return!!tYe.includes(t)||(e.error(`"${t}" is not a valid weather type`),!1)}const Of=1e4,iYe={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:kR,virtual:K6}};let QD=class extends le{constructor(e){super(e)}clone(){}};u([d({readOnly:!0,json:{read:!1}})],QD.prototype,"type",void 0),QD=u([P("esri.webscene.background.Background")],QD);const Mxe=QD;var sH;const sYe={...wy,nonNullable:!0};let U3=sH=class extends Mxe{constructor(t){super(t),this.type="color",this.color=new Ne([0,0,0,1])}clone(){return new sH(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};u([it({color:"color"},{readOnly:!0})],U3.prototype,"type",void 0),u([d(sYe)],U3.prototype,"color",void 0),U3=sH=u([P("esri.webscene.background.ColorBackground")],U3);const Pxe=U3,kse={base:Mxe,key:"type",typeMap:{color:Pxe}};function nYe(t){return(e,r,i)=>{if(!e)return e;for(const s in t.typeMap)if(e.type===s){const n=new t.typeMap[s];return n.read(e,i),n}}}const oYe={types:kse,json:{read:nYe(kse),write:{overridePolicy:(t,e,r)=>({enabled:!r||!r.isPresentation})}}};var nH;const Ixe="esri.webscene.Environment",aYe=Q.getLogger(Ixe),zse=(t,e,r)=>({enabled:!r||!r.isPresentation});let Y0=nH=class extends le{constructor(t){super(t),this.lighting=new kR,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(t){rYe(t?.type,aYe)&&this._set("weather",t)}clone(){return new nH(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?K6.prototype.clone.call(this.lighting):kR.prototype.clone.call(this.lighting),background:K(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};u([d({types:iYe,nonNullable:!0,json:{write:!0}})],Y0.prototype,"lighting",void 0),u([d(oYe)],Y0.prototype,"background",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:zse}}})],Y0.prototype,"atmosphereEnabled",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:zse}}})],Y0.prototype,"starsEnabled",void 0),u([d({types:Rxe,nonNullable:!0,json:{write:!0},value:new Kj})],Y0.prototype,"weather",null),Y0=nH=u([P(Ixe)],Y0);const $xe=Y0;var k3;let pS=k3=class extends $xe{constructor(t){super(t),this.atmosphere=new FO,this.lighting=new Z0,this.cachedCameraTrackingEnabled=null}static fromWebsceneEnvironment(t){const e=t.cloneConstructProperties();return new k3({...e,lighting:e.lighting?e.lighting.type==="virtual"?L3.fromWebsceneLighting(e.lighting):Z0.fromWebsceneLighting(e.lighting):void 0})}castLighting(t){return this._convertLighting(t)}applyLighting(t){this.lighting=this._convertLighting(t)}_convertLighting(t){return t?t instanceof Z0||t instanceof L3?t:t instanceof kR?this.lighting&&this.lighting.type!=="virtual"?this.lighting.cloneWithWebsceneLighting(t):new Z0({...t.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):t instanceof K6?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t):new L3({...t.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):bp(YZe,t):new Z0}clone(){return new k3({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:K(this.background)})}cloneWithWebsceneEnvironment(t){return new k3({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:K(this.background),...t.cloneConstructProperties(),lighting:this._getLighting(t)})}_getLighting(t){switch(t.lighting.type){case"sun":return this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(t.lighting):Z0.fromWebsceneLighting(t.lighting);case"virtual":return this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t.lighting):L3.fromWebsceneLighting(t.lighting);default:return t.lighting,Z0.fromWebsceneLighting(t.lighting)}}};u([d({type:FO,json:{read:!1},nonNullable:!0})],pS.prototype,"atmosphere",void 0),u([d({nonNullable:!0})],pS.prototype,"lighting",void 0),u([wr("lighting")],pS.prototype,"castLighting",null),pS=k3=u([P("esri.views.3d.environment.SceneViewEnvironment")],pS);const fS=pS;var ia;(function(t){t[t.Realistic=0]="Realistic",t[t.Local=1]="Local",t[t.Mars=2]="Mars",t[t.None=3]="None"})(ia||(ia={}));function fn(t,e){return t[0]=e[0],t[1]=e[1],t}function ar(t,e,r){return t[0]=e,t[1]=r,t}function Wd(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function $f(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function nJ(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function Lxe(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function lYe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function cYe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function uYe(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t}function hYe(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t}function dYe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function yc(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function pYe(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t}function Iw(t,e){const r=e[0]-t[0],i=e[1]-t[1];return Math.sqrt(r*r+i*i)}function K4(t,e){const r=e[0]-t[0],i=e[1]-t[1];return r*r+i*i}function oJ(t){const e=t[0],r=t[1];return Math.sqrt(e*e+r*r)}function Dxe(t){const e=t[0],r=t[1];return e*e+r*r}function aJ(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Nxe(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function zR(t,e){const r=e[0],i=e[1];let s=r*r+i*i;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s),t}function rn(t,e){return t[0]*e[0]+t[1]*e[1]}function fYe(t,e,r){const i=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=i,t}function wh(t,e,r,i){const s=e[0],n=e[1];return t[0]=s+i*(r[0]-s),t[1]=n+i*(r[1]-n),t}function mYe(t,e){e=e||1;const r=2*EM()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t}function Fxe(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[2]*s,t[1]=r[1]*i+r[3]*s,t}function ib(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[2]*s+r[4],t[1]=r[1]*i+r[3]*s+r[5],t}function gYe(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[3]*s+r[6],t[1]=r[1]*i+r[4]*s+r[7],t}function yYe(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[4]*s+r[12],t[1]=r[1]*i+r[5]*s+r[13],t}function _Ye(t,e,r,i){const s=e[0]-r[0],n=e[1]-r[1],o=Math.sin(i),a=Math.cos(i);return t[0]=s*a-n*o+r[0],t[1]=s*o+n*a+r[1],t}function vYe(t,e){const r=t[0],i=t[1],s=e[0],n=e[1];let o=r*r+i*i;o>0&&(o=1/Math.sqrt(o));let a=s*s+n*n;a>0&&(a=1/Math.sqrt(a));const l=(r*s+i*n)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function bYe(t){return"vec2("+t[0]+", "+t[1]+")"}function Uxe(t,e){return t[0]===e[0]&&t[1]===e[1]}function kxe(t,e){const r=t[0],i=t[1],s=e[0],n=e[1],o=sl();return Math.abs(r-s)<=o*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-n)<=o*Math.max(1,Math.abs(i),Math.abs(n))}function wYe(t,e,r,i,s){let n=e[0]-r[0],o=e[1]-r[1];const a=(i[0]*n+i[1]*o)*(s-1);return n=i[0]*a,o=i[1]*a,t[0]=e[0]+n,t[1]=e[1]+o,t}const xYe=oJ,zxe=$f,TYe=nJ,SYe=Lxe,Vxe=Iw,EYe=K4,CYe=Dxe;Object.freeze(Object.defineProperty({__proto__:null,add:Wd,angle:vYe,ceil:lYe,copy:fn,cross:fYe,dist:Vxe,distance:Iw,div:SYe,divide:Lxe,dot:rn,equals:kxe,exactEquals:Uxe,floor:cYe,inverse:Nxe,len:xYe,length:oJ,lerp:wh,max:hYe,min:uYe,mul:TYe,multiply:nJ,negate:aJ,normalize:zR,projectAndScale:wYe,random:mYe,rotate:_Ye,round:dYe,scale:yc,scaleAndAdd:pYe,set:ar,sqrDist:EYe,sqrLen:CYe,squaredDistance:K4,squaredLength:Dxe,str:bYe,sub:zxe,subtract:$f,transformMat2:Fxe,transformMat2d:ib,transformMat3:gYe,transformMat4:yYe},Symbol.toStringTag,{value:"Module"}));function lJ(t){return ve((t-1e5)/(1e6-1e5),0,1)}const oH=1e4,AYe=.085,l_=1e5;let OYe=class{};const ri=OYe;function w(t,...e){let r="";for(let i=0;i<e.length;i++)r+=t[i]+e[i];return r+=t[t.length-1],r}(function(t){function e(i){return Math.round(i).toString()}function r(i){return i.toPrecision(8)}t.int=e,t.float=r})(w||(w={}));var Ds;function Yf(t,e){switch(e.textureCoordinateType){case Ds.Default:return t.attributes.add(C.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(w`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case Ds.Compressed:return t.attributes.add(C.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(w`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case Ds.Atlas:return t.attributes.add(C.UV0,"vec2"),t.varyings.add("vuv0","vec2"),t.attributes.add(C.UVREGION,"vec4"),t.varyings.add("vuvRegion","vec4"),void t.vertex.code.add(w`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:e.textureCoordinateType;case Ds.None:return void t.vertex.code.add(w`void forwardTextureCoordinates() {}`);case Ds.COUNT:return}}(function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Atlas=2]="Atlas",t[t.Compressed=3]="Compressed",t[t.COUNT=4]="COUNT"})(Ds||(Ds={}));function Nc(t){t.code.add(w`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}function Ru(t){t.include(Nc),t.code.add(w`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture(depthTex, uv)), nearFar);
}`)}function eU(t){t.fragment.code.add(w`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var ei;(function(t){t[t.Pass=0]="Pass",t[t.Draw=1]="Draw"})(ei||(ei={}));let hs=class{constructor(e,r,i,s,n=null){this.name=e,this.type=r,this.arraySize=n,this.bind={[ei.Pass]:null,[ei.Draw]:null},i!=null&&s!=null&&(this.bind[i]=s)}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}},zt=class extends hs{constructor(e,r){super(e,"vec3",ei.Pass,(i,s,n)=>i.setUniform3fv(e,r(s,n)))}};function Cy(t){t.uniforms.add(new zt("mainLightDirection",(e,r)=>r.lighting.mainLight.direction))}function Sm(t){t.uniforms.add(new zt("mainLightIntensity",(e,r)=>r.lighting.mainLight.intensity))}function eF(t){Cy(t.fragment),Sm(t.fragment),t.fragment.code.add(w`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)}let Ar=class extends hs{constructor(e,r){super(e,"vec2",ei.Pass,(i,s,n)=>i.setUniform2fv(e,r(s,n)))}},nr=class extends hs{constructor(e,r){super(e,"vec4",ei.Pass,(i,s,n)=>i.setUniform4fv(e,r(s,n)))}},Pe=class extends hs{constructor(e,r){super(e,"float",ei.Pass,(i,s,n)=>i.setUniform1f(e,r(s,n)))}},Fi=class extends hs{constructor(e,r){super(e,"mat4",ei.Pass,(i,s,n)=>i.setUniformMatrix4fv(e,r(s,n)))}};const Aa=Xt();let RYe=class{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}};function nt(t,e){if(!t){e=e||"Assertion";const r=new Error(e).stack;throw new RYe(`${e} at ${r}`)}}function kx(t,e){t||(e=e||"",console.warn("Verify failed: "+e+`
`+new Error("verify").stack))}function Vse(t,e,r,i){let s,n=(r[0]-t[0])/e[0],o=(i[0]-t[0])/e[0];n>o&&(s=n,n=o,o=s);let a=(r[1]-t[1])/e[1],l=(i[1]-t[1])/e[1];if(a>l&&(s=a,a=l,l=s),n>l||a>o)return!1;a>n&&(n=a),l<o&&(o=l);let c=(r[2]-t[2])/e[2],h=(i[2]-t[2])/e[2];return c>h&&(s=c,c=h,h=s),!(n>h||c>o)&&(h<o&&(o=h),!(o<0))}function $I(t,e,r,i,s,n=Ge()){const o=(i[s]-r[s])*(e[0]-t[0])-(i[0]-r[0])*(e[s]-t[s]),a=(i[0]-r[0])*(t[s]-r[s])-(i[s]-r[s])*(t[0]-r[0]);if(o===0)return!1;const l=a/o;return n[0]=t[0]+l*(e[0]-t[0]),n[1]=t[s]+l*(e[s]-t[s]),!0}function Bse(t,e,r,i,s){Aa[0]=t[0],Aa[1]=t[1],Aa[2]=t[2],Aa[3]=1,mu(Aa,Aa,e),s.length>2&&(s[2]=-Aa[2]),mu(Aa,Aa,r),nt(Aa[3]!==0),s[0]=Aa[0]/Aa[3],s[1]=Aa[1]/Aa[3],s[2]=Aa[2]/Aa[3],s[0]=(.5*s[0]+.5)*i[2]+i[0],s[1]=(.5*s[1]+.5)*i[3]+i[1]}function MYe(t,e){return Math.log(t)/Math.log(e)}function PYe(t,e,r,i){t[12]=e,t[13]=r,t[14]=i}function Bxe(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[7]===0&&t[8]===0&&t[9]===0&&t[10]===1&&t[11]===0&&t[15]===1}const Gxe=Q.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");let jxe=class{constructor(){this._includedModules=new Map}include(e,r){if(this._includedModules.has(e)){const i=this._includedModules.get(e);if(i!==r){Gxe.error("Trying to include shader module multiple times with different sets of options.");const s=new Set;for(const n of Object.keys(i))i[n]!==e[n]&&s.add(n);for(const n of Object.keys(e))i[n]!==e[n]&&s.add(n);s.forEach(n=>console.error(`  ${n}: current ${i[n]} new ${e[n]}`))}}else this._includedModules.set(e,r),e(this.builder,r)}},Sr=class extends jxe{constructor(){super(...arguments),this.vertex=new Gse,this.fragment=new Gse,this.attributes=new LYe,this.varyings=new DYe,this.extensions=new aH,this.constants=new Hxe}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e){const r=this.extensions.generateSource(e),i=this.attributes.generateSource(e),s=this.varyings.generateSource(e),n=e==="vertex"?this.vertex:this.fragment,o=n.uniforms.generateSource(),a=n.code.generateSource(),l=e==="vertex"?FYe:NYe,c=this.constants.generateSource().concat(n.constants.generateSource());return`#version 300 es
${r.join(`
`)}

${l}

${c.join(`
`)}

${o.join(`
`)}

${i.join(`
`)}

${s.join(`
`)}

${a.join(`
`)}`}generateBind(e,r){const i=new Map;this.vertex.uniforms.entries.forEach(o=>{const a=o.bind[e];a!=null&&i.set(o.name,a)}),this.fragment.uniforms.entries.forEach(o=>{const a=o.bind[e];a!=null&&i.set(o.name,a)});const s=Array.from(i.values()),n=s.length;return(o,a,l)=>{for(let c=0;c<n;++c)s[c](r,o,a,l)}}},IYe=class{constructor(){this._entries=new Map}add(...e){for(const r of e)this._add(r)}get(e){return this._entries.get(e)}_add(e){if(e!=null){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new V(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}else Gxe.error(`Trying to add null Uniform from ${new Error().stack}.`)}generateSource(){return Array.from(this._entries.values()).map(e=>e.arraySize!=null?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`)}get entries(){return Array.from(this._entries.values())}},$Ye=class{constructor(){this._entries=new Array}add(e){this._entries.push(e)}generateSource(){return this._entries}},Gse=class extends jxe{constructor(){super(...arguments),this.uniforms=new IYe,this.code=new $Ye,this.constants=new Hxe}get builder(){return this}},LYe=class{constructor(){this._entries=new Array}add(e,r){this._entries.push([e,r])}generateSource(e){return e==="fragment"?[]:this._entries.map(r=>`in ${r[1]} ${r[0]};`)}},DYe=class{constructor(){this._entries=new Map}add(e,r){this._entries.has(e)&&nt(this._entries.get(e)===r),this._entries.set(e,r)}generateSource(e){const r=new Array;return this._entries.forEach((i,s)=>r.push(e==="vertex"?`out ${i} ${s};`:`in ${i} ${s};`)),r}},aH=class lH{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const r=e==="vertex"?lH.ALLOWLIST_VERTEX:lH.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(i=>r.includes(i)).map(i=>`#extension ${i} : enable`)}};aH.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],aH.ALLOWLIST_VERTEX=[];let Hxe=class en{constructor(){this._entries=new Set}add(e,r,i){let s="ERROR_CONSTRUCTOR_STRING";switch(r){case"float":s=en._numberToFloatStr(i);break;case"int":s=en._numberToIntStr(i);break;case"bool":s=i.toString();break;case"vec2":s=`vec2(${en._numberToFloatStr(i[0])},                            ${en._numberToFloatStr(i[1])})`;break;case"vec3":s=`vec3(${en._numberToFloatStr(i[0])},                            ${en._numberToFloatStr(i[1])},                            ${en._numberToFloatStr(i[2])})`;break;case"vec4":s=`vec4(${en._numberToFloatStr(i[0])},                            ${en._numberToFloatStr(i[1])},                            ${en._numberToFloatStr(i[2])},                            ${en._numberToFloatStr(i[3])})`;break;case"ivec2":s=`ivec2(${en._numberToIntStr(i[0])},                             ${en._numberToIntStr(i[1])})`;break;case"ivec3":s=`ivec3(${en._numberToIntStr(i[0])},                             ${en._numberToIntStr(i[1])},                             ${en._numberToIntStr(i[2])})`;break;case"ivec4":s=`ivec4(${en._numberToIntStr(i[0])},                             ${en._numberToIntStr(i[1])},                             ${en._numberToIntStr(i[2])},                             ${en._numberToIntStr(i[3])})`;break;case"mat2":case"mat3":case"mat4":s=`${r}(${Array.prototype.map.call(i,n=>en._numberToFloatStr(n)).join(", ")})`}return this._entries.add(`const ${r} ${e} = ${s};`),this}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}};const NYe=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif

out vec4 fragColor;`,FYe=`precision highp float;
precision highp sampler2D;`;let et=class extends hs{constructor(e,r){super(e,"sampler2D",ei.Pass,(i,s,n)=>i.bindTexture(e,r(s,n)))}};const UO=Me(parseFloat(5802e-9.toFixed(6)),parseFloat(13558e-9.toFixed(6)),parseFloat(331e-7.toFixed(6))),E9=3,C9=Me(E9*parseFloat(65e-8.toFixed(6)),E9*parseFloat(1881e-9.toFixed(6)),E9*parseFloat(85e-9.toFixed(6))),UYe=3996e-9,kYe=Me(parseFloat(Number(UO[0]+C9[0]).toFixed(6)),parseFloat(Number(UO[1]+C9[1]).toFixed(6)),parseFloat(Number(UO[2]+C9[2]).toFixed(6)));function zYe(t){const e=new Sr;e.attributes.add(C.POSITION,"vec2"),e.include(Yf,{textureCoordinateType:Ds.Default}),e.varyings.add("worldRay","vec3"),e.varyings.add("eyeDir","vec3");const{vertex:r,fragment:i}=e;return r.uniforms.add(new Fi("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new Fi("inverseViewMatrix",(s,n)=>rC(VYe,n.camera.viewMatrix))),r.code.add(w`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),i.uniforms.add(new zt("backgroundColor",s=>s.backgroundColor),new Ar("radii",s=>s.radii),new zt("cameraPosition",(s,n)=>n.camera.eye),new nr("heightParameters",s=>s.heightParameters),new Pe("innerFadeDistance",s=>s.innerFadeDistance),new Pe("altitudeFade",s=>s.altitudeFade),new et("depthTexture",s=>s.depthTexture),new Pe("hazeStrength",s=>s.hazeStrength)),i.constants.add("betaRayleigh","vec3",UO),i.constants.add("betaCombined","vec3",kYe),i.constants.add("betaMie","float",UYe),i.constants.add("scaleHeight","float",AYe*l_),Cy(i),e.include(eU),t.haze&&(i.include(Ru),i.uniforms.add(new Ar("nearFar",(s,n)=>n.camera.nearFar))),i.code.add(w`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),i.code.add(w`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),i.code.add(w`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),i.code.add(w`
    const int STEPS = 6;

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${t.haze?w`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${t.haze?"":w`mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * `} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${t.haze?"":w`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${t.haze?w`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:w`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    ${t.haze?"":w`
            vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
              vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
              if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
                return fragColor;
              }

              float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
              vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
              float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
              if (relDist > 1.0) {
                return surfaceColor;
              }

              return mix(fragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
            }

            float getGlow(float dist, float radius, float intensity) {
              return pow(radius / max(dist, 1e-6), intensity);
            }

            vec3 getSun(vec3 cameraPos, vec3 rayDir, vec3 lightDir){

              // Get the amount of atmosphere between camera and the Sun along the view ray
              float scaleFract = (length(cameraPos) - radii[0]) / scaleHeight;
              float sunOpticalDepth = getOpticalDepth(cameraPos, rayDir, max(scaleFract, 0.0));

              // Find the amount of light that remains after travelling through the atmosphere from the Sun along the view ray
              // This will make the colour of the Sun reddish on the horizon and white from space
              vec3 sunTransmittance = exp(-(mix(betaCombined, betaRayleigh, 0.5)) * max(0.0, sunOpticalDepth));

              // Alignment of light direction and view ray
              float mu = clamp(dot(rayDir, lightDir), 0.0, 1.0);
              // Draw the Sun as a bright disc
              float sunDisc = 256.0 * smoothstep(0.0, 128.0, clamp(getGlow(1.0 - mu, 3e-5, 3.0), 0.0, 128.0));

              return normalize(sunTransmittance) * sunDisc;
            }`}

    ${t.haze&&t.reduced?w`
        float getDepth(vec2 uv){
          return linearDepthFromTexture(depthTexture, uv, nearFar);
        }

        float textureBilinear(vec2 uv) {
          // Information about the high-resolution depth texture
          vec2 depthTextureSize = vec2(textureSize(depthTexture, 0));
          vec2 texelSize = 1.0 / depthTextureSize;

          // The uv inside the upper right pixel - of the tile of 4 pixels -
          // that the atmosphere uv maps to in the depth texture
          vec2 depthUV = (uv * depthTextureSize) - vec2(0.5);

          // Relative distance of the uv coordinates inside the depth texture pixel
          vec2 f = fract(depthUV);

          // Snap to the centre of the depth texture pixel
          vec2 snapUV = (floor(depthUV) + vec2(0.5)) / depthTextureSize;

          // Read the depth texture pixel and its three neighbours
          float d0 = getDepth(snapUV);
          float d1 = getDepth(snapUV + vec2(texelSize.x, 0.0));
          float d2 = getDepth(snapUV + vec2(0.0, texelSize.y));
          float d3 = getDepth(snapUV + texelSize);

          // Return the bilinearly interpolated value of the neighbouring pixels based
          // on the sample position in the depth texture pixel
          return mix(mix(d0, d1, f.x), mix(d2, d3, f.x), f.y);
        }
        `:""}

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${t.haze?w`
          vec4 depthSample = texture(depthTexture, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;

              ${t.reduced?w`cameraSpaceRay *= -textureBilinear(vuv0);`:w`cameraSpaceRay *= -linearDepthFromTexture(depthTexture, vuv0, nearFar);`}

            terrainDepth = max(0.0, length(cameraSpaceRay));
          }else{
            discard;
          }
          `:w`${t.reduced?"":w`
                float depthSample = texture(depthTexture, vuv0).r;
                if (depthSample != 1.0) {
                  fragColor = vec4(0);
                  return;
                }`}`}

      ${t.haze?w`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            // Alpha is ignored for haze blending
            float alpha = 1.0;
            `:w`
            vec3 col = linearizeGamma(backgroundColor);
            col += getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            col += getSun(cameraPosition, rayDir, mainLightDirection);
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
      ${t.haze?"":w`fragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, fragColor);`}
    }
  `),e}const VYe=be(),BYe=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:UO,build:zYe},Symbol.toStringTag,{value:"Module"}));let Or=class{constructor(e,r){this._module=e,this._loadModule=r}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}};var Ti,At,xe,dm,Tt,ap,fE,rt,ti,_s,Rt,Dt,as,Ct,Je,Gs,Ws,Cr,uu,fo;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(Ti||(Ti={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(At||(At={})),function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(xe||(xe={})),function(t){t[t.ADD=32774]="ADD",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.SUBTRACT=32778]="SUBTRACT",t[t.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(dm||(dm={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"}(Tt||(Tt={})),function(t){t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(ap||(ap={})),function(t){t[t.CW=2304]="CW",t[t.CCW=2305]="CCW"}(fE||(fE={})),function(t){t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT"}(rt||(rt={})),function(t){t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS"}(ti||(ti={})),function(t){t[t.ZERO=0]="ZERO",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP"}(_s||(_s={})),function(t){t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(Rt||(Rt={})),function(t){t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(Dt||(Dt={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(as||(as={})),function(t){t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.RED=6403]="RED",t[t.RG=33319]="RG",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER"}(Ct||(Ct={})),function(t){t[t.RGBA4=32854]="RGBA4",t[t.R16F=33325]="R16F",t[t.RG16F=33327]="RG16F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.R32F=33326]="R32F",t[t.RG32F=33328]="RG32F",t[t.RGBA32F=34836]="RGBA32F",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB5_A1=32855]="RGB5_A1",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.RGB16F=34843]="RGB16F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.RGB565=36194]="RGB565",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2=32857]="RGB10_A2",t[t.RGB10_A2UI=36975]="RGB10_A2UI"}(Je||(Je={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.INT=5124]="INT",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(Gs||(Gs={})),function(t){t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(Ws||(Ws={})),function(t){t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.STATIC_READ=35045]="STATIC_READ",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.STREAM_COPY=35042]="STREAM_COPY"}(Cr||(Cr={})),function(t){t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER"}(uu||(uu={})),function(t){t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(fo||(fo={}));const A9=33984;var Rn,ru;(function(t){t[t.Texture=0]="Texture",t[t.BufferObject=1]="BufferObject",t[t.VertexArrayObject=2]="VertexArrayObject",t[t.Shader=3]="Shader",t[t.Program=4]="Program",t[t.FramebufferObject=5]="FramebufferObject",t[t.Renderbuffer=6]="Renderbuffer",t[t.Sync=7]="Sync",t[t.COUNT=8]="COUNT"})(Rn||(Rn={})),function(t){t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(ru||(ru={}));const jse=33306;var fs,Hse,qse,Wse,tF,cH,Xse;(function(t){t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(fs||(fs={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT=5124]="INT",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(Hse||(Hse={})),function(t){t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS"}(qse||(qse={})),function(t){t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED"}(Wse||(Wse={})),function(t){t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED"}(tF||(tF={})),function(t){t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(cH||(cH={})),function(t){t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(Xse||(Xse={}));let Lr=class{constructor(e,r,i){this.release=i,this.initializeConfiguration(e,r),this._configuration=r.snapshot(),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}destroy(){this._program=Ve(this._program),this._pipeline=this._configuration=null}reload(e){Ve(this._program),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.compiled}get key(){return this._configuration.key}get configuration(){return this._configuration}bindPipelineState(e,r=null,i){e.setPipelineState(this.getPipelineState(r,i))}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}get primitiveType(){return At.TRIANGLES}getPipelineState(e,r){return this._pipeline}initializeConfiguration(e,r){}};const Tr=new Map([[C.POSITION,0],[C.NORMAL,1],[C.NORMALCOMPRESSED,1],[C.UV0,2],[C.COLOR,3],[C.COLORFEATUREATTRIBUTE,3],[C.SIZE,4],[C.TANGENT,4],[C.AUXPOS1,5],[C.SYMBOLCOLOR,5],[C.AUXPOS2,6],[C.FEATUREATTRIBUTE,6],[C.INSTANCEFEATUREATTRIBUTE,6],[C.INSTANCECOLOR,7],[C.OBJECTANDLAYERIDCOLOR,7],[C.INSTANCEOBJECTANDLAYERIDCOLOR,7],[C.MODEL,8],[C.MODELNORMAL,12],[C.MODELORIGINHI,11],[C.MODELORIGINLO,15]]),GYe=Q.getLogger("esri.views.webgl.checkWebGLError");function jYe(t,e){switch(e){case t.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case t.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case t.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case t.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case t.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case t.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const qxe=!!oe("enable-feature:webgl-debug");function hh(){return qxe}function uH(){return qxe}function g_(t){if(hh()){const e=t.getError();if(e){const r=jYe(t,e),i=new Error().stack;GYe.error(new V("webgl-error","WebGL error occured",{message:r,stack:i}))}}}let Rr=class{constructor(e,r,i){this._context=e,this._locations=i,this._textures=new Map,this._freeTextureUnits=new Bt({deallocator:null}),this._glProgram=e.programCache.acquire(r.generate("vertex"),r.generate("fragment"),i),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=r.generateBind(ei.Pass,this),this.bindDraw=r.generateBind(ei.Draw,this),this._fragmentUniforms=hh()?r.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get compiled(){return this._glProgram.compiled}setUniform1b(e,r){this._glProgram.setUniform1i(e,r?1:0)}setUniform1i(e,r){this._glProgram.setUniform1i(e,r)}setUniform1f(e,r){this._glProgram.setUniform1f(e,r)}setUniform2fv(e,r){this._glProgram.setUniform2fv(e,r)}setUniform3fv(e,r){this._glProgram.setUniform3fv(e,r)}setUniform4fv(e,r){this._glProgram.setUniform4fv(e,r)}setUniformMatrix3fv(e,r){this._glProgram.setUniformMatrix3fv(e,r)}setUniformMatrix4fv(e,r){this._glProgram.setUniformMatrix4fv(e,r)}setUniform1fv(e,r){this._glProgram.setUniform1fv(e,r)}setUniform1iv(e,r){this._glProgram.setUniform1iv(e,r)}setUniform2iv(e,r){this._glProgram.setUniform3iv(e,r)}setUniform3iv(e,r){this._glProgram.setUniform3iv(e,r)}setUniform4iv(e,r){this._glProgram.setUniform4iv(e,r)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,r){if(r==null||r.glName==null){const s=this._textures.get(e);return s&&(this._context.bindTexture(null,s.unit),this._freeTextureUnit(s),this._textures.delete(e)),null}let i=this._textures.get(e);return i==null?(i=this._allocTextureUnit(r),this._textures.set(e,i)):i.texture=r,this._context.useProgram(this),this.setUniform1i(e,i.unit),this._context.bindTexture(r,i.unit),i.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((e,r)=>{this._context.bindTexture(e.texture,e.unit),this.setUniform1i(r,e.unit)}),this._fragmentUniforms!=null&&this._fragmentUniforms.forEach(e=>{e.type!=="sampler2D"&&e.type!=="samplerCube"||this._textures.has(e.name)||console.error(`Texture sampler ${e.name} has no bound texture`)})}_allocTextureUnit(e){return{texture:e,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}};var mi,$w,gs,Wg,Il,my,mE,Qr,Lw,Xg;(function(t){t[t.None=0]="None",t[t.Front=1]="Front",t[t.Back=2]="Back",t[t.COUNT=3]="COUNT"})(mi||(mi={})),function(t){t[t.Less=0]="Less",t[t.Lequal=1]="Lequal",t[t.COUNT=2]="COUNT"}($w||($w={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.UPDATE=1]="UPDATE"}(gs||(gs={})),function(t){t[t.NOT_LOADED=0]="NOT_LOADED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"}(Wg||(Wg={})),function(t){t[t.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",t[t.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(Il||(Il={})),function(t){t[t.Highlight=0]="Highlight",t[t.MaskOccludee=1]="MaskOccludee",t[t.COUNT=2]="COUNT"}(my||(my={})),function(t){t[t.CHANGED=0]="CHANGED",t[t.UNCHANGED=1]="UNCHANGED"}(mE||(mE={})),function(t){t[t.Blend=0]="Blend",t[t.Opaque=1]="Opaque",t[t.Mask=2]="Mask",t[t.MaskBlend=3]="MaskBlend",t[t.COUNT=4]="COUNT"}(Qr||(Qr={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(Lw||(Lw={})),function(t){t.DDS_ENCODING="image/vnd-ms.dds",t.KTX2_ENCODING="image/ktx2",t.BASIS_ENCODING="image/x.basis"}(Xg||(Xg={}));function Lc(t,e,r=dm.ADD,i=[0,0,0,0]){return{srcRgb:t,srcAlpha:t,dstRgb:e,dstAlpha:e,opRgb:r,opAlpha:r,color:{r:i[0],g:i[1],b:i[2],a:i[3]}}}function Eo(t,e,r,i,s=dm.ADD,n=dm.ADD,o=[0,0,0,0]){return{srcRgb:t,srcAlpha:e,dstRgb:r,dstAlpha:i,opRgb:s,opAlpha:n,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const cJ={face:ap.BACK,mode:fE.CCW},Wxe={face:ap.FRONT,mode:fE.CCW},tU=t=>t===mi.Back?cJ:t===mi.Front?Wxe:null,Ul={zNear:0,zFar:1},Gt={r:!0,g:!0,b:!0,a:!0};function HYe(t){return KYe.intern(t)}function qYe(t){return eJe.intern(t)}function WYe(t){return tJe.intern(t)}function XYe(t){return rJe.intern(t)}function ZYe(t){return iJe.intern(t)}function YYe(t){return sJe.intern(t)}function JYe(t){return nJe.intern(t)}function QYe(t){return oJe.intern(t)}function Mt(t){return aJe.intern(t)}let Ay=class{constructor(e,r){this._makeKey=e,this._makeRef=r,this._interns=new Map}intern(e){if(!e)return null;const r=this._makeKey(e),i=this._interns;return i.has(r)||i.set(r,this._makeRef(e)),i.get(r)??null}};function Oy(t){return"["+t.join(",")+"]"}const KYe=new Ay(Xxe,t=>({__tag:"Blending",...t}));function Xxe(t){return t?Oy([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}const eJe=new Ay(Zxe,t=>({__tag:"Culling",...t}));function Zxe(t){return t?Oy([t.face,t.mode]):null}const tJe=new Ay(Yxe,t=>({__tag:"PolygonOffset",...t}));function Yxe(t){return t?Oy([t.factor,t.units]):null}const rJe=new Ay(Jxe,t=>({__tag:"DepthTest",...t}));function Jxe(t){return t?Oy([t.func]):null}const iJe=new Ay(Qxe,t=>({__tag:"StencilTest",...t}));function Qxe(t){return t?Oy([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}const sJe=new Ay(Kxe,t=>({__tag:"DepthWrite",...t}));function Kxe(t){return t?Oy([t.zNear,t.zFar]):null}const nJe=new Ay(eTe,t=>({__tag:"ColorWrite",...t}));function eTe(t){return t?Oy([t.r,t.g,t.b,t.a]):null}const oJe=new Ay(tTe,t=>({__tag:"StencilWrite",...t}));function tTe(t){return t?Oy([t.mask]):null}const aJe=new Ay(lJe,t=>({blending:HYe(t.blending),culling:qYe(t.culling),polygonOffset:WYe(t.polygonOffset),depthTest:XYe(t.depthTest),stencilTest:ZYe(t.stencilTest),depthWrite:YYe(t.depthWrite),colorWrite:JYe(t.colorWrite),stencilWrite:QYe(t.stencilWrite)}));function lJe(t){return t?Oy([Xxe(t.blending),Zxe(t.culling),Yxe(t.polygonOffset),Jxe(t.depthTest),Qxe(t.stencilTest),Kxe(t.depthWrite),eTe(t.colorWrite),tTe(t.stencilWrite)]):null}let cJe=class{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setSubState(e,r,i,s){return(i||e!==r)&&(s(e),this._pipelineInvalid=!0),e}},uJe=class extends ri{constructor(){super(...arguments),this.heightParameters=Xt(),this.radii=Ge(),this.innerFadeDistance=0,this.altitudeFade=0,this.hazeStrength=1,this.renderScale=Ge(),this.backgroundColor=O()}},z3=class rTe extends Lr{initializeProgram(e){return new Rr(e.rctx,rTe.shader.get().build(this.configuration),Tr)}initializePipeline(){return this.configuration.reduced?Mt({blending:Lc(xe.ONE,xe.ZERO),depthTest:{func:ti.ALWAYS},colorWrite:Gt}):this.configuration.haze?Mt({blending:Eo(xe.ONE,xe.ZERO,xe.ONE_MINUS_SRC_COLOR,xe.ONE),colorWrite:Gt}):Mt({blending:Lc(xe.SRC_ALPHA,xe.ONE_MINUS_SRC_ALPHA),depthTest:{func:ti.LEQUAL},colorWrite:Gt})}};z3.shader=new Or(BYe,()=>ce(()=>import("./ChapmanAtmosphere.glsl-d629d696.js"),[],import.meta.url));let va=class extends ri{constructor(){super(),this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const e=this._parameterNames,r={key:this.key};for(const i of e)r[i]=this[i];return r}};function B(t={}){return(e,r)=>{if(e._parameterNames=e._parameterNames??[],e._parameterNames.push(r),t.constValue!=null)Object.defineProperty(e,r,{get:()=>t.constValue});else{const i=e._parameterNames.length-1,s=t.count||2,n=Math.ceil(Math.log2(s)),o=e._parameterBits??[0];let a=0;for(;o[a]+n>16;)a++,a>=o.length&&o.push(0);e._parameterBits=o;const l=o[a],c=(1<<n)-1<<l;o[a]+=n,Object.defineProperty(e,r,{get(){return this[i]},set(h){if(this[i]!==h&&(this[i]=h,this._keyDirty=!0,this._parameterBits[a]=this._parameterBits[a]&~c|+h<<l&c,typeof h!="number"&&typeof h!="boolean"))throw new Error("Configuration value for "+r+" must be boolean or number, got "+typeof h)}})}}}let rF=class extends va{constructor(){super(...arguments),this.haze=!1,this.reduced=!1}};u([B()],rF.prototype,"haze",void 0),u([B()],rF.prototype,"reduced",void 0);let bo=class{constructor(e,r,i,s,n,o=!1,a=0){this.name=e,this.count=r,this.type=i,this.offset=s,this.stride=n,this.normalized=o,this.divisor=a}};new bo(C.POSITION,3,rt.FLOAT,0,12);new bo(C.POSITION,3,rt.FLOAT,0,20),new bo(C.UV0,2,rt.FLOAT,12,20);new bo(C.POSITION,3,rt.FLOAT,0,32),new bo(C.NORMAL,3,rt.FLOAT,12,32),new bo(C.UV0,2,rt.FLOAT,24,32);new bo(C.POSITION,3,rt.FLOAT,0,16),new bo(C.COLOR,4,rt.UNSIGNED_BYTE,12,16);const uJ=[new bo(C.POSITION,2,rt.FLOAT,0,8)],WM=[new bo(C.POSITION,2,rt.FLOAT,0,16),new bo(C.UV0,2,rt.FLOAT,8,16)];function Zse(t){const e=t.gl;switch(e.getError()){case e.NO_ERROR:return null;case e.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case e.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case e.INVALID_OPERATION:return"The specified command is not allowed for the current state";case e.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case e.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case e.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function zo(t,e){return t.vertexBuffers[e].byteLength/hJe(t.layout[e])}function hJe(t){return t[0].stride}function hJ(t,e,r,i,s=0){const n=t.gl,o=t.capabilities.instancing;t.bindBuffer(r);for(const a of i){const l=e.get(a.name);l===void 0&&console.error(`There is no location for vertex attribute '${a.name}' defined.`);const c=s*a.stride;if(a.count<=4)n.vertexAttribPointer(l,a.count,a.type,a.normalized,a.stride,a.offset+c),n.enableVertexAttribArray(l),a.divisor>0&&o&&o.vertexAttribDivisor(l,a.divisor);else if(a.count===9)for(let h=0;h<3;h++)n.vertexAttribPointer(l+h,3,a.type,a.normalized,a.stride,a.offset+12*h+c),n.enableVertexAttribArray(l+h),a.divisor>0&&o&&o.vertexAttribDivisor(l+h,a.divisor);else if(a.count===16)for(let h=0;h<4;h++)n.vertexAttribPointer(l+h,4,a.type,a.normalized,a.stride,a.offset+16*h+c),n.enableVertexAttribArray(l+h),a.divisor>0&&o&&o.vertexAttribDivisor(l+h,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count)}}function dJ(t,e,r,i){const s=t.gl,n=t.capabilities.instancing;t.bindBuffer(r);for(const o of i){const a=e.get(o.name);if(o.count<=4)s.disableVertexAttribArray(a),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a,0);else if(o.count===9)for(let l=0;l<3;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else if(o.count===16)for(let l=0;l<4;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else console.error("Unsupported vertex attribute element count: "+o.count)}t.unbindBuffer(Tt.ARRAY_BUFFER)}function pJ(t){switch(t){case Ct.ALPHA:case Ct.LUMINANCE:case Ct.RED:case Ct.RED_INTEGER:case Je.R8:case Je.R8I:case Je.R8UI:case Je.R8_SNORM:case Ws.STENCIL_INDEX8:return 1;case Ct.LUMINANCE_ALPHA:case Ct.RG:case Ct.RG_INTEGER:case Je.RGBA4:case Je.R16F:case Je.R16I:case Je.R16UI:case Je.RG8:case Je.RG8I:case Je.RG8UI:case Je.RG8_SNORM:case Je.RGB565:case Je.RGB5_A1:case Ws.DEPTH_COMPONENT16:return 2;case Ct.DEPTH_COMPONENT:case Ct.RGB:case Ct.RGB_INTEGER:case Je.RGB8:case Je.RGB8I:case Je.RGB8UI:case Je.RGB8_SNORM:case Je.SRGB8:case Ws.DEPTH_COMPONENT24:return 3;case Ct.DEPTH_STENCIL:case Ct.DEPTH24_STENCIL8:case Ct.RGBA:case Ct.RGBA_INTEGER:case Je.RGBA8:case Je.R32F:case Je.R11F_G11F_B10F:case Je.RG16F:case Je.R32I:case Je.R32UI:case Je.RG16I:case Je.RG16UI:case Je.RGBA8I:case Je.RGBA8UI:case Je.RGBA8_SNORM:case Je.SRGB8_ALPHA8:case Je.RGB9_E5:case Je.RGB10_A2UI:case Je.RGB10_A2:case Ws.DEPTH_STENCIL:case Ws.DEPTH_COMPONENT32F:case Ws.DEPTH24_STENCIL8:return 4;case Ws.DEPTH32F_STENCIL8:return 5;case Je.RGB16F:case Je.RGB16I:case Je.RGB16UI:return 6;case Je.RG32F:case Je.RG32I:case Je.RG32UI:case Je.RGBA16F:case Je.RGBA16I:case Je.RGBA16UI:return 8;case Je.RGB32F:case Je.RGB32I:case Je.RGB32UI:return 12;case Je.RGBA32F:case Je.RGBA32I:case Je.RGBA32UI:return 16;case fs.COMPRESSED_RGB_S3TC_DXT1_EXT:case fs.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case fs.COMPRESSED_RGBA_S3TC_DXT3_EXT:case fs.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case fs.COMPRESSED_R11_EAC:case fs.COMPRESSED_SIGNED_R11_EAC:case fs.COMPRESSED_RGB8_ETC2:case fs.COMPRESSED_SRGB8_ETC2:case fs.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case fs.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case fs.COMPRESSED_RG11_EAC:case fs.COMPRESSED_SIGNED_RG11_EAC:case fs.COMPRESSED_RGBA8_ETC2_EAC:case fs.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}const zx=Q.getLogger("esri.views.webgl.VertexArrayObject");let jh=class{constructor(e,r,i,s,n=null){this._context=e,this._locations=r,this._layout=i,this._buffers=s,this._indexBuffer=n,this._glName=null,this._initialized=!1,e.instanceCounter.increment(Rn.VertexArrayObject,this)}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Object.keys(this._buffers).reduce((e,r)=>e+this._buffers[r].byteLength,this._indexBuffer!=null?this._indexBuffer.byteLength:0)}get layout(){return this._layout}get locations(){return this._locations}get memoryEstimate(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*dfe}dispose(){if(this._context){this._context.getBoundVAO()===this&&this._context.bindVAO(null);for(const e in this._buffers)this._buffers[e]?.dispose(),delete this._buffers[e];this._indexBuffer=Ve(this._indexBuffer),this.disposeVAOOnly()}else(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&zx.warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&((this._context?.capabilities?.vao).deleteVertexArray(this._glName),this._glName=null),this._context.instanceCounter.decrement(Rn.VertexArrayObject,this),this._context=UE(this._context)}initialize(){if(this._initialized)return;const e=this._context.capabilities.vao;if(e){const r=e.createVertexArray();e.bindVertexArray(r),this._bindLayout(),e.bindVertexArray(null),this._glName=r}this._initialized=!0}bind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:e,_layout:r,_indexBuffer:i}=this;e||zx.error("Vertex buffer dictionary is empty!");const s=this._context.gl;for(const n in e){const o=e[n];o||zx.error("Vertex buffer is uninitialized!");const a=r[n];a||zx.error("Vertex element descriptor is empty!"),hJ(this._context,this._locations,o,a)}i!=null&&(this._context.capabilities.vao?s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,i.glName):this._context.bindBuffer(i))}unbind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:e,_layout:r}=this;e||zx.error("Vertex buffer dictionary is empty!");for(const i in e){const s=e[i];s||zx.error("Vertex buffer is uninitialized!");const n=r[i];dJ(this._context,this._locations,s,n)}this._indexBuffer!=null&&this._context.unbindBuffer(this._indexBuffer.bufferType)}},Rp=class extends jh{};var cr;function hH(t,e,r={}){const i=e===cr.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];for(const s of i){const n=t.getContext(s,r);if(n)return n}return null}function dJe(t,e,r={}){const i=iTe(t);for(const s of i){const n=hH(e,s,r);if(n)return n}return null}function iTe(t){if(t==="3d")return[cr.WEBGL2];const e=oe("esri-force-webgl");return e===cr.WEBGL1||e===cr.WEBGL2?[e]:oe("mac")&&oe("chrome")?[cr.WEBGL1,cr.WEBGL2]:[cr.WEBGL2,cr.WEBGL1]}(function(t){t[t.WEBGL1=1]="WEBGL1",t[t.WEBGL2=2]="WEBGL2"})(cr||(cr={}));const Vp=Q.getLogger("esri.views.webgl.BufferObject");let Ur=class mS{static createIndex(e,r,i){return new mS(e,Tt.ELEMENT_ARRAY_BUFFER,r,i)}static createVertex(e,r,i){return new mS(e,Tt.ARRAY_BUFFER,r,i)}static createUniform(e,r,i){if(e.type!==cr.WEBGL2)throw new Error("Uniform buffers are supported in WebGL2 only!");return new mS(e,Tt.UNIFORM_BUFFER,r,i)}static createPixelPack(e,r=Cr.STREAM_READ,i){if(e.type!==cr.WEBGL2)throw new Error("Pixel pack buffers are supported in WebGL2 only!");const s=new mS(e,Tt.PIXEL_PACK_BUFFER,r);return i&&s.setSize(i),s}static createPixelUnpack(e,r=Cr.STREAM_DRAW,i){if(e.type!==cr.WEBGL2)throw new Error("Pixel unpack buffers are supported in WebGL2 only!");return new mS(e,Tt.PIXEL_UNPACK_BUFFER,r,i)}constructor(e,r,i,s){this._context=e,this.bufferType=r,this.usage=i,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(Rn.BufferObject,this),this._glName=this._context.gl.createBuffer(),g_(this._context.gl),s&&this.setData(s)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteLength(){return this.bufferType===Tt.ELEMENT_ARRAY_BUFFER?this._indexType===rt.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===Tt.ELEMENT_ARRAY_BUFFER||this.bufferType===Tt.ARRAY_BUFFER}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(Rn.BufferObject,this),this._context=UE(this._context)):this._glName&&Vp.warn("Leaked WebGL buffer object")}setSize(e,r=null){if(e<=0&&Vp.error("Buffer size needs to be positive!"),this.bufferType===Tt.ELEMENT_ARRAY_BUFFER&&r!=null)switch(this._indexType=r,r){case rt.UNSIGNED_SHORT:e*=2;break;case rt.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let r=e.byteLength;this.bufferType===Tt.ELEMENT_ARRAY_BUFFER&&($5(e)&&(r/=2,this._indexType=rt.UNSIGNED_SHORT),D5(e)&&(r/=4,this._indexType=rt.UNSIGNED_INT)),this._setBufferData(r,e)}_setBufferData(e,r=null){this._size=e;const i=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const s=this._context.gl;r!=null?s.bufferData(this.bufferType,r,this.usage):s.bufferData(this.bufferType,e,this.usage),g_(s),this._isVAOAware&&this._context.bindVAO(i)}setSubData(e,r,i,s){if(!e)return;(r<0||r*e.BYTES_PER_ELEMENT>=this.byteLength)&&Vp.error("offset is out of range!"),i>=s&&Vp.error("end must be bigger than start!"),(r+(s-i))*e.BYTES_PER_ELEMENT>this.byteLength&&Vp.error("An attempt to write beyond the end of the buffer!");const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const o=this._context.gl;if(this._context.type===cr.WEBGL2)o.bufferSubData(this.bufferType,r*e.BYTES_PER_ELEMENT,e,i,s-i);else{const a=i===0&&s===e.length?e:e.subarray(i,s);o.bufferSubData(this.bufferType,r*e.BYTES_PER_ELEMENT,a)}g_(o),this._isVAOAware&&this._context.bindVAO(n)}getSubData(e,r=0,i,s){if(this._context.type!==cr.WEBGL2)return void Vp.error("Get buffer subdata is supported in WebGL2 only!");if(i<0||s<0)return void Vp.error("Problem getting subdata: offset and length were less than zero!");const n=pJe(e)?e.BYTES_PER_ELEMENT:1;if(n*((i??0)+(s??0))>e.byteLength)return void Vp.error("Problem getting subdata: offset and length exceeded destination size!");r+n*(s??0)>this.byteLength&&Vp.warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this._context.bindBuffer(this,Tt.COPY_READ_BUFFER),o.getBufferSubData(Tt.COPY_READ_BUFFER,r,e,i,s),this._context.unbindBuffer(Tt.COPY_READ_BUFFER)}async getSubDataAsync(e,r=0,i,s){this._context.type===cr.WEBGL2?(await this._context.clientWaitAsync(),this.getSubData(e,r,i,s)):Vp.error("Get buffer subdata is supported in WebGL2 only!")}};function pJe(t){return NIe(t)}var nv;(function(t){t[t.Texture=0]="Texture",t[t.RenderBuffer=1]="RenderBuffer"})(nv||(nv={}));let xr=class{constructor(e=0,r=e){this.width=e,this.height=r,this.target=as.TEXTURE_2D,this.pixelFormat=Ct.RGBA,this.dataType=Gs.UNSIGNED_BYTE,this.samplingMode=Rt.LINEAR,this.wrapMode=Dt.REPEAT,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.depth=1,this.isImmutable=!1}};function fJe(t){return t.width<=0||t.height<=0||t.internalFormat==null?0:t.width*t.height*(t.hasMipmap?4/3:1)*pJ(t.internalFormat)}let mJe=class sTe extends xr{constructor(e,r){switch(super(),this.context=e,Object.assign(this,r),this.internalFormat){case Je.R16F:case Je.R16I:case Je.R16UI:case Je.R32F:case Je.R32I:case Je.R32UI:case Je.R8_SNORM:case Je.R8:case Je.R8I:case Je.R8UI:this.pixelFormat=Ct.RED}}static validate(e,r){return new sTe(e,r)}};const Yse=4;let Ot=class{constructor(e,r=null,i=null){if(this.type=nv.Texture,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,"context"in e)this._descriptor=e,i=r;else{const s=mJe.validate(e,r);if(!s)throw new V("Texture descriptor invalid");this._descriptor=s}if(this._descriptor.context.instanceCounter.increment(Rn.Texture,this),this._descriptor.context.type!==cr.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),sb(this._descriptor.target)))throw new V("3D and array textures are not supported in WebGL1");this._descriptor.target===as.TEXTURE_CUBE_MAP?this._setDataCubeMap(i):this.setData(i)}get glName(){return this._glName}get descriptor(){return this._descriptor}get gpuMemoryUsage(){return bJe.delete(this),fJe(this._descriptor)}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null,this._descriptor.context.instanceCounter.decrement(Rn.Texture,this))}release(){this.dispose()}resize(e,r){const i=this._descriptor;if(i.width!==e||i.height!==r){if(this._wasImmutablyAllocated)throw new V("Immutable textures can't be resized!");i.width=e,i.height=r,this._descriptor.target===as.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(e=null){for(let r=as.TEXTURE_CUBE_MAP_POSITIVE_X;r<=as.TEXTURE_CUBE_MAP_NEGATIVE_Z;r++)this._setData(e,r)}setData(e){this._setData(e)}_setData(e,r){if(!this._descriptor.context||!this._descriptor.context.gl)return;const i=this._descriptor.context.gl;g_(i),this._glName||(this._glName=i.createTexture()),e===void 0&&(e=null);const s=this._descriptor,n=r??s.target,o=sb(n);e===null&&(s.width=s.width||Yse,s.height=s.height||Yse,o&&(s.depth=s.depth??1));const a=this._descriptor.context.bindTexture(this,Ot.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(Ot.TEXTURE_UNIT_FOR_UPDATES),O9(this._descriptor.context,s),this._configurePixelStorage(),g_(i);const l=this._deriveInternalFormat();if(R9(e)){let c=e.width,h=e.height;const p=1;e instanceof HTMLVideoElement&&(c=e.videoWidth,h=e.videoHeight),s.width&&s.height,o&&s.depth,s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(n,l,s.hasMipmap,c,h,p),this._texImage(n,0,l,c,h,p,e),g_(i),s.hasMipmap&&this.generateMipmap(),s.width||(s.width=c),s.height||(s.height=h),o&&!s.depth&&(s.depth=p)}else{const{width:c,height:h,depth:p}=s;if(c==null||h==null)throw new V("Width and height must be specified!");if(o&&p==null)throw new V("Depth must be specified!");if(s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(n,l,s.hasMipmap,c,h,p),KD(e)){const f=e.levels,m=Kse(n,c,h,p),y=Math.min(m-1,f.length-1);this._descriptor.context.gl2!=null?i.texParameteri(s.target,this._descriptor.context.gl2.TEXTURE_MAX_LEVEL,y):s.hasMipmap=s.hasMipmap&&m===f.length;const _=l;if(!_Je(_))throw new V("Attempting to use compressed data with an uncompressed format!");this._forEachMipmapLevel((v,b,T,x)=>{const S=f[Math.min(v,f.length-1)];this._compressedTexImage(n,v,_,b,T,x,S)},y)}else this._texImage(n,0,l,c,h,p,e),g_(i),s.hasMipmap&&this.generateMipmap()}Jse(i,this._descriptor),Qse(i,this._descriptor),gJe(this._descriptor.context,this._descriptor),g_(i),this._descriptor.context.bindTexture(a,Ot.TEXTURE_UNIT_FOR_UPDATES)}updateData(e,r,i,s,n,o,a=0){o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const l=this._descriptor.context.gl,c=this._descriptor.context.gl2,h=this._descriptor,p=this._deriveInternalFormat(),{pixelFormat:f,dataType:m,target:y,isImmutable:_}=h;if(_&&!this._wasImmutablyAllocated)throw new V("Cannot update immutable texture before allocation!");const v=this._descriptor.context.bindTexture(this,Ot.TEXTURE_UNIT_FOR_UPDATES,!0);if((r<0||i<0||s>h.width||n>h.height||r+s>h.width||i+n>h.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),a){if(!c)return void console.error("Webgl2 must be enabled to use dataRowOffset!");l.pixelStorei(c.UNPACK_SKIP_ROWS,a)}if(R9(o)?c?c.texSubImage2D(y,e,r,i,s,n,f,m,o):l.texSubImage2D(y,e,r,i,f,m,o):KD(o)?l.compressedTexSubImage2D(y,e,r,i,s,n,p,o.levels[e]):l.texSubImage2D(y,e,r,i,s,n,f,m,o),a){if(!c)return void console.error("Webgl2 must be enabled to use dataRowOffset!");l.pixelStorei(c.UNPACK_SKIP_ROWS,0)}this._descriptor.context.bindTexture(v,Ot.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(e,r,i,s,n,o,a,l){l||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._descriptor.context.gl2;if(c==null)throw new V("3D textures are not supported in WebGL1");const h=this._descriptor,p=this._deriveInternalFormat(),{pixelFormat:f,dataType:m,isImmutable:y,target:_}=h;if(y&&!this._wasImmutablyAllocated)throw new V("Cannot update immutable texture before allocation!");sb(_)||console.warn("Attempting to set 3D texture data on a non-3D texture");const v=this._descriptor.context.bindTexture(this,Ot.TEXTURE_UNIT_FOR_UPDATES);if(this._descriptor.context.setActiveTexture(Ot.TEXTURE_UNIT_FOR_UPDATES),(r<0||i<0||s<0||n>h.width||o>h.height||a>h.depth||r+n>h.width||i+o>h.height||s+a>h.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),KD(l))l=l.levels[e],c.compressedTexSubImage3D(_,e,r,i,s,n,o,a,p,l);else{const b=l;c.texSubImage3D(_,e,r,i,s,n,o,a,f,m,b)}this._descriptor.context.bindTexture(v,Ot.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;if(!e.hasMipmap){if(this._wasImmutablyAllocated)throw new V("Cannot add mipmaps to immutable texture after allocation");e.hasMipmap=!0,this._samplingModeDirty=!0,O9(this._descriptor.context,e)}e.samplingMode===Rt.LINEAR?(this._samplingModeDirty=!0,e.samplingMode=Rt.LINEAR_MIPMAP_NEAREST):e.samplingMode===Rt.NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=Rt.NEAREST_MIPMAP_NEAREST);const r=this._descriptor.context.bindTexture(this,Ot.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(Ot.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(e.target),this._descriptor.context.bindTexture(r,Ot.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,O9(this._descriptor.context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._descriptor.context.gl,r=this._descriptor;this._samplingModeDirty&&(Jse(e,r),this._samplingModeDirty=!1),this._wrapModeDirty&&(Qse(e,r),this._wrapModeDirty=!1)}_deriveInternalFormat(){if(this._descriptor.context.type===cr.WEBGL1)return this._descriptor.internalFormat=this._descriptor.pixelFormat;if(this._descriptor.internalFormat!=null)return this._descriptor.internalFormat===Ct.DEPTH_STENCIL&&(this._descriptor.internalFormat=Ct.DEPTH24_STENCIL8),this._descriptor.internalFormat;switch(this._descriptor.dataType){case Gs.FLOAT:switch(this._descriptor.pixelFormat){case Ct.RGBA:return this._descriptor.internalFormat=Je.RGBA32F;case Ct.RGB:return this._descriptor.internalFormat=Je.RGB32F;default:throw new V("Unable to derive format")}case Gs.UNSIGNED_BYTE:switch(this._descriptor.pixelFormat){case Ct.RGBA:return this._descriptor.internalFormat=Je.RGBA8;case Ct.RGB:return this._descriptor.internalFormat=Je.RGB8}}return this._descriptor.internalFormat=this._descriptor.pixelFormat===Ct.DEPTH_STENCIL?Ct.DEPTH24_STENCIL8:this._descriptor.pixelFormat}_configurePixelStorage(){const e=this._descriptor.context.gl,{unpackAlignment:r,flipped:i,preMultiplyAlpha:s}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,r),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,i?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s?1:0)}_texStorage(e,r,i,s,n,o){const a=this._descriptor.context.gl2;if(a==null)throw new V("Immutable textures are not supported in WebGL1");if(!yJe(r))throw new V("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=i?Kse(e,s,n,o):1;if(sb(e)){if(o==null)throw new V("Missing depth dimension for 3D texture upload");a.texStorage3D(e,l,r,s,n,o)}else a.texStorage2D(e,l,r,s,n);this._wasImmutablyAllocated=!0}_texImage(e,r,i,s,n,o,a){const l=this._descriptor.context.gl,c=sb(e),{isImmutable:h,pixelFormat:p,dataType:f}=this._descriptor,m=this._descriptor.context.type===cr.WEBGL2,y=m?l:null;if(m||!R9(a))if(h){if(a!=null){const _=a;if(c){if(o==null)throw new V("Missing depth dimension for 3D texture upload");y.texSubImage3D(e,r,0,0,0,s,n,o,p,f,_)}else l.texSubImage2D(e,r,0,0,s,n,p,f,_)}}else{const _=a;if(c){if(o==null)throw new V("Missing depth dimension for 3D texture upload");y.texImage3D(e,r,i,s,n,o,0,p,f,_)}else l.texImage2D(e,r,i,s,n,0,p,f,_)}else l.texImage2D(e,0,i,p,f,a)}_compressedTexImage(e,r,i,s,n,o,a){const l=this._descriptor.context.gl;let c=null;const h=sb(e),p=this._descriptor.isImmutable;if(h){if(this._descriptor.context.type!==cr.WEBGL2)throw new V("3D textures are not supported in WebGL1");c=l}if(p){if(a!=null)if(h){if(o==null)throw new V("Missing depth dimension for 3D texture upload");c.compressedTexSubImage3D(e,r,0,0,0,s,n,o,i,a)}else l.compressedTexSubImage2D(e,r,0,0,s,n,i,a)}else if(h){if(o==null)throw new V("Missing depth dimension for 3D texture upload");c.compressedTexImage3D(e,r,i,s,n,o,0,a)}else l.compressedTexImage2D(e,r,i,s,n,0,a)}_forEachMipmapLevel(e,r=1/0){let{width:i,height:s,depth:n,hasMipmap:o,target:a}=this._descriptor;const l=a===as.TEXTURE_3D;if(i==null||s==null||l&&n==null)throw new V("Missing texture dimensions for mipmap calculation");for(let c=0;e(c,i,s,n),o&&(i!==1||s!==1||l&&n!==1)&&!(c>=r);++c)i=Math.max(1,i>>1),s=Math.max(1,s>>1),l&&(n=Math.max(1,n>>1))}};function O9(t,e){(e.width!=null&&e.width<0||e.height!=null&&e.height<0||e.depth!=null&&e.depth<0)&&console.error("Negative dimension parameters are not allowed!");const r=t.type===cr.WEBGL2;r||!e.isImmutable&&!sb(e.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!"),!r&&(e.width!=null&&Sw(e.width)&&e.height!=null&&Sw(e.height)||(typeof e.wrapMode=="number"?e.wrapMode!==Dt.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):e.wrapMode.s===Dt.CLAMP_TO_EDGE&&e.wrapMode.t===Dt.CLAMP_TO_EDGE||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),e.hasMipmap&&console.error("Mipmapping requires power-of-two textures!")))}function Jse(t,e){let r=e.samplingMode,i=e.samplingMode;r===Rt.LINEAR_MIPMAP_NEAREST||r===Rt.LINEAR_MIPMAP_LINEAR?(r=Rt.LINEAR,e.hasMipmap||(i=Rt.LINEAR)):r!==Rt.NEAREST_MIPMAP_NEAREST&&r!==Rt.NEAREST_MIPMAP_LINEAR||(r=Rt.NEAREST,e.hasMipmap||(i=Rt.NEAREST)),t.texParameteri(e.target,t.TEXTURE_MAG_FILTER,r),t.texParameteri(e.target,t.TEXTURE_MIN_FILTER,i)}function Qse(t,e){typeof e.wrapMode=="number"?(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode)):(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode.s),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode.t))}function gJe(t,e){const r=t.capabilities.textureFilterAnisotropic;r&&t.gl.texParameterf(e.target,r.TEXTURE_MAX_ANISOTROPY,e.maxAnisotropy??1)}function yJe(t){return t in Je}function _Je(t){return t in fs}function KD(t){return t!=null&&"type"in t&&t.type==="compressed"}function vJe(t){return t!=null&&"byteLength"in t}function R9(t){return t!=null&&!KD(t)&&!vJe(t)}function sb(t){return t===as.TEXTURE_3D||t===as.TEXTURE_2D_ARRAY}function Kse(t,e,r,i=1){let s=Math.max(e,r);return t===as.TEXTURE_3D&&(s=Math.max(s,i)),Math.round(Math.log(s)/Math.LN2)+1}Ot.TEXTURE_UNIT_FOR_UPDATES=0;const bJe=new Map;function kl(t,e=uJ,r=Tr,i=-1,s=1){let n=null;return e===WM?n=new Float32Array([i,i,0,0,s,i,1,0,i,s,0,1,s,s,1,1]):n=new Float32Array([i,i,s,i,i,s,s,s]),new Rp(t,r,{geometry:e},{geometry:Ur.createVertex(t,Cr.STATIC_DRAW,n)})}function wJe(t,e=uJ,r=Tr){const i=new Float32Array([-1,-1,3,-1,-1,3]);return new Rp(t,r,{geometry:e},{geometry:Ur.createVertex(t,Cr.STATIC_DRAW,i)})}const nTe=4;function oTe(t,e=nTe){const r=new xr;return r.samplingMode=Rt.NEAREST,r.width=r.height=e,new Ot(t,r)}function xJe(t,e,r=nTe){const i=new Uint8Array(r*r*4);for(let n=0;n<i.length;n+=4)i[n]=255*e[0],i[n+1]=255*e[1],i[n+2]=255*e[2],i[n+3]=255*e[3];const s=new xr;return s.samplingMode=Rt.NEAREST,s.width=s.height=r,new Ot(t,s,i)}function aTe(t){const e=new xr;return e.samplingMode=Rt.NEAREST,e.width=e.height=1,new Ot(t,e,new Uint8Array([255,255,255,255]))}let ene=class{constructor(e,r){this._view=e,this.type=ia.Realistic,this._handles=new Ii,this._passParameters=new uJe,this._rootTileElevationMin=NaN,this._lowerBoundEarthRadius=or.radius,this._fadeHaze=0,this._tmpScale=Ge(),this._updateRadius(or.radius);const i=r.renderContext.rctx;this._updateRootTileElevationBounds(),this._handles.add([ae(()=>this._view?.basemapTerrain?.rootTileElevationBounds,()=>this._view?.basemapTerrain?this._updateRootTileElevationBounds():null),ae(()=>this._view?.basemapTerrain?.visibleElevationBounds,()=>this._view?.basemapTerrain?this._updateVisibleElevationBounds():null)]);const s=new rF;s.haze=!1,this._atmosphereTechnique=r.techniqueRepository.acquire(z3,s),s.haze=!0,this._atmosphereHazeTechnique=r.techniqueRepository.acquire(z3,s),s.reduced=!0,s.haze=!1,this._atmosphereReducedTechnique=r.techniqueRepository.acquire(z3,s),s.haze=!0,this._atmosphereHazeReducedTechnique=r.techniqueRepository.acquire(z3,s),this._vao=kl(i,WM)}destroy(){this._handles.destroy(),this._atmosphereTechnique.release(),this._atmosphereHazeTechnique.release(),this._atmosphereReducedTechnique.release(),this._atmosphereHazeReducedTechnique.release(),this._vao.dispose()}render(e,r){this._render(e,r?this._atmosphereTechnique:this._atmosphereReducedTechnique,e.offscreenRenderingHelper.depthTexture,r,!1)}renderHaze(e,r,i){this._fadeHaze=r,this._render(e,i?this._atmosphereHazeTechnique:this._atmosphereHazeReducedTechnique,e.offscreenRenderingHelper.linearDepthTexture,i,!0)}_render(e,r,i,s,n){if(i==null)return;const o=e.offscreenRenderingHelper;this._update(e.bindParameters.camera),this._passParameters.depthTexture=i;const a=o.background.color;se(this._passParameters.backgroundColor,a[0]*a[3],a[1]*a[3],a[2]*a[3]);const l=e.rctx.bindTechnique(r,this._passParameters,e.bindParameters);if(s)o.renderDepthDetached(()=>this._renderCommon(l,e));else{const c=e.rctx.getViewport(),h=Oe(e.bindParameters.camera.eye)-or.radius;let p;if(h<l_){const y=Math.min(1,Math.max(0,h/l_));p=n?St(.4,.5,y):St(.2,.3,y)}else{const y=Math.min(1,Math.max(0,(h-l_)/(15*l_)));p=n?St(.5,1,y):St(.3,.6,y)}const f=Math.floor(p*e.bindParameters.camera.fullViewport[2]),m=Math.floor(p*e.bindParameters.camera.fullViewport[3]);e.rctx.setViewport(0,0,f,m),o.renderToTargets(()=>this._renderCommon(l,e),o.tmpColor,o.tmpDepth,[0,0,0,1],!1,!1),e.rctx.setViewport(c.x,c.y,c.width,c.height),ar(this._tmpScale,f/e.bindParameters.camera.fullViewport[2],m/e.bindParameters.camera.fullViewport[3]),o.compositeAtmosphereToMain(e.bindParameters,n,i,this._tmpScale)}}_renderCommon(e,r){this._vao!=null&&(r.rctx.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.rctx.drawArrays(At.TRIANGLE_STRIP,0,4))}_adjustRadiusForTesselation(e){return e*Math.cos(Math.PI/16/16)}_updateRootTileElevationBounds(){const e=this._view.basemapTerrain.rootTileElevationBounds.min;e!==this._rootTileElevationMin&&(this._rootTileElevationMin=e,this._lowerBoundEarthRadius=or.radius,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const e=this._adjustRadiusForTesselation(or.radius+this._view.basemapTerrain.visibleElevationBounds.min);e<this._lowerBoundEarthRadius&&this._updateRadius(e)}_updateRadius(e){this._lowerBoundEarthRadius=e,ar(this._passParameters.radii,e,e+l_),this._passParameters.innerFadeDistance=2*Math.sqrt((2*e-oH)*oH)}_update(e){if(!e)return;const r=la(e.eye),i=Math.sqrt(r),s=r-this._passParameters.radii[1]*this._passParameters.radii[1],n=ve((i-this._passParameters.radii[0])/l_,0,1);xi(this._passParameters.heightParameters,i,r,s,n),this._passParameters.altitudeFade=lJ(i-this._lowerBoundEarthRadius),this._passParameters.hazeStrength=St(St(.6,1,bR(9500,10500,i-or.radius)),1,this._fadeHaze)}static isSupported(e){return e.renderContext.rctx.capabilities.depthTexture}};function lTe(t){t.fragment.code.add(w`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)}function fJ(t,e){switch(t.include(Yf,e),e.textureCoordinateType){case Ds.Default:case Ds.Compressed:return void t.fragment.code.add(w`vec4 textureLookup(sampler2D tex, vec2 uv) {
return texture(tex, uv);
}`);case Ds.Atlas:return t.include(lTe),void t.fragment.code.add(w`vec4 textureLookup(sampler2D tex, vec2 uv) {
return textureAtlasLookup(tex, uv, vuvRegion);
}`);default:e.textureCoordinateType;case Ds.None:case Ds.COUNT:return}}let wu=class extends hs{constructor(e,r){super(e,"vec3",ei.Draw,(i,s,n,o)=>i.setUniform3fv(e,r(s,n,o)))}},Ih=class extends hs{constructor(e,r){super(e,"sampler2D",ei.Draw,(i,s,n)=>i.bindTexture(e,r(s,n)))}},Ev=class{constructor(e){this._material=e.material,this._techniqueRepository=e.techniqueRep,this._output=e.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}get _stippleTextureRepository(){return this._techniqueRepository.constructionContext.stippleTextureRepository}get _markerTextureRepository(){return this._techniqueRepository.constructionContext.markerTextureRepository}ensureTechnique(e,r){return this._technique=this._techniqueRepository.releaseAndAcquire(e,this._material.getConfiguration(this._output,r),this._technique),this._technique}ensureResources(e){return Wg.LOADED}},mJ=class extends Ev{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textureRepository=e.textureRep,this._textureId=e.textureId,this._acquire(e.textureId,r=>this._texture=r),this._acquire(e.normalTextureId,r=>this._textureNormal=r),this._acquire(e.emissiveTextureId,r=>this._textureEmissive=r),this._acquire(e.occlusionTextureId,r=>this._textureOcclusion=r),this._acquire(e.metallicRoughnessTextureId,r=>this._textureMetallicRoughness=r)}dispose(){this._texture=Bi(this._texture),this._textureNormal=Bi(this._textureNormal),this._textureEmissive=Bi(this._textureEmissive),this._textureOcclusion=Bi(this._textureOcclusion),this._textureMetallicRoughness=Bi(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return this._numLoading===0?Wg.LOADED:Wg.LOADING}get textureBindParameters(){return new cTe(this._texture!=null?this._texture.glTexture:null,this._textureNormal!=null?this._textureNormal.glTexture:null,this._textureEmissive!=null?this._textureEmissive.glTexture:null,this._textureOcclusion!=null?this._textureOcclusion.glTexture:null,this._textureMetallicRoughness!=null?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){this._texture!=null&&e===this._texture.id||(this._texture=Bi(this._texture),this._textureId=e,this._acquire(this._textureId,r=>this._texture=r))}_acquire(e,r){if(e==null)return void r(null);const i=this._textureRepository.acquire(e);if(Iu(i))return++this._numLoading,void i.then(s=>{if(this._disposed)return Bi(s),void r(null);r(s)}).finally(()=>--this._numLoading);r(i)}},cTe=class extends ri{constructor(e=null,r=null,i=null,s=null,n=null){super(),this.texture=e,this.textureNormal=r,this.textureEmissive=i,this.textureOcclusion=s,this.textureMetallicRoughness=n}};var lt;(function(t){t[t.Disabled=0]="Disabled",t[t.Normal=1]="Normal",t[t.Schematic=2]="Schematic",t[t.Water=3]="Water",t[t.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",t[t.Terrain=5]="Terrain",t[t.TerrainWithWater=6]="TerrainWithWater",t[t.COUNT=7]="COUNT"})(lt||(lt={}));function gJ(t,e){const r=t.fragment,i=e.hasMetallicRoughnessTexture||e.hasEmissionTexture||e.hasOcclusionTexture;if(e.pbrMode===lt.Normal&&i&&t.include(fJ,e),e.pbrMode!==lt.Schematic)if(e.pbrMode!==lt.Disabled){if(e.pbrMode===lt.Normal){r.code.add(w`vec3 mrr;
vec3 emission;
float occlusion;`);const s=e.pbrTextureBindType;e.hasMetallicRoughnessTexture&&(r.uniforms.add(s===ei.Pass?new et("texMetallicRoughness",n=>n.textureMetallicRoughness):new Ih("texMetallicRoughness",n=>n.textureMetallicRoughness)),r.code.add(w`void applyMetallnessAndRoughness(vec2 uv) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),e.hasEmissionTexture&&(r.uniforms.add(s===ei.Pass?new et("texEmission",n=>n.textureEmissive):new Ih("texEmission",n=>n.textureEmissive)),r.code.add(w`void applyEmission(vec2 uv) {
emission *= textureLookup(texEmission, uv).rgb;
}`)),e.hasOcclusionTexture?(r.uniforms.add(s===ei.Pass?new et("texOcclusion",n=>n.textureOcclusion):new Ih("texOcclusion",n=>n.textureOcclusion)),r.code.add(w`void applyOcclusion(vec2 uv) {
occlusion *= textureLookup(texOcclusion, uv).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):r.code.add(w`float getBakedOcclusion() { return 1.0; }`),s===ei.Pass?r.uniforms.add(new zt("emissionFactor",n=>n.emissiveFactor),new zt("mrrFactors",n=>n.mrrFactors)):r.uniforms.add(new wu("emissionFactor",n=>n.emissiveFactor),new wu("mrrFactors",n=>n.mrrFactors)),r.code.add(w`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;

      ${e.hasMetallicRoughnessTexture?w`applyMetallnessAndRoughness(${e.hasMetallicRoughnessTextureTransform?w`metallicRoughnessUV`:"vuv0"});`:""}

      ${e.hasEmissionTexture?w`applyEmission(${e.hasEmissiveTextureTransform?w`emissiveUV`:"vuv0"});`:""}

      ${e.hasOcclusionTexture?w`applyOcclusion(${e.hasOcclusionTextureTransform?w`occlusionUV`:"vuv0"});`:""}
    }
  `)}}else r.code.add(w`float getBakedOcclusion() { return 1.0; }`);else r.code.add(w`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}function yJ(t,e){const r=t.fragment,i=e.lightingSphericalHarmonicsOrder!==void 0?e.lightingSphericalHarmonicsOrder:2;i===0?(r.uniforms.add(new zt("lightingAmbientSH0",(s,n)=>se(tne,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0]))),r.code.add(w`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):i===1?(r.uniforms.add(new nr("lightingAmbientSH_R",(s,n)=>xi(Lm,n.lighting.sh.r[0],n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3])),new nr("lightingAmbientSH_G",(s,n)=>xi(Lm,n.lighting.sh.g[0],n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3])),new nr("lightingAmbientSH_B",(s,n)=>xi(Lm,n.lighting.sh.b[0],n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3]))),r.code.add(w`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):i===2&&(r.uniforms.add(new zt("lightingAmbientSH0",(s,n)=>se(tne,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0])),new nr("lightingAmbientSH_R1",(s,n)=>xi(Lm,n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3],n.lighting.sh.r[4])),new nr("lightingAmbientSH_G1",(s,n)=>xi(Lm,n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3],n.lighting.sh.g[4])),new nr("lightingAmbientSH_B1",(s,n)=>xi(Lm,n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3],n.lighting.sh.b[4])),new nr("lightingAmbientSH_R2",(s,n)=>xi(Lm,n.lighting.sh.r[5],n.lighting.sh.r[6],n.lighting.sh.r[7],n.lighting.sh.r[8])),new nr("lightingAmbientSH_G2",(s,n)=>xi(Lm,n.lighting.sh.g[5],n.lighting.sh.g[6],n.lighting.sh.g[7],n.lighting.sh.g[8])),new nr("lightingAmbientSH_B2",(s,n)=>xi(Lm,n.lighting.sh.b[5],n.lighting.sh.b[6],n.lighting.sh.b[7],n.lighting.sh.b[8]))),r.code.add(w`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),e.pbrMode!==lt.Normal&&e.pbrMode!==lt.Schematic||r.code.add(w`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const tne=O(),Lm=Xt();function XM(t){t.vertex.code.add(w`const float PI = 3.141592653589793;`),t.fragment.code.add(w`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}var $s,Dw;function TJe(t){return t?.cubeMap!=null}function _J(t){return t!=null&&!t.running}(function(t){t[t.RENDERING=0]="RENDERING",t[t.FINISHED_RENDERING=1]="FINISHED_RENDERING",t[t.FADING_TEXTURE_CHANNELS=2]="FADING_TEXTURE_CHANNELS",t[t.SWITCH_CHANNELS=3]="SWITCH_CHANNELS",t[t.FINISHED=4]="FINISHED"})($s||($s={})),function(t){t[t.RG=0]="RG",t[t.BA=1]="BA"}(Dw||(Dw={}));let SJe=class{constructor(){this.readChannels=Dw.RG,this.renderingStage=$s.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=O(),this.isCameraPositionFinal=!0,this.parallax=new rne,this.parallaxNew=new rne,this.crossFade={enabled:!1,factor:1,distanceThresholdFactor:.3},this.fadeInOut={stage:wn.FINISHED,factor:1,distanceThresholdFactor:.6},this.fadeIn={stage:pc.FINISHED,factor:1,distanceThresholdFactor:2},this.fadeInOutHeight={stage:ov.FINISHED,factor:-1}}get isFading(){return this.fadeInOut.stage===wn.FADE_OUT||this.fadeInOut.stage===wn.FADE_IN||this.fadeIn.stage===pc.FADE_IN||this.fadeInOutHeight.stage!==ov.FINISHED||this.renderingStage===$s.FADING_TEXTURE_CHANNELS}};var pc,wn,ov;(function(t){t[t.FINISHED=0]="FINISHED",t[t.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",t[t.FADE_IN=2]="FADE_IN"})(pc||(pc={})),function(t){t[t.FINISHED=0]="FINISHED",t[t.FADE_OUT=1]="FADE_OUT",t[t.SWITCH=2]="SWITCH",t[t.FADE_IN=3]="FADE_IN"}(wn||(wn={})),function(t){t[t.FINISHED=0]="FINISHED",t[t.HEIGHT_FADE=1]="HEIGHT_FADE"}(ov||(ov={}));let rne=class{constructor(){this.anchorPointClouds=O(),this.cloudsHeight=1e5,this.radiusCurvatureCorrectionFactor=0,this.transform=be()}},Jf=class extends hs{constructor(e,r){super(e,"bool",ei.Pass,(i,s,n)=>i.setUniform1b(e,r(s,n)))}},EJe=class extends hs{constructor(e,r){super(e,"samplerCube",ei.Pass,(i,s,n)=>i.bindTexture(e,r(s,n)))}};function uTe(t){const e=t.fragment;e.uniforms.add(new Fi("rotationMatrixClouds",(r,i)=>i.cloudsFade.parallax.transform),new Fi("rotationMatrixCloudsCrossFade",(r,i)=>i.cloudsFade.parallaxNew.transform),new zt("anchorPosition",(r,i)=>i.cloudsFade.parallax.anchorPointClouds),new zt("anchorPositionCrossFade",(r,i)=>i.cloudsFade.parallaxNew.anchorPointClouds),new Pe("cloudsHeight",(r,i)=>i.cloudsFade.parallax.cloudsHeight),new Pe("radiusCurvatureCorrectionFactor",(r,i)=>i.cloudsFade.parallax.radiusCurvatureCorrectionFactor),new Pe("totalFadeInOut",(r,i)=>i.cloudsFade.fadeInOut.stage===wn.FINISHED?i.cloudsFade.fadeInOutHeight.factor+1-i.cloudsFade.fadeIn.factor:i.cloudsFade.fadeInOutHeight.factor+1-i.cloudsFade.fadeInOut.factor),new Pe("crossFadeAnchorFactor",(r,i)=>ve(i.cloudsFade.crossFade.factor,0,1)),new EJe("cubeMap",(r,i)=>i.cloudsFade.data?.cubeMap?i.cloudsFade.data.cubeMap.colorTexture:null),new Jf("crossFade",(r,i)=>i.cloudsFade.crossFade.enabled),new Jf("readChannelsRG",(r,i)=>i.cloudsFade.readChannels===Dw.RG),new Jf("fadeTextureChannels",(r,i)=>i.cloudsFade.renderingStage===$s.FADING_TEXTURE_CHANNELS)),e.constants.add("planetRadius","float",or.radius),e.code.add(w`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),e.code.add(w`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),e.code.add(w`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),Cy(e),Sm(e),e.code.add(w`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),e.code.add(w`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = texture(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`),e.code.add(w`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),e.code.add(w`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),e.code.add(w`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}function Em(t){t.code.add(w`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function CJe(){const t=new Sr;t.attributes.add(C.POSITION,"vec2"),t.varyings.add("worldRay","vec3");const{vertex:e,fragment:r}=t;return e.uniforms.add(new Fi("inverseProjectionMatrix",(i,s)=>s.camera.inverseProjectionMatrix),new Fi("inverseViewMatrix",(i,s)=>rC(AJe,s.camera.viewMatrix))),e.code.add(w`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),r.include(Em),r.include(Nc),t.include(yJ,{pbrMode:lt.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(XM),t.include(eU),t.include(eF),t.include(uTe,{instancedDoublePrecision:!1}),r.uniforms.add(new zt("cameraPosition",(i,s)=>s.camera.eye)),r.code.add(w`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
fragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),t}const AJe=be(),OJe=Object.freeze(Object.defineProperty({__proto__:null,build:CJe},Symbol.toStringTag,{value:"Module"}));let hTe=class dTe extends Lr{constructor(e){super(e,new va,()=>this.destroy())}initializeProgram(e){return new Rr(e.rctx,dTe.shader.get().build(),Tr)}initializePipeline(){return Mt({blending:Eo(xe.ONE,xe.ZERO,xe.SRC_ALPHA,xe.ONE),depthTest:{func:ti.LEQUAL},colorWrite:Gt})}};hTe.shader=new Or(OJe,()=>ce(()=>import("./CloudsComposition.glsl-39a38d44.js"),[],import.meta.url));let nb=class extends we{constructor(e){super(e),this._technique=new hTe(e),this._vao=kl(e.rctx)}destroy(){this._technique=Bi(this._technique),this._vao=Ve(this._vao)}render(e){const r=e.bindParameters.cloudsFade;if(this._vao==null||r.data==null)return;if(!this._technique.compiled)return void this.requestRender();const i=e.rctx.bindTechnique(this._technique,RJe,e.bindParameters);e.rctx.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays(At.TRIANGLE_STRIP,0,4)}};u([d({constructOnly:!0})],nb.prototype,"rctx",void 0),u([d({constructOnly:!0})],nb.prototype,"viewingMode",void 0),u([d({constructOnly:!0})],nb.prototype,"planetRadius",void 0),u([d({constructOnly:!0})],nb.prototype,"requestRender",void 0),nb=u([P("esri.views.3d.environment.CloudsComposition")],nb);const RJe=new ri;var Rl;(function(t){t[t.SIXTEEN=0]="SIXTEEN",t[t.HUNDRED=1]="HUNDRED",t[t.TWOHUNDRED=2]="TWOHUNDRED",t[t.COUNT=3]="COUNT"})(Rl||(Rl={}));let eN=class extends va{constructor(){super(...arguments),this.steps=Rl.SIXTEEN,this.writeTextureChannels=Dw.RG}};u([B({count:Rl.COUNT})],eN.prototype,"steps",void 0),u([B({constValue:oe("esri-mobile")?1024:2048})],eN.prototype,"cubeMapSize",void 0),u([B()],eN.prototype,"writeTextureChannels",void 0);let V3=class{constructor(e,r,i,s,n,o,a,l,c=.5){this.coverage=e,this.density=r,this.absorption=i,this.cloudSize=s,this.detailSize=n,this.smoothness=o,this.cloudHeight=a,this.raymarchingSteps=l,this.median=c}};const ine=new V3([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],Rl.SIXTEEN),ra={sunny:ine,cloudy:new V3([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],Rl.TWOHUNDRED,.6),rainy:new V3([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],Rl.TWOHUNDRED,.4),snowy:new V3([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],Rl.HUNDRED,.65),foggy:new V3([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],Rl.SIXTEEN),default:ine},gh=oe("esri-mobile")?64:128,MJe=gh/128,kd=Math.ceil(Math.sqrt(gh)),G_=(gh+2)*kd,PJe=1e5,M9=128,IJe=G_/1560;function Zh(t,e=!0){t.attributes.add(C.POSITION,"vec2"),e&&t.varyings.add("uv","vec2"),t.vertex.code.add(w`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${e?w`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}let VR=class extends hs{constructor(e,r){super(e,"mat3",ei.Draw,(i,s,n)=>i.setUniformMatrix3fv(e,r(s,n)))}},pTe=class extends ri{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.raymarchingSteps=ra.default.raymarchingSteps,this.weatherTile=Ge()}},fTe=class extends ri{constructor(){super(...arguments),this.viewMatrix=Ui()}};function $Je(t){const e=new Sr;e.include(Zh,!1);const r=e.fragment;return r.uniforms.add(new Pe("cloudRadius",i=>i.cloudRadius),new Pe("power",i=>St(35,120,i.absorption)),new Pe("sigmaE",i=>1+i.absorption),new Pe("density",i=>St(0,.3,i.density)),new Pe("cloudSize",i=>St(0,.02,Math.max(.01,1-i.cloudSize))),new Pe("detailSize",i=>St(0,.2,Math.max(.01,1-i.detailSize))),new Pe("smoothness",i=>St(0,.5,1-i.smoothness)),new Pe("cloudHeight",i=>St(0,1500,i.cloudHeight)),new Pe("coverage",i=>i.coverage),new VR("view",i=>i.viewMatrix),new et("cloudShapeTexture",i=>i.noiseTexture!=null?i.noiseTexture.textureAtlas:null),new Ar("cloudVariables",i=>ar(LJe,i.coverage,i.absorption))),r.constants.add("halfCubeMapSize","float",.5*t.cubeMapSize),r.code.add(w`
    const int STEPS = ${t.steps===Rl.SIXTEEN?w`16`:t.steps===Rl.HUNDRED?w`100`:w`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),r.code.add(w`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${w.float(G_)};
      const float dataWidth = ${w.float(G_)};
      const float tileRows = ${w.float(kd)};
      const vec3 atlasDimensions = vec3(${w.float(gh)}, ${w.float(gh)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${w.float(MJe)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = (${w.float(IJe)} * p) / ${w.float(G_)} + 0.5;

      return texture(cloudShapeTexture, uv).a;
    }
    `),r.code.add(w`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),r.code.add(w`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),r.code.add(`
    float multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      float luminance = 0.0;

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),r.code.add(w`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),r.code.add(w`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),r.code.add(w`void main() {
if (coverage ==  0.0) {
fragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`),e}const LJe=Ge(),DJe=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:fTe,CloudsPassParameters:pTe,build:$Je},Symbol.toStringTag,{value:"Module"}));let mTe=class gTe extends Lr{constructor(e,r){super(e,r,()=>this.destroy())}initializeProgram(e){return new Rr(e.rctx,gTe.shader.get().build(this.configuration),Tr)}initializePipeline(){return Mt({blending:Lc(xe.CONSTANT_COLOR,xe.ONE_MINUS_CONSTANT_COLOR,dm.ADD,this.configuration.writeTextureChannels===Dw.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:ti.LEQUAL},colorWrite:Gt})}};mTe.shader=new Or(DJe,()=>ce(()=>import("./Clouds.glsl-5482868c.js"),[],import.meta.url));var fu;(function(t){t[t.Full=0]="Full",t[t.WeatherMap=1]="WeatherMap",t[t.COUNT=2]="COUNT"})(fu||(fu={}));let dH=class extends va{constructor(){super(...arguments),this.mode=fu.Full}};u([B({count:fu.COUNT})],dH.prototype,"mode",void 0);let yTe=class extends ri{constructor(){super(...arguments),this.weatherTile=fr(0,0)}};function NJe(t){const e=new Sr;return e.include(Zh,!1),e.fragment.code.add(w`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),t.mode===fu.Full&&e.fragment.code.add(w`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${w.float(kd)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${w.float(8)});

      float worley0 = worley(p, ${w.float(2)} * 2.0);
      float worley1 = worley(p, ${w.float(2)} * 8.0);
      float worley2 = worley(p, ${w.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${w.float(2)});
      float worley1 = worley(p, ${w.float(2)} * 2.0);
      float worley2 = worley(p, ${w.float(2)} * 4.0);
      float worley3 = worley(p, ${w.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),e.fragment.uniforms.add(new Ar("weatherTile",r=>r.weatherTile)),e.fragment.code.add(w`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${w.float(M9)});

      // Get global coordinates of p
      p += weatherTile * ${w.float(M9)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${w.float(PJe)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),e.fragment.code.add(w`void main() {`),t.mode===fu.Full&&e.fragment.code.add(w`
        float padWidth = 1.0;
        float paddedSize = ${w.float(gh)} + 2.0 * padWidth;
        float tileCount = ${w.float(kd)} * ${w.float(kd)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${w.float(gh)};
          }

          if (startPadY) {
            pixel.y += ${w.float(gh)};
          }

          if (endPadX) {
            pixel.x -= ${w.float(gh)};
          }

          if (endPadY) {
            pixel.y -= ${w.float(gh)};
          }

          uv = vec2(pixel.xy / ${w.float(gh)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${w.float(gh)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${w.float(kd)} * ${w.float(kd)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        fragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${w.float(kd)} * ${w.float(kd)});
        p = p_;
        p.z /= (${w.float(kd)} * ${w.float(kd)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        fragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),e.fragment.code.add(w`
      vec2 mapUV = ${w.float(M9)} * (gl_FragCoord.xy / ${w.float(G_)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${t.mode===fu.Full?w`fragColor.ba = vec2(0.0, map);`:w`fragColor = vec4(map);`};
    }
  `),e}const FJe=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:yTe,build:NJe},Symbol.toStringTag,{value:"Module"}));let pH=class _Te extends Lr{initializeProgram(e){return new Rr(e.rctx,_Te.shader.get().build(this.configuration),Tr)}initializePipeline(){return Mt({blending:this.configuration.mode===fu.Full?Lc(xe.ONE,xe.ZERO):Eo(xe.ZERO,xe.ONE,xe.ONE,xe.ZERO),depthTest:{func:ti.ALWAYS},colorWrite:Gt})}};pH.shader=new Or(FJe,()=>ce(()=>import("./NoiseTextureAtlas.glsl-7537f11f.js"),[],import.meta.url));let iF=class{constructor(e,r,i=r){this.internalFormat=e,this.width=r,this.height=i,this.multisampled=!1,this.samples=1}};function UJe(t){return t.width<=0||t.height<=0||t.internalFormat==null?0:t.width*t.height*pJ(t.internalFormat)}let kJe=class{constructor(e,r){this._context=e,this._descriptor=r,this.type=nv.RenderBuffer,this._context.instanceCounter.increment(Rn.Renderbuffer,this);const i=this._context.gl;this.glName=i.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:s,height:n,internalFormat:o,multisampled:a}=r;if(a){if(this._context.type!==cr.WEBGL2)throw new Error("Multisampled renderbuffers are not supported in WebGL1!");i.renderbufferStorageMultisample(i.RENDERBUFFER,this.samples,o,s,n)}else i.renderbufferStorage(i.RENDERBUFFER,o,s,n)}get descriptor(){return this._descriptor}get samples(){const e=this._descriptor.samples,r=this._context.parameters.maxSamples;return e?Math.min(e,r):r}get gpuMemoryUsage(){return UJe(this._descriptor)}resize(e,r){const i=this._descriptor;if(i.width===e&&i.height===r)return;i.width=e,i.height=r;const s=this._context.gl;this._context.bindRenderbuffer(this),i.multisampled?s.renderbufferStorageMultisample(s.RENDERBUFFER,this.samples,i.internalFormat,i.width,i.height):s.renderbufferStorage(s.RENDERBUFFER,i.internalFormat,i.width,i.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(Rn.Renderbuffer,this),this._context=UE(this._context))}};const zJe=Q.getLogger("esri.views.webgl.FramebufferObject");let hn=class gS{constructor(e,r,i=null){this._context=e,this._glName=null,this._colorAttachments=new Map,this._depthBuffer=null,this._stencilBuffer=null,this._depthStencilTexture=null,this._initialized=!1,e.instanceCounter.increment(Rn.FramebufferObject,this);const s=tN(r)?r:new Ot(this._context,r);if(this._colorAttachments.set(ru.COLOR_ATTACHMENT0,s),this._validateTextureDescriptor(s.descriptor),this._validateColorAttachmentPoint(ru.COLOR_ATTACHMENT0),i!=null)if(BJe(i))this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),this._depthStencilTexture=tN(i)?i:new Ot(this._context,i),this._validateTextureDescriptor(this._depthStencilTexture.descriptor);else{const n=VJe(i)?i:new kJe(this._context,i),o=n.descriptor;o.internalFormat===Ws.STENCIL_INDEX8?this._stencilBuffer=n:this._depthBuffer=n,this._validateRenderBufferDescriptor(o)}}dispose(){if(this._colorAttachments.size===0&&!this._glName)return;const e=this._context.getBoundFramebufferObject();this._colorAttachments.forEach((r,i)=>this.detachColorTexture(i)?.dispose()),this.detachDepthStencilBuffer()?.dispose(),this.detachDepthStencilTexture()?.dispose(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(e),this._context.instanceCounter.decrement(Rn.FramebufferObject,this)}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(ru.COLOR_ATTACHMENT0)}get depthStencilAttachment(){return this._depthStencilTexture||this._depthBuffer||this._stencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._colorAttachments.get(ru.COLOR_ATTACHMENT0)?.descriptor?.width??0}get height(){return this._colorAttachments.get(ru.COLOR_ATTACHMENT0)?.descriptor?.height??0}get gpuMemoryUsage(){return[...this._colorAttachments].reduce((e,[r,i])=>e+i.gpuMemoryUsage,this.depthStencilAttachment?.gpuMemoryUsage??0)}getColorTexture(e){const r=this._colorAttachments.get(e);return r&&tN(r)?r:null}attachColorTexture(e,r=ru.COLOR_ATTACHMENT0){if(!e)return;this._validateColorAttachmentPoint(r);const i=e.descriptor;this._validateTextureDescriptor(i),this.detachColorTexture(r)?.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,r)),this._colorAttachments.set(r,e)}detachColorTexture(e=ru.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(e);if(r)return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e)),this._colorAttachments.delete(e),r}setColorTextureTarget(e,r=ru.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(r);i&&this._framebufferTexture2D(i.glName,r,e)}attachDepthStencil(e){if(e)switch(e.type){case nv.Texture:return this._attachDepthStencilTexture(e);case nv.RenderBuffer:return this._attachDepthStencilBuffer(e)}}_attachDepthStencilTexture(e){if(e==null)return;const r=e.descriptor;r.pixelFormat!==Ct.DEPTH_STENCIL&&r.pixelFormat!==Ct.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),r.dataType!==Gs.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),this._validateTextureDescriptor(r),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,jse)),this._depthStencilTexture?.dispose(),this._depthStencilTexture=e}detachDepthStencilTexture(){const e=this._depthStencilTexture;return e&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,jse)),this._depthStencilTexture=null,e}_attachDepthStencilBuffer(e){if(e==null)return;const r=e.descriptor;if(r.internalFormat!==Ws.DEPTH_STENCIL&&r.internalFormat!==Ws.DEPTH_COMPONENT16&&console.error("Depth/Stencil buffer must have correct internalFormat"),this._validateRenderBufferDescriptor(r),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const i=this._context.gl,s=this._getGLAttachmentPoint(r);i.framebufferRenderbuffer(fo.FRAMEBUFFER,s,i.RENDERBUFFER,e.glName)}this._depthBuffer?.dispose(),this._depthBuffer=e}detachDepthStencilBuffer(){const e=this._depthBuffer;if(e&&this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl,i=this._getGLAttachmentPoint(e.descriptor);r.framebufferRenderbuffer(fo.FRAMEBUFFER,i,r.RENDERBUFFER,null),e.dispose()}return this._depthBuffer=null,e}copyToTexture(e,r,i,s,n,o,a){(e<0||r<0||n<0||o<0)&&console.error("Offsets cannot be negative!"),(i<=0||s<=0)&&console.error("Copy width and height must be greater than zero!");const l=a.descriptor;a.descriptor.target!==as.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),(l?.width==null||l?.height==null||e+i>this.width||r+s>this.height||n+i>l.width||o+s>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const c=this._context,h=c.bindTexture(a,Ot.TEXTURE_UNIT_FOR_UPDATES);c.setActiveTexture(Ot.TEXTURE_UNIT_FOR_UPDATES),c.bindFramebuffer(this),c.gl.copyTexSubImage2D(as.TEXTURE_2D,0,n,o,e,r,i,s),c.bindTexture(h,Ot.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,r,i,s,n,o,a){(i<=0||s<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,r,i,s,n,o,a)}async readPixelsAsync(e,r,i,s,n,o,a){if(this._context.type!==cr.WEBGL2)return hh()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),void this.readPixels(e,r,i,s,n,o,a);const l=this._context.gl,c=Ur.createPixelPack(this._context,Cr.STREAM_READ,a.byteLength);this._context.bindBuffer(c),this._context.bindFramebuffer(this),l.readPixels(e,r,i,s,n,o,0),this._context.unbindBuffer(Tt.PIXEL_PACK_BUFFER),await c.getSubDataAsync(a),c.dispose()}resize(e,r){if(this.width===e&&this.height===r)return;const i={width:e,height:r};jb(i,this._context.parameters.maxTextureSize),this._colorAttachments.forEach(s=>s.resize(i.width,i.height)),this._depthStencilTexture?.resize(i.width,i.height),this._initialized&&(jb(i,this._context.parameters.maxRenderbufferSize),this._depthBuffer?.resize(i.width,i.height),this._stencilBuffer?.resize(i.width,i.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}initializeAndBind(e=fo.FRAMEBUFFER){const r=this._context.gl;if(this._initialized)return void r.bindFramebuffer(e,this.glName);this._glName&&r.deleteFramebuffer(this._glName);const i=r.createFramebuffer();r.bindFramebuffer(e,i),this._colorAttachments.forEach((n,o)=>this._framebufferTexture2D(n.glName,o,sne(n),e));const s=this._depthBuffer||this._stencilBuffer;if(s){const n=this._getGLAttachmentPoint(s.descriptor);r.framebufferRenderbuffer(e,n,r.RENDERBUFFER,s.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,r.DEPTH_STENCIL_ATTACHMENT,sne(this._depthStencilTexture),e);hh()&&r.checkFramebufferStatus(e)!==r.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=i,this._initialized=!0}_framebufferTexture2D(e,r=ru.COLOR_ATTACHMENT0,i=as.TEXTURE_2D,s=fo.FRAMEBUFFER,n=0){this._context.gl.framebufferTexture2D(s,r,i,e,n)}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthBuffer){if(this._initialized){this._context.bindFramebuffer(this);const r=this._getGLAttachmentPoint(this._depthBuffer.descriptor);e.framebufferRenderbuffer(fo.FRAMEBUFFER,r,e.RENDERBUFFER,null)}this._depthBuffer=Ve(this._depthBuffer)}this._stencilBuffer&&(this._initialized&&(this._context.bindFramebuffer(this),e.framebufferRenderbuffer(fo.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,null)),this._stencilBuffer=Ve(this._stencilBuffer)),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=Ve(this._depthStencilTexture))}_validateTextureDescriptor(e){e.target!==as.TEXTURE_2D&&e.target!==as.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),jb(e,this._context.parameters.maxTextureSize),this._validateBufferDimensions(e)}_validateRenderBufferDescriptor(e){jb(e,this._context.parameters.maxRenderbufferSize),this._validateBufferDimensions(e)}_validateBufferDimensions(e){e.width<=0&&(e.width=this.width),e.height<=0&&(e.height=this.height),this.width>0&&this.height>0&&(this.width===e.width&&this.height===e.height||console.error("Attachment size must match framebuffer size!"))}_getGLAttachmentPoint(e){switch(e.internalFormat){case Ws.DEPTH_COMPONENT16:case Ws.DEPTH_COMPONENT24:case Ws.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;case Ws.DEPTH24_STENCIL8:case Ws.DEPTH32F_STENCIL8:case Ws.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;case Ws.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(e){if(gS._MAX_COLOR_ATTACHMENTS===-1){const i=this._context.capabilities.drawBuffers;if(i){const s=this._context.gl;gS._MAX_COLOR_ATTACHMENTS=s.getParameter(i.MAX_COLOR_ATTACHMENTS)}else gS._MAX_COLOR_ATTACHMENTS=1}const r=e-ru.COLOR_ATTACHMENT0;r+1>gS._MAX_COLOR_ATTACHMENTS&&Q.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${r+1}. Implementation supports up to ${gS._MAX_COLOR_ATTACHMENTS} color attachments`)}};function tN(t){return t!=null&&"type"in t&&t.type===nv.Texture}function VJe(t){return t!=null&&"type"in t&&t.type===nv.RenderBuffer}function BJe(t){return tN(t)||t!=null&&"pixelFormat"in t}function jb(t,e){const r=Math.max(t.width,t.height);if(r>e){zJe.warn(`Resizing FBO attachment size ${t.width}x${t.height} to device limit ${e}`);const i=e/r;return t.width=Math.round(t.width*i),t.height=Math.round(t.height*i),!1}return!0}function sne(t){return t.descriptor.target===as.TEXTURE_CUBE_MAP?as.TEXTURE_CUBE_MAP_POSITIVE_X:as.TEXTURE_2D}hn._MAX_COLOR_ATTACHMENTS=-1;let B3=class extends we{constructor(e){super(e),this._needsRender=!0,this._passParameters=new yTe,this._frameBuffer=new hn(e.context.renderContext.rctx,new xr(G_)),this._vao=kl(e.context.renderContext.rctx)}get _techniqueRepository(){return this.context.techniqueRepository}get textureAtlas(){return this._texture!=null?this._weatherMapTechnique!=null&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render(fu.WeatherMap)):this._fullTechnique!=null&&this._fullTechnique.compiled&&(this._texture=this._render(fu.Full)),this._texture}_setDirty(){this._needsRender=!0}updateWeatherMap(e){this._passParameters.weatherTile[0]===e[0]&&this._passParameters.weatherTile[1]===e[1]||(fn(this._passParameters.weatherTile,e),this._setDirty())}destroy(){this._fullTechniqueCached=Bi(this._fullTechniqueCached),this._weatherMapTechniqueCached=Bi(this._weatherMapTechniqueCached),this._frameBuffer=Ve(this._frameBuffer),this._vao=Ve(this._vao)}get _fullTechnique(){if(this._fullTechniqueCached==null){const e=new dH;e.mode=fu.Full,this._fullTechniqueCached=this._techniqueRepository.acquire(pH,e)}return this._fullTechniqueCached}get _weatherMapTechnique(){if(this._weatherMapTechniqueCached==null){const e=new dH;e.mode=fu.WeatherMap,this._weatherMapTechniqueCached=this._techniqueRepository.acquire(pH,e)}return this._weatherMapTechniqueCached}_render(e){if(this._vao==null||this._frameBuffer==null)return null;const r=e===fu.Full?this._fullTechnique:this._weatherMapTechnique,i=this.context.renderContext.rctx,s=i.getViewport();i.setViewport(0,0,G_,G_),i.bindFramebuffer(this._frameBuffer);const n=i.bindTechnique(r,this._passParameters,null);return i.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao),i.gl.drawArrays(i.gl.TRIANGLE_STRIP,0,4),i.setViewport(s.x,s.y,s.width,s.height),this._needsRender=!1,this._frameBuffer.colorTexture}};u([d({constructOnly:!0})],B3.prototype,"context",void 0),u([d({readOnly:!0})],B3.prototype,"_techniqueRepository",null),B3=u([P("esri.views.3d.environment.NoiseTextureAtlas")],B3);function vTe(t){t.include(Ru),t.uniforms.add(new et("geometryDepthTexture",(e,r)=>r.multipassGeometry.linearDepthTexture),new Ar("nearFar",(e,r)=>r.camera.nearFar)),t.code.add(w`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}let GJe=class{constructor(){this.enabled=!1}};function Mu(t,e){e.hasMultipassTerrain&&(t.fragment.include(Ru),t.fragment.uniforms.add(new et("terrainDepthTexture",(r,i)=>i.multipassTerrain.linearDepthTexture)),t.fragment.uniforms.add(new Ar("nearFar",(r,i)=>i.camera.nearFar)),t.fragment.uniforms.add(new Ar("inverseViewport",(r,i)=>i.inverseViewport)),t.fragment.code.add(w`
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){
      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${e.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `))}let jJe=class{constructor(){this.enabled=!1,this.cullAboveGround=!1}};function HJe(t,e){const r=t.fragment;r.include(Ru),r.uniforms.add(new Ar("nearFar",(i,s)=>s.camera.nearFar)),r.uniforms.add(new et("depthMap",(i,s)=>s.linearDepthTexture)),r.uniforms.add(new Fi("proj",(i,s)=>s.ssr.camera.projectionMatrix)),r.uniforms.add(new Pe("invResolutionHeight",(i,s)=>1/s.ssr.camera.height)),r.uniforms.add(new Fi("reprojectionMatrix",(i,s)=>s.ssr.reprojectionMatrix)),r.code.add(w`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${e.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}let qJe=class{constructor(){this.enabled=!1,this.fadeFactor=1,this.reprojectionMatrix=be()}};function rU(t){return t?{ray:Jn(t.ray),c0:t.c0,c1:t.c1}:{ray:Jn(),c0:0,c1:Number.MAX_VALUE}}function WJe(t,e=rU()){return W4(t,e.ray),e.c0=0,e.c1=Number.MAX_VALUE,e}function XJe(t,e,r=rU()){const i=Oe(t.vector);return Xbe(t.origin,e,r.ray),r.c0=0,r.c1=i,r}function DFt(t,e){return bTe(t,t.c0,e)}function NFt(t,e){return bTe(t,t.c1,e)}function bTe(t,e,r){return ue(r,t.ray.origin,ie(r,t.ray.direction,e))}new Sy(()=>rU());function BR(t){return t?[Nr(t[0]),Nr(t[1]),Nr(t[2]),Nr(t[3]),Nr(t[4]),Nr(t[5])]:[Nr(),Nr(),Nr(),Nr(),Nr(),Nr()]}function wTe(){return[O(),O(),O(),O(),O(),O(),O(),O()]}function sF(t,e){for(let r=0;r<lC;r++)G6(t[r],e[r])}function xTe(t,e,r,i=eQe){const s=oi(kY.get(),e,t);Mn(s,s);for(let n=0;n<QJe;++n){const o=mu(UY.get(),KJe[n],s);se(i[n],o[0]/o[3],o[1]/o[3],o[2]/o[3])}TTe(r,i)}function TTe(t,e){oa(e[Qe.FAR_BOTTOM_LEFT],e[Qe.NEAR_BOTTOM_LEFT],e[Qe.NEAR_TOP_LEFT],t[di.LEFT]),oa(e[Qe.NEAR_BOTTOM_RIGHT],e[Qe.FAR_BOTTOM_RIGHT],e[Qe.FAR_TOP_RIGHT],t[di.RIGHT]),oa(e[Qe.FAR_BOTTOM_LEFT],e[Qe.FAR_BOTTOM_RIGHT],e[Qe.NEAR_BOTTOM_RIGHT],t[di.BOTTOM]),oa(e[Qe.NEAR_TOP_LEFT],e[Qe.NEAR_TOP_RIGHT],e[Qe.FAR_TOP_RIGHT],t[di.TOP]),oa(e[Qe.NEAR_BOTTOM_LEFT],e[Qe.NEAR_BOTTOM_RIGHT],e[Qe.NEAR_TOP_RIGHT],t[di.NEAR]),oa(e[Qe.FAR_BOTTOM_RIGHT],e[Qe.FAR_BOTTOM_LEFT],e[Qe.FAR_TOP_LEFT],t[di.FAR])}function D_(t,e){for(let r=0;r<lC;r++){const i=t[r];if(i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]>=e[3])return!1}return!0}function ZJe(t,e){return ETe(t,WJe(e,CTe.get()))}function FFt(t,e){for(let r=0;r<lC;r++){const i=t[r];if(!QHe(i,e))return!1}return!0}function YJe(t,e,r){return ETe(t,XJe(e,r,CTe.get()))}function STe(t,e){for(let r=0;r<lC;r++)if(pi(t[r],e)>0)return!1;return!0}function ETe(t,e){for(let r=0;r<lC;r++)if(!JHe(t[r],e))return!1;return!0}var di,Qe;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.TOP=3]="TOP",t[t.NEAR=4]="NEAR",t[t.FAR=5]="FAR"})(di||(di={})),function(t){t[t.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",t[t.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",t[t.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",t[t.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",t[t.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",t[t.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",t[t.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",t[t.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(Qe||(Qe={}));const JJe={bottom:[Qe.FAR_BOTTOM_RIGHT,Qe.NEAR_BOTTOM_RIGHT,Qe.NEAR_BOTTOM_LEFT,Qe.FAR_BOTTOM_LEFT],near:[Qe.NEAR_BOTTOM_LEFT,Qe.NEAR_BOTTOM_RIGHT,Qe.NEAR_TOP_RIGHT,Qe.NEAR_TOP_LEFT],far:[Qe.FAR_BOTTOM_RIGHT,Qe.FAR_BOTTOM_LEFT,Qe.FAR_TOP_LEFT,Qe.FAR_TOP_RIGHT],right:[Qe.NEAR_BOTTOM_RIGHT,Qe.FAR_BOTTOM_RIGHT,Qe.FAR_TOP_RIGHT,Qe.NEAR_TOP_RIGHT],left:[Qe.FAR_BOTTOM_LEFT,Qe.NEAR_BOTTOM_LEFT,Qe.NEAR_TOP_LEFT,Qe.FAR_TOP_LEFT],top:[Qe.FAR_TOP_LEFT,Qe.NEAR_TOP_LEFT,Qe.NEAR_TOP_RIGHT,Qe.FAR_TOP_RIGHT]},lC=6,QJe=8,KJe=[Nt(-1,-1,-1,1),Nt(1,-1,-1,1),Nt(1,1,-1,1),Nt(-1,1,-1,1),Nt(-1,-1,1,1),Nt(1,-1,1,1),Nt(1,1,1,1),Nt(-1,1,1,1)],CTe=new Sy(rU),eQe=wTe();function tQe(t,e,r){return 2*Math.atan(Math.sqrt(e*e+r*r)*Math.tan(.5*t)/e)}function rQe(t,e,r){return 2*Math.atan(Math.sqrt(e*e+r*r)*Math.tan(.5*t)/r)}function iQe(t,e,r){return 2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(e*e+r*r))}function sQe(t,e,r){return 2*Math.atan(r*Math.tan(.5*t)/Math.sqrt(e*e+r*r))}var fH;let gt=fH=class extends we{constructor(t={}){super(t),this._center=O(),this._up=O(),this._viewUp=O(),this._viewForward=O(),this._viewRight=O(),this._ray=Jn(),this._viewport=Nt(0,0,1,1),this._padding=Nt(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=fr(1,1e3),this._viewDirty=!0,this._viewMatrix=be(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=be(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=be(),this._frustumDirty=!0,this._frustum=BR(),this._fullViewport=Xt(),this._pixelRatio=1,this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center,"_center")}get ray(){return de(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){Us(this._viewMatrix,t),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get screenViewport(){if(this.pixelRatio===1)return this._viewport;const t=Tw(Xt(),this._viewport,1/this.pixelRatio),e=this._get("screenViewport");return e&&y4(t,e)?e:t}get screenPadding(){if(this.pixelRatio===1)return this._padding;const t=Tw(Xt(),this._padding,1/this.pixelRatio),e=this._get("screenPadding");return e&&y4(t,e)?e:t}get x(){return this._viewport[0]}set x(t){t+=this._padding[tr.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(t){t+=this._padding[tr.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[tr.RIGHT]+this._padding[tr.LEFT]}set fullWidth(t){this.width=t-(this._padding[tr.RIGHT]+this._padding[tr.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[tr.TOP]+this._padding[tr.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[tr.TOP]+this._padding[tr.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[tr.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[tr.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){a2(this._padding,t)||(this._viewport[0]+=t[tr.LEFT]-this._padding[tr.LEFT],this._viewport[1]+=t[tr.BOTTOM]-this._padding[tr.BOTTOM],this._viewport[2]-=t[tr.RIGHT]+t[tr.LEFT]-(this._padding[tr.RIGHT]+this._padding[tr.LEFT]),this._viewport[3]-=t[tr.TOP]+t[tr.BOTTOM]-(this._padding[tr.TOP]+this._padding[tr.BOTTOM]),Oh(this._padding,t),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&(oi(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){const t=this.width,e=this.height,r=this.near*Math.tan(this.fovY/2),i=r*this._aspect,s=Sve(be(),-i*(1+2*this._padding[tr.LEFT]/t),i*(1+2*this._padding[tr.RIGHT]/t),-r*(1+2*this._padding[tr.BOTTOM]/e),r*(1+2*this._padding[tr.TOP]/e),this.near,this.far),n=this._get("projectionMatrix");return n&&sY(n,s)?n:s}get inverseProjectionMatrix(){return Mn(be(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||be()}get fov(){return this._fov}set fov(t){this._fov=t,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return iQe(this._fov,this.width,this.height)}set fovX(t){this._fov=tQe(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return sQe(this._fov,this.width,this.height)}set fovY(t){this._fov=rQe(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return fi(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(Mn(this._viewInverseTransposeMatrix,this.viewMatrix),$c(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const e=2*t-1;return 2*this.near*this.far/(this.far+this.near-e*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation!=null&&this.relativeElevation>=0}copyFrom(t){re(this._ray.origin,t.eye),this.center=t.center,this.up=t.up,Oh(this._viewport,t.viewport),this.notifyChange("_viewport"),Oh(this._padding,t.padding),this.notifyChange("_padding"),fn(this._nearFar,t.nearFar),this.notifyChange("_nearFar"),this._fov=t.fov,this.relativeElevation=t.relativeElevation;const e=t;return this._viewDirty=e._viewDirty,this._viewDirty||(Us(this._viewMatrix,t.viewMatrix),re(this._viewRight,t.viewRight),re(this._viewUp,t.viewUp),re(this._viewForward,t.viewForward)),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||(sF(this._frustum,t.frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(Us(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),Oh(this._fullViewport,t.fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up}clone(){return new fH().copyFrom(this)}equals(t){return ha(this.eye,t.eye)&&ha(this.center,t.center)&&ha(this.up,t.up)&&a2(this._viewport,t.viewport)&&a2(this._padding,t.padding)&&Uxe(this.nearFar,t.nearFar)&&this._fov===t.fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation}almostEquals(t){if(Math.abs(t.fov-this._fov)>=.001||g4(t.screenPadding,this.screenPadding)>=1||g4(this.screenViewport,t.screenViewport)>=1)return!1;On(Zo,t.eye,t.center),On(P9,this.eye,this.center);const e=fe(Zo,P9),r=rB(Zo),i=rB(P9),s=5e-4;return e*e>=(1-1e-10)*r*i&&X5(t.eye,this.eye)<Math.max(r,i)*s*s}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(LO(this.viewForward,de(Zo,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,e){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(t=Ji()){return t[0]=(this.padding[tr.LEFT]+this.width/2)/this.pixelRatio,t[1]=(this.padding[tr.TOP]+this.height/2)/this.pixelRatio,t}getRenderCenter(t,e=.5,r=.5){return t[0]=this.padding[tr.LEFT]+this.width*e,t[1]=this.padding[tr.BOTTOM]+this.height*r,t[2]=.5,t}setGLViewport(t){const e=this.viewport,r=this.padding;t.setViewport(e[0]-r[3],e[1]-r[2],e[2]+r[1]+r[3],e[3]+r[0]+r[2])}applyProjection(t,e){t!==er&&re(er,t),er[3]=1,mu(er,er,this.projectionMatrix);const r=Math.abs(er[3]);ie(er,er,1/r);const i=this.fullViewport;e[0]=St(0,i[0]+i[2],.5+.5*er[0]),e[1]=St(0,i[1]+i[3],.5+.5*er[1]),e[2]=.5*(er[2]+1),e[3]=r}unapplyProjection(t,e){const r=this.fullViewport;er[0]=(t[0]/(r[0]+r[2])*2-1)*t[3],er[1]=(t[1]/(r[1]+r[3])*2-1)*t[3],er[2]=(2*t[2]-1)*t[3],er[3]=t[3],this.inverseProjectionMatrix!=null&&(mu(er,er,this.inverseProjectionMatrix),e[0]=er[0],e[1]=er[1],e[2]=er[2])}projectToScreen(t,e){return this.projectToRenderScreen(t,I9),this.renderToScreen(I9,e),e}projectToRenderScreen(t,e){if(er[0]=t[0],er[1]=t[1],er[2]=t[2],er[3]=1,mu(er,er,this.viewProjectionMatrix),er[3]===0)return null;ie(er,er,1/Math.abs(er[3]));const r=this.fullViewport;return"x"in e?(e.x=St(0,r[0]+r[2],.5+.5*er[0]),e.y=St(0,r[1]+r[3],.5+.5*er[1])):(e[0]=St(0,r[0]+r[2],.5+.5*er[0]),e[1]=St(0,r[1]+r[3],.5+.5*er[1]),e.length>2&&(e[2]=.5*(er[2]+1))),e}unprojectFromScreen(t,e){return this.unprojectFromRenderScreen(this.screenToRender(t,I9),e)}unprojectFromRenderScreen(t,e){if(oi(LI,this.projectionMatrix,this.viewMatrix),!Mn(LI,LI))return null;const r=this.fullViewport;return er[0]=2*(t[0]-r[0])/r[2]-1,er[1]=2*(t[1]-r[1])/r[3]-1,er[2]=2*t[2]-1,er[3]=1,mu(er,er,LI),er[3]===0?null:(e[0]=er[0]/er[3],e[1]=er[1]/er[3],e[2]=er[2]/er[3],e)}constrainWindowSize(t,e,r,i){const s=t*this.pixelRatio,n=e*this.pixelRatio,o=Math.max(s-r/2,0),a=Math.max(this.fullHeight-n-i/2,0),l=-Math.min(s-r/2,0),c=-Math.min(this.fullHeight-n-i/2,0);return[o,a,r-l- -Math.min(this.fullWidth-s-r/2,0),i-c- -Math.min(n-i/2,0)]}computeUp(t){t===Ue.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,e){const r=t[0]*this.pixelRatio,i=this.fullHeight-t[1]*this.pixelRatio;return e[0]=r,e[1]=i,e}renderToScreen(t,e){const r=t[0]/this.pixelRatio,i=(this.fullHeight-t[1])/this.pixelRatio;e[0]=r,e[1]=i}_computeUpGlobal(){de(Zo,this.center,this.eye);const t=Oe(this.center);t<1?(se(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(fe(Zo,this.center))>.9999*Oe(Zo)*t||(ht(this._up,Zo,this.center),ht(this._up,this._up,Zo),ye(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){by(Zo,this.eye,this.center),Math.abs(Zo[2])<=.9999&&(ie(Zo,Zo,Zo[2]),se(this._up,-Zo[0],-Zo[1],1-Zo[2]),ye(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(t,e,r=""){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?ha(t,e)||(re(e,t),this._markViewDirty(),r.length&&this.notifyChange(r)):Q.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(xTe(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(E6(this._viewMatrix,this.eye,this.center,this.up),se(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),se(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),se(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};u([d()],gt.prototype,"_center",void 0),u([d()],gt.prototype,"_up",void 0),u([d()],gt.prototype,"_viewport",void 0),u([d()],gt.prototype,"_padding",void 0),u([d()],gt.prototype,"_fov",void 0),u([d()],gt.prototype,"_nearFar",void 0),u([d()],gt.prototype,"_pixelRatio",void 0),u([d()],gt.prototype,"pixelRatio",null),u([d()],gt.prototype,"eye",null),u([d()],gt.prototype,"center",null),u([d()],gt.prototype,"up",null),u([d({readOnly:!0})],gt.prototype,"nearFar",null),u([d()],gt.prototype,"near",null),u([d()],gt.prototype,"far",null),u([d()],gt.prototype,"viewport",null),u([d({readOnly:!0})],gt.prototype,"screenViewport",null),u([d({readOnly:!0})],gt.prototype,"screenPadding",null),u([d()],gt.prototype,"x",null),u([d()],gt.prototype,"y",null),u([d()],gt.prototype,"width",null),u([d()],gt.prototype,"height",null),u([d()],gt.prototype,"fullWidth",null),u([d()],gt.prototype,"fullHeight",null),u([d({readOnly:!0})],gt.prototype,"_aspect",null),u([d()],gt.prototype,"padding",null),u([d({readOnly:!0})],gt.prototype,"projectionMatrix",null),u([d({readOnly:!0})],gt.prototype,"inverseProjectionMatrix",null),u([d()],gt.prototype,"fov",null),u([d()],gt.prototype,"fovX",null),u([d()],gt.prototype,"fovY",null),gt=fH=u([P("esri.views.3d.webgl-engine.lib.Camera")],gt);const er=Xt(),LI=be(),Zo=O(),P9=O(),I9=jo();var tr;(function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT"})(tr||(tr={}));var he;(function(t){t[t.INTEGRATED_MESH=0]="INTEGRATED_MESH",t[t.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",t[t.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",t[t.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL",t[t.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN",t[t.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",t[t.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN",t[t.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL",t[t.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL",t[t.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",t[t.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE",t[t.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT",t[t.LASERLINES=12]="LASERLINES",t[t.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL",t[t.HUD_MATERIAL=14]="HUD_MATERIAL",t[t.LABEL_MATERIAL=15]="LABEL_MATERIAL",t[t.LINE_CALLOUTS=16]="LINE_CALLOUTS",t[t.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH",t[t.DRAPED_MATERIAL=18]="DRAPED_MATERIAL",t[t.DRAPED_WATER=19]="DRAPED_WATER",t[t.VOXEL=20]="VOXEL",t[t.MAX_SLOTS=21]="MAX_SLOTS"})(he||(he={}));var ut;(function(t){t[t.Color=0]="Color",t[t.Alpha=1]="Alpha",t[t.FrontFace=2]="FrontFace",t[t.NONE=3]="NONE",t[t.COUNT=4]="COUNT"})(ut||(ut={}));let vJ=class{constructor(e=O()){this.intensity=e}},ATe=class{constructor(e=O(),r=Me(.57735,.57735,.57735)){this.intensity=e,this.direction=r}},nF=class{constructor(e=O(),r=Me(.57735,.57735,.57735),i=!0,s=1,n=1){this.intensity=e,this.direction=r,this.castShadows=i,this.specularStrength=s,this.environmentStrength=n}},OTe=class{constructor(){this.r=[0],this.g=[0],this.b=[0]}};function nQe(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]*e[i];return r}function $9(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]*e;return r}function v2(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]+e[i];return r}function RTe(t){return(t+1)*(t+1)}function oQe(t){return ve(Math.floor(Math.sqrt(t)-1),0,2)}function MTe(t,e,r){const i=t[0],s=t[1],n=t[2],o=r||[];return o.length=RTe(e),e>=0&&(o[0]=.28209479177),e>=1&&(o[1]=.4886025119*i,o[2]=.4886025119*n,o[3]=.4886025119*s),e>=2&&(o[4]=1.09254843059*i*s,o[5]=1.09254843059*s*n,o[6]=.31539156525*(3*n*n-1),o[7]=1.09254843059*i*n,o[8]=.54627421529*(i*i-s*s)),o}function aQe(t,e){const r=RTe(t),i=e||{r:[],g:[],b:[]};i.r.length=i.g.length=i.b.length=r;for(let s=0;s<r;s++)i.r[s]=i.g[s]=i.b[s]=0;return i}function lQe(t,e){const r=oQe(e.r.length);for(const i of t)pa(mH,i.direction),MTe(mH,r,Lg),nQe(Lg,rN),$9(Lg,i.intensity[0],Vx),v2(e.r,Vx),$9(Lg,i.intensity[1],Vx),v2(e.g,Vx),$9(Lg,i.intensity[2],Vx),v2(e.b,Vx);return e}function cQe(t,e){MTe(mH,0,Lg);for(const r of t)e.r[0]+=Lg[0]*rN[0]*r.intensity[0]*4*Math.PI,e.g[0]+=Lg[0]*rN[0]*r.intensity[1]*4*Math.PI,e.b[0]+=Lg[0]*rN[0]*r.intensity[2]*4*Math.PI;return e}function uQe(t,e,r,i){aQe(e,i),se(r.intensity,0,0,0);let s=!1;const n=hQe,o=dQe,a=pQe;n.length=0,o.length=0,a.length=0;for(const l of t)l instanceof nF&&!s?(re(r.direction,l.direction),re(r.intensity,l.intensity),r.specularStrength=l.specularStrength,r.environmentStrength=l.environmentStrength,r.castShadows=l.castShadows,s=!0):l instanceof nF||l instanceof ATe?n.push(l):l instanceof vJ?o.push(l):l instanceof OTe&&a.push(l);lQe(n,i),cQe(o,i);for(const l of a)v2(i.r,l.r),v2(i.g,l.g),v2(i.b,l.b)}const hQe=[],dQe=[],pQe=[],Lg=[0],Vx=[0],mH=O(),rN=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];let nne=class{constructor(){this.color=O(),this.intensity=1}},fQe=class{constructor(){this.direction=O(),this.ambient=new nne,this.diffuse=new nne}};const PTe=.4;let L9=class{constructor(){this._shOrder=2,this._legacy=new fQe,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new OTe,this._mainLight=new nF(O(),Me(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(e){uQe(e,this._shOrder,this._mainLight,this._sphericalHarmonics),re(this._legacy.direction,this._mainLight.direction);const r=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*r,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*r,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*r,ie(this._legacy.diffuse.color,this._mainLight.intensity,r),re(DI,this._legacy.diffuse.color),ie(DI,DI,PTe*this.globalFactor),ue(this._legacy.ambient.color,this._legacy.ambient.color,DI)}copyFrom(e){this._sphericalHarmonics.r=Array.from(e.sh.r),this._sphericalHarmonics.g=Array.from(e.sh.g),this._sphericalHarmonics.b=Array.from(e.sh.b),re(this._mainLight.direction,e.mainLight.direction),re(this._mainLight.intensity,e.mainLight.intensity),this._mainLight.castShadows=e.mainLight.castShadows,this._mainLight.specularStrength=e.mainLight.specularStrength,this._mainLight.environmentStrength=e.mainLight.environmentStrength,this.globalFactor=e.globalFactor,this.noonFactor=e.noonFactor}lerpLighting(e,r,i){if(Hr(this._mainLight.intensity,e.mainLight.intensity,r.mainLight.intensity,i),this._mainLight.environmentStrength=St(e.mainLight.environmentStrength,r.mainLight.environmentStrength,i),this._mainLight.specularStrength=St(e.mainLight.specularStrength,r.mainLight.specularStrength,i),re(this._mainLight.direction,r.mainLight.direction),this._mainLight.castShadows=r.mainLight.castShadows,this.globalFactor=St(e.globalFactor,r.globalFactor,i),this.noonFactor=St(e.noonFactor,r.noonFactor,i),e.sh.r.length===r.sh.r.length)for(let s=0;s<r.sh.r.length;s++)this._sphericalHarmonics.r[s]=St(e.sh.r[s],r.sh.r[s],i),this._sphericalHarmonics.g[s]=St(e.sh.g[s],r.sh.g[s],i),this._sphericalHarmonics.b[s]=St(e.sh.b[s],r.sh.b[s],i);else for(let s=0;s<r.sh.r.length;s++)this._sphericalHarmonics.r[s]=r.sh.r[s],this._sphericalHarmonics.g[s]=r.sh.g[s],this._sphericalHarmonics.b[s]=r.sh.b[s]}};const DI=O();let iU=class{constructor(e,r,i){this.shadowMap=e,this.ssaoHelper=r,this.slicePlane=i,this.slot=he.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=ut.NONE,this.alignPixelEnabled=!1,this._camera=new gt,this._inverseViewport=Ge(),this.oldLighting=new L9,this.newLighting=new L9,this._fadedLighting=new L9,this._lighting=this.newLighting,this.ssr=new qJe,this.multipassTerrain=new jJe,this.multipassGeometry=new GJe,this.overlays=[],this.cloudsFade=new SJe}get camera(){return this._camera}set camera(e){this._camera=this.ssr.camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(e){const{oldLighting:r,newLighting:i}=this;e>=1?this._lighting=i:(this._fadedLighting.lerpLighting(r,i,e),this._lighting=this._fadedLighting)}},vl=class extends we{constructor(e){super(e),this._handles=new Ii,this._techniques=new Array,this._techniqueConfiguration=new eN,this._bindParameters=new iU(null,null,null),this._passParameters=new pTe,this._drawParameters=new fTe,this._weatherTile=Ge(),this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this.coverage=St(ra.default.coverage[0],ra.default.coverage[1],.5),this.density=St(ra.default.density[0],ra.default.density[1],.5),this.absorption=St(ra.default.absorption[0],ra.default.absorption[1],.5),this.cloudSize=St(ra.default.cloudSize[0],ra.default.cloudSize[1],.5),this.detailSize=St(ra.default.detailSize[0],ra.default.detailSize[1],.5),this.smoothness=St(ra.default.smoothness[0],ra.default.smoothness[1],.5),this.cloudHeight=St(ra.default.cloudHeight[0],ra.default.cloudHeight[1],.5),this.raymarchingSteps=ra.default.raymarchingSteps,this._viewMatrix=be(),this._dirty=!1,this.running=!1,this._vao=kl(e.context.renderContext.rctx)}_getTechnique(e){const r=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,i=r===Dw.RG?2*e:2*e+1;return this._techniques[i]||(this._techniqueConfiguration.writeTextureChannels=r,this._techniqueConfiguration.steps=e,this._techniques[i]=new mTe({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[i])}updateWeatherTile(){const e=this.view.camera.position.latitude,r=this.view.camera.position.longitude;if(e==null||r==null)return;ar(this._weatherTile,(e+90)/180,(r+180)/360);const i=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1));this._weatherTile[0]=Math.floor(2*this._weatherTileCount*this._weatherTile[0]),this._weatherTile[1]=Math.floor(4*(this._weatherTileCount-i)*this._weatherTile[1]);let s=0,n=0;if(this.view.environment!=null&&this.view.environment.lighting.type!=="virtual"&&this.view.environment.lighting.date!=null){const o=new Date(this.view.environment.lighting.date);o.setUTCHours(this.view.environment.lighting.date.getUTCHours()+(this.view.environment.lighting.displayUTCOffset??0)),s=31*o.getUTCMonth()+o.getUTCDate(),n=o.getUTCFullYear()}this._weatherTile[0]=(this._weatherTile[0]+s)%(2*this._weatherTileCount),this._weatherTile[1]=(this._weatherTile[1]+n%100)%(4*this._weatherTileCount),kxe(this._passParameters.weatherTile,this._weatherTile)||this.setDirty()}initialize(){const e=zr(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius,this.setDirty(),this.updateWeatherTile(),this._handles.add([this.view.resourceController.scheduler.registerTask(vt.CLOUDS_GENERATOR,this),ae(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),Pr)])}destroy(){this._handles.destroy(),this._techniques.forEach(e=>Bi(e)),this._frameBufferCube=Ve(this._frameBufferCube),this._techniques.length=0,this._vao.dispose(),this._passParameters.noiseTexture=$e(this._passParameters.noiseTexture)}get _tilesPerFace(){switch(this._techniqueConfiguration.steps){case Rl.SIXTEEN:return 1;case Rl.HUNDRED:return 4;case Rl.COUNT:case Rl.TWOHUNDRED:return 8}}_ensureNoiseTexture(){if(this._passParameters.noiseTexture!=null)this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile);else{const e=this.context;this._passParameters.noiseTexture=new B3({context:e}),this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile)}return this._passParameters.noiseTexture.textureAtlas!=null}_ensureFrameBufferCube(e){if(this._frameBufferCube==null){const r=new xr(e);r.target=as.TEXTURE_CUBE_MAP,r.wrapMode=Dt.CLAMP_TO_EDGE,this._frameBufferCube=new hn(this.context.renderContext.rctx,r)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}destroyFrameBufferCube(){this._frameBufferCube=Ve(this._frameBufferCube)}applyPreset(e,r){const i=e.median,s=n=>{const o=St(n[0],n[1],i);return r<.5?St(n[0],o,2*r):St(o,n[1],2*(r-.5))};this.coverage=s(e.coverage),this.density=s(e.density),this.absorption=s(e.absorption),this.cloudSize=s(e.cloudSize),this.detailSize=s(e.detailSize),this.smoothness=s(e.smoothness),this.cloudHeight=s(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps}setDirty(){this._dirty=this.running=!0}runTask(e){this._faceIndex===0&&this._tileIndex===0&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),fn(this._passParameters.weatherTile,this._weatherTile));const r=this._getTechnique(this._passParameters.raymarchingSteps);if(!r.compiled||!this.context.renderContext.bindParameters.cloudsFade.isCameraPositionFinal||this.context.renderContext.bindParameters.cloudsFade.isFading||!this._ensureNoiseTexture())return Wo.YIELD;this._faceIndex===0&&this._tileIndex===0&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=$s.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);const i=this.context.renderContext.rctx,s=i.bindTechnique(r,this._passParameters,this._bindParameters);i.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao);const n=i.getViewport(),o=r.configuration.cubeMapSize,a=o/this._tilesPerFace,l=this._tileIndex*a;i.setViewport(0,l,o,a);const c=this._ensureFrameBufferCube(o);i.bindFramebuffer(c);const h=mQe[this._faceIndex],p=gQe[this._faceIndex];Cve(this._viewMatrix,yQe,h,p),Vh(this._drawParameters.viewMatrix,this._viewMatrix);const f=as.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex;return c.setColorTextureTarget(f),s.bindDraw(this._drawParameters,this._bindParameters,this._passParameters),i.gl.drawArrays(i.gl.TRIANGLE_STRIP,0,4),i.gl.flush(),i.setViewport(n.x,n.y,n.width,n.height),this.requestRender(),++this._tileIndex,this._faceIndex===4&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._faceIndex=0,this._tileIndex=0,this.context.renderContext.bindParameters.cloudsFade.renderingStage=$s.FINISHED_RENDERING):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0),e.madeProgress(),Wo.YIELD}};u([d({constructOnly:!0})],vl.prototype,"context",void 0),u([d({constructOnly:!0})],vl.prototype,"view",void 0),u([d({constructOnly:!0})],vl.prototype,"requestRender",void 0),u([d()],vl.prototype,"coverage",void 0),u([d()],vl.prototype,"density",void 0),u([d()],vl.prototype,"absorption",void 0),u([d()],vl.prototype,"cloudSize",void 0),u([d()],vl.prototype,"detailSize",void 0),u([d()],vl.prototype,"smoothness",void 0),u([d()],vl.prototype,"cloudHeight",void 0),u([d()],vl.prototype,"raymarchingSteps",void 0),u([d()],vl.prototype,"running",void 0),vl=u([P("esri.views.3d.environment.CloudsGenerator")],vl);const mQe=[Jr(1,0,0),Jr(-1,0,0),Jr(0,1,0),Jr(0,-1,0),Jr(0,0,1)],gQe=[Jr(0,1,0),Jr(0,1,0),Jr(0,0,-1),Jr(0,0,1),Jr(0,1,0)],yQe=FY();let ITe=class extends ri{constructor(){super(...arguments),this.fogColor=O(),this.fogStrength=4e-6,this.atmosphereC=1,this.fogAmount=0}};function _Qe(){const t=new Sr;t.attributes.add(C.POSITION,"vec2"),t.include(Yf,{textureCoordinateType:Ds.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:e,fragment:r}=t;return e.uniforms.add(new Fi("inverseProjectionMatrix",(i,s)=>s.camera.inverseProjectionMatrix),new Fi("inverseViewMatrix",(i,s)=>rC(vQe,s.camera.viewMatrix))),e.code.add(w`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add(new Pe("atmosphereC",i=>i.atmosphereC),new zt("cameraPosition",(i,s)=>s.camera.eye),new Ar("nearFar",(i,s)=>s.camera.nearFar),new et("depthTexture",i=>i.depthTexture),new Pe("fogStrength",i=>i.fogStrength),new Pe("fogAmount",i=>i.fogAmount),new zt("fogColor",i=>i.fogColor)),t.include(eU),r.include(Ru),r.code.add(w`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(w`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),r.code.add(w`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}
void main() {
vec3 rayDir = normalize(worldRay);
float terrainDepth = -1.0;
float depthSample = texture(depthTexture, vuv0).r;
float zNorm = 2.0 * depthSample - 1.0;
float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
if(depthSample < 1.0 && depthSample > 0.0){
vec3 cameraSpaceRay = normalize(eyeDir);
cameraSpaceRay /= cameraSpaceRay.z;
cameraSpaceRay *= linDepth;
terrainDepth = max(0.0, length(cameraSpaceRay));
}
vec4 fog = applyFog(terrainDepth, rayDir);
fragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
}`),t}const vQe=be(),bQe=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:ITe,build:_Qe},Symbol.toStringTag,{value:"Module"}));let $Te=class LTe extends Lr{constructor(e){super(e,new va,()=>this.destroy())}initializeProgram(e){return new Rr(e.rctx,LTe.shader.get().build(),Tr)}initializePipeline(){return Mt({blending:Eo(xe.SRC_ALPHA,xe.ZERO,xe.ONE_MINUS_SRC_ALPHA,xe.ONE),colorWrite:Gt})}};$Te.shader=new Or(bQe,()=>ce(()=>import("./Fog.glsl-17b201a7.js"),[],import.meta.url));const wQe=.95,xQe=1;let ob=class extends we{constructor(e){super(e),this._passParameters=new ITe;const r=e.context.renderContext.rctx;this._vao=kl(r,WM),this._technique=new $Te(e);const i=zr(e.view.spatialReference);this._planetRadius=i.radius,this._atmosphereRadius=i.radius+l_}destroy(){this._technique.release(),this._vao.dispose()}set strength(e){this._passParameters.fogStrength=e}get strength(){return this._passParameters.fogStrength}render(e,r){if(this._update(e,r),this._passParameters.fogAmount<=0)return;const i=this._technique;if(!i.compiled)return void this.context.requestRender();const s=e.offscreenRenderingHelper;s.renderDepthDetached(()=>{this._passParameters.depthTexture=s.depthTexture;const n=e.rctx.bindTechnique(i,this._passParameters,e.bindParameters);this._renderFog(n,e)})}_renderFog(e,r){const i=r.rctx;i.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(At.TRIANGLE_STRIP,0,4)}_update(e,r){const i=e.bindParameters.camera;ye(one,i.eye);const s=Math.max(0,fe(one,e.bindParameters.lighting.mainLight.direction)),n=r.color;ie(ane,n,.1),Hr(this._passParameters.fogColor,ane,n,s);const o=Oe(i.eye),a=o*o;this._passParameters.atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.fogAmount=(1-bR(wQe*Of,xQe*Of,Math.abs(o-this._planetRadius)))*r.amount,this._passParameters.fogStrength=r.strength}static isSupported(e){return e.capabilities.depthTexture}};u([d({constructOnly:!0})],ob.prototype,"context",void 0),u([d({constructOnly:!0})],ob.prototype,"view",void 0),u([d({constructOnly:!0})],ob.prototype,"rctx",void 0),u([d({constructOnly:!0})],ob.prototype,"viewingMode",void 0),ob=u([P("esri.views.3d.environment.Fog")],ob);let TQe=class{constructor(){this.color=O(),this.strength=0,this.amount=0}};const one=O(),ane=O();let Vo=class extends va{};u([B({constValue:!0})],Vo.prototype,"hasSliceHighlight",void 0),u([B({constValue:!1})],Vo.prototype,"hasSliceInVertexProgram",void 0),u([B({constValue:!1})],Vo.prototype,"instancedDoublePrecision",void 0),u([B({constValue:!1})],Vo.prototype,"hasModelTransformation",void 0),u([B({constValue:ei.Pass})],Vo.prototype,"pbrTextureBindType",void 0);var pm;(function(t){t[t.Cone=0]="Cone",t[t.Cylinder=1]="Cylinder",t[t.Underground=2]="Underground",t[t.COUNT=3]="COUNT"})(pm||(pm={}));let bJ=class extends Vo{constructor(){super(...arguments),this.geometry=pm.Cone}};u([B({count:pm.COUNT})],bJ.prototype,"geometry",void 0);var U;(function(t){t[t.Color=0]="Color",t[t.Depth=1]="Depth",t[t.Normal=2]="Normal",t[t.Shadow=3]="Shadow",t[t.ShadowHighlight=4]="ShadowHighlight",t[t.ShadowExcludeHighlight=5]="ShadowExcludeHighlight",t[t.Highlight=6]="Highlight",t[t.Alpha=7]="Alpha",t[t.ObjectAndLayerIdColor=8]="ObjectAndLayerIdColor",t[t.COUNT=9]="COUNT"})(U||(U={}));function ZM(t){t.attributes.add(C.POSITION,"vec3"),t.vertex.code.add(w`vec3 positionModel() { return position; }`)}function oF({code:t},e){e.doublePrecisionRequiresObfuscation?t.add(w`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):t.add(w`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}let Yh=class extends hs{constructor(e,r){super(e,"mat3",ei.Pass,(i,s,n)=>i.setUniformMatrix3fv(e,r(s,n)))}};function b2(t,e){t.include(ZM);const r=t.vertex;r.include(oF,e),t.varyings.add("vPositionWorldCameraRelative","vec3"),t.varyings.add("vPosition_view","vec3"),r.uniforms.add(new zt("transformWorldFromViewTH",i=>i.transformWorldFromViewTH),new zt("transformWorldFromViewTL",i=>i.transformWorldFromViewTL),new Yh("transformViewFromCameraRelativeRS",i=>i.transformViewFromCameraRelativeRS),new Fi("transformProjFromView",i=>i.transformProjFromView),new VR("transformWorldFromModelRS",i=>i.transformWorldFromModelRS),new wu("transformWorldFromModelTH",i=>i.transformWorldFromModelTH),new wu("transformWorldFromModelTL",i=>i.transformWorldFromModelTL)),r.code.add(w`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),r.code.add(w`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${e.spherical?w`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:w`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),t.fragment.uniforms.add(new zt("transformWorldFromViewTL",i=>i.transformWorldFromViewTL)),r.code.add(w`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),t.fragment.code.add(w`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}let DTe=class extends ri{constructor(){super(...arguments),this.transformWorldFromViewTH=O(),this.transformWorldFromViewTL=O(),this.transformViewFromCameraRelativeRS=Ui(),this.transformProjFromView=be()}},NTe=class extends ri{constructor(){super(...arguments),this.transformWorldFromModelRS=Ui(),this.transformWorldFromModelTH=O(),this.transformWorldFromModelTL=O()}};function av(t){t.varyings.add("linearDepth","float")}function Nw(t){t.vertex.uniforms.add(new Ar("nearFar",(e,r)=>r.camera.nearFar))}function sU(t){t.vertex.code.add(w`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function cC(t,e){const{vertex:r}=t;switch(e.output){case U.Color:if(e.receiveShadows)return av(t),void r.code.add(w`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case U.Depth:case U.Shadow:case U.ShadowHighlight:case U.ShadowExcludeHighlight:return t.include(b2,e),av(t),Nw(t),sU(t),void r.code.add(w`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}r.code.add(w`void forwardLinearDepth() {}`)}function Ml(t){sU(t),t.vertex.code.add(w`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),t.vertex.code.add(w`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}let wJ=class extends ri{constructor(){super(...arguments),this.texV=Ge(),this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new FTe}},FTe=class{constructor(){this.center=O(),this.v1=O(),this.v2=O()}};function SQe(t){const e=new Sr,{vertex:r,fragment:i}=e;if(Cy(r),t.geometry===pm.Underground)e.attributes.add(C.POSITION,"vec2"),e.varyings.add("color","vec4"),r.uniforms.add(new zt("cameraPosition",(s,n)=>n.camera.eye),new Pe("undergroundFadeAlpha",s=>s.undergroundFadeAlpha)),r.code.add(w`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),i.code.add(w`void main() {
fragColor = color;
}`);else{e.include(Ml,t),e.attributes.add(C.POSITION,"vec3"),e.varyings.add("vtc","vec2"),e.varyings.add("falloff","float");const s=t.geometry===pm.Cylinder;r.uniforms.add(new Fi("proj",(a,l)=>l.camera.projectionMatrix),new Fi("view",(a,l)=>l.camera.viewMatrix)),s||(e.varyings.add("innerFactor","float"),r.uniforms.add(new zt("silCircleCenter",a=>a.silhouette.center)),r.uniforms.add(new zt("silCircleV1",a=>a.silhouette.v1)),r.uniforms.add(new zt("silCircleV2",a=>a.silhouette.v2)),r.uniforms.add(new Ar("texV",a=>a.texV)),r.uniforms.add(new Pe("innerScale",a=>a.innerScale)));const n=6.2831853,o=1/128;r.code.add(w`
		void main(void) {
      ${s?w`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:w`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${w.float(n*o)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${w.float(o)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),i.uniforms.add(new et("tex",a=>a.texture)),s||i.uniforms.add(new Pe("altitudeFade",a=>a.altitudeFade)),i.code.add(w`
		void main() {
			vec4 atmosphereColor = texture(tex, vtc) * falloff;
      ${s?w`fragColor = atmosphereColor;`:w`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			fragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return e}const EQe=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:FTe,SimpleAtmospherePassParameters:wJ,build:SQe},Symbol.toStringTag,{value:"Module"}));let aF=class UTe extends Lr{initializeProgram(e){return new Rr(e.rctx,UTe.shader.get().build(this.configuration),Tr)}initializePipeline(){return this.configuration.geometry===pm.Cylinder?Mt({blending:Eo(xe.SRC_ALPHA,xe.ONE,xe.ONE_MINUS_SRC_ALPHA,xe.ONE_MINUS_SRC_ALPHA),culling:cJ,depthTest:{func:ti.LEQUAL},colorWrite:Gt}):Mt({blending:Eo(xe.SRC_ALPHA,xe.ONE,xe.ONE_MINUS_SRC_ALPHA,xe.ONE_MINUS_SRC_ALPHA),depthTest:{func:ti.LEQUAL},colorWrite:Gt})}};aF.shader=new Or(EQe,()=>ce(()=>import("./SimpleAtmosphere.glsl-93646cb9.js"),[],import.meta.url));const CQe=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);function Fc(t,e=0){const r=t.stride;return Array.from(t.fields.keys()).filter(i=>{const s=t.fields.get(i)?.optional;return!(s&&s.glPadding)}).map(i=>{const s=t.fields.get(i),n=s.constructor.ElementCount,o=AQe(s.constructor.ElementType),a=s.offset,l=!(!s.optional||!s.optional.glNormalized);return new bo(i,n,o,a,r,l,e)})}function AQe(t){const e=OQe[t];if(e)return e;throw new Error("BufferType not supported in WebGL")}const OQe={u8:rt.UNSIGNED_BYTE,u16:rt.UNSIGNED_SHORT,u32:rt.UNSIGNED_INT,i8:rt.BYTE,i16:rt.SHORT,i32:rt.INT,f32:rt.FLOAT};let xJ=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=9;const o=this.TypedArrayConstructor;s===void 0&&(s=9*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getMat(e,r){let i=e*this.typedBufferStride;for(let s=0;s<9;s++)r[s]=this.typedBuffer[i++];return r}setMat(e,r){let i=e*this.typedBufferStride;for(let s=0;s<9;s++)this.typedBuffer[i++]=r[s]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;for(let l=0;l<9;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}};xJ.ElementCount=9;let TJ=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=16;const o=this.TypedArrayConstructor;s===void 0&&(s=16*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getMat(e,r){let i=e*this.typedBufferStride;for(let s=0;s<16;s++)r[s]=this.typedBuffer[i++];return r}setMat(e,r){let i=e*this.typedBufferStride;for(let s=0;s<16;s++)this.typedBuffer[i++]=r[s]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;for(let l=0;l<16;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}};TJ.ElementCount=16;let Ry=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=1;const o=this.TypedArrayConstructor;s===void 0&&(s=o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.stride=s,this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,r){this.typedBuffer[e*this.typedBufferStride]=r}get buffer(){return this.typedBuffer.buffer}};Ry.ElementCount=1;let My=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=2;const o=this.TypedArrayConstructor;s===void 0&&(s=2*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,ar(r,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e]=r[1]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e]=i}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};My.ElementCount=2;let Py=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=3;const o=this.TypedArrayConstructor;s===void 0&&(s=3*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,se(r,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e++]=r[1],this.typedBuffer[e]=r[2]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i,s){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e++]=i,this.typedBuffer[e]=s}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};Py.ElementCount=3;let Iy=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.start=i,this.elementCount=4;const o=this.TypedArrayConstructor;s===void 0&&(s=4*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,xi(r,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e++]=r[1],this.typedBuffer[e++]=r[2],this.typedBuffer[e]=r[3]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i,s,n){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e++]=i,this.typedBuffer[e++]=s,this.typedBuffer[e]=n}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};Iy.ElementCount=4;let nU=class kTe extends Ry{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}static fromTypedArray(e,r){return new kTe(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};nU.ElementType="f32";let Cv=class gH extends My{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(gH,e,r)}static fromTypedArray(e,r){return new gH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Cv.ElementType="f32";let dn=class yH extends Py{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(yH,e,r)}static fromTypedArray(e,r){return new yH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};dn.ElementType="f32";let Ep=class _H extends Iy{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(_H,e,r)}static fromTypedArray(e,r){return new _H(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Ep.ElementType="f32";let lv=class vH extends xJ{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(vH,e,r)}static fromTypedArray(e,r){return new vH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};lv.ElementType="f32";let SJ=class bH extends xJ{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(bH,e,r)}static fromTypedArray(e,r){return new bH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};SJ.ElementType="f64";let EJ=class wH extends TJ{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(wH,e,r)}static fromTypedArray(e,r){return new wH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};EJ.ElementType="f32";let GR=class xH extends TJ{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(xH,e,r)}static fromTypedArray(e,r){return new xH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};GR.ElementType="f64";let CJ=class TH extends Ry{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(TH,e,r)}static fromTypedArray(e,r){return new TH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};CJ.ElementType="f64";let AJ=class SH extends My{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(SH,e,r)}static fromTypedArray(e,r){return new SH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};AJ.ElementType="f64";let Hh=class EH extends Py{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(EH,e,r)}static fromTypedArray(e,r){return new EH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Hh.ElementType="f64";let oU=class CH extends Iy{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(CH,e,r)}static fromTypedArray(e,r){return new CH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};oU.ElementType="f64";let gE=class AH extends Ry{constructor(e,r=0,i,s){super(Uint8Array,e,r,i,s),this.elementType="u8"}slice(e,r){return this.sliceBuffer(AH,e,r)}static fromTypedArray(e,r){return new AH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};gE.ElementType="u8";let aU=class OH extends My{constructor(e,r=0,i,s){super(Uint8Array,e,r,i,s),this.elementType="u8"}slice(e,r){return this.sliceBuffer(OH,e,r)}static fromTypedArray(e,r){return new OH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};aU.ElementType="u8";let lU=class RH extends Py{constructor(e,r=0,i,s){super(Uint8Array,e,r,i,s),this.elementType="u8"}slice(e,r){return this.sliceBuffer(RH,e,r)}static fromTypedArray(e,r){return new RH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};lU.ElementType="u8";let ga=class MH extends Iy{constructor(e,r=0,i,s){super(Uint8Array,e,r,i,s),this.elementType="u8"}slice(e,r){return this.sliceBuffer(MH,e,r)}static fromTypedArray(e,r){return new MH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};ga.ElementType="u8";let cU=class PH extends Ry{constructor(e,r=0,i,s){super(Uint16Array,e,r,i,s),this.elementType="u16"}slice(e,r){return this.sliceBuffer(PH,e,r)}static fromTypedArray(e,r){return new PH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};cU.ElementType="u16";let OJ=class IH extends My{constructor(e,r=0,i,s){super(Uint16Array,e,r,i,s),this.elementType="u16"}slice(e,r){return this.sliceBuffer(IH,e,r)}static fromTypedArray(e,r){return new IH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};OJ.ElementType="u16";let uU=class $H extends Py{constructor(e,r=0,i,s){super(Uint16Array,e,r,i,s),this.elementType="u16"}slice(e,r){return this.sliceBuffer($H,e,r)}static fromTypedArray(e,r){return new $H(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};uU.ElementType="u16";let YM=class LH extends Iy{constructor(e,r=0,i,s){super(Uint16Array,e,r,i,s),this.elementType="u16"}slice(e,r){return this.sliceBuffer(LH,e,r)}static fromTypedArray(e,r){return new LH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};YM.ElementType="u16";let hU=class DH extends Ry{constructor(e,r=0,i,s){super(Uint32Array,e,r,i,s),this.elementType="u32"}slice(e,r){return this.sliceBuffer(DH,e,r)}static fromTypedArray(e,r){return new DH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};hU.ElementType="u32";let RJ=class NH extends My{constructor(e,r=0,i,s){super(Uint32Array,e,r,i,s),this.elementType="u32"}slice(e,r){return this.sliceBuffer(NH,e,r)}static fromTypedArray(e,r){return new NH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};RJ.ElementType="u32";let zTe=class FH extends Py{constructor(e,r=0,i,s){super(Uint32Array,e,r,i,s),this.elementType="u32"}slice(e,r){return this.sliceBuffer(FH,e,r)}static fromTypedArray(e,r){return new FH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};zTe.ElementType="u32";let VTe=class UH extends Iy{constructor(e,r=0,i,s){super(Uint32Array,e,r,i,s),this.elementType="u32"}slice(e,r){return this.sliceBuffer(UH,e,r)}static fromTypedArray(e,r){return new UH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};VTe.ElementType="u32";let MJ=class kH extends Ry{constructor(e,r=0,i,s){super(Int8Array,e,r,i,s),this.elementType="i8"}slice(e,r){return this.sliceBuffer(kH,e,r)}static fromTypedArray(e,r){return new kH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};MJ.ElementType="i8";let dU=class zH extends My{constructor(e,r=0,i,s){super(Int8Array,e,r,i,s),this.elementType="i8"}slice(e,r){return this.sliceBuffer(zH,e,r)}static fromTypedArray(e,r){return new zH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};dU.ElementType="i8";let BTe=class VH extends Py{constructor(e,r=0,i,s){super(Int8Array,e,r,i,s),this.elementType="i8"}slice(e,r){return this.sliceBuffer(VH,e,r)}static fromTypedArray(e,r){return new VH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};BTe.ElementType="i8";let GTe=class BH extends Iy{constructor(e,r=0,i,s){super(Int8Array,e,r,i,s),this.elementType="i8"}slice(e,r){return this.sliceBuffer(BH,e,r)}static fromTypedArray(e,r){return new BH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};GTe.ElementType="i8";let jTe=class GH extends Ry{constructor(e,r=0,i,s){super(Int16Array,e,r,i,s),this.elementType="i16"}slice(e,r){return this.sliceBuffer(GH,e,r)}static fromTypedArray(e,r){return new GH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};jTe.ElementType="i16";let JM=class jH extends My{constructor(e,r=0,i,s){super(Int16Array,e,r,i,s),this.elementType="i16"}slice(e,r){return this.sliceBuffer(jH,e,r)}static fromTypedArray(e,r){return new jH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};JM.ElementType="i16";let HTe=class HH extends Py{constructor(e,r=0,i,s){super(Int16Array,e,r,i,s),this.elementType="i16"}slice(e,r){return this.sliceBuffer(HH,e,r)}static fromTypedArray(e,r){return new HH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};HTe.ElementType="i16";let qTe=class qH extends Iy{constructor(e,r=0,i,s){super(Int16Array,e,r,i,s),this.elementType="i16"}slice(e,r){return this.sliceBuffer(qH,e,r)}static fromTypedArray(e,r){return new qH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};qTe.ElementType="i16";let WTe=class WH extends Ry{constructor(e,r=0,i,s){super(Int32Array,e,r,i,s),this.elementType="i32"}slice(e,r){return this.sliceBuffer(WH,e,r)}static fromTypedArray(e,r){return new WH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};WTe.ElementType="i32";let XTe=class XH extends My{constructor(e,r=0,i,s){super(Int32Array,e,r,i,s),this.elementType="i32"}slice(e,r){return this.sliceBuffer(XH,e,r)}static fromTypedArray(e,r){return new XH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};XTe.ElementType="i32";let ZTe=class ZH extends Py{constructor(e,r=0,i,s){super(Int32Array,e,r,i,s),this.elementType="i32"}slice(e,r){return this.sliceBuffer(ZH,e,r)}static fromTypedArray(e,r){return new ZH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};ZTe.ElementType="i32";let YTe=class YH extends Iy{constructor(e,r=0,i,s){super(Int32Array,e,r,i,s),this.elementType="i32"}slice(e,r){return this.sliceBuffer(YH,e,r)}static fromTypedArray(e,r){return new YH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};YTe.ElementType="i32";function lne(t){switch(t){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}let cne=class JTe{constructor(e,r){this.layout=e,this.buffer=typeof r=="number"?new ArrayBuffer(r*e.stride):r;for(const i of e.fields.keys()){const s=e.fields.get(i);this[i]=new s.constructor(this.buffer,s.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,r){const i=this[e];return i&&i.elementCount===r.ElementCount&&i.elementType===r.ElementType?i:null}slice(e,r){return new JTe(this.layout,this.buffer.slice(e*this.stride,r*this.stride))}copyFrom(e,r=0,i=0,s=e.count){const n=this.stride;if(n%4==0){const o=new Uint32Array(e.buffer,r*n,s*n/4);new Uint32Array(this.buffer,i*n,s*n/4).set(o)}else{const o=new Uint8Array(e.buffer,r*n,s*n);new Uint8Array(this.buffer,i*n,s*n).set(o)}return this}},QTe=class KTe{constructor(e=null){this._stride=0,this._lastAligned=0,this._fields=new Map,e&&(this._stride=e.stride,e.fields.forEach(r=>this._fields.set(r[0],{...r[1],constructor:PQe(r[1].constructor)})))}vec2f(e,r){return this._appendField(e,Cv,r),this}vec2f64(e,r){return this._appendField(e,AJ,r),this}vec3f(e,r){return this._appendField(e,dn,r),this}vec3f64(e,r){return this._appendField(e,Hh,r),this}vec4f(e,r){return this._appendField(e,Ep,r),this}vec4f64(e,r){return this._appendField(e,oU,r),this}mat3f(e,r){return this._appendField(e,lv,r),this}mat3f64(e,r){return this._appendField(e,SJ,r),this}mat4f(e,r){return this._appendField(e,EJ,r),this}mat4f64(e,r){return this._appendField(e,GR,r),this}vec4u8(e,r){return this._appendField(e,ga,r),this}f32(e,r){return this._appendField(e,nU,r),this}f64(e,r){return this._appendField(e,CJ,r),this}u8(e,r){return this._appendField(e,gE,r),this}u16(e,r){return this._appendField(e,cU,r),this}i8(e,r){return this._appendField(e,MJ,r),this}vec2i8(e,r){return this._appendField(e,dU,r),this}vec2i16(e,r){return this._appendField(e,JM,r),this}vec2u8(e,r){return this._appendField(e,aU,r),this}vec4u16(e,r){return this._appendField(e,YM,r),this}u32(e,r){return this._appendField(e,hU,r),this}_appendField(e,r,i){if(this._fields.has(e))return void nt(!1,`${e} already added to vertex buffer layout`);const s=r.ElementCount*lne(r.ElementType),n=this._stride;this._stride+=s,this._fields.set(e,{size:s,constructor:r,offset:n,optional:i})}createBuffer(e){return new cne(this,e)}createView(e){return new cne(this,e)}clone(){const e=new KTe;return e._stride=this._stride,e._fields=new Map,this._fields.forEach((r,i)=>e._fields.set(i,r)),e.BufferType=this.BufferType,e}get stride(){if(this._lastAligned!==this._fields.size){let e=1;this._fields.forEach(r=>e=Math.max(e,lne(r.constructor.ElementType))),this._stride=Math.floor((this._stride+e-1)/e)*e,this._lastAligned=this._fields.size}return this._stride}get fields(){return this._fields}};function Hi(){return new QTe}let RQe=class{constructor(e){this.fields=new Array,e.fields.forEach((r,i)=>{const s={...r,constructor:eSe(r.constructor)};this.fields.push([i,s])}),this.stride=e.stride}};const MQe=[nU,Cv,dn,Ep,lv,EJ,CJ,AJ,Hh,oU,SJ,GR,gE,aU,lU,ga,cU,OJ,uU,YM,hU,RJ,zTe,VTe,MJ,dU,BTe,GTe,jTe,JM,HTe,qTe,WTe,XTe,ZTe,YTe];function eSe(t){return`${t.ElementType}_${t.ElementCount}`}function PQe(t){return tSe.get(t)}const tSe=new Map;MQe.forEach(t=>tSe.set(eSe(t),t));function Ho(t,e=!1){return t<=Su?e?new Array(t).fill(0):new Array(t):new Float64Array(t)}function rSe(t){return(vp(t)?t.length:t.byteLength/8)<=Su?Array.from(t):new Float64Array(t)}function $h(t,e,r){return Array.isArray(t)?t.slice(e,e+r):t.subarray(e,e+r)}function u5t(t,e){for(let r=0;r<e.length;++r)t[r]=e[r];return t}function h5t(t){return Array.isArray(t)?new Float64Array(t):t}function Ki(t,e=!1){return t<=Su?e?new Array(t).fill(0):new Array(t):new Float32Array(t)}function d5t(t){return vp(t)?t.length<Su?t:new Float32Array(t):t.length<Su?Array.from(t):t}function une(t){return(vp(t)?t.length:t.byteLength/8)<=Su?Array.from(t):new Float32Array(t)}function lF(t,e,r){return Array.isArray(t)?t.slice(e,e+r):t.subarray(e,e+r)}function Qf(t){return vp(t)?t.length<Su?t:hne(t):t.length<Su?Array.from(t):t.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT?t:hne(t)}function hne(t){let e=!0;for(const r of t){if(r>=65536)return vp(t)?new Uint32Array(t):t;r>=256&&(e=!1)}return e?new Uint8Array(t):new Uint16Array(t)}function cF(t){return t<=Su?new Array(t):t<=65536?new Uint16Array(t):new Uint32Array(t)}function IQe(t){return t<=Su?new Array(t):new Uint32Array(t)}let Bx=(()=>{const t=new Uint32Array(131072);for(let e=0;e<t.length;++e)t[e]=e;return t})();const iSe=[0],D9=(()=>{const t=new Uint16Array(65536);for(let e=0;e<t.length;++e)t[e]=e;return t})();function yE(t){if(t===1)return iSe;if(t<Su)return Array.from(new Uint16Array(D9.buffer,0,t));if(t<D9.length)return new Uint16Array(D9.buffer,0,t);if(t>Bx.length){const e=Math.max(2*Bx.length,t);Bx=new Uint32Array(e);for(let r=0;r<Bx.length;r++)Bx[r]=r}return new Uint32Array(Bx.buffer,0,t)}let NI=new Uint8Array(65536);function uC(t){if(t===1)return iSe;if(t<Su)return new Array(t).fill(0);if(t>NI.length){const e=Math.max(2*NI.length,t);NI=new Uint8Array(e)}return new Uint8Array(NI.buffer,0,t)}var JH;(function(t){function e(o,a){const l=o[a],c=o[a+1],h=o[a+2];return Math.sqrt(l*l+c*c+h*h)}function r(o,a){const l=o[a],c=o[a+1],h=o[a+2],p=1/Math.sqrt(l*l+c*c+h*h);o[a]*=p,o[a+1]*=p,o[a+2]*=p}function i(o,a,l){o[a]*=l,o[a+1]*=l,o[a+2]*=l}function s(o,a,l,c,h,p=a){(h=h||o)[p]=o[a]+l[c],h[p+1]=o[a+1]+l[c+1],h[p+2]=o[a+2]+l[c+2]}function n(o,a,l,c,h,p=a){(h=h||o)[p]=o[a]-l[c],h[p+1]=o[a+1]-l[c+1],h[p+2]=o[a+2]-l[c+2]}t.length=e,t.normalize=r,t.scale=i,t.add=s,t.subtract=n})(JH||(JH={}));var ls;(function(t){t[t.Layer=0]="Layer",t[t.Object=1]="Object",t[t.Mesh=2]="Mesh",t[t.Line=3]="Line",t[t.Point=4]="Point",t[t.Material=5]="Material",t[t.Texture=6]="Texture",t[t.COUNT=7]="COUNT"})(ls||(ls={}));function $Qe(t){if(t.length<Su)return Array.from(t);if(vp(t))return Float64Array.from(t);if(!("BYTES_PER_ELEMENT"in t))return Array.from(t);switch(t.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(t);case 2:return $5(t)?Uint16Array.from(t):Int16Array.from(t);case 4:return Float32Array.from(t);default:return Float64Array.from(t)}}let sSe=class nSe{constructor(e,r,i,s){this.primitiveIndices=e,this._numIndexPerPrimitive=r,this.indices=i,this.position=s,this._children=void 0,nt(e.length>=1),nt(i.length%this._numIndexPerPrimitive==0),nt(i.length>=e.length*this._numIndexPerPrimitive),nt(s.size===3||s.size===4);const{data:n,size:o}=s,a=e.length;let l=o*i[this._numIndexPerPrimitive*e[0]];Vv.clear(),Vv.push(l);const c=Me(n[l],n[l+1],n[l+2]),h=Fs(c);for(let m=0;m<a;++m){const y=this._numIndexPerPrimitive*e[m];for(let _=0;_<this._numIndexPerPrimitive;++_){l=o*i[y+_],Vv.push(l);let v=n[l];c[0]=Math.min(v,c[0]),h[0]=Math.max(v,h[0]),v=n[l+1],c[1]=Math.min(v,c[1]),h[1]=Math.max(v,h[1]),v=n[l+2],c[2]=Math.min(v,c[2]),h[2]=Math.max(v,h[2])}}this.bbMin=c,this.bbMax=h;const p=Hr(O(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(h[0]-c[0],h[1]-c[1]),h[2]-c[2]);let f=this.radius*this.radius;for(let m=0;m<Vv.length;++m){l=Vv.at(m);const y=n[l]-p[0],_=n[l+1]-p[1],v=n[l+2]-p[2],b=y*y+_*_+v*v;if(b<=f)continue;const T=Math.sqrt(b),x=.5*(T-this.radius);this.radius=this.radius+x,f=this.radius*this.radius;const S=x/T;p[0]+=y*S,p[1]+=_*S,p[2]+=v*S}this.center=p,Vv.clear()}getChildren(){if(this._children||vo(this.bbMin,this.bbMax)<=1)return this._children;const e=Hr(O(),this.bbMin,this.bbMax,.5),r=this.primitiveIndices.length,i=new Uint8Array(r),s=new Array(8);for(let c=0;c<8;++c)s[c]=0;const{data:n,size:o}=this.position;for(let c=0;c<r;++c){let h=0;const p=this._numIndexPerPrimitive*this.primitiveIndices[c];let f=o*this.indices[p],m=n[f],y=n[f+1],_=n[f+2];for(let v=1;v<this._numIndexPerPrimitive;++v){f=o*this.indices[p+v];const b=n[f],T=n[f+1],x=n[f+2];b<m&&(m=b),T<y&&(y=T),x<_&&(_=x)}m<e[0]&&(h|=1),y<e[1]&&(h|=2),_<e[2]&&(h|=4),i[c]=h,++s[h]}let a=0;for(let c=0;c<8;++c)s[c]>0&&++a;if(a<2)return;const l=new Array(8);for(let c=0;c<8;++c)l[c]=s[c]>0?new Uint32Array(s[c]):void 0;for(let c=0;c<8;++c)s[c]=0;for(let c=0;c<r;++c){const h=i[c];l[h][s[h]++]=this.primitiveIndices[c]}this._children=new Array;for(let c=0;c<8;++c)l[c]!==void 0&&this._children.push(new nSe(l[c],this._numIndexPerPrimitive,this.indices,this.position));return this._children}static prune(){Vv.prune()}};const Vv=new Bt({deallocator:null});let QM=class{constructor(){this.id=Cc()}unload(){}};function LQe(t){return t?{p0:Fs(t.p0),p1:Fs(t.p1),p2:Fs(t.p2)}:{p0:O(),p1:O(),p2:O()}}function dne(t,e,r){const i=e[0]-t[0],s=e[1]-t[1],n=r[0]-t[0],o=r[1]-t[1];return .5*Math.abs(i*o-s*n)}function DQe(t,e,r){return de(N9,e,t),de(pne,r,t),Oe(ht(N9,N9,pne))/2}new Sy(Op);new Sy(()=>LQe());const N9=O(),pne=O();function NQe(t,e,r){if(!t||!e)return!1;const{size:i,data:s}=t;se(r,0,0,0),se(dh,0,0,0);let n=0,o=0;for(let a=0;a<e.length-2;a+=3){const l=e[a]*i,c=e[a+1]*i,h=e[a+2]*i;se(Xn,s[l],s[l+1],s[l+2]),se(Dg,s[c],s[c+1],s[c+2]),se(FI,s[h],s[h+1],s[h+2]);const p=DQe(Xn,Dg,FI);p?(ue(Xn,Xn,Dg),ue(Xn,Xn,FI),ie(Xn,Xn,1/3*p),ue(r,r,Xn),n+=p):(ue(dh,dh,Xn),ue(dh,dh,Dg),ue(dh,dh,FI),o+=3)}return(o!==0||n!==0)&&(n!==0?(ie(r,r,1/n),!0):o!==0&&(ie(r,dh,1/o),!0))}function FQe(t,e,r){if(!t||!e)return!1;const{size:i,data:s}=t;se(r,0,0,0);let n=-1,o=0;for(let a=0;a<e.length;a++){const l=e[a]*i;n!==l&&(r[0]+=s[l],r[1]+=s[l+1],r[2]+=s[l+2],o++),n=l}return o>1&&ie(r,r,1/o),o>0}function UQe(t,e,r,i){if(!t)return!1;se(i,0,0,0),se(dh,0,0,0);let s=0,n=0;const{size:o,data:a}=t,l=e?e.length-1:a.length/o-1,c=l+(r?2:0);for(let h=0;h<c;h+=2){const p=h<l?h:l,f=h<l?h+1:0,m=(e?e[p]:p)*o,y=(e?e[f]:f)*o;Xn[0]=a[m],Xn[1]=a[m+1],Xn[2]=a[m+2],Dg[0]=a[y],Dg[1]=a[y+1],Dg[2]=a[y+2],ie(Xn,ue(Xn,Xn,Dg),.5);const _=CM(Xn,Dg);_>0?(ue(i,i,ie(Xn,Xn,_)),s+=_):s===0&&(ue(dh,dh,Xn),n++)}return s!==0?(ie(i,i,1/s),!0):n!==0&&(ie(i,dh,1/n),!0)}const Xn=O(),Dg=O(),FI=O(),dh=O();let uF=class{constructor(e){this.channel=e,this.id=Cc()}};function QH(t,e,r){for(let i=0;i<r;++i)e[2*i]=t[i],e[2*i+1]=t[i]-e[2*i]}function kQe(t,e){const r=t.length;for(let i=0;i<r;++i)jS[0]=t[i],e[i]=jS[0];return e}function zQe(t,e){const r=t.length;for(let i=0;i<r;++i)jS[0]=t[i],jS[1]=t[i]-jS[0],e[i]=jS[1];return e}const jS=new Float32Array(2);function KH(t,e){return t==null&&(t=[]),t.push(e),t}function eq(t,e){if(t==null)return null;const r=t.filter(i=>i!==e);return r.length===0?null:r}function VQe(t,e,r,i,s){UI[0]=t.get(e,0),UI[1]=t.get(e,1),UI[2]=t.get(e,2),QH(UI,Bv,3),r.set(s,0,Bv[0]),i.set(s,0,Bv[1]),r.set(s,1,Bv[2]),i.set(s,1,Bv[3]),r.set(s,2,Bv[4]),i.set(s,2,Bv[5])}const UI=O(),Bv=new Float32Array(6);let Ys=class oSe extends QM{constructor(e,r,i=[],s=null,n=ls.Mesh,o=null,a=-1){super(),this.material=e,this.mapPositions=s,this.type=n,this.objectAndLayerIdColor=o,this.edgeIndicesLength=a,this.visible=!0,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[l,c]of r)c&&this._vertexAttributes.set(l,{...c});if(i==null||i.length===0){const l=BQe(this._vertexAttributes),c=yE(l);this.edgeIndicesLength=this.edgeIndicesLength<0?l:this.edgeIndicesLength;for(const h of this._vertexAttributes.keys())this._indices.set(h,c)}else for(const[l,c]of i)c&&(this._indices.set(l,Qf(c)),l===C.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(l).length:this.edgeIndicesLength))}instantiate(e={}){const r=new oSe(e.material||this.material,[],void 0,this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._vertexAttributes.forEach((i,s)=>{i.exclusive=!1,r._vertexAttributes.set(s,i)}),this._indices.forEach((i,s)=>r._indices.set(s,i)),r._boundingInfo=this._boundingInfo,r.transformation=e.transformation||this.transformation,r}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(e){let r=this._vertexAttributes.get(e);return r&&!r.exclusive&&(r={...r,exclusive:!0,data:$Qe(r.data)},this._vertexAttributes.set(e,r)),r}setAttributeData(e,r){const i=this._vertexAttributes.get(e);i&&this._vertexAttributes.set(e,{...i,exclusive:!0,data:r})}get indices(){return this._indices}get indexCount(){const e=this._indices.values().next().value;return e?e.length:0}get faceCount(){return this.indexCount/3}get boundingInfo(){return this._boundingInfo==null&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===ls.Mesh?this._computeAttachmentOriginTriangles(e):this.type===ls.Line?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(this._transformation!=null&&Fe(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){const r=this.indices.get(C.POSITION),i=this.vertexAttributes.get(C.POSITION);return NQe(i,r,e)}_computeAttachmentOriginLines(e){const r=this.vertexAttributes.get(C.POSITION),i=this.indices.get(C.POSITION);return UQe(r,i,i&&GQe(this.material.parameters,r,i),e)}_computeAttachmentOriginPoints(e){const r=this.indices.get(C.POSITION),i=this.vertexAttributes.get(C.POSITION);return FQe(i,r,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.indices.get(C.POSITION),r=this.vertexAttributes.get(C.POSITION);if(!e||e.length===0||!r)return null;const i=this.type===ls.Mesh?3:1;nt(e.length%i==0,"Indexing error: "+e.length+" not divisible by "+i);const s=yE(e.length/i);return new sSe(s,i,e,r)}get transformation(){return this._transformation??un}set transformation(e){this._transformation=e&&e!==un?oE(e):null}get shaderTransformation(){return this._shaderTransformer!=null?this._shaderTransformer(this.transformation):this.transformation}get shaderTransformer(){return this._shaderTransformer}set shaderTransformer(e){this._shaderTransformer=e}get hasVolatileTransformation(){return this._shaderTransformer!=null}addHighlight(){const e=new uF(my.Highlight);return this.highlights=KH(this.highlights,e),e}removeHighlight(e){this.highlights=eq(this.highlights,e)}};function BQe(t){const e=t.values().next().value;return e==null?0:e.data.length/e.size}function GQe(t,e,r){return!(!("isClosed"in t)||!t.isClosed)&&(r?r.length>2:e.data.length>6)}const Gx=JH,F9=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],jQe=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],HQe=[0,0,1,0,1,1,0,1],qQe=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],aSe=new Array(36);for(let t=0;t<6;t++)for(let e=0;e<6;e++)aSe[6*t+e]=t;const ab=new Array(36);for(let t=0;t<6;t++)ab[6*t]=0,ab[6*t+1]=1,ab[6*t+2]=2,ab[6*t+3]=2,ab[6*t+4]=3,ab[6*t+5]=0;function WQe(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(24);for(let i=0;i<8;i++)r[3*i]=F9[i][0]*e[0],r[3*i+1]=F9[i][1]*e[1],r[3*i+2]=F9[i][2]*e[2];return new Ys(t,[[C.POSITION,new He(r,3,!0)],[C.NORMAL,new He(jQe,3)],[C.UV0,new He(HQe,2)]],[[C.POSITION,qQe],[C.NORMAL,aSe],[C.UV0,ab]])}const U9=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],XQe=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],ZQe=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],YQe=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function JQe(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(18);for(let i=0;i<6;i++)r[3*i]=U9[i][0]*e[0],r[3*i+1]=U9[i][1]*e[1],r[3*i+2]=U9[i][2]*e[2];return new Ys(t,[[C.POSITION,new He(r,3,!0)],[C.NORMAL,new He(XQe,3)]],[[C.POSITION,ZQe],[C.NORMAL,YQe]])}const iN=Jr(-.5,0,-.5),sN=Jr(.5,0,-.5),nN=Jr(0,0,.5),oN=Jr(0,.5,0),jx=os(),Hx=os(),w2=os(),x2=os(),T2=os();de(jx,iN,oN),de(Hx,iN,sN),ht(w2,jx,Hx),ye(w2,w2),de(jx,sN,oN),de(Hx,sN,nN),ht(x2,jx,Hx),ye(x2,x2),de(jx,nN,oN),de(Hx,nN,iN),ht(T2,jx,Hx),ye(T2,T2);const k9=[iN,sN,nN,oN],QQe=[0,-1,0,w2[0],w2[1],w2[2],x2[0],x2[1],x2[2],T2[0],T2[1],T2[2]],KQe=[0,1,2,3,1,0,3,2,1,3,0,2],eKe=[0,0,0,1,1,1,2,2,2,3,3,3];function tKe(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(12);for(let i=0;i<4;i++)r[3*i]=k9[i][0]*e[0],r[3*i+1]=k9[i][1]*e[1],r[3*i+2]=k9[i][2]*e[2];return new Ys(t,[[C.POSITION,new He(r,3,!0)],[C.NORMAL,new He(QQe,3)]],[[C.POSITION,KQe],[C.NORMAL,eKe]])}function m5t(t,e,r,i,s={uv:!0}){const n=-Math.PI,o=2*Math.PI,a=-Math.PI/2,l=Math.PI,c=Math.max(3,Math.floor(r)),h=Math.max(2,Math.floor(i)),p=(c+1)*(h+1),f=Ki(3*p),m=Ki(3*p),y=Ki(2*p),_=[];let v=0;for(let S=0;S<=h;S++){const E=[],A=S/h,R=a+A*l,M=Math.cos(R);for(let D=0;D<=c;D++){const k=D/c,$=n+k*o,N=Math.cos($)*M,H=Math.sin(R),Z=-Math.sin($)*M;f[3*v]=N*e,f[3*v+1]=H*e,f[3*v+2]=Z*e,m[3*v]=N,m[3*v+1]=H,m[3*v+2]=Z,y[2*v]=k,y[2*v+1]=A,E.push(v),++v}_.push(E)}const b=new Array;for(let S=0;S<h;S++)for(let E=0;E<c;E++){const A=_[S][E],R=_[S][E+1],M=_[S+1][E+1],D=_[S+1][E];S===0?(b.push(A),b.push(M),b.push(D)):S===h-1?(b.push(A),b.push(R),b.push(M)):(b.push(A),b.push(R),b.push(M),b.push(M),b.push(D),b.push(A))}const T=[[C.POSITION,b],[C.NORMAL,b]],x=[[C.POSITION,new He(f,3,!0)],[C.NORMAL,new He(m,3,!0)]];return s.uv&&(x.push([C.UV0,new He(y,2,!0)]),T.push([C.UV0,b])),s.offset&&(T[0][0]=C.OFFSET,x[0][0]=C.OFFSET,T.push([C.POSITION,uC(b.length)]),x.push([C.POSITION,new He(Float64Array.from(s.offset),3,!0)])),new Ys(t,x,T)}function rKe(t,e,r,i){const{vertexAttributes:s,indices:n}=lSe(e,r,i);return new Ys(t,s,n)}function lSe(t,e,r){const i=t;let s,n;if(r)s=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],n=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const h=i*(1+Math.sqrt(5))/2;s=[-i,h,0,i,h,0,-i,-h,0,i,-h,0,0,-i,h,0,i,h,0,-i,-h,0,i,-h,h,0,-i,h,0,i,-h,0,-i,-h,0,i],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let h=0;h<s.length;h+=3)Gx.scale(s,h,t/Gx.length(s,h));let o={};function a(h,p){h>p&&([h,p]=[p,h]);const f=h.toString()+"."+p.toString();if(o[f])return o[f];let m=s.length;return s.length+=3,Gx.add(s,3*h,s,3*p,s,m),Gx.scale(s,m,t/Gx.length(s,m)),m/=3,o[f]=m,m}for(let h=0;h<e;h++){const p=n.length,f=new Array(4*p);for(let m=0;m<p;m+=3){const y=n[m],_=n[m+1],v=n[m+2],b=a(y,_),T=a(_,v),x=a(v,y),S=4*m;f[S]=y,f[S+1]=b,f[S+2]=x,f[S+3]=_,f[S+4]=T,f[S+5]=b,f[S+6]=v,f[S+7]=x,f[S+8]=T,f[S+9]=b,f[S+10]=T,f[S+11]=x}n=f,o={}}const l=une(s);for(let h=0;h<l.length;h+=3)Gx.normalize(l,h);const c=[[C.POSITION,n],[C.NORMAL,n]];return{vertexAttributes:[[C.POSITION,new He(une(s),3,!0)],[C.NORMAL,new He(l,3,!0)]],indices:c}}function tq(t,e,r,i,s,n,o,a,l=null){const c=r?[r[0],r[1],r[2]]:[0,0,0],h=e?[e[0],e[1],e[2]]:[0,0,1];o=o||[0,0];const p=i?[255*i[0],255*i[1],255*i[2],i.length>3?255*i[3]:255]:[255,255,255,255],f=s!=null&&s.length===2?s:[1,1],m=[[C.POSITION,new He(c,3,!0)],[C.NORMAL,new He(h,3,!0)],[C.UV0,new He(o,o.length)],[C.COLOR,new He(p,4,!0)],[C.SIZE,new He(f,2)]];if(n!=null){const y=[n[0],n[1],n[2],n[3]];m.push([C.AUXPOS1,new He(y,4)])}if(a!=null){const y=[a[0],a[1],a[2],a[3]];m.push([C.AUXPOS2,new He(y,4)])}return new Ys(t,m,null,null,ls.Point,l)}const iKe=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function g5t(t,e=iKe){const r=new Array(12);for(let h=0;h<4;h++)for(let p=0;p<3;p++)r[3*h+p]=e[h][p];const i=[0,1,2,2,3,0],s=[0,0,1],n=[0,0,0,0,0,0],o=[0,0,1,0,1,1,0,1],a=[255,255,255,255],l=[[C.POSITION,i],[C.NORMAL,n],[C.UV0,i],[C.COLOR,n]],c=[[C.POSITION,new He(r,3,!0)],[C.NORMAL,new He(s,3,!0)],[C.UV0,new He(o,2,!0)],[C.COLOR,new He(a,4,!0)]];return new Ys(t,c,l)}function fne(t,e,r,i,s,n=!0,o=!0){let a=0;const l=r,c=e;let h=Jr(0,a,0),p=Jr(0,a+c,0),f=Jr(0,-1,0),m=Jr(0,1,0);s&&(a=c,p=Jr(0,0,0),h=Jr(0,a,0),f=Jr(0,1,0),m=Jr(0,-1,0));const y=[p,h],_=[f,m],v=i+2,b=Math.sqrt(c*c+l*l);if(s)for(let M=i-1;M>=0;M--){const D=M*(2*Math.PI/i),k=Jr(Math.cos(D)*l,a,Math.sin(D)*l);y.push(k);const $=Jr(c*Math.cos(D)/b,-l/b,c*Math.sin(D)/b);_.push($)}else for(let M=0;M<i;M++){const D=M*(2*Math.PI/i),k=Jr(Math.cos(D)*l,a,Math.sin(D)*l);y.push(k);const $=Jr(c*Math.cos(D)/b,l/b,c*Math.sin(D)/b);_.push($)}const T=new Array,x=new Array;if(n){for(let M=3;M<y.length;M++)T.push(1),T.push(M-1),T.push(M),x.push(0),x.push(0),x.push(0);T.push(y.length-1),T.push(2),T.push(1),x.push(0),x.push(0),x.push(0)}if(o){for(let M=3;M<y.length;M++)T.push(M),T.push(M-1),T.push(0),x.push(M),x.push(M-1),x.push(1);T.push(0),T.push(2),T.push(y.length-1),x.push(1),x.push(2),x.push(_.length-1)}const S=Ki(3*v);for(let M=0;M<v;M++)S[3*M]=y[M][0],S[3*M+1]=y[M][1],S[3*M+2]=y[M][2];const E=Ki(3*v);for(let M=0;M<v;M++)E[3*M]=_[M][0],E[3*M+1]=_[M][1],E[3*M+2]=_[M][2];const A=[[C.POSITION,T],[C.NORMAL,x]],R=[[C.POSITION,new He(S,3,!0)],[C.NORMAL,new He(E,3,!0)]];return new Ys(t,R,A)}function sKe(t,e,r,i,s,n,o){const a=s?H4(s):Jr(1,0,0),l=n?H4(n):Jr(0,0,0);o??(o=!0);const c=os();ye(c,a);const h=os();ie(h,c,Math.abs(e));const p=os();ie(p,h,-.5),ue(p,p,l);const f=Jr(0,1,0);Math.abs(1-fe(c,f))<.2&&se(f,0,0,1);const m=os();ht(m,c,f),ye(m,m),ht(f,m,c);const y=2*i+(o?2:0),_=i+(o?2:0),v=Ki(3*y),b=Ki(3*_),T=Ki(2*y),x=new Array(3*i*(o?4:2)),S=new Array(3*i*(o?4:2));o&&(v[3*(y-2)]=p[0],v[3*(y-2)+1]=p[1],v[3*(y-2)+2]=p[2],T[2*(y-2)]=0,T[2*(y-2)+1]=0,v[3*(y-1)]=v[3*(y-2)]+h[0],v[3*(y-1)+1]=v[3*(y-2)+1]+h[1],v[3*(y-1)+2]=v[3*(y-2)+2]+h[2],T[2*(y-1)]=1,T[2*(y-1)+1]=1,b[3*(_-2)]=-c[0],b[3*(_-2)+1]=-c[1],b[3*(_-2)+2]=-c[2],b[3*(_-1)]=c[0],b[3*(_-1)+1]=c[1],b[3*(_-1)+2]=c[2]);const E=($,N,H)=>{x[$]=N,S[$]=H};let A=0;const R=os(),M=os();for(let $=0;$<i;$++){const N=$*(2*Math.PI/i);ie(R,f,Math.sin(N)),ie(M,m,Math.cos(N)),ue(R,R,M),b[3*$]=R[0],b[3*$+1]=R[1],b[3*$+2]=R[2],ie(R,R,r),ue(R,R,p),v[3*$]=R[0],v[3*$+1]=R[1],v[3*$+2]=R[2],T[2*$]=$/i,T[2*$+1]=0,v[3*($+i)]=v[3*$]+h[0],v[3*($+i)+1]=v[3*$+1]+h[1],v[3*($+i)+2]=v[3*$+2]+h[2],T[2*($+i)]=$/i,T[2*$+1]=1;const H=($+1)%i;E(A++,$,$),E(A++,$+i,$),E(A++,H,H),E(A++,H,H),E(A++,$+i,$),E(A++,H+i,H)}if(o){for(let $=0;$<i;$++){const N=($+1)%i;E(A++,y-2,_-2),E(A++,$,_-2),E(A++,N,_-2)}for(let $=0;$<i;$++){const N=($+1)%i;E(A++,$+i,_-1),E(A++,y-1,_-1),E(A++,N+i,_-1)}}const D=[[C.POSITION,x],[C.NORMAL,S],[C.UV0,x]],k=[[C.POSITION,new He(v,3,!0)],[C.NORMAL,new He(b,3,!0)],[C.UV0,new He(T,2,!0)]];return new Ys(t,k,D)}function y5t(t,e,r,i,s,n,o=Jr(0,0,0)){const a=e.length,l=Ki(r.length*a*3+(6*i.length||0)),c=Ki(r.length*a*3+(i?6:0)),h=new Array,p=new Array;let f=0,m=0;const y=os(),_=os(),v=os(),b=os(),T=os(),x=os(),S=os(),E=O(),A=os(),R=os(),M=os(),D=os(),k=os(),$=Nr();se(A,0,1,0),de(_,r[1],r[0]),ye(_,_),n?(ue(E,r[0],o),ye(v,E)):se(v,0,0,1),hF(_,v,A,A,T,v,mne),re(b,v),re(D,T);for(let F=0;F<i.length;F++)ie(x,T,i[F][0]),ie(E,v,i[F][2]),ue(x,x,E),ue(x,x,r[0]),l[f++]=x[0],l[f++]=x[1],l[f++]=x[2];c[m++]=-_[0],c[m++]=-_[1],c[m++]=-_[2];for(let F=0;F<s.length;F++)h.push(s[F][0]>0?s[F][0]:-s[F][0]-1+i.length),h.push(s[F][1]>0?s[F][1]:-s[F][1]-1+i.length),h.push(s[F][2]>0?s[F][2]:-s[F][2]-1+i.length),p.push(0),p.push(0),p.push(0);let N=i.length;const H=i.length-1;for(let F=0;F<r.length;F++){let j=!1;F>0&&(re(y,_),F<r.length-1?(de(_,r[F+1],r[F]),ye(_,_)):j=!0,ue(R,y,_),ye(R,R),ue(M,r[F-1],b),qM(r[F],R,$),px($,Ou(M,y),E)?(de(E,E,r[F]),ye(v,E),ht(T,R,v),ye(T,T)):hF(R,b,D,A,T,v,mne),re(b,v),re(D,T)),n&&(ue(E,r[F],o),ye(k,E));for(let W=0;W<a;W++)if(ie(x,T,e[W][0]),ie(E,v,e[W][1]),ue(x,x,E),ye(S,x),c[m++]=S[0],c[m++]=S[1],c[m++]=S[2],ue(x,x,r[F]),l[f++]=x[0],l[f++]=x[1],l[f++]=x[2],!j){const Y=(W+1)%a;h.push(N+W),h.push(N+a+W),h.push(N+Y),h.push(N+Y),h.push(N+a+W),h.push(N+a+Y);for(let te=0;te<6;te++){const me=h.length-6;p.push(h[me+te]-H)}}N+=a}const Z=r[r.length-1];for(let F=0;F<i.length;F++)ie(x,T,i[F][0]),ie(E,v,i[F][1]),ue(x,x,E),ue(x,x,Z),l[f++]=x[0],l[f++]=x[1],l[f++]=x[2];const G=m/3;c[m++]=_[0],c[m++]=_[1],c[m++]=_[2];const J=N-a;for(let F=0;F<s.length;F++)h.push(s[F][0]>=0?N+s[F][0]:-s[F][0]-1+J),h.push(s[F][2]>=0?N+s[F][2]:-s[F][2]-1+J),h.push(s[F][1]>=0?N+s[F][1]:-s[F][1]-1+J),p.push(G),p.push(G),p.push(G);const I=[[C.POSITION,h],[C.NORMAL,p]],z=[[C.POSITION,new He(l,3,!0)],[C.NORMAL,new He(c,3,!0)]];return new Ys(t,z,I)}function _5t(t,e,r,i){nt(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),nt(e[0].length===3,"createPolylineGeometry(): malformed vertex"),nt(r==null||r.length===e.length,"createPolylineGeometry: need same number of points and normals"),nt(r==null||r[0].length===3,"createPolylineGeometry(): malformed normal");const s=Ho(3*e.length),n=new Array(2*(e.length-1));let o=0,a=0;for(let h=0;h<e.length;h++){for(let p=0;p<3;p++)s[o++]=e[h][p];h>0&&(n[a++]=h-1,n[a++]=h)}const l=[],c=[];if(l.push([C.POSITION,n]),c.push([C.POSITION,new He(s,3,!0)]),r){const h=Ki(3*r.length);let p=0;for(let f=0;f<e.length;f++)for(let m=0;m<3;m++)h[p++]=r[f][m];l.push([C.NORMAL,n]),c.push([C.NORMAL,new He(h,3,!0)])}return i&&(c.push([C.COLOR,new He(i,4)]),l.push([C.COLOR,yE(i.length/4)])),new Ys(t,c,l,null,ls.Line)}function nKe(t,e=t){const r=t.vertexAttributes,i=r.get(C.POSITION).data,s=r.get(C.NORMAL).data;if(s){const n=e.getMutableAttribute(C.NORMAL).data;for(let o=0;o<s.length;o+=3){const a=s[o+1];n[o+1]=-s[o+2],n[o+2]=a}}if(i){const n=e.getMutableAttribute(C.POSITION).data;for(let o=0;o<i.length;o+=3){const a=i[o+1];n[o+1]=-i[o+2],n[o+2]=a}}}function z9(t,e,r,i,s){return!(Math.abs(fe(e,t))>s)&&(ht(r,t,e),ye(r,r),ht(i,r,t),ye(i,i),!0)}function hF(t,e,r,i,s,n,o){return z9(t,e,s,n,o)||z9(t,r,s,n,o)||z9(t,i,s,n,o)}const mne=.99619469809;let oKe=class{constructor(e,r){this.type=ia.Local,this._configuration=new bJ,this._passParameters=new wJ,this._configuration.geometry=pm.Cylinder,this._technique=r.techniqueRepository.acquire(aF,this._configuration);const i=r.renderContext.rctx;this._vao=this._createVertexArrayObject(i),this._vaoCount=zo(this._vao,"geometry");const s=new xr;s.wrapMode=Dt.CLAMP_TO_EDGE,s.flipped=!0,s.width=1,s.height=512,this._passParameters.texture=new Ot(i,s,CQe)}destroy(){this._passParameters.texture=Ve(this._passParameters.texture),this._vao.dispose(),this._technique.release()}render(e){const r=e.rctx,i=r.bindTechnique(this._technique,this._passParameters,e.bindParameters);aKe(gne,e.bindParameters.camera.viewMatrix),i.setUniformMatrix4fv("view",gne),r.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(At.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(e){const r=lSe(1,2,!1),i=r.indices[0][1],s=r.vertexAttributes[0][1];for(let l=0;l<i.length;l+=3){const c=i[l];i[l]=i[l+2],i[l+2]=c}const n=s.data,o=yne.createBuffer(i.length),a=o.position;for(let l=0;l<i.length;++l){const c=3*i[l];a.set(l,0,n[c]),a.set(l,1,n[c+1]),a.set(l,2,n[c+2])}return new Rp(e,Tr,{geometry:Fc(yne)},{geometry:Ur.createVertex(e,Cr.STATIC_DRAW,o.buffer)})}};function aKe(t,e){Us(t,e),t[12]=0,t[13]=0,t[14]=0,t[15]=1}const gne=be(),yne=Hi().vec3f(C.POSITION),lKe=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]),kI=128,_ne=-oH,vne=0,V9=50,cKe=()=>1-511/512,uKe=jD([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);let hKe=class{constructor(e,r){this.view=e,this.type=ia.Mars,this._passParameters=new wJ,this._vaoCount=0,this._texV1=1;const i=zr(e.spatialReference);this._planetRadius=i.radius,this._outerRimWidth=i.outerAtmosphereRimWidth,this._innerRimFactor=(this._planetRadius+_ne)/this._planetRadius,this._middleRimFactor=(this._planetRadius+vne)/this._planetRadius,this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius,this._texV0=vne/this._outerRimWidth,this._texVScale=this._texV1-this._texV0,this._techniqueRepository=r.techniqueRepository;const s=r.renderContext.rctx;this._cameraChangeHandle=ae(()=>this.view.state?.camera,()=>r.requestRender(),Is),this._vao=this._createRibbon(s),this._vaoCount=zo(this._vao,"geometry"),this._fadeVao=kl(s),this._fadeVaoCount=zo(this._fadeVao,"geometry");const n=new xr;n.wrapMode=Dt.CLAMP_TO_EDGE,n.flipped=!0,n.width=1,n.height=512,this._passParameters.texture=new Ot(s,n,lKe);const o=new bJ;o.geometry=pm.Cone,this._coneTechnique=this._techniqueRepository.acquire(aF,o),o.geometry=pm.Underground,this._undergroundTechnique=this._techniqueRepository.acquire(aF,o)}destroy(){this._coneTechnique.release(),this._undergroundTechnique.release(),this._cameraChangeHandle.remove(),this._passParameters.texture=Ve(this._passParameters.texture),this._fadeVao.dispose(),this._vao.dispose()}render(e){const r=e.bindParameters.camera;this._update(r);const i=e.rctx;this._passParameters.undergroundFadeAlpha<1&&(i.bindTechnique(this._coneTechnique,this._passParameters,e.bindParameters),i.bindVAO(this._vao),i.drawArrays(At.TRIANGLES,0,this._vaoCount)),this._passParameters.undergroundFadeAlpha>0&&(i.bindTechnique(this._undergroundTechnique,this._passParameters,e.bindParameters),i.bindVAO(this._fadeVao),i.drawArrays(At.TRIANGLE_STRIP,0,this._fadeVaoCount))}renderHaze(){}_update(e){const r=O(),i=this._planetRadius,s=Oe(e.eye),n=s-i;if(n<0){const m=Math.min(-n/5e3,1);this._passParameters.undergroundFadeAlpha=m}else this._passParameters.undergroundFadeAlpha=0;const o=Math.max(V9,n),a=i+_ne;this._passParameters.innerScale=dKe(i+o,i,a)-1,this._passParameters.altitudeFade=lJ(n),ie(r,e.eye,(i+V9)/s),bne(r,e.center,e.up,i,this._passParameters.silhouette);const l=this._computeScreenRimWidth(e,r,e.up,this._passParameters.silhouette),c=cKe(),h=uKe(n);let p=this._texV0+c*this._texVScale,f=this._texV0+l*h*this._texVScale;if(n>V9){bne(e.eye,e.center,e.up,i,this._passParameters.silhouette);const m=this._computeScreenRimWidth(e,e.eye,e.up,this._passParameters.silhouette),y=ve((m-1.5)/(l-1.5),0,1);p=this._texV0+y*c*this._texVScale,f=this._texV0+St(this._texV1,l*h,y)*this._texVScale}ar(this._passParameters.texV,p,f)}_createRibbon(e){const r=Ki(3+3*kI*3),i=new Uint32Array(3*kI*5);r[0]=0,r[1]=0,r[2]=-1;for(let o=0;o<kI;o++){const a=9*o+3;r[a]=o,r[a+1]=this._innerRimFactor,r[a+2]=-1,r[a+3]=o,r[a+4]=this._middleRimFactor,r[a+5]=0,r[a+6]=o,r[a+7]=this._outerRimFactor,r[a+8]=1;const l=3*o+1,c=o===kI-1?1:l+3,h=15*o;i[h]=l,i[h+1]=l+1,i[h+2]=c+1,i[h+3]=c+1,i[h+4]=c,i[h+5]=l,i[h+6]=l+1,i[h+7]=l+2,i[h+8]=c+2,i[h+9]=c+2,i[h+10]=c+1,i[h+11]=l+1,i[h+12]=l,i[h+13]=c,i[h+14]=0}const s=wne.createBuffer(i.length),n=s.position;for(let o=0;o<i.length;++o){const a=3*i[o];n.set(o,0,r[a]),n.set(o,1,r[a+1]),n.set(o,2,r[a+2])}return new Rp(e,Tr,{geometry:Fc(wne)},{geometry:Ur.createVertex(e,Cr.STATIC_DRAW,s.buffer)})}_computeScreenRimWidth(e,r,i,s){return ue(qx,s.center,s.v2),ie(zI,qx,this._outerRimFactor),E6(B9,r,qx,i),Bse(qx,B9,e.projectionMatrix,e.viewport,qx),Bse(zI,B9,e.projectionMatrix,e.viewport,zI),fi(qx,zI)/e.height}};function bne(t,e,r,i,s){const n=Oe(t),o=i*Math.sqrt(n*n-i*i)/n,a=Math.sqrt(i*i-o*o),l=s.v1,c=s.v2;return ie(s.center,t,a/n),ht(l,t,e),la(l)<1&&ht(l,t,r),ie(l,l,o/Oe(l)),ht(c,l,t),ie(c,c,o/Oe(c)),o}const B9=be(),qx=O(),zI=O();function dKe(t,e,r){return t*t/(Math.sqrt(t*t-e*e)*Math.sqrt(t*t-r*r)+e*r)}const wne=Hi().vec3f(C.POSITION);var gy;(function(t){t[t.Rain=0]="Rain",t[t.Snow=1]="Snow",t[t.COUNT=2]="COUNT"})(gy||(gy={}));let rq=class extends va{constructor(){super(...arguments),this.type=gy.Rain}};u([B({count:gy.COUNT})],rq.prototype,"type",void 0);function pKe(t){const e=new Sr;return e.attributes.add(C.POSITION,"vec3"),e.attributes.add(C.INSTANCEFEATUREATTRIBUTE,"float"),e.vertex.uniforms.add(new zt("cameraPosition",(r,i)=>i.camera.eye)),e.vertex.uniforms.add(new zt("offset",(r,i)=>fKe(r,i))),e.vertex.uniforms.add(new Pe("width",r=>r.width)),e.vertex.uniforms.add(new Fi("proj",(r,i)=>i.camera.projectionMatrix)),e.vertex.uniforms.add(new Fi("view",(r,i)=>i.camera.viewMatrix)),e.vertex.uniforms.add(new Pe("time",r=>r.time)),e.varyings.add("vUv","vec2"),e.vertex.code.add(w`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${t.type===gy.Rain?w`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:w`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),e.fragment.uniforms.add(new Pe("opacity",r=>r.opacity),new zt("particleColor",(r,i)=>mKe(i,t))),e.fragment.code.add(w`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${t.type===gy.Rain?w`d = 0.35 * smoothstep(0.5, 0.0, d);`:w`d = smoothstep(0.5, 0.1, d);`}
      fragColor = opacity * vec4(particleColor * d, d);
    }
  `),e}function fKe(t,e){const r=e.camera.eye,i=.5*t.width,s=1/t.width,n=fge(iq,se(iq,(r[0]+i)*s,(r[1]+i)*s,(r[2]+i)*s));return On(n,r,ie(n,n,t.width))}function mKe(t,e){const r=e.type===gy.Rain?yKe:gKe,i=ie(iq,r,_Ke),s=t.camera.eye;ye(xne,s);const n=Math.max(0,fe(xne,t.lighting.mainLight.direction));return Hr(i,i,r,n)}const iq=O(),xne=O(),gKe=Me(1,1,1),yKe=Me(.85,.85,.85),_Ke=.7,vKe=Object.freeze(Object.defineProperty({__proto__:null,build:pKe},Symbol.toStringTag,{value:"Module"}));let bKe=class extends ri{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=1}},sq=class cSe extends Lr{initializeProgram(e){return new Rr(e.rctx,cSe.shader.get().build(this.configuration),aN)}initializePipeline(){return Mt({blending:Eo(xe.ONE,xe.ONE,xe.ONE_MINUS_SRC_ALPHA,xe.ONE_MINUS_SRC_ALPHA),depthTest:{func:ti.LEQUAL},colorWrite:Gt})}};sq.shader=new Or(vKe,()=>ce(()=>import("./Precipitation.glsl-3959d10a.js"),[],import.meta.url));const aN=new Map([[C.POSITION,0],[C.INSTANCEFEATUREATTRIBUTE,1]]);let uSe=class{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance({deltaTime:e,fixedTime:r}){return r!=null?this._time!==r&&(this._time=r,!0):(this._time=this._time+e,e!==0)}},wKe=class{constructor(e,r){this.deltaTime=e,this.fixedTime=r}},lb=class extends we{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._passParameters=new bKe,this._animation=new uSe,this._updatingTracking=new Xf,this._passParameters.time=0,this._passParameters.radius=zr(e.view.spatialReference).radius,this._techniqueRepository=e.context.techniqueRepository}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechniqueCached=Bi(this._snowTechniqueCached),this._rainTechniqueCached=Bi(this._rainTechniqueCached),this._vao=Ve(this._vao),this._instanceIdBuffer=Ve(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get _rainTechnique(){if(this._rainTechniqueCached==null){const e=new rq;e.type=gy.Rain,this._rainTechniqueCached=this._techniqueRepository.acquire(sq,e)}return this._rainTechniqueCached}get _snowTechnique(){if(this._snowTechniqueCached==null){const e=new rq;e.type=gy.Snow,this._snowTechniqueCached=this._techniqueRepository.acquire(sq,e)}return this._snowTechniqueCached}update(e){return this._animation.advance(e)}render(e,r,i){const s=i==="rainy"?this._rainTechnique:this._snowTechnique;if(!s.compiled)return void this.context.requestRender();const n=e.rctx;if(this._ensureResources(n),s==null||this._vao==null||this._instanceIdBuffer==null||(e.bindParameters.cloudsFade.data!=null&&(this._passParameters.opacity=1-e.bindParameters.cloudsFade.fadeInOutHeight.factor),this._passParameters.opacity<=0))return;const o=.35;r=r<.5?St(0,o,2*r):St(o,1,2*(r-.5)),this._passParameters.time=(i==="rainy"?this._rainSpeed:this._snowSpeed)*uX(this._animation.time)%1e5;const a=n.bindTechnique(s,this._passParameters,e.bindParameters);n.bindVAO(this._vao),a.assertCompatibleVertexAttributeLocations(this._vao),hJ(n,aN,this._instanceIdBuffer,Tne,0),n.capabilities.instancing?.drawArraysInstanced(At.TRIANGLES,0,3,this._numParticles*r),dJ(n,aN,this._instanceIdBuffer,Tne)}_ensureResources(e){this._vao==null&&(this._vao=this._createVertexArrayObject(e)),this._instanceIdBuffer==null&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const r=[];for(let i=0;i<this._numParticles;i++)r.push(i);return Ur.createVertex(e,Cr.STATIC_DRAW,new Float32Array(r))}_createVertexArrayObject(e){const r=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new Rp(e,aN,{geometry:Fc(xKe)},{geometry:Ur.createVertex(e,Cr.STATIC_DRAW,r)})}};u([d({constructOnly:!0})],lb.prototype,"context",void 0),u([d({constructOnly:!0})],lb.prototype,"view",void 0),u([d({readOnly:!0})],lb.prototype,"updating",null),u([d()],lb.prototype,"_updatingTracking",void 0),lb=u([P("esri.views.3d.environment.Precipitation")],lb);const xKe=Hi().vec3f(C.POSITION),Tne=Fc(Hi().f32(C.INSTANCEFEATUREATTRIBUTE),1);function TKe(){const t=new Sr;return t.attributes.add(C.POSITION,"vec3"),t.attributes.add(C.COLOR,"vec4"),t.attributes.add(C.SIZE,"float"),t.varyings.add("vcolor","vec4"),t.varyings.add("vsize","float"),t.vertex.uniforms.add(new Fi("transform",(e,r)=>SKe(e,r)),new nr("viewport",(e,r)=>r.camera.fullViewport),new Pe("pixelRatio",(e,r)=>r.camera.pixelRatio)),t.vertex.code.add(w`void main(void) {
gl_Position = transform * vec4(position, 0);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),t.fragment.code.add(w`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
fragColor = vec4(vcolor.xyz, intensity);
}`),t}function SKe(t,e){return Us(t0,e.camera.projectionMatrix),t0[10]=24e-8-1,t0[11]=-1,t0[14]=(24e-8-2)*e.camera.near,oi(t0,t0,e.camera.viewMatrix),oi(t0,t0,t.modelMatrix)}const t0=be(),EKe=Object.freeze(Object.defineProperty({__proto__:null,build:TKe},Symbol.toStringTag,{value:"Module"}));let CKe=class extends ri{constructor(){super(...arguments),this.modelMatrix=be()}},hSe=class dSe extends Lr{constructor(e){super(e,new va,()=>this.destroy())}initializeProgram(e){return new Rr(e.rctx,dSe.shader.get().build(),Tr)}initializePipeline(){return Mt({blending:Eo(xe.SRC_ALPHA,xe.ONE,xe.ONE_MINUS_SRC_ALPHA,xe.ONE_MINUS_SRC_ALPHA),depthTest:{func:ti.LEQUAL},colorWrite:Gt})}};hSe.shader=new Or(EKe,()=>ce(()=>import("./Stars.glsl-409a0896.js"),[],import.meta.url));let J0=class extends we{get updating(){return this._updatingTracking.updating||this.loading}get loading(){return this._loadDataTask!=null&&!this._loadDataTask.finished}constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._renderParameter=new CKe,this._updatingTracking=new Xf}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=Ll(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=Bi(this._technique),this._vao=Ve(this._vao),Gv=null}render(e){const{rctx:r}=e;if(this._ensureResources(r),this._technique==null||this._vao==null)return;if(!this._technique.compiled)return void this.requestRender();const i=r.bindTechnique(this._technique,this._renderParameter,e.bindParameters);r.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(At.POINTS,0,this._numPoints)}_ensureResources(e){if(this._technique!=null||Gv==null)return;this._technique=new hSe({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=Gv.byteLength/Sne;const r=new Float32Array(Gv,0,2*this._numPoints),i=new Uint8Array(Gv,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(e,r,i,this._numPoints),this._updatingTracking.add(()=>this.view.environment.lighting.type!=="virtual"?this.view.environment.lighting.date:null,s=>this._update(s),Pr)}_computeDayDuration(e){const r=e,i=new Date(e.getFullYear(),0,1,11,58,56);return(+r-+i)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+i)}_update(e){if(!e)return;const r=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,i=2*this._computeDayDuration(e),s=Us(this._renderParameter.modelMatrix,RKe);tE(s,s,-i*Math.PI),oi(s,OKe,s),tE(s,s,-r*Math.PI),this.requestRender()}_hexToRGB(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}_unpackUint8Attributes(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}_createVertexArrayObject(e,r,i,s){const n=Ene.createBuffer(s),o=n.position,a=n.color,l=n.size;for(let c=0;c<s;c++){const h=r[2*c],p=r[2*c+1];o.set(c,0,-Math.cos(h)*Math.sin(p)),o.set(c,1,-Math.sin(h)*Math.sin(p)),o.set(c,2,-Math.cos(p));const f=this._unpackUint8Attributes(i[c]),m=this._hexToRGB(AKe[f[1]]);a.set(c,0,255*m[0]),a.set(c,1,255*m[1]),a.set(c,2,255*m[2]),a.set(c,3,255),l.set(c,f[0])}return new Rp(e,Tr,{geometry:Fc(Ene)},{geometry:Ur.createVertex(e,Cr.STATIC_DRAW,n.buffer)})}_createLoadDataTask(){if(Gv!=null)return null;const e=jE(async r=>{const{data:i}=await WNe("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:r});this._verifyStarData(i),Gv=i});return e.promise.catch(r=>{us(r)||Q.getLogger(this).error(r)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}_verifyStarData(e){if(!e)throw new V("stars:no-data-received","Failed to create stars because star catalogue is missing");const r=e.byteLength/Sne;if(r%1!=0||r>5e4||r<5e3)throw new V("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};u([d({constructOnly:!0})],J0.prototype,"view",void 0),u([d({constructOnly:!0})],J0.prototype,"requestRender",void 0),u([d({readOnly:!0})],J0.prototype,"updating",null),u([d()],J0.prototype,"_loadDataTask",void 0),u([d()],J0.prototype,"_updatingTracking",void 0),J0=u([P("esri.views.3d.environment.Stars")],J0);const AKe=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],OKe=$Y(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),RKe=$Y(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),Sne=9,Ene=Hi().vec3f(C.POSITION).vec4u8(C.COLOR).f32(C.SIZE);let Gv=null;function $y(t=PKe){return[t[0],t[1],t[2],t[3]]}function G9(t,e,r=$y()){return re(r,t),r[3]=e,r}function Cne(t,e,r=$y()){return ht(r,t,e),ye(r,r),r[3]=-gge(t,e),r}function Ane(t,e,r=$y()){return G4(VI,t,One(t)),G4(Rne,e,One(e)),U6(VI,Rne,VI),MKe(r,rl(LY(r,VI)))}function O5t(t,e,r,i=$y()){return G9(dge,t,BI),G9(pge,e,Mne),G9(XX,r,Pne),Ane(BI,Mne,BI),Ane(BI,Pne,i),i}function R5t(t){return t}function M5t(t){return t[3]}function One(t){return Ft(t[3])}function MKe(t,e){return t[3]=e,t}const PKe=[0,0,1,0],VI=Xh(),Rne=Xh();$y();const BI=$y(),Mne=$y(),Pne=$y();function IKe(t,e,r){const i=t.parallax.anchorPointClouds;t.fadeIn.stage===pc.FINISHED&&(t.fadeIn.factor=0,re(i,Lf),t.fadeIn.stage=pc.CHANGE_ANCHOR,t.crossFade.enabled=!1,t.fadeInOut.stage=wn.FINISHED),t.fadeIn.stage===pc.CHANGE_ANCHOR&&t.isCameraPositionFinal&&(_J(t.data)&&t.renderingStage!==$s.RENDERING||t.renderingStage===$s.FADING_TEXTURE_CHANNELS)&&(re(i,Lf),t.fadeIn.stage=pc.FADE_IN,t.startTime=e,t.renderingStage===$s.FADING_TEXTURE_CHANNELS&&(t.renderingStage=$s.SWITCH_CHANNELS)),t.fadeIn.factor<1&&t.fadeIn.stage===pc.FADE_IN?t.fadeIn.factor=r?ve((e-t.startTime)/(pSe*r),0,1):1:t.fadeIn.factor>=1&&t.fadeIn.stage===pc.FADE_IN&&(t.fadeIn.stage=pc.FINISHED,t.fadeIn.factor=1)}function $Ke(t,e,r){const{fadeInOut:i,crossFade:s}=t;i.stage===wn.FINISHED&&(t.startTime=e,i.factor=1,i.stage=wn.FADE_OUT),i.factor>0&&i.stage===wn.FADE_OUT?i.factor=r?1-ve((e-t.startTime)/(UKe*r),0,1):0:(i.factor<=0&&i.stage===wn.FADE_OUT&&(i.factor=0,re(t.parallax.anchorPointClouds,Lf)),i.factor<=0&&i.stage===wn.FADE_OUT&&t.isCameraPositionFinal&&(i.factor=0,i.stage=wn.SWITCH,t.crossFade.enabled=!1,s.factor=1),i.stage===wn.SWITCH&&(_J(t.data)&&t.renderingStage!==$s.RENDERING||t.renderingStage===$s.FADING_TEXTURE_CHANNELS)&&(t.startTime=e,i.factor=0,i.stage=wn.FADE_IN,re(t.parallax.anchorPointClouds,Lf),t.crossFade.enabled=!1,s.factor=1,t.renderingStage===$s.FADING_TEXTURE_CHANNELS&&(t.renderingStage=$s.SWITCH_CHANNELS)),i.factor<1&&i.stage===wn.FADE_IN?i.factor=r?ve((e-t.startTime)/(pSe*r),0,1):1:i.factor>=1&&i.stage===wn.FADE_IN&&(i.stage=wn.FINISHED,i.factor=1))}function LKe(t,e,r,i){const{crossFade:s}=t,n=t.parallax.anchorPointClouds;t.crossFade.enabled&&!i||(re(t.parallaxNew.anchorPointClouds,Lf),t.startTime=e,s.factor=0,t.crossFade.enabled=!0),s.factor<1&&t.crossFade.enabled?s.factor=r?ve((e-t.startTime)/(kKe*r),0,1):1:s.factor>=1&&t.crossFade.enabled&&(t.crossFade.enabled=!1,s.factor=1,re(n,t.parallaxNew.anchorPointClouds),t.renderingStage===$s.FADING_TEXTURE_CHANNELS&&(t.renderingStage=$s.SWITCH_CHANNELS))}function Ine(t,e,r,i){const s=t.fadeInOutHeight,n=s.stage===ov.FINISHED?r:t.startTimeHeightFade;if(i!==0){const o=(r-n)/(zKe*i);s.factor+=e?-o:o}else s.factor=e?0:1;t.startTimeHeightFade=r,s.factor=ve(s.factor,0,1),s.stage=ov.HEIGHT_FADE}function DKe(t,e,r,i,s){t.renderingStage===$s.FINISHED_RENDERING&&(t.renderingStage=$s.FADING_TEXTURE_CHANNELS);const n=Oe(e.eye);t.fadeInOutHeight.factor<0&&(t.fadeInOutHeight.factor=n-or.radius>Of?1:0),t.isCameraPositionFinal=X_(t.cameraPositionLastFrame,e.eye),ye(Lf,e.eye),ie(Lf,Lf,or.radius);const o=t.parallax;o.anchorPointClouds[0]===0&&o.anchorPointClouds[1]===0&&o.anchorPointClouds[2]===0&&re(o.anchorPointClouds,Lf);const a=Oe(de(FKe,o.anchorPointClouds,Lf));let l=!0;a>t.fadeIn.distanceThresholdFactor*o.cloudsHeight||t.fadeIn.stage!==pc.FINISHED?IKe(t,i,s):a>t.fadeInOut.distanceThresholdFactor*o.cloudsHeight||t.fadeInOut.stage!==wn.FINISHED?$Ke(t,i,s):a>t.crossFade.distanceThresholdFactor*o.cloudsHeight||t.crossFade.enabled||t.renderingStage===$s.FADING_TEXTURE_CHANNELS?LKe(t,i,s,(r!==Fr.IDLE||!_J(t.data))&&t.renderingStage!==$s.FADING_TEXTURE_CHANNELS):l=!1;const c=n-or.radius;if((c>1.7*Of||c<-Of)&&t.fadeInOutHeight.factor<1?t.fadeInOutHeight.factor=1:(c>Of||c<-.35*Of)&&t.fadeInOutHeight.factor<1?Ine(t,!1,i,s):c<Of&&c>-.35*Of&&t.fadeInOutHeight.factor>0?Ine(t,!0,i,s):t.fadeInOutHeight.stage=ov.FINISHED,t.renderingStage===$s.SWITCH_CHANNELS&&(t.readChannels=1-t.readChannels,t.renderingStage=$s.FINISHED),o.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(n*n-or.radius*or.radius,0))/n,Cne($ne,o.anchorPointClouds,Wx),xc(o.transform,un,Wx[3],Wx),l){const{parallaxNew:h}=t;Cne($ne,h.anchorPointClouds,Wx),xc(h.transform,un,Wx[3],Wx)}re(t.cameraPositionLastFrame,e.eye)}function NKe(t){return t.crossFade.enabled||t.fadeInOut.stage!==wn.FINISHED||t.fadeIn.stage!==pc.FINISHED||t.fadeInOutHeight.stage!==ov.FINISHED||t.renderingStage!==$s.FINISHED}const $ne=Me(0,0,1),Wx=$y(),Lf=O(),FKe=O(),pSe=1,UKe=.5,kKe=1.3,zKe=1;let hC=class{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(e,r){return this._outer.get(e)?.get(r)}set(e,r,i){const s=this._outer.get(e);s?s.set(r,i):this._outer.set(e,new Map([[r,i]]))}delete(e,r){const i=this._outer.get(e);i&&(i.delete(r),i.size===0&&this._outer.delete(e))}forEach(e){this._outer.forEach((r,i)=>e(r,i))}};var Xs;function Lne(t=!oe("disable-feature:high-quality-idle"),e=null){const r=new hC;return t?(r.set(Fr.IDLE,Xs.Antialiasing,e!=="low"),r.set(Fr.IDLE,Xs.HighResolutionAtmosphere,e!=="low"),r.set(Fr.IDLE,Xs.HighQualityTransparency,!0),r.set(Fr.IDLE,Xs.SSAO,!0),r.set(Fr.IDLE,Xs.WaterReflection,!0),r.set(Fr.IDLE,Xs.PhysicalPixelRendering,!oe("esri-mobile"))):(r.set(Fr.ANIMATING,Xs.HighResolutionShadows,!0),r.set(Fr.INTERACTING,Xs.HighResolutionShadows,!0)),r.set(Fr.IDLE,Xs.HighResolutionShadows,!0),r.set(Fr.IDLE,Xs.HighResolutionVoxel,!0),r}(function(t){t[t.Antialiasing=0]="Antialiasing",t[t.HighQualityTransparency=1]="HighQualityTransparency",t[t.HighResolutionVoxel=2]="HighResolutionVoxel",t[t.HighResolutionAtmosphere=3]="HighResolutionAtmosphere",t[t.SSAO=4]="SSAO",t[t.WaterReflection=5]="WaterReflection",t[t.HighResolutionShadows=6]="HighResolutionShadows",t[t.PhysicalPixelRendering=7]="PhysicalPixelRendering"})(Xs||(Xs={}));var S2;(function(t){t[t.Immediate=0]="Immediate",t[t.Faded=1]="Faded"})(S2||(S2={}));var G3;const VKe=[he.POSTPROCESSING_ENVIRONMENT_OPAQUE,he.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];let Po=G3=class extends we{constructor(t){super(t),this._context=null,this._atmosphere=null,this._oldWeatherParameters=new j9,this._newWeatherParameters=new j9,this._fadedWeatherParameters=new j9,this._weatherParameters=this._newWeatherParameters}initialize(){this.view._stage.addRenderPlugin(VKe,this)}destroy(){this.removeHandles(),this.uninitializeRenderContext(),this.view?._stage!=null&&this.view._stage.removeRenderPlugin(this),this._set("view",null)}get atmosphere(){return this._atmosphere}get _atmosphereType(){return this.atmosphere!=null?this.atmosphere.type:ia.None}get canRender(){return!(this._atmosphere===null&&this._stars===null)}get needsLinearDepth(){return this._atmosphereType===ia.Realistic}updateAnimation(t){return this._precipitation!=null&&this._precipitation.update(t)}get updating(){return this._stars!=null&&this._stars.updating||this._clouds!=null&&this._clouds.running}get weatherVisible(){return Oe(this.view.state.camera.eye)-zr(this.view.spatialReference).radius<=Of}get _stars(){const t=this.view,e=t.environment?.starsEnabled??!1,r=this._get("_stars");return e&&this._context!=null?r??new J0({view:t,requestRender:()=>this._setNeedsRender()}):($e(r),null)}get _precipitation(){const t=this._get("_precipitation");if(!this._precipitationEnabled||this._context==null)return $e(t),null;const e=this.view,r=this._context;return t!=null&&t.context===r?t:($e(t),new lb({context:r,view:e}))}get _clouds(){const t=this._get("_clouds");if(!this.weatherEnabled||this._context==null)return $e(t),null;if(t!=null)return t;const e=this.view,r=this._context;return $e(t),new vl({context:r,view:e,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const t=this._get("_cloudsComposition");if(!this.weatherEnabled||this._context==null)return $e(t),null;const e=this.view.state.viewingMode,r=this._context.renderContext.rctx,i=zr(this.view.spatialReference).radius;return t!=null&&t.viewingMode===e&&t.planetRadius===i?t:($e(t),new nb({rctx:r,viewingMode:e,planetRadius:i,requestRender:()=>this._setNeedsRender()}))}get _fog(){const t=this._get("_fog");if(!this.weatherEnabled||this._context==null)return $e(t),null;if(t!=null)return t;const e=this.view,r=this._context,i=this._context.renderContext.rctx,s=this.view.state.viewingMode;return new ob({context:r,view:e,rctx:i,viewingMode:s})}get weatherEnabled(){return!!this.view?.environmentManager?.weatherEnabled}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(t=null){this._context=t;const e=()=>this._setNeedsRender();this.addHandles([ae(()=>({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),r=>this._updateAtmosphere(r),Is),ae(()=>this._stars,e),ae(()=>this._precipitation,e),ae(()=>this._clouds,()=>this._updateWeather(),Pr),ae(()=>this._fog,()=>this._updateFogHaze(),Pr),ae(()=>this.view.state.mode,()=>{this._setNeedsRender()},qr),ae(()=>this._weatherUpdateParameters,()=>{this._updateWeather(),this._updateFogHaze()},Is)])}uninitializeRenderContext(){this._context=null,this._atmosphere=$e(this._atmosphere),this._set("_stars",$e(this._stars)),this._set("_precipitation",$e(this._precipitation)),this._set("_clouds",$e(this._clouds)),this._set("_cloudsComposition",$e(this._cloudsComposition)),this._set("_fog",$e(this._fog))}prepareRender(t){t.bindParameters.cloudsFade.data=TJe(this._clouds)?this._clouds:null,this.view.viewingMode!=="local"&&t.bindParameters.cloudsFade.data?.cubeMap!=null&&(DKe(t.bindParameters.cloudsFade,t.bindParameters.camera,this.view.state.mode,t.time,this.view.qualitySettings.fadeDuration),this._updateWeatherFading(t.bindParameters),t.bindParameters.cloudsFade.renderingStage===$s.FINISHED&&this._clouds!=null&&this._clouds.coverage===0&&this._clouds.running===!1&&(this._clouds.destroyFrameBufferCube(),t.bindParameters.cloudsFade.data=null))}render(t){if(t.output===U.Color)switch(t.bindParameters.slot){case he.POSTPROCESSING_ENVIRONMENT_OPAQUE:this._stars!=null&&this._stars.render(t),this.atmosphere!=null&&(this.atmosphere.render(t,this.view?.qualitySettings.highResolutionAtmosphere||this.view?._stage?.renderer?.isFeatureEnabled(Xs.HighResolutionAtmosphere)),this._cloudsComposition!=null&&t.bindParameters.cloudsFade.data!=null&&(this.weatherVisible&&this._clouds!=null&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(t)),NKe(t.bindParameters.cloudsFade)&&this._context!=null&&t.bindParameters.cloudsFade.data?.cubeMap!=null&&this._context.requestRender());break;case he.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if(this.atmosphere!=null&&(this.atmosphere.renderHaze(t,this._weatherParameters.hazeAmount,this.view?.qualitySettings.highResolutionAtmosphere||this.view?._stage?.renderer?.isFeatureEnabled(Xs.HighResolutionAtmosphere)),this._weatherParameters.fog.amount>0&&this._fog!=null&&this._fog.render(t,this._weatherParameters.fog),this._precipitation!=null)){const e=this.view.environment.weather;e.type!=="rainy"&&e.type!=="snowy"||this._precipitation.render(t,e.precipitation,e.type)}}}updateLightSources(t,e,r,i){if(this._context!=null){const s=this._context.renderContext;s.bindParameters.oldLighting.copyFrom(s.bindParameters.lighting),s.bindParameters.newLighting.noonFactor=e,s.bindParameters.newLighting.globalFactor=r,s.bindParameters.newLighting.set(t),i===S2.Faded||s.bindParameters.weatherFading?s.bindParameters.fadeLighting(0):s.bindParameters.fadeLighting(1),this._context.requestRender()}}get _weatherUpdateParameters(){const t=this.weatherEnabled?this.view.environment.weather:null;return t==null?null:t.type==="rainy"||t.type==="snowy"?{type:t.type,weatherAdjustment:t.cloudCover,effect:t.precipitation}:{type:t.type,weatherAdjustment:t.type==="foggy"?t.fogStrength:t.cloudCover}}_updateWeatherFading(t){if(!t.weatherFading)return;const e=t.cloudsFade;return e.fadeIn.stage===pc.FADE_IN?(t.fadeLighting(e.fadeIn.factor),void this._fadeWeather(e.fadeIn.factor)):e.fadeInOut.stage===wn.FADE_IN?(t.fadeLighting(e.fadeInOut.factor),void this._fadeWeather(e.fadeInOut.factor)):e.crossFade.enabled?(t.fadeLighting(e.crossFade.factor),void this._fadeWeather(e.crossFade.factor)):(t.fadeLighting(0),void this._fadeWeather(0))}_fadeWeather(t){const{_newWeatherParameters:e,_oldWeatherParameters:r}=this;t>=1?this._weatherParameters=e:(this._fadedWeatherParameters.lerp(r,e,t),this._weatherParameters=this._fadedWeatherParameters)}_updateWeather(){const t=this._weatherUpdateParameters;t!=null&&this._clouds!=null&&(this._clouds.applyPreset(ra[t.type],t.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){this._context!=null&&this._context.requestRender()}_updateFogHaze(){const t=this._weatherUpdateParameters;if(this._fog==null||t==null||this._context==null)return;const e=this._context.renderContext.bindParameters;switch(this._oldWeatherParameters.copyFrom(this._weatherParameters),t.type){case"foggy":this._newWeatherParameters.fog.strength=St(3e-5,.005,t.weatherAdjustment**3),re(this._newWeatherParameters.fog.color,Dne),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;case"rainy":this._newWeatherParameters.fog.strength=St(4e-6,2e-4,(t.effect??0)**3),re(this._newWeatherParameters.fog.color,BKe),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=0,this._setNeedsRender();break;case"snowy":this._newWeatherParameters.fog.strength=St(4e-6,2e-4,(t.effect??0)**3),re(this._newWeatherParameters.fog.color,Dne),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender()}e.weatherFading?this._fadeWeather(0):this._fadeWeather(1)}_updateAtmosphere(t){const e=this._selectAtmosphereType(t);if(e!==ia.None&&this._context){if(!this._atmosphere||this._atmosphere.type!==e){this._atmosphere=$e(this._atmosphere);const r=this._getAtmosphereClass(e);r&&(this._atmosphere=new r(this.view,this._context))}}else this._atmosphere=$e(this._atmosphere);this._setNeedsRender()}_getAtmosphereClass(t){switch(t){case ia.Realistic:return ene;case ia.Local:return oKe;case ia.Mars:return hKe;default:case ia.None:return null}}_selectAtmosphereType(t){const{enabled:e,viewingMode:r}=t;return!e||bm(this.view.spatialReference)?ia.None:r===Ue.Local?ia.Local:this._context!=null&&ene.isSupported(this._context)&&mR(this.view.spatialReference)?ia.Realistic:vm(this.view.spatialReference)?ia.Mars:ia.None}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),stubGetAtmosphereClass:t=>{Nne=G3.prototype._getAtmosphereClass,G3.prototype._getAtmosphereClass=t},restoreGetAtmosphereClass:()=>{G3.prototype._getAtmosphereClass=Nne}}}};u([d({constructOnly:!0})],Po.prototype,"view",void 0),u([d({readOnly:!0})],Po.prototype,"atmosphere",null),u([d({readOnly:!0})],Po.prototype,"_atmosphereType",null),u([d({type:Boolean,readOnly:!0})],Po.prototype,"updating",null),u([d({readOnly:!0})],Po.prototype,"weatherVisible",null),u([d()],Po.prototype,"_context",void 0),u([d()],Po.prototype,"_atmosphere",void 0),u([d({readOnly:!0})],Po.prototype,"_stars",null),u([d({readOnly:!0})],Po.prototype,"_precipitation",null),u([d({readOnly:!0})],Po.prototype,"_clouds",null),u([d({readOnly:!0})],Po.prototype,"_cloudsComposition",null),u([d({readOnly:!0})],Po.prototype,"_fog",null),u([d({readOnly:!0})],Po.prototype,"weatherEnabled",null),u([d({readOnly:!0})],Po.prototype,"_precipitationEnabled",null),u([d({readOnly:!0})],Po.prototype,"_weatherUpdateParameters",null),Po=G3=u([P("esri.views.3d.environment.EnvironmentRenderer")],Po);let j9=class{constructor(){this.fog=new TQe,this.hazeAmount=1}copyFrom(e){this.fog.amount=e.fog.amount,this.hazeAmount=e.hazeAmount,this.fog.strength=e.fog.strength,re(this.fog.color,e.fog.color)}lerp(e,r,i){this.fog.amount=St(e.fog.amount,r.fog.amount,i),this.hazeAmount=St(e.hazeAmount,r.hazeAmount,i),this.fog.strength=St(e.fog.strength,r.fog.strength,i),Hr(this.fog.color,e.fog.color,r.fog.color,i)}};const BKe=Me(.5,.5,.5),Dne=Me(1.5,1.5,1.5);let Nne;function Fne(t,e,r){if(e.longitude==null||e.latitude==null||r.longitude==null||r.latitude==null)throw new Error("Invalid points: no lon/lat");return GKe(t,e.longitude,e.latitude,r.longitude,r.latitude)}function GKe(t,e,r,i,s){const n=Ft(r),o=Ft(s),a=n-o,l=Ft(e)-Ft(i),c=Math.sin(a/2),h=Math.sin(l/2),p=2*Fh(Math.sqrt(c*c+Math.cos(n)*Math.cos(o)*h*h))*t;return Math.round(1e4*p)/1e4}function jKe(t,e,r){const i=e.spatialReference,s=zr(i),n=new Ke(e.x,t.y,i),o=new Ke(r.x,t.y,i),a=new Ke(t.x,e.y,i),l=new Ke(t.x,r.y,i);return{lon:Fne(s.radius,n,o),lat:Fne(s.radius,a,l)}}function HKe(t,e,r){const i=e/r,s=Ft(t),n=Math.sin(i/2),o=Math.cos(s),a=2*Fh(Math.sqrt(n*n/(o*o)));return rl(a)}function qKe(t,e){let r=t/15;return e||(r=Math.round(r)),r}function Une(t,e){const r=t?.[0];if(r==null)return null;e||(e={hours:0,minutes:0,seconds:0}),e.hours=qKe(r,!0);const i=e.hours%1;e.hours-=i,e.minutes=60*i;const s=e.minutes%1;return e.minutes-=s,e.seconds=Math.round(60*s),e}var kne,zne,Vne,nq={exports:{}};nq.exports,kne=nq,zne=function(){var t=Math.PI,e=Math.sin,r=Math.cos,i=Math.tan,s=Math.asin,n=Math.atan2,o=Math.acos,a=t/180,l=864e5,c=2440588,h=2451545,p={dec:0,ra:0};function f(I){return I.valueOf()/l-.5+c}function m(I){return new Date((I+.5-c)*l)}function y(I){return f(I)-h}var _=23.4397*a;function v(I,z){return n(e(I)*r(_)-i(z)*e(_),r(I))}function b(I,z){return s(e(z)*r(_)+r(z)*e(_)*e(I))}function T(I,z,F){return n(e(I),r(I)*e(z)-i(F)*r(z))}function x(I,z,F){return s(e(z)*e(F)+r(z)*r(F)*r(I))}function S(I,z){return a*(280.16+360.9856235*I)-z}function E(I){return a*(357.5291+.98560028*I)}function A(I){return a*(1.9148*e(I)+.02*e(2*I)+3e-4*e(3*I))}function R(I,z){return I+z+102.9372*a+t}function M(I,z){var F=E(I),j=R(F,A(F));return z||(z={dec:0,ra:0}),z.dec=b(j,0),z.ra=v(j,0),z}var D={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(I,z,F,j){var W=a*-F,Y=a*z,te=y(I),me=M(te,p),Le=S(te,W)-me.ra;return j||(j={azimuth:0,altitude:0}),j.azimuth=T(Le,Y,me.dec),j.altitude=x(Le,Y,me.dec),j}},k=[[-.83,"sunrise","sunset"]];D.addTime=function(I,z,F){k.push([I,z,F])};var $=9e-4;function N(I,z){return Math.round(I-$-z/(2*t))}function H(I,z,F){return $+(I+z)/(2*t)+F}function Z(I,z,F){return h+I+.0053*e(z)-.0069*e(2*F)}function G(I,z,F){return o((e(I)-e(z)*e(F))/(r(z)*r(F)))}function J(I){var z=a*(134.963+13.064993*I),F=a*(93.272+13.22935*I),j=a*(218.316+13.176396*I)+6.289*a*e(z),W=5.128*a*e(F),Y=385001-20905*r(z);return{ra:v(j,W),dec:b(j,W),dist:Y}}return D.getTimes=function(I,z,F){var j=a*-F,W=a*z,Y=N(y(I),j),te=H(0,j,Y),me=E(te),Le=A(me),dt=R(me,Le),st=b(dt,0),Xe=Z(te,me,dt);function yt(Se){return Z(H(G(Se,W,st),j,Y),me,dt)}function ge(Se){var Re=(e(Se)-e(W)*e(st))/(r(W)*r(st));return Re<-1?D.PolarException.MIDNIGHT_SUN:Re>1?D.PolarException.POLAR_NIGHT:D.PolarException.NORMAL}var Ce,bt,_e,Be,qe,ft={solarNoon:m(Xe),nadir:m(Xe-.5),polarException:D.PolarException.NORMAL};for(Ce=0,bt=k.length;Ce<bt;Ce+=1)qe=Xe-((Be=yt((_e=k[Ce])[0]*a))-Xe),ft[_e[1]]=m(qe),ft[_e[2]]=m(Be);return ft.polarException=ge(k[0][0]*a),ft},D.getMoonPosition=function(I,z,F){var j=a*-F,W=a*z,Y=y(I),te=J(Y),me=S(Y,j)-te.ra,Le=x(me,W,te.dec);return Le+=.017*a/i(Le+10.26*a/(Le+5.1*a)),{azimuth:T(me,W,te.dec),altitude:Le,distance:te.dist}},D.getMoonFraction=function(I){var z=y(I),F=M(z),j=J(z),W=149598e3,Y=o(e(F.dec)*e(j.dec)+r(F.dec)*r(j.dec)*r(F.ra-j.ra)),te=n(W*e(Y),j.dist-W*r(Y));return(1+r(te))/2},D},(Vne=zne())!==void 0&&(kne.exports=Vne);const Fw=VM(nq.exports),Xa={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};let GI=class{constructor(e,r){this.direct=e,this.ambient=r}};function WKe(t,e,r,i,s,n){se(n.ambient.color,1,1,1),n.ambient.intensity=Xa.global.ambient,se(n.direct.color,1,1,1),n.direct.intensity=Xa.global.direct;const o=e[2],a=ve((Math.abs(o)-Xa.local.altitude)/(Xa.global.altitude-Xa.local.altitude),0,1);let l;if(n.globalFactor=a,t!=null&&(l=Fw.getTimes(t,e[1],e[0])),a<1){let c;if(t!=null)c=eet(t,l,i);else{const h=gSe(i);c={direct:{intensity:Xa.local.directAtNoon*h.direct,color:Me(1,1,1)},ambient:{intensity:Xa.local.ambientAtNoon*h.ambient,color:Me(1,1,1)},timeOfDay:"early afternoon"}}Hr(n.ambient.color,c.ambient.color,n.ambient.color,a),n.ambient.intensity=St(c.ambient.intensity,n.ambient.intensity,a),Hr(n.direct.color,c.direct.color,n.direct.color,a),n.direct.intensity=St(c.direct.intensity,n.direct.intensity,a),n.specularStrength=i==="rainy"||i==="snowy"||i==="foggy"?0:1,n.environmentStrength=i==="rainy"?.7:i==="snowy"||i==="foggy"?.75:1}n.noonFactor=t!=null?KKe(t,l):1,t!=null?XKe(t,e,r,n.direct.directionToLightSource):fSe(s,r,n.direct.directionToLightSource)}function fSe(t,e,r){e===Ue.Global?ye(X9,t.eye):se(X9,0,0,1),ie(Z9,t.viewForward,-1);const i=GD(Z9,X9),s=Math.max(i-2*Y9,0),n=.85*s/(s+1),o=Math.max(Y9,i-Y9-n);Au(Qne,-o,t.viewRight),Fe(r,Z9,Qne),ue(r,r,ie(tet,t.viewRight,ret)),ye(r,r)}function XKe(t,e,r,i){const s=QKe,n=zh(JKe);if(r===Ue.Global)Fw.getPosition(t,0,0,s),se(i,0,0,-1),eE(n,n,-s.azimuth),S6(n,n,-s.altitude),Fe(i,i,n);else{const o=Xa.planarDirection,a=o.globalAngles,l=e[2];let c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=ve(c,0,1),c<1?(Fw.getPosition(t,e[1],e[0],s),s.azimuth=(1-c)*s.azimuth+c*a.azimuth,s.altitude=(1-c)*s.altitude+c*a.altitude):(s.azimuth=a.azimuth,s.altitude=a.altitude),se(i,0,-1,0),tE(n,n,-s.azimuth),eE(n,n,-s.altitude),Fe(i,i,n)}}function ZKe(t,e){if(e===Ue.Global)return!0;const r=Xa.planarDirection;return Math.abs(t)<r.localAltitude}const YKe=Me(.5773502691896258,-.5773502691896258,.5773502691896258);let mSe=class{constructor(){this.ambient={color:Me(1,1,1),intensity:.55},this.direct={color:Me(1,1,1),intensity:.55,directionToLightSource:Fs(YKe)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}};const JKe=be(),QKe={azimuth:0,altitude:0};function KKe(t,e){const r=t.valueOf();let i,s;e.polarException===Fw.PolarException.MIDNIGHT_SUN?(i=r-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,s=i+432e6):e.polarException===Fw.PolarException.POLAR_NIGHT?(i=r-2,s=r-1):(i=e.sunrise.valueOf(),s=e.sunset.valueOf());const n=i+(s-i)/2;return 1-ve(Math.abs(r-n)/432e5,0,1)}function gSe(t){switch(t){case"disabled":case"sunny":case"cloudy":return new GI(1,1);case"rainy":return new GI(.4,1.2);case"snowy":return new GI(.5,1.3);case"foggy":return new GI(.2,1.6)}}function Bne(t,e){const r=(t[0]+t[1]+t[2])/3;t[0]+=(r-t[0])*e,t[1]+=(r-t[1])*e,t[2]+=(r-t[2])*e}const H9=Me(.01,.01,.01),oq=Me(1,.6,.5),aq=Me(1,.98,.98),Gne=Me(1,1,1),q9=Me(.8,.8,1),lq=Me(.8,.8,1),cq=Me(.98,.98,1),jne=Me(1,1,1),W9=fr(.01,Xa.local.ambientAtNight),uq=fr(Xa.local.directAtTwilight,Xa.local.ambientAtTwilight),hq=fr(.9*Xa.local.directAtNoon,Xa.local.ambientAtNoon),Hne=fr(Xa.local.directAtNoon,Xa.local.ambientAtNoon),qne=hq,Wne=aq,Xne=cq,Zne=uq,Yne=oq,Jne=lq;function eet(t,e,r){const i=t.valueOf();let s,n;e.polarException===Fw.PolarException.MIDNIGHT_SUN?(s=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,n=s+432e6):e.polarException===Fw.PolarException.POLAR_NIGHT?(s=i-2,n=i-1):(s=e.sunrise.valueOf(),n=e.sunset.valueOf());const o=n-s,a=s+o/2,l=o/4,c=a-l,h=a+l,p=.06*o,f=s-p/2,m=s+p/2,y=n-p/2,_=n+p/2,v=Ge(),b=O(),T=O();let x="";if(i<f||i>_)fn(v,W9),re(b,H9),re(T,q9),x="night";else if(i<m){const A=(i-f)/(m-f);wh(v,W9,uq,A),Hr(b,H9,oq,A),Hr(T,q9,lq,A),x="sun rising"}else if(i<c){const A=(i-m)/(c-m);wh(v,uq,hq,A),Hr(b,oq,aq,A),Hr(T,lq,cq,A),x="early morning"}else if(i<a){const A=(i-c)/(a-c);wh(v,hq,Hne,A),Hr(b,aq,Gne,A),Hr(T,cq,jne,A),x="late morning"}else if(i<h){const A=(i-a)/(h-a);wh(v,Hne,qne,A),Hr(b,Gne,Wne,A),Hr(T,jne,Xne,A),x="early afternoon"}else if(i<y){const A=(i-h)/(y-h);wh(v,qne,Zne,A),Hr(b,Wne,Yne,A),Hr(T,Xne,Jne,A),x="late afternoon"}else if(i<_){const A=(i-y)/(_-y);wh(v,Zne,W9,A),Hr(b,Yne,H9,A),Hr(T,Jne,q9,A),x="sun setting"}let S=0;switch(r){case"rainy":case"foggy":S=.8;break;case"snowy":S=.5}S>0&&(Bne(b,S),Bne(T,S));const E=gSe(r);return{direct:{intensity:v[0]*E.direct,color:b},ambient:{intensity:v[1]*E.ambient,color:T},timeOfDay:x}}const Qne=be(),X9=O(),Z9=O(),tet=O(),Y9=.25,ret=.2;let Rd=class extends ws.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandles=new Ii,this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new nF,this._ambientLight=new vJ,this._moonLight=new ATe,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView(),this._viewHandles.destroy()}get _view(){return this._renderer?.view}get updating(){return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!this._renderer?.updating)}get weatherEnabled(){return this._view?.environment.atmosphereEnabled&&!this._disableWeather&&this._view?.state?.viewingMode===Ue.Global&&mR(this._view.spatialReference)}get weatherVisible(){return this.weatherEnabled&&this._renderer?.weatherVisible}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){if(this._renderer)return;this._renderer=new Po({view:e});const r=()=>this._updateRenderParameters(),i=()=>this._cameraHandler();this._viewHandles.add([ae(()=>e.environment.lighting,s=>this._updateLightingHandler(s),qr),ae(()=>e.environment.lighting.type!=="virtual"?e.environment.lighting.date:null,s=>this._lightingDateHandler(s),qr),ae(()=>e.stationary,()=>this._interactingStationaryHandler()),ae(()=>e.environment.lighting.directShadowsEnabled,r,qr),ae(()=>e.qualitySettings.ambientOcclusion,r,qr),ae(()=>e.qualitySettings.reflections,r,qr),ae(()=>e.environment.background?.color,r,qr),ae(()=>e.spatialReference,()=>this._resetReferencePosition(!0),qr),ae(()=>e.environment.weather.type,()=>this._updateLighting(null,S2.Faded),qr),ae(()=>this.weatherEnabled,()=>this._updateLighting(null,S2.Faded),qr),ae(()=>e.viewingMode,()=>this._resetReferencePosition(!0),Is),ae(()=>e.environment.lighting.type!=="virtual"&&e.environment.lighting.cameraTrackingEnabled,s=>this._updateCameraTracking(s),Is),ae(()=>e.state.camera,i,Is),ae(()=>this.disableQueries,i)]),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer=$e(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type!=="virtual"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type!=="virtual"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const r=this._view.environment.lighting;r?.type!=="virtual"&&(r.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const r=this._view.environment.lighting;if(r?.type!=="virtual"){if(e){if(!r.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const i=this._view.spatialReference;if(!tv(i)){const s=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(s))return void this._requestReferencePositionUpdate(s)}if(this._preupdateTracking(e),this._referencePosWGS84Comparable!=null){const s=Une(this._referencePosWGS84Comparable,Kne);s!=null&&(r.autoUpdate(null,s),this._trackingEnabled&&(r.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type!=="virtual"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const r=this._view;if(!r.ready)return;const i=r.stateManager.camera;i&&(this._cameraHandlerClientSide(i,e)||this._cameraHandlerServerSide(i))}_cameraHandlerClientSide(e,r){const i=mR(this._view.spatialReference);if(i&&!tv(this._view.spatialReference))return this._view.environment.lighting.type==="virtual"&&this._updateLighting(),!1;const s=e.position;return this._referencePosWGS84Comparable==null&&(this._referencePosWGS84Comparable=O()),i?I1e(s,this._referencePosWGS84Comparable):se(this._referencePosWGS84Comparable,s.longitude??0,s.latitude??0,s.z??0),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,r)||this._updateLighting(r),!0}_cameraHandlerServerSide(e){const r=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(r))&&this._requestReferencePositionUpdate(r,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=(r.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e,r=S2.Immediate){const i=this._view;e=e||(i.environment.lighting.type==="virtual"?null:i.environment.lighting.date);const s=this._referencePosWGS84Comparable,n=s!=null?iet:set,o=this.weatherVisible?i.environment.weather.type:"disabled";s!=null?WKe(e,s,i.state.viewingMode,o,i.state.camera,n):i.environment.lighting.type==="virtual"&&fSe(i.state.camera,i.state.viewingMode,n.direct.directionToLightSource);const a=this._mainLight,l=n.direct;ie(a.intensity,l.color,l.intensity*Math.PI),re(a.direction,l.directionToLightSource),a.specularStrength=n.specularStrength,a.environmentStrength=n.environmentStrength;const c=this._ambientLight;ie(c.intensity,n.ambient.color,n.ambient.intensity);const h=this._moonLight;Hr(h.intensity,oet,aet,n.globalFactor);const p=(1-.5*n.globalFactor)*(1-.4*n.noonFactor*(1-n.globalFactor));ie(h.intensity,h.intensity,p),re(h.direction,l.directionToLightSource),this._renderer.updateLightSources([a,c,h],n.noonFactor,n.globalFactor,r),this._updateRenderParameters()}_autoUpdateTimezone(e,r=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||e==null)return!1;const i=net;i.setTime((r||this._view.environment.lighting.date).getTime());const s=Une(e,Kne);if(s==null)return!1;let n=this._view.environment.lighting.positionTimezoneInfo;if(n.autoUpdated){if(n.hours===s.hours&&n.minutes===s.minutes&&n.seconds===s.seconds)return!1}else n=s;const o=i.getUTCHours()-(s.hours-n.hours),a=i.getUTCMinutes()-(s.minutes-n.minutes),l=i.getUTCSeconds()-(s.seconds-n.seconds);return i.setUTCHours(o),i.setUTCMinutes(a),i.setUTCSeconds(l),!r&&this._view.environment.lighting.autoUpdate(i,s)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const r=this._referencePosWGS84Comparable==null||ZKe(this._referencePosWGS84Comparable[2],this._view.state.viewingMode),i=this._view.environment.background,s=i instanceof Pxe?{type:"color",color:XZ(Ne.toUnitRGBA(i.color))}:{type:"color",color:Nt(0,0,0,1)};e.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&r,background:s,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible,qualitySettings:this._view.qualitySettings})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,r=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!r,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const i=this._referencePosUpdateQuery=U2(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===i){const n=()=>this._referencePosUpdateQuery!==i;return this._doReferencePositionUpdateQuery(n)}}).catch(n=>{n.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===i&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),s=this._referencePosUpdateTimer=U2(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===s&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const r=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(r[0])&&!isNaN(r[1])){const i=(this._referencePosMapCoords.z??0)*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=r[0],this._referencePosWGS84Comparable[1]=r[1],this._referencePosWGS84Comparable[2]=i):this._referencePosWGS84Comparable=[r[0],r[1],i],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let r=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(r*=this._view.mapCoordsHelper.unitInMeters),r>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return{get renderer(){return e._renderer},set referencePointUpdateInterval(r){e._referencePointUpdateInterval=r},set referencePointUpdateDistThreshold(r){e._referencePointUpdateDistThreshold=r},set referencePosUpdateTimer(r){e._referencePosUpdateTimer=r},set referencePointUpdateDelay(r){e._referencePointUpdateDelay=r},set disableWeather(r){e._disableWeather=r}}}};u([d({type:Boolean,readOnly:!0})],Rd.prototype,"updating",null),u([d()],Rd.prototype,"disableQueries",void 0),u([d()],Rd.prototype,"_disableWeather",void 0),u([d()],Rd.prototype,"weatherEnabled",null),u([d()],Rd.prototype,"weatherVisible",null),u([d()],Rd.prototype,"referencePositionWGS84Comparable",null),u([d()],Rd.prototype,"_renderer",void 0),u([d()],Rd.prototype,"_referencePosWGS84Comparable",void 0),Rd=u([P("esri.views.3d.environment.SceneViewEnvironmentManager")],Rd);const iet=new mSe,set=new mSe,net=new Date,Kne={hours:0,minutes:0,seconds:0},oet=Me(.22,.22,.33),aet=Me(.22,.22,.22);var Ri;(function(t){t[t.NONE=0]="NONE",t[t.TILT=1]="TILT",t[t.ALTITUDE=2]="ALTITUDE",t[t.DISTANCE=4]="DISTANCE",t[t.COLLISION=8]="COLLISION",t[t.ALL=15]="ALL",t[t.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(Ri||(Ri={}));var Zt;(function(t){t[t.NONE=0]="NONE",t[t.ZOOM=1]="ZOOM",t[t.TUMBLE=2]="TUMBLE",t[t.LOOK_AROUND=3]="LOOK_AROUND",t[t.PAN=4]="PAN",t[t.ASCEND=5]="ASCEND"})(Zt||(Zt={}));var Kn;(function(t){t[t.TUMBLE=0]="TUMBLE",t[t.LOOK_AROUND=1]="LOOK_AROUND"})(Kn||(Kn={}));function jR(t,e){return(t&e)!=0}function dF(t,e,r,i,s,n){t!==0&&(r?(n.min=Math.min(n.min,e),n.max=Math.max(n.max,e)):i!=null?(n.min-=Math.max(0,(e-n.min)*(1-i)),n.max+=Math.max(0,(e-n.max)*(1-i))):s&&(n.min-=Math.max(0,e-n.min-s),n.max+=Math.max(0,e-n.max-s)))}const cv={selection:Ri.NONE,interactionType:Zt.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Kn.TUMBLE};function ySe(t,e,r,i){return e=e||t.viewForward,re(i,e),ie(i,i,Math.sign(fe(e,r))),i}function cet(t,e,r,i){return fet(t,e,r,det(i,e,r,!0))}function uet(t,e,r,i){const s=fe(r,de(t,i,e));return ue(t,e,ie(t,r,s))}const het={dir:O(),len:0,clip:Ge()};function det(t,e,r,i){const s=het;return t?(r&&i&&(s.len=fi(e,r)),re(s.dir,t)):i?(s.len=fi(e,r),de(s.dir,r,e),ie(s.dir,s.dir,1/s.len)):(de(s.dir,r,e),ye(s.dir,s.dir)),s}function pet(t,e,r){const i=fe(t,r.dir),s=-pi(t,e);if(s<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return s>0;if((s<0||i<0)&&!(s<0&&i<0))return!0;const n=s/i;return i>0?n<r.clip[1]&&(r.clip[1]=n):n>r.clip[0]&&(r.clip[0]=n),r.clip[0]<=r.clip[1]}function fet(t,e,r,i){i.clip[0]=0,i.clip[1]=r?i.len:Number.MAX_VALUE;for(let s=0;s<t.length;s++)if(!pet(t[s],e,i))return!1;return!0}function met(t,e,r=cv){const i=PJ(t,e,r);if(i===0)return!1;const s=t.renderCoordsHelper,n=s.getAltitude(e.eye)+i,o=ySe(e,r.interactionDirection,_et(t,e,Math.sign(i),xet),wet),a=re(Tet,e.viewForward),l=s.intersectInfiniteManifold(Ou(e.eye,o),n,J9);return e.eye=l??s.setAltitude(J9,n,e.eye),e.center=uet(J9,e.eye,a,e.center),!0}function PJ(t,e,r=cv){if(!get(t,r)||!t.state.constraints.altitude)return 0;const i=vet(t.state.constraints.altitude,bet);yet(t,r,i);const s=t.renderCoordsHelper.getAltitude(e.eye),n=ve(s,i.min,i.max)-s;return Math.abs(n)<=1e-6?0:n}function get(t,e){const r=t.state.constraints.altitude;return!(!t.state.isGlobal||!r)&&(e.interactionType!==Zt.TUMBLE||!jR(e.selection,Ri.TILT))}function yet(t,e,r){const i=e.interactionType;if(i===Zt.NONE)return;const{min:s,max:n}=r,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=i===Zt.TUMBLE||i===Zt.ZOOM,c=PJ(t,o),h=c===0?0:t.renderCoordsHelper.getAltitude(o.eye);r.min=s,r.max=n,dF(c,h,l,a,.05*h,r)}function _et(t,e,r,i){return t.renderCoordsHelper.worldUpAtPosition(e.eye,i),ie(i,i,r),i}function vet(t,e){return e.min=t.min,e.max=t.max,e}const bet={min:0,max:0},wet=O(),xet=O(),Tet=O(),J9=O();function IJ(t,e,r=cv){if(!t.state.isLocal)return 0;const i=t.state.constraints.distance;if(!t.pointsOfInterest.surfaceOrigin.renderLocation||i===1/0)return 0;jI.min=0,jI.max=i,Cet(t,r,jI);const s=$J(t,e),n=jI.max-s;return n>=-1e-6?0:n}function Eet(t,e,r=cv){const i=IJ(t,e,r);if(i===0)return!1;const s=t.pointsOfInterest.surfaceOrigin;if(!s.renderLocation)return!1;const n=$J(t,e)+i,o=re(Oet,e.eye),a=ySe(e,r.interactionDirection,Aet(e,s.renderLocation,Pet),Met);if(!Sv(Jbe(s.renderLocation,n),Ou(e.eye,a),HI))return!1;e.eye=HI;const l=de(Ret,e.eye,o);e.center=ue(HI,e.center,l);const c=t.renderCoordsHelper.getAltitude(e.center),h=t.renderCoordsHelper.intersectInfiniteManifold(e.ray,c,HI);return h!=null&&(e.center=h),!0}function Cet(t,e,r){const i=e.interactionType;if(i===Zt.NONE)return;const{min:s,max:n}=r,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=i===Zt.ZOOM||i===Zt.PAN,c=IJ(t,o),h=c===0?0:$J(t,o);r.min=s,r.max=n,dF(c,h,l,a,.05*h,r)}function $J(t,e){const r=t.pointsOfInterest.surfaceOrigin;return r.renderLocation?fi(e.eye,r.renderLocation):0}function Aet(t,e,r){return by(r,t.eye,e)}const jI={min:0,max:0},Oet=O(),Ret=O(),Met=O(),Pet=O(),HI=O();var Gi,wo;(function(t){t[t.OBJECT=0]="OBJECT",t[t.HUD=1]="HUD",t[t.TERRAIN=2]="TERRAIN",t[t.OVERLAY=3]="OVERLAY",t[t.I3S=4]="I3S",t[t.PCL=5]="PCL",t[t.LOD=6]="LOD",t[t.VOXEL=7]="VOXEL"})(Gi||(Gi={}));let Iet=class{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=wo.ALL}};(function(t){t[t.MIN=0]="MIN",t[t.MINMAX=1]="MINMAX",t[t.ALL=2]="ALL"})(wo||(wo={}));let $et=class{constructor(e,r,i){this.object=e,this.geometryId=r,this.triangleNr=i}},Let=class extends $et{constructor(e,r,i,s){super(e,r,i),this.center=s!=null?Fs(s):null}},_Se=class{constructor(e){this.layerUid=e}},pU=class extends _Se{constructor(e,r){super(e),this.graphicUid=r}};function Mp(t){return t!=null&&t.dist!=null}function eoe(t){return(e,r,i)=>(Hr(toe,e,r,i),!XY(t,toe))}function fU(t){return Mp(t)&&t.intersector===Gi.OBJECT&&!!t.target}function mU(t){return Mp(t)&&t.intersector===Gi.HUD&&!!t.target&&"center"in t.target&&t.target.center!=null}const toe=O();let Det=class{constructor(){this._transform=be(),this._transformInverse=new qI({value:this._transform},Mn,be),this._transformInverseTranspose=new qI(this._transformInverse,$c,be),this._transformTranspose=new qI({value:this._transform},$c,be),this._transformInverseRotation=new qI({value:this._transform},fbe,Ui)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){Us(this._transform,e)}multiplyTransform(e){oi(this._transform,this._transform,e)}set(e){Us(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,r){this.setTransformMatrix(e),this.multiplyTransform(r),this._invalidateLazyTransforms()}},qI=class{constructor(e,r,i){this._original=e,this._update=r,this._dirty=!0,this._transform=i()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}},Net=class{constructor(e=0){this.offset=e,this.tmpVertex=O()}applyToVertex(e,r,i){const s=e+this.localOrigin[0],n=r+this.localOrigin[1],o=i+this.localOrigin[2],a=this.offset/Math.sqrt(s*s+n*n+o*o);return this.tmpVertex[0]=e+s*a,this.tmpVertex[1]=r+n*a,this.tmpVertex[2]=i+o*a,this.tmpVertex}applyToAabb(e){for(let n=0;n<3;++n)r0[n]=e[0+n]+this.localOrigin[n],WI[n]=e[3+n]+this.localOrigin[n],HC[n]=r0[n];const r=this.applyToVertex(r0[0],r0[1],r0[2]);for(let n=0;n<3;++n)e[n]=r[n],e[n+3]=r[n];const i=n=>{const o=this.applyToVertex(n[0],n[1],n[2]);for(let a=0;a<3;++a)e[a]=Math.min(e[a],o[a]),e[a+3]=Math.max(e[a+3],o[a])};for(let n=1;n<8;++n){for(let o=0;o<3;++o)HC[o]=n&1<<o?WI[o]:r0[o];i(HC)}let s=0;for(let n=0;n<3;++n)r0[n]*WI[n]<0&&(s|=1<<n);if(s!==0&&s!==7){for(let n=0;n<8;++n)if(!(s&n)){for(let o=0;o<3;++o)HC[o]=s&1<<o?0:n&1<<o?r0[o]:WI[o];i(HC)}}for(let n=0;n<3;++n)e[n]-=this.localOrigin[n],e[n+3]-=this.localOrigin[n];return e}};const r0=O(),WI=O(),HC=O();let Fet=class{constructor(e=0){this.componentLocalOriginLength=0,this._tmpVertex=O(),this._mbs=bs(),this._obb={center:O(),halfSize:os(),quaternion:null},this._totalOffset=0,this._offset=0,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}applyToVertex(e,r,i){const s=e,n=r,o=i+this.componentLocalOriginLength,a=this._totalOffset/Math.sqrt(s*s+n*n+o*o);return this._tmpVertex[0]=e+s*a,this._tmpVertex[1]=r+n*a,this._tmpVertex[2]=i+o*a,this._tmpVertex}applyToAabb(e){const r=e[0],i=e[1],s=e[2]+this.componentLocalOriginLength,n=e[3],o=e[4],a=e[5]+this.componentLocalOriginLength,l=r*n<0?0:Math.min(Math.abs(r),Math.abs(n)),c=i*o<0?0:Math.min(Math.abs(i),Math.abs(o)),h=s*a<0?0:Math.min(Math.abs(s),Math.abs(a)),p=Math.sqrt(l*l+c*c+h*h);if(p<this._totalOffset)return e[0]-=r<0?this._totalOffset:0,e[1]-=i<0?this._totalOffset:0,e[2]-=s<0?this._totalOffset:0,e[3]+=n>0?this._totalOffset:0,e[4]+=o>0?this._totalOffset:0,e[5]+=a>0?this._totalOffset:0,e;const f=Math.max(Math.abs(r),Math.abs(n)),m=Math.max(Math.abs(i),Math.abs(o)),y=Math.max(Math.abs(s),Math.abs(a)),_=Math.sqrt(f*f+m*m+y*y),v=this._totalOffset/_,b=this._totalOffset/p;return e[0]+=r*(r>0?v:b),e[1]+=i*(i>0?v:b),e[2]+=s*(s>0?v:b),e[3]+=n*(n<0?v:b),e[4]+=o*(o<0?v:b),e[5]+=a*(a<0?v:b),e}applyToMbs(e){const r=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this._totalOffset/r;return this._mbs[0]=e[0]+e[0]*i,this._mbs[1]=e[1]+e[1]*i,this._mbs[2]=e[2]+e[2]*i,this._mbs[3]=e[3]+e[3]*this._totalOffset/r,this._mbs}applyToObb(e){const r=e.center,i=this._totalOffset/Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);this._obb.center[0]=r[0]+r[0]*i,this._obb.center[1]=r[1]+r[1]*i,this._obb.center[2]=r[2]+r[2]*i,Oc(this._obb.halfSize,e.halfSize,e.quaternion),ue(this._obb.halfSize,this._obb.halfSize,e.center);const s=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);return this._obb.halfSize[0]+=this._obb.halfSize[0]*s,this._obb.halfSize[1]+=this._obb.halfSize[1]*s,this._obb.halfSize[2]+=this._obb.halfSize[2]*s,de(this._obb.halfSize,this._obb.halfSize,e.center),um(noe,e.quaternion),Oc(this._obb.halfSize,this._obb.halfSize,noe),this._obb.halfSize[0]*=this._obb.halfSize[0]<0?-1:1,this._obb.halfSize[1]*=this._obb.halfSize[1]<0?-1:1,this._obb.halfSize[2]*=this._obb.halfSize[2]<0?-1:1,this._obb.quaternion=e.quaternion,this._obb}},Uet=class{constructor(e=0){this.offset=e,this.sphere=bs(),this.tmpVertex=O()}applyToVertex(e,r,i){const s=this.objectTransform.transform;let n=s[0]*e+s[4]*r+s[8]*i+s[12],o=s[1]*e+s[5]*r+s[9]*i+s[13],a=s[2]*e+s[6]*r+s[10]*i+s[14];const l=this.offset/Math.sqrt(n*n+o*o+a*a);n+=n*l,o+=o*l,a+=a*l;const c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*n+c[4]*o+c[8]*a+c[12],this.tmpVertex[1]=c[1]*n+c[5]*o+c[9]*a+c[13],this.tmpVertex[2]=c[2]*n+c[6]*o+c[10]*a+c[14],this.tmpVertex}applyToMinMax(e,r){const i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i;const s=this.offset/Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);r[0]+=r[0]*s,r[1]+=r[1]*s,r[2]+=r[2]*s}applyToAabb(e){const r=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*r,e[1]+=e[1]*r,e[2]+=e[2]*r;const i=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*i,e[4]+=e[4]*i,e[5]+=e[5]*i,e}applyToBoundingSphere(e){const r=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this.offset/r;return this.sphere[0]=e[0]+e[0]*i,this.sphere[1]=e[1]+e[1]*i,this.sphere[2]=e[2]+e[2]*i,this.sphere[3]=e[3]+e[3]*this.offset/r,this.sphere}};const roe=new Uet;function dq(t){return t!=null?(roe.offset=t,roe):null}const ioe=new Fet;function ket(t){return t!=null?(ioe.offset=t,ioe):null}const soe=new Net;function zet(t){return t!=null?(soe.offset=t,soe):null}const y_="terrain",noe=Xh(),_E=1e-5;let Vet=class{constructor(e){this.options=new Iet,this._results=new Bet,this.transform=new Det,this.tolerance=_E,this.verticalOffset=null,this._ray=Jn(),this._rayEnd=O(),this._rayBeginTransformed=O(),this._rayEndTransformed=O(),this.viewingMode=e??Ue.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,r,i){this.resetWithRay(OHe(e,r,this._ray),i)}resetWithRay(e,r){this.camera=r,e!==this._ray&&W4(e,this._ray),this.options.verticalOffset!==0?this.viewingMode===Ue.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,ue(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,r,i,s,n){this.point=r,this.filterPredicate=s,this.tolerance=i??_E;const o=dq(this.verticalOffset);if(e&&e.length>0){const a=n?l=>{n(l)&&this.intersectObject(l)}:l=>{this.intersectObject(l)};for(const l of e){const c=l.getSpatialQueryAccelerator&&l.getSpatialQueryAccelerator();c!=null?(o!=null?c.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,a,o):c.forEachAlongRay(this._ray.origin,this._ray.direction,a),this.options.selectionMode&&this.options.hud&&c.forEachDegenerateObject(a)):l.objects.forAll(h=>a(h))}}this.sortResults()}intersectObject(e){const r=e.geometries;if(!r)return;const i=e.shaderTransformation,s=dq(this.verticalOffset);for(const n of r){if(!n.visible)continue;const{material:o,id:a}=n;this.transform.setAndInvalidateLazyTransforms(i,n.shaderTransformation),Fe(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),Fe(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;s!=null&&(s.objectTransform=this.transform),o.intersect(n,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(c,h,p,f,m,y)=>{if(c>=0){if(this.filterPredicate!=null&&!this.filterPredicate(this._ray.origin,this._rayEnd,c))return;const _=f?this._results.hud:this._results,v=f?b=>{const T=new Let(e,a,p,y);b.set(Gi.HUD,T,c,h,un,m)}:b=>b.set(Gi.OBJECT,{object:e,geometryId:a,triangleNr:p},c,h,l,m);if((_.min.drapedLayerOrder==null||m>=_.min.drapedLayerOrder)&&(_.min.dist==null||c<_.min.dist)&&v(_.min),this.options.store!==wo.MIN&&(_.max.drapedLayerOrder==null||m<_.max.drapedLayerOrder)&&(_.max.dist==null||c>_.max.dist)&&v(_.max),this.options.store===wo.ALL)if(f){const b=new pq(this._ray);v(b),this._results.hud.all.push(b)}else{const b=new E2(this._ray);v(b),this._results.all.push(b)}}})}}sortResults(e=this._results.all){e.sort((r,i)=>r.dist!==i.dist?(r.dist??0)-(i.dist??0):r.drapedLayerOrder!==i.drapedLayerOrder?(r.drapedLayerOrder??Number.MAX_VALUE)-(i.drapedLayerOrder??Number.MAX_VALUE):(i.drapedLayerGraphicOrder??Number.MIN_VALUE)-(r.drapedLayerGraphicOrder??Number.MIN_VALUE))}};function qh(t){return new Vet(t)}let Bet=class{constructor(){this.min=new E2(Jn()),this.max=new E2(Jn()),this.hud={min:new pq(Jn()),max:new pq(Jn()),all:new Array},this.ground=new E2(Jn()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}},E2=class{get ray(){return this._ray}get distanceInRenderSpace(){return this.dist!=null?(ie(XI,this.ray.direction,this.dist),Oe(XI)):null}getIntersectionPoint(e){return!!Mp(this)&&(ie(XI,this.ray.direction,this.dist),ue(e,this.ray.origin,XI),!0)}getTransformedNormal(e){return re(qC,this.normal),qC[3]=0,mu(qC,qC,this.transformation),re(e,qC),ye(e,e)}constructor(e){this.intersector=Gi.OBJECT,this.normal=O(),this.transformation=be(),this._ray=Jn(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=Gi.OBJECT,W4(e,this._ray)}set(e,r,i,s,n,o,a){this.intersector=e,this.dist=i,re(this.normal,s??XX),Us(this.transformation,n??un),this.target=r,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(e){W4(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,re(this.normal,e.normal),Us(this.transformation,e.transformation)}},pq=class extends E2{constructor(){super(...arguments),this.intersector=Gi.HUD}};function LJ(t){return new E2(t)}const XI=O(),qC=Xt();function vSe(t,e,r,i){return t.renderCoordsHelper.fromRenderCoords(e.eye,pF,i)!=null&&Fge(r,pF)}function gU(t,e){return t.elevationProvider?t.elevationProvider.getElevation(e[0],e[1],e[2],t.renderCoordsHelper.spatialReference,"ground")??0:0}function gx(t,e,r,i){const s=t.state.camera.clone();e&&r&&i&&(s.eye=e,s.center=r,s.up=i),Get(t,s.ray,i0)||re(i0,s.center);const n=t.state.constraints,o=n.minimumPoiDistance;if(vo(s.eye,i0)<o){const a=n.collision.enabled;re(jv,s.viewForward),ie(jv,jv,o),a?s.eye=de(pF,i0,jv):ue(i0,s.eye,jv);const l=t.renderCoordsHelper,c=l.getAltitude(s.eye),h=n.collision.elevationMargin;a&&c<h&&(de(jv,i0,s.eye),s.eye=l.setAltitude(pF,h,s.eye),ue(i0,s.eye,jv))}return s.center=i0,s}function ooe(t,e,r){if(!t.state.isGlobal||!t.stateManager.constraintsManager)return!1;const i=gU(t,e),s=t.stateManager.constraintsManager.nearFarHeuristic,{far:n}=s.compute(e,r,t.renderDataExtent,i,Het),o=n*n;return vo(e,r)>o}function Get(t,e,r){let i=aoe[t.viewingMode];i||(i=qh(t.state.viewingMode),i.options.backfacesTerrain=!t.state.isGlobal,i.options.invisibleTerrain=!0,aoe[t.viewingMode]=i);const{isGlobal:s}=t.state;return!(!t.sceneIntersectionHelper.intersectRay(e,i,r)||ooe(t,e.origin,r))||!(!t.renderCoordsHelper.intersectManifold(e,0,r)||ooe(t,e.origin,r))||!!s&&jet(e,r,zr(t.spatialReference).radius)}function jet(t,e,r){const i=fe(t.origin,t.origin)-r*r,s=i>0?Math.sqrt(i)/3:1;return ie(e,t.direction,s/Oe(t.direction)),ue(e,e,t.origin),!0}const aoe={},pF=O(),i0=O(),jv=O(),Het={near:0,far:0};function dC(t,e,r=Ph.EYE){const i=t.state.constraints;if(!i.collision.enabled)return!1;const s=gU(t,e.eye),n=t.renderCoordsHelper.getAltitude(e.eye),o=s+i.collision.elevationMargin;if(n>=o)return!1;const a=Oe(e.eye);if(de(ZI,e.center,e.eye),e.eye=t.renderCoordsHelper.setAltitude(qet,o,e.eye),r===Ph.EYE_AND_CENTER)e.center=ue(ZI,e.eye,ZI);else if(r===Ph.EYE_AND_CENTER_SCALE){const l=(a-n+o)/a;e.center=ie(ZI,e.center,l)}return!0}var Ph;(function(t){t[t.EYE=0]="EYE",t[t.EYE_AND_CENTER=1]="EYE_AND_CENTER",t[t.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(Ph||(Ph={}));const ZI=O(),qet=O();function uv(t,e,r){t.worldUpAtPosition(e,loe),de(Q9,r,e);const i=Oe(Q9);return i===0?0:In(fe(Q9,loe)/i)}const loe=O(),Q9=O();function bSe(t,e,r=cv,i=!0){WC.eyeCenterDistance=0,WC.requiresTwoSteps=!1;const s=DJ(t,e,r,void 0,WC);if(s===0)return!1;switch(Au(YI,-s,e.viewRight),r.tiltMode){case Kn.LOOK_AROUND:Fe(s0,e.viewForward,YI),ie(s0,s0,WC.eyeCenterDistance),e.center=ue(__,e.eye,s0);break;case Kn.TUMBLE:de(s0,e.center,e.eye),Fe(s0,s0,YI),e.eye=de(__,e.center,s0);break;default:r.tiltMode}return e.up=Fe(__,e.up,YI),!WC.requiresTwoSteps||!i||bSe(t,e,r,!1)}function DJ(t,e,r=cv,i=cv,s){if(!t.state.constraints.tilt)return 0;const n=e.distance,o=t.state.constraints.tilt(n,rtt);return ttt(t,r,o),i.interactionType===Zt.TUMBLE&&jR(i.selection,Ri.ALTITUDE)&&wSe(t,i.interactionStartCamera,o),r.tiltMode===Kn.LOOK_AROUND||i.tiltMode===Kn.LOOK_AROUND?Xet(t,e,o,s):Wet(t,e,o)}function Wet(t,e,r){const i=uv(t.renderCoordsHelper,e.center,e.eye),s=i-ve(i,r.min,r.max);return HR(s)?s:0}function Xet(t,e,r,i){switch(i&&(i.requiresTwoSteps=!1),t.viewingMode){case"global":return Yet(t,e,r,i);case"local":return Zet(t,e,r,i)}}function Zet(t,e,r,i){const s=uv(t.renderCoordsHelper,e.center,e.eye),n=ve(s,r.min,r.max),o=s-n;if(!HR(o))return 0;if(i){const a=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=t.renderCoordsHelper.getAltitude(e.eye)-a,c=Math.cos(n);Math.abs(c)>1e-4?i.eyeCenterDistance=l/c:i.eyeCenterDistance=e.distance}return o}function Yet(t,e,r,i){const s=Jet(t,e,itt),n=ve(s.tiltAtCenter,r.min,r.max);if(!HR(s.tiltAtCenter-n))return 0;let o,a;return s.centerIsOnSurface?(o=Qet(s),a=Ket(s,o)):(o=s.constraints.clampTilt(s.eyeCenterDistance,s.tiltAtCenter),i&&o<Math.PI/2&&(i.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=ett(s,o)),i&&(i.eyeCenterDistance=fq(s,o)),a}function Jet(t,e,r){const i=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,s=i+zr(t.spatialReference).radius,n=t.renderCoordsHelper.intersectManifold(e.ray,i,__);return r.eyeCenterDistance=e.distance,r.centerIsOnSurface=!1,n!=null?(r.eyeCenterDistance=fi(e.eye,n),r.tiltAtCenter=uv(t.renderCoordsHelper,n,e.eye),r.centerIsOnSurface=!0):t.state.isLocal?r.tiltAtCenter=uv(t.renderCoordsHelper,e.center,e.eye):(aC(V6(B6,s),e.ray,__),r.eyeCenterDistance=fi(e.eye,__),r.tiltAtCenter=In(-fe(e.viewForward,ye(__,__)))),r.radius=s,r.eyeRadius=Oe(e.eye),r.constraints=t.state.constraints,r}function HR(t){return Math.abs(t)>1e-9}function Qet(t){const{constraints:e,eyeCenterDistance:r,tiltAtCenter:i}=t;let s=i,n=e.clampTilt(r,i);const o=fq(t,n);if(e.clampTilt(o,i)===n)return n;let a=0;for(;a<10&&HR(n-s);){const l=(s+n)/2,c=fq(t,l);HR(e.clampTilt(c,l)-l)?s=l:n=l,a++}return n}function fq(t,e){if(!t.centerIsOnSurface)return t.eyeCenterDistance;const r=Math.PI-ve(e,0,Math.PI),i=Fh(t.radius/t.eyeRadius*Math.sin(r)),s=Math.PI-r-i,n=Math.sin(s)/Math.sin(r);if(t.eyeRadius<t.radius&&n>1){const o=Math.PI-i,a=Math.PI-r-o;return Math.sin(a)/Math.sin(r)*t.eyeRadius}return n*t.eyeRadius}function Ket(t,e){const r=Fh(t.radius/t.eyeRadius*Math.sin(t.tiltAtCenter)),i=Fh(t.radius/t.eyeRadius*Math.sin(e));return t.eyeRadius>t.radius?r-i:i-r}function ett(t,e){return t.tiltAtCenter-Math.PI/2-(e-Math.PI/2)}function ttt(t,e,r){if(e.interactionType===Zt.NONE)return;const{interactionStartCamera:i,interactionFactor:s}=e;if(!i)return;const{min:n,max:o}=r,a=DJ(t,i,cv,e),l=a===0?0:uv(t.renderCoordsHelper,i.center,i.eye);r.min=n,r.max=o,e.interactionType===Zt.TUMBLE?(jR(e.selection,Ri.ALTITUDE)&&wSe(t,i,r),dF(a,l,!0,s,coe,r)):dF(a,l,!1,s,coe,r)}function wSe(t,e,r){const i=t.state.constraints;if(t.state.isLocal||!i.altitude||!e)return;const s=la(e.center),n=Math.sqrt(s),o=e.distance,a=zr(t.spatialReference).radius,l=i.altitude.min+a,c=i.altitude.max+a,h=(l*l-o*o-s)/(-2*n*o),p=(c*c-o*o-s)/(-2*n*o);r.min=Math.max(r.min,Math.min(Math.PI-In(p),r.max)),r.max=Math.min(r.max,Math.PI-In(h))}const s0=O(),YI=be(),__=O(),coe=Ft(5),rtt={min:0,max:0},itt={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},WC={eyeCenterDistance:0,requiresTwoSteps:!1};function stt(t){return t}const yU=t=>t*t,NJ=t=>1-yU(1-t),ntt=t=>t<.5?yU(2*t)/2:(NJ(2*(t-.5))+1)/2,FJ=t=>t*t*t,xSe=t=>1-FJ(1-t),TSe=t=>t<.5?FJ(2*t)/2:(xSe(2*(t-.5))+1)/2,UJ=t=>t*t*t*t,SSe=t=>1-UJ(1-t),ott=t=>t<.5?UJ(2*t)/2:(SSe(2*(t-.5))+1)/2,kJ=t=>t*t*t*t*t,ESe=t=>1-kJ(1-t),att=t=>t<.5?kJ(2*t)/2:(ESe(2*(t-.5))+1)/2,zJ=t=>1-Math.cos(t*Math.PI/2),CSe=t=>1-zJ(1-t),ltt=t=>t<.5?zJ(2*t)/2:(CSe(2*(t-.5))+1)/2,VJ=t=>2**(10*(t-1)),KM=t=>1-VJ(1-t),ctt=t=>t<.5?VJ(2*t)/2:(KM(2*(t-.5))+1)/2,BJ=t=>-(Math.sqrt(1-t*t)-1),ASe=t=>1-BJ(1-t),utt=t=>t<.5?BJ(2*t)/2:(ASe(2*(t-.5))+1)/2;function Jh(t){const e=2*(t-Math.sqrt((t-1)*t)),r=e/2/t;return i=>i<r?t*i*i:e*i-e+1}function Qh(t,e){return(r,i)=>r<e?e*t(r/e,i):1-t((1-r)/(1-e),i)*(1-e)}const htt=Qh(Jh(1),1),dtt=Qh(Jh(1),0),OSe=Qh(Jh(1),.5),ptt=Qh(Jh(2),1),ftt=Qh(Jh(2),0),mtt=Qh(Jh(2),.5),gtt=Qh(Jh(3),1),ytt=Qh(Jh(3),0),_tt=Qh(Jh(3),.5),vtt=Qh(Jh(4),1),btt=Qh(Jh(4),0),wtt=Qh(Jh(4),.5),xtt={linear:stt,"in-quad":yU,"out-quad":NJ,"in-out-quad":ntt,"in-coast-quad":htt,"out-coast-quad":dtt,"in-out-coast-quad":OSe,"in-cubic":FJ,"out-cubic":xSe,"in-out-cubic":TSe,"in-coast-cubic":ptt,"out-coast-cubic":ftt,"in-out-coast-cubic":mtt,"in-quart":UJ,"out-quart":SSe,"in-out-quart":ott,"in-coast-quart":gtt,"out-coast-quart":ytt,"in-out-coast-quart":_tt,"in-quint":kJ,"out-quint":ESe,"in-out-quint":att,"in-coast-quint":vtt,"out-coast-quint":btt,"in-out-coast-quint":wtt,"in-sine":zJ,"out-sine":CSe,"in-out-sine":ltt,"in-expo":VJ,"out-expo":KM,"in-out-expo":ctt,"in-circ":BJ,"out-circ":ASe,"in-out-circ":utt};function Ls(t,e,r=Ctt,i=e){i!==e&&i.copyFrom(e),i.computeUp(t.state.viewingMode);let s=!1;for(let a=0;a<Att;a++){let l=0;for(const c of Ett)if(jR(r.selection,c.type)){const h=Math.abs(c.error(t,i,r));c.apply(t,i,r)&&(s=!0,l+=h)}if(l===0)break}const n=jR(r.selection,Ri.COLLISION),o=Ttt(r.interactionType,t);return n&&dC(t,i,o)&&(s=!0),s&&i.computeUp(t.state.viewingMode),s}function Ttt(t,e){switch(t){case Zt.PAN:return Ph.EYE_AND_CENTER;case Zt.ASCEND:return e.state.isGlobal?Ph.EYE_AND_CENTER_SCALE:Ph.EYE_AND_CENTER;default:return Ph.EYE}}function Yd(t){const e=Math.min(1,t/150);return TSe(e)}function Stt(t,e,r){return DJ(t,e,r)*e.distance}const Ett=[{type:Ri.TILT,error:Stt,apply:bSe},{type:Ri.ALTITUDE,error:PJ,apply:met},{type:Ri.DISTANCE,error:IJ,apply:Eet}],Ctt={selection:Ri.ALL,interactionType:Zt.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Kn.TUMBLE},Att=5,zc=O(),Bl=O(),n0=O(),Yo=O(),Hv=O(),Ott=O(),Vc={upward:Me(0,0,1),forward:Me(0,1,0),sideway:Me(1,0,0)},uoe=Ui();let hoe=class{constructor(e=Ue.Global){this.viewingMode=e,this.center=O(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=Fs(Vc.forward)}pixelsPerPanAtZoom(e){return this.size/2/(this._zoomToPanScale*e)}zoomAtPixelsPerPan(e){return this.size/2/(this._zoomToPanScale*e)}pixelsPerRotateAtZoom(){const e=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/e}compareTo(e,r){if(r||(r={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===Ue.Global){const n=(Oe(this.center)+Oe(e.center))/2;r.pan=GD(this.center,e.center)*n}else r.pan=fi(this.center,e.center);let i=Math.abs(e.yaw-this.yaw);i>=Math.PI&&(i=2*Math.PI-i);const s=Math.abs(e.pitch-this.pitch);return r.rotate=Math.max(i,s),r.sourceZoom=this.distance,r.targetZoom=e.distance,r}interpolate(e,r,i){this.viewingMode===Ue.Global?HHe(e.center,r.center,i.pan,this.center):Hr(this.center,e.center,r.center,i.pan),this.distance=isFinite(r.distance)?St(e.distance,r.distance,i.zoom):e.distance,this.pitch=St(e.pitch,r.pitch,i.rotate);let s=e.yaw;const n=r.yaw;Math.abs(n-s)>=Math.PI&&(s+=2*(s<n?1:-1)*Math.PI),this.yaw=St(s,n,i.rotate)}copyFrom(e){re(this.center,e.center),this.pitch=e.pitch,this.yaw=e.yaw,this.distance=e.distance,re(this.lookAtDirection,e.lookAtDirection),this.size=e.size,this.copyFromCommon(e),this.viewingMode=e.viewingMode}copyFromRenderCamera(e){const r=this._lookAtOrientation(e.center,uoe);re(this.center,e.center),de(Yo,e.center,e.eye),wc(Yo,Yo,r),wc(Hv,e.up,r),this.distance=Oe(Yo),this.distance!==0&&(Yo[0]/=this.distance,Yo[1]/=this.distance,Yo[2]/=this.distance),this.pitch=this._eyeUpToPitch(Yo),this.yaw=this._eyeUpToYaw(Yo,Hv),this.size=Math.sqrt(e.width*e.width+e.height*e.height),this.copyFromCommon(e)}copyFromCommon(e){this.fov=e.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(e){const r=this._lookAtOrientation(this.center,uoe);Bh(r,r),this._axisAngleVec3(Vc.sideway,this.pitch-Math.PI/2,Vc.forward,Yo),this._axisAngleVec3(Vc.upward,this.yaw,Yo),this._axisAngleVec3(Vc.sideway,this.pitch-Math.PI/2,Vc.upward,Hv),this._axisAngleVec3(Vc.upward,this.yaw,Hv),ie(Yo,Yo,this.distance),wc(Yo,Yo,r),wc(Hv,Hv,r),e.center=this.center,e.eye=de(Yo,this.center,Yo),e.up=Hv}_axisAngleVec3(e,r,i,s=i){const n=Math.cos(r),o=Math.sin(r);return ie(zc,i,n),ht(Bl,e,i),ie(Bl,Bl,o),ie(n0,e,(1-n)*fe(e,i)),ue(s,ue(s,zc,Bl),n0)}_lookAtOrientation(e,r=Ui()){return this._upAtLookAt(e,n0),ht(zc,this.lookAtDirection,n0),ye(zc,zc),zc[0]===0&&zc[1]===0&&zc[2]===0&&re(zc,Vc.sideway),ht(Bl,n0,zc),ye(Bl,Bl),r[0]=zc[0],r[1]=Bl[0],r[2]=n0[0],r[3]=zc[1],r[4]=Bl[1],r[5]=n0[1],r[6]=zc[2],r[7]=Bl[2],r[8]=n0[2],r}_upAtLookAt(e,r){return this.viewingMode===Ue.Local?re(r,Vc.upward):ye(r,e)}_eyeUpToPitch(e){return Math.PI-GD(Vc.upward,e)}_eyeUpToYaw(e,r){const i=Ott;return Math.abs(r[2])<.5?(re(i,r),e[2]>0&&ie(i,i,-1)):re(i,e),ht(Bl,i,Vc.upward),ye(Bl,Bl),GD(Vc.sideway,Bl,Vc.upward)}};const fF={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};let Rtt=class RSe{constructor(e){this._createCamera=e,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:fF.desiredScreenFlow},this.source=e(),this.target=e()}clone(){const e=new RSe(this._createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,r,i){this.source!==e&&this.source.copyFrom(e),this.target!==r&&this.target.copyFrom(r),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=i.desiredScreenFlow!=null?i.desiredScreenFlow:fF.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const r=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/r}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}},Mtt=class{constructor(){this.segments=[]}get time(){return this.segments.reduce((e,r)=>e+r.time,0)}interpolateComponentsAt(e,r){e=Math.min(Math.max(e,0),1),e*=this.time;let i=0,s=0;const n=this.definition;for(let o=0;o<this.segments.length;o++){const a=this.segments[o],l=a.definition;if(e<=a.time||o===this.segments.length-1){if(r=this.segmentInterpolateComponentsAt(a,a.time===0?0:e/a.time,r),n.hasPan&&!isNaN(r.pan)&&isFinite(n.compared.pan)?r.pan=(i+l.compared.pan*r.pan)/n.compared.pan:r.pan=1,n.hasRotate&&!isNaN(r.rotate)&&isFinite(n.compared.rotate)?r.rotate=(s+l.compared.rotate*r.rotate)/n.compared.rotate:r.rotate=1,n.hasZoom&&!isNaN(r.zoom)&&isFinite(l.compared.targetZoom)){const c=r.zoom*(l.compared.targetZoom-l.compared.sourceZoom)+l.compared.sourceZoom,h=this.segments[0].definition.compared.sourceZoom,p=this.segments[this.segments.length-1].definition.compared.targetZoom;r.zoom=(c-h)/(p-h)}else r.zoom=1;return r}e-=a.time,i+=l.compared.pan,s+=l.compared.rotate}}segmentInterpolateComponentsAt(e,r,i){return e.interpolateComponentsAt(r,i)}},K9=class{get time(){return this._time}constructor(e){e&&this.update(e)}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,r=e.compared,i=r.sourceZoom,s=r.targetZoom;this._zoomSign=i>s?1:-1,this._panPixelsAtSource=r.pan*e.source.pixelsPerPanAtZoom(i);const n=(e.source.pixelsPerRotateAtZoom(i)+e.target.pixelsPerRotateAtZoom(s))/2;this._rotatePixels=r.rotate*n}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom,{hasZoom:i,hasPan:s,hasRotate:n}=this.definition;let o=0,a=0;i&&(s&&(o=(r/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),n&&(a=this._zoomSign*(Math.log(e/r)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(i&&s&&n){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(i&&s){const c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(i&&n){const c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(s&&n){const c=this._panPixelsAtSource/this._rotatePixels,h=1+c;this._panPixelFlow=c/h*l,this._rotatePixelFlow=1/h*l}else s?this._panPixelFlow=l:i?this._zoomPixelFlow=l:n&&(this._rotatePixelFlow=l);this._time=n?this.rotateTime:i?this.zoomTime:s?this.panTime:0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,r=e*this._panPixelsAtSource;return Math.log(r*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0}_interpolateComponentsZoom(e){if(e===0||e===1)return e;if(this.definition.hasZoom){const r=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom;return(r*(r/i)**-e-r)/(i-r)}return e}_interpolateComponentsPan(e){if(e===0||e===1)return e;if(this.definition.hasPan&&this.definition.hasZoom){const r=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(r*e*this._time)-1))/(r*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,r){e=Math.min(Math.max(e,0),1);const i=this._interpolateComponentsZoom(e),s=this._interpolateComponentsPan(e),n=this._interpolateComponentsRotate(e);return r?(r.zoom=i,r.pan=s,r.rotate=n):r={zoom:i,pan:s,rotate:n},r}};function Ptt(t,e,r){const i=e-t.compared.sourceZoom,s=t.halfWindowPanAtZoom(i);return-t.halfWindowSize*(r.ascensionFactor*Math.LN2*t.compared.pan+s)*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2*s)}function Itt(t,e,r){const i=1/e,s=Math.log(t.compared.sourceZoom*i),n=1/t.desiredPixelFlow,o=1/Math.LN2,a=e-t.compared.sourceZoom,l=1/a,c=(r.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(a))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*i*n*o*l*c-t.halfWindowSize*s*n*o*l+t.halfWindowSize*s*n*o*c/(a*a)}function $tt(t,e,r){const i=e-t.compared.sourceZoom,s=1/i,n=1/e,o=Math.log(t.compared.sourceZoom*n),a=(r.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(i))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*n*a+2*s*o+2*n-2*o*a/(i*i)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function Ltt(t,e){return-t.halfWindowSize*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2)}function Dtt(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function Ntt(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function Ftt(t,e,r){return-t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e))}function Utt(t,e,r){return t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e))}function ktt(t,e,r){return-2*t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e*e))}function ztt(t,e,r){return t.halfWindowSize*(-t.halfWindowPanAtZoom(e)-r.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*t.halfWindowPanAtZoom(-e+t.compared.targetZoom))}function Vtt(t,e,r){const i=Math.log(e/t.compared.targetZoom),s=1/t.desiredPixelFlow,n=1/Math.LN2,o=-e+t.compared.targetZoom,a=1/o,l=(-t.halfWindowPanAtZoom(e)-r.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return-t.halfWindowSize*i*s*n*a+t.halfWindowSize*i*s*n*l/(o*o)+t.halfWindowSize*s*n*a*l/e}function Btt(t,e,r){const i=e-t.compared.targetZoom,s=1/i,n=1/e,o=Math.log(e/t.compared.targetZoom),a=(t.halfWindowPanAtZoom(e)+r.descensionFactor*Math.LN2*t.compared.pan-t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*n*a-2*s*o+2*n+2*o*a/(i*i)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function Gtt(t,e){return t.halfWindowSize*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2)}function jtt(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function Htt(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function qtt(t){const e=Math.LN2*t.compared.pan,r=t.compared.sourceZoom-t.compared.targetZoom,i=t.halfWindowPanAtZoom(r),s=t.halfWindowSize*Math.log(t.compared.sourceZoom/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*i);return t.compared.sourceZoom<=t.compared.targetZoom?s*(e-i):s*(e+i)}function Wtt(t,e){let r=Xtt(t,e);const i={ascensionFactor:e.ascensionFactor!=null?e.ascensionFactor:.5,descensionFactor:e.descensionFactor!=null?e.descensionFactor:.5},s=i.ascensionFactor===0,n=i.descensionFactor===0,o=s?Ltt:Ptt,a=s?Dtt:Itt,l=s?Ntt:$tt,c=n?Gtt:ztt,h=n?jtt:Vtt,p=n?Htt:Btt,f=S=>o(t,S,i)+Ftt(t,S,i)+c(t,S,i),m=S=>a(t,S,i)+Utt(t,S,i)+h(t,S,i),y=S=>l(t,S,i)+ktt(t,S,i)+p(t,S,i);let _=f(r);const v=qtt(t);let b;const T=e.maximumIterations||20,x=e.maximumDistance!=null?e.maximumDistance:1/0;for(b=0;b<T;b++){const E=(m(r)+1e-6)/y(r);if(isNaN(E)||r>=x&&E<0){if(!isFinite(x))return null;r=x,_=f(r);break}if(r-=E,r<t.compared.sourceZoom||r<t.compared.targetZoom)return null;const A=f(r);if(Math.abs(A-_)/_<=.005)break;_=A}return _>v*(1-.3)||r<t.compared.sourceZoom||r<t.compared.targetZoom?null:r}function Xtt(t,e){const r=Math.max(t.compared.sourceZoom,t.compared.targetZoom),i=t.source.zoomAtPixelsPerPan(t.desiredPixelFlow/t.compared.pan)/2;return i<r?e.maximumDistance!=null?r+(e.maximumDistance-r)/2:1.5*r:e.maximumDistance?Math.min(e.maximumDistance,i):i}let Ztt=class extends Mtt{constructor(e,r){super(),this._preallocSegments=[new K9,new K9,new K9],this._ascensionSegment=null,this._descensionSegment=null,this.update(e,r)}update(e,r){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();let i=null;r&&r.apex&&(i=Wtt(e,r.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,i==null?this._updateWithoutApex():this._updateWithApex(i,r?.apex)}segmentInterpolateComponentsAt(e,r,i){return i=e.interpolateComponentsAt(r,i),e===this._ascensionSegment?i.zoom=NJ(i.zoom):e===this._descensionSegment&&(i.zoom=yU(i.zoom)),i}_updateWithApex(e,r){const[i,s,n]=this._preallocSegments,o=r?.ascensionFactor??.5,a=Math.min(1-o,r?.ascensionFactor!=null&&r.descensionFactor!=null?r.descensionFactor:.5),l=1-o-a;i.definition?i.definition.copyFrom(this.definition):i.definition=this.definition.clone(),i.definition.compared.targetZoom=e,i.definition.compared.pan=this.definition.compared.pan*o,i.definition.compared.rotate=this.definition.compared.rotate*o,i.update(),this._ascensionSegment=i,this.segments.push(i),l>0&&(s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.copyFrom(this.definition),s.definition.compared.sourceZoom=e,s.definition.compared.targetZoom=e,s.definition.compared.pan=this.definition.compared.pan*l,s.definition.compared.rotate=this.definition.compared.rotate*l,s.update(),this.segments.push(s)),n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.sourceZoom=e,n.definition.compared.pan=this.definition.compared.pan*a,n.definition.compared.rotate=this.definition.compared.rotate*a,n.update(),this._descensionSegment=n,this.segments.push(n)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}};const Ytt={zoom:0,pan:0,rotate:0};let Jtt=class{get time(){return this._time}constructor(e){this._createCamera=e,this._time=0,this.definition=new Rtt(e),this.path=new Ztt}update(e,r,i){this.definition.update(e,r,i),this.path.update(this.definition,i),this._time=this._applyTimeSettings(Nfe(isFinite(this.path.time)?this.path.time:0),i),this._easing=i.easing??(this._time>=1e3?OSe:KM)}cameraAt(e,r){r=r||this._createCamera(),e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const i=this.path.interpolateComponentsAt(e,Ytt);return r.interpolate(this.definition.source,this.definition.target,i),r}_normalizedEasing(e){const r=this._easing(0,this._time),i=this._easing(1,this._time);return(this._easing(e,this._time)-r)/(i-r)}_applyTimeSettings(e,r){const i=r.speedFactor!=null?r.speedFactor:1;r.duration!=null?e=r.duration:r.speedFactor!=null&&(e=e/i);const s=r.minDuration!=null?r.minDuration:fF.minDuration/i,n=r.maxDuration!=null?r.maxDuration:fF.maxDuration/i;return Math.min(Math.max(s,e),n)}};const Qtt=O();let Ktt=class{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(e){this.currentTime=0,this._animation=new Jtt(()=>new hoe(e)),this._current=new hoe(e)}update(e,r,i){const s=this._animation.definition.source,n=this._animation.definition.target,o=de(Qtt,r.center,e.center),a=Oe(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),re(s.lookAtDirection,o),re(n.lookAtDirection,o),s.copyFromRenderCamera(e),n.copyFromRenderCamera(r),this._current.copyFrom(s),this._animation.update(s,n,i),this.currentTime=0,e.almostEquals(r)&&(this.currentTime=this._animation.time)}cameraAt(e,r){return this._animation.cameraAt(e,this._current),r=r||new gt,this._current.copyToRenderCamera(r),r}step(e,r){return this.finished||(this.currentTime=this.currentTime+Nfe(e),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,r)}};var Zi;(function(t){t.Ready="ready",t.Rejected="rejected",t.Running="running",t.Stopped="stopped",t.Finished="finished"})(Zi||(Zi={}));let Ig=class extends we{constructor(e){super(e),this.state=Zi.Ready}get active(){return this.state===Zi.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=Zi.Stopped,!0)}finishController(){this.state=Zi.Finished}get steppingFinished(){return!1}};u([d({constructOnly:!0})],Ig.prototype,"view",void 0),u([d({readOnly:!0})],Ig.prototype,"active",null),u([d()],Ig.prototype,"state",void 0),u([d({readOnly:!0})],Ig.prototype,"isInteractive",null),Ig=u([P("esri.views.3d.state.controllers.CameraController")],Ig);let qR=class extends Ig{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(kr()),this._asyncResult=null),this.state===Zi.Finished||this.state===Zi.Stopped?(R5(e),this.state===Zi.Finished?e.resolve():e.reject(kr())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=Zi.Running,this.viewAnimation!=null&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){this.viewAnimation==null||this.state!==Zi.Ready&&this.state!==Zi.Running||(this.viewAnimation.state===pE.State.FINISHED?this.finish():this.viewAnimation.state===pE.State.STOPPED&&(this.state=Zi.Stopped))}onControllerEnd(){this.viewAnimation==null||this.viewAnimation.done||(this.state===Zi.Finished?this.viewAnimation.finish():this.state===Zi.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===Zi.Finished?this._asyncResult.resolve():this._asyncResult.reject(kr()))}finish(){this.finishController()}};qR=u([P("esri.views.3d.state.controllers.AnimationController")],qR);let Bg=class extends qR{get intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.mode="interaction",this._hasTarget=!1}initialize(){this.animation=new Ktt(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new pE}get isInteractive(){return this.mode==="interaction"}begin(e,r){this._hasTarget=!0;const i=this.animationSettings(r);JI.copyFrom(this.view.state.camera);const s=qh(this.view.state.viewingMode);this.intersectionHelper.intersectRay(JI.ray,s,doe)&&(JI.center=doe),this.animation.update(JI,e,i),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(e,r){this._hasTarget&&this.animation.step(e,r)}onControllerEnd(e){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:typeof e.easing=="string"?xtt[e.easing]:e.easing}}};u([d({constructOnly:!0})],Bg.prototype,"mode",void 0),u([d({readOnly:!0})],Bg.prototype,"isInteractive",null),Bg=u([P("esri.views.3d.state.controllers.PointToPointAnimationController")],Bg);const JI=new gt,doe=O();function _U(t=trt){return[t[0],t[1],t[2],t[3]]}function WR(t,e){return ert(t[0],t[1],t[2],e,UY.get())}function ert(t,e,r,i,s=_U()){return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function GJ(t,e,r){return ht(r,t,e),ye(r,r),r[3]=z6(t,e),r}const trt=[0,0,1,0];function MSe(t,e,r){return rrt(t,t.screenToRender(e,ze.get()),r)}function rrt(t,e,r){const i=fn(ze.get(),e);if(i[2]=0,!t.unprojectFromRenderScreen(i,r.origin))return null;const s=fn(ze.get(),e);s[2]=1;const n=t.unprojectFromRenderScreen(s,ze.get());return n==null?null:(de(r.direction,n,r.origin),r)}function pC(t,e,r){return jJ(t,t.screenToRender(e,ze.get()),r)}function jJ(t,e,r){re(r.origin,t.eye);const i=se(ze.get(),e[0],e[1],1),s=t.unprojectFromRenderScreen(i,ze.get());return s==null?null:(de(r.direction,s,r.origin),r)}function HJ(t,e,r,i){const s=pC(e,r,irt);return Sv(t,s,i)}const irt=Jn();var vE;(function(t){t[t.Ellipsoid=0]="Ellipsoid",t[t.Silhouette=1]="Silhouette"})(vE||(vE={}));const PSe=30,mF=[1,3e8],vU=80,ISe=8,$Se=200,LSe=1508e5,DSe=5,NSe=50,srt=5,nrt=10,ek=90,yx={exclude:new Set([y_])};function nw(t,e,r){return r[0]=e[0]/(t.fullWidth/t.pixelRatio),r[1]=e[1]/(t.fullHeight/t.pixelRatio),r}function mq(t){for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;return t}function hv(t,e,r){const i=Au(kY.get(),r[3],r);i==null||Ove(i,un)||(de(Yr,t.eye,e),Fe(Yr,Yr,i),t.eye=ue(Yr,Yr,e),de(Yr,t.center,e),Fe(Yr,Yr,i),t.center=ue(Yr,Yr,e),t.up=Fe(Yr,t.up,i))}function ort(t,e,r,i){return px(t,MSe(e,r,XJ),i)}function gq(t,e,r,i){return px(t,pC(e,r,XJ),i)}function qJ(t,e,r,i){const s=ze.get();let n=1-r;de(s,e,t.eye);const o=Oe(s);let a=o*(1-n);n>=0&&a<i&&(a=i,n=-(a-o)/o),Math.abs(o-a)<1e-6||(ie(s,s,n),t.eye=ue(Yr,t.eye,s),t.center=Hr(Yr,t.center,e,n))}function FSe(t,e,r){e.getScreenCenter(poe),HJ(t,e,poe,Yr)&&(e.center=Yr);const i=e.distance,s=i*r;if(Math.abs(i-s)<1e-6)return;const n=ie(ze.get(),e.viewForward,s);e.eye=de(Yr,e.center,n)}const poe=Ji();function tk(t,e){se(e,0,0,0);for(const r of t)ue(e,e,r);ie(e,e,1/t.length)}function lN(t,e,r,i){return Math.sin(t/Oe(e))*(r+i.radius)}function foe(t,e,r,i){return lN(Math.PI/2,e,r,i)+(t-Math.PI/2)}var Qn;(function(t){t[t.Vertical=0]="Vertical",t[t.Horizontal=1]="Horizontal"})(Qn||(Qn={}));const moe={Elevation:3e4,Angle:Ft(16)},QI={Pole:.95,Angle:Ft(18),Tilt:45},USe=Ft(80);function kSe(t,e,r,i,s,n){const o=O(),a=bs();let l=!0,c=!0;return t.intersectScreen(r,o,n)?a[3]=Oe(o):(c=!1,e.aboveGround&&s!==vE.Ellipsoid?a[3]=Math.max(Oe(e.center),.9*i.radius):a[3]=Oe(e.eye)-e.relativeElevation,s===vE.Silhouette?XR(a,e,r,o):l=HJ(a,e,r,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function bU(t,e,r){return Oe(t.eye)-r.radius>moe.Elevation?Qn.Horizontal:(pC(t,e,Toe),-Math.sign(t.relativeElevation)*(.5*Math.PI+z6(t.eye,Toe.direction))<moe.Angle?Qn.Vertical:Qn.Horizontal)}function zSe(t,e,r){de(rk,r,e),t.eye=de(Yr,t.eye,rk),t.center=de(Yr,t.center,rk)}const rk=O();function XR(t,e,r,i){const s=pC(e,r,XJ);return s!=null&&(aC(t,s,KI),Sv(t,s,i)?!(vo(KI,s.origin)<vo(i,s.origin))||(re(i,KI),!1):(de(Xx,e.eye,e.center),ye(Xx,Xx),swe(Xx,-fe(ye(Xx,Xx),KI),goe),px(goe,s,i),!1))}const KI=O(),Xx=O(),goe=Nr();function VSe(t,e,r,i,s,n){let o=0;if(ht(_F,t,e),de(i$,t,e),Oe(t)<=s||!i.aboveGround){ht(r,i$,i.eye);const a=fe(t,e)/(Oe(t)*Oe(e));if(a<.9999)o=In(a);else{const c=Oe(ht(O(),t,e))/(Oe(t)*Oe(e));o=Fh(c)}const l=Math.cos(ve(sv.normalize(Ft(n)),0,USe));o=-o-Math.max(0,Oe(e)-s)/(l*s)}else de(yoe,i.eye,i.center),ht(r,i$,yoe),o=-Oe(i$)/s;return ye(r,r),ie(r,r,Oe(_F)),o}const yoe=O();function _oe(t,e,r,i){let s,n;const o=Math.cos(ve(sv.normalize(Ft(i)),0,USe));return s=e>r?-(e-r)/(o*r):e<-r?Math.PI-(e+r)/(o*r):In(e/r),n=t>r?-(t-r)/(o*r):t<-r?Math.PI-(t+r)/(o*r):In(t/r),(n-s)*r}function art(t,e,r,i,s,n,o,a,l,c){const h=_oe(t[2],e[2],n[3],a),p=l?_oe(t[0],e[0],n[3],180):e[0]-t[0],f=Math.sin(o)*p-Math.cos(o)*h,m=Math.cos(o)*p+Math.sin(o)*h;ye(Yr,s);const y=l?f/Math.sqrt(Math.abs(n[3]**2-fe(r,Yr)**2)):f/n[3],_=m/Math.sqrt(Math.abs(n[3]**2-fe(r,i)**2));ar(c,y,_)}function BSe(t,e,r,i,s,n,o,a,l,c){ht(_F,t,e),zj(n.up,n.eye,e$,t$,r$),zj([0,0,1],n.eye,Zg,j_,qSe),re(r,j_),re(i,Zg),ye(r,r),ie(r,r,Oe(_F)),tse(t,ye(t$,t$),ye(r$,r$),ye(e$,e$),voe),tse(e,t$,r$,e$,boe),art(voe,boe,t,Zg,j_,o,a,l,c,s)}function lrt(t,e,r,i,s,n,o){Au(gF,s,i),Au(yF,o,n),oi(HS,gF,yF),de(e,t,r),Fe(e,e,HS),ue(e,e,r)}function GSe(t,e,r,i,s,n){Au(gF,i,r),Au(yF,n,s),oi(HS,gF,yF),de(Yr,t.eye,e),Fe(Yr,Yr,HS),t.eye=ue(Yr,Yr,e),de(Yr,t.center,e),Fe(Yr,Yr,HS),t.center=ue(Yr,Yr,e),de(Yr,t.up,e),Fe(Yr,Yr,HS),t.up=ue(Yr,Yr,e)}function WJ(t,e,r,i,s,n){return(Math.abs(i)>Math.PI-QI.Angle||Math.abs(i)<QI.Angle)&&(Math.abs(t[2])<r*QI.Pole||Math.abs(e)>r)&&n.aboveGround&&s<QI.Tilt}function jSe(t,e,r,i,s,n){if(n)GJ(r,i,woe),hv(e,t,woe);else{const o=VSe(r,i,xoe,e,t[3],s);hv(e,t,WR(xoe,o))}}function HSe(t,e,r,i,s,n,o){const a=o?20:1,l=1e-12;let c,h;re(qv,i),s$.copyFrom(e);for(let p=0;p<a&&vo(r,qv)>l&&(c=vo(r,qv),BSe(r,qv,j_,Zg,XC,s$,t,s,n,o),GSe(s$,t,Zg,XC[1],j_,XC[0]),lrt(qv,qv,t,Zg,XC[1],j_,XC[0]),h=vo(r,qv),h<c||p===0);p++)e.copyFrom(s$)}function crt(t,e,r,i,s,n,o){WJ(r,fe(e.up,r),t[3],-sv.normalize(Ft(s)),n,e)?HSe(t,e,r,i,-sv.normalize(Ft(s)),n,o):jSe(t,e,r,i,n,o)}function urt(t,e,r,i,s,n){const{eye:o}=t;zj([0,0,1],o,Zg,j_,qSe);const a=e.translation[0]*r.pan,l=s.mode==="zoom"?0:e.translation[1]*r.pan,c=Math.max(Math.sqrt(Math.abs(1-fe(t.center,Zg)**2/Oe(t.center)**2)),.5),h=(Math.sin(n)*l+Math.cos(n)*a)/c,p=-Math.cos(n)*l+Math.sin(n)*a;switch(xc(i.pan.matrix,i.pan.matrix,h,Zg),i.pan.enabled=!0,s.mode){case"pan":xc(i.pan.matrix,i.pan.matrix,p,j_),i.pan.enabled=!0;break;case"zoom":i.zoom=-e.translation[1]*r.zoom}}function hrt(t,e,r,i,s){const{eye:n,viewRight:o}=t,a=ht(ze.get(),o,n),l=e.translation[0]*r.pan;switch(l!==0&&(xc(i.pan.matrix,i.pan.matrix,-l,a),i.pan.enabled=!0),s.mode){case"pan":{const c=e.translation[1]*r.pan;c!==0&&(xc(i.pan.matrix,i.pan.matrix,c,o),i.pan.enabled=!0);break}case"zoom":i.zoom=-e.translation[1]*r.zoom}}function drt(t,e,r,i,s,n,o,a,l){WJ(t.center,fe(t.up,t.center),Oe(t.center),-sv.normalize(Ft(n)),o,e)?urt(e,r,i,a,l,-sv.normalize(Ft(s))):hrt(e,r,i,a,l)}const Zg=O(),j_=O(),qSe=O(),e$=O(),t$=O(),r$=O(),voe=O(),boe=O(),XC=Ge(),woe=_U(),gF=be(),yF=be(),HS=be(),qv=O(),Yr=O(),i$=O(),s$=new gt,_F=O(),xoe=O(),XJ={origin:O(),direction:O()},Toe={origin:O(),direction:O()},Soe=.6,ik=4,prt=60;let vF=class extends Bg{constructor(){super(...arguments),this._zoomLocation=O(),this._tmpCamera=new gt,this._tmpViewDir=O(),this._tmpRayDir={origin:O(),direction:O()},this._targetOnSphere=O(),this._tmpCenter=O(),this._constraintOptions={selection:Ri.ALL_EXCEPT_COLLISION,interactionType:Zt.ZOOM,interactionFactor:null,interactionStartCamera:new gt,interactionDirection:null,tiltMode:Kn.TUMBLE},this._sphere=bs()}initialize(){this._intersector=qh(this.view.state.viewingMode)}zoomStep(e,r){if(!this.active)return;const i=this.view.state,{interactionStartCamera:s}=this._constraintOptions;s&&(this.animation.finished?s.copyFrom(i.camera):this.animation.cameraAt(1,s));let n=!1,o=!1;this.intersectionHelper.intersectScreen(r,this._zoomLocation,this.view.map.ground.opacity===0?yx:{})&&(n=e>0,o=!0),this._tmpCamera.copyFrom(i.camera),n?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:re(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,this._zoomLocation,r,o),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:KM}}_updateCamera(e,r,i,s,n){const o=zr(this.view.spatialReference),a=bU(e,s,o),l=Math.abs(this.view.camera.position.z);ye(o$,e.eye),ie(o$,o$,-1),pC(e,s,this._tmpRayDir),ye(this._tmpRayDir.direction,this._tmpRayDir.direction);const c=ve(Math.min(ISe,1/Math.abs(fe(o$,this._tmpRayDir.direction)))*l,$Se,LSe);if(a===Qn.Horizontal){let h=Soe**r;this._sphere[3]=Oe(i),de(this._tmpViewDir,e.center,e.eye);const p=Math.min(Oe(this._tmpViewDir),c);let f=p*h;if(h<=1&&f<ik&&(f=ik,h=f/p),Math.abs(p-f)<1e-6)return;const m=Oe(e.center);if(this._sphere[3]!==m){const y=this._sphere[3]+h*(m-this._sphere[3]);e.center=ie(n$,e.center,y/m)}ie(this._tmpViewDir,this._tmpViewDir,-h),e.eye=ue(n$,e.center,this._tmpViewDir),Ls(this.view,e,this._constraintOptions),vo(i,e.center)>1e-12&&HJ(this._sphere,e,s,this._targetOnSphere)&&crt(this._sphere,e,i,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let h=Soe**Math.abs(r);const p=r>0?1:-1;de(this._tmpViewDir,i,e.eye);const f=Oe(this._tmpViewDir),m=this.view._stage.renderView.getMinimalDepthForArea(null,s[0],s[1],this.view.state.camera,prt);let y=m??c;y=n&&r>0?Math.min(y,f):y,ie(this._tmpRayDir.direction,this._tmpRayDir.direction,y),ue(i,this._tmpRayDir.origin,this._tmpRayDir.direction);let _=y*h;const v=Math.max(ik,1.01*e.nearFar[0]);if(r>0&&_<v&&(_=v,h=_/y),Math.abs(y-_)<1e-6)return;ie(this._tmpRayDir.direction,this._tmpRayDir.direction,p*(1-h)),e.eye=ue(n$,e.eye,this._tmpRayDir.direction),e.center=ue(n$,e.center,this._tmpRayDir.direction)}dC(this.view,e)}};vF=u([P("esri.views.3d.state.controllers.global.ZoomStepController")],vF);const n$=O(),o$=O(),frt=.6,mrt=4,grt=60;let bF=class extends Bg{constructor(){super(...arguments),this._zoomLocation=O(),this._tmpCamera=new gt,this._tmpRayDir=O(),this._tmpCenter=O(),this._constraintOptions={selection:Ri.ALL,interactionType:Zt.ZOOM,interactionFactor:null,interactionStartCamera:new gt,interactionDirection:null,tiltMode:Kn.TUMBLE}}zoomStep(e,r){if(!this.active)return;const i=this.view.state,{interactionStartCamera:s}=this._constraintOptions;s&&(this.animation.finished?s.copyFrom(i.camera):this.animation.cameraAt(1,s)),this._tmpCamera.copyFrom(i.camera);const n=qh(this.view.state.viewingMode);let o=!1;e>0?(o=this.intersectionHelper.intersectScreenFreePointFallback(r,this._zoomLocation,this.view.map.ground.opacity===0?yx:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,n,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,n,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:re(this._zoomLocation,this._tmpCamera.center);const a=frt**e;let l=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,r[0],r[1],this.view.state.camera,grt);de(a$,this._tmpCamera.eye,this._zoomLocation),ye(a$,a$);const c=ve(Math.min(ISe,1/Math.abs(fe(yrt,a$)))*Math.abs(this.view.camera.position.z),$Se,LSe);if(l=l??c,l){const h=O();de(h,this._zoomLocation,this._tmpCamera.eye),(l<Oe(h)||!o)&&(ye(h,h),ue(this._zoomLocation,this._tmpCamera.eye,ie(h,h,l)))}this._updateCamera(this._tmpCamera,a,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:KM}}_updateCamera(e,r,i){de(this._tmpRayDir,i,e.eye);const s=Oe(this._tmpRayDir);let n=s*r;const o=r<=1,a=Math.max(mrt,1.01*e.nearFar[0]);n!==0&&(o&&n<a&&(n=a,r=n/s),Math.abs(s-n)<1e-6||(ie(this._tmpRayDir,this._tmpRayDir,r),e.eye=de(Eoe,i,this._tmpRayDir),e.center=Hr(Eoe,e.center,i,1-r),Ls(this.view,e,this._constraintOptions)))}};bF=u([P("esri.views.3d.state.controllers.local.ZoomStepController")],bF);const Eoe=O(),yrt=Me(0,0,1),a$=O();function _rt(t,e){switch(e){case"primary":return t.pointerType==="touch"||t.button===0;case"secondary":return t.pointerType!=="touch"&&t.button===2;case"tertiary":return t.pointerType!=="touch"&&t.button===1}}function ZJ(t,e){if(t.pointerType==="touch")return!1;switch(e){case"primary":return t.button===0;case"secondary":return t.button===2;case"tertiary":return t.button===1}}let vrt=class extends Co{constructor(e,r){super(!0),this._view=e,this.registerIncoming("double-click",r,i=>this._handleDoubleClick(i))}_handleDoubleClick(e){const r=e.data;if(_rt(r,"primary")){const i=this._view.state.isGlobal?new vF({view:this._view,mode:"animation"}):new bF({view:this._view,mode:"animation"});this._view.state.switchCameraController(i),i.zoomStep(Math.log(.5)/Math.log(.6),Ji(r.x,r.y)),e.stopPropagation()}}};function brt(t,e,r){return t===Ue.Global?new xrt(r):new wrt(e,r)}let wrt=class{constructor(e,r){this._elevationProvider=e,this._referenceEllipsoid=zr(r),this._unitInMeters=_a(r,this._referenceEllipsoid.metersPerDegree)}compute(e,r,i,s,n){n||(n={near:0,far:0});let o=e[2]*this._unitInMeters;const a=o,l=o-s,c=this._elevationProvider?.visibleElevationBounds;c&&(o=l>=0?a-this._unitInMeters*c.min:this._unitInMeters*c.max-a);const h={x:(i=i??new ur({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-i.xmin,y:i.ymax-i.ymin,z:4*Math.max(i.xmax-i.xmin,i.ymax-i.ymin)},p=Math.max(h.x,h.y,h.z);de(Wv,r,e),Zx[0]=Wv[0]>0?i.xmax:i.xmin,Zx[1]=Wv[1]>0?i.ymax:i.ymin,Zx[2]=Wv[2]>0?p/2:-p/2,de(Zx,Zx,e),ye(Wv,Wv);const f=1.1*fe(Zx,Wv)*this._unitInMeters,m=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),y=Math.max(i.xmax-i.xmin,i.ymax-i.ymin),_=y*Ert*this._unitInMeters,v=y*Crt*this._unitInMeters,b=ve((o-v)/(_-v),0,1)**3,T=Math.min(St(m,f,b),m)*Math.max(Math.log(Math.abs(l)),1);return WSe(Math.min(T,Math.max(34064e4,p))/this._unitInMeters,Trt,this._unitInMeters,n)}},xrt=class{constructor(e){this._referenceEllipsoid=zr(e)}compute(e,r,i,s,n){n||(n={near:0,far:0});const o=Oe(e),a=o-this._referenceEllipsoid.radius,l=this._referenceEllipsoid.radius+Math.min(0,s),c=Math.abs(a-s),h=Math.max(c,Math.abs(a)),p=Math.sqrt(h*(h+2*l)),f=o+this._referenceEllipsoid.radius;return WSe(1.2*St(p,f,lJ(h)),ve(2e4-(Math.log(h)-7.983)/9.011*19e3,1e3,2e4),1,n)}};function WSe(t,e,r,i){const s=Srt/r;return t/e>s?(i.far=t,i.near=i.far/e):(i.near=s,i.far=i.near*e),i}const Trt=2e4,Srt=2,Ert=.001,Crt=1e-4,Zx=O(),Wv=O();let cN=class extends we{constructor(e){super(e)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const r=this.view.state.camera;e.spatialReference!=null&&vSe(this.view,r,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>dC(this.view,e,Ph.EYE_AND_CENTER))}};u([d({constructOnly:!0})],cN.prototype,"view",void 0),cN=u([P("esri.views.3d.state.ElevationCollisionConstraint")],cN);let j3=class extends we{constructor(e){super(e),this.nearFarHeuristic=brt(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([ae(()=>[this.view.constraints?.clipDistance?.near,this.view.constraints?.clipDistance?.far],()=>this._clipDistanceNearFarChanged()),ae(()=>this.view.constraints?.clipDistance?.mode,()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e)),ae(()=>this.view.renderDataExtent,()=>this._updateNearFar(),qr),ae(()=>[this.view.constraints?.altitude?.min,this.view.constraints?.altitude?.max],()=>this._updateAltitude(),qr),ae(()=>this.view.constraints?.tilt?.max,()=>this._updateTiltMax(),qr),ae(()=>this.view.constraints?.tilt?.mode,()=>this._updateTilt(),qr),ae(()=>this.view.state?.camera,()=>this._updateTiltAutoMax(),qr),ae(()=>[this.view.map?.ground?.navigationConstraint?.type,this.view.state?.constraints?.collision?.enabled],()=>this._updateCollision(),qr)]),this.view.state.isLocal&&this.addHandles(ae(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),Pr)),this._updateNearFar(),this.view.state.viewingMode!==Ue.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new cN({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){const e=this.view.constraints?.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(r=>this._updateCameraNearFarManual(r,e))}_updateNearFar(){this.view.state.updateCamera(e=>this._updateCameraNearFar(e))}_updateCameraNearFar(e){const r=this.view.constraints&&this.view.constraints.clipDistance;(r?r.mode:"auto")==="manual"?this._updateCameraNearFarManual(e,r):this._updateCameraNearFarAuto(e,r)}_updateCameraNearFarAuto(e,r){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,gU(this.view,e.eye),e),r&&r.autoUpdate(e.near,e.far)}_updateCameraNearFarManual(e,r){r&&(e.near=r.near,e.far=r.far)}_updateCollision(){const e=this.view.map?.ground?.navigationConstraint?.type,r=!e||e==="stay-above",i=this.view.state.constraints.collision;if(r!==i.enabled){i.enabled=r,r&&this._reapplyConstraints(Ri.COLLISION);const s=this.view.constraints&&this.view.constraints.tilt;s&&s.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==Ue.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const r=this.view.state.constraints;r.tilt=r.createConstantMaxTilt(Ft(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const r=this.view.state.constraints;if(r.tilt){const i=r.tilt(this.view.state.camera.distance).max;e.autoUpdate(rl(i))}}_updateLocalSurfaceDistance(e){if(e==null)return;let r=Math.max(e.width,e.height);if(r<=0)return;e.zmax!=null&&e.zmin!=null&&(r=Math.max(r,e.zmax-e.zmin));const i=this.view.state,s=3*r/Math.atan(i.camera.fov/2);s!==i.constraints.distance&&(i.constraints.distance=s)}_reapplyConstraints(e=Ri.ALL){this.view.state.updateCamera(r=>Ls(this.view,r,{selection:e,interactionType:Zt.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:Kn.TUMBLE}))}};u([d({constructOnly:!0})],j3.prototype,"view",void 0),u([d({readOnly:!0})],j3.prototype,"surfaceCollisionConstraint",void 0),j3=u([P("esri.views.3d.state.ConstraintsManager")],j3);let v_=class{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}constructor(e){this.renderCoordsHelper=e,this.frustum=BR(),this._points=wTe(),this.lines=new Array(12),this._origin=O(),this._direction=O(),this._altitude=null;for(let r=0;r<12;r++)this.lines[r]={origin:null,direction:O(),endpoint:null}}update(e){xTe(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),re(this._origin,e.eye),re(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let r=0;r<this._points.length;r++)re(this._points[r],e[r]);TTe(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return D_(this.frustum,e)}intersectsRay(e){return ZJe(this.frustum,e)}intersectsLineSegment(e,r){return YJe(this.frustum,e,r)}intersectsPoint(e){return STe(this.frustum,e)}_updateLines(){const e=this._points;for(let r=0;r<4;r++){const i=r+4;sk(this.lines[r],e[r],e[i]),sk(this.lines[r+4],e[r],r===3?e[0]:e[r+1]),sk(this.lines[r+8],e[i],r===3?e[4]:e[i+1])}}};function sk(t,e,r){t.origin=e,t.endpoint=r,by(t.direction,e,r)}v_.planePointIndices=JJe,v_.nearFarLineIndices=[[Qe.NEAR_BOTTOM_LEFT,Qe.FAR_BOTTOM_LEFT],[Qe.NEAR_BOTTOM_RIGHT,Qe.FAR_BOTTOM_RIGHT],[Qe.NEAR_TOP_RIGHT,Qe.FAR_TOP_RIGHT],[Qe.NEAR_TOP_LEFT,Qe.FAR_TOP_LEFT]];let kO=class extends Ig{set desiredCamera(e){this._set("desiredCamera",e.clone())}constructor(e){super(e)}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=Zi.Running,this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this.removeAllHandles()}stepController(){}_handleElevationChangeEvent(e){(e.spatialReference==null||vSe(this.view,this.desiredCamera,e.extent,e.spatialReference))&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),dC(this.view,e,Ph.EYE_AND_CENTER)||this.constraintEnabled||(this.state=Zi.Stopped)})}};u([d({constructOnly:!0})],kO.prototype,"desiredCamera",null),kO=u([P("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],kO);const Art=O(),l$=O();function YJ(){return{direction:O(),up:O()}}function XSe(t,e,r,i,s){let n=ye(Art,t),o=fe(n,i);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(fe(e,i)),o<.99?(re(n,e),a&&ie(n,n,-1)):n=null);let l=0;if(n){ie(l$,i,fe(i,n)),de(n,n,l$);const h=fe(n,s)/(Oe(n)*Oe(s));ht(l$,n,s),l=(fe(l$,i)>0?1:-1)*rl(In(h))}const c=rl(In(-fe(i,t)/Oe(t)));return r?(r.heading=l,r.tilt=c,r):{heading:l,tilt:c}}const ZSe=Me(0,1,0),YSe=Me(0,0,1),ZC=be(),Dm=O(),Nm=O();function JSe(t,e,r,i=YJ()){const{direction:s,up:n}=i;return wve(ZC,-Ft(e)),eE(ZC,ZC,Ft(r)),Fe(s,YSe,ZC),ie(s,s,-1),Fe(n,ZSe,ZC),i}function Ort(t,e,r,i){return XSe(e,r,i,YSe,ZSe)}function Rrt(t,e,r,i){const s=JSe(t,r,i),n=O();return ie(n,s.direction,-e),ue(n,n,t),{up:s.up,eye:n,heading:r,tilt:i}}function Mrt(t){return rl(t)}function Prt(t){return Ft(t)}function QSe(t,e,r,i,s){const n=t.renderSpatialReference,o=t.map&&t.spatialReference||e.spatialReference;return So(e,Dm,n),So(e,Nm,n),Dm[0]-=r/2,Nm[0]+=r/2,Dm[1]-=i/2,Nm[1]+=i/2,Zs(Dm,n,Dm,o),Zs(Nm,n,Nm,o),s?(s.xmin=Dm[0],s.ymin=Dm[1],s.xmax=Nm[0],s.ymax=Nm[1],s.spatialReference=o):s=new ur(Dm[0],Dm[1],Nm[0],Nm[1],o),s}const Irt=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:Ort,eyeForCenterWithHeadingTilt:Rrt,eyeTiltToLookAtTilt:Prt,headingTiltToDirectionUp:JSe,lookAtTiltToEyeTilt:Mrt,toExtent:QSe},Symbol.toStringTag,{value:"Module"})),KSe=Me(0,0,1),e2e=ye(O(),Me(1,1,1)),$rt=new iv(-180,180),YC=be(),c_=O(),Yx=O();function t2e(t,e,r,i=YJ()){ht(c_,t,KSe),fe(c_,c_)===0&&ht(c_,t,e2e),Au(YC,-Ft(e),t),xc(YC,YC,-Ft(r),c_);const{up:s,direction:n}=i;return ht(s,c_,t),ye(s,s),Fe(s,s,YC),ye(n,t),pa(n,n),Fe(n,n,YC),i}function Lrt(t,e,r,i){const s=c_,n=Yx;return ye(s,t),ht(Yx,s,KSe),fe(Yx,Yx)===0&&ht(Yx,s,e2e),ht(n,Yx,s),XSe(e,r,i,s,n)}function Drt(t,e,r,i){const s={eye:O(),up:null,tilt:i,heading:r},n=c_;n[0]=t[0],n[1]=t[2],n[2]=-t[1];const o=e,a=Ft(r),l=Ft(i),c=Math.sin(a),h=Math.cos(a),p=Math.sin(l),f=Math.cos(l),m=Oe(n);let y;if(Math.abs(l)<1e-8)y=o+m;else{const J=m/p,I=Fh(o/J),z=Math.PI-l-I;y=J*Math.sin(z)}const _=f*o,v=o*o*(p*p),b=h*h*v,T=y-_,x=T*T,S=b*(b+x-n[1]*n[1]);if(S<0)return ie(s.eye,n,y/m),s.tilt=0,c$(s,t);const E=Math.sqrt(S),A=n[1]*T,R=b+x;let M;if(M=h>0?-E+A:E+A,Math.abs(R)<1e-8)return m<1e-8?(s.eye[0]=0,s.eye[1]=0,s.eye[2]=o):ie(s.eye,n,y/m),s.tilt=0,nk(s.eye),c$(s,t);s.eye[1]=M/R;const D=c*c*v,k=p*o,$=h*k*s.eye[1],N=s.eye[1]*s.eye[1],H=1-N,Z=Math.sqrt(H),G=b*N+D-2*$*Z*T+H*x;return Math.abs(G)<1e-8?(ie(s.eye,n,y/m),s.tilt=0,nk(s.eye),c$(s,t)):(s.eye[0]=(H*(y*n[0]-_*n[0])-k*Z*(n[0]*s.eye[1]*h+n[2]*c))/G,s.eye[2]=(H*(y*n[2]-_*n[2])-k*Z*(n[2]*s.eye[1]*h-n[0]*c))/G,ie(s.eye,s.eye,y),nk(s.eye),c$(s,t))}function nk(t){const e=t[1];t[1]=-t[2],t[2]=e}function c$(t,e){const r=t2e(e,t.heading,t.tilt);return t.up=r.up,t}function Nrt(t,e,r){const i=Oe(e),s=Math.sqrt(r*r+i*i-2*r*i*Math.cos(Math.PI-t)),n=Fh(r/(s/Math.sin(t)));return rl(t-n)}function Frt(t,e,r){const i=Ft(t),s=Oe(e);return Fh(r/(s/Math.sin(i)))+i}function r2e(t,e,r,i,s){let n,o,a,l;const c=e.latitude,h=zr(t.spatialReference).radius,p=e.longitude,f=HKe(c,r,h)/2;n=p-f,o=p+f;const m=Ft(c),y=(1+Math.sin(m))/(1-Math.sin(m)),_=(y+1)*Math.tan(i/h/2),v=_*_;function b(x){const S=Math.PI/2;return(x=jqe.normalize(x,-S))>S&&(x=Math.PI-x),x}if(a=1.5*Math.PI-2*Math.atan(.5*(_+Math.sqrt(4*y+v))),l=a+i/h,a=b(a),l=b(l),l<a){const x=l;l=a,a=x}if(a=Math.max(rl(a),-90),l=Math.min(rl(l),90),o=$rt.monotonic(n,o),o-n>180){const x=(o-n-180)/2;n+=x,o-=x}const T=t.spatialReference&&t.spatialReference.isGeographic?t.spatialReference:je.WGS84;return s?(s.xmin=n,s.ymin=a,s.xmax=o,s.ymax=l,s.spatialReference=T):s=new ur(n,a,o,l,T),t.spatialReference&&t.spatialReference.isWebMercator&&n2(s,!1,s),s}const Urt=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:Lrt,eyeForCenterWithHeadingTilt:Drt,eyeTiltToLookAtTilt:Frt,headingTiltToDirectionUp:t2e,lookAtTiltToEyeTilt:Nrt,toExtent:r2e},Symbol.toStringTag,{value:"Module"}));function wF(t){return t.type==="point"}let JJ=class{constructor(e,r=null,i=0){this.array=e,this.spatialReference=r,this.offset=i}};function i2e(t){return"array"in t}function kf(t,e,r="ground"){if(wF(e))return t.getElevation(e.x,e.y,e.z||0,e.spatialReference,r);if(i2e(e)){let i=e.offset;return t.getElevation(e.array[i++],e.array[i++],e.array[i]||0,e.spatialReference??t.spatialReference,r)}return t.getElevation(e[0],e[1],e[2]||0,t.spatialReference,r)}function yq(t,e){return t!=null&&(e==null||(e===Ue.Local?!t.isGeographic||t.isWGS84||t.wkid===Eh.CGCS2000:t.isWebMercator||t.isWGS84||t.wkid===Eh.CGCS2000||t.wkid===Eh.GCSMARS2000||t.wkid===Eh.GCSMARS2000_SPHERE||t.wkid===Eh.GCSMOON2000))}const s2e=Q.getLogger("esri.views.3d.support.cameraUtils"),n2e=39.37,o2e=96,_q=1,krt=8,zrt=5,a2e=1,Coe=O(),Vrt={heading:0,tilt:0},b_=new Ke,Brt=new iv(-20037508342788905e-9,20037508342788905e-9),Grt=new iv(-180,180);var qo;function eP(t){return t.spatialReference||je.WGS84}function fC(t){return t.viewingMode==="global"?Urt:Irt}function jrt(t,e,r,i,s){return fC(t).headingTiltToDirectionUp(e,r,i,s)}function Og(t,e){if(e==null)return null;const r=t.renderSpatialReference,i=fC(t).headingTiltToDirectionUp,s=O();if(!So(e.position,s,r))return null;const n=i(s,e.heading,e.tilt);ie(n.direction,n.direction,t.state.camera.distance),ue(n.direction,n.direction,s);const o=gx(t,s,n.direction,n.up);return o.fov=Ft(e.fov),o}(function(t){t[t.LOCKED=0]="LOCKED",t[t.ADJUST=1]="ADJUST"})(qo||(qo={}));const Jx=O();function bE(t,e,r){const i=t.renderSpatialReference,s=wU(t,e.eye,e.viewForward,e.up,Vrt);let n=eP(t);return Zs(e.eye,i,Jx,n)||(n=je.WGS84,Zs(e.eye,i,Jx,n)),r==null?new Gh(new Ke(Jx,n),s.heading,s.tilt,rl(e.fov)):(r.position.x=Jx[0],r.position.y=Jx[1],r.position.z=Jx[2],r.position.spatialReference=n,r.heading=s.heading,r.tilt=s.tilt,r.fov=rl(e.fov),r)}function QJ(t,e,r){const i=t.state.camera,s=i.width/2/i.pixelRatio;return t.renderCoordsHelper.viewingMode===Ue.Global&&r!=null&&(e*=Math.cos(Ft(r))),e/=t.renderCoordsHelper.unitInMeters,s/(o2e*n2e/e)/Math.tan(i.fovX/2)}function Uw(t,e,r){const i=t.state.camera,s=e*Math.tan(i.fovX/2),n=i.width/2/i.pixelRatio;let o=o2e*n2e/(n/s);return t.renderCoordsHelper.viewingMode===Ue.Global&&r!=null&&(o/=Math.cos(Ft(r))),o*t.renderCoordsHelper.unitInMeters}function l2e(t,e,r,i,s,n){return c2e(t,e,QJ(t,r,e.latitude),i,s,n)}function c2e(t,e,r,i,s,n){if(ow(n)){const a=new mC(n.signal);return ZR(t,i.heading,i.tilt,e,r,s,a),void a.resolver.promise.then(l=>{const c=TF(t,l,i.fov);if(c!=null)return n.resolver.resolve(c);n.resolver.reject()},l=>n.resolver.reject(l))}const o=ZR(t,i.heading,i.tilt,e,r,s);return TF(t,o,i.fov,n)}function wU(t,e,r,i,s){return fC(t).directionToHeadingTilt(e,r,i,s)}function Hrt(t,e){return!!(t.basemapTerrain&&t.renderCoordsHelper.fromRenderCoords(e,b_,t.spatialReference)&&t.elevationProvider&&(kf(t.elevationProvider,b_)??0)>(b_.z??0)-a2e)}async function qrt(t,e,r){if(!t.renderCoordsHelper.fromRenderCoords(e,b_,t.spatialReference)||!t.elevationProvider)return!1;const i=b_.z??0;return(await t.elevationProvider.queryElevation(b_.x,b_.y,i,b_.spatialReference,"ground",r)??0)>i-a2e}async function Wrt(t,e,r){const i=O();if(e)if(e instanceof Ke){if(So(e,i,t.renderSpatialReference),e.z==null&&t.basemapTerrain!=null&&t.elevationProvider!=null){const s=await t.elevationProvider.queryElevation(e.x,e.y,e.z??0,e.spatialReference,"ground",r);return s!=null&&t.renderCoordsHelper.setAltitude(i,s),i}}else re(i,e);else re(i,t.state.camera.center);return i}function Xrt(t,e){const r=O();if(e&&e instanceof Ke){if(So(e,r,t.renderSpatialReference),e.z==null&&t.basemapTerrain!=null&&t.elevationProvider!=null){const i=kf(t.elevationProvider,e);i!=null&&t.renderCoordsHelper.setAltitude(r,i)}}else re(r,e||t.state.camera.center);return r}function ZR(t,e,r,i,s,n,o){const a=i&&i instanceof Ke?i:null;if(ow(o))return Wrt(t,i,o.signal).then(c=>{vq(t,e,r,a,c,s,n,o)},c=>o.resolver.reject(c)),null;const l=Xrt(t,i);return vq(t,e,r,a,l,s,n,o)}function vq(t,e,r,i,s,n,o,a){if(i==null){const p=t.renderSpatialReference;if((i=dy(s,p,eP(t)))==null)return null}n=Math.max(n,t.state.constraints.minimumPoiDistance);const l=Jrt(t,e,r,s,n,o),c=(0,fC(t).eyeForCenterWithHeadingTilt)(s,n,l.heading,l.tilt);if(o===qo.ADJUST&&t.viewingMode==="global"&&r>0){const p=()=>{const m=u2e(t,s,n,Krt(t,n,r,s));return o=r-m<1?qo.LOCKED:qo.ADJUST,vq(t,e,m,i,s,n,o,a)},f=t.map.ground.navigationConstraint;if(!f||f.type==="stay-above"){if(Hrt(t,c.eye))return p();if(ow(a))return qrt(t,c.eye,a.signal).then(m=>m?p():(a.resolver.resolve({eye:c.eye,up:c.up,center:Fs(s),heading:c.heading,tilt:c.tilt}),null)),null}}const h=!a||ow(a)?{center:O(),eye:O(),up:O(),tilt:0,heading:0}:a;return h.eye=c.eye,h.up=c.up,h.center=Fs(s),h.heading=c.heading,h.tilt=c.tilt,ow(a)&&a.resolver.resolve(h),h}function zO(t,e,r,i,s,n=null){let o,a,l;if(t.state.isGlobal){if(!yq(e.spatialReference,Ue.Global))return ow(n)&&n.resolver.reject(),null;const v=new Ke(e.xmin,e.ymin,e.spatialReference),b=new Ke(e.xmax,e.ymax,e.spatialReference),T=e.spatialReference.isGeographic?Grt:Brt;o=new Ke({x:T.center(v.x,b.x),y:(b.y+v.y)/2,z:e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0,spatialReference:e.spatialReference});const x=zr(e.spatialReference),S=jKe(o,v,b);a=S.lon,l=S.lat,T.diff(v.x,b.x)>T.range/2&&(a+=x.halfCircumference),a=Math.min(a,x.halfCircumference),l=Math.min(l,x.halfCircumference)}else{const v=t.renderSpatialReference??e.spatialReference;v.equals(e.spatialReference)||(e=hx(e,v)),a=e.xmax-e.xmin,l=e.ymax-e.ymin;const b=e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0;o=new Ke({x:e.xmin+.5*a,y:e.ymin+.5*l,z:b,spatialReference:v})}const c=e.zmax!=null&&e.zmin!=null?e.zmax-e.zmin:0,h=t.state.camera,p=1/Math.tan(h.fovX/2),f=1/Math.tan(h.fovY/2),m=1/Math.tan(h.fov/2),y=Math.max(.5*a*p,.5*l*f,.5*c*m)/_q;if(ow(n)){const v=new mC(n.signal);return ZR(t,r,i,o,y,s,v),void v.resolver.promise.then(b=>{const T=TF(t,b,t.camera.fov);if(T!=null)return n.resolver.resolve(T);n.resolver.reject()},b=>n.resolver.reject(b))}const _=ZR(t,r,i,o,y,s);return TF(t,_,t.camera.fov,n)}function Zrt(t,e,r){const i=t.renderSpatialReference,s=dy(r,i,eP(t));if(s==null)return null;const n=Math.tan(e.fovX/2),o=Math.tan(e.fovY/2),a=CM(e.eye,r),l=2*a*n*_q,c=2*a*o*_q;return t.viewingMode==="global"?r2e(t,s,l,c):QSe(t,s,l,c)}function Yrt(t,e,r){const i=t.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(r/i)/Math.LN2>krt)return!0;const s=t.renderSpatialReference,n=eP(t),o=dy(e,s,n),a=dy(t.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s,n);if(o==null||a==null)return!1;const l=Math.tan(.5*t.state.camera.fov)*i;return a.distance(o)/l>zrt}function Jrt(t,e,r,i,s,n){let o=0;return n===qo.ADJUST&&Yrt(t,i,s)?(e=0,o=Qrt(t,s,r,i)):o=KJ(t,i,s,r),o=t.state.constraints.clampTilt(s,o),{heading:e,tilt:r=u2e(t,i,s,o)}}const xF=.7;function Qrt(t,e,r,i){const s=KJ(t,i,e,r);if(!t.state.constraints.tilt)return s;const n=t.state.constraints.tilt(e);n.max=Math.min(n.max,.5*Math.PI);const o=n.min*(1-xF)+n.max*xF;return Math.min(s,o)}function Krt(t,e,r,i){let s=KJ(t,i,e,r);if(!t.state.constraints.tilt)return s;const n=t.state.constraints.tilt(e);return s=Math.min(s,.5*Math.PI),n.min*(1-xF)+s*xF}function u2e(t,e,r,i){return fC(t).lookAtTiltToEyeTilt(i,e,r)}function KJ(t,e,r,i){return fC(t).eyeTiltToLookAtTilt(i,e,r)}function TF(t,e,r,i){if(e==null)return null;const s=t.renderSpatialReference,n=dy(e.eye,s,eP(t));return n==null?null:i!=null?(i.position=n,i.heading=e.heading,i.tilt=e.tilt,i.fov=r,i):new Gh(n,e.heading,e.tilt,r)}function eit(t,e){const r=t.basemapTerrain?.tilingScheme;if(r)return r.levelAtScale(e);s2e.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function h2e(t,e){const r=t.basemapTerrain?.tilingScheme;if(r)return r.scaleAtLevel(e);s2e.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function d2e(t,e){return Zs(e.center,t.renderSpatialReference,Coe,je.WGS84),Uw(t,e.distance,Coe[1])}let mC=class{constructor(e){this.signal=e,this.resolver=xo()}};function ow(t){return t&&"resolver"in t}const tit=.66;function p2e(t){return 360-GY.normalize(t)}function xU(t){return GY.normalize(360-t)}function JC(t){return t!=null&&t.resolver&&t.resolver.reject(),null}function rit(t,e){return t!=null&&t.resolver&&t.resolver.resolve(e),e}function f2e(t,e,r,i=null){if(!e)return JC(i);const s=t.spatialReference||je.WGS84;if(e.camera!=null){const c=rx(e.camera.position,s);if(c==null)return JC(i);const h=e.camera.clone();return h.position=c.clone(),rit(i,h)}if(e.targetGeometry==null)return JC(i);const n=e.get("targetGeometry.spatialReference");if(n&&!z_(n,s))return JC(i);const o=bE(t,t.state.camera);let a=qo.ADJUST;if(e.rotation!=null&&(o.heading=p2e(e.rotation),a=qo.LOCKED),r!=null&&(o.tilt=r),e.targetGeometry.type==="point"){const c=e.targetGeometry;let h;const p=e.targetGeometry.clone();return h=e.scale!=null?QJ(t,e.scale,c.latitude):t.state.camera.distance,c2e(t,p,h,o,a,i)}const l=e.targetGeometry.extent;return l?zO(t,l,o.heading,o.tilt,a,i):JC(i)}function iit(t,e,r=null){return r==null&&(r=new Sp),rQ(t,null,e.clone(),r)}async function sit(t,e,r){const i=fit(t,e);if(!i)throw new V("viewpointutils-create:no-target","Missing target for creating viewpoint");const s=new Gh({fov:t.camera.fov}),n=new Sp({camera:s});if(i.target instanceof Sp)return Xv(await ait(t,i.target,i,r,n));if(i.target instanceof Gh)return Xv(g2e(t,i.target,n));const o=i.scale!=null||i.zoom!=null;if(i.target instanceof ur){const c=i.target.xmin===i.target.xmax||i.target.ymin===i.target.ymax;return Xv(o||c?await bq(t,i,i.target.center,s,r,n):await hit(t,i,i.target,s,r,n))}const a={boundingBox:Si(),hasZ:!1,screenSpaceObjects:[]},l=o?nit(t,i):void 0;if(await m2e(t,i.target,l,a),isFinite(a.boundingBox[0])){let c;if(sp(a.boundingBox,Ps),iu.x=Ps[0],iu.y=Ps[1],iu.z=Ps[2],iu.spatialReference=t.spatialReference,isFinite(iu.z)&&a.hasZ?c=$Z(a.boundingBox):(iu.z=void 0,c=NFe(IZ(a.boundingBox,git))),o||c)return Xv(await bq(t,i,iu,s,r,n));const h=mit(t,a.screenSpaceObjects);return Xv(await pit(t,i,iu,a.boundingBox,h,s,r,n))}return i.position?Xv(cit(t,i,s,n)):Xv(await uit(t,i,s,r,n))}function eQ(t,e){return e.scale==null&&e.zoom!=null?h2e(t,e.zoom):e.scale}function nit(t,e){const r=eQ(t,e);return r?wWe(r):void 0}function tQ(t,e){let r=!1;return e.heading!=null?(t.heading=e.heading,r=!0):e.rotation!=null&&(t.heading=p2e(e.rotation),r=!0),e.tilt!=null&&(t.tilt=e.tilt,r=!0),e.fov!=null&&(t.fov=e.fov),r}function rQ(t,e,r,i){const s=t.spatialReference||je.WGS84;return(e=e??Og(t,r))==null||(i.targetGeometry=dy(e.center,t.renderSpatialReference,s),i.scale=d2e(t,e),i.rotation=xU(r.heading),i.camera=r),i}function SF(t,e,r){const i=()=>new V("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!e)throw i();if(!z_(e.spatialReference,t.spatialReference))throw new V("viewpointutils:incompatible-spatialreference",`Spatial reference (${e.spatialReference?e.spatialReference.wkid:"unknown"}) is incompatible with the view (${t.spatialReference?.wkid})`,{geometry:e});const s=[];if(!e.hasZ&&t.basemapTerrain){let a;switch(e.type){case"point":a=e;break;case"multipoint":case"polyline":a=e.extent?.center;break;case"mesh":a=e.origin;break;case"extent":a=e.center;break;case"polygon":a=e.centroid}a&&t.basemapTerrain.spatialReference!=null&&z_(a,t.basemapTerrain.spatialReference)&&t.elevationProvider?Ps[2]=kf(t.elevationProvider,a)??0:Ps[2]=0}(0,yit[e.type])(e,a=>{s.push(a[0],a[1],a[2])},Ps);const n=s.length/3;if(n===0)throw i();const o=new Array(s.length);if(li(s,e.spatialReference,0,o,t.spatialReference,0,n)){e.hasZ&&(r.hasZ=!0);for(let a=0;a<o.length;a+=3)e.hasZ?(Ps[0]=o[a],Ps[1]=o[a+1],Ps[2]=o[a+2]):(Ps[0]=o[a],Ps[1]=o[a+1]),am(r.boundingBox,Ps)}}async function oit(t,e,r,i){const s=await Eu(t.whenViewForGraphic(e));if(s.ok===!1||s.value==null||!("whenGraphicBounds"in s.value))return void SF(t,e.geometry,i);const n=s.value,o=await Eu(n.whenGraphicBounds(e,{minDemResolution:r}));if(o.ok===!1)return void SF(t,e.geometry,i);const{screenSpaceObjects:a,boundingBox:l}=o.value;Z2(i.boundingBox,l),a&&a.forEach(c=>{i.screenSpaceObjects.push(c)}),isFinite(l[2])&&(i.hasZ=!0)}async function m2e(t,e,r,i){if(Array.isArray(e)&&e.length===2){const s=e[0],n=e[1];if(typeof s=="number"&&typeof n=="number")return iu.x=s,iu.y=n,iu.z=void 0,iu.spatialReference=t.spatialReference?.isGeographic?t.spatialReference:je.WGS84,void SF(t,iu,i)}e&&"map"in e&&typeof e.map=="function"?await bc(e.map(s=>m2e(t,s,r,i))):e instanceof gv?SF(t,e,i):e instanceof Nl&&await oit(t,e,r,i)}async function ait(t,e,r,i,s){if(e.camera!=null)return g2e(t,e.camera,s);s.scale=e.scale,s.rotation=e.rotation,s.targetGeometry=e.targetGeometry!=null?e.targetGeometry.clone():null,s.camera=null,r.heading!=null?s.rotation=xU(r.heading):r.rotation!=null&&(s.rotation=r.rotation);const n=eQ(t,r);n!=null&&(s.scale=n);const o=new mC(i);return f2e(t,s,r.tilt,o),s.camera=await o.resolver.promise,s}function g2e(t,e,r){const i=t.spatialReference,s=rx(e.position,i);return s==null?null:((e=e.clone()).fov=t.camera.fov,e.position=s,rQ(t,null,e,r))}function lit(t,e,r,i,s,n){const o=t.renderSpatialReference;return So(r,h$,o),So(e,ok,o),n.targetGeometry=new Ke(e),s.position=new Ke(r),de(EF,ok,h$),wU(t,h$,EF,i.up,s),n.scale=Uw(t,fi(h$,ok),n.targetGeometry.latitude),n.rotation=xU(s.heading),n.camera=s,n}async function bq(t,e,r,i,s,n){if(r==null)throw new V("createfromcenter","invalid point");n.targetGeometry=r.clone();const o=gx(t);if(e.position)return lit(t,n.targetGeometry,e.position,o,i,n);if(e.zoomFactor){const l=o.distance/e.zoomFactor,c=ie(Ps,o.viewForward,-l);o.eye=ue(Ps,o.center,c),n.scale=Uw(t,l,r.latitude)}bE(t,o,i);const a=tQ(i,e)?qo.LOCKED:qo.ADJUST;if(!e.zoomFactor){const l=eQ(t,e);l==null?(So(r,Ps,t.renderSpatialReference),STe(o.frustum,Ps)?n.scale=Uw(t,fi(o.eye,Ps),r.latitude):n.scale=d2e(t,o)):n.scale=l;const c=new mC(s);l2e(t,n.targetGeometry,n.scale,i,a,c),n.camera=await c.resolver.promise}return n}function cit(t,e,r,i){const s=gx(t);return re(EF,s.viewForward),wU(t,s.eye,EF,s.up,ak),r.position=new Ke(e.position),r.heading=e.heading!=null?e.heading:ak.heading,r.tilt=e.tilt!=null?e.tilt:ak.tilt,rQ(t,null,r,i)}async function uit(t,e,r,i,s){const n=gx(t);return bq(t,e,dy(n.center,t.renderSpatialReference,t.spatialReference),r,i,s)}async function hit(t,e,r,i,s,n){n.targetGeometry=r.clone();const o=gx(t);bE(t,o,i);const a=tQ(i,e)?qo.LOCKED:qo.ADJUST,l=new mC(s);return zO(t,r,i.heading,i.tilt,a,l),n.camera=await l.resolver.promise,n}function dit(t,e,r,i,s){let n=0;r.z!=null?n=r.z:t.basemapTerrain&&t.elevationProvider&&(n=kf(t.elevationProvider,r)),se(Ps,r.x,r.y,n),Pl(t.spatialReference,Ps,Aoe,t.renderSpatialReference),Vh(u$,Aoe),Bh(u$,u$),Si(QC);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let y=0;y<o.length;y++){const _=o[y];let v=i[_[2]];isFinite(v)||(v=n),se(Ps,i[_[0]],i[_[1]],v),Zs(Ps,t.spatialReference,Ps,t.renderSpatialReference),am(QC,wc(Ps,Ps,u$))}const a=nx(QC),l=vv(QC),c=ox(QC),h=1/Math.tan(e.fovX/2),p=1/Math.tan(e.fovY/2),f=.5*Math.sqrt(a*a+c*c)*Math.max(p,h)+.5*l,m=.5*l*p+.5*Math.max(a,c);return Math.max(f,m)/s}async function pit(t,e,r,i,s,n,o,a){a.targetGeometry=r.clone();const l=gx(t),c=dit(t,l,r,i,s);bE(t,l,n);const h=tQ(n,e)?qo.LOCKED:qo.ADJUST;a.scale=Uw(t,c,a.targetGeometry.latitude);const p=new mC(o);return l2e(t,a.targetGeometry,a.scale,n,h,p),a.camera=await p.resolver.promise,a}function fit(t,e){if(!e||!t.spatialReference)return null;const r={target:void 0};return"declaredClass"in e||Array.isArray(e)?r.target=e:(Object.assign(r,e),e.center&&!r.target&&(r.target=e.center)),r}function Xv(t){return t&&t.camera!=null&&(t.rotation=xU(t.camera.heading)),t}function mit(t,e){const r=tit;if(!e.length)return r;let i=Number.NEGATIVE_INFINITY;for(let s=0;s<e.length;s++){const n=e[s].screenSpaceBoundingRect;i=Math.max(i,Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2]),Math.abs(n[3]))}return r-i/Math.min(t.width,t.height)*2}const Ps=O(),Aoe=be(),u$=Ui(),QC=pn(),git=Vt(),EF=O(),h$=O(),ok=O(),ak={heading:0,tilt:0},iu=new Ke,yit={point(t,e,r){r[0]=t.x,r[1]=t.y,t.z!=null&&(r[2]=t.z),e(r)},polygon(t,e,r){const i=t.hasZ;for(let s=0;s<t.rings.length;s++){const n=t.rings[s];for(let o=0;o<n.length;o++)r[0]=n[o][0],r[1]=n[o][1],i&&(r[2]=n[o][2]),e(r)}},polyline(t,e,r){const i=t.hasZ;for(let s=0;s<t.paths.length;s++){const n=t.paths[s];for(let o=0;o<n.length;o++)r[0]=n[o][0],r[1]=n[o][1],i&&(r[2]=n[o][2]),e(r)}},multipoint(t,e,r){const i=t.points,s=t.hasZ;for(let n=0;n<i.length;n++)r[0]=i[n][0],r[1]=i[n][1],s&&(r[2]=i[n][2]),e(r)},extent(t,e,r){t.zmin!=null&&t.zmax!=null?(e(se(r,t.xmin,t.ymin,t.zmin)),e(se(r,t.xmax,t.ymin,t.zmin)),e(se(r,t.xmin,t.ymax,t.zmin)),e(se(r,t.xmax,t.ymax,t.zmin)),e(se(r,t.xmin,t.ymin,t.zmax)),e(se(r,t.xmax,t.ymin,t.zmax)),e(se(r,t.xmin,t.ymax,t.zmax)),e(se(r,t.xmax,t.ymax,t.zmax))):(e(se(r,t.xmin,t.ymin,r[2])),e(se(r,t.xmax,t.ymin,r[2])),e(se(r,t.xmin,t.ymax,r[2])),e(se(r,t.xmax,t.ymax,r[2])))},mesh(t,e,r){const i=t.vertexAttributes&&t.vertexAttributes.position;if(i)for(let s=0;s<i.length;s+=3)e(se(r,i[s],i[s+1],i[s+2]))}};let _it=class{constructor(e,r,i){this.target=e,this.options=r,this.view=i,this.state="pending",this._animationController=null,this._promise=new Promise((s,n)=>{this._resolveCallback=s,this._rejectCallback=n;const o=new AbortController;this.options.signal!=null&&da(this.options.signal,()=>{this.abort()}),this._abortController=o,this.waitForReady()})}then(e,r){return this._promise.then(e,r)}catch(e){return this._promise.catch(e)}resolve(e){if(this.state!=="finished")return this.state="finished",this._resolveCallback(e)}reject(e){if(this.state!=="finished")return this.state="finished",this._rejectCallback(e)}abort(e=!1){this._abortController.abort(),this.state==="wait-for-animation-finish"&&!e&&this._animationController!=null&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController(),this.reject(kr())}async waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await ay(()=>this.view.ready,this._abortController.signal)}catch(e){return this.reject(e)}this.createViewPoint()}createViewPoint(){this.state!=="finished"&&(this.state="wait-for-viewpoint",this._animationController=this.options.animate?this._getAnimationController():null,sit(this.view,this.target,this._abortController.signal).then(e=>{if(this.state==="finished")return;const r=e?this._getCameraFromViewpoint(e):null;if(r!=null)if(this.options.animate){if(this._animationController==null)return;this.startAnimation(r,this._animationController)}else this.view.stateManager.setStateCamera(r.camera,{applyConstraints:!r.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()},e=>{this.reject(e)}))}_getCameraFromViewpoint(e){const r=!!(this.target instanceof Sp&&this.target.camera||this.target instanceof Gh),i=e.camera;if(i==null)return null;if(!this.view.stateManager.isCompatible(i)){const n=i.position,o=n&&n.spatialReference,a=o?o.wkid:"none",l=this.view.spatialReference?.wkid;return this.reject(new V("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${a}, view: ${l})`,{camera:i})),null}const s=Og(this.view,i);return s==null?(this.reject(new V("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:e,camera:s,isFullySpecified:r}}startAnimation(e,r){this.state="wait-for-animation-finish";const i=r.viewAnimation;if(i==null)return void this.reject(new V("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(i.update(e.viewpoint,"running"),!r.active||r.viewAnimation==null||r.viewAnimation.target!==e.viewpoint||this.view.state.cameraController!==r)return this.abort();let s;e.isFullySpecified?(s=new kO({view:this.view,desiredCamera:e.camera}),dC(this.view,e.camera,Ph.EYE_AND_CENTER)):Ls(this.view,e.camera),r.begin(e.camera,this.options);const n=()=>{const a=this.view.state.cameraController;s&&(a&&a.active?a instanceof Bg&&a.viewAnimation!=null&&a.viewAnimation.target===e.viewpoint&&(this.view.state.cameraController=s):r.viewAnimation!=null&&r.viewAnimation.target===e.viewpoint&&r.state==="finished"&&(this.view.state.cameraController=s))},o=a=>{if(this.view.state!=null)switch(r.state){case Zi.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case Zi.Ready:case Zi.Rejected:case Zi.Running:case Zi.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(a)}}};i.when(n,a=>o(a)),r.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let e=null,r=null;const i=this.view.state.cameraController;return i instanceof Bg&&(i.updateStateFromViewAnimation(),i.active&&(e=i,r=e.viewAnimation)),e!=null||(e=new Bg({view:this.view,mode:"animation"}),r=e.viewAnimation,this.view.state.switchCameraController(e))?e:(r?.stop(),this.reject(new V("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}},vn=class extends we{get camera(){const e=this._get("camera");if(!this.ready)return e;const r=bE(this.view,this.view.state.camera,lk);return r&&e&&r.equals(e)?e:r.clone()}set camera(e){this._updatePropertyBeforeReady("camera",e)||(this.view.elevationProvider?.enableElevationCache(!0),this.setStateCamera(Og(this.view,e),{applyConstraints:!1})||Q.getLogger(this).error("#camera=","Invalid camera",e),this.view.elevationProvider?.enableElevationCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const r=bE(this.view,this.view.state.contentCamera,lk);return r&&e&&r.equals(e)?e:r.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const r=Og(this.view,e);r!=null?(this._updateElevation(r),this.view.state.contentCamera=r):this.view.state.contentCamera=null}installContentCameraReset(e){if(this.removeHandles(ck),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const r=this.zoom,i=this.view.state.camera.distance**2,s=Wa(this.view.state.camera.center),n=e.sticky?this.contentCamera.clone():null;return this.addHandles([ae(()=>this.contentCamera,()=>{e.sticky||(this.removeHandles(ck),this.test.contentCameraResetState.clear())}),ae(()=>this.zoom,o=>{o!==void 0&&r!==void 0&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(o-r)/2),Math.abs(o-r)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n))}),ae(()=>this.view.state.camera,o=>{const a=vo(s,o.center);this.test.contentCameraResetState.set("camera.center",a/i),a>i?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n)})],ck),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():Q.getLogger(this).error("#center=","Invalid center",e):Q.getLogger(this).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e):Q.getLogger(this).error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,r=Zrt(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return r??this._get("extent")}set extent(e){this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||Q.getLogger(this).error("#extent=","Invalid extent",e):Q.getLogger(this).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e):Q.getLogger(this).error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get hasInitialView(){return!!this.view.get("map.initialViewProperties.viewpoint")}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return Uw(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||Q.getLogger(this).error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,r=e.padding,i=e.pixelRatio,s=this._get("padding"),n=Math.round(r[tr.TOP]/i),o=Math.round(r[tr.RIGHT]/i),a=Math.round(r[tr.BOTTOM]/i),l=Math.round(r[tr.LEFT]/i);return s!=null&&s.top===n&&s.right===o&&s.bottom===a&&s.left===l?s:{top:n,right:o,bottom:a,left:l}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,d$),this.view.state.updateCamera(r=>r.padding=d$))}_paddingToArray(e,r,i){e?xi(i,e.top||0,e.right||0,e.bottom||0,e.left||0):xi(i,0,0,0,0);for(let s=0;s<4;s++)i[s]=Math.round(i[s]*r)}get screenCenter(){const e=this.padding;return kh((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?iit(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||Q.getLogger(this).error("#viewpoint=","Invalid viewpoint",e);else{const r=e.camera!=null?e.camera.position:e.targetGeometry,i=r!=null&&r.spatialReference;Q.getLogger(this).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(i?i.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e)}else Q.getLogger(this).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?eit(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||e===void 0||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||Q.getLogger(this).error("#zoom=","Invalid zoom",e)}_computeCanvasSize(){if(this._devicePixelRatioOverride)return this.view.state.contentPixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*this._devicePixelRatioOverride),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*this._devicePixelRatioOverride),this._tmpCanvasSize.pixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize;const e=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio),r=this._usePhysicalPixelRendering?this._windowDevicePixelRatio:e;this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*r),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*r);const i=this.view._stage.renderView.renderingContext.parameters.maxTextureSize;return jb(this._tmpCanvasSize,i)?this._tmpCanvasSize.pixelRatio=r:this._tmpCanvasSize.pixelRatio=this._tmpCanvasSize.width>0?this._tmpCanvasSize.width/this.view.surface.clientWidth:r,this.view.state&&(this.view.state.contentPixelRatio=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)),this._tmpCanvasSize}get _rasterPixelRatio(){return this._devicePixelRatioOverride!=null?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){return this.view?._stage?.renderer.isFeatureEnabled(Xs.PhysicalPixelRendering)??!1}get _usePhysicalPixelRenderingAny(){const e=this.view?._stage?.renderer;return e&&(e.isFeatureEnabled(Xs.PhysicalPixelRendering,Fr.IDLE)||e.isFeatureEnabled(Xs.PhysicalPixelRendering,Fr.INTERACTING)||e.isFeatureEnabled(Xs.PhysicalPixelRendering,Fr.ANIMATING))}constructor(e){super(e),this.constraintsManager=null,this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._updatingIgnoreRenderState=!1,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:r=>this._devicePixelRatioOverride=r,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},set updatingIgnoreRenderState(r){this.viewStateManager._updatingIgnoreRenderState=r},get updatingIgnoreRenderState(){return this.viewStateManager._updatingIgnoreRenderState||this.renderState!=null}},this._propertiesPool=new fy({frustum:v_},this),this._cameraSetByUser=!1,this._gotoOperation=null,this._cameraChangeTime=0,this._tmpCanvasSize=new vit}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([fa(()=>this.view.state.events,"before-camera-change",e=>e&&this._updateElevation(e)),ae(()=>this.view.state?.camera,(e,r)=>this._cameraChangedHandler(e,r),qr)]),Cu(()=>this.view.state?.camera,e=>this._updateElevation(e),{once:!0,sync:!0}),this.addHandles([k2({prepare:()=>this._prepareFrame()}),ae(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0,this.removeHandles(p$)}),fa(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit(),this._propertiesPool=$e(this._propertiesPool)}init(){this.constraintsManager=new j3({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const r of e)this.set(r.name,r.value);if(!this._cameraSetByUser){const r=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent;r&&this.isCompatible(r)?this._setInitialView(r):this.view.state.viewingMode===Ue.Local&&this.addHandles(Cu(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles(p$),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),p$)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles(p$),this.constraintsManager=$e(this.constraintsManager))}async goTo(e,r){const i={animate:!0,...r};return this._gotoOperation!=null&&this._gotoOperation.abort(i.animate),this._gotoOperation=new _it(e,i,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation}debugSetCameraOnContent(){this.setStateCamera(gx(this.view),{applyConstraints:!1})}step(e){const r=this.view.state,i=r?.cameraController;i&&(r.updateCamera(s=>i.stepController(e,s)),i.steppingFinished&&i.finishController())}_cancelGoToOperation(){this._gotoOperation!=null&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const e=new Set,r=[];for(const{propertyName:i,overrides:s}of wit){const n=e.has(i),o=this._isOverridden(i);!n&&o&&r.push({name:i,value:this._get(i)}),this._clearOverride(i),(n||o)&&s.forEach(a=>e.add(a))}return r}_setInitialView(e){if(e==null||this._cameraSetByUser)return;if(e instanceof Gh)return void this.setStateCamera(Og(this.view,e),{applyConstraints:!1});if(e instanceof Sp){if(e.targetGeometry instanceof ur){const n=zO(this.view,e.targetGeometry,0,.5,qo.LOCKED);return void(n!=null&&this.setStateCamera(Og(this.view,n),{applyConstraints:!0}))}const i={applyConstraints:!e.camera},s=this._viewpointToCamera(e);return void this.setStateCamera(s,i)}const r=zO(this.view,e,0,.5,qo.LOCKED);r!=null&&this.setStateCamera(Og(this.view,r),{applyConstraints:!0})}_updatePropertyBeforeReady(e,r){return!this.ready&&(this._override(e,r),r&&bit.includes(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return e!=null&&(e instanceof Sp?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof Gh?this.isCompatible(e.position):e.spatialReference&&z_(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=xit){return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,r,i=o0){const{heading:s,tilt:n}=this._getPreservingHeadingTilt(),o=ZR(this.view,s,n,e,r,qo.ADJUST);return o==null?null:(i.copyFrom(this.view.state.camera),i.eye=o.eye,i.center=o.center,i.up=o.up,i)}_centerToCamera(e){const r=this.view.pointsOfInterest.centerOnContent;r.runTask();const i=r.distance;return this._centerPointAtDistanceToCamera(e,i)}_extentToCamera(e){const{heading:r,tilt:i}=this._getPreservingHeadingTilt(),s=zO(this.view,e,r,i,qo.ADJUST,lk);return s?Og(this.view,s):null}_scaleToCamera(e){if(e==null)return null;const r=this.view.pointsOfInterest.centerOnContent;r.runTask();const i=r.renderLocation,s=r.location.latitude;if(s==null)return null;const n=QJ(this.view,e,s);return this._centerPointAtDistanceToCamera(i,n)}_zoomToCamera(e){return this._scaleToCamera(h2e(this.view,e))}_viewpointToCamera(e){return Og(this.view,f2e(this.view,e))}setStateCamera(e,r){return!(e==null||!this.view.state.stopActiveCameraController())&&(this._cameraSetByUser=!0,r.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(i=>{r.positionAndOrientationOnly?(i.eye=e.eye,i.center=e.center,i.up=e.up):i.copyFrom(e),r.applyConstraints&&Ls(this.view,i)}),r.applyConstraints||(this.view.state.cameraController=new kO({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:r}=this.view;if(!e||!r)return;this._windowDevicePixelRatio=window.devicePixelRatio;const i=this._computeCanvasSize();if(i.width!==0&&i.height!==0&&(r.width===i.width&&r.height===i.height||(r.width=i.width,r.height=i.height),this.view.state)){const s=this.view.state.camera;s.fullWidth===i.width&&s.fullHeight===i.height&&s.pixelRatio===i.pixelRatio||(o0.copyFrom(s),o0.pixelRatio!==i.pixelRatio&&(this._paddingToArray(this.padding,i.pixelRatio,d$),o0.padding=d$),o0.fullWidth=i.width,o0.fullHeight=i.height,o0.pixelRatio=i.pixelRatio,this.view.state.camera=o0),this._updateViewState()}}_updateElevation(e){const r=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,i=this.view.renderCoordsHelper?.getAltitude(e.eye)??0,s=r?gU(this.view,e.eye):0;e.relativeElevation=i-s}_updateViewState(){this.test.renderState!=null?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=Fr.ANIMATING:this.view.interacting?this.view.state.mode=Fr.INTERACTING:(this.view.state.mode===Fr.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<=Tit?this.view.state.mode=Fr.INTERACTING:this.view.state.mode=Fr.IDLE),this.view.state.rasterPixelRatio=this._rasterPixelRatio}_cameraChangedHandler(e,r){e&&r&&e.almostEquals(r)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};u([d({type:Gh,dependsOn:["view.state.camera","ready"]})],vn.prototype,"camera",null),u([d({type:Gh,dependsOn:["view.state.contentCamera","ready"]})],vn.prototype,"contentCamera",null),u([d({type:Ke})],vn.prototype,"center",null),u([d({type:ur})],vn.prototype,"extent",null),u([d({readOnly:!0})],vn.prototype,"frustum",null),u([d({readOnly:!0})],vn.prototype,"hasInitialView",null),u([d({readOnly:!0,type:Boolean})],vn.prototype,"ready",void 0),u([d({type:Number})],vn.prototype,"scale",null),u([d()],vn.prototype,"padding",null),u([d({readOnly:!0})],vn.prototype,"screenCenter",null),u([d({constructOnly:!0})],vn.prototype,"view",void 0),u([d({type:Sp})],vn.prototype,"viewpoint",null),u([d({type:Number})],vn.prototype,"zoom",null),u([d({readOnly:!0})],vn.prototype,"_rasterPixelRatio",null),u([d({readOnly:!0})],vn.prototype,"_usePhysicalPixelRendering",null),u([d({readOnly:!0})],vn.prototype,"_usePhysicalPixelRenderingAny",null),u([d()],vn.prototype,"_windowDevicePixelRatio",void 0),u([d()],vn.prototype,"_devicePixelRatioOverride",void 0),vn=u([P("esri.views.3d.state.ViewStateManager")],vn);let vit=class{constructor(){this.width=0,this.height=0,this.pixelRatio=1}};const bit=["camera","viewpoint","extent","scale","center","zoom"],wit=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],xit={heading:0,tilt:0},lk=new Gh,o0=new gt,d$=Xt(),p$="pending-initial-view",ck="content-camera-reset",Tit=300,Ooe=100;let zf=class extends Ig{constructor(){super(...arguments),this.startCamera=new gt,this.currentCamera=new gt,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<Ooe}stepController(e,r){r.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(r)}onControllerStart(e){this.state=Zi.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout(()=>this.notifyChange("isInteractive"),Ooe),this.view.state.updateCamera(e=>this.stepController(0,e)),this.steppingFinished&&this.finishController()}};u([d({readOnly:!0})],zf.prototype,"isInteractive",null),u([d()],zf.prototype,"_lastInteraction",void 0),zf=u([P("esri.views.3d.state.controllers.InteractiveController")],zf);var uc;(function(t){t[t.CENTER=0]="CENTER",t[t.EYE=1]="EYE"})(uc||(uc={}));let VO=class extends zf{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.pivot=uc.CENTER,this._rotScale=0,this._lastPoint=Ge(),this._tmpWorldUp=O(),this._tmpViewDir=O(),this._tmpRotCurPoint=Ge(),this._tmpTransf=be(),this._tmpAxis=O(),this._tmpPivotPoint=O(),this._pivotPos=O(),this._constraintOptions={selection:Ri.ALL,interactionType:Zt.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Kn.TUMBLE}}initialize(){this._rotScale=this.pivot===uc.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case uc.EYE:re(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=Zt.LOOK_AROUND,this._constraintOptions.tiltMode=Kn.LOOK_AROUND,this._constraintOptions.selection=Ri.NONE;break;case uc.CENTER:{const r=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,this.view.map.ground.opacity===0?yx:{});r||re(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,r),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=Zt.TUMBLE,this._constraintOptions.tiltMode=Kn.TUMBLE,this._constraintOptions.selection=Ri.ALL&~Ri.DISTANCE;break}}this._constraintOptions.interactionStartCamera=this.startCamera,nw(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,r){const i=this.startCamera,s=O();de(s,this._pivotPos,i.eye);const n=Oe(s),o=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(i.eye,Roe);let a=Math.max(Math.min(srt,1/Math.abs(fe(Roe,i.viewForward)))*o,nrt);r&&(a=Math.min(n,a));const l=zr(this.view.spatialReference),c=Ji(i.width/i.pixelRatio*.5,i.height/i.pixelRatio*.5),h=bU(this.startCamera,c,l);let p=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,i.fullWidth/i.pixelRatio*.5,i.fullHeight/i.pixelRatio*.5,i,2.5*ek,ek),f=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],i,ek);p==null&&f==null||(p=p??f??0,f=f==null||h===Qn.Horizontal?p:f,a=p>f?f:p,a=r?Math.min(a,n):a),ye(s,s),re(this._pivotPos,ue(this._tmpPivotPoint,i.eye,ie(this._tmpPivotPoint,s,a)))}update(e){if(this.active){switch(this.pivot){case uc.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case uc.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}Ls(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.active&&this.finishController()}_applyRotation(e,r,i,s){this.view.renderCoordsHelper.worldUpAtPosition(s,this._tmpWorldUp),nw(e,r,this._tmpRotCurPoint);let n=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,o=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;de(this._tmpViewDir,i,s);const a=Oe(this._tmpViewDir),l=In(fe(this._tmpViewDir,this._tmpWorldUp)/a);if(this.pivot===uc.EYE){n*=-.5;const c=.5*Math.PI-l,h=.5*Math.PI*.99;n=c-Math.max(-h,Math.min(h,c+n))}return n=ve(n+l,No.min,No.max)-l,ht(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===uc.CENTER&&(o=-o),Au(this._tmpTransf,o,this._tmpWorldUp),xc(this._tmpTransf,this._tmpTransf,n,this._tmpAxis),Fe(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=Fe(uk,e.up,this._tmpTransf),ue(uk,s,this._tmpViewDir),fn(this._lastPoint,this._tmpRotCurPoint),uk}};u([d()],VO.prototype,"pivot",void 0),VO=u([P("esri.views.3d.state.controllers.RotateController")],VO);const uk=O(),Roe=O();let hk=class extends Co{constructor(e,r,i,s){super(!0),this._view=e,this.pointerAction=r,this._pivot=i,this.registerIncoming("drag",s,n=>this._handleDrag(n))}_handleDrag(e){const r=e.data;if(r.pointers.size>1||!ZJ(e.data,this.pointerAction))return;const i=Ji(r.center.x,r.center.y);switch(r.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new VO({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController&&this._cameraController.update(i);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}},wq=class extends zf{constructor(){super(...arguments),this._pickPoint=O(),this._tmpP0=Ge(),this._panAxisAngle=_U(),this._tmpRayDir=O(),this._tmpRayDirPick=O(),this._targetOnSphere=O(),this._navMode=Qn.Horizontal,this._tmpRay={origin:O(),direction:O()},this.dragBeginPoint=Ji(),this._normalizedAnchorPoint=Ge(),this._constraintOptions={selection:Ri.ALL_EXCEPT_COLLISION,interactionType:Zt.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Kn.TUMBLE},this._sphere=bs(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;fn(this.dragBeginPoint,e),nw(this.startCamera,e,this._normalizedAnchorPoint);const r=zr(this.view.spatialReference),i=kSe(this._intersectionHelper,this.startCamera,e,r,vE.Ellipsoid,this.view.map.ground.opacity===0?yx:{});if(this._navMode=bU(this.startCamera,e,r),this._navMode===Qn.Horizontal)this._hasPickPoint=!!i.scenePickPoint,this._pickPoint=i.scenePickPoint??this._pickPoint,this._sphere=i.sphere;else{let s;pC(this.startCamera,e,this._tmpRay),ye(this._tmpRay.direction,this._tmpRay.direction),i.scenePickPoint!=null&&(de(this._tmpRayDirPick,this.startCamera.eye,i.scenePickPoint),s=Oe(this._tmpRayDirPick));const n=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,Moe);let o=ve(Math.min(PSe,1/Math.abs(fe(Moe,this._tmpRay.direction)))*n,mF[0],mF[1]);const a=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,vU);o=a??o,o=s!=null?Math.min(o,s):o,this._hasPickPoint=!0,ie(this._tmpRay.direction,this._tmpRay.direction,o),ue(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===Qn.Horizontal){de(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const r=Oe(this._tmpRayDir);nw(this.currentCamera,e,this._tmpP0);const i=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let s=r*2**i;const n=this.view.state.constraints.minimumPoiDistance;if(i<0&&s<n&&(s=n),Math.abs(r-s)<1e-6)return;if(this._hasPickPoint&&s<r){const o=1-(1-s/r)*(1-this._sphere[3]/Oe(this.currentCamera.center));this.currentCamera.center=ie(f$,this.currentCamera.center,o)}ie(this._tmpRayDir,this._tmpRayDir,-s/r),this.currentCamera.eye=ue(f$,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=Yd(Iw(this.dragBeginPoint,e)),Ls(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(XR(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),GJ(this._pickPoint,this._targetOnSphere,this._panAxisAngle),hv(this.currentCamera,this._sphere,this._panAxisAngle))}else{const r=Oe(this._tmpRay.direction);nw(this.currentCamera,e,this._tmpP0);const i=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let s=r*2**i;const n=this.view.state.constraints.minimumPoiDistance;if(i<0&&s<n&&(s=n),Math.abs(r-s)<1e-6)return;ie(this._tmpRayDir,this._tmpRay.direction,1-s/r),this.currentCamera.eye=ue(f$,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=ue(f$,this.currentCamera.center,this._tmpRayDir)}dC(this.view,this.currentCamera),this.commitCamera()}}end(){this.active&&this.finishController()}};wq=u([P("esri.views.3d.state.controllers.global.ZoomController")],wq);const f$=O(),Moe=O();let xq=class extends zf{constructor(){super(...arguments),this._tmpP=O(),this._tmpDir=O(),this._tmpN=O(),this._tmpP0=Ge(),this._tmpPoi=O(),this._tmpRayDir=O(),this.dragBeginPoint=Ji(),this._normalizedAnchorPoint=Ge(),this._constraintOptions={selection:Ri.ALL,interactionType:Zt.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:O(),tiltMode:Kn.TUMBLE},this._plane=Nr()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;fn(this.dragBeginPoint,e),nw(this.startCamera,e,this._normalizedAnchorPoint);const r=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,this.view.map.ground.opacity===0?yx:{});de(this._tmpDir,this._tmpP,this.startCamera.eye);const i=Oe(this._tmpDir);ye(this._tmpDir,this._tmpDir);const s=Math.abs(this.view.camera.position.z);let n=ve(Math.min(PSe,1/Math.abs(fe(Sit,this._tmpDir)))*s,mF[0],mF[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],this.view.state.camera,vU);n=o??n,n=r?Math.min(n,i):n,ie(this._tmpDir,this._tmpDir,n),ue(this._tmpP,this.startCamera.eye,this._tmpDir),de(this._tmpN,this.startCamera.eye,this.startCamera.center),ye(this._tmpN,this._tmpN),this._tmpN[1]<0&&pa(this._tmpN,this._tmpN),qM(this._tmpP,this._tmpN,this._plane),this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(!this.active)return;ort(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||re(this._tmpPoi,this.currentCamera.center),nw(this.currentCamera,e,this._tmpP0);let r=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);fn(this._normalizedAnchorPoint,this._tmpP0),de(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const i=Oe(this._tmpRayDir);let s=i*(1-r);this._constraintOptions.interactionDirection&&(re(this._constraintOptions.interactionDirection,this._tmpRayDir),ie(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(r)/i));const n=this.view.state.constraints.minimumPoiDistance;r>=0&&s<n&&(s=n,r=-(s-i)/i),Math.abs(i-s)<1e-6||(ie(this._tmpRayDir,this._tmpRayDir,r),this.currentCamera.eye=ue(Zv,this.currentCamera.eye,this._tmpRayDir),Hr(Zv,this.currentCamera.center,this._tmpPoi,r),this._tmpPoi[2]>this.startCamera.center[2]?Zv[2]=Math.max(this.startCamera.center[2],Zv[2]):Zv[2]=Math.min(this.startCamera.center[2],Zv[2]),this.currentCamera.center=Zv,this._constraintOptions.interactionFactor=Yd(Iw(this.dragBeginPoint,e)),Ls(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}end(){this.active&&this.finishController()}};xq=u([P("esri.views.3d.state.controllers.local.ZoomController")],xq);const Zv=O(),Sit=Me(0,0,1);let Eit=class extends Co{constructor(e,r,i){super(!0),this._view=e,this.pointerAction=r,this.registerIncoming("drag",i,s=>this._handleDrag(s))}_handleDrag(e){const r=e.data;if(r.pointers.size>1||!ZJ(e.data,this.pointerAction))return;const i=Ji(r.center.x,r.center.y);switch(r.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._view.state.isGlobal?this._cameraController=new wq({view:this._view}):this._cameraController=new xq({view:this._view}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController&&this._cameraController.update(i);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}};function ad(t){let e=t*t;return t<0&&(e*=-1),e}function Poe(t,e,r){const i=r,s=t.state,n=t.device,o=e.tiltDirection==="forward-down"?1:-1,a=1;return n.deviceType==="standard"?(i.translation[0]=ad(s.axes[0]),i.translation[1]=ad(s.axes[1]),i.translation[2]=ad(s.buttons[7])-ad(s.buttons[6]),i.heading=ad(s.axes[2]),i.tilt=ad(s.axes[3])):n.deviceType==="spacemouse"&&(i.translation[0]=1.2*ad(s.axes[0]),i.translation[1]=1.2*ad(s.axes[1]),i.translation[2]=2*-ad(s.axes[2]),i.heading=1.2*ad(s.axes[5]),i.tilt=1.2*ad(s.axes[3])),i.tilt*=o,ie(i.translation,i.translation,a),i}function Ioe(t,e){const r=e;return r.translation[0]=t[1]-t[0],r.translation[1]=t[3]-t[2],r.translation[2]=t[4]-t[5],r.heading=t[7]-t[6],r.tilt=t[8]-t[9],r.zoom=t[10]-t[11],r}function dk(t){return t.translation[0]===0&&t.translation[1]===0&&t.translation[2]===0&&t.heading===0&&t.tilt===0&&t.zoom===0}let Hb=class extends zf{constructor(e){super(e),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new gt,this._headingStart=0,this._constraintOptions={selection:Ri.ALL,interactionType:Zt.NONE,interactionStartCamera:new gt,interactionFactor:0,interactionDirection:null,tiltMode:Kn.LOOK_AROUND}}handleEventGamepad(e){const r=Poe(e,this.view.navigation.gamepad,this._transformation);(e.action==="end"||dk(r))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,Ioe(this._keysButtonState,this._transformation)}deactivateDirection(e){this._keysButtonState[e]=0;const r=Ioe(this._keysButtonState,this._transformation);dk(r)&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const r=this.view.pointsOfInterest.cameraOnSurface.location.z,i=1;this._filteredSurfaceElevation+=i*(r-this._filteredSurfaceElevation)*e}stepController(e,r){this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(r),this._updateCameraCenter(),this._constraintOptions.interactionStartCamera?.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,Yv),this._applyDisabledMovementTypes(Yv),this._applyPan(Yv.pan),this._applyRotate(Yv.rotate),this._applyZoom(Yv.zoom),this._applyAscend(Yv.ascend),this._constraintOptions.interactionType=Zt.NONE,this._constraintOptions.selection=Ri.COLLISION,Ls(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,r)}_updateStartHeading(){this._transformation.heading!==0&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const r=this.currentCamera;de(ll,r.center,r.eye),Fe(ll,ll,e.matrix),r.center=ue(ll,ll,r.eye),r.up=Fe(ll,r.up,e.matrix),this._constraintOptions.interactionType=Zt.LOOK_AROUND,this._constraintOptions.selection=Ri.ALL_EXCEPT_COLLISION,Ls(this.view,r,this._constraintOptions)}_applyPan(e,r=this.currentCamera){e.enabled&&(r.eye=Fe(ll,r.eye,e.matrix),r.center=Fe(ll,r.center,e.matrix),this.view.state.isGlobal&&(r.up=Fe(ll,r.up,e.matrix)),this._constraintOptions.interactionType=Zt.PAN,this._constraintOptions.selection=Ri.ALL,Ls(this.view,r,this._constraintOptions))}_applyZoom(e){if(!e)return;const r=this.currentCamera.viewForward;this.currentCamera.eye=ue(ll,this.currentCamera.eye,ie(ze.get(),r,e)),re(KC,r),pa(KC,KC),this._constraintOptions.interactionDirection=KC,this._constraintOptions.interactionType=Zt.ZOOM,this._constraintOptions.selection=Ri.ALL_EXCEPT_COLLISION,Ls(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const r=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,ze.get());if(this._constraintOptions.interactionDirection=re(KC,r),this.view.state.isGlobal){const i=Oe(this.currentCamera.eye),s=(i+e)/i;this.currentCamera.eye=ie(ll,this.currentCamera.eye,s),this.currentCamera.center=ie(ll,this.currentCamera.center,s)}else{const i=ie(ze.get(),r,e);this.currentCamera.eye=ue(ll,this.currentCamera.eye,i),this.currentCamera.center=ue(ll,this.currentCamera.center,i)}this._updateCameraCenter(),this._constraintOptions.interactionType=Zt.ASCEND,this._constraintOptions.selection=Ri.COLLISION,Ls(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=Ri.ALL_EXCEPT_COLLISION,Ls(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,r,i){Iit(i);const s=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(s,r,i):this._calculateControlTransformationGlobal(s,r,i)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,r=this.view.renderCoordsHelper,i=this.currentCamera.ray;this.currentCamera.center=r.intersectManifoldClosestSilhouette(i,e,ll)}_calculateControlTransformationLocal(e,r,i){const{viewRight:s,viewForward:n}=r,o=this._transformation,a=this.view.navigation.gamepad,l=se(ze.get(),n[0],n[1],0);ye(l,l);const c=o.translation[0]*e.pan;if(c!==0){const _=ie(ze.get(),s,c);Fl(i.pan.matrix,i.pan.matrix,_),i.pan.enabled=!0}switch(a.mode){case"pan":{const _=-o.translation[1]*e.pan;if(_!==0){const v=ie(ze.get(),l,_);Fl(i.pan.matrix,i.pan.matrix,v),i.pan.enabled=!0}i.zoom=o.zoom*e.zoom;break}case"zoom":i.zoom=(-o.translation[1]+o.zoom)*e.zoom;break;default:a.mode}const h=o.translation[2]*e.ascend;i.ascend=h;const p=-o.heading*e.rotate;p!==0&&(xc(i.rotate.matrix,i.rotate.matrix,p,this.view.renderCoordsHelper.worldUpAtPosition(r.eye,ze.get())),i.rotate.enabled=!0);const f=o.tilt*e.rotate,m=uv(this.view.renderCoordsHelper,r.center,r.eye),y=ve(m+f,No.min,No.max)-m;y&&(xc(i.rotate.matrix,i.rotate.matrix,y,s),i.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,r,i){const{eye:s,viewRight:n}=r,o=this._transformation,a=this.view.navigation.gamepad,l=ht(ze.get(),n,s);ye(l,l),pa(l,l),drt(this.startCamera,r,o,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,i,a),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(Yv.pan,this._tmpCamera);const c=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,h=o.translation[2]*e.ascend;i.ascend=h;const p=-o.heading*e.rotate;p!==0&&(xc(i.rotate.matrix,i.rotate.matrix,p,this._tmpCamera.eye),i.rotate.enabled=!0);const f=o.tilt*e.rotate,m=this._clampTiltDeltaGlobalToValidRange(f,r.ray,c);m!==0&&(xc(i.rotate.matrix,i.rotate.matrix,m,this._tmpCamera.viewRight),i.rotate.enabled=!0),i.zoom+=o.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,r,i){const s=zr(this.view.spatialReference),n=lN(No.min,r.origin,i,s);let o=0,a=0;const l=ze.get();if(this.view.renderCoordsHelper.intersectManifold(r,i,l)){const c=uv(this.view.renderCoordsHelper,l,r.origin);o=lN(c,r.origin,i,s),a=lN(No.max,r.origin,i,s)}else{aC(V6(B6,i+s.radius),r,l);const c=Math.PI+z6(r.direction,l);o=foe(c,r.origin,i,s),a=foe(No.max,r.origin,i,s)}return ve(o+e,n,a)-o}_getPointAbsoluteSurfaceElevation(e,r,i){const{renderCoordsHelper:s}=this.view,n=s.getAltitude(e),o=r+Math.abs(n-r);return s.setAltitude(i,o,e),o}_clampedDistanceToSurface(e,r){const{renderCoordsHelper:i}=this.view,{camera:s}=this.view.state,{direction:n}=jrt(this.view,r,0,y2e,Pit),o=i.intersectManifoldClosestSilhouette(Ou(r,n),e,ze.get()),a=fi(r,o),l=i.intersectManifoldClosestSilhouette(Ou(r,by(ze.get(),r,s.center)),e,ze.get()),c=fi(r,l);return Math.min(a,c)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:r,state:i}=this.view,{camera:s,isGlobal:n}=i,o=r.intersectManifoldClosestSilhouette(s.ray,this._filteredSurfaceElevation,ze.get());if(n){const a=de(ze.get(),e,o),l=Oe(a);ie(a,a,1/l);const c=ye(ze.get(),e),h=In(fe(c,a));return l*Math.sin(Math.min(Ait,h))}{const a=re(ze.get(),e);return r.setAltitude(a,this._filteredSurfaceElevation),fi(o,a)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:Oit}_computeVelocities(e){const r=this._filteredSurfaceElevation,i=r+zr(this.view.spatialReference).radius,{camera:s,isGlobal:n}=this.view.state,o=ze.get(),a=this._getPointAbsoluteSurfaceElevation(s.eye,r,o),l=this._clampedDistanceToSurface(r,o),c=s.width/2,h=$oe*s.width,p=$oe*s.width,f=l*Math.tan(.5*s.fovX)/c,m=f/i,y=f/this._computeHeadingRotateRadius(o),_=a-r;return{pan:(n?m:f)*h*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(h*e/c)*_-_),zoom:2**(h*e/c)*l-l,rotate:ve(y*p,Rit,Mit)*e}}_applyDisabledMovementTypes(e){this.disableMovements==null||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&zh(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&zh(e.rotate.matrix))}static activatesFor(e,r){const i=Poe(r,e.navigation.gamepad,Cit);return!(r.action==="end"||dk(i))}};u([d({constructOnly:!0})],Hb.prototype,"gamepadDevice",void 0),u([d({constructOnly:!0})],Hb.prototype,"disableMovements",void 0),Hb=u([P("esri.views.3d.state.controllers.GamepadKeyboardController")],Hb);const Cit={translation:[0,0,0],heading:0,tilt:0,zoom:0},y2e=80,Ait=Ft(y2e),$oe=.75,Oit=5,Rit=Ft(30),Mit=Ft(80),Yv={zoom:0,ascend:0,pan:{enabled:!1,matrix:be()},rotate:{enabled:!1,matrix:be()}},ll=O(),KC=O(),Pit=YJ();function Iit(t){t.zoom=0,t.ascend=0,t.pan.enabled=!1,zh(t.pan.matrix),t.rotate.enabled=!1,zh(t.rotate.matrix)}let $it=class extends Co{constructor(e){super(!0),this._view=e,this._watchHandles=new Ii,this._handle=this.registerIncoming("gamepad",r=>this._handleEventGamepad(r)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([ae(()=>this._view.navigation.gamepad.enabled,r=>{r?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},Pr),ae(()=>this._view.navigation.gamepad.device,r=>{this._cameraControllerGamepad&&r&&this._cameraControllerGamepad.gamepadDevice!==r&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(e){const r=this._view.navigation.gamepad.device;if(r&&e.data.device!==r)return;const i=this._cameraControllerGamepad&&this._cameraControllerGamepad.active;if(i||Hb.activatesFor(this._view,e.data)){if(!i){const s=new Hb({view:this._view,gamepadDevice:e.data.device});this._view.state.switchCameraController(s)&&(this._cameraControllerGamepad=s)}this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===e.data.device&&this._cameraControllerGamepad.handleEventGamepad(e.data)}}};var ic;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.FORWARD=2]="FORWARD",t[t.BACKWARD=3]="BACKWARD",t[t.UP=4]="UP",t[t.DOWN=5]="DOWN",t[t.HEADINGLEFT=6]="HEADINGLEFT",t[t.HEADINGRIGHT=7]="HEADINGRIGHT",t[t.TILTUP=8]="TILTUP",t[t.TILTDOWN=9]="TILTDOWN",t[t.ZOOMIN=10]="ZOOMIN",t[t.ZOOMOUT=11]="ZOOMOUT"})(ic||(ic={}));let Lit=class extends Co{constructor(e,r){super(!0),this._view=e,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:Ue.Local},this._keyToNumber={[r.left]:ic.LEFT,[r.right]:ic.RIGHT,[r.forward]:ic.FORWARD,[r.backward]:ic.BACKWARD,[r.up]:ic.UP,[r.down]:ic.DOWN,[r.headingLeft]:ic.HEADINGLEFT,[r.headingRight]:ic.HEADINGRIGHT,[r.tiltUp]:ic.TILTUP,[r.tiltDown]:ic.TILTDOWN,[r.zoomIn]:ic.ZOOMIN,[r.zoomOut]:ic.ZOOMOUT},this.registerIncoming("key-down",null,i=>this._handleKeyDown(i)),this.registerIncoming("key-up",null,i=>this._handleKeyUp(i)),this.registerIncoming("blur",null,()=>this._handleBlur())}_handleKeyDown(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const r=this._keyToNumber[e.data.key];r!=null&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new Hb({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(r),e.stopPropagation()))}_handleBlur(){this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const r=this._keyToNumber[e.data.key];r!=null&&this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.deactivateDirection(r),e.stopPropagation())}},Dit=class extends Co{constructor(e,r){super(!0),this._view=e,this.registerIncoming("mouse-wheel",r,i=>this._handleMouseWheel(i))}_handleMouseWheel(e){if(!this._view.navigation.mouseWheelZoomEnabled)return;const r=e.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new vF({view:this._view,mode:"interaction"}):new bF({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._cameraController)),this._cameraController.zoomStep(-1/60*r.deltaY,Ji(r.x,r.y)),e.preventDefault(),e.stopPropagation()}},CF=class{constructor(e){this._gain=e}reset(e){this._value=e}set gain(e){this._gain=e}get value(){return this._value===void 0?0:this._value}update(e){this._value===void 0?this._value=e:this._value=this._gain*e+(1-this._gain)*this._value}},kw=class extends qR{constructor(){super(...arguments),this._beginCamera=new gt,this._elapsedTimeSec=0,this.constraintOptions={selection:Ri.ALL,interactionType:Zt.PAN,interactionFactor:0,interactionStartCamera:new gt,interactionDirection:null,tiltMode:Kn.TUMBLE}}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new pE}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(e){this._beginCamera.copyFrom(e),this.constraintOptions.interactionStartCamera=this._beginCamera,super.onControllerStart(e)}stepController(e,r){r.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=e,this.momentumStep(this._elapsedTimeSec,r),Ls(this.view,r,this.constraintOptions)}};kw=u([P("esri.views.3d.state.controllers.momentum.MomentumController")],kw);let BO=class extends kw{constructor(e){super(e),this.interactionType=Zt.PAN,this._tmpPan=O()}momentumStep(e,r){const i=this.momentum.value(e);ie(this._tmpPan,this.momentum.direction,i),r.eye=de(Loe,r.eye,this._tmpPan),r.center=de(Loe,r.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};u([d({constructOnly:!0})],BO.prototype,"momentum",void 0),BO=u([P("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],BO);const Loe=O(),Nit=O(),m$=O();let uN=class extends kw{constructor(e){super(e),this.interactionType=Zt.PAN}momentumStep(e,r){const i=this.momentum.value1(e),s=this.momentum.value2(e);re(m$,r.eye),ye(m$,m$),ht(this.momentum.axis2,m$,this.momentum.axis1),GSe(r,Nit,this.momentum.axis1,i,this.momentum.axis2,s)}};u([d({constructOnly:!0})],uN.prototype,"momentum",void 0),uN=u([P("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],uN);let Mb=class extends kw{set center(e){this._set("center",Fs(e))}set axis(e){this._set("axis",Fs(e))}constructor(e){super(e),this.interactionType=Zt.TUMBLE}momentumStep(e,r){const i=this.momentum.value(e);hv(r,this.center,WR(this.axis,i))}};u([d({constructOnly:!0})],Mb.prototype,"momentum",void 0),u([d({constructOnly:!0})],Mb.prototype,"center",null),u([d({constructOnly:!0})],Mb.prototype,"axis",null),Mb=u([P("esri.views.3d.state.controllers.momentum.MomentumController")],Mb);let qS=class extends kw{set zoomCenter(e){this._set("zoomCenter",Fs(e))}constructor(e){super(e),this.interactionType=Zt.ZOOM,this.constraintOptions.interactionDirection=O()}momentumStep(e,r){const{interactionDirection:i}=this.constraintOptions;if(!i)return;re(i,r.eye);const s=this.momentum.valueDelta(0,e);qJ(r,this.zoomCenter,s,this.view.state.constraints.minimumPoiDistance),by(i,r.eye,i)}};u([d({constructOnly:!0})],qS.prototype,"momentum",void 0),u([d({constructOnly:!0})],qS.prototype,"zoomCenter",null),qS=u([P("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],qS);let cb=class extends kw{set screenCenter(e){this._set("screenCenter",Ji(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",Fs(e))}constructor(e){super(e),this.interactionType=Zt.ZOOM,this.radius=0,this._tmpSceneCenter=O(),this._tmpZoomAxisAngle=_U(),this._sphere=bs()}initialize(){this._sphere[3]=this.radius}momentumStep(e,r){const i=this.momentum.valueDelta(0,e);FSe(this._sphere,r,i),this.constraintOptions.interactionType=Zt.ZOOM,Ls(this.view,r,this.constraintOptions),XR(this._sphere,r,this.screenCenter,this._tmpSceneCenter),GJ(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),hv(r,this._sphere,this._tmpZoomAxisAngle),this.constraintOptions.interactionType=Zt.PAN}};u([d({constructOnly:!0})],cb.prototype,"momentum",void 0),u([d({constructOnly:!0})],cb.prototype,"screenCenter",null),u([d({constructOnly:!0})],cb.prototype,"sceneCenter",null),u([d({constructOnly:!0})],cb.prototype,"radius",void 0),cb=u([P("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],cb);let Jd=class{constructor(e){this._gain=e,this.lastValue=void 0,this.filteredDelta=void 0}update(e){if(this.hasLastValue()){const r=this.computeDelta(e);this._updateDelta(r)}this.lastValue=e}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(e){return this.lastValue===void 0?NaN:e-this.lastValue}_updateDelta(e){this.filteredDelta!==void 0?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*e:this.filteredDelta=e}},TU=class{constructor(e,r,i){this._initialVelocity=e,this._stopVelocity=r,this._friction=i,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(e){return e>this.duration}get friction(){return this._friction}value(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}valueDelta(e,r){const i=this.value(e);return this.value(e+r)-i}valueFromInitialVelocity(e,r){r=Math.min(r,this.duration);const i=1-this.friction;return e*(i**r-1)/Math.log(i)}},Fit=class extends TU{constructor(e,r,i,s,n){super(e,r,i),this._sceneVelocity=s,this.direction=n}value(e){return super.valueFromInitialVelocity(this._sceneVelocity,e)}},_2e=class{constructor(e=300,r=12,i=.84){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this.enabled=!0,this._time=new Jd(.6),this._screen=[new Jd(.4),new Jd(.4)],this._scene=[new Jd(.6),new Jd(.6),new Jd(.6)],this._tmpDirection=O()}add(e,r,i){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(i)<.015)return;this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._scene[0].update(r[0]),this._scene[1].update(r[1]),this._scene[2].update(r[2]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,r=this._screen[1].filteredDelta,i=e==null||r==null?0:Math.sqrt(e*e+r*r),s=this._time.filteredDelta,n=s==null||i==null?0:i/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,r,i){se(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const s=Oe(this._tmpDirection);s>0&&ie(this._tmpDirection,this._tmpDirection,1/s);const n=this._time.filteredDelta;return new Fit(e,r,i,n==null?0:s/n,this._tmpDirection)}},Doe=class{constructor(e){this._gain=e}update(e){this.filteredValue!==void 0?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*e:this.filteredValue=e}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}};const Noe=1e-5;let Uit=class extends TU{constructor(e,r,i,s,n,o=0,a){super(e,r,i),this._angularVelocity1=s,this.axis1=n,this.angularVelocity2=o,this.axis2=a}value1(e){return super.valueFromInitialVelocity(this._angularVelocity1,e)}value2(e){return super.valueFromInitialVelocity(this.angularVelocity2,e)}},kit=class{constructor(e=300,r=12,i=.84){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this.enabled=!0,this._tmpAxis1=O(),this._tmpAxis2=O(),this._tmpAngles=Ge(),this._time=new Jd(.3),this._screen=[new Jd(.4),new Jd(.4)],this._angle1=new Doe(.6),this._angle2=new Doe(.6),this._axis1=O(),this._axis2=O(),this._lastScene=O()}addMomentumDirectRotation(e,r,i,s,n,o){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(i)<.01)return;let a=VSe(this._lastScene,r,this._tmpAxis2,s,n,o);this._angle2.update(0),la(this._tmpAxis2)<Noe?a=0:ye(this._axis1,this._tmpAxis2),this._angle1.update(a),re(this._lastScene,r)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(i)}}addMomentumPreserveHeading(e,r,i,s,n,o,a){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(i)<.01)return;BSe(this._lastScene,r,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,s,n,o,a,!1),la(this._tmpAxis2)<Noe?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),ye(this._axis1,this._tmpAxis1),ye(this._axis2,this._tmpAxis2)),re(this._lastScene,r)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,r=this._screen[1].filteredDelta,i=e==null||r==null?null:Math.sqrt(e*e+r*r),s=this._time.filteredDelta,n=i==null||s==null?0:i/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,r,i){const s=this._time.filteredDelta,n=this._angle1.filteredValue,o=this._angle2.filteredValue,a=s==null||o==null?0:o/s;return new Uit(e,r,i,s==null||n==null?0:n/s,this._axis1,a,this._axis2)}},v2e=class{constructor(e=2.5,r=.01,i=.95,s=12){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this._maxVelocity=s,this.enabled=!0,this.value=new Jd(.8),this.time=new Jd(.3)}add(e,r){if(this.enabled&&r!=null){if(this.time.hasLastValue()){if(this.time.computeDelta(r)<.01)return;if(this.value.hasFilteredDelta()){const i=this.value.computeDelta(e);this.value.filteredDelta*i<0&&this.value.reset()}}this.time.update(r),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=ve(e,-this._maxVelocity,this._maxVelocity),Math.abs(e)<this._minimumInitialVelocity?null:this.createMomentum(e,this._stopVelocity,this._friction)}createMomentum(e,r,i){return new TU(e,r,i)}},b2e=class extends v2e{constructor(e=3,r=.01,i=.95,s=12){super(e,r,i,s)}add(e,r){const i=this.value.lastValue;if(i!=null){let s=e-i;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;e=i+s}super.add(e,r)}},zit=class extends TU{constructor(e,r,i){super(e,r,i)}value(e){const r=super.value(e);return Math.exp(r)}valueDelta(e,r){const i=super.value(e),s=super.value(e+r)-i;return Math.exp(s)}},w2e=class extends v2e{constructor(e=2.5,r=.01,i=.95,s=12){super(e,r,i,s)}add(e,r){super.add(Math.log(e),r)}createMomentum(e,r,i){return new zit(e,r,i)}},Tq=class extends zf{constructor(){super(...arguments),this._smoothRotation=new CF(.05),this._rotationAxis=O(),this._beginAngle=0,this._beginHeading=0,this._panningPlane=Nr(),this._beginRadius=0,this._smoothScaling=new CF(.05),this._zoomCenterScreen=Ji(),this._zoomMomentumEstimator=new w2e,this._rotationMomentumEstimator=new b2e,this._panSphericalMomentumEstimator=new kit,this._panPlanarMomentumEstimator=new _2e,this._adjustedSphere=bs(),this._tmp3d=O(),this._tmpScreenPointArray=Ji(),this._beginScreenPoint=Ji(),this._beginScenePoint=O(),this._screenPickPoint=Ji(),this._scenePickPoint=O(),this._mode=Qn.Horizontal,this._sphere=bs(),this._pointerCount=0,this._tmpInteractionDirection=O(),this._constraintOptions={selection:Ri.ALL,interactionType:Zt.NONE,interactionFactor:0,interactionStartCamera:new gt,interactionDirection:null,tiltMode:Kn.TUMBLE}}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;const r=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=r,this._rotationMomentumEstimator.enabled=r,this._panPlanarMomentumEstimator.enabled=r,this._panSphericalMomentumEstimator.enabled=r,this._beginHeading=-sv.normalize(Ft(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),Pf(e.center,this._screenPickPoint),fn(this._beginScreenPoint,this._screenPickPoint);const i=zr(this.view.spatialReference),s=kSe(this._intersectionHelper,this.startCamera,this._screenPickPoint,i,vE.Silhouette,this.view.map.ground.opacity===0?yx:{});s.scenePickPoint!=null&&(this._scenePickPoint=s.scenePickPoint,this._sphere=s.sphere,re(this._beginScenePoint,this._scenePickPoint),this._mode=bU(this.startCamera,this._screenPickPoint,i),this._mode===Qn.Vertical&&this._preparePlanarPanMode(e,s.hasGeometryIntersection),this._constraintOptions.interactionStartCamera?.copyFrom(this.startCamera))}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const r=e.pointers.size>1;this._mode===Qn.Horizontal?(r&&this._zoomSpherical(e),this._panningSpherical(e),r&&this._rotateSpherical(e)):(r&&this._zoomPlanar(e),this._panningPlanar(e),r&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const r=this._zoomMomentumEstimator.evaluateMomentum();if(r)return this._mode===Qn.Horizontal?new cb({view:this.view,momentum:r,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new qS({view:this.view,momentum:r,zoomCenter:this._beginScenePoint});const i=this._rotationMomentumEstimator.evaluateMomentum();if(i)return new Mb({view:this.view,momentum:i,center:this._sphere,axis:this._rotationAxis});if(this._mode===Qn.Horizontal){const s=this._panSphericalMomentumEstimator.evaluateMomentum();if(s)return new uN({view:this.view,momentum:s})}else{const s=this._panPlanarMomentumEstimator.evaluateMomentum();if(s)return new BO({view:this.view,momentum:s})}return null}_preparePlanarPanMode(e,r){const i=pa(this._tmp3d,this.startCamera.viewForward);qM(this._scenePickPoint,i,this._panningPlane);const s=Ji(this._screenPickPoint[0],0),n=O(),o=Oe(this.startCamera.eye);this._adjustedSphere[3]=o<this._sphere[3]?o-100:this._sphere[3],XR(this._adjustedSphere,this.startCamera,s,n);const a=jo();this.startCamera.projectToRenderScreen(n,a);const l=O(),c=O(),h=O();de(l,this._scenePickPoint,this.currentCamera.eye);const p=Oe(l);ye(l,l);const f=DSe*Math.max(Math.abs(this.view.camera.position.z),NSe),m=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,vU);let y=m??f;y=r?Math.min(y,p):y,re(h,ue(c,this.currentCamera.eye,ie(c,l,y))),this._panningPlane[3]=-fe(this._panningPlane,h),this.startCamera.center=ue(c,this.startCamera.eye,ie(c,this.startCamera.viewForward,y));const _=Pf(e.center,this._tmpScreenPointArray);gq(this._panningPlane,this.startCamera,_,this._beginScenePoint)}_zoomSpherical(e){const r=this._beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=i,this._smoothScaling.update(r),FSe(this._sphere,this.currentCamera,this._smoothScaling.value),Pf(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=Zt.ZOOM,this._constraintOptions.interactionFactor=Yd(e.radius-this._beginRadius),Ls(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){const r=Pf(e.center,this._tmpScreenPointArray);XR(this._sphere,this.currentCamera,r,this._tmp3d),WJ(this._beginScenePoint,fe(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(HSe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(r,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(jSe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(r,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=Zt.PAN,this._constraintOptions.interactionFactor=Yd(Iw(this._screenPickPoint,r)),Ls(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){ye(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||pa(this._rotationAxis,this._rotationAxis);const r=this._smoothRotation.value,i=r+mq(e.angle-r),s=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=s,this._smoothRotation.update(i);const n=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(n,.001*e.timestamp),hv(this.currentCamera,this._sphere,WR(this._rotationAxis,n)),this._constraintOptions.interactionType=Zt.TUMBLE,this._constraintOptions.interactionFactor=Yd(e.radius*i),Ls(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){const r=Pf(e.center,this._tmpScreenPointArray);gq(this._panningPlane,this.currentCamera,r,this._tmp3d)&&(zSe(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(r,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=Zt.PAN,this._constraintOptions.interactionFactor=Yd(Iw(this._beginScreenPoint,r)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),Ls(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){const r=this._beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=i,this._smoothScaling.update(r),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),qJ(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=Zt.ZOOM,this._constraintOptions.interactionFactor=Yd(e.radius-this._beginRadius),Ls(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){re(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||pa(this._rotationAxis,this._rotationAxis);const r=this._smoothRotation.value;let i=e.angle-r;i=mq(i);const s=r+i,n=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=n,this._smoothRotation.update(s);const o=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(o,.001*e.timestamp),hv(this.currentCamera,this._sphere,WR(this._rotationAxis,o)),this._constraintOptions.interactionType=Zt.TUMBLE,this._constraintOptions.interactionFactor=Yd(e.radius*o),Ls(this.view,this.currentCamera,this._constraintOptions)}};Tq=u([P("esri.views.3d.state.controllers.global.PinchAndPanController")],Tq);const Foe=Me(0,0,1),Vit={ELEVATION_THRESHOLD:3e4,ANGLE_THRESHOLD:16/180*Math.PI};let Sq=class extends zf{constructor(){super(...arguments),this._rotationValueSmooth=new CF(.05),this._scalingValueSmooth=new CF(.05),this._planeHorizontal=Nr(),this._planeVertical=Nr(),this._rotationMomentumEstimator=new b2e,this._panMomentumEstimator=new _2e(300,12,.9),this._zoomMomentumEstimator=new w2e,this._beginRadius=0,this._beginCenter=O(),this._beginAngle=0,this._tmpPoints=[],this._panMode=Qn.Horizontal,this._beginCenterScreen=Ji(),this._tmpCentroid3d=O(),this._tmpCentroid2d=Ji(),this._tmp2d=Ji(),this._pointerCount=0,this._constraintOptions={selection:Ri.ALL,interactionType:Zt.NONE,interactionFactor:0,interactionStartCamera:new gt,interactionDirection:null,tiltMode:Kn.TUMBLE}}begin(e){if(!this.active)return;const r=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=r,this._rotationMomentumEstimator.enabled=r,this._panMomentumEstimator.enabled=r,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),Pf(e.center,this._beginCenterScreen),swe(Foe,0,this._planeHorizontal);const i=O(),s=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,i,this.view.map.ground.opacity===0?yx:{}),n=O();pa(n,this.startCamera.viewForward);const o=O();re(o,Foe);const a=fe(n,o),l=Fh(a<0?-a:a);this._panMode=l>=Vit.ANGLE_THRESHOLD?Qn.Horizontal:Qn.Vertical;const c=Math.min(DSe,1/Math.abs(fe(o,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),NSe);Rj(this._planeHorizontal,this._planeHorizontal,i),this.startCamera.aboveGround||Mj(this._planeHorizontal,this._planeHorizontal);const h=O(),p=O(),f=O();de(h,i,this.currentCamera.eye);const m=Oe(h);if(ye(h,h),this._panMode===Qn.Vertical){ie(o,o,a),de(this._planeVertical,n,o),ye(this._planeVertical,this._planeVertical),Rj(this._planeVertical,this._planeVertical,i);const y=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,vU);let _=y??c;_=s?Math.min(_,m):_,re(f,ue(p,this.currentCamera.eye,ie(p,h,_))),this._planeVertical[3]=-fe(this._planeVertical,f),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),tk(this._tmpPoints,this._beginCenter)}else{const y=s?m:c;re(f,ue(p,this.currentCamera.eye,ie(p,h,y))),this._planeHorizontal[3]=-fe(this._planeHorizontal,f),this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),tk(this._tmpPoints,this._beginCenter)}this._constraintOptions.interactionStartCamera?.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const r=e.pointers.size>1,i=this._panMode===Qn.Horizontal?this._planeHorizontal:this._planeVertical,s=this._beginCenter;if(r){const n=this._beginRadius/e.radius,o=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=o,this._scalingValueSmooth.update(n),qJ(this.currentCamera,s,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=Zt.ZOOM,this._constraintOptions.interactionFactor=Yd(Math.abs(e.radius-this._beginRadius)),Ls(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,i,this.currentCamera,this._tmpPoints),tk(this._tmpPoints,this._tmpCentroid3d),Pf(e.center,this._tmpCentroid2d),zSe(this.currentCamera,s,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=Zt.PAN,this._constraintOptions.interactionFactor=Yd(Iw(this._beginCenterScreen,this._tmpCentroid2d)),Ls(this.view,this.currentCamera,this._constraintOptions),r){const n=this._planeHorizontal,o=s,a=this._rotationValueSmooth.value,l=a+mq(e.angle-a),c=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=c,this._rotationValueSmooth.update(l);const h=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(h,.001*e.timestamp),hv(this.currentCamera,o,WR(n,h)),this._constraintOptions.interactionType=Zt.TUMBLE,this._constraintOptions.interactionFactor=Yd(Math.abs(e.radius*h)),Ls(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const r=this._zoomMomentumEstimator.evaluateMomentum();if(r)return new qS({view:this.view,momentum:r,zoomCenter:this._beginCenter});const i=this._rotationMomentumEstimator.evaluateMomentum();if(i)return new Mb({view:this.view,momentum:i,center:this._beginCenter,axis:this._planeHorizontal});const s=this._panMomentumEstimator.evaluateMomentum();return s?new BO({view:this.view,momentum:s}):null}_computePlanePoints(e,r,i,s){s.length=e.size;const n=this._tmp2d;let o=0;return e.forEach(a=>{n[0]=a.x,n[1]=a.y,s[o]===void 0&&(s[o]=O()),gq(r,i,n,s[o]),o+=1}),s}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};Sq=u([P("esri.views.3d.state.controllers.local.PinchAndPanController")],Sq);let Uoe=class extends Co{constructor(e,r,i){super(!0),this._view=e,this.pointerAction=r,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",i,s=>this._handleDrag(s))}_handleDrag(e){if(e.data.pointerType==="mouse"&&!ZJ(e.data,this.pointerAction))return;const r=e.timestamp-this._lastEndTimestamp,i=40,s=this._momentum&&this._momentum.active&&r<i;switch(e.data.action){case"start":case"update":if(s)break;this._controller&&this._controller.active?e.data.timestamp-this._lastTimestamp>2&&(this._controller.update(e.data),this._lastTimestamp=e.timestamp):this._startController(e);break;case"end":case"removed":this._endController(e,!0);break;case"added":this._endController(e,!1),this._startController(e)}e.stopPropagation()}_endController(e,r){if(this._controller&&this._controller.active){this._lastEndTimestamp=e.timestamp;const i=this._controller.end(e.data);r&&i&&(this._momentum=i,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(e){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(e.data),this._lastTimestamp=e.timestamp}_createController(){return this._view.state.isGlobal?new Tq({view:this._view}):new Sq({view:this._view})}},Bit=class extends Co{constructor(e,r){super(!0),this.view=e,this.registerIncoming("pointer-down",r,()=>this.view.state.stopActiveCameraController())}},x2e=class extends Co{constructor(e,r){super(!0),this.key=e,this.registerIncoming("key-down",r,i=>this._handleKeyDown(i))}_handleKeyDown(e){e.data.key===this.key&&(this.activate(),e.stopPropagation())}},Git=class extends x2e{constructor(e,r,i){super(r,i),this.view=e}activate(){this.view.goTo({heading:0}).catch(()=>{})}},jit=class extends x2e{constructor(e,r,i){super(r,i),this.view=e}activate(){this.view.goTo({tilt:0}).catch(()=>{})}},Hit=class extends Co{constructor(e,r=!1){super(!0),this._view=e,this._invert=r,this.registerIncoming("vertical-two-finger-drag",i=>this._handleTwoFinger(i))}_handleTwoFinger(e){const r=this._invert?-1:1,i=Ji(0,e.data.delta*r);switch(e.data.action){case"begin":this._cameraController?.end(),this._cameraController=new VO({view:this._view,pivot:uc.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController?.update(i);break;case"end":this._cameraController?.end(),this._cameraController=null}}};function koe(t){const e=t.native;return e?{buttons:e.buttons.map(r=>r.pressed?r.value||1:0),axes:e.axes.map(r=>Xit(r,t.axisThreshold))}:{buttons:[],axes:[]}}function qit(t,e){if(t.axes.length!==e.axes.length||t.buttons.length!==e.buttons.length)return!1;for(let r=0;r<t.axes.length;r++)if(t.axes[r]!==e.axes[r])return!1;for(let r=0;r<t.buttons.length;r++)if(t.buttons[r]!==e.buttons[r])return!1;return!0}function Wit(t){for(let e=0;e<t.axes.length;e++)if(t.axes[e]!==0)return!1;for(let e=0;e<t.buttons.length;e++)if(t.buttons[e]!==0)return!1;return!0}function Xit(t,e){const r=Math.abs(t);return r<e?0:Math.sign(t)*(r-e)/(1-e)}let Zit=class{constructor(e,r){this._element=e,this._input=r,this._hasEventListeners=!1,this._onConnectGamepad=n=>{this._connectGamepad(n.gamepad)},this._onDisconnectGamepad=n=>{const o=n.gamepad,a=o.index,l=this._inputDevices[a];l&&(this._emitGamepadEvent(o,koe(l),!1),this._inputDevices.splice(a,1),this._latestUpdate.splice(a,1),this._input.gamepad.devices.remove(l),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const i="getGamepads"in window.navigator,s=window.isSecureContext;this.supported=i&&s,this.supported&&(this._forEachGamepad(n=>this._connectGamepad(n)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const r=new sJ(e);r.deviceType!=="unknown"&&(this._inputDevices[e.index]=r,this._input.gamepad.devices.add(r)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=k2({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),r=this._element.contains(document.activeElement),i=this._input.gamepad.enabledFocusMode==="document"&&!e||this._input.gamepad.enabledFocusMode==="view"&&!r;this._forEachGamepad(s=>{const n=this._inputDevices[s.index];if(!n)return;const o=this._latestUpdate[s.index],a=koe(n),l=i||Wit(a);o&&(o.timestamp===s.timestamp||!o.active&&l||qit(o.state,a))||this._emitGamepadEvent(s,a,!l)})}_forEachGamepad(e){const r=window.navigator.getGamepads();for(let i=0;i<r.length;i++){const s=r[i];this._validate(s)&&e(s)}}_emitGamepadEvent(e,r,i){const s=this._latestUpdate[e.index],n=s&&s.active;if(!n&&!i)return;const o=!n&&i?"start":n&&i?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:r,active:i},this._callback&&this._callback({device:this._inputDevices[e.index],state:r,action:o})}_validate(e){if(!e||!e.connected)return!1;for(let r=0;r<e.axes.length;r++)if(isNaN(e.axes[r]))return!1;return!0}};const zoe=oe("edge"),Yit=oe("chrome"),Jit=oe("ff"),Qit=oe("safari"),Voe="esri-view-surface",Qx={touchNone:`${Voe}--touch-none`,touchPan:`${Voe}--touch-pan`};let T2e=class S2e{constructor(e,r){this._input=r,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new Zit(e,this._input),this._gamepadSource.onEvent=i=>this._callback("gamepad",i)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(e=>{this._releasePointerCaptureSafe(e)}),this._gamepadSource=$e(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const r in this._active)if(!e||!e.has(r)){const i=this._active[r];this._element.removeEventListener(pk[r],i),delete this._active[r]}e&&e.forEach(r=>{if(!this._active[r]&&pk[r]){const i=(this._eventHandlers[r]||this._handleDefault).bind(this,r);this._element.addEventListener(pk[r],i),this._active[r]=i}}),this._gamepadSource.hasEventListeners=e?.has("gamepad")??!1}setPointerCapture(e,r){r?this._setPointerCatpureSafe(e.pointerId):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?Qx.touchNone:Qx.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?Qx.touchPan:Qx.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(Qx.touchNone),this._element.classList.remove(Qx.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCatpureSafe(e){try{this._element.setPointerCapture(e),this._activePointerCaptures.add(e)}catch{}}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch{}}_updateNormalizedPointerLikeEvent(e,r){const i=_xe(this._element,e);return S2e.test.disableSubpixelCoordinates&&(i.x=Math.round(i.x),i.y=Math.round(i.y)),r.x=i.x,r.y=i.y,r}_handleKey(e,r){const i=aZe(r);i&&e==="key-up"&&this._keyDownState.delete(i);const s={native:r,key:i,repeat:!!i&&this._keyDownState.has(i)};i&&e==="key-down"&&this._keyDownState.add(s.key),this._callback(e,s)}_handlePointer(e,r){const i=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});this._callback(e,i)}_handlePointerPreventDefault(e,r){const i=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});r.preventDefault(),this._callback(e,i)}_handleMouseWheel(e,r){let i=r.deltaY;switch(r.deltaMode){case 0:zoe&&(i=i/document.documentElement.clientHeight*600);break;case 1:i*=30;break;case 2:i*=900}zoe?i*=.7:Yit||Qit?i*=.6:Jit&&(i*=1.375);const s=100,n=Math.abs(i);n>s&&(i=i/n*200/(1+Math.exp(-.02*(n-s))));const o=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,deltaY:i});this._callback(e,o)}_handlePointerCaptureLost(e,r){this._activePointerCaptures.delete(r.pointerId),this._handleDefault(e,r)}_handleDefault(e,r){const i={native:r};r.preventDefault(),this._callback(e,i)}_preventAltKeyDefault(e){e.key==="Alt"&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}};T2e.test={disableSubpixelCoordinates:!1};const pk={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};let Kit=class extends Co{constructor(){super(!0),this.registerIncoming("context-menu",e=>{e.data.native.preventDefault()})}};function E2e(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}function est(t,e){const r=e.x-t.x,i=e.y-t.y;return Math.sqrt(r*r+i*i)}function tst(t,e){if(e?(e.radius=0,e.center.x=0,e.center.y=0):e={radius:0,center:kh()},t.length===0)return e;if(t.length===1)return e.center.x=t[0].x,e.center.y=t[0].y,e;if(t.length===2){const[x,S]=t,[E,A]=[S.x-x.x,S.y-x.y];return e.radius=Math.sqrt(E*E+A*A)/2,e.center.x=(x.x+S.x)/2,e.center.y=(x.y+S.y)/2,e}let r=0,i=0;for(let x=0;x<t.length;x++)r+=t[x].x,i+=t[x].y;r/=t.length,i/=t.length;const s=t.map(x=>x.x-r),n=t.map(x=>x.y-i);let o=0,a=0,l=0,c=0,h=0,p=0,f=0;for(let x=0;x<s.length;x++){const S=s[x],E=n[x],A=S*S,R=E*E;o+=A,a+=R,l+=S*E,c+=A*S,h+=R*E,p+=S*R,f+=E*A}const m=.5*(c+p),y=.5*(h+f),_=o*a-l*l,v=(m*a-y*l)/_,b=(o*y-l*m)/_,T=kh(v+r,b+i);return{radius:Math.sqrt(v*v+b*b+(o+a)/t.length),center:T}}function GO(t){const{native:e}=t,{pointerId:r,button:i,pointerType:s}=e;return s==="mouse"?`${r}:${i}`:`${s}`}let rst=class extends Co{constructor(e){super(!1),this._navigationTouch=e,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,r,i,s){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:r.buttons,timestamp:s,pointers:ist(this._activePointerMap),pointer:r,angle:i.angle,radius:i.radius,center:i.center}}_addPointer(e){const r=e.native.pointerId,i=g$(this._activePointerMap).angle,s={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(r,s);const n=hN(s,C2e(this._activePointerMap));s.initialAngle=n,s.lastAngle=n,this._updatePointerAngles(i)}_updatePointer(e){if(e&&e.x==null&&e.y==null)return;const r=e.native.pointerId,i=this._activePointerMap.get(r);i?i.event=e:this._addPointer(e)}_removePointer(e){const r=g$(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(r)}_updatePointerAngles(e){const r=g$(this._activePointerMap);this._activePointerMap.forEach(i=>{i.initialAngle=hN(i,r)-e,i.lastAngle=hN(i,r)-e})}_emitEvent(e,r,i){const s=g$(this._activePointerMap);this._drag.emit(this._createPayload(e,r,s,i),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(e){const r=e.data.native.pointerId,i=e.timestamp;this._activePointerMap.get(r)&&(this._activePointerMap.size===1?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,i),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(r)):(this._removePointer(r),this._emitEvent("removed",e.data,e.timestamp)))}_handlePointerDrag(e){const r=e.data,i=r.currentEvent,s=e.timestamp;switch(r.action){case"start":case"update":this._isDragging?this._activePointerMap.has(i.native.pointerId)?(this._updatePointer(i),!this._isCurrentDragSuppressed&&this._emitEvent("update",i,s)):(this._addPointer(i),this._emitEvent("added",i,s),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(i),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",i,s))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function C2e(t){const e=[];return t.forEach(r=>{e.push(kh(r.event.x,r.event.y))}),tst(e)}function g$(t){const e=C2e(t);let r=0;return t.forEach(i=>{let s=hN(i,e),n=s-i.lastAngle;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;s=i.lastAngle+n,i.lastAngle=s;const o=s-i.initialAngle;r+=o}),r/=t.size||1,{angle:r,radius:e.radius,center:e.center}}function ist(t){const e=new Map;return t.forEach((r,i)=>e.set(i,r.event)),e}function hN(t,e){const r=t.event,i=r.x-e.center.x,s=r.y-e.center.y;return Math.atan2(s,i)}var Boe;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",t[t.Back=3]="Back",t[t.Forward=4]="Forward",t[t.Undefined=-1]="Undefined"})(Boe||(Boe={}));const N_={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};let sst=class extends Co{constructor(e=N_.maximumDoubleClickDelay,r=N_.maximumDoubleClickDistance,i=N_.maximumDoubleTouchDelay,s=N_.maximumDoubleTouchDistance,n=xM){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=r,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=Ni(e.doubleClickTimer))}get hasPendingInputs(){return ko(this._pointerState,e=>e.doubleClickTimer!=null)}_clearDoubleClickTimer(e,r){const i=this._pointerState.get(e);i&&(i.doubleClickTimer=Ni(i.doubleClickTimer),r&&this._click.emit(i.event.data,void 0,i.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const r=this._pointerState.get(e);r.pointerDownCount===1&&this._click.emit(r.event.data,void 0,r.event.modifiers),r.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_getPointerId(e){const{pointerId:r,pointerType:i,button:s}=e.native;return i==="mouse"?`${r}:${s}`:`${i}`}_handleImmediateClick(e){const r=e.data,{pointerType:i}=r.native,s=this._getPointerId(r);if(!this._pointerState.has(s))return void this._startClick(e);const n=this._pointerState.get(s),{data:o,modifiers:a}=n.event,l=i==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;E2e(o,r)>l?(this._clearDoubleClickTimer(s,!0),this._startClick(e)):(this._clearDoubleClickTimer(s,!1),n.pointerDownCount===2&&this._doubleClick.emit(o,void 0,a))}_handlePointerDown(e){const r=GO(e.data),i=this._pointerState.get(r);i&&(i.pointerDownCount+=1)}_startClick(e){const{data:r}=e,{native:{pointerType:i}}=r,s=GO(r),n=i==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(s),n),a=1;this._pointerState.set(s,{event:e,doubleClickTimer:o,pointerDownCount:a}),this.refreshHasPendingInputs()}},nst=class extends Co{constructor(e=N_.maximumDoubleClickDelay,r=N_.maximumDoubleClickDistance,i=N_.maximumDoubleTouchDelay,s=N_.maximumDoubleTouchDistance,n=xM){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=r,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(e){const r=e.data,i=GO(r);if(!this._pointerState.has(i)){const s={downButton:r.native.button,immediateDoubleClick:null};this._pointerState.set(i,s),this.startCapturingPointer(r.native)}}_handlePointerUp(e){const r=e.data,i=GO(r),s=this._pointerState.get(i);if(s&&s.downButton===r.native.button){const n=s.immediateDoubleClick;if(n){n.timeoutHandle.remove();const o=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;E2e(n,e.data)>o?this._startImmediateDoubleClick(e,s):(this._immediateDoubleClick.emit(e.data,void 0,n.modifiers),this._removeState(r))}else this._startImmediateDoubleClick(e,s)}}_startImmediateDoubleClick(e,r){const i=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;r.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(e.data),i)}}_removeState(e){const r=GO(e);this._pointerState.delete(r),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}};const eA={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};let ost=class extends Co{constructor(e=eA.maximumClickDelay,r=eA.movementUntilMouseDrag,i=eA.movementUntilPenDrag,s=eA.movementUntilTouchDrag,n=eA.holdDelay,o=xM){super(!1),this._maximumClickDelay=e,this._movementUntilMouseDrag=r,this._movementUntilPenDrag=i,this._movementUntilTouchDrag=s,this._holdDelay=n,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",a=>{this._handlePointerLoss(a,"pointer-up")}),this.registerIncoming("pointer-capture-lost",a=>{this._handlePointerLoss(a,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",a=>{this._handlePointerLoss(a,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(e=>{e.holdTimeout=Ni(e.holdTimeout)}),super.onUninstall()}_handlePointerDown(e){const r=e.data,i=r.native.pointerId;let s=null;this._pointerState.size===0&&(s=this._clock.setTimeout(()=>{const o=this._pointerState.get(i);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,e.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this._holdDelay));const n={startEvent:r,previousEvent:r,startTimestamp:e.timestamp,isDragging:!1,downButton:r.native.button,holdTimeout:s,modifiers:new Set};this._pointerState.set(i,n),this.startCapturingPointer(r.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_createPointerDragData(e,r,i){return{action:e,startEvent:r.startEvent,previousEvent:r.previousEvent,currentEvent:i}}_handlePointerMove(e){const r=e.data,i=r.native.pointerId,s=this._pointerState.get(i);s&&(s.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",s,r),void 0,s.modifiers):est(r,s.startEvent)>this._getDragThreshold(r.native.pointerType)&&this._startDragging(e),s.previousEvent=r)}_getDragThreshold(e){switch(e){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(e){const r=e.data,i=r.native.pointerId;this._pointerState.forEach(s=>{s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging||(s.modifiers=e.modifiers,s.isDragging=!0,i===s.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",s,r)):this._pointerDrag.emit(this._createPointerDragData("start",s,s.previousEvent),e.timestamp))})}_handlePointerLoss(e,r){const i=e.data,s=i.native.pointerId,n=this._pointerState.get(s);n&&(n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",n,r==="pointer-up"?i:n.previousEvent),void 0,n.modifiers):r==="pointer-up"&&n.downButton===i.native.button&&e.timestamp-n.startTimestamp<=this._maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(i),this._pointerState.delete(s),this.stopCapturingPointer(i.native),this._pointerState.size===0&&this._moveHandle.pause())}},ast=class{constructor(e){this._callbacks=e,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(e){const r=e.data,i=r.pointers.size;switch(r.action){case"start":this._currentCount=i,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=i,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=i,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}_emitStart(e){this._startEvent=e,this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.start(this._currentCount,e,this._startEvent)}_emitUpdate(e){this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.update(this._currentCount,e,this._startEvent)}_emitEnd(e){this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}},lst=class extends Co{constructor(e=20,r=40){super(!1),this._threshold=e,this._maxDelta=r,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new ast({start:(i,s)=>this._observeStart(i,s),update:(i,s,n)=>this._observeUpdate(i,s,n),end:(i,s)=>this._observeEnd(s)}),this.registerIncoming("drag",i=>this._dragEventSeparator.handle(i))}get failed(){return this._state==="failed"}_observeStart(e,r){e===1&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:r.data.button,buttons:r.data.buttons,pointerType:r.data.pointerType,timestamp:r.data.timestamp,pointers:r.data.pointers,pointer:r.data.pointer,angle:r.data.angle,radius:r.data.radius,center:r.data.center}),r.stopPropagation()),this._state=e===2?"ready":"failed"}_observeUpdate(e,r,i){if(this._state!=="failed"&&e===2)return this._state==="active"?(this._vertical.emit({delta:r.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void r.stopPropagation()):void(this._checkMovementWithinLimits(r.data,i.data)?this._checkVerticalThresholdReached(r.data,i.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=r.data.center,this._artificalDrag.emit({action:"end",button:r.data.button,buttons:r.data.buttons,pointerType:r.data.pointerType,timestamp:r.data.timestamp,pointers:r.data.pointers,pointer:r.data.pointer,angle:r.data.angle,radius:r.data.radius,center:r.data.center}),this._vertical.emit({delta:r.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),r.stopPropagation()):this._state="failed")}_observeEnd(e){this._state==="active"&&(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",e.stopPropagation())}_checkMovementWithinLimits(e,r){let i=-1/0,s=1/0,n=-1/0,o=1/0;for(const{x:_,y:v}of r.pointers.values())i=Math.max(i,_),s=Math.min(s,_),n=Math.max(n,v),o=Math.min(o,v);let a=-1/0,l=1/0,c=-1/0,h=1/0;for(const{x:_,y:v}of e.pointers.values())a=Math.max(a,_),l=Math.min(l,_),c=Math.max(c,v),h=Math.min(h,v);const p=i-s,f=n-o,m=a-l,y=c-h;return Math.abs(e.center.x-r.center.x)<this._threshold&&Math.abs(m-p)<=this._maxDelta&&Math.abs(y-f)<=this._maxDelta}_checkVerticalThresholdReached(e,r){let i=Math.abs(e.center.y-r.center.y);return e.pointers.forEach((s,n)=>{const o=r.pointers.get(n);i=Math.min(i,Math.abs(s.y-o.y))}),i>=this._threshold}},Md=class extends we{constructor(){super(...arguments),this._handles=new Ii}destroy(){this._handles=$e(this._handles),this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get updating(){return!!this._inputManager?.updating}get latestPointerType(){return this._inputManager?.latestPointerType}get latestPointerLocation(){return this._inputManager?.latestPointerLocation}get multiTouchActive(){return this._inputManager?.multiTouchActive??!1}disconnect(){this.view.viewEvents.disconnect(),this._inputManager=$e(this._inputManager)}connect(){const e=this.view;this._source=new T2e(this.view.surface,e.input);const r=[new nst,new ost,new sst,new rst(this.view.navigation),new lst],i=new rh({eventSource:this._source,recognizers:r});this._inputManager=i,i.installHandlers("prevent-context-menu",[new Kit],B_.INTERNAL),this._modeDragPan=new Uoe(e,"primary"),this._modeDragRotate=new hk(e,"secondary",uc.CENTER),this._modeDragZoom=new Eit(e,"tertiary");const s={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};i.installHandlers("navigation",[new Bit(e),new vrt(e),new $it(e),new Lit(e,s.pan),new Dit(e),new jit(e,s.resetTilt),new Git(e,s.resetHeading),new hk(e,"primary",uc.EYE,[s.lookAround]),new hk(e,"secondary",uc.CENTER,[s.lookAround]),new Uoe(e,"tertiary",[s.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new Hit(e)],B_.INTERNAL),this.view.viewEvents.connect(i),this._updateMode(),this._handles.add(ae(()=>this.view.navigation?.browserTouchPanEnabled,n=>{this._source.browserTouchPanningEnabled=!n},Pr))}_updateMode(){const e=this.mode,r=this.primaryDragAction,i=Eq.get(e)?.get(r);i&&(this._modeDragPan&&(this._modeDragPan.pointerAction=i.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=i.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=i.zoom))}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};u([d()],Md.prototype,"view",void 0),u([d({value:"pan"})],Md.prototype,"primaryDragAction",null),u([d({value:"default"})],Md.prototype,"mode",null),u([d({readOnly:!0})],Md.prototype,"updating",null),u([d()],Md.prototype,"latestPointerType",null),u([d()],Md.prototype,"latestPointerLocation",null),u([d()],Md.prototype,"multiTouchActive",null),u([d()],Md.prototype,"_inputManager",void 0),Md=u([P("esri.views.3d.input.SceneInputManager")],Md);const Eq=new Map,fk=new Map,mk=new Map;fk.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),fk.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),mk.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),mk.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),Eq.set("default",fk),Eq.set("pro",mk);const cst=Md;let Cs=class extends we{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};u([d()],Cs.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),u([d()],Cs.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),u([d()],Cs.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),u([d()],Cs.prototype,"DECONFLICTOR_SHOW_GRID",void 0),u([d()],Cs.prototype,"LABELS_SHOW_BORDER",void 0),u([d()],Cs.prototype,"TEXT_SHOW_BASELINE",void 0),u([d()],Cs.prototype,"TEXT_SHOW_BORDER",void 0),u([d()],Cs.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),u([d()],Cs.prototype,"OVERLAY_SHOW_CENTER",void 0),u([d()],Cs.prototype,"SHOW_POI",void 0),u([d()],Cs.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),u([d()],Cs.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),u([d()],Cs.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),u([d()],Cs.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),u([d()],Cs.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),u([d()],Cs.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),u([d()],Cs.prototype,"I3S_TREE_SHOW_TILES",void 0),u([d()],Cs.prototype,"I3S_SHOW_MODIFICATIONS",void 0),u([d()],Cs.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),u([d()],Cs.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),u([d()],Cs.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),u([d()],Cs.prototype,"LINE_WIREFRAMES",void 0),Cs=u([P("esri.views.3d.support.DebugFlags")],Cs);const ai=new Cs;let su,C2,Cq=!1,Aq=!1,Oq=!1,Rq=!1,jO=null;function ust(t,e){if(!Aq||!C2)return;A2e();const r=C2;let i=0;for(let s=0;s<t.accBinsNumX;s++)for(let n=0;n<t.accBinsNumY;n++){const o=t.accBins[s][t.accBinsNumY-1-n];i+=o.length;const a=s*t.accBinsSizeX,l=(s+1)*t.accBinsSizeX,c=n*t.accBinsSizeY,h=(n+1)*t.accBinsSizeY;r.fillText(o.length.toFixed(),a+5,c+15),O2e(a,l,c,h,"blue")}r.fillText("total totalShownLabels: "+i,70,40),r.fillText("total visible labels: "+e.size,70,50),r.fillText("total numTests: "+t.accNumTests,70,30)}function hst(t){Oq=ai.DECONFLICTOR_SHOW_VISIBLE,Rq=ai.DECONFLICTOR_SHOW_INVISIBLE,Cq=Oq||Rq,Aq=ai.DECONFLICTOR_SHOW_GRID,jO=null,Cq||Aq?jO=()=>dst(t):su&&(su.parentElement.removeChild(su),su=null)}function A2e(){jO&&(jO(),jO=null)}function dst(t){su==null&&(su=document.createElement("canvas"),su.setAttribute("id","debugCanvas2d"),t.surface.parentElement.style.position="relative",t.surface.parentElement.appendChild(su));const{state:e}=t,{camera:r,pixelRatio:i}=e,{width:s,height:n}=r,o=s*i,a=n*i;su.setAttribute("width",`${o}px`),su.setAttribute("height",`${a}px`),su.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${s}px;height:${n}px`),C2=su.getContext("2d"),C2.clearRect(0,0,s,n),C2.font="12px Arial"}function O2e(t,e,r,i,s){A2e();const n=su.height,o=C2;o.beginPath(),o.lineWidth=1,o.strokeStyle=s,o.moveTo(t,n-r),o.lineTo(e,n-r),o.stroke(),o.lineTo(e,n-i),o.stroke(),o.lineTo(e,n-r),o.stroke(),o.lineTo(t,n-r),o.stroke(),o.lineTo(t,n-r),o.stroke(),o.closePath()}function pst(t,e){Cq&&(e&&Oq||!e&&Rq)&&O2e(t.aabr[0],t.aabr[2],t.aabr[1],t.aabr[3],e?"green":"red")}var Bo,Yn;(function(t){t[t.USER=1]="USER",t[t.SCALE_RANGE=2]="SCALE_RANGE",t[t.FILTER=4]="FILTER",t[t.DECONFLICTION=8]="DECONFLICTION",t[t.ALL_GRAPHIC=15]="ALL_GRAPHIC",t[t.ALL_LABEL=255]="ALL_LABEL"})(Bo||(Bo={})),function(t){t[t.GRAPHIC=1]="GRAPHIC",t[t.LABEL=16]="LABEL"}(Yn||(Yn={}));function R2e(t,e){return new $2e(t,D2e,e)}function fst(t,e){const{curvatureDependent:r,scaleStart:i,scaleFallOffRange:s}=D2e;return new $2e(t,{curvatureDependent:{min:{curvature:r.min.curvature,tiltAngle:r.min.tiltAngle,scaleFallOffFactor:gk.curvatureDependent.min.scaleFallOffFactor},max:{curvature:r.max.curvature,tiltAngle:r.max.tiltAngle,scaleFallOffFactor:gk.curvatureDependent.max.scaleFallOffFactor}},scaleStart:i,scaleFallOffRange:s,minPixelSize:gk.minPixelSize},e)}function mst(t){return Math.abs(t*t*t)}function M2e(t,e,r){const i=r.parameters,s=r.paddingPixelsOverride;return tA.scale=Math.min(i.divisor/(e-i.offset),1),tA.factor=mst(t),tA.minPixelSize=i.minPixelSize,tA.paddingPixels=s,tA}function P2e(t,e){return t===0?e.minPixelSize:e.minPixelSize*(1+2*e.paddingPixels/t)}function iQ(t,e){return Math.max(St(t*e.scale,t,e.factor),P2e(t,e))}function gst(t,e,r){const i=M2e(t,e,r);return i.minPixelSize=0,i.paddingPixels=0,iQ(1,i)}function Goe(t,e,r,i){i.scale=gst(t,e,r),i.factor=0,i.minPixelSize=r.parameters.minPixelSize,i.paddingPixels=r.paddingPixelsOverride}function I2e(t,e,r=[0,0]){const i=Math.min(Math.max(e.scale,P2e(t[1],e)/Math.max(1e-5,t[1])),1);return r[0]=t[0]*i,r[1]=t[1]*i,r}function yst(t,e,r,i){return iQ(t,M2e(e,r,i))}let $2e=class L2e{get paddingPixelsOverride(){return this._paddingPixelsOverride||this.parameters.paddingPixels}constructor(e,r,i,s=_st(),n){this._viewingMode=e,this._description=r,this._ellipsoidRadius=i,this.parameters=s,this._paddingPixelsOverride=n,this._viewingMode===Ue.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(e){return(!this.parameters||this.parameters.camera.fovY!==e.fovY||this.parameters.camera.distance!==e.distance)&&(this._calculateParameters(e,this._ellipsoidRadius,this.parameters),!0)}overridePadding(e){return e!==this.paddingPixelsOverride?new L2e(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,e):this}_calculateParameters(e,r,i){const{scaleStart:s,scaleFallOffRange:n,minPixelSize:o}=this._description,{fovY:a,distance:l}=e,c=this._calculateCurvatureDependentParameters(e,r),h=this._coverageCompensation(e,r,c),{tiltAngle:p,scaleFallOffFactor:f}=c,m=Math.sin(p)*l,y=.5*Math.PI-p-a*(.5-s*h),_=m/Math.cos(y),v=y+a*n*h,b=(_-f*(m/Math.cos(v)))/(1-f);return i.camera.fovY=e.fovY,i.camera.distance=e.distance,i.offset=b,i.divisor=_-b,i.minPixelSize=o,i}_calculateCurvatureDependentParametersLocal(e,r,i=joe){return i.tiltAngle=this._description.curvatureDependent.min.tiltAngle,i.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,i}_calculateCurvatureDependentParametersGlobal(e,r,i=joe){const s=this._description.curvatureDependent,n=1+e.distance/r,o=Math.sqrt(n*n-1),[a,l]=[s.min.curvature,s.max.curvature],c=ve((o-a)/(l-a),0,1),[h,p]=[s.min,s.max];return i.tiltAngle=St(h.tiltAngle,p.tiltAngle,c),i.scaleFallOffFactor=St(h.scaleFallOffFactor,p.scaleFallOffFactor,c),i}_surfaceCoverageCompensationLocal(e,r,i){return(e.fovY-i.tiltAngle)/e.fovY}_surfaceCoverageCompensationGlobal(e,r,i){const s=r*r,n=i.tiltAngle+.5*Math.PI,{fovY:o,distance:a}=e,l=a*a+s-2*Math.cos(n)*a*r,c=Math.sqrt(l),h=Math.sqrt(l-s);return(Math.acos(h/c)-Math.asin(r/(c/Math.sin(n)))+.5*o)/o}};const D2e={curvatureDependent:{min:{curvature:Ft(10),tiltAngle:Ft(12),scaleFallOffFactor:.5},max:{curvature:Ft(70),tiltAngle:Ft(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},gk={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function _st(){return{camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}}const tA={scale:0,factor:0,minPixelSize:0,paddingPixels:0},joe={tiltAngle:0,scaleFallOffFactor:0};function vst(t){return t instanceof Float32Array&&t.length>=16}function bst(t){return Array.isArray(t)&&t.length>=16}function wst(t){return vst(t)||bst(t)}function sQ(t){t.vertex.code.add(w`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`),t.vertex.code.add(w`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),t.vertex.code.add(w`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`),t.vertex.code.add(w`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`),t.vertex.code.add(w`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),t.vertex.code.add(w`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`),t.vertex.code.add(w`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function xst(t){t.uniforms.add(new nr("screenSizePerspective",e=>N2e(e.screenSizePerspective)))}function SU(t){t.uniforms.add(new nr("screenSizePerspectiveAlignment",e=>N2e(e.screenSizePerspectiveAlignment||e.screenSizePerspective)))}function N2e(t){return xi(Tst,t.parameters.divisor,t.parameters.offset,t.parameters.minPixelSize,t.paddingPixelsOverride)}const Tst=Xt();var Li,xh,HO,ns,on;(function(t){t[t.INNER=0]="INNER",t[t.OUTER=1]="OUTER"})(Li||(Li={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",t[t.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",t[t.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(xh||(xh={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(HO||(HO={})),function(t){t[t.Color=0]="Color",t[t.ColorNoRasterImage=1]="ColorNoRasterImage",t[t.Highlight=2]="Highlight",t[t.Water=3]="Water",t[t.Occluded=4]="Occluded",t[t.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"}(ns||(ns={})),function(t){t[t.FADING=0]="FADING",t[t.IMMEDIATE=1]="IMMEDIATE",t[t.UNFADED=2]="UNFADED"}(on||(on={}));let Sst=class{constructor(e,r){this.vec3=e,this.id=r}};function AF(t,e,r,i){return new Sst(Me(t,e,r),i)}var Ha;(function(t){t[t.None=0]="None",t[t.ColorAndWater=1]="ColorAndWater",t[t.Highlight=2]="Highlight",t[t.Occluded=3]="Occluded",t[t.ObjectAndLayerIdColor=4]="ObjectAndLayerIdColor"})(Ha||(Ha={}));const nQ=1.3;let Hoe=class{get extent(){return this._extent}constructor(e,r){this.index=e,this.renderTargets=r,this._extent=Vt(),this.resolution=0,this.renderLocalOrigin=AF(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new Est,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=e,this.validTargets=new Array(r.renderTargets.length).fill(!1)}getValidTexture(e){return this.validTargets[e]?this.renderTargets.getTarget(e).getTexture():null}get _needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(e){const r=e===Ha.ColorAndWater?this.renderTargets.getTarget(ns.Color):e===Ha.Highlight?this.renderTargets.getTarget(ns.Highlight):e===Ha.ObjectAndLayerIdColor?this.renderTargets.getTarget(ns.ObjectAndLayerIdColor):this.renderTargets.getTarget(ns.Occluded);return r?r.getTexture():null}getColorTextureNoRasterImage(){return this._needsColorWithoutRasterImage?this.getValidTexture(ns.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(ns.Color):null}getNormalTexture(e){const r=e===Ha.ColorAndWater?this.renderTargets.getTarget(ns.Water):null;return r?r.getTexture():null}draw(e,r){const i=this.computeRenderTargetValidityBitfield();for(const s of this.renderTargets.renderTargets)s.type!==ns.ColorNoRasterImage||this._needsColorWithoutRasterImage?this.validTargets[s.type]=e.drawTarget(this,s,r):this.validTargets[s.type]=!1;return i^this.computeRenderTargetValidityBitfield()?mE.CHANGED:mE.UNCHANGED}computeRenderTargetValidityBitfield(){const e=this.validTargets;return+e[ns.Color]|+e[ns.ColorNoRasterImage]<<1|+e[ns.Highlight]<<2|+e[ns.Water]<<3|+e[ns.Occluded]<<4}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const r=.001*e.range;if(this._extent[0]-r<=e.min){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];b4(this._extent,e.range,0,i)}if(this._extent[2]+r>=e.max){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];b4(this._extent,-e.range,0,i)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,oy(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const r=this.canvasGeometries.extents[e];if(r[0]!==r[2]&&r[1]!==r[3])return!0}return!1}applyViewport(e){e.setViewport(this.index===Li.INNER?0:this.resolution,0,this.resolution,this.resolution)}},Est=class{constructor(){this.extents=[Vt(),Vt(),Vt()],this.numViews=0}},F2e=class extends hs{constructor(e,r){super(e,"mat4",ei.Draw,(i,s,n)=>i.setUniformMatrix4fv(e,r(s,n)))}};function Cp(t,e){e.instancedDoublePrecision?t.constants.add("cameraPosition","vec3",Ka):t.uniforms.add(new wu("cameraPosition",(r,i)=>se(U2e,i.camera.viewInverseTransposeMatrix[3]-r.origin[0],i.camera.viewInverseTransposeMatrix[7]-r.origin[1],i.camera.viewInverseTransposeMatrix[11]-r.origin[2])))}function Mc(t,e){if(!e.instancedDoublePrecision)return void t.uniforms.add(new Fi("proj",(i,s)=>s.camera.projectionMatrix),new F2e("view",(i,s)=>Fl(qoe,s.camera.viewMatrix,i.origin)),new wu("localOrigin",i=>i.origin));const r=i=>se(U2e,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]);t.uniforms.add(new Fi("proj",(i,s)=>s.camera.projectionMatrix),new Fi("view",(i,s)=>Fl(qoe,s.camera.viewMatrix,r(s))),new zt("localOrigin",(i,s)=>r(s)))}const qoe=be(),U2e=O();function wE(t){t.uniforms.add(new Fi("viewNormal",(e,r)=>r.camera.viewInverseTransposeMatrix))}function gC(t,e){t.uniforms.add(new Pe("pixelRatio",(r,i)=>i.camera.pixelRatio/(e.draped?nQ:1)))}function k2e(t,e){const r=t.vertex;e.hasVerticalOffset?(z2e(r),e.hasScreenSizePerspective&&(t.include(sQ),SU(r),Cp(t.vertex,e)),r.code.add(w`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${e.spherical?w`vec3 worldNormal = normalize(worldPos + localOrigin);`:w`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${e.hasScreenSizePerspective?w`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:w`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):r.code.add(w`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const Cst=Xt();function z2e(t){t.uniforms.add(new nr("verticalOffset",(e,r)=>{const{minWorldLength:i,maxWorldLength:s,screenLength:n}=e.verticalOffset,o=Math.tan(.5*r.camera.fovY)/(.5*r.camera.fullViewport[3]),a=r.camera.pixelRatio||1;return xi(Cst,n*a,o,i,s)}))}function EU(t){t.uniforms.add(new Jf("alignPixelEnabled",(e,r)=>r.alignPixelEnabled)),t.code.add(w`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),t.code.add(w`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}var ac;(function(t){t[t.Occluded=0]="Occluded",t[t.NotOccluded=1]="NotOccluded",t[t.Both=2]="Both",t[t.COUNT=3]="COUNT"})(ac||(ac={}));var Al;function V2e(t,e){t.include(sQ),t.attributes.add(C.POSITION,"vec3"),t.attributes.add(C.NORMAL,"vec3"),t.attributes.add(C.AUXPOS1,"vec4");const r=t.vertex;Mc(r,e),Cp(r,e),r.uniforms.add(new nr("viewport",(i,s)=>s.camera.fullViewport),new Pe("polygonOffset",i=>i.shaderPolygonOffset),new Pe("cameraGroundRelative",(i,s)=>s.camera.aboveGround?1:-1),new Pe("renderTransparentlyOccludedHUD",(i,s)=>s.renderTransparentlyOccludedHUD===ac.Occluded?1:s.renderTransparentlyOccludedHUD===ac.NotOccluded?0:.75),new et("hudVisibilityTexture",(i,s)=>s.hudVisibilityTexture)),e.hasVerticalOffset&&z2e(r),r.constants.add("smallOffsetAngle","float",.984807753012208),r.code.add(w`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),r.code.add(w`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),e.draped&&!e.hasVerticalOffset||wE(r),e.draped||(r.uniforms.add(new Pe("perDistancePixelRatio",(i,s)=>Math.tan(s.camera.fovY/2)/(s.camera.fullViewport[2]/2))),r.code.add(w`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`)),e.screenCenterOffsetUnitsEnabled===Al.Screen&&gC(r,e),e.hasScreenSizePerspective&&SU(r),r.code.add(w`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${e.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${e.hasScreenSizePerspective&&(e.hasVerticalOffset||e.screenCenterOffsetUnitsEnabled===Al.Screen)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${e.hasVerticalOffset?e.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${e.hasVerticalOffset?w`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${e.screenCenterOffsetUnitsEnabled!==Al.Screen?w`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${e.screenCenterOffsetUnitsEnabled===Al.Screen?e.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${e.screenCenterOffsetUnitsEnabled===Al.Screen?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),r.include(EU),r.code.add(w`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}(function(t){t[t.World=0]="World",t[t.Screen=1]="Screen",t[t.COUNT=2]="COUNT"})(Al||(Al={}));const y$=pn();function B2e(t,e,r,i,s,n){if(t.visible)if(t.boundingInfo){nt(t.type===ls.Mesh);const o=e.tolerance;G2e(t.boundingInfo,r,i,o,s,n)}else{const o=t.indices.get(C.POSITION),a=t.vertexAttributes.get(C.POSITION);tP(r,i,0,o.length/3,o,a,void 0,s,n)}}const Ast=O();function G2e(t,e,r,i,s,n){if(t==null)return;const o=H2e(e,r,Ast);if($0e(y$,t.bbMin),L0e(y$,t.bbMax),s?.applyToAabb(y$),aQ(y$,e,o,i)){const{primitiveIndices:a,indices:l,position:c}=t,h=a?a.length:l.length/3;if(h>Pst){const p=t.getChildren();if(p!==void 0){for(const f of p)G2e(f,e,r,i,s,n);return}}tP(e,r,0,h,l,c,a,s,n)}}const j2e=O();function tP(t,e,r,i,s,n,o,a,l){if(o)return Ost(t,e,r,i,s,n,o,a,l);const{data:c,stride:h}=n,p=t[0],f=t[1],m=t[2],y=e[0]-p,_=e[1]-f,v=e[2]-m;for(let b=r,T=3*r;b<i;++b){let x=h*s[T++],S=c[x++],E=c[x++],A=c[x];x=h*s[T++];let R=c[x++],M=c[x++],D=c[x];x=h*s[T++];let k=c[x++],$=c[x++],N=c[x];a!=null&&([S,E,A]=a.applyToVertex(S,E,A,b),[R,M,D]=a.applyToVertex(R,M,D,b),[k,$,N]=a.applyToVertex(k,$,N,b));const H=R-S,Z=M-E,G=D-A,J=k-S,I=$-E,z=N-A,F=_*z-I*v,j=v*J-z*y,W=y*I-J*_,Y=H*F+Z*j+G*W;if(Math.abs(Y)<=Number.EPSILON)continue;const te=p-S,me=f-E,Le=m-A,dt=te*F+me*j+Le*W;if(Y>0){if(dt<0||dt>Y)continue}else if(dt>0||dt<Y)continue;const st=me*G-Z*Le,Xe=Le*H-G*te,yt=te*Z-H*me,ge=y*st+_*Xe+v*yt;if(Y>0){if(ge<0||dt+ge>Y)continue}else if(ge>0||dt+ge<Y)continue;const Ce=(J*st+I*Xe+z*yt)/Y;Ce>=0&&l(Ce,oQ(H,Z,G,J,I,z,j2e),b,!1)}}function Ost(t,e,r,i,s,n,o,a,l){const{data:c,stride:h}=n,p=t[0],f=t[1],m=t[2],y=e[0]-p,_=e[1]-f,v=e[2]-m;for(let b=r;b<i;++b){const T=o[b];let x=3*T,S=h*s[x++],E=c[S++],A=c[S++],R=c[S];S=h*s[x++];let M=c[S++],D=c[S++],k=c[S];S=h*s[x];let $=c[S++],N=c[S++],H=c[S];a!=null&&([E,A,R]=a.applyToVertex(E,A,R,b),[M,D,k]=a.applyToVertex(M,D,k,b),[$,N,H]=a.applyToVertex($,N,H,b));const Z=M-E,G=D-A,J=k-R,I=$-E,z=N-A,F=H-R,j=_*F-z*v,W=v*I-F*y,Y=y*z-I*_,te=Z*j+G*W+J*Y;if(Math.abs(te)<=Number.EPSILON)continue;const me=p-E,Le=f-A,dt=m-R,st=me*j+Le*W+dt*Y;if(te>0){if(st<0||st>te)continue}else if(st>0||st<te)continue;const Xe=Le*J-G*dt,yt=dt*Z-J*me,ge=me*G-Z*Le,Ce=y*Xe+_*yt+v*ge;if(te>0){if(Ce<0||st+Ce>te)continue}else if(Ce>0||st+Ce<te)continue;const bt=(I*Xe+z*yt+F*ge)/te;bt>=0&&l(bt,oQ(Z,G,J,I,z,F,j2e),T,!1)}}const Woe=O(),Xoe=O();function oQ(t,e,r,i,s,n,o){return se(Woe,t,e,r),se(Xoe,i,s,n),ht(o,Woe,Xoe),ye(o,o),o}function H2e(t,e,r){return se(r,1/(e[0]-t[0]),1/(e[1]-t[1]),1/(e[2]-t[2]))}function aQ(t,e,r,i){return lQ(t,e,r,i,1/0)}function lQ(t,e,r,i,s){const n=(t[0]-i-e[0])*r[0],o=(t[3]+i-e[0])*r[0];let a=Math.min(n,o),l=Math.max(n,o);const c=(t[1]-i-e[1])*r[1],h=(t[4]+i-e[1])*r[1];if(l=Math.min(l,Math.max(c,h)),l<0||(a=Math.max(a,Math.min(c,h)),a>l))return!1;const p=(t[2]-i-e[2])*r[2],f=(t[5]+i-e[2])*r[2];return l=Math.min(l,Math.max(p,f)),!(l<0)&&(a=Math.max(a,Math.min(p,f)),!(a>l)&&a<s)}function q2e(t,e,r,i,s){let n=(r.screenLength||0)*t.pixelRatio;s!=null&&(n=yst(n,i,e,s));const o=n*Math.tan(.5*t.fovY)/(.5*t.fullHeight);return ve(o*e,r.minWorldLength||0,r.maxWorldLength!=null?r.maxWorldLength:1/0)}function W2e(t,e){const r=e?W2e(e):{};for(const i in t){let s=t[i];s&&s.forEach&&(s=Mst(s)),s==null&&i in r||(r[i]=s)}return r}function Rst(t,e){let r=!1;for(const i in e){const s=e[i];s!==void 0&&(Array.isArray(s)?t[i]===null?(t[i]=s.slice(),r=!0):tX(t[i],s)&&(r=!0):t[i]!==s&&(r=!0,t[i]=s))}return r}function Mst(t){const e=[];return t.forEach(r=>e.push(r)),e}const X2e={multiply:1,ignore:2,replace:3,tint:4},Pst=1e3;let Av=class extends QM{constructor(e,r){super(),this.type=ls.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=Tr,this._pp0=Me(0,0,1),this._pp1=Me(0,0,0),this._parameters=W2e(e,r),this.validateParameters(this._parameters)}dispose(){}get parameters(){return this._parameters}update(e){return!1}setParameters(e,r=!0){Rst(this._parameters,e)&&(this.validateParameters(this._parameters),r&&this.parametersChanged())}validateParameters(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}shouldRender(e){return this.isVisible()&&this.isVisibleForOutput(e.output)&&(this.renderOccluded&e.renderOccludedMask)!=0}isVisibleForOutput(e){return!0}get renderOccluded(){return this.parameters.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(e){e!==this._insertOrder&&(this._insertOrder=e,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){this.repository!=null&&this.repository.materialChanged(this)}intersectDraped(e,r,i,s,n,o){return this._pp0[0]=this._pp1[0]=s[0],this._pp0[1]=this._pp1[1]=s[1],this.intersect(e,r,i,this._pp0,this._pp1,n)}},Z2e=class extends wKe{constructor(e,r,i){super(r,i),this.camera=e}};var Di;(function(t){t[t.None=0]="None",t[t.Occlude=1]="Occlude",t[t.Transparent=2]="Transparent",t[t.OccludeAndTransparent=4]="OccludeAndTransparent",t[t.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",t[t.Opaque=16]="Opaque"})(Di||(Di={}));let cQ=class extends ri{constructor(){super(...arguments),this.renderOccluded=Di.Occlude}},Y2e=class{constructor(){this.factor=new Zoe,this.factorAlignment=new Zoe}},Zoe=class{constructor(){this.scale=0,this.factor=0,this.minPixelSize=0,this.paddingPixels=0}};function bUt(t,e,r,i,s=1){const n=r.typedBuffer,o=r.typedBufferStride,a=t.length;if(i*=o,s===1)for(let l=0;l<a;++l)n[i]=e[t[l]],i+=o;else for(let l=0;l<a;++l){const c=e[t[l]];for(let h=0;h<s;h++)n[i]=c,i+=o}}function Yoe(t,e,r,i){const s=r.typedBuffer,n=r.typedBufferStride,o=t.length;i*=n;for(let a=0;a<o;++a){const l=2*t[a];s[i]=e[l],s[i+1]=e[l+1],i+=n}}function J2e(t,e,r,i,s){const n=r.typedBuffer,o=r.typedBufferStride,a=t.length;if(i*=o,s==null||s===1)for(let l=0;l<a;++l){const c=3*t[l];n[i]=e[c],n[i+1]=e[c+1],n[i+2]=e[c+2],i+=o}else for(let l=0;l<a;++l){const c=3*t[l];for(let h=0;h<s;++h)n[i]=e[c],n[i+1]=e[c+1],n[i+2]=e[c+2],i+=o}}function xE(t,e,r,i,s=1){const n=r.typedBuffer,o=r.typedBufferStride,a=t.length;if(i*=o,s===1)for(let l=0;l<a;++l){const c=4*t[l];n[i]=e[c],n[i+1]=e[c+1],n[i+2]=e[c+2],n[i+3]=e[c+3],i+=o}else for(let l=0;l<a;++l){const c=4*t[l];for(let h=0;h<s;++h)n[i]=e[c],n[i+1]=e[c+1],n[i+2]=e[c+2],n[i+3]=e[c+3],i+=o}}function Joe(t,e,r){const i=t.typedBuffer,s=t.typedBufferStride;e*=s;for(let n=0;n<r;++n)i[e]=0,i[e+1]=0,i[e+2]=0,i[e+3]=0,e+=s}function uQ(t,e,r,i,s,n=1){if(!r)return void J2e(t,e,i,s,n);const o=i.typedBuffer,a=i.typedBufferStride,l=t.length,c=r[0],h=r[1],p=r[2],f=r[4],m=r[5],y=r[6],_=r[8],v=r[9],b=r[10],T=r[12],x=r[13],S=r[14];s*=a;let E=0,A=0,R=0;const M=C6(r)?D=>{E=e[D]+T,A=e[D+1]+x,R=e[D+2]+S}:D=>{const k=e[D],$=e[D+1],N=e[D+2];E=c*k+f*$+_*N+T,A=h*k+m*$+v*N+x,R=p*k+y*$+b*N+S};if(n===1)for(let D=0;D<l;++D)M(3*t[D]),o[s]=E,o[s+1]=A,o[s+2]=R,s+=a;else for(let D=0;D<l;++D){M(3*t[D]);for(let k=0;k<n;++k)o[s]=E,o[s+1]=A,o[s+2]=R,s+=a}}function hQ(t,e,r,i,s,n=1){if(!r)return void J2e(t,e,i,s,n);const o=r,a=i.typedBuffer,l=i.typedBufferStride,c=t.length,h=o[0],p=o[1],f=o[2],m=o[4],y=o[5],_=o[6],v=o[8],b=o[9],T=o[10],x=!nY(o),S=1e-6,E=1-S;s*=l;let A=0,R=0,M=0;const D=C6(o)?k=>{A=e[k],R=e[k+1],M=e[k+2]}:k=>{const $=e[k],N=e[k+1],H=e[k+2];A=h*$+m*N+v*H,R=p*$+y*N+b*H,M=f*$+_*N+T*H};if(n===1)if(x)for(let k=0;k<c;++k){D(3*t[k]);const $=A*A+R*R+M*M;if($<E&&$>S){const N=1/Math.sqrt($);a[s]=A*N,a[s+1]=R*N,a[s+2]=M*N}else a[s]=A,a[s+1]=R,a[s+2]=M;s+=l}else for(let k=0;k<c;++k)D(3*t[k]),a[s]=A,a[s+1]=R,a[s+2]=M,s+=l;else for(let k=0;k<c;++k){if(D(3*t[k]),x){const $=A*A+R*R+M*M;if($<E&&$>S){const N=1/Math.sqrt($);A*=N,R*=N,M*=N}}for(let $=0;$<n;++$)a[s]=A,a[s+1]=R,a[s+2]=M,s+=l}}function Ist(t,e,r,i,s,n=1){if(!r)return void xE(t,e,i,s,n);const o=r,a=i.typedBuffer,l=i.typedBufferStride,c=t.length,h=o[0],p=o[1],f=o[2],m=o[4],y=o[5],_=o[6],v=o[8],b=o[9],T=o[10],x=!nY(o),S=1e-6,E=1-S;if(s*=l,n===1)for(let A=0;A<c;++A){const R=4*t[A],M=e[R],D=e[R+1],k=e[R+2],$=e[R+3];let N=h*M+m*D+v*k,H=p*M+y*D+b*k,Z=f*M+_*D+T*k;if(x){const G=N*N+H*H+Z*Z;if(G<E&&G>S){const J=1/Math.sqrt(G);N*=J,H*=J,Z*=J}}a[s]=N,a[s+1]=H,a[s+2]=Z,a[s+3]=$,s+=l}else for(let A=0;A<c;++A){const R=4*t[A],M=e[R],D=e[R+1],k=e[R+2],$=e[R+3];let N=h*M+m*D+v*k,H=p*M+y*D+b*k,Z=f*M+_*D+T*k;if(x){const G=N*N+H*H+Z*Z;if(G<E&&G>S){const J=1/Math.sqrt(G);N*=J,H*=J,Z*=J}}for(let G=0;G<n;++G)a[s]=N,a[s+1]=H,a[s+2]=Z,a[s+3]=$,s+=l}}function Q2e(t,e,r,i,s,n=1){const o=i.typedBuffer,a=i.typedBufferStride,l=t.length;if(s*=a,r!==e.length||r!==4)if(n!==1)if(r!==4)for(let c=0;c<l;++c){const h=3*t[c];for(let p=0;p<n;++p)o[s]=e[h],o[s+1]=e[h+1],o[s+2]=e[h+2],o[s+3]=255,s+=a}else for(let c=0;c<l;++c){const h=4*t[c];for(let p=0;p<n;++p)o[s]=e[h],o[s+1]=e[h+1],o[s+2]=e[h+2],o[s+3]=e[h+3],s+=a}else{if(r===4){for(let c=0;c<l;++c){const h=4*t[c];o[s]=e[h],o[s+1]=e[h+1],o[s+2]=e[h+2],o[s+3]=e[h+3],s+=a}return}for(let c=0;c<l;++c){const h=3*t[c];o[s]=e[h],o[s+1]=e[h+1],o[s+2]=e[h+2],o[s+3]=255,s+=a}}else{o[s]=e[0],o[s+1]=e[1],o[s+2]=e[2],o[s+3]=e[3];const c=new Uint32Array(i.typedBuffer.buffer,i.start),h=a/4,p=c[s/=4];s+=h;const f=l*n;for(let m=1;m<f;++m)c[s]=p,s+=h}}function $st(t,e,r,i){const s=r.typedBuffer,n=r.typedBufferStride,o=t.length,a=e[0];i*=n;for(let l=0;l<o;++l)s[i]=a,i+=n}function K2e(t,e,r,i,s=1){const n=e.typedBuffer,o=e.typedBufferStride;if(i*=o,s===1)for(let a=0;a<r;++a)n[i]=t[0],n[i+1]=t[1],n[i+2]=t[2],n[i+3]=t[3],i+=o;else for(let a=0;a<r;++a)for(let l=0;l<s;++l)n[i]=t[0],n[i+1]=t[1],n[i+2]=t[2],n[i+3]=t[3],i+=o}function eEe(t,e,r,i,s,n){for(const o of e.fields.keys()){const a=t.vertexAttributes.get(o),l=t.indices.get(o);if(a&&l)tEe(o,a,l,r,i,s,n);else if(o===C.OBJECTANDLAYERIDCOLOR&&t.objectAndLayerIdColor!=null){const c=t.indices.get(C.POSITION);if(nt(!!c,`No buffer view for ${o}`),c){const h=c.length,p=s.getField(o,ga);K2e(t.objectAndLayerIdColor,p,h,n)}}}}function tEe(t,e,r,i,s,n,o){switch(t){case C.POSITION:{nt(e.size===3);const a=n.getField(t,dn);nt(!!a,`No buffer view for ${t}`),a&&uQ(r,e.data,i,a,o);break}case C.NORMAL:{nt(e.size===3);const a=n.getField(t,dn);nt(!!a,`No buffer view for ${t}`),a&&hQ(r,e.data,s,a,o);break}case C.NORMALCOMPRESSED:{nt(e.size===2);const a=n.getField(t,JM);nt(!!a,`No buffer view for ${t}`),a&&Yoe(r,e.data,a,o);break}case C.UV0:{nt(e.size===2);const a=n.getField(t,Cv);nt(!!a,`No buffer view for ${t}`),a&&Yoe(r,e.data,a,o);break}case C.COLOR:case C.SYMBOLCOLOR:{const a=n.getField(t,ga);nt(!!a,`No buffer view for ${t}`),nt(e.size===3||e.size===4),!a||e.size!==3&&e.size!==4||Q2e(r,e.data,e.size,a,o);break}case C.COLORFEATUREATTRIBUTE:{const a=n.getField(t,nU);nt(!!a,`No buffer view for ${t}`),nt(e.size===1),a&&e.size===1&&$st(r,e.data,a,o);break}case C.TANGENT:{nt(e.size===4);const a=n.getField(t,Ep);nt(!!a,`No buffer view for ${t}`),a&&Ist(r,e.data,s,a,o);break}case C.PROFILERIGHT:case C.PROFILEUP:case C.PROFILEVERTEXANDNORMAL:case C.FEATUREVALUE:{nt(e.size===4);const a=n.getField(t,Ep);nt(!!a,`No buffer view for ${t}`),a&&xE(r,e.data,a,o)}}}function YR(t,e,r=0){const i=ve(t,0,Nst);for(let s=0;s<4;s++)e[r+s]=Math.floor(256*Fst(i*Lst[s]))}function dQ(t,e=0){let r=0;for(let i=0;i<4;i++)r+=t[e+i]*Dst[i];return r}const Lst=[1,256,65536,16777216],Dst=[1/256,1/65536,1/16777216,1/4294967296],Nst=dQ(new Uint8ClampedArray([255,255,255,255]));function Fst(t){return t-Math.floor(t)}async function yy(t,e){const{data:r}=await hr(t,{responseType:"image",...e});return r}function Ust(){if(yk==null){const t=e=>Gr(`esri/libs/basisu/${e}`);yk=ce(()=>import("./basis_transcoder-f99f66df.js"),[],import.meta.url).then(e=>e.b).then(({default:e})=>e({locateFile:t}).then(r=>(r.initializeBasis(),delete r.then,r)))}return yk}let yk;var Pb;(function(t){t[t.ETC1_RGB=0]="ETC1_RGB",t[t.ETC2_RGBA=1]="ETC2_RGBA",t[t.BC1_RGB=2]="BC1_RGB",t[t.BC3_RGBA=3]="BC3_RGBA",t[t.BC4_R=4]="BC4_R",t[t.BC5_RG=5]="BC5_RG",t[t.BC7_M6_RGB=6]="BC7_M6_RGB",t[t.BC7_M5_RGBA=7]="BC7_M5_RGBA",t[t.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",t[t.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",t[t.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",t[t.ATC_RGB=11]="ATC_RGB",t[t.ATC_RGBA=12]="ATC_RGBA",t[t.FXT1_RGB=17]="FXT1_RGB",t[t.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",t[t.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",t[t.ETC2_EAC_R11=20]="ETC2_EAC_R11",t[t.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",t[t.RGBA32=13]="RGBA32",t[t.RGB565=14]="RGB565",t[t.BGR565=15]="BGR565",t[t.RGBA4444=16]="RGBA4444"})(Pb||(Pb={}));let mp=null,_$=null;async function rEe(){return _$==null&&(_$=Ust(),mp=await _$),_$}function kst(t,e){if(mp==null)return t.byteLength;const r=new mp.BasisFile(new Uint8Array(t)),i=sEe(r)?iEe(r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),e):0;return r.close(),r.delete(),i}function zst(t,e){if(mp==null)return t.byteLength;const r=new mp.KTX2File(new Uint8Array(t)),i=nEe(r)?iEe(r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),e):0;return r.close(),r.delete(),i}function iEe(t,e,r,i,s){const n=pJ(e?fs.COMPRESSED_RGBA8_ETC2_EAC:fs.COMPRESSED_RGB8_ETC2),o=s&&t>1?(4**t-1)/(3*4**(t-1)):1;return Math.ceil(r*i*n*o)}function sEe(t){return t.getNumImages()>=1&&!t.isUASTC()}function nEe(t){return t.getFaces()>=1&&t.isETC1S()}async function Vst(t,e,r){mp==null&&(mp=await rEe());const i=new mp.BasisFile(new Uint8Array(r));if(!sEe(i))return null;i.startTranscoding();const s=oEe(t,e,i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),(n,o)=>i.getImageTranscodedSizeInBytes(0,n,o),(n,o,a)=>i.transcodeImage(a,0,n,o,0,0));return i.close(),i.delete(),s}async function Bst(t,e,r){mp==null&&(mp=await rEe());const i=new mp.KTX2File(new Uint8Array(r));if(!nEe(i))return null;i.startTranscoding();const s=oEe(t,e,i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),(n,o)=>i.getImageTranscodedSizeInBytes(n,0,0,o),(n,o,a)=>i.transcodeImage(a,n,0,0,o,0,-1,-1));return i.close(),i.delete(),s}function oEe(t,e,r,i,s,n,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=t.capabilities,[h,p]=l?i?[Pb.ETC2_RGBA,fs.COMPRESSED_RGBA8_ETC2_EAC]:[Pb.ETC1_RGB,fs.COMPRESSED_RGB8_ETC2]:c?i?[Pb.BC3_RGBA,fs.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[Pb.BC1_RGB,fs.COMPRESSED_RGB_S3TC_DXT1_EXT]:[Pb.RGBA32,Ct.RGBA],f=e.hasMipmap?r:Math.min(1,r),m=[];for(let y=0;y<f;y++)m.push(new Uint8Array(o(y,h))),a(y,h,m[y]);return e.internalFormat=p,e.hasMipmap=m.length>1,e.samplingMode=e.hasMipmap?Rt.LINEAR_MIPMAP_LINEAR:Rt.LINEAR,e.width=s,e.height=n,new Ot(t,e,{type:"compressed",levels:m})}const v$=Q.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),Gst=542327876,jst=131072,Hst=4;function pQ(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function qst(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)}const Wst=pQ("DXT1"),Xst=pQ("DXT3"),Zst=pQ("DXT5"),Yst=31,Jst=0,Qst=1,Kst=2,ent=3,tnt=4,rnt=7,int=20,snt=21;function nnt(t,e,r){const i=ont(r,e.hasMipmap??!1);if(i==null)throw new Error("DDS texture data is null");const{textureData:s,internalFormat:n,width:o,height:a}=i;return e.samplingMode=s.levels.length>1?Rt.LINEAR_MIPMAP_LINEAR:Rt.LINEAR,e.hasMipmap=s.levels.length>1,e.internalFormat=n,e.width=o,e.height=a,new Ot(t,e,s)}function ont(t,e){const r=new Int32Array(t,0,Yst);if(r[Jst]!==Gst)return v$.error("Invalid magic number in DDS header"),null;if(!(r[int]&Hst))return v$.error("Unsupported format, must contain a FourCC code"),null;const i=r[snt];let s,n;switch(i){case Wst:s=8,n=fs.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case Xst:s=16,n=fs.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case Zst:s=16,n=fs.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return v$.error("Unsupported FourCC code:",qst(i)),null}let o=1,a=r[tnt],l=r[ent];!(3&a)&&!(3&l)||(v$.warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,h=l;let p,f;r[Kst]&jst&&e!==!1&&(o=Math.max(1,r[rnt]));let m=r[Qst]+4;const y=[];for(let _=0;_<o;++_)f=(a+3>>2)*(l+3>>2)*s,p=new Uint8Array(t,m,f),y.push(p),m+=f,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:y},internalFormat:n,width:c,height:h}}let _x=class extends QM{constructor(e,r){super(),this._data=e,this.type=ls.Texture,this._glTexture=null,this._loadingPromise=null,this._loadingController=null,this.events=new ws,this.parameters=r||{},this.parameters.mipmap=this.parameters.mipmap!==!1,this.parameters.noUnpackFlip=this.parameters.noUnpackFlip||!1,this.parameters.preMultiplyAlpha=this.parameters.preMultiplyAlpha||!1,this.parameters.wrap=this.parameters.wrap||{s:Dt.REPEAT,t:Dt.REPEAT},this._startPreload(e)}_startPreload(e){e!=null&&(e instanceof HTMLVideoElement?this._startPreloadVideoElement(e):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!(W_(e.src)||e.preload==="auto"&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";const r=!e.paused;if(e.src=e.src,r&&e.autoplay){const i=()=>{e.removeEventListener("canplay",i),e.play()};e.addEventListener("canplay",i)}}}_startPreloadImageElement(e){_m(e.src)||W_(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}dispose(){this._data=void 0}_createDescriptor(e){const r=new xr;return r.wrapMode=this.parameters.wrap??Dt.REPEAT,r.flipped=!this.parameters.noUnpackFlip,r.samplingMode=this.parameters.mipmap?Rt.LINEAR_MIPMAP_LINEAR:Rt.LINEAR,r.hasMipmap=!!this.parameters.mipmap,r.preMultiplyAlpha=!!this.parameters.preMultiplyAlpha,r.maxAnisotropy=this.parameters.maxAnisotropy??(this.parameters.mipmap?e.parameters.maxMaxAnisotropy:1),r}get glTexture(){return this._glTexture}get memoryEstimate(){return this._glTexture?.gpuMemoryUsage||ant(this._data,this.parameters)}load(e){if(this._glTexture!=null)return this._glTexture;if(this._loadingPromise)return this._loadingPromise;const r=this._data;return r==null?(this._glTexture=new Ot(e,this._createDescriptor(e),null),this._glTexture):typeof r=="string"?this._loadFromURL(e,r):r instanceof Image?this._loadFromImageElement(e,r):r instanceof HTMLVideoElement?this._loadFromVideoElement(e,r):r instanceof ImageData||r instanceof HTMLCanvasElement?this._loadFromImage(e,r):(MA(r)||T_(r))&&this.parameters.encoding===Xg.DDS_ENCODING?(this._data=void 0,this._loadFromDDSData(e,r)):(MA(r)||T_(r))&&this.parameters.encoding===Xg.KTX2_ENCODING?(this._data=void 0,this._loadFromKTX2(e,r)):(MA(r)||T_(r))&&this.parameters.encoding===Xg.BASIS_ENCODING?(this._data=void 0,this._loadFromBasis(e,r)):T_(r)?this._loadFromPixelData(e,r):MA(r)?this._loadFromPixelData(e,new Uint8Array(r)):null}get requiresFrameUpdates(){return this._data instanceof HTMLVideoElement}frameUpdate(e){return this._data instanceof HTMLVideoElement&&this._glTexture!=null?this._data.readyState<qO.HAVE_CURRENT_DATA||e===this._data.currentTime?e:(this._glTexture.setData(this._data),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this.parameters.updateCallback&&this.parameters.updateCallback(),this._data.currentTime):e}_loadFromDDSData(e,r){return this._glTexture=nnt(e,this._createDescriptor(e),r),this._glTexture}_loadFromKTX2(e,r){return this._loadAsync(()=>Bst(e,this._createDescriptor(e),r).then(i=>(this._glTexture=i,i)))}_loadFromBasis(e,r){return this._loadAsync(()=>Vst(e,this._createDescriptor(e),r).then(i=>(this._glTexture=i,i)))}_loadFromPixelData(e,r){nt(this.parameters.width>0&&this.parameters.height>0);const i=this._createDescriptor(e);return i.pixelFormat=this.parameters.components===1?Ct.LUMINANCE:this.parameters.components===3?Ct.RGB:Ct.RGBA,i.width=this.parameters.width??0,i.height=this.parameters.height??0,this._glTexture=new Ot(e,i,r),this._glTexture}_loadFromURL(e,r){return this._loadAsync(async i=>{const s=await yy(r,{signal:i});return Yt(i),this._loadFromImage(e,s)})}_loadFromImageElement(e,r){return r.complete?this._loadFromImage(e,r):this._loadAsync(async i=>{const s=await Hme(r,r.src,!1,i);return Yt(i),this._loadFromImage(e,s)})}_loadFromVideoElement(e,r){return r.readyState>=qO.HAVE_CURRENT_DATA?this._loadFromImage(e,r):this._loadFromVideoElementAsync(e,r)}_loadFromVideoElementAsync(e,r){return this._loadAsync(i=>new Promise((s,n)=>{const o=()=>{r.removeEventListener("loadeddata",a),r.removeEventListener("error",l),Ni(c)},a=()=>{r.readyState>=qO.HAVE_CURRENT_DATA&&(o(),s(this._loadFromImage(e,r)))},l=h=>{o(),n(h||new V("Failed to load video"))};r.addEventListener("loadeddata",a),r.addEventListener("error",l);const c=da(i,()=>l(kr()))}))}_loadFromImage(e,r){const i=aEe(r);this.parameters.width=i.width,this.parameters.height=i.height;const s=this._createDescriptor(e);return s.pixelFormat=this.parameters.components===3?Ct.RGB:Ct.RGBA,s.width=i.width,s.height=i.height,this._glTexture=new Ot(e,s,r),this._glTexture}_loadAsync(e){const r=new AbortController;this._loadingController=r;const i=e(r.signal);this._loadingPromise=i;const s=()=>{this._loadingController===r&&(this._loadingController=null),this._loadingPromise===i&&(this._loadingPromise=null)};return i.then(s,s),i}unload(){if(this._glTexture=Ve(this._glTexture),this._loadingController!=null){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}};function ant(t,e){if(t==null)return 0;if(MA(t)||T_(t))return e.encoding===Xg.KTX2_ENCODING?zst(t,!!e.mipmap):e.encoding===Xg.BASIS_ENCODING?kst(t,!!e.mipmap):t.byteLength;const{width:r,height:i}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?aEe(t):e;return(e.mipmap?4/3:1)*r*i*(e.components||4)||0}function aEe(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}var qO;(function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(qO||(qO={}));const JR=128,fQ=.5;function lnt(t,e=JR,r=e*fQ,i=0){const s=lEe(t,e,r,i);return new _x(s,{mipmap:!1,wrap:{s:Dt.CLAMP_TO_EDGE,t:Dt.CLAMP_TO_EDGE},width:e,height:e,components:4,noUnpackFlip:!0})}function lEe(t,e=JR,r=e*fQ,i=0){switch(t){case"circle":default:return cnt(e,r);case"square":return unt(e,r);case"cross":return dnt(e,r,i);case"x":return pnt(e,r,i);case"kite":return hnt(e,r);case"triangle":return fnt(e,r);case"arrow":return mnt(e,r)}}function cnt(t,e){const r=t/2-.5;return rP(t,hEe(r,r,e/2))}function unt(t,e){return cEe(t,e,!1)}function hnt(t,e){return cEe(t,e,!0)}function dnt(t,e,r=0){return uEe(t,e,!1,r)}function pnt(t,e,r=0){return uEe(t,e,!0,r)}function fnt(t,e){return rP(t,dEe(t/2,e,e/2))}function mnt(t,e){const r=e,i=e/2,s=t/2,n=.8*r,o=hEe(s,(t-e)/2-n,Math.sqrt(n*n+i*i)),a=dEe(s,r,i);return rP(t,(l,c)=>Math.max(a(l,c),-o(l,c)))}function cEe(t,e,r){return r&&(e/=Math.SQRT2),rP(t,(i,s)=>{let n=i-.5*t+.25,o=.5*t-s-.75;if(r){const a=(n+o)/Math.SQRT2;o=(o-n)/Math.SQRT2,n=a}return Math.max(Math.abs(n),Math.abs(o))-.5*e})}function uEe(t,e,r,i=0){e-=i,r&&(e*=Math.SQRT2);const s=.5*e;return rP(t,(n,o)=>{let a,l=n-.5*t,c=.5*t-o-1;if(r){const h=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=h}return l=Math.abs(l),c=Math.abs(c),a=l>c?l>s?Math.sqrt((l-s)*(l-s)+c*c):c:c>s?Math.sqrt(l*l+(c-s)*(c-s)):l,a-=i/2,a})}function hEe(t,e,r){return(i,s)=>{const n=i-t,o=s-e;return Math.sqrt(n*n+o*o)-r}}function dEe(t,e,r){const i=Math.sqrt(e*e+r*r);return(s,n)=>{const o=Math.abs(s-t)-r,a=n-t+e/2+.75,l=(e*o+r*a)/i,c=-a;return Math.max(l,c)}}function rP(t,e){const r=new Uint8Array(4*t*t);for(let i=0;i<t;i++)for(let s=0;s<t;s++){const n=s+t*i;let o=e(s,i);o=o/t+.5,YR(o,r,4*n)}return r}let xUt=class extends ri{constructor(e){super(),this.slicePlaneLocalOrigin=e}};function gnt(t,e){pEe(t,e,new zt("slicePlaneOrigin",(r,i)=>yEe(e,r,i)),new zt("slicePlaneBasis1",(r,i)=>OF(e,r,i,i.slicePlane?.basis1)),new zt("slicePlaneBasis2",(r,i)=>OF(e,r,i,i.slicePlane?.basis2)))}function ys(t,e){pEe(t,e,new wu("slicePlaneOrigin",(r,i)=>yEe(e,r,i)),new wu("slicePlaneBasis1",(r,i)=>OF(e,r,i,i.slicePlane?.basis1)),new wu("slicePlaneBasis2",(r,i)=>OF(e,r,i,i.slicePlane?.basis2)))}function pEe(t,e,...r){if(!e.hasSlicePlane){const o=w`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return e.hasSliceInVertexProgram&&t.vertex.code.add(o),void t.fragment.code.add(o)}e.hasSliceInVertexProgram&&t.vertex.uniforms.add(...r),t.fragment.uniforms.add(...r);const i=w`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,s=w`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,n=e.hasSliceHighlight?w`
        ${s}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:w`#define highlightSlice(_color_, _pos_) (_color_)`;e.hasSliceInVertexProgram&&t.vertex.code.add(i),t.fragment.code.add(i),t.fragment.code.add(n)}function fEe(t,e,r){return t.instancedDoublePrecision?se(ynt,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]):e.slicePlaneLocalOrigin}function mEe(t,e){return t!=null?de(RF,e.origin,t):e.origin}function gEe(t,e,r){return t.hasSliceTranslatedView?e!=null?Fl(_nt,r.camera.viewMatrix,e):r.camera.viewMatrix:null}function yEe(t,e,r){if(r.slicePlane==null)return Ka;const i=fEe(t,e,r),s=mEe(i,r.slicePlane),n=gEe(t,i,r);return n!=null?Fe(RF,s,n):s}function OF(t,e,r,i){if(i==null||r.slicePlane==null)return Ka;const s=fEe(t,e,r),n=mEe(s,r.slicePlane),o=gEe(t,s,r);return o!=null?(ue(rA,i,n),Fe(RF,n,o),Fe(rA,rA,o),de(rA,rA,RF)):i}const ynt=O(),RF=O(),rA=O(),_nt=be();function iP(t,e){const r=e.output===U.ObjectAndLayerIdColor,i=e.objectAndLayerIdColorInstanced;r&&(t.varyings.add("objectAndLayerIdColorVarying","vec4"),i?t.attributes.add(C.INSTANCEOBJECTANDLAYERIDCOLOR,"vec4"):t.attributes.add(C.OBJECTANDLAYERIDCOLOR,"vec4")),t.vertex.code.add(w`
     void forwardObjectAndLayerIdColor() {
      ${r?i?w`objectAndLayerIdColorVarying = instanceObjectAndLayerIdColor * 0.003921568627451;`:w`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:w``} }`),t.fragment.code.add(w`
      void outputObjectAndLayerIdColor() {
        ${r?w`fragColor = objectAndLayerIdColorVarying;`:w``} }`)}function vnt(t,e){const{vertex:r,fragment:i}=t;r.include(EU),e.hasMultipassGeometry&&r.include(vTe),e.hasMultipassTerrain&&t.varyings.add("depth","float"),r.code.add(w`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${e.hasMultipassGeometry?w`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${e.hasMultipassTerrain?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),e.hasMultipassTerrain&&i.include(Ru),e.hasMultipassTerrain&&i.uniforms.add(new et("terrainDepthTexture",(s,n)=>n.multipassTerrain.linearDepthTexture),new Ar("nearFar",(s,n)=>n.camera.nearFar)),i.include(Nc),i.code.add(w`
  void main() {
    fragColor = vec4(1);
    ${e.hasMultipassTerrain?w`
          // Read the rgba data from the texture linear depth
          vec4 terrainDepthData = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0);

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          // If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          // Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            fragColor.g = 0.5;
          }`:""}
  }
  `)}const bnt=Nt(1,1,0,1),_Ee=Nt(1,0,1,1);function Ly(t){t.fragment.uniforms.add(new et("depthTexture",(e,r)=>r.highlightDepthTexture)),t.fragment.constants.add("occludedHighlightFlag","vec4",bnt).add("unoccludedHighlightFlag","vec4",_Ee),t.fragment.code.add(w`void outputHighlight() {
float sceneDepth = float(texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x);
if (gl_FragCoord.z > sceneDepth + 5e-7) {
fragColor = occludedHighlightFlag;
} else {
fragColor = unoccludedHighlightFlag;
}
}`)}let vEe=class extends hs{constructor(e,r,i){super(e,"vec4",ei.Pass,(s,n,o)=>s.setUniform4fv(e,r(n,o)),i)}},Ol=class extends hs{constructor(e,r,i){super(e,"float",ei.Pass,(s,n,o)=>s.setUniform1fv(e,r(n,o)),i)}};var aa,Qoe;(function(t){t[t.Undefined=0]="Undefined",t[t.DefinedSize=1]="DefinedSize",t[t.DefinedScale=2]="DefinedScale"})(aa||(aa={})),function(t){t[t.Undefined=0]="Undefined",t[t.DefinedAngle=1]="DefinedAngle"}(Qoe||(Qoe={}));let mQ=class{constructor(e){this.field=e}},wnt=class extends mQ{constructor(e){super(e),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[aa.Undefined,aa.Undefined,aa.Undefined]}},xnt=class extends mQ{constructor(e){super(e),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0]}},Tnt=class extends mQ{constructor(e){super(e),this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}},Snt=class{};function iA(t){return t!=null}function Kx(t){return typeof t=="number"}function CU(t){return typeof t=="string"}function Ent(t){return t==null||CU(t)}function an(t,e){t&&t.push(e)}function Cnt(t,e,r,i=be()){const s=t||0,n=e||0,o=r||0;return s!==0&&tE(i,i,-s/180*Math.PI),n!==0&&eE(i,i,n/180*Math.PI),o!==0&&S6(i,i,o/180*Math.PI),i}function a0(t,e,r,i,s){const n=t.minSize,o=t.maxSize;if(t.expression)return an(s,"Could not convert size info: expression not supported"),!1;if(t.useSymbolValue){const a=i.symbolSize[r];return e.minSize[r]=a,e.maxSize[r]=a,e.offset[r]=e.minSize[r],e.factor[r]=0,e.type[r]=aa.DefinedSize,!0}if(iA(t.field))return iA(t.stops)?t.stops.length===2&&Kx(t.stops[0].size)&&Kx(t.stops[1].size)?(Koe(t.stops[0].size,t.stops[1].size,t.stops[0].value,t.stops[1].value,e,r),e.type[r]=aa.DefinedSize,!0):(an(s,"Could not convert size info: stops only supported with 2 elements"),!1):Kx(n)&&Kx(o)&&iA(t.minDataValue)&&iA(t.maxDataValue)?(Koe(n,o,t.minDataValue,t.maxDataValue,e,r),e.type[r]=aa.DefinedSize,!0):t.valueUnit==="unknown"?(an(s,"Could not convert size info: proportional size not supported"),!1):Q2[t.valueUnit]!=null?(e.minSize[r]=-1/0,e.maxSize[r]=1/0,e.offset[r]=0,e.factor[r]=1/Q2[t.valueUnit],e.type[r]=aa.DefinedSize,!0):(an(s,"Could not convert size info: scale-dependent size not supported"),!1);if(!iA(t.field)){if(t.stops&&t.stops[0]&&Kx(t.stops[0].size))return e.minSize[r]=t.stops[0].size,e.maxSize[r]=t.stops[0].size,e.offset[r]=e.minSize[r],e.factor[r]=0,e.type[r]=aa.DefinedSize,!0;if(Kx(n))return e.minSize[r]=n,e.maxSize[r]=n,e.offset[r]=n,e.factor[r]=0,e.type[r]=aa.DefinedSize,!0}return an(s,"Could not convert size info: unsupported variant of sizeInfo"),!1}function Koe(t,e,r,i,s,n){const o=Math.abs(i-r)>0?(e-t)/(i-r):0;s.minSize[n]=o>0?t:e,s.maxSize[n]=o>0?e:t,s.offset[n]=t-r*o,s.factor[n]=o}function Ant(t,e,r,i){if(t.normalizationField||t.valueRepresentation)return an(i,"Could not convert size info: unsupported property"),null;if(!Ent(t.field))return an(i,"Could not convert size info: field is not a string"),null;if(e.size){if(t.field)if(e.size.field){if(t.field!==e.size.field)return an(i,"Could not convert size info: multiple fields in use"),null}else e.size.field=t.field}else e.size=new wnt(t.field);let s;switch(t.axis){case"width":return s=a0(t,e.size,0,r,i),s?e:null;case"height":return s=a0(t,e.size,2,r,i),s?e:null;case"depth":return s=a0(t,e.size,1,r,i),s?e:null;case"width-and-depth":return s=a0(t,e.size,0,r,i),s&&a0(t,e.size,1,r,i),s?e:null;case null:case void 0:case"all":return s=a0(t,e.size,0,r,i),s=s&&a0(t,e.size,1,r,i),s=s&&a0(t,e.size,2,r,i),s?e:null;default:return an(i,`Could not convert size info: unknown axis "${t.axis}""`),null}}function Ont(t,e,r){for(let s=0;s<3;++s){let n=e.unitInMeters;t.type[s]===aa.DefinedSize&&(n*=e.modelSize[s],t.type[s]=aa.DefinedScale),t.minSize[s]=t.minSize[s]/n,t.maxSize[s]=t.maxSize[s]/n,t.offset[s]=t.offset[s]/n,t.factor[s]=t.factor[s]/n}let i;if(t.type[0]!==aa.Undefined)i=0;else if(t.type[1]!==aa.Undefined)i=1;else{if(t.type[2]===aa.Undefined)return an(r,"No size axis contains a valid size or scale"),!1;i=2}for(let s=0;s<3;++s)t.type[s]===aa.Undefined&&(t.minSize[s]=t.minSize[i],t.maxSize[s]=t.maxSize[i],t.offset[s]=t.offset[i],t.factor[s]=t.factor[i],t.type[s]=t.type[i]);return!0}function eae(t,e,r){t[4*e]=r.r/255,t[4*e+1]=r.g/255,t[4*e+2]=r.b/255,t[4*e+3]=r.a}function Rnt(t,e,r){if(t.normalizationField)return an(r,"Could not convert color info: unsupported property"),null;if(CU(t.field)){if(!t.stops)return an(r,"Could not convert color info: missing stops or colors"),null;{if(t.stops.length>8)return an(r,"Could not convert color info: too many color stops"),null;e.color=new xnt(t.field);const i=t.stops;for(let s=0;s<8;++s){const n=i[Math.min(s,i.length-1)];e.color.values[s]=n.value,eae(e.color.colors,s,n.color)}}}else{if(!(t.stops&&t.stops.length>=0))return an(r,"Could not convert color info: no field and no colors/stops"),null;{const i=t.stops&&t.stops.length>=0&&t.stops[0].color;e.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)e.color.values[s]=1/0,eae(e.color.colors,s,i)}}return e}function Mnt(t,e,r){if(t.normalizationField)return an(r,"Could not convert opacity info: unsupported property"),null;if(CU(t.field)){if(!t.stops)return an(r,"Could not convert opacity info: missing stops or opacities"),null;{if(t.stops.length>8)return an(r,"Could not convert opacity info: too many opacity stops"),null;e.opacity=new Tnt(t.field);const i=t.stops;for(let s=0;s<8;++s){const n=i[Math.min(s,i.length-1)];e.opacity.values[s]=n.value,e.opacity.opacityValues[s]=n.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return an(r,"Could not convert opacity info: no field and no opacities/stops"),null;{const i=t.stops&&t.stops.length>=0?t.stops[0].opacity:0;e.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)e.opacity.values[s]=1/0,e.opacity.opacityValues[s]=i}}return e}function _k(t,e,r){const i=r===2&&t.rotationType==="arithmetic";e.offset[r]=i?90:0,e.factor[r]=i?-1:1,e.type[r]=1}function Pnt(t,e,r){if(!CU(t.field))return an(r,"Could not convert rotation info: field is not a string"),null;if(e.rotation){if(t.field)if(e.rotation.field){if(t.field!==e.rotation.field)return an(r,"Could not convert rotation info: multiple fields in use"),null}else e.rotation.field=t.field}else e.rotation={field:t.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(t.axis){case"tilt":return _k(t,e.rotation,0),e;case"roll":return _k(t,e.rotation,1),e;case null:case void 0:case"heading":return _k(t,e.rotation,2),e;default:return an(r,`Could not convert rotation info: unknown axis "${t.axis}""`),null}}let sP=class{constructor(e,r=[1,1,1],i=[1,1,1],s=1,n=[0,0,0],o=[1,1,1],a=[0,0,0]){this.supports=e,this.modelSize=r,this.symbolSize=i,this.unitInMeters=s,this.anchor=n,this.scale=o,this.rotation=a}};function bEe(t,e,r){if(!t)return null;const i=t.reduce((s,n)=>{if(!s)return s;if(n.valueExpression)return an(r,"Could not convert visual variables: arcade expressions not supported"),null;switch(n.type){case"size":return e.supports.size?Ant(n,s,e,r):s;case"color":return e.supports.color?Rnt(n,s,r):s;case"opacity":return e.supports.opacity?Mnt(n,s,r):null;case"rotation":return e.supports.rotation?Pnt(n,s,r):s;default:return null}},new Snt);return!(t.length>0&&i)||i.size||i.color||i.opacity||i.rotation?i&&i.size&&!Ont(i.size,e,r)?null:i:null}let Int=class{constructor(e,r,i){this.visualVariables=e,this.materialParameters=r,this.requiresShaderTransformation=i}};function TE(t,e){if(!t||ai.TESTS_DISABLE_FAST_UPDATES)return null;const r=bEe(t.visualVariables,e);return r?new Int(r,xEe(r,e),!!r.size):null}function SE(t,e,r){if(!e||!t)return!1;const i=t.visualVariables,s=bEe(e.visualVariables,r);return!!s&&!!(b$(i.size,s.size,"size")&&b$(i.color,s.color,"color")&&b$(i.rotation,s.rotation,"rotation")&&b$(i.opacity,s.opacity,"opacity"))&&(t.visualVariables=s,t.materialParameters=xEe(s,r),t.requiresShaderTransformation=!!s.size,!0)}function b$(t,e,r){if(!!t!=!!e||t&&t.field!==e?.field)return!1;if(t&&r==="rotation"){const i=t,s=e;for(let n=0;n<3;n++)if(i.type[n]!==s.type[n]||i.offset[n]!==s.offset[n]||i.factor[n]!==s.factor[n])return!1}return!0}let wEe=class extends ri{constructor(e){super(),this.vvSize=e?.size??null,this.vvColor=e?.color??null,this.vvOpacity=e?.opacity??null}};function xEe(t,e){const r=new wEe(t);return r.vvSize&&(r.vvSymbolAnchor=e.anchor,zh(WO),Cnt(e.rotation[2],e.rotation[0],e.rotation[1],WO),r.vvSymbolRotationMatrix=r.vvSymbolRotationMatrix||Ui(),Vh(r.vvSymbolRotationMatrix,WO)),r}function Mq(t,e,r){if(!t.vvSize)return r;Us(l0,r);const i=t.vvSymbolRotationMatrix;xm(WO,i[0],i[1],i[2],0,i[3],i[4],i[5],0,i[6],i[7],i[8],0,0,0,0,1),oi(l0,l0,WO);for(let s=0;s<3;++s){const n=t.vvSize.offset[s]+e[0]*t.vvSize.factor[s];tae[s]=ve(n,t.vvSize.minSize[s],t.vvSize.maxSize[s])}return T6(l0,l0,tae),Fl(l0,l0,t.vvSymbolAnchor),l0}function $nt(t,e,r){if(e.vvSize)for(let i=0;i<3;++i){const s=e.vvSize.offset[i]+r[0]*e.vvSize.factor[i];t[i]=ve(s,e.vvSize.minSize[i],e.vvSize.maxSize[i])}else se(t,1,1,1)}function gp(t,e){const r=t==null?0:e.attributes[t];return typeof r=="number"&&isFinite(r)?r:0}const l0=be(),tae=O(),WO=be();let nP=class extends wEe{constructor(){super(...arguments),this.renderOccluded=Di.Occlude}};const A2=8;function Yg(t,e){const{vertex:r,attributes:i}=t;e.hasVvInstancing&&(e.vvSize||e.vvColor)&&i.add(C.INSTANCEFEATUREATTRIBUTE,"vec4"),e.vvSize?(r.uniforms.add(new zt("vvSizeMinSize",s=>s.vvSize.minSize)),r.uniforms.add(new zt("vvSizeMaxSize",s=>s.vvSize.maxSize)),r.uniforms.add(new zt("vvSizeOffset",s=>s.vvSize.offset)),r.uniforms.add(new zt("vvSizeFactor",s=>s.vvSize.factor)),r.uniforms.add(new Yh("vvSymbolRotationMatrix",s=>s.vvSymbolRotationMatrix)),r.uniforms.add(new zt("vvSymbolAnchor",s=>s.vvSymbolAnchor)),r.code.add(w`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),r.code.add(w`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${e.hasVvInstancing?w`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):r.code.add(w`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),e.vvColor?(r.constants.add("vvColorNumber","int",A2),r.uniforms.add(new Ol("vvColorValues",s=>s.vvColor.values,A2),new vEe("vvColorColors",s=>s.vvColor.colors,A2)),r.code.add(w`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${e.hasVvInstancing?w`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):r.code.add(w`vec4 vvColor() { return vec4(1.0); }`)}const MF=.1,yo=.001;function Lnt(t){const e=new Sr,r=t.signedDistanceFieldEnabled;if(e.include(V2e,t),e.include(ys,t),t.occlusionPass)return e.include(vnt,t),e;const{vertex:i,fragment:s}=e;e.include(sQ),s.include(Nc),s.include(Em),e.include(Yg,t),e.include(iP,t),e.varyings.add("vcolor","vec4"),e.varyings.add("vtc","vec2"),e.varyings.add("vsize","vec2"),t.binaryHighlightOcclusionEnabled&&e.varyings.add("voccluded","float"),i.uniforms.add(new nr("viewport",(c,h)=>h.camera.fullViewport),new Ar("screenOffset",(c,h)=>ar(TEe,2*c.screenOffset[0]*h.camera.pixelRatio,2*c.screenOffset[1]*h.camera.pixelRatio)),new Ar("anchorPosition",c=>PF(c)),new nr("materialColor",c=>c.color)),gC(i,t),r&&(i.uniforms.add(new nr("outlineColor",c=>c.outlineColor)),s.uniforms.add(new nr("outlineColor",c=>rae(c)?c.outlineColor:Wf),new Pe("outlineSize",c=>rae(c)?c.outlineSize:0))),t.hasScreenSizePerspective&&(xst(i),SU(i)),(t.debugDrawLabelBorder||t.binaryHighlightOcclusionEnabled)&&e.varyings.add("debugBorderCoords","vec4"),e.attributes.add(C.UV0,"vec2"),e.attributes.add(C.COLOR,"vec4"),e.attributes.add(C.SIZE,"vec2"),e.attributes.add(C.AUXPOS2,"vec4"),i.code.add(w`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${t.hasScreenSizePerspective?w`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:w`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${t.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${t.occlusionTestEnabled||t.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${t.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const n=w`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`;t.pixelSnappingEnabled&&i.include(EU);const o=t.pixelSnappingEnabled?r?w`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:w`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:w`posProj += quadOffset;`;i.code.add(w`
    ${t.occlusionTestEnabled?"if (visible) {":""}
    ${n}
    ${t.vvColor?"vcolor = interpolateVVColor(auxpos2.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${t.output===U.ObjectAndLayerIdColor?w`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${w.float(yo)};
    ${r?`alphaDiscard = alphaDiscard && outlineColor.a < ${w.float(yo)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${o}
      gl_Position = posProj;
    }

    vtc = uv;

    ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${t.occlusionTestEnabled?w`} else { vtc = vec2(0.0);
      ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),s.uniforms.add(new et("tex",c=>c.texture));const a=t.debugDrawLabelBorder?w`(isBorder > 0.0 ? 0.0 : ${w.float(MF)})`:w.float(MF),l=w`
    ${t.debugDrawLabelBorder?w`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${r?w`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${w.float(JR)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${w.float(yo)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        fragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        fragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:w`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          fragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${t.debugDrawLabelBorder?w`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;return t.output===U.Alpha&&s.code.add(w`
      void main() {
        ${l}
        fragColor = vec4(fragColor.a);
      }
      `),t.output===U.ObjectAndLayerIdColor&&s.code.add(w`
      void main() {
        ${l}
        outputObjectAndLayerIdColor();
      }
      `),t.output===U.Color&&s.code.add(w`
    void main() {
      ${l}
      ${t.transparencyPassType===ut.FrontFace?"fragColor.rgb /= fragColor.a;":""}
    }
    `),t.output===U.Highlight&&(e.include(Ly,t),s.code.add(w`
    void main() {
      ${l}
      ${t.binaryHighlightOcclusionEnabled?w`
          if (voccluded == 1.0) {
            fragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            fragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),e}function rae(t){return t.outlineColor[3]>0&&t.outlineSize>0}function PF(t,e=TEe){return t.textureIsSignedDistanceField?Dnt(t.anchorPosition,t.distanceFieldBoundingBox,e):fn(e,t.anchorPosition),e}function Dnt(t,e,r){e!=null?ar(r,t[0]*(e[2]-e[0])+e[0],t[1]*(e[3]-e[1])+e[1]):ar(r,0,0)}const TEe=Ge(),Nnt=Object.freeze(Object.defineProperty({__proto__:null,build:Lnt,calculateAnchorPosForRendering:PF},Symbol.toStringTag,{value:"Module"})),xu=Eo(xe.SRC_ALPHA,xe.ONE,xe.ONE_MINUS_SRC_ALPHA,xe.ONE_MINUS_SRC_ALPHA),Fnt=Lc(xe.ONE,xe.ONE),SEe=Lc(xe.ZERO,xe.ONE_MINUS_SRC_ALPHA);function Dy(t){return t===ut.FrontFace?null:t===ut.Alpha?SEe:Fnt}function AU(t){return t===ut.FrontFace?Ul:null}const OU=5e5,RU={factor:-1,units:-2};function MU(t){return t?RU:null}function Ov(t,e=ti.LESS){return t===ut.NONE||t===ut.FrontFace?e:ti.LEQUAL}let EEe=class CEe extends Lr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Ue.Global}initializeProgram(e){return new Rr(e.rctx,CEe.shader.get().build(this.configuration),Tr)}_setPipelineState(e){const r=this.configuration,i=e===ut.NONE,s=e===ut.FrontFace,n=this.configuration.hasPolygonOffset?Unt:null,o=(i||s)&&r.output!==U.Highlight&&(r.depthEnabled||r.occlusionPass)?Ul:null;return Mt({blending:r.output===U.Color||r.output===U.Alpha||r.output===U.Highlight?i?knt:Dy(e):null,depthTest:{func:ti.LEQUAL},depthWrite:o,colorWrite:Gt,polygonOffset:n})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return this.configuration.occlusionPass?At.POINTS:At.TRIANGLES}};EEe.shader=new Or(Nnt,()=>ce(()=>import("./HUDMaterial.glsl-dfd89b42.js"),[],import.meta.url));const Unt={factor:0,units:-4},knt=Lc(xe.ONE,xe.ONE_MINUS_SRC_ALPHA);let As=class extends Vo{constructor(){super(...arguments),this.output=U.Color,this.screenCenterOffsetUnitsEnabled=Al.World,this.transparencyPassType=ut.NONE,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.binaryHighlightOcclusionEnabled=!0,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.hasMultipassGeometry=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}};u([B({count:U.COUNT})],As.prototype,"output",void 0),u([B({count:Al.COUNT})],As.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([B({count:ut.COUNT})],As.prototype,"transparencyPassType",void 0),u([B()],As.prototype,"spherical",void 0),u([B()],As.prototype,"occlusionTestEnabled",void 0),u([B()],As.prototype,"signedDistanceFieldEnabled",void 0),u([B()],As.prototype,"vvSize",void 0),u([B()],As.prototype,"vvColor",void 0),u([B()],As.prototype,"hasVerticalOffset",void 0),u([B()],As.prototype,"hasScreenSizePerspective",void 0),u([B()],As.prototype,"debugDrawLabelBorder",void 0),u([B()],As.prototype,"binaryHighlightOcclusionEnabled",void 0),u([B()],As.prototype,"hasSlicePlane",void 0),u([B()],As.prototype,"hasPolygonOffset",void 0),u([B()],As.prototype,"depthEnabled",void 0),u([B()],As.prototype,"pixelSnappingEnabled",void 0),u([B()],As.prototype,"draped",void 0),u([B()],As.prototype,"hasMultipassGeometry",void 0),u([B()],As.prototype,"hasMultipassTerrain",void 0),u([B()],As.prototype,"cullAboveGround",void 0),u([B()],As.prototype,"occlusionPass",void 0),u([B()],As.prototype,"objectAndLayerIdColorInstanced",void 0),u([B({constValue:!0})],As.prototype,"hasSliceInVertexProgram",void 0),u([B({constValue:!1})],As.prototype,"hasVvInstancing",void 0);let EE=class extends Av{constructor(e){super(e,new Znt),this._configuration=new As}getConfiguration(e,r){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?Al.Screen:Al.World,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.isDraped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=r.slot===he.OCCLUSION_PIXELS&&this.parameters.occlusionTest&&(e===U.Color||e===U.Alpha),e===U.Color&&(this._configuration.debugDrawLabelBorder=!!ai.LABELS_SHOW_BORDER),e===U.Highlight&&(this._configuration.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassGeometry=r.multipassGeometry.enabled,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}intersect(e,r,i,s,n,o){if(!i.options.selectionMode||!i.options.hud||!e.visible)return;const a=this.parameters;let l=1,c=1;if(Vh(bk,r),e.shaderTransformer!=null){const T=e.shaderTransformer(nae);l=T[0],c=T[5],Bnt(bk)}const h=e.vertexAttributes.get(C.POSITION),p=e.vertexAttributes.get(C.SIZE),f=e.vertexAttributes.get(C.NORMAL),m=e.vertexAttributes.get(C.AUXPOS1);nt(h.size>=3);const y=i.point,_=i.camera,v=PF(a);l*=_.pixelRatio,c*=_.pixelRatio;const b=this.parameters.centerOffsetUnits==="screen";for(let T=0;T<h.data.length/h.size;T++){const x=T*h.size;se(Jo,h.data[x],h.data[x+1],h.data[x+2]),Fe(Jo,Jo,r);const S=T*p.size;c0[0]=p.data[S]*l,c0[1]=p.data[S+1]*c,Fe(Jo,Jo,_.viewMatrix);const E=T*m.size;if(se(Bc,m.data[E],m.data[E+1],m.data[E+2]),!b&&(Jo[0]+=Bc[0],Jo[1]+=Bc[1],Bc[2]!==0)){const R=Bc[2];ye(Bc,Jo),de(Jo,Jo,ie(Bc,Bc,R))}const A=T*f.size;if(se(sA,f.data[A],f.data[A+1],f.data[A+2]),this._normalAndViewAngle(sA,bk,_,wk),this._applyVerticalOffsetTransformationView(Jo,wk,_,vk),_.applyProjection(Jo,Oa),Oa[0]>-1){Oa[0]=Math.floor(Oa[0]),Oa[1]=Math.floor(Oa[1]),b&&(Bc[0]||Bc[1])&&(Oa[0]+=Bc[0],Bc[1]!==0&&(Oa[1]+=iQ(Bc[1],vk.factorAlignment)),_.unapplyProjection(Oa,Jo)),Oa[0]+=this.parameters.screenOffset[0],Oa[1]+=this.parameters.screenOffset[1],I2e(c0,vk.factor,c0);const R=qnt*_.pixelRatio;let M=0;if(a.textureIsSignedDistanceField&&(M=a.outlineSize*_.pixelRatio/2),y&&iae(y,Oa[0],Oa[1],c0,R,M,a,v)){const D=i.ray;if(Fe(sae,Jo,Mn(Hnt,_.viewMatrix)),Oa[0]=y[0],Oa[1]=y[1],_.unprojectFromRenderScreen(Oa,Jo)){const k=O();re(k,D.direction);const $=1/Oe(k);ie(k,k,$),o(fi(D.origin,Jo)*$,k,-1,!0,1,sae)}}}}}intersectDraped(e,r,i,s,n,o){const a=e.vertexAttributes.get(C.POSITION),l=e.vertexAttributes.get(C.SIZE),c=this.parameters,h=PF(c);let p=1,f=1;if(e.shaderTransformer!=null){const y=e.shaderTransformer(nae);p=y[0],f=y[5]}p*=e.screenToWorldRatio,f*=e.screenToWorldRatio;const m=Wnt*e.screenToWorldRatio;for(let y=0;y<a.data.length/a.size;y++){const _=y*a.size,v=a.data[_],b=a.data[_+1],T=y*l.size;c0[0]=l.data[T]*p,c0[1]=l.data[T+1]*f;let x=0;c.textureIsSignedDistanceField&&(x=c.outlineSize*e.screenToWorldRatio/2),iae(s,v,b,c0,m,x,c,h)&&n(o.dist,o.normal,-1,!1)}}createBufferWriter(){return new Jnt(this)}_normalAndViewAngle(e,r,i,s){return wst(r)&&(r=Vh(jnt,r)),wc(s.normal,e,r),Fe(s.normal,s.normal,i.viewInverseTransposeMatrix),s.cosAngle=fe(AEe,Xnt),s}_updateScaleInfo(e,r,i){const s=this.parameters;s.screenSizePerspective!=null?Goe(i,r,s.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),s.screenSizePerspectiveAlignment!=null?Goe(i,r,s.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)}applyShaderOffsetsView(e,r,i,s,n,o,a){const l=this._normalAndViewAngle(r,i,n,wk);return this._applyVerticalGroundOffsetView(e,l,n,a),this._applyVerticalOffsetTransformationView(a,l,n,o),this._applyPolygonOffsetView(a,l,s[3],n,a),this._applyCenterOffsetView(a,s,a),a}applyShaderOffsetsNDC(e,r,i,s,n){return this._applyCenterOffsetNDC(e,r,i,s),n!=null&&re(n,s),this._applyPolygonOffsetNDC(s,r,i,s),s}_applyPolygonOffsetView(e,r,i,s,n){const o=s.aboveGround?1:-1;let a=Math.sign(i);a===0&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return re(n,e);const c=ve(Math.abs(r.cosAngle),.01,1),h=1-Math.sqrt(1-c*c)/c/s.viewport[2];return ie(n,e,l>0?h:1/h),n}_applyVerticalGroundOffsetView(e,r,i,s){const n=Oe(e),o=i.aboveGround?1:-1,a=.5*i.computeRenderPixelSizeAtDist(n),l=ie(Jo,r.normal,o*a);return ue(s,e,l),s}_applyVerticalOffsetTransformationView(e,r,i,s){const n=this.parameters;if(!n.verticalOffset||!n.verticalOffset.screenLength){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const c=Oe(e);this._updateScaleInfo(s,c,r.cosAngle)}else s.factor.scale=1,s.factorAlignment.scale=1;return e}const o=Oe(e),a=n.screenSizePerspectiveAlignment??n.screenSizePerspective,l=q2e(i,o,n.verticalOffset,r.cosAngle,a);return this._updateScaleInfo(s,o,r.cosAngle),ie(r.normal,r.normal,l),ue(e,e,r.normal)}_applyCenterOffsetView(e,r,i){const s=this.parameters.centerOffsetUnits!=="screen";return i!==e&&re(i,e),s&&(i[0]+=r[0],i[1]+=r[1],r[2]&&(ye(sA,i),ue(i,i,ie(sA,sA,r[2])))),i}_applyCenterOffsetNDC(e,r,i,s){const n=this.parameters.centerOffsetUnits!=="screen";return s!==e&&re(s,e),n||(s[0]+=r[0]/i.fullWidth*2,s[1]+=r[1]/i.fullHeight*2),s}_applyPolygonOffsetNDC(e,r,i,s){const n=this.parameters.shaderPolygonOffset;if(e!==s&&re(s,e),n){const o=i.aboveGround?1:-1,a=o*Math.sign(r[3]);s[2]-=(a||o)*n}return s}requiresSlot(e,r){if(r===U.Color||r===U.Alpha||r===U.Highlight||r===U.ObjectAndLayerIdColor){if(e===he.DRAPED_MATERIAL)return!0;const{drawInSecondSlot:i,occlusionTest:s}=this.parameters;return e===(i?he.LABEL_MATERIAL:he.HUD_MATERIAL)||s&&e===he.OCCLUSION_PIXELS}return!1}createGLMaterial(e){return new znt(e)}calculateRelativeScreenBounds(e,r,i=Vt()){return Vnt(this.parameters,e,r,i),i[2]=i[0]+e[0],i[3]=i[1]+e[1],i}},znt=class extends mJ{constructor(e){super({...e,...e.material.parameters})}selectProgram(e){return this.ensureTechnique(EEe,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}};function Vnt(t,e,r,i=Gnt){return fn(i,t.anchorPosition),i[0]*=-e[0],i[1]*=-e[1],i[0]+=t.screenOffset[0]*r,i[1]+=t.screenOffset[1]*r,i}function Bnt(t){const e=t[0],r=t[1],i=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=1/Math.sqrt(e*e+r*r+i*i),p=1/Math.sqrt(s*s+n*n+o*o),f=1/Math.sqrt(a*a+l*l+c*c);return t[0]=e*h,t[1]=r*h,t[2]=i*h,t[3]=s*p,t[4]=n*p,t[5]=o*p,t[6]=a*f,t[7]=l*f,t[8]=c*f,t}function iae(t,e,r,i,s,n,o,a){let l=e-s-(a[0]>0?i[0]*a[0]:0),c=l+i[0]+2*s,h=r-s-(a[1]>0?i[1]*a[1]:0),p=h+i[1]+2*s;const f=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&f!=null&&(l+=i[0]*f[0],h+=i[1]*f[1],c-=i[0]*(1-f[2]),p-=i[1]*(1-f[3]),l-=n,c+=n,h-=n,p+=n),t[0]>l&&t[0]<c&&t[1]>h&&t[1]<p}const vk=new Y2e,Gnt=Ge(),Jo=O(),sA=O(),Oa=Xt(),AEe=O(),sae=O(),bk=Ui(),jnt=Ui(),Hnt=be(),Bc=O(),wk={normal:AEe,cosAngle:0},nae=be(),qnt=1,Wnt=2,c0=[0,0],Xnt=Me(0,0,1);let Znt=class extends cTe{constructor(){super(...arguments),this.renderOccluded=Di.Occlude,this.color=Nt(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=fr(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.outlineColor=Nt(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.binaryHighlightOcclusion=!0,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1}};const OEe=Hi().vec3f(C.POSITION).vec3f(C.NORMAL).vec2f(C.UV0).vec4u8(C.COLOR).vec2f(C.SIZE).vec4f(C.AUXPOS1).vec4f(C.AUXPOS2),Ynt=OEe.clone().vec4u8(C.OBJECTANDLAYERIDCOLOR);let Jnt=class{constructor(e){this._material=e,this.vertexBufferLayout=oe("enable-feature:objectAndLayerId-rendering")?Ynt:OEe}elementCount(e){return 6*e.indices.get(C.POSITION).length}write(e,r,i,s,n){uQ(i.indices.get(C.POSITION),i.vertexAttributes.get(C.POSITION).data,e,s.position,n,6),hQ(i.indices.get(C.NORMAL),i.vertexAttributes.get(C.NORMAL).data,r,s.normal,n,6);const o=i.vertexAttributes.get(C.UV0).data;let a,l,c,h;if(o==null||o.length<4){const b=this._material.parameters;a=0,l=0,c=b.texCoordScale[0],h=b.texCoordScale[1]}else a=o[0],l=o[1],c=o[2],h=o[3];c=Math.min(1.99999,c+1),h=Math.min(1.99999,h+1);let p=i.indices.get(C.POSITION).length,f=n;const m=s.uv0;for(let b=0;b<p;++b)m.set(f,0,a),m.set(f,1,l),f+=1,m.set(f,0,c),m.set(f,1,l),f+=1,m.set(f,0,c),m.set(f,1,h),f+=1,m.set(f,0,c),m.set(f,1,h),f+=1,m.set(f,0,a),m.set(f,1,h),f+=1,m.set(f,0,a),m.set(f,1,l),f+=1;Q2e(i.indices.get(C.COLOR),i.vertexAttributes.get(C.COLOR).data,4,s.color,n,6);const y=i.indices.get(C.SIZE),_=i.vertexAttributes.get(C.SIZE).data;p=y.length;const v=s.size;f=n;for(let b=0;b<p;++b){const T=_[2*y[b]],x=_[2*y[b]+1];for(let S=0;S<6;++S)v.set(f,0,T),v.set(f,1,x),f+=1}if(i.indices.get(C.AUXPOS1)&&i.vertexAttributes.get(C.AUXPOS1)?xE(i.indices.get(C.AUXPOS1),i.vertexAttributes.get(C.AUXPOS1).data,s.auxpos1,n,6):Joe(s.auxpos1,n,6*p),i.indices.get(C.AUXPOS2)&&i.vertexAttributes.get(C.AUXPOS2)?xE(i.indices.get(C.AUXPOS2),i.vertexAttributes.get(C.AUXPOS2).data,s.auxpos2,n,6):Joe(s.auxpos2,n,6*p),i.objectAndLayerIdColor!=null&&i.indices.get(C.POSITION)){const b=i.indices.get(C.POSITION).length,T=s.getField(C.OBJECTANDLAYERIDCOLOR,ga);K2e(i.objectAndLayerIdColor,T,b,n,6)}}};const Bp=O(),eT=Xt(),nA=Xt(),xk=O(),Qnt=be(),Knt=bs(),Tk=Jn(),eot=O(),tot=Vt();class rot{constructor(){this.aabr=Vt(),this.distance=0,this.culled=!1,this.visible=!1}}class iot{constructor(e,r){this.graphics3DGraphic=e,this.slicePlaneEnabled=r,this.info={}}}var oc;(function(t){t[t.Idle=0]="Idle",t[t.Process=1]="Process",t[t.Sort=2]="Sort",t[t.Deconflict=3]="Deconflict",t[t.NumStates=4]="NumStates"})(oc||(oc={}));class REe{constructor(){this.camera=new gt,this.slicePlane=Ey(),this.slicePlaneEnabled=!1}copyFrom(e){this.camera.copyFrom(e.camera),fx(e.slicePlane,this.slicePlane),this.slicePlaneEnabled=e.slicePlaneEnabled}}let WS=class extends we{get dirty(){return this._dirty}get state(){return this._state}constructor(t){super(t),this._dirty=!1,this._runningViewState=new REe,this._state=oc.Idle,this._active=new Map,this._visible=new Map,this._iterators=new aot,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0}destroy(){this._active.clear(),this._visible.clear(),this._iterators=null}setDirty(){!this._dirty&&this._active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==oc.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const t=this._state/oc.NumStates;return this._dirty?.5*t:t}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(t){switch(this._state){case oc.Idle:this._startUpdate(),t.madeProgress();case oc.Process:if(this._state=oc.Process,!this._processActiveGraphics(t))return;case oc.Sort:if(this._state=oc.Sort,!this._sortVisibleGraphics(t))return;case oc.Deconflict:if(this._state=oc.Deconflict,!this._deconflictVisibleGraphics(t))return;default:ust(this,this._visible),this._state=oc.Idle,this.notifyChange("updating")}}modifyGraphics(t,e){e?t.forEach(r=>this.addToActiveGraphics(r)):t.forEach(r=>this.removeFromActiveGraphics(r)),this.setDirty()}layerSupportsDeconfliction(t){if(t==null||t.type!=="object3d")return!1;const e=t.stageObject;return(e?e.geometries.length:0)!==1?!1:e?.geometries[0]?.material instanceof EE}_startUpdate(){hst(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);const{fullWidth:t,fullHeight:e}=this._runningViewState.camera;this._initBins(t,e),this._resetIterators()}addToActiveGraphics(t){t.info[this.visibilityGroup]=new rot,this._active.set(t.graphics3DGraphic.graphic.uid,t),this.setDirty()}removeFromActiveGraphics(t){this._visible.delete(t.graphics3DGraphic.graphic.uid),sot(t,this.visibilityGroup),delete t.info[this.visibilityGroup],this._active.delete(t.graphics3DGraphic.graphic.uid),this.setDirty()}_processActiveGraphics(t){const e=this._ensureActiveGraphicsIterator(),r=rC(Qnt,this._runningViewState.camera.projectionMatrix),i=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._runningViewState.camera.relativeElevation>0?Knt:null;let s=0;for(i!=null&&(Fe(i,Ka,this._runningViewState.camera.viewMatrix),i[3]=zr(this.view.spatialReference).radius,s=ewe(i,Ka));!t.done;){t.madeProgress();const n=e.next();if(n.done===!0)return this._resetActiveGraphicsIterator(),!0;const o=n.value,a=o&&o.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,r,i,s),a.culled?this._visible.delete(o.graphics3DGraphic.graphic.uid):this._visible.set(o.graphics3DGraphic.graphic.uid,o))}return!1}_sortVisibleGraphics(t){const e=this._ensureSortGraphicsIterator();for(;!t.done;){const r=e.next();if(t.madeProgress(),r.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(t){const e=this._ensureVisibleGraphicsIterator(),r=this.visibilityGroup===Yn.LABEL;for(;!t.done;){t.madeProgress();const i=e.next();if(i.done===!0)return this._resetVisibleGraphicsIterator(),!0;const s=i.value,n=s.info[this.visibilityGroup];if(!n||n.culled)continue;const o=s.graphics3DGraphic,a=!r||o.isVisible();n.visible=a&&!this._isConflicted(s),n.visible&&this._addToBins(s),this._setGraphicVisibility(s,n.visible),pst(n,n.visible)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=oae(this._active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=oae(this._visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=not(this._visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(t,e,r,i){const s=t.graphics3DGraphic;if(s.destroyed)return;const n=t.info[this.visibilityGroup];if(!s.isVisible(Yn.GRAPHIC,Bo.DECONFLICTION))return void(n.culled=!0);const o=this.getGraphicsLayers(s);Ic(n.aabr);let a=null;for(const l of o){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometries[0].material;if(a==null&&(a=uot,this._getProjectionInfo(l,e,a),a.isOutsideScreen||this._isCulledBySlice(t,Bp)||r!=null&&this._isCulledByHorizon(a,r,i)))return void(n.culled=!0);this._expandBoundingRect(n,l,c,a)}a==null?n.culled=!0:(n.distance=a.distance,n.culled=!1)}_getProjectionInfo(t,e,r){const i=this._runningViewState.camera,s=t.stageObject,n=s.geometries[0],o=n.material,a=s.boundingVolumeWorldSpace.bounds;Fe(Bp,a,i.viewMatrix);const l=n.vertexAttributes,c=l.get(C.NORMAL).data,h=l.get(C.AUXPOS1).data;o.applyShaderOffsetsView(Bp,c,s.transformation,h,i,r.scaleInfo,Bp),xi(eT,Bp[0],Bp[1],Bp[2],1),mu(nA,eT,i.projectionMatrix),ie(r.positionNDC,nA,1/nA[3]),o.applyShaderOffsetsNDC(r.positionNDC,h,i,r.positionNDC,xk),r.distanceWithoutPolygonOffset=i.depthNDCToWorld(xk[2]),r.distance=xk[2]===r.positionNDC[2]?r.distanceWithoutPolygonOffset:i.depthNDCToWorld(r.positionNDC[2]),xi(nA,r.positionNDC[0],r.positionNDC[1],r.positionNDC[2],1),mu(eT,nA,e),Tw(eT,eT,1/eT[3]),se(r.positionView,Bp[0],Bp[1],Bp[2])}_isCulledByHorizon(t,e,r){return re(Tk.direction,t.positionView),se(Tk.origin,0,0,0),!!Sv(e,Tk,eot)&&t.distanceWithoutPolygonOffset>r}_isCulledBySlice(t,e){return t.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&XY(this._runningViewState.slicePlane,e)}_expandBoundingRect(t,e,r,{positionNDC:i,scaleInfo:s}){const n=this._runningViewState.camera,o=e.getScreenSize(lot);I2e(o,s.factor,o),o[0]*=n.pixelRatio,o[1]*=n.pixelRatio;const a=b4(r.calculateRelativeScreenBounds(o,s.factorAlignment.scale,tot),St(0,n.fullWidth,.5+.5*i[0]),St(0,n.fullHeight,.5+.5*i[1])),l=this.iconMarginFactor;if(l!==0){const c=l*Math.min(pu(a),wp(a));a[0]-=c,a[1]-=c,a[2]+=c,a[3]+=c}V_(t.aabr,a,t.aabr)}_isConflicted(t){const e=t.graphics3DGraphic.graphic.uid,r=t.info[this.visibilityGroup];for(let i=Math.floor(r.aabr[0]/this._accBinsSizeX);i<=Math.floor(r.aabr[2]/this._accBinsSizeX);i++)if(!(i<0||i>=this._accBinsNumX))for(let s=Math.floor(r.aabr[1]/this._accBinsSizeY);s<=Math.floor(r.aabr[3]/this._accBinsSizeY);s++){if(s<0||s>=this._accBinsNumY)continue;const n=this._accBins[i][s];for(let o=0;o<n.length;o++){const a=n.data[o],l=a.info[this.visibilityGroup];if(l&&l.visible&&a.graphics3DGraphic.graphic.uid!==e&&(this.accNumTests++,OM(l.aabr,r.aabr)))return!0}}return!1}_initBins(t,e){if(this._accBins==null){this._accBins=[];for(let r=0;r<this._accBinsNumX;r++){this._accBins.push([]);const i=this._accBins[this._accBins.length-1];for(let s=0;s<this._accBinsNumY;s++)i.push(new Bt)}}else for(let r=0;r<this._accBinsNumX;r++)for(let i=0;i<this._accBinsNumY;i++)this._accBins[r][i].clear();this._accBinsSizeX=t/this._accBinsNumX,this._accBinsSizeY=e/this._accBinsNumY,this.accNumTests=0}_addToBins(t){const e=t.info[this.visibilityGroup],r=Math.floor(e.aabr[0]/this._accBinsSizeX),i=Math.floor(e.aabr[2]/this._accBinsSizeX),s=Math.floor(e.aabr[1]/this._accBinsSizeY),n=Math.floor(e.aabr[3]/this._accBinsSizeY);for(let o=r;o<=i;o++)if(!(o<0||o>=this._accBinsNumX))for(let a=s;a<=n;a++)a<0||a>=this._accBinsNumY||this._accBins[o][a].push(t)}_setGraphicVisibility(t,e){const r=t.graphics3DGraphic;r.destroyed||(r.setVisibilityFlag(this.visibilityGroup,Bo.DECONFLICTION,e),this.visibilityGroup===Yn.LABEL&&this.view.labeler.setLabelGraphicVisibility(r,e))}};function sot(t,e){const r=t.graphics3DGraphic;r.destroyed||r.setVisibilityFlag(e,Bo.DECONFLICTION,!0)}function*oae(t){if(Map.prototype.entries){const e=t.entries();for(let r=e.next();!r.done;r=e.next())yield r.value[1]}else yield*t.values()}function*not(t,e,r){e.clear(),t.forEach((s,n)=>{const o=e.pushNew();o.id=n,o.visible=s.graphics3DGraphic.getVisibilityFlag(r,Bo.DECONFLICTION);const a=s.info&&s.info[r];o.prio=s.graphics3DGraphic.deconflictionPriority,o.distance=a?a.distance:Number.MAX_VALUE}),yield;const i=e.iterableSort((s,n)=>s.prio!==n.prio?n.prio-s.prio:s.distance!==n.distance?s.distance-n.distance:s.visible!==n.visible?s.visible?-1:1:s.id-n.id);for(let s=i.next();!s.done;s=i.next())yield;e.forAll(s=>{const n=t.get(s.id);n&&(t.delete(s.id),t.set(s.id,n))}),e.clear()}u([d({constructOnly:!0})],WS.prototype,"view",void 0),u([d({type:Boolean,readOnly:!0})],WS.prototype,"updating",null),WS=u([P("esri.views.3d.layers.graphics.Deconflictor")],WS);class oot{constructor(){this.id=0,this.visible=!1,this.prio=0,this.distance=0}}class aot{constructor(e=null,r=null,i=null){this.active=e,this.visible=r,this.sort=i,this.sortArray=new Bt({allocator:s=>s||new oot})}}const lot=Ge();class cot{constructor(){this.positionView=O(),this.positionNDC=O(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo=new Y2e}get isOutsideScreen(){const e=this.positionNDC;return e[0]<-1||e[1]<-1||e[2]<-1||e[0]>=1||e[1]>=1}}const uot=new cot,hot=2e3;let dN=class extends WS{constructor(e){super(e),this.visibilityGroup=Yn.LABEL,this.iconMarginFactor=0,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return Wo.YIELD;const r=performance.now();if(e.state!==Fr.IDLE&&r-this._lastDeconfliction<hot)return Wo.YIELD;super.runTask(e),this.state===oc.Idle&&(this._lastDeconfliction=r)}enabledChanged(e,r){this.modifyGraphics(r,e.labelsEnabled)}getGraphicsLayers(e){return e.labelLayers}};u([d({constructOnly:!0})],dN.prototype,"parent",void 0),dN=u([P("esri.views.3d.layers.graphics.LabelDeconflictor")],dN);let Pq=class extends WS{constructor(){super(...arguments),this._handles=new Ii,this._contexts=new Map,this._viewState=new REe,this.visibilityGroup=Yn.GRAPHIC,this._iconMarginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._handles.add([ae(()=>this.view?.state?.camera,()=>{this._updateViewState(),this.setDirty()}),ae(()=>this.view?.map?.ground?.opacity,(e,r)=>{e!==1&&r!==1||this.setDirty()}),ae(()=>this.view?.slicePlane,()=>{this._updateSlicePlane(),this._slicePlaneChanged()},Pr)]),this._frameTask=this.view.resourceController.scheduler.registerTask(vt.GRAPHICS_DECONFLICTOR,this),this._labels=new dN({view:this.view,parent:this})}destroy(){this._labels.destroy(),this._labels=null,this._handles.destroy(),this._handles=null,this._frameTask&&(this._frameTask.remove(),this._frameTask=null)}get iconMarginFactor(){return this._iconMarginFactor}set iconMarginFactor(e){this._iconMarginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,r){const i=!(this._graphicSupportsDeconfliction(r)&&Sk(e));r.setVisibilityFlag(Yn.GRAPHIC,Bo.DECONFLICTION,i)}_updateViewState(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;e!=null&&Mwe(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=e!=null}_slicePlaneChanged(){ko(this._contexts,(e,r)=>r.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){const r=this._getGraphicsContext(e);return{addGraphic:i=>this._addGraphic(e,r,i),removeGraphic:i=>this._removeGraphic(r,i),labelingInfoChange:()=>this._labels.enabledChanged(e,r),featureReductionChange:()=>this.enabledChanged(e,r),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,r),clear:()=>r.forEach(i=>this._removeGraphic(r,i.graphics3DGraphic))}}removeGraphicsOwner(e){const r=this._contexts.get(e);r&&(r.forEach(i=>this._removeGraphic(r,i.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,r,i){const s=i.graphic.uid,n=new iot(i,e.symbolCreationContext.slicePlaneEnabled);r.set(s,n),Sk(e)&&this.addToActiveGraphics(n),e.labelsEnabled&&this._labels.addToActiveGraphics(n)}_removeGraphic(e,r){const i=r.graphic.uid,s=e.get(i);s&&(this.removeFromActiveGraphics(s),this._labels.removeFromActiveGraphics(s),e.delete(i),this.setDirty())}enabledChanged(e,r){const i=Sk(e);i||dot(e),this.modifyGraphics(r,i)}_slicePlaneEnabledChanged(e,r){const i=e.symbolCreationContext.slicePlaneEnabled;r.forEach(s=>s.slicePlaneEnabled=i),this.setDirty()}getGraphicsLayers(e){return e.layers}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const r=e.layers;if(!r||!r.length)return!1;for(const i of r)if(this.layerSupportsDeconfliction(i))return!0;return!1}_getGraphicsContext(e){const r=this._contexts.get(e);if(r)return r;const i=new Map;return this._contexts.set(e,i),this.setDirty(),i}};function Sk(t){const e=t.layer;return!(!e||!e.featureReduction||e.featureReduction.type!=="selection")}function dot(t){const e=t.graphics3DGraphics;e&&e.forEach(r=>r.setVisibilityFlag(Yn.GRAPHIC,Bo.DECONFLICTION,!0))}Pq=u([P("esri.views.3d.layers.graphics.GraphicsDeconflictor")],Pq);function MEe(t){return 32+t.length}function PEe(t){return 16}function IEe(t){if(!t)return 0;let e=DEe;for(const r in t)if(t.hasOwnProperty(r)){const i=t[r];switch(typeof i){case"string":e+=MEe(i);break;case"number":e+=PEe();break;case"boolean":e+=4}}return e}function $Ee(t){if(!t)return 0;if(Array.isArray(t))return pot(t);let e=DEe;for(const r in t)t.hasOwnProperty(r)&&(e+=LEe(t[r]));return e}function pot(t){const e=t.length;if(e===0||typeof t[0]=="number")return 32+8*e;let r=NEe;for(let i=0;i<e;i++)r+=LEe(t[i]);return r}function LEe(t){switch(typeof t){case"object":return $Ee(t);case"string":return MEe(t);case"number":return PEe();case"boolean":return 4;default:return 8}}function BUt(t,e){return NEe+t.length*e}const DEe=32,NEe=32,gQ=(t,e,r)=>[e,r],CE=(t,e,r)=>[e,r,t[2]],yQ=(t,e,r)=>[e,r,t[2],t[3]];function GUt(t){return t?{originPosition:t.originPosition==="upper-left"?"upperLeft":t.originPosition==="lower-left"?"lowerLeft":t.originPosition,scale:t.tolerance?[t.tolerance,t.tolerance]:[1,1],translate:t.extent!=null?[t.extent.xmin,t.extent.ymax]:[0,0]}:null}function fot({scale:t,translate:e},r){return Math.round((r-e[0])/t[0])}function mot({scale:t,translate:e},r){return Math.round((e[1]-r)/t[1])}function FEe({scale:t,translate:e},r){return r*t[0]+e[0]}function UEe({scale:t,translate:e},r){return e[1]-r*t[1]}function kEe(t,e,r){const i=new Array(r.length);if(!r.length)return i;const[s,n]=t.scale;let o=FEe(t,r[0][0]),a=UEe(t,r[0][1]);i[0]=e(r[0],o,a);for(let l=1;l<r.length;l++){const c=r[l];o+=c[0]*s,a-=c[1]*n,i[l]=e(c,o,a)}return i}function zEe(t,e,r){const i=new Array(r.length);for(let s=0;s<r.length;s++)i[s]=kEe(t,e,r[s]);return i}function got(t,e,r,i){return kEe(t,r?i?yQ:CE:i?CE:gQ,e)}function yot(t,e,r,i){return zEe(t,r?i?yQ:CE:i?CE:gQ,e)}function _ot(t,e,r,i){return zEe(t,r?i?yQ:CE:i?CE:gQ,e)}function jUt(t,e,r,i,s){return e.x=fot(t,r.x),e.y=mot(t,r.y),e!==r&&(i&&(e.z=r.z),s&&(e.m=r.m)),e}function VEe(t,e,r,i,s){return r!=null&&(e.points=got(t,r.points,i,s)),e}function BEe(t,e,r,i,s){return r==null||(e.x=FEe(t,r.x),e.y=UEe(t,r.y),e!==r&&(i&&(e.z=r.z),s&&(e.m=r.m))),e}function GEe(t,e,r,i,s){return r!=null&&(e.rings=_ot(t,r.rings,i,s)),e}function jEe(t,e,r,i,s){return r!=null&&(e.paths=yot(t,r.paths,i,s)),e}let HUt=class{constructor(e,r,i){this.uid=e,this.geometry=r,this.attributes=i,this.visible=!0,this.objectId=null,this.centroid=null}};function WUt(t){return t.geometry!=null}let XUt=class{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}};function YUt(t){const e=Jge.fromJSON(t.geometryType),r=je.fromJSON(t.spatialReference),i=t.transform,s=t.features.map(n=>{const o=vot(n,e,r,t.objectIdFieldName),a=o.geometry;if(a!=null&&i)switch(a.type){case"point":o.geometry=BEe(i,a,a,a.hasZ,a.hasM);break;case"multipoint":o.geometry=VEe(i,a,a,!!a.hasZ,!!a.hasM);break;case"polygon":o.geometry=GEe(i,a,a,!!a.hasZ,!!a.hasM);break;case"polyline":o.geometry=jEe(i,a,a,!!a.hasZ,!!a.hasM);break;case"extent":case"mesh":o.geometry=a}return o});return{geometryType:e,features:s,spatialReference:r,fields:t.fields?.map(n=>b6.fromJSON(n))??[],objectIdFieldName:t.objectIdFieldName,globalIdFieldName:t.globalIdFieldName,geohashFieldName:t.geohashFieldName,geometryProperties:t.geometryProperties,hasZ:t.hasZ,hasM:t.hasM,exceededTransferLimit:t.exceededTransferLimit,transform:null}}function vot(t,e,r,i){return{uid:Cc(),objectId:i&&t.attributes?t.attributes[i]:null,attributes:t.attributes,geometry:bot(t.geometry,e,r),visible:!0}}function bot(t,e,r){if(t==null)return null;switch(e){case"point":{const i=t;return{x:i.x,y:i.y,z:i.z,m:i.m,hasZ:i.z!=null,hasM:i.m!=null,type:"point",spatialReference:r}}case"polyline":{const i=t;return{paths:i.paths,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polyline",spatialReference:r}}case"polygon":{const i=t;return{rings:i.rings,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polygon",spatialReference:r}}case"multipoint":{const i=t;return{points:i.points,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"multipoint",spatialReference:r}}}}function vx(t,e,r,i){return{x:t,y:e,z:r,hasZ:r!=null,hasM:!1,spatialReference:i,type:"point"}}function wot(t){if(t==null)return 0;let e=32;switch(t.type){case"point":e+=42;break;case"polyline":case"polygon":{let r=0;const i=2+(t.hasZ?1:0)+(t.hasM?1:0),s=t.type==="polyline"?t.paths:t.rings;for(const n of s)r+=n.length;e+=8*r*i+64,e+=128*r,e+=34,e+=32*(s.length+1);break}case"multipoint":{const r=2+(t.hasZ?1:0)+(t.hasM?1:0),i=t.points.length;e+=8*i*r+64,e+=128*i,e+=34,e+=32;break}case"extent":e+=98,t.hasM&&(e+=32),t.hasZ&&(e+=32);break;case"mesh":e+=S_(t.vertexAttributes.position),e+=S_(t.vertexAttributes.normal),e+=S_(t.vertexAttributes.uv),e+=S_(t.vertexAttributes.tangent)}return e}function JUt(t){let e=32;return e+=IEe(t.attributes),e+=3,e+=8+wot(t.geometry),e}function xot(t){if(t==null)return 0;switch(t.type){case"point":return 1;case"polyline":{let e=0;for(const r of t.paths)e+=r.length;return e}case"polygon":{let e=0;for(const r of t.rings)e+=r.length;return e}case"multipoint":return t.points.length;case"extent":return 2;case"mesh":{const e=t.vertexAttributes&&t.vertexAttributes.position;return e?e.length/3:0}default:return}}function QUt(t){if(t==null)return!1;switch(t.type){case"extent":case"point":return!0;case"polyline":for(const e of t.paths)if(e.length>0)return!0;return!1;case"polygon":for(const e of t.rings)if(e.length>0)return!0;return!1;case"multipoint":return t.points.length>0;case"mesh":return!t.loaded||t.vertexAttributes.position.length>0}}function KUt(t,e){switch(Si(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[3]=t.x,e[1]=e[4]=t.y,t.hasZ&&(e[2]=e[5]=t.z);break;case"polyline":for(let r=0;r<t.paths.length;r++)U8(e,t.paths[r],!!t.hasZ);break;case"polygon":for(let r=0;r<t.rings.length;r++)U8(e,t.rings[r],!!t.hasZ);break;case"multipoint":U8(e,t.points,!!t.hasZ);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[3]=t.xmax,e[4]=t.ymax,t.zmin!=null&&(e[2]=t.zmin),t.zmax!=null&&(e[5]=t.zmax)}}function Tot(t,e){switch(Ic(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[2]=t.x,e[1]=e[3]=t.y;break;case"polyline":for(let r=0;r<t.paths.length;r++)C8(e,t.paths[r]);break;case"polygon":for(let r=0;r<t.rings.length;r++)C8(e,t.rings[r]);break;case"multipoint":C8(e,t.points);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax}}function e8t(t,e){return t.objectId!=null?t.objectId:t.attributes&&e?t.attributes[e]:null}function HEe(t){return"declaredClass"in t}function aae(t){return"declaredClass"in t}function Sot(t){return"declaredClass"in t}function Eot(t,e){return t?Sot(t)?t:new Nl({layer:e,sourceLayer:e,visible:t.visible,symbol:K(t.symbol),attributes:K(t.attributes),geometry:qEe(t.geometry)}):null}function qEe(t){return t==null?null:HEe(t)?t:Z_(Cot(t))}function Cot(t){const{wkid:e,wkt:r,latestWkid:i}=t.spatialReference,s={wkid:e,wkt:r,latestWkid:i};switch(t.type){case"point":{const{x:n,y:o,z:a,m:l}=t;return{x:n,y:o,z:a,m:l,spatialReference:s}}case"polygon":{const{rings:n,hasZ:o,hasM:a}=t;return{rings:lae(n),hasZ:o,hasM:a,spatialReference:s}}case"polyline":{const{paths:n,hasZ:o,hasM:a}=t;return{paths:lae(n),hasZ:o,hasM:a,spatialReference:s}}case"extent":{const{xmin:n,xmax:o,ymin:a,ymax:l,zmin:c,zmax:h,mmin:p,mmax:f,hasZ:m,hasM:y}=t;return{xmin:n,xmax:o,ymin:a,ymax:l,zmin:c,zmax:h,mmin:p,mmax:f,hasZ:m,hasM:y,spatialReference:s}}case"multipoint":{const{points:n,hasZ:o,hasM:a}=t;return{points:XEe(n)?WEe(n):n,hasZ:o,hasM:a,spatialReference:s}}default:return}}function lae(t){return Aot(t)?t.map(e=>WEe(e)):t}function WEe(t){return t.map(e=>Array.from(e))}function Aot(t){for(const e of t)if(e.length!==0)return XEe(e);return!1}function XEe(t){return t.length>0&&(kE(t[0])||zE(t[0]))}function Oot(t,e){if(!t)return null;let r;if(aae(t)){if(e==null)return t.clone();if(aae(e))return e.copy(t)}return e!=null?(r=e,r.x=t.x,r.y=t.y,r.spatialReference=t.spatialReference,t.hasZ?(r.z=t.z,r.hasZ=t.hasZ):(r.z=void 0,r.hasZ=!1),t.hasM?(r.m=t.m,r.hasM=!0):(r.m=void 0,r.hasM=!1)):(r=vx(t.x,t.y,t.z,t.spatialReference),t.hasM&&(r.m=t.m,r.hasM=!0)),r}function t8t(t){const{wkid:e,wkt:r,latestWkid:i}=t,s={wkid:e,wkt:r,latestWkid:i};return je.fromJSON(s)}const Ek=Q.getLogger("esri.layers.support.labelFormatUtils"),Ck={type:"simple",evaluate:()=>null},Rot={getAttribute:(t,e)=>t.field(e)};async function ZEe(t,e,r){if(!t||!t.symbol||!e)return Ck;const i=t.where,s=M6(t),n=i?await ce(()=>import("./WhereClause-e2c9f470.js").then(a=>a.W),["./WhereClause-e2c9f470.js","./executionError-e8d36121.js"],import.meta.url):null;let o;if(s.type==="arcade"){const a=await r5e(s.expression,r,e);if(a==null)return Ck;o={type:"arcade",evaluate(l){try{const c=a.evaluate({$feature:"attributes"in l?a.repurposeFeature(l):l},a.services);if(c!=null)return c.toString()}catch(c){Ek.error(new V("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:c,feature:l,expression:s}))}return null},needsHydrationToEvaluate:()=>yY(s.expression)==null}}else o={type:"simple",evaluate:a=>s.expression.replaceAll(/{[^}]*}/g,l=>{const c=l.slice(1,-1),h=e.get(c);if(!h)return l;let p=null;return"attributes"in a?a&&a.attributes&&(p=a.attributes[h.name]):p=a.field(h.name),p==null?"":YEe(p,h)})};if(i){let a;try{a=n.WhereClause.create(i,e)}catch(c){return Ek.error(new V("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:i,error:c})),Ck}const l=o.evaluate;o.evaluate=c=>{const h="attributes"in c?void 0:Rot;try{if(a.testFeature(c,h))return l(c)}catch(p){Ek.error(new V("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:i,feature:c,error:p}))}return null}}return o}function YEe(t,e){if(t==null)return"";const r=e.domain;if(r){if(r.type==="codedValue"||r.type==="coded-value"){const s=t;for(const n of r.codedValues)if(n.code===s)return n.name}else if(r.type==="range"){const s=+t,n="range"in r?r.range[0]:r.minValue,o="range"in r?r.range[1]:r.maxValue;if(n<=s&&s<=o)return r.name}}let i=t;return e.type==="date"||e.type==="esriFieldTypeDate"?i=cy(i,kA("short-date")):mZ(e)&&(i=X2(+i)),i||""}const r8t=Object.freeze(Object.defineProperty({__proto__:null,createLabelFunction:ZEe,formatField:YEe},Symbol.toStringTag,{value:"Module"}));let JEe=class{constructor(e=null,r="center",i="center",s=null,n=[0,0,0],o=0,a=[0,0,0,1],l=[0,0],c="world",h=0,p=0){this.verticalOffset=e,this.horizontalPlacement=r,this.verticalPlacement=i,this.text=s,this.translation=n,this.elevationOffset=o,this.centerOffset=a,this.screenOffset=l,this.centerOffsetUnits=c,this.displayWidth=h,this.displayHeight=p}};function _Q(t,e){if(t.type==="point")return u0(t,e,!1);if(HEe(t))switch(t.type){case"extent":return u0(t.center,e,!1);case"polygon":return u0(t.centroid,e,!1);case"polyline":return u0(cae(t),e,!0);case"mesh":return u0(t.origin,e,!1)}else switch(t.type){case"extent":return u0(Mot(t),e,!0);case"polygon":return u0(Pot(t),e,!0);case"polyline":return u0(cae(t),e,!0)}}function cae(t){const e=t.paths[0];if(!e||e.length===0)return null;const r=Mge(e,Rge(e)/2);return vx(r[0],r[1],r[2],t.spatialReference)}function Mot(t){return vx(.5*(t.xmax+t.xmin),.5*(t.ymax+t.ymin),t.zmin!=null&&t.zmax!=null&&isFinite(t.zmin)&&isFinite(t.zmax)?.5*(t.zmax+t.zmin):void 0,t.spatialReference)}function Pot(t){const e=t.rings[0];if(!e||e.length===0)return null;const r=$ge(t.rings,!!t.hasZ);return vx(r[0],r[1],r[2],t.spatialReference)}function u0(t,e,r){const i=r?t:Oot(t);return e&&t?E1e(t,i,e)?i:null:i}function s8t(t,e,r,i=0){if(t){e||(e=Vt());const s=t;let n=.5*s.width*(r-1),o=.5*s.height*(r-1);return s.width<1e-7*s.height?n+=o/20:s.height<1e-7*s.width&&(o+=n/20),xi(e,s.xmin-n-i,s.ymin-o-i,s.xmax+n+i,s.ymax+o+i),e}return null}function QEe(t,e){for(let r=0;r<t.geometries.length;++r){const i=t.geometries[r].getMutableAttribute(C.AUXPOS1);i&&i.data[3]!==e&&(i.data[3]=e,t.geometryVertexAttrsUpdated(t.geometries[r]))}}function XO(t,e,r=null){const i=UM(Ch);return t!=null&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),e!=null?i[3]=e:t!=null&&t.length>3&&(i[3]=t[3]),r&&(i[0]*=r,i[1]*=r,i[2]*=r,i[3]*=r),i}function n8t(t,e,r,i,s,n=[0,0,0,0]){for(let o=0;o<3;++o)t!=null&&t[o]!=null?n[o]=t[o]:r!=null&&r[o]!=null?n[o]=r[o]:n[o]=s[o];return n[3]=e??i??s[3],n}function uae(t=kg,e,r,i=1){const s=new Array(3);if(e==null||r==null)s[0]=1,s[1]=1,s[2]=1;else{let n,o=0;for(let a=2;a>=0;a--){const l=t[a];let c;const h=l!=null,p=a===0&&!n&&!h,f=r[a];l==="symbol-value"||p?c=f!==0?e[a]/f:1:h&&l!=="proportional"&&isFinite(l)&&(c=f!==0?l/f:1),c!=null&&(s[a]=c,n=c,o=Math.max(o,Math.abs(c)))}for(let a=2;a>=0;a--)s[a]==null?s[a]=n:s[a]===0&&(s[a]=.001*o)}for(let n=2;n>=0;n--)s[n]/=i;return Wa(s)}function Iot(t){return t.isPrimitive!=null}function PU(t){return Iq(Iot(t)?[t.width,t.depth,t.height]:t)?null:"Symbol sizes may not be negative values"}function Iq(t){const e=r=>r==null||r>=0;return Array.isArray(t)?t.every(e):e(t)}function $ot(t,e,r,i=be()){return t&&tE(i,i,-t/180*Math.PI),e&&eE(i,i,e/180*Math.PI),r&&S6(i,i,r/180*Math.PI),i}function vQ(t,e,r){if(r.minDemResolution!=null)return r.minDemResolution;const i=_a(e),s=nx(t)*i,n=ox(t)*i,o=vv(t)*(e.isGeographic?1:i);return s===0&&n===0&&o===0?r.minDemResolutionForPoints:.01*Math.max(s,n,o)}function KEe(t,e,r,i,s,n,o,a,l,c,h){const p=Vot[h.mode];let f,m,y=0;if(li(t,e,r,i,l.spatialReference,s,a))return p.requiresAlignment(h)?(y=p.applyElevationAlignmentBuffer(i,s,n,o,a,l,c,h),f=n,m=o):(f=i,m=s),li(f,l.spatialReference,m,n,c.spatialReference,o,a)?y:void 0}function dv(t,e,r,i,s){const n=(wF(t)?t.z:i2e(t)?t.array[t.offset+2]:t[2])||0;switch(r.mode){case"on-the-ground":{const o=kf(e,t,"ground")??0;return s.verticalDistanceToGround=0,s.sampledElevation=o,void(s.z=o)}case"relative-to-ground":{const o=kf(e,t,"ground")??0,a=r.geometryZWithOffset(n,i);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"relative-to-scene":{const o=kf(e,t,"scene")??0,a=r.geometryZWithOffset(n,i);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"absolute-height":{const o=r.geometryZWithOffset(n,i),a=kf(e,t,"ground")??0;return s.verticalDistanceToGround=o-a,s.sampledElevation=a,void(s.z=o)}default:return void(s.z=0)}}function Lot(t,e,r,i){return dv(t,e,r,i,XS),XS.z}function oP(t,e,r){return e==null||r==null?t.definedChanged:e==="on-the-ground"&&r==="on-the-ground"?t.staysOnTheGround:e===r||e!=="on-the-ground"&&r!=="on-the-ground"?cs.UPDATE:t.onTheGroundChanged}function Wh(t){return t==="relative-to-ground"||t==="relative-to-scene"}function pv(t){return t!=="absolute-height"}function Dot(t,e,r,i,s){dv(e,r,s,i,XS),QEe(t,XS.verticalDistanceToGround);const n=XS.sampledElevation,o=Us(Bot,t.transformation);return w$[0]=e.x,w$[1]=e.y,w$[2]=XS.z,Pl(e.spatialReference,w$,o,i.spatialReference)?t.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),n}function Not(t,e,r,i,s,n){let o=0;const a=n.spatialReference;e*=3,i*=3;for(let l=0;l<s;++l){const c=t[e],h=t[e+1],p=t[e+2],f=n.getElevation(c,h,p,a,"ground")??0;o+=f,r[i]=c,r[i+1]=h,r[i+2]=f,e+=3,i+=3}return o/s}function Fot(t,e,r,i,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,p=n.spatialReference;e*=3,i*=3;for(let f=0;f<s;++f){const m=t[e],y=t[e+1],_=t[e+2],v=n.getElevation(m,y,_,p,"ground")??0;l+=v,r[i]=m,r[i+1]=y,r[i+2]=h==null?_+v+c:v+c,e+=3,i+=3}return l/s}function Uot(t,e,r,i,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,p=n.spatialReference;e*=3,i*=3;for(let f=0;f<s;++f){const m=t[e],y=t[e+1],_=t[e+2],v=n.getElevation(m,y,_,p,"scene")??0;l+=v,r[i]=m,r[i+1]=y,r[i+2]=h==null?_+v+c:v+c,e+=3,i+=3}return l/s}function kot(t){const e=t.meterUnitOffset,r=t.featureExpressionInfoContext;return e!==0||r!=null}function zot(t,e,r,i,s,n,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;e*=3,i*=3;for(let h=0;h<s;++h){const p=t[e],f=t[e+1],m=t[e+2];r[i]=p,r[i+1]=f,r[i+2]=c==null?m+l:l,e+=3,i+=3}return 0}let aP=class{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}};var cs;(function(t){t[t.NONE=0]="NONE",t[t.UPDATE=1]="UPDATE",t[t.RECREATE=2]="RECREATE"})(cs||(cs={}));const Vot={"absolute-height":{applyElevationAlignmentBuffer:zot,requiresAlignment:kot},"on-the-ground":{applyElevationAlignmentBuffer:Not,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:Fot,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:Uot,requiresAlignment:()=>!0}},Bot=be(),XS=new aP,w$=O();function bQ(t){return t.mapPositions!=null}function eCe(t,e,r,i,s){const n=t.stageObject,o=n.geometries;let a=0;for(const l of o){if(!bQ(l))continue;const{update:c,averageGeometrySampledElevation:h}=rCe(l,e,r,i,s);a+=h,c&&n.geometryVertexAttrsUpdated(l)}return a/o.length}function aw(t,e,r,i,s,n){const o=t.stageObject,a=e.centerPointInElevationSR;let l=0;o.usesVerticalDistanceToGround?(i(a,Cl),QEe(o,Cl.verticalDistanceToGround),l=Cl.sampledElevation):(i(a,Cl),e.mode!=="absolute-height"&&(l=Cl.sampledElevation));const c=Us(Got,n??o.transformation),h=se(tCe,c[12],c[13],c[14]);ai.TESTS_DISABLE_OPTIMIZATIONS?(El[0]=a.x,El[1]=a.y,El[2]=Cl.z,Pl(a.spatialReference,El,c,s.spatialReference)&&(n?Us(n,c):o.transformation=c)):s.setAltitudeOfTransformation(Cl.z,c);const p=wQ/s.unitInMeters;return(Math.abs(c[12]-h[0])>=p||Math.abs(c[13]-h[1])>=p||Math.abs(c[14]-h[2])>=p)&&(n?Us(n,c):o.transformation=c),l}const Got=be();function jot(t,e,r,i,s){const n=t.graphics3DSymbolLayer.lodRenderer;if(n==null)return 0;const o=e.centerPointInElevationSR;i(o,Cl);const a=e.mode!=="absolute-height"?Cl.sampledElevation:0,l=n.instanceData,c=t.instanceIndex,h=qot;l.getGlobalTransform(c,h);const p=se(tCe,h[12],h[13],h[14]);ai.TESTS_DISABLE_OPTIMIZATIONS?(El[0]=o.x,El[1]=o.y,El[2]=Cl.z,Pl(o.spatialReference,El,h,s.spatialReference)&&l.setGlobalTransform(c,h)):s.setAltitudeOfTransformation(Cl.z,h);const f=wQ/s.unitInMeters;return(ai.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(h[12]-p[0])>=f||Math.abs(h[13]-p[1])>=f||Math.abs(h[14]-p[2])>=f)&&l.setGlobalTransform(c,h),a}function Hot(t,e,r,i,s){const n=t.stageObject,o=n.geometries;if(o.length===0)return 0;let a=0,l=null,c=0,h=!1;for(const p of o){if(!bQ(p))continue;const f=p.vertexAttributes.get(C.POSITION);if(f!==l){const{update:m,averageGeometrySampledElevation:y}=rCe(p,e,r,i,s);c=y,l=f,h=m}h&&n.geometryVertexAttrsUpdated(p),a+=c}return a/o.length}const wQ=.01,El=O(),Vu=O(),tT=O(),qot=be(),tCe=O(),Cl=new aP;function rCe(t,e,r,i,s){let n=!1;const o=t.shaderTransformation,a=e.requiresSampledElevationInfo;Vu[0]=o[12],Vu[1]=o[13],Vu[2]=o[14],t.invalidateBoundingInfo();const l=t.getMutableAttribute(C.POSITION),c=l.data,h=l.size,p=c.length/h,f=new JJ(t.mapPositions,r);let m=0,y=0;for(let _=0;_<p;_++){if(tT[0]=c[m],tT[1]=c[m+1],tT[2]=c[m+2],i(f,Cl),a&&(y+=Cl.sampledElevation),ai.TESTS_DISABLE_OPTIMIZATIONS)c[m]=f.array[f.offset],c[m+1]=f.array[f.offset+1],c[m+2]=Cl.z,li(c,r,m,c,s.spatialReference,m,1),c[m]-=Vu[0],c[m+1]-=Vu[1],c[m+2]-=Vu[2],n=!0;else{El[0]=c[m]+Vu[0],El[1]=c[m+1]+Vu[1],El[2]=c[m+2]+Vu[2],s.setAltitude(El,Cl.z),c[m]=El[0]-Vu[0],c[m+1]=El[1]-Vu[1],c[m+2]=El[2]-Vu[2];const v=wQ/s.unitInMeters;(Math.abs(tT[0]-c[m])>=v||Math.abs(tT[1]-c[m+1])>=v||Math.abs(tT[2]-c[m+2])>=v)&&(n=!0)}m+=h,f.offset+=3}return y/=p,{update:n,averageGeometrySampledElevation:y}}const Wot=Q.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function Xot(t){return{cachedResult:t.cachedResult,arcade:t.arcade?{func:t.arcade.func,context:t.arcade.modules.arcadeUtils.createExecContext(null,{sr:t.arcade.context.spatialReference}),modules:t.arcade.modules}:null}}function a8t(t){const e=t&&t.expression;if(typeof e=="string"){const r=nCe(e);if(r!=null)return{cachedResult:r}}return null}async function l8t(t,e,r,i){const s=t&&t.expression;if(typeof s!="string")return null;const n=nCe(s);if(n!=null)return{cachedResult:n};const o=await Y_();Yt(r);const a=o.arcadeUtils,l=a.createSyntaxTree(s);return a.dependsOnView(l)?(i?.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:a.createFunction(l),context:a.createExecContext(null,{sr:e}),modules:o}}}function iCe(t,e,r){return t.arcadeUtils.createFeature(e.attributes,e.geometry,r)}function IU(t,e){if(t!=null&&!sCe(t)){if(!e||!t.arcade)return void Wot.errorOncePerTick("Arcade support required but not provided");const r=e;r._geometry&&(r._geometry=qEe(r._geometry)),t.arcade.modules.arcadeUtils.updateExecContext(t.arcade.context,e)}}function Zot(t){if(t!=null){if(sCe(t))return t.cachedResult;const e=t.arcade;let r=e?.modules.arcadeUtils.executeFunction(e.func,e.context);return typeof r!="number"&&(t.cachedResult=0,r=0),r}return 0}function c8t(t,e=!1){let r=t&&t.featureExpressionInfo;const i=r&&r.expression;return e||i==="0"||(r=null),r??null}const Yot={cachedResult:0};function sCe(t){return t.cachedResult!=null}function nCe(t){return t==="0"?0:null}let Pp=class oCe{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=ZVe(e)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,r){const i=this.calculateOffsetRenderUnits(r);return this.featureExpressionInfoContext!=null?i:e+i}calculateOffsetRenderUnits(e){let r=this._meterUnitOffset;const i=this.featureExpressionInfoContext;return i!=null&&(r+=Zot(i)*this._metersPerElevationInfoUnit),r/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=XVe(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=e.offset??0}updateFeatureExpressionInfoContext(e,r,i){if(e==null)return void(this._featureExpressionInfoContext=null);const s=e&&e.arcade;s&&r!=null&&i!=null?(this._featureExpressionInfoContext=Xot(e),IU(this._featureExpressionInfoContext,iCe(s.modules,r,i))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const r=new oCe;return e!=null&&r.setFromElevationInfo(e),r}},Jot=class{constructor(e,r,i){this.graphic=e,this.renderingInfo=r,this.layer=i}},Qot=class{constructor(e,r,i){this.baseMaterial=e,this.edgeMaterials=r,this.properties=i}},Cm=class{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(e,r,i,s,n,o,a,l=null){this.graphics3DSymbolLayer=e,this.stageObject=r,this._uniqueGeometries=i,this._uniqueMaterials=s,this._sharedResource=n,this.elevationAligner=o,this.elevationContext=a,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e){this._stageLayer=e;const r=e.stage;r.addMany(this._uniqueMaterials),r.addMany(this._uniqueGeometries),r.add(this.stageObject)}destroy(){if(!this._stageLayer)return;const e=this._stageLayer.stage;e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);const r=e.renderer.ensureEdgeView();r.hasObject(this.stageObject)&&r.removeObject(this.stageObject),this.stageObject.dispose(),this._sharedResource!=null&&this._sharedResource.release(),this._visible=!1,this._stageLayer=null}layerOpacityChanged(e,r){if(this._edgeState==null)return;const i=hae(this._edgeState.baseMaterial);let s=!1;for(const n of this._edgeState.edgeMaterials)n.objectTransparency!==i&&(n.objectTransparency=i,s=!0);s&&this.resetEdgeObject(r),this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[e])}slicePlaneEnabledChanged(e,r){this._edgeState!=null&&(this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:e},!r),this._edgeState.properties.hasSlicePlane=e)}setVisibility(e){if(this._stageLayer!=null&&this._visible!==e&&(this._visible=e,this.stageObject.visible=e,this._visible&&!this._addedToStage&&(this._stageLayer.add(this.stageObject),this._addedToStage=!0),this._edgeState)){const r=this._stageLayer.stage.renderer.ensureEdgeView();r.hasObject(this.stageObject)?r.updateObjectVisibility(this.stageObject,e):e&&this._addOrUpdateEdgeObject(r,!1)}}get visible(){return this._visible}alignWithElevation(e,r,i,s){if(this.elevationAligner==null)return;i!=null&&IU(this.elevationContext.featureExpressionInfoContext,i);const n=(o,a)=>dv(o,e,this.elevationContext,r,a);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,n,r),this.resetEdgeObject(s)}alignWithAbsoluteElevation(e,r,i){const s=(n,o)=>{o.sampledElevation=e,o.verticalDistanceToGround=0,o.z=e};this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,s,r),this.resetEdgeObject(i)}getCenterObjectSpace(e=O()){return re(e,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(e=pn()){const r=this.stageObject.boundingVolumeObjectSpace;return $0e(e,r.min),L0e(e,r.max),e}computeAttachmentOrigin(e){if(this.useObjectOriginAsAttachmentOrigin){const r=this.stageObject.shaderTransformation;e.render.origin[0]+=r[12],e.render.origin[1]+=r[13],e.render.origin[2]+=r[14],e.render.num++}else for(const r of this.stageObject.geometries)r.computeAttachmentOrigin(Fm)&&(Fe(Fm,Fm,this.stageObject.shaderTransformation),ue(e.render.origin,e.render.origin,Fm),e.render.num++)}async getProjectedBoundingBox(e,r,i,s,n){const o=this.getBoundingBoxObjectSpace(n),a=Kot,l=$Z(o)?1:a.length;for(let h=0;h<l;h++){const p=a[h];h0[0]=o[p[0]],h0[1]=o[p[1]],h0[2]=o[p[2]],Fe(h0,h0,this.stageObject.transformation),Jv[3*h]=h0[0],Jv[3*h+1]=h0[1],Jv[3*h+2]=h0[2]}if(!e(Jv,0,l))return null;Si(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let p=0;p<3;p++)o[p]=Math.min(o[p],Jv[h+p]),o[p+3]=Math.max(o[p+3],Jv[h+p]);c&&i.push({location:Jv.slice(h,h+3),screenSpaceBoundingRect:c})}if(r&&r.service&&this.elevationContext.mode!=="absolute-height"){sp(o,Fm);const h=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let p=0;if(r.useViewElevation)p=r.service.getElevation(Fm[0],Fm[1],h)??0;else try{const f=vQ(o,r.service.spatialReference,r);p=await r.service.queryElevation(Fm[0],Fm[1],s,f,h)??0}catch{}I0e(o,0,0,-this.alignedSampledElevation+p)}return o}addObjectState(e,r){e===my.Highlight&&r.addObject(this.stageObject,this.stageObject.highlight()),e===my.MaskOccludee&&r.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeObject(this.stageObject)}resetEdgeObject(e){if(this._edgeState==null)return;const r=this._stageLayer.stage.renderer.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(r,e):r.removeObject(this.stageObject)}_addOrUpdateEdgeObject(e,r){const i=this._edgeState;if(i==null)return;const s=hae(i.baseMaterial);for(const n of i.edgeMaterials)n.objectTransparency=s;e.addOrUpdateObject3D(this.stageObject,i.edgeMaterials,i.properties,!r).then(()=>this._stageLayer?.sync())}};function hae(t){return t.isVisible()?t.parameters.transparent?Ht.TRANSPARENT:Ht.OPAQUE:Ht.INVISIBLE}const Jv=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],h0=O(),Fm=O(),Kot=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];let aCe=class{constructor(e,r=null){this.labelText=r,this.elevationOffset=e??0}};var Ns;(function(t){t[t.RecreateSymbol=0]="RecreateSymbol",t[t.RecreateGraphics=1]="RecreateGraphics",t[t.FastUpdate=2]="FastUpdate"})(Ns||(Ns={}));let xQ=class{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=lu.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,r){return this._loadStatus===lu.LOADED?(e&&e(),this._loader??Promise.resolve()):this._loadStatus===lu.FAILED?(r&&r(this._loadError),this._loader??Promise.resolve()):(this._loader==null&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=lu.LOADED},i=>{throw this._loadError=i,this._abortController=null,this._loadStatus=lu.FAILED,!us(i)&&this.logger&&i.message&&this.logger.warn(i.message),i})),this._loader.then(e,r).catch(()=>{}),this._loader)}abortLoad(){this._abortController!=null?this._abortController=Ll(this._abortController):this._loadStatus===lu.LOADING&&(this._loadStatus=lu.FAILED),this._loader=null}};var lu;(function(t){t[t.LOADING=0]="LOADING",t[t.LOADED=1]="LOADED",t[t.FAILED=2]="FAILED"})(lu||(lu={}));const lCe=3,$q=3,cCe=10;let uCe=class{constructor(e,r=null){this.geometry=e,this.textures=r}};function x$(t){const e=[];return t.levels.forEach(r=>r.components.forEach(i=>e.push(i.geometry.material))),P5(e)}function dae(t){const e=new Array;return t.levels.forEach(r=>{r.components.forEach(i=>{i.textures!=null&&e.push(...i.textures)})}),P5(e)}function hCe(t){const e=t.components.map(r=>r.geometry);return P5(e)}function pae(t){const e=[];return t.levels.forEach(r=>{r.components.forEach(i=>{e.push(i.geometry)})}),P5(e)}function eat(t){switch(t){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function dCe(t,e){const r=(i,s,n=!1)=>({levels:i.map(o=>{const a=s(o.tesselation);return n&&nKe(a),{components:[new uCe(a)],faceCount:a.indexCount/3,minScreenSpaceRadius:o.minScreenSpaceRadius}})});switch(t){case"sphere":return r([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],i=>rKe(e,.5,i,!0));case"cube":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>WQe(e,1));case"cone":return r(Ak,i=>fne(e,1,.5,i,!1),!0);case"inverted-cone":return r(Ak,i=>fne(e,1,.5,i,!0),!0);case"cylinder":return r(Ak,i=>sKe(e,1,.5,i,[0,0,1],[0,0,.5]));case"tetrahedron":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>tKe(e,1),!0);case"diamond":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>JQe(e,1),!0);default:return}}const Ak=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}],TQ={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};function g8t(t){return t.type==="web-style"?TQ:SQ(t.symbolLayers.toArray().map(e=>pCe(t,e)))}function SQ(t){let e=0,r=0,i=0,s=!1,n=0;const o={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const a of t)a!=null&&(e+=a.primitivesPerFeature,r+=a.primitivesPerCoordinate,i+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.bytesPerCoordinate+=a.memory.bytesPerCoordinate,o.resourceBytes+=a.memory.resourceBytes,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.draped.bytesPerCoordinate+=a.memory.bytesPerCoordinate,s=s||a.estimated,++n);return{primitivesPerFeature:e,primitivesPerCoordinate:r,drawCallsPerFeature:i,estimated:s,memory:o,numComplexities:n}}function y8t(t){const e=SQ(t);return e.numComplexities>0&&(e.primitivesPerFeature/=e.numComplexities,e.primitivesPerCoordinate/=e.numComplexities,e.drawCallsPerFeature/=e.numComplexities,e.memory.bytesPerFeature/=e.numComplexities,e.memory.bytesPerFeatureLabel/=e.numComplexities,e.memory.bytesPerCoordinate/=e.numComplexities,e.memory.resourceBytes/=e.numComplexities,e.memory.draped.bytesPerFeature/=e.numComplexities,e.memory.draped.bytesPerFeatureLabel/=e.numComplexities,e.memory.draped.bytesPerCoordinate/=e.numComplexities),e}const fae={};function pCe(t,e){const r=fCe(t,e),i=fHe(e)?2:0;switch(e.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:i,estimated:!1,memory:r};case"fill":return t.type==="mesh-3d"?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:i,estimated:!1,memory:r}:e.outline!=null&&e.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:r}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case"water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:r};case"object":return e.resource?.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:r}:{...tat(e.resource&&e.resource.primitive||H0e),memory:r};case"path":{let s=0,n=0;switch(e.profile){case"circle":s=cCe;break;case"quad":s=4;break;default:return void(e.profile,void 0)}switch(e.join??"simple"){case"round":n=lCe;break;case"miter":case"bevel":n=1;break;default:return}const o=2*s,a=s*n*2;let l=-2*a-o;switch(e.cap){case"none":break;case"butt":case"square":l+=2*(s-1);break;case"round":l+=2*(s*($q-1)*2+s);break;default:return}return{primitivesPerFeature:l,primitivesPerCoordinate:a+o,drawCallsPerFeature:0,estimated:!1,memory:r}}case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:r};default:return}}function fCe(t,e){const r=t.type==="point-3d";switch(e.type){case"extrude":return e.edges&&e.edges.size>0?cl.EXTRUDE_EDGES:cl.EXTRUDE;case"fill":return e.outline!=null&&e.outline.size>0?cl.FILL_OUTLINE:cl.FILL;case"water":return cl.FILL;case"line":return e.join==="round"?cl.LINE_ROUND:cl.LINE_MITER;case"path":switch(e.join){case"round":switch(e.profile){case"circle":return cl.PATH_ROUND_CIRCLE;case"quad":return cl.PATH_ROUND_QUAD;default:return void(e.profile,void 0)}case"miter":case"bevel":switch(e.profile){case"circle":return cl.PATH_MITER_CIRCLE;case"quad":return cl.PATH_MITER_QUAD;default:return void(e.profile,void 0)}default:return}case"object":return r?cl.OBJECT_POINT:cl.OBJECT_POLYGON;case"icon":case"text":return r?cl.ICON_POINT:cl.ICON_POLYGON;default:return}}function tat(t){let e=fae[t];if(e)return e;const r=dCe(t,null);return e={primitivesPerFeature:hCe(r.levels[0]).reduce((i,s)=>i+s.indices.get(C.POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1},fae[t]=e,e}const cl={ICON_POINT:{bytesPerFeature:2321.5204640676384,bytesPerFeatureLabel:990.45722,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:2169.5155951150787,bytesPerFeatureLabel:999.2598599999999,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:3822.4566594216512,bytesPerFeatureLabel:1004.4288266666666,bytesPerCoordinate:3.8232947206245864,resourceBytes:0,draped:{bytesPerFeature:3656.161389156324,bytesPerFeatureLabel:994.9227800000001,bytesPerCoordinate:3.836714603517761}},OBJECT_POINT:{bytesPerFeature:1286.2669145138564,bytesPerFeatureLabel:1011.4901900000001,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:1286.2669145138564,bytesPerFeatureLabel:1011.4901900000001,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:2796.828455517831,bytesPerFeatureLabel:1012.9951500000002,bytesPerCoordinate:4.051546356517487,resourceBytes:0,draped:{bytesPerFeature:2796.828455517831,bytesPerFeatureLabel:1012.9951500000002,bytesPerCoordinate:4.051546356517487}},LINE_MITER:{bytesPerFeature:4906.045480276492,bytesPerFeatureLabel:1002.8815266666666,bytesPerCoordinate:24.04850207798191,resourceBytes:0,draped:{bytesPerFeature:4315.785832179941,bytesPerFeatureLabel:998.7028333333334,bytesPerCoordinate:19.457038722015074}},LINE_ROUND:{bytesPerFeature:4893.576398024015,bytesPerFeatureLabel:1015.8812866666666,bytesPerCoordinate:24.039686621147293,resourceBytes:0,draped:{bytesPerFeature:4321.076505943878,bytesPerFeatureLabel:1008.7058400000001,bytesPerCoordinate:19.522527447599565}},PATH_MITER_CIRCLE:{bytesPerFeature:27475.37385725739,bytesPerFeatureLabel:945.1915,bytesPerCoordinate:1936.190695268645,resourceBytes:0,draped:{bytesPerFeature:27475.37385725739,bytesPerFeatureLabel:945.1915,bytesPerCoordinate:1936.190695268645}},PATH_ROUND_CIRCLE:{bytesPerFeature:13432.532036888486,bytesPerFeatureLabel:949.8167000000001,bytesPerCoordinate:4250.913048917402,resourceBytes:0,draped:{bytesPerFeature:13432.532036888486,bytesPerFeatureLabel:949.8167000000001,bytesPerCoordinate:4250.913048917402}},PATH_MITER_QUAD:{bytesPerFeature:17083.041162790672,bytesPerFeatureLabel:1006.4104,bytesPerCoordinate:1543.9135284683243,resourceBytes:0,draped:{bytesPerFeature:17083.041162790672,bytesPerFeatureLabel:1006.4104,bytesPerCoordinate:1543.9135284683243}},PATH_ROUND_QUAD:{bytesPerFeature:24054.406240577355,bytesPerFeatureLabel:976.0122999999999,bytesPerCoordinate:2683.863857257418,resourceBytes:0,draped:{bytesPerFeature:24054.406240577355,bytesPerFeatureLabel:976.0122999999999,bytesPerCoordinate:2683.863857257418}},FILL:{bytesPerFeature:5336.950602511737,bytesPerFeatureLabel:993.6785799999999,bytesPerCoordinate:9.558162275921951,resourceBytes:0,draped:{bytesPerFeature:4643.732435264264,bytesPerFeatureLabel:1003.6394400000001,bytesPerCoordinate:8.123952159573538}},FILL_OUTLINE:{bytesPerFeature:8210.8457089066,bytesPerFeatureLabel:1006.2871066666667,bytesPerCoordinate:14.496686428135353,resourceBytes:0,draped:{bytesPerFeature:6982.149803527473,bytesPerFeatureLabel:1005.1158800000001,bytesPerCoordinate:11.034666572000932}},EXTRUDE:{bytesPerFeature:16336.386002724352,bytesPerFeatureLabel:1013.2957066666665,bytesPerCoordinate:40.50904192903909,resourceBytes:0,draped:{bytesPerFeature:16336.386002724352,bytesPerFeatureLabel:1013.2957066666665,bytesPerCoordinate:40.50904192903909}},EXTRUDE_EDGES:{bytesPerFeature:18251.260762353977,bytesPerFeatureLabel:1044.1864133333333,bytesPerCoordinate:40.594518397678755,resourceBytes:0,draped:{bytesPerFeature:18251.260762353977,bytesPerFeatureLabel:1044.1864133333333,bytesPerCoordinate:40.594518397678755}}},rT=Q.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");let Am=class extends xQ{constructor(e,r,i,s){super(i.schedule),this.symbol=e,this.symbolLayer=r,this._context=i,this._elevationInfoOverride=null,this.ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this.complexity=null,this.logger=rT,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.skipHighSymbolLodsChanged=!0,this._renderPriority=s.renderPriority,this._renderPriorityStep=s.renderPriorityStep,this._elevationContext=new Pp,this.complexity=this.computeComplexity(),this.ignoreDrivers=s.ignoreDrivers,this.ignoreDrivers||(this._drivenProperties=mae(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}_drivenPropertiesChanged(e){if(this.ignoreDrivers)return!1;const r=this._drivenProperties,i=mae(e);return i.color!==r.color||i.opacity!==r.opacity||i.opacityAlwaysOpaque!==r.opacityAlwaysOpaque||i.size!==r.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,r,i,s){const n=e.projectionSuccess,o="polygons"in e?e.polygons:null,a=`${s} geometry failed to be created`;let l=null;n?!this._logGeometryValidationWarnings(r,i,s)&&o&&o.length===0&&i==="rings"&&r.length>0&&r[0].length>2&&(l=`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):l=`${a} (failed to project geometry to view spatial reference)`,l&&rT.warnOncePerTick(l)}_logGeometryValidationWarnings(e,r,i){const s=`${i} geometry failed to be created`;return!e.length||e.length===1&&!e[0].length?(rT.warnOncePerTick(`${s} (no ${r} were defined)`),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(rT.warnOncePerTick(`${s} (${r} should be defined as a 2D array)`),!0)}_validateGeometry(e,r=null,i=null){if(r!=null&&!r.includes(e.type))return this.logger.warn("unsupported geometry type for "+i+` symbol: ${e.type}`),!1;if(e.type==="point"){const s=e;if(!isFinite(s.x)||!isFinite(s.y))return rT.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return rat}_defaultElevationInfoZ(){return iat}_updateElevationContext(){this._elevationInfoOverride!=null?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,r=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||r.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,r){const i=e.geometry,s=this.getDefaultElevationInfo(i);r.unit=this._elevationContext.unit!=null?this._elevationContext.unit:s.unit,r.mode=this.getGeometryElevationMode(i,s),r.offsetMeters=this._elevationContext.meterUnitOffset??s.offset??0;const n=!this._elevationOptions.supportsOnTheGround&&r.mode==="on-the-ground";n&&(r.mode="relative-to-ground",r.offsetMeters=0);const o=n?Yot:this._elevationContext.featureExpressionInfoContext;return r.updateFeatureExpressionInfoContext(o,e,this._context.layer),r}prepareSymbolLayerPatch(e){}updateGeometry(e,r){return!1}updateTransform(e,r,i,s){return!1}onRemoveGraphic(e){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(e,r=gae){let i=1;return this.draped||(i*=this._getLayerOpacity()),this._drivenProperties.opacity||(e!=null?i*=e.a:r.hasIntrinsicColor||(i=0)),i}_getCombinedOpacityAndColor(e,r=gae){const i=this._getCombinedOpacity(e,r);if(this._drivenProperties.color)return XO(null,i);const s=e!=null?Ne.toUnitRGB(e):kg;return XO(s,i)}_getVertexOpacityAndColor(e,r=null){const i=this._drivenProperties.color?e.color:null,s=this._drivenProperties.opacity?e.opacity:null,n=XO(i,s);return r&&(n[0]*=r,n[1]*=r,n[2]*=r,n[3]*=r),n}isFastUpdatesEnabled(){return this._fastUpdates!=null}computeComplexity(){return pCe(this.symbol,this.symbolLayer)}globalPropertyChanged(e,r,i){switch(e){case"opacity":return this.layerOpacityChanged(r,i),!0;case"elevationInfo":{const s=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(r,i,s)!==cs.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(r,i);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged;case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(e,r,i){let s=cs.UPDATE;return e.forEach(n=>{const o=r(n);if(o!=null){const a=n.graphic;this.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=i(o.elevationContext.mode)}else s=cs.RECREATE}),s}applyRendererDiff(e,r){return Ns.RecreateSymbol}getFastUpdateAttrValues(e){if(!this._fastUpdates)return null;const r=this._fastUpdates.visualVariables,i=r.size?gp(r.size.field,e):0,s=r.color?gp(r.color.field,e):0,n=r.opacity?gp(r.opacity.field,e):0;return Nt(i,s,n,0)}get draped(){return this._draped}ensureDrapedStatus(e){return this._draped==null?(this._draped=e,!0):(e!==this.draped&&rT.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const e=()=>({size:this._fastUpdates?.visualVariables.size?.field??null,color:this._fastUpdates?.visualVariables.color?.field??null,opacity:this._fastUpdates?.visualVariables.opacity?.field??null,rotation:this._fastUpdates?.visualVariables.rotation?.field??null});return{drivenProperties:this._drivenProperties,getVisVarFields:e}}};function mae(t){const e={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return t&&"visualVariables"in t&&t.visualVariables&&t.visualVariables.forEach(r=>{switch(r.type){case"color":if(e.color=!0,r.stops)for(let i=0;i<r.stops.length;i++){const s=r.stops[i].color;s&&(e.opacity=!0,s.a<1&&(e.opacityAlwaysOpaque=!1))}break;case"opacity":e.opacity=!0,e.opacityAlwaysOpaque=!1;break;case"size":e.size=!0}}),e}const rat={mode:"on-the-ground",offset:0,unit:"meters"},iat={mode:"absolute-height",offset:0,unit:"meters"},gae={hasIntrinsicColor:!1};let Ny=class extends QM{get geometries(){return this._geometries}get transformation(){return this._transformation??un}set transformation(e){this._transformation=Us(this._transformation??be(),e),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}get shaderTransformation(){return this._shaderTransformation??this.transformation}set shaderTransformation(e){this._shaderTransformation=Us(this._shaderTransformation??be(),e),this._invalidateBoundingVolume(),this._emit("objectShaderTransformation",this)}clearShaderTransformation(){this._shaderTransformation=void 0,this._invalidateBoundingVolume(),this._emit("objectShaderTransformation",this)}constructor(e={}){super(),this.type=ls.Object,this._hasVolatileTransformation=!1,this._parentLayer=null,this._visible=!0,this.castShadow=e.castShadow??!0,this.usesVerticalDistanceToGround=e.usesVerticalDistanceToGround??!1,this.graphicUid=e.graphicUid,this.layerUid=e.layerUid,e.isElevationSource&&(this.lastValidElevationBB=new mCe),this._geometries=e.geometries?Array.from(e.geometries):new Array}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){nt(this._parentLayer==null||e==null,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._hasVolatileTransformation=this._hasVolatileTransformation||e.hasVolatileTransformation,this._emit("objectGeometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const r=this._geometries.splice(e,1)[0];r&&(this._emit("objectGeometryRemoved",{object:this,geometry:r}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(e){this._emit("objectGeometryUpdated",{object:this,geometry:e}),this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const r of this._geometries)r.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new uF(my.MaskOccludee);for(const r of this._geometries)r.occludees=KH(r.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const r of this._geometries)r.occludees=eq(r.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new uF(my.Highlight);for(const r of this._geometries)r.highlights=KH(r.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const r of this._geometries)r.highlights=eq(r.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,r){return oi(r,this.transformation,e.transformation)}getCombinedShaderTransformation(e,r=be()){return oi(r,this.shaderTransformation,e.shaderTransformation)}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._bvWorldSpace&&!this._hasVolatileTransformation||(this._bvWorldSpace=this._bvWorldSpace||new yae,this._validateBoundingVolume(this._bvWorldSpace,ZO.WorldSpace)),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._bvObjectSpace&&!this._hasVolatileTransformation||(this._bvObjectSpace=this._bvObjectSpace||new yae,this._validateBoundingVolume(this._bvObjectSpace,ZO.ObjectSpace)),this._bvObjectSpace}_validateBoundingVolume(e,r){const i=r===ZO.ObjectSpace;for(const s of this._geometries){const n=s.boundingInfo;n&&sat(n,e,i?s.shaderTransformation:this.getCombinedShaderTransformation(s))}Hr(e.bounds,e.min,e.max,.5);for(const s of this._geometries){const n=s.boundingInfo;if(n==null)continue;const o=i?s.shaderTransformation:this.getCombinedShaderTransformation(s),a=lE(o);Fe(_ae,n.center,o);const l=fi(_ae,e.bounds),c=n.radius*a;e.bounds[3]=Math.max(e.bounds[3],l+c)}}_invalidateBoundingVolume(){const e=this._bvWorldSpace?.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0,this._parentLayer&&e&&this._parentLayer.notifyObjectBBChanged(this,e)}_emit(e,r){this._parentLayer&&this._parentLayer.events.emit(e,r)}get test(){const e=this;return{hasGeometry:r=>e._geometries.includes(r),getGeometryIndex:r=>e._geometries.indexOf(r)}}},mCe=class{constructor(){this.min=Me(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Me(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}},yae=class extends mCe{constructor(){super(...arguments),this.bounds=bs()}};function sat(t,e,r){const i=t.bbMin,s=t.bbMax;if(C6(r)){const n=se(nat,r[12],r[13],r[14]);ue(Gc,i,n),ue(ld,s,n);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],Gc[o]),e.max[o]=Math.max(e.max[o],ld[o])}else if(Fe(Gc,i,r),ha(i,s))for(let n=0;n<3;++n)e.min[n]=Math.min(e.min[n],Gc[n]),e.max[n]=Math.max(e.max[n],Gc[n]);else{Fe(ld,s,r);for(let n=0;n<3;++n)e.min[n]=Math.min(e.min[n],Gc[n],ld[n]),e.max[n]=Math.max(e.max[n],Gc[n],ld[n]);for(let n=0;n<3;++n){re(Gc,i),re(ld,s),Gc[n]=s[n],ld[n]=i[n],Fe(Gc,Gc,r),Fe(ld,ld,r);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],Gc[o],ld[o]),e.max[o]=Math.max(e.max[o],Gc[o],ld[o])}}}const nat=O(),Gc=O(),ld=O(),_ae=O();var ZO;(function(t){t[t.WorldSpace=0]="WorldSpace",t[t.ObjectSpace=1]="ObjectSpace"})(ZO||(ZO={}));function EQ(t,e,r,i,s,n){const o=t.clippingExtent;if(So(e,F_,t.elevationProvider.spatialReference),o!=null&&!PZ(o,F_))return null;So(e,F_,t.renderCoordsHelper.spatialReference),r.shaderTransformer=n,r.localOrigin=t.localOriginFactory.getOrigin(F_);const a=new Ny({geometries:[r],castShadow:!1,layerUid:t.layer.uid,graphicUid:s,usesVerticalDistanceToGround:!0});return{object:a,sampledElevation:Dot(a,e,t.elevationProvider,t.renderCoordsHelper,i)}}function QR(t,e,r){const i=t.elevationContext,s=r.spatialReference;So(e,F_,s),i.centerPointInElevationSR=vx(F_[0],F_[1],e.hasZ?F_[2]:0,s??null)}function KR(t){switch(t.type){case"point":return t;case"polygon":case"extent":return _Q(t);case"polyline":{const e=t.paths[0];if(!e||e.length===0)return null;const r=Mge(e,Rge(e)/2);return vx(r[0],r[1],r[2],t.spatialReference)}case"mesh":return t.origin}return null}const F_=O();function gCe(){return new Float32Array(2)}function oat(t){const e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e}function Th(t,e){const r=new Float32Array(2);return r[0]=t,r[1]=e,r}function aat(t,e){return new Float32Array(t,e,2)}function yCe(){return gCe()}function _Ce(){return Th(1,1)}function vCe(){return Th(1,0)}function bCe(){return Th(0,1)}const wCe=yCe(),xCe=_Ce(),lat=vCe(),cat=bCe();Object.freeze(Object.defineProperty({__proto__:null,ONES:xCe,UNIT_X:lat,UNIT_Y:cat,ZEROS:wCe,clone:oat,create:gCe,createView:aat,fromValues:Th,ones:_Ce,unitX:vCe,unitY:bCe,zeros:yCe},Symbol.toStringTag,{value:"Module"}));function uat(t){const e=new Sr,{vertex:r,fragment:i}=e;return r.include(EU),e.include(V2e,t),e.include(ys,t),e.attributes.add(C.UV0,"vec2"),r.uniforms.add(new nr("viewport",(s,n)=>n.camera.fullViewport),new Pe("lineSize",(s,n)=>s.size>0?Math.max(1,s.size)*n.camera.pixelRatio:0),new Ar("pixelToNDC",(s,n)=>ar(bae,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new Pe("borderSize",(s,n)=>s.borderColor!=null?n.camera.pixelRatio:0),new Ar("screenOffset",(s,n)=>ar(bae,s.screenOffset[0]*n.camera.pixelRatio,s.screenOffset[1]*n.camera.pixelRatio))),e.varyings.add("coverageSampling","vec4"),e.varyings.add("lineSizes","vec2"),t.hasMultipassGeometry&&e.varyings.add("depth","float"),t.hasScreenSizePerspective&&SU(r),r.code.add(w`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${t.occlusionTestEnabled?w`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${t.hasScreenSizePerspective?w`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:w`vec2 screenOffsetScaled = screenOffset;`}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
      // correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${t.hasMultipassGeometry?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${t.depthHudEnabled?t.depthHudAlignStartEnabled?w`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:w`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${t.hasScreenSizePerspective?w`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:w`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),i.uniforms.add(new nr("uColor",s=>vae(s.color)),new nr("borderColor",s=>vae(s.borderColor))),t.hasMultipassGeometry&&(i.include(vTe,t),i.uniforms.add(new Ar("inverseViewport",(s,n)=>n.inverseViewport))),i.code.add(w`
    void main() {
      ${t.hasMultipassGeometry?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line blends on top of the
      // border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${t.depthHudEnabled?w`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:w`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      fragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),e}function vae(t){return t??Wf}const bae=Ge(),hat=Object.freeze(Object.defineProperty({__proto__:null,build:uat},Symbol.toStringTag,{value:"Module"}));let TCe=class SCe extends Lr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Ue.Global}initializeProgram(e){return new Rr(e.rctx,SCe.shader.get().build(this.configuration),Tr)}setPipelineState(e){const r=e?ti.ALWAYS:ti.LESS;return this.configuration.depthHudEnabled?Mt({depthTest:{func:r},depthWrite:Ul}):Mt({blending:Eo(xe.ONE,xe.SRC_ALPHA,xe.ONE_MINUS_SRC_ALPHA,xe.ONE_MINUS_SRC_ALPHA),depthTest:{func:r},colorWrite:Gt})}initializePipeline(){return this.setPipelineState(this.configuration.hasMultipassGeometry)}};TCe.shader=new Or(hat,()=>ce(()=>import("./LineCallout.glsl-d35d3497.js"),[],import.meta.url));let nh=class extends Vo{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=Al.World,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.hasMultipassGeometry=!1}};u([B({count:Al.COUNT})],nh.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([B()],nh.prototype,"spherical",void 0),u([B()],nh.prototype,"occlusionTestEnabled",void 0),u([B()],nh.prototype,"hasVerticalOffset",void 0),u([B()],nh.prototype,"hasScreenSizePerspective",void 0),u([B()],nh.prototype,"depthHudEnabled",void 0),u([B()],nh.prototype,"depthHudAlignStartEnabled",void 0),u([B()],nh.prototype,"hasSlicePlane",void 0),u([B()],nh.prototype,"hasMultipassGeometry",void 0),u([B({constValue:!0})],nh.prototype,"hasSliceInVertexProgram",void 0),u([B({constValue:!1})],nh.prototype,"draped",void 0);let T$=class Lq extends Av{get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}constructor(e){super(e,new ECe),this._configuration=new nh,this._uniqueMaterialIdentifier=Lq.uniqueMaterialIdentifier(this.parameters)}getPassParameters(){return this.parameters}getConfiguration(e,r){const i=r?.slot!==he.LINE_CALLOUTS;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.depthHudEnabled=i,this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?Al.Screen:Al.World,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasMultipassGeometry=r.multipassGeometry.enabled,this._configuration}intersect(){}requiresSlot(e,r){if(r===U.Color)switch(e){case he.LINE_CALLOUTS:case he.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1}createGLMaterial(e){return new dat(e)}createBufferWriter(){return new fat}validateParameters(e){const r=Lq.uniqueMaterialIdentifier(e);r!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=r)}static uniqueMaterialIdentifier(e){return JSON.stringify({screenOffset:e.screenOffset||[0,0],centerOffsetUnits:e.centerOffsetUnits||"world"})}},dat=class extends Ev{beginSlot(e){return this.ensureTechnique(TCe,e)}},ECe=class extends cQ{constructor(){super(...arguments),this.screenOffset=Tp,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}};const pat=Hi().vec3f(C.POSITION).vec3f(C.NORMAL).vec2f(C.UV0).vec4f(C.AUXPOS1),wae=[Th(0,0),Th(1,0),Th(0,1),Th(1,0),Th(1,1),Th(0,1)];let fat=class{constructor(){this.vertexBufferLayout=pat}elementCount(e){return 6*e.indices.get(C.POSITION).length}write(e,r,i,s,n){uQ(i.indices.get(C.POSITION),i.vertexAttributes.get(C.POSITION).data,e,s.position,n,6),hQ(i.indices.get(C.NORMAL),i.vertexAttributes.get(C.NORMAL).data,r,s.normal,n,6),xE(i.indices.get(C.AUXPOS1),i.vertexAttributes.get(C.AUXPOS1).data,s.auxpos1,n,6);for(let o=0;o<wae.length;++o)s.uv0.setVec(n+o,wae[o])}},CCe=class ACe extends Am{constructor(e,r){super(e,null,r,yat),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._material=new T$(this._materialParameters),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}_perInstanceMaterialParameters(e){const r=this._materialParameters;return r.screenOffset=e.screenOffset||Tp,r.centerOffsetUnits=e.centerOffsetUnits||"world",r}get _materialParameters(){const e=new ECe,r=this.symbol,i=r.callout;if(e.color=i.color!=null?Ne.toUnitRGBA(i.color):[0,0,0,0],e.color[3]*=this._getLayerOpacity(),e.size=_o(i.size||0),r.verticalOffset){const{screenLength:o,minWorldLength:a,maxWorldLength:l}=r.verticalOffset;e.verticalOffset={screenLength:_o(o),minWorldLength:a||0,maxWorldLength:l??1/0}}e.borderColor=i.border!=null&&i.border.color!=null?Ne.toUnitRGBA(i.border.color):null;const s=r.symbolLayers.at(0).type==="object",n=r.type==="label-3d";return e.occlusionTest=!s,e.shaderPolygonOffset=s?0:void 0,e.depthHUDAlignStart=n,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return gat}createGraphics3DGraphic(e){const r=e.renderingInfo,i=e.graphic,s=this.setGraphicElevationContext(i,new Pp,r.elevationOffset||0),n=r.symbol,o=this._elevationContext.mode==="on-the-ground"&&(n.type==="cim"||!n.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(n.type!=="label-3d"&&o||n.type==="point-3d"&&n.symbolLayers.every(l=>l.type==="text"&&!J0e(l)))return null;const a=_Q(i.geometry);return a==null?null:this._createAs3DShape(a,s,r,i.uid)}layerOpacityChanged(){this._material?.setParameters(this._materialParameters)}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=oP(ACe.elevationModeChangeTypes,i,s);return n!==cs.UPDATE||e.forEach(o=>{const a=r(o);a!=null&&this.updateGraphicElevationContext(o.graphic,a)}),n}slicePlaneEnabledChanged(){return this._material?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(e,r,i=0){const s=super.setGraphicElevationContext(e,r);return s.addOffsetRenderUnits(i),s}updateGraphicElevationContext(e,r){this.setGraphicElevationContext(e,r.elevationContext,r.metadata!=null?r.metadata.elevationOffset:0),r.needsElevationUpdates=Wh(r.elevationContext.mode)}computeComplexity(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:TQ.memory}}_createVertexData(e){const{translation:r,centerOffset:i}=e,s=new He(r?[r[0],r[1],r[2]]:[0,0,0],3,!0),n=new He(i?[i[0],i[1],i[2],i[3]]:[0,0,0,1],4,!0);return[[C.POSITION,s],[C.NORMAL,new He([0,0,1],3,!0)],[C.AUXPOS1,n]]}_getOrCreateMaterial(e){const r=this._perInstanceMaterialParameters(e),i=T$.uniqueMaterialIdentifier(r);if(this._material&&i===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(e.materialCollection!=null){let s=e.materialCollection.get(i);return s==null&&(s=new T$(r),e.materialCollection.add(i,s)),{material:s,isUnique:!1}}return{material:new T$(r),isUnique:!0}}_createAs3DShape(e,r,i,s){const n=this._context.layer.uid,o=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:n}),a=this._getOrCreateMaterial(i),l=new Ys(a.material,this._createVertexData(i),mat,null,ls.Point,o),c=EQ(this._context,e,l,r,s);if(c==null)return null;const h=new Cm(this,c.object,[l],a.isUnique?[a.material]:null,null,aw,r);return h.metadata=new aCe(i.elevationOffset),h.alignedSampledElevation=c.sampledElevation,h.needsElevationUpdates=Wh(r.mode),QR(h,e,this._context.elevationProvider),h}};CCe.elevationModeChangeTypes={definedChanged:cs.UPDATE,staysOnTheGround:cs.UPDATE,onTheGroundChanged:cs.RECREATE};const Ok=[0],mat=[[C.POSITION,Ok],[C.NORMAL,Ok],[C.AUXPOS1,Ok]],gat={mode:"relative-to-ground",offset:0},yat={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};let _at=class{constructor(e,r,i=O(),s=Xt(),n=Ge(),o="world",a=0,l=null){this.renderer=e,this.symbol=r,this.translation=i,this.centerOffset=s,this.screenOffset=n,this.centerOffsetUnits=o,this.elevationOffset=a,this.materialCollection=l}},vat=class extends Jot{};const xae=Q.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function bat(t,e){if(!UZ(t))return xae.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${t.type}' does not support callouts`),null;if(!t.callout)return null;const r=wat[t.callout.type];return r?new r(t,e):(xae.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${t.callout.type}`),null)}const wat={line:CCe};let zw=class OCe{constructor(e=null,r={},i,s){this.geometry=e,this.attributes=r,this.centroid=i,this.objectId=s,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const e=new OCe(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}};function O8t(t){return!(t.geometry==null||!t.geometry.coords||!t.geometry.coords.length)}let R8t=class extends zw{},xat=class RCe{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new RCe;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}},fv=class pN{constructor(e=[],r=[],i=!1){this.lengths=e??[],this.coords=r??[],this.hasIndeterminateRingOrder=i}static fromRect(e){const[r,i,s,n]=e,o=s-r,a=n-i;return new pN([5],[r,i,o,0,0,a,-o,0,0,-a])}get isPoint(){return this.lengths.length===0}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((e,r)=>e+r)}forEachVertex(e){let r=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let i=0;i<this.lengths.length;i++){const s=this.lengths[i];for(let n=0;n<s;n++)e(this.coords[2*(n+r)],this.coords[2*(n+r)+1]);r+=s}}clone(e){return e?(e.set(this.coords),new pN(this.lengths.slice(),e,this.hasIndeterminateRingOrder)):new pN(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}};function ya(t,e){return t?e?4:3:e?3:2}const lP=Q.getLogger("esri.layers.graphics.featureConversionUtils"),MCe={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryEnvelope:0},Tat=(t,e,r,i,s,n)=>{t[r]=s,t[r+1]=n},Tae=(t,e,r,i,s,n)=>{t[r]=s,t[r+1]=n,t[r+2]=e[i+2]},Sat=(t,e,r,i,s,n)=>{t[r]=s,t[r+1]=n,t[r+2]=e[i+3]},Eat=(t,e,r,i,s,n)=>{t[r]=s,t[r+1]=n,t[r+2]=e[i+2],t[r+3]=e[i+3]};function CQ(t,e,r,i){if(t){if(r)return e&&i?Eat:Tae;if(e&&i)return Sat}else if(e&&i)return Tae;return Tat}function Rk({scale:t,translate:e},r){return Math.round((r-e[0])/t[0])}function Mk({scale:t,translate:e},r){return Math.round((e[1]-r)/t[1])}function Pk({scale:t,translate:e},r,i){return r*t[i]+e[i]}function P8t(t,e,r){return t?e?r?RQ(t):AQ(t):r?OQ(t):$U(t):null}function $U(t){const e=t.coords;return{x:e[0],y:e[1]}}function PCe(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t}function AQ(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2]}}function Cat(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t}function OQ(t){const e=t.coords;return{x:e[0],y:e[1],m:e[2]}}function Aat(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.m,t}function RQ(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2],m:e[3]}}function Oat(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t.coords[3]=e.m,t}function Rat(t,e,r,i){let s=$U;r&&i?s=RQ:r?s=AQ:i&&(s=OQ);for(const n of e){const{geometry:o,attributes:a}=n,l=o!=null?s(o):null;t.push({attributes:a,geometry:l})}return t}function MQ(t,e){return t&&e?Oat:t?Cat:e?Aat:PCe}function Mat(t,e,r,i,s){const n=MQ(r,i);for(const{geometry:o,attributes:a}of e){const l=o!=null?n(new fv,o):null;t.push(new zw(l,a,null,s?a[s]:void 0))}return t}function I8t(t,e,r=MQ(e.z!=null,e.m!=null)){return r(t,e)}function Pat(t,e,r,i){for(const{geometry:s,attributes:n}of e)t.push({attributes:n,geometry:s!=null?ICe(s,r,i):null});return t}function ICe(t,e,r){if(t==null)return null;const i=ya(e,r),s=[];for(let n=0;n<t.coords.length;n+=i){const o=[];for(let a=0;a<i;a++)o.push(t.coords[n+a]);s.push(o)}return e?r?{points:s,hasZ:e,hasM:r}:{points:s,hasZ:e}:r?{points:s,hasM:r}:{points:s}}function Iat(t,e,r,i,s){const n=ya(r,i);for(const{geometry:o,attributes:a}of e){const l=o!=null?$Ce(new fv,o,n):null;t.push(new zw(l,a,null,s?a[s]:void 0))}return t}function $Ce(t,e,r=ya(e.hasZ,e.hasM)){t.lengths[0]=e.points.length;const i=t.coords;let s=0;for(const n of e.points)for(let o=0;o<r;o++)i[s++]=n[o];return t}function $at(t,e,r,i){for(const{geometry:s,attributes:n}of e)t.push({attributes:n,geometry:s!=null?LCe(s,r,i):null});return t}function LCe(t,e,r){if(!t)return null;const i=ya(e,r),{coords:s,lengths:n}=t,o=[];let a=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const p=[];for(let f=0;f<i;f++)p.push(s[a++]);c.push(p)}o.push(c)}return e?r?{paths:o,hasZ:e,hasM:r}:{paths:o,hasZ:e}:r?{paths:o,hasM:r}:{paths:o}}function Lat(t,e,r,i,s){const n=ya(r,i);for(const{geometry:o,attributes:a}of e){const l=o!=null?DCe(new fv,o,n):null;t.push(new zw(l,a,null,s?a[s]:void 0))}return t}function DCe(t,e,r=ya(e.hasZ,e.hasM)){const{lengths:i,coords:s}=t;let n=0;for(const o of e.paths){for(const a of o)for(let l=0;l<r;l++)s[n++]=a[l];i.push(o.length)}return t}function Dat(t,e,r,i){for(const{geometry:s,attributes:n,centroid:o}of e){const a=s!=null?NCe(s,r,i):null;if(o!=null){const l=$U(o);t.push({attributes:n,centroid:l,geometry:a})}else t.push({attributes:n,geometry:a})}return t}function NCe(t,e,r){if(!t)return null;const i=ya(e,r),{coords:s,lengths:n}=t,o=[];let a=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const p=[];for(let f=0;f<i;f++)p.push(s[a++]);c.push(p)}o.push(c)}return e?r?{rings:o,hasZ:e,hasM:r}:{rings:o,hasZ:e}:r?{rings:o,hasM:r}:{rings:o}}function Nat(t,e,r,i,s){for(const{geometry:n,centroid:o,attributes:a}of e){const l=n!=null?FCe(new fv,n,r,i):null,c=s?a[s]:void 0;o!=null?t.push(new zw(l,a,PCe(new fv,o),c)):t.push(new zw(l,a,null,c))}return t}function FCe(t,e,r=e.hasZ,i=e.hasM){return Fat(t,e.rings,r,i)}function Fat(t,e,r,i){const s=ya(r,i),{lengths:n,coords:o}=t;let a=0;Jg(t);for(const l of e){for(const c of l)for(let h=0;h<s;h++)o[a++]=c[h];n.push(l.length)}return t}const O2=[],YO=[];function $8t(t,e,r,i,s){O2[0]=t;const[n]=UCe(YO,O2,e,r,i,s);return Ap(O2),Ap(YO),n}function UCe(t,e,r,i,s,n){if(Ap(t),!r){for(const o of e){const a=n?o.attributes[n]:void 0;t.push(new zw(null,o.attributes,null,a))}return t}switch(r){case"esriGeometryPoint":return Mat(t,e,i,s,n);case"esriGeometryMultipoint":return Iat(t,e,i,s,n);case"esriGeometryPolyline":return Lat(t,e,i,s,n);case"esriGeometryPolygon":return Nat(t,e,i,s,n);default:lP.error("convertToFeatureSet:unknown-geometry",new V(`Unable to parse unknown geometry type '${r}'`)),Ap(t)}return t}function L8t(t,e,r,i){YO[0]=t,kCe(O2,YO,e,r,i);const s=O2[0];return Ap(O2),Ap(YO),s}function Uat(t,e,r){if(t==null)return null;const i=new fv;return"hasZ"in t&&e==null&&(e=t.hasZ),"hasM"in t&&r==null&&(r=t.hasM),lZ(t)?MQ(e??t.z!=null,r??t.m!=null)(i,t):u2(t)?FCe(i,t,e,r):cZ(t)?DCe(i,t,ya(e,r)):aZ(t)?$Ce(i,t,ya(e,r)):void lP.error("convertFromGeometry:unknown-geometry",new V(`Unable to parse unknown geometry type '${t}'`))}function kat(t,e,r,i){const s=t&&("coords"in t?t:t.geometry);if(s==null)return null;switch(e){case"esriGeometryPoint":{let n=$U;return r&&i?n=RQ:r?n=AQ:i&&(n=OQ),n(s)}case"esriGeometryMultipoint":return ICe(s,r,i);case"esriGeometryPolyline":return LCe(s,r,i);case"esriGeometryPolygon":return NCe(s,r,i);default:return lP.error("convertToGeometry:unknown-geometry",new V(`Unable to parse unknown geometry type '${e}'`)),null}}function zat(t,e){for(const r of e)t.push({attributes:r.attributes});return t}function kCe(t,e,r,i,s){if(Ap(t),r==null)return zat(t,e);switch(r){case"esriGeometryPoint":return Rat(t,e,i,s);case"esriGeometryMultipoint":return Pat(t,e,i,s);case"esriGeometryPolyline":return $at(t,e,i,s);case"esriGeometryPolygon":return Dat(t,e,i,s);default:lP.error("convertToFeatureSet:unknown-geometry",new V(`Unable to parse unknown geometry type '${r}'`))}return t}function D8t(t){const{objectIdFieldName:e,spatialReference:r,transform:i,fields:s,hasM:n,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:h,queryGeometry:p,queryGeometryType:f}=t,m={features:kCe([],a,l,o,n),fields:s,geometryType:l,objectIdFieldName:e,spatialReference:r,uniqueIdField:h,queryGeometry:kat(p,f,!1,!1)};return i&&(m.transform=i),c&&(m.exceededTransferLimit=c),n&&(m.hasM=n),o&&(m.hasZ=o),m}function N8t(t,e){const r=new xat,{hasM:i,hasZ:s,features:n,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:c,transform:h,fields:p}=t;return p&&(r.fields=p),r.geometryType=l??null,r.objectIdFieldName=o??e??null,r.spatialReference=a??null,r.objectIdFieldName?(n&&UCe(r.features,n,l,s,i,r.objectIdFieldName),c&&(r.exceededTransferLimit=c),i&&(r.hasM=i),s&&(r.hasZ=s),h&&(r.transform=h),r):(lP.error(new V("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),r)}function F8t(t){const{transform:e,features:r,hasM:i,hasZ:s}=t;if(!e)return t;for(const n of r)n.geometry!=null&&Eae(n.geometry,n.geometry,i,s,e),n.centroid!=null&&Eae(n.centroid,n.centroid,i,s,e);return t.transform=null,t}function U8t(t,e){const{geometryType:r,features:i,hasM:s,hasZ:n}=e;if(!t)return e;for(let o=0;o<i.length;o++){const a=i[o],l=a.weakClone();l.geometry=new fv,Sae(l.geometry,a.geometry,s,n,r,t),a.centroid&&(l.centroid=new fv,Sae(l.centroid,a.centroid,s,n,"esriGeometryPoint",t)),i[o]=l}return e.transform=t,e}function Sae(t,e,r,i,s,n,o=r,a=i){if(Jg(t),e==null||!e.coords.length)return null;const l=MCe[s],{coords:c,lengths:h}=e,p=ya(r,i),f=ya(r&&o,i&&a),m=CQ(r,i,o,a);if(!h.length)return m(t.coords,c,0,0,Rk(n,c[0]),Mk(n,c[1])),Jg(t,p,0),t;let y,_,v,b,T=0,x=0,S=x;for(const E of h){if(E<l)continue;let A=0;x=S,v=y=Rk(n,c[T]),b=_=Mk(n,c[T+1]),m(t.coords,c,x,T,v,b),A++,T+=p,x+=f;for(let R=1;R<E;R++,T+=p)v=Rk(n,c[T]),b=Mk(n,c[T+1]),v===y&&b===_||(m(t.coords,c,x,T,v-y,b-_),x+=f,A++,y=v,_=b);A>=l&&(t.lengths.push(A),S=x)}return Ap(t.coords,S),t.coords.length?t:null}function k8t(t,e,r,i,s,n,o=r,a=i){if(Jg(t),!e||!e.coords.length)return null;const l=MCe[s],{coords:c,lengths:h}=e,p=ya(r,i),f=ya(r&&o,i&&a),m=CQ(r,i,o,a);if(!h.length)return m(t.coords,c,0,0,c[0],c[1]),Jg(t,p,0),t;let y=0;const _=n*n;for(const v of h){if(v<l){y+=v*p;continue}const b=t.coords.length/f,T=y,x=y+(v-1)*p;m(t.coords,c,t.coords.length,T,c[T],c[T+1]),Dq(t.coords,c,p,_,m,T,x),m(t.coords,c,t.coords.length,x,c[x],c[x+1]);const S=t.coords.length/f-b;S>=l?t.lengths.push(S):Ap(t.coords,b*f),y+=v*p}return t.coords.length?t:null}function Vat(t,e,r,i){const s=t[e],n=t[e+1],o=t[r],a=t[r+1],l=t[i],c=t[i+1];let h=o,p=a,f=l-h,m=c-p;if(f!==0||m!==0){const y=((s-h)*f+(n-p)*m)/(f*f+m*m);y>1?(h=l,p=c):y>0&&(h+=f*y,p+=m*y)}return f=s-h,m=n-p,f*f+m*m}function Dq(t,e,r,i,s,n,o){let a,l=i,c=0;for(let h=n+r;h<o;h+=r)a=Vat(e,h,n,o),a>l&&(c=h,l=a);l>i&&(c-n>r&&Dq(t,e,r,i,s,n,c),s(t,e,t.length,c,e[c],e[c+1]),o-c>r&&Dq(t,e,r,i,s,c,o))}function z8t(t,e,r,i){if(e==null||!e.coords||!e.coords.length)return null;const s=ya(r,i);let n=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(e&&e.coords){const c=e.coords;for(let h=0;h<c.length;h+=s){const p=c[h],f=c[h+1];n=Math.min(n,p),a=Math.max(a,p),o=Math.min(o,f),l=Math.max(l,f)}}return iG(t)?P8e(t,n,o,a,l):rZ(n,o,a,l,t),t}function Eae(t,e,r,i,s){const{coords:n,lengths:o}=e,a=ya(r,i);if(!n.length)return t!==e&&Jg(t),t;R5(s);const{originPosition:l,scale:c,translate:h}=s,p=Gat;p.originPosition=l;const f=p.scale;f[0]=c[0]??1,f[1]=-(c[1]??1),f[2]=c[2]??1,f[3]=c[3]??1;const m=p.translate;if(m[0]=h[0]??0,m[1]=h[1]??0,m[2]=h[2]??0,m[3]=h[3]??0,!o.length){for(let _=0;_<a;++_)t.coords[_]=Pk(p,n[_],_);return t!==e&&Jg(t,a,0),t}let y=0;for(let _=0;_<o.length;_++){const v=o[_];t.lengths[_]=v;for(let x=0;x<a;++x)t.coords[y+x]=Pk(p,n[y+x],x);let b=t.coords[y],T=t.coords[y+1];y+=a;for(let x=1;x<v;x++,y+=a){b+=n[y]*f[0],T+=n[y+1]*f[1],t.coords[y]=b,t.coords[y+1]=T;for(let S=2;S<a;++S)t.coords[y+S]=Pk(p,n[y+S],S)}}return t!==e&&Jg(t,n.length,o.length),t}function V8t(t,e,r,i,s,n){if(Jg(t),t.lengths.push(...e.lengths),r===s&&i===n)for(let o=0;o<e.coords.length;o++)t.coords.push(e.coords[o]);else{const o=ya(r,i),a=CQ(r,i,s,n),l=e.coords;for(let c=0;c<l.length;c+=o)a(t.coords,l,t.coords.length,c,l[c],l[c+1])}return t}function Bat(t,e,r,i){let s=0,n=t[i*e],o=t[i*(e+1)];for(let a=1;a<r;a++){const l=n+t[i*(e+a)],c=o+t[i*(e+a)+1],h=(l-n)*(c+o);n=l,o=c,s+=h}return .5*s}function B8t(t,e){const{coords:r,lengths:i}=t;let s=0,n=0;for(let o=0;o<i.length;o++){const a=i[o];n+=Bat(r,s,a,e),s+=a}return Math.abs(n)}function Jg(t,e=0,r=0){Ap(t.lengths,r),Ap(t.coords,e)}function Ap(t,e=0){t.length!==e&&(t.length=e)}const Gat={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]},Cae=new Go(Array,t=>c6(t,D0e),null,10,5),jat=Vt();let Hat=class{get labelLayers(){return this._labelLayers||GIe}get extent(){return this._extent}get isElevationSource(){return this.layers.some(e=>e?.isElevationSource)}constructor(e,r,i,s,n){this.graphic=e,this.graphics3DSymbol=r,this.layers=i,this._visibleFlags=Bo.ALL_LABEL,this.deconflictionPriority=0,++r.referenced,this._featureExpressionFeature=n?iCe(n,e,s):null}initialize(e){this._layer=e,this._forEachSymbolLayerGraphic(r=>{r.initialize(e),r.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(e=>e.destroy()),this._calloutLayer=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.layers==null}clearLabelGraphics(){this._forEachLabelGraphic(e=>e.destroy()),this._labelLayers=null}addLabelGraphic(e,r){this._labelLayers||(this._labelLayers=new Array),this._labelLayers.push(e),e.initialize(r),e.setVisibility(this.isVisible(Yn.LABEL))}setCalloutGraphic(e){this._calloutLayer=e,this._layer&&(e.initialize(this._layer),e.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic(r=>{r.type==="draped"&&(e=!0)}),e}isVisible(e=Yn.GRAPHIC,r){const i=r?this._visibleFlags|r|Yn.LABEL*r:this._visibleFlags;return e===Yn.GRAPHIC?(i&Bo.ALL_GRAPHIC)===Bo.ALL_GRAPHIC:(i&Bo.ALL_LABEL)===Bo.ALL_LABEL}setVisibilityFlag(e,r,i){const s=this.isVisible(e);i?this._visibleFlags|=e*r:this._visibleFlags&=~(e*r);const n=this.isVisible(e);if(s===n)return!1;if(e===Yn.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(n));else{this._forEachSymbolLayerGraphic(a=>a.setVisibility(n));const o=this.isVisible(Yn.LABEL);this._forEachLabelGraphic(a=>a.setVisibility(o))}return!0}getVisibilityFlag(e,r){return(this._visibleFlags&e*r)!=0}computeExtent(e){if(!this._extent){const r=this.graphic.geometry;if(r==null)return!1;this._extent=Vt(),Tot(r,this._extent);const i=r.spatialReference;if(!Pn(i,e)&&!jM(this._extent,i,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,r){return this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,r)),this._optimizedGeometry}_convertGraphicToOptimizedGeometry(e,r,i){let s=e.geometry;return s.type!=="mesh"&&s.type!=="extent"||(s=yu.fromExtent(s.type==="mesh"?s.extent:s)),Uat(s,r,i)}get usedMemory(){let e=IEe(this.graphic.attributes);return this._forEachSymbolLayerGraphic(r=>{const i=r.graphics3DSymbolLayer.complexity;if(i==null)return;const s=r.type==="draped"?i.memory.draped:i.memory;e+=s.bytesPerFeature,s.bytesPerCoordinate&&(e+=xot(this.graphic.geometry)*s.bytesPerCoordinate)}),e}computeAttachmentOrigin(){const e={render:{origin:O(),num:0},draped:{origin:Ge(),num:0}};for(const r of this.layers)r?.computeAttachmentOrigin(e);return e.render.num>1&&ie(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&yc(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,r,i,s,n){return n||(n={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),n.boundingBox?Si(n.boundingBox):n.boundingBox=Si(),n.requiresDrapedElevation=!1,await G5(this.layers,async o=>{if(o==null)return;const a=o.type==="draped"?r:e,l=Cae.acquire(),c=await o.getProjectedBoundingBox(a,i,n.screenSpaceObjects,s,l);isFinite(c[2])&&isFinite(c[5])||(n.requiresDrapedElevation=!0),c&&Z2(n.boundingBox,l),Cae.release(l)}),R8e(n.boundingBox)||cB(IZ(n.boundingBox,jat))?n:null}needsElevationUpdates(){for(const e of this.layers)if(e!=null&&(e.type==="object3d"||e.type==="lod-instance")&&e.needsElevationUpdates)return!0;return this._labelLayers?.some(e=>e?.needsElevationUpdates??!1)??!1}alignWithElevation(e,r,i){this._forEachRenderedGraphic(s=>{s.type!=="object3d"&&s.type!=="lod-instance"||s.alignWithElevation(e,r,this._featureExpressionFeature,i)})}alignWithAbsoluteElevation(e,r,i){this._forEachRenderedGraphic(s=>{s.type==="object3d"&&s.alignWithAbsoluteElevation(e,r,i)})}addObjectStateSet(e,r){this._forEachSymbolLayerGraphic(i=>i.addObjectState(e,r))}removeObjectState(e){this._forEachSymbolLayerGraphic(r=>r.removeObjectState(e))}_forEachGraphicList(e,r){e?.forEach(i=>i&&r(i))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._calloutLayer&&e(this._calloutLayer)}_forEachLabelGraphic(e){this._forEachGraphicList(this._labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}get test(){const e=this;return{addLabelLayer:r=>{e._labelLayers||(e._labelLayers=new Array),e._labelLayers.push(r)}}}},j8t=class{constructor(e,r){this.scheduler=e,this.schedule=r,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.skipHighSymbolLods=!1,this.isAsync=!1}},qat=class{constructor(){this.renderPriority=0,this.renderPriorityStep=1,this.ignoreDrivers=!1}};var Aae,Oae,Rae,Nq={exports:{}};Nq.exports,Aae=Nq,Oae=function(){function t(I,z,F){F=F||2;var j,W,Y,te,me,Le,dt,st=z&&z.length,Xe=st?z[0]*F:I.length,yt=e(I,0,Xe,F,!0),ge=[];if(!yt||yt.next===yt.prev)return ge;if(st&&(yt=l(I,z,yt,F)),I.length>80*F){j=Y=I[0],W=te=I[1];for(var Ce=F;Ce<Xe;Ce+=F)(me=I[Ce])<j&&(j=me),(Le=I[Ce+1])<W&&(W=Le),me>Y&&(Y=me),Le>te&&(te=Le);dt=(dt=Math.max(Y-j,te-W))!==0?1/dt:0}return i(yt,ge,F,j,W,dt),ge}function e(I,z,F,j,W){var Y,te;if(W===J(I,z,F,j)>0)for(Y=z;Y<F;Y+=j)te=H(Y,I[Y],I[Y+1],te);else for(Y=F-j;Y>=z;Y-=j)te=H(Y,I[Y],I[Y+1],te);if(te&&E(te,te.next)){var me=te.next;Z(te),te=me}return te}function r(I,z){if(!I)return I;z||(z=I);var F,j=I;do if(F=!1,j.steiner||!E(j,j.next)&&S(j.prev,j,j.next)!==0)j=j.next;else{var W=j.prev;if(Z(j),(j=z=W)===j.next)break;F=!0}while(F||j!==z);return z}function i(I,z,F,j,W,Y,te){if(I){!te&&Y&&y(I,j,W,Y);for(var me,Le,dt=I;I.prev!==I.next;)if(me=I.prev,Le=I.next,Y?n(I,j,W,Y):s(I))z.push(me.i/F),z.push(I.i/F),z.push(Le.i/F),Z(I),I=Le.next,dt=Le.next;else if((I=Le)===dt){te?te===1?i(I=o(r(I),z,F),z,F,j,W,Y,2):te===2&&a(I,z,F,j,W,Y):i(r(I),z,F,j,W,Y,1);break}}}function s(I){var z=I.prev,F=I,j=I.next;if(S(z,F,j)>=0)return!1;for(var W=I.next.next;W!==I.prev;){if(T(z.x,z.y,F.x,F.y,j.x,j.y,W.x,W.y)&&S(W.prev,W,W.next)>=0)return!1;W=W.next}return!0}function n(I,z,F,j){var W=I.prev,Y=I,te=I.next;if(S(W,Y,te)>=0)return!1;for(var me=W.x<Y.x?W.x<te.x?W.x:te.x:Y.x<te.x?Y.x:te.x,Le=W.y<Y.y?W.y<te.y?W.y:te.y:Y.y<te.y?Y.y:te.y,dt=W.x>Y.x?W.x>te.x?W.x:te.x:Y.x>te.x?Y.x:te.x,st=W.y>Y.y?W.y>te.y?W.y:te.y:Y.y>te.y?Y.y:te.y,Xe=v(me,Le,z,F,j),yt=v(dt,st,z,F,j),ge=I.prevZ,Ce=I.nextZ;ge&&ge.z>=Xe&&Ce&&Ce.z<=yt;){if(ge!==I.prev&&ge!==I.next&&T(W.x,W.y,Y.x,Y.y,te.x,te.y,ge.x,ge.y)&&S(ge.prev,ge,ge.next)>=0||(ge=ge.prevZ,Ce!==I.prev&&Ce!==I.next&&T(W.x,W.y,Y.x,Y.y,te.x,te.y,Ce.x,Ce.y)&&S(Ce.prev,Ce,Ce.next)>=0))return!1;Ce=Ce.nextZ}for(;ge&&ge.z>=Xe;){if(ge!==I.prev&&ge!==I.next&&T(W.x,W.y,Y.x,Y.y,te.x,te.y,ge.x,ge.y)&&S(ge.prev,ge,ge.next)>=0)return!1;ge=ge.prevZ}for(;Ce&&Ce.z<=yt;){if(Ce!==I.prev&&Ce!==I.next&&T(W.x,W.y,Y.x,Y.y,te.x,te.y,Ce.x,Ce.y)&&S(Ce.prev,Ce,Ce.next)>=0)return!1;Ce=Ce.nextZ}return!0}function o(I,z,F){var j=I;do{var W=j.prev,Y=j.next.next;!E(W,Y)&&A(W,j,j.next,Y)&&k(W,Y)&&k(Y,W)&&(z.push(W.i/F),z.push(j.i/F),z.push(Y.i/F),Z(j),Z(j.next),j=I=Y),j=j.next}while(j!==I);return r(j)}function a(I,z,F,j,W,Y){var te=I;do{for(var me=te.next.next;me!==te.prev;){if(te.i!==me.i&&x(te,me)){var Le=N(te,me);return te=r(te,te.next),Le=r(Le,Le.next),i(te,z,F,j,W,Y),void i(Le,z,F,j,W,Y)}me=me.next}te=te.next}while(te!==I)}function l(I,z,F,j){var W,Y,te,me=[];for(W=0,Y=z.length;W<Y;W++)(te=e(I,z[W]*j,W<Y-1?z[W+1]*j:I.length,j,!1))===te.next&&(te.steiner=!0),me.push(b(te));for(me.sort(c),W=0;W<me.length;W++)F=r(F=p(me[W],F),F.next);return F}function c(I,z){return I.x-z.x}function h(I){if(I.next.prev===I)return I;let z=I;for(;;){const F=z.next;if(F.prev===z||F===z||F===I)break;z=F}return z}function p(I,z){var F=f(I,z);if(!F)return z;var j=N(F,I),W=r(F,F.next);let Y=h(j);return r(Y,Y.next),W=h(W),h(z===F?W:z)}function f(I,z){var F,j=z,W=I.x,Y=I.y,te=-1/0;do{if(Y<=j.y&&Y>=j.next.y&&j.next.y!==j.y){var me=j.x+(Y-j.y)*(j.next.x-j.x)/(j.next.y-j.y);if(me<=W&&me>te){if(te=me,me===W){if(Y===j.y)return j;if(Y===j.next.y)return j.next}F=j.x<j.next.x?j:j.next}}j=j.next}while(j!==z);if(!F)return null;if(W===te)return F;var Le,dt=F,st=F.x,Xe=F.y,yt=1/0;j=F;do W>=j.x&&j.x>=st&&W!==j.x&&T(Y<Xe?W:te,Y,st,Xe,Y<Xe?te:W,Y,j.x,j.y)&&(Le=Math.abs(Y-j.y)/(W-j.x),k(j,I)&&(Le<yt||Le===yt&&(j.x>F.x||j.x===F.x&&m(F,j)))&&(F=j,yt=Le)),j=j.next;while(j!==dt);return F}function m(I,z){return S(I.prev,I,z.prev)<0&&S(z.next,I,I.next)<0}function y(I,z,F,j){var W=I;do W.z===null&&(W.z=v(W.x,W.y,z,F,j)),W.prevZ=W.prev,W.nextZ=W.next,W=W.next;while(W!==I);W.prevZ.nextZ=null,W.prevZ=null,_(W)}function _(I){var z,F,j,W,Y,te,me,Le,dt=1;do{for(F=I,I=null,Y=null,te=0;F;){for(te++,j=F,me=0,z=0;z<dt&&(me++,j=j.nextZ);z++);for(Le=dt;me>0||Le>0&&j;)me!==0&&(Le===0||!j||F.z<=j.z)?(W=F,F=F.nextZ,me--):(W=j,j=j.nextZ,Le--),Y?Y.nextZ=W:I=W,W.prevZ=Y,Y=W;F=j}Y.nextZ=null,dt*=2}while(te>1);return I}function v(I,z,F,j,W){return(I=1431655765&((I=858993459&((I=252645135&((I=16711935&((I=32767*(I-F)*W)|I<<8))|I<<4))|I<<2))|I<<1))|(z=1431655765&((z=858993459&((z=252645135&((z=16711935&((z=32767*(z-j)*W)|z<<8))|z<<4))|z<<2))|z<<1))<<1}function b(I){var z=I,F=I;do(z.x<F.x||z.x===F.x&&z.y<F.y)&&(F=z),z=z.next;while(z!==I);return F}function T(I,z,F,j,W,Y,te,me){return(W-te)*(z-me)-(I-te)*(Y-me)>=0&&(I-te)*(j-me)-(F-te)*(z-me)>=0&&(F-te)*(Y-me)-(W-te)*(j-me)>=0}function x(I,z){return I.next.i!==z.i&&I.prev.i!==z.i&&!D(I,z)&&(k(I,z)&&k(z,I)&&$(I,z)&&(S(I.prev,I,z.prev)||S(I,z.prev,z))||E(I,z)&&S(I.prev,I,I.next)>0&&S(z.prev,z,z.next)>0)}function S(I,z,F){return(z.y-I.y)*(F.x-z.x)-(z.x-I.x)*(F.y-z.y)}function E(I,z){return I.x===z.x&&I.y===z.y}function A(I,z,F,j){var W=M(S(I,z,F)),Y=M(S(I,z,j)),te=M(S(F,j,I)),me=M(S(F,j,z));return W!==Y&&te!==me||!(W!==0||!R(I,F,z))||!(Y!==0||!R(I,j,z))||!(te!==0||!R(F,I,j))||!(me!==0||!R(F,z,j))}function R(I,z,F){return z.x<=Math.max(I.x,F.x)&&z.x>=Math.min(I.x,F.x)&&z.y<=Math.max(I.y,F.y)&&z.y>=Math.min(I.y,F.y)}function M(I){return I>0?1:I<0?-1:0}function D(I,z){var F=I;do{if(F.i!==I.i&&F.next.i!==I.i&&F.i!==z.i&&F.next.i!==z.i&&A(F,F.next,I,z))return!0;F=F.next}while(F!==I);return!1}function k(I,z){return S(I.prev,I,I.next)<0?S(I,z,I.next)>=0&&S(I,I.prev,z)>=0:S(I,z,I.prev)<0||S(I,I.next,z)<0}function $(I,z){var F=I,j=!1,W=(I.x+z.x)/2,Y=(I.y+z.y)/2;do F.y>Y!=F.next.y>Y&&F.next.y!==F.y&&W<(F.next.x-F.x)*(Y-F.y)/(F.next.y-F.y)+F.x&&(j=!j),F=F.next;while(F!==I);return j}function N(I,z){var F=new G(I.i,I.x,I.y),j=new G(z.i,z.x,z.y),W=I.next,Y=z.prev;return I.next=z,z.prev=I,F.next=W,W.prev=F,j.next=F,F.prev=j,Y.next=j,j.prev=Y,j}function H(I,z,F,j){var W=new G(I,z,F);return j?(W.next=j.next,W.prev=j,j.next.prev=W,j.next=W):(W.prev=W,W.next=W),W}function Z(I){I.next.prev=I.prev,I.prev.next=I.next,I.prevZ&&(I.prevZ.nextZ=I.nextZ),I.nextZ&&(I.nextZ.prevZ=I.prevZ)}function G(I,z,F){this.i=I,this.x=z,this.y=F,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function J(I,z,F,j){for(var W=0,Y=z,te=F-j;Y<F;Y+=j)W+=(I[te]-I[Y])*(I[Y+1]+I[te+1]),te=Y;return W}return t.deviation=function(I,z,F,j){var W=z&&z.length,Y=W?z[0]*F:I.length,te=Math.abs(J(I,0,Y,F));if(W)for(var me=0,Le=z.length;me<Le;me++){var dt=z[me]*F,st=me<Le-1?z[me+1]*F:I.length;te-=Math.abs(J(I,dt,st,F))}var Xe=0;for(me=0;me<j.length;me+=3){var yt=j[me]*F,ge=j[me+1]*F,Ce=j[me+2]*F;Xe+=Math.abs((I[yt]-I[Ce])*(I[ge+1]-I[yt+1])-(I[yt]-I[ge])*(I[Ce+1]-I[yt+1]))}return te===0&&Xe===0?0:Math.abs((Xe-te)/te)},t.flatten=function(I){for(var z=I[0][0].length,F={vertices:[],holes:[],dimensions:z},j=0,W=0;W<I.length;W++){for(var Y=0;Y<I[W].length;Y++)for(var te=0;te<z;te++)F.vertices.push(I[W][Y][te]);W>0&&(j+=I[W-1].length,F.holes.push(j))}return F},t},(Rae=Oae())!==void 0&&(Aae.exports=Rae);const AE=VM(Nq.exports),LU=Q.getLogger("esri.views.3d.support.buffer.math");function Wat(t,e,r){OE(t.typedBuffer,e.typedBuffer,r,t.typedBufferStride,e.typedBufferStride)}function OE(t,e,r,i=3,s=i){if(t.length/i!==Math.ceil(e.length/s))return LU.error("source and destination buffers need to have the same number of elements"),t;const n=t.length/i,o=r[0],a=r[1],l=r[2],c=r[4],h=r[5],p=r[6],f=r[8],m=r[9],y=r[10],_=r[12],v=r[13],b=r[14];let T=0,x=0;for(let S=0;S<n;S++){const E=e[T],A=e[T+1],R=e[T+2];t[x]=o*E+c*A+f*R+_,t[x+1]=a*E+h*A+m*R+v,t[x+2]=l*E+p*A+y*R+b,T+=s,x+=i}return t}function zCe(t,e,r){Vw(t.typedBuffer,e.typedBuffer,r,t.typedBufferStride,e.typedBufferStride)}function Vw(t,e,r,i=3,s=i){if(t.length/i!==Math.ceil(e.length/s))return void LU.error("source and destination buffers need to have the same number of elements");const n=t.length/i,o=r[0],a=r[1],l=r[2],c=r[3],h=r[4],p=r[5],f=r[6],m=r[7],y=r[8];let _=0,v=0;for(let b=0;b<n;b++){const T=e[_],x=e[_+1],S=e[_+2];t[v]=o*T+c*x+f*S,t[v+1]=a*T+h*x+m*S,t[v+2]=l*T+p*x+y*S,_+=s,v+=i}}function Xat(t,e,r){IF(t.typedBuffer,e,r,t.typedBufferStride)}function IF(t,e,r,i=3){const s=Math.min(t.length/i,e.count),n=e.typedBuffer,o=e.typedBufferStride;let a=0,l=0;for(let c=0;c<s;c++)t[l]=r*n[a],t[l+1]=r*n[a+1],t[l+2]=r*n[a+2],a+=o,l+=i}function Zat(t,e){DU(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function DU(t,e,r=3,i=r){const s=Math.min(t.length/r,e.length/i);let n=0,o=0;for(let a=0;a<s;a++){const l=e[n],c=e[n+1],h=e[n+2],p=l*l+c*c+h*h;if(p>0){const f=1/Math.sqrt(p);t[o]=f*l,t[o+1]=f*c,t[o+2]=f*h}n+=i,o+=r}}function Yat(t,e,r){const i=Math.min(t.count,e.count),s=t.typedBuffer,n=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;let l=0,c=0;for(let h=0;h<i;h++)s[c]=o[l]>>r,s[c+1]=o[l+1]>>r,s[c+2]=o[l+2]>>r,l+=a,c+=n}Object.freeze(Object.defineProperty({__proto__:null,normalize:DU,normalizeView:Zat,scale:IF,scaleView:Xat,shiftRight:Yat,transformMat3:Vw,transformMat3View:zCe,transformMat4:OE,transformMat4View:Wat},Symbol.toStringTag,{value:"Module"}));function Jat(t,e,r){return{objectId:t,target:e,distance:r,type:"vertex"}}function Mae(t,e,r,i,s,n=!1){return{objectId:t,target:e,distance:r,type:"edge",start:i,end:s,draped:n}}function NU(t,e){if(!t||t.symbol)return null;const r=e&&e.renderer;return t&&r!=null&&r.getObservationRenderer?r.getObservationRenderer(t):r}function Qat(t,e){if(t.symbol!=null)return t.symbol;const r=NU(t,e);return r!=null&&r.type!=="dot-density"?r.getSymbol(t,e):null}function W8t(t,e){const r=NU(t,e),i=Qat(t,e);if(i==null)return null;const s={renderer:r,symbol:i};if(r==null||!("visualVariables"in r)||!r.visualVariables)return s;const n=GZ(r,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)switch(a.type){case"color":s.color=l.toRgba();break;case"size":if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;switch(c){case"width":o[0]=h;break;case"depth":o[1]=h;break;case"height":o[2]=h;break;case"width-and-depth":o[0]=o[1]=h;break;default:o[0]=o[1]=o[2]=h}}break;case"opacity":s.opacity=l;break;case"rotation":switch(a.axis){case"tilt":s.tilt=l;break;case"roll":s.roll=l;break;default:s.heading=l}}return o[0]==="proportional"&&o[1]==="proportional"&&o[2]==="proportional"||(s.size=o),s}async function Kat(t,e){if(t.symbol!=null)return t.symbol;const r=NU(t,e);return r!=null?r.getSymbolAsync(t,e):null}async function X8t(t,e){const r=NU(t,e),i=await Kat(t,e);if(!i)return null;const s={renderer:r,symbol:i};if(!r||!("visualVariables"in r)||!r.visualVariables)return s;const n=GZ(r,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)if(a.type==="color")s.color=Ne.toUnitRGBA(l);else if(a.type==="size")if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;c==="width"?o[0]=h:c==="depth"?o[1]=h:c==="height"?o[2]=h:o[0]=o[1]=c==="width-and-depth"?h:o[2]=h}else a.type==="opacity"?s.opacity=l:a.type==="rotation"&&a.axis==="tilt"?s.tilt=l:a.type==="rotation"&&a.axis==="roll"?s.roll=l:a.type==="rotation"&&(s.heading=l);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(s.size=o),s}function elt(t,e=0){const r=t[e];return typeof r=="number"&&isFinite(r)?r:null}function tlt(t){for(let e=0;e<3;e++){const r=t[e];if(typeof r=="number")return isFinite(r)?r:0}return 0}function Pae(t){const e=[[C.POSITION,t.indices]],r=[[C.POSITION,new He(t.attributeData.position,3,!0)]];return t.attributeData.colorFeature!=null?(r.push([C.COLORFEATUREATTRIBUTE,new He([t.attributeData.colorFeature],1,!0)]),e.push([C.COLORFEATUREATTRIBUTE,new Array(t.indices.length).fill(0)])):t.attributeData.color&&(r.push([C.COLOR,new He(t.attributeData.color,4,!0)]),e.push([C.COLOR,uC(t.indices.length)])),t.attributeData.uvMapSpace&&(r.push([C.UVMAPSPACE,new He(t.attributeData.uvMapSpace,4,!0)]),e.push([C.UVMAPSPACE,t.indices])),t.attributeData.boundingRect&&(r.push([C.BOUNDINGRECT,new He(t.attributeData.boundingRect,9,!0)]),e.push([C.BOUNDINGRECT,t.indices])),new Ys(t.material,r,e,t.mapPositions,ls.Mesh,t.attributeData.objectAndLayerIdColor)}function Iae(t,e=null){const r=[[C.POSITION,t.indices],[C.UV0,t.indices]],i=[[C.POSITION,new He(t.attributeData.position,3,!0)],[C.UV0,new He(t.attributeData.uv0,2,!0)]];return new Ys(t.material,i,r,t.mapPositions,ls.Mesh,e)}function eM(t){switch(t.type){case"extent":if(t instanceof ur)return yu.fromExtent(t);break;case"polygon":return t}return null}let FU=class{constructor(e,r,i){this.renderData=e,this.layerUid=r,this.graphicUid=i,this.outGeometries=new Array}};function Fq(t,e,r){const i=Array.isArray(t),s=i?t.length/e:t.byteLength/(4*e),n=i?t:new Uint32Array(t,0,s*e),o=r?.minReduction??0,a=r?.originalIndices||null,l=a?a.length:0,c=r?.componentOffsets||null;let h=0;if(c)for(let A=0;A<c.length-1;A++){const R=c[A+1]-c[A];R>h&&(h=R)}else h=s;const p=Math.floor(1.1*h)+1;(Gp==null||Gp.length<2*p)&&(Gp=new Uint32Array(rFe(2*p)));for(let A=0;A<2*p;A++)Gp[A]=0;let f=0;const m=!!c&&!!a,y=m?l:s;let _=cF(s);const v=new Uint32Array(l),b=1.96;let T=o!==0?Math.ceil(4*b*b/(o*o)*o*(1-o)):y,x=1,S=c?c[1]:y;for(let A=0;A<y;A++){if(A===T){const N=1-f/A;if(N+b*Math.sqrt(N*(1-N)/A)<o)return null;T*=2}if(A===S){for(let N=0;N<2*p;N++)Gp[N]=0;if(a)for(let N=c[x-1];N<c[x];N++)v[N]=_[a[N]];S=c[++x]}const R=m?a[A]:A,M=R*e,D=slt(n,M,e);let k=D%p,$=f;for(;Gp[2*k+1]!==0;){if(Gp[2*k]===D){const N=Gp[2*k+1]-1;if(rlt(n,M,N*e,e)){$=_[N];break}}k++,k>=p&&(k-=p)}$===f&&(Gp[2*k]=D,Gp[2*k+1]=R+1,f++),_[R]=$}if(o!==0&&1-f/s<o)return null;if(m){for(let A=c[x-1];A<v.length;A++)v[A]=_[a[A]];_=Qf(v)}const E=i?new Array(f):new Uint32Array(f*e);f=0;for(let A=0;A<y;A++)_[A]===f&&(ilt(n,(m?a[A]:A)*e,E,f*e,e),f++);if(a&&!m){const A=new Uint32Array(l);for(let R=0;R<A.length;R++)A[R]=_[a[R]];_=Qf(A)}return{buffer:Array.isArray(E)?E:E.buffer,indices:_,uniqueCount:f}}function rlt(t,e,r,i){for(let s=0;s<i;s++)if(t[e+s]!==t[r+s])return!1;return!0}function ilt(t,e,r,i,s){for(let n=0;n<s;n++)r[i+n]=t[e+n]}function slt(t,e,r){let i=0;for(let s=0;s<r;s++)i=t[e+s]+i|0,i=i+(i<<11)+(i>>>2)|0;return i>>>0}let Gp=null;function Y8t(t){const e=cP(t.rings,t.hasZ,fm.CCW_IS_HOLE),r=new Array;let i=0,s=0;for(const a of e.polygons){const l=a.count,c=a.index,h=$h(e.position,3*c,3*l),p=a.holeIndices.map(m=>m-c),f=Qf(AE(h,p,3));r.push({position:h,faces:f}),i+=h.length,s+=f.length}const n=nlt(r,i,s),o=Array.isArray(n.position)?Fq(n.position,3,{originalIndices:n.faces}):Fq(n.position.buffer,6,{originalIndices:n.faces});return n.position=rSe(new Float64Array(o.buffer)),n.faces=o.indices,n}function nlt(t,e,r){if(t.length===1)return t[0];const i=Ho(e),s=new Array(r);let n=0,o=0,a=0;for(const l of t){for(let c=0;c<l.position.length;c++)i[n++]=l.position[c];for(const c of l.faces)s[o++]=c+a;a=n/3}return{position:i,faces:Qf(s)}}function cP(t,e,r){const i=t.length,s=new Array(i),n=new Array(i),o=new Array(i);let a=0,l=0,c=0,h=0;for(let m=0;m<i;++m)h+=t[m].length;const p=Ho(3*h);let f=0;for(let m=i-1;m>=0;m--){const y=t[m],_=r===fm.CCW_IS_HOLE&&olt(y);if(_&&i!==1)s[a++]=y;else{let v=y.length;for(let T=0;T<a;++T)v+=s[T].length;const b={index:f,pathLengths:new Array(a+1),count:v,holeIndices:new Array(a)};b.pathLengths[0]=y.length,y.length>0&&(o[c++]={index:f,count:y.length}),f=_?S$(y,y.length-1,-1,p,f,y.length,e):S$(y,0,1,p,f,y.length,e);for(let T=0;T<a;++T){const x=s[T];b.holeIndices[T]=f,b.pathLengths[T+1]=x.length,x.length>0&&(o[c++]={index:f,count:x.length}),f=S$(x,0,1,p,f,x.length,e)}a=0,b.count>0&&(n[l++]=b)}}for(let m=0;m<a;++m){const y=s[m];y.length>0&&(o[c++]={index:f,count:y.length}),f=S$(y,0,1,p,f,y.length,e)}return n.length=l,o.length=c,{position:p,polygons:n,outlines:o}}function S$(t,e,r,i,s,n,o){s*=3;for(let a=0;a<n;++a){const l=t[e];i[s++]=l[0],i[s++]=l[1],i[s++]=o?l[2]:0,e+=r}return s/3}function olt(t){return!Pge(t,!1,!1)}var fm;(function(t){t[t.NONE=0]="NONE",t[t.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(fm||(fm={}));var JO,$F,Uq;(function(t){t[t.RasterImage=0]="RasterImage",t[t.Features=1]="Features"})(JO||(JO={})),function(t){t[t.MapLayer=0]="MapLayer",t[t.ViewLayer=1]="ViewLayer",t[t.Outline=2]="Outline",t[t.SnappingHint=3]="SnappingHint"}($F||($F={})),function(t){t[t.WithRasterImage=0]="WithRasterImage",t[t.WithoutRasterImage=1]="WithoutRasterImage"}(Uq||(Uq={}));let VCe=class{constructor(e,r){this._fbo=null;const i=new xr;i.wrapMode=Dt.CLAMP_TO_EDGE,i.samplingMode=Rt.LINEAR_MIPMAP_LINEAR,i.hasMipmap=r,i.maxAnisotropy=8,this._fbo=new hn(e,i)}dispose(){this._fbo=Ve(this._fbo)}getTexture(){return this._fbo?.colorTexture}isValid(){return this._fbo!=null}resize(e,r){this._fbo?.resize(e,r)}bind(e){e.bindFramebuffer(this._fbo)}generateMipMap(){const e=this._fbo?.colorTexture;e?.descriptor.hasMipmap&&e.generateMipmap()}disposeRenderTargetMemory(){this._fbo?.resize(0,0)}get gpuMemoryUsage(){return this._fbo?.gpuMemoryUsage??0}},iT=class{constructor(e,r,i,s=!0){this.output=r,this.type=i,this.valid=!1,this.lastUsed=1/0,this.fbo=new VCe(e,s)}},alt=class{constructor(e){this.renderTargets=[new iT(e,U.Color,ns.Color),new iT(e,U.Color,ns.ColorNoRasterImage),new iT(e,U.Highlight,ns.Highlight,!1),new iT(e,U.Normal,ns.Water),new iT(e,U.Color,ns.Occluded)],oe("enable-feature:objectAndLayerId-rendering")&&this.renderTargets.push(new iT(e,U.ObjectAndLayerIdColor,ns.ObjectAndLayerIdColor))}getTarget(e){return this.renderTargets[e].fbo}dispose(){for(const e of this.renderTargets)e.fbo.dispose()}disposeRenderTargetMemory(){for(const e of this.renderTargets)e.fbo.disposeRenderTargetMemory()}validateUsageForTarget(e,r,i){return e?(r.lastUsed=i,!1):i-r.lastUsed>llt?(r.fbo.disposeRenderTargetMemory(),r.lastUsed=1/0,!1):r.lastUsed<1/0}get gpuMemoryUsage(){return this.renderTargets.reduce((e,r)=>e+r.fbo.gpuMemoryUsage,0)}};const llt=1e3;let BCe=class extends ri{constructor(){super(...arguments),this.color=Nt(1,1,1,1)}};function clt(){const t=new Sr;return t.include(Zh),t.fragment.uniforms.add(new et("tex",e=>e.texture),new nr("uColor",e=>e.color)),t.fragment.code.add(w`void main() {
vec4 texColor = texture(tex, uv);
fragColor = texColor * uColor;
}`),t}const ult=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:BCe,build:clt},Symbol.toStringTag,{value:"Module"}));let GCe=class{constructor(e){this._context=e,this._perConstructorInstances=new hC,this._frameCounter=0,this._keepAliveFrameCount=$ae}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach(e=>e.forEach(r=>r.technique.destroy())),this._perConstructorInstances.clear()}acquire(e,r=dlt){const i=r.key;let s=this._perConstructorInstances.get(e,i);if(s==null){const n=new e(this._context,r,()=>this.release(n));s=new hlt(n),this._perConstructorInstances.set(e,i,s)}return++s.refCount,s.technique}releaseAndAcquire(e,r,i){if(i!=null){if(r.key===i.key)return i;this.release(i)}return this.acquire(e,r)}release(e){if(e==null||this._perConstructorInstances.empty)return;const r=this._perConstructorInstances.get(e.constructor,e.key);r!=null&&(--r.refCount,r.refCount===0&&(r.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==$ae&&this._perConstructorInstances.forEach((e,r)=>{e.forEach((i,s)=>{i.refCount===0&&i.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(i.technique.destroy(),this._perConstructorInstances.delete(r,s))})})}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach((r,i)=>{const s=async(n,o)=>{const a=o.shader;a&&(await a.reload(),n.forEach(l=>l.technique.reload(this._context)))};e.push(s(r,i))}),await Promise.all(e)}},hlt=class{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}};const $ae=-1,dlt=new va;let jCe=class{constructor(e,r,i,s){this._textureRepository=e,this._techniqueRepository=r,this.materialChanged=i,this.requestRender=s,this._id2glMaterialRef=new hC}dispose(){this._textureRepository.destroy()}acquire(e,r,i){if(this._ownMaterial(e),!e.requiresSlot(r,i))return null;let s=this._id2glMaterialRef.get(i,e.id);if(s==null){const n=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:i});s=new plt(n),this._id2glMaterialRef.set(i,e.id,s)}return s.ref(),s.glMaterial}release(e,r){const i=this._id2glMaterialRef.get(r,e.id);i!=null&&(i.unref(),i.referenced||(Ve(i.glMaterial),this._id2glMaterialRef.delete(r,e.id)))}_ownMaterial(e){e.repository!=null&&e.repository!==this&&Q.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}},plt=class{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,nt(this._refCnt>=0)}get referenced(){return this._refCnt>0}};const flt={orderedRepackingEnabled:!1},mlt=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","objectGeometryUpdated"];let kq=class fN{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(e,r){this.objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new Hn,this._objectCount=0,r&&(r.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=r.maximumObjectsPerNode),r.maximumDepth!==void 0&&(this._maximumDepth=r.maximumDepth))}destroy(){this._degenerateObjects.clear(),Hn.clearPool(),zq[0]=null,Qv.prune(),ub.prune()}add(e,r=e.length){this._objectCount+=r,this._grow(e,r);const i=Hn.acquire();for(let s=0;s<r;s++){const n=e[s];this._isDegenerate(n)?this._degenerateObjects.add(n):(i.init(this._root),this._add(n,i))}Hn.release(i)}remove(e,r=null){this._objectCount-=e.length;const i=Hn.acquire();for(const s of e){const n=r??aE(this.objectToBoundingSphere(s),blt);H3(n[3])?(i.init(this._root),this._remove(s,n,i)):this._degenerateObjects.delete(s)}Hn.release(i),this._shrink()}update(e,r){if(!H3(r[3])&&this._isDegenerate(e))return;const i=vlt(e);this.remove(i,r),this.add(i)}forEachAlongRay(e,r,i){const s=Ou(e,r);this._forEachNode(this._root,n=>{if(!this._intersectsNode(s,n))return!1;const o=n.node;return o.terminals.forAll(a=>{this._intersectsObject(s,a)&&i(a)}),o.residents!==null&&o.residents.forAll(a=>{this._intersectsObject(s,a)&&i(a)}),!0})}forEachAlongRayWithVerticalOffset(e,r,i,s){const n=Ou(e,r);this._forEachNode(this._root,o=>{if(!this._intersectsNodeWithOffset(n,o,s))return!1;const a=o.node;return a.terminals.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&i(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&i(l)}),!0})}forEach(e){this._forEachNode(this._root,r=>{const i=r.node;return i.terminals.forAll(e),i.residents!==null&&i.residents.forAll(e),!0}),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,r,i,s=()=>!0,n=1/0){let o=1/0,a=1/0,l=null;const c=Ik(e,r),h=p=>{if(--n,!s(p))return;const f=this.objectToBoundingSphere(p);if(!D_(i,f))return;const m=u_(e,r,f),y=m-f[3],_=m+f[3];y<o&&(o=y,a=_,l=p)};return this._forEachNodeDepthOrdered(this._root,p=>{if(n<=0||!D_(i,p.bounds)||(ie(Bu,c,p.halfSize),ue(Bu,Bu,p.bounds),u_(e,r,Bu)>a))return!1;const f=p.node;return f.terminals.forAll(m=>h(m)),f.residents!==null&&f.residents.forAll(m=>h(m)),!0},e,r),l}forEachInDepthRange(e,r,i,s,n,o,a){let l=-1/0,c=1/0;const h={setRange:_=>{i===fN.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,_.near),c=Math.min(c,_.far)):(l=Math.max(l,-_.far),c=Math.min(c,-_.near))}};h.setRange(s);const p=u_(r,i,e),f=Ik(r,i),m=Ik(r,-i),y=_=>{if(!a(_))return;const v=this.objectToBoundingSphere(_),b=v,T=u_(r,i,b)-p,x=T-v[3],S=T+v[3];x>c||S<l||!D_(o,v)||n(_,h)};this._forEachNodeDepthOrdered(this._root,_=>{if(!D_(o,_.bounds)||(ie(Bu,f,_.halfSize),ue(Bu,Bu,_.bounds),u_(r,i,Bu)-p>c)||(ie(Bu,m,_.halfSize),ue(Bu,Bu,_.bounds),u_(r,i,Bu)-p<l))return!1;const v=_.node;return v.terminals.forAll(b=>y(b)),v.residents!==null&&v.residents.forAll(b=>y(b)),!0},r,i)}forEachNode(e){this._forEachNode(this._root,r=>e(r.node,r.bounds,r.halfSize,r.depth))}forEachNeighbor(e,r){const i=qg(r),s=r,n=l=>{const c=this.objectToBoundingSphere(l),h=qg(c),p=i+h;return!(vo(c,s)-p*p<=0)||e(l)};let o=!0;const a=l=>{o&&(o=n(l))};this._forEachNode(this._root,l=>{const c=qg(l.bounds),h=i+c;if(vo(l.bounds,s)-h*h>0)return!1;const p=l.node;return p.terminals.forAll(a),o&&p.residents!==null&&p.residents.forAll(a),o}),o&&this.forEachDegenerateObject(a)}_intersectsNode(e,r){return E$(r.bounds,2*-r.halfSize,nu),E$(r.bounds,2*r.halfSize,ou),Vse(e.origin,e.direction,nu,ou)}_intersectsNodeWithOffset(e,r,i){return E$(r.bounds,2*-r.halfSize,nu),E$(r.bounds,2*r.halfSize,ou),i.applyToMinMax(nu,ou),Vse(e.origin,e.direction,nu,ou)}_intersectsObject(e,r){const i=this.objectToBoundingSphere(r);return!(i[3]>0)||Aj(i,e)}_intersectsObjectWithOffset(e,r,i){const s=this.objectToBoundingSphere(r);return!(s[3]>0)||Aj(i.applyToBoundingSphere(s),e)}_forEachNode(e,r){let i=Hn.acquire().init(e);const s=[i];for(;s.length!==0;){if(i=s.pop(),r(i)&&!i.isLeaf())for(let n=0;n<i.node.children.length;n++)i.node.children[n]&&s.push(Hn.acquire().init(i).advance(n));Hn.release(i)}}_forEachNodeDepthOrdered(e,r,i,s=fN.DepthOrder.FRONT_TO_BACK){let n=Hn.acquire().init(e);const o=[n];for(_lt(i,s,Nae);o.length!==0;){if(n=o.pop(),r(n)&&!n.isLeaf())for(let a=7;a>=0;--a){const l=Nae[a];n.node.children[l]&&o.push(Hn.acquire().init(n).advance(l))}Hn.release(n)}}_remove(e,r,i){Qv.clear();const s=i.advanceTo(r,(n,o)=>{Qv.push(n.node),Qv.push(o)})?i.node.terminals:i.node.residents;if(s.removeUnordered(e),s.length===0)for(let n=Qv.length-2;n>=0;n-=2){const o=Qv.data[n],a=Qv.data[n+1];if(!this._purge(o,a))break}}_nodeIsEmpty(e){if(e.terminals.length!==0)return!1;if(e.residents!==null)return e.residents.length===0;for(let r=0;r<e.children.length;r++)if(e.children[r])return!1;return!0}_purge(e,r){return r>=0&&(e.children[r]=null),!!this._nodeIsEmpty(e)&&(e.residents===null&&(e.residents=new Bt({shrink:!0})),!0)}_add(e,r){r.advanceTo(this.objectToBoundingSphere(e))?r.node.terminals.push(e):(r.node.residents.push(e),r.node.residents.length>this._maximumObjectsPerNode&&r.depth<this._maximumDepth&&this._split(r))}_split(e){const r=e.node.residents;e.node.residents=null;for(let i=0;i<r.length;i++){const s=Hn.acquire().init(e);this._add(r.at(i),s),Hn.release(s)}}_grow(e,r){if(r!==0&&(Lae(e,r,i=>this.objectToBoundingSphere(i),Um),H3(Um[3])&&!this._fitsInsideTree(Um)))if(this._nodeIsEmpty(this._root.node))aE(Um,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const i=this._rootBoundsForRootAsSubNode(Um);this._placingRootViolatesMaxDepth(i)?this._rebuildTree(Um,i):this._growRootAsSubNode(i),Hn.release(i)}}_rebuildTree(e,r){re(Lk,r.bounds),Lk[3]=r.halfSize,Lae([e,Lk],2,s=>s,Dk);const i=Hn.acquire().init(this._root);this._root.initFrom(null,Dk,Dk[3]),this._root.increaseHalfSize(1.25),this._forEachNode(i,s=>(this.add(s.node.terminals.data,s.node.terminals.length),s.node.residents!==null&&this.add(s.node.residents.data,s.node.residents.length),!0)),Hn.release(i)}_placingRootViolatesMaxDepth(e){const r=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let i=0;return this._forEachNode(this._root,s=>(i=Math.max(i,s.depth),i+r<=this._maximumDepth)),i+r>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const r=e[3],i=e;let s=-1/0;const n=this._root.bounds,o=this._root.halfSize;for(let l=0;l<3;l++){const c=n[l]-o-(i[l]-r),h=i[l]+r-(n[l]+o),p=Math.max(0,Math.ceil(c/(2*o))),f=Math.max(0,Math.ceil(h/(2*o)))+1,m=2**Math.ceil(Math.log(p+f)*Math.LOG2E);s=Math.max(s,m),C$[l].min=p,C$[l].max=f}for(let l=0;l<3;l++){let c=C$[l].min,h=C$[l].max;const p=(s-(c+h))/2;c+=Math.ceil(p),h+=Math.floor(p);const f=n[l]-o-c*o*2;$k[l]=f+(h+c)*o}const a=s*o;return $k[3]=a*qCe,Hn.acquire().initFrom(null,$k,a,0)}_growRootAsSubNode(e){const r=this._root.node;re(Um,this._root.bounds),Um[3]=this._root.halfSize,this._root.init(e),e.advanceTo(Um,null,!0),e.node.children=r.children,e.node.residents=r.residents,e.node.terminals=r.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(e===-1)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let e=null;const r=this._root.node.children;let i=0,s=0;for(;s<r.length&&e==null;)i=s++,e=r[i];for(;s<r.length;)if(r[s++])return-1;return i}_isDegenerate(e){return!H3(this.objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const r=this._root.bounds,i=this._root.halfSize;return e[3]<=i&&e[0]>=r[0]-i&&e[0]<=r[0]+i&&e[1]>=r[1]-i&&e[1]<=r[1]+i&&e[2]>=r[2]-i&&e[2]<=r[2]+i}toJSON(){const{maximumDepth:e,maximumObjectsPerNode:r,_objectCount:i}=this,s=this._nodeToJSON(this._root.node);return{maximumDepth:e,maximumObjectsPerNode:r,objectCount:i,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:s}}}_nodeToJSON(e){const r=e.children.map(n=>n?this._nodeToJSON(n):null),i=e.residents?.map(n=>this.objectToBoundingSphere(n)),s=e.terminals?.map(n=>this.objectToBoundingSphere(n));return{children:r,residents:i,terminals:s}}static fromJSON(e){const r=new fN(i=>i,{maximumDepth:e.maximumDepth,maximumObjectsPerNode:e.maximumObjectsPerNode});return r._objectCount=e.objectCount,r._root.initFrom(e.root.node,e.root.bounds,e.root.halfSize,e.root.depth),r}},Hn=class yS{constructor(){this.bounds=bs(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,r,i,s=this.depth){return this.node=e??yS.createEmptyNode(),r!=null&&aE(r,this.bounds),this.halfSize=i,this.depth=s,this}increaseHalfSize(e){this.halfSize*=e,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*qCe}advance(e){let r=this.node.children[e];r||(r=yS.createEmptyNode(),this.node.children[e]=r),this.node=r,this.halfSize/=2,this.depth++;const i=HCe[e];return this.bounds[0]+=i[0]*this.halfSize,this.bounds[1]+=i[1]*this.halfSize,this.bounds[2]+=i[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(e,r,i=!1){for(;;){if(this.isTerminalFor(e))return r&&r(this,-1),!0;if(this.isLeaf()){if(!i)return r&&r(this,-1),!1;this.node.residents=null}const s=this._childIndex(e);r&&r(this,s),this.advance(s)}}isLeaf(){return this.node.residents!=null}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const r=this.bounds;return(r[0]<e[0]?1:0)+(r[1]<e[1]?2:0)+(r[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new Bt({shrink:!0}),residents:new Bt({shrink:!0})}}static acquire(){return yS._pool.acquire()}static release(e){yS._pool.release(e)}static clearPool(){yS._pool.prune()}};function glt(t,e){t[0]=Math.min(t[0],e[0]-e[3]),t[1]=Math.min(t[1],e[1]-e[3]),t[2]=Math.min(t[2],e[2]-e[3])}function ylt(t,e){t[0]=Math.max(t[0],e[0]+e[3]),t[1]=Math.max(t[1],e[1]+e[3]),t[2]=Math.max(t[2],e[2]+e[3])}function E$(t,e,r){r[0]=t[0]+e,r[1]=t[1]+e,r[2]=t[2]+e}function Lae(t,e,r,i){if(e===1){const s=r(t[0]);aE(s,i)}else{nu[0]=1/0,nu[1]=1/0,nu[2]=1/0,ou[0]=-1/0,ou[1]=-1/0,ou[2]=-1/0;for(let s=0;s<e;s++){const n=r(t[s]);H3(n[3])&&(glt(nu,n),ylt(ou,n))}Hr(i,nu,ou,.5),i[3]=Math.max(ou[0]-nu[0],ou[1]-nu[1],ou[2]-nu[2])/2}}function _lt(t,e,r){if(!ub.length)for(let i=0;i<8;++i)ub.push({index:0,distance:0});for(let i=0;i<8;++i){const s=HCe[i];ub.data[i].index=i,ub.data[i].distance=u_(t,e,s)}ub.sort((i,s)=>i.distance-s.distance);for(let i=0;i<8;++i)r[i]=ub.data[i].index}function Ik(t,e){let r,i=1/0;for(let s=0;s<8;++s){const n=u_(t,e,Dae[s]);n<i&&(i=n,r=Dae[s])}return r}function u_(t,e,r){return e*(t[0]*r[0]+t[1]*r[1]+t[2]*r[2])}function H3(t){return!isNaN(t)&&t!==-1/0&&t!==1/0&&t>0}Hn._pool=new Go(Hn),function(t){var e;(e=t.DepthOrder||(t.DepthOrder={}))[e.FRONT_TO_BACK=1]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(kq||(kq={}));const HCe=[Me(-1,-1,-1),Me(1,-1,-1),Me(-1,1,-1),Me(1,1,-1),Me(-1,-1,1),Me(1,-1,1),Me(-1,1,1),Me(1,1,1)],Dae=[Me(-1,-1,-1),Me(-1,-1,1),Me(-1,1,-1),Me(-1,1,1),Me(1,-1,-1),Me(1,-1,1),Me(1,1,-1),Me(1,1,1)],qCe=Math.sqrt(3),zq=[null];function vlt(t){return zq[0]=t,zq}const $k=bs(),Bu=O(),nu=O(),ou=O(),Qv=new Bt,blt=bs(),Um=bs(),Lk=bs(),Dk=bs(),C$=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],ub=new Bt,Nae=[0,0,0,0,0,0,0,0],lp=kq;var H_;(function(t){t[t.ASYNC=0]="ASYNC",t[t.SYNC=1]="SYNC"})(H_||(H_={}));let WCe=class extends QM{get objects(){return this._objects}constructor(e,r,i=""){super(),this.stage=e,this.apiLayerUid=i,this.type=ls.Layer,this.events=new ws,this.sliceable=!1,this._objects=new Bt,this._objectsAdded=new Bt,this._handles=new Ii,this.apiLayerUid=i,this.visible=r?.visible??!0,this.pickable=r?.pickable??!0,this.updatePolicy=r?.updatePolicy??H_.ASYNC,this._disableOctree=r?.disableOctree??!1,e.add(this);for(const s of mlt)this._handles.add(this.events.on(s,n=>e.handleEvent(s,n)))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),this._octree!=null&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),this._octree!=null&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const r of e)r.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),this._octree!=null&&this._objectsAdded.pushArray(e)}removeMany(e){const r=new Array;if(this._objects.removeUnorderedMany(e,e.length,r),r.length!==0){for(const i of r)i.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:r}),this._octree!=null){for(let i=0;i<r.length;)this._objectsAdded.removeUnordered(r[i])?(r[i]=r[r.length-1],r.length-=1):++i;this._octree.remove(r)}}}sync(){this.updatePolicy!==H_.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(e,r){this._octree==null||this._objectsAdded.includes(e)||this._octree.update(e,r)}getSpatialQueryAccelerator(){return this._octree==null&&this._objects.length>50&&!this._disableOctree?(this._octree=new lp(e=>e.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):this._octree!=null&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=$e(this._octree),this._objectsAdded.clear()}};function LF(t){return t!=null&&t.type===ls.Layer}var Tu,Bw;(function(t){t[t.Draped=0]="Draped",t[t.Screen=1]="Screen",t[t.World=2]="World",t[t.COUNT=3]="COUNT"})(Tu||(Tu={})),function(t){t[t.Center=0]="Center",t[t.Tip=1]="Tip",t[t.COUNT=2]="COUNT"}(Bw||(Bw={}));let uo=class extends Vo{constructor(){super(...arguments),this.output=U.Color,this.transparencyPassType=ut.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=Tu.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=Bw.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}get draped(){return this.space===Tu.Draped}};u([B({count:U.COUNT})],uo.prototype,"output",void 0),u([B({count:ut.COUNT})],uo.prototype,"transparencyPassType",void 0),u([B()],uo.prototype,"occluder",void 0),u([B()],uo.prototype,"hasSlicePlane",void 0),u([B()],uo.prototype,"writeDepth",void 0),u([B({count:Tu.COUNT})],uo.prototype,"space",void 0),u([B()],uo.prototype,"hideOnShortSegments",void 0),u([B()],uo.prototype,"hasCap",void 0),u([B({count:Bw.COUNT})],uo.prototype,"anchor",void 0),u([B()],uo.prototype,"hasTip",void 0),u([B()],uo.prototype,"vvSize",void 0),u([B()],uo.prototype,"vvColor",void 0),u([B()],uo.prototype,"vvOpacity",void 0),u([B()],uo.prototype,"hasOccludees",void 0),u([B()],uo.prototype,"hasMultipassTerrain",void 0),u([B()],uo.prototype,"cullAboveGround",void 0),u([B({constValue:!0})],uo.prototype,"hasVvInstancing",void 0),u([B({constValue:!0})],uo.prototype,"hasSliceTranslatedView",void 0);const Fae=8;function XCe(t,e){const r=t.vertex;r.uniforms.add(new Pe("intrinsicWidth",i=>i.width)),e.vvSize?(t.attributes.add(C.SIZEFEATUREATTRIBUTE,"float"),r.uniforms.add(new zt("vvSizeMinSize",i=>i.vvSize.minSize),new zt("vvSizeMaxSize",i=>i.vvSize.maxSize),new zt("vvSizeOffset",i=>i.vvSize.offset),new zt("vvSizeFactor",i=>i.vvSize.factor)),r.code.add(w`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(t.attributes.add(C.SIZE,"float"),r.code.add(w`float getSize(){
return intrinsicWidth * size;
}`)),e.vvOpacity?(t.attributes.add(C.OPACITYFEATUREATTRIBUTE,"float"),r.constants.add("vvOpacityNumber","int",8),r.uniforms.add(new Ol("vvOpacityValues",i=>i.vvOpacity.values,Fae),new Ol("vvOpacityOpacities",i=>i.vvOpacity.opacityValues,Fae)),r.code.add(w`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):r.code.add(w`vec4 applyOpacity( vec4 color ){
return color;
}`),e.vvColor?(t.include(Yg,e),t.attributes.add(C.COLORFEATUREATTRIBUTE,"float"),r.code.add(w`vec4 getColor(){
return applyOpacity(interpolateVVColor(colorFeatureAttribute));
}`)):(t.attributes.add(C.COLOR,"vec4"),r.code.add(w`vec4 getColor(){
return applyOpacity(color);
}`))}function _y(t,e){switch(t.fragment.include(Nc),e.output){case U.Shadow:case U.ShadowHighlight:case U.ShadowExcludeHighlight:t.fragment.code.add(w`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
fragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`);break;case U.Depth:t.fragment.code.add(w`void outputDepth(float _linearDepth) {
fragColor = float2rgba(_linearDepth);
}`)}}let ZCe=class{constructor(e,r,i){this._createTexture=e,this._parametersKey=r,this._repository=new Map,this._orphanCache=i.newCache(`procedural-texture-repository:${Cc()}`,s=>s.dispose())}destroy(){for(const[e,{texture:r}]of this._repository)r.dispose();this._repository.clear(),this._orphanCache.destroy()}swap(e,r=null){const i=this._acquire(e);return this.release(r),i}release(e){if(e==null)return;const r=this._parametersKey(e),i=this._repository.get(r);if(i&&(i.refCount--,i.refCount===0)){this._repository.delete(r);const{texture:s}=i,n=s.gpuMemoryUsage;this._orphanCache.put(r,s,n)}}_acquire(e){if(e==null)return null;const r=this._parametersKey(e),i=this._repository.get(r);if(i)return i.refCount++,i.texture;const s=this._orphanCache.pop(r)??this._createTexture(e),n=new wlt(s);return this._repository.set(r,n),s}},wlt=class{constructor(e){this.texture=e,this.refCount=1}};function xlt(t,e){return new ZCe(r=>{const{encodedData:i,paddedPixels:s}=Tlt(r),n=new xr;return n.internalFormat=Ct.RGBA,n.width=s,n.height=1,n.wrapMode=Dt.CLAMP_TO_EDGE,new Ot(t,n,i)},r=>`${r.pattern.join(",")}-r${r.pixelRatio}`,e)}function Tlt(t){const e=PQ(t),r=1/t.pixelRatio,i=YCe(t),s=JCe(t),n=(Math.floor(.5*(s-1))+.5)*r,o=[];let a=1;for(const m of e){for(let y=0;y<m;y++){const _=a*(Math.min(y,m-1-y)+.5)*r/n*.5+.5;o.push(_)}a=-a}const l=Math.round(e[0]/2),c=[...o.slice(l),...o.slice(0,l)],h=i+QCe,p=new Uint8Array(4*h);let f=4;for(const m of c)YR(m,p,f),f+=4;return p.copyWithin(0,f-4,f),p.copyWithin(f,4,8),{encodedData:p,paddedPixels:h}}function PQ(t){return t.pattern.map(e=>Math.round(e*t.pixelRatio))}function YCe(t){if(t==null)return 1;const e=PQ(t);return Math.floor(e.reduce((r,i)=>r+i))}function JCe(t){return PQ(t).reduce((e,r)=>Math.max(e,r))}const QCe=2;function Slt(t){return t==null?Wf:t.length===4?t:xi(Elt,t[0],t[1],t[2],1)}const Elt=Xt();function KCe(t,e){t.constants.add("stippleAlphaColorDiscard","float",.001),t.constants.add("stippleAlphaHighlightDiscard","float",.5),e.stippleEnabled?Clt(t,e):Alt(t)}function Clt(t,e){const r=!(e.draped&&e.stipplePreferContinuous),{vertex:i,fragment:s}=t;s.include(Nc),e.draped||(Cp(i,e),i.uniforms.add(new Pe("worldToScreenPerDistanceRatio",(n,o)=>1/o.camera.perScreenPixelRatio)),i.code.add(w`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),t.varyings.add("vStippleDistance","float"),e.stippleRequiresClamp&&t.varyings.add("vStippleDistanceLimits","vec2"),e.stippleRequiresStretchMeasure&&t.varyings.add("vStipplePatternStretch","float"),i.code.add(w`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${Rlt};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),i.code.add(w`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),i.code.add(w`
    if (segmentLengthPseudoScreen >= ${r?"patternLength":"1e4"}) {
  `),gC(i,e),i.code.add(w`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${e.stippleRequiresStretchMeasure?w`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `),s.constants.add("stippleTexturePadding","float",QCe),s.uniforms.add(new et("stipplePatternTexture",n=>n.stippleTexture),new Pe("stipplePatternSDFNormalizer",n=>Olt(n.stipplePattern)),new Pe("stipplePatternPixelSizeInv",n=>1/IQ(n))),s.code.add(w`float padStippleTexture(float u) {
float paddedTextureSize = float(textureSize(stipplePatternTexture, 0).x);
float unpaddedTextureSize = paddedTextureSize - stippleTexturePadding;
return (u * unpaddedTextureSize + stippleTexturePadding * 0.5) / paddedTextureSize;
}`),s.code.add(w`
    float getStippleSDF(out bool isClamped) {
      ${e.stippleRequiresClamp?w`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:w`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${e.stippleScaleWithLineWidth?w`u *= vLineSizeInv;`:""}
      u = padStippleTexture(fract(u));

      float encodedSDF = rgba2float(texture(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${e.stippleRequiresStretchMeasure?w`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:w`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${e.stippleScaleWithLineWidth?w`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:w`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `),e.stippleOffColorEnabled?(s.uniforms.add(new nr("stippleOffColor",n=>Slt(n.stippleOffColor))),s.code.add(w`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):s.code.add(w`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function Alt(t){t.fragment.code.add(w`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}function Olt(t){return t?(Math.floor(.5*(JCe(t)-1))+.5)/t.pixelRatio:1}function IQ(t){const e=t.stipplePattern;return e?YCe(t.stipplePattern)/e.pixelRatio:1}const Rlt=w.float(.4),lw=64,$Q=lw/2,eAe=$Q/5,Mlt=lw/eAe,Plt=.25;function Ilt(t,e){const r=lEe(t,lw,$Q,eAe),i=new xr;return i.internalFormat=Ct.RGBA,i.width=lw,i.height=lw,i.wrapMode=Dt.CLAMP_TO_EDGE,new Ot(e,i,r)}function tAe(t,e){const{vertex:r,constants:i}=t;i.add("markerSizePerLineWidth","float",Mlt),gC(r,e),r.uniforms.get("markerScale")==null&&r.constants.add("markerScale","float",1),r.code.add(w`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),e.space===Tu.World&&(r.constants.add("maxSegmentLengthFraction","float",.45),r.uniforms.add(new Pe("perRenderPixelRatio",(s,n)=>n.camera.perRenderPixelRatio)),r.code.add(w`bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}
float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}`))}var Lh;(function(t){t[t.BUTT=0]="BUTT",t[t.SQUARE=1]="SQUARE",t[t.ROUND=2]="ROUND",t[t.COUNT=3]="COUNT"})(Lh||(Lh={}));let Vi=class extends Vo{constructor(){super(...arguments),this.output=U.Color,this.capType=Lh.BUTT,this.transparencyPassType=ut.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}};u([B({count:U.COUNT})],Vi.prototype,"output",void 0),u([B({count:Lh.COUNT})],Vi.prototype,"capType",void 0),u([B({count:ut.COUNT})],Vi.prototype,"transparencyPassType",void 0),u([B()],Vi.prototype,"occluder",void 0),u([B()],Vi.prototype,"hasSlicePlane",void 0),u([B()],Vi.prototype,"hasPolygonOffset",void 0),u([B()],Vi.prototype,"writeDepth",void 0),u([B()],Vi.prototype,"draped",void 0),u([B()],Vi.prototype,"stippleEnabled",void 0),u([B()],Vi.prototype,"stippleOffColorEnabled",void 0),u([B()],Vi.prototype,"stippleScaleWithLineWidth",void 0),u([B()],Vi.prototype,"stipplePreferContinuous",void 0),u([B()],Vi.prototype,"roundJoins",void 0),u([B()],Vi.prototype,"applyMarkerOffset",void 0),u([B()],Vi.prototype,"vvSize",void 0),u([B()],Vi.prototype,"vvColor",void 0),u([B()],Vi.prototype,"vvOpacity",void 0),u([B()],Vi.prototype,"falloffEnabled",void 0),u([B()],Vi.prototype,"innerColorEnabled",void 0),u([B()],Vi.prototype,"hasOccludees",void 0),u([B()],Vi.prototype,"hasMultipassTerrain",void 0),u([B()],Vi.prototype,"cullAboveGround",void 0),u([B()],Vi.prototype,"wireframe",void 0),u([B({constValue:!0})],Vi.prototype,"stippleRequiresClamp",void 0),u([B({constValue:!0})],Vi.prototype,"stippleRequiresStretchMeasure",void 0),u([B({constValue:!0})],Vi.prototype,"hasVvInstancing",void 0),u([B({constValue:!0})],Vi.prototype,"hasSliceTranslatedView",void 0),u([B()],Vi.prototype,"objectAndLayerIdColorInstanced",void 0);const DF=1;function $lt(t){const e=new Sr,{vertex:r,fragment:i}=e,s=t.hasMultipassTerrain&&(t.output===U.Color||t.output===U.Alpha);e.include(XM),e.include(XCe,t),e.include(KCe,t);const n=t.applyMarkerOffset&&!t.draped;n&&(r.uniforms.add(new Pe("markerScale",m=>m.markerScale)),e.include(tAe,{space:Tu.World,draped:!1})),t.output===U.Depth&&e.include(_y,t),e.include(iP,t),Mc(r,t),r.uniforms.add(new Fi("inverseProjectionMatrix",(m,y)=>y.camera.inverseProjectionMatrix),new Ar("nearFar",(m,y)=>y.camera.nearFar),new Pe("miterLimit",m=>m.join!=="miter"?0:m.miterLimit),new nr("viewport",(m,y)=>y.camera.fullViewport)),r.constants.add("LARGE_HALF_FLOAT","float",65500),e.attributes.add(C.POSITION,"vec3"),e.attributes.add(C.SUBDIVISIONFACTOR,"float"),e.attributes.add(C.UV0,"vec2"),e.attributes.add(C.AUXPOS1,"vec3"),e.attributes.add(C.AUXPOS2,"vec3"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),av(e),s&&e.varyings.add("depth","float");const o=t.stippleEnabled&&t.stippleScaleWithLineWidth;o&&e.varyings.add("vLineSizeInv","float");const a=t.capType===Lh.ROUND,l=o||a;l&&e.varyings.add("vLineWidth","float");const c=t.innerColorEnabled||a;c&&e.varyings.add("vLineDistance","float");const h=t.stippleEnabled&&a,p=t.falloffEnabled||h;p&&e.varyings.add("vLineDistanceNorm","float"),a&&(e.varyings.add("vSegmentSDF","float"),e.varyings.add("vReverseSegmentSDF","float")),r.code.add(w`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),r.code.add(w`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),sU(e),r.code.add(w`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${s?"depth = pos.z;":""}
      linearDepth = calculateLinearDepth(nearFar,pos.z);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),gC(r,t),r.code.add(w`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${l?w`vLineWidth = lineWidth;`:""}
      ${o?w`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);
  `),n&&r.code.add(w`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),r.code.add(w`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(t.stippleEnabled||a)&&r.code.add(w`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${a?w`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),r.code.add(w`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),t.roundJoins?r.code.add(w`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${t.stippleEnabled?w`min(1.0, subdivisionFactor * ${w.float((DF+2)/(DF+1))})`:w`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):r.code.add(w`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const f=t.capType!==Lh.BUTT;return r.code.add(w`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${f?w`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),r.code.add(w`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${p||c?w`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${c?w`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${p?w`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),a&&r.code.add(w`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),t.stippleEnabled&&(t.draped?r.uniforms.add(new Pe("worldToScreenRatio",(m,y)=>1/y.screenToPCSRatio)):r.code.add(w`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),r.code.add(w`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),t.draped?r.code.add(w`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):r.code.add(w`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),r.uniforms.add(new Pe("stipplePatternPixelSize",m=>IQ(m))),r.code.add(w`
      float patternLength = ${t.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `)),r.code.add(w`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${t.wireframe&&!t.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `),s&&e.include(Mu,t),e.include(ys,t),i.include(Em),i.code.add(w`
  void main() {
    discardBySlice(vpos);
    ${s?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),t.wireframe?i.code.add(w`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(a&&i.code.add(w`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${w.float(yo)}) {
        discard;
      }
    `),h?i.code.add(w`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${w.float(yo)}, stippleCoverage);
      `):i.code.add(w`float stippleAlpha = getStippleAlpha();`),i.uniforms.add(new nr("intrinsicColor",m=>m.color)),t.output!==U.ObjectAndLayerIdColor&&i.code.add(w`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),i.code.add(w`vec4 color = intrinsicColor * vColor;`),t.innerColorEnabled&&(i.uniforms.add(new nr("innerColor",m=>m.innerColor??m.color),new Pe("innerWidth",(m,y)=>m.innerWidth*y.camera.pixelRatio)),i.code.add(w`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),i.code.add(w`vec4 finalColor = blendStipple(color, stippleAlpha);`),t.falloffEnabled&&(i.uniforms.add(new Pe("falloff",m=>m.falloff)),i.code.add(w`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`))),i.code.add(w`
    ${t.output===U.ObjectAndLayerIdColor?w`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${w.float(yo)}) {
      discard;
    }

    ${t.output===U.Alpha?w`fragColor = vec4(finalColor.a);`:""}
    ${t.output===U.Color?w`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===U.Color&&t.transparencyPassType===ut.Color?"fragColor = premultiplyAlpha(fragColor);":""}
    ${t.output===U.Highlight?w`fragColor = vec4(1.0);`:""}
    ${t.output===U.Depth?w`outputDepth(linearDepth);`:""}
    ${t.output===U.ObjectAndLayerIdColor?w`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const Llt=Object.freeze(Object.defineProperty({__proto__:null,RIBBONLINE_NUM_ROUND_JOIN_SUBDIVISIONS:DF,build:$lt},Symbol.toStringTag,{value:"Module"})),LQ={func:ti.LESS},NF={func:ti.ALWAYS},mm={mask:255},rAe={mask:0},Dlt=t=>({function:{func:ti.NOTEQUAL,ref:t,mask:t},operation:{fail:_s.KEEP,zFail:_s.KEEP,zPass:_s.KEEP}}),Nlt=t=>({function:{func:ti.ALWAYS,ref:t,mask:t},operation:{fail:_s.KEEP,zFail:_s.KEEP,zPass:_s.REPLACE}}),Rv={function:{func:ti.ALWAYS,ref:Il.OutlineVisualElementMask,mask:Il.OutlineVisualElementMask},operation:{fail:_s.KEEP,zFail:_s.KEEP,zPass:_s.ZERO}},mv={function:{func:ti.ALWAYS,ref:Il.OutlineVisualElementMask,mask:Il.OutlineVisualElementMask},operation:{fail:_s.KEEP,zFail:_s.KEEP,zPass:_s.REPLACE}},iAe={function:{func:ti.EQUAL,ref:Il.OutlineVisualElementMask,mask:Il.OutlineVisualElementMask},operation:{fail:_s.KEEP,zFail:_s.KEEP,zPass:_s.KEEP}},sAe={function:{func:ti.NOTEQUAL,ref:Il.OutlineVisualElementMask,mask:Il.OutlineVisualElementMask},operation:{fail:_s.KEEP,zFail:_s.KEEP,zPass:_s.KEEP}},nAe=new Map([[C.POSITION,0],[C.SUBDIVISIONFACTOR,1],[C.UV0,2],[C.AUXPOS1,3],[C.AUXPOS2,4],[C.COLOR,5],[C.COLORFEATUREATTRIBUTE,5],[C.SIZE,6],[C.SIZEFEATUREATTRIBUTE,6],[C.OPACITYFEATUREATTRIBUTE,7],[C.OBJECTANDLAYERIDCOLOR,8]]);let oAe=class aAe extends Lr{initializeProgram(e){return new Rr(e.rctx,aAe.shader.get().build(this.configuration),nAe)}_makePipelineState(e,r){const i=this.configuration,s=e===ut.NONE,n=e===ut.FrontFace;return Mt({blending:i.output===U.Color||i.output===U.Alpha?s?xu:Dy(e):null,depthTest:{func:Ov(e)},depthWrite:s?i.writeDepth?Ul:null:AU(e),colorWrite:Gt,stencilWrite:i.hasOccludees?mm:null,stencilTest:i.hasOccludees?r?mv:Rv:null,polygonOffset:s||n?i.hasPolygonOffset?Uae:null:RU})}initializePipeline(){const e=this.configuration;if(e.occluder){const r=e.hasPolygonOffset?Uae:null;this._occluderPipelineTransparent=Mt({blending:xu,polygonOffset:r,depthTest:NF,depthWrite:null,colorWrite:Gt,stencilWrite:null,stencilTest:sAe}),this._occluderPipelineOpaque=Mt({blending:xu,polygonOffset:r,depthTest:NF,depthWrite:null,colorWrite:Gt,stencilWrite:rAe,stencilTest:iAe}),this._occluderPipelineMaskWrite=Mt({blending:null,polygonOffset:r,depthTest:LQ,depthWrite:null,colorWrite:null,stencilWrite:mm,stencilTest:mv})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?At.LINES:At.TRIANGLE_STRIP}getPipelineState(e,r){return r?this._occludeePipelineState:this.configuration.occluder?e===he.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===he.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,r)}};oAe.shader=new Or(Llt,()=>ce(()=>import("./RibbonLine.glsl-9089264c.js"),[],import.meta.url));const Uae={factor:0,units:-4};var sc;(function(t){t[t.LEFT_JOIN_START=-2]="LEFT_JOIN_START",t[t.LEFT_JOIN_END=-1]="LEFT_JOIN_END",t[t.LEFT_CAP_START=-4]="LEFT_CAP_START",t[t.LEFT_CAP_END=-5]="LEFT_CAP_END",t[t.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",t[t.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",t[t.RIGHT_CAP_START=4]="RIGHT_CAP_START",t[t.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(sc||(sc={}));let ZS=class extends Av{constructor(e){super(e,new Ult),this._configuration=new Vi,this._vertexAttributeLocations=nAe}isClosed(e,r){return cAe(this.parameters,e,r)}getConfiguration(e,r){this._configuration.output=e,this._configuration.draped=r.slot===he.DRAPED_MATERIAL;const i=this.parameters.stipplePattern!=null&&e!==U.Highlight;return this._configuration.stippleEnabled=i,this._configuration.stippleOffColorEnabled=i&&this.parameters.stippleOffColor!=null,this._configuration.stippleScaleWithLineWidth=i&&this.parameters.stippleScaleWithLineWidth,this._configuration.stipplePreferContinuous=i&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins=this.parameters.join==="round",this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=this.parameters.markerParameters!=null&&zlt(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&this.parameters.innerColor!=null,this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===Di.OccludeAndTransparentStencil,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersectDraped(e,r,i,s,n,o){if(!i.options.selectionMode)return;const a=e.vertexAttributes.get(C.POSITION).data,l=e.vertexAttributes.get(C.SIZE);let c=this.parameters.width;if(this.parameters.vvSize){const _=e.vertexAttributes.get(C.SIZEFEATUREATTRIBUTE).data[0];c*=ve(this.parameters.vvSize.offset[0]+_*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else l&&(c*=l.data[0]);const h=s[0],p=s[1],f=(c/2+4)*e.screenToWorldRatio;let m=Number.MAX_VALUE,y=0;for(let _=0;_<a.length-5;_+=3){const v=a[_],b=a[_+1],T=h-v,x=p-b,S=a[_+3]-v,E=a[_+4]-b,A=ve((S*T+E*x)/(S*S+E*E),0,1),R=S*A-T,M=E*A-x,D=R*R+M*M;D<m&&(m=D,y=_/3)}m<f*f&&n(o.dist,o.normal,y,!1)}intersect(e,r,i,s,n,o){if(!i.options.selectionMode||!e.visible)return;if(!Bxe(r))return void Q.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const a=e.vertexAttributes,l=a.get(C.POSITION).data;let c=this.parameters.width;if(this.parameters.vvSize){const T=a.get(C.SIZEFEATUREATTRIBUTE).data[0];c*=ve(this.parameters.vvSize.offset[0]+T*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else a.has(C.SIZE)&&(c*=a.get(C.SIZE).data[0]);const h=i.camera,p=Vlt;fn(p,i.point);const f=c*h.pixelRatio/2+4*h.pixelRatio;se(oA[0],p[0]-f,p[1]+f,0),se(oA[1],p[0]+f,p[1]+f,0),se(oA[2],p[0]+f,p[1]-f,0),se(oA[3],p[0]-f,p[1]-f,0);for(let T=0;T<4;T++)if(!h.unprojectFromRenderScreen(oA[T],km[T]))return;oa(h.eye,km[0],km[1],Fk),oa(h.eye,km[1],km[2],Uk),oa(h.eye,km[2],km[3],kk),oa(h.eye,km[3],km[0],zk);let m=Number.MAX_VALUE,y=0;const _=lAe(this.parameters,a,e.indices)?l.length-2:l.length-5;for(let T=0;T<_;T+=3){ul[0]=l[T]+r[12],ul[1]=l[T+1]+r[13],ul[2]=l[T+2]+r[14];const x=(T+3)%l.length;if(hl[0]=l[x]+r[12],hl[1]=l[x+1]+r[13],hl[2]=l[x+2]+r[14],pi(Fk,ul)<0&&pi(Fk,hl)<0||pi(Uk,ul)<0&&pi(Uk,hl)<0||pi(kk,ul)<0&&pi(kk,hl)<0||pi(zk,ul)<0&&pi(zk,hl)<0)continue;if(h.projectToRenderScreen(ul,e1),h.projectToRenderScreen(hl,t1),e1[2]<0&&t1[2]>0){de(jp,ul,hl);const E=h.frustum,A=-pi(E[di.NEAR],ul)/fe(jp,E[di.NEAR]);ie(jp,jp,A),ue(ul,ul,jp),h.projectToRenderScreen(ul,e1)}else if(e1[2]>0&&t1[2]<0){de(jp,hl,ul);const E=h.frustum,A=-pi(E[di.NEAR],hl)/fe(jp,E[di.NEAR]);ie(jp,jp,A),ue(hl,hl,jp),h.projectToRenderScreen(hl,t1)}else if(e1[2]<0&&t1[2]<0)continue;e1[2]=0,t1[2]=0;const S=jY(sw(e1,t1,Vae),p);S<m&&(m=S,re(kae,ul),re(zae,hl),y=T/3)}const v=i.rayBegin,b=i.rayEnd;if(m<f*f){let T=Number.MAX_VALUE;if(bwe(sw(kae,zae,Vae),sw(v,b,Blt),Kv)){de(Kv,Kv,v);const x=Oe(Kv);ie(Kv,Kv,1/x),T=x/fi(v,b)}o(T,Kv,y,!1)}}get _layout(){const e=Hi().vec3f(C.POSITION).f32(C.SUBDIVISIONFACTOR).vec2f(C.UV0).vec3f(C.AUXPOS1).vec3f(C.AUXPOS2);return this.parameters.vvSize?e.f32(C.SIZEFEATUREATTRIBUTE):e.f32(C.SIZE),this.parameters.vvColor?e.f32(C.COLORFEATUREATTRIBUTE):e.vec4f(C.COLOR),this.parameters.vvOpacity&&e.f32(C.OPACITYFEATUREATTRIBUTE),oe("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(C.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new klt(this._layout,this.parameters)}requiresSlot(e,r){return r===U.Color||r===U.Alpha||r===U.Highlight||r===U.Depth||r===U.ObjectAndLayerIdColor?e===he.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===Di.OccludeAndTransparentStencil?e===he.OPAQUE_MATERIAL||e===he.OCCLUDER_MATERIAL||e===he.TRANSPARENT_OCCLUDER_MATERIAL:r===U.Color||r===U.Alpha?e===(this.parameters.writeDepth?he.TRANSPARENT_MATERIAL:he.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===he.OPAQUE_MATERIAL:!1}createGLMaterial(e){return new Flt(e)}validateParameters(e){e.join!=="miter"&&(e.miterLimit=0),e.markerParameters!=null&&(e.markerScale=e.markerParameters.width/e.width)}},Flt=class extends Ev{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==U.Color&&this._output!==U.Alpha||this._updateOccludeeState(e);const r=this._material.parameters.stipplePattern;return this._stipplePattern!==r&&(this._material.setParameters({stippleTexture:this._stippleTextureRepository.swap(r,this._stipplePattern)}),this._stipplePattern=r),this.ensureTechnique(oAe,e)}},Ult=class extends nP{constructor(){super(...arguments),this.width=0,this.color=Ch,this.join="miter",this.cap=Lh.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}},klt=class{constructor(e,r){this._parameters=r,this.numJoinSubdivisions=0,this.vertexBufferLayout=e;const i=r.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=i;break;case"round":this.numJoinSubdivisions=DF+i}}_isClosed(e){return lAe(this._parameters,e.vertexAttributes,e.indices)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const i=e.indices.get(C.POSITION).length/2+1,s=this._isClosed(e);let n=s?2:2*2;return n+=((s?i:i-1)-(s?0:1))*(2*this.numJoinSubdivisions+4),n+=2,this._parameters.wireframe&&(n=2+4*(n-2)),n}write(e,r,i,s,n){const o=Glt,a=jlt,l=Hlt,c=i.vertexAttributes.get(C.POSITION).data,h=i.indices&&i.indices.get(C.POSITION),p=i.vertexAttributes.get(C.DISTANCETOSTART)?.data;h&&h.length!==2*(c.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let f=1,m=0;this._parameters.vvSize?m=i.vertexAttributes.get(C.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(C.SIZE)&&(f=i.vertexAttributes.get(C.SIZE).data[0]);let y=[1,1,1,1],_=0;this._parameters.vvColor?_=i.vertexAttributes.get(C.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(C.COLOR)&&(y=i.vertexAttributes.get(C.COLOR).data);const v=oe("enable-feature:objectAndLayerId-rendering")?i.objectAndLayerIdColor:null;let b=0;this._parameters.vvOpacity&&(b=i.vertexAttributes.get(C.OPACITYFEATUREATTRIBUTE).data[0]);const T=c.length/3,x=new Float32Array(s.buffer),S=oe("enable-feature:objectAndLayerId-rendering")?new Uint8Array(s.buffer):null,E=this.vertexBufferLayout.stride/4;let A=n*E;const R=A;let M=0;const D=p?(G,J,I)=>M=p[I]:(G,J,I)=>M+=fi(G,J),k=oe("enable-feature:objectAndLayerId-rendering"),$=(G,J,I,z,F,j,W)=>{if(x[A++]=J[0],x[A++]=J[1],x[A++]=J[2],x[A++]=z,x[A++]=W,x[A++]=F,x[A++]=G[0],x[A++]=G[1],x[A++]=G[2],x[A++]=I[0],x[A++]=I[1],x[A++]=I[2],x[A++]=this._parameters.vvSize?m:f,this._parameters.vvColor)x[A++]=_;else{const Y=Math.min(4*j,y.length-4);x[A++]=y[Y],x[A++]=y[Y+1],x[A++]=y[Y+2],x[A++]=y[Y+3]}this._parameters.vvOpacity&&(x[A++]=b),k&&(v!=null&&(S[4*A]=v[0],S[4*A+1]=v[1],S[4*A+2]=v[2],S[4*A+3]=v[3]),A++)};A+=E,se(a,c[0],c[1],c[2]),e&&Fe(a,a,e);const N=this._isClosed(i);if(N){const G=c.length-3;se(o,c[G],c[G+1],c[G+2]),e&&Fe(o,o,e)}else se(l,c[3],c[4],c[5]),e&&Fe(l,l,e),$(a,a,l,1,sc.LEFT_CAP_START,0,0),$(a,a,l,1,sc.RIGHT_CAP_START,0,0),re(o,a),re(a,l);const H=N?0:1,Z=N?T:T-1;for(let G=H;G<Z;G++){const J=(G+1)%T*3;se(l,c[J],c[J+1],c[J+2]),e&&Fe(l,l,e),D(o,a,G),$(o,a,l,0,sc.LEFT_JOIN_END,G,M),$(o,a,l,0,sc.RIGHT_JOIN_END,G,M);const I=this.numJoinSubdivisions;for(let z=0;z<I;++z){const F=(z+1)/(I+1);$(o,a,l,F,sc.LEFT_JOIN_END,G,M),$(o,a,l,F,sc.RIGHT_JOIN_END,G,M)}$(o,a,l,1,sc.LEFT_JOIN_START,G,M),$(o,a,l,1,sc.RIGHT_JOIN_START,G,M),re(o,a),re(a,l)}N?(se(l,c[3],c[4],c[5]),e&&Fe(l,l,e),M=D(o,a,Z),$(o,a,l,0,sc.LEFT_JOIN_END,H,M),$(o,a,l,0,sc.RIGHT_JOIN_END,H,M)):(M=D(o,a,Z),$(o,a,a,0,sc.LEFT_CAP_END,Z,M),$(o,a,a,0,sc.RIGHT_CAP_END,Z,M)),Nk(x,R+E,x,R,E),A=Nk(x,A-E,x,A,E),this._parameters.wireframe&&this._addWireframeVertices(s,R,A,E)}_addWireframeVertices(e,r,i,s){const n=new Float32Array(e.buffer,i*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT,i-r);let a=0;const l=c=>a=Nk(o,c,n,a,s);for(let c=0;c<o.length-1;c+=2*s)l(c),l(c+2*s),l(c+1*s),l(c+2*s),l(c+1*s),l(c+3*s)}};function Nk(t,e,r,i,s){for(let n=0;n<s;n++)r[i++]=t[e++];return i}function lAe(t,e,r){return cAe(t,e.get(C.POSITION).data,r?r.get(C.POSITION):null)}function cAe(t,e,r){return!!t.isClosed&&(r?r.length>2:e.length>6)}function zlt(t){return t.anchor===Bw.Tip&&t.hideOnShortSegments&&t.placement==="begin-end"&&t.worldSpace}const ul=O(),hl=O(),jp=O(),Kv=O(),Vlt=O(),e1=jo(),t1=jo(),kae=O(),zae=O(),Vae=Op(),Blt=Op(),Glt=O(),jlt=O(),Hlt=O(),oA=[jo(),jo(),jo(),jo()],km=[O(),O(),O(),O()],Fk=Nr(),Uk=Nr(),kk=Nr(),zk=Nr();let DQ=class{constructor(e){this._originSR=e,this._origins=new Map,this._objects=new Map,this._gridSize=5e5,this._rootOriginId="root/"+Cc()}getOrigin(e){const r=this._origins.get(this._rootOriginId);if(r==null){const h=AF(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,h),h}const i=this._gridSize,s=Math.round(e[0]/i),n=Math.round(e[1]/i),o=Math.round(e[2]/i),a=`${s}/${n}/${o}`;let l=this._origins.get(a);const c=.5*i;if(de(ro,e,r.vec3),ro[0]=Math.abs(ro[0]),ro[1]=Math.abs(ro[1]),ro[2]=Math.abs(ro[2]),ro[0]<c&&ro[1]<c&&ro[2]<c){if(l){const h=Math.max(...ro);if(de(ro,e,l.vec3),ro[0]=Math.abs(ro[0]),ro[1]=Math.abs(ro[1]),ro[2]=Math.abs(ro[2]),Math.max(...ro)<h)return l}return r}return l||(l=AF(s*i,n*i,o*i,a),this._origins.set(a,l)),l}_drawOriginBox(e,r=Nt(1,1,0,1)){const i=window.view,s=i._stage,n=r.toString();if(!this._objects.has(n)){this._material=new ZS({width:2,color:r}),s.add(this._material);const m=new WCe(s,{pickable:!1}),y=new Ny({castShadow:!1});s.add(y),m.add(y),this._objects.set(n,y)}const o=this._objects.get(n),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=a.length,c=new Array(3*l),h=new Array,p=.5*this._gridSize;for(let m=0;m<l;m++)c[3*m]=e[0]+(1&a[m]?p:-p),c[3*m+1]=e[1]+(2&a[m]?p:-p),c[3*m+2]=e[2]+(4&a[m]?p:-p),m>0&&h.push(m-1,m);li(c,this._originSR,0,c,i.renderSpatialReference,0,l);const f=new Ys(this._material,[[C.POSITION,new He(c,3,!0)]],[[C.POSITION,h]],null,ls.Line);s.add(f),o.addGeometry(f)}get test(){const e=this;return{set gridSize(r){e._gridSize=r}}}};const ro=O();let uAe=class{constructor(e,r,i,s=null){this.rctx=e,this.sliceHelper=s,this.lastFrameCamera=new gt,this.output=U.Color,this.renderOccludedMask=Bae,this.bindParameters=new iU(r,i,s!=null?s.plane:null),this.bindParameters.alignPixelEnabled=!0}resetRenderOccludedMask(){this.renderOccludedMask=Bae}},qlt=class extends uAe{constructor(e,r,i,s,n){super(e,i,s,n),this.offscreenRenderingHelper=r,this.sliceHelper=n,this.time=0}};const Bae=Di.Occlude|Di.OccludeAndTransparent|Di.OccludeAndTransparentStencil;let q3=class extends gt{constructor(){super(...arguments),this._projectionMatrix=be()}get projectionMatrix(){return this._projectionMatrix}};u([d()],q3.prototype,"_projectionMatrix",void 0),u([d({readOnly:!0})],q3.prototype,"projectionMatrix",null),q3=u([P("esri.views.3d.webgl-engine.lib.CascadeCamera")],q3);const Gae=16;function NQ(t){return Math.ceil(t/Gae)*Gae}var RE;(function(t){t[t.Highlight=0]="Highlight",t[t.Default=1]="Default"})(RE||(RE={}));let A$=class{constructor(){this.camera=new q3,this.lightMat=be()}},Wlt=class{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}},FQ=class{get depthTexture(){return this._fbo?.colorTexture}get textureSize(){return this._textureSize}get numCascades(){return this._numCascades}get cascadeDistances(){return xi(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}constructor(e,r){this._rctx=e,this._viewingMode=r,this._enabled=!1,this._snapshots=new Array,this._textureSize=0,this._numCascades=1,this.settings=new Wlt,this._projectionView=be(),this._projectionViewInverse=be(),this._modelViewLight=be(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=Xt(),this._cascades=[new A$,new A$,new A$,new A$],this._lastOrigin=null,this._maxTextureSize=Math.min(oe("esri-mobile")?2048:8192,this._rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}disposeOffscreenBuffers(){this._fbo=Ve(this._fbo),this._discardAllSnapshots()}set maxCascades(e){this.settings.maxNumCascadesHighQuality=ve(Math.floor(e),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&this.depthTexture!=null}getSnapshot(e){return this.enabled?this._snapshots[e]:null}get cascades(){for(let e=0;e<this._numCascades;++e)Bk[e]=this._cascades[e];return Bk.length=this._numCascades,Bk}start(e,r,i,s,n){nt(this.enabled),this._textureSize=this._computeTextureSize(e,n,s),this._ensureDepthTexture();const{near:o,far:a}=this._clampNearFar(i);this._computeCascadeDistances(a,o,s),this._setupMatrices(e,r);const{viewMatrix:l,projectionMatrix:c}=e;for(let h=0;h<this._numCascades;++h)this._constructCascade(h,c,l,r);this._lastOrigin=null,this.clear()}finish(e){nt(this.enabled),this._rctx.bindFramebuffer(e)}getShadowMapMatrices(e){if(!this._lastOrigin||!ha(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||O(),re(this._lastOrigin,e);for(let r=0;r<this._numCascades;++r){Fl(Zae,this._cascades[r].lightMat,e);for(let i=0;i<16;++i)Yae[16*r+i]=Zae[i]}}return Yae}takeCascadeSnapshotTo(e,r){nt(this.enabled);const i=this._ensureSnapshot(r);this._bindFbo();const s=this._rctx,n=s.bindTexture(i,Ot.TEXTURE_UNIT_FOR_UPDATES);s.gl.copyTexSubImage2D(as.TEXTURE_2D,0,e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[2],e.camera.viewport[3]),s.bindTexture(n,Ot.TEXTURE_UNIT_FOR_UPDATES)}clear(){const e=this._rctx;this._bindFbo(),e.setClearColor(1,1,1,1),e.clearSafe(Ti.COLOR_BUFFER_BIT|Ti.DEPTH_BUFFER_BIT)}_computeTextureSize(e,r,i){const s=Math.min(window.devicePixelRatio,r)/e.pixelRatio,n=Math.max(e.fullWidth,e.fullHeight)*s,o=i?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality;return Math.floor(Math.min(this._maxTextureSize,NQ((this.numCascades===1?1:2)*n*o)))}_ensureDepthTexture(){if(this._fbo?.width===this._textureSize)return;const e=new xr(this._textureSize);e.wrapMode=Dt.CLAMP_TO_EDGE,e.samplingMode=Rt.NEAREST,this._fbo?.dispose(),this._fbo=new hn(this._rctx,e,new iF(Ws.DEPTH_COMPONENT16,this._textureSize))}_ensureSnapshot(e){let r=this._snapshots[e];if(r!=null&&r.descriptor.width===this._textureSize)return r;this._discardSnapshot(e);const i=new xr;return i.wrapMode=Dt.CLAMP_TO_EDGE,i.samplingMode=Rt.NEAREST,i.width=this._textureSize,i.height=this._textureSize,r=new Ot(this._rctx,i),this._snapshots[e]=r,r}_discardSnapshot(e){this._snapshots[e]=Ve(this._snapshots[e])}_discardAllSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){const e=this._rctx;e.unbindTexture(this.depthTexture),e.bindFramebuffer(this._fbo)}_constructCascade(e,r,i,s){const n=this._cascades[e],o=-this._cascadeDistances[e],a=-this._cascadeDistances[e+1],l=(r[10]*o+r[14])/Math.abs(r[11]*o+r[15]),c=(r[10]*a+r[14])/Math.abs(r[11]*a+r[15]);nt(l<c);for(let m=0;m<8;++m){xi(jae,m%4==0||m%4==3?-1:1,m%4==0||m%4==1?-1:1,m<4?l:c,1);const y=ph[m];mu(y,jae,this._projectionViewInverse),y[0]/=y[3],y[1]/=y[3],y[2]/=y[3]}pa(Vk,ph[0]),n.camera.viewMatrix=Fl(Xlt,this._modelViewLight,Vk);for(let m=0;m<8;++m)Fe(ph[m],ph[m],n.camera.viewMatrix);let h=ph[0][2],p=ph[0][2];for(let m=1;m<8;++m)h=Math.min(h,ph[m][2]),p=Math.max(p,ph[m][2]);h-=200,p+=200,n.camera.near=-p,n.camera.far=-h,Qlt(i,s,h,p,n.camera),oi(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const f=this._textureSize/(this.numCascades===1?1:2);n.camera.viewport=[e%2==0?0:f,Math.floor(e/2)===0?0:f,f,f]}_setupMatrices(e,r){oi(this._projectionView,e.projectionMatrix,e.viewMatrix),Mn(this._projectionViewInverse,this._projectionView);const i=this._viewingMode===Ue.Global?e.eye:se(Vk,0,0,1);E6(this._modelViewLight,[0,0,0],[-r[0],-r[1],-r[2]],i)}_clampNearFar(e){let{near:r,far:i}=e;return r<2&&(r=2),i<2&&(i=2),r>=i&&(r=2,i=4),{near:r,far:i}}_computeCascadeDistances(e,r,i){const s=i?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor(MYe(e/r,4)),s);const n=(e-r)/this._numCascades,o=(e/r)**(1/this._numCascades);let a=r,l=r;for(let c=0;c<this._numCascades+1;++c)this._cascadeDistances[c]=St(a,l,this.settings.splitSchemeLambda),a*=o,l+=n}get gpuMemoryUsage(){return this._snapshots.reduce((e,r)=>e+(r?.gpuMemoryUsage??0),this._fbo?.gpuMemoryUsage??0)}get test(){return{cascades:this._cascades,textureSize:this._textureSize}}};const Xlt=be(),jae=Xt(),ph=[];for(let t=0;t<8;++t)ph.push(Xt());const Hae=Ge(),qae=Ge(),Zlt=Ge(),Wae=Ge(),Xae=Ge(),Vk=O(),Bk=[],Zae=be(),Yae=new Array(64),jc=Ge(),sT=Ge(),r1=[Ge(),Ge(),Ge(),Ge()],_n=Ge(),Gk=Ge(),d0=Ge(),aA=Ge(),nT=Ge(),oT=Ge(),O$=Ge();function Ylt(t,e,r,i,s,n,o,a){ar(jc,0,0);for(let E=0;E<4;++E)Wd(jc,jc,t[E]);yc(jc,jc,.25),ar(sT,0,0);for(let E=4;E<8;++E)Wd(sT,sT,t[E]);yc(sT,sT,.25),wh(r1[0],t[4],t[5],.5),wh(r1[1],t[5],t[6],.5),wh(r1[2],t[6],t[7],.5),wh(r1[3],t[7],t[4],.5);let l=0,c=K4(r1[0],jc);for(let E=1;E<4;++E){const A=K4(r1[E],jc);A<c&&(c=A,l=E)}$f(_n,r1[l],t[l+4]);const h=_n[0];let p,f;_n[0]=-_n[1],_n[1]=h,$f(Gk,sT,jc),rn(Gk,_n)<0&&aJ(_n,_n),wh(_n,_n,Gk,r),zR(_n,_n),p=f=rn($f(d0,t[0],jc),_n);for(let E=1;E<8;++E){const A=rn($f(d0,t[E],jc),_n);A<p?p=A:A>f&&(f=A)}fn(i,jc),yc(d0,_n,p-e),Wd(i,i,d0);let m=-1,y=1,_=0,v=0;for(let E=0;E<8;++E){$f(aA,t[E],i),zR(aA,aA);const A=_n[0]*aA[1]-_n[1]*aA[0];A>0?A>m&&(m=A,_=E):A<y&&(y=A,v=E)}kx(m>0,"leftArea"),kx(y<0,"rightArea"),yc(nT,_n,p),Wd(nT,nT,jc),yc(oT,_n,f),Wd(oT,oT,jc),O$[0]=-_n[1],O$[1]=_n[0];const b=$I(i,t[v],oT,Wd(d0,oT,O$),1,s),T=$I(i,t[_],oT,d0,1,n),x=$I(i,t[_],nT,Wd(d0,nT,O$),1,o),S=$I(i,t[v],nT,d0,1,a);kx(b,"rayRay"),kx(T,"rayRay"),kx(x,"rayRay"),kx(S,"rayRay")}function vr(t,e){return 3*e+t}const Jae=Ge();function Gl(t,e){return ar(Jae,t[e],t[e+3]),Jae}const dl=Ge(),Ze=Ui();function Jlt(t,e,r,i,s){$f(dl,r,i),yc(dl,dl,.5),Ze[0]=dl[0],Ze[1]=dl[1],Ze[2]=0,Ze[3]=dl[1],Ze[4]=-dl[0],Ze[5]=0,Ze[6]=dl[0]*dl[0]+dl[1]*dl[1],Ze[7]=dl[0]*dl[1]-dl[1]*dl[0],Ze[8]=1,Ze[vr(0,2)]=-rn(Gl(Ze,0),t),Ze[vr(1,2)]=-rn(Gl(Ze,1),t);let n=rn(Gl(Ze,0),r)+Ze[vr(0,2)],o=rn(Gl(Ze,1),r)+Ze[vr(1,2)],a=rn(Gl(Ze,0),i)+Ze[vr(0,2)],l=rn(Gl(Ze,1),i)+Ze[vr(1,2)];n=-(n+a)/(o+l),Ze[vr(0,0)]+=Ze[vr(1,0)]*n,Ze[vr(0,1)]+=Ze[vr(1,1)]*n,Ze[vr(0,2)]+=Ze[vr(1,2)]*n,n=1/(rn(Gl(Ze,0),r)+Ze[vr(0,2)]),o=1/(rn(Gl(Ze,1),r)+Ze[vr(1,2)]),Ze[vr(0,0)]*=n,Ze[vr(0,1)]*=n,Ze[vr(0,2)]*=n,Ze[vr(1,0)]*=o,Ze[vr(1,1)]*=o,Ze[vr(1,2)]*=o,Ze[vr(2,0)]=Ze[vr(1,0)],Ze[vr(2,1)]=Ze[vr(1,1)],Ze[vr(2,2)]=Ze[vr(1,2)],Ze[vr(1,2)]+=1,n=rn(Gl(Ze,1),e)+Ze[vr(1,2)],o=rn(Gl(Ze,2),e)+Ze[vr(2,2)],a=rn(Gl(Ze,1),r)+Ze[vr(1,2)],l=rn(Gl(Ze,2),r)+Ze[vr(2,2)],n=-.5*(n/o+a/l),Ze[vr(1,0)]+=Ze[vr(2,0)]*n,Ze[vr(1,1)]+=Ze[vr(2,1)]*n,Ze[vr(1,2)]+=Ze[vr(2,2)]*n,n=rn(Gl(Ze,1),e)+Ze[vr(1,2)],o=rn(Gl(Ze,2),e)+Ze[vr(2,2)],a=-o/n,Ze[vr(1,0)]*=a,Ze[vr(1,1)]*=a,Ze[vr(1,2)]*=a,s[0]=Ze[0],s[1]=Ze[1],s[2]=0,s[3]=Ze[2],s[4]=Ze[3],s[5]=Ze[4],s[6]=0,s[7]=Ze[5],s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=Ze[6],s[13]=Ze[7],s[14]=0,s[15]=Ze[8]}function Qlt(t,e,r,i,s){const n=1/ph[0][3],o=1/ph[4][3];nt(n<o);let a=n+Math.sqrt(n*o);const l=Math.sin(In(t[2]*e[0]+t[6]*e[1]+t[10]*e[2]));a/=l,Ylt(ph,a,l,Hae,qae,Zlt,Wae,Xae),Jlt(Hae,qae,Wae,Xae,s.projectionMatrix),s.projectionMatrix[10]=2/(r-i),s.projectionMatrix[14]=-(r+i)/(r-i)}function Klt(t){return Mp(t)&&t.intersector===Gi.TERRAIN&&!!t.target}let ect=class extends pU{constructor(e,r,i){super(e,r),this.triangleNr=i}};function hAe(t){return Mp(t)&&t.intersector===Gi.OVERLAY&&!!t.target}let Vq=class{constructor(){this.adds=new Bt,this.removes=new Bt,this.updates=new Bt({allocator:e=>e||new tct,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return this.adds.length===0&&this.removes.length===0&&this.updates.length===0}},tct=class{},rct=class{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}};var Xi,Sn;(function(t){t[t.ADD=0]="ADD",t[t.UPDATE=1]="UPDATE",t[t.REMOVE=2]="REMOVE"})(Xi||(Xi={})),function(t){t[t.NONE=0]="NONE",t[t.VISIBILITY=1]="VISIBILITY",t[t.GEOMETRY=2]="GEOMETRY",t[t.TRANSFORMATION=4]="TRANSFORMATION",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.OCCLUDEE=16]="OCCLUDEE"}(Sn||(Sn={}));function dAe(t){const e=new Map,r=i=>{let s=e.get(i);return s||(s=new rct,e.set(i,s)),s};return t.removes.forAll(i=>{jk(i)&&r(i.material).removes.push(i)}),t.adds.forAll(i=>{jk(i)&&r(i.material).adds.push(i)}),t.updates.forAll(i=>{jk(i.renderGeometry)&&r(i.renderGeometry.material).updates.push(i)}),e}function jk(t){return t.geometry.indexCount>=1}let pAe=class{constructor(e,r){this._material=e,this._repository=r,this._map=new Map}destroy(){this._map.forEach((e,r)=>{e!=null&&this._repository.release(this._material,r)})}load(e,r,i){if(!this._material.requiresSlot(r,i))return null;this._map.has(i)||this._map.set(i,this._repository.acquire(this._material,r,i));const s=this._map.get(i);if(s!=null){if(s.ensureResources(e)===Wg.LOADED)return s;this._repository.requestRender()}return null}};function uP(t,e){switch(e.normalType){case Ir.Compressed:t.attributes.add(C.NORMALCOMPRESSED,"vec2"),t.vertex.code.add(w`vec3 normalModel() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
return vec3(normalCompressed + sign(normalCompressed) * min(z, 0.0), z);
}`);break;case Ir.Attribute:t.attributes.add(C.NORMAL,"vec3"),t.vertex.code.add(w`vec3 normalModel() {
return normal;
}`);break;case Ir.ScreenDerivative:t.fragment.code.add(w`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:e.normalType;case Ir.COUNT:case Ir.Ground:}}var Ir;(function(t){t[t.Attribute=0]="Attribute",t[t.Compressed=1]="Compressed",t[t.Ground=2]="Ground",t[t.ScreenDerivative=3]="ScreenDerivative",t[t.COUNT=4]="COUNT"})(Ir||(Ir={}));function UU(t,e){switch(e.normalType){case Ir.Attribute:case Ir.Compressed:t.include(uP,e),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("vNormalView","vec3"),t.vertex.uniforms.add(new VR("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel),new Yh("transformNormalViewFromGlobal",r=>r.transformNormalViewFromGlobal)),t.vertex.code.add(w`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case Ir.Ground:t.include(b2,e),t.varyings.add("vNormalWorld","vec3"),t.vertex.code.add(w`
        void forwardNormal() {
          vNormalWorld = ${e.spherical?w`normalize(vPositionWorldCameraRelative);`:w`vec3(0.0, 0.0, 1.0);`}
        }
        `);break;case Ir.ScreenDerivative:t.vertex.code.add(w`void forwardNormal() {}`);break;default:e.normalType;case Ir.COUNT:}}let fAe=class extends DTe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Ui()}},mAe=class extends NTe{constructor(){super(...arguments),this.transformNormalGlobalFromModel=Ui(),this.toMapSpace=Xt()}},Bq=class extends mAe{constructor(e=O()){super(),this.origin=e,this.slicePlaneLocalOrigin=this.origin}},yC=class{constructor(e){this.vertexBufferLayout=e}elementCount(e){return e.indices.get(C.POSITION).length}write(e,r,i,s,n){eEe(i,this.vertexBufferLayout,e,r,s,n)}};const ict=Hi().vec3f(C.POSITION),sct=Hi().vec3f(C.POSITION).vec2f(C.UV0),nct=Hi().vec3f(C.POSITION).vec4u8(C.COLOR);Hi().vec3f(C.POSITION).vec4u8(C.OBJECTANDLAYERIDCOLOR);const oct=Hi().vec3f(C.POSITION).vec2f(C.UV0).vec4u8(C.OBJECTANDLAYERIDCOLOR);Hi().vec3f(C.POSITION).vec4u8(C.COLOR).vec4u8(C.OBJECTANDLAYERIDCOLOR);let UQ=class extends Av{intersect(e,r,i,s,n,o){return B2e(e,i,s,n,void 0,o)}};function act(t){t.fragment.code.add(w`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function lct(t){t.fragment.code.add(w`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}let hP=class extends hs{constructor(e,r){super(e,"int",ei.Pass,(i,s,n)=>i.setUniform1i(e,r(s,n)))}},cct=class extends hs{constructor(e,r,i){super(e,"mat4",ei.Draw,(s,n,o,a)=>s.setUniformMatrix4fv(e,r(n,o,a)),i)}},uct=class extends hs{constructor(e,r,i){super(e,"mat4",ei.Pass,(s,n,o)=>s.setUniformMatrix4fv(e,r(n,o)),i)}},hct=class extends ri{constructor(){super(...arguments),this.origin=O()}},dct=class extends hct{},pct=class extends ri{constructor(){super(...arguments),this.modelTransformation=un}},kQ=class extends pct{constructor(){super(...arguments),this.origin=O()}};function kU(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new uct("shadowMapMatrix",(r,i)=>i.shadowMap.getShadowMapMatrices(r.origin),4)),gAe(t))}function Gw(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new cct("shadowMapMatrix",(r,i)=>i.shadowMap.getShadowMapMatrices(r.origin),4)),gAe(t))}function gAe(t){const e=t.fragment;e.include(Nc),e.uniforms.add(new et("shadowMapTex",(r,i)=>i.shadowMap.depthTexture),new hP("numCascades",(r,i)=>i.shadowMap.numCascades),new nr("cascadeDistances",(r,i)=>i.shadowMap.cascadeDistances)),e.code.add(w`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, vec3 lvpos) {
return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + (numCascades == 1 ? 1.0 : 0.5) * lvpos.xy;
}
float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
return rgba2float(texture(_depthTex, uv));
}
float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, float texSize, sampler2D _depthTex) {
float halfPixelSize = 0.5 / texSize;
vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);
float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
vec2 uv = cascadeCoordinates(i, lvpos);
return filterShadow(uv, lvpos, float(textureSize(shadowMapTex, 0).x), shadowMapTex);
}`)}function Qae(t){t.fragment.uniforms.add(new et("texWaveNormal",e=>e.waveNormal),new et("texWavePerturbation",e=>e.wavePertubation),new nr("waveParams",e=>xi(fct,e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset)),new Ar("waveDirection",e=>ar(mct,e.waveDirection[0]*e.waveVelocity,e.waveDirection[1]*e.waveVelocity))),t.include(act),t.fragment.code.add(w`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const fct=Xt(),mct=Ge();function tM(t,e){e.spherical?t.vertex.code.add(w`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):t.vertex.code.add(w`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),e.spherical?t.vertex.code.add(w`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):t.vertex.code.add(w`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}function gct(t){const e=t.fragment.code;e.add(w`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),e.add(w`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),e.add(w`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function zQ(t,e){const r=t.fragment.code;t.include(XM),e.pbrMode!==lt.Normal&&e.pbrMode!==lt.Schematic&&e.pbrMode!==lt.Terrain&&e.pbrMode!==lt.TerrainWithWater||(r.add(w`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),r.add(w`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),e.pbrMode!==lt.Normal&&e.pbrMode!==lt.Schematic||(t.include(gct),r.add(w`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),r.add(w`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),r.add(w`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),r.add(w`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function yct(t,e){const r=t.fragment.code;t.include(XM),r.add(w`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${e.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),r.add(w`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),r.add(w`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),r.add(w`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),r.add(w`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)}function yAe(t,e){t.include(yct,e),t.include(eU),t.include(lct),e.hasCloudsReflections&&t.include(uTe,e),e.hasScreenSpaceReflections&&t.include(HJe,e);const r=t.fragment;r.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),r.code.add(w`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),r.uniforms.add(new Pe("lightingSpecularStrength",(i,s)=>s.lighting.mainLight.specularStrength),new Pe("lightingEnvironmentStrength",(i,s)=>s.lighting.mainLight.environmentStrength)),r.code.add(w`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),e.hasCloudsReflections&&r.code.add(w`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),e.hasScreenSpaceReflections?(r.uniforms.add(new Fi("view",(i,s)=>s.ssr.camera.viewMatrix),new et("lastFrameColorTexture",(i,s)=>s.ssr.lastFrameColorTexture),new Pe("fadeFactorSSR",(i,s)=>s.ssr.fadeFactor)),r.code.add(w`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):r.code.add(w`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),e.hasCloudsReflections?e.hasScreenSpaceReflections?r.code.add(w`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):r.code.add(w`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):r.code.add(w`return waterRenderedColor;
}`)}function _ct(t){const e=new Sr,{vertex:r,fragment:i}=e;Mc(r,t),e.include(Ml,t),e.attributes.add(C.POSITION,"vec3"),e.attributes.add(C.UV0,"vec2");const s=new nr("waterColor",n=>n.color);if(t.output===U.Color&&t.isDraped)return e.varyings.add("vpos","vec3"),r.uniforms.add(s),r.code.add(w`
        void main(void) {
          if (waterColor.a < ${w.float(yo)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),i.uniforms.add(s),i.code.add(w`void main() {
fragColor = waterColor;
}`),e;switch(t.output!==U.Color&&t.output!==U.Alpha||(e.include(tM,t),e.include(cC,t),e.varyings.add("vuv","vec2"),e.varyings.add("vpos","vec3"),e.varyings.add("vnormal","vec3"),e.varyings.add("vtbnMatrix","mat3"),t.hasMultipassTerrain&&e.varyings.add("depth","float"),r.uniforms.add(s),r.code.add(w`
      void main(void) {
        if (waterColor.a < ${w.float(yo)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${t.output===U.Color?"forwardLinearDepth();":""}
      }
    `)),e.include(Mu,t),t.output){case U.Alpha:e.include(ys,t),i.uniforms.add(s),i.code.add(w`
        void main() {
          discardBySlice(vpos);
          ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          fragColor = vec4(waterColor.a);
        }
      `);break;case U.Color:e.include(eF),e.include(yJ,{pbrMode:lt.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(Qae),e.include(ys,t),e.include(Gw,t),e.include(yAe,t),i.uniforms.add(s,new Pe("timeElapsed",n=>n.timeElapsed),r.uniforms.get("view"),r.uniforms.get("localOrigin")),Cp(i,t),i.include(Em),Cy(i),Sm(i),i.code.add(w`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${t.receiveShadows?w`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        fragColor = delinearizeGamma(final);
        fragColor = highlightSlice(fragColor, vpos);
        ${t.transparencyPassType===ut.Color?"fragColor = premultiplyAlpha(fragColor);":""}
      }
    `);break;case U.Normal:e.include(tM,t),e.include(Qae,t),e.include(ys,t),e.varyings.add("vpos","vec3"),e.varyings.add("vuv","vec2"),r.uniforms.add(s),r.code.add(w`
        void main(void) {
          if (waterColor.a < ${w.float(yo)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),i.uniforms.add(new Pe("timeElapsed",n=>n.timeElapsed)),i.code.add(w`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
fragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case U.Highlight:e.include(Ly,t),e.varyings.add("vpos","vec3"),r.uniforms.add(s),r.code.add(w`
      void main(void) {
        if (waterColor.a < ${w.float(yo)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),e.include(ys,t),i.code.add(w`void main() {
discardBySlice(vpos);
outputHighlight();
}`);break;case U.ObjectAndLayerIdColor:e.include(iP,t),e.varyings.add("vpos","vec3"),r.uniforms.add(s),r.code.add(w`
      void main(void) {
        if (waterColor.a < ${w.float(yo)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
        forwardObjectAndLayerIdColor();
      }
    `),e.include(ys,t),i.code.add(w`void main() {
discardBySlice(vpos);
outputObjectAndLayerIdColor();
}`)}return e}const vct=Object.freeze(Object.defineProperty({__proto__:null,build:_ct},Symbol.toStringTag,{value:"Module"}));let _Ae=class vAe extends Lr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Ue.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Rr(e.rctx,vAe.shader.get().build(this.configuration),Tr)}_setPipelineState(e){const r=this.configuration,i=e===ut.NONE,s=e===ut.FrontFace;return Mt({blending:r.output!==U.Normal&&r.output!==U.Highlight&&r.output!==U.ObjectAndLayerIdColor&&r.transparent?i?xu:Dy(e):null,depthTest:{func:Ov(e)},depthWrite:i?r.writeDepth?Ul:null:AU(e),colorWrite:Gt,polygonOffset:i||s?null:MU(r.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};_Ae.shader=new Or(vct,()=>ce(()=>import("./WaterSurface.glsl-8dfa08eb.js"),[],import.meta.url));let kn=class extends Vo{constructor(){super(...arguments),this.output=U.Color,this.transparencyPassType=ut.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.objectAndLayerIdColorInstanced=!1,this.isDraped=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}};u([B({count:U.COUNT})],kn.prototype,"output",void 0),u([B({count:ut.COUNT})],kn.prototype,"transparencyPassType",void 0),u([B()],kn.prototype,"spherical",void 0),u([B()],kn.prototype,"receiveShadows",void 0),u([B()],kn.prototype,"hasSlicePlane",void 0),u([B()],kn.prototype,"transparent",void 0),u([B()],kn.prototype,"enableOffset",void 0),u([B()],kn.prototype,"writeDepth",void 0),u([B()],kn.prototype,"hasScreenSpaceReflections",void 0),u([B()],kn.prototype,"doublePrecisionRequiresObfuscation",void 0),u([B()],kn.prototype,"hasCloudsReflections",void 0),u([B()],kn.prototype,"objectAndLayerIdColorInstanced",void 0),u([B()],kn.prototype,"isDraped",void 0),u([B()],kn.prototype,"hasMultipassTerrain",void 0),u([B()],kn.prototype,"cullAboveGround",void 0),u([B({constValue:lt.Water})],kn.prototype,"pbrMode",void 0),u([B({constValue:!0})],kn.prototype,"useCustomDTRExponentForWater",void 0),u([B({constValue:!0})],kn.prototype,"highStepCount",void 0),u([B({constValue:!1})],kn.prototype,"useFillLights",void 0);let bct=class extends Ev{_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}_updateSSRState(e){e.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:e.ssr.enabled})}_updateCloudsReflectionState(e){const r=e.cloudsFade.data!=null;r!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:r})}ensureResources(e){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(e)}beginSlot(e){return this._output===U.Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e)),this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters),this.ensureTechnique(_Ae,e)}},bAe=class extends UQ{constructor(e){super(e,new wAe),this._configuration=new kn,this.animation=new uSe}getConfiguration(e,r){return this._configuration.output=e,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.isDraped=this.parameters.isDraped,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<OU,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}update(e){const r=Math.min(e.camera.relativeElevation,e.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*r<wct;const i=this.animation.advance(e);return this.setParameters({timeElapsed:uX(this.animation.time)*this.parameters.animationSpeed},!1),this.animation.enabled&&i}requiresSlot(e,r){switch(r){case U.Normal:return e===he.DRAPED_WATER;case U.Color:if(this.parameters.isDraped)return e===he.DRAPED_MATERIAL;break;case U.Alpha:break;case U.Highlight:case U.ObjectAndLayerIdColor:return e===he.OPAQUE_MATERIAL||e===he.DRAPED_MATERIAL;default:return!1}let i=he.OPAQUE_MATERIAL;return this.parameters.transparent&&(i=this.parameters.writeDepth?he.TRANSPARENT_MATERIAL:he.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===i}createGLMaterial(e){return new bct(e)}createBufferWriter(){return new yC(oe("enable-feature:objectAndLayerId-rendering")?oct:sct)}},wAe=class extends cQ{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=fr(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=Nt(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.origin=O(),this.modelTransformation=null}};const wct=35e3;let VQ=class{constructor(e=0,r=0){this.from=e,this.to=r}get numElements(){return this.to-this.from}};function Kae(t){const e=new Map;t.forAll(i=>e.set(i.from,i));let r=!0;for(;r;)r=!1,t.forEach(i=>{const s=e.get(i.to);s&&(i.to=s.to,e.delete(s.from),t.removeUnordered(s),r=!0)})}let ele=class extends VQ{constructor(e,r,i){super(r,i),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return this.geometry.highlights!=null&&this.isVisible}get hasOccludees(){return this.geometry.occludees!=null}},xct=class{constructor(){this.first=0,this.count=0}},Tct=class{constructor(){this._numElements=0,this._instances=new Map,this.holes=new Bt({allocator:e=>e||new VQ,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=R$(),this.drawCommandsHighlight=R$(),this.drawCommandsOccludees=R$(),this.drawCommandsShadowHighlightRest=R$()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(e,r){this.deleteInstance(e),this._instances.set(e,r),this._numElements+=r.numElements}deleteInstance(e){const r=this._instances.get(e);r&&(this._numElements-=r.numElements,this._instances.delete(e))}updateInstance(e,r,i){const s=this._instances.get(e);s&&(this._numElements-=s.numElements,s.from=r,s.to=i,this._numElements+=s.numElements)}updateDrawState(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,this._instances.size===0)return;if(!this.needsMultipleCommands()){const i=this.drawCommandsDefault.pushNew(),s=this.holes.front();return this.vao!=null&&this.holes.length===1&&s.to===Math.floor(this.vao.byteSize/e)?(i.first=0,void(i.count=s.from)):(i.first=1/0,i.count=0,this._instances.forEach(n=>{i.first=Math.min(i.first,n.from),i.count=Math.max(i.count,n.to)}),void(i.count-=i.first))}const r=Array.from(this._instances.values()).sort((i,s)=>i.from===s.from?i.to-s.to:i.from-s.from);for(const i of r)i.isVisible&&(tle(i.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,i),tle(i.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,i))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}};function Sct(t){return t.vao!=null}function R$(){return new Bt({allocator:t=>t||new xct,deallocator:t=>t})}function tle(t,e){const r=t.back();if(r==null){const i=t.pushNew();return i.first=e.from,void(i.count=e.numElements)}if(Ect(r,e)){const i=e.from-r.first+e.numElements;r.count=i}else{const i=t.pushNew();i.first=e.from,i.count=e.numElements}}function Ect(t,e){return t.first+t.count>=e.from}let Cct=class{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach(e=>e.vao.dispose()),this.buffers.length=0}findBuffer(e){return this.buffers.find(r=>r.instances.has(e))}};const Act=ED+1;let Oct=class{constructor(e,r,i){this._rctx=e,this._locations=r,this._layout=i,this._cache=e.newCache("VaoCache",Rct)}dispose(){this._cache.destroy()}newVao(e){const r=e.toString(),i=this._cache.pop(r);if(i!=null){const n=i.pop();return i.length>0&&this._cache.put(r,i,e*i.length,Act),n}const s=new Rp(this._rctx,this._locations,{geometry:this._layout},{geometry:Ur.createVertex(this._rctx,Cr.STATIC_DRAW)});return s.vertexBuffers.geometry.setSize(e),s}deleteVao(e){if(e==null)return null;const r=e.byteSize,i=r.toString(),s=this._cache.pop(i);return s!=null?(s.push(e),this._cache.put(i,s,r*s.length,-1)):this._cache.put(i,[e],r,-1),null}};function Rct(t,e){if(e===Pg.ALL)return void t.forEach(s=>s.dispose());const r=t.pop(),i=t.length*r.byteSize;return r.dispose(),i}let xAe=class{constructor(e,r,i){this._rctx=e,this._materialRepository=r,this.material=i,this._dataByOrigin=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new pAe(this.material,this._materialRepository),this._bufferWriter=i.createBufferWriter(),this._vaoCache=new Oct(e,i.vertexAttributeLocations,Fc(this._bufferWriter.vertexBufferLayout))}dispose(){this._glMaterials.destroy(),this._dataByOrigin.forEach(e=>e.dispose()),this._dataByOrigin.clear(),this._vaoCache.dispose()}get isEmpty(){return this._dataByOrigin.size===0}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this.material instanceof bAe}get rendersOccluded(){return!this.isEmpty&&this.material.renderOccluded!==Di.Occlude}get numGeometries(){let e=0;return this._dataByOrigin.forEach(r=>e+=r.buffers.reduce((i,s)=>i+s.instances.size,0)),e}forEachGeometry(e){this._dataByOrigin.forEach(r=>r.buffers.forEach(i=>i.instances.forEach(s=>e(s.geometry))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){const r=this._bufferWriter,i=r.vertexBufferLayout.stride/4;for(const s of e){const n=s.renderGeometry,o=this._dataByOrigin.get(n.localOrigin.id),a=o?.findBuffer(n.id);if(a==null)return;const l=a.instances.get(n.id);if(s.updateType&(Sn.GEOMETRY|Sn.TRANSFORMATION)){const c=$$(r.elementCount(l.geometry.geometry)*i),h=r.vertexBufferLayout.createView(c.buffer);this._writeGeometry(n,h,0),a.vao.vertexBuffers.geometry.setSubData(c,l.from*i,0,l.numElements*i),L$()}s.updateType&(Sn.HIGHLIGHT|Sn.OCCLUDEE|Sn.VISIBILITY)&&(a.drawCommandsDirty=!0)}}_computeDeltas(e,r){const i=new hC;for(const s of e){const n=s.localOrigin;if(n==null)continue;let o=i.get(n.id,null);o==null&&(o=new rle(n.vec3),i.set(n.id,null,o)),o.changes.push(s)}for(const s of r){const n=s.localOrigin;if(n==null)continue;const o=this._dataByOrigin.get(n.id),a=o?.findBuffer(s.id);if(a==null)continue;let l=i.get(n.id,a);l==null&&(l=new rle(n.vec3),i.set(n.id,a,l)),l.changes.push(s)}return i}_addAndRemoveGeometries(e,r){const{_bufferWriter:i,_dataByOrigin:s}=this,n=i.vertexBufferLayout.stride/4,o=this._computeDeltas(e,r);o.forEach((a,l)=>{const c=a.get(null),h=c!=null?c.changes:[];o.delete(l,null);let p=s.get(l);if(a.forEach((f,m)=>{if(o.delete(l,m),m==null)return void nt(!1,"No VAO for removed geometries");if(m.instances.size===f.changes.length)return this._vaoCache.deleteVao(m.vao),uR(p.buffers,m),void(p.buffers.length===0&&h.length===0&&s.delete(l));const y=m.numElements,_=m.vao.byteSize/4,v=h.reduce((S,E)=>S+i.elementCount(E.geometry),0),b=f.changes.reduce((S,E)=>S+i.elementCount(E.geometry),0),T=Math.min((y+v-b)*n,I$),x=T>_;T>FF&&T<_/2?(f.changes.forEach(({id:S})=>m.deleteInstance(S)),m.instances.forEach(({geometry:S})=>h.push(S)),this._vaoCache.deleteVao(m.vao),uR(p.buffers,m)):x?this._applyAndRebuild(m,h,f):this._applyRemoves(m,f)}),h.length>0)for(p==null&&(p=new Cct(c.origin),s.set(l,p)),p.buffers.forEach(f=>this._applyAdds(f,h));h.length>0;)p.buffers.push(this._applyAndRebuild(new Tct,h,null))})}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(e=>{e.buffers.forEach(r=>{r.drawCommandsDirty&&(r.hasHiddenInstances=!1,r.hasHighlights=!1,r.hasOccludees=!1,ko(r.instances,i=>(r.updateDrawState(i),r.hasHiddenInstances&&r.hasHighlights&&r.hasOccludees)),r.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)),this._hasHighlights=this._hasHighlights||r.hasHighlights,this._hasOccludees=this._hasOccludees||r.hasOccludees})})}_applyAndRebuild(e,r,i){if(i!=null)for(const y of i.changes)e.deleteInstance(y.id);const s=this._bufferWriter,n=s.vertexBufferLayout.stride,o=n/4,a=Math.floor(I$/o);let l=e.numElements;for(;r.length>0;){const y=r.pop(),_=s.elementCount(y.geometry);if(l+_>a&&l>0){r.push(y);break}l+=_;const v=new ele(y,0,0);nt(e.instances.get(y.id)==null),e.addInstance(y.id,v)}const c=l*o,h=$$(c),p=s.vertexBufferLayout.createView(h.buffer);let f=0;e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,e.instances.forEach((y,_)=>{this._writeGeometry(y.geometry,p,f);const v=f;f+=s.elementCount(y.geometry.geometry),e.updateInstance(_,v,f),e.updateDrawState(y)}),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(nle(c)),e.vao.vertexBuffers.geometry.setSubData(h,0,0,f*o),L$(),e.holes.clear();const m=e.holes.pushNew();return m.from=f,m.to=Math.floor(e.vao.byteSize/n),e.updateDrawCommands(n),e}_applyRemoves(e,r){if(r.changes.length===0)return;for(const a of r.changes){const l=a.id,c=e.instances.get(l);if(!c)continue;e.deleteInstance(l);const h=Hp.back();if(h){if(h.to===c.from){h.to=c.to;continue}if(h.from===c.to){h.from=c.from;continue}}const p=Hp.pushNew();p.from=c.from,p.to=c.to}Kae(Hp);const i=this._bufferWriter.vertexBufferLayout.stride/4,s=Hp.reduce((a,l)=>Math.max(a,l.numElements),0)*i,n=$$(s);n.fill(0,0,s);const o=e.vao.vertexBuffers.geometry;Hp.forAll(a=>o.setSubData(n,a.from*i,0,a.numElements*i)),L$(),e.holes.pushArray(Hp.data,Hp.length),Hp.forAll((a,l)=>Hp.data[l]=null),Hp.clear(),e.drawCommandsDirty=!0}_applyAdds(e,r){if(r.length===0)return;if(!Sct(e))return void this._applyAndRebuild(e,r,null);const i=this._bufferWriter,s=i.vertexBufferLayout.stride/4,n=e.numElements,o=r.reduce((b,T)=>b+i.elementCount(T.geometry),0),a=Math.min((n+o)*s,I$),l=4*a;if(e.vao.byteSize<nle(I$-FF)&&l>e.vao.byteSize)return void this._applyAndRebuild(e,r,null);Kae(e.holes);const c=new Array;for(const b of r){const T=i.elementCount(b.geometry),x=Mct(e.holes,T);c.push(x)}const h=e.vao.vertexBuffers.geometry;let p=0,f=0,m=0;const y=$$(a),_=i.vertexBufferLayout.createView(y.buffer);r.forEach((b,T)=>{const x=c[T];if(x==null)return;if(m!==x){const A=m-f;A>0&&h.setSubData(y,f*s,0,A*s),f=x,p=0}const S=i.elementCount(b.geometry);this._writeGeometry(b,_,p),p+=S,m=x+S;const E=new ele(b,x,x+S);nt(e.instances.get(b.id)==null),e.addInstance(b.id,E),e.drawCommandsDirty=!0});const v=m-f;v>0&&h.setSubData(y,f*s,0,v*s),VIe(r,(b,T)=>c[T]==null),L$()}_writeGeometry(e,r,i){const s=e.localOrigin.vec3;PYe(ile,-s[0],-s[1],-s[2]);const n=oi(Pct,ile,e.transformation);Mn(M$,n),$c(M$,M$),this._bufferWriter.write(n,M$,e.geometry,r,i)}updateAnimation(e){return this.material.update(e)}requiresSlot(e,r){return this.material.requiresSlot(e,r)}prepareTechnique(e){const{output:r,bindParameters:i}=e;if(!this.requiresSlot(i.slot,r))return null;const s=r===U.Highlight||r===U.ShadowHighlight;if(s&&!this._hasHighlights)return null;const n=r===U.ShadowExcludeHighlight,o=!(s||n);for(const a of this._dataByOrigin.values())for(const l of a.buffers){if(s&&!l.hasHighlights)continue;const c=(s?l.drawCommandsHighlight:n&&l.needsMultipleCommands()?l.drawCommandsShadowHighlightRest:l.drawCommandsDefault)||null,h=o&&l.drawCommandsOccludees||null;if(c?.length||h?.length){const p=this._glMaterials.load(e.rctx,i.slot,r),f=p!=null?p.beginSlot(i):null;if(f!=null)return f}}return null}render(e,r){const{output:i,bindParameters:s}=e,n=i===U.Highlight||i===U.ShadowHighlight,o=i===U.ShadowExcludeHighlight,a=!(n||o),l=this._rctx;l.appleAmdDriverHelper?.resetIndicesType(),l.bindTechnique(r,this.material.parameters,s);for(const c of this._dataByOrigin.values())for(const h of c.buffers){if(n&&!h.hasHighlights)continue;const p=(n?h.drawCommandsHighlight:o&&h.needsMultipleCommands()?h.drawCommandsShadowHighlightRest:h.drawCommandsDefault)||null,f=a&&h.drawCommandsOccludees||null;(p?.length||f?.length)&&(r.program.bindDraw(new Bq(c.origin),s,this.material.parameters),r.ensureAttributeLocations(h.vao),l.bindVAO(h.vao),p?.length&&(r.bindPipelineState(l,s.slot,!1),p.forAll(m=>l.drawArrays(r.primitiveType,m.first,m.count))),f?.length&&(r.bindPipelineState(l,s.slot,!0),f.forAll(m=>l.drawArrays(r.primitiveType,m.first,m.count))))}}get test(){return{material:this.material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}},rle=class{constructor(e){this.origin=e,this.changes=new Array}};function Mct(t,e){let r;if(!t.some(s=>!(s.numElements<e)&&(r=s,!0)))return null;const i=r.from;return r.from+=e,r.from>=r.to&&t.removeUnordered(r),i}const ile=be(),Pct=be(),M$=be(),Hp=new Bt({allocator:t=>t||new VQ,deallocator:null}),FF=65536,P$=4*FF,sle=1024,TAe=16777216,I$=TAe/4;let mN=new Float32Array(FF);function $$(t){return mN.length<t&&(mN=new Float32Array(t)),mN}function nle(t){const e=4*t;return e<=sle?sle:e<P$?P$:Math.max(Math.min(Math.ceil(1.5*e/P$)*P$,TAe),e)}function L$(){mN=new Float32Array(2)}let eu=class extends we{constructor(e){super(e),this._pending=new Ict,this._changes=new Vq,this._materialRenderers=new Map,this._sortedMaterialRenderers=new Bt,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear(),this._pending.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return ko(this._materialRenderers,e=>e.rendersOccluded)}get isEmpty(){return!this.updating&&this._materialRenderers.size===0&&this._geometries.size===0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=dAe(this._changes);let r=!1,i=!1,s=!1;return e.forEach((n,o)=>{let a=this._materialRenderers.get(o);if(!a&&n.adds.length>0&&(a=new xAe(this.rctx,this._materialRepository,o),this._materialRenderers.set(o,a),r=!0,i=!0,s=!0),!a)return;const l=i||a.hasHighlights,c=s||a.hasWater;a.modify(n),i=i||l!==a.hasHighlights,s=s||c!==a.hasWater,a.isEmpty&&(this._materialRenderers.delete(o),a.dispose(),r=!0)}),this._changes.clear(),r&&this._updateSortedMaterialRenderers(),i&&(this._hasHighlights=ko(this._materialRenderers,n=>n.hasHighlights)),s&&(this._hasWater=ko(this._materialRenderers,n=>n.hasWater)),this.notifyChange("updating"),!0}addGeometries(e,r){if(e.length===0)return;const i=this._validateRenderGeometries(e);for(const n of i)this._geometries.set(n.id,n);const s=this._pending.empty;for(const n of i)this._pending.adds.add(n);s&&this.notifyChange("updating"),r===Xi.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,r){const i=this._pending.empty,s=this._pending.adds;for(const n of e)s.has(n)?(this._pending.removed.add(n),s.delete(n)):this._pending.removed.has(n)||this._pending.removes.add(n),this._geometries.delete(n.id);i&&!this._pending.empty&&this.notifyChange("updating"),r===Xi.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,r){const i=this._changes.updates.length===0;for(const s of e){const n=this._changes.updates.pushNew();n.renderGeometry=this._validateRenderGeometry(s),n.updateType=r}switch(i&&this._changes.updates.length>0&&this.notifyChange("updating"),r){case Sn.TRANSFORMATION:case Sn.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case Sn.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let r=!1;return this._sortedMaterialRenderers.forAll(i=>r=i.updateAnimation(e)||r),r}render(e){this._sortedMaterialRenderers.forAll(r=>{if(r.material.shouldRender(e)){const i=r.prepareTechnique(e);i!=null&&r.render(e,i)}})}intersect(e,r,i,s,n){return this._geometries.forEach(o=>{if(s&&!s(o))return;this._intersectRenderGeometry(o,i,r,0,e,n);const a=this.rendererContext.longitudeCyclical;a&&(o.boundingSphere[0]-o.boundingSphere[3]<a.min&&this._intersectRenderGeometry(o,i,r,a.range,e,n),o.boundingSphere[0]+o.boundingSphere[3]>a.max&&this._intersectRenderGeometry(o,i,r,-a.range,e,n)),n++}),n}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach((r,i)=>{i.insertOrder=e++,this._sortedMaterialRenderers.push(r)}),this._sortedMaterialRenderers.sort((r,i)=>{const s=i.material.renderPriority-r.material.renderPriority;return s!==0?s:r.material.insertOrder-i.material.insertOrder})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const r=this._changes.updates.data[e];this._pending.has(r.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,r,i,s,n,o){if(!e.visible)return;let a=0;s+=e.transformation[12],a=e.transformation[13],Hk[0]=i[0]-s,Hk[1]=i[1]-a,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,n,Hk,(l,c,h)=>{$ct(r,h,e.material.renderPriority,o,n,e.layerUid,e.graphicUid)},r)}_notifyGraphicGeometryChanged(e){if(this.drapeSource.notifyGraphicGeometryChanged==null)return;let r;for(const i of e){const s=i.graphicUid;s!=null&&s!==r&&(this.drapeSource.notifyGraphicGeometryChanged(s),r=s)}}_notifyGraphicVisibilityChanged(e){if(this.drapeSource.notifyGraphicVisibilityChanged==null)return;let r;for(const i of e){const s=i.graphicUid;s!=null&&s!==r&&(this.drapeSource.notifyGraphicVisibilityChanged(s),r=s)}}_validateRenderGeometries(e){for(const r of e)this._validateRenderGeometry(r);return e}_validateRenderGeometry(e){return e.localOrigin==null&&(e.localOrigin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};u([d()],eu.prototype,"drapeSource",void 0),u([d()],eu.prototype,"updating",null),u([d()],eu.prototype,"rctx",null),u([d()],eu.prototype,"rendererContext",void 0),u([d()],eu.prototype,"_materialRepository",null),u([d()],eu.prototype,"_localOriginFactory",null),u([d({readOnly:!0})],eu.prototype,"isEmpty",null),u([d()],eu.prototype,"_materialRenderers",void 0),u([d()],eu.prototype,"_geometries",void 0),eu=u([P("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],eu);let Ict=class{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}};function $ct(t,e,r,i,s,n,o){const a=new ect(n,o,e),l=c=>{c.set(Gi.OVERLAY,a,t.dist,t.normal,t.transformation,r,i)};if((s.results.min.drapedLayerOrder==null||r>=s.results.min.drapedLayerOrder)&&(s.results.min.dist==null||s.results.ground.dist<=s.results.min.dist)&&l(s.results.min),s.options.store!==wo.MIN&&(s.results.max.drapedLayerOrder==null||r<s.results.max.drapedLayerOrder)&&(s.results.max.dist==null||s.results.ground.dist>s.results.max.dist)&&l(s.results.max),s.options.store===wo.ALL){const c=LJ(s.ray);l(c),s.results.all.push(c)}}const Hk=Ge();let BQ=class extends hs{constructor(e,r){super(e,"vec2",ei.Draw,(i,s,n,o)=>i.setUniform2fv(e,r(s,n,o)))}};const qk=4;function Lct(){const t=new Sr,e=t.fragment;t.include(Zh);const r=(qk+1)/2,i=1/(2*r*r);return e.include(Ru),e.uniforms.add(new et("depthMap",s=>s.depthTexture),new Ih("tex",s=>s.colorTexture),new BQ("blurSize",s=>s.blurSize),new Pe("projScale",(s,n)=>{const o=fi(n.camera.eye,n.camera.center);return o>5e4?Math.max(0,s.projScale-(o-5e4)):s.projScale}),new Ar("nearFar",(s,n)=>n.camera.nearFar)),e.code.add(w`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv, nearFar);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${w.float(i)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),e.code.add(w`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${w.int(qk)}; r <= ${w.int(qk)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      fragColor = vec4(b / w_total);
    }
  `),t}const Dct=Object.freeze(Object.defineProperty({__proto__:null,build:Lct},Symbol.toStringTag,{value:"Module"}));let SAe=class EAe extends Lr{initializeProgram(e){return new Rr(e.rctx,EAe.shader.get().build(),Tr)}initializePipeline(){return Mt({colorWrite:Gt})}};SAe.shader=new Or(Dct,()=>ce(()=>import("./SSAOBlur.glsl-9cd07ca4.js"),[],import.meta.url));const Nct="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";function zU(t){t.fragment.uniforms.add(new nr("projInfo",(e,r)=>Fct(r))),t.fragment.uniforms.add(new Ar("zScale",(e,r)=>CAe(r))),t.fragment.code.add(w`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function Fct(t){const e=t.camera.projectionMatrix;return e[11]===0?xi(ole,2/(t.camera.fullWidth*e[0]),2/(t.camera.fullHeight*e[5]),(1+e[12])/e[0],(1+e[13])/e[5]):xi(ole,-2/(t.camera.fullWidth*e[0]),-2/(t.camera.fullHeight*e[5]),(1-e[8])/e[0],(1-e[9])/e[5])}const ole=Xt();function CAe(t){return t.camera.projectionMatrix[11]===0?ar(ale,0,1):ar(ale,1,0)}const ale=Ge(),lle=16;function Uct(){const t=new Sr,e=t.fragment;return t.include(Zh),e.include(Ru),t.include(zU),e.uniforms.add(new Pe("radius",(r,i)=>GQ(i.camera))),e.code.add(w`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn - bias, 0.0);
}`),e.code.add(w`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),e.uniforms.add(new Ar("nearFar",(r,i)=>i.camera.nearFar),new et("normalMap",r=>r.normalTexture),new et("depthMap",r=>r.depthTexture),new Ar("zScale",(r,i)=>CAe(i)),new Pe("projScale",r=>r.projScale),new et("rnm",r=>r.noiseTexture),new Ar("rnmScale",(r,i)=>ar(cle,i.camera.fullWidth/r.noiseTexture.descriptor.width,i.camera.fullHeight/r.noiseTexture.descriptor.height)),new Pe("intensity",r=>r.intensity),new Ar("screenSize",(r,i)=>ar(cle,i.camera.fullWidth,i.camera.fullHeight))),e.code.add(w`
    void main(void) {
      fillSphere();
      vec3 fres = normalize(2.0 * texture(rnm, uv * rnmScale).xyz - 1.0);
      float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

      if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
        fragColor = vec4(0);
        return;
      }

      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

      // get the normal of current fragment
      vec4 norm4 = texture(normalMap, uv);
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
      bool isTerrain = norm4.w < 0.5;

      float sum = 0.0;
      vec3 tapPixelPos;

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${w.int(lle)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        //don't use current or very nearby samples
        if( abs(offset.x) < 2.0 || abs(offset.y) < 2.0){
          continue;
        }

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

        if (isTerrain) {
          if (texture(normalMap, tcTap).w < 0.5) {
            continue;
          }
        }

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${w.int(lle)}), 0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4) / 2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
      fragColor = vec4(A);
    }
  `),t}function GQ(t){return Math.max(10,20*t.computeScreenPixelSizeAtDist(Math.abs(4*t.relativeElevation)))}const cle=Ge(),kct=Object.freeze(Object.defineProperty({__proto__:null,build:Uct,getRadius:GQ},Symbol.toStringTag,{value:"Module"}));let AAe=class OAe extends Lr{initializeProgram(e){return new Rr(e.rctx,OAe.shader.get().build(),Tr)}initializePipeline(){return Mt({colorWrite:Gt})}};AAe.shader=new Or(kct,()=>ce(()=>import("./SSAO.glsl-f596ad29.js"),[],import.meta.url));let zct=class extends ri{constructor(){super(...arguments),this.projScale=1}},Vct=class extends zct{constructor(){super(...arguments),this.intensity=1}},Bct=class extends ri{},Gct=class extends Bct{constructor(){super(...arguments),this.blurSize=Ge()}};const W3=2;let RAe=class{constructor(e,r,i,s){this._view=e,this._techniqueRepository=r,this._rctx=i,this._requestRender=s,this._quadVAO=null,this._passParameters=new Vct,this._drawParameters=new Gct}dispose(){this.enabled=!1,this._quadVAO=Ve(this._quadVAO)}destroy(){this.dispose()}disposeOffscreenBuffers(){this._ssaoFBO?.resize(0,0),this._blurFBO?.resize(0,0)}set enabled(e){e?this._enable():this._disable()}get enabled(){return this._enableTime!=null}get active(){return this.enabled&&this._ssaoTechnique.compiled&&this._blurTechnique.compiled}get colorTexture(){return this._ssaoFBO?.colorTexture}render(e,r,i,s){if(this._enableTime==null||i==null||s==null||this._ssaoFBO==null||this._blurFBO==null)return;if(!this.active)return this._enableTime=r,void this._requestRender();this._enableTime===0&&(this._enableTime=r);const n=this._rctx,o=e.camera,a=this._view.qualitySettings.fadeDuration,l=a>0?Math.min(a,r-this._enableTime)/a:1;this._passParameters.normalTexture=s,this._passParameters.depthTexture=i,this._passParameters.projScale=1/o.computeRenderPixelSizeAtDist(1),this._passParameters.intensity=4*jct/GQ(o)**6*l;const c=o.fullViewport,h=c[2],p=c[3],f=h/W3,m=p/W3;this._ssaoFBO.resize(h,p),this._blurFBO.resize(f,m),this._quadVAO==null&&(this._quadVAO=kl(this._rctx)),n.bindFramebuffer(this._ssaoFBO),n.setViewport(0,0,h,p),n.bindTechnique(this._ssaoTechnique,this._passParameters,e).bindDraw(this._drawParameters,e,this._passParameters),n.bindVAO(this._quadVAO);const y=zo(this._quadVAO,"geometry");n.drawArrays(At.TRIANGLE_STRIP,0,y);const _=n.bindTechnique(this._blurTechnique,this._passParameters,e);n.setViewport(0,0,f,m),n.bindFramebuffer(this._blurFBO),this._drawParameters.colorTexture=this._ssaoFBO.colorTexture,ar(this._drawParameters.blurSize,0,W3/p),_.bindDraw(this._drawParameters,e,this._passParameters),n.setViewport(0,0,f,m),n.drawArrays(At.TRIANGLE_STRIP,0,y),n.bindFramebuffer(this._ssaoFBO),n.setViewport(0,0,h,p),n.setClearColor(1,1,1,0),n.clear(Ti.COLOR_BUFFER_BIT),n.setViewport(0,0,f,m),this._drawParameters.colorTexture=this._blurFBO.colorTexture,ar(this._drawParameters.blurSize,W3/h,0),_.bindDraw(this._drawParameters,e,this._passParameters),n.drawArrays(At.TRIANGLE_STRIP,0,y),n.setViewport(c[0],c[1],c[2],c[3]),l<1&&this._requestRender()}_enable(){if(this._enableTime!=null)return;const e=new xr;e.wrapMode=Dt.CLAMP_TO_EDGE,this._ssaoFBO=new hn(this._rctx,e),this._blurFBO=new hn(this._rctx,e);const r=Uint8Array.from(atob(Nct),i=>i.charCodeAt(0));e.pixelFormat=Ct.RGB,e.wrapMode=Dt.REPEAT,e.hasMipmap=!0,e.width=32,e.height=32,this._passParameters.noiseTexture=new Ot(this._rctx,e,r),this._ssaoTechnique==null&&(this._ssaoTechnique=this._techniqueRepository.acquire(AAe)),this._blurTechnique==null&&(this._blurTechnique=this._techniqueRepository.acquire(SAe)),this._enableTime=0,this._requestRender()}_disable(){this._enableTime=null,this._passParameters.noiseTexture=Ve(this._passParameters.noiseTexture),this._blurFBO=Ve(this._blurFBO),this._ssaoFBO=Ve(this._ssaoFBO)}get gpuMemoryUsage(){return(this._blurFBO?.gpuMemoryUsage??0)+(this._ssaoFBO?.gpuMemoryUsage??0)}};const jct=.5;let jQ=class MAe extends Lr{initializeProgram(e){return new Rr(e.rctx,MAe.shader.get().build(),Tr)}initializePipeline(){return this.configuration.hasAlpha?Mt({blending:Eo(xe.SRC_ALPHA,xe.ONE,xe.ONE_MINUS_SRC_ALPHA,xe.ONE_MINUS_SRC_ALPHA),colorWrite:Gt}):Mt({colorWrite:Gt})}};jQ.shader=new Or(ult,()=>ce(()=>import("./TextureOnly.glsl-b1f23ab2.js"),[],import.meta.url));let HQ=class extends va{constructor(){super(...arguments),this.hasAlpha=!1}};u([B()],HQ.prototype,"hasAlpha",void 0);let gf=class extends we{get _bindParameters(){return this._renderContext.bindParameters}get _rctx(){return this.view._stage.renderView.renderingContext}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._handles=new Ii,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new Bt,this._passParameters=new BCe,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this._camera=new gt,this.worldToPCSRatio=1,this.events=new ws,this.longitudeCyclical=null}initialize(){const e=this.view._stage.renderView,{waterTextureRepository:r,stippleTextureRepository:i,markerTextureRepository:s}=e;this._shaderTechniqueRepository=new GCe({rctx:this._rctx,viewingMode:Ue.Local,stippleTextureRepository:i,markerTextureRepository:s,waterTextureRepository:r}),this._renderContext=new uAe(this._rctx,new FQ(this._rctx,this.view.state.viewingMode),new RAe(this.view,this._shaderTechniqueRepository,this._rctx,()=>{})),this._handles.add([ae(()=>r.updating,()=>this.events.emit("content-changed"),Is),ae(()=>this.spatialReference,n=>this._localOriginFactory=new DQ(n),Is),fa(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materialRepository=new jCe(e.textureRepository,this._shaderTechniqueRepository,n=>{(n.renderOccluded&UF)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")},()=>this.events.emit("content-changed")),this._bindParameters.slot=he.DRAPED_MATERIAL,this._bindParameters.highlightDepthTexture=aTe(this._rctx),this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=ut.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new vJ(Me(1,1,1))]),this._handles.add(this.view.resourceController.scheduler.registerTask(vt.STAGE,this))}destroy(){this._handles.destroy(),this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._debugTextureTechnique=Bi(this._debugTextureTechnique),this._passParameters.texture=Ve(this._passParameters.texture),this._bindParameters.highlightDepthTexture=Ve(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=$e(this._shaderTechniqueRepository),this._temporaryFBO=Ve(this._temporaryFBO),this._quadVAO=Ve(this._quadVAO),this.disposeOverlays()}get updating(){return this._sortedDrapeSourceRenderersDirty||ko(this._renderers,e=>e.updating)}get hasOverlays(){return this._overlays!=null&&this._overlayRenderTarget!=null}get gpuMemoryUsage(){return this._overlayRenderTarget!=null?this._overlayRenderTarget.gpuMemoryUsage:0}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,eu)}createDrapeSourceRenderer(e,r,i){const s=this._renderers.get(e);s?.destroy();const n=new r({...i,rendererContext:this,drapeSource:e});return this._renderers.set(e,n),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(ae(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),n}removeDrapeSourceRenderer(e){if(e==null)return;const r=this._renderers.get(e);r!=null&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this._handles.remove(e),r.destroy())}collectUnusedRenderTargetMemory(){let e=!1;const r=T$e();if(this._overlayRenderTarget!=null)for(const i of this._overlayRenderTarget.renderTargets){const s=this.overlays[Li.INNER].validTargets[i.type];e=this._overlayRenderTarget.validateUsageForTarget(s,i,r)||e}return e}get overlays(){return this._overlays??[]}ensureDrapeTargets(e){this._overlays!=null&&this._overlays.forEach(r=>r.hasTargetWithoutRasterImage=BL(e,i=>i.drapeTargetType===Uq.WithoutRasterImage))}ensureDrapeSources(e){this._overlays!=null&&this._overlays.forEach(r=>{r.hasDrapedFeatureSource=BL(e,i=>i.drapeSourceType===JO.Features),r.hasDrapedRasterSource=BL(e,i=>i.drapeSourceType===JO.RasterImage)})}ensureOverlays(e,r){this._overlays==null&&(this._overlayRenderTarget=new alt(this._rctx),this._overlays=[new Hoe(Li.INNER,this._overlayRenderTarget),new Hoe(Li.OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(r)}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=Ve(this._overlayRenderTarget),this.events.emit("textures-disposed")}get running(){return this.updating}runTask(e){this._processDrapeSources(e,()=>!0)}_processDrapeSources(e,r){let i=!1;for(const[s,n]of this._renderers){if(e.done)break;(s.destroyed||r(s))&&n.commitChanges()&&(i=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,i=!0,this._updateSortedDrapeSourceRenderers()),i&&(this._overlays!=null&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(Ja,e=>e.updatePolicy===H_.SYNC)}get isEmpty(){return!ai.OVERLAY_DRAW_DEBUG_TEXTURE&&!ko(this._renderers,e=>!e.isEmpty)}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateAnimation(e){let r=!1;return this._renderers.forEach(i=>r=i.updateAnimation(e)||r),r}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawTarget(e,r,i){const s=e.canvasGeometries;if(s.numViews===0)return!1;const{alignPixelEnabled:n,contentPixelRatio:o}=i;this._screenToWorldRatio=o*e.mapUnitsPerPixel/nQ;const a=r.output;if(this.isEmpty||a===U.Highlight&&!this.hasHighlights||a===U.Normal&&!this.hasWater||!e.hasSomeSizedView())return!1;const l=r.fbo;if(!l.isValid())return!1;const c=2*e.resolution,h=e.resolution;l.resize(c,h);const p=this._rctx;if(this._camera.pixelRatio=e.pixelRatio*o,this._renderContext.output=a,this._bindParameters.alignPixelEnabled=n,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=a===U.Normal?he.DRAPED_WATER:he.DRAPED_MATERIAL,e.applyViewport(this._rctx),l.bind(p),e.index===Li.INNER&&(p.setClearColor(0,0,0,0),p.clearSafe(Ti.COLOR_BUFFER_BIT)),r.type===ns.Occluded&&(this._renderContext.renderOccludedMask=UF),ai.OVERLAY_DRAW_DEBUG_TEXTURE&&r.type!==ns.Occluded)for(let f=0;f<s.numViews;f++)this._setViewParameters(s.extents[f],e),this._drawDebugTexture(e.resolution,qct[e.index]);return this._renderers.size>0&&this._sortedRenderers.forAll(({drapeSource:f,renderer:m})=>{if(r.type===ns.ColorNoRasterImage&&f.drapeSourceType===JO.RasterImage)return;const{fullOpacity:y}=f,_=y!=null&&y<1&&a===U.Color;_&&(this.bindTemporaryFramebuffer(this._rctx,c,h),p.clearSafe(Ti.COLOR_BUFFER_BIT));for(let v=0;v<s.numViews;v++)this._setViewParameters(s.extents[v],e),m.render(this._renderContext);_&&this._temporaryFBO!=null&&(l.bind(p),this.view._stage.renderView.compositingHelper.compositeOverlay(this._renderContext.bindParameters,this._temporaryFBO.getTexture(),y,e.index))}),p.bindFramebuffer(null),l.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,r,i){this._temporaryFBO==null&&(this._temporaryFBO=new VCe(e,!1)),this._temporaryFBO.resize(r,i),this._temporaryFBO.bind(e)}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,r,i,s){let n=0;for(const o of this._renderers.values())n=o.intersect?.(e,r,i,s,n)??n}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const e=this.view.map.allLayers;this._renderers.forEach((r,i)=>{const s=e.indexOf(i.layer),n=s>=0,o=this._renderers.size*(i.renderGroup??(n?$F.MapLayer:$F.ViewLayer))+(n?s:0);this._sortedRenderers.push(new Hct(i,r,o))}),this._sortedRenderers.sort((r,i)=>r.index-i.index)}_setViewParameters(e,r){const i=this._camera;i.viewport=[0,0,r.resolution,r.resolution],Eve(i.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],i.near,i.far),zM(i.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=ko(this._renderers,r=>r.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_updateHasHighlights(){const e=ko(this._renderers,r=>r.hasHighlights);e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}_updateRendersOccluded(){const e=ko(this._renderers,r=>r.rendersOccluded);e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}_drawDebugTexture(e,r){this._ensureDebugPatternResources(e,r);const i=this._rctx;i.bindTechnique(this._debugTextureTechnique,this._passParameters,null),i.bindVAO(this._quadVAO),i.drawArrays(At.TRIANGLE_STRIP,0,zo(this._quadVAO,"geometry"))}_ensureDebugPatternResources(e,r){if(se(this._passParameters.color,r[0],r[1],r[2]),this._passParameters.texture)return;const i=new Uint8Array(e*e*4);let s=0;for(let a=0;a<e;a++)for(let l=0;l<e;l++){const c=Math.floor(l/10),h=Math.floor(a/10);c<2||h<2||10*c>e-20||10*h>e-20?(i[s++]=255,i[s++]=255,i[s++]=255,i[s++]=255):(i[s++]=255,i[s++]=255,i[s++]=255,i[s++]=1&c&&1&h?1&l^1&a?0:255:1&c^1&h?0:128)}const n=new xr(e);n.samplingMode=Rt.NEAREST,this._passParameters.texture=new Ot(this._rctx,n,i);const o=new HQ;o.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(jQ,o),this._quadVAO=kl(this._rctx)}get test(){return{drapedRenderers:Array.from(this._renderers.values()),getDrapeSourceRenderer:e=>this._renderers.get(e)}}};u([d()],gf.prototype,"_sortedDrapeSourceRenderersDirty",void 0),u([d({autoDestroy:!0})],gf.prototype,"_shaderTechniqueRepository",void 0),u([d({constructOnly:!0})],gf.prototype,"view",void 0),u([d()],gf.prototype,"worldToPCSRatio",void 0),u([d()],gf.prototype,"spatialReference",void 0),u([d({type:Boolean,readOnly:!0})],gf.prototype,"updating",null),u([d()],gf.prototype,"isEmpty",null),gf=u([P("esri.views.3d.terrain.OverlayRenderer")],gf);let Hct=class{constructor(e,r,i){this.drapeSource=e,this.renderer=r,this.index=i}};const qct=[[1,.5,.5],[.5,.5,1]],qQ=-2,UF=Di.OccludeAndTransparent;function WQ(t,e,r,i){const s=cP(t.rings,!!t.hasZ,fm.CCW_IS_HOLE),n=Ho(s.position.length),o=KEe(s.position,t.spatialReference,0,n,0,s.position,0,s.position.length/3,e,r,i),a=o!=null;return new Zct(s.position,n,$Ae(s.polygons,s.position,n),IAe(s.outlines,s.position,n),a,o)}function PAe(t,e){const r=cP(t.rings,!1,fm.CCW_IS_HOLE),i=li(r.position,t.spatialReference,0,r.position,e,0,r.position.length/3);for(let s=2;s<r.position.length;s+=3)r.position[s]=qQ;return{position:r.position,polygons:$Ae(r.polygons,r.position),outlines:IAe(r.outlines,r.position),projectionSuccess:i}}function IAe(t,e,r=null){return t.filter(({count:i})=>i>1).map(({index:i,count:s})=>{const n=3*i,o=3*s;return r!=null?new LAe(i,s,$h(e,n,o),$h(r,n,o)):new XQ(i,s,$h(e,n,o))})}function $Ae(t,e,r=null){const i=new Array;for(const{index:s,count:n,holeIndices:o,pathLengths:a}of t){if(n<=1)continue;const l=3*s,c=3*n,h=o.map(f=>f-s),p=r!=null?new Wct(s,n,$h(e,3*s,3*n),$h(r,l,c),h,a):new Xct(s,n,$h(e,3*s,3*n),h,a);i.push(p)}return i}let XQ=class{constructor(e,r,i){this.index=e,this.count=r,this.position=i}},LAe=class extends XQ{constructor(e,r,i,s){super(e,r,i),this.mapPositions=s}},Wct=class extends LAe{constructor(e,r,i,s,n,o){super(e,r,i,s),this.holeIndices=n,this.pathLengths=o}},Xct=class extends XQ{constructor(e,r,i,s,n){super(e,r,i),this.holeIndices=s,this.pathLengths=n}},Zct=class{constructor(e,r,i,s,n,o){this.position=e,this.mapPositions=r,this.polygons=i,this.outlines=s,this.projectionSuccess=n,this.sampledElevation=o}};function jw(t,e,r,i,s,n=2){const o=1/(Math.abs(r)+Math.abs(i)+Math.abs(s)),a=r*o,l=i*o,c=s<=0?(a>=0?1:-1)*(1-Math.abs(l)):a,h=s<=0?(l>=0?1:-1)*(1-Math.abs(a)):l,p=e*n;t[p]=ule(c),t[p+1]=ule(h)}function Yct(t){const e=t.length/3,r=new Int16Array(2*e);let i=0;for(let s=0;s<e;++s)jw(r,s,t[i++],t[i++],t[i++]);return r}function Jct(t,e,r,i=2){const s=r*i,n=hle(e[s]),o=hle(e[s+1]),a=1-Math.abs(n)-Math.abs(o);t[2]=a,a<0?(t[0]=(n>=0?1:-1)*(1-Math.abs(o)),t[1]=(o>=0?1:-1)*(1-Math.abs(n))):(t[0]=n,t[1]=o),ye(t,t)}function ule(t){return ve(Math.round(32767*t),-32767,32767)}function hle(t){return ve(t/32767,-1,1)}function DAe(t,e){const r=t.fragment;switch(r.code.add(w`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),e.doubleSidedMode){case es.None:r.code.add(w`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case es.View:r.code.add(w`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case es.WindingOrder:r.code.add(w`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:e.doubleSidedMode;case es.COUNT:}}var es;(function(t){t[t.None=0]="None",t[t.View=1]="View",t[t.WindingOrder=2]="WindingOrder",t[t.COUNT=3]="COUNT"})(es||(es={}));function NAe({normalTexture:t,metallicRoughnessTexture:e,metallicFactor:r,roughnessFactor:i,emissiveTexture:s,emissiveFactor:n,occlusionTexture:o}){return t==null&&e==null&&s==null&&(n==null||ha(n,Ka))&&o==null&&(i==null||i===1)&&(r==null||r===1||r===0)}const VU=[1,1,.5],ZQ=[0,.6,.2],Qct=[0,1,.2];function FAe(t){t.vertex.code.add(w`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}let Kct=class extends va{constructor(){super(...arguments),this.instancedDoublePrecision=!1}};function UAe(t,e){e.instanced&&e.instancedDoublePrecision&&(t.attributes.add(C.MODELORIGINHI,"vec3"),t.attributes.add(C.MODELORIGINLO,"vec3"),t.attributes.add(C.MODEL,"mat3"),t.attributes.add(C.MODELNORMAL,"mat3"));const r=t.vertex;e.instancedDoublePrecision&&(r.include(oF,e),r.uniforms.add(new wu("viewOriginHi",(i,s)=>kQe(se(D$,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),D$)),new wu("viewOriginLo",(i,s)=>zQe(se(D$,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),D$)))),r.code.add(w`
    vec3 calculateVPos() {
      ${e.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `),r.code.add(w`
    vec3 subtractOrigin(vec3 _pos) {
      ${e.instancedDoublePrecision?w`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),r.code.add(w`
    vec3 dpNormal(vec4 _normal) {
      ${e.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `),e.output===U.Normal&&(wE(r),r.code.add(w`
    vec3 dpNormalView(vec4 _normal) {
      ${e.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `)),e.hasVertexTangents&&r.code.add(w`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${e.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `)}u([B()],Kct.prototype,"instancedDoublePrecision",void 0);const D$=O();function kAe(t){t.vertex.code.add(w`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${w.int(Bs.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${w.int(Bs.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${w.int(Bs.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${w.int(Bs.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}function zAe(t,e){e.hasSymbolColors?(t.include(kAe),t.attributes.add(C.SYMBOLCOLOR,"vec4"),t.varyings.add("colorMixMode","mediump float"),t.vertex.code.add(w`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(t.fragment.uniforms.add(new hP("colorMixMode",r=>X2e[r.colorMixMode])),t.vertex.code.add(w`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function bx(t,e){e.hasVertexColors?(t.attributes.add(C.COLOR,"vec4"),t.varyings.add("vColor","vec4"),t.vertex.code.add(w`void forwardVertexColor() { vColor = color; }`),t.vertex.code.add(w`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):t.vertex.code.add(w`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function eut(t){t.fragment.code.add(w`
    #define discardOrAdjustAlpha(color) { if (color.a < ${w.float(yo)}) { discard; } }
  `)}let cw=class extends hs{constructor(e,r){super(e,"float",ei.Draw,(i,s,n)=>i.setUniform1f(e,r(s,n)))}};function uw(t,e){VAe(t,e,new Pe("textureAlphaCutoff",r=>r.textureAlphaCutoff))}function tut(t,e){VAe(t,e,new cw("textureAlphaCutoff",r=>r.textureAlphaCutoff))}function VAe(t,e,r){const i=t.fragment;switch(e.alphaDiscardMode!==Qr.Mask&&e.alphaDiscardMode!==Qr.MaskBlend||i.uniforms.add(r),e.alphaDiscardMode){case Qr.Blend:return t.include(eut);case Qr.Opaque:i.code.add(w`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case Qr.Mask:i.code.add(w`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case Qr.MaskBlend:t.fragment.code.add(w`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function BAe(t,e){const{vertex:r,fragment:i}=t,s=e.hasModelTransformation;if(s){const o=Ui();r.uniforms.add(new Fi("model",a=>a.modelTransformation??un)),r.uniforms.add(new Yh("normalTransform",a=>(rv(o,a.modelTransformation??un),o)))}const n=e.hasColorTexture&&e.alphaDiscardMode!==Qr.Opaque;switch(e.output){case U.Depth:case U.Shadow:case U.ShadowHighlight:case U.ShadowExcludeHighlight:case U.ObjectAndLayerIdColor:Mc(r,e),t.include(Ml,e),t.include(Yf,e),t.include(Yg,e),t.include(_y,e),t.include(ys,e),t.include(iP,e),Nw(t),t.varyings.add("depth","float"),n&&i.uniforms.add(new et("tex",o=>o.texture)),r.code.add(w`
          void main(void) {
            vpos = calculateVPos();
            ${s?"vpos = (model * vec4(vpos, 1.0)).xyz;":""}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
            forwardTextureCoordinates();
            forwardObjectAndLayerIdColor();
          }
        `),t.include(uw,e),i.code.add(w`
          void main(void) {
            discardBySlice(vpos);
            ${n?w`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?w`colorUV`:w`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${e.output===U.ObjectAndLayerIdColor?w`outputObjectAndLayerIdColor();`:w`outputDepth(depth);`}
          }
        `);break;case U.Normal:{Mc(r,e),t.include(Ml,e),t.include(uP,e),t.include(UU,e),t.include(Yf,e),t.include(Yg,e),n&&i.uniforms.add(new et("tex",a=>a.texture)),e.normalType===Ir.ScreenDerivative&&t.varyings.add("vPositionView","vec3");const o=e.normalType===Ir.Attribute||e.normalType===Ir.Compressed;r.code.add(w`
          void main(void) {
            vpos = calculateVPos();
            ${s?"vpos = (model * vec4(vpos, 1.0)).xyz;":""}

            ${o?w`vNormalWorld = ${s?"normalize(normalTransform * dpNormal(vvLocalNormal(normalModel())))":"dpNormalView(vvLocalNormal(normalModel()))"};`:w`
                  // Get vertex position in camera space for screen-space derivative normals
                  vPositionView = (view * vec4(vpos, 1.0)).xyz;
                `}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            forwardTextureCoordinates();
          }
        `),t.include(ys,e),t.include(uw,e),i.code.add(w`
          void main() {
            discardBySlice(vpos);
            ${n?w`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?w`colorUV`:w`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${e.normalType===Ir.ScreenDerivative?w`vec3 normal = screenDerivativeNormal(vPositionView);`:w`
                  vec3 normal = normalize(vNormalWorld);
                  if (gl_FrontFacing == false){
                    normal = -normal;
                  }`}
            fragColor = vec4(0.5 + 0.5 * normal, 1.0);
          }
        `);break}case U.Highlight:Mc(r,e),t.include(Ml,e),t.include(Yf,e),t.include(Yg,e),n&&i.uniforms.add(new et("tex",o=>o.texture)),r.code.add(w`
          void main(void) {
            vpos = calculateVPos();
            ${s?"vpos = (model * vec4(vpos, 1.0)).xyz;":""}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            forwardTextureCoordinates();
          }
        `),t.include(ys,e),t.include(uw,e),t.include(Ly,e),i.code.add(w`
          void main() {
            discardBySlice(vpos);
            ${n?w`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?w`colorUV`:w`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}}function GAe(t,e){const r=t.fragment;e.hasVertexTangents?(t.attributes.add(C.TANGENT,"vec4"),t.varyings.add("vTangent","vec4"),e.doubleSidedMode===es.WindingOrder?r.code.add(w`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):r.code.add(w`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):r.code.add(w`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`),e.textureCoordinateType!==Ds.None&&(t.include(fJ,e),r.uniforms.add(e.pbrTextureBindType===ei.Pass?new et("normalTexture",i=>i.textureNormal):new Ih("normalTexture",i=>i.textureNormal)),r.code.add(w`vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
vec3 rawNormal = textureLookup(normalTexture, uv).rgb * 2.0 - 1.0;
return tangentSpace * rawNormal;
}`))}function dP(t,e){const r=t.fragment;e.receiveAmbientOcclusion?(r.uniforms.add(new et("ssaoTex",(i,s)=>s.ssaoHelper.colorTexture)),r.constants.add("blurSizePixelsInverse","float",1/W3),r.code.add(w`float evaluateAmbientOcclusionInverse() {
vec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));
return texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).a;
}
float evaluateAmbientOcclusion() {
return 1.0 - evaluateAmbientOcclusionInverse();
}`)):r.code.add(w`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}function pP(t){t.constants.add("ambientBoostFactor","float",PTe)}function _C(t){t.uniforms.add(new Pe("lightingGlobalFactor",(e,r)=>r.lighting.globalFactor))}function Hw(t,e){const r=t.fragment;switch(t.include(dP,e),e.pbrMode!==lt.Disabled&&t.include(zQ,e),t.include(yJ,e),t.include(XM),r.code.add(w`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${e.pbrMode===lt.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),pP(r),_C(r),Cy(r),r.code.add(w`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${e.spherical?w`normalize(vPosWorld)`:w`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),Sm(r),r.code.add(w`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),e.pbrMode){case lt.Disabled:case lt.WaterOnIntegratedMesh:case lt.Water:t.include(eF),r.code.add(w`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case lt.Normal:case lt.Schematic:r.code.add(w`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),r.code.add(w`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),e.useFillLights?r.uniforms.add(new Jf("hasFillLights",(i,s)=>s.enableFillLights)):r.constants.add("hasFillLights","bool",!1),r.code.add(w`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),r.uniforms.add(new Pe("lightingSpecularStrength",(i,s)=>s.lighting.mainLight.specularStrength),new Pe("lightingEnvironmentStrength",(i,s)=>s.lighting.mainLight.environmentStrength)),r.code.add(w`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),r.code.add(w`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${e.pbrMode===lt.Schematic?w`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:w`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case lt.Terrain:case lt.TerrainWithWater:t.include(eF),r.code.add(w`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluateTerrainLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:e.pbrMode;case lt.COUNT:}}function $l(){const t=new Float32Array(9);return t[0]=1,t[4]=1,t[8]=1,t}function jAe(t){const e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function gN(t,e,r,i,s,n,o,a,l){const c=new Float32Array(9);return c[0]=t,c[1]=e,c[2]=r,c[3]=i,c[4]=s,c[5]=n,c[6]=o,c[7]=a,c[8]=l,c}function rut(t,e){return new Float32Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:jAe,create:$l,createView:rut,fromValues:gN},Symbol.toStringTag,{value:"Module"}));function iut(t){t.vertex.uniforms.add(new Yh("colorTextureTransformMatrix",e=>e.colorTextureTransformMatrix!=null?e.colorTextureTransformMatrix:$l())),t.varyings.add("colorUV","vec2"),t.vertex.code.add(w`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function sut(t){t.vertex.uniforms.add(new Yh("normalTextureTransformMatrix",e=>e.normalTextureTransformMatrix!=null?e.normalTextureTransformMatrix:$l())),t.varyings.add("normalUV","vec2"),t.vertex.code.add(w`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function nut(t){t.vertex.uniforms.add(new Yh("emissiveTextureTransformMatrix",e=>e.emissiveTextureTransformMatrix!=null?e.emissiveTextureTransformMatrix:$l())),t.varyings.add("emissiveUV","vec2"),t.vertex.code.add(w`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function out(t){t.vertex.uniforms.add(new Yh("occlusionTextureTransformMatrix",e=>e.occlusionTextureTransformMatrix!=null?e.occlusionTextureTransformMatrix:$l())),t.varyings.add("occlusionUV","vec2"),t.vertex.code.add(w`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function aut(t){t.vertex.uniforms.add(new Yh("metallicRoughnessTextureTransformMatrix",e=>e.metallicRoughnessTextureTransformMatrix!=null?e.metallicRoughnessTextureTransformMatrix:$l())),t.varyings.add("metallicRoughnessUV","vec2"),t.vertex.code.add(w`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function rM(t){t.include(Em),t.code.add(w`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${w.int(Bs.Multiply)}) {
        return allMixed;
      }
      if (mode == ${w.int(Bs.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${w.int(Bs.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${w.int(Bs.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${w.int(Bs.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function lut(t){const e=new Sr,{vertex:r,fragment:i,varyings:s}=e;if(Mc(r,t),e.include(ZM),s.add("vpos","vec3"),e.include(Yg,t),e.include(UAe,t),e.include(k2e,t),t.hasColorTextureTransform&&e.include(iut),t.output===U.Color||t.output===U.Alpha){t.hasNormalTextureTransform&&e.include(sut),t.hasEmissionTextureTransform&&e.include(nut),t.hasOcclusionTextureTransform&&e.include(out),t.hasMetallicRoughnessTextureTransform&&e.include(aut),Cp(r,t),e.include(uP,t),e.include(Ml,t);const n=t.normalType===Ir.Attribute||t.normalType===Ir.Compressed;n&&t.offsetBackfaces&&e.include(FAe),e.include(GAe,t),e.include(UU,t),t.instancedColor&&e.attributes.add(C.INSTANCECOLOR,"vec4"),s.add("vPositionLocal","vec3"),e.include(Yf,t),e.include(cC,t),e.include(zAe,t),e.include(bx,t),r.uniforms.add(new nr("externalColor",a=>a.externalColor)),s.add("vcolorExt","vec4"),t.hasMultipassTerrain&&s.add("depth","float");const o=t.hasModelTransformation;if(o){const a=Ui();r.uniforms.add(new Fi("model",l=>l.modelTransformation??un)),r.uniforms.add(new Yh("normalTransform",l=>(rv(a,l.modelTransformation??un),a)))}r.code.add(w`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${w.float(yo)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = calculateVPos();
          ${o?"vpos = (model * vec4(vpos, 1.0)).xyz;":""}
          vPositionLocal = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${n?w`vNormalWorld = ${o?"normalize(normalTransform * dpNormal(vvLocalNormal(normalModel())))":"dpNormal(vvLocalNormal(normalModel()))"};`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${t.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, vpos);
          ${n&&t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        ${t.hasColorTextureTransform?w`forwardColorUV();`:""}
        ${t.hasNormalTextureTransform?w`forwardNormalUV();`:""}
        ${t.hasEmissionTextureTransform?w`forwardEmissiveUV();`:""}
        ${t.hasOcclusionTextureTransform?w`forwardOcclusionUV();`:""}
        ${t.hasMetallicRoughnessTextureTransform?w`forwardMetallicRoughnessUV();`:""}
      }
    `)}switch(t.output){case U.Alpha:e.include(ys,t),e.include(uw,t),e.include(Mu,t),i.uniforms.add(new Pe("opacity",n=>n.opacity),new Pe("layerOpacity",n=>n.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new et("tex",n=>n.texture)),i.include(rM),i.code.add(w`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${t.hasColorTexture?w`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?w`colorUV`:w`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:w`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?w`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:w`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        fragColor = vec4(opacity_);
      }
    `);break;case U.Color:e.include(ys,t),e.include(Hw,t),e.include(dP,t),e.include(uw,t),e.include(t.instancedDoublePrecision?kU:Gw,t),e.include(Mu,t),Cp(i,t),i.uniforms.add(r.uniforms.get("localOrigin"),new zt("ambient",n=>n.ambient),new zt("diffuse",n=>n.diffuse),new Pe("opacity",n=>n.opacity),new Pe("layerOpacity",n=>n.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new et("tex",n=>n.texture)),e.include(gJ,t),e.include(zQ,t),i.include(rM),e.include(DAe,t),pP(i),_C(i),Sm(i),i.code.add(w`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${t.hasColorTexture?w`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?w`colorUV`:w`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:w`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${t.normalType===Ir.ScreenDerivative?w`
                vec3 normal = screenDerivativeNormal(vPositionLocal);`:w`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${t.pbrMode===lt.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${t.receiveShadows?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?w`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:w`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.hasNormalTexture?w`
                mat3 tangentSpace = ${t.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, ${t.hasNormalTextureTransform?w`normalUV`:"vuv0"});`:w`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${t.spherical?w`normalize(posWorld);`:w`vec3(0.0, 0.0, 1.0);`}

        ${t.snowCover?w`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${t.pbrMode===lt.Normal||t.pbrMode===lt.Schematic?w`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?w`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:w`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===ut.Color?w`fragColor = premultiplyAlpha(fragColor);`:""}
      }
    `)}return e.include(BAe,t),e}const cut=Object.freeze(Object.defineProperty({__proto__:null,build:lut},Symbol.toStringTag,{value:"Module"}));let uut=class extends fAe{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=Wa(VU),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=mi.Back,this.isInstanced=!1,this.hasInstancedColor=!1,this.emissiveFactor=Me(0,0,0),this.instancedDoublePrecision=!1,this.normalType=Ir.Attribute,this.receiveSSAO=!0,this.receiveShadows=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=Me(.2,.2,.2),this.diffuse=Me(.8,.8,.8),this.externalColor=Nt(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=O(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.modelTransformation=null,this.transparent=!1,this.writeDepth=!0,this.customDepthTest=$w.Less,this.textureAlphaMode=Qr.Blend,this.textureAlphaCutoff=MF,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=Di.Occlude}},hut=class extends mAe{constructor(){super(...arguments),this.origin=O(),this.slicePlaneLocalOrigin=this.origin}},YQ=class HAe extends Lr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Ue.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result,r.textureCoordinateType=r.hasColorTexture||r.hasMetallicRoughnessTexture||r.hasEmissionTexture||r.hasOcclusionTexture||r.hasNormalTexture?Ds.Default:Ds.None,r.objectAndLayerIdColorInstanced=r.instanced}initializeProgram(e){return this._initializeProgram(e,HAe.shader)}_initializeProgram(e,r){return new Rr(e.rctx,r.get().build(this.configuration),Tr)}_convertDepthTestFunction(e){return e===$w.Lequal?ti.LEQUAL:ti.LESS}_makePipeline(e,r){const i=this.configuration,s=e===ut.NONE,n=e===ut.FrontFace;return Mt({blending:i.output!==U.Color&&i.output!==U.Alpha||!i.transparent?null:s?xu:Dy(e),culling:dut(i)?tU(i.cullFace):null,depthTest:{func:Ov(e,this._convertDepthTestFunction(i.customDepthTest))},depthWrite:(s||n)&&i.writeDepth?Ul:null,colorWrite:Gt,stencilWrite:i.hasOccludees?mm:null,stencilTest:i.hasOccludees?r?mv:Rv:null,polygonOffset:s||n?null:MU(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0),this._makePipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};function dut(t){return t.cullFace!==mi.None||!t.hasSlicePlane&&!t.transparent&&!t.doubleSidedMode}YQ.shader=new Or(cut,()=>ce(()=>import("./DefaultMaterial.glsl-eeb19531.js"),[],import.meta.url));let jt=class extends Vo{constructor(){super(...arguments),this.output=U.Color,this.alphaDiscardMode=Qr.Opaque,this.doubleSidedMode=es.None,this.pbrMode=lt.Disabled,this.cullFace=mi.None,this.transparencyPassType=ut.NONE,this.normalType=Ir.Attribute,this.textureCoordinateType=Ds.None,this.customDepthTest=$w.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.objectAndLayerIdColorInstanced=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1}};u([B({count:U.COUNT})],jt.prototype,"output",void 0),u([B({count:Qr.COUNT})],jt.prototype,"alphaDiscardMode",void 0),u([B({count:es.COUNT})],jt.prototype,"doubleSidedMode",void 0),u([B({count:lt.COUNT})],jt.prototype,"pbrMode",void 0),u([B({count:mi.COUNT})],jt.prototype,"cullFace",void 0),u([B({count:ut.COUNT})],jt.prototype,"transparencyPassType",void 0),u([B({count:Ir.COUNT})],jt.prototype,"normalType",void 0),u([B({count:Ds.COUNT})],jt.prototype,"textureCoordinateType",void 0),u([B({count:$w.COUNT})],jt.prototype,"customDepthTest",void 0),u([B()],jt.prototype,"spherical",void 0),u([B()],jt.prototype,"hasVertexColors",void 0),u([B()],jt.prototype,"hasSymbolColors",void 0),u([B()],jt.prototype,"hasVerticalOffset",void 0),u([B()],jt.prototype,"hasSlicePlane",void 0),u([B()],jt.prototype,"hasSliceHighlight",void 0),u([B()],jt.prototype,"hasColorTexture",void 0),u([B()],jt.prototype,"hasMetallicRoughnessTexture",void 0),u([B()],jt.prototype,"hasEmissionTexture",void 0),u([B()],jt.prototype,"hasOcclusionTexture",void 0),u([B()],jt.prototype,"hasNormalTexture",void 0),u([B()],jt.prototype,"hasScreenSizePerspective",void 0),u([B()],jt.prototype,"hasVertexTangents",void 0),u([B()],jt.prototype,"hasOccludees",void 0),u([B()],jt.prototype,"hasMultipassTerrain",void 0),u([B()],jt.prototype,"hasModelTransformation",void 0),u([B()],jt.prototype,"offsetBackfaces",void 0),u([B()],jt.prototype,"vvSize",void 0),u([B()],jt.prototype,"vvColor",void 0),u([B()],jt.prototype,"receiveShadows",void 0),u([B()],jt.prototype,"receiveAmbientOcclusion",void 0),u([B()],jt.prototype,"textureAlphaPremultiplied",void 0),u([B()],jt.prototype,"instanced",void 0),u([B()],jt.prototype,"instancedColor",void 0),u([B()],jt.prototype,"objectAndLayerIdColorInstanced",void 0),u([B()],jt.prototype,"instancedDoublePrecision",void 0),u([B()],jt.prototype,"doublePrecisionRequiresObfuscation",void 0),u([B()],jt.prototype,"writeDepth",void 0),u([B()],jt.prototype,"transparent",void 0),u([B()],jt.prototype,"enableOffset",void 0),u([B()],jt.prototype,"cullAboveGround",void 0),u([B()],jt.prototype,"snowCover",void 0),u([B()],jt.prototype,"hasColorTextureTransform",void 0),u([B()],jt.prototype,"hasEmissionTextureTransform",void 0),u([B()],jt.prototype,"hasNormalTextureTransform",void 0),u([B()],jt.prototype,"hasOcclusionTextureTransform",void 0),u([B()],jt.prototype,"hasMetallicRoughnessTextureTransform",void 0),u([B({constValue:!0})],jt.prototype,"hasVvInstancing",void 0),u([B({constValue:!1})],jt.prototype,"useCustomDTRExponentForWater",void 0),u([B({constValue:!1})],jt.prototype,"supportsTextureAtlas",void 0),u([B({constValue:!0})],jt.prototype,"useFillLights",void 0);function put(t){const e=new Sr,{vertex:r,fragment:i,varyings:s}=e;return Mc(r,t),e.include(ZM),s.add("vpos","vec3"),e.include(Yg,t),e.include(UAe,t),e.include(k2e,t),t.output!==U.Color&&t.output!==U.Alpha||(Cp(e.vertex,t),e.include(uP,t),e.include(Ml,t),t.offsetBackfaces&&e.include(FAe),t.instancedColor&&e.attributes.add(C.INSTANCECOLOR,"vec4"),s.add("vNormalWorld","vec3"),s.add("localvpos","vec3"),t.hasMultipassTerrain&&s.add("depth","float"),e.include(Yf,t),e.include(cC,t),e.include(zAe,t),e.include(bx,t),r.uniforms.add(new nr("externalColor",n=>n.externalColor)),s.add("vcolorExt","vec4"),r.code.add(w`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${w.float(yo)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${t.hasMultipassTerrain?w`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),t.output===U.Alpha&&(e.include(ys,t),e.include(uw,t),e.include(Mu,t),i.uniforms.add(new Pe("opacity",n=>n.opacity),new Pe("layerOpacity",n=>n.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new et("tex",n=>n.texture)),i.include(rM),i.code.add(w`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?w`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${t.hasColorTexture?w`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?w`colorUV`:w`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:w`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?w`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:w`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        fragColor = vec4(opacity_);
      }
    `)),t.output===U.Color&&(e.include(ys,t),e.include(Hw,t),e.include(dP,t),e.include(uw,t),e.include(t.instancedDoublePrecision?kU:Gw,t),e.include(Mu,t),Cp(e.fragment,t),Cy(i),pP(i),_C(i),i.uniforms.add(r.uniforms.get("localOrigin"),r.uniforms.get("view"),new zt("ambient",n=>n.ambient),new zt("diffuse",n=>n.diffuse),new Pe("opacity",n=>n.opacity),new Pe("layerOpacity",n=>n.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new et("tex",n=>n.texture)),e.include(gJ,t),e.include(zQ,t),i.include(rM),Sm(i),i.code.add(w`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?w`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${t.hasColorTexture?w`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?w`colorUV`:w`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:w`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${t.pbrMode===lt.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?w`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:w`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.snowCover?w`albedo = mix(albedo, vec3(1), 0.9);`:w``}
        ${w`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${t.pbrMode===lt.Normal||t.pbrMode===lt.Schematic?t.spherical?w`vec3 normalGround = normalize(vpos + localOrigin);`:w`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:w``}
        ${t.pbrMode===lt.Normal||t.pbrMode===lt.Schematic?w`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?w`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:w`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===ut.Color?w`fragColor = premultiplyAlpha(fragColor);`:w``}
      }
    `)),e.include(BAe,t),e}const fut=Object.freeze(Object.defineProperty({__proto__:null,build:put},Symbol.toStringTag,{value:"Module"}));let qAe=class WAe extends YQ{initializeConfiguration(e,r){super.initializeConfiguration(e,r),r.hasMetallicRoughnessTexture=!1,r.hasEmissionTexture=!1,r.hasOcclusionTexture=!1,r.hasNormalTexture=!1,r.hasModelTransformation=!1,r.normalType=Ir.Attribute,r.doubleSidedMode=es.WindingOrder,r.hasVertexTangents=!1}initializeProgram(e){return this._initializeProgram(e,WAe.shader)}};qAe.shader=new Or(fut,()=>ce(()=>import("./RealisticTree.glsl-852cc792.js"),[],import.meta.url));let gm=class extends Av{constructor(e){super(e,yut),this.supportsEdges=!0,this._configuration=new jt,this._vertexBufferLayout=_ut(this.parameters)}isVisibleForOutput(e){return e!==U.Shadow&&e!==U.ShadowExcludeHighlight&&e!==U.ShadowHighlight||this.parameters.castShadows}isVisible(){const e=this.parameters;if(!super.isVisible()||e.layerOpacity===0)return!1;const{hasInstancedColor:r,hasVertexColors:i,hasSymbolColors:s,vvColor:n}=e,o=e.colorMixMode==="replace",a=e.opacity>0,l=e.externalColor&&e.externalColor[3]>0,c=r||n||s;return i&&c?o||a:i?o?l:a:c?o||a:o?l:a}getConfiguration(e,r){return this._configuration.output=e,this._configuration.hasNormalTexture=!!this.parameters.normalTextureId,this._configuration.hasColorTexture=!!this.parameters.textureId,this._configuration.hasVertexTangents=this.parameters.hasVertexTangents,this._configuration.instanced=this.parameters.isInstanced,this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight,this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode,this._configuration.normalType=this.parameters.normalType,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this.parameters.customDepthTest!=null&&(this._configuration.customDepthTest=this.parameters.customDepthTest),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.cullFace=this.parameters.hasSlicePlane?mi.None:this.parameters.cullFace,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.hasModelTransformation=this.parameters.modelTransformation!=null,e!==U.Color&&e!==U.Alpha||(this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this._configuration.doubleSidedMode=es.WindingOrder:this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?es.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?es.WindingOrder:es.None,this._configuration.instancedColor=this.parameters.hasInstancedColor,this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=!!r.ssaoHelper.active&&this.parameters.receiveSSAO,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?lt.Schematic:lt.Normal:lt.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<OU,this._configuration.snowCover=this.hasSnowCover(r),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix),this._configuration}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}intersect(e,r,i,s,n,o){if(this.parameters.verticalOffset!=null){const a=i.camera;se(Xk,r[12],r[13],r[14]);let l=null;switch(i.viewingMode){case Ue.Global:l=ye(dle,Xk);break;case Ue.Local:l=re(dle,wut)}let c=0;const h=de(xut,Xk,a.eye),p=Oe(h),f=ie(h,h,1/p);let m=null;this.parameters.screenSizePerspective&&(m=fe(l,f)),c+=q2e(a,p,this.parameters.verticalOffset,m??0,this.parameters.screenSizePerspective),ie(l,l,c),wc(Wk,l,i.transform.inverseRotation),s=de(vut,s,Wk),n=de(but,n,Wk)}B2e(e,i,s,n,dq(i.verticalOffset),o)}requiresSlot(e,r){return r===U.Color||r===U.Alpha||r===U.Depth||r===U.Normal||r===U.Shadow||r===U.ShadowHighlight||r===U.ShadowExcludeHighlight||r===U.Highlight||r===U.ObjectAndLayerIdColor?e===(this.parameters.transparent?this.parameters.writeDepth?he.TRANSPARENT_MATERIAL:he.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:he.OPAQUE_MATERIAL)||e===he.DRAPED_MATERIAL:!1}createGLMaterial(e){return new mut(e)}createBufferWriter(){return new yC(this._vertexBufferLayout)}},mut=class extends mJ{constructor(e){super({...e,...e.material.parameters})}_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:e.shadowMap.enabled})}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==U.Color&&this._output!==U.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e));const r=this._material.parameters;this.updateTexture(r.textureId);const i=e.camera.viewInverseTransposeMatrix;return se(r.origin,i[3],i[7],i[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(r.treeRendering?qAe:YQ,e)}},gut=class extends uut{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}};const yut=new gut;function _ut(t){const e=Hi().vec3f(C.POSITION);return t.normalType===Ir.Compressed?e.vec2i16(C.NORMALCOMPRESSED,{glNormalized:!0}):e.vec3f(C.NORMAL),t.hasVertexTangents&&e.vec4f(C.TANGENT),(t.textureId||t.normalTextureId||t.metallicRoughnessTextureId||t.emissiveTextureId||t.occlusionTextureId)&&e.vec2f(C.UV0),t.hasVertexColors&&e.vec4u8(C.COLOR),t.hasSymbolColors&&e.vec4u8(C.SYMBOLCOLOR),oe("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(C.OBJECTANDLAYERIDCOLOR),e}const vut=O(),but=O(),wut=Me(0,0,1),dle=O(),Wk=O(),Xk=O(),xut=O(),Tut=["polygon","extent"];let Sut=class extends Am{constructor(e,r,i,s){super(e,r,i,s),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const a=PU(this._getSymbolSize());if(a)throw new V("graphics3dextrudesymbollayer:invalid-size",a)}const e=this.symbolLayer?.material?.color,r=this._getCombinedOpacityAndColor(e),i=Wa(r),s=r[3],n=s<1||this.needsDrivenTransparentPass,o={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:i,ambient:i,opacity:s,transparent:n,cullFace:n?mi.None:mi.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0,normalType:Ir.Compressed};this._material=new gm(o),this._bottomMaterial=new gm({...o,cullFace:mi.Back}),this._context.stage.add(this._material),this._context.stage.add(this._bottomMaterial)}destroy(){super.destroy(),this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,Tut,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(e.renderingInfo,255),s=this.setGraphicElevationContext(r,new Pp);return this._createAs3DShape(r,e.renderingInfo,i,s,r.uid)}layerOpacityChanged(e,r){const i=this.symbolLayer?.material?.color,s=this._getCombinedOpacity(i),n=s<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:s,transparent:n}),this._bottomMaterial.setParameters({opacity:s,transparent:n});const o=this._getLayerOpacity();e.forEach(a=>{const l=r(a);l?.layerOpacityChanged(o,this._context.isAsync)})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,pv)}slicePlaneEnabledChanged(e,r){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._bottomMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),e.forEach(i=>{const s=r(i);s?.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}_getExtrusionSize(e){let r;return r=e.size&&this._drivenProperties.size?elt(e.size,2)??0:this._getSymbolSize(),r/=this._context.renderCoordsHelper.unitInMeters,r}applyRendererDiff(e,r){return this._drivenPropertiesChanged(r)?Ns.RecreateSymbol:Ns.RecreateGraphics}async queryForSnapping(e,r,i,s){const n=this._getExtrusionSize(i)*this._context.renderCoordsHelper.unitInMeters/vR(r),{objectId:o,target:a}=e,l=K(a);switch(l.z=(l.z??0)+n,e.type){case"edge":{const{start:c,end:h}=e,p=K(c),f=K(h);return p.z=(p.z??0)+n,f.z=(f.z??0)+n,[Mae(o,l,1/0,p,f)]}case"vertex":return[Jat(o,l,1/0),Mae(o,a,1/0,a,l)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(e,r,i,s,n){const o=eM(e.geometry);if(o==null)return null;if(o.rings.length===0||!o.rings.some(M=>M.length>0))return this._logGeometryValidationWarnings(o.rings,"rings","ExtrudeSymbol3DLayer"),null;const a=WQ(o,this._context.elevationProvider,this._context.renderCoordsHelper,s);this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer");const l=_Q(o);if(l==null)return null;const c=new Array,h=new Array,p=pn(),f=be(),m=O(),y=this._context.renderCoordsHelper.viewingMode===Ue.Global;y||this._context.renderCoordsHelper.worldUpAtPosition(null,m),Pl(o.spatialReference,[l.x,l.y,0],f,this._context.renderCoordsHelper.spatialReference);const _=be();Mn(_,f);const v=Ui();rv(v,_);const{polygons:b,mapPositions:T,position:x}=a;for(const M of b){const D=M.count;if(this._context.clippingExtent&&(Si(p),gu(p,M.mapPositions),!np(p,this._context.clippingExtent)))continue;const k=AE(M.mapPositions,M.holeIndices,3);if(k.length===0)continue;const $=k.length,N=6*D,H=cF(N+$),Z=cF($),G=Ho(3*N),J=Ho(3*N),I=Ho(3*N),z=Ho(N);Eut(x,T,k,M,G,I,J,z,H,Z,this._getExtrusionSize(r),m,y),OE(G,G,_);const F=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:this._context.layer.uid}),j=new Mut(G,I,Yct(J),z);c.push(ple(this._material,H,H.length-Z.length,j,i,F),ple(this._bottomMaterial,Z,0,j,i,F)),h.push(j.heights)}if(c.length===0)return null;const S=new Ny({geometries:c,layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0});S.transformation=f;const E=Pbe(this.symbolLayer,{opacity:this._getLayerOpacity()}),A=E!=null?{baseMaterial:this._material,edgeMaterials:[E],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,R=new Cm(this,S,c,null,null,(M,D,k,$,N)=>Out(M,D,k,$,N,h),s,A);return R.alignedSampledElevation=a.sampledElevation,R.needsElevationUpdates=pv(s.mode),R}};function ple(t,e,r,i,s,n){const o=uC(e.length),a=[[C.POSITION,new He(i.positions,3,!0)],[C.NORMALCOMPRESSED,new He(i.normals,2,!0)],[C.COLOR,new He(s,4,!0)]],l=[[C.POSITION,e],[C.NORMALCOMPRESSED,e],[C.COLOR,o]];return new Ys(t,a,l,i.elevation,ls.Mesh,n,r)}function Eut(t,e,r,i,s,n,o,a,l,c,h,p,f){const m=r.length/3;let y=0,_=2*i.count;Cut(t,e,i.index,i.count,r,0,m,s,n,o,a,l,c,_,h,p,f);let v=2*i.count;_=0,fle(s,n,a,o,y,i.pathLengths[0],i.count,v,l,_,h),v+=4*i.pathLengths[0],_+=2*i.pathLengths[0],y+=i.pathLengths[0];for(let b=1;b<i.pathLengths.length;++b)fle(s,n,a,o,y,i.pathLengths[b],i.count,v,l,_,h),v+=4*i.pathLengths[b],_+=2*i.pathLengths[b],y+=i.pathLengths[b]}function Cut(t,e,r,i,s,n,o,a,l,c,h,p,f,m,y,_,v){re(pl,_);const b=y>0?1:-1;let T=3*r,x=0,S=3*x,E=i,A=3*E;for(let D=0;D<i;++D)v&&(pl[0]=t[T],pl[1]=t[T+1],pl[2]=t[T+2],ye(pl,pl)),a[S]=t[T],a[S+1]=t[T+1],a[S+2]=t[T+2],l[S]=e[T],l[S+1]=e[T+1],l[S+2]=e[T+2],c[S]=-b*pl[0],c[S+1]=-b*pl[1],c[S+2]=-b*pl[2],h[x]=0,a[A]=t[T]+y*pl[0],a[A+1]=t[T+1]+y*pl[1],a[A+2]=t[T+2]+y*pl[2],l[A]=e[T],l[A+1]=e[T+1],l[A+2]=e[T+2],c[A]=b*pl[0],c[A+1]=b*pl[1],c[A+2]=b*pl[2],h[E]=y,S+=3,A+=3,T+=3,x+=1,E+=1;T=3*n,S=0,A=3*m;const R=y<0?ble:vle,M=y<0?vle:ble;for(let D=0;D<o;++D)f[S]=s[T+R[0]],f[S+1]=s[T+R[1]],f[S+2]=s[T+R[2]],p[A]=s[T+M[0]]+i,p[A+1]=s[T+M[1]]+i,p[A+2]=s[T+M[2]]+i,S+=3,A+=3,T+=3}function N$(t,e,r,i,s,n,o){i[n]=i[o],o*=3,t[n*=3]=t[o],t[n+1]=t[o+1],t[n+2]=t[o+2],e[n]=e[o],e[n+1]=e[o+1],e[n+2]=e[o+2],r[n]=s[0],r[n+1]=s[1],r[n+2]=s[2]}const lA=O();function fle(t,e,r,i,s,n,o,a,l,c,h){let p=s,f=s+1,m=s+o,y=s+o+1,_=a,v=a+1,b=a+2*n,T=a+2*n+1;h<0&&(p=s+o+1,y=s),c*=3;for(let x=0;x<n;++x)x===n-1&&(h>0?(f=s,y=s+o):(f=s,p=s+o)),Aut(t,p,f,m,lA),N$(t,e,i,r,lA,_,p),N$(t,e,i,r,lA,v,f),N$(t,e,i,r,lA,b,m),N$(t,e,i,r,lA,T,y),l[c++]=_,l[c++]=b,l[c++]=T,l[c++]=_,l[c++]=T,l[c++]=v,p++,f++,m++,y++,_+=2,v+=2,b+=2,T+=2}const Zk=O(),mle=O(),gle=O(),yle=O(),_le=O();function Aut(t,e,r,i,s){e*=3,r*=3,i*=3,se(Zk,t[e++],t[e++],t[e++]),se(mle,t[r++],t[r++],t[r++]),se(gle,t[i++],t[i++],t[i++]),de(yle,mle,Zk),de(_le,gle,Zk),ht(s,_le,yle),ye(s,s)}const aT=O();function Out(t,e,r,i,s,n){const o=t.stageObject,a=o.geometries,l=a.length,c=e.mode!=="absolute-height";let h=0;const p=o.transformation,f=rC(be(),p);for(let m=0;m<l;m+=2){const y=a[m];if(!bQ(y))continue;const _=y.getMutableAttribute(C.POSITION).data,v=n[m/2],b=new JJ(y.mapPositions),T=_.length/3;let x=0,S=!1,E=0;for(let A=0;A<T;A++){aT[0]=_[x],aT[1]=_[x+1],aT[2]=_[x+2],i(b,F$),c&&(E+=F$.sampledElevation),ai.TESTS_DISABLE_OPTIMIZATIONS?(se(jl,b.array[b.offset],b.array[b.offset+1],F$.z+v[x/3]),r!=null&&s.toRenderCoords(jl,r,jl),Fe(jl,jl,f)):(se(jl,_[x],_[x+1],_[x+2]),Fe(jl,jl,p),s.setAltitude(jl,F$.z+v[x/3]),Fe(jl,jl,f)),_[x]=jl[0],_[x+1]=jl[1],_[x+2]=jl[2];const R=Rut/s.unitInMeters;(Math.abs(aT[0]-_[x])>=R||Math.abs(aT[1]-_[x+1])>=R||Math.abs(aT[2]-_[x+2])>=R)&&(S=!0),b.offset+=3,x+=3}S&&(y.invalidateBoundingInfo(),o.geometryVertexAttrsUpdated(a[m]),a[m+1].invalidateBoundingInfo(),o.geometryVertexAttrsUpdated(a[m+1])),h+=E/T}return h/l}const jl=O(),pl=O(),F$=new aP,vle=[0,2,1],ble=[0,1,2],Rut=.01;let Mut=class{constructor(e,r,i,s){this.positions=e,this.elevation=r,this.normals=i,this.heights=s}};function Put(t){return typeof t=="function"}function xkt(t,e,r,i){return Put(t)?t(e,r,i):t}function Tkt(t){return[t.r,t.g,t.b,t.a]}const Iut=` /-,
`;function wle(t){let e=t.length;for(;e--;)if(!Iut.includes(t.charAt(e)))return!1;return!0}function $ut(t,e){const r=[];let i=0,s=-1;do if(s=t.indexOf("[",i),s>=i){if(s>i){const n=t.substr(i,s-i);r.push([n,null,wle(n)])}if(i=s+1,s=t.indexOf("]",i),s>=i){if(s>i){const n=e[t.substr(i,s-i)];n&&r.push([null,n,!1])}i=s+1}}while(s!==-1);if(i<t.length-1){const n=t.substr(i);r.push([n,null,wle(n)])}return r}function Lut(t,e,r){let i="",s=null;for(const n of e){const[o,a,l]=n;if(o)l?s=o:(s&&(i+=s,s=null),i+=o);else{const c=t.attributes[a];c&&(s&&(i+=s,s=null),i+=c)}}return Dut(i,r)}function Skt(t,e,r){const i=$ut(e,t);return s=>Lut(s,i,r)}function Dut(t,e){switch(typeof t!="string"&&(t=String(t)),e){case"LowerCase":return t.toLowerCase();case"Allcaps":return t.toUpperCase();default:return t}}function Ekt(t,e,r,i,s,n,o=!0){const a=e/s,l=r/n,c=Math.ceil(a/2),h=Math.ceil(l/2);for(let p=0;p<n;p++)for(let f=0;f<s;f++){const m=4*(f+(o?n-p-1:p)*s);let y=0,_=0,v=0,b=0,T=0,x=0,S=0;const E=(p+.5)*l;for(let A=Math.floor(p*l);A<(p+1)*l;A++){const R=Math.abs(E-(A+.5))/h,M=(f+.5)*a,D=R*R;for(let k=Math.floor(f*a);k<(f+1)*a;k++){let $=Math.abs(M-(k+.5))/c;const N=Math.sqrt(D+$*$);N>=-1&&N<=1&&(y=2*N*N*N-3*N*N+1,y>0&&($=4*(k+A*e),S+=y*t[$+3],v+=y,t[$+3]<255&&(y=y*t[$+3]/250),b+=y*t[$],T+=y*t[$+1],x+=y*t[$+2],_+=y))}}i[m]=b/_,i[m+1]=T/_,i[m+2]=x/_,i[m+3]=S/v}}function XAe(t){return t?{r:t[0],g:t[1],b:t[2],a:t[3]/255}:{r:0,g:0,b:0,a:0}}function Nut(t){return t.data?.symbol??null}function Fut(t){return t.type==="CIMVectorMarker"||t.type==="CIMPictureMarker"||t.type==="CIMBarChartMarker"||t.type==="CIMCharacterMarker"||t.type==="CIMPieChartMarker"||t.type==="CIMStackedBarChartMarker"}function Uut(t){return t.type==="CIMGradientStroke"||t.type==="CIMPictureStroke"||t.type==="CIMSolidStroke"}function ZAe(t){return t!=null&&(t.type==="CIMMarkerPlacementAlongLineRandomSize"||t.type==="CIMMarkerPlacementAlongLineSameSize"||t.type==="CIMMarkerPlacementAlongLineVariableSize"||t.type==="CIMMarkerPlacementAtExtremities"||t.type==="CIMMarkerPlacementAtMeasuredUnits"||t.type==="CIMMarkerPlacementAtRatioPositions"||t.type==="CIMMarkerPlacementOnLine"||t.type==="CIMMarkerPlacementOnVertices")}const Ckt=(t,e=0)=>t==null||isNaN(t)?e:t,Akt=t=>t.tintColor?XAe(t.tintColor):{r:255,g:255,b:255,a:1},Okt=t=>{if(!t)return!1;for(const e of t)switch(e.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1};function Rkt(){return ce(()=>import("./geometryEngineJSON-251d3482.js"),["./geometryEngineJSON-251d3482.js","./geometryEngineBase-c1c9526a.js","./geometryEngineJSON-3dabcf6b.js","./json-48e3ea08.js"],import.meta.url)}function Mkt(t){if(!t)return"normal";switch(t.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}}function Pkt(t){if(!t)return"normal";switch(t.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}}function Ikt(t){let e="normal",r="normal";if(t){const i=t.toLowerCase();i.includes("italic")?e="italic":i.includes("oblique")&&(e="oblique"),i.includes("bold")?r="bold":i.includes("light")&&(r="lighter")}return{style:e,weight:r}}function $kt(t){return t.underline?"underline":t.strikethrough?"line-through":"none"}function xle(t){if(!t)return null;switch(t.type){case"CIMPolygonSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const r=xle(e);if(r!=null)return r}break;case"CIMTextSymbol":return xle(t.symbol);case"CIMSolidFill":return t.color}}function Tle(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const e=t.symbolLayers;if(e)for(const r of e){const i=Tle(r);if(i!=null)return i}break}case"CIMTextSymbol":return Tle(t.symbol);case"CIMSolidStroke":return t.color}}function Sle(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const r=Sle(e);if(r!==void 0)return r}break;case"CIMTextSymbol":return Sle(t.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return t.width}}function Lkt(t){switch(t){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}}function Dkt(t){switch(t){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function Nkt(t){return(t?Object.keys(t):[]).map(e=>({name:e,alias:e,type:typeof t[e]=="string"?"esriFieldTypeString":"esriFieldTypeDouble"}))}const Fkt=t=>t.includes("data:image/svg+xml");function Ukt(t){if(!t)return null;switch(t.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function YAe(t,e,r,i){if(t)if(t.type!=="CIMTextSymbol"){if(r&&t.effects)for(const s of t.effects)Vut(s,e);if(t.symbolLayers)for(const s of t.symbolLayers)switch(s.type){case"CIMPictureMarker":case"CIMVectorMarker":kut(s,e,i);break;case"CIMPictureStroke":case"CIMSolidStroke":!i?.preserveOutlineWidth&&s.width&&(s.width*=e);break;case"CIMPictureFill":s.height&&(s.height*=e),s.offsetX&&(s.offsetX*=e),s.offsetY&&(s.offsetY*=e);break;case"CIMHatchFill":YAe(s.lineSymbol,e,!0,{...i,preserveOutlineWidth:!1}),s.offsetX&&(s.offsetX*=e),s.offsetY&&(s.offsetY*=e),s.separation&&(s.separation*=e)}}else t.height!=null&&(t.height*=e)}function kut(t,e,r){if(t&&(t.markerPlacement&&zut(t.markerPlacement,e),t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.anchorPoint&&t.anchorPointUnits==="Absolute"&&(t.anchorPoint={x:t.anchorPoint.x*e,y:t.anchorPoint.y*e}),t.size=t.size!=null?t.size*e:0,t.type==="CIMVectorMarker"&&t.markerGraphics))for(const i of t.markerGraphics)t.scaleSymbolsProportionally||YAe(i.symbol,e,!0,r)}function zut(t,e){switch(ZAe(t)&&t.offset&&(t.offset*=e),t.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.placementTemplate&&t.placementTemplate.length){const r=t.placementTemplate.map(i=>i*e);t.placementTemplate=r}break;case"CIMMarkerPlacementAlongLineVariableSize":if(t.maxRandomOffset&&(t.maxRandomOffset*=e),t.placementTemplate&&t.placementTemplate.length){const r=t.placementTemplate.map(i=>i*e);t.placementTemplate=r}break;case"CIMMarkerPlacementOnLine":t.startPointOffset&&(t.startPointOffset*=e);break;case"CIMMarkerPlacementAtExtremities":t.offsetAlongLine&&(t.offsetAlongLine*=e);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":t.beginPosition&&(t.beginPosition*=e),t.endPosition&&(t.endPosition*=e);break;case"CIMMarkerPlacementPolygonCenter":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMMarkerPlacementInsidePolygon":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.stepX&&(t.stepX*=e),t.stepY&&(t.stepY*=e)}}function Vut(t,e){switch(t.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":t.width&&(t.width*=e);break;case"CIMGeometricEffectBuffer":t.size&&(t.size*=e);break;case"CIMGeometricEffectCut":t.beginCut&&(t.beginCut*=e),t.endCut&&(t.endCut*=e),t.middleCut&&(t.middleCut*=e);break;case"CIMGeometricEffectDashes":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.dashTemplate&&t.dashTemplate.length){const r=t.dashTemplate.map(i=>i*e);t.dashTemplate=r}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":t.length&&(t.length*=e);break;case"CIMGeometricEffectMove":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":t.offset&&(t.offset*=e);break;case"CIMGeometricEffectRegularPolygon":t.radius&&(t.radius*=e);break;case"CIMGeometricEffectTaperedPolygon":t.fromWidth&&(t.fromWidth*=e),t.length&&(t.length*=e),t.toWidth&&(t.toWidth*=e);break;case"CIMGeometricEffectWave":t.amplitude&&(t.amplitude*=e),t.period&&(t.period*=e)}}function But(t){const e=[];return Gq(Nut(t),e),e.length?new Ne(XAe(e[0])):null}function Gq(t,e){if(!t)return;let r;r=t.type==="CIMTextSymbol"?t.symbol:t;const i=t.type==="CIMPolygonSymbol";if(r?.symbolLayers){for(const s of r.symbolLayers)if(!(s.colorLocked||i&&(Uut(s)||Fut(s)&&s.markerPlacement&&ZAe(s.markerPlacement))))switch(s.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":s.tintColor&&Ele(e,s.tintColor);break;case"CIMVectorMarker":s.markerGraphics?.forEach(n=>{Gq(n.symbol,e)});break;case"CIMSolidStroke":case"CIMSolidFill":Ele(e,s.color);break;case"CIMHatchFill":Gq(s.lineSymbol,e)}}}function Ele(t,e){for(const r of t)if(r.join(".")===e.join("."))return;t.push(e)}new O_e(1e3);new Ne([128,128,128]);const Gut=new Ne("white");function jut(t){return hc(t.resource).href}function kkt(t,e){if(!t)return null;let r=null;return Aw(t)?r=Hut(t):p6(t)&&(r=t.type==="cim"?But(t):t.color?new Ne(t.color):null),r?iM(r,e):null}function Hut(t){const e=t.symbolLayers;if(!e)return null;let r=null;return e.forEach(i=>{i.type==="object"&&i.resource?.href||(r=i.type==="water"?i.color:i.material?i.material.color:null)}),r?new Ne(r):null}function iM(t,e){if(e==null||t==null)return t;const r=t.toRgba();return r[3]=r[3]*e,new Ne(r)}function qut(t,e,r){const i=t.symbolLayers;if(!i)return;const s=n=>iM(e=e??n??(r!=null?Gut:null),r);i.forEach(n=>{if(n.type!=="object"||!n.resource?.href||e)if(n.type==="water")n.color=s(n.color);else{const o=n.material!=null?n.material.color:null,a=s(o);n.material==null?n.material=new bu({color:a}):n.material.color=a,r!=null&&"outline"in n&&n.outline!=null&&n.outline.color!=null&&(n.outline.color=iM(n.outline.color,r))}})}function Wut(t,e,r){(e=e??t.color)&&(t.color=iM(e,r)),r!=null&&"outline"in t&&t.outline&&t.outline.color&&(t.outline.color=iM(t.outline.color,r))}function zkt(t,e,r){t&&(e||r!=null)&&(e&&(e=new Ne(e)),Aw(t)?qut(t,e,r):p6(t)&&Wut(t,e,r))}async function Xut(t,e){const r=t.symbolLayers;r&&await G5(r,async i=>Zut(i,e))}async function Zut(t,e){switch(t.type){case"extrude":Jut(t,e);break;case"icon":case"line":case"text":Yut(t,e);break;case"path":Kut(t,e);break;case"object":await Qut(t,e)}}function Yut(t,e){const r=JAe(e);r!=null&&(t.size=r)}function JAe(t){for(const e of t)if(typeof e=="number")return e;return null}function Jut(t,e){t.size=typeof e[2]=="number"?e[2]:0}async function Qut(t,e){const{resourceSize:r,symbolSize:i}=await eht(t),s=QAe(e,r,i);t.width=QO(e[0],i[0],r[0],s),t.depth=QO(e[1],i[1],r[1],s),t.height=QO(e[2],i[2],r[2],s)}function Kut(t,e){const r=QAe(e,kg,[t.width,void 0,t.height]);t.width=QO(e[0],t.width,1,r),t.height=QO(e[2],t.height,1,r)}function QAe(t,e,r){for(let i=0;i<3;i++){const s=t[i];switch(s){case"symbol-value":{const n=r[i];return n!=null?n/e[i]:1}case"proportional":break;default:if(s&&e[i])return s/e[i]}}return 1}async function eht(t){const{computeObjectLayerResourceSize:e}=await ce(()=>import("./symbolLayerUtils-57f4b89e.js"),[],import.meta.url),r=await e(t,10),{width:i,height:s,depth:n}=t,o=[i,n,s];let a=1;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/r[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=r[l]*a);return{resourceSize:r,symbolSize:o}}function QO(t,e,r,i){switch(t){case"proportional":return r*i;case"symbol-value":return e??r;default:return t}}function tht(t,e){const r=JAe(e);if(r!=null)switch(t.type){case"simple-marker":t.size=r;break;case"picture-marker":{const i=t.width/t.height;i>1?(t.width=r,t.height=r*i):(t.width=r*i,t.height=r);break}case"simple-line":t.width=r;break;case"text":t.font.size=r}}async function Vkt(t,e){if(t&&e)return Aw(t)?Xut(t,e):void(p6(t)&&tht(t,e))}function Bkt(t,e,r){if(t&&e!=null)if(Aw(t)){const i=t.symbolLayers;i&&i.forEach(s=>{if(s&&s.type==="object")switch(r){case"tilt":s.tilt=e;break;case"roll":s.roll=e;break;default:s.heading=e}})}else p6(t)&&(t.type!=="simple-marker"&&t.type!=="picture-marker"&&t.type!=="text"||(t.angle=e))}function Gkt(t){return t!=null&&t.type==="polygon-3d"&&t.symbolLayers.some(e=>e.type==="extrude")}async function jkt(t,e){return await t.fetchSymbol(e)||t.fetchCIMSymbol(e)}function rht(t,e,r,i,s){if(t==null)return null;const n=t.referencesGeometry()&&s?iht(e,i,s):e,o=t.repurposeFeature(n);try{return t.evaluate({...r,$feature:o},t.services)}catch(a){return Q.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}}const Yk=new Map;function iht(t,e,r){const{transform:i,hasZ:s,hasM:n}=r;Yk.has(e)||Yk.set(e,sht(e));const o=Yk.get(e)(t.geometry,i,s,n);return{...t,geometry:o}}function sht(t){const e={};switch(t){case"esriGeometryPoint":return(r,i,s,n)=>BEe(i,e,r,s,n);case"esriGeometryPolygon":return(r,i,s,n)=>GEe(i,e,r,s,n);case"esriGeometryPolyline":return(r,i,s,n)=>jEe(i,e,r,s,n);case"esriGeometryMultipoint":return(r,i,s,n)=>VEe(i,e,r,s,n);default:return Q.getLogger("esri.views.2d.support.arcadeOnDemand").error(new V("mapview-arcade",`Unable to handle geometryType: ${t}`)),r=>r}}const Hkt=1.2,nht=Wf;let BU=class{constructor(e,r,i,s){this.graphics3DSymbolLayer=e,this.renderGeometries=r,this.boundingBox=i,this._drapeSourceRenderer=s,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(e){this.stage=e.stage}setVisibility(e){if(this.stage!=null&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,Xi.ADD);if(e||this._addedToStage){for(const r of this.renderGeometries)r.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Sn.VISIBILITY)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,Xi.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(e=O()){return se(e,0,0,0)}getBoundingBoxObjectSpace(e=pn()){return Si(e)}addObjectState(e,r){e===my.Highlight&&(this.renderGeometries.forEach(i=>{const s=i.geometry.addHighlight();r.addRenderGeometry(i,s,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Sn.HIGHLIGHT))}removeObjectState(e){this.renderGeometries.forEach(r=>{e.removeRenderGeometry(r)})}removeRenderGeometryObjectState(e,r){e.geometry.removeHighlight(r),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Sn.HIGHLIGHT)}computeAttachmentOrigin(e){for(const r of this.renderGeometries)r.geometry.computeAttachmentOrigin(lT)&&(e.draped.origin[0]+=lT[0],e.draped.origin[1]+=lT[1],e.draped.num++)}async getProjectedBoundingBox(e,r,i,s,n){Si(n);for(let o=0;o<this.renderGeometries.length;o++){const a=this.renderGeometries[o];this._getRenderGeometryProjectedBoundingRect(a,e,Cle,i),O8e(n,Cle)}if(r){let o;sp(n,lT);const a=vQ(n,r.service.spatialReference,r);try{o=await r.service.queryElevation(lT[0],lT[1],s,a,"ground")}catch{}o!=null&&(n[2]=Math.min(n[2],o),n[5]=Math.max(n[5],o))}return n}_getRenderGeometryProjectedBoundingRect(e,r,i,s){if(this.boundingBox)c6(qp,this.boundingBox);else{const n=e.boundingSphere,o=n[3];qp[0]=n[0]-o,qp[1]=n[1]-o,qp[2]=n[2]-o,qp[3]=n[0]+o,qp[4]=n[1]+o,qp[5]=n[2]+o}return r(qp,0,2),this.calculateRelativeScreenBounds&&s.push({location:sp(qp),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),IZ(qp,i)}};const Cle=Vt(),qp=pn(),lT=O();let KAe=class{constructor(e,r,i,s=2048){this.text=e,this._alignment=r,this._parameters=i,this._maxSize=s,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${e}`,this._lines=e.split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._backgroundHorizontalPadding)}get displayHeight(){const e=this._lineSpacing*(this._lines.length-1),r=this._lineHeight;return Math.ceil(e+r+2*this._haloSize+this._backgroundTopPadding+this._backgroundBottomPadding)}get renderedWidth(){return Math.ceil(this._toRenderUnit(this.displayWidth))}get renderedHeight(){return Math.ceil(this._toRenderUnit(this.displayHeight))}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._baselinePosition)}get _firstLineYOffset(){return this._backgroundTopPadding+this._haloSize}get _metrics(){if(this._metricsCached==null){const e=jq(Ale,U$,U$).getContext("2d");this._setFontProperties(e,this._fontSize);let r=2*this._haloSize;const i=this._parameters.definition.font;i.style!=="italic"&&i.style!=="oblique"&&i.weight!=="bold"&&i.weight!=="bolder"||(r+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let s,n,o=0,a=0,l=0;this._lines.forEach((y,_)=>{const v=e.measureText(y),b=v.width,T=b+r;this._textWidths.push(b),this._lineWidths.push(T),o=Math.max(o,T),a=Math.max(a,v.actualBoundingBoxAscent),l=Math.max(l,v.actualBoundingBoxDescent),_===0&&(s=v),_===this._lines.length-1&&(n=v)});const c=e.font;let h=Rle.get(c);if(!h){const y=e.measureText(aht);h=new cht(y.actualBoundingBoxAscent,y.actualBoundingBoxDescent),Rle.set(c,h)}a=Math.max(a,h.actualBoundingBoxAscent),l=Math.max(l,h.actualBoundingBoxDescent);const p=a+l,f=this._hasBackground?s.actualBoundingBoxAscent:a,m=this._hasBackground?n.actualBoundingBoxDescent:l;this._metricsCached=new lht(a-f,l-m,p,o,a)}return this._metricsCached}get _lineSpacing(){return(this._lineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _lineHeight(){return this._metrics.lineHeight}get _linePadding(){return this._lineHeight*oht}get _baselinePosition(){return this._metrics.baselinePosition}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _backgroundHorizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _backgroundVerticalPadding(){return this._hasBackground?this._parameters.definition.background.padding[1]:0}get _backgroundTopPadding(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingTop)}get _backgroundBottomPadding(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingBottom)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(this._renderPixelRatio==null){const e=this._parameters.definition.pixelRatio;this._maxSize>0?this._renderPixelRatio=Math.min(e,Math.min(this._maxSize/this.displayWidth,this._maxSize/this.displayHeight)):this._renderPixelRatio=e}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case q_.Left:return this._backgroundHorizontalPadding;case q_.Center:return(this.displayWidth-this._lineWidths[e])/2;case q_.Right:return this.displayWidth-this._backgroundHorizontalPadding-this._lineWidths[e]}}render(e,r=0,i=0){e.save();const s=r/=this.renderPixelRatio,n=i/=this.renderPixelRatio,o=this._haloSize,a=this._firstLineYOffset;r+=o,i+=a+this._baselinePosition;const l=this._haloSize>0;l&&this._renderHalo(e,s,n,o,a),this._setFontProperties(e,this._renderedFontSize);for(let c=0;c<this._lines.length;++c){const h=this._lines[c],p=this._getLineXOffset(c);l&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,h,r+p,i),this._renderLineDecoration(e,r+p,i,this._textWidths[c])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,h,r+this._getLineXOffset(c),i),this._renderLineDecoration(e,r+p,i,this._textWidths[c]),i+=this._lineSpacing}if(ai.TEXT_SHOW_BASELINE){e.strokeStyle=Ole,e.setLineDash([2,2]),e.lineWidth=1;let c=n+a;for(let h=0;h<this._lines.length;++h){const p=c+this._baselinePosition;this._drawLine(e,[s,p],[s+this.displayWidth,p]),c+=this._lineSpacing}}if(ai.TEXT_SHOW_BORDER&&(e.strokeStyle=Ole,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[s,n],[this.displayWidth,this.displayHeight])),this._hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,s,n,c),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,r,i,s,n=!1){if(this._parameters.definition.font.decoration==="none"||s===0)return;const o=1,a=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":i+=2*a;break;case"line-through":i-=.33*this._baselinePosition}const l=n?this._haloSize:0;e.strokeStyle=n?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(a+2*l),e.beginPath(),e.moveTo(this._toRenderUnit(r-l),this._toRenderUnit(i)),e.lineTo(this._toRenderUnit(r+s+l),this._toRenderUnit(i)),e.stroke()}_roundedRect(e,r,i,s){r=this._toRenderUnit(r),i=this._toRenderUnit(i);const n=this.renderedWidth,o=this.renderedHeight;s!==0?(s=ve(s,0,Math.floor(o/2)),e.beginPath(),e.moveTo(r,i+s),e.arcTo(r,i,r+s,i,s),e.lineTo(r+n-s,i),e.arcTo(r+n,i,r+n,i+s,s),e.lineTo(r+n,i+o-s),e.arcTo(r+n,i+o,r+n-s,i+o,s),e.lineTo(r+s,i+o),e.arcTo(r,i+o,r,i+o-s,s),e.closePath()):e.rect(r,i,n,o)}_renderHalo(e,r,i,s,n){const o=this.renderedWidth,a=this.renderedHeight,l=jq(Ale,Math.max(o,U$),Math.max(a,U$)),c=l.getContext("2d");c.clearRect(0,0,o,a),this._setFontProperties(c,this._renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const h=this._renderedHaloSize<3;c.lineJoin=h?"miter":"round",h?this._renderHaloEmulated(c,s,n):this._renderHaloNative(c,s,n);let p=n+this._baselinePosition;for(let f=0;f<this._lines.length;++f){const m=this._getLineXOffset(f);this._renderLineDecoration(c,s+m,p,this._textWidths[f],!0),p+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(l,0,0,o,a,this._toRenderUnit(r),this._toRenderUnit(i),o,a),e.globalAlpha=1}_renderHaloEmulated(e,r,i){i+=this._baselinePosition;for(let s=0;s<this._lines.length;++s){const n=this._lines[s],o=this._getLineXOffset(s);for(const[a,l]of e3e)this._fillText(e,n,r+o+this._haloSize*a,i+this._haloSize*l);i+=this._lineSpacing}}_renderHaloNative(e,r,i){const s=2*this._haloSize;i+=this._baselinePosition;for(let n=0;n<this._lines.length;++n){const o=this._lines[n],a=this._getLineXOffset(n),l=5,c=.1;for(let h=0;h<l;h++){const p=1-(l-1)*c+h*c;e.lineWidth=this._toRenderUnit(p*s),this._strokeText(e,o,r+a,i)}i+=this._lineSpacing}}_setFontProperties(e,r){e.font=this._parameters.fontString(r),e.textAlign="left",e.textBaseline="alphabetic"}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,r,i,s){e.fillText(r,this._toRenderUnit(i),this._toRenderUnit(s))}_strokeText(e,r,i,s){e.strokeText(r,this._toRenderUnit(i),this._toRenderUnit(s))}_drawLine(e,r,i){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),e.lineTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),e.stroke()}_drawBox(e,r,i){const s=this._toRenderUnit(r[0]),n=this._toRenderUnit(r[1]),o=this._toRenderUnit(i[0]),a=this._toRenderUnit(i[1]),l=Math.floor(s)+.5,c=Math.ceil(s+o)-.5,h=Math.floor(n)+.5,p=Math.ceil(n+a)-.5;e.beginPath(),e.moveTo(l,h),e.lineTo(c,h),e.lineTo(c,p),e.lineTo(l,p),e.lineTo(l,h),e.stroke()}};const e3e=[];for(let e=0;e<360;e+=360/16)e3e.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);var q_;function jq(t,e,r){return t.canvas||(t.canvas=document.createElement("canvas")),t.canvas.width=e,t.canvas.height=r,t.canvas}(function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"})(q_||(q_={}));const Ale={canvas:null},oht=.2,U$=512,Ole="rgb(255, 0, 255, 0.5)",aht=(()=>{let t="";for(let e=32;e<127;e++)t+=String.fromCharCode(e);return t})();let lht=class{constructor(e,r,i,s,n){this.paddingTop=e,this.paddingBottom=r,this.lineHeight=i,this.displayWidth=s,this.baselinePosition=n}},cht=class{constructor(e,r){this.actualBoundingBoxAscent=e,this.actualBoundingBoxDescent=r}};const Rle=new Map,uht=Object.freeze({left:0,center:.5,right:1}),yN=Object.freeze({"bottom-left":fr(0,0),bottom:fr(.5,0),"bottom-right":fr(1,0),left:fr(0,.5),center:fr(.5,.5),right:fr(1,.5),"top-left":fr(0,1),top:fr(.5,1),"top-right":fr(1,1)});function t3e(t){switch(t){case"left":return q_.Left;case"right":return q_.Right;default:return q_.Center}}function Mle(t){switch(t){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function hht(t){switch(t){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function dht(t,e){switch(e){case"bottom":return t==="left"?"bottom-left":t==="right"?"bottom-right":"bottom";case"center":return t;case"top":return t==="left"?"top-left":t==="right"?"top-right":"top"}}function pht(t){return t==="middle"?"center":t}let ME=class{constructor(e,r={}){this.geometry=e,this.screenToWorldRatio=1,this._transformation=be(),this._shaderTransformation=null,this._boundingSphere=null,this.id=Cc(),this.layerUid=r.layerUid,this.graphicUid=r.graphicUid,this.shaderTransformer=r.shaderTransformer,this.castShadow=r.castShadow??!1}get transformation(){return this._transformation}get boundingInfo(){return this.geometry.boundingInfo}updateTransformation(e){e(this._transformation),this._shaderTransformation=this._boundingSphere=null}shaderTransformationChanged(){this._shaderTransformation=null}get boundingSphere(){return this._boundingSphere?this._boundingSphere:this.boundingInfo?(this._boundingSphere=Fe(bs(),this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*lE(this.shaderTransformation),this._boundingSphere):Ybe}get hasShaderTransformation(){return this.shaderTransformer!=null}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this.shaderTransformer==null?this.transformation:(this._shaderTransformation||(this._shaderTransformation=Us(be(),this.shaderTransformer(this.transformation))),this._shaderTransformation)}get indices(){return this.geometry.indices}get vertexAttributes(){return this.geometry.vertexAttributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}};const fht=be(),Ple=Me(0,0,1),mht=16,ght=1.5,qb=fQ,yht=[qb/2,qb/2,1-qb/2,1-qb/2],_ht=[JR*qb,JR*qb];let Hq=class r3e extends Am{getCachedSize(){return{size:this._getIconSize()}}constructor(e,r,i,s){super(e,r,i,s),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}async doLoad(e){this._validateOrThrow();const r=this._prepareMaterialParameters(),i=this._getPrimitive();if(i!=null)this._prepareResourcesPrimitive(r,i);else{const s=jut(this.symbolLayer),n=yw(s);n&&n.mediaType==="application/json"?await this._prepareResourcesCIM(r,JSON.parse(n.data),e):await this._prepareResourcesHref(r,s,e)}}_validateOrThrow(){if(this._drivenProperties.size)return;const e=PU(this._getIconSize());if(e)throw new V("graphics3diconsymbollayer:invalid-size",e)}_getIconSize(){const e=this.symbolLayer,r=Math.round(e.size!=null?_o(e.size):mht);return this._drivenProperties.size?Math.max(r,64):r}_generateTextureCIM(e){const r=this._getGraphicHash(e);let i=r===""?null:this._cimSymbolTextures.get(r);if(!i){const s={scaleFactor:this._cimScaleFactorOrFunction},n=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol3D(this._cimLayers,e,"esriGeometryPoint",s,void 0,void 0);this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",n.anchorPosition);const o={width:n.imageData.width,height:n.imageData.height};i=new _x(n.imageData,o),this._cimSymbolTextures.set(r,i),this._context.stage.add(i)}return i}_prepareMaterialParameters(){const e={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},r=this.symbol;if(vht(r)){const{screenLength:i,minWorldLength:s,maxWorldLength:n}=r.verticalOffset;e.verticalOffset={screenLength:_o(i),minWorldLength:s||0,maxWorldLength:n??1/0}}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e.occlusionTest=!0,e.hasSlicePlane=this._context.slicePlaneEnabled,e}_prepareResourcesPrimitive(e,r){const i=this._getOutlineSize();if(Jk(r)&&i===0)throw new Error("Nothing to render");if(this._outlineSize=i,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,this._context.sharedResources.textures!=null){const n=this._context.sharedResources.textures.fromData(`${r}-icon`,()=>lnt(r));this._texture=n.texture,this._releaseTexture=n,e.textureId=this._texture.id}e.textureIsSignedDistanceField=!0,e.distanceFieldBoundingBox=yht;const s=this._getIconSize();this._size=[s,s],this._symbolTextureRatio=1/qb,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesHref(e,r,i){this._outlineSize=this._getOutlineSize(),e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,e.textureIsSignedDistanceField=!1;const s=this._getIconSize(),n=s*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;if(this._context.sharedResources.textures!=null){const o=await Eu(this._context.sharedResources.textures.fromUrl(r,n,{signal:i}));if(o.ok===!1)throw Fo(o.error),new V("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${r})`);this._releaseTexture=o.value;const a=o.value.texture,l=a.parameters.width/a.parameters.height;this._size=l>1?[s,Math.round(s/l)]:[Math.round(s*l),s],e.textureId=a.id}this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesCIM(e,r,i){const s=new JE({data:r});if(!this._context.sharedResources.cimSymbolRasterizer){const h=(await ce(()=>import("./CIMSymbolRasterizer-621325c3.js"),["./CIMSymbolRasterizer-621325c3.js","./cimAnalyzer-a00db7d9.js","./TileClipper-ae6eca9e.js","./definitions-128afd1b.js","./number-e491b09e.js","./BidiEngine-9a40f2f4.js","./imageutils-48a8726f.js","./rasterizingUtils-148c6894.js"],import.meta.url)).CIMSymbolRasterizer;Yt(i),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new h(this._context.renderCoordsHelper.spatialReference,!0))}const n=this._context.layer.fields?this._context.layer.fields.map(h=>h.toJSON()):null;let o,a;if(this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol3D(s,n,this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:i}),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const h=this._context.renderer;if(isNaN(h.scaleExpression)){const p=h.scaleExpression,f=await i5e(p,this._context.layer.spatialReference,n);a=(m,y,_)=>{const v=rht(f,m,{$view:_},"esriGeometryPoint",y);return v!==null?v:1}}else o=Number(h.scaleExpression)}this._cimScaleFactorOrFunction=o||a||1;const l=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];Yt(i);const c=this._context.layer.fieldsIndex;this._cimRequiredFields=l.map(h=>c.get(h).name),this._cimMaterialParametersInfo=e,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||W8e}_getOutlineSize(){let e=0;const r=this.symbolLayer;return r.outline!=null&&r.outline.size!=null?Math.max(_o(r.outline.size),0):(e=Jk(this._getPrimitive())?ght:0,Math.max(e,0))}_getOutlineColor(){const e=this._getLayerOpacity(),r=this.symbolLayer,i=r?.outline?.color;if(i!=null){const s=Ne.toUnitRGB(i),n=i.a*e;return[s[0],s[1],s[2],n]}return[0,0,0,0]}_getFillColor(){if(Jk(this._getPrimitive()))return nht;const e=this._getPrimitive()==null,r=this.symbolLayer?.material?.color;return this._getCombinedOpacityAndColor(r,{hasIntrinsicColor:e})}_getAnchorPos(e,r){return e==="relative"?fr((r.x||0)+.5,.5-(r.y||0)):e in yN?yN[e]:yN.center}_createMaterialAndAddToStage(e,r){if(this._cimLayers){this._fastUpdates=null;let i=e.textureId?this._cimSymbolMaterials.get(e.textureId):null;return i||(i=new EE(e),this._cimSymbolMaterials.set(e.textureId??0,i),r.add(i)),i}return this._fastUpdates=TE(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates&&(e={...e,...this._fastUpdates.materialParameters}),this._material=new EE(e),r.add(this._material),this._material}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(e=>{e.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._material=null,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(e=>this._context.stage.remove(e)),this._cimSymbolTextures.clear(),this._releaseTexture=Bi(this._releaseTexture)}_getScaleFactor(e,r){if(this._drivenProperties.size&&e.size){for(let i=0;i<3;i++){const s=e.size[i];s&&s!=="symbol-value"&&s!=="proportional"&&(e.size[i]=_o(s))}if(e.size[0]==="symbol-value")return 1;if(isFinite(+e.size[0]))return+e.size[0]/r;if(isFinite(+e.size[2]))return+e.size[2]/r}return 1}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry))return null;let i,s=[0,0];if(this._cimLayers){if(!this._cimLayers.length)return null;const p=this._generateTextureCIM(r),f={textureId:p.id,...this._cimMaterialParametersInfo};i=this._createMaterialAndAddToStage(f,this._context.stage),s=[p.parameters.width,p.parameters.height]}else s=this._size,i=this._material;const n=KR(r.geometry);if(n==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${r.geometry.type}`),null;const o=e.renderingInfo,a=this._getVertexOpacityAndColor(o);let l=1;if(!this._fastUpdates?.visualVariables.size){const p=s[0]>s[1]?s[0]:s[1];l=this._getScaleFactor(o,p)}l*=this._symbolTextureRatio;const c=fr(s[0]*l,s[1]*l),h=this.setGraphicElevationContext(r,new Pp);return this.ensureDrapedStatus(h.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(r,n,i,a,c,e.layer.uid):this._createAs3DShape(r,n,i,a,c,h,r.uid)}layerOpacityChanged(){const e=this._getFillColor(),r=this._getOutlineColor();this._forEachMaterial(i=>{i.setParameters({color:e}),i.setParameters({outlineColor:r})})}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=oP(r3e.elevationModeChangeTypes,i,s);if(n!==cs.UPDATE)return n;const o=Wh(s)||s==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(e=>{e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return this._getPrimitive()!=null}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables"||!SE(this._fastUpdates,r,this._fastVisualVariableConvertOptions()))return Ns.RecreateSymbol;this._material!=null&&this._material.setParameters(this._fastUpdates.materialParameters)}return Ns.FastUpdate}_defaultElevationInfoNoZ(){return bht}_createAs3DShape(e,r,i,s,n,o,a){const l=this.getFastUpdateAttrValues(e),c=l&&this._fastUpdates?_=>Mq(this._fastUpdates.materialParameters,l,_):void 0,h=this._context.layer.uid,p=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:h}),f=tq(i,Ple,null,s,n,wht,null,l,p),m=EQ(this._context,r,f,o,a,c);if(m==null)return null;const y=new Cm(this,m.object,[f],null,null,aw,o);return y.alignedSampledElevation=m.sampledElevation,y.needsElevationUpdates=Wh(o.mode)||o.mode==="absolute-height",y.getScreenSize=this._createScreenSizeGetter(n,c),y.calculateRelativeScreenBounds=_=>i.calculateRelativeScreenBounds(y.getScreenSize(),1,_),QR(y,r,this._context.elevationProvider),y}_createAsOverlay(e,r,i,s,n,o){i.renderPriority=this._renderPriority;const a=Xt();So(r,a,this._context.overlaySR),a[2]=qQ;const l=this._context.clippingExtent;if(l!=null&&!PZ(l,a))return null;const c=this.getFastUpdateAttrValues(e),h=c&&this._fastUpdates?_=>Mq(this._fastUpdates.materialParameters,c,_):void 0,p=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:e.uid,layerUid:this._context.layer.uid}),f=tq(i,Ple,a,s,n,null,null,c,p),m=new ME(f,{layerUid:o,graphicUid:e.uid,shaderTransformer:h}),y=new BU(this,[m],null,this._context.drapeSourceRenderer);return y.getScreenSize=this._createScreenSizeGetter(n,h),y.calculateRelativeScreenBounds=_=>i.calculateRelativeScreenBounds(y.getScreenSize(),1,_),y}_createScreenSizeGetter(e,r){const i=this._outlineSize+2;if(this._fastUpdates&&r){const s=e[0]/this._symbolTextureRatio,n=e[1]/this._symbolTextureRatio;return(o=Ge())=>{const a=r(fht);return o[0]=a[0]*s+i,o[1]=a[5]*n+i,o}}{const s=e[0]/this._symbolTextureRatio+i,n=e[1]/this._symbolTextureRatio+i;return(o=Ge())=>(o[0]=s,o[1]=n,o)}}_fastVisualVariableConvertOptions(){const e=Math.max(this._size[0],this._size[1]),r=Me(e,e,e),i=Uh(1),s=e*i,n=Me(s,s,s);return new sP({size:!0,color:!0,rotation:!0,opacity:!1},r,n,i)}_getGraphicHash(e){let r="";for(const i of this._cimRequiredFields)r+=i+e.attributes[i];return r}_forEachMaterial(e){this._material!=null&&e(this._material),this._cimSymbolMaterials.forEach(e)}test(){return{...super.test(),material:this._material}}};function vht(t){return t&&t.type==="point-3d"&&t.hasVisibleVerticalOffset()}function Jk(t){return t!=null&&(t==="cross"||t==="x")}Hq.PRIMITIVE_SIZE=_ht,Hq.elevationModeChangeTypes={definedChanged:cs.UPDATE,staysOnTheGround:cs.NONE,onTheGroundChanged:cs.RECREATE};const bht={mode:"relative-to-ground",offset:0},wht=Nt(0,0,0,1);function qq(t){switch(t){case"butt":return Lh.BUTT;case"square":return Lh.SQUARE;case"round":return Lh.ROUND;default:return null}}function Ile(t){return t==="diamond"?"kite":t}function Wq(t,e,r=null){const i=[],s=[],n=e.mapPositions;xht(e,s,i);const o=s[0][1].data,a=i[0][1].length,l=uC(a);return Tht(e,s,i,l),Cht(e,s,i,l),Sht(e,s,i,l),Eht(e,s,i,l),Aht(e,s,i,l),Oht(e,s,i,l),Rht(e,s,i,o),new Ys(t,s,i,n,ls.Line,r)}function xht(t,e,r){const{attributeData:{position:i},removeDuplicateStartEnd:s}=t,n=Mht(i)&&s,o=i.length/3-(n?1:0),a=new Array(2*(o-1)),l=n?i.slice(0,i.length-3):i;let c=0;for(let h=0;h<o-1;h++)a[c++]=h,a[c++]=h+1;e.push([C.POSITION,new He(l,3,n)]),r.push([C.POSITION,a])}function Tht(t,e,r,i){if(t.attributeData.colorFeature!=null)return;const s=t.attributeData.color;e.push([C.COLOR,new He(s??Ch,4)]),r.push([C.COLOR,i])}function Sht(t,e,r,i){if(t.attributeData.normal==null)return;const s=t.attributeData.normal;e.push([C.NORMAL,new He(s,3)]),r.push([C.NORMAL,i])}function Eht(t,e,r,i){t.attributeData.colorFeature!=null&&(e.push([C.COLORFEATUREATTRIBUTE,new He([t.attributeData.colorFeature],1,!0)]),r.push([C.COLOR,i]))}function Cht(t,e,r,i){t.attributeData.sizeFeature==null&&(e.push([C.SIZE,new He([t.attributeData.size??1],1,!0)]),r.push([C.SIZE,i]))}function Aht(t,e,r,i){t.attributeData.sizeFeature!=null&&(e.push([C.SIZEFEATUREATTRIBUTE,new He([t.attributeData.sizeFeature],1,!0)]),r.push([C.SIZEFEATUREATTRIBUTE,i]))}function Oht(t,e,r,i){const s=t.attributeData.opacityFeature;s!=null&&(e.push([C.OPACITYFEATUREATTRIBUTE,new He([s],1,!0)]),r.push([C.OPACITYFEATUREATTRIBUTE,i]))}function Rht(t,e,r,i){if(t.overlayInfo==null||t.overlayInfo.renderCoordsHelper.viewingMode!==Ue.Global||!t.overlayInfo.spatialReference.isGeographic)return;const s=Ho(i.length),n=zr(t.overlayInfo.spatialReference);for(let f=0;f<s.length;f+=3)L6(i,f,s,f,n);const o=i.length/3,a=Ki(o+1);let l=Pht,c=Iht,h=0,p=0;se(l,s[p++],s[p++],s[p++]),a[0]=0;for(let f=1;f<o+1;++f)f===o&&(p=0),se(c,s[p++],s[p++],s[p++]),h+=Vxe(l,c),a[f]=h,[l,c]=[c,l];e.push([C.DISTANCETOSTART,new He(a,1,!0)]),r.push([C.DISTANCETOSTART,r[0][1]])}function Mht(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}const Pht=O(),Iht=O();function Jkt(t,e){if(t==null||t.length===0)return[];const r=[];return t.forEach(i=>{const s=i.length,n=Ho(3*s);i.forEach((a,l)=>{n[3*l]=a[0],n[3*l+1]=a[1],n[3*l+2]=a[2]});const o={attributeData:{position:n,normal:e},removeDuplicateStartEnd:!1};r.push(o)}),r}function $ht(t,e,r,i){const s=t.type==="polygon"?fm.CCW_IS_HOLE:fm.NONE,n=t.type==="polygon"?t.rings:t.paths,{position:o,outlines:a}=cP(n,!!t.hasZ,s),l=Ho(o.length),c=KEe(o,t.spatialReference,0,l,0,o,0,o.length/3,e,r,i),h=c!=null;return{lines:h?i3e(a,o,l):[],projectionSuccess:h,sampledElevation:c}}function Lht(t,e){const r=t.type==="polygon"?fm.CCW_IS_HOLE:fm.NONE,i=t.type==="polygon"?t.rings:t.paths,{position:s,outlines:n}=cP(i,!1,r),o=li(s,t.spatialReference,0,s,e,0,s.length/3);for(let a=2;a<s.length;a+=3)s[a]=qQ;return{lines:o?i3e(n,s):[],projectionSuccess:o}}function i3e(t,e,r=null){const i=new Array;for(const{index:s,count:n}of t){if(n<=1)continue;const o=3*s,a=3*n;i.push({position:$h(e,3*s,3*n),mapPositions:r!=null?$h(r,o,a):void 0})}return i}function Dht(t){const e=new Sr,r=t.hasMultipassTerrain&&(t.output===U.Color||t.output===U.Alpha),i=t.space===Tu.World;e.include(XCe,t),e.include(tAe,t),t.output===U.Depth&&e.include(_y,t);const{vertex:s,fragment:n}=e;return n.include(Nc),Mc(s,t),e.attributes.add(C.POSITION,"vec3"),e.attributes.add(C.UV0,"vec2"),e.attributes.add(C.AUXPOS1,"vec3"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),e.varyings.add("vUV","vec2"),e.varyings.add("vSize","float"),av(e),r&&e.varyings.add("depth","float"),t.hasTip&&e.varyings.add("vLineWidth","float"),s.uniforms.add(new Ar("nearFar",(o,a)=>a.camera.nearFar),new nr("viewport",(o,a)=>a.camera.fullViewport)),s.code.add(w`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),s.code.add(w`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`),i?(e.attributes.add(C.NORMAL,"vec3"),wE(s),s.constants.add("tiltThreshold","float",.7),s.code.add(w`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):s.code.add(w`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`),s.code.add(w`
      #define vecN ${i?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${i?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${t.anchor===Bw.Tip?"pos -= 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `),t.space===Tu.Screen&&(s.uniforms.add(new Fi("inverseProjectionMatrix",(o,a)=>a.camera.inverseProjectionMatrix)),s.code.add(w`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),s.code.add(w`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),s.uniforms.add(new Pe("perScreenPixelRatio",(o,a)=>a.camera.perScreenPixelRatio)),s.code.add(w`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${t.hasCap?`
                if(prev.z > posLeft.z) {
                  vec2 diff = posLeft.xy - posRight.xy;
                  planeOrigin.xy += perpendicular(diff) / 2.0;
                }
              `:""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),gC(s,t),sU(e),s.code.add(w`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position.xyz, 1.0);
vec4 prev = view * vec4(auxpos1.xyz, 1.0);
clip(pos, prev);`),i?(t.hideOnShortSegments&&s.code.add(w`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),s.code.add(w`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(s.code.add(w`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),t.space===Tu.Screen&&s.code.add(w`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`)),s.code.add(w`
        ${r?"depth = pos.z;":""}
        linearDepth = calculateLinearDepth(nearFar,pos.z);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${i?"":"vUV *= displacedPosScreen.w;"}

        ${t.hasTip?"vLineWidth = lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),r&&e.include(Mu,t),e.include(ys,t),n.uniforms.add(new nr("intrinsicColor",o=>o.color),new et("tex",o=>o.markerTexture)),n.include(Em),e.constants.add("texelSize","float",1/lw),n.code.add(w`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`),t.hasTip&&(e.constants.add("relativeMarkerSize","float",$Q/lw),e.constants.add("relativeTipLineWidth","float",Plt),n.code.add(w`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${i?"halfTipLineWidth *= fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `)),e.constants.add("symbolAlphaCutoff","float",yo),n.code.add(w`
  void main() {
    discardBySlice(vpos);
    ${r?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${i?"vec2 samplePos = vUV;":"vec2 samplePos = vUV * gl_FragCoord.w;"}

    ${t.hasTip?"finalColor.a *= max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *= markerAlpha(samplePos);"}

    ${t.output===U.ObjectAndLayerIdColor?w`finalColor.a = 1.0;`:""}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${t.output===U.Alpha?w`fragColor = vec4(finalColor.a);`:""}
    ${t.output===U.Color?w`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===U.Color&&t.transparencyPassType===ut.Color?"fragColor = premultiplyAlpha(fragColor);":""}
    ${t.output===U.Highlight?w`fragColor = vec4(1.0);`:""}
    ${t.output===U.Depth?w`outputDepth(linearDepth);`:""}
  }
  `),e}const Nht=Object.freeze(Object.defineProperty({__proto__:null,build:Dht},Symbol.toStringTag,{value:"Module"})),s3e=new Map([[C.POSITION,0],[C.UV0,2],[C.AUXPOS1,3],[C.NORMAL,4],[C.COLOR,5],[C.COLORFEATUREATTRIBUTE,5],[C.SIZE,6],[C.SIZEFEATUREATTRIBUTE,6],[C.OPACITYFEATUREATTRIBUTE,7]]);let n3e=class o3e extends Lr{initializeProgram(e){return new Rr(e.rctx,o3e.shader.get().build(this.configuration),s3e)}_makePipelineState(e,r){const i=this.configuration,s=e===ut.NONE;return Mt({blending:i.output===U.Color||i.output===U.Alpha?s?xu:Dy(e):null,depthTest:{func:Ov(e)},depthWrite:s?i.writeDepth?Ul:null:AU(e),colorWrite:Gt,stencilWrite:i.hasOccludees?mm:null,stencilTest:i.hasOccludees?r?mv:Rv:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=Mt({blending:xu,depthTest:NF,depthWrite:null,colorWrite:Gt,stencilWrite:null,stencilTest:sAe}),this._occluderPipelineOpaque=Mt({blending:xu,depthTest:NF,depthWrite:null,colorWrite:Gt,stencilWrite:rAe,stencilTest:iAe}),this._occluderPipelineMaskWrite=Mt({blending:null,depthTest:LQ,depthWrite:null,colorWrite:null,stencilWrite:mm,stencilTest:mv})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:this.configuration.occluder?e===he.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===he.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,r)}};n3e.shader=new Or(Nht,()=>ce(()=>import("./LineMarker.glsl-befdc96b.js"),[],import.meta.url));let Fht=class extends Av{constructor(e){super(e,new kht),this._vertexAttributeLocations=s3e,this._configuration=new uo,this._layout=this.createLayout()}dispose(){}getConfiguration(e,r){return this._configuration.output=e,this._configuration.space=r.slot===he.DRAPED_MATERIAL?Tu.Draped:this.parameters.worldSpace?Tu.World:Tu.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==Lh.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.occluder=this.parameters.renderOccluded===Di.OccludeAndTransparentStencil,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}intersect(){}createLayout(){const e=Hi().vec3f(C.POSITION).vec2f(C.UV0).vec3f(C.AUXPOS1);return this.parameters.worldSpace&&e.vec3f(C.NORMAL),this.parameters.vvSize?e.f32(C.SIZEFEATUREATTRIBUTE):e.f32(C.SIZE),this.parameters.vvColor?e.f32(C.COLORFEATUREATTRIBUTE):e.vec4f(C.COLOR),this.parameters.vvOpacity&&e.f32(C.OPACITYFEATUREATTRIBUTE),e}createBufferWriter(){return new zht(this._layout,this.parameters)}requiresSlot(e,r){return r===U.Color||r===U.Alpha||r===U.Highlight||r===U.Depth?e===he.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===Di.OccludeAndTransparentStencil?e===he.OPAQUE_MATERIAL||e===he.OCCLUDER_MATERIAL||e===he.TRANSPARENT_OCCLUDER_MATERIAL:r===U.Color||r===U.Alpha?e===(this.parameters.writeDepth?he.TRANSPARENT_MATERIAL:he.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===he.OPAQUE_MATERIAL:!1}createGLMaterial(e){return new Uht(e)}},Uht=class extends mJ{constructor(){super(...arguments),this._markerPrimitive=null}dispose(){super.dispose(),this._markerTextureRepository.release(this._markerPrimitive),this._markerPrimitive=null}_updateParameters(e){const r=this._material.parameters.markerPrimitive;return r!==this._markerPrimitive&&(this._material.setParameters({markerTexture:this._markerTextureRepository.swap(r,this._markerPrimitive)}),this._markerPrimitive=r),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(n3e,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==U.Color&&this._output!==U.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},kht=class extends nP{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.markerPrimitive="arrow",this.placement="end",this.cap=Lh.BUTT,this.anchor=Bw.Center,this.hasTip=!1,this.worldSpace=!1,this.hideOnShortSegments=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1,this.markerTexture=null}},zht=class{constructor(e,r){this.vertexBufferLayout=e,this._parameters=r}elementCount(){return this._parameters.placement==="begin-end"?12:6}write(e,r,i,s,n){const o=i.vertexAttributes.get(C.POSITION).data,a=o.length/3;let l=[1,0,0];const c=i.vertexAttributes.get(C.NORMAL);this._parameters.worldSpace&&c!=null&&(l=c.data);let h=1,p=0;this._parameters.vvSize?p=i.vertexAttributes.get(C.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(C.SIZE)&&(h=i.vertexAttributes.get(C.SIZE).data[0]);let f=[1,1,1,1],m=0;this._parameters.vvColor?m=i.vertexAttributes.get(C.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(C.COLOR)&&(f=i.vertexAttributes.get(C.COLOR).data);let y=0;this._parameters.vvOpacity&&(y=i.vertexAttributes.get(C.OPACITYFEATUREATTRIBUTE).data[0]);const _=new Float32Array(s.buffer);let v=n*(this.vertexBufferLayout.stride/4);const b=(E,A,R,M)=>{if(_[v++]=E[0],_[v++]=E[1],_[v++]=E[2],_[v++]=R[0],_[v++]=R[1],_[v++]=A[0],_[v++]=A[1],_[v++]=A[2],this._parameters.worldSpace&&(_[v++]=l[0],_[v++]=l[1],_[v++]=l[2]),this._parameters.vvSize?_[v++]=p:_[v++]=h,this._parameters.vvColor)_[v++]=m;else{const D=Math.min(4*M,f.length-4);_[v++]=f[D],_[v++]=f[D+1],_[v++]=f[D+2],_[v++]=f[D+3]}this._parameters.vvOpacity&&(_[v++]=y)};let T;(function(E){E[E.ASCENDING=1]="ASCENDING",E[E.DESCENDING=-1]="DESCENDING"})(T||(T={}));const x=(E,A)=>{const R=se(Vht,o[3*E],o[3*E+1],o[3*E+2]),M=Bht;let D=E+A;do se(M,o[3*D],o[3*D+1],o[3*D+2]),D+=A;while(X_(R,M)&&D>=0&&D<a);e&&(Fe(R,R,e),Fe(M,M,e)),b(R,M,[-1,-1],E),b(R,M,[1,-1],E),b(R,M,[1,1],E),b(R,M,[-1,-1],E),b(R,M,[1,1],E),b(R,M,[-1,1],E)},S=this._parameters.placement;S!=="begin"&&S!=="begin-end"||x(0,T.ASCENDING),S!=="end"&&S!=="begin-end"||x(a-1,T.DESCENDING)}};const Vht=O(),Bht=O(),Qo={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},Ght={dash:Qo.dash,"dash-dot":[...Qo.dash,...Qo.dot],dot:Qo.dot,"long-dash":Qo["long-dash"],"long-dash-dot":[...Qo["long-dash"],...Qo.dot],"long-dash-dot-dot":[...Qo["long-dash"],...Qo.dot,...Qo.dot],none:null,"short-dash":Qo["short-dash"],"short-dash-dot":[...Qo["short-dash"],...Qo["short-dot"]],"short-dash-dot-dot":[...Qo["short-dash"],...Qo["short-dot"],...Qo["short-dot"]],"short-dot":Qo["short-dot"],solid:null},jht=8;function Hht(t,e){return t==null?t:{pattern:t.slice(),pixelRatio:e}}function rzt(t){return{pattern:[t,t],pixelRatio:2}}function a3e(t){return t!=null&&t.type==="style"?qht(t.style):null}function qht(t){return t!=null?Hht(Ght[t],jht):null}const Wht=["polyline","polygon","extent"],$le=new sP({size:!0,color:!0,rotation:!1,opacity:!0});let l3e=class c3e extends Am{constructor(e,r,i,s){super(e,r,i,s)}async doLoad(){if(this._fastUpdates=TE(this._context.renderer,$le),!this._drivenProperties.size&&(this.symbolLayer.size!=null?this.symbolLayer.size:Uh(1))<0)throw new V("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values")}_getMaterialParameters(e,r=!1){const i=this._getCombinedOpacityAndColor(r&&this._markerColor||this._materialColor);this._patternHidesLine&&!r&&(i[3]=0);const s={width:this._computeMaterialWidth(this.symbolLayer?.size),color:i,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:qq(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:e,stipplePattern:a3e(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};return this._fastUpdates?.visualVariables?{...s,...this._fastUpdates.materialParameters}:s}get _materialColor(){return this.symbolLayer.material?.color}get _markerColor(){return this.symbolLayer.marker?.color}get _lineMaterial(){return this._lineMaterialCached==null&&(this._lineMaterialCached=new ZS(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterialCached)),this._lineMaterialCached}get _ringMaterial(){return this._ringMaterialCached==null&&(this._ringMaterialCached=new ZS(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterialCached)),this._ringMaterialCached}get _wireframeLineMaterial(){return this._wireframeLineMaterialCached==null&&(this._wireframeLineMaterialCached=new ZS({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._wireframeLineMaterialCached)),this._wireframeLineMaterialCached}get _wireframeRingMaterial(){return this._wireframeRingMaterialCached==null&&(this._wireframeRingMaterialCached=new ZS({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._wireframeRingMaterialCached)),this._wireframeRingMaterialCached}get _markerMaterial(){return this._markerMaterialCached==null&&this.symbolLayer.marker!=null&&(this._markerMaterialCached=new Fht({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,markerPrimitive:Ile(this.symbolLayer.marker.style)}),this._context.stage.add(this._markerMaterialCached)),this._markerMaterialCached}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._lineMaterialCached=null,this._ringMaterialCached=null,this._wireframeLineMaterialCached=null,this._wireframeRingMaterialCached=null,this._markerMaterialCached=null}_getDrivenSize(e){return this._drivenProperties.size&&e.size?_o(tlt(e.size)):1}_getDrivenColor(e){const r=Nt(1,1,1,1);return this._drivenProperties.color&&e.color&&(r[0]=e.color[0],r[1]=e.color[1],r[2]=e.color[2],e.color.length>0&&(r[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(r[3]=e.opacity),r}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,Wht,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new Pp);return this.ensureDrapedStatus(i.mode==="on-the-ground"),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,i,r.uid)}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables")return Ns.RecreateSymbol;{const s=this._fastUpdates;if(!SE(s,r,$le))return Ns.RecreateSymbol;this._forEachMaterial(n=>n.setParameters(s.materialParameters))}}return Ns.FastUpdate}prepareSymbolLayerPatch(e){if(e.diff.type!=="partial")return;const r=e.diff.diff,i={};r.size?.type==="complete"&&(i.width=this._computeMaterialWidth(r.size.newValue),delete r.size),r.cap?.type==="complete"&&(i.cap=qq(r.cap.newValue??"butt"),delete r.cap);const s=this._prepareMarkerPatch(e,r);this._prepareMaterialPatch(e,r,s),e.symbolLayerStatePatches.push(()=>this._forEachMaterial(n=>n.setParameters(i)))}layerOpacityChanged(){this._forEachMaterial((e,r)=>this._updateMaterialLayerOpacity(e,r))}_forEachMaterial(e){this._lineMaterialCached!=null&&e(this._lineMaterialCached),this._ringMaterialCached!=null&&e(this._ringMaterialCached),this._wireframeLineMaterialCached!=null&&e(this._wireframeLineMaterialCached),this._wireframeRingMaterialCached!=null&&e(this._wireframeRingMaterialCached),this._markerMaterialCached!=null&&e(this._markerMaterialCached,!0)}_updateMaterialLayerOpacity(e,r=!1){const i=e.parameters.color,s=this.symbolLayer?.material?.color,n=this._patternHidesLine&&!r?0:this._getCombinedOpacity(s),o=Nt(i[0],i[1],i[2],n);e.setParameters({color:o})}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=oP(c3e.elevationModeChangeTypes,i,s);if(n!==cs.UPDATE)return n;const o=Wh(s);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){const e={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(r=>r.setParameters(e)),!0}physicalBasedRenderingChanged(){return!0}_getGeometryAsPolygonOrPolyline(e){switch(e.type){case"extent":if(e instanceof ur)return yu.fromExtent(e);break;case"polygon":case"polyline":return e}return null}_createAs3DShape(e,r,i){const s=e.graphic,n=this._getGeometryAsPolygonOrPolyline(s.geometry),o=n.type==="polygon"?n.rings:n.paths,a=new Array,l=pn(),c=$ht(n,this._context.elevationProvider,this._context.renderCoordsHelper,r),h=n.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(c,o,h,"LineSymbol3DLayer");for(let m=0;m<c.lines.length;m++){const y=c.lines[m],_=y.position,v=y.mapPositions;if(this._context.clippingExtent!=null&&(Si(l),gu(l,v),!np(l,this._context.clippingExtent)))continue;const b=this._createGeometry(n.type==="polygon"?this._ringMaterial:this._lineMaterial,e,_,v,n.type,KO.ELEVATED,i);a.push(b),ai.LINE_WIREFRAMES&&a.push(b.instantiate({material:n.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial})),this._markerMaterial!=null&&a.push(b.instantiate({material:this._markerMaterial}))}if(a.length===0)return null;const p=new Ny({geometries:a,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:i}),f=new Cm(this,p,a,null,null,Hot,r);return f.alignedSampledElevation=c.sampledElevation,f.needsElevationUpdates=Wh(r.mode),f}_createGeometry(e,r,i,s,n,o,a){const l=o===KO.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,c=n==="polygon",h=this._fastUpdates?.visualVariables.color,p=this._fastUpdates?.visualVariables.size,f=this._fastUpdates?.visualVariables.opacity,m=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:this._context.layer.uid}),y={position:i,size:p?null:this._getDrivenSize(r.renderingInfo),color:h?null:this._getDrivenColor(r.renderingInfo),sizeFeature:p?gp(p.field,r.graphic):null,colorFeature:h?gp(h.field,r.graphic):null,opacityFeature:f?gp(f.field,r.graphic):null};return Wq(e,{overlayInfo:l,removeDuplicateStartEnd:c,mapPositions:s,attributeData:y},m)}_createAsOverlay(e,r){const i=e.graphic,s=this._getGeometryAsPolygonOrPolyline(i.geometry),n=s.type==="polygon"?s.rings:s.paths,o=s.type==="polygon"?this._ringMaterial:this._lineMaterial;o.renderPriority=this._renderPriority;const a=ai.LINE_WIREFRAMES?s.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial:null,l=this._markerMaterial;a!=null&&(a.renderPriority=this._renderPriority-.001),l!=null&&(l.renderPriority=this._renderPriority-.002);const c=new Array,h=pn(),p=Si(),f=Lht(s,this._context.overlaySR),m=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(f,n,m,"LineSymbol3DLayer");for(const y of f.lines){if(Si(h),gu(h,y.position),!np(h,this._context.clippingExtent))continue;Z2(p,h);const _=v=>{const b=this._createGeometry(v,e,y.position,void 0,s.type,KO.DRAPED,i.uid),T=new ME(b,{layerUid:r,graphicUid:i.uid});c.push(T)};if(l!=null){_(l);const v=this.symbolLayer.marker.placement;v!=="begin"&&v!=="begin-end"||gu(h,y.position,0,1),v!=="end"&&v!=="begin-end"||gu(h,y.position,y.position.length-3,1)}_(o),ai.LINE_WIREFRAMES&&_(a)}return new BU(this,c,p,this._context.drapeSourceRenderer)}get _patternHidesLine(){const e=this.symbolLayer.pattern;return e!=null&&e.type==="style"&&e.style==="none"}_computeMaterialWidth(e){return e=e??Uh(1),this._drivenProperties.size?this._fastUpdates?.visualVariables.size?_o(1):1:_o(e)}_prepareMaterialPatch(e,r,i){const s=r.material;if(s==null)return void(i.changed&&i.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._markerMaterialCached,e));if(s.type==="collection")return;const n=s.type==="complete"?s.newValue?.color:s.diff.color?.type==="complete"?s.diff.color.newValue:null,o=this._getCombinedOpacityAndColor(n);i.useMaterialColor&&this._patchMaterialColor(UM(o),this._markerMaterialCached,e),this._patternHidesLine&&(o[3]=0),this._patchMaterialColor(o,this._lineMaterialCached,e),delete r.material}_prepareMarkerPatch(e,r){const i=r.marker,s=this._markerMaterial;if(i==null||i.type!=="partial"||i.diff==null||i.diff.placement!=null||i.diff.style!=null&&i.diff.style.type!=="complete"||i.diff.color!=null&&i.diff.color.type!=="complete"||s==null)return{changed:!1,useMaterialColor:this._markerColor==null};const n=i.diff.color,o=n!=null,a=o?n.newValue:null,l=a==null&&this._markerColor==null;a&&this._patchMaterialColor(this._getCombinedOpacityAndColor(a),s,e);const c=i.diff.style?.newValue;return c&&e.symbolLayerStatePatches.push(()=>s.setParameters({markerPrimitive:Ile(c)})),delete r.marker,{changed:o,useMaterialColor:l}}_patchMaterialColor(e,r,i){r!=null&&i.symbolLayerStatePatches.push(()=>r.setParameters({color:e}))}};var KO;l3e.elevationModeChangeTypes={definedChanged:cs.RECREATE,staysOnTheGround:cs.NONE,onTheGroundChanged:cs.RECREATE},function(t){t[t.DRAPED=0]="DRAPED",t[t.ELEVATED=1]="ELEVATED"}(KO||(KO={}));let cA=null,kF=!0;function Qk(t,e,r){if(!t||!e)throw new Error("Cannot construct image data without dimensions");if(kF)try{return new ImageData(t,e)}catch{kF=!1}return u3e(t,e,r)}function Xht(t,e,r,i){if(!e||!r)throw new Error("Cannot construct image data without dimensions");if(kF)try{return new ImageData(t,e,r)}catch{kF=!1}const s=u3e(e,r,i);return s.data.set(t,0),s}function Zht(){return cA||(cA=document.createElement("canvas"),cA.width=1,cA.height=1),cA}function u3e(t,e,r){return r||(r=Zht()),r.getContext("2d").createImageData(t,e)}var _S;const Kk=new WeakMap;let Yht=0,yf=_S=class extends le{constructor(t){super(t),this.wrap="repeat"}get url(){return this._get("url")||null}set url(t){this._set("url",t),t&&this._set("data",null)}get data(){return this._get("data")||null}set data(t){this._set("data",t),t&&this._set("url",null)}writeData(t,e,r,i){if(t instanceof HTMLImageElement){const s={type:"image-element",src:hy(t.src,i),crossOrigin:t.crossOrigin};e[r]=s}else if(t instanceof HTMLCanvasElement){const s=t.getContext("2d").getImageData(0,0,t.width,t.height),n={type:"canvas-element",imageData:this._encodeImageData(s)};e[r]=n}else if(t instanceof HTMLVideoElement){const s={type:"video-element",src:hy(t.src,i),autoplay:t.autoplay,loop:t.loop,muted:t.muted,crossOrigin:t.crossOrigin,preload:t.preload};e[r]=s}else if(t instanceof ImageData){const s={type:"image-data",imageData:this._encodeImageData(t)};e[r]=s}}readData(t){switch(t.type){case"image-element":{const e=new Image;return e.src=t.src,e.crossOrigin=t.crossOrigin,e}case"canvas-element":{const e=this._decodeImageData(t.imageData),r=document.createElement("canvas");return r.width=e.width,r.height=e.height,r.getContext("2d").putImageData(e,0,0),r}case"image-data":return this._decodeImageData(t.imageData);case"video-element":{const e=document.createElement("video");return e.src=t.src,e.crossOrigin=t.crossOrigin,e.autoplay=t.autoplay,e.loop=t.loop,e.muted=t.muted,e.preload=t.preload,e}default:return}}get transparent(){const t=this.data,e=this.url;if(t instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(t.getContext("2d").getImageData(0,0,t.width,t.height));if(t instanceof ImageData)return this._imageDataContainsTransparent(t);if(e){const r=e.substr(e.length-4,4).toLowerCase(),i=e.substr(0,15).toLocaleLowerCase();if(r===".png"||i==="data:image/png;")return!0}return!1}set transparent(t){this._overrideIfSome("transparent",t)}get contentHash(){const t=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",e=(r="")=>`d:${r},t:${this.transparent},w:${t}`;return this.url!=null?e(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?e(this.data.src):(Kk.has(this.data)||Kk.set(this.data,++Yht),e(Kk.get(this.data))):e()}get memoryUsage(){let t=0;if(t+=this.url!=null?this.url.length:0,this.data!=null){const e=this.data;"data"in e?t+=e.data.byteLength:e instanceof HTMLImageElement?t+=e.naturalWidth*e.naturalHeight*3:e instanceof HTMLCanvasElement&&(t+=e.width*e.height*3)}return t}clone(){const t={url:this.url,data:this.data,wrap:this._cloneWrap()};return new _S(t)}cloneWithDeduplication(t){const e=t.get(this);if(e)return e;const r=this.clone();return t.set(this,r),r}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(t){let e="";for(let r=0;r<t.data.length;r++)e+=String.fromCharCode(t.data[r]);return{data:btoa(e),width:t.width,height:t.height}}_decodeImageData(t){const e=atob(t.data),r=new Uint8ClampedArray(e.length);for(let i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return Xht(r,t.width,t.height)}_imageDataContainsTransparent(t){for(let e=3;e<t.data.length;e+=4)if(t.data[e]!==255)return!0;return!1}static from(t){return typeof t=="string"?new _S({url:t}):t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData||t instanceof HTMLVideoElement?new _S({data:t}):mw(_S,t)}};u([d({type:String,json:{write:J_}})],yf.prototype,"url",null),u([d({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),d()],yf.prototype,"data",null),u([ke("data")],yf.prototype,"writeData",null),u([Ae("data")],yf.prototype,"readData",null),u([d({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],yf.prototype,"transparent",null),u([d({json:{write:!0}})],yf.prototype,"wrap",void 0),u([d({readOnly:!0})],yf.prototype,"contentHash",null),yf=_S=u([P("esri.geometry.support.MeshTexture")],yf);const eR=yf;let vS=class extends ji(le){constructor(e){super(e),this.offset=[0,0],this.rotation=0,this.scale=[1,1]}};u([d({type:[Number],nonNullable:!0,json:{write:!0}})],vS.prototype,"offset",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0}})],vS.prototype,"rotation",void 0),u([d({type:[Number],nonNullable:!0,json:{write:!0}})],vS.prototype,"scale",void 0),vS=u([P("esri.geometry.support.MeshTextureTransform")],vS);const R2=vS;var Xq;let Pd=Xq=class extends le{constructor(t){super(t),this.color=null,this.colorTexture=null,this.colorTextureTransform=null,this.normalTexture=void 0,this.normalTextureTransform=void 0,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const r=t!=null?t.get(this):null;if(r)return r;const i=new Xq(this.clonePropertiesWithDeduplication(e));return t?.set(this,i),i}clonePropertiesWithDeduplication(t){return{color:this.color!=null?this.color.clone():null,colorTexture:this.colorTexture?.cloneWithDeduplication(t),normalTexture:this.normalTexture?.cloneWithDeduplication(t),alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:this.colorTextureTransform?.clone(),normalTextureTransform:this.normalTextureTransform?.clone()}}get memoryUsage(){return this.getMemoryUsage()}getMemoryUsage(){let t=0;return t+=this.color!=null?16:0,this.colorTexture!=null&&(t+=this.colorTexture.memoryUsage),t+=this.colorTextureTransform!=null?20:0,this.normalTexture!=null&&(t+=this.normalTexture.memoryUsage),t+=this.normalTextureTransform!=null?20:0,t}};u([d({type:Ne,json:{write:!0}})],Pd.prototype,"color",void 0),u([d({type:eR,json:{write:!0}})],Pd.prototype,"colorTexture",void 0),u([d({type:R2,json:{write:!0}})],Pd.prototype,"colorTextureTransform",void 0),u([d({type:eR,json:{write:!0}})],Pd.prototype,"normalTexture",void 0),u([d({type:R2,json:{write:!0}})],Pd.prototype,"normalTextureTransform",void 0),u([d({nonNullable:!0,json:{write:!0}})],Pd.prototype,"alphaMode",void 0),u([d({nonNullable:!0,json:{write:!0}})],Pd.prototype,"alphaCutoff",void 0),u([d({nonNullable:!0,json:{write:!0}})],Pd.prototype,"doubleSided",void 0),Pd=Xq=u([P("esri.geometry.support.MeshMaterial")],Pd);const JQ=Pd;var Zq;let oh=Zq=class extends JQ{constructor(t){super(t),this.emissiveColor=null,this.emissiveTexture=null,this.emissiveTextureTransform=void 0,this.occlusionTexture=null,this.occlusionTextureTransform=void 0,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null,this.metallicRoughnessTextureTransform=void 0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const r=t!=null?t.get(this):null;if(r)return r;const i=new Zq(this.clonePropertiesWithDeduplication(e));return t?.set(this,i),i}getMemoryUsage(){let t=super.getMemoryUsage();return t+=this.emissiveColor!=null?16:0,this.emissiveTexture!=null&&(t+=this.emissiveTexture.memoryUsage),t+=this.emissiveTextureTransform!=null?20:0,this.occlusionTexture!=null&&(t+=this.occlusionTexture.memoryUsage),t+=this.occlusionTextureTransform!=null?20:0,this.metallicRoughnessTexture!=null&&(t+=this.metallicRoughnessTexture.memoryUsage),t+=this.metallicRoughnessTextureTransform!=null?20:0,t}clonePropertiesWithDeduplication(t){return{...super.clonePropertiesWithDeduplication(t),emissiveColor:this.emissiveColor?.clone(),emissiveTexture:this.emissiveTexture?.cloneWithDeduplication(t),emissiveTextureTransform:this.emissiveTextureTransform?.clone(),occlusionTexture:this.occlusionTexture?.cloneWithDeduplication(t),occlusionTextureTransform:this.occlusionTextureTransform?.clone(),metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:this.metallicRoughnessTexture?.cloneWithDeduplication(t),metallicRoughnessTextureTransform:this.metallicRoughnessTextureTransform?.clone()}}};u([d({type:Ne,json:{write:!0}})],oh.prototype,"emissiveColor",void 0),u([d({type:eR,json:{write:!0}})],oh.prototype,"emissiveTexture",void 0),u([d({type:R2,json:{write:!0}})],oh.prototype,"emissiveTextureTransform",void 0),u([d({type:eR,json:{write:!0}})],oh.prototype,"occlusionTexture",void 0),u([d({type:R2,json:{write:!0}})],oh.prototype,"occlusionTextureTransform",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],oh.prototype,"metallic",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],oh.prototype,"roughness",void 0),u([d({type:eR,json:{write:!0}})],oh.prototype,"metallicRoughnessTexture",void 0),u([d({type:R2,json:{write:!0}})],oh.prototype,"metallicRoughnessTextureTransform",void 0),oh=Zq=u([P("esri.geometry.support.MeshMaterialMetallicRoughness")],oh);const h3e=oh;var _N;const d3e="esri.geometry.support.MeshVertexAttributes",cT=Q.getLogger(d3e);let Gu=_N=class extends le{constructor(t){super(t),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(t){return bS(t,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},cT)}castPosition(t){return t&&t instanceof Float32Array&&cT.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),bS(t,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},cT)}castUv(t){return bS(t,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},cT)}castNormal(t){return bS(t,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},cT)}castTangent(t){return bS(t,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},cT)}clone(){const t={position:K(this.position),uv:K(this.uv),normal:K(this.normal),tangent:K(this.tangent),color:K(this.color)};return new _N(t)}clonePositional(){const t={position:K(this.position),normal:K(this.normal),tangent:K(this.tangent),uv:this.uv,color:this.color};return new _N(t)}get memoryUsage(){let t=0;return t+=this.position.byteLength,this.uv!=null&&(t+=this.uv.byteLength),this.normal!=null&&(t+=this.normal.byteLength),this.tangent!=null&&(t+=this.tangent.byteLength),this.color!=null&&(t+=this.color.byteLength),t}};function ez(t,e,r,i){const{loggerTag:s,stride:n}=e;return t.length%n!=0?(i.error(s,`Invalid array length, expected a multiple of ${n}`),new r([])):t}function bS(t,e,r,i,s){if(!t)return t;if(t instanceof e)return ez(t,i,e,s);for(const n of r)if(t instanceof n)return ez(new e(t),i,e,s);if(Array.isArray(t))return ez(new e(t),i,e,s);{const n=r.map(o=>`'${o.name}'`);return s.error(`Failed to set property, expected one of ${n}, but got ${t.constructor.name}`),new e([])}}function uA(t,e,r){e[r]=Jht(t)}function Jht(t){const e=new Array(t.length);for(let r=0;r<t.length;r++)e[r]=t[r];return e}u([d({json:{write:uA}})],Gu.prototype,"color",void 0),u([wr("color")],Gu.prototype,"castColor",null),u([d({nonNullable:!0,json:{write:uA}})],Gu.prototype,"position",void 0),u([wr("position")],Gu.prototype,"castPosition",null),u([d({json:{write:uA}})],Gu.prototype,"uv",void 0),u([wr("uv")],Gu.prototype,"castUv",null),u([d({json:{write:uA}})],Gu.prototype,"normal",void 0),u([wr("normal")],Gu.prototype,"castNormal",null),u([d({json:{write:uA}})],Gu.prototype,"tangent",void 0),u([wr("tangent")],Gu.prototype,"castTangent",null),Gu=_N=u([P(d3e)],Gu);var X3;const p3e="esri.geometry.support.MeshComponent",Qht=Q.getLogger(p3e);let yg=X3=class extends le{static from(t){return mw(X3,t)}constructor(t){super(t),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}castFaces(t){return bS(t,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},Qht)}castMaterial(t){return mw(t&&typeof t=="object"&&("metallic"in t||"roughness"in t||"metallicRoughnessTexture"in t)?h3e:JQ,t)}clone(){return new X3({faces:K(this.faces),shading:this.shading,material:K(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(t,e){const r={faces:K(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(t,e):null,trustSourceNormals:this.trustSourceNormals};return new X3(r)}get memoryUsage(){let t=0;return this.faces!=null&&(t+=this.faces.byteLength),this.material!=null&&(t+=this.material.memoryUsage),t}};u([d({json:{write:!0}})],yg.prototype,"faces",void 0),u([wr("faces")],yg.prototype,"castFaces",null),u([d({type:JQ,json:{write:!0}})],yg.prototype,"material",void 0),u([wr("material")],yg.prototype,"castMaterial",null),u([d({type:String,json:{write:!0}})],yg.prototype,"shading",void 0),u([d({type:Boolean})],yg.prototype,"trustSourceNormals",void 0),yg=X3=u([P(p3e)],yg);const Kht=yg,GU=Q.getLogger("esri.geometry.support.meshUtils.normalProjection");function edt(t,e,r,i,s){return HU(i)?(jU(Qg.TO_PCPF,dn.fromTypedArray(t),Hh.fromTypedArray(e),Hh.fromTypedArray(r),i,dn.fromTypedArray(s)),s):(GU.error("Cannot convert spatial reference to PCPF"),s)}function szt(t,e,r,i,s){return HU(i)?(jU(Qg.FROM_PCPF,dn.fromTypedArray(t),Hh.fromTypedArray(e),Hh.fromTypedArray(r),i,dn.fromTypedArray(s)),s):(GU.error("Cannot convert to spatial reference from PCPF"),s)}function nzt(t,e,r){return li(t,e,0,r,hm(e),0,t.length/3),r}function ozt(t,e,r){return li(t,hm(r),0,e,r,0,t.length/3),e}function tdt(t,e,r){return rv(qn,r),Vw(e,t,qn),IY(qn)||DU(e,e),e}function rdt(t,e,r){if(rv(qn,r),Vw(e,t,qn,4),IY(qn)||DU(e,e,4),t!==e)for(let i=3;i<t.length;i+=4)e[i]=t[i];return e}function idt(t,e,r,i,s){if(!HU(i))return GU.error("Cannot convert spatial reference to PCPF"),s;jU(Qg.TO_PCPF,dn.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),Hh.fromTypedArray(e),Hh.fromTypedArray(r),i,dn.fromTypedArray(s,4*Float32Array.BYTES_PER_ELEMENT));for(let n=3;n<t.length;n+=4)s[n]=t[n];return s}function azt(t,e,r,i,s){if(!HU(i))return GU.error("Cannot convert to spatial reference from PCPF"),s;jU(Qg.FROM_PCPF,dn.fromTypedArray(t,16),Hh.fromTypedArray(e),Hh.fromTypedArray(r),i,dn.fromTypedArray(s,16));for(let n=3;n<t.length;n+=4)s[n]=t[n];return s}function jU(t,e,r,i,s,n){if(!e)return;const o=r.count,a=hm(s);if(f3e(s))for(let l=0;l<o;l++)i.getVec(l,k$),e.getVec(l,Wp),Pl(a,k$,z$,a),Vh(qn,z$),t===Qg.FROM_PCPF&&Bh(qn,qn),wc(Wp,Wp,qn),n.setVec(l,Wp);else for(let l=0;l<o;l++){i.getVec(l,k$),e.getVec(l,Wp),Pl(a,k$,z$,a),Vh(qn,z$);const c=u4(r.get(l,1));let h=Math.cos(c);t===Qg.TO_PCPF&&(h=1/h),qn[0]*=h,qn[1]*=h,qn[2]*=h,qn[3]*=h,qn[4]*=h,qn[5]*=h,t===Qg.FROM_PCPF&&Bh(qn,qn),wc(Wp,Wp,qn),ye(Wp,Wp),n.setVec(l,Wp)}return n}function HU(t){return f3e(t)||sdt(t)}function f3e(t){return t.isWGS84||$me(t)||vm(t)||bm(t)}function sdt(t){return t.isWebMercator}var Qg;(function(t){t[t.TO_PCPF=0]="TO_PCPF",t[t.FROM_PCPF=1]="FROM_PCPF"})(Qg||(Qg={}));const k$=O(),Wp=O(),z$=be(),qn=Ui();var tR;(function(t){t[t.EnableFastUpdates=0]="EnableFastUpdates",t[t.DisableFastUpdates=1]="DisableFastUpdates",t[t.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin"})(tR||(tR={}));let m3e=class{constructor(e){this.data=e,this.type="encoded-mesh-texture",this.encoding=Xg.KTX2_ENCODING}};function hw(t){return t?.type==="encoded-mesh-texture"}async function ndt(t){return new Promise((e,r)=>{const i=new Blob([t]),s=new FileReader;s.onload=()=>{const n=s.result;e(JSON.parse(n))},s.onerror=n=>{r(n)},s.readAsText(i)})}async function odt(t,e){return e===Xg.KTX2_ENCODING?new m3e(t):new Promise((r,i)=>{const s=new Blob([t],{type:e}),n=URL.createObjectURL(s),o=new Image,a=()=>{URL.revokeObjectURL(n),"decode"in o?o.decode().then(()=>r(o),()=>r(o)).then(c):(r(o),c())},l=h=>{URL.revokeObjectURL(n),i(h),c()},c=()=>{o.removeEventListener("load",a),o.removeEventListener("error",l)};o.addEventListener("load",a),o.addEventListener("error",l),o.src=n})}function Df(t){if(t==null)return null;const e=t.offset!=null?t.offset:wCe,r=t.rotation!=null?t.rotation:0,i=t.scale!=null?t.scale:xCe,s=gN(1,0,0,0,1,0,e[0],e[1],1),n=gN(Math.cos(r),-Math.sin(r),0,Math.sin(r),Math.cos(r),0,0,0,1),o=gN(i[0],0,0,0,i[1],0,0,0,1),a=$l();return nE(a,n,o),nE(a,s,a),a}Q.getLogger("esri.views.3d.layers.graphics.Graphics3DMeshObject3DGraphicLayer");let adt=class extends Cm{constructor(){super(...arguments),this._originalGeometries=[],this._fastTransformUpdatesEnabled=!1}get fastTransformUpdatesEnabled(){return this._fastTransformUpdatesEnabled}enableFastTransformUpdates(e,r){if(this._fastTransformUpdatesEnabled)return;this._fastTransformUpdatesEnabled=!0;const{stageObject:i}=this,s=i.geometries.slice();i.removeAllGeometries();const n=O7(tz,i.transformation),o=r.getOrigin(n);for(const a of s){const l=e(a.material),c=a.instantiate({material:l});c.localOrigin=o,i.addGeometry(c)}this._originalGeometries=s}disableFastTransformUpdates(e){if(!this._fastTransformUpdatesEnabled)return;this._fastTransformUpdatesEnabled=!1;const{stageObject:r}=this,i=r.geometries.map(s=>e(s.material));r.removeAllGeometries();for(let s=0;s<this._originalGeometries.length;s++){const n=this._originalGeometries[s],o=i[s];o.setParameters({modelTransformation:null}),o===n.material?r.addGeometry(n):r.addGeometry(n.instantiate({material:o}))}this._originalGeometries.length=0}updateFastLocalOrigin(e,r,i){if(!this._fastTransformUpdatesEnabled)return;const{stageObject:s}=this;if(s.geometries.length===0)return;const n=s.geometries[0].localOrigin,o=O7(tz,e),a=i.getOrigin(o);if(a===n)return;const l=r?.localMatrix??un;s.clearShaderTransformation(),s.transformation=e,s.geometries.forEach(c=>{c.transformation=l,c.localOrigin=a})}updateTransform(e,r,i){const{stageObject:s}=this,n=r?.localMatrix??un;if(!this._fastTransformUpdatesEnabled)return s.clearShaderTransformation(),s.transformation=e,s.geometries.forEach(m=>{m.transformation=n}),void this.resetEdgeObject(i);const o=s.transformation,a=s.geometries[0].transformation,l=e,c=n,h=oi(Lle,o,a),p=oi(Dle,l,c);s.shaderTransformation=l,this._setFastMaterialTransformation({matA:h,matB:p});const f=()=>c;for(const m of s.geometries)m.shaderTransformer=f;this.resetEdgeObject(i)}alignWithElevation(e,r,i,s){if(!this._fastTransformUpdatesEnabled)return void super.alignWithElevation(e,r,i,s);i!=null&&IU(this.elevationContext.featureExpressionInfoContext,i);const n=(m,y)=>dv(m,e,this.elevationContext,r,y),{stageObject:o}=this;if(!o.geometries[0].material.parameters.modelTransformation)return;const a=o.transformation,l=o.geometries[0].transformation,c=oi(Lle,a,l),h=Us(ldt,o.shaderTransformation);this.alignedSampledElevation=aw(this,this.elevationContext,e.spatialReference,n,r,h),o.shaderTransformation=h;const p=o.geometries[0].shaderTransformation,f=oi(Dle,h,p);this._setFastMaterialTransformation({matA:c,matB:f}),this.resetEdgeObject(s)}_setFastMaterialTransformation({matA:e,matB:r}){const{stageObject:i}=this;if(i.geometries.length===0)return;const s=i.geometries[0].localOrigin,n=zM(cdt,ie(tz,s.vec3,-1)),o=oi(Nle,n,e),a=oi(Fle,n,r),l=Mn(Nle,o),c=oi(Fle,a,l);for(const h of i.geometries)h.material.setParameters({modelTransformation:c})}};const tz=O(),Lle=be(),Dle=be(),ldt=be(),Nle=be(),Fle=be(),cdt=be();let udt=class{constructor(){this._fastTransformOriginalMaterials=new Map,this._fastTransformClonedMaterials=new Map,this._graphicReferenceCount=0}enable(e,r,i){e.enableFastTransformUpdates(s=>{if(this._graphicReferenceCount<=1){if(this._fastTransformOriginalMaterials.has(s))return s;const o=r.byMaterial(s);return this._fastTransformOriginalMaterials.set(s,o),r.delete(s),s}const n=new gm(s.parameters);return i.stage.add(n),this._fastTransformClonedMaterials.set(n,s),n},i.localOriginFactory)}disable(e,r,i){const s=new Set,n=new Set;e.disableFastTransformUpdates(o=>{if(!this._fastTransformClonedMaterials.has(o)){const c=o,h=this._fastTransformOriginalMaterials.get(c);return r.has(h.uid)?(s.add(c),r.byUid(h.uid).material):(n.add(c),h.material)}const a=o,l=this._fastTransformClonedMaterials.get(a);return this._fastTransformClonedMaterials.delete(a),i.stage.remove(a),a.dispose(),l});for(const o of s)this._fastTransformOriginalMaterials.delete(o),i.stage.remove(o),o.dispose();for(const o of n){const a=this._fastTransformOriginalMaterials.get(o);this._fastTransformOriginalMaterials.delete(o),r.set(a.uid,a)}}onAddGraphic(){this._graphicReferenceCount++}onRemoveGraphic(e,r,i){this._graphicReferenceCount--,this.disable(e,r,i)}forEachMaterialInfo(e){this._fastTransformOriginalMaterials.forEach(e)}forEachClonedMaterial(e){this._fastTransformClonedMaterials.forEach(e)}destroy(e){e.removeMany(Array.from(this._fastTransformClonedMaterials.keys())),e.removeMany(Array.from(this._fastTransformOriginalMaterials.values(),({material:r})=>r)),this._fastTransformClonedMaterials.clear(),this._fastTransformOriginalMaterials.clear()}},hdt=class{constructor(){this._byUid=new Map,this._byMaterial=new Map}get materials(){return Array.from(this._byUid.values(),e=>e.material)}byUid(e){return this._byUid.get(e)}byMaterial(e){return this._byMaterial.get(e)}set(e,r){this._byUid.set(e,r),this._byMaterial.set(r.material,r)}delete(e){const r=this._byMaterial.get(e)?.uid;r&&(this._byUid.delete(r),this._byMaterial.delete(e))}has(e){return this._byUid.has(e)}forEachMaterialInfo(e){this._byUid.forEach(e)}clear(){this._byUid.clear(),this._byMaterial.clear()}};function ddt(t){const e=new Sr,{vertex:r,fragment:i}=e;return e.include(Ml,t),e.include(bx,t),e.include(KCe,t),Mc(r,t),t.stippleEnabled&&(e.attributes.add(C.UV0,"vec2"),e.attributes.add(C.AUXPOS1,"vec3"),r.uniforms.add(new nr("viewport",(s,n)=>n.camera.fullViewport))),e.attributes.add(C.POSITION,"vec3"),e.varyings.add("vpos","vec3"),r.code.add(w`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),t.stippleEnabled&&(r.code.add(w`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),t.draped?r.uniforms.add(new Pe("worldToScreenRatio",(s,n)=>1/n.screenToPCSRatio)):r.code.add(w`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),r.code.add(w`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),t.draped?r.code.add(w`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):r.code.add(w`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),r.uniforms.add(new Pe("stipplePatternPixelSize",s=>IQ(s))),r.code.add(w`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`)),r.code.add(w`}`),t.output===U.Highlight&&e.include(Ly,t),e.include(ys,t),i.uniforms.add(new Pe("alphaCoverage",(s,n)=>Math.min(1,s.width*n.camera.pixelRatio))),t.hasVertexColors||i.uniforms.add(new nr("constantColor",s=>s.color)),i.code.add(w`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${t.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    ${t.output===U.ObjectAndLayerIdColor?w`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${w.float(yo)}) {
      discard;
    }

    ${t.output===U.Color?w`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===U.Highlight?w`outputHighlight();`:""}
  }
  `),e}const pdt=Object.freeze(Object.defineProperty({__proto__:null,build:ddt},Symbol.toStringTag,{value:"Module"}));let g3e=class y3e extends Lr{get _stippleEnabled(){return this.configuration.stippleEnabled&&this.configuration.output!==U.Highlight}initializeProgram(e){return new Rr(e.rctx,y3e.shader.get().build(this.configuration),Tr)}initializePipeline(){const e=this.configuration,r=Eo(xe.SRC_ALPHA,xe.ONE,xe.ONE_MINUS_SRC_ALPHA,xe.ONE_MINUS_SRC_ALPHA),i=(s,n=null,o=null)=>Mt({blending:n,depthTest:LQ,depthWrite:o,colorWrite:Gt,stencilWrite:e.hasOccludees?mm:null,stencilTest:e.hasOccludees?s?mv:Rv:null});return e.output===U.Color?(this._occludeePipelineState=i(!0,e.transparent||this._stippleEnabled?r:null,Ul),i(!1,e.transparent||this._stippleEnabled?r:null,Ul)):i(!1)}get primitiveType(){return At.LINES}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};g3e.shader=new Or(pdt,()=>ce(()=>import("./NativeLine.glsl-ea28b8ca.js"),[],import.meta.url));let Yc=class extends Vo{constructor(){super(...arguments),this.output=U.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}};u([B({count:U.COUNT})],Yc.prototype,"output",void 0),u([B()],Yc.prototype,"hasSlicePlane",void 0),u([B()],Yc.prototype,"hasVertexColors",void 0),u([B()],Yc.prototype,"transparent",void 0),u([B()],Yc.prototype,"draped",void 0),u([B()],Yc.prototype,"stippleEnabled",void 0),u([B()],Yc.prototype,"stippleOffColorEnabled",void 0),u([B()],Yc.prototype,"stipplePreferContinuous",void 0),u([B()],Yc.prototype,"hasOccludees",void 0),u([B({constValue:!1})],Yc.prototype,"stippleRequiresClamp",void 0),u([B({constValue:!1})],Yc.prototype,"stippleScaleWithLineWidth",void 0),u([B({constValue:!1})],Yc.prototype,"stippleRequiresStretchMeasure",void 0);var zF;(function(t){t[t.START=0]="START",t[t.END=1]="END"})(zF||(zF={}));let Ule=class extends Av{constructor(e){super(e,new gdt),this._configuration=new Yc}getConfiguration(e,r){this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.draped=r.slot===he.DRAPED_MATERIAL;const i=this.parameters.stipplePattern!=null;return this._configuration.stippleEnabled=i,this._configuration.stippleOffColorEnabled=i&&this.parameters.stippleOffColor!=null,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._configuration}intersect(e,r,i,s,n,o){if(!i.options.selectionMode||!e.visible)return;if(!Bxe(r))return void Q.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix");const a=e.vertexAttributes.get(C.POSITION).data,l=i.camera,c=_dt;fn(c,i.point);const h=2;se(hA[0],c[0]-h,c[1]+h,0),se(hA[1],c[0]+h,c[1]+h,0),se(hA[2],c[0]+h,c[1]-h,0),se(hA[3],c[0]-h,c[1]-h,0);for(let _=0;_<4;_++)if(!l.unprojectFromRenderScreen(hA[_],zm[_]))return;oa(l.eye,zm[0],zm[1],rz),oa(l.eye,zm[1],zm[2],iz),oa(l.eye,zm[2],zm[3],sz),oa(l.eye,zm[3],zm[0],nz);let p=Number.MAX_VALUE,f=0;for(let _=0;_<a.length-5;_+=3){if(Fa[0]=a[_]+r[12],Fa[1]=a[_+1]+r[13],Fa[2]=a[_+2]+r[14],Ua[0]=a[_+3]+r[12],Ua[1]=a[_+4]+r[13],Ua[2]=a[_+5]+r[14],pi(rz,Fa)<0&&pi(rz,Ua)<0||pi(iz,Fa)<0&&pi(iz,Ua)<0||pi(sz,Fa)<0&&pi(sz,Ua)<0||pi(nz,Fa)<0&&pi(nz,Ua)<0)continue;if(l.projectToRenderScreen(Fa,s1),l.projectToRenderScreen(Ua,n1),s1[2]<0&&n1[2]>0){de(Xp,Fa,Ua);const b=l.frustum,T=-pi(b[di.NEAR],Fa)/fe(Xp,b[di.NEAR]);ie(Xp,Xp,T),ue(Fa,Fa,Xp),l.projectToRenderScreen(Fa,s1)}else if(s1[2]>0&&n1[2]<0){de(Xp,Ua,Fa);const b=l.frustum,T=-pi(b[di.NEAR],Ua)/fe(Xp,b[di.NEAR]);ie(Xp,Xp,T),ue(Ua,Ua,Xp),l.projectToRenderScreen(Ua,n1)}else if(s1[2]<0&&n1[2]<0)continue;s1[2]=0,n1[2]=0;const v=jY(sw(s1,n1,Vle),c);v<p&&(p=v,re(kle,Fa),re(zle,Ua),f=_/3)}const m=i.rayBegin,y=i.rayEnd;if(p<h*h){let _=Number.MAX_VALUE;if(bwe(sw(kle,zle,Vle),sw(m,y,ydt),i1)){de(i1,i1,m);const v=Oe(i1);ie(i1,i1,1/v),_=v/fi(m,y)}o(_,i1,f,!1)}}intersectDraped(e,r,i,s,n,o){if(!i.options.selectionMode)return;const a=e.vertexAttributes.get(C.POSITION).data,l=e.vertexAttributes.get(C.SIZE),c=l?l.data[0]:0,h=s[0],p=s[1],f=((c+1)/2+4)*e.screenToWorldRatio;let m=Number.MAX_VALUE,y=0;for(let _=0;_<a.length-5;_+=3){const v=a[_],b=a[_+1],T=h-v,x=p-b,S=a[_+3]-v,E=a[_+4]-b,A=ve((S*T+E*x)/(S*S+E*E),0,1),R=S*A-T,M=E*A-x,D=R*R+M*M;D<m&&(m=D,y=_/3)}m<f*f&&n(o.dist,o.normal,y,!1)}requiresSlot(e,r){return!(r!==U.Color&&r!==U.Highlight&&r!==U.ObjectAndLayerIdColor||e!==he.OPAQUE_MATERIAL&&e!==he.DRAPED_MATERIAL)}createGLMaterial(e){return new fdt(e)}createBufferWriter(){const e=this.parameters.hasVertexColors?nct:ict;return this.parameters.stipplePattern==null?new yC(e):new mdt(e.clone().vec3f(C.AUXPOS1).vec2f(C.UV0))}},fdt=class extends Ev{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output===U.Color&&this._updateOccludeeState(e);const r=this._material.parameters.stipplePattern;return this._stipplePattern!==r&&(this._material.setParameters({stippleTexture:this._stippleTextureRepository.swap(r,this._stipplePattern)}),this._stipplePattern=r),this.ensureTechnique(g3e,e)}},mdt=class{constructor(e){this.vertexBufferLayout=e}elementCount(e){return e.indices.get(C.POSITION).length}write(e,r,i,s,n){eEe(i,this.vertexBufferLayout,e,r,s,n),this._writeAuxpos1(e,i,s,n),this._writeUV0(e,i,s,n)}_writeAuxpos1(e,r,i,s){const n=i.getField(C.AUXPOS1,dn),o=r.indices.get(C.POSITION),a=r.vertexAttributes.get(C.POSITION).data,l=e,c=n.typedBufferStride,h=n.typedBuffer;s*=c;for(let p=0;p<o.length-1;p+=2)for(const f of[1,0]){const m=3*o[p+f],y=a[m],_=a[m+1],v=a[m+2],b=l[0]*y+l[4]*_+l[8]*v+l[12],T=l[1]*y+l[5]*_+l[9]*v+l[13],x=l[2]*y+l[6]*_+l[10]*v+l[14];h[s]=b,h[s+1]=T,h[s+2]=x,s+=c}}_writeUV0(e,r,i,s){const n=i.getField(C.UV0,Cv),o=r.indices.get(C.POSITION),a=r.vertexAttributes.get(C.POSITION).data,l=r.vertexAttributes.get(C.DISTANCETOSTART)?.data,c=n.typedBufferStride,h=n.typedBuffer;let p=0;h[s*=c]=zF.START,h[s+1]=p,s+=c;const f=3*o[0],m=se(Fa,a[f],a[f+1],a[f+2]);e&&Fe(m,m,e);const y=Ua,_=o.length-1;let v=1;const b=l?(x,S,E)=>p=l[E]:(x,S,E)=>p+=fi(x,S);for(let x=1;x<_;x+=2){const S=3*o[x];se(y,a[S],a[S+1],a[S+2]),e&&Fe(y,y,e),b(m,y,v++);for(let E=0;E<2;++E)h[s]=1-E,h[s+1]=p,s+=c;re(m,y)}const T=3*o[_];se(y,a[T],a[T+1],a[T+2]),e&&Fe(y,y,e),b(m,y,v),h[s]=zF.END,h[s+1]=p}},gdt=class extends cQ{constructor(){super(...arguments),this.color=Ch,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.stipplePreferContinuous=!0,this.hasOccludees=!1,this.stippleTexture=null}};const Fa=O(),Ua=O(),Xp=O(),i1=O(),s1=jo(),n1=jo(),kle=O(),zle=O(),Vle=Op(),ydt=Op(),_dt=O(),hA=[jo(),jo(),jo(),jo()],zm=[O(),O(),O(),O()],rz=Nr(),iz=Nr(),sz=Nr(),nz=Nr(),vdt=["mesh"];let bdt=class extends Am{constructor(e,r,i,s){super(e,r,i,s),this._materialInfoCache=new hdt,this._fastUpdateProcessor=new udt,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){ai.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new Ule({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new Ule({color:[0,1,1,1]}))}destroy(){super.destroy(),this._context.stage.removeMany(this._materialInfoCache.materials),this._context.stage.removeMany(Array.from(this._textures.values())),this._materialInfoCache.clear(),this._textures.clear(),this._fastUpdateProcessor.destroy(this._context.stage)}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,vdt,"fill on mesh-3d"))return null;const i=this.setGraphicElevationContext(r,new Pp),s=e.renderingInfo;return this._createAs3DShape(r,s,i,r.uid)}onRemoveGraphic(e){this._fastUpdateProcessor.onRemoveGraphic(e,this._materialInfoCache,this._context)}layerOpacityChanged(e,r){const i=this._getLayerOpacity();this._updateMaterialParameters(s=>{s.material.setParameters({layerOpacity:i});const n=s.material.parameters;this._setMaterialTransparentParameter(n,s),s.material.setParameters({transparent:n.transparent})}),e.forEach(s=>{const n=r(s);n?.layerOpacityChanged(i,this._context.isAsync)})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,pv)}slicePlaneEnabledChanged(e,r){return this._updateMaterialParameters(({material:i})=>{i.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),e.forEach(i=>{const s=r(i);s?.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const e=this._usePBR();return this._updateMaterialParameters(({material:r})=>r.setParameters({usePBR:e})),!0}updateTransform(e,r,i,s){const n=this._context.renderCoordsHelper.spatialReference,o=wdt,{origin:a,transform:l}=i;switch(Pl(r,se(io,a.x,a.y,a.z??0),o,n),s){case tR.EnableFastUpdates:this._fastUpdateProcessor.enable(e,this._materialInfoCache,this._context);break;case tR.DisableFastUpdates:this._fastUpdateProcessor.disable(e,this._materialInfoCache,this._context);break;case tR.UpdateFastLocalOrigin:e.updateFastLocalOrigin(o,l,this._context.localOriginFactory)}const{elevationContext:c}=e;c.centerPointInElevationSR=this._getCenterPointInElevationSR(o);const{elevationProvider:h,renderCoordsHelper:p}=this._context,f=(m,y)=>dv(m,h,c,p,y);return e.alignedSampledElevation=aw(e,c,h.spatialReference,f,p,o),e.updateTransform(o,l,this._context.isAsync),!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(e){return e==null?"-":e instanceof Ne?e.toHex():e.contentHash}_materialPropertiesDefault(e,r){const i=this._requiresSymbolVertexColors(),s=!!e.vertexAttributes.color,n=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:i,hasVertexColors:s,hasVertexTangents:n,uid:`vc:${s},vt:${n},vct${r},svc:${i}`}}_textureTransformUid(e){const{offset:r,scale:i,rotation:s}=e??Tdt;return`${r[0]},${r[1]},${s},${i[0]},${i[1]}`}_materialProperties(e,r,i){const s=this._materialPropertiesDefault(e,i);if(!r.material)return s;const{color:n,colorTexture:o,colorTextureTransform:a,normalTexture:l,normalTextureTransform:c,doubleSided:h,alphaCutoff:p,alphaMode:f}=r.material,m=this._colorOrTextureUid(n),y=this._colorOrTextureUid(o),_=this._textureTransformUid(a),v=this._colorOrTextureUid(l),b=this._textureTransformUid(c);if(s.color=n,s.colorTexture=o,s.normalTexture=l,s.uid=`${s.uid},cmuid:${m},ctmuid:${y},cttuid:${_},ntmuid:${v},nttuid:${b},ds:${h},ac:${p},am:${f}`,r.material instanceof h3e){const{metallic:T,roughness:x,metallicRoughnessTexture:S,metallicRoughnessTextureTransform:E,emissiveColor:A,emissiveTexture:R,emissiveTextureTransform:M,occlusionTexture:D,occlusionTextureTransform:k}=r.material,$=this._colorOrTextureUid(S),N=this._textureTransformUid(E),H=this._colorOrTextureUid(A),Z=this._colorOrTextureUid(R),G=this._textureTransformUid(M),J=this._colorOrTextureUid(D),I=this._textureTransformUid(k);s.metallic=T,s.roughness=x,s.metallicRoughnessTexture=S,s.emissiveColor=A,s.emissiveTexture=R,s.occlusionTexture=D,s.colorTextureTransform=this._convertTextureTransform(a),s.normalTextureTransform=this._convertTextureTransform(c),s.emissiveTextureTransform=this._convertTextureTransform(M),s.occlusionTextureTransform=this._convertTextureTransform(k),s.metallicRoughnessTextureTransform=this._convertTextureTransform(E),s.uid=`${s.uid},mrm:${T},mrr:${x},mrt:${$},mrtt:${N},emuid:${H},etmuid:${Z},ett:${G},otmuid:${J},ott:${I}`}return s}_convertTextureTransform(e){if(!e)return null;const{scale:r,offset:i,rotation:s}=e;return{scale:r,offset:i,rotation:Ft(s)}}_setInternalColorValueParameters(e,r){r.diffuse=Ne.toUnitRGB(e),r.opacity=e.a}_getLoadableTextureResource(e){return e.data?e.data:e.url}_getInternalTextureId(e){const r=this._getInternalTexture(e,Qr.Opaque);return r!=null?r.id:null}_getInternalTexture(e,r){const i=this._getLoadableTextureResource(e);if(!i)return null;const s=`${e.contentHash}/${r}`;let n=this._textures.get(s);return n||(n=new _x(hw(i)?i.data:i,{mipmap:!0,wrap:this._castTextureWrap(e.wrap),noUnpackFlip:!0,preMultiplyAlpha:!hw(i)&&r!==Qr.Opaque,encoding:hw(i)&&i.encoding!=null?i.encoding:void 0}),this._textures.set(s,n),this._context.stage.add(n),this._context.stage.loadImmediate(n)),n}_castTextureWrap(e="repeat"){if(typeof e=="string"){const r=this._castTextureWrapIndividual(e);return{s:r,t:r}}return{s:this._castTextureWrapIndividual(e.horizontal),t:this._castTextureWrapIndividual(e.vertical)}}_castTextureWrapIndividual(e){switch(e){case"clamp":return Dt.CLAMP_TO_EDGE;case"mirror":return Dt.MIRRORED_REPEAT;default:return Dt.REPEAT}}_setInternalMaterialParameters(e,r){if(e.color!=null&&this._setInternalColorValueParameters(e.color,r),e.colorTexture!=null){const i=this._getInternalTexture(e.colorTexture,r.textureAlphaMode);i!=null?(r.textureId=i.id,r.textureAlphaPremultiplied=!!i.parameters.preMultiplyAlpha):r.textureId=void 0}e.normalTexture!=null&&(r.normalTextureId=this._getInternalTextureId(e.normalTexture)),e.emissiveColor!=null&&(r.emissiveFactor=Ne.toUnitRGB(e.emissiveColor)),e.emissiveTexture!=null&&(r.emissiveTextureId=this._getInternalTextureId(e.emissiveTexture)),e.occlusionTexture!=null&&(r.occlusionTextureId=this._getInternalTextureId(e.occlusionTexture)),e.metallicRoughnessTexture!=null&&(r.metallicRoughnessTextureId=this._getInternalTextureId(e.metallicRoughnessTexture)),r.colorTextureTransformMatrix=Df(e.colorTextureTransform),r.normalTextureTransformMatrix=Df(e.normalTextureTransform),r.occlusionTextureTransformMatrix=Df(e.occlusionTextureTransform),r.emissiveTextureTransformMatrix=Df(e.emissiveTextureTransform),r.metallicRoughnessTextureTransformMatrix=Df(e.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(e){const r=this._drivenProperties.color;let i=this.symbolLayer.material!=null?this.symbolLayer.material.colorMixMode:null;if(r)e.externalColor=Ch;else{const s=this.symbolLayer.material!=null?this.symbolLayer.material.color:null;s!=null?e.externalColor=Ne.toUnitRGBA(s):(i=null,e.externalColor=Ch)}i&&(e.colorMixMode=i),e.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(e){const r=e.vertexAttributes.color;if(r==null)return!1;for(let i=3;i<r.length;i+=4)if(r[i]!==255)return!0;return!1}_getOrCreateMaterial(e,r){const i=r.material?.color,s=r.material?.colorTexture,n=r.material?.alphaMode,o=n==="blend",a=n!=="opaque"&&(this._hasTransparentVertexColors(e)||i!=null&&i.a<1||s!=null&&s.transparent||o),l=this._materialProperties(e,r,a),c=this._materialInfoCache.byUid(l.uid);if(c)return c.material;const h={uid:l.uid,material:null,isComponentTransparent:a,alphaMode:r.material?r.material.alphaMode:"opaque"},p=NAe({normalTexture:l.normalTexture,metallicRoughnessTexture:l.metallicRoughnessTexture,metallicFactor:l.metallic,roughnessFactor:l.roughness,emissiveTexture:l.emissiveTexture,emissiveFactor:Ne.toUnitRGB(l.emissiveColor),occlusionTexture:l.occlusionTexture}),f={usePBR:this._usePBR(),isSchematic:p,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:Ka,diffuse:kg,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:mi.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};f.mrrFactors=p?[...ZQ]:[l.metallic,l.roughness,VU[2]],r.material&&(f.doubleSided=r.material.doubleSided,f.cullFace=r.material.doubleSided?mi.None:mi.Back,f.textureAlphaCutoff=r.material.alphaCutoff),this._setExternalMaterialParameters(f),this._setMaterialTransparentParameter(f,h),this._setInternalMaterialParameters(l,f);const m=new gm(f);return h.material=m,this._materialInfoCache.set(l.uid,h),this._context.stage.add(m),m}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(e,r){e.transparent=this.needsDrivenTransparentPass||r.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,r.alphaMode==="auto"?e.textureAlphaMode=e.transparent?Qr.MaskBlend:Qr.Opaque:e.textureAlphaMode=r.alphaMode==="opaque"?Qr.Opaque:r.alphaMode==="mask"?Qr.Mask:Qr.Blend}_addDebugNormals(e,r){const i=r.length,s=e.spatialReference.isGeographic?20015077/180:1,n=.1*Math.max(e.extent.width*s,e.extent.height*s,e.extent.zmax-e.extent.zmin),o=[],a=[],l=[],c=[];for(let m=0;m<i;m++){const y=r[m],_=y.vertexAttributes.get(C.POSITION),v=y.vertexAttributes.get(C.NORMAL),b=y.indices.get(C.POSITION),T=y.indices.get(C.NORMAL),x=_.data,S=v.data;for(let E=0;E<b.length;E++){const A=3*b[E],R=3*T[E];for(let M=0;M<3;M++)o.push(x[A+M]);for(let M=0;M<3;M++)o.push(x[A+M]+S[R+M]*n);if(a.push(a.length),a.push(a.length),E%3==0){this._calculateFaceNormal(x,b,E,dT),this._getFaceVertices(x,b,E,io,uT,hT),ue(io,io,uT),ue(io,io,hT),ie(io,io,1/3);for(let M=0;M<3;M++)l.push(io[M]);for(let M=0;M<3;M++)l.push(io[M]+dT[M]*n);c.push(c.length),c.push(c.length)}}}const h=r[0].transformation,p=new Ys(this._debugVertexNormalMaterial,[[C.POSITION,new He(o,3,!0)]],[[C.POSITION,a]],null,ls.Line);r.push(p),p.transformation=h;const f=new Ys(this._debugFaceNormalMaterial,[[C.POSITION,new He(l,3,!0)]],[[C.POSITION,c]],null,ls.Line);f.transformation=h,r.push(f)}_createAs3DShape(e,r,i,s){const n=e.geometry;if(n.type!=="mesh")return null;const o=this._createGeometryInfo(n,r,s);if(o==null)return null;const{geometries:a,objectTransformation:l}=o;ai.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(n,a);const c=new Ny({geometries:a,layerUid:this._context.layer.uid,graphicUid:s});c.transformation=l;const h=Pbe(this.symbolLayer,{opacity:this._getLayerOpacity()}),p=h!=null?new Qot(a[0].material,[h],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null,f=new adt(this,c,a,null,null,aw,i,p);this._fastUpdateProcessor.onAddGraphic(),f.needsElevationUpdates=pv(i.mode),f.useObjectOriginAsAttachmentOrigin=!0,i.centerPointInElevationSR=this._getCenterPointInElevationSR(c.transformation);const{elevationProvider:m,renderCoordsHelper:y}=this._context,_=(v,b)=>dv(v,m,i,y,b);return f.alignedSampledElevation=aw(f,i,m.spatialReference,_,y),f}_getCenterPointInElevationSR(e){const r=vx(0,0,0,this._context.elevationProvider.spatialReference!=null?this._context.elevationProvider.spatialReference:null);return vY([e[12],e[13],e[14]],this._context.renderCoordsHelper.spatialReference,r),r}_createComponentNormals(e,r,i,s){switch(i.shading||"flat"){default:case"source":return this._createComponentNormalsSource(e,r,i,s);case"flat":return this._createComponentNormalsFlat(e,s);case"smooth":return this._createComponentNormalsSmooth(e,s)}}_createComponentNormalsSource(e,r,i,s){if(r==null)return this._createComponentNormalsFlat(e,s);let n=!1;if(!i.trustSourceNormals)for(let o=0;o<s.length;o+=3){this._calculateFaceNormal(e,s,o,dT);for(let a=0;a<3;a++){const l=3*s[o+a];io[0]=r[l],io[1]=r[l+1],io[2]=r[l+2],fe(dT,io)<0&&(r[l]=-r[l],r[l+1]=-r[l+1],r[l+2]=-r[l+2],n=!0)}}return new oz(r,s,n)}_createComponentNormalsFlat(e,r){const i=Ki(r.length),s=new Array(3*r.length);for(let n=0;n<r.length;n+=3){const o=this._calculateFaceNormal(e,r,n,dT);for(let a=0;a<3;a++)i[n+a]=o[a],s[n+a]=n/3}return new oz(i,s,!1)}_createComponentNormalsSmooth(e,r){const i={};for(let o=0;o<r.length;o+=3){const a=this._calculateFaceNormal(e,r,o,dT);for(let l=0;l<3;l++){const c=r[o+l];let h=i[c];h||(h={normal:O(),count:0},i[c]=h),ue(h.normal,h.normal,a),h.count++}}const s=Ki(3*r.length),n=new Array(3*r.length);for(let o=0;o<r.length;o++){const a=i[r[o]];a.count!==1&&(ye(a.normal,a.normal),a.count=1);for(let l=0;l<3;l++)s[3*o+l]=a.normal[l];n[o]=o}return new oz(s,n,!1)}_getFaceVertices(e,r,i,s,n,o){const a=3*r[i],l=3*r[i+1],c=3*r[i+2];s[0]=e[a],s[1]=e[a+1],s[2]=e[a+2],n[0]=e[l],n[1]=e[l+1],n[2]=e[l+2],o[0]=e[c],o[1]=e[c+1],o[2]=e[c+2]}_calculateFaceNormal(e,r,i,s){return this._getFaceVertices(e,r,i,io,uT,hT),de(uT,uT,io),de(hT,hT,io),ht(io,uT,hT),ye(s,io),s}_getOrCreateComponents(e){return e.components??xdt}_createPositionBuffer(e,r){let i=e.vertexAttributes.position;const s=r.reprojection===nc.ECEF?r.transformBeforeProject:null;if(s!=null&&(i=OE(new Float64Array(i.length),i,s)),r.reprojection===nc.NONE)return r.needsBufferCopy?new Float64Array(i):i;const n=s!=null?i:new Float64Array(i.length);return li(i,e.spatialReference,0,n,this._context.renderCoordsHelper.spatialReference,0,i.length/3),n}_createNormalBuffer(e,r,i){let s=e.vertexAttributes.normal;if(s==null)return null;const n=i.reprojection===nc.ECEF?i.transformBeforeProject:null;if(n!=null&&(s=tdt(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||i.reprojection===nc.NONE)return i.needsBufferCopy&&e.vertexAttributes.normal===s?new Float32Array(s):s;const o=e.vertexAttributes.position,a=n!=null?s:new Float32Array(s.length);return edt(s,o,r,e.spatialReference,a)}_createTangentBuffer(e,r,i){let s=e.vertexAttributes.tangent;if(s==null)return null;const n=i.reprojection===nc.ECEF?i.transformBeforeProject:null;if(n!=null&&(s=rdt(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||i.reprojection===nc.NONE)return i.needsBufferCopy&&e.vertexAttributes.normal===s?new Float32Array(s):s;const o=e.vertexAttributes.position,a=n!=null?s:new Float32Array(s.length);return idt(s,o,r,e.spatialReference,a)}_createColorBuffer(e){return e.vertexAttributes.color}_createSymbolColorBuffer(e){if(this._requiresSymbolVertexColors()){const r=this._getVertexOpacityAndColor(e),i=Lbe(this.symbolLayer?.material?.colorMixMode),s=new Uint8Array(4);return Dbe(r,i,s),s}return null}_createBuffers(e,r){const i=e.vertexAttributes&&e.vertexAttributes.position;if(!i)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const s=e.vertexAttributes.normal,n=e.vertexAttributes.uv,o=e.vertexAttributes.tangent;if(s!=null&&s.length!==i.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(o!=null&&o.length/4!=i.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(n!=null&&n.length/2!=i.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const a=this._computeReprojectionInfo(e),l=this._createPositionBuffer(e,a),c=this._createColorBuffer(e),h=this._createSymbolColorBuffer(r),p=this._createNormalBuffer(e,l,a),f=this._createTangentBuffer(e,l,a);return{positionBuffer:l,normalBuffer:p,tangentBuffer:f,uvBuffer:n,colorBuffer:c,symbolColorBuffer:h,objectTransformation:a.reprojection===nc.NONE&&a.objectTransformation!=null?a.objectTransformation:this._transformOriginLocal(e,l,p,f),geometryTransformation:a.reprojection===nc.NONE&&a.geometryTransformation!=null?a.geometryTransformation:be()}}_computeReprojectionInfo(e){const{vertexSpace:r}=e,i=r.isRelative,s=r.isGeoreferenced?this._context.renderCoordsHelper.viewingMode===Ue.Local?nc.NONE:nc.ECEF:nc.NONE;if(i){const{origin:n}=r,o=be(),a=e.transform?.localMatrix??un;if(s===nc.NONE)return Pl(e.spatialReference,n,o,this._context.renderCoordsHelper.spatialReference),{reprojection:s,objectTransformation:o,geometryTransformation:oE(a),needsBufferCopy:!1};const l=zM(be(),n);return oi(l,l,a),{reprojection:s,transformBeforeProject:l,needsBufferCopy:!0}}return{reprojection:s,needsBufferCopy:!0}}_transformOriginLocal(e,r,i,s){const n=this._context.renderCoordsHelper.spatialReference,o=e.anchor;V$[0]=o.x,V$[1]=o.y,V$[2]=o.z??0;const a=be();return Pl(e.spatialReference,V$,a,n),Mn(Ble,a),OE(r,r,Ble),i==null&&s==null||(Vh(dA,a),Bh(dA,dA),i!=null&&Vw(i,i,dA),s!=null&&Vw(s,s,dA,4)),a}_validateFaces(e,r){const i=e.vertexAttributes.position.length/3,s=r.faces;if(s){let n=-1;for(let o=0;o<s.length;o++){const a=s[o];a>n&&(n=a)}if(i<=n)return this.logger.warn(`Vertex index ${n} is out of bounds of the mesh position buffer`),!1}else if(i%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(e,r){return r.faces??yE(e.vertexAttributes.position.length/3)}_isOutsideClippingArea(e){if(!this._context.clippingExtent)return!1;const r=e.vertexAttributes&&e.vertexAttributes.position;if(!r)return!1;const i=this._context.elevationProvider.spatialReference;let s;const n=r.length/3;return i==null||e.spatialReference.equals(i)?s=r:(s=new Float64Array(r.length),li(e.vertexAttributes.position,e.spatialReference,0,s,i,0,n)),Si(az),gu(az,s,0,n),!np(az,this._context.clippingExtent)}_createGeometryInfo(e,r,i){if(!lm(e.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(e))return null;const s=this._createBuffers(e,r);if(s==null)return null;const{positionBuffer:n,uvBuffer:o,colorBuffer:a,symbolColorBuffer:l,normalBuffer:c,tangentBuffer:h,objectTransformation:p,geometryTransformation:f}=s,m=this._getOrCreateComponents(e),y=new Array;let _=!1;for(const v of m){if(!this._validateFaces(e,v))return null;const b=this._getOrCreateFaces(e,v);if(b.length===0)continue;const T=this._createComponentNormals(n,c,v,b);T.didFlipNormals&&(_=!0);const x=[[C.POSITION,new He(n,3,!0)],[C.NORMAL,new He(T.normals,3,!0)]],S=[[C.POSITION,b],[C.NORMAL,T.indices]];a!=null&&(x.push([C.COLOR,new He(a,4,!0)]),S.push([C.COLOR,b])),l!=null&&(x.push([C.SYMBOLCOLOR,new He(l,4,!0)]),S.push([C.SYMBOLCOLOR,uC(b.length)])),o!=null&&(x.push([C.UV0,new He(o,2,!0)]),S.push([C.UV0,b])),h!=null&&(x.push([C.TANGENT,new He(h,4,!0)]),S.push([C.TANGENT,b]));const E=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:i,layerUid:this._context.layer.uid}),A=this._getOrCreateMaterial(e,v),R=new Ys(A,x,S,null,ls.Mesh,E);R.transformation=f,y.push(R)}return _&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:y,objectTransformation:p}}_updateMaterialParameters(e){this._materialInfoCache.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachClonedMaterial((r,i)=>{i.setParameters(r.parameters)})}test(){return{...super.test(),materials:this._materialInfoCache.materials}}};class oz{constructor(e,r,i){this.normals=e,this.indices=r,this.didFlipNormals=i}}const V$=O(),io=O(),uT=O(),hT=O(),dT=O(),Ble=be(),dA=Ui(),wdt=be(),az=pn(),xdt=[new Kht],Tdt=new R2;var nc;(function(t){t[t.NONE=0]="NONE",t[t.ECEF=1]="ECEF"})(nc||(nc={}));let Sdt=class{constructor(e,r,i,s){this.graphics3DSymbolLayer=e,this.instanceIndex=r,this.elevationAligner=i,this.elevationContext=s,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(e){const r=this._lodRenderer.instanceData;e!==r.getVisible(this.instanceIndex)&&r.setVisible(this.instanceIndex,e)}destroy(){this.instanceIndex!=null&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(e,r,i){if(this.elevationAligner){IU(this.elevationContext.featureExpressionInfoContext,i);const s=(o,a)=>dv(o,e,this.elevationContext,r,a),n=this.elevationAligner(this,this.elevationContext,e.spatialReference,s,r);n!=null&&(this.alignedSampledElevation=n)}}getCenterObjectSpace(e=O()){return this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Zp),Fe(e,this._lodRenderer.baseBoundingSphere.center,Zp)}getBoundingBoxObjectSpace(e=pn()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Zp);const r=this._lodRenderer.baseBoundingBox;Si(e);for(let i=0;i<8;++i)se(ju,1&i?r[3]:r[0],2&i?r[4]:r[1],4&i?r[5]:r[2]),Fe(ju,ju,Zp),am(e,ju);return e}computeAttachmentOrigin(e){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Zp),e.render.origin[0]+=Zp[12],e.render.origin[1]+=Zp[13],e.render.origin[2]+=Zp[14],e.render.num++}async getProjectedBoundingBox(e,r,i,s,n){const o=this.getBoundingBoxObjectSpace(n),a=Edt,l=$Z(o)?1:a.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Zp);for(let h=0;h<l;h++){const p=a[h];ju[0]=o[p[0]],ju[1]=o[p[1]],ju[2]=o[p[2]],Fe(ju,ju,Zp),o1[3*h]=ju[0],o1[3*h+1]=ju[1],o1[3*h+2]=ju[2]}if(!e(o1,0,l))return null;Si(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let p=0;p<3;p++)o[p]=Math.min(o[p],o1[h+p]),o[p+3]=Math.max(o[p+3],o1[h+p]);c&&i.push({location:o1.slice(h,h+3),screenSpaceBoundingRect:c})}if(r&&(sp(o,lz),this.elevationContext.mode!=="absolute-height")){let h;const p=vQ(o,r.service.spatialReference,r);try{h=await r.service.queryElevation(lz[0],lz[1],s,p,"ground")}catch{}h!=null&&I0e(o,0,0,-this.alignedSampledElevation+h)}return o}addObjectState(e,r){if(e===my.Highlight){const i=new uF(e);this._addHighlightId(i),r.addExternal(s=>{this._removeHighlightId(s)},i)}}removeObjectState(e){this._highlights.forEach(r=>e.remove(r))}_addHighlightId(e){this._highlights.add(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(e){this._highlights.delete(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}};const o1=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ju=O(),lz=O(),Edt=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],Zp=be();function Cdt(t){const e=new Array;return t.stageResources.geometries.forEach(r=>{const i=t.stageResources.textures;e.push(new uCe(r,i))}),{components:e,minScreenSpaceRadius:t.lodThreshold??0,pivotOffset:t.pivotOffset}}function Adt(t){return{levels:t.map(e=>Cdt(e))}}function Odt(t){return t=t||globalThis.location.hostname,Rdt.some(e=>t?.match(e)!=null)}function Yq(t,e){return t&&(e=e||globalThis.location.hostname)?e.match(_3e)!=null||e.match(b3e)!=null?t.replace("static.arcgis.com","staticdev.arcgis.com"):e.match(v3e)!=null||e.match(w3e)!=null?t.replace("static.arcgis.com","staticqa.arcgis.com"):t:t}const _3e=/^devext.arcgis.com$/,v3e=/^qaext.arcgis.com$/,b3e=/^[\w-]*\.mapsdevext.arcgis.com$/,w3e=/^[\w-]*\.mapsqa.arcgis.com$/,Rdt=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,_3e,v3e,/^jsapps.esri.com$/,b3e,w3e];function Mdt(t,e,r){if(t.count!==e.count)return void LU.error("source and destination buffers need to have the same number of elements");const i=t.count,s=r[0],n=r[1],o=r[2],a=r[3],l=r[4],c=r[5],h=r[6],p=r[7],f=r[8],m=r[9],y=r[10],_=r[11],v=r[12],b=r[13],T=r[14],x=r[15],S=t.typedBuffer,E=t.typedBufferStride,A=e.typedBuffer,R=e.typedBufferStride;for(let M=0;M<i;M++){const D=M*E,k=M*R,$=A[k],N=A[k+1],H=A[k+2],Z=A[k+3];S[D]=s*$+l*N+f*H+v*Z,S[D+1]=n*$+c*N+m*H+b*Z,S[D+2]=o*$+h*N+y*H+T*Z,S[D+3]=a*$+p*N+_*H+x*Z}}function Pdt(t,e,r){QQ(t.typedBuffer,e.typedBuffer,r,t.typedBufferStride,e.typedBufferStride)}function QQ(t,e,r,i=4,s=i){if(t.length/i!=e.length/s)return void LU.error("source and destination buffers need to have the same number of elements");const n=t.length/i,o=r[0],a=r[1],l=r[2],c=r[3],h=r[4],p=r[5],f=r[6],m=r[7],y=r[8];let _=0,v=0;for(let b=0;b<n;b++){const T=e[_],x=e[_+1],S=e[_+2],E=e[_+3];t[v]=o*T+c*x+f*S,t[v+1]=a*T+h*x+m*S,t[v+2]=l*T+p*x+y*S,t[v+3]=E,_+=s,v+=i}}function Idt(t,e){const r=Math.min(t.count,e.count),i=t.typedBuffer,s=t.typedBufferStride,n=e.typedBuffer,o=e.typedBufferStride;for(let a=0;a<r;a++){const l=a*s,c=a*o,h=n[c],p=n[c+1],f=n[c+2],m=h*h+p*p+f*f;if(m>0){const y=1/Math.sqrt(m);i[l]=y*h,i[l+1]=y*p,i[l+2]=y*f}}}function $dt(t,e,r){VF(t.typedBuffer,e,r,t.typedBufferStride)}function VF(t,e,r,i=4){const s=Math.min(t.length/i,e.count),n=e.typedBuffer,o=e.typedBufferStride;let a=0,l=0;for(let c=0;c<s;c++)t[l]=r*n[a],t[l+1]=r*n[a+1],t[l+2]=r*n[a+2],t[l+3]=r*n[a+3],a+=o,l+=i}Object.freeze(Object.defineProperty({__proto__:null,normalize:Idt,scale:VF,scaleView:$dt,transformMat3:QQ,transformMat3View:Pdt,transformMat4:Mdt},Symbol.toStringTag,{value:"Module"}));function Ldt(t,e){KQ(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function KQ(t,e,r=2,i=r){const s=e.length/2;let n=0,o=0;if(vp(e)||HIe(e)){for(let l=0;l<s;++l)t[n]=e[o],t[n+1]=e[o+1],n+=r,o+=i;return}const a=qIe(e);if(jIe(e))for(let l=0;l<s;++l)t[n]=Math.max(e[o]/a,-1),t[n+1]=Math.max(e[o+1]/a,-1),n+=r,o+=i;else for(let l=0;l<s;++l)t[n]=e[o]/a,t[n+1]=e[o+1]/a,n+=r,o+=i}function Ddt(t,e,r,i){const s=t.typedBuffer,n=t.typedBufferStride,o=i?.count??t.count;let a=(i?.dstIndex??0)*n;for(let l=0;l<o;++l)s[a]=e,s[a+1]=r,a+=n}Object.freeze(Object.defineProperty({__proto__:null,fill:Ddt,normalizeIntegerBuffer:KQ,normalizeIntegerBufferView:Ldt},Symbol.toStringTag,{value:"Module"}));function Ndt(t,e){fP(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function fP(t,e,r=3,i=r){const s=e.length/i;let n=0,o=0;for(let a=0;a<s;++a)t[n]=e[o],t[n+1]=e[o+1],t[n+2]=e[o+2],n+=r,o+=i}function Fdt(t,e,r,i,s){const n=t.typedBuffer,o=t.typedBufferStride,a=s?.count??t.count;let l=(s?.dstIndex??0)*o;for(let c=0;c<a;++c)n[l]=e,n[l+1]=r,n[l+2]=i,l+=o}Object.freeze(Object.defineProperty({__proto__:null,copy:fP,copyView:Ndt,fill:Fdt},Symbol.toStringTag,{value:"Module"}));function Udt(t,e){eK(t.typedBuffer,e,t.typedBufferStride)}function eK(t,e,r=4){const i=e.typedBuffer,s=e.typedBufferStride,n=e.count;let o=0,a=0;for(let l=0;l<n;++l)t[o]=i[a],t[o+1]=i[a+1],t[o+2]=i[a+2],t[o+3]=i[a+3],o+=r,a+=s}function kdt(t,e,r,i,s,n){const o=t.typedBuffer,a=t.typedBufferStride,l=n?.count??t.count;let c=(n?.dstIndex??0)*a;for(let h=0;h<l;++h)o[c]=e,o[c+1]=r,o[c+2]=i,o[c+3]=s,c+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:eK,copyView:Udt,fill:kdt},Symbol.toStringTag,{value:"Module"}));let x3e=class{constructor(e){this._streamDataRequester=e}async loadJSON(e,r){return this._load("json",e,r)}async loadBinary(e,r){return _m(e)?(Yt(r),EX(e)):this._load("binary",e,r)}async loadImage(e,r){return this._load("image",e,r)}async _load(e,r,i){if(this._streamDataRequester==null)return(await hr(r,{responseType:zdt[e]})).data;const s=await Eu(this._streamDataRequester.request(r,e,i));if(s.ok===!0)return s.value;throw Fo(s.error),new V("",`Request for resource failed: ${s.error}`)}};const zdt={image:"image",binary:"array-buffer",json:"json","image+type":void 0};function Vdt(t={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...t}}function Bdt(t,e={}){return{data:t,parameters:{wrap:{s:Dt.REPEAT,t:Dt.REPEAT,...e.wrap},noUnpackFlip:!0,mipmap:!1,...e}}}function vN(t,e){const r=t.count;e||(e=new t.TypedArrayConstructor(r));for(let i=0;i<r;i++)e[i]=t.get(i);return e}Object.freeze(Object.defineProperty({__proto__:null,makeDense:vN},Symbol.toStringTag,{value:"Module"}));let Gle=class{constructor(e){this._data=e,this._offset4=0,this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const e=this._offset4;return this._offset4+=1,this._dataUint32[e]}readUint8Array(e){const r=4*this._offset4;return this._offset4+=e/4,new Uint8Array(this._data,r,e)}remainingBytes(){return this._data.byteLength-4*this._offset4}};var rR,jle;(function(t){t.SCALAR="SCALAR",t.VEC2="VEC2",t.VEC3="VEC3",t.VEC4="VEC4",t.MAT2="MAT2",t.MAT3="MAT3",t.MAT4="MAT4"})(rR||(rR={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(jle||(jle={}));const T3e={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},Gdt={pbrMetallicRoughness:T3e,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},jdt={ESRI_externalColorMixMode:"tint"},Hle=(t={})=>{const e={...T3e,...t.pbrMetallicRoughness},r=Hdt({...jdt,...t.extras});return{...Gdt,...t,pbrMetallicRoughness:e,extras:r}};function Hdt(t){switch(t.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:t.ESRI_externalColorMixMode,t.ESRI_externalColorMixMode="tint"}return t}const qdt={magFilter:Rt.LINEAR,minFilter:Rt.LINEAR_MIPMAP_LINEAR,wrapS:Dt.REPEAT,wrapT:Dt.REPEAT},Wdt=t=>({...qdt,...t});function Xdt(t){let e,r;return t.replace(/^(.*\/)?([^/]*)$/,(i,s,n)=>(e=s||"",r=n||"","")),{dirPart:e,filePart:r}}const B$={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};let Zdt=class Q0{constructor(e,r,i,s){if(this._context=e,this.uri=r,this.json=i,this._glbBuffer=s,this._bufferLoaders=new Map,this._textureLoaders=new Map,this._textureCache=new Map,this._materialCache=new Map,this._nodeParentMap=new Map,this._nodeTransformCache=new Map,this._supportedExtensions=["KHR_texture_basisu"],this._baseUri=Xdt(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),i.scenes==null)throw new V("gltf-loader-unsupported-feature","Scenes must be defined.");if(i.meshes==null)throw new V("gltf-loader-unsupported-feature","Meshes must be defined");if(i.nodes==null)throw new V("gltf-loader-unsupported-feature","Nodes must be defined.");this._computeNodeParents()}static async load(e,r,i){if(_m(r)){const o=yw(r);if(o&&o.mediaType!=="model/gltf-binary")try{const l=JSON.parse(o.isBase64?atob(o.data):o.data);return new Q0(e,r,l)}catch{}const a=EX(r);if(Q0._isGLBData(a))return this._fromGLBData(e,r,a)}if(r.endsWith(".gltf")){const o=await e.loadJSON(r,i);return new Q0(e,r,o)}const s=await e.loadBinary(r,i);if(Q0._isGLBData(s))return this._fromGLBData(e,r,s);const n=await e.loadJSON(r,i);return new Q0(e,r,n)}static _isGLBData(e){if(e==null)return!1;const r=new Gle(e);return r.remainingBytes()>=4&&r.readUint32()===B$.MAGIC}static async _fromGLBData(e,r,i){const s=await Q0._parseGLBData(i);return new Q0(e,r,s.json,s.binaryData)}static async _parseGLBData(e){const r=new Gle(e);if(r.remainingBytes()<12)throw new V("gltf-loader-error","GLB binary data is insufficiently large.");const i=r.readUint32(),s=r.readUint32(),n=r.readUint32();if(i!==B$.MAGIC)throw new V("gltf-loader-error","Magic first 4 bytes do not fit to expected GLB value.");if(e.byteLength<n)throw new V("gltf-loader-error","GLB binary data is smaller than header specifies.");if(s!==2)throw new V("gltf-loader-unsupported-feature","An unsupported GLB container version was detected. Only version 2 is supported.");let o,a,l=0;for(;r.remainingBytes()>=8;){const c=r.readUint32(),h=r.readUint32();if(l===0){if(h!==B$.CHUNK_TYPE_JSON)throw new V("gltf-loader-error","First GLB chunk must be JSON.");if(c<0)throw new V("gltf-loader-error","No JSON data found.");o=await ndt(r.readUint8Array(c))}else if(l===1){if(h!==B$.CHUNK_TYPE_BIN)throw new V("gltf-loader-unsupported-feature","Second GLB chunk expected to be BIN.");a=r.readUint8Array(c)}else Q.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 GLB chunks detected. Skipping.");l+=1}if(!o)throw new V("gltf-loader-error","No GLB JSON chunk detected.");return{json:o,binaryData:a}}async getBuffer(e,r){const i=this.json.buffers[e];if(i.uri==null){if(this._glbBuffer==null)throw new V("gltf-loader-error","GLB buffer not present");return this._glbBuffer}const s=await this._getBufferLoader(e,r);if(s.byteLength!==i.byteLength)throw new V("gltf-loader-error","Buffer byte lengths should match.");return s}async _getBufferLoader(e,r){const i=this._bufferLoaders.get(e);if(i)return i;const s=this.json.buffers[e].uri,n=this._context.loadBinary(this._resolveUri(s),r).then(o=>new Uint8Array(o));return this._bufferLoaders.set(e,n),n}async getAccessor(e,r){if(!this.json.accessors)throw new V("gltf-loader-unsupported-feature","Accessors missing.");const i=this.json.accessors[e];if(i?.bufferView==null)throw new V("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(i.type in[rR.MAT2,rR.MAT3,rR.MAT4])throw new V("gltf-loader-unsupported-feature",`AttributeType ${i.type} is not supported`);const s=this.json.bufferViews[i.bufferView],n=await this.getBuffer(s.buffer,r),o=Qdt[i.type],a=Kdt[i.componentType],l=o*a,c=s.byteStride||l;return{raw:n.buffer,byteStride:c,byteOffset:n.byteOffset+(s.byteOffset||0)+(i.byteOffset||0),entryCount:i.count,isDenselyPacked:c===l,componentCount:o,componentByteSize:a,componentType:i.componentType,min:i.min,max:i.max,normalized:!!i.normalized}}async getIndexData(e,r){if(e.indices==null)return;const i=await this.getAccessor(e.indices,r);if(i.isDenselyPacked)switch(i.componentType){case rt.UNSIGNED_BYTE:return new Uint8Array(i.raw,i.byteOffset,i.entryCount);case rt.UNSIGNED_SHORT:return new Uint16Array(i.raw,i.byteOffset,i.entryCount);case rt.UNSIGNED_INT:return new Uint32Array(i.raw,i.byteOffset,i.entryCount)}else switch(i.componentType){case rt.UNSIGNED_BYTE:return vN(this._wrapAccessor(gE,i));case rt.UNSIGNED_SHORT:return vN(this._wrapAccessor(cU,i));case rt.UNSIGNED_INT:return vN(this._wrapAccessor(hU,i))}}async getPositionData(e,r){if(e.attributes.POSITION==null)throw new V("gltf-loader-unsupported-feature","No POSITION vertex data found.");const i=await this.getAccessor(e.attributes.POSITION,r);if(i.componentType!==rt.FLOAT)throw new V("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+rt[i.componentType]);if(i.componentCount!==3)throw new V("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+i.componentCount.toFixed());return this._wrapAccessor(dn,i)}async getNormalData(e,r){if(e.attributes.NORMAL==null)throw new V("gltf-loader-error","No NORMAL vertex data found.");const i=await this.getAccessor(e.attributes.NORMAL,r);if(i.componentType!==rt.FLOAT)throw new V("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+rt[i.componentType]);if(i.componentCount!==3)throw new V("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+i.componentCount.toFixed());return this._wrapAccessor(dn,i)}async getTangentData(e,r){if(e.attributes.TANGENT==null)throw new V("gltf-loader-error","No TANGENT vertex data found.");const i=await this.getAccessor(e.attributes.TANGENT,r);if(i.componentType!==rt.FLOAT)throw new V("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+rt[i.componentType]);if(i.componentCount!==4)throw new V("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+i.componentCount.toFixed());return new Ep(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*i.entryCount)}async getTextureCoordinates(e,r){if(e.attributes.TEXCOORD_0==null)throw new V("gltf-loader-error","No TEXCOORD_0 vertex data found.");const i=await this.getAccessor(e.attributes.TEXCOORD_0,r);if(i.componentCount!==2)throw new V("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+i.componentCount.toFixed());if(i.componentType===rt.FLOAT)return this._wrapAccessor(Cv,i);if(!i.normalized)throw new V("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return ept(i)}async getVertexColors(e,r){if(e.attributes.COLOR_0==null)throw new V("gltf-loader-error","No COLOR_0 vertex data found.");const i=await this.getAccessor(e.attributes.COLOR_0,r);if(i.componentCount!==4&&i.componentCount!==3)throw new V("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+i.componentCount.toFixed());if(i.componentCount===4){if(i.componentType===rt.FLOAT)return this._wrapAccessor(Ep,i);if(i.componentType===rt.UNSIGNED_BYTE)return this._wrapAccessor(ga,i);if(i.componentType===rt.UNSIGNED_SHORT)return this._wrapAccessor(YM,i)}else if(i.componentCount===3){if(i.componentType===rt.FLOAT)return this._wrapAccessor(dn,i);if(i.componentType===rt.UNSIGNED_BYTE)return this._wrapAccessor(lU,i);if(i.componentType===rt.UNSIGNED_SHORT)return this._wrapAccessor(uU,i)}throw new V("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+rt[i.componentType])}hasPositions(e){return e.attributes.POSITION!==void 0}hasNormals(e){return e.attributes.NORMAL!==void 0}hasVertexColors(e){return e.attributes.COLOR_0!==void 0}hasTextureCoordinates(e){return e.attributes.TEXCOORD_0!==void 0}hasTangents(e){return e.attributes.TANGENT!==void 0}async getMaterial(e,r,i){let s=e.material?this._materialCache.get(e.material):void 0;if(!s){const n=e.material!=null?Hle(this.json.materials[e.material]):Hle(),o=n.pbrMetallicRoughness,a=this.hasVertexColors(e),l=this.getTexture(o.baseColorTexture,r),c=this.getTexture(n.normalTexture,r),h=i?this.getTexture(n.occlusionTexture,r):void 0,p=i?this.getTexture(n.emissiveTexture,r):void 0,f=i?this.getTexture(o.metallicRoughnessTexture,r):void 0,m=e.material!=null?e.material:-1;s={alphaMode:n.alphaMode,alphaCutoff:n.alphaCutoff,color:o.baseColorFactor,doubleSided:!!n.doubleSided,colorTexture:await l,normalTexture:await c,name:n.name,id:m,occlusionTexture:await h,emissiveTexture:await p,emissiveFactor:n.emissiveFactor,metallicFactor:o.metallicFactor,roughnessFactor:o.roughnessFactor,metallicRoughnessTexture:await f,hasVertexColors:a,ESRI_externalColorMixMode:n.extras.ESRI_externalColorMixMode,colorTextureTransform:o?.baseColorTexture?.extensions?.KHR_texture_transform,normalTextureTransform:n.normalTexture?.extensions?.KHR_texture_transform,occlusionTextureTransform:n.occlusionTexture?.extensions?.KHR_texture_transform,emissiveTextureTransform:n.emissiveTexture?.extensions?.KHR_texture_transform,metallicRoughnessTextureTransform:o?.metallicRoughnessTexture?.extensions?.KHR_texture_transform}}return s}async getTexture(e,r){if(!e)return;if((e.texCoord||0)!==0)throw new V("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");const i=e.index,s=this.json.textures[i],n=Wdt(s.sampler!=null?this.json.samplers[s.sampler]:{}),o=this._getTextureSourceId(s),a=this.json.images[o],l=await this._loadTextureImageData(i,s,r);return qfe(this._textureCache,i,()=>{const c=p=>p===33071||p===33648||p===10497,h=p=>{throw new V("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${p}`)};return{data:l,wrapS:c(n.wrapS)?n.wrapS:h(n.wrapS),wrapT:c(n.wrapT)?n.wrapT:h(n.wrapT),minFilter:n.minFilter,name:a.name,id:i}})}getNodeTransform(e){if(e===void 0)return Ydt;let r=this._nodeTransformCache.get(e);if(!r){const i=this.getNodeTransform(this._getNodeParent(e)),s=this.json.nodes[e];s.matrix?r=oi(be(),i,s.matrix):s.translation||s.rotation||s.scale?(r=oE(i),s.translation&&Fl(r,r,s.translation),s.rotation&&(G$[3]=LY(G$,s.rotation),xc(r,r,G$[3],G$)),s.scale&&T6(r,r,s.scale)):r=oE(i),this._nodeTransformCache.set(e,r)}return r}_wrapAccessor(e,r){return new e(r.raw,r.byteOffset,r.byteStride,r.byteOffset+r.byteStride*(r.entryCount-1)+r.componentByteSize*r.componentCount)}_resolveUri(e){return du(e,this._baseUri)}_getNodeParent(e){return this._nodeParentMap.get(e)}_checkVersionSupported(){const e=Ow.parse(this.json.asset.version,"glTF");Jdt.validate(e)}_checkRequiredExtensionsSupported(){const e=this.json;if(e.extensionsRequired&&!e.extensionsRequired.every(r=>this._supportedExtensions.includes(r)))throw new V("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+e.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((e,r)=>{e.children&&e.children.forEach(i=>{this._nodeParentMap.set(i,r)})})}async _loadTextureImageData(e,r,i){const s=this._textureLoaders.get(e);if(s)return s;const n=this._createTextureLoader(r,i);return this._textureLoaders.set(e,n),n}_getTextureSourceId(e){if(e.extensions!==void 0&&e.extensions.KHR_texture_basisu!==null)return e.extensions.KHR_texture_basisu.source;if(e.source!==null)return e.source;throw new V("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.")}async _createTextureLoader(e,r){const i=this._getTextureSourceId(e),s=this.json.images[i];if(s.uri){if(s.uri.endsWith(".ktx2")){const l=await this._context.loadBinary(this._resolveUri(s.uri),r);return new m3e(new Uint8Array(l))}return this._context.loadImage(this._resolveUri(s.uri),r)}if(s.bufferView==null)throw new V("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(s.mimeType==null)throw new V("gltf-loader-unsupported-feature","Image mimeType must be defined.");const n=this.json.bufferViews[s.bufferView],o=await this.getBuffer(n.buffer,r);if(n.byteStride!=null)throw new V("gltf-loader-unsupported-feature","byteStride not supported for image buffer");const a=o.byteOffset+(n.byteOffset||0);return odt(new Uint8Array(o.buffer,a,n.byteLength),s.mimeType)}async getLoadedBuffersSize(){if(this._glbBuffer)return this._glbBuffer.byteLength;const e=await RV(Array.from(this._bufferLoaders.values())),r=await RV(Array.from(this._textureLoaders.values()));return e.reduce((i,s)=>i+(s?.byteLength??0),0)+r.reduce((i,s)=>i+(s?hw(s)?s.data.byteLength:s.width*s.height*4:0),0)}};const Ydt=bve(be(),Math.PI/2),Jdt=new Ow(2,0,"glTF"),G$=Xh(),Qdt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Kdt={[rt.BYTE]:1,[rt.UNSIGNED_BYTE]:1,[rt.SHORT]:2,[rt.UNSIGNED_SHORT]:2,[rt.FLOAT]:4,[rt.INT]:4,[rt.UNSIGNED_INT]:4};function ept(t){switch(t.componentType){case rt.BYTE:return new dU(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case rt.UNSIGNED_BYTE:return new aU(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case rt.SHORT:return new JM(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case rt.UNSIGNED_SHORT:return new OJ(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case rt.UNSIGNED_INT:return new RJ(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case rt.FLOAT:return new Cv(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount)}}let tpt=0;async function S3e(t,e,r={},i=!0){const s=await Zdt.load(t,e,r),n="gltf_"+tpt++,o={lods:[],materials:new Map,textures:new Map,meta:rpt(s)},a=!(!s.json.asset.extras||s.json.asset.extras.ESRI_type!=="symbolResource"),l=new Map;await ipt(s,async(h,p,f,m)=>{const y=l.get(f)??0;l.set(f,y+1);const _=h.mode!==void 0?h.mode:At.TRIANGLES,v=_===At.TRIANGLES||_===At.TRIANGLE_STRIP||_===At.TRIANGLE_FAN?_:null;if(v==null)return void Q.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+At[_]+"). Skipping primitive.");if(!s.hasPositions(h))return void Q.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.");const b=s.getPositionData(h,r),T=s.getMaterial(h,r,i),x=s.hasNormals(h)?s.getNormalData(h,r):null,S=s.hasTangents(h)?s.getTangentData(h,r):null,E=s.hasTextureCoordinates(h)?s.getTextureCoordinates(h,r):null,A=s.hasVertexColors(h)?s.getVertexColors(h,r):null,R=s.getIndexData(h,r),M={transform:oE(p),attributes:{position:await b,normal:x?await x:null,texCoord0:E?await E:null,color:A?await A:null,tangent:S?await S:null},indices:await R,primitiveType:v,material:npt(o,await T,n)};let D=null;o.meta!=null&&o.meta.ESRI_lod!=null&&o.meta.ESRI_lod.metric==="screenSpaceRadius"&&(D=o.meta.ESRI_lod.thresholds[f]),o.lods[f]=o.lods[f]||{parts:[],name:m,lodThreshold:D},o.lods[f].parts[y]=M});for(const h of o.lods)h.parts=h.parts.filter(p=>!!p);const c=await s.getLoadedBuffersSize();return{model:o,meta:{isEsriSymbolResource:a,uri:s.uri},customMeta:{},size:c}}function rpt(t){const e=t.json;let r=null;return e.nodes.forEach(i=>{const s=i.extras;s!=null&&(s.ESRI_proxyEllipsoid||s.ESRI_lod)&&(r=s)}),r}async function ipt(t,e){const r=t.json,i=r.scenes[r.scene||0].nodes,s=i.length>1,n=[];for(const a of i){const l=r.nodes[a];n.push(o(a,0)),spt(l)&&!s&&l.extensions.MSFT_lod.ids.forEach((c,h)=>o(c,h+1))}async function o(a,l){const c=r.nodes[a],h=t.getNodeTransform(a);if(c.weights!=null&&Q.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported."),c.mesh!=null){const p=r.meshes[c.mesh];for(const f of p.primitives)n.push(e(f,h,l,p.name))}for(const p of c.children||[])n.push(o(p,l))}await Promise.all(n)}function spt(t){return t.extensions&&t.extensions.MSFT_lod&&Array.isArray(t.extensions.MSFT_lod.ids)}function npt(t,e,r){const i=n=>{const o=`${r}_tex_${n&&n.id}${n&&n.name?"_"+n.name:""}`;if(n&&!t.textures.has(o)){const a=Bdt(n.data,{wrap:{s:n.wrapS,t:n.wrapT},mipmap:opt.includes(n.minFilter),noUnpackFlip:!0});t.textures.set(o,a)}return o},s=`${r}_mat_${e.id}_${e.name}`;if(!t.materials.has(s)){const n=Vdt({color:[e.color[0],e.color[1],e.color[2]],opacity:e.color[3],alphaMode:e.alphaMode,alphaCutoff:e.alphaCutoff,doubleSided:e.doubleSided,colorMixMode:e.ESRI_externalColorMixMode,textureColor:e.colorTexture?i(e.colorTexture):void 0,textureNormal:e.normalTexture?i(e.normalTexture):void 0,textureOcclusion:e.occlusionTexture?i(e.occlusionTexture):void 0,textureEmissive:e.emissiveTexture?i(e.emissiveTexture):void 0,textureMetallicRoughness:e.metallicRoughnessTexture?i(e.metallicRoughnessTexture):void 0,emissiveFactor:[e.emissiveFactor[0],e.emissiveFactor[1],e.emissiveFactor[2]],colorTextureTransform:e.colorTextureTransform,normalTextureTransform:e.normalTextureTransform,occlusionTextureTransform:e.occlusionTextureTransform,emissiveTextureTransform:e.emissiveTextureTransform,metallicRoughnessTextureTransform:e.metallicRoughnessTextureTransform,metallicFactor:e.metallicFactor,roughnessFactor:e.roughnessFactor});t.materials.set(s,n)}return s}const opt=[Rt.LINEAR_MIPMAP_LINEAR,Rt.LINEAR_MIPMAP_NEAREST];function apt(t,e){switch(e){case At.TRIANGLES:return lpt(t);case At.TRIANGLE_STRIP:return cpt(t);case At.TRIANGLE_FAN:return upt(t)}}function lpt(t){return typeof t=="number"?yE(t):T_(t)?new Uint16Array(t):t}function cpt(t){const e=typeof t=="number"?t:t.length;if(e<3)return[];const r=e-2,i=cF(3*r);if(typeof t=="number"){let s=0;for(let n=0;n<r;n+=1)n%2==0?(i[s++]=n,i[s++]=n+1,i[s++]=n+2):(i[s++]=n+1,i[s++]=n,i[s++]=n+2)}else{let s=0;for(let n=0;n<r;n+=1)n%2==0?(i[s++]=t[n],i[s++]=t[n+1],i[s++]=t[n+2]):(i[s++]=t[n+1],i[s++]=t[n],i[s++]=t[n+2])}return i}function upt(t){const e=typeof t=="number"?t:t.length;if(e<3)return new Uint16Array(0);const r=e-2,i=r<=65536?new Uint16Array(3*r):new Uint32Array(3*r);if(typeof t=="number"){let a=0;for(let l=0;l<r;++l)i[a++]=0,i[a++]=l+1,i[a++]=l+2;return i}const s=t[0];let n=t[1],o=0;for(let a=0;a<r;++a){const l=t[a+2];i[o++]=s,i[o++]=n,i[o++]=l,n=l}return i}let hpt=class{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}},dpt=class{constructor(e,r,i){this.name=e,this.lodThreshold=r,this.pivotOffset=i,this.stageResources=new hpt,this.numberOfVertices=0}};const _g=Q.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function E3e(t,e){const r=await ppt(t,e),i=await _pt(r.textureDefinitions??{},e);let s=0;for(const n in i)if(i.hasOwnProperty(n)){const o=i[n];s+=o?.image?o.image.width*o.image.height*4:0}return{resource:r,textures:i,size:s+$Ee(r)}}async function ppt(t,e){const r=e!=null&&e.streamDataRequester;if(r)return fpt(t,r,e);const i=await Eu(hr(t,e));if(i.ok===!0)return i.value.data;Fo(i.error),C3e(i.error)}async function fpt(t,e,r){const i=await Eu(e.request(t,"json",r));if(i.ok===!0)return i.value;Fo(i.error),C3e(i.error.details.url)}function C3e(t){throw new V("",`Request for object resource failed: ${t}`)}function mpt(t){const e=t.params,r=e.topology;let i=!0;switch(e.vertexAttributes||(_g.warn("Geometry must specify vertex attributes"),i=!1),e.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const n=e.faces;if(n){if(e.vertexAttributes)for(const o in e.vertexAttributes){const a=n[o];a&&a.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(_g.warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),i=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(_g.warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),i=!1)):(_g.warn(`Indexed geometry does not specify face indices for '${o}' attribute`),i=!1)}}else _g.warn("Indexed geometries must specify faces"),i=!1;break}default:_g.warn(`Unsupported topology '${r}'`),i=!1}t.params.material||(_g.warn("Geometry requires material"),i=!1);const s=t.params.vertexAttributes;for(const n in s)s[n].values||(_g.warn("Geometries with externally defined attributes are not yet supported"),i=!1);return i}function gpt(t,e){const r=new Array,i=new Array,s=new Array,n=new hC,o=t.resource,a=Ow.parse(o.version||"1.0","wosr");bpt.validate(a);const l=o.model.name,c=o.model.geometries,h=o.materialDefinitions??{},p=t.textures;let f=0;const m=new Map;for(let y=0;y<c.length;y++){const _=c[y];if(!mpt(_))continue;const v=vpt(_),b=_.params.vertexAttributes,T=[];for(const $ in b){const N=b[$],H=N.values;T.push([$,new He(H,N.valuesPerElement,!0)])}const x=[];if(_.params.topology!=="PerAttributeArray"){const $=_.params.faces;for(const N in $)x.push([N,$[N].values])}const S=v.texture,E=p&&p[S];if(E&&!m.has(S)){const{image:$,parameters:N}=E,H=new _x($,N);i.push(H),m.set(S,H)}const A=m.get(S),R=A?A.id:void 0,M=v.material;let D=n.get(M,S);if(D==null){const $=h[M.substring(M.lastIndexOf("/")+1)].params;$.transparency===1&&($.transparency=0);const N=E&&E.alphaChannelUsage,H=$.transparency>0||N==="transparency"||N==="maskAndTransparency",Z=E?A3e(E.alphaChannelUsage):void 0,G={ambient:Wa($.diffuse),diffuse:Wa($.diffuse),opacity:1-($.transparency||0),transparent:H,textureAlphaMode:Z,textureAlphaCutoff:.33,textureId:R,initTextureTransparent:!0,doubleSided:!0,cullFace:mi.None,colorMixMode:$.externalColorMixMode||"tint",textureAlphaPremultiplied:E?.parameters.preMultiplyAlpha??!1};e!=null&&e.materialParamsMixin&&Object.assign(G,e.materialParamsMixin),D=new gm(G),n.set(M,S,D)}s.push(D);const k=new Ys(D,T,x);f+=x.find($=>$[0]===C.POSITION)?.[1].length??0,r.push(k)}return{engineResources:[{name:l,stageResources:{textures:i,materials:s,geometries:r},pivotOffset:o.model.pivotOffset,numberOfVertices:f,lodThreshold:null}],referenceBoundingBox:ypt(r)}}function ypt(t){const e=Si();return t.forEach(r=>{const i=r.boundingInfo;i!=null&&(am(e,i.bbMin),am(e,i.bbMax))}),e}async function _pt(t,e){const r=new Array;for(const n in t){const o=t[n],a=o.images[0].data;if(!a){_g.warn("Externally referenced texture data is not yet supported");continue}const l=o.encoding+";base64,"+a,c="/textureDefinitions/"+n,h=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",p={noUnpackFlip:!0,wrap:{s:Dt.REPEAT,t:Dt.REPEAT},preMultiplyAlpha:A3e(h)!==Qr.Opaque},f=e!=null&&e.disableTextures?Promise.resolve(null):yy(l,e);r.push(f.then(m=>({refId:c,image:m,parameters:p,alphaChannelUsage:h})))}const i=await Promise.all(r),s={};for(const n of i)s[n.refId]=n;return s}function A3e(t){switch(t){case"mask":return Qr.Mask;case"maskAndTransparency":return Qr.MaskBlend;case"none":return Qr.Opaque;default:return Qr.Blend}}function vpt(t){const e=t.params;return{id:1,material:e.material,texture:e.texture,region:e.texture}}const bpt=new Ow(1,2,"wosr"),pT=2.1;async function O3e(t,e){const r=R3e(Yq(t));if(r.fileType==="wosr"){const p=await(e.cache?e.cache.loadWOSR(r.url,e):E3e(r.url,e)),{engineResources:f,referenceBoundingBox:m}=gpt(p,e);return{lods:f,referenceBoundingBox:m,isEsriSymbolResource:!1,isWosr:!0}}const i=await(e.cache?e.cache.loadGLTF(r.url,e,!!e.usePBR):S3e(new x3e(e.streamDataRequester),r.url,e,e.usePBR)),s=i.model.meta?.ESRI_proxyEllipsoid,n=i.meta.isEsriSymbolResource&&s!=null&&i.meta.uri.includes("/RealisticTrees/");n&&!i.customMeta.esriTreeRendering&&(i.customMeta.esriTreeRendering=!0,Spt(i,s));const o=!!e.usePBR,a=i.meta.isEsriSymbolResource?{usePBR:o,isSchematic:!1,treeRendering:n,mrrFactors:[...Qct]}:{usePBR:o,isSchematic:!1,treeRendering:!1,mrrFactors:[...VU]},l={...e.materialParamsMixin,treeRendering:n},{engineResources:c,referenceBoundingBox:h}=M3e(i,a,l,e.skipHighLods&&r.specifiedLodIndex==null?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:r.specifiedLodIndex});return{lods:c,referenceBoundingBox:h,isEsriSymbolResource:i.meta.isEsriSymbolResource,isWosr:!1}}function R3e(t){const e=t.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return e?{fileType:"gltf",url:e[1],specifiedLodIndex:e[4]!=null?Number(e[4]):null}:t.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:t,specifiedLodIndex:null}:{fileType:"unknown",url:t,specifiedLodIndex:null}}function M3e(t,e,r,i){const s=t.model,n=new Array,o=new Map,a=new Map,l=s.lods.length,c=Si();return s.lods.forEach((h,p)=>{const f=i.skipHighLods===!0&&(l>1&&p===0||l>3&&p===1)||i.skipHighLods===!1&&i.singleLodIndex!=null&&p!==i.singleLodIndex;if(f&&p!==0)return;const m=new dpt(h.name,h.lodThreshold,[0,0,0]);h.parts.forEach(y=>{const _=f?new gm({}):wpt(s,y,m,e,r,o,a),{geometry:v,vertexCount:b}=xpt(y,_??new gm({})),T=v.boundingInfo;T!=null&&p===0&&(am(c,T.bbMin),am(c,T.bbMax)),_!=null&&(m.stageResources.geometries.push(v),m.numberOfVertices+=b)}),f||n.push(m)}),{engineResources:n,referenceBoundingBox:c}}function wpt(t,e,r,i,s,n,o){const a=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),l=t.materials.get(e.material),c=e.attributes.texCoord0!=null,h=e.attributes.normal!=null;if(l==null)return null;const p=Tpt(l.alphaMode);if(!n.has(a)){if(c){const E=(A,R=!1)=>{if(A!=null&&!o.has(A)){const M=t.textures.get(A);if(M!=null){const D=M.data;o.set(A,new _x(hw(D)?D.data:D,{...M.parameters,preMultiplyAlpha:!hw(D)&&R,encoding:hw(D)&&D.encoding!=null?D.encoding:void 0}))}}};E(l.textureColor,p!==Qr.Opaque),E(l.textureNormal),E(l.textureOcclusion),E(l.textureEmissive),E(l.textureMetallicRoughness)}const m=l.color[0]**(1/pT),y=l.color[1]**(1/pT),_=l.color[2]**(1/pT),v=l.emissiveFactor[0]**(1/pT),b=l.emissiveFactor[1]**(1/pT),T=l.emissiveFactor[2]**(1/pT),x=l.textureColor!=null&&c?o.get(l.textureColor):null,S=NAe({normalTexture:l.textureNormal,metallicRoughnessTexture:l.textureMetallicRoughness,metallicFactor:l.metallicFactor,roughnessFactor:l.roughnessFactor,emissiveTexture:l.textureEmissive,emissiveFactor:l.emissiveFactor,occlusionTexture:l.textureOcclusion});n.set(a,new gm({...i,transparent:p===Qr.Blend,customDepthTest:$w.Lequal,textureAlphaMode:p,textureAlphaCutoff:l.alphaCutoff,diffuse:[m,y,_],ambient:[m,y,_],opacity:l.opacity,doubleSided:l.doubleSided,doubleSidedType:"winding-order",cullFace:l.doubleSided?mi.None:mi.Back,hasVertexColors:!!e.attributes.color,hasVertexTangents:!!e.attributes.tangent,normalType:h?Ir.Attribute:Ir.ScreenDerivative,castShadows:!0,receiveSSAO:!0,textureId:x?.id,colorMixMode:l.colorMixMode,normalTextureId:l.textureNormal!=null&&c?o.get(l.textureNormal).id:void 0,textureAlphaPremultiplied:x!=null&&!!x.parameters.preMultiplyAlpha,occlusionTextureId:l.textureOcclusion!=null&&c?o.get(l.textureOcclusion).id:void 0,emissiveTextureId:l.textureEmissive!=null&&c?o.get(l.textureEmissive).id:void 0,metallicRoughnessTextureId:l.textureMetallicRoughness!=null&&c?o.get(l.textureMetallicRoughness).id:void 0,emissiveFactor:[v,b,T],mrrFactors:S?[...ZQ]:[l.metallicFactor,l.roughnessFactor,i.mrrFactors[2]],isSchematic:S,colorTextureTransformMatrix:Df(l.colorTextureTransform),normalTextureTransformMatrix:Df(l.normalTextureTransform),occlusionTextureTransformMatrix:Df(l.occlusionTextureTransform),emissiveTextureTransformMatrix:Df(l.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:Df(l.metallicRoughnessTextureTransform),...s}))}const f=n.get(a);if(r.stageResources.materials.push(f),c){const m=y=>{y!=null&&r.stageResources.textures.push(o.get(y))};m(l.textureColor),m(l.textureNormal),m(l.textureOcclusion),m(l.textureEmissive),m(l.textureMetallicRoughness)}return f}function xpt(t,e){const r=t.attributes.position.count,i=apt(t.indices||r,t.primitiveType),s=Ki(3*r),{typedBuffer:n,typedBufferStride:o}=t.attributes.position;OE(s,n,t.transform,3,o);const a=[[C.POSITION,new He(s,3,!0)]],l=[[C.POSITION,i]];if(t.attributes.normal!=null){const c=Ki(3*r),{typedBuffer:h,typedBufferStride:p}=t.attributes.normal;rv(j$,t.transform),Vw(c,h,j$,3,p),a.push([C.NORMAL,new He(c,3,!0)]),l.push([C.NORMAL,i])}if(t.attributes.tangent!=null){const c=Ki(4*r),{typedBuffer:h,typedBufferStride:p}=t.attributes.tangent;rv(j$,t.transform),QQ(c,h,j$,4,p),a.push([C.TANGENT,new He(c,4,!0)]),l.push([C.TANGENT,i])}if(t.attributes.texCoord0!=null){const c=Ki(2*r),{typedBuffer:h,typedBufferStride:p}=t.attributes.texCoord0;KQ(c,h,2,p),a.push([C.UV0,new He(c,2,!0)]),l.push([C.UV0,i])}if(t.attributes.color!=null){const c=new Uint8Array(4*r);t.attributes.color.elementCount===4?t.attributes.color instanceof Ep?VF(c,t.attributes.color,255):t.attributes.color instanceof ga?eK(c,t.attributes.color):t.attributes.color instanceof YM&&VF(c,t.attributes.color,1/256):(c.fill(255),t.attributes.color instanceof dn?IF(c,t.attributes.color,255,4):t.attributes.color instanceof lU?fP(c,t.attributes.color.typedBuffer,4,t.attributes.color.typedBufferStride):t.attributes.color instanceof uU&&IF(c,t.attributes.color,1/256,4)),a.push([C.COLOR,new He(c,4,!0)]),l.push([C.COLOR,i])}return{geometry:new Ys(e,a,l),vertexCount:r}}const j$=Ui();function Tpt(t){switch(t){case"BLEND":return Qr.Blend;case"MASK":return Qr.Mask;case"OPAQUE":case null:case void 0:return Qr.Opaque}}function Spt(t,e){for(let r=0;r<t.model.lods.length;++r){const i=t.model.lods[r];for(const s of i.parts){const n=s.attributes.normal;if(n==null)return;const o=s.attributes.position,a=o.count,l=O(),c=O(),h=O(),p=new Uint8Array(4*a),f=new Float64Array(3*a),m=Mn(be(),s.transform);let y=0,_=0;for(let v=0;v<a;v++){o.getVec(v,c),n.getVec(v,l),Fe(c,c,s.transform),de(h,c,e.center),f4(h,h,e.radius);const b=h[2],T=Oe(h),x=Math.min(.45+.55*T*T,1);f4(h,h,e.radius),m!==null&&Fe(h,h,m),ye(h,h),r+1!==t.model.lods.length&&t.model.lods.length>1&&Hr(h,h,l,b>-1?.2:Math.min(-4*b-3.8,1)),f[y]=h[0],f[y+1]=h[1],f[y+2]=h[2],y+=3,p[_]=255*x,p[_+1]=255*x,p[_+2]=255*x,p[_+3]=255,_+=4}s.attributes.normal=new dn(f),s.attributes.color=new ga(p)}}}const Tzt=Object.freeze(Object.defineProperty({__proto__:null,fetch:O3e,gltfToEngineResources:M3e,parseUrl:R3e},Symbol.toStringTag,{value:"Module"}));function Ept(t,e,r,i){const s=t.name;return s==null?Promise.reject(new V("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):t.styleName&&t.styleName==="Esri2DPointSymbolsStyle"?Cpt(s,e,i):YZ(t,e,i).then(n=>rK(hc(n),s,e,r,G_e,i))}function tK(t,e){return e.items.find(r=>r.name===t)}function rK(t,e,r,i,s,n){const o=r&&r.portal!=null?r.portal:Js.getDefault(),a={portal:o,url:To(t.baseUrl),origin:"portal-item"},l=tK(e,t.data);if(!l){const m=`The symbol name '${e}' could not be found`;return Promise.reject(new V("symbolstyleutils:symbol-name-not-found",m,{symbolName:e}))}let c=uy(s(l,i),a),h=l.thumbnail?.href??null;const p=l.thumbnail&&l.thumbnail.imageData;Odt()&&(c=Yq(c)??"",h=Yq(h));const f={portal:o,url:To(OX(c)),origin:"portal-item"};return JZ(c,n).then(m=>{const y=i==="cimRef"?B_e(m.data):m.data,_=S_e(y,f);if(_&&Aw(_)){if(h){const v=uy(h,a);_.thumbnail=new Kb({url:v})}else p&&(_.thumbnail=new Kb({url:`data:image/png;base64,${p}`}));t.styleUrl?_.styleOrigin=new ER({portal:r.portal,styleUrl:t.styleUrl,name:e}):t.styleName&&(_.styleOrigin=new ER({portal:r.portal,styleName:t.styleName,name:e}))}return _})}function Cpt(t,e,r){const i=_ke.replaceAll(/\{SymbolName\}/gi,t),s=e.portal!=null?e.portal:Js.getDefault();return JZ(i,r).then(n=>{const o=B_e(n.data);return S_e(o,{portal:s,url:To(OX(i)),origin:"portal-item"})})}const Apt=Object.freeze(Object.defineProperty({__proto__:null,fetchSymbolFromStyle:rK,getStyleItemFromStyle:tK,resolveWebStyleSymbol:Ept},Symbol.toStringTag,{value:"Module"}));async function Opt(t){if(t===null||t.styleName==null&&t.styleUrl==null)return null;const e=t.name;if(e==null)throw new V("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference");const r={portal:t.portal},i=await YZ(t,r).catch(()=>null);if(i===null)return null;const s=tK(e,i.data);if(s&&!s.formatInfos?.some(a=>a.type==="gltf_basisu"))return null;const n=await rK(i,e,r,"webRef",(a,l)=>G_e(a,l,["gltf_basisu","gltf"])).catch(()=>null);if(n===null||n.type!=="point-3d")return null;const o=n.symbolLayers.items[0];return o.type==="object"?o.resource:null}let Rpt=class{constructor(e,r,i){this._elementSize=r,this._buffer=Ur.createVertex(e,Cr.STATIC_DRAW),this.resize(i)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get memoryUsage(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}copyRange(e,r,i,s=0){const n=new Uint8Array(this.array,e*this.elementSize,(r-e)*this.elementSize);new Uint8Array(i.array,s*this.elementSize).set(n)}transferAll(){this._buffer.setData(this._array)}transferRange(e,r){const i=e*this._elementSize,s=r*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),i,i,s)}resize(e){const r=e*this._elementSize,i=new ArrayBuffer(r);this._array&&(e>=this._capacity?new Uint8Array(i).set(new Uint8Array(this._array)):new Uint8Array(i).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=i,this._buffer.setSize(r),this._capacity=e}},Mpt=class{constructor(e){this.modelOriginHi=e.getField(C.MODELORIGINHI,dn),this.modelOriginLo=e.getField(C.MODELORIGINLO,dn),this.model=e.getField(C.MODEL,lv),this.modelNormal=e.getField(C.MODELNORMAL,lv),this.featureAttribute=e.getField(C.INSTANCEFEATUREATTRIBUTE,Ep),this.color=e.getField(C.INSTANCECOLOR,ga),this.objectAndLayerIdColor=e.getField(C.INSTANCEOBJECTANDLAYERIDCOLOR,ga)}},qle=class{constructor(e,r){this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=e,this._instanceBufferLayout=r,this._elementSize=r.stride,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,r=this._tailIndex;return e>=r?e-r:e+this._capacity-r}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get memoryUsage(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){nt(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){nt(this._updating,"not updating"),this.size<LIe*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){nt(this._updating,"not updating"),this.isFull&&this._grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this._incrementHead(),nt(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){nt(this._updating,"not updating"),nt(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}_grow(){const e=Math.max(BF,Math.floor(this._capacity*M5));this._resize(e)}_shrink(){const e=Math.max(BF,Math.floor(this._capacity*$Ie));this._resize(e)}_resize(e){if(nt(this._updating,"not updating"),e===this._capacity)return;const r=new Rpt(this._rctx,this._elementSize,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const i=this.size,s=this._compactInstances(r);nt(s===i,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=s,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=r,this._view=new Mpt(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(e){const r=this._headIndex,i=this._tailIndex;return i<r?(this._buffer.copyRange(i,r,e),r-i):i>r?(this._buffer.copyRange(i,this._capacity,e),r>0&&this._buffer.copyRange(0,r,e,this._capacity-i),r+(this._capacity-i)):0}_incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}_incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}_transferRange(e,r){e<r?this._buffer.transferRange(e,r):e>r&&(r>0&&this._buffer.transferRange(0,r),this._buffer.transferRange(e,this._capacity))}};const BF=64;var $i;function Ppt(t){let e=Hi().mat4f64(C.LOCALTRANSFORM).mat4f64(C.GLOBALTRANSFORM).vec4f64(C.BOUNDINGSPHERE).vec3f64(C.MODELORIGIN).mat3f(C.MODEL).mat3f(C.MODELNORMAL).vec2f(C.MODELSCALEFACTORS);return t.includes(C.FEATUREATTRIBUTE)&&(e=e.vec4f(C.FEATUREATTRIBUTE)),t.includes(C.COLOR)&&(e=e.vec4u8(C.COLOR)),t.includes(C.OBJECTANDLAYERIDCOLOR)&&(e=e.vec4u8(C.OBJECTANDLAYERIDCOLOR)),e=e.u8(C.STATE).u8(C.LODLEVEL),e}(function(t){t[t.ALLOCATED=1]="ALLOCATED",t[t.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",t[t.VISIBLE=4]="VISIBLE",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",t[t.REMOVE=32]="REMOVE",t[t.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",t[t.ACTIVE=18]="ACTIVE"})($i||($i={}));let Wle=class{constructor(e){this.localTransform=e.getField(C.LOCALTRANSFORM,GR),this.globalTransform=e.getField(C.GLOBALTRANSFORM,GR),this.modelOrigin=e.getField(C.MODELORIGIN,Hh),this.model=e.getField(C.MODEL,lv),this.modelNormal=e.getField(C.MODELNORMAL,lv),this.modelScaleFactors=e.getField(C.MODELSCALEFACTORS,Cv),this.boundingSphere=e.getField(C.BOUNDINGSPHERE,oU),this.featureAttribute=e.getField(C.FEATUREATTRIBUTE,Ep),this.color=e.getField(C.COLOR,ga),this.objectAndLayerIdColor=e.getField(C.OBJECTANDLAYERIDCOLOR,ga),this.state=e.getField(C.STATE,gE),this.lodLevel=e.getField(C.LODLEVEL,gE)}},wS=class extends we{constructor(e,r){super(e),this.events=new ws,this._capacity=0,this._size=0,this._next=0,this._layout=Ppt(r),this._capacity=BF,this._buffer=this._layout.createBuffer(this._capacity),this._view=new Wle(this._buffer)}get capacity(){return this._capacity}get size(){return this._size}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,$i.ALLOCATED),this._size++,this.events.emit("instances-changed"),e}removeInstance(e){const r=this._view.state;nt(e>=0&&e<this._capacity&&(r.get(e)&$i.ALLOCATED)!=0,"invalid instance handle"),this._getStateFlag(e,$i.ACTIVE)?this._setStateFlags(e,$i.REMOVE):this.freeInstance(e),this.events.emit("instances-changed")}freeInstance(e){const r=this._view.state;nt(e>=0&&e<this._capacity&&(r.get(e)&$i.ALLOCATED)!=0,"invalid instance handle"),r.set(e,0),this._size--}setLocalTransform(e,r,i=!0){this._view.localTransform.setMat(e,r),i&&this.updateModelTransform(e)}getLocalTransform(e,r){this._view.localTransform.getMat(e,r)}setGlobalTransform(e,r,i=!0){this._view.globalTransform.setMat(e,r),i&&this.updateModelTransform(e)}getGlobalTransform(e,r){this._view.globalTransform.getMat(e,r)}updateModelTransform(e){const r=this._view,i=Hl,s=cd;r.localTransform.getMat(e,Xle),r.globalTransform.getMat(e,cz);const n=oi(cz,cz,Xle);se(i,n[12],n[13],n[14]),r.modelOrigin.setVec(e,i),Vh(s,n),r.model.setMat(e,s);const o=jHe(Hl,n);o.sort(),r.modelScaleFactors.set(e,0,o[1]),r.modelScaleFactors.set(e,1,o[2]),dx(s,s),Bh(s,s),r.modelNormal.setMat(e,s),this._setStateFlags(e,$i.TRANSFORM_CHANGED),this.events.emit("instance-transform-changed",{index:e})}getModelTransform(e,r){const i=this._view;i.model.getMat(e,cd),i.modelOrigin.getVec(e,Hl),r[0]=cd[0],r[1]=cd[1],r[2]=cd[2],r[3]=0,r[4]=cd[3],r[5]=cd[4],r[6]=cd[5],r[7]=0,r[8]=cd[6],r[9]=cd[7],r[10]=cd[8],r[11]=0,r[12]=Hl[0],r[13]=Hl[1],r[14]=Hl[2],r[15]=1}applyShaderTransformation(e,r){this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,r)}getCombinedModelTransform(e,r){return this.getModelTransform(e,r),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,r),r}getCombinedLocalTransform(e,r){this._view.localTransform.getMat(e,r),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,r)}getCombinedMaxScaleFactor(e){let r=this._view.modelScaleFactors.get(e,1);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(Hl,this,e),r*=Math.max(Hl[0],Hl[1],Hl[2])),r}getCombinedMedianScaleFactor(e){let r=this._view.modelScaleFactors.get(e,0);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(Hl,this,e),r*=Ipt(Hl[0],Hl[1],Hl[2])),r}getModel(e,r){this._view.model.getMat(e,r)}setFeatureAttribute(e,r){this._view.featureAttribute.setVec(e,r)}getFeatureAttribute(e,r){this._view.featureAttribute.getVec(e,r)}setColor(e,r){this._view.color.setVec(e,r)}setObjectAndLayerIdColor(e,r){this._view.objectAndLayerIdColor.setVec(e,r)}setVisible(e,r){r!==this.getVisible(e)&&(this._setStateFlag(e,$i.VISIBLE,r),this.events.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,$i.VISIBLE)}setHighlight(e,r){r!==this.getHighlight(e)&&(this._setStateFlag(e,$i.HIGHLIGHT,r),this.events.emit("instance-highlight-changed"))}getHighlight(e){return this._getStateFlag(e,$i.HIGHLIGHT)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let r=0;for(let i=0;i<this._capacity;++i)this.getState(i)&e&&++r;return r}_setStateFlags(e,r){const i=this._view.state;r=i.get(e)|r,i.set(e,r)}_clearStateFlags(e,r){const i=this._view.state;r=i.get(e)&~r,i.set(e,r)}_setStateFlag(e,r,i){i?this._setStateFlags(e,r):this._clearStateFlags(e,r)}_getStateFlag(e,r){return!!(this._view.state.get(e)&r)}_grow(){this._capacity=Math.max(BF,Math.floor(this._capacity*M5)),this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer),this._view=new Wle(this._buffer)}_findSlot(){const e=this._view.state;let r=this._next;for(;e.get(r)&$i.ALLOCATED;)r=r+1===this._capacity?0:r+1;return this._next=r+1===this._capacity?0:r+1,r}};function Ipt(t,e,r){return Math.max(Math.min(t,e),Math.min(Math.max(t,e),r))}u([d({constructOnly:!0})],wS.prototype,"shaderTransformation",void 0),u([d()],wS.prototype,"_size",void 0),u([d({readOnly:!0})],wS.prototype,"size",null),wS=u([P("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],wS);const Hl=O(),cd=Ui(),Xle=be(),cz=be();let $pt=class extends lp{constructor(e,r){super(i=>this._instanceData.view.boundingSphere.getVec(i,this._tmpSphere),{maximumDepth:25}),this._instanceData=e,this._boundingSphere=r,this._tmpSphere=bs(),this._tmpMat4=be()}addInstance(e){const r=this._instanceData.view.boundingSphere,i=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);Fe(this._tmpSphere,this._boundingSphere.center,i),this._tmpSphere[3]=this._boundingSphere.radius*lE(i),r.setVec(e,this._tmpSphere),this.add([e])}removeInstance(e){this.remove([e])}},Lpt=class{constructor(e,r){this._worldSpaceRadius=e,this._minScreenSpaceRadii=r}selectLevel(e,r,i){const s=i.computeScreenPixelSizeAt(e),n=this._worldSpaceRadius*r/s;let o=0;for(let a=1;a<this._minScreenSpaceRadii.length;++a)n>=this._minScreenSpaceRadii[a]&&(o=a);return o}},Dpt=class extends pU{constructor(e,r,i,s,n,o){super(e,r),this.layerUid=e,this.graphicUid=r,this.geometryId=i,this.triangleNr=s,this.baseBoundingSphere=n,this.numLodLevels=o}};function iK(t){return Mp(t)&&t.intersector===Gi.LOD&&!!t.target}let Npt=class{constructor(e,r){const i=e.renderContext.rctx,s=r.geometry;this._materialRepository=e.materialRepository,s.material.setParameters({instancedDoublePrecision:!0});const n=s.material.createBufferWriter(),o=n.vertexBufferLayout,a=n.elementCount(s),l=o.createBuffer(a);n.write(null,null,s,l,0),this.geometry=s,this.material=s.material,this.glMaterials=new pAe(s.material,this._materialRepository),this.vertexBufferLayout=o,this.vbo=Ur.createVertex(i,Cr.STATIC_DRAW,l.buffer),this.vao=new Rp(i,Tr,{geometry:Fc(o)},{geometry:this.vbo}),this.vertexCount=a}destroy(){this.glMaterials.destroy(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(e,r,i,s,n,o,a,l){const c=this.geometry.id;this.material.intersect(this.geometry,e.transform.transform,e,i,s,(h,p,f,m,y)=>{if(h>=0){if(r!=null&&!r(e.rayBegin,e.rayEnd,h))return;const _=new Dpt(o.layerUid,o.graphicUid(n),c,f,a,l);if((e.results.min.drapedLayerOrder==null||y>=e.results.min.drapedLayerOrder)&&(e.results.min.dist==null||h<e.results.min.dist)&&e.results.min.set(Gi.LOD,_,h,p,e.transform.transform,y),e.options.store!==wo.MIN&&(e.results.max.drapedLayerOrder==null||y>=e.results.max.drapedLayerOrder)&&(e.results.max.dist==null||h>e.results.max.dist)&&e.results.max.set(Gi.LOD,_,h,p,e.transform.transform,y),e.options.store===wo.ALL){const v=LJ(e.results.min.ray);v.set(Gi.LOD,_,h,p,e.transform.transform,y),e.results.all.push(v)}}})}},Fpt=class P3e{static async create(e,r,i){const s=await Promise.allSettled(r.components.map(o=>e.controller.schedule(()=>new Npt(e,o),i))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(jf);if(An(i)||n.length!==s.length){n.forEach(o=>o.destroy()),Yt(i);for(const o of s)if(o.status==="rejected")throw o.reason}return new P3e(r.minScreenSpaceRadius,n)}constructor(e,r){this.minScreenSpaceRadius=e,this.components=r}destroy(){this.components.forEach(e=>e.destroy())}intersect(e,r,i,s,n,o,a){this.components.forEach(l=>l.intersect(e,r,i,s,n,o,this.boundingSphere,a))}get boundingBox(){if(this._boundingBox==null){const e=Si();this.components.forEach(r=>{r.boundingInfo!=null&&(am(e,r.boundingInfo.bbMin),am(e,r.boundingInfo.bbMax))}),this._boundingBox=e}return this._boundingBox}get boundingSphere(){if(this._boundingSphere==null){const e=this.boundingBox,r=O();sp(e,r),this._boundingSphere={center:r,radius:.5*P0e(e)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((e,r)=>e+r.triangleCount,0)}};const Upt=t=>{const e=t.baseBoundingSphere.radius,r=t.levels.map(i=>i.minScreenSpaceRadius);return new Lpt(e,r)};let ah=class extends we{constructor(e,r){super(e),this.type=Gi.LOD,this.isGround=!1,this._handles=new Ii,this._levels=[],this._defaultRenderInstanceData=[new Array],this._highlightRenderInstanceData=[new Array],this._allRenderInstanceData=[this._defaultRenderInstanceData[0],this._highlightRenderInstanceData[0]],this._instanceIndex=0,this._cycleStartIndex=0,this._slicePlane=!1,this._camera=new gt,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.slots=[he.OPAQUE_MATERIAL,he.TRANSPARENT_MATERIAL],this.canRender=!0,this._instanceData=new wS({shaderTransformation:e.shaderTransformation},e.optionalFields),this._handles.add(r.registerTask(vt.LOD_RENDERER,this))}initialize(){this._instanceBufferLayout=zpt(this.optionalFields),this._glInstanceBufferLayout=Fc(this._instanceBufferLayout,1),this._handles.add([this._instanceData.events.on("instances-changed",()=>this._requestUpdateCycle()),this._instanceData.events.on("instance-transform-changed",({index:e})=>{this._requestUpdateCycle(),this.metadata.notifyGraphicGeometryChanged(e)}),this._instanceData.events.on("instance-visibility-changed",({index:e})=>{this._requestUpdateCycle(!0),this.metadata.notifyGraphicVisibilityChanged(e)}),this._instanceData.events.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0))])}destroy(){this._handles.destroy()}get _enableLevelSelection(){return this.symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get memoryUsage(){const e={cpu:0,gpu:0};return this._allRenderInstanceData.forEach(r=>r.forEach(i=>{e.cpu+=i.memoryUsage.cpu,e.gpu+=i.memoryUsage.gpu})),e}get renderStats(){const e=this._instanceData.size,r=[];return this._levels.forEach((i,s)=>{const n=this._allRenderInstanceData[0][s].size+this._allRenderInstanceData[1][s].size,o=i.triangleCount;r.push({renderedInstances:n,renderedTriangles:n*o,trianglesPerInstance:o})}),{totalInstances:e,renderedInstances:r.reduce((i,s)=>i+s.renderedInstances,0),renderedTriangles:r.reduce((i,s)=>i+s.renderedTriangles,0),levels:r}}async initializeRenderContext(e,r){this._context=e;const i=e.renderContext.rctx,s=await Promise.allSettled(this.symbol.levels.map(o=>(this._defaultRenderInstanceData[0].push(new qle(i,this._instanceBufferLayout)),this._highlightRenderInstanceData[0].push(new qle(i,this._instanceBufferLayout)),Fpt.create(e,o,r)))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(jf);if(An(r)||n.length!==s.length){n.forEach(o=>o.destroy()),Yt(r);for(const o of s)if(o.status==="rejected")throw o.reason}this._levels=n,this._levelSelector=Upt(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(e=>e.destroy()),this._defaultRenderInstanceData[0].forEach(e=>e.destroy()),this._highlightRenderInstanceData[0].forEach(e=>e.destroy())}get needsTransparentPass(){return this._levels.some(e=>e.components.some(r=>r.material.requiresSlot(he.TRANSPARENT_MATERIAL,U.Color)))}get needsHighlight(){return this._highlightRenderInstanceData[0].some(e=>e.size>0)}prepareRender(e){if(!ai.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const r=e.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(e.bindParameters.contentCamera),r||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(Ja),this._needFullCycle=!1)}}prepareTechniques(e){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(e.output))return null;const r=this._getInstanceDatas(e.output);if(!r)return null;const i=new Array;return r.forEach(s=>this.levels.forEach((n,o)=>{n.components.forEach(a=>i.push(this._beginComponent(e,s[o],a)))})),i}render(e,r){const i=this._getInstanceDatas(e.output);if(!i)return;let s=0;e.rctx.bindVAO(),i.forEach(n=>this.levels.forEach((o,a)=>{o.components.forEach(l=>this._renderComponent(e,r[s++],n[a],l,a))}))}_getInstanceDatas(e){const r=e!==U.Highlight&&e!==U.ShadowHighlight,i=e!==U.ShadowExcludeHighlight;return r&&i?this._allRenderInstanceData:r?this._defaultRenderInstanceData:i?this._highlightRenderInstanceData:null}intersect(e,r,i,s){if(!this.baseMaterial.isVisible()||this._octree==null)return;const n=O();de(n,s,i);const o=a=>{this._instanceData.getCombinedModelTransform(a,Jle),e.transform.set(Jle),Fe(Qle,i,e.transform.inverse),Fe(Kle,s,e.transform.inverse);const l=this._instanceData.getState(a),c=this._instanceData.getLodLevel(a),h=this._levels.length;nt((l&$i.ACTIVE)!=0,"invalid instance state"),nt(c>=0&&c<h,"invaid lod level"),this._levels[c].intersect(e,r,Qle,Kle,a,this.metadata,h)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(o):this._octree.forEachAlongRay(i,n,o)}queryDepthRange(e){return this._queryDepthRangeOctree(e)}notifyShaderTransformationChanged(){this._invalidateOctree(),this._requestUpdateCycle()}get _octree(){if(this._octreeCached==null){const e=this._instanceData,r=e.view?.state;if(!r)return null;this._octreeCached=new $pt(e,this.baseBoundingSphere);for(let i=0;i<e.capacity;++i)r.get(i)&$i.ACTIVE&&this._octreeCached.addInstance(i)}return this._octreeCached}_invalidateOctree(){this._octreeCached=$e(this._octreeCached)}_queryDepthRangeOctree(e){if(this._octree==null)return{near:1/0,far:-1/0};const r=e.viewForward,i=this._octree.findClosest(r,lp.DepthOrder.FRONT_TO_BACK,e.frustum),s=this._octree.findClosest(r,lp.DepthOrder.BACK_TO_FRONT,e.frustum);if(i==null||s==null)return{near:1/0,far:-1/0};const n=e.eye,o=this._instanceData.view;o.boundingSphere.getVec(i,Yp),de(Yp,Yp,n);const a=fe(Yp,r)-Yp[3];o.boundingSphere.getVec(s,Yp),de(Yp,Yp,n);const l=fe(Yp,r)+Yp[3];return{near:Math.max(e.near,a),far:Math.min(e.far,l)}}_requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,e&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._allRenderInstanceData.forEach(e=>e.forEach(r=>r.startUpdateCycle()))}get running(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}runTask(e){const{_enableLevelSelection:r,_camera:i,_levelSelector:s}=this;this._allRenderInstanceData.forEach(h=>h.forEach(p=>p.beginUpdate()));const n=this._instanceData,o=n.view;let a=n.size;const l=n.capacity;let c=this._instanceIndex;for(let h=0;h<a&&!e.done;++h){c===this._cycleStartIndex&&this._startUpdateCycle();const p=o.state.get(c);let f=0;if(!(p&$i.ALLOCATED)){c=c+1===l?0:c+1,a++;continue}const m=o.lodLevel.get(c);if(p&$i.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[0][m].freeTail(),p&$i.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[0][m].freeTail(),p&$i.REMOVE)n.freeInstance(c);else if(p&$i.VISIBLE){let y=0;r&&(o.modelOrigin.getVec(c,Yle),y=s.selectLevel(Yle,n.getCombinedMedianScaleFactor(c),i)),f=p&~($i.ACTIVE|$i.TRANSFORM_CHANGED),y>=0&&(p&$i.HIGHLIGHT?(Zle(this._highlightRenderInstanceData[0][y],o,c),f|=$i.HIGHLIGHT_ACTIVE):(Zle(this._defaultRenderInstanceData[0][y],o,c),f|=$i.DEFAULT_ACTIVE)),o.state.set(c,f),o.lodLevel.set(c,y)}else f=p&~($i.ACTIVE|$i.TRANSFORM_CHANGED),o.state.set(c,f);if(this._octreeCached!=null){const y=!!(p&$i.ACTIVE),_=!!(f&$i.ACTIVE);!y&&_?this._octreeCached.addInstance(c):y&&!_?this._octreeCached.removeInstance(c):y&&_&&p&$i.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(c),this._octreeCached.addInstance(c))}c=c+1===l?0:c+1,e.madeProgress()}this._instanceIndex=c,this._allRenderInstanceData.forEach(h=>h.forEach(p=>p.endUpdate())),this._context.requestRender()}_beginComponent(e,r,i){const{bindParameters:s,rctx:n,output:o}=e;if(r.size===0||!i.material.requiresSlot(s.slot,e.output))return null;const a=i.glMaterials.load(n,s.slot,o);return a!=null?a.beginSlot(s):null}_renderComponent(e,r,i,s,n){if(!r)return;const{bindParameters:o,rctx:a}=e;a.appleAmdDriverHelper?.resetIndicesType();const l=a.bindTechnique(r,s.material.parameters,o);a.bindVAO(s.vao),r.ensureAttributeLocations(s.vao),l.bindDraw(Vpt,o,s.material.parameters),ai.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.output===U.Color&&(l.setUniform4fv("externalColor",ece[Math.min(n,ece.length-1)]),l.setUniform1i("colorMixMode",X2e.replace));const c=a.capabilities.instancing,h=i.capacity,p=i.headIndex,f=i.tailIndex,m=i.firstIndex,y=this._glInstanceBufferLayout,_=(v,b)=>{hJ(a,Tr,i.buffer,y,v),c.drawArraysInstanced(r.primitiveType,0,s.vertexCount,b-v),dJ(a,Tr,i.buffer,y)};s.material.parameters.transparent&&m!=null?p>f?(nt(m>=f&&m<=p,"invalid firstIndex"),_(m,p),_(f,m)):p<f&&(m<=p?(nt(m>=0&&m<=p,"invalid firstIndex"),_(m,p),_(f,h),_(0,m)):(nt(m>=f&&m<=h,"invalid firstIndex"),_(m,h),_(0,p),_(f,m))):p>f?_(f,p):p<f&&(_(0,p),_(f,h)),a.bindVAO(null)}};function Zle(t,e,r){const i=t.allocateHead();kpt(e,r,t.view,i)}function kpt(t,e,r,i){VQe(t.modelOrigin,e,r.modelOriginHi,r.modelOriginLo,i),r.model.copyFrom(i,t.model,e),r.modelNormal.copyFrom(i,t.modelNormal,e),t.color&&r.color&&r.color.copyFrom(i,t.color,e),t.objectAndLayerIdColor&&r.objectAndLayerIdColor&&r.objectAndLayerIdColor.copyFrom(i,t.objectAndLayerIdColor,e),t.featureAttribute&&r.featureAttribute&&r.featureAttribute.copyFrom(i,t.featureAttribute,e)}function zpt(t){let e=Hi().vec3f(C.MODELORIGINHI).vec3f(C.MODELORIGINLO).mat3f(C.MODEL).mat3f(C.MODELNORMAL);return t!=null&&t.includes("featureAttribute")&&(e=e.vec4f(C.INSTANCEFEATUREATTRIBUTE)),t!=null&&t.includes("color")&&(e=e.vec4u8(C.INSTANCECOLOR)),t!=null&&t.includes("objectAndLayerIdColor")&&(e=e.vec4u8(C.INSTANCEOBJECTANDLAYERIDCOLOR)),e}u([d({constructOnly:!0})],ah.prototype,"symbol",void 0),u([d({constructOnly:!0})],ah.prototype,"optionalFields",void 0),u([d({constructOnly:!0})],ah.prototype,"metadata",void 0),u([d({constructOnly:!0})],ah.prototype,"shaderTransformation",void 0),u([d()],ah.prototype,"_instanceData",void 0),u([d()],ah.prototype,"_cycleStartIndex",void 0),u([d({readOnly:!0})],ah.prototype,"_enableLevelSelection",null),u([d()],ah.prototype,"_updateCyclesWithStaticCamera",void 0),u([d({readOnly:!0})],ah.prototype,"running",null),ah=u([P("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],ah);const Yle=O(),Yp=Xt(),Jle=be(),Qle=O(),Kle=O(),ece=[Nt(1,0,1,1),Nt(0,0,1,1),Nt(0,1,0,1),Nt(1,1,0,1),Nt(1,0,0,1)],Vpt=new hut;let tce=class{constructor(e,r,i,s,n,o,a,l,c,h,p,f){this.lodResources=e,this.lodRenderer=r,this.stageResources=i,this.originalMaterialParameters=s,this.resourceSize=n,this.isEsriSymbolResource=o,this.isWosr=a,this.resourceBoundingBox=l,this.symbolSize=c,this.extentPadding=h,this.physicalBasedRenderingEnabled=p,this.pivotOffset=f}},Bpt=class extends Am{getCachedSize(){const[e,r,i]=this._resources!=null?this._resources.symbolSize:[1,1,1];return{width:e,depth:r,height:i}}constructor(e,r,i,s){super(e,r,i,s),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this._hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.skipHighSymbolLodsChanged=!1,this.ensureDrapedStatus(!1),this._hasLoadedPBRTextures=i.physicalBasedRenderingEnabled}async doLoad(e){if(!this._drivenProperties.size&&PU(this.symbolLayer))throw new Error;if(this._isPrimitive){const r=this.symbolLayer.resource,i=r&&eat(r.primitive)?r.primitive:H0e;this._resources=await this._createResourcesForPrimitive(i,e)}else{const r=await Opt(this.symbol.styleOrigin),i=r?.href??this.symbolLayer.resource.href;this._resources=await this._createResourcesForUrl(i,e)}this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return this._resources!=null?this._resources.extentPadding:0}get _isPrimitive(){return!this.symbolLayer.resource?.href}get lodRenderer(){return this._resources?.lodRenderer}_setMaterialTransparencyParams(e,r=this.symbolLayer?.material?.color){const i=this._getCombinedOpacity(r),s=i<1||this.needsDrivenTransparentPass;return e.transparent=s,e.opacity=i,e.cullFace=s?mi.None:mi.Back,e}async _createResourcesForPrimitive(e,r){const i=this.symbolLayer,s=pn(F8e(e)),n=Wa(BP(s)),o=Wa(k8(n,i)),a=Oe(o),l=!1,c=!1,h={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,mrrFactors:[...ZQ],ambient:kg,diffuse:kg,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},p=!!h.usePBR;this._setMaterialTransparencyParams(h);const f=this.symbol;if(f.type==="point-3d"&&f.verticalOffset){const{screenLength:T,minWorldLength:x,maxWorldLength:S}=f.verticalOffset;h.verticalOffset={screenLength:_o(T),minWorldLength:x||0,maxWorldLength:S??1/0},h.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(h.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)h.externalColor=Ch;else{const T=i.material!=null?i.material.color:null,x=T!=null?Ne.toUnitRGBA(T):Ch;h.externalColor=x}this._fastUpdates=TE(this._context.renderer,this._fastVisualVariableConvertOptions(s,o,n,null)),h.isInstanced=!0,this._fastUpdates?(Object.assign(h,this._fastUpdates.materialParameters),this._optionalFields.push(C.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(h.hasInstancedColor=!0,this._optionalFields.push(C.COLOR)),oe("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(C.OBJECTANDLAYERIDCOLOR);const m=new gm(h),y=dCe(e,m);if(!y)throw new Error(`Unknown object symbol primitive: ${e}`);const _=x$(y).map(T=>({opacity:1,transparent:T.parameters.transparent})),v=await this._createStageResources(y,p,r),b=await this._createLodRenderer(y,r);return new tce(y,b,v,_,n,l,c,s,o,a,p,null)}async _createResourcesForUrl(e,r){const i={materialParamsMixin:{isInstanced:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=TE(this._context.renderer,this._fastVisualVariableConvertOptions(null,null,null,null)),this._fastUpdates?(Object.assign(i.materialParamsMixin,this._fastUpdates.materialParameters),this._optionalFields.push(C.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(i.materialParamsMixin.hasInstancedColor=!0,this._optionalFields.push(C.COLOR)),oe("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(C.OBJECTANDLAYERIDCOLOR);const s=this.symbol;if(s.type==="point-3d"&&s.verticalOffset){const{screenLength:k,minWorldLength:$,maxWorldLength:N}=s.verticalOffset;i.materialParamsMixin.verticalOffset={screenLength:_o(k),minWorldLength:$||0,maxWorldLength:N??1/0},i.materialParamsMixin.castShadows=!1}i.signal=r,i.usePBR=this._context.physicalBasedRenderingEnabled,i.skipHighLods=this._context.skipHighSymbolLods;const n=i.usePBR,o=await O3e(e,i),a=o.isEsriSymbolResource,l=o.isWosr,c=Adt(o.lods);c.levels.sort((k,$)=>k.minScreenSpaceRadius-$.minScreenSpaceRadius);const h=this._context,p=this.symbolLayer.material,f=this._getExternalColorParameters(p),m=this.symbolLayer?.material?.color,y=this._getCombinedOpacity(m,{hasIntrinsicColor:!0}),_=this.needsDrivenTransparentPass,v=x$(c),b=x$(c).map(k=>({opacity:k.parameters.opacity||1,transparent:k.parameters.transparent}));v.forEach(k=>{const $=k.parameters;k.setParameters(f);const N=$.opacity*y,H=N<1||_||$.transparent;k.setParameters({opacity:N,transparent:H}),h.screenSizePerspectiveEnabled&&k.setParameters({screenSizePerspective:h.sharedResources.screenSizePerspectiveSettings})});const T=o.referenceBoundingBox,x=Wa(BP(T)),S=Wa(c.levels[0].pivotOffset),E=Wa(k8(x,this.symbolLayer)),A=Oe(E),R=this._fastUpdates;SE(R,this._context.renderer,this._fastVisualVariableConvertOptions(T,E,x,S))&&v.forEach(k=>k.setParameters(R.materialParameters));const M=await this._createStageResources(c,n,r),D=await this._createLodRenderer(c,r);return new tce(c,D,M,b,x,a,l,T,E,A,n,S)}_addDisposeResource(e){this._disposeResourceHandles.push(e)}async _createStageResources(e,r,i){const s=this._context.stage,n=x$(e);r!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),s.addMany(n),this._addDisposeResource(()=>s.removeMany(n));const o=dae(e);s.addMany(o),this._addDisposeResource(()=>s.removeMany(o)),await s.load(o,i),Yt(i);const a=pae(e);return s.addMany(a),this._addDisposeResource(()=>s.removeMany(a)),{materials:n,textures:o,geometries:a}}async _createLodRenderer(e,r){const i=this._context.stage,s={layerUid:this._context.layer.uid,graphicUid:l=>this._instanceIndexToGraphicUid.get(l),notifyGraphicGeometryChanged:l=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(l)),notifyGraphicVisibilityChanged:l=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(l))},n=this._fastUpdates,o=n?{applyTransform:(l,c,h)=>{l.getFeatureAttribute(c,H$),Us(h,Mq(n.materialParameters,H$,h))},scaleFactor:(l,c,h)=>{c.getFeatureAttribute(h,H$),$nt(l,n.materialParameters,H$)}}:null,a=new ah({symbol:e,optionalFields:this._optionalFields,metadata:s,shaderTransformation:o},this._context.scheduler);return a.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{i.removeRenderPlugin(a),a.destroy()}),await i.addRenderPlugin(a.slots,a,r),a}_getExternalColorParameters(e){const r={};return this._drivenProperties.color?r.externalColor=Ch:e!=null&&e.color!=null?r.externalColor=Ne.toUnitRGBA(e.color):(r.externalColor=Ch,r.colorMixMode="ignore"),r}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(e=>e()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry))return null;const i=KR(r.geometry);if(i==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${r.geometry.type}`),null;const s=this.setGraphicElevationContext(r,new Pp),n=e.renderingInfo;return this._createAs3DShape(r,i,n,s,r.uid,e.layer.uid)}notifyDestroyGraphicLayer(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(this._resources==null)return;const e=this._drivenProperties.opacity,r=!this._isPrimitive,i=this._resources.stageResources.materials,s=this._resources.originalMaterialParameters;for(let n=0;n<i.length;n++){const o=i[n],a=this.symbolLayer?.material?.color,l=s[n],c=this._getCombinedOpacity(a,{hasIntrinsicColor:r})*l.opacity,h=c<1||e||l.transparent;o.setParameters({opacity:c,transparent:h}),this._isPrimitive&&o.setParameters({cullFace:h?mi.None:mi.Back})}}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,pv)}slicePlaneEnabledChanged(){if(this._resources==null)return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const e of this._resources.stageResources.materials)e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(this._resources==null)return!0;const{stageResources:e,isWosr:r}=this._resources;for(const i of e.materials)this._isPrimitive?i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):r||i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this._hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this._hasLoadedPBRTextures=!0,!1)}applyRendererDiff(e,r){if(this._resources==null)return Ns.RecreateSymbol;const{stageResources:{materials:i},lodRenderer:s,resourceBoundingBox:n,symbolSize:o,resourceSize:a,pivotOffset:l}=this._resources;for(const c in e.diff){if(c!=="visualVariables"||!SE(this._fastUpdates,r,this._fastVisualVariableConvertOptions(n,o,a,l)))return Ns.RecreateSymbol;for(const h of i)h.setParameters(this._fastUpdates.materialParameters);s.notifyShaderTransformationChanged()}return Ns.FastUpdate}computeComplexity(){if(this._resources==null)return super.computeComplexity();const e=this._resources.lodResources,r=hCe(e.levels[0]).reduce((n,o)=>n+o.indices.get(C.POSITION).length,0)/3,i=n=>Array.from(n.vertexAttributes.values()).reduce((o,a)=>o+S_(a.data),0)+Array.from(n.indices.values()).reduce((o,a)=>o+S_(a),0),s=dae(e).reduce((n,o)=>n+(o.parameters.encoding&&o.parameters.encoding==="image/ktx2"?o.memoryEstimate:o.memoryEstimate/4),0)+pae(e).reduce((n,o)=>n+i(o),0);return{primitivesPerFeature:r,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:{...fCe(this.symbol,this.symbolLayer),resourceBytes:s}}}_hasLodRenderer(){return this._resources!=null}_createAs3DShape(e,r,i,s,n,o){if(!this._hasLodRenderer()||this._resources==null)return null;const a=this.getFastUpdateAttrValues(e),l=this._context.clippingExtent;if(So(r,fT,this._context.elevationProvider.spatialReference),l!=null&&!PZ(l,fT))return null;const c=this._requiresTerrainElevation(s),h=this._computeGlobalTransform(r,s,uz,q$),p=this._computeLocalTransform(this._resources,this.symbolLayer,i,rce),f=this._resources.lodRenderer.instanceData,m=f.addInstance();this._instanceIndexToGraphicUid.set(m,n),f.setLocalTransform(m,p,!1),f.setGlobalTransform(m,h),a&&f.setFeatureAttribute(m,a),this._fastUpdates==null&&this._hasPerInstanceColor()&&f.setColor(m,XO(i.color,i.opacity,255)),this._context.stage.renderView.objectAndLayerIdRenderHelper!=null&&f.setObjectAndLayerIdColor(m,this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:n,layerUid:o}));const y=new Sdt(this,m,jot,s);return c&&(y.alignedSampledElevation=q$.sampledElevation),y.needsElevationUpdates=pv(s.mode),QR(y,r,this._context.elevationProvider),y}_computeGlobalTransform(e,r,i,s){return dv(e,this._context.elevationProvider,r,this._context.renderCoordsHelper,s),fT[0]=e.x,fT[1]=e.y,fT[2]=s.z,Pl(e.spatialReference,fT,i,this._context.renderCoordsHelper.spatialReference),i}_computeLocalTransform(e,r,i,s){return zh(s),this._applyObjectRotation(i,!1,s),this._applyObjectRotation(r,!0,s),this._applyObjectScale(e,i,s),this._applyAnchor(e,r,s),s}_applyObjectScale(e,r,i){if(this._fastUpdates?.requiresShaderTransformation)return;const s=this._drivenProperties.size&&r.size?r.size:e.symbolSize,n=uae(s,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);n[0]===1&&n[1]===1&&n[2]===1||T6(i,i,n)}prepareSymbolLayerPatch(e){if(e.diff.type!=="partial")return;const r=e.diff.diff;this._preparePatchTransform(e,r),this._preparePatchColor(e,r)}updateGeometry(e,r){if(this._resources==null)return!0;const i=r&&KR(r);if(i==null)return!1;const s=this.getGeometryElevationMode(r);return e.elevationContext.mode===s&&(this._computeGlobalTransform(i,e.elevationContext,uz,q$),this._requiresTerrainElevation(e.elevationContext)&&(e.alignedSampledElevation=q$.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,uz,!0),QR(e,i,this._context.elevationProvider),!0)}_preparePatchTransform(e,r){if(!(r.heading||r.tilt||r.roll||r.width||r.height||r.depth||r.anchor||r.anchorPosition)||this._resources==null)return;const i=(y,_,v)=>(y!=null&&y.type==="complete"?y.newValue:_)??v,s=i(r.heading,this.symbolLayer.heading,0),n=i(r.tilt,this.symbolLayer.tilt,0),o=i(r.roll,this.symbolLayer.roll,0),a=i(r.width,this.symbolLayer.width,void 0),l=i(r.height,this.symbolLayer.height,void 0),c=i(r.depth,this.symbolLayer.depth,void 0),h=i(r.anchor,this.symbolLayer.anchor,void 0),p=i(r.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete r.heading,delete r.tilt,delete r.roll,delete r.width,delete r.height,delete r.depth,delete r.anchor,delete r.anchorPosition;const f={heading:s,tilt:n,roll:o,anchor:h,anchorPosition:p},m=this._resources;this.loadStatus===lu.LOADED&&e.symbolLayerStatePatches.push(()=>{m.symbolSize=Wa(k8(m.resourceSize,{width:a,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))}),e.graphics3DGraphicPatches.push((y,_)=>{const v=this._computeLocalTransform(m,f,_,rce),b=y.instanceIndex;m.lodRenderer.instanceData.setLocalTransform(b,v,!0)})}_preparePatchColor(e,r){if(!r.material||r.material.type!=="partial")return;const i=r.material.diff;if(!i.color||i.color.type!=="complete"||i.color.newValue==null||i.color.oldValue==null)return;const s=i.color.newValue,n=s!=null?Ne.toUnitRGBA(s):Ch;delete i.color;const o=this._resources;o!=null&&e.graphics3DGraphicPatches.push(a=>{let l;this._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(a.instanceIndex,n),l=this._setMaterialTransparencyParams({},s)):l=this._setMaterialTransparencyParams({externalColor:n},s);for(const c of o.stageResources.materials)c.setParameters(l)})}_requiresTerrainElevation(e){return e.mode!=="absolute-height"}_applyObjectRotation(e,r,i){if(!this._fastUpdates?.requiresShaderTransformation||!r)return $ot(e.heading,e.tilt,e.roll,i)}_computeAnchor(e,r,i){const s=O();switch(i.anchor){case"center":re(s,sp(e)),pa(s,s);break;case"top":{const n=sp(e);se(s,-n[0],-n[1],-e[5]);break}case"bottom":{const n=sp(e);se(s,-n[0],-n[1],-e[2]);break}case"relative":{const n=sp(e),o=BP(e),a=i.anchorPosition,l=a?Me(a.x,a.y,a.z):Ka;W5(s,o,l),ue(s,s,n),pa(s,s);break}default:r!=null?pa(s,r):re(s,Ka)}return s}_applyAnchor(e,r,i){if(this._fastUpdates?.requiresShaderTransformation)return;const s=this._computeAnchor(e.resourceBoundingBox,e.pivotOffset,r);s&&Fl(i,i,s)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(e,r,i,s){const n=e!=null?Wa(BP(e)):kg,o=e!=null?this._computeAnchor(e,s,this.symbolLayer):Ka,a=this._context.renderCoordsHelper.unitInMeters,l=uae(r??void 0,r,i,a),c=Me(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return new sP({size:!0,color:!0,rotation:!0,opacity:!1},n,r??kg,a,o,l,c)}};const fT=O(),rce=be(),uz=be(),H$=Xt(),q$=new aP;let Gpt=class{constructor(e,r,i,s){this.vertices=e,this.positionsES=r,this.offset=s;const n=e.length,o=Math.floor(n/2),a=this.offset+3*o,l=i[a],c=i[a+1],h=i[a+2];this.origin=Me(l,c,h),this.positions=Ki(3*n);const p=this.offset+3*n;for(let f=this.offset;f<p;f+=3)this.positions[f]=i[f]-l,this.positions[f+1]=i[f+1]-c,this.positions[f+2]=i[f+2]-h;this.updatePathVertexInformation()}updatePathVertexInformation(){const e=this.vertices.length,r=this.vertices[0];let i=this.offset;const s=this.positions;r.vRight[0]=s[i+3]-s[i],r.vRight[1]=s[i+4]-s[i+1],r.vRight[2]=s[i+5]-s[i+2],i+=3;let n=Oe(r.vRight);r.vMinSiblingLength=n,ye(r.vRight,r.vRight);let o=r;for(let a=1;a<e;++a){const l=this.vertices[a];if(l.vLeft=o.vRight,a<e-1){l.vRight[0]=s[i+3]-s[i],l.vRight[1]=s[i+4]-s[i+1],l.vRight[2]=s[i+5]-s[i+2];const c=Oe(l.vRight);l.vMinSiblingLength=Math.min(n,c),n=c,ye(l.vRight,l.vRight)}else re(l.vRight,l.vLeft),l.vMinSiblingLength=n;o=l,i+=3}}},jpt=class{constructor(e,r,i,s,n,o={}){this.path=e,this.profile=r,this.extruder=i,this.startCap=s,this.endCap=n,this.options=o,this._extrusionVertexCount=0;const a=this.path.vertices.length-2;this.numExtrusionProfiles=i.numProfilesPerJoin()*a+2,this.numVerticesTotal=r.vertices.length*this.numExtrusionProfiles,this.startCap.vertexBufferStart=this.numVerticesTotal;const l=this.startCap.numVertices;this.numVerticesTotal+=l,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.numVertices;this.numVerticesTotal+=c,this.pathVertexData=IQe(1*this.numVerticesTotal),this.profileRightAxes=Ki(4*this.numVerticesTotal),this.profileUpAxes=Ki(4*this.numVerticesTotal),this.profileVertexAndNormals=Ki(4*this.numVerticesTotal),this.positions=lF(e.positions,e.offset,3*e.vertices.length),this._rebuildGeometry(),this.buildTopology()}emitVertex(e,r,i,s,n){const o=4*this._extrusionVertexCount;if(this.profileRightAxes[o]=r.right[0],this.profileRightAxes[o+1]=r.right[1],this.profileRightAxes[o+2]=r.right[2],this.profileUpAxes[o]=r.up[0],this.profileUpAxes[o+1]=r.up[1],this.profileUpAxes[o+2]=r.up[2],this.profileVertexAndNormals[o]=i[0],this.profileVertexAndNormals[o+1]=i[1],this.profileVertexAndNormals[o+2]=s[0],this.profileVertexAndNormals[o+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=e,n){const a=this.path.vertices[e],l=a.maxStretchDistance;this.profileRightAxes[o+3]=a.rotationRight[0]*l,this.profileUpAxes[o+3]=a.rotationRight[1]*l}else this.profileRightAxes[o+3]=0,this.profileUpAxes[o+3]=0;++this._extrusionVertexCount}emitCapVertex(e,r,i,s,n,o){const a=4*this._extrusionVertexCount;this.profileRightAxes[a]=r.right[0],this.profileRightAxes[a+1]=r.right[1],this.profileRightAxes[a+2]=r.right[2],this.profileRightAxes[a+3]=n,this.profileUpAxes[a]=r.up[0],this.profileUpAxes[a+1]=r.up[1],this.profileUpAxes[a+2]=r.up[2],this.profileUpAxes[a+3]=o,this.profileVertexAndNormals[a]=i[0],this.profileVertexAndNormals[a+1]=i[1],this.profileVertexAndNormals[a+2]=s[0],this.profileVertexAndNormals[a+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=e,++this._extrusionVertexCount}_rebuildGeometry(){this._extrusionVertexCount=0;const{positions:e,offset:r,vertices:i}=this.path;this.positions=lF(e,r,3*i.length);let s=0;const n=(a,l,c,h,p)=>this.emitCapVertex(s,a,l,c,h,p),o=(a,l,c,h)=>this.emitVertex(s,a,l,c,h);for(this.startCap.rebuildConnectingProfileGeometry(i[s],this.profile,n),s=1;s<i.length-1;++s)this.extruder.extrude(i[s],this.profile,o);this.endCap.rebuildConnectingProfileGeometry(i[s],this.profile,n),s=0,this.startCap.rebuildCapGeometry(i[s],n),s=i.length-1,this.endCap.rebuildCapGeometry(i[s],n)}buildTopology(){const e=this.profile.vertices.length,r=this.profile.numSegments,i=this.numExtrusionProfiles-1;let s=3*(2*(r*i));this.startCap.indexBufferStart=s,this.startCap.firstProfileVertexIndex=0,s+=this.startCap.numIndices,this.endCap.indexBufferStart=s,this.endCap.firstProfileVertexIndex=e*(this.numExtrusionProfiles-1);const n=new Array,o=new Array,a=new Array,l=(c,h,p)=>{n.push(c),n.push(h),n.push(p),o.push(c),o.push(h),o.push(p),a.push(this.pathVertexData[c]),a.push(this.pathVertexData[h]),a.push(this.pathVertexData[p])};for(let c=0;c<r;++c){const h=this.profile.indices[2*c],p=this.profile.indices[2*c+1];for(let f=0;f<i;++f){const m=f*e+h,y=(f+1)*e+p,_=f*e+p;l(m,(f+1)*e+h,y),l(m,y,_)}}this.startCap.buildTopology(this.path.vertices[0],l),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],l),this.vertexIndices=Qf(n),this.normalIndices=Qf(o),this.pathVertexIndices=Qf(a)}onPathChanged(){this._rebuildGeometry()}},sK=class{rebuildConnectingProfileGeometry(e,r,i){for(let s=0;s<r.vertices.length;++s)i(e.frame,r.vertices[s],r.normals[s],0,0)}},ice=class extends sK{constructor(){super(),this.numVertices=0,this.numIndices=0}rebuildCapGeometry(){}buildTopology(){}},W$=class extends sK{constructor(e,r=0,i=!1){super(),this.profile=e,this.profilePlaneOffset=r,this.flip=i}get numVertices(){return this.profile.vertices.length}get numIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(e,r,i){const s=this.profilePlaneOffset;for(let n=0;n<r.vertices.length;++n)i(e.frame,r.vertices[n],r.normals[n],s,0)}rebuildCapGeometry(e,r){const i=this.profile,s=this.flip?1:-1,n=this.profilePlaneOffset,o=I3e;ar(o,0,0);for(let a=0;a<i.vertices.length;++a)r(e.frame,i.vertices[a],o,n,s)}buildTopology(e,r){const i=this.profile,s=this.vertexBufferStart+i.indices[0];for(let n=1;n<i.numSegments;++n){const o=i.indices[2*n],a=i.indices[2*n+1],l=this.vertexBufferStart+o,c=this.vertexBufferStart+a;this.flip?r(c,l,s):r(s,l,c)}}},sce=class extends sK{constructor(e){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=e.profile,this.flip=e.flip,this.sign=this.flip?1:-1,this.breakNormals=e.breakNormals,this.numSegments=e.subdivisions}get numVertices(){let e=this.profile.vertices.length*(this.numSegments-1)+this.profile.poles.length;return this.breakNormals&&(e+=this.profile.vertices.length),e}get numIndices(){let e=0;const r=this.profile;e+=2*r.numSegments*(this.numSegments-1);for(let i=0;i<r.numSegments;++i){const s=r.indices[2*i],n=r.indices[2*i+1];r.poleIndices[s]===r.poleIndices[n]?e+=1:e+=2}return 3*e}rebuildCapGeometry(e,r){const i=this.profile,s=e.frame,n=.5*this.sign,o=Hpt,a=I3e;ar(a,0,0);for(const l of i.poles)l.normal?r(s,l.position,l.normal,n,0):r(s,l.position,a,n,this.sign);if(this.breakNormals)for(let l=0;l<i.vertices.length;++l)r(s,i.vertices[l],i.normals[l],0,0);for(let l=0;l<this.numSegments-1;++l){const c=(1-(l+1)/this.numSegments)*Math.PI*.5,h=Math.sin(c),p=Math.cos(c);for(let f=0;f<i.vertices.length;++f){const m=i.poles[i.poleIndices[f]];$f(o,i.vertices[f],m.position),yc(o,o,h),m.normal?(Wd(o,o,m.position),r(s,o,m.normal,n*p,0)):(zR(a,o),yc(a,a,h),Wd(o,o,m.position),r(s,o,a,n*p,this.sign*p))}}}buildTopology(e,r){const i=this.profile,s=this.breakNormals?this.vertexBufferStart+i.poles.length:this.firstProfileVertexIndex,n=this.breakNormals?this.vertexBufferStart+i.poles.length+i.vertices.length:this.vertexBufferStart+i.poles.length;for(let o=0;o<i.numSegments;++o){const a=i.indices[2*o],l=i.indices[2*o+1],c=this.vertexBufferStart+i.poleIndices[a],h=this.vertexBufferStart+i.poleIndices[l];let p=s+a,f=s+l;for(let m=0;m<this.numSegments-1;++m){const y=n+m*i.vertices.length+a,_=n+m*i.vertices.length+l;this.flip?(r(y,f,p),r(f,y,_)):(r(p,f,y),r(_,y,f)),p=y,f=_}this.flip?(r(c,f,p),c!==h&&r(c,h,f)):(r(p,f,c),c!==h&&r(f,h,c))}}};const Hpt=Ge(),I3e=Ge();let qpt=class{numProfilesPerJoin(){return 1}extrude(e,r,i){for(let s=0;s<r.vertices.length;++s)i(e.frame,r.vertices[s],r.normals[s],!1)}},hz=class{constructor(e,r){this.cutoffAngle=e,this.numBendSubdivisions=r}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(e,r,i){const s=Xpt,{rotationAngle:n,rotationRight:o,frame:a}=e;if(Math.abs(n)>=this.cutoffAngle){const l=e.rotationFrameUp;for(let c=0;c<this.numBendSubdivisions+1;++c){Au(oce,.5*-n+c*n/this.numBendSubdivisions,l),Wpt(s,a,oce);for(let h=0;h<r.vertices.length;++h)rn(r.vertices[h],o)*n>=0?i(s,r.vertices[h],r.normals[h],!1):i(a,e.applyMiterStretch(nce,r.vertices[h]),r.normals[h],!0)}}else for(let l=0;l<this.numBendSubdivisions+1;++l)for(let c=0;c<r.vertices.length;++c){const h=rn(r.vertices[c],o)*n>=0;i(a,e.applyMiterStretch(nce,r.vertices[c]),r.normals[c],!h)}}},$3e=class{constructor(){this.up=O(),this.right=O()}};function Wpt(t,e,r){Fe(t.up,e.up,r),Fe(t.right,e.right,r)}const nce=Ge(),oce=be(),Xpt=new $3e;let Zpt=class extends Ys{constructor(e,r,i,s,n,o,a){super(e,r,i,null,ls.Mesh,a),this.path=s,this.geometrySR=n,this.stencilWidth=o}};var Kf;function L3e(t){return"path"in t}(function(t){t[t.World=0]="World",t[t.Path=1]="Path"})(Kf||(Kf={}));let D3e=class{constructor(e){this.builder=e}onPathChanged(e){this.builder.onPathChanged()}},N3e=class extends D3e{constructor(e){super(e),this.vertexAttributeColor=Nt(255,255,255,255),this.size=new Array,this.vertexAttributePosition=Ki(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Int16Array(2*this.builder.numVerticesTotal)}bakeVertexColors(e){this.vertexAttributeColor[0]=255*e[0],this.vertexAttributeColor[1]=255*e[1],this.vertexAttributeColor[2]=255*e[2],this.vertexAttributeColor[3]=255*(e.length>3?e[3]:1)}bake(e){this.size=e;const{numVerticesTotal:r,pathVertexData:i,path:s,positions:n,profileRightAxes:o,profileUpAxes:a,profileVertexAndNormals:l}=this.builder;for(let c=0;c<r;++c){let h=i[c];const p=h===0||h===s.vertices.length-1;h*=3;const f=eft;let m=0,y=0;const _=4*c,v=se(tft,o[_],o[_+1],o[_+2]),b=se(rft,a[_],a[_+1],a[_+2]),T=ar(ace,l[_]*e[0],l[_+1]*e[1]);if(p)ht(f,b,v),m=o[_+3]*e[0],y=a[_+3];else{const A=Jpt,R=Qpt;ar(A,o[_+3],a[_+3]);const M=oJ(A);zR(A,A);const D=rn(T,A);if(Math.abs(D)>M){ar(R,-A[1],A[0]);const k=rn(T,R);yc(A,A,M*Math.sign(D)),yc(R,R,k),Wd(T,A,R)}se(f,0,0,0)}const x=se(Kpt,v[0]*T[0]+b[0]*T[1],v[1]*T[0]+b[1]*T[1],v[2]*T[0]+b[2]*T[1]),S=3*c;this.vertexAttributePosition[S]=n[h]+x[0]+f[0]*m,this.vertexAttributePosition[S+1]=n[h+1]+x[1]+f[1]*m,this.vertexAttributePosition[S+2]=n[h+2]+x[2]+f[2]*m;const E=ar(ace,l[_+2],l[_+3]);jw(this.vertexAttributeNormal,c,v[0]*E[0]+b[0]*E[1]+f[0]*y,v[1]*E[0]+b[1]*E[1]+f[1]*y,v[2]*E[0]+b[2]*E[1]+f[2]*y)}}createGeometryData(){const e=this.builder.vertexIndices.length;return new F3e([[C.POSITION,new He(this.vertexAttributePosition,3,!0)],[C.NORMALCOMPRESSED,new He(this.vertexAttributeNormal,2,!0)],[C.COLOR,new He(this.vertexAttributeColor,4)]],[[C.POSITION,this.builder.vertexIndices],[C.NORMALCOMPRESSED,this.builder.normalIndices],[C.COLOR,uC(e)]])}onPathChanged(e){super.onPathChanged(e),this.bake(this.size)}intersect(e,r,i){const s=this.builder.vertexIndices,n=new He(this.vertexAttributePosition,3),o=s.length/3;tP(e,r,0,o,s,n,void 0,void 0,i)}},Ypt=class extends D3e{constructor(e,r,i,s){super(e),this.sizeAttributeValue=r,this.colorAttributeValue=i,this.opacityAttributeValue=s,this.vvData=null,this.baked=new N3e(e),this.vvData=Ki(4*this.builder.path.vertices.length);for(let n=0;n<this.builder.path.vertices.length;++n){this.vvData[4*n]=r,this.vvData[4*n+1]=i,this.vvData[4*n+2]=s;const o=n===0||n===this.builder.path.vertices.length-1;this.vvData[4*n+3]=o?1:0}}createGeometryData(){return new F3e([[C.POSITION,new He(this.builder.positions,3,!0)],[C.PROFILERIGHT,new He(this.builder.profileRightAxes,4,!0)],[C.PROFILEUP,new He(this.builder.profileUpAxes,4,!0)],[C.PROFILEVERTEXANDNORMAL,new He(this.builder.profileVertexAndNormals,4,!0)],[C.FEATUREVALUE,new He(this.vvData,4,!0)]],[[C.POSITION,this.builder.pathVertexIndices],[C.PROFILERIGHT,this.builder.vertexIndices],[C.PROFILEUP,this.builder.vertexIndices],[C.PROFILEVERTEXANDNORMAL,this.builder.vertexIndices],[C.FEATUREVALUE,this.builder.pathVertexIndices]])}onPathChanged(e){super.onPathChanged(e);const r=e.getMutableAttribute(C.POSITION);r&&(r.data=this.builder.positions)}},F3e=class{constructor(e,r){this.vertexAttributes=e,this.indices=r}};const ace=Ge(),Jpt=Ge(),Qpt=Ge(),Kpt=O(),eft=O(),tft=O(),rft=O();function ift(t,e){let r=null;const i=t.vertices.length,s=.99619469809,n=O(),o=O(),a=O(),l=O(),c=O(),h=O(),p=Nr();let f=t.vertices[0];re(o,e),se(n,0,1,0),hF(f.vRight,o,n,n,a,o,s),re(f.frame.up,o),re(f.frame.right,a);const m=t.positions;let y=t.offset;r=f;for(let _=1;_<i;++_){f=t.vertices[_],ue(c,f.vLeft,f.vRight);let v=Oe(c);v>0?(v=1/Math.sqrt(v),c[0]=c[0]*v,c[1]=c[1]*v,c[2]=c[2]*v):(c[0]=f.vRight[0],c[1]=f.vRight[1],c[2]=f.vRight[2]),h[0]=m[y]+r.frame.up[0],h[1]=m[y+1]+r.frame.up[1],h[2]=m[y+2]+r.frame.up[2],y+=3;const b=se(sft,m[y],m[y+1],m[y+2]);qM(b,c,p),px(p,Ou(h,f.vLeft),l)?(l[0]-=m[y],l[1]-=m[y+1],l[2]-=m[y+2],ye(o,l),ht(a,c,o),ye(a,a)):hF(c,r.frame.up,r.frame.right,n,a,o,s),re(f.frame.up,o),re(f.frame.right,a),r=f}}const sft=O();let U3e=class{constructor(){this.vertices=new Array,this.normals=new Array,this.indices=new Array,this.poles=new Array,this.poleIndices=new Array}addVertex(e,r){return this.vertices.push(C3(e)),this.normals.push(C3(r)),this.vertices.length-1}addPole(e,r=null){return this.poles.push({position:C3(e),normal:r?C3(r):null}),this.poles.length-1}addSegment(e,r=null){this.indices.push(e.v0),this.indices.push(e.v1),r&&(this.poleIndices.push(r.v0),this.poleIndices.push(r.v1))}get numSegments(){return this.indices.length/2}translate(e,r){for(const i of this.vertices)i[0]+=e,i[1]+=r;for(const i of this.poles)i.position[0]+=e,i.position[1]+=r}};const k3e={top:[0,-.5],bottom:[0,.5]};function dz(t){const r=cCe,i=new U3e,s={v0:0,v1:0};i.addPole(fr(0,0));for(let o=0;o<r;++o){const a=2*o*Math.PI/r,l=Math.cos(a),c=Math.sin(a),h=fr(l*.5,c*.5),p=fr(l,c);i.addVertex(h,p)}for(let o=0;o<r-1;++o){const a={v0:o,v1:o+1};i.addSegment(a,s)}const n={v0:r-1,v1:0};if(i.addSegment(n,s),t!=="center"){const o=k3e[t];i.translate(o[0],o[1])}return i}const nft={center:dz("center"),top:dz("top"),bottom:dz("bottom")},oft={center:pz("center"),top:pz("top"),bottom:pz("bottom")};function pz(t){const i=new U3e,s=fr(.5*-1,.5*-1),n=fr(.5*1,.5*-1),o=fr(.5*1,.5*1),a=fr(.5*-1,.5*1),l=fr(0,-1),c=fr(1,0),h=fr(0,1),p=fr(-1,0);if(i.addPole(fr(0,.5*1),h),i.addPole(fr(0,.5*1)),i.addPole(fr(0,.5*-1)),i.addPole(fr(0,.5*-1),l),i.addVertex(s,l),i.addVertex(n,l),i.addSegment({v0:0,v1:1},{v0:3,v1:3}),i.addVertex(n,c),i.addVertex(o,c),i.addSegment({v0:2,v1:3},{v0:2,v1:1}),i.addVertex(o,h),i.addVertex(a,h),i.addSegment({v0:4,v1:5},{v0:0,v1:0}),i.addVertex(a,p),i.addVertex(s,p),i.addSegment({v0:6,v1:7},{v0:1,v1:2}),t!=="center"){const f=k3e[t];i.translate(f[0],f[1])}return i}function aft(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function lft(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function z3e(t,e,r,i,s){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t}function cft(t,e){if(t===e){const r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function uft(t,e){const r=e[0],i=e[1],s=e[2],n=e[3];let o=r*n-s*i;return o?(o=1/o,t[0]=n*o,t[1]=-i*o,t[2]=-s*o,t[3]=r*o,t):null}function hft(t,e){const r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t}function dft(t){return t[0]*t[3]-t[2]*t[1]}function V3e(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=r[0],l=r[1],c=r[2],h=r[3];return t[0]=i*a+n*l,t[1]=s*a+o*l,t[2]=i*c+n*h,t[3]=s*c+o*h,t}function pft(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+n*a,t[1]=s*l+o*a,t[2]=i*-a+n*l,t[3]=s*-a+o*l,t}function fft(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=r[0],l=r[1];return t[0]=i*a,t[1]=s*a,t[2]=n*l,t[3]=o*l,t}function mft(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t}function gft(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function yft(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function _ft(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2)}function vft(t,e,r,i){return t[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-t[2]*r[1],[t,e,r]}function bft(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function B3e(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function wft(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function xft(t,e){const r=t[0],i=t[1],s=t[2],n=t[3],o=e[0],a=e[1],l=e[2],c=e[3],h=sl();return Math.abs(r-o)<=h*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=h*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(s-l)<=h*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=h*Math.max(1,Math.abs(n),Math.abs(c))}function Tft(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function Sft(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t}const Eft=V3e,Cft=B3e;Object.freeze(Object.defineProperty({__proto__:null,LDU:vft,add:bft,adjoint:hft,copy:aft,determinant:dft,equals:xft,exactEquals:wft,frob:_ft,fromRotation:mft,fromScaling:gft,identity:lft,invert:uft,mul:Eft,multiply:V3e,multiplyScalar:Tft,multiplyScalarAndAdd:Sft,rotate:pft,scale:fft,set:z3e,str:yft,sub:Cft,subtract:B3e,transpose:cft},Symbol.toStringTag,{value:"Module"}));function G3e(){return[1,0,0,1]}function Aft(t){return[t[0],t[1],t[2],t[3]]}function Oft(t,e,r,i){return[t,e,r,i]}function Rft(t,e){return new Float64Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:Aft,create:G3e,createView:Rft,fromValues:Oft},Symbol.toStringTag,{value:"Module"}));let j3e=class{constructor(){this.vLeft=O(),this.vRight=O(),this.vMinSiblingLength=0,this.frame=new $3e}setFrameFromUpVector(e){re(this.frame.up,e),ue(fA,this.vLeft,this.vRight),ye(fA,fA),ie(uce,this.frame.up,fe(fA,this.frame.up)),de(X$,fA,uce),ye(X$,X$),ht(this.frame.right,X$,this.frame.up)}get foldingAngle(){return Math.PI-this.rotationAngle}},Mft=class extends j3e{get rotationFrameUp(){return this.frame.up}get rotationRight(){return Wbe}get rotationAngle(){return ie(p0,this.frame.up,fe(this.frame.up,this.vLeft)),de(p0,this.vLeft,p0),pa(p0,p0),ye(p0,p0),ie(gT,this.frame.up,fe(this.frame.up,this.vRight)),de(gT,this.vRight,gT),ye(gT,gT),ht(GF,this.rotationFrameUp,this.vLeft),Math.sign(fe(GF,this.vRight))*(Math.PI-In(fe(p0,gT)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength/Math.cos(.5*this.foldingAngle))}applyMiterStretch(e,r){const i=this.rotationAngle;if(Math.abs(i)<=0)return r;const s=iB(Math.cos(.5*i));return ar(e,(s-1+1)*r[0],r[1])}},Pft=class extends j3e{get rotationFrameUp(){const e=Math.sign(fe(this.frame.right,this.vRight));return ht(pA,this.vRight,this.vLeft),ie(pA,pA,e),ye(pA,pA)}get rotationRight(){const e=this.rotationFrameUp,r=fe(e,this.frame.up),i=fe(e,this.frame.right);return ie(mT,this.frame.up,-i),ie(cce,this.frame.right,r),ue(mT,mT,cce),ye(mT,mT),Ift(lce,this.frame,mT),lce}get rotationAngle(){const e=Math.sign(fe(this.frame.right,this.vRight));return pa(GF,this.vLeft),-e*(Math.PI-In(fe(GF,this.vRight)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength*iB(Math.cos(.5*this.foldingAngle)))}applyMiterStretch(e,r){const i=this.rotationAngle;if(Math.abs(i)===0)return r;const s=iB(Math.cos(.5*i)),n=this.rotationRight,o=z3e(Lft,1+(s-1)*n[0]*n[0],(s-1)*n[0]*n[1],(s-1)*n[0]*n[1],1+(s-1)*n[1]*n[1]);return Fxe(e,r,o)}};function Ift(t,e,r){ar(t,fe(r,e.right),fe(r,e.up))}function $ft(t){switch(t){case Kf.World:return new Mft;case Kf.Path:return new Pft}}const pA=O(),lce=Ge(),mT=O(),cce=O(),GF=O(),p0=O(),gT=O(),uce=O(),fA=O(),X$=O(),Lft=G3e(),fz=8;function Dft(t,e){const r=C.FEATUREVALUE;t.attributes.add(r,"vec4");const i=t.vertex;i.code.add(w`
  bool isCapVertex() {
    return ${r}.w == 1.0;
  }
  `),i.uniforms.add(new Ar("size",s=>s.size)),e.vvSize?(i.uniforms.add(new zt("vvSizeMinSize",s=>s.vvSize.minSize),new zt("vvSizeMaxSize",s=>s.vvSize.maxSize),new zt("vvSizeOffset",s=>s.vvSize.offset),new zt("vvSizeFactor",s=>s.vvSize.factor)),i.code.add(w`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${r}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):i.code.add(w`vec2 getSize(){
return size;
}`),e.vvOpacity?(i.constants.add("vvOpacityNumber","int",fz),i.uniforms.add(new Ol("vvOpacityValues",s=>s.vvOpacity.values,fz),new Ol("vvOpacityOpacities",s=>s.vvOpacity.opacityValues,fz)),i.code.add(w`
    vec4 applyOpacity(vec4 color) {
      float value = ${r}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):i.code.add(w`vec4 applyOpacity(vec4 color){
return color;
}`),e.vvColor?(i.constants.add("vvColorNumber","int",A2),i.uniforms.add(new Ol("vvColorValues",s=>s.vvColor.values,A2),new vEe("vvColorColors",s=>s.vvColor.colors,A2)),i.code.add(w`
    vec4 getColor() {
      float value = ${r}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):i.code.add(w`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),t.include(ZM),t.attributes.add(C.PROFILERIGHT,"vec4"),t.attributes.add(C.PROFILEUP,"vec4"),t.attributes.add(C.PROFILEVERTEXANDNORMAL,"vec4"),i.code.add(w`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),i.code.add(w`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),i.code.add(w`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),i.code.add(w`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}let Nft=class extends nP{constructor(){super(...arguments),this.size=fr(1,1)}};function Fft(t){const e=new Sr,{vertex:r,fragment:i}=e;switch(Mc(r,t),e.varyings.add("vpos","vec3"),e.include(Dft,t),t.output!==U.Color&&t.output!==U.Alpha||(e.include(Ml,t),e.include(Gw,t),e.include(cC,t),e.varyings.add("vnormal","vec3"),e.varyings.add("vcolor","vec4"),t.hasMultipassTerrain&&e.varyings.add("depth","float"),r.code.add(w`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${t.output===U.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),e.include(Mu,t),t.output){case U.Alpha:e.include(ys,t),i.uniforms.add(new Pe("opacity",s=>s.opacity)),i.code.add(w`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        fragColor = vec4(combinedOpacity);
      }
    `);break;case U.Color:e.include(ys,t),e.include(Hw,t),e.include(dP,t),e.include(Gw,t),e.include(DAe,t),Cp(i,t),pP(i),_C(i),i.uniforms.add(r.uniforms.get("localOrigin"),new zt("ambient",s=>s.ambient),new zt("diffuse",s=>s.diffuse),new zt("specular",s=>s.specular),new Pe("opacity",s=>s.opacity)),i.include(Em),Sm(i),i.code.add(w`
        void main() {
          discardBySlice(vpos);
          ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          fragColor = vec4(shadedColor, combinedOpacity);
          fragColor = highlightSlice(fragColor, vpos);
          ${t.transparencyPassType===ut.Color?"fragColor = premultiplyAlpha(fragColor);":""}
        }
      `);break;case U.Depth:case U.Shadow:case U.ShadowHighlight:case U.ShadowExcludeHighlight:e.include(Ml,t),Nw(e),e.varyings.add("depth","float"),r.code.add(w`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),e.include(ys,t),e.include(_y,t),i.code.add(w`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case U.Normal:e.include(Ml,t),e.include(tM,t),wE(r),e.varyings.add("vnormal","vec3"),r.code.add(w`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(ys,t),i.code.add(w`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case U.Highlight:e.include(Ml,t),e.include(tM,t),e.varyings.add("vnormal","vec3"),r.code.add(w`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(ys,t),e.include(Ly,t),i.code.add(w`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return e}const Uft=Object.freeze(Object.defineProperty({__proto__:null,build:Fft},Symbol.toStringTag,{value:"Module"})),H3e=new Map([[C.POSITION,0],[C.PROFILERIGHT,1],[C.PROFILEUP,2],[C.PROFILEVERTEXANDNORMAL,3],[C.FEATUREVALUE,4]]);let kft=class extends Nft{constructor(){super(...arguments),this.ambient=Me(.2,.2,.2),this.diffuse=Me(.8,.8,.8),this.specular=Me(0,0,0),this.opacity=1,this.origin=O(),this.modelTransformation=null}},q3e=class W3e extends Lr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Ue.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Rr(e.rctx,W3e.shader.get().build(this.configuration),H3e)}initializePipeline(){const e=this.configuration.transparencyPassType,r=this.configuration,i=e===ut.NONE,s=e===ut.FrontFace;return Mt({blending:r.output!==U.Color&&r.output!==U.Alpha||!r.transparent?null:i?xu:Dy(e),culling:r.hasSlicePlane&&!r.transparent&&r.doubleSidedMode!==es.None?Wxe:null,depthTest:{func:Ov(e)},depthWrite:i||s?Ul:null,colorWrite:Gt,stencilWrite:r.hasOccludees?mm:null,stencilTest:r.hasOccludees?Rv:null,polygonOffset:i||s?null:RU})}};q3e.shader=new Or(Uft,()=>ce(()=>import("./Path.glsl-87e26f30.js"),[],import.meta.url));let zn=class extends Vo{constructor(){super(...arguments),this.output=U.Color,this.doubleSidedMode=es.None,this.transparencyPassType=ut.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1}};u([B({count:U.COUNT})],zn.prototype,"output",void 0),u([B({count:es.COUNT})],zn.prototype,"doubleSidedMode",void 0),u([B({count:ut.COUNT})],zn.prototype,"transparencyPassType",void 0),u([B()],zn.prototype,"spherical",void 0),u([B()],zn.prototype,"receiveShadows",void 0),u([B()],zn.prototype,"receiveAmbientOcclusion",void 0),u([B()],zn.prototype,"vvSize",void 0),u([B()],zn.prototype,"vvColor",void 0),u([B()],zn.prototype,"vvOpacity",void 0),u([B()],zn.prototype,"hasSlicePlane",void 0),u([B()],zn.prototype,"transparent",void 0),u([B()],zn.prototype,"hasOccludees",void 0),u([B()],zn.prototype,"hasMultipassTerrain",void 0),u([B()],zn.prototype,"cullAboveGround",void 0),u([B()],zn.prototype,"doublePrecisionRequiresObfuscation",void 0),u([B({constValue:lt.Disabled})],zn.prototype,"pbrMode",void 0),u([B({constValue:!0})],zn.prototype,"hasVvInstancing",void 0),u([B({constValue:!1})],zn.prototype,"useCustomDTRExponentForWater",void 0),u([B({constValue:!1})],zn.prototype,"useFillLights",void 0);let zft=class X3e extends Av{constructor(e){super(e,new Bft),this.supportsEdges=!0,this._vertexAttributeLocations=H3e,this._configuration=new zn,this._vertexBufferLayout=X3e.getVertexBufferLayout()}getConfiguration(e,r){return this._configuration.output=e,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,e!==U.Color&&e!==U.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?es.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?es.WindingOrder:es.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=!!r.ssaoHelper.active&&this.parameters.receiveSSAO),this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}isVisibleForOutput(e){return e!==U.Shadow&&e!==U.ShadowExcludeHighlight&&e!==U.ShadowHighlight||this.parameters.castShadows}isVisible(){return super.isVisible()&&this.parameters.opacity>0}intersect(e,r,i,s,n,o){const a=e;if(!L3e(a))return;const l=a.path,c=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSize){const{offset:v,factor:b,minSize:T,maxSize:x}=this.parameters.vvSize,S=l.sizeAttributeValue;c[0]*=ve(v[0]+S*b[0],T[0],x[0]),c[1]*=ve(v[2]+S*b[2],T[2],x[2])}const h=Math.max(c[0],c[1]),p=e.boundingInfo;if(p==null)return void this._intersectTriangles(l,c,s,n,o);const f=Ew(p.bbMin[0]-h,p.bbMin[1]-h,p.bbMin[2]-h,p.bbMax[0]+h,p.bbMax[1]+h,p.bbMax[2]+h),m=[n[0]-s[0],n[1]-s[1],n[2]-s[2]],y=Math.sqrt(m[0]*m[0]+m[1]*m[1]+m[2]*m[2]),_=[y/m[0],y/m[1],y/m[2]];aQ(f,s,_,i.tolerance)&&this._intersectTriangles(l,c,s,n,o)}_intersectTriangles(e,r,i,s,n){e.baked.size&&e.baked.size[0]===r[0]&&e.baked.size[1]===r[1]||e.baked.bake(r),e.baked.intersect(i,s,n)}createBufferWriter(){return new yC(this._vertexBufferLayout)}requiresSlot(e,r){switch(r){case U.Shadow:case U.ShadowHighlight:case U.ShadowExcludeHighlight:if(!this.parameters.castShadows)return!1;case U.Color:case U.Alpha:case U.Depth:case U.Normal:case U.Highlight:case U.ObjectAndLayerIdColor:return e===(this.parameters.transparent?he.TRANSPARENT_MATERIAL:he.OPAQUE_MATERIAL)||e===he.DRAPED_MATERIAL;default:return!1}}createGLMaterial(e){return new Vft(e)}static getVertexBufferLayout(){return Hi().vec3f(C.POSITION).vec4f(C.PROFILERIGHT).vec4f(C.PROFILEUP).vec4f(C.PROFILEVERTEXANDNORMAL).vec4f(C.FEATUREVALUE)}},Vft=class extends Ev{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}_updateShadowState(e){this.technique!=null&&e.shadowMap.enabled===this.technique.configuration.receiveShadows||this._material.setParameters({receiveShadows:e.shadowMap.enabled})}beginSlot(e){return this._output!==U.Color&&this._output!==U.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e)),this.ensureTechnique(q3e,e)}},Bft=class extends kft{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveSSAO=!0,this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}};const Gft=["polyline"];let jft=class extends Am{constructor(e,r,i,s){super(e,r,i,s),this._intrinsicSize=fr(1,1),this._upVectorAlignment=Kf.Path,this._stencilWidth=.1,this.ensureDrapedStatus(!1)}async doLoad(){const e=this.symbolLayer.width!=null?this.symbolLayer.width:this.symbolLayer.height,r=this.symbolLayer.height!=null?this.symbolLayer.height:e;this._vvConvertOptions=new sP({size:!0,color:!0,rotation:!1,opacity:!0},[1,1,1],[e,1,r],this._context.renderCoordsHelper.unitInMeters),this._fastUpdates=this._context.renderer?.visualVariables?.length>0?TE(this._context.renderer,this._vvConvertOptions):null;const i=this.symbolLayer.anchor||"center";this._upVectorAlignment=this.symbolLayer.profileRotation==="heading"?Kf.World:Kf.Path;const s=this.symbolLayer.profile||"circle";switch(s){default:case"circle":this._profile=nft[i];break;case"quad":this._profile=oft[i]}switch(this.symbolLayer.join){case"round":this._extruder=new hz(0,lCe);break;case"bevel":this._extruder=new hz(0,1);break;case"miter":this._extruder=new hz(.8*Math.PI,1);break;default:this._extruder=new qpt}const n=this.symbolLayer.cap||"butt";switch(n){case"none":this._startCap=new ice,this._endCap=new ice;break;case"butt":default:this._startCap=new W$(this._profile,0),this._endCap=new W$(this._profile,0,!0);break;case"square":this._startCap=new W$(this._profile,-.5),this._endCap=new W$(this._profile,.5,!0);break;case"round":{const f=s==="quad";this._startCap=new sce({profile:this._profile,flip:!1,breakNormals:f,subdivisions:$q}),this._endCap=new sce({profile:this._profile,flip:!0,breakNormals:f,subdivisions:$q});break}}const o=this.symbolLayer?.material?.color,a=this._getCombinedOpacityAndColor(o),l=Wa(a),c=a[3],h=c<1||this.needsDrivenTransparentPass,p={diffuse:l,ambient:l,opacity:c,transparent:h,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:h||n==="none"?mi.None:mi.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(ar(this._intrinsicSize,e,r),!Iq(this._intrinsicSize[0])||!Iq(this._intrinsicSize[1])))throw new V("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(this._fastUpdates&&this._fastUpdates.visualVariables.size||yc(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates){const f={...p,...this._fastUpdates.materialParameters,size:Vbe(this._intrinsicSize)};this._material=new zft(f)}else p.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,p.normalType=Ir.Compressed,this._material=new gm(p);this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,Gft,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new Pp),s=e.renderingInfo;return this._createAs3DShape(r,s,i,r.uid)}layerOpacityChanged(){const e=this.symbolLayer?.material?.color,r=this._getCombinedOpacity(e),i=r<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:r,transparent:i})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,pv)}slicePlaneEnabledChanged(){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables"||!SE(this._fastUpdates,r,this._vvConvertOptions))return Ns.RecreateSymbol;this._material.setParameters(this._fastUpdates.materialParameters)}return Ns.FastUpdate}_getVertexData(e){let r=0;const i=e.paths,s=[],n=e.spatialReference,o=this._context.elevationProvider.spatialReference,a=this._context.renderCoordsHelper.spatialReference;for(const p of i)r+=p.length;const l=Ho(3*r);let c,h=0;for(const p of i){s.push({offset:h,numVertices:p.length});for(const f of p)l[h++]=f[0],l[h++]=f[1],l[h++]=e.hasZ?f[2]:0}return o==null||n.equals(o)||li(l,n,0,l,o,0,r)?(o==null||o.equals(a)?c=rSe(l):(c=Ho(3*r),li(l,o,0,c,a,0,r)),{pathVertexDataInfos:s,vertexDataES:l,vertexDataRS:c}):null}_createAs3DShape(e,r,i,s){const n=e.geometry,o=this._getVertexData(n);if(o==null)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(o.pathVertexDataInfos.length===0)return n.paths.length!==0&&n.paths.some(y=>y.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;const a=new Array,l=n.spatialReference,c=pn(),h=this._context.renderCoordsHelper,p=new JJ(o.vertexDataES);for(const y of o.pathVertexDataInfos){const _=y.numVertices;if(_<2)continue;const v=y.offset;if(this._context.clippingExtent!=null&&(Si(c),gu(c,o.vertexDataES,v,_),!np(c,this._context.clippingExtent)))continue;const b=new Array,T=v+3*_;for(let k=v;k<T;k+=3){p.offset=k;const $=Lot(p,this._context.elevationProvider,i,h);se(ms,o.vertexDataRS[k],o.vertexDataRS[k+1],o.vertexDataRS[k+2]),h.setAltitude(ms,$),o.vertexDataRS[k]=ms[0],o.vertexDataRS[k+1]=ms[1],o.vertexDataRS[k+2]=ms[2],b.push($ft(this._upVectorAlignment))}const x=new Gpt(b,o.vertexDataES,o.vertexDataRS,v);Z3e(x,this._upVectorAlignment,this._context.renderCoordsHelper);const S=new jpt(x,this._profile,this._extruder,this._startCap,this._endCap);let E=null;if(this._fastUpdates){const k=this._fastUpdates.visualVariables,$=gp(k.size?.field,e)??0,N=gp(k.color?.field,e)??0,H=gp(k.opacity?.field,e)??0;E=new Ypt(S,$,N,H)}else{const k=[this._intrinsicSize[0],this._intrinsicSize[1]];if(this._drivenProperties.size){const H=r.size;k[0]*=hce(H[0],H[2]==="symbol-value"?this.symbolLayer.height||0:H[2],this.symbolLayer.width||0),k[1]*=hce(H[2],H[0]==="symbol-value"?this.symbolLayer.width||0:H[0],this.symbolLayer.height||0)}let $;this._drivenProperties.color&&($=r.color),this._drivenProperties.opacity&&r.opacity!=null&&($=$?[$[0],$[1],$[2],r.opacity]:[1,1,1,r.opacity]);const N=new N3e(S);N.bake(k),$&&N.bakeVertexColors($),E=N}const{vertexAttributes:A,indices:R}=E.createGeometryData(),M=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:this._context.layer.uid}),D=new Zpt(this._material,A,R,E,l,this._stencilWidth,M);D.transformation=Fl(be(),un,S.path.origin),a.push(D)}if(a.length===0)return null;const f=new Ny({geometries:a,layerUid:this._context.layer.uid,graphicUid:s}),m=new Cm(this,f,a,null,null,(y,_,v,b,T)=>qft(y,_,b,T,this._upVectorAlignment),i);return m.alignedSampledElevation=0,m.needsElevationUpdates=pv(i.mode),m}};function Z3e(t,e,r){const{origin:i,positions:s}=t;let n=t.offset;switch(e){default:case Kf.World:for(const o of t.vertices)ms[0]=s[n++]+i[0],ms[1]=s[n++]+i[1],ms[2]=s[n++]+i[2],r.worldUpAtPosition(ms,ms),o.setFrameFromUpVector(ms);break;case Kf.Path:ms[0]=s[n]+i[0],ms[1]=s[n+1]+i[1],ms[2]=s[n+2]+i[2],r.worldUpAtPosition(ms,ms),ift(t,ms)}}function hce(t,e,r){switch(t){case"symbol-value":return r;case"proportional":return e;default:return t}}function Hft(t,e,r,i){let s=0;const{origin:n,vertices:o,positions:a,positionsES:l}=t,c=t.offset+3*o.length;for(let h=t.offset;h<c;h+=3)se(ms,l[h],l[h+1],l[h+2]),r(ms,mz),s+=mz.sampledElevation,ms[0]=a[h]+n[0],ms[1]=a[h+1]+n[1],ms[2]=a[h+2]+n[2],i.setAltitude(ms,mz.z),a[h]=ms[0]-n[0],a[h+1]=ms[1]-n[1],a[h+2]=ms[2]-n[2];return t.updatePathVertexInformation(),s/o.length}function qft(t,e,r,i,s){const n=t.stageObject,o=n.geometries;let a=0;for(const l of o){if(!L3e(l))continue;const c=l.path,h=c.builder.path;a+=Hft(h,e,r,i),s!==Kf.World&&Z3e(h,s,i),c.onPathChanged(l),l.invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(l)}return a/o.length}const ms=O(),mz=new aP;function Wft(t,e,r,i,s=1){if(r.isGeographic&&i===Ue.Global){const c=Ho(e.length),h=e.length,p=zr(r);for(let f=0;f<h;f+=3)L6(e,f,c,f,p);e=c}ar(nn,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let c=0;c<e.length;c+=3)nn[0]=Math.min(nn[0],e[c]),nn[1]=Math.min(nn[1],e[c+1]);const n=nn[0]%s,o=nn[1]%s,a=nn[0]-n,l=nn[1]-o;for(let c=0;c<e.length;c+=3){const h=c/3*4;t[h]=(e[c]-a)/s,t[h+1]=(e[c+1]-l)/s,t[h+2]=a/s,t[h+3]=l/s}}function Y3e(t,e,r,i,s=1){se(a1,1,0,0),se(l1,0,1,0),se(_T,0,0,1),Yft(gz,r),Xft(r,dce)&&Zft(dce,a1,l1,_T,i,gz),ar(nn,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),ar(c1,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let h=0;h<r.length;h+=3){se(yT,r[h],r[h+1],r[h+2]);const p=fe(a1,yT),f=fe(l1,yT);nn[0]=Math.min(nn[0],p),nn[1]=Math.min(nn[1],f),c1[0]=Math.max(c1[0],p),c1[1]=Math.max(c1[1],f)}const n=fe(_T,gz);_z(f0,nn[0],nn[1],n,a1,l1,_T),_z(u1,c1[0],nn[1],n,a1,l1,_T),_z(h1,nn[0],c1[1],n,a1,l1,_T),de(u1,u1,f0),ie(u1,u1,.5),de(h1,h1,f0),ie(h1,h1,.5),ue(f0,f0,u1),ue(f0,f0,h1);const o=nn[0]%s,a=nn[1]%s,l=nn[0]-o,c=nn[1]-a;for(let h=0;h<r.length;h+=3){se(yT,r[h],r[h+1],r[h+2]);const p=h/3,f=4*p;t[f]=(fe(a1,yT)-l)/s,t[f+1]=(fe(l1,yT)-c)/s,t[f+2]=l/s,t[f+3]=c/s;const m=9*p;for(let y=0;y<3;y++)e[m+y]=f0[y],e[m+y+3]=u1[y],e[m+y+6]=h1[y]}}const gz=O(),yT=O(),dce=Nr(),a1=O(),l1=O(),_T=O(),nn=Ge(),c1=Ge(),f0=O(),u1=O(),h1=O();function Xft(t,e){const r=t.length/3-1;return nwe(t,e,0,Math.floor(r/3),Math.floor(r*(2/3)))}function Zft(t,e,r,i,s,n){s!=null?(s.basisMatrixAtPosition(n,Jp),se(Z$,Jp[0],Jp[1],Jp[2]),se(Y$,Jp[4],Jp[5],Jp[6]),se(yz,Jp[8],Jp[9],Jp[10])):(se(Z$,1,0,0),se(Y$,0,1,0),se(yz,0,0,1));const o=t;fe(o,yz)<0&&ie(o,o,-1),re(i,o);const a=fe(o,Y$),l=fe(o,Z$);Math.abs(a)<Math.abs(l)?(Fb(e,Z$,o,-l),ye(e,e),ht(r,e,o),ye(r,r),ie(r,r,-1)):(Fb(r,Y$,o,-a),ye(r,r),ht(e,r,o),ye(e,e))}const Jp=be(),Z$=O(),Y$=O(),yz=O();function Yft(t,e){se(mA,0,0,0);for(let r=0;r<e.length-3;r+=3)mA[0]+=e[r],mA[1]+=e[r+1],mA[2]+=e[r+2];ie(t,mA,1/(e.length/3-1))}const mA=O();function _z(t,e,r,i,s,n,o){se(t,e*s[0]+r*n[0]+i*o[0],e*s[1]+r*n[1]+i*o[1],e*s[2]+r*n[2]+i*o[2])}function Jft(t){const e=new Sr,{vertex:r,fragment:i,attributes:s,varyings:n}=e;Mc(r,t),e.include(Ml,t),e.include(bx,t),e.include(Yg,t),e.include(iP,t),s.add(C.POSITION,"vec3"),t.vvColor&&s.add(C.COLORFEATUREATTRIBUTE,"float"),n.add("vColor","vec4"),n.add("vpos","vec3");const o=t.hasMultipassTerrain&&(t.output===U.Color||t.output===U.Alpha);o&&n.add("depth","float"),r.uniforms.add(new nr("eColor",c=>c.color));const a=t.output===U.Depth;a&&(e.include(_y,t),Nw(e),av(e)),r.code.add(w`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${t.hasVertexColors?"vColor *= eColor;":t.vvColor?"vColor = eColor * interpolateVVColor(colorFeatureAttribute);":"vColor = eColor;"}
      ${o?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${a?w`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:w`transformPosition(proj, view, vpos);`}
    }
  `),e.include(ys,t),o&&e.include(Mu,t),i.include(Em);const l=t.output===U.Highlight;return l&&e.include(Ly,t),i.code.add(w`
  void main() {
    discardBySlice(vpos);
    ${o?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = vColor;

    ${t.output===U.ObjectAndLayerIdColor?w`fColor.a = 1.0;`:""}

    if (fColor.a < ${w.float(yo)}) {
      discard;
    }

    ${t.output===U.Alpha?w`fragColor = vec4(fColor.a);`:""}

    ${t.output===U.Color?w`fragColor = highlightSlice(fColor, vpos); ${t.transparencyPassType===ut.Color?"fragColor = premultiplyAlpha(fragColor);":""}`:""}
    ${l?w`outputHighlight();`:""};
    ${t.output===U.Depth?w`outputDepth(linearDepth);`:""};
    ${t.output===U.ObjectAndLayerIdColor?w`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const Qft=Object.freeze(Object.defineProperty({__proto__:null,build:Jft},Symbol.toStringTag,{value:"Module"}));let J3e=class Q3e extends Lr{initializeProgram(e){return new Rr(e.rctx,Q3e.shader.get().build(this.configuration),Tr)}_createPipeline(e,r){const i=this.configuration,s=e===ut.NONE,n=e===ut.FrontFace;return Mt({blending:i.output!==U.Color&&i.output!==U.Alpha||!i.transparent?null:s?xu:Dy(e),culling:tU(i.cullFace),depthTest:{func:Ov(e)},depthWrite:(s||n)&&i.writeDepth?Ul:null,colorWrite:Gt,stencilWrite:i.hasOccludees?mm:null,stencilTest:i.hasOccludees?r?mv:Rv:null,polygonOffset:s||n?i.polygonOffset?Kft:null:MU(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};J3e.shader=new Or(Qft,()=>ce(()=>import("./ColorMaterial.glsl-1aa768f7.js"),[],import.meta.url));const Kft={factor:1,units:1};let Io=class extends Vo{constructor(){super(...arguments),this.output=U.Color,this.cullFace=mi.None,this.transparencyPassType=ut.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1}};u([B({count:U.COUNT})],Io.prototype,"output",void 0),u([B({count:mi.COUNT})],Io.prototype,"cullFace",void 0),u([B({count:ut.COUNT})],Io.prototype,"transparencyPassType",void 0),u([B()],Io.prototype,"hasSlicePlane",void 0),u([B()],Io.prototype,"hasVertexColors",void 0),u([B()],Io.prototype,"transparent",void 0),u([B()],Io.prototype,"polygonOffset",void 0),u([B()],Io.prototype,"enableOffset",void 0),u([B()],Io.prototype,"writeDepth",void 0),u([B()],Io.prototype,"hasOccludees",void 0),u([B()],Io.prototype,"hasMultipassTerrain",void 0),u([B()],Io.prototype,"cullAboveGround",void 0),u([B()],Io.prototype,"objectAndLayerIdColorInstanced",void 0),u([B()],Io.prototype,"vvColor",void 0),u([B({constValue:!0})],Io.prototype,"hasVvInstancing",void 0),u([B({constValue:!1})],Io.prototype,"vvSize",void 0),u([B({constValue:!1})],Io.prototype,"vvOpacity",void 0);let pce=class extends UQ{constructor(e){super(e,new tmt),this.supportsEdges=!0,this._configuration=new Io}getConfiguration(e,r){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<OU,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}requiresSlot(e,r){return r===U.Color||r===U.Alpha||r===U.Highlight||r===U.Depth&&this.parameters.writeLinearDepth||r===U.ObjectAndLayerIdColor?e===he.DRAPED_MATERIAL?!0:r===U.Highlight?e===he.OPAQUE_MATERIAL:e===(this.parameters.transparent?this.parameters.writeDepth?he.TRANSPARENT_MATERIAL:he.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:he.OPAQUE_MATERIAL):!1}createGLMaterial(e){return new emt(e)}createBufferWriter(){const e=Hi().vec3f(C.POSITION);return oe("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(C.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?e.f32(C.COLORFEATUREATTRIBUTE):e.vec4u8(C.COLOR),new yC(e)}},emt=class extends Ev{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==U.Color&&this._output!==U.Alpha||this._updateOccludeeState(e),this.ensureTechnique(J3e,e)}},tmt=class extends nP{constructor(){super(...arguments),this.color=Wf,this.transparent=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=mi.None,this.hasOccludees=!1}};var go;(function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.Cross=2]="Cross",t[t.ForwardDiagonal=3]="ForwardDiagonal",t[t.BackwardDiagonal=4]="BackwardDiagonal",t[t.DiagonalCross=5]="DiagonalCross",t[t.COUNT=6]="COUNT"})(go||(go={}));const Jq=.70710678118,fce=Jq,rmt=.08715574274;function imt(t){const e=new Sr,r=t.hasMultipassTerrain&&(t.output===U.Color||t.output===U.Alpha),{vertex:i,fragment:s,attributes:n,varyings:o}=e;Mc(i,t),e.include(Ml,t),e.include(bx,t),e.include(Yg,t),t.draped?i.uniforms.add(new Pe("worldToScreenRatio",(c,h)=>1/h.screenToPCSRatio)):n.add(C.BOUNDINGRECT,"mat3"),n.add(C.POSITION,"vec3"),n.add(C.UVMAPSPACE,"vec4"),t.vvColor&&n.add(C.COLORFEATUREATTRIBUTE,"float"),o.add("vColor","vec4"),o.add("vpos","vec3"),o.add("vuv","vec2"),r&&o.add("depth","float"),i.uniforms.add(new nr("uColor",c=>c.color));const a=t.style===go.ForwardDiagonal||t.style===go.BackwardDiagonal||t.style===go.DiagonalCross;a&&i.code.add(w`
      const mat2 rotate45 = mat2(${w.float(Jq)}, ${w.float(-fce)},
                                 ${w.float(fce)}, ${w.float(Jq)});
    `),t.draped||(Cp(i,t),i.uniforms.add(new Pe("worldToScreenPerDistanceRatio",(c,h)=>1/h.camera.perScreenPixelRatio)),i.code.add(w`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),i.code.add(w`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),i.code.add(w`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${w.float(rmt)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),i.code.add(w`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${a?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${a?" * rotate45":""};

      ${t.draped?"":w`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${w.float(t.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `);const l=t.output===U.Depth;return l&&(e.include(_y,t),Nw(e),av(e)),i.code.add(w`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${r?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      ${t.hasVertexColors?"vColor *= uColor;":t.vvColor?"vColor = uColor * interpolateVVColor(colorFeatureAttribute);":"vColor = uColor;"}
      gl_Position = ${l?w`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:w`transformPosition(proj, view, vpos);`}
    }
  `),e.include(ys,t),s.include(Em),t.draped&&s.uniforms.add(new Pe("texelSize",(c,h)=>1/h.camera.pixelRatio)),t.output===U.Highlight&&e.include(Ly,t),r&&e.include(Mu,t),t.output!==U.Highlight&&(s.code.add(w`
      const float lineWidth = ${w.float(t.lineWidth)};
      const float spacing = ${w.float(t.patternSpacing)};
      const float spacingINV = ${w.float(1/t.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),t.draped||s.code.add(w`const int maxSamples = 5;
float sampleAA(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),s.code.add(w`
    void main() {
      discardBySlice(vpos);
      ${r?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = vColor;
      color = highlightSlice(color, vpos);

      ${t.output!==U.Highlight?w`color.a *= ${smt(t)};`:""}

      ${t.output===U.ObjectAndLayerIdColor?w`color.a = 1.0;`:""}

      if (color.a < ${w.float(yo)}) {
        discard;
      }

      ${t.output===U.Alpha?w`fragColor = vec4(color.a);`:""}

      ${t.output===U.Color?w`fragColor = color; ${t.transparencyPassType===ut.Color?"fragColor = premultiplyAlpha(fragColor);":""}`:""}
      ${t.output===U.Highlight?w`outputHighlight();`:""}
      ${t.output===U.Depth?w`outputDepth(linearDepth);`:""};
    }
  `),e}function smt(t){function e(r){return t.draped?w`coverage(vuv.${r}, texelSize)`:w`sampleAA(vuv.${r})`}switch(t.style){case go.ForwardDiagonal:case go.Horizontal:return e("y");case go.BackwardDiagonal:case go.Vertical:return e("x");case go.DiagonalCross:case go.Cross:return w`
        1.0 - (1.0 - ${e("x")}) * (1.0 - ${e("y")})
      `;default:return"0.0"}}const nmt=Object.freeze(Object.defineProperty({__proto__:null,build:imt},Symbol.toStringTag,{value:"Module"}));let K3e=class eOe extends Lr{initializeProgram(e){return new Rr(e.rctx,eOe.shader.get().build(this.configuration),tOe)}_setPipelineState(e,r){const i=this.configuration,s=e===ut.NONE,n=e===ut.FrontFace;return Mt({blending:i.output===U.Color||i.output===U.Alpha?s?xu:Dy(e):null,culling:tU(i.cullFace),depthTest:{func:Ov(e)},depthWrite:s?i.writeDepth?Ul:null:AU(e),colorWrite:Gt,stencilWrite:i.hasOccludees?mm:null,stencilTest:i.hasOccludees?r?mv:Rv:null,polygonOffset:s||n?i.polygonOffset?omt:null:MU(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};K3e.shader=new Or(nmt,()=>ce(()=>import("./Pattern.glsl-83b89903.js"),[],import.meta.url));const omt={factor:1,units:1};let Vn=class extends Vo{constructor(){super(...arguments),this.output=U.Color,this.cullFace=mi.None,this.transparencyPassType=ut.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.writeDepth=!0,this.hasOccludees=!1,this.enableOffset=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.vvColor=!1}};u([B({count:U.COUNT})],Vn.prototype,"output",void 0),u([B({count:mi.COUNT})],Vn.prototype,"cullFace",void 0),u([B({count:go.COUNT})],Vn.prototype,"style",void 0),u([B({count:ut.COUNT})],Vn.prototype,"transparencyPassType",void 0),u([B()],Vn.prototype,"hasSlicePlane",void 0),u([B()],Vn.prototype,"hasVertexColors",void 0),u([B()],Vn.prototype,"polygonOffset",void 0),u([B()],Vn.prototype,"writeDepth",void 0),u([B()],Vn.prototype,"hasOccludees",void 0),u([B()],Vn.prototype,"patternSpacing",void 0),u([B()],Vn.prototype,"lineWidth",void 0),u([B()],Vn.prototype,"enableOffset",void 0),u([B()],Vn.prototype,"draped",void 0),u([B()],Vn.prototype,"hasMultipassTerrain",void 0),u([B()],Vn.prototype,"cullAboveGround",void 0),u([B()],Vn.prototype,"vvColor",void 0),u([B({constValue:!1})],Vn.prototype,"hasVvInstancing",void 0),u([B({constValue:!1})],Vn.prototype,"vvSize",void 0),u([B({constValue:!1})],Vn.prototype,"vvOpacity",void 0);const tOe=new Map([[C.POSITION,0],[C.COLOR,3],[C.UVMAPSPACE,4],[C.COLORFEATUREATTRIBUTE,5],[C.BOUNDINGRECT,6]]);let nK=class extends UQ{constructor(e){super(e,new cmt),this.supportsEdges=!0,this._vertexAttributeLocations=tOe,this._configuration=new Vn}getConfiguration(e,r){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.style=this.parameters.style,this._configuration.patternSpacing=this.parameters.patternSpacing,this._configuration.lineWidth=this.parameters.lineWidth,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<OU,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}requiresSlot(e,r){return r===U.Color||r===U.Alpha||r===U.Highlight||r===U.Depth&&this.parameters.writeLinearDepth?e===he.DRAPED_MATERIAL?!0:r===U.Highlight?e===he.OPAQUE_MATERIAL:e===(this.parameters.writeDepth?he.TRANSPARENT_MATERIAL:he.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):!1}createGLMaterial(e){return new amt(e)}createBufferWriter(){const e=Hi().vec3f(C.POSITION).vec4f(C.UVMAPSPACE);return this.parameters.draped||e.mat3f(C.BOUNDINGRECT),this.parameters.vvColor?e.f32(C.COLORFEATUREATTRIBUTE):e.vec4u8(C.COLOR),new lmt(e)}},amt=class extends Ev{_updateParameters(e){return this.ensureTechnique(K3e,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==U.Color&&this._output!==U.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},lmt=class extends yC{write(e,r,i,s,n){for(const o of this.vertexBufferLayout.fields.keys()){const a=i.vertexAttributes.get(o),l=i.indices.get(o);if(a&&l)switch(o){case C.UVMAPSPACE:{nt(a.size===4);const c=s.getField(o,Ep);c&&xE(l,a.data,c,n);break}case C.BOUNDINGRECT:{nt(a.size===9);const c=s.getField(o,lv);c&&this.writeBoundingRect(l,a.data,e,c,n);break}default:tEe(o,a,l,e,r,s,n)}}}writeBoundingRect(e,r,i,s,n){const o=i,a=s.typedBuffer,l=s.typedBufferStride,c=e.length;n*=l;for(let h=0;h<c;++h){const p=9*e[h],f=r[p],m=r[p+1],y=r[p+2];a[n]=o[0]*f+o[4]*m+o[8]*y+o[12],a[n+1]=o[1]*f+o[5]*m+o[9]*y+o[13],a[n+2]=o[2]*f+o[6]*m+o[10]*y+o[14];for(let _=3;_<9;++_)a[n+_]=r[p+_];n+=l}}},cmt=class extends nP{constructor(){super(...arguments),this.color=Nt(1,1,1,1),this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=mi.None,this.hasOccludees=!1,this.style=go.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}};function umt(t,e){const r=t?.pattern??null;return r==null?new pce(e):r.style==="none"||r.style==="solid"?(r.style==="none"&&(e.color=Nt(0,0,0,0),e.transparent=!0),new pce(e)):(e.style=hmt(r.style),new nK(e))}function hmt(t){switch(t){case"horizontal":return go.Horizontal;case"vertical":return go.Vertical;case"cross":return go.Cross;case"forward-diagonal":return go.ForwardDiagonal;case"backward-diagonal":return go.BackwardDiagonal;case"diagonal-cross":return go.DiagonalCross;default:return}}function dmt(t){return t.material instanceof nK&&!t.material.parameters.draped}function pmt(t,e){if(dmt(t)){const r=t.vertexAttributes.get(C.POSITION).data,i=t.getMutableAttribute(C.UVMAPSPACE).data,s=t.getMutableAttribute(C.BOUNDINGRECT).data;Y3e(i,s,r,e)}}function fmt(t,e,r,i,s){const n=eCe(t,e,r,i,s),o=t.stageObject.geometries;for(const a of o)pmt(a,s);return n}const mmt=["polyline","polygon","extent"],mce=new sP({size:!1,color:!0,rotation:!1,opacity:!1});let rOe=class iOe extends Am{constructor(e,r,i,s){super(e,r,i,s),this._needsUV=!1,this._hasOutline=!1}async doLoad(){this._fastUpdates=TE(this._context.renderer,mce)}_ensureMaterials(){this._ensureFillMaterial(),this._ensureOutlineMaterial()}_ensureFillMaterial(){if(this._material!=null)return;const e=this.symbolLayer?.material?.color,r=this._getCombinedOpacityAndColor(e);this._material=umt(this.symbolLayer,{color:r,transparent:r[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,draped:this.draped,hasSlicePlane:this._context.slicePlaneEnabled,...this._fastUpdates?.materialParameters}),this._needsUV=this._material instanceof nK,this._context.stage.add(this._material)}_ensureOutlineMaterial(){const e=this.symbolLayer.outline;if(this._outlineMaterial||!this._isValidOutline(e))return;this._hasOutline=!0;const r=i=>{const s=a3e(e.pattern);return new ZS({width:i,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:s,stippleScaleWithLineWidth:!0,cap:qq(e.patternCap||"butt")})};this._outlineMaterial=r(_o(e.size)),this._context.stage.add(this._outlineMaterial)}_isValidOutline(e){return e!=null&&e.size!=null&&e.size>0&&e.color!=null&&(e.pattern==null||e.pattern.type!=="style"||e.pattern.style!=="none")}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null,this._context.stage.remove(this._outlineMaterial),this._outlineMaterial=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,mmt,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(e.renderingInfo,255),s=this.setGraphicElevationContext(r,new Pp);return this.ensureDrapedStatus(s.mode==="on-the-ground"),this._ensureMaterials(),this.draped?this._createAsOverlay(r,i):this._createAs3DShape(r,i,s)}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables"||!SE(this._fastUpdates,r,mce))return Ns.RecreateSymbol;this._material&&this._material.setParameters(this._fastUpdates.materialParameters)}return Ns.FastUpdate}layerOpacityChanged(){if(this._material!=null){const e=this._material.parameters.color,r=this.symbolLayer?.material?.color,i=this._getCombinedOpacity(r);this._material.setParameters({color:[e[0],e[1],e[2],i],transparent:i<1||this.needsDrivenTransparentPass})}if(this._outlineMaterial!=null){const e=this._outlineMaterial.parameters.color;this._outlineMaterial.setParameters({color:[e[0],e[1],e[2],this._getOutlineOpacity()]})}}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=oP(iOe.elevationModeChangeTypes,i,s);if(n!==cs.UPDATE)return n;const o=Wh(s);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){if(this._material&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._outlineMaterial){const e={hasSlicePlane:this._context.slicePlaneEnabled};this._outlineMaterial.setParameters(e)}return!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,r,i){const s=eM(e.geometry);if(!s)return null;const n=WQ(s,this._context.elevationProvider,this._context.renderCoordsHelper,i),o=new gmt(n,r,this._context.layer.uid,e.uid),a=o.renderData.position.length/3;if(this._needsUV&&(o.uvMapSpace=Ki(4*a,!0),o.boundingRect=Ho(9*a,!0),Y3e(o.uvMapSpace,o.boundingRect,o.renderData.position,this._context.renderCoordsHelper)),o.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(o),this._createAs3DShapeFill(e,o),this._hasOutline&&this._createAs3DShapeOutline(o),this._logGeometryCreationWarnings(o.renderData,s.rings,"rings","FillSymbol3DLayer"),o.outGeometries.length===0)return null;const l=new Ny({geometries:o.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:e.uid}),c=new Cm(this,l,o.outGeometries,null,null,fmt,i);return c.alignedSampledElevation=o.renderData.sampledElevation,c.needsElevationUpdates=Wh(i.mode),c}_createAs3DShapeFill(e,r){const i=r.renderData.polygons;for(const{position:s,mapPositions:n,holeIndices:o,index:a,count:l}of i){if(this._context.clippingExtent!=null&&(Si(ud),gu(ud,n),!np(ud,this._context.clippingExtent)))continue;const c=AE(n,o,3);if(c.length===0)continue;const h=this._fastUpdates?.visualVariables.color,p=Pae({material:this._material,indices:c,mapPositions:n,attributeData:{position:s,color:h?null:r.color,colorFeature:h?gp(h.field,e):null,uvMapSpace:this._needsUV?lF(r.uvMapSpace,4*a,4*l):null,boundingRect:this._needsUV?$h(r.boundingRect,9*a,9*l):null,objectAndLayerIdColor:r.objectAndLayerIdColor}});r.outGeometries.push(p)}}_createAs3DShapeOutline(e){if(!this._hasOutline)return;const r=e.renderData.outlines;for(let i=0;i<r.length;++i){const{mapPositions:s,position:n}=r[i];if(this._context.clippingExtent!=null&&(Si(ud),gu(ud,s),!np(ud,this._context.clippingExtent)))continue;const o=Wq(this._outlineMaterial,{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:s,attributeData:{position:n}},e.objectAndLayerIdColor);e.outGeometries.push(o)}}_createAsOverlay(e,r){const i=eM(e.geometry);if(i==null)return null;this._material.renderPriority=this._renderPriority+this._renderPriorityStep/2,this._outlineMaterial!=null&&(this._outlineMaterial.renderPriority=this._renderPriority);const s=PAe(i,this._context.overlaySR),n=new ymt(s,r,this._context.layer.uid,e.uid),o=n.renderData.position.length/3;return this._needsUV&&(n.uvMapSpace=Ki(4*o,!0),Wft(n.uvMapSpace,n.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode)),n.outBoundingBox=Si(),n.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(n),this._createAsOverlayFill(e,n),this._hasOutline&&this._createAsOverlayOutline(n),this._logGeometryCreationWarnings(n.renderData,i.rings,"rings","FillSymbol3DLayer"),n.outGeometries.length===0?null:new BU(this,n.outGeometries,n.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayFill(e,r){const i=r.renderData.polygons;for(const{position:s,holeIndices:n,index:o,count:a}of i){const l=Si(ud);if(gu(l,s),!np(l,this._context.clippingExtent))continue;const c=AE(s,n,3);if(c.length===0)continue;Z2(r.outBoundingBox,l);const h=this._fastUpdates?.visualVariables.color,p=Pae({material:this._material,indices:c,attributeData:{position:s,color:h?null:r.color,colorFeature:h?gp(h.field,e):null,uvMapSpace:this._needsUV?lF(r.uvMapSpace,4*o,4*a):null,objectAndLayerIdColor:r.objectAndLayerIdColor}});r.outGeometries.push(new ME(p,r))}}_createAsOverlayOutline(e){if(!this._hasOutline)return;const r=e.renderData.outlines;for(let i=0;i<r.length;++i){const{position:s}=r[i];if(Si(ud),gu(ud,s),!np(ud,this._context.clippingExtent))continue;Z2(e.outBoundingBox,ud);const n=Wq(this._outlineMaterial,{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:s}},e.objectAndLayerIdColor);e.outGeometries.push(new ME(n,e))}}_getOutlineOpacity(){const e=this.symbolLayer?.outline?.color;return(this.draped?1:this._getLayerOpacity())*(e!=null?e.a:0)}_getOutlineColor(){const e=this.symbolLayer?.outline?.color,r=this._getOutlineOpacity();return XO(e!=null?Ne.toUnitRGB(e):null,r)}test(){return{...super.test(),createAsOverlay:(e,r)=>this._createAsOverlay(e,r),createAs3DShape:(e,r,i)=>this._createAs3DShape(e,r,i)}}};rOe.elevationModeChangeTypes={definedChanged:cs.RECREATE,staysOnTheGround:cs.NONE,onTheGroundChanged:cs.RECREATE};const ud=pn();let gmt=class extends FU{constructor(e,r,i,s){super(e,i,s),this.color=r}},ymt=class extends FU{constructor(e,r,i,s){super(e,i,s),this.color=r}};const _mt="arial-unicode-ms",gce="woff2",yce=new Map,sOe=new Set;let vmt=class{constructor(e,r){this.fontFace=e,this.promise=r}};async function bmt(t){const e=Tmt(t),r=yce.get(e);if(r)return r.promise;const i=new FontFace(t.family,`url('${Br.fontsUrl}/woff2/${e}.${gce}') format('${gce}')`,{style:t.style,weight:t.weight}),s=document.fonts;if(s.has(i)&&i.status==="loading")return i.loaded;const n=i.load().then(()=>(s.add(i),i));return yce.set(e,new vmt(i,n)),sOe.add(i),n}function wmt(t){return sOe.has(t)}function xmt(t){if(!t)return _mt;const e=t.toLowerCase().split(" ").join("-");switch(e){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return e}}function Tmt(t){const e=Smt(t)+Emt(t);return xmt(t.family)+(e.length>0?e:"-regular")}function Smt(t){if(!t.weight)return"";switch(t.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function Emt(t){if(!t.style)return"";switch(t.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}let nOe=class oOe{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.textStyle=this._colorToRGBA(e.color),this.haloStyle=this._colorToRGB(e.halo.color),this.backgroundStyle=e.background.color[3]!==0?this._colorToRGBA(e.background.color):null}fontString(e){const r=this.definition.font;return`${r.style} ${r.weight} ${e}px ${r.family}, sans-serif`}_colorToRGB(e){return`rgb(${e.slice(0,3).map(r=>Math.floor(255*r)).toString()})`}_colorToRGBA(e){return`rgba(${e.slice(0,3).map(r=>Math.floor(255*r)).toString()},${e[3]})`}static async fromSymbol(e,r){const i=e?.material?.color,s=Ne.toUnitRGBA(i)??Wf,n=e.size!=null?_o(e.size):12,o=e.lineHeight,a=e.background!=null?Ne.toUnitRGBA(e.background.color):Wf,l={family:e.font?.family??"sans-serif",decoration:e.font?.decoration??"none",weight:e.font?.weight??"normal",style:e.font?.style??"normal"},c=e.halo,h=c!=null&&c.color!=null&&c.size>0?{size:_o(c.size),color:Ne.toUnitRGBA(c.color)}:{size:0,color:Wf},p=new oOe({color:s,size:n,background:{color:a,padding:e.background!=null?[.65*n,.5*n]:[0,0],borderRadius:e.background!=null?n*(6/16):0},lineSpacingFactor:o,font:l,halo:h,pixelRatio:r});if(e.font){let f=!1;const m=p.fontString(n);try{f=(await document.fonts.load(m)).some(y=>!wmt(y))}catch{Q.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${m}'. Some text symbology may be rendered using the default browser font.`)}if(!f&&!Cmt.has(e.font.family))try{await bmt(e.font)}catch{}}return p}};const Cmt=new Set(["Arial","Times New Roman","Courier New","serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]);let Amt=class{constructor(e,r,i){this._renderer=new KAe(e,r,i)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const e=jq(Omt,this._renderer.renderedWidth,this._renderer.renderedHeight),r=e.getContext("2d");return r.save(),this._renderer.render(r,0,0),r.restore(),new _x(e,{wrap:{s:Dt.CLAMP_TO_EDGE,t:Dt.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0})}};const Omt={canvas:null},Rmt=[0,0,1];let Mmt=class extends Am{constructor(e,r,i,s){super(e,r,i,s),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=PU(this.symbolLayer.size);if(e)throw new V("graphics3dtextsymbollayer:invalid-size",e)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const e=this._context.graphicsCoreOwner.view.state.rasterPixelRatio;this._textRenderParameters=await nOe.fromSymbol(this.symbolLayer,e)}destroy(){super.destroy()}createGraphics3DGraphic(e){const r=e.graphic,i=KR(r.geometry);if(i==null)return this.logger.warn(`unsupported geometry type for text symbol: ${r.geometry.type}`),null;const s=this.symbolLayer.text;if(s==null||s==="")return null;const n=UZ(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(n!=null&&!J0e(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const o=new JEe(n,this.symbolLayer.horizontalAlignment,pht(this.symbolLayer.verticalAlignment));return this._createAs3DShape(r,i,s,o)}createLabel(e,r,i,s){const n=e.graphic,o=KR(n.geometry);if(o==null)return this.logger.warn(`unsupported geometry type for label: ${n.geometry.type}`),null;const a=r.text;return!a||/^\s+$/.test(a)?null:this._createAs3DShape(n,o,a,r,i,s)}setGraphicElevationContext(e,r,i=0){const s=super.setGraphicElevationContext(e,r);return s.addOffsetRenderUnits(i),s}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(e,r){return _ce(e,r,(i,s)=>{this.updateGraphicElevationContext(s,i)}),cs.UPDATE}slicePlaneEnabledChanged(e,r){return _ce(e,r,i=>{for(const s of i.stageObject.geometries)s.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return!1}updateGraphicElevationContext(e,r){const i=r.elevationContext;this.setGraphicElevationContext(e,i,r.metadata!=null?r.metadata.elevationOffset:0),r.needsElevationUpdates=Wh(i.mode)||i.mode==="absolute-height"}_defaultElevationInfoNoZ(){return Imt}_createAs3DShape(e,r,i,s,n,o){const a=this.setGraphicElevationContext(e,new Pp,s.elevationOffset),l=e.geometry?.type==="polyline",c=e.uid;let h=null,p=null;if(o==null){const M=t3e(s.horizontalPlacement);h=new Amt(i,M,this._textRenderParameters);let D=null;if(this._context.sharedResources.textures!=null){p=this._context.sharedResources.textures.fromData(h.key,()=>h.create(),()=>{D?.release()});const k=this._context.stage.renderView.textureRepository.acquire(p.texture.id);if(k==null||Iu(k))return p.release(),null;D=k}}const f=Pmt(h,s),m={occlusionTest:!0,screenOffset:s.screenOffset,anchorPosition:f,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:s.centerOffsetUnits,drawInSecondSlot:!0};if(o!=null?m.textureId=o.id:p!=null&&(m.textureId=p.texture.id),s.verticalOffset!=null){const{screenLength:M,minWorldLength:D,maxWorldLength:k}=s.verticalOffset;m.verticalOffset={screenLength:_o(M),minWorldLength:D||0,maxWorldLength:k??1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:M,screenSizePerspectiveSettingsLabels:D}=this._context.sharedResources;m.screenSizePerspective=D.overridePadding(this._textRenderParameters.haloSize+this._textRenderParameters.definition.background.padding[0]),m.screenSizePerspectiveAlignment=M}let y;if(l&&(m.shaderPolygonOffset=1e-4),m.hasSlicePlane=this._context.slicePlaneEnabled,n!=null){const M=JSON.stringify(m);y=n.get(M),y==null&&(y=new EE(m),n.add(M,y))}else y=new EE(m);const _=s.translation,v=h?fr(h.displayWidth,h.displayHeight):Tp,b=s.centerOffset,T=tq(y,Rmt,_,null,v,b,[0,0],null),x=EQ(this._context,r,T,a,c);if(x==null)return null;const S=new Cm(this,x.object,[T],n==null?[y]:null,p,aw,a);S.alignedSampledElevation=x.sampledElevation,S.needsElevationUpdates=Wh(a.mode)||a.mode==="absolute-height";const{displayWidth:E,displayHeight:A}=h??s;S.getScreenSize=(M=Ge())=>(M[0]=E,M[1]=A,M);const R=new aCe(s.elevationOffset,i);return S.metadata=R,QR(S,r,this._context.elevationProvider),S}};function _ce(t,e,r){t&&t.forEach(i=>{const s=e(i);s!=null&&r(s,i.graphic)})}function Pmt(t,e){if(e.verticalPlacement==="baseline"){const i=uht[e.horizontalPlacement],s=t!=null?t.baselineAnchorY:0;return fr(i,s)}const r=dht(e.horizontalPlacement,e.verticalPlacement);return yN[r]}const Imt={mode:"relative-to-ground",offset:0},$mt={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},Lmt=["polyline","polygon","extent"];let Qq=class hb extends Am{constructor(e,r,i,s){super(e,r,i,s)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,Lmt,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new Pp);return this.ensureDrapedStatus(i.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(r):this._createAs3DShape(r,i,r.uid)}ensureMaterial(){if(this._material!=null)return;const e=new wAe,r=this.symbolLayer.color;r!=null&&(e.color=Ne.toUnitRGBA(r));const i=this._getCombinedOpacity(r,{hasIntrinsicColor:!0});e.color=[e.color[0],e.color[1],e.color[2],i],e.transparent=i<1||this.needsDrivenTransparentPass,e.waveDirection=this.symbolLayer.waveDirection!=null?hb.headingVectorFromAngle(this.symbolLayer.waveDirection):fr(0,0);const s=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,n=$mt[s];e.waveStrength=n.waveStrength,e.waveTextureRepeat=n.textureRepeat,e.waveVelocity=n.waveVelocity,e.flowStrength=n.perturbationStrength,e.hasSlicePlane=this._context.slicePlaneEnabled,e.isDraped=this.draped,this._material=new bAe(e),this._context.stage.add(this._material)}layerOpacityChanged(){if(this._material==null)return;const e=this._material.parameters.color,r=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),i=r<1||this.needsDrivenTransparentPass;this._material.setParameters({color:[e[0],e[1],e[2],r],transparent:i})}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=oP(hb.elevationModeChangeTypes,i,s);if(n!==cs.UPDATE)return n;const o=Wh(s);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){return this._material!=null&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,r,i){const s=eM(e.geometry);if(s==null)return null;const n=WQ(s,this._context.elevationProvider,this._context.renderCoordsHelper,r),o=n.position.length/3,a=Ho(2*o);this._createUVCoordsFromVertices(a,n.mapPositions,o,this._context.elevationProvider.spatialReference);const l=new Dmt(n,a,this._context.layer.uid,e.uid);if(l.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(l),this._create3DShapeGeometries(l),this._logGeometryCreationWarnings(l.renderData,s.rings,"rings","WaterSymbol3DLayer"),l.outGeometries.length===0)return null;const c=new Ny({geometries:l.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:i}),h=new Cm(this,c,l.outGeometries,null,null,eCe,r);return h.alignedSampledElevation=l.renderData.sampledElevation,h.needsElevationUpdates=Wh(r.mode),h}_createUVCoordsFromVertices(e,r,i,s){const n=_a(s);Ic(m0);for(let l=0;l<i;l++)ar(vce,r[3*l],r[3*l+1]),c2(m0,vce);Tw(m0,m0,n);const o=m0[0]%hb.unitSizeOfTexture,a=m0[1]%hb.unitSizeOfTexture;J$[0]=m0[0]-o,J$[1]=m0[1]-a;for(let l=0;l<i;l++)e[2*l]=(r[3*l]*n-J$[0])/hb.unitSizeOfTexture,e[2*l+1]=(r[3*l+1]*n-J$[1])/hb.unitSizeOfTexture}_create3DShapeGeometries(e){const r=e.renderData.polygons,i=e.uvCoords;for(const{count:s,index:n,position:o,mapPositions:a,holeIndices:l}of r){if(this._context.clippingExtent!=null&&(Si(d1),gu(d1,a),!np(d1,this._context.clippingExtent)))continue;const c=AE(a,l,3);if(c.length===0)continue;const h=$h(i,2*n,2*s),p=Iae({material:this._material,indices:c,mapPositions:a,attributeData:{position:o,uv0:h}},e.objectAndLayerIdColor);e.outGeometries.push(p)}}_createAsOverlay(e){const r=eM(e.geometry);if(r==null)return null;this._material.renderPriority=this._renderPriority;const i=PAe(r,this._context.overlaySR),s=i.position.length/3,n=Ho(2*s);this._createUVCoordsFromVertices(n,i.position,s,this._context.overlaySR);const o=new Nmt(i,n,this._context.layer.uid,e.uid);return o.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(o),o.outBoundingBox=Si(),this._createAsOverlayWater(o),this._logGeometryCreationWarnings(o.renderData,r.rings,"rings","WaterSymbol3DLayer"),o.outGeometries.length===0?null:new BU(this,o.outGeometries,o.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayWater(e){const r=e.uvCoords,i=e.renderData.polygons;for(const{position:s,holeIndices:n,index:o,count:a}of i){if(Si(d1),gu(d1,s),!np(d1,this._context.clippingExtent))continue;Z2(e.outBoundingBox,d1);const l=AE(s,n,3);if(l.length===0)continue;const c=$h(r,2*o,2*a),h=Iae({material:this._material,indices:l,attributeData:{position:s,uv0:c}},e.objectAndLayerIdColor);e.outGeometries.push(new ME(h,e))}}static headingVectorFromAngle(e){const r=Ge(),i=q5(e);return r[0]=Math.sin(i),r[1]=Math.cos(i),r}test(){return{...super.test(),create3DShape:e=>this._createAs3DShape(e.graphic,e.elevationContext,e.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}};Qq.unitSizeOfTexture=100,Qq.elevationModeChangeTypes={definedChanged:cs.RECREATE,staysOnTheGround:cs.NONE,onTheGroundChanged:cs.RECREATE};const J$=Ge(),m0=Vt(),vce=Ge(),d1=pn();let Dmt=class extends FU{constructor(e,r,i,s){super(e,i,s),this.uvCoords=r}},Nmt=class extends FU{constructor(e,r,i,s){super(e,i,s),this.uvCoords=r}};function Fmt(t,e,r,i){const s=kmt[t.type]?.[e.type]||Umt[e.type];return s?new s(t,e,r,i):(Q.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",`unknown symbol type ${e.type}`),null)}const Umt={icon:Hq,object:Bpt,line:l3e,path:jft,fill:rOe,extrude:Sut,text:Mmt,water:Qq},kmt={"mesh-3d":{fill:bdt}};let zmt=class extends xQ{set symbol(e){this._symbol=e,e.symbolLayers.forEach((r,i)=>{const s=this.symbolLayers[i];s!=null&&(s.symbol=e,s.symbolLayer=r)})}get symbol(){return this._symbol}constructor(e,r,i){super(r.schedule),this._symbol=e,this._context=r,this._backgroundLayers=i,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let r=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(r=this._backgroundLayers.concat(r));const i=r.length;for(;this.symbolLayers.length<r.length;)this.symbolLayers.push(null);this.symbolLayers.length=r.length;const s=[];for(let n=0;n<i;n++){const o=r.at(n);if(o.enabled===!1)continue;Q$.renderPriority=1-(1+n)/i,Q$.renderPriorityStep=1/i,Q$.ignoreDrivers=o.ignoreDrivers;const a=Fmt(this.symbol,o,this._context,Q$),l=lX(e,()=>{this.symbolLayers[n]=null,a.destroy()});l&&s.push(l),this.symbolLayers[n]=a}if(await G5(this.symbolLayers,async(n,o)=>{if(n!=null)try{await n.load(),this._extentPadding+=Math.max(this._extentPadding,n.extentPadding)}catch{this.symbolLayers[o]=null}}),s.forEach(n=>n.remove()),Yt(e),this.symbolLayers.length&&!this.symbolLayers.some(n=>!!n))throw new Error}getSymbolLayerSize(e){const r=this.symbolLayers[e];return r!=null?r.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(e=>e!=null&&e.queryForSnapping)}createGraphics3DGraphic(e,r){const i=e.graphic,s=this.symbolLayers.map(o=>o?.createGraphics3DGraphic(e)??null),n=this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null;return new Hat(i,r||this,s,e.layer,n)}get complexity(){return SQ(this.symbolLayers.map(e=>e!=null?e.complexity:null))}globalPropertyChanged(e,r){const i=this.symbolLayers.length;for(let s=0;s<i;s++){const n=this.symbolLayers[s],o=a=>{const l=a.layers[s];return l instanceof Cm?l:null};if(n!=null&&!n.globalPropertyChanged(e,r,o))return!1}return!0}applyRendererDiff(e,r){return this.loadStatus!==lu.LOADED?Ns.RecreateSymbol:this.symbolLayers.reduce((i,s)=>i!==Ns.RecreateSymbol&&s!=null?Math.min(i,s.applyRendererDiff(e,r)):i,Ns.FastUpdate)}prepareSymbolPatch(e){if(this.loadStatus===lu.FAILED||e.diff.type!=="partial")return;const r=e.diff.diff;if(!r.symbolLayers||r.symbolLayers.type!=="partial")return;const i=r.symbolLayers.diff;this.symbolLayers.forEach((s,n)=>{if(s==null)return;const o=i[n];if(o){const a={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};s.prepareSymbolLayerPatch(a),e.symbolStatePatches.push(...a.symbolLayerStatePatches),a.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((l,c)=>{const h=l.layers[n];h!=null&&a.graphics3DGraphicPatches.forEach(p=>p(h,c))})}})}updateGeometry(e,r){return this._updateGeometryOrTransform(e,(i,s)=>i.updateGeometry(s,r))}updateTransform(e,r,i,s){return this._updateGeometryOrTransform(e,(n,o)=>n.updateTransform(o,r,i,s))}_updateGeometryOrTransform(e,r){for(let i=0;i<this.symbolLayers.length;i++){const s=this.symbolLayers[i];if(s==null)continue;const n=e.layers[i];if(!n||!r(s,n))return!1}return!0}onRemoveGraphic(e){for(let r=0;r<this.symbolLayers.length;r++){const i=this.symbolLayers[r];if(i==null)continue;const s=e.layers[r];s!=null&&i.onRemoveGraphic(s)}}getFastUpdateStatus(){let e=0,r=0,i=0;return this.symbolLayers.forEach(s=>{s!=null&&(s.loadStatus===lu.LOADING?e++:s.isFastUpdatesEnabled()?i++:r++)}),{loading:e,slow:r,fast:i}}async queryForSnapping(e,r,i,s){const n=this.symbolLayers.filter(jf).filter(a=>a.queryForSnapping!=null).map(a=>a.queryForSnapping(e,r,i,s)),o=await Promise.all(n);return Yt(s),o.flat()}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const e of this.symbolLayers)e?.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}};const Q$=new qat;let Vmt=class extends xQ{constructor(e,r,i){super(r),this.symbol=e,this._convert=i,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const r=await this.symbol.fetchSymbol({signal:e});r.id=this.symbol.id,this.graphics3DSymbol=this._convert(r),this.graphics3DSymbol!=null&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.complexity:TQ}globalPropertyChanged(e,r){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.globalPropertyChanged(e,r)}applyRendererDiff(e,r){return this.graphics3DSymbol!=null?this.graphics3DSymbol.applyRendererDiff(e,r):Ns.RecreateSymbol}prepareSymbolPatch(e){this.graphics3DSymbol!=null&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,r){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.updateGeometry(e,r)}updateTransform(e,r,i,s){return this.graphics3DSymbol?.updateTransform(e,r,i,s)??!1}onRemoveGraphic(){}getFastUpdateStatus(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){this.graphics3DSymbol!=null&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}};function oK(t){return t instanceof Vmt?t.graphics3DSymbol:t instanceof zmt?t:null}const sM=Q.getLogger("esri.views.3d.layers.graphics.labelPlacement");function Bmt(t){const e=Jmt(t);if(e==null)return null;const r=Gmt(t,e);if(r==null)return null;const i=r.anchor,s=!!e.hasLabelVerticalOffset;return Hmt({anchor:i,verticalOffset:e.verticalOffset,screenOffset:Ge(),centerOffset:Nt(0,0,0,-1),centerOffsetUnits:"world",translation:O(),elevationOffset:0,hasLabelVerticalOffset:s},r,t)}function Gmt(t,e){if(e.anchor)return e;const r=t.labelClass.labelPlacement,i=cp[r],s=i||jF(t);return r&&!i&&sM.warnOncePerTick(`the requested label placement '${r}' is currently unsupported in SceneView.`),jmt(s,t)}function aK(t){const e=t.graphics3DGraphic.graphics3DSymbol,r=oK(e);return r!=null?r.symbol.symbolLayers.at(0):null}function jmt(t,e){const r=e.graphics3DGraphic.graphic.geometry;if(r==null)return null;if(e.disablePlacement!=null)return e.labelClass.labelPlacement?(sM.warnOncePerTick(bce(t?.placement,e.disablePlacement.logEntityDescription)),jF(e)):t;const i=r.type;switch(i){case"polyline":case"polygon":case"extent":case"multipoint":if(e.labelClass.labelPlacement)return sM.warnOncePerTick(bce(t?.placement,`'${i}' geometries`)),jF(e);break;case"point":case"mesh":return t}return t}function bce(t,e){return`the requested label placement '${t}' is currently unsupported for ${e} in SceneView.`}function jF(t){const e=t.graphics3DGraphic.graphic.geometry;if(e==null)return null;switch(e.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case"polygon":{const r=aK(t);return r!=null&&r.type==="extrude"?cp["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"}}case"point":case"mesh":return cp["above-center"];default:return}}function Hmt(t,e,r){const i=r.graphics3DGraphic.graphic.geometry;if(i==null)return null;switch(i.type){case"point":Wmt(t,e,r);break;case"polygon":qmt(t,e,r);break;case"mesh":lK(t,e,r.graphics3DGraphic.layers[0])}return t}function qmt(t,e,r){const i=aK(r);if(i!=null)switch(i.type){case"extrude":{const s=r.graphics3DGraphic.layers[0];s!=null?(s.getBoundingBoxObjectSpace(iR),sp(iR,t.translation),t.translation[2]=vv(iR)/2):se(t.translation,0,0,0),lK(t,e,s);break}}}function Wmt(t,e,r){const i=aK(r);if(i==null)return;const s=r.graphics3DGraphic.layers[0];switch(s!=null?s.getCenterObjectSpace(t.translation):se(t.translation,0,0,0),i.type){case"icon":case"text":Xmt(t,e,r,s);break;case"object":lK(t,e,s)}}function Xmt(t,e,r,i){const{graphics3DGraphic:s}=r,n=i!=null?i.getScreenSize():null;if(s.isDraped||n==null)t.hasLabelVerticalOffset||t.anchor==="center"||(cp[r.labelClass.labelPlacement]&&sM.warnOncePerTick(`the requested placement '${e.placement}' is currently unsupported for draped graphics`),t.anchor="center");else{const o=Zmt(r);t.screenOffset[0]=n[0]/2*(e.normalizedOffset[0]-o[0]);const a=n[1]/2*(e.normalizedOffset[1]-o[1]);t.hasLabelVerticalOffset?(t.centerOffset[1]=a,t.centerOffsetUnits="screen"):t.screenOffset[1]=a}}function Zmt(t,e=Qmt){const{graphics3DGraphic:r}=t,i=r.layers[0],s=i!=null?i.stageObject.geometries[0].material:null;if(s&&s instanceof EE){const n=s.parameters.anchorPosition;e[0]=2*(n[0]-.5),e[1]=2*(n[1]-.5)}else e[0]=0,e[1]=0;return e}function lK(t,e,r){const i=r!=null?r.getBoundingBoxObjectSpace(iR):iR,s=Me(i[3]-i[0],i[4]-i[1],i[5]-i[2]),n=Math.sqrt(s[0]*s[0]+s[1]*s[1]);t.centerOffset[0]=n/2*e.normalizedOffset[0];const o=t.translation[2],a=s[2]/2*e.normalizedOffset[1];t.translation[2]=0,t.elevationOffset=o+a;const l=Oe(s);t.centerOffset[2]=l/2*e.normalizedOffset[2]}function Ymt(t){return t==="above-center"}function Jmt(t){const e=t.labelClass.labelPlacement,{labelSymbol:r,graphics3DGraphic:i}=t,s=oK(i.graphics3DSymbol),n=vc(s,a=>a.symbol.type==="point-3d"?a.symbol:null),o=cp[e]||jF(t);return n!=null&&n.supportsCallout()&&n.hasVisibleVerticalOffset()&&!i.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:wce(n.verticalOffset),anchor:null,normalizedOffset:null}:!r||!r.hasVisibleVerticalOffset()||n!=null&&n.supportsCallout()&&n.verticalOffset&&!i.isDraped?{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}:o&&Ymt(o.placement)?{placement:"above-center",verticalOffset:wce(r.verticalOffset),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(sM.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+e+" placement)"),null)}function wce(t){const{screenLength:e,minWorldLength:r,maxWorldLength:i}=t;return{screenLength:e,minWorldLength:r,maxWorldLength:i}}const cp={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},xce={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const t in xce){const e=xce[t],r=cp[t];e.forEach(i=>{cp[i]=r})}Object.freeze&&(Object.freeze(cp),Object.keys(cp).forEach(t=>{Object.freeze(cp[t]),Object.freeze(cp[t]?.normalizedOffset)}));const Qmt=[0,0],iR=pn();let Tce=class{constructor(e){this._stage=e,this._materials=new Map}get(e){return this._materials.get(e)}add(e,r){this._materials.set(e,r),this._stage.add(r)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}};const K$=4096;let Kmt=class{constructor(){this.offset={x:0,y:0},this.uvMinMax=Xt()}},egt=class{constructor(e,r){this.textId=e,this.textRenderer=r,this.placement=new Kmt,this.rendered=!1}},tgt=class{constructor(e,r,i){this.size=e,this.cursor=r,this.lineHeight=i}resize(e){this.size.height=e}resetCursor(){this.cursor.x=sR,this.cursor.y=sR+aOe,this.lineHeight=0}getUsage(){return(this.cursor.x+this.cursor.y*this.size.width)/(this.size.width*this.size.height)}},Z3=class extends we{constructor(e){super(e),this.type=ls.Texture,this.id=Cc(),this.events=new ws,this._glTexture=null,this._needsClear=!1,this._elementsToAddOrUpdate=new Map,this._elementsToRemove=new Map,this._elementsToRender=new Map,this._elements=new Map,this._stageObjects=new Map,this.updating=!1}initialize(){this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","textAtlasCanvas"),this._canvas.setAttribute("style","display:none"),this._ctx=this._canvas.getContext("2d"),this._stage=this.view._stage,this._stage.add(this),this._atlas=new tgt({width:K$,height:256},{x:0,y:0},0),this._updateCanvasElementSize(this._atlas),this._resetAtlasCursor()}unload(){this._glTexture=Ve(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get requiresFrameUpdates(){return!1}_createDescriptor(e){const r=new xr;return r.wrapMode=Dt.CLAMP_TO_EDGE,r.flipped=!0,r.samplingMode=Rt.LINEAR_MIPMAP_LINEAR,r.hasMipmap=!0,r.preMultiplyAlpha=!0,r.maxAnisotropy=e.parameters.maxMaxAnisotropy,r}get glTexture(){return this._glTexture}load(e){return this._glTexture!=null||(this._glTexture=new Ot(e,this._createDescriptor(e),this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(vt.TEXT_TEXTURE_ATLAS,this),this.setDirty()),this._glTexture}dispose(){this._elements=null,this._elementsToAddOrUpdate=null,this._elementsToRemove=null,this._elementsToRender=null,this._frameWorker=Ni(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=Ve(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_updateCanvasElementSize(e){this._canvas.setAttribute("width",e.size.width.toString()),this._canvas.setAttribute("height",e.size.height.toString())}_resizeAtlas(e){this._atlas.resize(e),this._glTexture!=null&&this._glTexture.resize(this._atlas.size.width,e),this._updateCanvasElementSize(this._atlas)}_resetAtlasCursor(){this._atlas.resetCursor(),this._needsClear=!0}_addAtlasElement(e,r,i,s){const n=this._atlas,{renderedWidth:o,renderedHeight:a}=e.textRenderer;e.placement.offset.x=n.cursor.x,e.placement.offset.y=n.cursor.y,xi(e.placement.uvMinMax,e.placement.offset.x/n.size.width,1-(e.placement.offset.y+a)/n.size.height,(e.placement.offset.x+o)/n.size.width,1-e.placement.offset.y/n.size.height),n.cursor.x+=i,n.lineHeight=Math.max(n.lineHeight,s),this._elements.set(r,e)}_removeAtlasElement(e){if(e&&this._elements.has(e.textId)){const r=e.placement.offset;this._ctx.clearRect(r.x,r.y,e.textRenderer.renderedWidth,e.textRenderer.renderedHeight),this._elements.delete(e.textId)}}_ensureStageObjects(e){const r=this._stageObjects.get(e);if(r)return r;const i=new Set;return this._stageObjects.set(e,i),i}_addStageObject(e,r){this._ensureStageObjects(e).add(r)}_removeStageObject(e,r){const i=this._stageObjects.get(e);i&&i.delete(r)&&(r.geometries[0].setAttributeData(C.SIZE,[0,0]),r.geometryVertexAttrsUpdated(r.geometries[0]))}_processAddition(e,r){const i=this._atlas,s=e.textId,n=e.textRenderer.renderedWidth,o=e.textRenderer.renderedHeight,a=n+sR,l=o+sR+aOe;if(i.cursor.x+a<i.size.width&&i.cursor.y+l<i.size.height)this._addAtlasElement(e,s,a,l),this._elementsToRender.set(s,e),this._elementsToAddOrUpdate.delete(s);else{if(!(i.cursor.y+l+i.lineHeight<i.size.height)){const c=i.cursor.y+l+i.lineHeight-i.size.height,h=i.size.height+c<K$;if(h){const p=Math.ceil(i.size.height*Math.max(1.3,(c+i.size.height)/i.size.height));this._resizeAtlas(Math.min(NQ(p),K$))}return!r||!h&&i.size.height===K$?(this._processRemovals(),YS.OK):(this._repack(),YS.REPACK)}i.cursor.x=sR,i.cursor.y+=i.lineHeight,i.lineHeight=0,this._addAtlasElement(e,s,a,l),this._elementsToRender.set(s,e),this._elementsToAddOrUpdate.delete(s)}return YS.OK}_processRemovals(){this._elementsToRemove.forEach((e,r)=>{const i=this._stageObjects.get(r);i&&i.size!==0||this._removeAtlasElement(e),i&&i.size===0&&this._stageObjects.delete(r)}),this._elementsToRemove.clear()}_repack(){this._processRemovals(),this._elements.forEach((e,r)=>{e.rendered=!1,this._elementsToAddOrUpdate.set(r,e)}),this._elements.clear(),this._resetAtlasCursor(),this._elementsToRender.clear()}_processRenderingRequest(e){this._ctx.clearRect(e.placement.offset.x,e.placement.offset.y,e.textRenderer.renderedWidth,e.textRenderer.renderedHeight),e.textRenderer.render(this._ctx,e.placement.offset.x,e.placement.offset.y);const r=this._stageObjects.get(e.textId);r&&r.forEach(i=>{i.geometries[0].setAttributeData(C.UV0,e.placement.uvMinMax),i.geometries[0].setAttributeData(C.SIZE,[e.textRenderer.displayWidth,e.textRenderer.displayHeight]),i.geometryVertexAttrsUpdated(i.geometries[0])}),e.rendered=!0}get running(){return this.updating}runTask(e,r=!0){if(this._glTexture==null)return Wo.YIELD;let i=!1;if(ko(this._elementsToAddOrUpdate,(n,o)=>{if(this._elements.get(o)?.rendered){const l=this._stageObjects.get(o);return l&&l.forEach(c=>{const h=c.geometries[0],p=this._elements.get(o);h.setAttributeData(C.UV0,p.placement.uvMinMax),h.setAttributeData(C.SIZE,[p.textRenderer.displayWidth,p.textRenderer.displayHeight]),c.geometryVertexAttrsUpdated(c.geometries[0])}),this._elementsToAddOrUpdate.delete(o),e.madeProgress(),!1}return this._processAddition(this._elementsToAddOrUpdate.get(o),r)===YS.REPACK&&(i=!0,!0)}),i)return this.runTask(Ja,!1),void e.madeProgress();let s=!1;this._elementsToRender.size>0&&this._needsClear&&(this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._needsClear=!1),ko(this._elementsToRender,(n,o)=>(this._processRenderingRequest(n),this._elementsToRender.delete(o),s=!0,e.madeProgress(),e.done)),s&&this._glTexture.setData(this._canvas),this.updating=this._elementsToRender.size>0,!this.updating&&flt.orderedRepackingEnabled&&(this.repackOrdered(),e.madeProgress())}addTextTexture(e,r){const i=e.key;this._elementsToAddOrUpdate.has(i)||this._elementsToAddOrUpdate.set(i,new egt(i,e)),this._addStageObject(i,r),this._elementsToRemove.delete(i),this.setDirty()}removeTextTexture(e,r){const i=e.key;this._elementsToRemove.set(i,this._elements.get(i)),this._removeStageObject(i,r)}setDirty(){this._glTexture&&(this.updating=!0)}repackOrdered(){if(this._elements.size===0)return;const e=[];this._elements.forEach((i,s)=>e.push({element:i,key:s}));let r=!0;for(let i=0;i<e.length-1;i++)if(e[i].key.localeCompare(e[i+1].key)>0){r=!1;break}if(!r||this._elementsToRemove.size){e.sort((i,s)=>i.key.localeCompare(s.key)),this._elements.clear();for(const{element:i,key:s}of e)this._elements.set(s,i);this._repack(),this.setDirty()}}get test(){const{_elements:e,_stageObjects:r,_elementsToRemove:i,_atlas:s}=this,n=this;return{elements:e,stageObjects:r,elementsToRemove:i,atlas:s,resizeAtlas:o=>n._resizeAtlas(o),run:(o,a)=>n.runTask(o,a)}}};u([d({constructOnly:!0})],Z3.prototype,"view",void 0),u([d({type:Boolean})],Z3.prototype,"updating",void 0),Z3=u([P("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],Z3);const sR=2,aOe=2;var YS;(function(t){t[t.OK=0]="OK",t[t.REPACK=1]="REPACK"})(YS||(YS={}));let Sce=class{constructor(e,r){this.labelingContext=e,this.graphics3DGraphic=r,this.hasGraphics3DResources=!1,this.visible=!1,this.rendered=!1,this.textInitialized=!1,this.textRenderers=new Array,this.textLabelPlacements=new Array}},rgt=class{constructor(e,r,i,s,n){this.labelClass=e,this.graphics3DSymbol=r,this.graphics3DCalloutSymbolLayer=i,this.textRenderParameters=s,this.labelFunction=n,this.calloutSymbolLayerIndex=0}},igt=class{constructor(e,r,i,s,n,o,a,l){this.layer=r,this.graphics3DCore=i,this.scaleVisibility=s,this.emptySymbolLabelSupported=n,this.elevationInfoOverride=o,this.disablePlacement=a,this.active=l,this.labelClassAbortController=new AbortController,this.labelClassContexts=new Array,this.graphics=new Map,this.labelsToInitialize=new Map,this.stageLayer=new WCe(e,{pickable:!0,disableOctree:!0},r.uid)}destroy(){this.stageLayer.destroy()}},db=class extends we{constructor(e){super(e),this._dirty=!1,this._labels=new Map,this._labelsToAdd=new Map,this._labelsToRemove=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this._handles=new Ii,this._handles.add([ae(()=>this.view.state?.camera,()=>this.setDirty()),ae(()=>this.view.state?.rasterPixelRatio,()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(vt.LABELER,this)]),this._textTextureAtlas=new Z3({view:this.view}),this._hudMaterialCollection=new Tce(this.view._stage),this._calloutMaterialCollection=new Tce(this.view._stage)}dispose(){this._handles=$e(this._handles),this._textTextureAtlas=Ve(this._textTextureAtlas),this._hudMaterialCollection=Ve(this._hudMaterialCollection),this._calloutMaterialCollection=Ve(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear(),this._labelsToAdd.clear(),this._labelsToRemove.clear()}destroy(){this.dispose(),hd.graphic=null,hd.renderingInfo=null,hd.layer=null}_activateLabelingContext(e){e.graphics.forEach((r,i)=>{const s=new Sce(e,r);this._labels.set(i,s),e.labelsToInitialize.set(i,s),r.setVisibilityFlag(Yn.LABEL,Bo.USER,!0)}),e.active=!0}_deactivateLabelingContext(e){e.graphics.forEach((r,i)=>{r.setVisibilityFlag(Yn.LABEL,Bo.USER,!1),this.setLabelGraphicVisibility(r,!1),this._labels.delete(i)}),e.active=!1}_addLabelTextureToAtlas(e){for(const r of e.graphics3DGraphic.labelLayers){if(!r._labelClass)continue;const i=e.textRenderers[r._labelIndex];i&&this._textTextureAtlas.addTextTexture(i,r.stageObject)}e.rendered=!0}_removeLabelTextureFromAtlas(e){for(const r of e.graphics3DGraphic.labelLayers){if(!r._labelClass)continue;const i=e.textRenderers[r._labelIndex];i!=null&&this._textTextureAtlas.removeTextTexture(i,r.stageObject)}e.rendered=!1}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(e){return this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e),Wo.YIELD}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const r of this._labelingContexts)if(r.active){if(!Ece(r)){if(sgt(r)){this._deactivateLabelingContext(r);continue}if(this._createLabelClassContext(r),vz(r)){this._dirty=!0;continue}if(!Ece(r))continue}ko(r.labelsToInitialize,(i,s)=>(this._ensureGraphics3DResources(i)&&(this._labels.set(s,i),this.deconflictor.setDirty(),e.madeProgress()),(i.visible&&i.textInitialized||!i.visible&&i.hasGraphics3DResources)&&(r.labelsToInitialize.delete(s),e.madeProgress()),e.done))&&(this._dirty=!0)}this._labelsToRemove.forEach(r=>this._removeLabelTextureFromAtlas(r)),this._labelsToAdd.forEach(r=>this._addLabelTextureToAtlas(r)),this._labelsToRemove.clear(),this._labelsToAdd.clear(),this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){const r=e.labelClassAbortController?.signal;await e.layer.when?.(),Yt(r),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const i=e.graphics3DCore,s=i.layer,n=s.labelingInfo&&s.labelingInfo.filter(o=>!!o.symbol);!n||n.length===0||(await G5(n,async(o,a)=>{const l=o.symbol,c=oK(i.getOrCreateGraphics3DSymbol(l));if(c==null)return void Q.getLogger(this).error("Failed to create Graphics3DSymbol for label");await c.load(),Yt(r);let h=null;UZ(l)&&l.hasVisibleCallout()&&(h=bat(l,i.symbolCreationContext),await h.load(),Yt(r));const p=await Eu(ZEe(o,e.layer.fieldsIndex,this.view.spatialReference));if(Yt(r),p.ok===!0){const f=await this._createTextRenderParameters(c.symbol);Yt(r),e.labelClassContexts[a]=new rgt(o,c,h,f,p.value)}else Q.getLogger(this).error(`Label expression failed to evaluate: ${p.error}`)}),Yt(r))}async _createLabelClassContext(e){return e.labelClassPromise==null&&(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(r=>{if(us(r))throw r;e.labelClassContexts.length=0}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const r=e.symbolLayers.at(0);return r?.type!=="text"?null:nOe.fromSymbol(r,this.view.state.rasterPixelRatio)}_destroyLabelClassContext(e){for(const i of e.labelClassContexts)--i.graphics3DSymbol.referenced;const r=e.labelClassAbortController;e.labelClassAbortController=new AbortController,Ll(r),e.labelClassContexts.length=0,e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,r,i,s,n){const o=new JEe(i.verticalOffset,Mle(i.anchor),hht(i.anchor),e.text,i.translation,i.elevationOffset,i.centerOffset,i.screenOffset,i.centerOffsetUnits,e.displayWidth,e.displayHeight);return hd.graphic=r,hd.renderingInfo=null,hd.layer=s,n.createLabel(hd,o,this._hudMaterialCollection,this._textTextureAtlas)}_createLineCalloutGraphic(e,r,i,s,n){return hd.graphic=e,hd.layer=n,hd.renderingInfo=new _at(null,r,s.translation,s.centerOffset,s.screenOffset,s.centerOffsetUnits,s.elevationOffset,this._calloutMaterialCollection),i.createGraphics3DGraphic(hd)}_ensureGraphics3DResources(e){if(e.hasGraphics3DResources)return!1;const r=e.graphics3DGraphic;if(r.destroyed)return!1;this._ensureTextTextureResources(e);const i=e.labelingContext,s=i.labelClassContexts;if(!s||s.length===0||!i.emptySymbolLabelSupported&&r.layers.length===0)return!1;let n=!1;const o=r.graphic,a=i.layer,l=eL(i.layer);for(let c=0;c<s.length;c++){const h=e.textRenderers[c],p=e.textLabelPlacements[c];if(h==null||p==null)continue;const f=s[c],m=f.graphics3DSymbol,y=m.symbol&&m.symbol.type==="label-3d"?m.symbol:null,_=m.symbolLayers[0];if(!_)continue;_.setElevationInfoOverride(i.elevationInfoOverride);const v=this._createTextSymbolGraphic(h,o,p,a,_);if(v==null)return!1;v._labelClass=f.labelClass,v._labelIndex=c,r.addLabelGraphic(v,i.stageLayer),r.deconflictionPriority=f.textRenderParameters?.definition.size??0,r.setVisibilityFlag(Yn.LABEL,Bo.USER,l),r.setVisibilityFlag(Yn.LABEL,Bo.SCALE_RANGE,!0),r.setVisibilityFlag(Yn.LABEL,Bo.DECONFLICTION,!1),n=!0;const b=f.graphics3DCalloutSymbolLayer;if(b&&p.hasLabelVerticalOffset){b.setElevationInfoOverride(i.elevationInfoOverride);const T=this._createLineCalloutGraphic(o,y,b,p,a);T!=null&&(f.calloutSymbolLayerIndex=r.labelLayers.length,r.addLabelGraphic(T,i.stageLayer))}break}return i.scaleVisibility&&n&&i.scaleVisibility.updateGraphicLabelScaleVisibility(r),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const r=e.labelingContext.labelClassContexts;for(const i of e.graphics3DGraphic.labelLayers){if(i._labelClass==null)continue;const s=r[i._labelIndex].graphics3DSymbol.symbolLayers[0];s?.onRemoveGraphic(i)}e.graphics3DGraphic.deconflictionPriority=0,e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){if(e.textInitialized)return;const r=e.labelingContext,i=r.labelClassContexts;if(!i||i.length===0)return;const s=e.graphics3DGraphic.graphic;for(let n=0;n<i.length;n++){const o=i[n];if(e.textRenderers[n]=null,e.textLabelPlacements[n]=null,o?.textRenderParameters==null)continue;const a=o.labelFunction;let l;if(a.type==="arcade")try{const b=a.needsHydrationToEvaluate()?Eot(s,r.layer):s;l=a.evaluate(b)}catch{l=null}else l=a.evaluate(s);if(l==null||l===""||/^\s+$/.test(l))continue;const c=o.graphics3DSymbol,h=c.symbol?.type==="label-3d"?c.symbol:null;if(!c.symbolLayers[0])continue;const p=e.graphics3DGraphic,f=o.labelClass,m=r.disablePlacement,y=Bmt({graphics3DGraphic:p,labelSymbol:h,labelClass:f,disablePlacement:m});if(y==null)continue;const _=Mle(y.anchor),v=t3e(_);e.textRenderers[n]=new KAe(l,v,o.textRenderParameters),e.textLabelPlacements[n]=y}e.textInitialized=!0}_destroyTextTextureResources(e){e.textInitialized=!1,e.textRenderers.length=0,e.textLabelPlacements.length=0}_addGraphic(e,r){const i=r.graphic.uid;if(e.graphics.set(i,r),e.active){const s=new Sce(e,r);this._labels.set(i,s),e.labelsToInitialize.set(i,s)}this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(e,r){const i=r.graphic.uid,s=this._labels.get(i);e.graphics.delete(i),s&&(this._destroyGraphic(s,i),e.labelsToInitialize.delete(i),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,r){this._labels.has(r)&&(this._labels.delete(r),this._labelsToAdd.delete(r),this._labelsToRemove.delete(r)),e.textInitialized&&(this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e)),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,r){if(!r)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const i of r){const s=e.graphics.get(i);s&&(this._removeGraphic(e,s),this._addGraphic(e,s))}}_globalPropertyChanged(e,r){for(const i of r.labelClassContexts){const s=new Map;r.graphics.forEach(o=>s.set(o.graphic.uid,o));const n=o=>o.labelLayers[0];if(i.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,s,n),i.graphics3DCalloutSymbolLayer){const o=a=>a.labelLayers[i.calloutSymbolLayerIndex];i.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,s,o)}}}_visibilityInfoChange(e){const r=eL(e.layer);r&&!e.active&&this._activateLabelingContext(e),!r&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.graphics.forEach((r,i)=>{const s=this._labels.get(i);s&&(this._destroyGraphic(s,i),s.visible=!1,s.rendered=!1,e.labelsToInitialize.set(i,s))}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const r of this._labelingContexts)if(r.graphics3DCore===e)return r;return null}addGraphicsOwner(e,r,i){const s=i&&i.emptySymbolLabelSupported||!1,n=i&&i.elevationInfoOverride||null,o=i&&i.disablePlacement||null;if(this._findLabelingContext(e))return;const a=e.layer,l=new igt(this.view._stage,a,e,r,s,n,o,eL(a));return this._labelingContexts.push(l),this.setDirty(),{addGraphic:c=>this._addGraphic(l,c),removeGraphic:c=>this._removeGraphic(l,c),featureReductionChange:()=>{},layerLabelsEnabled:()=>eL(l.layer),labelingInfoChange:c=>this._labelingInfoChange(l,c),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",l),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",l),visibilityInfoChange:()=>this._visibilityInfoChange(l),reset:()=>this._resetLabels(l),clear:()=>{}}}removeGraphicsOwner(e){const r=this._findLabelingContext(e);if(!r)return;const i=this._labelingContexts.indexOf(r);this._labelingContexts.splice(i,1),r.graphics.forEach(s=>this._removeGraphic(r,s)),r.destroy(),this.setDirty()}setLabelGraphicVisibility(e,r){const i=e.graphic.uid,s=this._labels.get(i);s&&s.visible!==r&&(r&&!s.rendered?(this._labelsToAdd.set(i,s),this._labelsToRemove.delete(i),s.textInitialized||s.labelingContext.labelsToInitialize.set(i,s)):!r&&s.rendered&&(this._labelsToRemove.set(i,s),this._labelsToAdd.delete(i)),s.visible=r,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._dirty||this._textTextureAtlas?.updating||this.deconflictor.updating||this._labelingContexts.some(e=>vz(e))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((r,i)=>r+(vz(i)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function vz(t){return!!t.labelClassPromise&&!!t.labelClassAbortController}function Ece(t){return t.labelClassContexts&&t.labelClassContexts.length}function sgt(t){return t.labelClassContexts===null}function eL(t){return t.labelsVisible===!0&&!!t.labelingInfo?.some(e=>!!e.symbol)}u([d({constructOnly:!0})],db.prototype,"view",void 0),u([d({constructOnly:!0})],db.prototype,"deconflictor",void 0),u([d()],db.prototype,"_textTextureAtlas",void 0),u([d({type:Boolean,readOnly:!0})],db.prototype,"updating",null),db=u([P("esri.views.3d.layers.graphics.Labeler")],db);const hd=new vat(null,null,null);let Y3=class xS{constructor(e,r,i,s=null){this.lij=[0,0,0],this.extent=Vt(),this.resolution=0,this.loadPriority=0,this.measures={visibility:sa.VISIBLE_ON_SURFACE,screenRect:Vt(),distance:0,shouldSplit:!1},this.used=!1,s&&this.acquire(e,r,i,s)}acquire(e,r,i,s){this.tilingScheme=s,this.id=xS.id(e,r,i),this.lij[0]=e,this.lij[1]=r,this.lij[2]=i,s.getExtent(e,r,i,this.extent),this.resolution=s.resolutionAtLevel(e)}release(){this.tilingScheme=null}getChildren(e){const r=this.lij[0]+1,i=2*this.lij[1],s=2*this.lij[2];return e?(e[0].acquire(r,i,s,this.tilingScheme),e[1].acquire(r,i+1,s,this.tilingScheme),e[2].acquire(r,i,s+1,this.tilingScheme),e[3].acquire(r,i+1,s+1,this.tilingScheme),e):[new xS(r,i,s,this.tilingScheme),new xS(r,i+1,s,this.tilingScheme),new xS(r,i,s+1,this.tilingScheme),new xS(r,i+1,s+1,this.tilingScheme)]}copyMeasurementsFrom(e){this.measures.visibility=e.measures.visibility,this.measures.shouldSplit=e.measures.shouldSplit,this.measures.distance=e.measures.distance,oy(e.measures.screenRect,this.measures.screenRect)}static id(e,r,i){return`${e}/${r}/${i}`}};var sa;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",t[t.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(sa||(sa={}));const lOe=.5*Math.PI,ngt=lOe/Math.PI*180;let ogt=class{constructor(e){this._renderCoordsHelper=e.renderCoordsHelper,this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:O(),direction:O()};for(let r=0;r<4;r++)this._extent[r]={origin:O(),direction:O(),cap:{next:null,direction:O()}},this._planes[r]=Nr();this._planes[di.NEAR]=Nr(),this._planes[di.FAR]=Nr(),this._planesWithoutFar=this._planes.slice(0,5)}update(e,r,i,s=!0){const n=this._extent;this._toRenderBoundingExtent(e,r,i),ue(this._center.origin,n[0].origin,n[2].origin),ie(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),s||ie(this._center.direction,this._center.direction,-1);for(let o=0;o<4;o++){const a=n[o];this._renderCoordsHelper.worldUpAtPosition(a.origin,a.direction);const l=n[o===3?0:o+1];a.cap.next=l.origin,by(a.cap.direction,a.origin,l.origin),LR(a.direction,a.cap.direction,a.origin,this._planes[o]),s||ie(a.direction,a.direction,-1)}LR(n[0].cap.direction,n[1].cap.direction,n[0].origin,this._planes[di.NEAR]),s?Mj(this._planes[di.NEAR],this._planes[di.FAR]):(G6(this._planes[di.FAR],this._planes[di.NEAR]),Mj(this._planes[di.NEAR],this._planes[di.NEAR])),this._maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this._maxSpanSpatialReference=r,this._minGlobalAltitude=.9*zr(this._maxSpanSpatialReference).radius}isVisibleInFrustum(e,r,i=!1){if(e==null)return!1;if(this._renderCoordsHelper.viewingMode===Ue.Global){const n=this._maxSpanSpatialReference.isGeographic?ngt:lOe*r;if(this._maxSpan>n)return!0;if(e.altitude!=null&&e.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(e)}if(this._maxSpan===0){const n=this._extent[0];return!(i||!e.intersectsRay(Ou(n.origin,n.direction)))}for(let n=0;n<this._extent.length;n++){const o=this._extent[n];if(!i&&e.intersectsRay(Ou(o.origin,o.direction))||e.intersectsLineSegment(sw(o.origin,o.cap.next,lgt),o.cap.direction))return!0}const s=i?this._planes:this._planesWithoutFar;for(let n=0;n<e.lines.length;n++){const o=e.lines[n];if(cet(s,o.origin,o.endpoint,o.direction))return!0}return!1}_toRenderBoundingExtentGlobal(e,r,i){iZ(e,dd),dd[2]=i,Pl(r,dd,bz,this._renderCoordsHelper.spatialReference),Mn(Cce,bz),Si(ql);for(const{x0:n,x1:o,y0:a,y1:l}of agt)for(let c=0;c<5;c++){const h=c/4;dd[0]=St(e[n],e[o],h),dd[1]=St(e[a],e[l],h),dd[2]=i,Zs(dd,r,dd,this._renderCoordsHelper.spatialReference),Fe(dd,dd,Cce),am(ql,dd)}se(this._extent[0].origin,ql[0],ql[1],ql[2]),se(this._extent[1].origin,ql[3],ql[1],ql[2]),se(this._extent[2].origin,ql[3],ql[4],ql[2]),se(this._extent[3].origin,ql[0],ql[4],ql[2]);for(let n=0;n<4;++n)Fe(this._extent[n].origin,this._extent[n].origin,bz)}_toRenderBoundingExtentLocal(e,r,i){jM(e,r,Vm,this._renderCoordsHelper.spatialReference),se(this._extent[0].origin,Vm[0],Vm[1],i),se(this._extent[1].origin,Vm[2],Vm[1],i),se(this._extent[2].origin,Vm[2],Vm[3],i),se(this._extent[3].origin,Vm[0],Vm[3],i)}_toRenderBoundingExtent(e,r,i){switch(this._renderCoordsHelper.viewingMode){case Ue.Global:this._toRenderBoundingExtentGlobal(e,r,i);break;case Ue.Local:this._toRenderBoundingExtentLocal(e,r,i);break;default:this._renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(e){if(pi(e.planes[di.NEAR],this._center.origin)<0&&fe(this._center.direction,e.direction)<0)return!0;for(let r=0;r<4;r++){const i=this._extent[r];if(pi(e.planes[di.NEAR],i.origin)<0&&fe(i.direction,e.direction)<0)return!0}return!1}};const agt=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],dd=O(),bz=be(),Cce=be(),ql=pn(),Vm=Vt(),lgt=Op();let cgt=class{constructor(e){this._renderCoordsHelper=e,this._surfaceElevation=0,this._cache=new Map,this._frustum=new v_(e),this._extendedFrustum=new v_(e),this._intersector=new ogt({renderCoordsHelper:e}),this._renderCoordsHelper=e}begin(e,r){this._surfaceElevation=r,this._aboveGround=this._renderCoordsHelper.getAltitude(e.eye)>r,this._frustum.update(e),this._shortenFrustumFarPlane(this._frustum),this._updateExtendedFrustum(e)}end(){this._cache.clear()}calculate(e){if(this._allTilesInvisible)return sa.INVISIBLE;const r=this._renderCoordsHelper.viewingMode===Ue.Global&&e.lij[0]>=ugt&&e.lij[0]<hgt,i=this._getOrCalculateSingleTileVisibility(e,!r);return i!==sa.INVISIBLE&&r?this._calculateAggregatedChildrenVisibility(e):i}_shortenFrustumFarPlane(e){const r=v_.nearFarLineIndices,i=e.mutablePoints;for(const s of r){const[n,o]=s,a=i[n],l=i[o];de(Hc,l,a),ie(Hc,Hc,pgt),ue(i[o],a,Hc)}e.updatePoints(i)}_calculateAggregatedChildrenVisibility(e){let r=sa.INVISIBLE;const i=this._cache.get(e.id);if(i!=null)return i;const s=Mce.acquire();e.getChildren(s);for(const n of s){const o=this.calculate(n);if(o!==sa.INVISIBLE&&(r=o,o===sa.VISIBLE_ON_SURFACE))break}return Mce.release(s),this._cache.set(e.id,r),r}_getOrCalculateSingleTileVisibility(e,r){const i=this._cache.get(e.id);if(i!=null)return i;const s=this._calculateSingleTileVisibility(e);return r&&this._cache.set(e.id,s),s}_calculateSingleTileVisibility(e){return!this._aboveGround&&this._renderCoordsHelper.viewingMode===Ue.Global&&e.lij[0]<dgt?this._calculateSingleTileVisibilitySided(e,!1)===sa.INVISIBLE?this._calculateSingleTileVisibilitySided(e,!0):void 0:this._calculateSingleTileVisibilitySided(e,this._aboveGround)}_calculateSingleTileVisibilitySided(e,r){this._intersector.update(e.extent,e.tilingScheme.spatialReference,this._surfaceElevation,r);const i=zr(e.tilingScheme.spatialReference).radius;return this._intersector.isVisibleInFrustum(this._extendedFrustum,i)?this._intersector.isVisibleInFrustum(this._frustum,i,!0)?sa.VISIBLE_ON_SURFACE:sa.VISIBLE_WHEN_EXTENDED:sa.INVISIBLE}_updateExtendedFrustum(e){this._extendedFrustum.update(e),this._shortenFrustumFarPlane(this._extendedFrustum);const r=this._renderCoordsHelper.worldUpAtPosition(e.eye,Hc);this._aboveGround||pa(r,r);const i=In(-fe(r,e.viewForward));if(this._allTilesInvisible=i>(Math.PI+e.fovY)/2,this._allTilesInvisible||(this._hasExtendedFrustum=i>e.fovY/2,!this._hasExtendedFrustum))return;const s=this._extendedFrustumParameters(),n=this._extendedFrustum.mutablePoints;for(let o=0;o<4;o++){const a=s.pointIndices[o],l=n[a],c=this._renderCoordsHelper.getAltitude(l);if(s.needsAltitudeAdjustment(c)){switch(this._renderCoordsHelper.worldUpAtPosition(l,Hc),a){case Qe.FAR_BOTTOM_LEFT:case Qe.FAR_TOP_LEFT:case Qe.NEAR_BOTTOM_LEFT:case Qe.NEAR_TOP_LEFT:Pj(this._extendedFrustum.planes[di.LEFT],Hc,Hc);break;case Qe.FAR_BOTTOM_RIGHT:case Qe.FAR_TOP_RIGHT:case Qe.NEAR_BOTTOM_RIGHT:case Qe.NEAR_TOP_RIGHT:Pj(this._extendedFrustum.planes[di.RIGHT],Hc,Hc)}ie(Hc,Hc,s.direction),this._renderCoordsHelper.intersectInfiniteManifold(Ou(l,Hc),s.zWithMargin,l)}}if(this._extendedFrustum.updatePoints(n),oa(n[Qe.NEAR_BOTTOM_LEFT],n[Qe.NEAR_BOTTOM_RIGHT],n[Qe.NEAR_TOP_RIGHT],Oce),oa(n[Qe.NEAR_BOTTOM_RIGHT],n[Qe.NEAR_TOP_RIGHT],n[Qe.NEAR_TOP_LEFT],Rce),fe(Oce,Rce)<0){const o=this._extendedFrustum.mutablePoints;this._aboveGround?[o[Qe.NEAR_BOTTOM_LEFT],o[Qe.NEAR_BOTTOM_RIGHT]]=[o[Qe.NEAR_BOTTOM_RIGHT],o[Qe.NEAR_BOTTOM_LEFT]]:[o[Qe.NEAR_TOP_LEFT],o[Qe.NEAR_TOP_RIGHT]]=[o[Qe.NEAR_TOP_RIGHT],o[Qe.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(o)}}_extendedFrustumParameters(){return this._aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const e=this._surfaceElevation-Ace;return{zWithMargin:e,pointIndices:v_.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:r=>r>e}}_extendedFrustumParametersBelowSurface(){const e=this._surfaceElevation+Ace;return{zWithMargin:e,pointIndices:v_.planePointIndices.top,direction:1,needsAltitudeAdjustment:r=>r<e}}};const ugt=2,hgt=6,dgt=12,pgt=.95,Ace=1,Hc=O(),Oce=Nr(),Rce=Nr(),Mce=new Go(Array,t=>{t.length!==4&&(t[0]=new Y3,t[1]=new Y3,t[2]=new Y3,t[3]=new Y3)},t=>{t[0].release(),t[1].release(),t[2].release(),t[3].release()});let fgt=class{constructor(e){this._camera=new gt,this._focusOnMap=[0,0],this._screenRect=Vt(),this._tileSize=e.tileSize,this._renderCoordsHelper=e.renderCoordsHelper,this._tilingScheme=e.tilingScheme,this._visibility=new cgt(e.renderCoordsHelper)}begin(e,r,i){this._camera.copyFrom(e),this._surfaceElevation=i,this._focusOnMap[0]=r.x,this._focusOnMap[1]=r.y,rZ(0,0,e.fullWidth,e.fullHeight,this._screenRect),this._visibility.begin(this._camera,i)}end(){this._visibility.end()}updateTile(e){e.measures.visibility=this._visibility.calculate(e),e.measures.distance=DFe(e.extent,this._focusOnMap),e.measures.visibility!==sa.INVISIBLE&&this._updateScreenMeasure(e)}_updateScreenMeasure(e){const r=mgt,i=1<<r,s=e.measures.screenRect;Ic(s);let n=0;const o=e.lij[0]+r,a=e.lij[1]<<r,l=e.lij[2]<<r,c=this._tileSizeWithBias(e),h=c*c;for(let p=0;p<i;p++)for(let f=0;f<i;f++)if(n+=this._computeScreenArea(e,o,a+p,l+f,s),n>h)return void(e.measures.shouldSplit=!0);e.measures.shouldSplit=!1}_tileSizeWithBias(e){return e.measures.visibility===sa.VISIBLE_WHEN_EXTENDED?this._tileSize*ggt:this._tileSize}_computeScreenArea(e,r,i,s,n){const o=e.measures.visibility===sa.VISIBLE_WHEN_EXTENDED;this._projectToScreen(r,i,s,o,g0),Ic(wz);for(let a=0;a<4;a++)c2(wz,g0[a]);return V_(n,wz,n),dne(g0[0],g0[1],g0[2])+dne(g0[0],g0[2],g0[3])}_projectToScreen(e,r,i,s,n){this._tilingScheme.ensureMaxLod(e),this._tilingScheme.getExtent(e,r,i,gA),this._toRenderCoords(gA,0,3,y0[0]),this._toRenderCoords(gA,2,3,y0[1]),this._toRenderCoords(gA,2,1,y0[2]),this._toRenderCoords(gA,0,1,y0[3]),s&&(this._projectToPlane(y0,this._camera.frustum[di.NEAR]),this._projectToPlane(y0,this._camera.frustum[di.TOP]),this._projectToPlane(y0,this._camera.frustum[di.BOTTOM]));for(let o=0;o<4;o++)this._camera.projectToRenderScreen(y0[o],Pce),this._camera.renderToScreen(Pce,n[o])}_projectToPlane(e,r){for(let s=0;s<4;s++)_A[s]=pi(r,e[s]);const i=Math.max(_A[0],_A[1],_A[2],_A[3]);if(i>0){const s=ie(yA,r,-i);for(let n=0;n<4;n++)ue(e[n],e[n],s)}}_toRenderCoords(e,r,i,s){return yA[0]=e[r],yA[1]=e[i],yA[2]=this._surfaceElevation,this._renderCoordsHelper.toRenderCoords(yA,this._tilingScheme.spatialReference,s),s}};const wz=Vt(),mgt=2,ggt=5,g0=[Ji(),Ji(),Ji(),Ji()],gA=Vt(),yA=O(),y0=[O(),O(),O(),O()],_A=[0,0,0,0],Pce=jo();function NVt(t,e,r){if(t==null||r==null)return!1;let i=!0;return sn[0]=t.xmin!=null?t.xmin:0,sn[1]=t.ymin!=null?t.ymin:0,sn[2]=t.zmin!=null?t.zmin:0,i=i&&li(sn,t.spatialReference,0,e,r,0,1),sn[0]=t.xmax!=null?t.xmax:0,sn[1]=t.ymax!=null?t.ymax:0,sn[2]=t.zmax!=null?t.zmax:0,i=i&&li(sn,t.spatialReference,0,e,r,3,1),t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.zmin==null&&(e[2]=-1/0),t.xmax==null&&(e[3]=1/0),t.ymax==null&&(e[4]=1/0),t.zmax==null&&(e[5]=1/0),i}function cOe(t,e,r){if(t==null||r==null)return!1;let i=!0;return sn[0]=t.xmin!=null?t.xmin:0,sn[1]=t.ymin!=null?t.ymin:0,sn[2]=t.zmin!=null?t.zmin:0,i=i&&li(sn,t.spatialReference,0,sn,r,0,1),e[0]=sn[0],e[1]=sn[1],sn[0]=t.xmax!=null?t.xmax:0,sn[1]=t.ymax!=null?t.ymax:0,sn[2]=t.zmax!=null?t.zmax:0,i=i&&li(sn,t.spatialReference,0,sn,r,0,1),e[2]=sn[0],e[3]=sn[1],t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.xmax==null&&(e[2]=1/0),t.ymax==null&&(e[3]=1/0),i}const sn=O();let ho=class extends we{get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(e!=null&&!e.spatialReference.equals(this.viewState.spatialReference))return void Q.getLogger(this).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const r=this._get("filterExtent");if(r===e||r!=null&&e&&r.equals(e))return;const i=e!=null?e.clone():null;this._set("filterExtent",i),this._setDirty()}get _filterExtentRect(){if(this.filterExtent==null)return null;const e=Vt();return cOe(this.filterExtent,e,this.tilingScheme.spatialReference),e}get _rootTileIds(){const{tilingScheme:e}=this;return this._filterExtentRect&&e?e.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}constructor(e){super(e),this.tiles=new Pt,this.tileSize=512,this._idToTile=new Map,this._handles=new Ii,this._clients=new Set,this._dirty=!1,this._pendingTiles=null,this._newTiles=new Bt}initialize(){this._handles.add([ae(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),qr),ae(()=>[this.tileSize,this.cameraOnSurface?.location,this.tilingScheme,this.viewState?.contentCamera,this.focus?.location],()=>this._setDirty(),Is)]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(vt.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=Ni(this._frameWorker),this._handles=$e(this._handles)}addClient(){const e=_gt();return this._clients.add(e),this._clients.size===1&&this._setDirty(),el(()=>this._removeClient(e))}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(Ja))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),this._frameWorker!=null&&(this._frameWorker.priority=vt.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),this._pendingTiles||this._frameWorker==null||(this._frameWorker.priority=vt.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new fgt({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){const{tilingScheme:e}=this;return this._rootTileIds.map(r=>new Y3(r[0],r[1],r[2],e))}_purgeHorizonTiles(e){e.sort((r,i)=>{const s=r.measures.screenRect,n=i.measures.screenRect;return s[1]+s[3]-(n[1]+n[3])}),Ic(tL);for(let r=0;r<e.length;r++)if(V_(tL,e.data[r].measures.screenRect,tL),wp(tL)>vgt)return e.data.slice(r,e.length);return[]}_subdivideTilesForView(e){if(!this._pendingTiles)return;const{tilingScheme:r}=this;for(;this._pendingTiles.length>0&&!e.done;){const i=this._pendingTiles.pop();e.madeProgress(),this._filterExtentRect&&!OM(this._filterExtentRect,i.extent)||(this._tileMeasurements.updateTile(i),i.measures.visibility!==sa.INVISIBLE&&(i.measures.shouldSplit?(r.ensureMaxLod(i.lij[0]+1),this._pendingTiles.push(...i.getChildren())):this._newTiles.push(i)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}_updateTiles(e){for(const s of this.tiles.items)s.used=!1;const r=e.filter(s=>{const n=this._idToTile.get(s.id);return n?(n.copyMeasurementsFrom(s),n.used=!0):this._idToTile.set(s.id,s),!n}),i=this.tiles.items.filter(s=>!s.used&&(this._idToTile.delete(s.id),!0));this.tiles.removeMany(i),this.tiles.addMany(r),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,r)=>e.measures.visibility!==r.measures.visibility?e.measures.visibility===sa.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-r.measures.distance),this.tiles.forEach((e,r)=>e.loadPriority=r)}};u([d({constructOnly:!0})],ho.prototype,"scheduler",void 0),u([d({constructOnly:!0})],ho.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],ho.prototype,"tilingSchemeOwner",void 0),u([d({constructOnly:!0})],ho.prototype,"cameraOnSurface",void 0),u([d({constructOnly:!0})],ho.prototype,"focus",void 0),u([d({constructOnly:!0})],ho.prototype,"viewState",void 0),u([d({constructOnly:!0})],ho.prototype,"terrain",void 0),u([d()],ho.prototype,"tiles",void 0),u([d()],ho.prototype,"tileSize",void 0),u([d({readOnly:!0})],ho.prototype,"tilingScheme",null),u([d()],ho.prototype,"filterExtent",null),u([d({readOnly:!0})],ho.prototype,"_filterExtentRect",null),u([d({readOnly:!0})],ho.prototype,"_rootTileIds",null),u([d({value:!1})],ho.prototype,"suspended",null),u([d({readOnly:!0})],ho.prototype,"updating",null),ho=u([P("esri.views.3d.layers.support.FeatureTileTree3D")],ho);let ygt=0;function _gt(){return ygt++}const tL=Vt(),vgt=10;let rs=class extends we{constructor(){super(...arguments),this._propertiesPool=new fy({camera:gt},this),this._lastSeenCameraProjectionValues=new gt,this.mode=Fr.ANIMATING,this._cssCamera=new gt,this._camera=new gt,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.events=new ws,this.viewingMode=Ue.Global,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}init(e,r){this._set("viewingMode",e),this._set("spatialReference",r),this._set("constraints",new gg({mode:this.viewingMode}))}exit(){this.cameraController?.destroy(),this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new fy({camera:gt},this)}destroy(){this.cameraController?.destroy(),this.cameraController=null,this._propertiesPool?.destroy(),this._propertiesPool=null}createInitialCamera(){if(this.viewingMode===Ue.Global){const e=zr(this.spatialReference).radius;this.camera=new gt({eye:Me(4*e,0,0),center:Me(e,0,0),up:Me(0,0,1)})}else this.camera=new gt({eye:Me(0,0,100),center:Me(0,0,0),up:Me(0,1,0)})}get animation(){return this.cameraController instanceof qR&&this.cameraController.viewAnimation!=null?this.cameraController.viewAnimation:null}get camera(){return this._camera}get cssCamera(){const e=this._cssCamera.copyFrom(this.camera),{height:r,width:i,pixelRatio:s}=this.camera;return e.pixelRatio=1,e.height=Math.round(r/s),e.width=Math.round(i/s),e}set camera(e){e!==Hu&&Hu.copyFrom(e),Hu.computeUp(this.viewingMode),this.events.emit("before-camera-change",Hu);const r=this._camera;if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,Hu)&&(this._lastSeenCameraProjectionValues.copyFrom(Hu),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),!r.equals(Hu)&&(this._camera=this._propertiesPool.get("camera").copyFrom(Hu),this._cameraChanged=!r.almostEquals(Hu),this._cameraChanged)){const i=Hfe(()=>{this._cameraChanged=!1,i.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get alignPixelEnabled(){return this.pixelRatio===this.rasterPixelRatio&&this.mode===Fr.IDLE}get updating(){return!this.alignPixelEnabled}get contentCamera(){return this._contentCamera??this.camera}set contentCamera(e){this._contentCamera=e!=null?e.clone():null}get fixedContentCamera(){return this._contentCamera!=null}get isGlobal(){return this.viewingMode===Ue.Global}get isLocal(){return this.viewingMode===Ue.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){this.stopActiveCameraController()?(this.cameraController?.destroy(),e&&(this.removeHandles(Ice),this.addHandles(Cu(()=>e.state===Zi.Finished||e.state===Zi.Stopped,()=>{this._set("cameraController",null),this.updateCamera(r=>e.onControllerEnd(r))},{sync:!0,once:!0}),Ice),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=Zi.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==Zi.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this._updateQueue.length===0||this._processingUpdates)return;this._processingUpdates=!0;const e=this._updateQueue.shift();Hu.copyFrom(this._get("camera")),e(Hu),this.camera=Hu,this._processingUpdates=!1,this._processUpdateQueue()}_cameraProjectionChanged(e,r){return e.fov!==r.fov||e.fullViewport[0]!==r.fullViewport[0]||e.fullViewport[1]!==r.fullViewport[1]||e.fullViewport[2]!==r.fullViewport[2]||e.fullViewport[3]!==r.fullViewport[3]||e.padding[tr.TOP]!==r.padding[tr.TOP]||e.padding[tr.RIGHT]!==r.padding[tr.RIGHT]||e.padding[tr.BOTTOM]!==r.padding[tr.BOTTOM]||e.padding[tr.LEFT]!==r.padding[tr.LEFT]}};u([d()],rs.prototype,"mode",void 0),u([d({readOnly:!0,type:pE})],rs.prototype,"animation",null),u([d({type:gt})],rs.prototype,"camera",null),u([d({type:gt})],rs.prototype,"cssCamera",null),u([d()],rs.prototype,"_cssCamera",void 0),u([d()],rs.prototype,"_camera",void 0),u([d({readOnly:!0})],rs.prototype,"pixelRatio",null),u([d()],rs.prototype,"rasterPixelRatio",void 0),u([d()],rs.prototype,"contentPixelRatio",void 0),u([d({readOnly:!0})],rs.prototype,"alignPixelEnabled",null),u([d({readOnly:!0})],rs.prototype,"updating",null),u([d({})],rs.prototype,"_contentCamera",void 0),u([d({type:gt})],rs.prototype,"contentCamera",null),u([d({readOnly:!0})],rs.prototype,"fixedContentCamera",null),u([d({readOnly:!0})],rs.prototype,"constraints",void 0),u([d({readOnly:!0})],rs.prototype,"events",void 0),u([d({readOnly:!0})],rs.prototype,"isGlobal",null),u([d({readOnly:!0})],rs.prototype,"isLocal",null),u([d({readOnly:!0})],rs.prototype,"viewingMode",void 0),u([d({readOnly:!0})],rs.prototype,"spatialReference",void 0),u([d()],rs.prototype,"navigating",null),u([d()],rs.prototype,"stationary",null),u([d()],rs.prototype,"_cameraChanged",void 0),u([d()],rs.prototype,"cameraController",null),rs=u([P("esri.views.3d.state.ViewState")],rs);const bgt=rs,Hu=new gt,Ice="ViewStateHandles";let wgt=class{constructor(e,r,i){this.viewingMode=e,this._forEachLayer=r,this._view=i,this._externalIntersectionHandlers=new Bt,this._tolerance=_E,this._tmpRay=Jn(),this._tmpRegion=Vt(),this._validateHUDIntersector=qh(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(e,r,i){return this.intersectRay(this._getPickRay(e,this._tmpRay),$ce(this.viewingMode),r,i)}intersectScreenFreePointFallback(e,r,i){return this.intersectRayFreePointFallback(this._getPickRay(e,this._tmpRay),r,i)}intersectRayFreePointFallback(e,r,i){return this.intersectRay(e,$ce(this.viewingMode),r,i)||this._intersectRayFreePointLocal(e,r)}intersectRay(e,r,i,s){return r.options.selectionMode=!1,r.options.store=wo.MIN,this.computeIntersection(e,r,s),!!r.results.min&&r.results.min.getIntersectionPoint(i)}getCenterRayWithSubpixelOffset(e,r,i=.5,s=.5){return e.getRenderCenter(sL,i,s),sL[0]+=.0466,sL[1]-=.0123,jJ(e,sL,r)}intersectIntersectorScreen(e,r,i){this.computeIntersection(this._getPickRay(e,this._tmpRay),r,i)}intersectToolIntersectorScreen(e,r,i){const s=this._getPickRay(e,this._tmpRay);this.intersectToolIntersectorRay(s,r,i)}intersectToolIntersectorRay(e,r,i){r.options.selectionMode=!0,this.computeIntersection(e,r,i);const s=r.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||Mp(s)&&s.intersector!==Gi.TERRAIN||(r.options.selectionMode=!1,this.computeIntersection(e,r,i))}setTolerance(e=_E){this._tolerance=e}addIntersectionHandler(e){this._externalIntersectionHandlers.push(e),this._externalIntersectionHandlers.sort((r,i)=>r.type===Gi.TERRAIN?1:i.type===Gi.TERRAIN?-1:0)}removeIntersectionHandler(e){this._externalIntersectionHandlers.removeUnordered(e)!=null&&this._externalIntersectionHandlers.sort((r,i)=>r.type===Gi.TERRAIN?1:i.type===Gi.TERRAIN?-1:0)}_getPickRay(e,r){const i=this._view.state.camera;return MSe(i,e,r)}_intersectRayFreePointLocal(e,r){return this.viewingMode!==Ue.Local||e==null||ue(r,e.origin,ye(ze.get(),e.direction)),!1}intersectElevationFromScreen(e,r,i=0,s=null){return this._intersectElevation(this._getPickRay(e,this._tmpRay),r,i,s)}_intersectElevation(e,r,i=0,s=null){if(e==null)return null;const n=r!=null?r.mode:"absolute-height",o=r?.offset??0,a=n!=="on-the-ground"?o+i:0,l=a/this._view.renderCoordsHelper.unitInMeters;if(n==="absolute-height"){if(this._view.renderCoordsHelper.intersectInfiniteManifold(e,a,iL)){const T=this._view.computeMapPointFromVec3d(iL);return T.z??(T.z=0),T.z-=o,T}return null}const c=this._view.state.camera,h=ze.get();c.projectToRenderScreen(e.origin,h);const p=new Lce(null,this._forEachLayer),f=this._view.slicePlane,m=f!=null?eoe(f):null,y=qh(this.viewingMode);y.options.store=wo.MIN,y.options.verticalOffset=l;const _=e.origin,v=ue(ze.get(),_,e.direction);y.reset(_,v,c),y.point=h;const b=s?"type"in s&&s.type==="graphics"?T=>T.layerUid!==s.uid:T=>T.graphicUid!==s.uid:null;switch(n){case"relative-to-scene":{const T=x=>(!b||b(x))&&!!x.lastValidElevationBB;y.intersect(p.layers,h,this._tolerance,null,T),this._externalIntersectionHandlers.forAll(x=>{if(x.type===Gi.I3S||x.type===Gi.TERRAIN){const S=x.slicePlaneEnabled?m:null;x.intersect(y,S,y.rayBegin,y.rayEnd,h)}});break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll(T=>{if(T.isGround){const x=T.slicePlaneEnabled?m:null;T.intersect(y,x,y.rayBegin,y.rayEnd,h)}})}if(y.results.min.getIntersectionPoint(iL)){const T=this._view.computeMapPointFromVec3d(iL);return T.z=i,T}return null}computeIntersection(e,r,i){if(e==null)return;const s=this._view.state.camera,n=ze.get();s.projectToRenderScreen(e.origin,n);const o=new Lce(i,this._forEachLayer);r.options.selectOpaqueTerrainOnly=!i||!("include"in i||"exclude"in i);const a=e.origin,l=ue(ze.get(),e.origin,e.direction);r.reset(a,l,s),r.intersect(o.layers,n,this._tolerance);const c=this._view.slicePlane,h=c!=null?eoe(c):null;r.intersect(o.sliceableLayers,n,this._tolerance,h);const p=i&&(i.requiresGroundFeedback||i.enableDraped);this._externalIntersectionHandlers.forAll(y=>{const _=y.layerUid,v=Array.isArray(_),b=v?_:[_];v&&(r.options.filteredLayerUids=[]);let T=!1;for(const x of b)o.filterLayerUid(x)?T=!0:v&&r.options.filteredLayerUids.push(x);if(r.options.isFiltered=!T,y.isGround&&p||!r.options.isFiltered){const x=y.slicePlaneEnabled?h:null;y.intersect(r,x,a,l,n)}});const f=ze.get(),m=this._view.basemapTerrain;if(i&&i.enableDraped&&m.spatialReference!=null&&r.results.ground.getIntersectionPoint(f)){const y=m.overlayManager.renderer,_=this._view.renderCoordsHelper.spatialReference,v=ze.get();this._view.renderCoordsHelper.fromRenderCoords(f,v,m.spatialReference),v[2]=this._view.elevationProvider?.getElevation(f[0],f[1],f[2],_,"ground")??0,y.intersect(r,v,r.results.ground,b=>o.filterRenderGeometry(b))}r.sortResults(),this._processHUDResults(r)}_processHUDResults(e){const r=e.results.hud;oy(this._tmpRegion,dB);const i=this._view.state.camera,s=[],n=this._tmpRegion,o=b=>{const T=new Tgt(b);i.projectToRenderScreen(b.target.center,T.screenPoint),T.screenPoint[0]=Math.floor(T.screenPoint[0]),T.screenPoint[1]=Math.floor(T.screenPoint[1]),s.push(T),c2(n,T.screenPoint)};e.sortResults(r.all),r.min.dist!=null&&o(r.min);for(const b of r.all)r.min.target.object!==b.target.object&&r.max.target.object!==b.target.object&&o(b);if(r.max.dist!=null&&r.max.target.object!==r.min.target.object&&o(r.max),!s.length)return;n[0]===n[2]&&(n[2]+=1),n[1]===n[3]&&(n[3]+=1);const a=i.fullWidth,l=i.fullHeight,c=Math.max(0,n[0]-J3),h=Math.max(0,n[1]-J3),p=Math.min(pu(n)+2*J3,a-c),f=Math.min(wp(n)+2*J3,l-h),m=new Uint8Array(p*f*4);this._view._stage.renderer.readHUDVisibility(c,h,p,f,m);let y=!0;const _=e.results.max.dist==null;let v=0;for(const b of s)for(const T of xgt)if(m[4*(Math.min(b.screenPoint[0]+T[0],a)-n[0]+(Math.min(b.screenPoint[1]+T[1],l)-n[1])*p)]){y&&(e.results.min.copy(b.result),y=!1),_&&e.results.max.copy(b.result),e.options.store===wo.ALL&&e.results.all.splice(v++,0,b.result);break}}};const J3=1,xgt=(()=>{const t=[],e=J3;for(let r=-e;r<=e;r++)for(let i=-e;i<=e;i++)t.push([i+e,r+e]);return t})();let Tgt=class{constructor(e){this.result=e,this.screenPoint=jo()}},rL;function $ce(t){return rL&&rL.viewingMode===t||(rL=qh(t)),rL}let Lce=class{constructor(e,r){this.layers=new Array,this.sliceableLayers=new Array,this.include=e?.include,this.exclude=e?.exclude,r(i=>{i.pickable&&this.filterLayerUid(i.apiLayerUid)&&(i.sliceable?this.sliceableLayers:this.layers).push(i)})}filterLayerUid(e){const{include:r,exclude:i}=this;return e==null?r==null&&i==null:(r==null||r.has(e))&&(i==null||!i.has(e))}filterRenderGeometry(e){return this.filterLayerUid(e.layerUid)}};function Dce(t){return typeof t=="object"&&"intersect"in t}const iL=O(),sL=jo();let BVt=class{constructor(e,r){this.spatialReference=e,this._view=r}getElevation(e,r,i){return this._view.elevationProvider.getElevation(e,r,0,this.spatialReference,i)}async queryElevation(e,r,i,s,n){return this._view.elevationProvider.queryElevation(e,r,0,this.spatialReference,n,i,s)}},Sgt=class{constructor(e,r,i,s){this.spatialReference=r,this._getElevationQueryProvider=i,this._queries=new Array,this._queryOptions={...s,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(vt.ELEVATION_QUERY,this)}destroy(){this._frameTask.remove()}queryElevation(e,r,i,s=0){const n=xo(),o={x:e,y:r,minDemResolution:s,result:n,signal:i};return this._queries.push(o),da(i,()=>{rX(this._queries,o),n.reject(kr())}),n.promise}get running(){return this._queries.length>0}runTask(e){const r=this._queries;this._queries=[];const i=this._getElevationQueryProvider();if(!i)return r.forEach(h=>h.result.reject()),void e.madeProgress();const s=r.map(h=>[h.x,h.y]),n=r.reduce((h,p)=>Math.min(h,p.minDemResolution),1/0),o=new AM({points:s,spatialReference:this.spatialReference}),a=r.length>1&&r.some(h=>!!h.signal)?new AbortController:null,l=a!=null?a.signal:r[0].signal;if(a!=null){let h=0;r.forEach(p=>da(p.signal,()=>{h++,p.result.reject(kr()),h===r.length&&a.abort()}))}const c={...this._queryOptions,minDemResolution:n,signal:l};i.queryElevation(o,c).then(h=>{r.forEach((p,f)=>{p.signal!=null&&p.signal.aborted?p.result.reject(kr()):p.result.resolve(h.geometry.points[f][2])})}).catch(h=>{r.forEach(p=>p.result.reject(h))}),e.madeProgress()}get test(){const e=this;return{update:()=>e._queries.length>0&&e.runTask(Ja)}}},Q3=class extends ws.EventedMixin(we){get spatialReference(){return this.view?.basemapTerrain?.spatialReference}constructor(e){super(e),this._im=new Array,this._ground=new Array,this._scene=new Array,this._handles=new Map,this.lastElevationQuery=null,this.elevationCacheEnabled=!1}destroy(){this._elevationQueryCached=$e(this._elevationQueryCached)}get _elevationQuery(){return this._elevationQueryCached==null&&(this._elevationQueryCached=new Sgt(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4})),this._elevationQueryCached}enableElevationCache(e){e||(this.lastElevationQuery=null),this.elevationCacheEnabled=e}getElevation(e,r,i,s,n){if(this.elevationCacheEnabled&&this.lastElevationQuery!=null){const a=this.lastElevationQuery;if(e===a.x&&r===a.y&&i===a.z&&Pn(s,a.spatialReference)&&n===a.queryContext)return a.result}let o=null;return o=nL(o,this._im,e,r,i,s,n),o==null&&(o=nL(o,this._ground,e,r,i,s,n)),n==="scene"&&(o=nL(o,this._scene,e,r,i,s,n)),this.elevationCacheEnabled&&(this.lastElevationQuery={x:e,y:r,z:i,spatialReference:s,queryContext:n,result:o}),o}getSphereElevationBounds(e,r){let i=1/0,s=-1/0;for(const n of[this._im,this._ground,this._scene])n.forEach(o=>{if(o.getSphereElevationBounds){const a=o.getSphereElevationBounds(e,r);a!=null&&(i=Math.min(i,a.min),s=Math.max(s,a.max))}});return{min:i,max:s}}queryElevation(e,r,i,s,n,o=null,a=0){const l=xo();return this._elevationQuery.queryElevation(e,r,o,a).then(c=>{n==="scene"&&(c=nL(c,this._scene,e,r,i,s,n)),l.resolve(c)}).catch(c=>{us(c)?l.reject(c):l.resolve(this.getElevation(e,r,i,s,n))}),l.promise}register(e,r){this._handles.set(r,r.on("elevation-change",i=>this.emit("elevation-change",i))),this._providersFromContext(e).push(r)}unregister(e){this._handles.has(e)&&(this._handles.get(e)?.remove(),this._handles.delete(e));for(const r of[this._im,this._ground,this._scene]){const i=r.indexOf(e);i>-1&&r.splice(i,1)}}_providersFromContext(e){switch(e){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}};function nL(t,e,r,i,s,n,o){for(const a of e){const l=a.getElevation(r,i,s,n,o);l!=null&&(t=t!=null?Math.max(l,t):l)}return t}u([d({constructOnly:!0})],Q3.prototype,"view",void 0),u([d()],Q3.prototype,"spatialReference",null),Q3=u([P("esri.views.3d.support.CombinedElevationProvider")],Q3);let K3=class Kq{static isValidProfile(e){return e in Kq.profiles}static getDefaultProfile(){return oe("esri-iPhone")?"low":"medium"}static apply(e,r){const i=Kq.profiles[e];r.graphics3D.maxTotalNumberOfFeatures=i.graphics3D.maxTotalNumberOfFeatures,r.graphics3D.maxTotalNumberOfPrimitives=i.graphics3D.maxTotalNumberOfPrimitives,r.graphics3D.polygonLodFactor=i.graphics3D.polygonLodFactor,r.graphics3D.polylineLodFactor=i.graphics3D.polylineLodFactor,r.graphics3D.snapshotAvailable=i.graphics3D.snapshotAvailable,r.graphics3D.skipHighSymbolLods=i.graphics3D.skipHighSymbolLods;const s=r.sceneService.object,n=i.sceneService.object;s.lodFactor=n.lodFactor,s.lodCrossfadeinDuration=n.lodCrossfadeinDuration,s.lodCrossfadeoutDuration=n.lodCrossfadeoutDuration,s.lodCrossfadeUncoveredDuration=n.lodCrossfadeUncoveredDuration,r.sceneService.point.lodFactor=i.sceneService.point.lodFactor,r.sceneService.integratedMesh.lodFactor=i.sceneService.integratedMesh.lodFactor,r.sceneService.pointCloud.lodFactor=i.sceneService.pointCloud.lodFactor,r.sceneService.uncompressedTextureDownsamplingEnabled=i.sceneService.uncompressedTextureDownsamplingEnabled,r.tiledSurface.lodBias=i.tiledSurface.lodBias,r.tiledSurface.angledSplitBias=i.tiledSurface.angledSplitBias,r.tiledSurface.reduceTileLevelDifferences=i.tiledSurface.reduceTileLevelDifferences,r.tiledSurface.textureFadeDuration=i.tiledSurface.textureFadeDuration,r.heatmap.pixelRatio=i.heatmap.pixelRatio,r.heatmap.maxTotalNumberOfFeatures=i.heatmap.maxTotalNumberOfFeatures,r.fadeDuration=i.fadeDuration,r.antialiasingEnabled=i.antialiasingEnabled,r.physicallyBasedRenderingEnabled=i.physicalBasedRenderingEnabled,r.highQualityTransparency=i.highQualityTransparency,r.highResolutionAtmosphere=i.highResolutionAtmosphere,r.reflections=i.reflections,r.ambientOcclusion=i.ambientOcclusion,r.memoryLimit=i.memoryLimit,r.additionalCacheMemory=i.additionalCacheMemory,r.frameRate=i.frameRate,r.maximumPixelRatio=i.maximumPixelRatio}};function Nce(){const t=!!oe("esri-mobile"),e=!!oe("ios"),r=400;return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxTotalNumberOfPrimitives:85e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25e3},sceneService:{object:{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},fadeDuration:0,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:t?.8:1,polylineLodFactor:t?1.2:1.5,snapshotAvailable:!e,skipHighSymbolLods:!1},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:r},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:t},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!oe("disable-feature:reduce-map-tile-levels"),textureFadeDuration:r},fadeDuration:r,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:t?600:750,additionalCacheMemory:t?-100:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:t?1.2:2,polylineLodFactor:t?1.2:2,snapshotAvailable:!e,skipHighSymbolLods:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:r},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!oe("disable-feature:reduce-map-tile-levels"),textureFadeDuration:r},fadeDuration:r,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!0,reflections:!0,ambientOcclusion:!0,memoryLimit:t?900:1500,additionalCacheMemory:t?-150:0,frameRate:0,maximumPixelRatio:t?1:1/0}}}K3.test={reset(){const t=Nce();for(const e of Object.keys(t))K3.profiles[e]=t[e]}},function(t){t.profiles=Nce()}(K3||(K3={}));const bN=K3;function uOe(){return new Float32Array(4)}function Egt(t){const e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function ym(t,e,r,i){const s=new Float32Array(4);return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function Cgt(t,e){return new Float32Array(t,e,4)}function hOe(){return uOe()}function dOe(){return ym(1,1,1,1)}function pOe(){return ym(1,0,0,0)}function fOe(){return ym(0,1,0,0)}function mOe(){return ym(0,0,1,0)}function gOe(){return ym(0,0,0,1)}const Agt=hOe(),Ogt=dOe(),Rgt=pOe(),Mgt=fOe(),Pgt=mOe(),Igt=gOe();Object.freeze(Object.defineProperty({__proto__:null,ONES:Ogt,UNIT_W:Igt,UNIT_X:Rgt,UNIT_Y:Mgt,UNIT_Z:Pgt,ZEROS:Agt,clone:Egt,create:uOe,createView:Cgt,fromValues:ym,ones:dOe,unitW:gOe,unitX:pOe,unitY:fOe,unitZ:mOe,zeros:hOe},Symbol.toStringTag,{value:"Module"}));const Fce=new Ne([0,255,255]),Uce=new Ne([0,0,0]),kce=1,zce=.25,Vce=.4,Bce=.2;let _f=class extends we{constructor(){super(...arguments),this.color=Fce.clone(),this.haloColor=null,this.haloOpacity=kce,this.fillOpacity=zce,this.shadowOpacity=Vce,this.shadowColor=Uce.clone(),this.shadowDifference=Bce}static toEngineOptions(e){const r=Ne.toUnitRGBA(e.color??Fce),i=e.haloColor!=null?Ne.toUnitRGBA(e.haloColor):r,s=Ne.toUnitRGBA(e.shadowColor??Uce),n=e.haloOpacity??kce,o=e.fillOpacity??zce,a=e.shadowOpacity??Vce,l=e.shadowDifference??Bce;return{color:ym(r[0],r[1],r[2],r[3]),haloColor:ym(i[0],i[1],i[2],i[3]),haloOpacity:n,haloOpacityOccluded:.25*n,fillOpacity:o,fillOpacityOccluded:.25*o,shadowOpacity:a,shadowColor:Nt(s[0],s[1],s[2],s[3]),occludedShadowOpacity:a*(1-l)}}};u([d({type:Ne})],_f.prototype,"color",void 0),u([d({type:Ne})],_f.prototype,"haloColor",void 0),u([d()],_f.prototype,"haloOpacity",void 0),u([d()],_f.prototype,"fillOpacity",void 0),u([d()],_f.prototype,"shadowOpacity",void 0),u([d({type:Ne})],_f.prototype,"shadowColor",void 0),u([d()],_f.prototype,"shadowDifference",void 0),_f=u([P("esri.views.3d.support.HighlightOptions")],_f);const eW=_f;function qU(t,e){return e?{...e,query:{...t??{},...e.query}}:{query:t}}function WU(t){return typeof t=="string"?To(t):K(t)}function XU(t,e,r){const i={};for(const s in t){if(s==="declaredClass")continue;const n=t[s];if(n!=null&&typeof n!="function")if(Array.isArray(n)){i[s]=[];for(let o=0;o<n.length;o++)i[s][o]=XU(n[o])}else if(typeof n=="object")if(n.toJSON){const o=n.toJSON(r&&r[s]);i[s]=e?o:JSON.stringify(o)}else i[s]=e?n:JSON.stringify(n);else i[s]=n}return i}function WVt(t){return{geometryType:uZ(t[0]),geometries:t.map(e=>e.toJSON())}}function $gt(t,e,r){const i=XFe(e);return t.map(s=>{const n=i.fromJSON(s);return n.spatialReference=r,n})}let pb=class extends le{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(s=>s.toJSON()),r=this.geometries[0],i={};return i.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),i.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference.toJSON()),i.geometries=JSON.stringify({geometryType:uZ(r),geometries:e}),this.transformation&&(i.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(i.transformForward=this.transformForward),i}};u([d()],pb.prototype,"geometries",void 0),u([d({json:{read:{source:"outSR"}}})],pb.prototype,"outSpatialReference",void 0),u([d()],pb.prototype,"transformation",void 0),u([d()],pb.prototype,"transformForward",void 0),pb=u([P("esri.rest.support.ProjectParameters")],pb);const ZU=pb,Lgt=vs(ZU);async function cK(t,e,r){e=Lgt(e);const i=WU(t),s={...i.query,f:"json",...e.toJSON()},n=e.outSpatialReference,o=uZ(e.geometries[0]),a=qU(s,r);return hr(i.path+"/project",a).then(({data:{geometries:l}})=>$gt(l,o,n))}async function uK(t=null,e){if(Br.geometryServiceUrl)return Br.geometryServiceUrl;if(!t)throw new V("internal:geometry-service-url-not-configured");let r;r="portal"in t?t.portal||Js.getDefault():t,await r.load({signal:e});const i=r.helperServices?.geometry?.url;if(!i)throw new V("internal:geometry-service-url-not-configured");return i}async function Dgt(t,e,r=null,i){const s=await uK(r,i),n=new ZU;n.geometries=[t],n.outSpatialReference=e;const o=await cK(s,n,{signal:i});if(o&&Array.isArray(o)&&o.length===1)return o[0];throw new V("internal:geometry-service-projection-failed")}const Ngt=Object.freeze(Object.defineProperty({__proto__:null,getGeometryServiceURL:uK,projectGeometry:Dgt},Symbol.toStringTag,{value:"Module"}));let Fgt=class{constructor(e,r){this.spatialReference=r,this.unitInMeters=_a(this.spatialReference,zr(this.spatialReference).metersPerDegree),this._geometryServiceURLPromise=uK(e&&e.get("portalItem")).catch(()=>{throw new V("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(e){const r=await this._geometryServiceURLPromise;let i,s=!0;Array.isArray(e[0])&&typeof e[0]!="number"?i=e:(i=[e],s=!1);const n=i.map(l=>l instanceof Ke?l:new Ke(l,this.spatialReference)),o=new ZU({geometries:n,outSpatialReference:je.WGS84}),a=(await cK(r,o)).map(l=>l.type==="point"?[l.x,l.y]:void 0).filter(l=>!!l);return s?a:a[0]}},zd=class extends we{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxTotalNumberOfPrimitives=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1}};u([d()],zd.prototype,"minTotalNumberOfFeatures",void 0),u([d()],zd.prototype,"maxTotalNumberOfFeatures",void 0),u([d()],zd.prototype,"maxTotalNumberOfPrimitives",void 0),u([d()],zd.prototype,"snapshotAvailable",void 0),u([d()],zd.prototype,"polygonLodFactor",void 0),u([d()],zd.prototype,"polylineLodFactor",void 0),u([d()],zd.prototype,"skipHighSymbolLods",void 0),zd=u([P("esri.views.3d.support.QualitySettings.Graphics3DSettings")],zd);let em=class extends we{constructor(){super(...arguments),this.lodFactor=1}};u([d()],em.prototype,"lodFactor",void 0),em=u([P("esri.views.3d.support.QualitySettings.LoDFactorSettings")],em);let HF=class extends em{constructor(){super(...arguments),this.lodCrossfadeinDuration=0,this.lodCrossfadeoutDuration=0,this.lodCrossfadeUncoveredDuration=0}};HF=u([P("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],HF);let Rg=class extends we{constructor(){super(...arguments),this.object=new HF,this.point=new em,this.integratedMesh=new em,this.pointCloud=new em,this.uncompressedTextureDownsamplingEnabled=!1}};u([d({type:HF})],Rg.prototype,"object",void 0),u([d({type:em})],Rg.prototype,"point",void 0),u([d({type:em})],Rg.prototype,"integratedMesh",void 0),u([d({type:em})],Rg.prototype,"pointCloud",void 0),u([d()],Rg.prototype,"uncompressedTextureDownsamplingEnabled",void 0),Rg=u([P("esri.views.3d.support.QualitySettings.SceneServiceSettings")],Rg);let h_=class extends we{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.reduceTileLevelDifferences=!0,this.textureFadeDuration=400}};u([d()],h_.prototype,"lodBias",void 0),u([d()],h_.prototype,"angledSplitBias",void 0),u([d()],h_.prototype,"reduceTileLevelDifferences",void 0),u([d()],h_.prototype,"textureFadeDuration",void 0),h_=u([P("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],h_);let JS=class extends we{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};u([d()],JS.prototype,"pixelRatio",void 0),u([d()],JS.prototype,"maxTotalNumberOfFeatures",void 0),JS=u([P("esri.views.3d.support.QualitySettings.HeatmapSettings")],JS);let $o=class extends we{constructor(){super(...arguments),this.graphics3D=new zd,this.sceneService=new Rg,this.tiledSurface=new h_,this.heatmap=new JS,this.fadeDuration=400,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.highResolutionAtmosphere=!1,this.reflections=!1,this.ambientOcclusion=!1,this.memoryLimit=750,this.additionalCacheMemory=0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};u([d({type:zd})],$o.prototype,"graphics3D",void 0),u([d({type:Rg})],$o.prototype,"sceneService",void 0),u([d({type:h_})],$o.prototype,"tiledSurface",void 0),u([d({type:JS})],$o.prototype,"heatmap",void 0),u([d()],$o.prototype,"fadeDuration",void 0),u([d()],$o.prototype,"antialiasingEnabled",void 0),u([d()],$o.prototype,"physicallyBasedRenderingEnabled",void 0),u([d()],$o.prototype,"highQualityTransparency",void 0),u([d()],$o.prototype,"highResolutionAtmosphere",void 0),u([d()],$o.prototype,"reflections",void 0),u([d()],$o.prototype,"ambientOcclusion",void 0),u([d()],$o.prototype,"memoryLimit",void 0),u([d()],$o.prototype,"additionalCacheMemory",void 0),u([d()],$o.prototype,"frameRate",void 0),u([d()],$o.prototype,"maximumPixelRatio",void 0),$o=u([P("esri.views.3d.support.QualitySettings.QualitySettings")],$o);const Gce=$o;function Ugt(t){return kE(t)&&t.length>=3}function kgt(t){return(zE(t)||Array.isArray(t))&&t.length>=3}function zgt(t){return Ugt(t)||kgt(t)}let Vgt=class tW{constructor(e,r,i,s){this.viewingMode=e,this.spatialReference=r,this.unitInMeters=i,this._coordinateSystem=s,this._tmpCoordinateSystem=cWe(s)}set extent(e){e&&uWe(this._coordinateSystem,e,this._coordinateSystem)}getAltitude(e){return _We(this._coordinateSystem,e)}setAltitude(e,r,i=e){return Dwe(this._coordinateSystem,i,r,e)}setAltitudeOfTransformation(e,r){vWe(this._coordinateSystem,r,e,r)}worldUpAtPosition(e,r){return fWe(this._coordinateSystem,e,r)}worldBasisAtPosition(e,r,i){return mWe(this._coordinateSystem,e,r,i)}basisMatrixAtPosition(e,r){const i=this.worldBasisAtPosition(e,Tc.X,ze.get()),s=this.worldBasisAtPosition(e,Tc.Y,ze.get()),n=this.worldBasisAtPosition(e,Tc.Z,ze.get());return xm(r,i[0],i[1],i[2],0,s[0],s[1],s[2],0,n[0],n[1],n[2],0,0,0,0,1),r}headingAtPosition(e,r){const i=this.worldUpAtPosition(e,ze.get()),s=this.worldBasisAtPosition(e,Tc.Y,ze.get()),n=Zbe(r,s,i);return rl(n)}intersectManifoldClosestSilhouette(e,r,i){return g9(this._coordinateSystem,r,this._tmpCoordinateSystem),yWe(this._tmpCoordinateSystem,e,i),i}intersectManifold(e,r,i){g9(this._coordinateSystem,r,this._tmpCoordinateSystem);const s=ze.get();return gWe(this._tmpCoordinateSystem,e,s)?re(i,s):null}intersectInfiniteManifold(e,r,i){if(this.viewingMode===Ue.Global)return this.intersectManifold(e,r,i);g9(this._coordinateSystem,r,this._tmpCoordinateSystem);const s=this._tmpCoordinateSystem.value,n=ze.get();return px(s.plane,e,n)?re(i,n):null}toRenderCoords(e,r,i){return wF(e)?So(e,r,this.spatialReference):Zs(e,r,i,this.spatialReference)}fromRenderCoords(e,r,i=null){return wF(r)?(i!=null&&(r.spatialReference=i),vY(e,this.spatialReference,r)):zgt(r)?Zs(e,this.spatialReference,r,i)?r:null:dy(e,this.spatialReference,r)}static create(e,r){switch(e){case Ue.Local:return new tW(Ue.Local,r,_a(r),pWe());case Ue.Global:return new tW(Ue.Global,r,1,dWe(r))}}static renderUnitScaleFactor(e,r){return Uee(e)/Uee(r)}};var Nf;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.BASEMAP=1]="BASEMAP",t[t.I3S_INDEX=2]="I3S_INDEX",t[t.I3S_DATA=3]="I3S_DATA",t[t.SYMBOLOGY=4]="SYMBOLOGY"})(Nf||(Nf={}));const Bgt=(()=>{const t=new Array;return t[Nf.ELEVATION]=10,t[Nf.BASEMAP]=10,t[Nf.I3S_INDEX]=10,t[Nf.I3S_DATA]=10,t[Nf.SYMBOLOGY]=5,t})(),Ggt=30;function yOe(t){return"usedMemory"in t&&"unloadedMemory"in t&&"ignoresMemoryFactor"in t}function jgt(t){return new bl({view:t})}const oL=1,xz=1,Hgt=.75,qgt=.6,jce=1.3;let bl=class extends we{constructor(e){super(e),this._quality=1,this._usedMemory=0,this._updating=!1,this.minQuality=.1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new A_e,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=750,this._additionalCacheMemory=0}destroy(){this._cacheStorage.destroy()}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(oL),this._maxMemory=e)}get maxMemory(){return this._maxMemory}set additionalCacheMemory(e){e!=null&&(this._additionalCacheMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._usedMemory}newCache(e,r){return new z9e(e,this._cacheStorage,r)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._updateMemory(),this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();if(this._memoryPredicted<qgt&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(oL);else if(e)(this._memoryPredicted>1.1*xz||this._usedMemory>xz)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._usedMemory&&(this._updateQuality(this._quality/jce),this._downscaleMemoryUsed=this._usedMemory,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._usedMemory>xz)this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/jce),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._usedMemory<Hgt&&this._quality<oL){this._stableQuality=this._quality;const r=.05;e=this._updateQuality(this._quality+r)}else this._quality<1&&(this._canFastRecover=!0);this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,this.minQuality),oL))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){if(!this.view)return;let e=0;this.view.basemapTerrain&&(e+=this.view.basemapTerrain.usedMemory);const r=this.view?._stage&&this.view._stage.renderView&&this.view._stage.renderer?.edgeView;r!=null&&(e+=r.usedMemory);let i=0;this.view.allLayerViews&&this.view.allLayerViews.forEach(a=>{if(yOe(a)){const l=a.ignoresMemoryFactor?this._quality:1;e+=a.usedMemory*l,i+=a.unloadedMemory*l}});const s=this._warnMemoryUsage==null||Math.round(10*e)!==Math.round(10*this._warnMemoryUsage),n=1048576*this.maxMemory;if(e>n&&s){this._warnMemoryUsage=e;const a=c=>(c/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",l=Math.round(100*this._quality);Q.getLogger(this).warn(`Memory Limit exceeded! Limit: ${a(n)} Current: ${a(e)} Projected: ${a(e+i)} Quality: ${l}%`)}this._usedMemory=e/n,this._memoryPredicted=(e+i)/n;const o=n-e;this._cacheStorage.maxSize=Math.max(0,o+1048576*this.additionalCacheMemory)}get test(){const e=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const r=e._numQualityChanges;return e._numQualityChanges=0,r}}}};u([d({constructOnly:!0})],bl.prototype,"view",void 0),u([d()],bl.prototype,"maxMemory",null),u([d()],bl.prototype,"additionalCacheMemory",null),u([d()],bl.prototype,"memoryFactor",null),u([d()],bl.prototype,"updating",null),u([d()],bl.prototype,"usedMemory",null),u([d()],bl.prototype,"_quality",void 0),u([d()],bl.prototype,"_usedMemory",void 0),u([d()],bl.prototype,"_updating",void 0),u([d()],bl.prototype,"_stableQuality",void 0),u([d()],bl.prototype,"_maxMemory",void 0),u([d()],bl.prototype,"_additionalCacheMemory",void 0),bl=u([P("esri.views.3d.support.MemoryController")],bl);let Wgt=class{constructor(e){this.client=e,this._cancelled=!1,this.size=0,this.duration=0}},Xgt=class{constructor(e){this.typeWorkerQuota=e,this.tasks=new Array,this.numWorkers=0,this.statistics=new Zgt}},Zgt=class{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}},Ygt=class{constructor(e,r,i,s){this._workerFunc=e,this._callbackFunc=r,this._maxTotalNumWorkers=i,this._totalNumWorkers=0,this._clients=s.map(n=>new Xgt(n))}destroy(){this._clients.length=0}hasQuota(e){const r=this._clients[e];return!!r&&(this._totalNumWorkers<this._maxTotalNumWorkers||r.numWorkers+r.tasks.length<r.typeWorkerQuota)}push(e){const r=this._clients[e.client];r&&(this._totalNumWorkers<this._maxTotalNumWorkers?(r.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,(i,s)=>this._taskCallback(i,s))):r.tasks.push(e))}cancel(e){this._taskFinished(e),e._cancelled=!0}_taskFinished(e){const r=this._clients[e.client];this._totalNumWorkers--,r&&(r.numWorkers--,r.statistics.requests++,r.statistics.size+=e.size||0,r.statistics.duration+=e.duration||0,r.statistics.speed=r.statistics.duration>0?r.statistics.size/r.statistics.duration:0,nt(r.numWorkers>=0)),this._next()}_next(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))return}_processQueue(e){for(;e.tasks.length>0;)if(this._workerFunc(e.tasks.shift(),(r,i)=>this._taskCallback(r,i)))return e.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(e,r){e._cancelled||(this._callbackFunc(e,r),this._taskFinished(e))}getStatsForType(e){const r=this._clients[e];return r?{quota:r.typeWorkerQuota,workers:r.numWorkers,queueSize:r.tasks.length,requestStats:r.statistics}:null}get test(){const e=this;return{set workerFunc(r){e._workerFunc=r}}}},wN=class extends we{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,r,i){this._loadQueue=new Ygt((s,n)=>this._startLoading(s,n),(s,n)=>this._doneLoadingCB(s,n),e,r),i&&(this._frameTask=i.registerTask(vt.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=Ni(this._frameTask),this._tasks.forEach(e=>Ll(e.abortController)),this._loadQueue=$e(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,r,i,s={}){const n=xo();n.__signal=s!=null?s.signal:null;const o=this._createOrUpdateTask(e,r,i,s,n);return da(s,()=>this._cancelRequest(o,n)),n.promise}_createTask(e,r,i,s,n,o){const a=new Kgt(e,r,i,s,n);return this._updateTask(a,o),this._tasks.set(n,a),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(a),a}_cancelRequest(e,r){uR(e.resolvers,r),r.reject(kr()),e.resolvers.length===0&&(e.status===ch.DOWNLOADING&&(e.status=ch.CANCELLED,this._loadQueue.cancel(e),e.abortController?.abort(),e.request=null,e.abortController=null),e.status=ch.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,r){e.resolvers.push(r)}_createOrUpdateTask(e,r,i,s,n){const o=eyt(s!=null&&s.uid||e,r,i),a=this._tasks.get(o);return a?(this._updateTask(a,n),a):this._createTask(e,s,r,i,o,n)}_doneLoadingCB(e,r){this._loadQueue&&(nt(e.status===ch.DOWNLOADING),e.status=ch.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:r}):this._doneLoading(e,r))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const r=this._onLoadQueue.shift();Yt(r.task.abortController),r.task.abortController=null,r.callback(r.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const r=this._doneQueue.shift();r.task.status!==ch.DOWNLOADED&&(r.err=r.err||kr()),this._doneLoading(r.task,r.err),e.madeProgress()}}_doneLoading(e,r){if(r&&!us(r)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let i=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const s of e.resolvers)if(r)us(r)?s.reject(r):s.reject(new V("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${r}`,{url:e.url,error:r}));else{--i;const n=i<=0?e.result:K(e.result);s.resolve(n)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,r){if(e.status===ch.CANCELLED)return!1;let i,s;switch(e.startTime=performance.now(),e.status=ch.DOWNLOADING,e.docType){case"binary":s="array-buffer",i=0;break;case"image":s="image";break;case"image+type":s="array-buffer";break;default:s="json"}e.abortController=new AbortController;const n=e.abortController.signal;e.request=hr(e.url,{...e.options,responseType:s,timeout:i,signal:n});let o=()=>{};const a=c=>{e.duration=performance.now()-e.startTime,e.size=c instanceof ArrayBuffer?c.byteLength:e.size||0,e.result=c,this._frameTask?this._onLoadQueue.push({callback:r,task:e}):(e.abortController=null,r(e))},l=c=>{e.status===ch.DOWNLOADING&&r(e,c),o()};return e.docType!=="image+type"?(e.request.then(c=>a(c.data),l),!0):(e.request.then(c=>{const h=c.data,p=Qgt(h);if(s="image",e.size=h.byteLength,p==="unknown")return e.request=hr(e.url,{responseType:s,timeout:i,signal:n}),void e.request.then(y=>a(y.data),l);const f=new Blob([h],{type:p}),m=window.URL.createObjectURL(f);o=()=>window.URL.revokeObjectURL(m),e.request=hr(m,{responseType:s,timeout:i,signal:n}),e.request.then(y=>a(new YU(y.data,p,o)),l)},l),!0)}get test(){return{loadQueue:this._loadQueue}}};u([d({readOnly:!0})],wN.prototype,"updating",void 0),wN=u([P("esri.views.3d.support.StreamDataLoader")],wN);const Jgt={numRetries:0};function Qgt(t){if(t.byteLength<2)return"unknown";const e=new Uint8Array(t,0,t.byteLength);return e[0]===137&&e[1]===80?"image/png":e[0]===71&&e[1]===73?"image/gif":e[0]===66&&e[1]===77?"image/bmp":e[0]===255&&e[1]===216?"image/jpeg":"unknown"}let YU=class{constructor(e,r,i){this.image=e,this.type=r,this.release=i}get isOpaque(){return this.type==="image/jpeg"}},Kgt=class extends Wgt{constructor(e,r,i,s,n){super(s),this.url=e,this.options=r,this.docType=i,this.key=n,this.result=null,this.status=ch.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=Jgt.numRetries}};function eyt(t,e,r){return`${t}:${e}:${r}`}var ch;(function(t){t[t.QUEUED=1]="QUEUED",t[t.DOWNLOADING=2]="DOWNLOADING",t[t.DOWNLOADED=3]="DOWNLOADED",t[t.CANCELLED=4]="CANCELLED"})(ch||(ch={}));let xN=class extends we{constructor(){super(...arguments),this.updating=!1}};function tyt(t){return new Id({view:t})}u([d({readOnly:!0})],xN.prototype,"updating",void 0),xN=u([P("esri.views.3d.support.ResourceControllerMain")],xN);let Id=class extends xN{constructor(){super(...arguments),this._immediateTask=dE,this._normalTask=dE,this._updatingObjects=FR([]),this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=EZe(),this._memoryController=jgt(this.view),this._streamDataLoader=new wN,this._streamDataLoader.setup(Ggt,Bgt,this._scheduler),this.addHandles([ae(()=>this.view.state?.mode,e=>{e!=null&&(this._scheduler.state=e)},qr),ae(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=k2({update:e=>this._frame(e)}),this._immediateTask=this._scheduler.registerTask(vt.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(vt.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=Ni(this._frameTask),this._streamDataLoader=$e(this._streamDataLoader),this._memoryController=$e(this._memoryController),this._scheduler=$e(this._scheduler),this.view=null}get updating(){return!!(this._memoryController?.updating||this._streamDataLoader?.updating||this._immediateTask?.updating)||this._updatingObjects?.value.some(e=>e.updating)}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(e){const r=this._streamDataLoader;return{request:(i,s,n)=>r.request(i,s,e,n),get busy(){return!r.hasDownloadSlots(e)}}}addUpdatingObject(e){const r=this._updatingObjects;return r.value=[...r.value,e],el(()=>{r.value=r.value.filter(i=>i!==e)})}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(uX(e.deltaTime)),!this._scheduler)||(this._scheduler.updateBudget(e)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update())}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){return{getQueueStats:e=>this._streamDataLoader.test.loadQueue.getStatsForType(e)}}};u([d()],Id.prototype,"view",void 0),u([d()],Id.prototype,"_scheduler",void 0),u([d()],Id.prototype,"_memoryController",void 0),u([d()],Id.prototype,"_streamDataLoader",void 0),u([d()],Id.prototype,"_immediateTask",void 0),u([d()],Id.prototype,"_normalTask",void 0),u([d()],Id.prototype,"_updatingObjects",void 0),u([d({readOnly:!0})],Id.prototype,"updating",null),Id=u([P("esri.views.3d.support.ResourceControllerImpl")],Id);function ryt(t){return yOe(t)}function iyt(t){return"performanceInfo"in t}var na,ct;(function(t){t[t.INSIDE=0]="INSIDE",t[t.INTERSECTS=1]="INTERSECTS",t[t.OUTSIDE=2]="OUTSIDE"})(na||(na={})),function(t){t[t.NORTH=0]="NORTH",t[t.NORTH_EAST=1]="NORTH_EAST",t[t.EAST=2]="EAST",t[t.SOUTH_EAST=3]="SOUTH_EAST",t[t.SOUTH=4]="SOUTH",t[t.SOUTH_WEST=5]="SOUTH_WEST",t[t.WEST=6]="WEST",t[t.NORTH_WEST=7]="NORTH_WEST"}(ct||(ct={}));const vT=O(),syt=O(),Bm=O(),Gm=O();function nyt(t,e,r=0){const i=t.extent;if(i==null)return!1;if(r===0)return Fge(i,e);const s=Math.min(i[2]-i[0],i[3]-i[1]);return LFe(i,e,r*s)}function aL(t,e,r,i){re(vT,r),vT[i]=e[i];const s=de(vT,vT,e),n=de(syt,t,e),o=fe(n,s),a=fe(s,s);let l;l=o<=0?e:a<=o?r:ue(vT,e,ie(s,s,o/a));const c=de(vT,t,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function oyt(t,e,r){const i=t.extent;if(i==null)return 0;Bm[0]=i[0],Bm[1]=i[1],Bm[2]=r,Gm[0]=i[2],Gm[1]=i[3],Gm[2]=r;let s=1/0,n=1/0;return e[0]<Bm[0]?s=aL(e,Bm,Gm,0):e[0]>Gm[0]&&(s=aL(e,Gm,Bm,0)),e[1]<Bm[1]?n=aL(e,Bm,Gm,1):e[1]>Gm[1]&&(n=aL(e,Gm,Bm,1)),Math.min(s,n)}function ayt(t,e,r){if(t==null)return iJ();if(t.spatialReference.isGeographic&&!tv(t.spatialReference))return new V("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const i=gc.checkUnsupported(t);if(i!=null)return i;if(r==null)return new V("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const s=lyt(t,r);if(s)return s;const n=t.spatialReference;return e==null||n.equals(e)||e.isWGS84&&n.isWebMercator?null:new V("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")}function lyt(t,e){const r=t.lods,i=r[0].resolution*2**r[0].level,s=[i*t.size[0],i*t.size[1]],n=[t.origin.x,t.origin.y],o=Dge(e),a=Vt();gc.computeRowColExtent(o,s,n,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>zS){const c=r[0].scale*2**r[0].level;let h=Math.max((o[3]-o[1])/t.size[1],(o[2]-o[0])/t.size[0])*c/i;const p=Math.floor(Math.log(h)/Math.log(10));return h=Math.ceil(h/10**p)*10**p,new V("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+h.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:h,requiredNumRootTiles:l,allowedNumRootTiles:zS})}return null}const cyt=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:ayt,isInsideExtent:nyt,tiltToExtentEdge:oyt},Symbol.toStringTag,{value:"Module"}));function uyt(){return!0}function hyt(){return 0}function dyt(t,e){if(t==null)return iJ();const r=t.lods.length-1,i=t.spatialReference,s=tv(i)||vm(i)||bm(i);if(i.isWebMercator){if(!gc.makeWebMercatorAuxiliarySphere(r).compatibleWith(t))return new V("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!s)return new V("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!gc.makeGCSWithTileSize(t.spatialReference,t.size[0],r).compatibleWith(t))return t.spatialReference.isWGS84?new V("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new V("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return e==null||t.spatialReference.equals(e)?void 0:new V("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}const pyt=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:dyt,isInsideExtent:uyt,tiltToExtentEdge:hyt},Symbol.toStringTag,{value:"Module"})),fyt={[Ue.Global]:pyt,[Ue.Local]:cyt};function Rf(t,e){t||console.warn("Terrain: "+e)}let cn=!1,qF=!1;function myt(t){qF=t,cn=cn||t}function gyt(t){cn=t}function Te(t,e){if(cn&&!t){const r=new Error().stack?.slice(5);throw console.warn("Terrain internal: "+(e??"")+" at "+r),new Error("Assertion failed"+(e?": "+e:""))}}function rW(t){return JU(t)?{fullExtent:t.fullExtent,minScale:t.layer.minScale,maxScale:t.layer.maxScale,tilemapCache:null}:t.layer}function WF(t){return t?.type==="imagery-tile"||t?.type==="wcs"}function JU(t){return t?.type==="imagery-tile-3d"}function hK(t){return t?.type==="tile-3d"}function nM(t){return t?.type==="vector-tile-3d"}function _Oe(t){return t?.type==="wmts-3d"}function iW(t){return t?.type==="elevation-3d"}function vA(t){return t?.type==="group"}function XF(t){return t&&(hK(t)||_Oe(t)||JU(t)||nM(t))}function sW(t){return t&&(hK(t)||JU(t)||nM(t)||_Oe(t))}function oM(t){return sW(t)||iW(t)}function yyt(t){const e=t?.sourceLayerInfo?.data;return e!=null&&"type"in e&&e.type==="raster-tile"}function vOe(t){return bOe(t?.sourceLayerInfo)}function _yt(t){const e=t?.sourceLayerInfo?.data;return e!=null&&"type"in e&&e.type==="tile-texture"}function vyt(t){const e=t?.sourceLayerInfo?.data;return e instanceof HTMLImageElement||e instanceof YU||e instanceof HTMLCanvasElement||e instanceof ImageData}function bOe(t){return t?.data!=null&&"type"in t.data&&t.data.type==="vector-tile"}function M2(t){return t!=null&&"release"in t&&t.release(),null}function Hce(t){return t.fetchTile&&t.hasOverriddenFetchTile!==!1}function dK(t,e,r,i){return fyt[i].checkIfTileInfoSupportedForViewSR(t,r,e)}function QU(t,e,r){let i=null,s=null;if(t?.type==="wmts"){const n=byt(t,e,r);i=n.tileInfo,s=n.fullExtent}else{s=WF(t)?t.getCompatibleFullExtent(e):t.fullExtent;const n=r===Ue.Local;if(WF(t))i=t.getCompatibleTileInfo(e,s,n);else if(t?.type==="vector-tile"){const o=n&&!wyt(e)||xyt.force512VTL,a=t.tileInfo.spatialReference.isGeographic;i=o?t.tileInfo:t.tileInfo.getOrCreateCompatible(256,a?1:2)}else i=t.tileInfo}return i!=null&&s!=null&&dK(i,s,e,r)==null?{tileInfo:i,fullExtent:s}:null}function byt(t,e,r){const i=i4e(t);if(i!=null){if(!Pt.isCollection(i))return{tileInfo:i.tileInfo,fullExtent:i.fullExtent};{const s=i.find(n=>dK(n.tileInfo,n.fullExtent,e,r)==null);if(s)return{tileInfo:s.tileInfo,fullExtent:s.fullExtent}}}return{tileInfo:null,fullExtent:null}}function wyt(t){return t.isWGS84||t.isWebMercator||$me(t)||!mR(t)}const xyt={force512VTL:!1};function qce(t){return"["+t[0]+","+t[1]+","+t[2]+"]"}function jm(t){return"("+t[0]+","+t[1]+","+t[2]+")"}function Sh(t,e,r=Eyt){return Math.abs(t-e)<r}function ZF(t){return t===ct.NORTH_EAST?ct.SOUTH_WEST:t===ct.NORTH_WEST?ct.SOUTH_EAST:t===ct.SOUTH_WEST?ct.NORTH_EAST:ct.NORTH_WEST}function YF(t){return t===ct.NORTH?ct.SOUTH:t===ct.EAST?ct.WEST:t===ct.SOUTH?ct.NORTH:ct.EAST}function Tyt(t){return t===ct.NORTH_WEST||t===ct.SOUTH_WEST}function Syt(t){return t===ct.NORTH_WEST||t===ct.NORTH_EAST}function Wce(t){return t===ct.NORTH_WEST||t===ct.WEST||t===ct.SOUTH_WEST}function Xce(t){return t===ct.NORTH_EAST||t===ct.EAST||t===ct.SOUTH_EAST}function Zce(t){return t===ct.SOUTH_EAST||t===ct.SOUTH||t===ct.SOUTH_WEST}function Yce(t){return t===ct.NORTH_EAST||t===ct.NORTH||t===ct.NORTH_WEST}const Vf=[ct.NORTH,ct.EAST,ct.SOUTH,ct.WEST],aM=[ct.NORTH_EAST,ct.SOUTH_EAST,ct.SOUTH_WEST,ct.NORTH_WEST],Eyt=1e-5;let Cyt=class{constructor(e,r){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=e.layer,this.memory=oM(e)?r.basemapTerrain.getUsedMemoryForLayerView(e):e.usedMemory,iyt(e)){const i=e.performanceInfo;this.displayedNumberOfFeatures=i.displayedNumberOfFeatures,this.maximumNumberOfFeatures=i.maximumNumberOfFeatures,this.totalNumberOfFeatures=i.totalNumberOfFeatures}}},Ayt=class{constructor(e){if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,e.resourceController!=null){const i=e.resourceController.memoryController;this.totalMemory=(i.maxMemory??0)*q4.MEGABYTES,this.usedMemory=Math.round(i.usedMemory*this.totalMemory),this.quality=i.memoryFactor,this.load=e.resourceController.scheduler.load}this.terrainMemory=e.basemapTerrain?.usedMemory??0;const r=e._stage&&e._stage.renderView&&e._stage.renderer.edgeView;this.edgesMemory=r!=null?r.usedMemory:0,e.allLayerViews.items.forEach(i=>{(ryt(i)||oM(i))&&this.layerPerformanceInfos.push(new Cyt(i,e))}),this.layerPerformanceInfos.sort((i,s)=>s.memory-i.memory)}},Oyt=class{constructor(e){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=e("gltf-resources",()=>{}),this._wosrMemCache=e("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(e=>e.abortController.abort()),this._wosrLoading.forEach(e=>e.abortController.abort()),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(e,r,i){const s=i?`gltfPBR:${e}`:`gltf:${e}`,n=this._gltfMemCache.get(s);return n!=null?Promise.resolve(n):this._loadOnce(this._gltfLoading,this._gltfMemCache,s,o=>S3e(new x3e(o.streamDataRequester),e,o,i),r)}loadWOSR(e,r){const i=`wosr:${e}:${r.disableTextures}`,s=this._wosrMemCache.get(i);return s!=null?Promise.resolve(s):this._loadOnce(this._wosrLoading,this._wosrMemCache,i,n=>E3e(e,n),r)}async _loadOnce(e,r,i,s,n){Yt(n);const o=da(n,()=>this._abortLoad(e,i));let a=e.get(i);if(a)a.refCount++;else{const l=new AbortController;a={refCount:1,abortController:l,promise:s({...n,signal:l.signal})},e.set(i,a)}try{const l=await a.promise;return r.put(i,l,l.size),e.delete(i),Yt(n),l}finally{Ni(o)}}_abortLoad(e,r){const i=e.get(r);i!=null&&--i.refCount>0||(e.delete(r),i?.abortController.abort())}},Ryt=class extends VS{constructor(e,r,i){super(r,i),this._streamDataRequester=e}async fromUrl(e,r,i){Yt(i);const s=i!=null?i.signal:null,n=this.makeUid(e,r);let o=this._textureRequests.get(n);if(!o){const a=new AbortController,l=this._streamDataRequester.request(e,"image",{uid:n,signal:a.signal});o=new fxe,o.abortController=a;const c=o;this._textureRequests.set(n,o),o.textureAsync=l.then(async h=>{const p=this._createTexture(e,h,r);return c.texture=p,c.abortController=null,this._stage.add(p),await this._stage.load(p),{uid:n,texture:p,release:()=>this._release(n)}},h=>{throw c.abortController=null,h})}o.referenceCount++;try{return await Dfe(o.textureAsync,s)}catch(a){throw this._release(n),a}}_createTexture(e,r,i){const s={width:r.width,height:r.height,wrap:{s:Dt.CLAMP_TO_EDGE,t:Dt.CLAMP_TO_EDGE},preMultiplyAlpha:!0};if(Ame(e)){if(i||r.width===0&&r.height===0){const n=r.width?r.height/r.width:1;i=i||64,n>1?(r.width=Math.round(i/n),r.height=i):(r.width=i,r.height=Math.round(i*n))}this._stage.renderView?.renderingContext.driverTest.svgPremultipliesAlpha.result&&(s.preMultiplyAlpha=!1)}return new _x(r,s)}},Myt=class{constructor(e){this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=e.viewState,this._view=e.view,this._pointsOfInterest=e.pointsOfInterest,this.streamDataRequester=e.resourceController.createStreamDataRequester(Nf.SYMBOLOGY),this.objectResourceCache=new Oyt((i,s)=>e.resourceController.memoryController.newCache(i,s)),this.textures=new Ryt(this.streamDataRequester,e.view._stage,e.resourceController.scheduler);const r=zr(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=R2e(e.viewingMode,r),this.screenSizePerspectiveSettingsLabels=fst(e.viewingMode,r)}destroy(){this.textures.destroy(),this.streamDataRequester=null}addGraphicsOwner(e){if(!e)return el();this._graphicsOwners.push(e);const r=ae(()=>e.layer?.screenSizePerspectiveEnabled,()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),el(()=>{r.remove(),uR(this._graphicsOwners,e),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const e=this._graphicsOwners.some(r=>r.layer?.screenSizePerspectiveEnabled===!0);if(e&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new Ii;const r=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([ae(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,r,qr),this._viewState.events.on("camera-projection-changed",r)]),this._updateScreenSizePerspectiveSettings()}else e||(this._screenSizePerspectiveHandles=$e(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){const e=this._pointsOfInterest;lL.distance=e.centerOnSurfaceInfrequent.distance,lL.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(lL),this.screenSizePerspectiveSettingsLabels.update(lL),this._view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this._screenSizePerspectiveHandles}}};const lL={distance:0,fovY:0};let TS=class{constructor(e,r,i=""){this.graphics=e,this._symbol=new Uf({symbolLayers:[new Ff({material:{color:r},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new bv({text:i,halo:{color:"white",size:1/.75},material:{color:r},size:12})]})}show(e,r){if(r==null)return;this.hide();const i=new Ke({x:e[0],y:e[1],z:e[2],spatialReference:r});this._graphic=new Nl({geometry:i,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){this._graphic!=null&&(this.graphics.remove(this._graphic),this._graphic=null)}},w_=class extends we{constructor(e){super(e),this.handles=new Ii}destroy(){this.handles.destroy()}};u([d({constructOnly:!0})],w_.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],w_.prototype,"surface",void 0),u([d({constructOnly:!0})],w_.prototype,"state",void 0),w_=u([P("esri.views.3d.support.PointOfInterest")],w_);const Pyt=Array;let $d=class extends w_{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new fy({location:Ke,renderLocation:Pyt},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.renderLocation=O(),this._tmpPoint=new Ke}initialize(){if(this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.handles.add(fa(()=>this.map?.ground?.layers,"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=$e(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get scale(){const e=this._camera,r=fi(e.eye,this.renderLocation),i={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return Uw(i,r,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map||!this.map.ground)return this._updateSurfaceAltitude(0),Wo.YIELD;const e=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint,e);const r=(this._tmpPoint.z??0)>Iyt&&this.renderCoordsHelper.viewingMode===Ue.Global&&(e.isWGS84||e.isWebMercator);let i=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:i.signal,cache:this.cache,minDemResolution:r?$yt:0}).then(s=>this._updateSurfaceAltitude(s.geometry.z??0)).catch(s=>{us(s)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===i&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),i=null}),this._pendingElevationQueryController=i,Wo.YIELD}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(Tz,this._estimatedSurfaceAltitude,this._camera.eye),ha(this._get("renderLocation"),Tz)||(this._set("renderLocation",re(this._propertiesPool.get("renderLocation"),Tz)),this.notifyChange("renderLocation"))}};u([d({constructOnly:!0})],$d.prototype,"scheduler",void 0),u([d({constructOnly:!0})],$d.prototype,"cache",void 0),u([d({constructOnly:!0})],$d.prototype,"task",void 0),u([d({readOnly:!0})],$d.prototype,"location",null),u([d({constructOnly:!0})],$d.prototype,"map",void 0),u([d({readOnly:!0})],$d.prototype,"renderLocation",void 0),u([d({readOnly:!0})],$d.prototype,"scale",null),u([d({readOnly:!0})],$d.prototype,"updating",null),$d=u([P("esri.views.3d.support.CameraOnSurface")],$d);const Tz=O(),Iyt=1e5,$yt=1e6,Lyt=Array;let uh=class extends w_{constructor(e){super(e),this._propertiesPool=new fy({location:Ke,renderLocation:Lyt},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=O(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=Ni(this._frameWorker),this._propertiesPool=$e(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,Wo.YIELD}_updateRenderLocation(){const e=Nyt;let r=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const i=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!r&&i&&(r=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),r&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const s=Fyt;r&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,s)&&(re(e,s),this._currentSurfaceAltitude=this._latestSurfaceAltitude),r?this.distance=fi(this._camera.eye,e):(ie(e,this._camera.viewForward,this._get("distance")),ue(e,e,this._camera.eye)),ha(this._get("renderLocation"),e)||this._set("renderLocation",re(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,r){const i=this._camera;if(!this.renderCoordsHelper.intersectManifold(i.ray,e,r))return!1;if(this.state.isGlobal){const s=zr(this.renderCoordsHelper.spatialReference).radius,n=s+e,o=la(i.eye),a=o<n*n,l=fi(i.eye,r);if(a&&l>s/4){const c=n-Math.sqrt(o);return ie(r,i.viewForward,c),ue(r,r,i.eye),!0}}else{const s=this.surface?.ready?this.surface.extent:null;s!=null&&jM(s,this.surface?.spatialReference,bA,this.renderCoordsHelper.spatialReference)&&(r[0]=ve(r[0],bA[0],bA[2]),r[1]=ve(r[1],bA[1],bA[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,r){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,r)){if(ai.TESTS_DISABLE_OPTIMIZATIONS)return!0;const i=this._camera.eye,s=fi(i,e),n=fi(i,r);if(Math.abs(n-s)/s>Dyt)return!0}return!1}};u([d({constructOnly:!0})],uh.prototype,"scheduler",void 0),u([d({constructOnly:!0})],uh.prototype,"task",void 0),u([d()],uh.prototype,"distance",void 0),u([d({constructOnly:!0})],uh.prototype,"estimateSurfaceAltitudeAtCenter",void 0),u([d({readOnly:!0})],uh.prototype,"location",null),u([d({readOnly:!0})],uh.prototype,"renderLocation",void 0),u([d()],uh.prototype,"updating",void 0),uh=u([P("esri.views.3d.support.CenterOnSurface")],uh);const Dyt=.05,Nyt=O(),Fyt=O(),bA=Vt();let Uyt=class{constructor(e){this._handles=new Ii,this.events=new ws,this._contentLayerViews=e.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",r=>this._layerViewsChanged(r))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=$e(this._handles),this._contentLayerViews.destroy()}_layerViewsChanged(e){e.added.forEach(r=>{r.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this._handles.add(r.on("visible-geometry-changed",()=>this._contentChanged()),r.uid)}),e.removed.forEach(r=>this._handles.remove(r.uid))}_contentChanged(){this.events.emit("request-update",kyt)}};const kyt={},zyt=Array;let vf=class extends w_{constructor(e){super(e),this._propertiesPool=new fy({location:Ke,renderLocation:zyt},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.handles.add([ae(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),ae(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.handles.add(this.scheduler.registerTask(vt.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=$e(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),r=this.centerOnSurface.renderLocation,i=this.renderCoordsHelper,s=this.state.contentCamera;this._dirty=!1,i.worldUpAtPosition(r,Jce);const n=Math.max(0,(Math.acos(fe(Jce,s.viewForward))-.5*Math.PI)*(s.aboveGround?1:-1));if(Number.isNaN(n)){if(!e||!X_(e,r)){const c=this._propertiesPool.get("renderLocation");re(c,r),this._set("renderLocation",c)}return Wo.YIELD}const o=1-ve(n/(.5*Math.PI),0,1),a=o*o*o;this._calculateScreenHorizontalEdgeOnSurface(Qce);const l=this._propertiesPool.get("renderLocation");return Hr(l,r,Qce,a),e&&X_(e,l)||this._set("renderLocation",l),Wo.YIELD}_calculateScreenHorizontalEdgeOnSurface(e){const r=this.state.contentCamera,i=r.getRenderCenter(jo());if(i[1]=r.aboveGround?r.padding[tr.BOTTOM]:r.fullHeight-r.padding[tr.TOP],this.estimateSurfaceIntersectionAtRenderPoint(i,e))return e;const s=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(r.unprojectFromRenderScreen(i,wA)){de(wA,wA,r.eye);const n=ye(wA,wA);if(this.renderCoordsHelper.intersectManifold(Ou(r.eye,n),s,e))return e}return this.renderCoordsHelper.setAltitude(e,s,r.eye)}updateRenderLocation(){this._dirty=!0}};u([d()],vf.prototype,"_dirty",void 0),u([d({constructOnly:!0})],vf.prototype,"scheduler",void 0),u([d({constructOnly:!0})],vf.prototype,"centerOnSurface",void 0),u([d({constructOnly:!0})],vf.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),u([d({readOnly:!0})],vf.prototype,"updating",null),u([d({readOnly:!0})],vf.prototype,"location",null),u([d({readOnly:!0})],vf.prototype,"renderLocation",void 0),vf=u([P("esri.views.3d.support.pointsOfInterest.Focus")],vf);const Jce=O(),wA=O(),Qce=O();let vg=class extends we{get surface(){return this.view.map?.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const e=O();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}constructor(e){super(e),this.location=null,this._updateController=null,this._handles=new Ii}initialize(){this.view.state.isLocal&&(this._handles.add([ae(()=>[this.surfaceView?.spatialReference,this.surfaceView?.extent],()=>this._update()),fa(()=>this.surface?.layers,"change",()=>this._update())]),this._update())}destroy(){this._handles.destroy()}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),!this.surfaceView||this.surfaceView.extent==null||this.surfaceView.spatialReference==null)return void this._set("location",null);const e=iZ(this.surfaceView.extent),r=new Ke({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(r,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(i=>{this._updateController=null,this._set("location",i.geometry)}).catch(i=>{us(i)||i&&i.name==="elevation-query:invalid-layer"||console.error("StableSurfaceCenter failed to update: ",i)})):this._set("location",r)}};u([d({constructOnly:!0})],vg.prototype,"view",void 0),u([d({constructOnly:!0})],vg.prototype,"cache",void 0),u([d()],vg.prototype,"surface",null),u([d()],vg.prototype,"surfaceView",null),u([d({readOnly:!0})],vg.prototype,"location",void 0),u([d({readOnly:!0})],vg.prototype,"renderLocation",null),vg=u([P("esri.views.3d.terrain.StableSurfaceCenter")],vg);let bg=class extends we{constructor(e){super(e),this._tileGeometryUpdateExtent=Ic(),this._tileGeometryUpdateSpatialReference=null,this.events=new ws,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(vt.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){return this.updating&&(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",Vyt),Ic(this._tileGeometryUpdateExtent),this._set("updating",!1)),Wo.YIELD}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,V_(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let r=1;r<this.centerOnSurfaces.length;r++){const i=this.centerOnSurfaces[r];i.distance>e.distance&&(e=i)}return e}_centerIntersectsExtent(e,r){const i=this.state.contentCamera.eye,s=Byt,n=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(i,p1,r),this.renderCoordsHelper.fromRenderCoords(n.renderLocation,f1,r),p1[0]<f1[0]?(s[0]=p1[0],s[2]=f1[0]):(s[0]=f1[0],s[2]=p1[0]),p1[1]<f1[1]?(s[1]=p1[1],s[3]=f1[1]):(s[1]=f1[1],s[3]=p1[1]),OM(s,e)}};u([d({constructOnly:!0})],bg.prototype,"state",void 0),u([d({constructOnly:!0})],bg.prototype,"centerOnSurfaces",void 0),u([d({constructOnly:!0})],bg.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],bg.prototype,"scheduler",void 0),u([d({constructOnly:!0})],bg.prototype,"surface",void 0),u([d({readOnly:!0})],bg.prototype,"updating",void 0),bg=u([P("esri.views.3d.support.SurfaceGeometryUpdates")],bg);const Vyt={},p1=O(),f1=O(),Byt=Ic();let xl=class extends we{constructor(e){super(e),this._handles=new Ii,this._tmpRay=Jn(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new fy({renderPointOfView:Gyt},this),this.renderPointOfView=O(),this._pois=new Array,this._debugCenters=new Map}initialize(){const{state:e,basemapTerrain:r,renderCoordsHelper:i,map:s}=this.view;this._surfaceIntersector=qh(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=wo.MIN,this._contentIntersector=qh(e.viewingMode);const n=()=>this._estimateSurfaceAltitudeAtCenter(),o=this.view.resourceController.scheduler,a=this.view.basemapTerrain?.elevationQueryCache,l={state:e,scheduler:o,surface:r,renderCoordsHelper:i};this._set("centerOnSurfaceInfrequent",new uh({...l,task:vt.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnSurfaceFrequent",new uh({...l,task:vt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnContent",new uh({...l,task:vt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new $d({...l,cache:a,task:vt.POINT_OF_INTEREST_INFREQUENT,map:s})),this._set("surfaceGeometryUpdates",new bg({...l,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new Uyt({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:i})),this._set("surfaceOrigin",new vg({cache:a,view:this.view})),this._set("focus",new vf({state:e,scheduler:o,surface:r,renderCoordsHelper:i,centerOnSurface:this.centerOnSurfaceFrequent,estimateSurfaceIntersectionAtRenderPoint:(h,p)=>this._estimateSurfaceIntersectionAtRenderPoint(h,this.view.state.contentCamera,p)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);const c=this.view.graphics;this._debugCenters.set(this.centerOnContent,new TS(c,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new TS(c,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new TS(c,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new TS(c,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new TS(c,"green","Focus")),this._handles.add([ae(()=>e.contentCamera,h=>this._cameraChanged(h),qr),ae(()=>r.extent,()=>this._updateCenterPointsOfInterest()),Cu(()=>!r.updating,()=>this._updateCenterPointsOfInterest(),qr),fa(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),fa(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),Cu(()=>ai.SHOW_POI,h=>this._setDebug(h),Pr)]),this._cameraChanged(this.view.state.contentCamera);for(const h of this._pois)h.runTask()}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){return!(!this.surfaceGeometryUpdates?.updating&&!this._pois.some(e=>e.updating))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this._centerRay;return e==null||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,bT,Hyt)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(bT):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this._centerRay;if(e==null)return this._surfaceAltitudeAtCenter;const r=e.origin,i=ue(bT,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.contentCamera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,r,i),this._surfaceIntersector.results.min.getIntersectionPoint(bT)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(bT)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,r,i){const s=jJ(r,e,jyt);if(s==null)return null;const n=s.origin,o=ue(bT,s.origin,s.direction);return this._surfaceIntersector.resetWithRay(s,r),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,n,o),this._surfaceIntersector.results.min.getIntersectionPoint(i)?i:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const r=e.eye;ha(this.renderPointOfView,r)||this._set("renderPointOfView",re(this._propertiesPool.get("renderPointOfView"),r))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(r=>r.hide()),void this._handles.remove("debug");for(const r of this._pois)this._handles.add(ae(()=>r.renderLocation,i=>this._debugCenters.get(r)?.show(i,r.renderCoordsHelper.spatialReference),Pr),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};u([d({readOnly:!0})],xl.prototype,"centerOnContent",void 0),u([d({readOnly:!0})],xl.prototype,"centerOnSurfaceFrequent",void 0),u([d({readOnly:!0})],xl.prototype,"centerOnSurfaceInfrequent",void 0),u([d({readOnly:!0})],xl.prototype,"cameraOnSurface",void 0),u([d({readOnly:!0})],xl.prototype,"focus",void 0),u([d({readOnly:!0})],xl.prototype,"renderPointOfView",void 0),u([d({readOnly:!0})],xl.prototype,"surfaceOrigin",void 0),u([d({readOnly:!0})],xl.prototype,"contentGeometryUpdates",void 0),u([d({readOnly:!0})],xl.prototype,"surfaceGeometryUpdates",void 0),u([d({constructOnly:!0})],xl.prototype,"view",void 0),u([d({readOnly:!0})],xl.prototype,"updating",null),xl=u([P("esri.views.3d.support.PointsOfInterest")],xl);const Gyt=Array,bT=O(),jyt=Jn(),Hyt={exclude:new Set([y_])};let qyt=class{constructor(e){this._store=e}destroy(){this._store.destroy()}get(e){return this._store.get(e)}put(e,r){this._store.put(e,r,r.values.byteLength+256)}},Wyt=class{constructor(e,r,i,s){this._hasNoDataValues=null,this._minValue=null,this._maxValue=null,"pixelData"in e?(this.values=e.pixelData,this.width=e.width,this.height=e.height,this.noDataValue=e.noDataValue):(this.values=e,this.width=r,this.height=i,this.noDataValue=s)}get hasNoDataValues(){if(this._hasNoDataValues==null){const e=this.noDataValue;this._hasNoDataValues=this.values.includes(e)}return this._hasNoDataValues}get minValue(){return this._ensureBounds(),this._minValue}get maxValue(){return this._ensureBounds(),this._maxValue}_ensureBounds(){if(this._minValue!=null)return;const{noDataValue:e,values:r}=this;let i=1/0,s=-1/0,n=!0;for(const o of r)o===e?this._hasNoDataValues=!0:(i=o<i?o:i,s=o>s?o:s,n=!1);n?(this._minValue=0,this._maxValue=0):(this._minValue=i,this._maxValue=s>-3e38?s:0)}},wOe=class{constructor(e,r,i,s,n={}){this._mainMethod=r,this._transferLists=i,this._listeners=[],this._promise=ave(e,{...n,schedule:s}).then(o=>{if(this._thread===void 0){this._thread=o,this._promise=null,n.hasInitialize&&this.broadcast({},"initialize");for(const a of this._listeners)this._connectListener(a)}else o.close()}),this._promise.catch(o=>Q.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${e} worker: ${o}`))}on(e,r){const i={removed:!1,eventName:e,callback:r,threadHandle:null};return this._listeners.push(i),this._connectListener(i),el(()=>{i.removed=!0,rX(this._listeners,i),this._thread&&i.threadHandle!=null&&i.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null,this._listeners.length=0,this._transferLists={}}invoke(e,r){return this.invokeMethod(this._mainMethod,e,r)}invokeMethod(e,r,i){if(this._thread){const s=this._transferLists[e],n=s?s(r):[];return this._thread.invoke(e,r,{transferList:n,signal:i})}return this._promise?this._promise.then(()=>(Yt(i),this.invokeMethod(e,r,i))):Promise.reject(null)}broadcast(e,r){return this._thread?Promise.all(this._thread.broadcast(r,e)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(e,r)):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then(r=>{e.removed||(e.threadHandle=r)})}},Kce=class extends wOe{constructor(e=null){super("LercWorker","_decode",{_decode:r=>[r.buffer]},e,{strategy:"dedicated"}),this.schedule=e,this.ref=0}decode(e,r,i){return e&&e.byteLength!==0?this.invoke({buffer:e,options:r},i):Promise.resolve(null)}release(){--this.ref<=0&&(nR.forEach((e,r)=>{e===this&&nR.delete(r)}),this.destroy())}};const nR=new Map;function Xyt(t=null){let e=nR.get(t);return e||(t!=null?(e=new Kce(r=>t.immediate.schedule(r)),nR.set(t,e)):(e=new Kce,nR.set(null,e))),++e.ref,e}var fc,eue,tue;(function(t){t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(fc||(fc={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.OUTLINE=2]="OUTLINE",t[t.LINE=3]="LINE",t[t.ICON=4]="ICON",t[t.CIRCLE=5]="CIRCLE",t[t.TEXT=6]="TEXT",t[t.TILEINFO=7]="TILEINFO"}(eue||(eue={})),function(t){t[t.PAINTER_CHANGED=0]="PAINTER_CHANGED",t[t.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",t[t.LAYER_CHANGED=2]="LAYER_CHANGED",t[t.LAYER_REMOVED=3]="LAYER_REMOVED",t[t.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(tue||(tue={}));let Zyt=class{constructor(e){this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}},IBt=class{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}};function LBt(t,e,r,i,s,n){const o=r-s;if(o>=0)return(e>>o)+(i-(n<<o))*(t>>o);const a=-o;return e-(n-(i<<a))*(t>>a)<<a}let DBt=class{constructor(e,r,i){this._rows=Math.ceil(r/i),this._columns=Math.ceil(e/i),this._cellSize=i,this.cells=new Array(this._rows);for(let s=0;s<this._rows;s++){this.cells[s]=new Array(this._columns);for(let n=0;n<this._columns;n++)this.cells[s][n]=[]}}getCell(e,r){const i=Math.min(Math.max(Math.floor(r/this._cellSize),0),this._rows-1),s=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[i]&&this.cells[i][s]||null}getCellSpan(e,r,i,s){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}};function Yyt(t,e,r,i,s,n){const o=e[i++];for(let a=0;a<o;a++){const l=new Zyt(n);l.xTile=e[i++],l.yTile=e[i++],l.hash=e[i++],l.priority=e[i++];const c=e[i++];for(let f=0;f<c;f++){const m=e[i++],y=e[i++],_=e[i++],v=e[i++],b=!!e[i++],T=e[i++],x=r[i++],S=r[i++],E=e[i++],A=e[i++];l.colliders.push({xTile:m,yTile:y,dxPixels:_,dyPixels:v,hard:b,partIndex:T,width:E,height:A,minLod:x,maxLod:S})}const h=t[i++];for(let f=0;f<h;f++)l.textVertexRanges.push([t[i++],t[i++]]);const p=t[i++];for(let f=0;f<p;f++)l.iconVertexRanges.push([t[i++],t[i++]]);s.push(l)}return i}function FBt(t,e,r){for(const[i,s]of t.symbols)Jyt(t,e,r,s,i)}function Jyt(t,e,r,i,s){const n=t.layerData.get(s);if(n.type===fc.SYMBOL){for(const o of i){const a=o.unique;let l;if(o.selectedForRendering){const c=a.parts[0],h=c.startOpacity,p=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&p===0;const f=r?Math.floor(127*h)|p<<7:p?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.iconVertexRanges)for(let p=c;p<c+h;p+=4)n.iconOpacity[p/4]=l;if(o.selectedForRendering){const c=a.parts[1],h=c.startOpacity,p=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&p===0;const f=r?Math.floor(127*h)|p<<7:p?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.textVertexRanges)for(let p=c;p<c+h;p+=4)n.textOpacity[p/4]=l}n.lastOpacityUpdate=e,n.opacityChanged=!0}}let KU=class{constructor(e,r){this.layerUIDs=[],this.isDestroyed=!1,this._data=e;let i=1;const s=new Uint32Array(e);this.layerUIDs=[];const n=s[i++];for(let o=0;o<n;o++)this.layerUIDs[o]=s[i++];this.bufferDataOffset=i,r&&(this.layer=r.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return this._data==null}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}prepareForRendering(e){this._data!=null&&(this.doPrepareForRendering(e,this._data,this.bufferDataOffset),this._data=null)}},Qyt=class extends KU{constructor(e,r){super(e,r),this.type=fc.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const i=new Uint32Array(e);let s=this.bufferDataOffset;this.lineIndexStart=i[s++],this.lineIndexCount=i[s++];const n=i[s++];if(n>0){this.patternMap=new Map;for(let o=0;o<n;o++){const a=i[s++],l=i[s++],c=i[s++];this.patternMap.set(a,[l,c])}}this.bufferDataOffset=s}get memoryUsed(){return(this.data?.byteLength??0)+(this.vao?.memoryEstimate??0)}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.vao=Ve(this.vao)}doPrepareForRendering(e,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++],a=Ur.createVertex(e,Cr.STATIC_DRAW,new Int32Array(n.buffer,4*i,o));i+=o;const l=s[i++],c=Ur.createIndex(e,Cr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,l));i+=l;const h=this.layer.lineMaterial;this.vao=new jh(e,h.getAttributeLocations(),h.getLayoutInfo(),{geometry:a},c)}},Kyt=class extends KU{constructor(e,r){super(e,r),this.type=fc.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const i=new Uint32Array(e);let s=this.bufferDataOffset;this.fillIndexStart=i[s++],this.fillIndexCount=i[s++],this.outlineIndexStart=i[s++],this.outlineIndexCount=i[s++];const n=i[s++];if(n>0){this.patternMap=new Map;for(let o=0;o<n;o++){const a=i[s++],l=i[s++],c=i[s++];this.patternMap.set(a,[l,c])}}this.bufferDataOffset=s}get memoryUsed(){return(this.data?.byteLength??0)+(this.fillVAO?.memoryEstimate??0)+(this.outlineVAO?.memoryEstimate??0)}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVAO=Ve(this.fillVAO),this.outlineVAO=Ve(this.outlineVAO)}doPrepareForRendering(e,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++],a=Ur.createVertex(e,Cr.STATIC_DRAW,new Int32Array(n.buffer,4*i,o));i+=o;const l=s[i++],c=Ur.createIndex(e,Cr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,l));i+=l;const h=s[i++],p=Ur.createVertex(e,Cr.STATIC_DRAW,new Int32Array(n.buffer,4*i,h));i+=h;const f=s[i++],m=Ur.createIndex(e,Cr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,f));i+=f;const y=this.layer,_=y.fillMaterial,v=y.outlineMaterial;this.fillVAO=new jh(e,_.getAttributeLocations(),_.getLayoutInfo(),{geometry:a},c),this.outlineVAO=new jh(e,v.getAttributeLocations(),v.getLayoutInfo(),{geometry:p},m)}},e0t=class extends KU{constructor(e,r,i){super(e,r),this.type=fc.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const s=new Uint32Array(e),n=new Int32Array(e),o=new Float32Array(e);let a=this.bufferDataOffset;this.isIconSDF=!!s[a++];const l=s[a++];for(let f=0;f<l;f++){const m=s[a++],y=s[a++],_=s[a++];this.iconPerPageElementsMap.set(m,[y,_])}const c=s[a++];for(let f=0;f<c;f++){const m=s[a++],y=s[a++],_=s[a++];this.glyphPerPageElementsMap.set(m,[y,_])}const h=s[a++],p=s[a++];this.iconOpacity=new Int32Array(h),this.textOpacity=new Int32Array(p),a=Yyt(s,n,o,a,this.symbols,i),this.bufferDataOffset=a}get memoryUsed(){return(this.data?.byteLength??0)+(this.iconVAO?.memoryEstimate??0)+(this.textVAO?.memoryEstimate??0)+S_(this.iconOpacity)+S_(this.textOpacity)}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let e=0;for(const[r,i]of this.iconPerPageElementsMap)e+=i[1];for(const[r,i]of this.glyphPerPageElementsMap)e+=i[1];return e/3}doDestroy(){this.iconVAO=Ve(this.iconVAO),this.textVAO=Ve(this.textVAO)}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const e=this.iconOpacity,r=this.iconVAO.vertexBuffers.opacity;e.length>0&&e.byteLength===r.byteLength&&r.setSubData(e,0,0,e.length);const i=this.textOpacity,s=this.textVAO.vertexBuffers.opacity;i.length>0&&i.byteLength===s.byteLength&&s.setSubData(i,0,0,i.length)}doPrepareForRendering(e,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++],a=Ur.createVertex(e,Cr.STATIC_DRAW,new Int32Array(n.buffer,4*i,o));i+=o;const l=s[i++],c=Ur.createIndex(e,Cr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,l));i+=l;const h=s[i++],p=Ur.createVertex(e,Cr.STATIC_DRAW,new Int32Array(n.buffer,4*i,h));i+=h;const f=s[i++],m=Ur.createIndex(e,Cr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,f));i+=f;const y=Ur.createVertex(e,Cr.STATIC_DRAW,this.iconOpacity.buffer),_=Ur.createVertex(e,Cr.STATIC_DRAW,this.textOpacity.buffer),v=this.layer,b=v.iconMaterial,T=v.textMaterial;this.iconVAO=new jh(e,b.getAttributeLocations(),b.getLayoutInfo(),{geometry:a,opacity:y},c),this.textVAO=new jh(e,T.getAttributeLocations(),T.getLayoutInfo(),{geometry:p,opacity:_},m)}},t0t=class extends KU{constructor(e,r){super(e,r),this.type=fc.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const i=new Uint32Array(e);let s=this.bufferDataOffset;this.circleIndexStart=i[s++],this.circleIndexCount=i[s++],this.bufferDataOffset=s}get memoryUsed(){return(this.data?.byteLength??0)+(this.vao?.memoryEstimate??0)}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.vao=Ve(this.vao)}doPrepareForRendering(e,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++],a=Ur.createVertex(e,Cr.STATIC_DRAW,new Int32Array(n.buffer,4*i,o));i+=o;const l=s[i++],c=Ur.createIndex(e,Cr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,l));i+=l;const h=this.layer.circleMaterial;this.vao=new jh(e,h.getAttributeLocations(),h.getLayoutInfo(),{geometry:a},c)}};const GBt=!0,jBt=32,rue=200,r0t=1/oe("mapview-transitions-duration");let i0t=class extends ws{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}get stage(){return this._stage}set stage(e){if(this._stage===e)return;const r=this._stage;this._stage=e,e?this._stage?.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):r?.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return this._transforms==null&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.requestRender())}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.opacity=1,this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=xo(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=xo(),this.requestRender()),this._fadeOutResolver.promise}endTransitions(){this._fadeInResolver?.(),this._fadeInResolver=null,this._fadeOutResolver?.(),this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0,this.requestRender()}beforeRender(e){this.updateTransitionProperties(e.deltaTime,e.state.scale)}afterRender(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){this.parent?.removeChild(this)}setTransform(e){}processRender(e){this.stage&&this.computedVisible&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(e,r){if(this.fadeTransitionEnabled){const i=this._fadeOutResolver||!this.visible?0:this.opacity,s=this.computedOpacity;if(s===i)this.computedVisible=this.visible;else{const n=e*r0t;this.computedOpacity=s>i?Math.max(i,s-n):Math.min(i,s+n),this.computedVisible=this.computedOpacity>0;const o=i===this.computedOpacity;this.inFadeTransition=!o,o||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}},nW=class fb{static getId(e,r,i,s){return typeof e=="object"?`${e.level}/${e.row}/${e.col}/${e.world}`:`${e}/${r}/${i}/${s}`}constructor(e,r,i,s){this.set(e,r,i,s)}get key(){return this}get id(){return this.toString()}set id(e){this.set(e)}get hash(){const e=4095&this.row,r=4095&this.col,i=63&this.level;return(3&this.world)<<30|r<<22|e<<8|i}acquire(e,r,i,s){this.set(e,r,i,s)}contains(e){const r=e.level-this.level;return r>=0&&this.row===e.row>>r&&this.col===e.col>>r&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new fb(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,r,i,s){if(e==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof e=="object")this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if(typeof e=="string"){const[n,o,a,l]=e.split("/");this.level=parseFloat(n),this.row=parseFloat(o),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+e,this.row=+r,this.col=+i,this.world=+s||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new fb(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const e=this.level+1,r=this.row<<1,i=this.col<<1,s=this.world;return[new fb(e,r,i,s),new fb(e,r,i+1,s),new fb(e,r+1,i,s),new fb(e,r+1,i+1,s)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}};nW.pool=new Go(nW,null,null,25,50);let s0t=class extends i0t{constructor(e,r,i,s,n,o,a=n,l=o){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new nW(e),this.resolution=r,this.x=i,this.y=s,this.width=n,this.height=o,this.rangeX=a,this.rangeY=l}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(e){const r=this.resolution/(e.resolution*e.pixelRatio),i=this.transforms.tileMat3,[s,n]=e.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*r,a=this.height/this.rangeY*r;OY(i,o,0,0,0,a,0,s,n,1),nE(this.transforms.dvs,e.displayViewMat3,i)}},Sz=class xOe extends s0t{constructor(e,r,i,s,n,o,a,l=null){super(e,r,i,s,n,o,4096,4096),this.styleRepository=a,this._memCache=l,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.layerCount=0,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.invalidating=!1,this.parentTile=null,this.childrenTiles=new Set,this._processed=!1,this._referenced=1,this.id=e.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<rue}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<rue)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}deleteLayerData(e){let r=!1;for(const i of e)if(this.layerData.has(i)){const s=this.layerData.get(i);this._memoryUsedByLayerData-=s.memoryUsed,s.type===fc.SYMBOL&&this.symbols.has(i)&&(this.symbols.delete(i),r=!0),s.destroy(),this.layerData.delete(i),this.layerCount--}this._memCache?.updateSize(this.key.id,this,this._memoryUsedByLayerData),r&&this.emit("symbols-changed"),this.requestRender()}processed(){return this._processed}hasData(){return this.layerCount>0}dispose(){this.status!=="unloaded"&&(TOe.delete(this),xOe._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsed(){return this._memoryUsedByLayerData+256}changeDataImpl(e){let r=!1;if(e){const{bucketsWithData:i,emptyBuckets:s}=e,n=this._createRenderBuckets(i);if(s&&s.byteLength>0){const o=new Uint32Array(s);for(const a of o)this._deleteLayerData(a)}for(const[o,a]of n)this._deleteLayerData(o),a.type===fc.SYMBOL&&(this.symbols.set(o,a.symbols),r=!0),this._memoryUsedByLayerData+=a.memoryUsed,this.layerData.set(o,a),this.layerCount++;this._memCache?.updateSize(this.key.id,this,this.memoryUsed)}this._hasSymbolBuckets=!1;for(const[i,s]of this.layerData)s.type===fc.SYMBOL&&(this._hasSymbolBuckets=!0);r&&this.emit("symbols-changed")}attachWithContext(e){this.stage={context:e,trashDisplayObject(r){r.processDetach()},untrashDisplayObject:()=>!1}}setTransform(e){super.setTransform(e);const r=this.resolution/(e.resolution*e.pixelRatio),i=this.width/this.rangeX*r,s=this.height/this.rangeY*r,n=[0,0];e.toScreen(n,[this.x,this.y]);const o=this.transforms.tileUnitsToPixels;RY(o),B4(o,o,n),MY(o,o,Math.PI*e.rotation/180),PY(o,o,[i,s,1])}_createTransforms(){return{dvs:$l(),tileMat3:$l(),tileUnitsToPixels:$l()}}static _destroyRenderBuckets(e){if(!e)return;const r=new Set;e.forEach(i=>{r.has(i)||(i.destroy(),r.add(i))}),e.clear()}_createRenderBuckets(e){const r=new Map,i=new Map;for(const s of e){const n=this._deserializeBucket(s,i);for(const o of n.layerUIDs)r.set(o,n)}return r}_deserializeBucket(e,r){let i=r.get(e);if(i)return i;switch(new Uint32Array(e)[0]){case fc.FILL:i=new Kyt(e,this.styleRepository);break;case fc.LINE:i=new Qyt(e,this.styleRepository);break;case fc.SYMBOL:i=new e0t(e,this.styleRepository,this);break;case fc.CIRCLE:i=new t0t(e,this.styleRepository)}return r.set(e,i),i}_deleteLayerData(e){if(!this.layerData.has(e))return;const r=this.layerData.get(e);this._memoryUsedByLayerData-=r.memoryUsed,r.destroy(),this.layerData.delete(e),this.layerCount--}};const TOe=new Map;function n0t(){TOe.forEach((t,e)=>{console.log(`
${e.key}:`),t[0].forEach(r=>console.log(r)),console.log("========"),t[1].forEach(r=>console.log(r))})}const WBt={value:.5,readOnly:!0},o0t={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};let QS=class{constructor(e=0,r=0){this.min=e,this.max=r,this.level=0,this.hasNoDataValues=!1}copyFrom(e){this.min=e.min,this.max=e.max,this.level=e.level,this.hasNoDataValues=e.hasNoDataValues}},a0t=class{constructor(e,r){this.data=e,this.safeWidth=.99999999*(e.width-1),this.dx=(e.width-1)/(r[2]-r[0]),this.dy=(e.width-1)/(r[3]-r[1]),this.x0=r[0],this.y1=r[3]}},l0t=class{constructor(e,r,i){this.type="elevation",this.level=e[0],this.i=e[1],this.j=e[2],this.extent=r,this.samplerData=new a0t(i,r)}computeMinMaxValue(e,r,i,s){s.min=1/0,s.max=-1/0,s.hasNoDataValues=!1;const n=e-this.level;if(n<=0)return s;const o=2**n;if(!(Math.floor(r/o)===this.i&&Math.floor(i/o)===this.j))return s;let a=1/0,l=-1/0;const c=this.samplerData.data.width,h=this.samplerData.data.values,p=.5*NR;let f=(c-1)/o,m=(i-this.j*o)*f,y=(r-this.i*o)*f;if(f<1){const _=Math.floor(m),v=Math.floor(y),b=_+v*c,T=h[b],x=h[b+1],S=h[b+c],E=h[b+c+1];if(T+x+S+E<p){const A=m-_,R=y-v,M=mI(T,x,S,E,A,R),D=mI(T,x,S,E,A+f,R),k=mI(T,x,S,E,A,R+f),$=mI(T,x,S,E,A+f,R+f);return s.min=Math.min(M,D,k,$),s.max=Math.max(M,D,k,$),s}m=_,y=v,f=1}else m=Math.floor(m),y=Math.floor(y),f=Math.ceil(f);for(let _=m;_<=m+f;_++)for(let v=y;v<=y+f;v++){const b=h[_+v*c];b<p?(a=Math.min(a,b),l=Math.max(l,b)):s.hasNoDataValues=!0}return s.min=a,s.max=l,s}};const c0t=.5*NR;function Yi(t,e,r){if(r==null)return null;for(const i of r){if(!i)continue;const s=i.safeWidth;let n=ve(i.dy*(i.y1-e),0,s),o=ve(i.dx*(t-i.x0),0,s);const a=Math.floor(n),l=Math.floor(o),c=i.data.width,h=a*c+l,p=i.data.values,f=p[h],m=p[h+1],y=h+c,_=p[y],v=p[y+1];if(f+_+m+v<c0t){n-=a,o-=l;const b=f+(m-f)*o;return b+(_+(v-_)*o-b)*n}}return null}let lh=class extends we{constructor(e){super(e)}initialize(){this.addHandles([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(r=>{const i=r.layer;if(i.operationalLayerType==="IntegratedMeshLayer"&&this.viewSpatialReference!=null){const s=SOe(i.fullExtent,this.viewSpatialReference);s!=null&&e.push(Dge(s))}}),e}};function u0t(t,e){return t===Ue.Global?new oW(e):new aW(e)}u([d({readOnly:!0})],lh.prototype,"layerViewsExtent",null),u([d({readOnly:!0})],lh.prototype,"tiledLayersExtent",null),u([d({readOnly:!0})],lh.prototype,"stencilEnabledExtents",null),u([d()],lh.prototype,"viewSpatialReference",void 0),u([d()],lh.prototype,"tilingScheme",void 0),u([d()],lh.prototype,"defaultTiledLayersExtent",void 0),u([d({constructOnly:!0})],lh.prototype,"layers",void 0),u([d({constructOnly:!0})],lh.prototype,"layerViews",void 0),lh=u([P("esri.views.3d.terrain.ExtentHelper")],lh);let oW=class extends lh{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?dxe:KXe}};oW=u([P("esri.views.3d.terrain.ExtentHelperGlobal")],oW);let aW=class extends lh{_computeLayerViewsExtent(){const e=Ic(),r=this.viewSpatialReference;this.layerViews.forEach(n=>{const o=n.layer;if(n.isResolved()&&(o.type!=="graphics"||!o.internal)){const a=SOe("fullExtentInLocalViewSpatialReference"in n&&n.fullExtentInLocalViewSpatialReference||n.layer.fullExtent,r);V_(e,a,e)}});const i=cB(e)?e:null,s=this._get("layerViewsExtent");return Jb(i,s)?s:i}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const r=this.viewSpatialReference,i=Ic();this.layers.forEach(o=>{if(o.loaded&&bO(o)){const a=QU(o,r,Ue.Local);if(a==null)return;const{tileInfo:l,fullExtent:c}=a;l!=null&&c!=null&&(WF(o)||e.compatibleWith(l)&&c.spatialReference.equals(e.spatialReference))&&V_(i,c,i)}}),V_(i,this.defaultTiledLayersExtent,i);const s=cB(i)?i:null,n=this._get("tiledLayersExtent");return Jb(s,n)?n:s}};function SOe(t,e){return t==null||t.spatialReference.equals(e)?t:_Y(t,t.spatialReference,e)}aW=u([P("esri.views.3d.terrain.ExtentHelperLocal")],aW);var rr;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.MAP=1]="MAP"})(rr||(rr={}));const mb=[rr.ELEVATION,rr.MAP];function EOe(){const t=globalThis.require?.modules;if(t){const e=Object.keys(t);for(const r of e)r.search(".glsl")!==-1&&delete t[r]}}const h0t=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let _0,ka=class extends we{get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||ai.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return this._spatialReference!=null&&this._spatialReference.isGeographic&&!this.view.state.isLocal?zr(this._spatialReference).metersPerDegree:1}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get hasHighlights(){return this.renderer.hasHighlights}get rendersOccluded(){return this.renderer.rendersOccluded}constructor(e){super(e),this._handles=new Ii,this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._hasUnusedRenderTargets=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=oe("esri-mobile")?2048:4096,this._animationTimeLast=0,this._removeRenderOverlayCallback=()=>{}}initialize(){const e=this.view;this.renderer=new gf({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference});const r=()=>this.setDrawTexturesDirty();this._groundIntersector=qh(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this._handles.add([this.renderer.events.on("has-highlights",()=>{r(),this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",s=>e._stage?.renderer.setParameters({hasOverlayWater:s})),this.renderer.events.on("renders-occluded",()=>{r(),this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",r),ae(()=>e.state.camera.pixelRatio,r),ae(()=>e.state.alignPixelEnabled,r),this.renderer.events.on("textures-disposed",()=>this.updateOverlayResult()),ae(()=>[e.pointsOfInterest?.renderPointOfView,e.pointsOfInterest?.centerOnSurfaceFrequent?.location],()=>this.setPlacementDirty()),ae(()=>[e.state?.pixelRatio,e.state?.contentPixelRatio],()=>this.setPlacementDirty(),qr),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),e.resourceController.scheduler.registerTask(vt.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",s=>{this._updateOverlays(Ja,s.camera,gs.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays,gs.BACKGROUND,s)})]);let i=s=>this._renderOverlayCallback(s);this._removeRenderOverlayCallback=()=>{i=()=>{}},e._stage?.renderer.setParameters({renderOverlay:s=>i(s)})}_renderOverlayCallback(e){this._contentUpdated=!1;const r=this.renderer;r.processSyncDrapeSources(),r.hasOverlays&&(this._dispatchAnimationUpdate(e),this._drawOverlayTextures(r.overlays,gs.UPDATE,this.view.state)),this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}destroy(){this._handles=$e(this._handles),this._removeRenderOverlayCallback(),this.view?._stage?.renderer.setParameters({renderOverlay:()=>{}}),_0!=null&&(_0.hide(),_0=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const r=this.view.renderSpatialReference;e!=null&&r!=null?(this._renderSR=r,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new iv(-20037508342787e-6,20037508342787e-6):new iv(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}get gpuMemoryUsage(){return this.renderer.gpuMemoryUsage}registerDrapeSource(e,r,i){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const s=this.renderer.createDrapeSourceRenderer(e,r,i);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),s}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,eu)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&e.setDrapingExtent!=null&&this._spatialReference!=null&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}updateOverlayResult(){this.view._stage?.renderer.setParameters({overlays:this.renderer.overlays})}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(e){return this._updateOverlays(e,this.view.state.contentCamera,gs.UPDATE)}_updateOverlays(e,r,i){if(!this._spatialReference)return Wo.YIELD;const s=this._computeOverlayResolution(r);this._computeOverlayExtents(r,s,Hm);const n=pu(Hm.inner)/pu(Hm.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const o=this._updateOverlay(Li.INNER,Hm.inner,s,1*Hm.pixelRatioAdjustment,Hm.mapUnitsPerPixel),a=this._updateOverlay(Li.OUTER,Hm.outer,s,n*Hm.pixelRatioAdjustment,Hm.mapUnitsPerPixel);o!==Cf.EXTENT&&a!==Cf.EXTENT||(this._drapeSources.forEach(l=>this._updateDrapeSourceExtent(l)),this.surface.updateTileOverlayParams(i)),o===Cf.NONE&&a===Cf.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1,e.madeProgress()}_computeOverlayResolution(e){const r=this.view.state.contentPixelRatio,i=e.fullWidth/e.pixelRatio*r,s=e.fullHeight/e.pixelRatio*r,n=Math.ceil(1.5*Math.max(i,s));return Math.min(NQ(n),this._maxResolution)}_updateOverlay(e,r,i,s,n){if(this.renderer.overlays.length===0)return Cf.NONE;const o=this.renderer.overlays[e],a=o.mapUnitsPerPixel;if(o.mapUnitsPerPixel=n,o.pixelRatio=s,d0t(r,o.extent)&&i===o.resolution)return a===n?Cf.NONE:Cf.RERENDER_ONLY;oy(o.extent,r),o.resolution=i;const l=iZ(o.extent);return o.renderLocalOrigin=AF(l[0],l[1],0,"OV_"+this._latestOriginId++),Cf.EXTENT}setTileParameters(e){const r=e.renderData.overlay;if(this.renderer.overlays.length>0){const i=this.renderer.overlays[Li.INNER],s=this.renderer.overlays[Li.OUTER],n=e.extent;this._rectInsideRect(i.extent,n)||this._rectanglesOverlap(n,i.extent)||this._rectanglesOverlap(n,s.extent)?(this._setTileOverlayData(n,Li.INNER,r),this._setTileOverlayData(n,Li.OUTER,r)):(this._clearTileOverlayData(Li.INNER,r),this._clearTileOverlayData(Li.OUTER,r))}else this._clearTileOverlayData(Li.INNER,r),this._clearTileOverlayData(Li.OUTER,r)}overlayPixelSizeInMapUnits(e){if(this.renderer.overlays.length===0)return 0;const r=this.renderer.overlays[Li.INNER],i=this.renderer.overlays[Li.OUTER],s=this._pointIsInExtent(e,r.extent)?r:i;return(s.extent[2]-s.extent[0])/s.resolution}_setTileOverlayData(e,r,i){if(this.renderer.overlays.length===0)return;const s=this.renderer.overlays[r].extent,n=pu(s),o=wp(s);let a=e[0];if(this._longitudeCyclical){a=this._longitudeCyclical.minimalMonotonic(s[0],a);const l=this._longitudeCyclical.minimalMonotonic(s[0],e[2]);a>l&&(a=l-(e[2]-e[0]))}i.setScale(r,pu(e)/n,wp(e)/o),i.setOffset(r,(a-s[0])/n,(e[1]-s[1])/o)}_clearTileOverlayData(e,r){r.setScale(e,-1,-1),r.setOffset(e,-1,-1)}async reloadShaders(){EOe(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask(Ja)}_dispatchAnimationUpdate(e){const r=e-this._animationTimeLast;if(r>=this.surface.view._stage.renderer.animationTimestep||this.view.state.forcedAnimationTime!=null||this._drawTexturesDirty||this._drawTexturesAnimateDirty){const i=r/this.surface.view._stage.renderer.animationTimeDilation,s=new Z2e(this.view.state.camera,i,this.view.state.forcedAnimationTime);this.renderer.updateAnimation(s)&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e}}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0,this.view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(e,r,i,s){const n=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,m0t,r,i);if(n==null)return!1;const o=n.origin,a=ue(cL,n.origin,n.direction);return this._groundIntersector.reset(o,a,e),this._groundIntersector.intersect([]),this.view.basemapTerrain.intersect(this._groundIntersector,null,o,a),this._groundIntersector.results.min.getIntersectionPoint(s)}_findHorizonBasedPointOfInterest(e,r){let i=.5;const s=.55,n=this.view.renderCoordsHelper.getAltitude(e.eye),o=this.view.pointsOfInterest.centerOnSurfaceFrequent,a=1e-5,l=ve(o.estimatedSurfaceAltitude,e.aboveGround?-1/0:n+a,e.aboveGround?n-a:1/0),c=e.aboveGround;if(this.view.viewingMode==="global"){const h=cL;aC(V6(B6,zr(this.view.spatialReference).radius+l),Ou(e.eye,e.viewForward),h),de(h,h,e.eye);const p=sv.normalize(Zbe(e.viewForward,h,e.viewRight))/e.fovY+.5,f=p<=0||p>=1?.5:s;i=c?f*p:p+f*(1-p)}else{const h=.5*Math.PI-Math.acos(-e.viewForward[2]),p=Math.tan(h),f=Nt(0,p,1,0),m=mu(f,f,e.projectionMatrix)[1],y=ve(.5+.5*m,0,1);i=y===1||y===0?.5:c?y*s:1-(1-y)*s}return!!this._intersectGroundFromView(e,.5,i,r)&&X5(r,e.eye)<o.distance*o.distance}_computeOverlayExtents(e,r,i){const s=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,n=O();this._findHorizonBasedPointOfInterest(e,n)||re(n,s),ai.OVERLAY_SHOW_CENTER?(_0==null&&(_0=new TS(this.view.graphics,"red")),_0.show(n,this._renderSR)):_0?.hide();const o=Math.max(.1,fi(e.eye,n)),a=uv(this.view.renderCoordsHelper,s,e.eye);this._overlaySREqualsRenderSR||Zs(n,this._renderSR,n,this._spatialReference);const l=this.surface.extent,c=!this._isSpherical&&this._spatialReference!=null&&this._spatialReference.isGeographic,h=c&&this._spatialReference!=null?1/zr(this._spatialReference).metersPerDegree:1,p=this.view.state.contentPixelRatio,f=e.perScreenPixelRatio/p*o*h;i.mapUnitsPerPixel=f/this._worldToPCSRatio;let m=r*f/2*nQ,y=!1,_=c?90:1/0;this._isSpherical&&l!=null&&this._spatialReference!=null&&(this._spatialReference.isWebMercator?(m/=Math.cos(u4(n[1])),_=l[3]):(y=!0,m/=zr(this._spatialReference).metersPerDegree,_=90),m>=_&&(m=_,n[1]=0,this._spatialReference.isWebMercator&&(n[0]=0)));let v=1;y&&(v=1/Math.max(.2,Math.cos(Math.abs(Ft(n[1])))),m*v>180&&(v=180/m),i.mapUnitsPerPixel*=v);const b=Math.log(2)/12;m=Math.exp(Math.round(Math.log(m)/b)*b);const T=m*v,x=32,S=.5*r/(x*T),E=.5*r/(x*m);n[0]=Math.round(n[0]*S)/S,n[1]=Math.round(n[1]*E)/E;const A=i.inner;A[0]=n[0]-T,A[1]=n[1]-m,A[2]=n[0]+T,A[3]=n[1]+m,this._isSpherical&&this._shiftExtentToFitBounds(A,1/0,_);const R=i.outer;if(6*T>pu(l))oy(R,l);else if(Math.PI/2-Math.abs(a-Math.PI/2)<=.25*Math.PI)R[0]=A[0]-T,R[1]=A[1]-m,R[2]=A[2]+T,R[3]=A[3]+m;else{Zs(e.eye,this._renderSR,cL,this._spatialReference),$f(m1,n,cL);let D=-Math.atan2(m1[1],m1[0])+.125*Math.PI;D<0&&(D+=2*Math.PI);const k=Math.floor(D/(.25*Math.PI));Tw(m1,h0t[k],2*m),m1[0]*=v,m1[2]*=v,JX(R,A,m1)}if(this._isSpherical)R[0]=this._longitudeCyclical.clamp(R[0]),R[2]=this._longitudeCyclical.clamp(R[2]),R[1]=Math.max(R[1],-_),R[3]=Math.min(R[3],_);else{const D=uB(A,l,p0t),k=uB(R,l,f0t);dte(D,k)&&(R[2]=R[0],R[3]=R[1])}const M=Math.abs(A[2]-A[0])/r;i.mapUnitsPerPixel=Math.max(i.mapUnitsPerPixel,M),i.pixelRatioAdjustment=i.mapUnitsPerPixel/M}_drawOverlayTextures(e,r,i){if(e.length===0||!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return;const s=this._drawTexturesDirty;this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1;const n=this._drawOverlay(e[Li.INNER],i),o=this._drawOverlay(e[Li.OUTER],i);n!==mE.CHANGED&&o!==mE.CHANGED||this.surface.updateTileOverlayParams(gs.UPDATE),this._collectUnusedRenderTargetMemory(),this.updateOverlayResult(),s?(this.surface.requestRender(r),r===gs.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(gs.BACKGROUND)}_drawOverlay(e,r){return this._longitudeCyclical?e.setupGeometryViewsCyclical(this._longitudeCyclical):e.setupGeometryViewsDirect(),e.draw(this.renderer,r)}_collectUnusedRenderTargetMemory(){this._hasUnusedRenderTargets=!1,this.renderer.hasOverlays&&(this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory())}_rectanglesOverlap(e,r){return e!=null&&(this._longitudeCyclical?(this._longitudeCyclical.contains(r[0],r[2],e[0])||this._longitudeCyclical.contains(r[0],r[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],r[0]))&&!(e[1]>r[3]||e[3]<r[1]):OM(e,r))}_rectInsideRect(e,r){return r!=null&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],r[0])&&this._longitudeCyclical.contains(e[0],e[2],r[2])&&r[1]>e[1]&&r[3]<e[3]:dte(e,r))}_pointIsInExtent(e,r){if(this._longitudeCyclical)return this._longitudeCyclical.contains(r[0],r[2],e.x)&&e.y>=r[1]&&e.y<=r[3];const i=e.x,s=e.y;return i>r[0]&&i<r[2]&&s>r[1]&&s<r[3]}_shiftExtentToFitBounds(e,r,i){let s=0,n=0;e[0]<-r?s=e[0]+r:e[2]>r&&(s=r-e[2]),e[1]<-i?n=e[1]+i:e[3]>i&&(n=i-e[3]),b4(e,s,n)}get test(){return{renderer:this.renderer,update:()=>this.runTask(Ja)}}};function d0t(t,e){const i=ai.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(t[2]-t[0],t[3]-t[1],e[2]-e[0],e[3]-e[1]);return Math.abs(e[0]-t[0])<=i&&Math.abs(e[1]-t[1])<=i&&Math.abs(e[2]-t[2])<=i&&Math.abs(e[3]-t[3])<=i}u([d()],ka.prototype,"_spatialReference",void 0),u([d({readOnly:!0})],ka.prototype,"running",null),u([d()],ka.prototype,"_placementDirty",void 0),u([d()],ka.prototype,"_contentUpdated",void 0),u([d()],ka.prototype,"_isSpherical",null),u([d()],ka.prototype,"_worldToPCSRatio",null),u([d({autoDestroy:!0})],ka.prototype,"renderer",void 0),u([d({constructOnly:!0})],ka.prototype,"view",void 0),u([d({constructOnly:!0})],ka.prototype,"surface",void 0),u([d()],ka.prototype,"suspended",null),u([d()],ka.prototype,"updating",null),u([d({type:Boolean})],ka.prototype,"hasHighlights",null),u([d({type:Boolean})],ka.prototype,"rendersOccluded",null),ka=u([P("esri.views.3d.terrain.OverlayManager")],ka);const m1=Xt(),cL=O(),Hm={inner:Vt(),outer:Vt(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},p0t=Vt(),f0t=Vt(),m0t=Jn();var Cf;(function(t){t[t.NONE=0]="NONE",t[t.EXTENT=1]="EXTENT",t[t.RERENDER_ONLY=2]="RERENDER_ONLY"})(Cf||(Cf={}));let COe=class lW{constructor(e,r){this._factoryCallback=e,this._lengthCallback=r,this._pool=new Map}acquire(e){if(!lW.test.disabled){const r=this._pool.get(e);if(r&&r.length!==0)return r.pop()}try{return this._factoryCallback(e)}catch(r){const i=window.performance&&window.performance.memory;let s="";throw i&&(s=`
  totalJSHeapSize: ${i.totalJSHeapSize}, usedJSHeapSize: ${i.usedJSHeapSize}, jsHeapSizeLimit: ${i.jsHeapSizeLimit}`),console.log("Array allocation of size "+e+" failed: "+r+s),r}}release(e){if(lW.test.disabled)return;const r=this._lengthCallback(e);let i=this._pool.get(r);i||(i=new Bt({shrink:!0}),this._pool.set(r,i)),i.push(e)}clear(){this._pool.clear()}get test(){return{size:this._pool.size}}};COe.test={disabled:!1};let g0t=class{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=Si(),this.indexCount=0,this.numVerticesPerSide=0,this.uvRange=[0,0,1,1],this.outerEdges=[null,null,null,null],this.innerEdges=[null,null,null,null]}},iue=class{constructor(e,r,i,s,n){this.attributes=e,this.localOrigin=r,this.index0=i,this.stride=s,this.count=n}getVertexIndex(e){return this.getAttributeIndex(e)}getAttributeIndex(e){return Te(0<=e&&e<this.count),this.index0+this.stride*e}_getVertexRaw(e,r){this.attributes.position.getVec(e,r)}getVertexPos(e,r){this._getVertexRaw(this.getAttributeIndex(r),e),ue(e,e,this.localOrigin)}getNormal(e,r){const{typedBuffer:i,typedBufferStride:s}=this.attributes.normalCompressed;Jct(e,i,this.getAttributeIndex(r),s)}_setNormal(e,r,i,s){const{typedBuffer:n,typedBufferStride:o}=this.attributes.normalCompressed;jw(n,e,r,i,s,o)}_setUV(e,r,i){yp(this.attributes.uv0,e,r,i)}setNormalFromValues(e,r,i,s){this._setNormal(this.getAttributeIndex(e),r,i,s)}setVertexFromValuesRawPositionUV(e,r,i,s,n,o){const a=this.getAttributeIndex(e);this.attributes.position.setValues(a,r,i,s),this._setUV(a,n,o)}setVertexFromValuesRawPositionUVNormal(e,r,i,s,n,o,a,l,c){const h=this.getAttributeIndex(e);this.attributes.position.setValues(h,r,i,s),this._setUV(h,n,o),this._setNormal(h,a,l,c)}};const y0t=Hi().vec3f(C.POSITION).vec2i16(C.UV0).vec2i16(C.NORMALCOMPRESSED,{glNormalized:!0}),pK=new COe(t=>y0t.createBuffer(t),t=>t.count);function _0t(){pK.clear()}function AOe(t){return pK.acquire(t)}function v0t(t){pK.release(t.vertexAttributes),t.vertexAttributes=null,t.indices=null}const sue=16384;function yp(t,e,r,i){t.setValues(e,r*sue,i*sue)}function Dh(t,e,r,i){t<i[0]?i[0]=t:t>i[3]&&(i[3]=t),e<i[1]?i[1]=e:e>i[4]&&(i[4]=e),r<i[2]?i[2]=r:r>i[5]&&(i[5]=r)}let b0t=class{constructor(){this.sinLonLUT=new Array(O3+1),this.cosLonLUT=new Array(O3+1),this.sinLatLUT=new Array(O3+1),this.cosLatLUT=new Array(O3+1)}update(e,r,i){const s=r[0],n=r[2];for(let o=0;o<=e;o++){const a=o/e,l=s*(1-a)+n*a;this.sinLonLUT[o]=Math.sin(l),this.cosLonLUT[o]=Math.cos(l);const c=i(a);this.sinLatLUT[o]=Math.sin(c),this.cosLatLUT[o]=Math.cos(c)}}},uL=class{constructor(){this.cornerTiles=[null,null,null,null],this.cornerTileSamplerVersions=[-1,-1,-1,-1]}},w0t=class{constructor(){this.cornerNeighborData=[new uL,new uL,new uL,new uL],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1],this.cornerPeerNeighbors=[null,null,null,null]}},x0t=class{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.clippingArea=null,this.wireframe=!1,this.samplerDataVersion=0,this.neighborData=new w0t}},OOe=class TN{constructor(e){this._getFadeDuration=e,this._fadeStart=0,this._delayedTime=0}clear(){this._current=$e(this._current),this._next=$e(this._next),this._waiting=$e(this._waiting),this._delayed=$e(this._delayed)}get current(){if(this._current==null)return null;if(!this._isFadingEnabled){const r=this._delayed||this._waiting||this._next||this._current;r!==this._current&&(this._current=null,this.clear(),this._current=r)}let e=TN.test.fadeMoment;if(this._delayed!=null&&(e=e||performance.now(),e>=this._delayedTime&&(this._push(this._delayed,Kg.Immediate),this._delayed=null)),this._next!=null){e=e||performance.now();const r=this._fadeDuration,i=this._current!=null&&this._next.texture===this._current.texture,s=this._next.type!==on.FADING,n=e-this._fadeStart>=r;(i||s||n)&&($e(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(e))}return this._current}get next(){return this._next}get fadeFactor(){if(this._next==null)return 1;const e=TN.test.fadeMoment||performance.now(),r=Math.max(0,e-this._fadeStart),i=this._fadeDuration;return r>i?0:1-r/i}get isFading(){return this._next!=null||this._delayed!=null}push(e,r=Kg.Immediate){this._delayed=$e(this._delayed),this._push(e,r)}_push(e,r){if(this._isFadingEnabled||this.clear(),this._current==null)return void(this._current=e);const i=TN.test.fadeMoment||performance.now();return r!==Kg.Immediate?(this._delayed=e,void(this._delayedTime=i+r)):this._next==null?(this._next=e,void(this._fadeStart=this._alignFadeStart(i))):void(e!=null&&($e(this._waiting),this._waiting=e))}get _fadeDuration(){return this._waiting==null?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(e){const r=this._getFadeDuration();return e+r-e%r}get _isFadingEnabled(){return this._getFadeDuration()>0}};var Kg;OOe.test={fadeMoment:0},function(t){t[t.Immediate=0]="Immediate",t[t.Delayed=5e3]="Delayed"}(Kg||(Kg={}));var PE;(function(t){t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT",t[t.NONE=0]="NONE",t[t.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(PE||(PE={}));let ROe=class{constructor(){this._queue=new Bt,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=void 0}reset(e=null){this._queue.clear(),e!=null&&this._queue.pushArray(e),this._last=void 0}skipSubtree(){this._last=void 0}next(){const e=this._last?.children;return e&&e[0]&&this._queue.pushArray(e),this._last=this._queue.pop(),this._last}},T0t=class{constructor(){this._q=new Bt}get done(){return this._q.length===0}reset(e){if(this._q.clear(),e!=null){this._q.pushArray(e);for(let r=0;r<this._q.length;++r){const i=this._q.data[r];i.isLeaf||this._q.pushArray(i.children)}}}next(){return this._q.pop()}};function oR(t,e,r){if(e==null||e.fullExtent==null)return!1;const i=e.fullExtent,s=t.extent;if(r){if(s[0]<i.xmin||s[1]<i.ymin||s[2]>i.xmax||s[3]>i.ymax)return!1}else if(i.xmin>s[2]||i.ymin>s[3]||i.xmax<s[0]||i.ymax<s[1])return!1;const n=t.surface.tilingScheme.levels[t.level].scale,o=e.minScale;if(o>0&&n>1.00000001*o)return!1;const a=e.maxScale;return!(a>0&&n<.99999999*a)}function ey(t,e){const r=t.lij,i=e.lij;return r[0]-i[0]||r[1]-i[1]||r[2]-i[2]}function MOe(t,e,r=null){r==null||r.length===0?t===PE.BACK_TO_FRONT?e.sort(S0t):e.sort(E0t):e.sort((i,s)=>C0t(i,s,t,r))}function S0t(t,e){const r=e.screenDepth-t.screenDepth;if(r!==0)return r;const i=t.lij,s=e.lij;return i[0]-s[0]||i[1]-s[1]||i[2]-s[2]}function E0t(t,e){const r=t.screenDepth-e.screenDepth;if(r!==0)return r;const i=t.lij,s=e.lij;return i[0]-s[0]||i[1]-s[1]||i[2]-s[2]}function POe(t,e,r){const i=t.screenDepth,s=e.screenDepth;return i<s?-r:i>s?r:ey(t,e)}function C0t(t,e,r,i){return nue(t,i)===nue(e,i)?POe(t,e,r):t?r:-r}function nue(t,e){for(const r of e)if(t.intersectsExtent(r))return!0;return!1}function A0t(t,e){const r=t.distanceToPOI-e.distanceToPOI;if(r!==0)return r;const i=t.lij,s=e.lij;return i[0]-s[0]||i[1]-s[1]||i[2]-s[2]}function O0t(t,e){const r=t.length;for(let i=0;i<r;++i)t.at(i).updateDistanceToPOI(e);t.sort(A0t)}function R0t(t,e,r){let i=1,s=0,n=0;for(;t!==e;)if(i*=.5,s*=.5,n*=.5,1&t.lij[2]&&(s+=.5),!(1&t.lij[1])&&(n+=.5),(t=t.parent)==null)throw new Error("tile was not a descendant of upsampleTile");r.init(e,s,n,i)}function M0t(t){for(let e=0;e<t.length;e++){const r=t[e],i=r.parent;if(i)for(let s=0;s<4;s++){const n=i.children[s];if(n&&n!==r)return!0}}return!1}function cGt(t,e){if(!t||!e||t[0]===e[0])return!1;const r=t[0]<e[0],i=r?t:e,s=r?e:t,n=1<<s[0]-i[0];return Math.floor(s[1]/n)===i[1]&&Math.floor(s[2]/n)===i[2]}let fK=class{get updating(){return!!this._tileRequested}init(e,r,i,s){this.tile=e,this._layerIdx=r,this._layerClass=i,this._suspended=s,this._tileLayerInfo=e.getLayerInfo(r,i),this._tileRequested=null;const n=this._findAncestorWithData();this._setUpsampleTile(n)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(e){e!==this._suspended&&(this._suspended=e,e?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();return this._setUpsampleTile(e),this._requestNext()}dataArrived(e,r){this._setUpsampleTile(e,r),this._tileRequested=null,e===this.tile?this.tile.updateRenderData(this._layerClass,on.FADING,r):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return e!=null?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone(),!!this._tileRequested}_findNextDownload(){const e=this._layerIdx,r=this._layerClass,i=this.tile.surface.layerViewByIndex(e,r),s=rW(i),{minLevel:n,maxLevel:o}=i.dataLevelRange,a=this._desiredMinLevelDelta,l=this._progressiveLevelModulo+a,c=this._scaleRangeEnabled?oR:()=>!0;let h=this.tile;const p=h.level;let f;const m=this._tileLayerInfo.upsampleInfo,y=m!=null?m.tile.level:-1,_=m!=null&&y-p>=a,v=s?.tilemapCache,b=i.type==="vector-tile-3d"?i.schemaHelper:null;for(;h&&c(h,s,!1)&&h.level>=n;){const T=h.level,x=p-T,S=h.layerInfo[r][e];if(S.data&&x>=a){(!_||T>y)&&this._setUpsampleTile(h),S.dataInvalidated&&(f=h);break}const E=b?.getLevelRowColumn(h.lij)??h.lij;if(v?.getAvailability(E[0],E[1],h.lij[2])!=="unavailable"&&T<=o&&!S.data&&!S.dataMissing&&((!f||h.level===n||T%hxe==0||p-f.level<a)&&(f=h),x>=l))break;h=h.parent}if(f!=null&&p-f.level<a)if(m)f=null;else{const T=this._findAncestorWithData();T!=null&&(this._setUpsampleTile(T),f=T.layerInfo[r][e].dataInvalidated?T:null)}return f}_findAncestorWithData(){const e=this.tile.elevationLevel,r=this._desiredMinLevelDelta;let i;for(let s=this.tile;s;s=s.parent)if(s.hasLayerData(this._layerIdx,this._layerClass)){if(e-s.level>=r)return s;i=s}return i}_setUpsampleTile(e,r){this._tileLayerInfo.setUpsampleInfo(this.tile,e),this.tile.updateRenderData(this._layerClass,on.FADING,r)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}},P0t=class extends fK{get _desiredMinLevelDelta(){throw oue}get _progressiveLevelModulo(){throw oue}dispose(){}};const oue=new Error("Abstract method called on TileAgent"),Wl=new P0t;let IOe=class extends fK{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return Hj(this.tile.level)-(this.tile.elevationLevel-this.tile.level)}get _progressiveLevelModulo(){return 0}},$Oe=class extends fK{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return hxe}};var dw,qw;(function(t){t[t.Stretch=0]="Stretch",t[t.Lut=1]="Lut",t[t.Hillshade=2]="Hillshade",t[t.COUNT=3]="COUNT"})(dw||(dw={})),function(t){t[t.Noop=0]="Noop",t[t.PerBand=1]="PerBand",t[t.COUNT=2]="COUNT"}(qw||(qw={}));function I0t(t){t.fragment.uniforms.add(new et("u_colormap",e=>e.u_colormap),new Pe("u_colormapOffset",e=>e.colormap.u_colormapOffset),new Pe("u_colormapMaxIndex",e=>e.colormap.u_colormapMaxIndex),new Pe("u_opacity",e=>e.common.u_opacity)),t.fragment.code.add(w`vec4 colormap(vec4 currentPixel, bool isFloat) {
float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
result = texelFetch(u_colormap, ivec2(texelCoordinates), 0);
}
return result;
}`)}function $0t(t){t.fragment.uniforms.add(new et("u_transformGrid",e=>e.u_transformGrid),new Ar("u_transformSpacing",e=>e.common.u_transformSpacing),new Ar("u_targetImageSize",e=>e.common.u_targetImageSize)),t.fragment.code.add(w`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(4.0, 1.0);
vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;
vec2 pos = fract((index_image + 0.5) / u_transformSpacing);
vec2 transform_location = index_transform + 0.5;
vec2 srcLocation;
if (pos.s <= pos.t) {
vec3 ll_abc = texelFetch(u_transformGrid, ivec2(transform_location), 0).rgb;
vec3 ll_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 1.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
srcLocation.t = dot(ll_def, vec3(pos, 1.0));
} else {
vec3 ur_abc = texelFetch(u_transformGrid, ivec2(transform_location.s + 2.0, transform_location.t), 0).rgb;
vec3 ur_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 3.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
srcLocation.t = dot(ur_def, vec3(pos, 1.0));
}
return srcLocation;
}`)}let LOe=class extends ri{constructor(){super(...arguments),this.scale=1,this.offset=Tp}};function DOe(t){t.attributes.add(C.POSITION,"vec2"),t.attributes.add(C.UV0,"vec2"),t.vertex.uniforms.add(new Pe("scale",e=>e.scale)),t.vertex.uniforms.add(new Ar("offset",e=>e.offset)),t.varyings.add("uv","vec2"),t.varyings.add("vuv","vec2"),t.vertex.code.add(w`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}let L0t=class extends LOe{constructor(e,r,i){super(),this.common=e,this.u_image=r,this.u_transformGrid=i}};function D0t(t,e){t.include($0t),t.fragment.uniforms.add(new et("u_image",i=>i.u_image),new Jf("u_flipY",i=>i.common.u_flipY),new Jf("u_applyTransform",i=>i.common.u_applyTransform));const{requireBilinearWithNN:r}=e;r&&t.fragment.uniforms.add(new Ar("u_srcImageSize",i=>i.common.u_srcImageSize)),t.fragment.code.add(w`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}`),r?t.fragment.code.add(w`vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {
vec2 texelStart = floor(coords * texSize);
vec2 coord0 = texelStart / texSize;
vec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;
vec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;
vec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;
vec4 color0 = texture(sampler, coord0);
vec4 color1 = texture(sampler, coord1);
vec4 color2 = texture(sampler, coord2);
vec4 color3 = texture(sampler, coord3);
vec2 blend = fract(coords * texSize);
vec4 color01 = mix(color0, color1, blend.x);
vec4 color23 = mix(color2, color3, blend.x);
vec4 color = mix(color01, color23, blend.y);
float alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);
color = color * alpha + (1.0 - alpha) * texture(sampler, coords);
return color;
}
vec4 getPixel(vec2 pixelLocation) {
return sampleBilinear(u_image, pixelLocation, u_srcImageSize);
}`):t.fragment.code.add(w`vec4 getPixel(vec2 pixelLocation) {
return texture(u_image, pixelLocation);
}`)}var Ie;(function(t){t[t.Normal=0]="Normal",t[t.Average=1]="Average",t[t.Lighten=2]="Lighten",t[t.Lighter=3]="Lighter",t[t.Plus=4]="Plus",t[t.Screen=5]="Screen",t[t.ColorDodge=6]="ColorDodge",t[t.Darken=7]="Darken",t[t.Multiply=8]="Multiply",t[t.ColorBurn=9]="ColorBurn",t[t.Overlay=10]="Overlay",t[t.SoftLight=11]="SoftLight",t[t.HardLight=12]="HardLight",t[t.VividLight=13]="VividLight",t[t.Hue=14]="Hue",t[t.Saturation=15]="Saturation",t[t.Luminosity=16]="Luminosity",t[t.Color=17]="Color",t[t.DestinationOver=18]="DestinationOver",t[t.DestinationAtop=19]="DestinationAtop",t[t.DestinationIn=20]="DestinationIn",t[t.DestinationOut=21]="DestinationOut",t[t.SourceAtop=22]="SourceAtop",t[t.SourceIn=23]="SourceIn",t[t.SourceOut=24]="SourceOut",t[t.Xor=25]="Xor",t[t.Difference=26]="Difference",t[t.Exclusion=27]="Exclusion",t[t.Minus=28]="Minus",t[t.Invert=29]="Invert",t[t.Reflect=30]="Reflect",t[t.COUNT=31]="COUNT"})(Ie||(Ie={}));const cW={normal:Ie.Normal,average:Ie.Average,lighten:Ie.Lighten,lighter:Ie.Lighter,screen:Ie.Screen,plus:Ie.Plus,"color-dodge":Ie.ColorDodge,darken:Ie.Darken,multiply:Ie.Multiply,"color-burn":Ie.ColorBurn,overlay:Ie.Overlay,"soft-light":Ie.SoftLight,"hard-light":Ie.HardLight,"vivid-light":Ie.VividLight,hue:Ie.Hue,saturation:Ie.Saturation,luminosity:Ie.Luminosity,color:Ie.Color,difference:Ie.Difference,exclusion:Ie.Exclusion,minus:Ie.Minus,invert:Ie.Invert,reflect:Ie.Reflect,"destination-over":Ie.DestinationOver,"destination-atop":Ie.DestinationAtop,"destination-in":Ie.DestinationIn,"destination-out":Ie.DestinationOut,"source-atop":Ie.SourceAtop,"source-in":Ie.SourceIn,"source-out":Ie.SourceOut,xor:Ie.Xor};function N0t(t){return t===Ie.DestinationOver||t===Ie.DestinationAtop||t===Ie.DestinationIn||t===Ie.DestinationOut||t===Ie.SourceAtop||t===Ie.SourceIn||t===Ie.SourceOut||t===Ie.Xor}function mK(t){t.code.add(w`
    float lineFactorAtPosition(float value) {
      float pos = value * ${w.float(257)};
      if(pos < 0.5 || pos > ${w.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)}function F0t(t,e){const r=e.blendMode;r!==Ie.Normal&&(r===Ie.Reflect&&t.code.add(w`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),r!==Ie.ColorDodge&&r!==Ie.VividLight||t.code.add(w`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),r!==Ie.ColorBurn&&r!==Ie.VividLight||t.code.add(w`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),r===Ie.Overlay&&t.code.add(w`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),r===Ie.HardLight&&t.code.add(w`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),r===Ie.SoftLight&&t.code.add(w`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),r===Ie.VividLight&&t.code.add(w`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),r!==Ie.Hue&&r!==Ie.Saturation&&r!==Ie.Color&&r!==Ie.Luminosity||(t.code.add(w`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),r!==Ie.Hue&&r!==Ie.Saturation||t.code.add(w`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),t.code.add(w`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${r===Ie.Multiply?w`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ie.Average?w`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ie.Lighten?w`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ie.Darken?w`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ie.Lighter?w`return vec4(cl * ol + cb * ob, ol + ob);`:r===Ie.Plus?w`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:r===Ie.Minus?w`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:r===Ie.Screen?w`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ie.Difference?w`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ie.Invert?w`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:r===Ie.DestinationOver?w`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:r===Ie.DestinationAtop?w`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:r===Ie.DestinationOut?w`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:r===Ie.SourceAtop?w`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:r===Ie.SourceOut?w`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:r===Ie.Xor?w`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:r===Ie.DestinationIn?w`return vec4(cb * ob * ol, ol * ob);`:r===Ie.SourceIn?w`return vec4(cl * ol * ob, ol * ob);`:r===Ie.Hue?w`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ie.Saturation?w`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ie.Color?w`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ie.Luminosity?w`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ie.Exclusion?w`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ie.Reflect?w`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ie.ColorDodge?w`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ie.ColorBurn?w`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ie.Overlay?w`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ie.SoftLight?w`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ie.HardLight?w`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ie.VividLight?w`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:w``}
    }
  `))}var En,up,Xd;(function(t){t[t.Composite=0]="Composite",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.GroupBackgroundComposite=3]="GroupBackgroundComposite",t[t.COUNT=4]="COUNT"})(En||(En={})),function(t){t[t.NotRequired=0]="NotRequired",t[t.Required=1]="Required",t[t.COUNT=2]="COUNT"}(up||(up={})),function(t){t[t.Off=0]="Off",t[t.On=1]="On",t[t.COUNT=2]="COUNT"}(Xd||(Xd={}));function NOe(t,e){const r=e.output===En.GridComposite,i=e.output===En.ColorComposite,s=e.output===En.GroupBackgroundComposite,n=e.output===En.Composite;r&&t.fragment.include(mK),i&&t.fragment.uniforms.add(new zt("backgroundColor",c=>c.backgroundColor));const o=e.baseOpacityMode===up.Required;o&&t.fragment.uniforms.add(new Pe("baseOpacity",c=>c.baseOpacity)),n&&t.fragment.uniforms.add(new et("fboColor",c=>c.fboTexture));const a=e.blendMode!==Ie.Normal,l=e.premultipliedSource===Xd.On;t.fragment.include(F0t,e),t.fragment.code.add(w`
    vec4 getBackground(vec2 uv) {
      return ${o?w`baseOpacity *`:""} ${s?w`vec4(0.0, 0.0, 0.0, 0.0)`:i?w`vec4(backgroundColor, 1.0)`:r?w`vec4(gridColor(uv), 1.0)`:w`texelFetch(fboColor, ivec2(gl_FragCoord.xy), 0)`};
    }

    vec4 blendLayers(vec4 bgColor, vec4 colorLayer, float opacity) {
      ${a?w`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:w`
          float composeAlpha = colorLayer.a * opacity;
          return ${!l&&(n&&!o||s)?w`colorLayer * opacity;`:w`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)}let e8=class extends L0t{constructor(e,r,i,s,n,o){super(e,s,n),this.colormap=r,this.symbolizer=i,this.u_colormap=o,this.backgroundColor=Ka,this.fboTexture=null,this.baseOpacity=1}},U0t=class extends e8{},k0t=class extends e8{};function z0t(t){const e=new Sr;return e.include(DOe),e.include(D0t,t),e.include(I0t,t),e.include(NOe,t),e.fragment.code.add(w`vec4 applyBackgroundBlend(vec4 layerColor) {
vec4 bgColor = getBackground(vuv);
return blendLayers(bgColor, layerColor, u_opacity);
}`),t.colorizerType===dw.Stretch?B0t(e,t):t.colorizerType===dw.Lut?V0t(e):t.colorizerType===dw.Hillshade&&G0t(e,t),e}function V0t(t){t.fragment.code.add(w`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
fragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}function B0t(t,e){t.fragment.uniforms.add(new hP("u_bandCount",i=>i.symbolizer.u_bandCount),new Ol("u_minCutOff",i=>i.symbolizer.u_minCutOff,3),new Ol("u_maxCutOff",i=>i.symbolizer.u_maxCutOff,3),new Ol("u_factor",i=>i.symbolizer.u_factor,3),new Pe("u_minOutput",i=>i.symbolizer.u_minOutput),new Pe("u_maxOutput",i=>i.symbolizer.u_maxOutput),new Jf("u_useGamma",i=>i.symbolizer.u_useGamma),new Ol("u_gamma",i=>i.symbolizer.u_gamma,3),new Ol("u_gammaCorrection",i=>i.symbolizer.u_gammaCorrection,3),new Pe("u_opacity",i=>i.common.u_opacity)),t.fragment.code.add(w`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const r=e.applyColormap?w`fragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:w`fragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;t.fragment.code.add(w`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${e.stretchType===qw.Noop?w`
        fragColor = applyBackgroundBlend(currentPixel);`:w`
        if (currentPixel.a == 0.0) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${r}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          fragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function G0t(t,e){const r=t.fragment;r.uniforms.add(new et("u_image",s=>s.u_image),new hP("u_hillshadeType",s=>s.symbolizer.u_hillshadeType),new Ol("u_sinZcosAs",s=>s.symbolizer.u_sinZcosAs,6),new Ol("u_sinZsinAs",s=>s.symbolizer.u_sinZsinAs,6),new Ol("u_cosZs",s=>s.symbolizer.u_cosZs,6),new Ol("u_weights",s=>s.symbolizer.u_weights,6),new Ar("u_factor",s=>s.symbolizer.u_factor),new Pe("u_minValue",s=>s.symbolizer.u_minValue),new Pe("u_maxValue",s=>s.symbolizer.u_maxValue),new Ar("u_srcImageSize",s=>s.common.u_srcImageSize)),r.include(Em),r.code.add(w`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`),r.code.add(w`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const i=e.applyColormap?w`fragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:w`hillshade *= alpha;
fragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;r.code.add(w`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture(u_image, pixelLocation);
      vec4 vf = texture(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${i}
    }
  `)}const j0t=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:k0t,ColorizerStretchUniforms:U0t,ColorizerUniforms:e8,build:z0t},Symbol.toStringTag,{value:"Module"}));function H0t(t,e,r="nearest",i=!1){const s=!(i&&e.pixelType==="u8"),n=s?Gs.FLOAT:Gs.UNSIGNED_BYTE,o=e.pixels==null||e.pixels.length===0?null:s?e.getAsRGBAFloat():e.getAsRGBA(),a=t.capabilities.textureFloat?.textureFloatLinear,l=new xr;return l.width=e.width,l.height=e.height,l.internalFormat=t.type===cr.WEBGL2&&s?Je.RGBA32F:Ct.RGBA,l.samplingMode=!a||r!=="bilinear"&&r!=="cubic"?Rt.NEAREST:Rt.LINEAR,l.dataType=n,l.wrapMode=Dt.CLAMP_TO_EDGE,new Ot(t,l,o)}function q0t(t,e){const{spacing:r,offsets:i,coefficients:s,size:[n,o]}=e,a=r[0]>1,l=new xr;l.width=a?4*n:n,l.height=o,l.internalFormat=t.type===cr.WEBGL2?Je.RGBA32F:Ct.RGBA,l.dataType=Gs.FLOAT,l.samplingMode=Rt.NEAREST,l.wrapMode=Dt.CLAMP_TO_EDGE;const c=new Float32Array(a?n*o*16:2*i.length);if(a&&s!=null)for(let h=0,p=0;h<s.length;h++)c[p++]=s[h],h%3==2&&(c[p++]=1);else for(let h=0;h<o;h++)for(let p=0;p<n;p++){const f=4*(h*n+p),m=2*(p*o+h);c[f]=i[m],c[f+1]=i[m+1],c[f+3]=i[m]===-1?0:1}return new Ot(t,l,c)}function aue(t,e){const r=new xr;return r.internalFormat=Ct.RGBA,r.width=e.length/4,r.height=1,r.samplingMode=Rt.NEAREST,r.wrapMode=Dt.CLAMP_TO_EDGE,new Ot(t,r,e)}function W0t(t,e,r,i=1,s=!0){return{u_flipY:s,u_applyTransform:!!t,u_opacity:i,u_transformSpacing:t?t.spacing:Tp,u_transformGridSize:t?t.size:Tp,u_targetImageSize:e,u_srcImageSize:r}}function X0t(t,e){return{u_colormapOffset:e||0,u_colormapMaxIndex:t?t.length/4-1:0}}function Z0t(t){return{u_bandCount:t.bandCount,u_minOutput:t.outMin,u_maxOutput:t.outMax,u_minCutOff:t.minCutOff,u_maxCutOff:t.maxCutOff,u_factor:t.factor,u_useGamma:t.useGamma,u_gamma:t.gamma,u_gammaCorrection:t.gammaCorrection}}function Y0t(t){return{u_hillshadeType:t.hillshadeType,u_sinZcosAs:t.sinZcosAs,u_sinZsinAs:t.sinZsinAs,u_cosZs:t.cosZs,u_weights:t.weights,u_factor:t.factor,u_minValue:t.minValue,u_maxValue:t.maxValue}}const lue={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};let J0t=class{constructor(e,r,i=null,s=null){this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.opacity=1,this.lij=e,this.source=r,this.width=i||r.width,this.height=s||r.height}get source(){return this._source}set source(e){this._source=e,this._rasterTexture=Ve(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?{...lue,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||lue}set symbolizerParameters(e){this._symbolizerParameters=e}get bandIds(){return this._bandIds}set bandIds(e){e!=null&&e.length>0?this._bandIds&&e.every((r,i)=>!!this._bandIds?.[i]&&r===this._bandIds[i])||(this._bandIds=e,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(e){if(this._interpolation=e,this._rasterTexture!=null){const r=this._getRasterTextureInterpolation(e);this._rasterTexture.setSamplingMode(r==="bilinear"?Rt.LINEAR:Rt.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(e){this._transformGrid=e,this._transformGridTexture=Ve(this._transformGridTexture),this._memoryUsed=null}bind(e){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&((this._rasterTexture==null||this._dirty)&&this._updateRasterTexture(e,this.bandIds),this._rasterTexture!=null&&(this._updateColormapTexture(e),this.transformGrid&&this._transformGridTexture==null&&(this._transformGridTexture=q0t(e,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:e,transformGrid:r,width:i,height:s,opacity:n}=this,o=W0t(r,[i,s],[this.source.width,this.source.height],n),a=X0t(e.colormap,e.colormapOffset),l=this.symbolizerParameters.type==="stretch"?Z0t(this.symbolizerParameters):null,c=this.symbolizerParameters.type==="hillshade"?Y0t(this.symbolizerParameters):null;return new e8(o,a,l||c,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get isBilinearWithStretchColorRamp(){const{symbolizerParameters:e}=this;return this.interpolation==="bilinear"&&e.colormap!=null&&e.type==="stretch"}get memoryUsage(){if(this._memoryUsed==null){const e=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=e.map(r=>r!=null?r.descriptor.width*r.descriptor.height*4:0).reduce((r,i)=>r+i,0)}return this._memoryUsed}release(){return this._rasterTexture=Ve(this._rasterTexture),this._transformGridTexture=Ve(this._transformGridTexture),this._colormapTexture=Ve(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(e,r){const i=this.source?this.source.extractBands(r):null;if(!(i&&i.pixels&&i.pixels.length>0))return void(this._rasterTexture=Ve(this._rasterTexture));const s=r==null&&this.bandIds==null||r!=null&&this.bandIds!=null&&r.join("")===this.bandIds.join("");if(this._rasterTexture!=null&&s)return;this._rasterTexture=Ve(this._rasterTexture);const n=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=H0t(e,i,n,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&this.symbolizerParameters.stretchType==="none"&&!this.symbolizerParameters.useGamma&&this.source.pixelType==="u8"}_getRasterTextureInterpolation(e){return this.symbolizerParameters.type==="lut"||e==="nearest"||e==="majority"||this.isBilinearWithStretchColorRamp?"nearest":"bilinear"}_updateColormapTexture(e){const r=this._colormap,i=this.symbolizerParameters.colormap;return i?r?i.length!==r.length||i.some((s,n)=>s!==r[n])?(this._colormapTexture=Ve(this._colormapTexture),this._colormapTexture=aue(e,i),void(this._colormap=i)):void 0:(this._colormapTexture=aue(e,i),void(this._colormap=i)):(this._colormapTexture=Ve(this._colormapTexture),void(this._colormap=null))}},SN=class{constructor(){this.waitingAgents=new Bt,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(e){const r=Ez.acquire();return r._init(e),r}release(){this.dispose(),EN.delete(this),Ez.release(this)}dispose(){this.loadingAgent=Ve(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=M2(this._data)}static prune(){Ez.prune(0)}_init(e){this.waitingAgents.clear(),this._data=M2(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=e,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=Ll(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){this._upsampleInfo!=null&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(e,r){if(e!==r&&r!=null){if(this._upsampleInfo==null)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===r)return;this._upsampleInfo.tile.unrefMapData()}r.refMapData(),R0t(e,r,this._upsampleInfo)}else this._unsetUpsampleInfo()}get data(){return this._data}set data(e){M2(this._data),this._data=e}};const Ez=new Go(SN,null,()=>{}),EN=new Map;function Q0t(){EN.size>0&&(console.log(`${EN.size} live TilePerLayerInfo allocations:`),EN.forEach(t=>console.log(t,`
`)))}let SS=class{constructor(e){this._texture=e,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){--this._refCount,this._refCount===0&&this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}get gpuMemoryUsage(){return this._texture.gpuMemoryUsage}};var xt;(function(t){t[t.NONE=0]="NONE",t[t.SPLIT=1]="SPLIT",t[t.ELEVATION=2]="ELEVATION",t[t.MERGE=4]="MERGE",t[t.RENDERDATA=8]="RENDERDATA",t[t.GEOMETRY=16]="GEOMETRY",t[t.TEXTURE_NOFADING=32]="TEXTURE_NOFADING",t[t.TEXTURE_FADING=64]="TEXTURE_FADING"})(xt||(xt={}));const K0t=.1;let gK=class{constructor(){this.lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this.renderData=null,this._dirty=!0,this._previouslyRendered=!1,this.extent=Vt(),this._elevationBounds=Ge(),this.layerInfo=[[],[]],this.extentInRadians=Vt(),this.centerAtSeaLevel=O(),this._center=[O(),bs(),O()],this.up=WX(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemoryInternal=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=O()}static prune(){yK.prune(0),_K.prune(0),SN.prune()}get _isCached(){return!this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[Vs.MIDDLE][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){this._dirty=!1;const e=this.parent,r=e?.frustumVisibility??na.INTERSECTS;this._frustumVisibility=r===na.INSIDE?na.INSIDE:r===na.OUTSIDE?na.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);const i=this._frustumVisibility!==na.OUTSIDE&&this._intersectsClippingArea;i!==this._visible&&(this._visible=i,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const e=!!this.renderData;return e!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=e,this._surface.renderer.setDirty()),e}get shouldLoad(){return this.isLeaf}init(e,r,i){this.lij[0]=e[0],this.lij[1]=e[1],this.lij[2]=e[2],this.ellipsoid=zr(i.tilingScheme.spatialReference),i.tilingScheme.getExtent(e[0],e[1],e[2],this.extent),i.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,i.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[Vs.MIDDLE][3]=0,this.elevationLevel=e?e[0]:0,r&&r.elevationBounds?fn(this._elevationBounds,r.elevationBounds):ar(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=r,this.unsetChildren(),this._surface=i,this.updateVisibility();for(const s of mb){const n=i.numLayers(s),o=this.layerInfo[s];for(const a of o)a.release();o.length=n;for(let a=0;a<n;a++)o[a]=SN.acquire(this._surface.upsampleInfoPool),s===rr.ELEVATION&&this.findElevationBoundsForLayer(a,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(i.tilingScheme.pixelSize,O3)}release(){Rf(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const e of mb){for(const r of this.layerInfo[e])r.release();this.layerInfo[e].length=0}this._parent=null;for(let e=0;e<4;++e)this._children[e]=null;this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this._isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this._isCached){this.setMemoryDirty();const e=this._cachedMemory;e>0&&this._surface.upsampleMapCache.put(this.key,this,e)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}get _cachedMemory(){return this._isCached?this._mapTileMemory:0}get _mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[rr.MAP].reduce((e,r)=>e+(r instanceof Sz?r.memoryUsed/r.referenced:0),this._mapTileMemoryInternal)}get _cpuImageMemorySize(){const r=this._surface.tilingScheme.pixelSize;return r*r*4}_ensureUsedMemory(){if(this._usedMemory!=null)return this._usedMemory;this._usedMemory=0,this._mapTileMemoryInternal=0;let e=0;for(const{data:i}of this.layerInfo[rr.MAP])i instanceof Sz?e+=this._getTerrainDataMemory(i):this._mapTileMemoryInternal+=this._getTerrainDataMemory(i);const r=this._cpuImageMemorySize;for(const i of this.layerInfo[rr.ELEVATION])this._usedMemory+=i.data?r:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemoryInternal+=this.renderData.texture?.gpuMemoryUsage??0),this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+e),this._usedMemory}getUsedMemoryForLayer(e,r){const i=this.layerInfo[e][r];return i?.data?e===rr.MAP?this._isCached?0:this._getTerrainDataMemory(i.data):e===rr.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(e){return e instanceof SS?e.texture.gpuMemoryUsage:e instanceof HTMLImageElement||e instanceof YU?this._cpuImageMemorySize:e instanceof J0t?e.memoryUsage:e instanceof Sz?e.memoryUsed/e.referenced:0}updateScreenDepth(e){const r=this._center[Vs.MIDDLE],i=e,s=r[0],n=r[1],o=r[2],a=i[2]*s+i[6]*n+i[10]*o+i[14];this.screenDepth=a<0?0:a/(i[3]*s+i[7]*n+i[11]*o+i[15])}shouldSplit(e,r,i){if(!this.visible||e.frustum!=null&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(e.frustum)===na.OUTSIDE))return xt.NONE;const s=this.level;de(dL,this._center[Vs.MIDDLE],r);let n=la(dL),o=dL,a=Vs.MIDDLE;de(Cz,this._center[Vs.TOP],r);const l=la(Cz);l<n&&(n=l,o=Cz,a=Vs.TOP),de(Az,this._center[Vs.BOTTOM],r);const c=la(Az);if(c<n&&(n=c,o=Az,a=Vs.BOTTOM),this._edgeLen2>n&&s<e.maxLod)return xt.SPLIT;const h=i!=null?i-s:1/0,p=Math.sqrt(n),f=e.fovX*p*2,m=this._edgeLen/f,y=()=>{if(s<e.maxLod)return this.elevationLevel=s,xt.NONE;const R=s+Math.ceil(-Math.log2(e.relativeWidthLimit/m));return R!==this.elevationLevel?(this.elevationLevel=R,xt.ELEVATION):xt.NONE};if(h<=.5)return y();const _=fe(this.up,dL),v=this._elevationBounds[1]-this._elevationBounds[0],b=v/this.edgeLen;if(e.aboveGround&&_>0&&b<.001&&_/p-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-b>0)return xt.NONE;const T=i!=null?3-Math.min(h,2):1;if(m*T<e.relativeWidthLimit||s>=e.maxLod)return y();if(s<7)return xt.SPLIT;ie(so,this.up,_),de(so,so,o);const x=la(so);if(x<=this.radius*this.radius)return xt.SPLIT;ie(so,so,this.radius/Math.sqrt(x)),ue(so,so,this._center[a]),de(so,r,so);const S=Math.min(1,(Math.abs(fe(so,this.up))+.5*v+this._curvatureHeight)/Oe(so)),E=K0t/e.angledSplitBias,A=e.fovY*p*2;return S*(this._edgeLen/A*T)<E*e.relativeHeightLimit?xt.NONE:xt.SPLIT}setChildren(e,r,i,s){Rf(!!(e&&r&&i&&s),"Null child passed"),this._children[0]=e,this._children[1]=r,this._children[2]=i,this._children[3]=s}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){return this.renderData?.hasGeometry??!1}load(){this.refMapData();for(const e of mb)this._createOrUpdateAgents(0,e);this.surface.renderer.loadTile(this)}unload(e){e.unloadTile(this);for(const r of mb){const i=this.layerInfo[r];for(const s of i)s.loadingAgent&&s.loadingAgent!==Wl&&(hL(s.loadingAgent),s.loadingAgent=null),s.pendingUpdates=0}this.resetPendingUpdate(xt.GEOMETRY),this.resetPendingUpdate(xt.TEXTURE_NOFADING),this.resetPendingUpdate(xt.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const e=this.layerInfo[rr.MAP];for(const r of e)r.loadingAgent&&r.loadingAgent!==Wl&&(hL(r.loadingAgent),r.loadingAgent=null),r.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(e){if(Jb(e,this._clippingArea))return!1;const r=this._intersectsClippingArea,i=this._isWithinClippingArea;e!=null?(this._intersectsClippingArea=this.intersectsExtent(e),this._isWithinClippingArea=this._isWithinExtent(e)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=e,this.updateVisibility();const s=i&&this._isWithinClippingArea,n=!(i||r||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||s||n||this.setPendingUpdate(xt.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(e,r){return this.layerInfo[r][e]}hasLayerData(e,r){const i=this.layerInfo[r][e];return!(!i||!i.data||i.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const e of mb){const r=this.layerInfo[e];for(const i of r)if(i.loadingAgent&&i.loadingAgent!==Wl&&i.loadingAgent.updating)return!0}return!1}_isSuspended(e){return!!this.hasPendingUpdate(xt.SPLIT)||e!==rr.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(e){return(this._pendingUpdates&e)===e}setPendingUpdate(e){this._pendingUpdates|=e,e===xt.SPLIT||e===xt.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(e){return!!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)}requestLayerData(e,r,i){const s=this.layerInfo[r][e];if(s.waitingAgents.has(i))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),i.tile.lij.toString(),r,e),!0;if(s.waitingAgents.push(i),s.data&&!s.dataInvalidated){console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),i.tile.lij.toString(),r,e);const a=s.data&&"type"in s.data&&s.data.type==="vector-tile";return i.dataArrived(this,a),!0}if(s.requestPromise)return!0;Ll(s.requestAbort),s.requestAbort=new AbortController;const n=this._surface.requestTileData(this,e,r,s.requestAbort);if(!n)return s.requestAbort=null,!1;const o=()=>{s.requestPromise===n&&(s.requestPromise=null,s.requestAbort=null)};return s.requestPromise=n,n.then(o,o),!0}get isLeaf(){return this._children[0]==null}hasLij(e){return this.lij[0]===e[0]&&this.lij[1]===e[1]&&this.lij[2]===e[2]}findByLij(e){if(this.hasLij(e))return this;const r=this._children;return r[0]?r[0].findByLij(e)||r[1].findByLij(e)||r[2].findByLij(e)||r[3].findByLij(e):null}distanceToSquared(e){return la(de(so,this._center[Vs.MIDDLE],e))}containsPoint(e){const r=this.extent;return e[0]>=r[0]&&e[1]>=r[1]&&e[0]<=r[2]&&e[1]<=r[3]}containsPointXY(e,r){const i=this.extent;return e>=i[0]&&r>=i[1]&&e<=i[2]&&r<=i[3]}unrequestLayerData(e,r,i){const s=this.layerInfo[r][e],n=s.waitingAgents,o=n.removeUnordered(i)!=null;Rf(o,"agent has not requested this piece of map data"),n.length<1&&(s.abortRequest(),this.setMemoryDirty())}dataArrived(e,r,i){const s=i!=null&&"type"in i&&i.type==="vector-tile",n=this.layerInfo[r][e];n.data=i,n.dataInvalidated=!1,n.waitingAgents.forAll(o=>o.dataArrived(this,s)),n.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(e,r,i){i.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${r}/${e} error ${i}`);const s=this.layerInfo[r][e];s.dataMissing=!0,s.waitingAgents.forAll(n=>n.dataMissing()),s.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(e,r,i){switch(i&&this.forEachLoadedNeighbor(s=>s.updateRenderData(e,r)),e){case rr.MAP:return this._updateTexture(r);case rr.ELEVATION:return this._updateGeometry()}}_updateTexture(e){this.renderData&&(this.resetPendingUpdate(e===on.FADING?xt.TEXTURE_NOFADING:xt.TEXTURE_FADING),this.setPendingUpdate(e===on.FADING?xt.TEXTURE_FADING:xt.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(xt.GEOMETRY);for(const e of this.layerInfo[rr.ELEVATION])e.pendingUpdates|=xt.GEOMETRY}invalidateLayerData(e,r){this.layerInfo[r][e].invalidateSourceData(),this.restartAgents(r)}computeElevationBounds(){const e=this._elevationBounds,r=e[0],i=e[1];ar(e,1/0,-1/0);const s=this.layerInfo[rr.ELEVATION];let n=!0;for(const o of s)o.elevationBounds!=null&&(e[0]=Math.min(e[0],o.elevationBounds.min),e[1]=Math.max(e[1],o.elevationBounds.max),o.elevationBounds.hasNoDataValues||(n=!1));n&&(e[0]=Math.min(e[0],0),e[1]=Math.max(e[1],0)),r===e[0]&&i===e[1]||(this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){const e=this._elevationBounds,r=.5*(e[0]+e[1]),i=this._center;ie(so,this.up,r),ue(i[Vs.MIDDLE],this.centerAtSeaLevel,so),ie(so,this.up,e[0]),ue(i[Vs.TOP],this.centerAtSeaLevel,so),ie(so,this.up,e[1]),ue(i[Vs.BOTTOM],this.centerAtSeaLevel,so)}findElevationBoundsForLayer(e,r){const i=this.layerInfo[rr.ELEVATION][e],s=Hj(this.level),n=Math.max(this.elevationLevel-s,0),o=i.elevationBounds;if(o!=null&&o.level>=r&&o.level<=n)return;const a=this._surface.layerViewByIndex(e,rr.ELEVATION),l=rW(a);if(!oR(this,l,!1))return;const c=t_t;let h=!1;const p=i.data;if(p&&p.level<=n){const f=i.data;c.min=f.samplerData.data.minValue,c.max=f.samplerData.data.maxValue,c.hasNoDataValues=f.samplerData.data.hasNoDataValues,c.level=this.level,h=!0}else{let f,m,y=0;for(let _=this._parent;_&&(!m||y<s)&&(y=this.elevationLevel-_.level,f=m||f,m=_.layerInfo[rr.ELEVATION][e].data,!(!m&&f&&_.level<=n));_=_.parent);m=m||f,m&&(m.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],c),c.min!==1/0&&(c.level=m.level,h=!0))}h&&(i.elevationBounds==null&&(i.elevationBounds=new QS),i.elevationBounds.copyFrom(c))}modifyLayers(e,r,i){const s=this.layerInfo[i];for(const a of s)a.loadingAgent&&a.loadingAgent!==Wl&&(hL(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<s.length;++a)e[a]===void 0&&s[a].release();const n=new Array(...s),o=r.length;s.length=o;for(let a=0;a<o;a++){const l=r[a];s[a]=l>-1?n[l]:SN.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e,on.FADING))}updateAgents(e){if(this.renderData){const r=this.layerInfo[e];for(const i of r)i.loadingAgent===Wl&&(i.loadingAgent=null);this._createOrUpdateAgents(0,e)}}updateAgentSuspension(){for(const e of mb){const r=this._isSuspended(e);for(const i of this.layerInfo[e])i.loadingAgent&&i.loadingAgent!==Wl&&(i.loadingAgent.setSuspension(r),i.loadingAgent===Wl&&this.updateRenderData(e,on.FADING))}}removeLayerAgent(e,r){const i=this.layerInfo[r][e];i.loadingAgent&&i.loadingAgent!==Wl&&i.loadingAgent.dispose(),i.loadingAgent=null}agentDone(e,r){const i=this.layerInfo[r][e];i.loadingAgent=Wl,i.data||i.upsampleInfo!=null||this._createOrUpdateAgents(e+1,r)}_hasBlendableAncestor(e){return e.blendMode!=="normal"||B2(e.parent)&&this._hasBlendableAncestor(e.parent)}_hasBlendModes(e,r,i){for(let s=e;s<r;++s){const n=this._surface.layerViewByIndex(s,i);if(XF(n)&&n?.layer?.blendMode!=="normal"||B2(n?.layer?.parent)&&this._hasBlendableAncestor(n?.layer?.parent))return!0}return!1}_createOrUpdateAgents(e,r){const i=this.layerInfo[r];if(i.length===0)return;const s=this._isSuspended(r);for(let n=e;n<i.length;++n){const o=i[n];let a=!1;const l=this._surface.layerViewByIndex(n,r),c=rW(l);if(o.loadingAgent?oR(this,c,!1)?(o.loadingAgent!==Wl&&o.loadingAgent.setSuspension(s),o.loadingAgent!==Wl&&(a=o.loadingAgent.update())):o.dispose():oR(this,c,!1)&&(o.loadingAgent=e_t(this,n,r,s),a=o.loadingAgent.startLoading(),a?o.loadingAgent===Wl&&this.setPendingUpdate(xt.GEOMETRY):(hL(o.loadingAgent),o.loadingAgent=Wl)),o.loadingAgent===Wl&&this.updateRenderData(r,on.FADING),!this._hasBlendModes(e,i.length,r)&&a&&l.isOpaque)return}}_isWithinExtent(e){const r=this.extent;return r[0]>=e[0]&&e[2]>=r[2]&&r[1]>=e[1]&&e[3]>=r[3]}intersectsExtent(e){const r=this.extent;return r[2]>=e[0]&&e[2]>=r[0]&&r[3]>=e[1]&&e[3]>=r[1]}getElevationVerticesPerSide(e){const r=this.elevationLevel-this.level,i=Math.max(this.level-e,Hj(this.level)-r),s=ve(1+(this.maxTesselation>>i),2,this.maxTesselation+1),n=this.getDefaultVerticesPerSide();return Math.max(s,n)}get test(){return{cachedMemory:this._cachedMemory}}_findLIJ(e,r){if(!e)return null;const i=this.surface.rootTiles;if(i!=null){for(const s of i)if(r_t(s,e)){let n=s,o=e[0]-n.level-1;for(;o>=0&&!n.isLeaf&&!r(n);){const a=e[1]>>o&1,l=e[2]>>o&1;n=n.children[2*a+l],o--}return r(n)?n:null}}return null}findNeighborTile(e,r){const i=this.lij,s=this.getNeighborLIJ(i,e);return s?i_t(i,s)?r(this)?this:null:this._findLIJ(s,r):null}findCorner(e,r){const i=e===ct.NORTH_EAST?1:e===ct.NORTH_WEST?0:e===ct.SOUTH_WEST?2:3;let s=this;for(;s.children[0]&&(!r||!r(s));)s=s.children[i];return s}findNeighborCornerTileExact(e,r){return this.findNeighborTile(e,i=>r(i)||i.level===this.level)?.findCorner(ZF(e),r)||null}forAllSubtreeOnSide(e,r){const i=e===ct.NORTH?[0,1]:e===ct.NORTH_EAST?[1]:e===ct.EAST?[1,3]:e===ct.SOUTH_EAST?[3]:e===ct.SOUTH?[2,3]:e===ct.SOUTH_WEST?[2]:e===ct.WEST?[0,2]:[0],s=n=>{const o=n.children;!r(n)&&o[0]&&i.forEach(a=>s(o[a]))};s(this)}forallNeighbors(e){aM.forEach(r=>this.findNeighborCornerTileExact(r,e)),Vf.forEach(r=>this.findNeighborTile(r,i=>i.level===this.level||e(i))?.forAllSubtreeOnSide(YF(r),e))}getNeighborEdgeStartVertexIndex(e,r){if(!r)return 0;const i=this.level-r.level;if(Te(!cn||i>=0),i===0)return 0;const s=2**i,n=(1&e)==1,o=n?0:1,a=r.lij[o+1]*s,l=this.lij[o+1],c=l-a,h=n?s-1-c:c;return cn&&(Te(a<=l&&l<a+s),Te(0<=h&&h<s)),h}forEachLoadedNeighbor(e){const r=this.level,i=s=>s.level===r||s.isLoaded;Vf.forEach(s=>{const n=this.findNeighborTile(s,i);n!=null&&n!==this&&n.forAllSubtreeOnSide(YF(s),o=>!!o.isLoaded&&(e(o,s),!0))}),aM.forEach(s=>{const n=this.findNeighborTile(s,i)?.findCorner(ZF(s),o=>o.isLoaded);Te(!n||uW(this,n,s)),n?.isLoaded&&e(n,s)})}getNeighborLIJ(e,r){const i=Yce(r)?-1:Zce(r)?1:0,s=Wce(r)?-1:Xce(r)?1:0,n=[e[0],e[1]+i,e[2]+s];return n[1]<0?null:this.surface.isGlobal?this.wrapLIJ(n):n[2]<0?null:n}wrapLIJ(e){return!e||e[1]<0||e[1]>=2**e[0]?null:this.surface.wrapEastWest(e)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this.lij[2]===0}get isNorthEnd(){return this.lij[1]===0}get isSouthEnd(){const e=this.surface.extent,r=e?.[1]??null;return r!=null&&this.extent[1]+sl()>=r}checkGeometryWaterproofness(){qF&&(Te(this.isLoaded),this.renderData?.checkGeometryWaterproofness())}shouldHaveNeighbor(e){const r=this.extent,i=this.surface.rootTilesExtent,s=.25*(r[2]-r[0]);if(Yce(e)&&r[3]+s>=i[3]||Zce(e)&&r[1]-s<=i[1])return!1;const n=this.surface.isGlobal;return!(!n&&Wce(e)&&r[0]-s<=i[0])&&!(!n&&Xce(e)&&r[2]+s>=i[2])}updateDistanceToPOI(e){const r=this._lastPOI;if(this.distanceToPOI>=0&&r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2])return;re(this._lastPOI,e);const i=this._center[Vs.MIDDLE],s=e[0]-i[0],n=e[1]-i[1],o=e[2]-i[2];this.distanceToPOI=s*s+n*n+o*o}};function e_t(t,e,r,i){const s=r===rr.ELEVATION?_K.acquire():yK.acquire();return s.init(t,e,r,i),s}function hL(t){t.dispose(),t instanceof IOe?_K.release(t):t instanceof $Oe&&yK.release(t)}const yK=new Go($Oe),_K=new Go(IOe),t_t=new QS;var Vs;function r_t(t,e){const r=t.level,i=e[0];if(r>i)return!1;const s=i-r,n=Math.floor(e[1]/2**s),o=Math.floor(e[2]/2**s);return n===t.lij[1]&&o===t.lij[2]}function i_t(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function s_t(t,e,r){if(t==null||e==null)return!1;if(t.level===0&&e.level===0&&(t.isEastEnd&&e.isWestEnd&&r===ct.EAST||t.isWestEnd&&e.isEastEnd&&r===ct.WEST))return!0;const i=Math.max(1e-6*(t.extent[2]-t.extent[0]),1);switch(r){case ct.NORTH:return Sh(t.extent[3],e.extent[1],i);case ct.SOUTH:return Sh(t.extent[1],e.extent[3],i);case ct.EAST:return Sh(t.extent[2],e.extent[0],i)||Sh(t.extent[2],-e.extent[0],i);case ct.WEST:return Sh(t.extent[0],e.extent[2],i)||Sh(t.extent[0],-e.extent[2],i)}}function uW(t,e,r){return t!=null&&e!=null&&e!==t&&(t.level>=e.level?cue(t,e,r):cue(e,t,ZF(r)))}function cue(t,e,r){Te(t.level>=e.level);const i=Tyt(r),s=Syt(r),n=t.extent,o=e.extent,a=[i?n[0]:n[2],s?n[3]:n[1]],l=[i?o[2]:o[0],s?o[1]:o[3]],c=1e-5*(n[2]-n[0]),h=Sh(a[0],l[0],c)||t.surface.isGlobal&&Sh(a[0],-l[0],c),p=Sh(a[1],l[1],c);if(h&&p)return!0;if(t.level===e.level||!h&&!p)return Te(!1),!1;const f=h?uue(o[1],o[3],n[1],n[3],c):uue(o[0],o[2],n[0],n[2],c);return Te(f),f}function uue(t,e,r,i,s){return t-s<=r&&r<=i&&i<=e+s}(function(t){t[t.TOP=0]="TOP",t[t.MIDDLE=1]="MIDDLE",t[t.BOTTOM=2]="BOTTOM"})(Vs||(Vs={}));const dL=O(),Cz=O(),Az=O(),so=O();let n_t=class{constructor(){this._scales=Nt(-1,-1,-1,-1),this._offsets=Nt(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(e,r,i){this._scales[2*e]=r,this._scales[2*e+1]=i}setOffset(e,r,i){this._offsets[2*e]=r,this._offsets[2*e+1]=i}get scales(){return this._scales}get offsets(){return this._offsets}};function o_t(t,e){t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),e.spherical?t.vertex.code.add(w`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):t.vertex.code.add(w`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),t.fragment.code.add(w`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}let vK=class extends fAe{constructor(){super(...arguments),this.slicePlaneLocalOrigin=O(),this.origin=this.slicePlaneLocalOrigin,this.modelTransformation=null}};var _c;(function(t){t[t.Material=0]="Material",t[t.ShadowMap=1]="ShadowMap",t[t.Highlight=2]="Highlight"})(_c||(_c={}));let a_t=class extends vK{constructor(){super(...arguments),this.identifier=_c.Material,this.output=U.Color,this.transparent=!1,this.integratedMesh=!1}},l_t=class extends vK{constructor(){super(...arguments),this.identifier=_c.ShadowMap}},c_t=class extends vK{constructor(){super(...arguments),this.identifier=_c.Highlight}},JF=class extends hs{constructor(e,r){super(e,"vec4",ei.Draw,(i,s,n)=>i.setUniform4fv(e,r(s,n)))}};var ty;function u_t(t,e){const{vertex:r,fragment:i}=t;r.uniforms.add(new JF("overlayTexOffset",(s,n)=>h_t(s,n)),new JF("overlayTexScale",(s,n)=>d_t(s,n))),i.constants.add("overlayOpacity","float",1),i.uniforms.add(new et("ovColorTex",(s,n)=>hW(s,n))),FOe(t,e)}function FOe(t,e){e.pbrMode!==lt.Water&&e.pbrMode!==lt.WaterOnIntegratedMesh&&e.pbrMode!==lt.TerrainWithWater||t.include(yAe,e);const{vertex:r,fragment:i}=t;t.varyings.add("vtcOverlay","vec4"),r.code.add(w`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),i.code.add(w`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),i.code.add(w`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),i.code.add(w`vec4 getOverlayColorTexel(vec4 texCoords) {
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y)*texDim), 0);
vec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w)*texDim), 0);
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),e.pbrMode!==lt.Water&&e.pbrMode!==lt.WaterOnIntegratedMesh&&e.pbrMode!==lt.TerrainWithWater||(Cy(i),Sm(i),i.code.add(w`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function hW(t,e){return e.overlays.length===0?null:t.identifier===_c.Material&&t.output===U.Color?e.overlays[Li.INNER].getColorTextureNoRasterImage():t.identifier===_c.Material&&t.output===U.ObjectAndLayerIdColor?e.overlays[Li.INNER].getColorTexture(Ha.ObjectAndLayerIdColor):t.identifier===_c.Highlight?e.overlays[Li.INNER].getValidTexture(ns.Highlight):null}function h_t(t,e){for(const r of e.overlays){const{index:i,extent:s}=r;Nge(s)>0&&(P2[2*i]=t.toMapSpace[0]/pu(s)-s[0]/pu(s),P2[2*i+1]=t.toMapSpace[1]/wp(s)-s[1]/wp(s))}return P2}function d_t(t,e){for(const r of e.overlays){const{index:i,extent:s}=r;Nge(s)>0&&(P2[2*i]=t.toMapSpace[2]/pu(s),P2[2*i+1]=t.toMapSpace[3]/wp(s))}return P2}(function(t){t[t.Disabled=0]="Disabled",t[t.Enabled=1]="Enabled",t[t.EnabledWithWater=2]="EnabledWithWater",t[t.COUNT=3]="COUNT"})(ty||(ty={}));const P2=Xt();var Bf;(function(t){t[t.LayerOnly=0]="LayerOnly",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.COUNT=3]="COUNT"})(Bf||(Bf={}));let p_t=class extends kQ{constructor(){super(...arguments),this.overlayOpacity=1,this.overlaySource=Ha.None}};function xA(t,e){t.vertex.uniforms.add(new QF("overlayTexOffset"),new QF("overlayTexScale")),t.fragment.uniforms.add(new Pe("overlayOpacity",r=>r.overlayOpacity),new et("ovColorTex",(r,i)=>i.overlays.length===0?null:i.overlays[Li.INNER].getColorTexture(r.overlaySource))),FOe(t,e)}function f_t(t,e){const{vertex:r,fragment:i,varyings:s}=t;s.add("vtc","vec2"),r.uniforms.add(new QF("texOffsetAndScale")),i.uniforms.add(new hue("tex")),i.uniforms.add(new Oz("textureOpacities"));const n=e.textureFadingEnabled&&!e.renderOccluded;n&&(r.uniforms.add(new QF("nextTexOffsetAndScale")),s.add("nvtc","vec2"),i.uniforms.add(new hue("texNext")),i.uniforms.add(new Oz("nextTexOpacities")),i.uniforms.add(new m_t("fadeFactor")));const o=e.tileBlendInput===Bf.ColorComposite,a=e.tileBlendInput===Bf.GridComposite;a&&i.include(mK),o&&i.uniforms.add(new Oz("backgroundColor")),r.code.add(w`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${n?w`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:w``}
  }`),i.code.add(w`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${a||o?w`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${o?w`backgroundColor`:w`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:w`return color;`}
    }`),n?i.code.add(w`vec4 getTileColor() {
vec4 color = getColor(texture(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):i.code.add(w`vec4 getTileColor() {
return getColor(texture(tex, vtc), vtc, textureOpacities);
}`)}let m_t=class extends hs{constructor(e){super(e,"float")}},Oz=class extends hs{constructor(e){super(e,"vec3")}},QF=class extends hs{constructor(e){super(e,"vec4")}},hue=class extends hs{constructor(e){super(e,"sampler2D")}},UOe=class extends p_t{};function g_t(t){const e=new Sr,{vertex:r,fragment:i,varyings:s}=e;e.include(ZM),e.include(uP,t),e.include(Yf,t);const n=()=>{e.include(tM,t),r.code.add(w`vec3 getNormal() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
vec3 n = vec3(normalCompressed + vec2(normalCompressed.x >= 0.0 ? 1.0 : -1.0,
normalCompressed.y >= 0.0 ? 1.0 : -1.0) * min(z, 0.0), z);
return normalize(n);
}`)};Mc(r,t),e.include(Ml,t);const o=t.overlayMode!==ty.Disabled,a=o&&t.invisible;switch(t.output){case U.Color:{e.include(f_t,t),e.include(Hw,t),o&&e.include(xA,{...t,pbrMode:t.pbrMode===lt.Terrain?lt.TerrainWithWater:lt.Water});const l=t.overlayMode===ty.EnabledWithWater;l&&e.include(o_t,t),s.add("vnormal","vec3"),s.add("vpos","vec3"),s.add("vup","vec3"),n(),t.screenSizePerspective&&wE(r);const c=t.receiveShadows&&!t.renderOccluded;c&&e.include(cC,t),t.screenSizePerspective&&(s.add("screenSizeDistanceToCamera","float"),s.add("screenSizeCosAngle","float")),r.code.add(w`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          //Up
          vup = getLocalUp(position, localOrigin);

          ${l?w`forwardVertexTangent(vnormal);`:w``}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${o?w`setOverlayVTC(uv);`:""}
          ${t.tileBorders?w`forwardTextureCoordinates();`:""}

          ${t.screenSizePerspective?w`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${c?w`forwardLinearDepth();`:""}

        }
      `),e.include(ys,t),e.include(Hw,t),e.include(dP,t),e.include(Gw,t),Cp(i,t),pP(i),_C(i),i.uniforms.add(r.uniforms.get("localOrigin"),new zt("viewDirection",(h,p)=>ye(due,se(due,p.camera.viewMatrix[12],p.camera.viewMatrix[13],p.camera.viewMatrix[14])))),l&&i.uniforms.add(new et("ovWaterTex",(h,p)=>p.overlays.length===0?null:p.overlays[Li.INNER].getNormalTexture(h.overlaySource)),new F2e("view",(h,p)=>Fl(y_t,p.camera.viewMatrix,h.origin))),i.code.add(w`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),Cy(i),Sm(i),i.code.add(w`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${t.receiveShadows&&!t.renderOccluded?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${o?w`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${t.invisible?w`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a <= 0.0) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= sliceOpacity;
          }

          vec3 albedo = tileColor.rgb;

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${t.pbrMode===lt.Terrain||t.pbrMode===lt.TerrainWithWater?w`fragColor = vec4(evaluateTerrainLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:w`fragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${l?w`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                float opacity = sliced ? sliceOpacity : 1.0;
                // un-gamma the ground color to mix in linear space
                fragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
              }`:""}
          ${t.screenSizePerspective?w`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              fragColor = mix(fragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              fragColor = mix(fragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${t.visualizeNormals?t.spherical?w`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:w`
                  vec3 tNormal = normalize(normal);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:""}
          ${t.tileBorders?w`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          fragColor = highlightSlice(fragColor, vpos);
        }
      `)}break;case U.Depth:a&&e.include(xA,t),e.include(_y,t),av(e),Nw(e),r.code.add(w`
              void main(void) {
                ${a?w`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
              }
          `),i.code.add(w`
              void main() {
                ${a?w`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
                outputDepth(linearDepth);
              }
          `);break;case U.Shadow:case U.ShadowHighlight:case U.ShadowExcludeHighlight:e.include(_y,t),av(e),Nw(e),r.code.add(w`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),i.code.add(w`void main() {
outputDepth(linearDepth);
}`);break;case U.Normal:a&&e.include(xA,t),s.add("vnormal","vec3"),wE(r),n(),r.code.add(w`
            void main(void) {
              ${a?w`setOverlayVTC(getUV0());`:""}
              gl_Position = transformPosition(proj, view, position);
              vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);
            }
        `),i.code.add(w`
            void main() {
              ${a?w`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
              vec3 normal = normalize(vnormal);
              if (gl_FrontFacing == false) {
                normal = -normal;
              }
              fragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
            }
        `);break;case U.Highlight:o&&e.include(xA,t),r.code.add(w`
          void main() {
            ${o?w`setOverlayVTC(getUV0());`:""}
            gl_Position = transformPosition(proj, view, position);
          }
        `),e.include(Ly,t),i.code.add(w`
          void main() {
            ${o?w`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
            outputHighlight();
          }
        `)}return t.output===U.ObjectAndLayerIdColor&&(e.include(xA,{...t,pbrMode:lt.Disabled}),r.code.add(w`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),i.code.add(w`void main() {
fragColor = getOverlayColorTexel(vtcOverlay);
}`)),e}const y_t=be(),due=O(),__t=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:UOe,build:g_t},Symbol.toStringTag,{value:"Module"}));let kOe=class zOe extends Lr{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(e,r){r.spherical=e.viewingMode===Ue.Global}initializeProgram(e){return new Rr(e.rctx,zOe.shader.get().build(this.configuration),VOe)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(e){const r=this.configuration,i=r.backfaceCullingEnabled&&!r.renderOccluded;return Mt({blending:r.renderOccluded?Lc(xe.ONE,xe.ONE_MINUS_SRC_ALPHA):null,culling:i?cJ:null,depthTest:r.renderOccluded?null:{func:ti.LESS},depthWrite:r.renderOccluded?null:Ul,colorWrite:Gt,stencilTest:e?Dlt(Il.IntegratedMeshMaskExcluded):null})}getPipelineState(e,r){return this.useStencil?this._stencilPipelineState:super.getPipelineState(e,r)}};kOe.shader=new Or(__t,()=>ce(()=>import("./Terrain.glsl-fc39cfe9.js"),[],import.meta.url));const VOe=new Map([[C.POSITION,0],[C.UV0,1],[C.NORMALCOMPRESSED,2]]);let v_t=class{constructor(){this.geometry=new g0t,this.intersectionData=null,this.geometryState=null,this._textureRef=new OOe(()=>this.tile.surface.textureFadeDuration),this.overlay=new n_t,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1,this._dirtyEdgeResolutions=15,this._dirtyEdges=15,this._dirtyCorners=15}get tile(){return this._tile}init(e){this.clear(),this._tile=e;const r=this.geometry;r.indices=null,r.vertexAttributes=null,Si(r.boundingBox),r.indexCount=0,r.numVerticesPerSide=0,this.intersectionData=null,this.geometryState=new x0t,this.localOrigin=null,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(e){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this._wireframeChanged||this._clippingAreaChanged||this._samplerDataChanged||this._numVerticesPerSideChanged||this._dirtyCorners||this._dirtyEdgeResolutions||this._dirtyEdges)&&(this._updateGeometry(e),this._geometryStateChangedSinceLastUpdate=!1),cn&&this.tile.intersectsClippingArea)for(let r=0;r<4;++r)Te(this.geometry.outerEdges[r].count===this.geometryState.neighborData.edgeResolutions[r]+1)}_calculateEdgeResolution(e,r){const i=this.tile,s=this.geometryState.numVerticesPerSide-1;if(!i.surface.isGlobal){const l=i.surface.extent;if(l!=null&&(e===0&&i.extent[3]>l[3]||e===1&&i.extent[2]>l[2]||e===2&&i.extent[1]<l[1]||e===3&&i.extent[0]<l[0]))return s}const n=i.level,o=Vf[e];if(!r)return Te(i.surface?.rootTiles==null||i.surface.updatingRootTiles||!i.shouldHaveNeighbor(o)),s;if(r.isLoaded){const l=r,c=l.renderData.geometryState,h=n-l.level;if(Te(h>=0),h===0){const m=c.numVerticesPerSide-1;return Math.max(m,s)}const p=2**h,f=c.neighborData.edgeResolutions[(e+2)%4]/p;return Math.max(1,f)}Te(!r.isLeaf);let a=s;return r.forAllSubtreeOnSide(YF(o),l=>l===i||(l.isLoaded?(a=Math.max(a,2**(l.level-n)),!0):(Te(!l.isLeaf),!1))),a}updateNeighborData(){const e=this.tile;if(!e.intersectsClippingArea)return;const r=e.renderData.geometryState.neighborData,i=a=>(a.isLoaded||a.level===e.level)&&a?.intersectsClippingArea,s=r.edgePeerNeighbors,n=r.edgePeerNeighborSamplerVersions;for(let a=0;a<4;++a){const l=e.findNeighborTile(Vf[a],i),c=Ib(e,l),h=c?.renderData?.geometryState.samplerDataVersion??-1,p=s[a],f=c!==Ib(e,p),m=n[a]!==h;s[a]=l,(f||m)&&(n[a]=h,this._markEdgeDirty(a));const y=r.edgeResolutions[a],_=this._calculateEdgeResolution(a,l);Te(Sw(_)),Te(_>=1),r.edgeResolutions[a]=_,y!==_&&this._markEdgeResolutionDirty(a)}const o=r.cornerPeerNeighbors;for(let a=0;a<4;++a){const l=e.findNeighborTile(aM[a],i);o[a]=l;const c=Ib(e,s[a]),h=Ib(e,s[(a+1)%4]),p=Ib(e,l);pd[a]=p,pd[(a+1)%4]=h,pd[(a+2)%4]=e,pd[(a+3)%4]=c,Te(pd.some(_=>_?.isLoaded||_===e));const f=pd.reduce((_,v)=>Math.min(_,v?.level??1/0),1/0);pd.forEach((_,v)=>{_&&_?.level>f&&(pd[v]=null)}),Te(pd.some(_=>_?.isLoaded||_===e));const m=r.cornerNeighborData[a].cornerTiles,y=r.cornerNeighborData[a].cornerTileSamplerVersions;for(let _=0;_<4;++_){const v=pd[_],b=v?.renderData.geometryState.samplerDataVersion??-1,T=m[_]!==v,x=!T&&y[_]!==b;(T||x)&&(m[_]=v,y[_]=b,this._markCornerDirty(a))}Te(m.some(_=>_?.isLoaded||_===e))}cn&&Te(this.geometryState.neighborData.edgeResolutions.every(a=>a>0));for(let a=0;a<4;++a)pd[a]=null}_updateGeometry(e){if(!this.tile.intersectsClippingArea)return;cn&&Te(!this.tile.intersectsClippingArea||this.geometryState.neighborData.edgeResolutions.every(l=>l>0)),this.intersectionData=null;const r=this.tile,i=this._vao,s=this.geometry.vertexAttributes,n=!i||!s||this._wireframeChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||this._dirtyEdgeResolutions,o=!n&&(this._dirtyEdges!==0||this._dirtyEdgeResolutions!==0),a=!o&&this._dirtyCorners!==0;n?(this.releaseGeometry(),this._createGeometry(e)):o||a?r.updateEdgeElevations():a?r.updateCornerElevations():console.warn("Update for no reason?"),this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._dirtyEdgeResolutions=0,this._dirtyEdges=0,this._dirtyCorners=0,this._clippingAreaChanged=!1,this._wireframeChanged=!1}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao.dispose(),this._vao=null,v0t(this.geometry),!0)}ensureTexture(e,r){return this._texture!=null&&this._texture.descriptor.width!==e&&this.releaseTexture(),this._texture==null&&(this._texture=r(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){this._texture!=null&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}_markCornerDirty(e){const r=1<<e;this._dirtyCorners|=r}_markEdgeDirty(e){const r=1<<e;this._dirtyEdges|=r,this._markCornerDirty((e+0)%4),this._markCornerDirty((e+3)%4)}_markEdgeResolutionDirty(e){const r=1<<e;this._dirtyEdgeResolutions|=r,this._markEdgeDirty(e)}_markAllEdgesAndCornersDirty(){this._dirtyCorners=15,this._dirtyEdges=15,this._dirtyEdgeResolutions=15}updateGeometryState(){const e=this._getElevationInfo(),r=this.tile,i=e.samplerData?r.getElevationVerticesPerSide(e.maxTileLevel):r.getDefaultVerticesPerSide(),s=Math.max(i,5);let n=r.clippingArea;r.intersectsClippingArea&&!r.isWithinClippingArea||(n=null);const o=this.geometryState;let a=!1;o.numVerticesPerSide!==s&&(this._numVerticesPerSideChanged=!0,o.numVerticesPerSide=s,o.samplerDataVersion++,a=!0),e.changed&&(this._samplerDataChanged=!0,o.samplerData=e.samplerData,o.samplerDataVersion++,a=!0),ry(o.clippingArea,n)||(this._clippingAreaChanged=!0,o.clippingArea=n,a=!0);const l=r.surface.wireframe;return o.wireframe!==l&&(this._wireframeChanged=!0,o.wireframe=l,a=!0),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=a),a&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(e){this.tile.createGeometry();const r=this.geometry.vertexAttributes,i=this.geometry.indices,s=e.gl;this._vao=new Rp(e,VOe,{geometry:Fc(r.layout)},{geometry:Ur.createVertex(e,s.STATIC_DRAW,r.buffer)},Ur.createIndex(e,s.STATIC_DRAW,i)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(e,r=Kg.Immediate){e!=null&&e.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(e,r)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const e=this.geometryState.samplerData,r=this.tile.layerInfo[rr.ELEVATION],i=r.length,s=new Array(i);let n=0,o=0,a=!1;for(let h=0;h<i;h++){const p=r[h];if(p.upsampleInfo!=null){const f=p.upsampleInfo.tile,m=f.layerInfo[rr.ELEVATION][h].data,y=m&&m.samplerData;e&&e[n]===y||(a=!0),s[n++]=y,o=Math.max(o,f.lij[0])}else if(p.data){const f=this.tile.surface.layerViewByIndex(h,rr.ELEVATION);if(oR(this.tile,f.layer,!1)){const m=p.data;e&&e[n]===m.samplerData||(a=!0),s[n++]=m.samplerData,o=this.tile.level}}}e!=null&&e.length!==n&&(a=!0);const l=n>0,c=l?s:null;return l&&(s.length=n),{changed:a,samplerData:c,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){const e=this.intersectionData?.estimatedMemoryUsage??0;return(this.geometry.indices?.byteLength??0)+(this.geometry.vertexAttributes?.byteLength??0)+e}get texture(){return this._texture}get test(){return{hasTexture:this._texture!=null}}checkGeometryWaterproofness(){if(!cn)return;const e=this.tile;if(!e.isLoaded||!e.intersectsClippingArea||e.level===0)return void Te(e?.isLoaded);const r=e.surface.extent;if(r!=null&&!e.intersectsExtent(r))return;const i=Vf.map((a,l)=>r!=null&&(l<2?-1:1)*(e.extent[3-l]-r[3-l])<0),s=e.level;Te(this._dirtyCorners===0),Te(this._dirtyEdges===0),Te(this._dirtyEdgeResolutions===0),Te(!this._numVerticesPerSideChanged),Te(!this._samplerDataChanged),Te(!this._clippingAreaChanged),Te(!this._wireframeChanged);const n=aM.map(a=>e.findNeighborCornerTileExact(a,l=>!l.intersectsClippingArea||l.isLoaded||l.level===e.level)??null).map(a=>a?.intersectsClippingArea?a:null),o=this.geometryState.neighborData;for(let a=0;a<4;++a){const l=o.cornerPeerNeighbors[a],c=n[a];Te(c===l,`Tile[${e.lij}].corner[${a}] out of date: cur=[${l?.lij}] exp=[${c?.lij}]`)}Vf.forEach((a,l)=>{if(i[l])return;const c=e.findNeighborTile(a,F=>(F.level===s||F?.isLoaded)&&F?.intersectsClippingArea);if(!c){const F=!e.surface.updatingRootTiles&&e.surface.rootTiles!=null&&e.surface.rootTiles.length>0&&e.shouldHaveNeighbor(a);return void Te(!F)}Te(c.isLoaded||c.level===e.level),Te(c===this.geometryState.neighborData.edgePeerNeighbors[l]);const h=s-c.level;if(!c.isLoaded)return Te(!c.isLeaf),void Te(h===0);const p=c.renderData;Te(s_t(e,c,a)),Te(h>=0);const f=2**h;if(h<0)return void Te(!1);const m=e.renderData,y=m.geometry,_=y.outerEdges[l],v=y.numVerticesPerSide-1,b=p.geometry;if(!b)return void Te(!1);const T=this.geometryState.neighborData.edgePeerNeighbors[l];if(T?.isLoaded){const F=T.renderData;Te(T==T),Te(m.geometryState.neighborData.edgePeerNeighborSamplerVersions[l]===F.geometryState.samplerDataVersion),Te(this.geometryState.neighborData.edgePeerNeighborSamplerVersions[l]===F.geometryState.samplerDataVersion)}const x=(l+2)%4,S=b.outerEdges[x],E=_.count-1,A=S.count-1;Te(E*f===A,`Tile[${e.lij}]:e${l},res=${E} edgeRes mismatch with Neighbor[${c.lij}]:e${x},res=${A} (expected:${E*f})`);const R=e.extent,M=a===ct.NORTH||a===ct.SOUTH,D=S.count-1,k=D/2**h,$=_.count-1;if(k<1)return void Te($===1);Te(k===$),Te(Sw(k));const N=b.numVerticesPerSide-1;Te(h>0||k===Math.max(N,v));const H=e.getNeighborEdgeStartVertexIndex(l,c);Te(0<=H&&H<f);const Z=H*k;Te(0<=Z&&Z<=D-k);let G=0,J=Z;_.getVertexPos(Qp,0),_.getVertexPos(Kp,_.count-1);const I=fi(Qp,Kp),z=Math.max(b_t,1e-4*I);for(let F=0;F<=k;++F){_.getVertexPos(Qp,G),S.getVertexPos(Kp,J);const j=F/k,W=M?R[0]+j*(R[2]-R[0]):a===ct.WEST?R[0]:R[2],Y=M?a===ct.SOUTH?R[1]:R[3]:R[1]+j*(R[3]-R[1]),te=e.surface.extent;if(te==null||K5(te,W,Y)){const me=CM(Qp,Kp),Le=lc(Qp)-or.radius,dt=lc(Kp)-or.radius,st=me<z;if(!st){console.warn(`Tile edge vertex position mismatch: between [${e.lij}].edge${l}[${G}/${_.count}] and [${c.lij}].edge${x}[${J}/${S.count}]`),te!=null&&console.warn("  surface extent= ",te," x,y=",W,",",Y);const ge=O();de(ge,m.localOrigin,p.localOrigin),lc(ge)>0&&console.warn(`   localOrigins: ${m.localOrigin} vs ${p.localOrigin} d=${lc(ge)} [${ge}]`),(()=>{const Ce=Fs(Qp),bt=Fs(Kp);e.updateEdgeElevations(),c.updateEdgeElevations(),_.getVertexPos(Qp,G),S.getVertexPos(Kp,J);const _e=O();On(_e,Qp,Ce),lc(_e)>0&&console.warn(`  XXX Tile[${e.lij}] edge out of date: ${Ce} vs ${Qp} d=${lc(_e)} [${_e}]`),On(_e,Kp,bt),lc(_e)>0&&console.warn(`  XXX Neighbor[${c.lij}] edge out of date: ${bt} vs ${Kp} d=${lc(_e)} [${_e}]`)})(),Te(st,`Mismatch in tile [${e.lij}].edge[${l}][${G}/${_.count}] vs neighbor [${c.lij}].edge[${x}][${J}/${S.count}] ${jm(Qp)} vs ${jm(Kp)}  dist=${me} h(t|n|d)=${Le}|${dt}|${dt-Le}`)}_.getNormal(wT,G),S.getNormal(xT,J),ye(pue,wT),ye(fue,xT);const Xe=fe(pue,fue),yt=1-Xe<.01||!1||e===c;if(!yt){const ge=O();On(ge,wT,xT);const Ce=()=>`Mismatch in tile edge normal ${qce(e.lij)} (${G}/${_.count-1}) edge ${l} vs neighbor ${qce(c.lij)}  (${J}/${S.count-1}) nedge ${x} :${jm(wT)} vs ${jm(xT)}  dot = ${Xe} : ${jm(ge)}`;console.warn("Mismatch in tile edge normal: ",Ce());{e.updateEdgeElevations(),c.updateEdgeElevations();const bt=O(),_e=O();_.getNormal(bt,G),S.getNormal(_e,J),X_(wT,bt)||console.warn("Missing update in tile normal: ",jm(wT)," => ",jm(bt)),X_(xT,_e)||console.warn("Missing update in neighbor normal: ",jm(xT)," => ",jm(_e))}Te(yt,Ce())}}G+=1,J+=1}})}};const Qp=O(),Kp=O(),wT=O(),xT=O(),pue=O(),fue=O(),b_t=1,pd=[null,null,null,null];function Ib(t,e){return e?.isLoaded||e===t?e:null}const w_t=65536;function x_t(t,e){const r=t.tile,{extent:i,extentInRadians:s,surface:n}=r,o=t.localOrigin,a=t.geometryState,l=n.isWebMercator,c=a.numVerticesPerSide,h=c-1,p=(c-2)**2,f=l&&(e===xh.HAS_SOUTH_POLE||e===xh.HAS_BOTH_POLES),m=l&&(e===xh.HAS_NORTH_POLE||e===xh.HAS_BOTH_POLES),y=6,_=((f?1:0)+(m?1:0))*y*(h+1),v=a.neighborData,b=v.edgeResolutions.reduce((R,M)=>R+M+1,0),T=AOe(p+_+b),x=t.geometry;x.numVerticesPerSide=a.numVerticesPerSide,x.vertexAttributes=T;const S=x.boundingBox;Si(S);const E=bK(t);po.update(h,s,E),T_t(t),JOe(t,p),BOe(t);const A=[];if((()=>{let R=p+b;const M=o[0],D=o[1],k=o[2],$=r.ellipsoid.radius,N=i[1],H=i[3],Z=(G,J)=>{const I=J*c;Dh(-M,-D,G*$-k,S),A.push({connectedRowOffset:I,connectedOuterEdgeOffset:G===1?0:2,rowOffset:R,latitudeResolution:y});const z=HOe(G===-1?N:H,$),F=G*Math.PI/2-z,j=.99*(G===1?1:-1),W=$+0,Y=T.position,te=T.uv0,{typedBuffer:me,typedBufferStride:Le}=T.normalCompressed;for(let dt=1;dt<=y;++dt){const st=z+F*(dt/y),Xe=Math.cos(st),yt=Math.sin(st);for(let ge=0;ge<=h;ge++){const Ce=ge/h,bt=po.sinLonLUT[ge],_e=po.cosLonLUT[ge]*Xe,Be=bt*Xe,qe=yt,ft=_e*W-M,Se=Be*W-D,Re=qe*W-k;Dh(ft,Se,Re,S),Y.setValues(R,ft,Se,Re),yp(te,R,Ce,j),jw(me,R,_e,Be,qe,Le),++R}}};f&&Z(-1,0),m&&Z(1,h)})(),YOe(x,a.numVerticesPerSide,A,[0,c-1],[0,c-1],a.wireframe),t.intersectionData=null,cn)for(let R=0;R<4;++R)Te(x.outerEdges[R].count===v.edgeResolutions[R]+1)}function T_t(t){const e=t.tile;if(!e.intersectsClippingArea)return;const r=t.geometryState,i=r.numVerticesPerSide,s=i-2,n=i-1,o=t.geometry,a=o.vertexAttributes,l=a.position,c=a.uv0,{typedBuffer:h,typedBufferStride:p}=a.normalCompressed,f=e.extent,m=f[0],y=f[2],_=f[1],v=f[3],b=e.ellipsoid.radius,T=r.samplerData,x=t.localOrigin,S=x[0],E=x[1],A=x[2],R=l.typedBuffer,M=l.typedBufferStride,D=1/n,k=o.boundingBox;let $=0;if(1<=s){const N=D,H=_*(1-N)+v*N,Z=po.sinLatLUT[1],G=po.cosLatLUT[1];for(let J=1;J<=s;J++){const I=J*D,z=m*(1-I)+y*I,F=po.sinLonLUT[J],j=po.cosLonLUT[J],W=b+Yi(z,H,T),Y=W*j*G-S,te=W*F*G-E,me=W*Z-A;Dh(Y,te,me,k);const Le=(J-1)*M;R[Le]=Y,R[Le+1]=te,R[Le+2]=me,yp(c,J-1,I,N)}}for(let N=1;N<=s;N++){const H=N*D,Z=_*(1-H)+v*H,G=po.sinLatLUT[N],J=po.cosLatLUT[N],I=N+1,z=I*D,F=_*(1-z)+v*z,j=po.sinLatLUT[I],W=po.cosLatLUT[I],Y=po.sinLonLUT[0],te=po.cosLonLUT[0],me=b+Yi(m,Z,T);let Le=te*J*me-S,dt=Y*J*me-E,st=G*me-A;const Xe=$*M;let yt=R[Xe],ge=R[Xe+1],Ce=R[Xe+2];for(let bt=1;bt<=s;bt++){const _e=bt*D,Be=m*(1-_e)+y*_e,qe=po.sinLonLUT[bt],ft=po.cosLonLUT[bt];let Se=0,Re=0,pt=0;if(bt<s){const _r=($+1)*M;Se=R[_r],Re=R[_r+1],pt=R[_r+2]}else{const _r=po.sinLonLUT[n],ci=po.cosLonLUT[n],js=b+Yi(y,Z,T);Se=ci*J*js-S,Re=_r*J*js-E,pt=G*js-A}const Ut=Le,ir=dt,gi=st;Le=yt,dt=ge,st=Ce,yt=Se,ge=Re,Ce=pt;const ot=Se-Ut,at=Re-ir,wt=pt-gi;let Jt=0,sr=0,Wr=0;if(N>1){const _r=($-s)*M;Jt=R[_r],sr=R[_r+1],Wr=R[_r+2]}else{const _r=po.sinLatLUT[0],ci=po.cosLatLUT[0],js=b+Yi(Be,_,T);Jt=ft*ci*js-S,sr=qe*ci*js-E,Wr=_r*js-A}const yi=b+Yi(Be,F,T),Qt=ft*W*yi-S,_i=qe*W*yi-E,ki=j*yi-A;if(N<s){const _r=$+s,ci=_r*M;R[ci]=Qt,R[ci+1]=_i,R[ci+2]=ki,Dh(Qt,_i,ki,k),yp(c,_r,_e,z)}const jr=Jt-Qt,Er=sr-_i,qi=Wr-ki;let xs=ft*J,Dr=qe*J,ii=G;ii*ii<.999&&(xs=wt*Er-at*qi,Dr=ot*qi-wt*jr,ii=at*jr-ot*Er);const Xr=1/Math.sqrt(xs*xs+Dr*Dr+ii*ii);jw(h,$,xs*Xr,Dr*Xr,ii*Xr,p),++$}}}function S_t(t){t.tile.intersectsClippingArea&&(BOe(t),t8(t))}function E_t(t){t.tile.intersectsClippingArea&&(jOe(t),GOe(t,!0),t8(t))}function BOe(t){t.tile.intersectsClippingArea&&(jOe(t),GOe(t))}function GOe(t,e=!1){const r=t.geometryState,i=t.geometry,s=r.neighborData,n=t.tile,o=n.level,a=n.extent,l=n.ellipsoid.radius,c=n.extentInRadians,h=c[0],p=c[2],f=c[1],m=c[3],y=r.samplerData,_=a[0],v=a[2],b=a[1],T=a[3],x=bK(t),S=i.boundingBox,E=t.localOrigin,A=E[0],R=E[1],M=E[2],D=i.vertexAttributes,k=D.position,$=k.typedBuffer,N=k.typedBufferStride,H=D.uv0;for(let Z=0;Z<4;++Z){const G=Z===1||Z===3,J=s.edgeResolutions[Z];Te(Sw(J));const I=J+1,z=Ib(n,s.edgePeerNeighbors[Z]);if(eRe(n,z,Z)){QOe(t,Z,z);continue}const F=z!=null;Te(!F||z.level===n.level),Te(!F||ey(n,z)<=0);const j=z?.renderData,W=j?.geometryState;if(cn){const ot=n.surface;if(!z&&ot&&!ot.updatingRootTiles){const at=Vf[Z],wt=n.findNeighborTile(at,Jt=>Jt.isLoaded||Jt.isLeaf||Jt.level===n.level);wt?wt.intersectsClippingArea&&(Te(!wt.isLoaded),Te(!wt.isLeaf),Te(wt.level===o)):Te(ot?.rootTiles==null||!n.shouldHaveNeighbor(at))}}const Y=Z===1?a[2]:a[0],te=z?.extent,me=te&&G?Z===1?te[0]:te[2]:Y,Le=Z===0?a[3]:a[1],dt=Z===1?1:0,st=Z===0?1:0,Xe=Z===1?p:h,yt=Z===0?m:f,ge=Math.sin(Xe),Ce=Math.cos(Xe),bt=Math.sin(yt),_e=Math.cos(yt),Be=W?.samplerData,qe=F?(ot,at,wt)=>.5*(Yi(ot,at,y)+Yi(wt,at,Be)):(ot,at,wt)=>Yi(ot,at,y),ft=i.outerEdges[Z],Se=e&&I>3?I-3:1,Re=y!=null&&y.some(ot=>ot!=null),pt=Be!=null&&Be.some(ot=>ot!=null),Ut=Re||pt,ir=1/J,gi=ft.index0;Te(!te||Sh(te[2]-te[0],a[2]-a[0])),(()=>{const ot=Z===1?-1:Z===3?1:0,at=Z===0?-1:Z===2?1:0,wt=(a[2]-a[0])*ir,Jt=ot*wt,sr=at*wt,Wr=G?ot*((p-h)*ir):0,yi=G?0:at*ir,Qt=st,_i=G?Xe+Wr:Xe,ki=G?Math.sin(_i):ge,jr=G?Math.cos(_i):Ce,Er=G?Xe-Wr:Xe,qi=G?Math.sin(Er):ge,xs=G?Math.cos(Er):Ce,Dr=G?yt:x(Qt+yi),ii=G?bt:Math.sin(Dr),Xr=G?_e:Math.cos(Dr),_r=G?yt:x(Qt-yi),ci=G?bt:Math.sin(_r),js=G?_e:Math.cos(_r);let eo=0,to=0,mn=0;{const Zr=0*ir,$n=G?Y:_*(1-Zr)+v*Zr,Ao=G?me:$n,ba=G?b*(1-Zr)+T*Zr:Le,ne=G?Xe:h*(1-Zr)+p*Zr,Ei=G?ge:Math.sin(ne),Kh=G?Ce:Math.cos(ne),Ln=G?x(Zr):yt,ed=G?Math.sin(Ln):bt,tt=G?Math.cos(Ln):_e,zl=l+qe($n,ba,Ao);eo=Kh*tt*zl,to=Ei*tt*zl,mn=ed*zl}let gn=0,Wi=0,yn=0;{const Zr=1*ir,$n=G?Y:_*(1-Zr)+v*Zr,Ao=G?me:$n,ba=G?b*(1-Zr)+T*Zr:Le,ne=G?Xe:h*(1-Zr)+p*Zr,Ei=G?ge:Math.sin(ne),Kh=G?Ce:Math.cos(ne),Ln=G?x(Zr):yt,ed=G?Math.sin(Ln):bt,tt=G?Math.cos(Ln):_e,zl=l+qe($n,ba,Ao);gn=Kh*tt*zl,Wi=Ei*tt*zl,yn=ed*zl}for(let Zr=1;Zr<I-1;Zr+=Se){let $n=0,Ao=0,ba=0;{const wa=(Zr+1)*ir,Vl=G?Y:_*(1-wa)+v*wa,Lp=G?me:Vl,Nn=G?b*(1-wa)+T*wa:Le,ts=G?Xe:h*(1-wa)+p*wa,ky=G?ge:Math.sin(ts),$v=G?Ce:Math.cos(ts),Lv=G?x(wa):yt,Tx=G?Math.sin(Lv):bt,Dv=G?Math.cos(Lv):_e,zy=l+qe(Vl,Nn,Lp);$n=$v*Dv*zy,Ao=ky*Dv*zy,ba=Tx*zy}const ne=$n,Ei=Ao,Kh=ba,Ln=gn,ed=Wi,tt=yn;gn=ne,Wi=Ei,yn=Kh;{const wa=gi+Zr,Vl=wa*N,Lp=Ln-A,Nn=ed-R,ts=tt-M;$[Vl]=Lp,$[Vl+1]=Nn,$[Vl+2]=ts,Dh(Lp,Nn,ts,S);const ky=Zr*ir;yp(H,wa,G?dt:ky,G?ky:st)}const zl=eo,Dn=to,Mv=mn;eo=Ln,to=ed,mn=tt;const Pv=Ln,nl=ed,Rm=tt,Iv=1/Math.sqrt(Pv*Pv+nl*nl+Rm*Rm),Kt=Rm*Iv;let Fy=0,Mm=0,Uy=0;if(Ut&&Kt*Kt<.999){let wa=0,Vl=0,Lp=0;{const Nn=Z===0?-1:1;wa=Nn*(ne-zl),Vl=Nn*(Ei-Dn),Lp=Nn*(Kh-Mv)}{const Nn=Zr*ir,ts=G?Y:_*(1-Nn)+v*Nn,ky=G?me:ts,$v=G?b*(1-Nn)+T*Nn:Le,Lv=G?Xe:h*(1-Nn)+p*Nn,Tx=G?ge:Math.sin(Lv),Dv=G?Ce:Math.cos(Lv),zy=G?x(Nn):yt,TP=G?Math.sin(zy):bt,ol=G?Math.cos(zy):_e;let vC=Pv,bC=nl,q=Rm;if(F){const pe=l+Yi(ky-Jt,$v-sr,Be),Ee=G?ol:js;vC=(G?xs:Dv)*Ee*pe,bC=(G?qi:Tx)*Ee*pe,q=(G?TP:ci)*pe}{const pe=l+Yi(ts+Jt,$v+sr,y),Ee=G?ol:Xr,dr=(G?jr:Dv)*Ee*pe,Hs=(G?ki:Tx)*Ee*pe,vi=(G?TP:ii)*pe;F||(vC=2*Pv-dr,bC=2*nl-Hs,q=2*Rm-vi);const xa=Z===3?-1:1,Nv=xa*(vC-dr),see=xa*(bC-Hs),nee=xa*(q-vi);Fy=Lp*see-Vl*nee,Mm=wa*nee-Lp*Nv,Uy=Vl*Nv-wa*see;const d8=1/Math.sqrt(Fy*Fy+Mm*Mm+Uy*Uy);Fy*=d8,Mm*=d8,Uy*=d8}}}else Fy=Pv*Iv,Mm=nl*Iv,Uy=Rm*Iv;ft.setNormalFromValues(Zr,Fy,Mm,Uy)}})()}}function jOe(t){KOe(t)}function HOe(t,e){return Math.PI/2-2*Math.atan(Math.exp(-t/e))}function C_t(t,e,r,i){return HOe(t*(1-i)+e*i,r)}function A_t(t,e,r){return t*(1-r)+e*r}function bK(t){const e=t.tile;if(e.surface.isWebMercator){const i=e.extent,s=e.ellipsoid.radius;return n=>C_t(i[1],i[3],s,n)}const r=e.extentInRadians;return i=>A_t(r[1],r[3],i)}function O_t(t,e){const r=t.tile.extent,i=t.geometryState,s=r[0],n=r[1],o=r[2]-s,a=r[3]-n,l=i.clippingArea,c=l!=null?Math.max(0,(l[0]-s)/o):0,h=l!=null?Math.max(0,(l[1]-n)/a):0,p=l!=null?Math.min(1,(l[2]-s)/o):1,f=l!=null?Math.min(1,(l[3]-n)/a):1,m=i.numVerticesPerSide,y=(m-2)**2,_=i.neighborData.edgeResolutions.reduce((x,S)=>x+S+1,0),v=AOe(y+_),b=t.geometry,T=b.boundingBox;Si(T),b.numVerticesPerSide=i.numVerticesPerSide,b.vertexAttributes=v,xi(b.uvRange,c,h,p,f),R_t(t),JOe(t,y),qOe(t),YOe(b,i.numVerticesPerSide,[],[0,m-1],[0,m-1],i.wireframe),t.intersectionData=null}function R_t(t){const e=t.tile;if(!e.intersectsClippingArea)return;const r=e.surface,i=t.geometryState,s=i.samplerData,n=t.localOrigin,o=r.isWebMercatorOnPlateeCarree,a=i.clippingArea,l=a??wK,c=e.extent,h=c[0],p=c[1],f=c[2],m=c[3],y=Math.max(h,l[0]),_=Math.min(f,l[2]),v=Math.max(p,l[1]),b=Math.min(m,l[3]),T=e.ellipsoid.radius,x=e.horizontalScale,S=i.numVerticesPerSide,E=S-1,A=S-2,R=t.geometry,M=R.vertexAttributes,D=M.position,k=M.uv0,{typedBuffer:$,typedBufferStride:N}=M.normalCompressed,H=R.uvRange,Z=H[0],G=H[1],J=H[2],I=H[3],z=R.boundingBox,F=n[0],j=n[1],W=n[2],Y=D.typedBuffer,te=D.typedBufferStride;let me=0;const Le=ve(p,v,b),dt=o?(Math.PI/2-2*Math.atan(Math.exp(-Le/T)))*T:Le*x,st=1/E,Xe=ve(p*(1-st)+m*st,v,b);let yt=dt,ge=o?(Math.PI/2-2*Math.atan(Math.exp(-Xe/T)))*T:Xe*x;for(let Ce=1;Ce<=A;Ce++){const bt=Ce/E,_e=ve(p*(1-bt)+m*bt,v,b),Be=ve(bt,G,I),qe=ge,ft=(Ce-1)/E,Se=ve(p*(1-ft)+m*ft,v,b),Re=yt,pt=(Ce+1)/E,Ut=ve(p*(1-pt)+m*pt,v,b),ir=o?(Math.PI/2-2*Math.atan(Math.exp(-Ut/T)))*T:Ut*x,gi=ve(pt,G,I);yt=ge,ge=ir;const ot=ve(h,y,_);let at=ot*x,wt=Yi(ot,_e,s);const Jt=1/E,sr=ve(Jt,Z,J),Wr=ve(h*(1-sr)+f*sr,y,_);let yi=sr,Qt=Wr,_i=Wr*x,ki=Yi(Wr,_e,s);if(Ce===1){const jr=_i-F,Er=yt-j,qi=ki-W,xs=0*te;Y[xs]=jr,Y[xs+1]=Er,Y[xs+2]=qi,Dh(jr,Er,qi,z);const Dr=ve(Jt,Z,J);yp(k,me,Dr,Be)}for(let jr=1;jr<=A;jr++){const Er=_i,qi=ki,xs=(jr+1)/E,Dr=ve(xs,Z,J),ii=ve(h*(1-xs)+f*xs,y,_),Xr=Qt;Qt=ii;{const Wi=me+1,yn=Wi*te;if(Ce===1||jr===A){const Zr=ii*x,$n=Yi(ii,_e,s);if(Ce===1&&jr<A){const Ao=Zr-F,ba=qe-j,ne=$n-W;Y[yn]=Ao,Y[yn+1]=ba,Y[yn+2]=ne,Dh(Ao,ba,ne,z),yp(k,Wi,Dr,Be)}_i=Zr,ki=$n}else _i=Y[yn]+F,ki=Y[yn+2]+W}const _r=_i,ci=ki,js=at,eo=wt;at=Er,wt=qi;const to=(me-A)*te,mn=Ce===1?Yi(Xr,Se,s):Y[to+2]+W,gn=Yi(Xr,Ut,s);if(Ce<A){const Wi=me+A,yn=Wi*te,Zr=Er-F,$n=ir-j,Ao=gn-W;Y[yn]=Zr,Y[yn+1]=$n,Y[yn+2]=Ao,Dh(Zr,$n,Ao,z);const ba=yi;yi=Dr,yp(k,Wi,ba,gi)}{const Wi=_r-js,yn=Re-ir,Zr=yn*(ci-eo),$n=Wi*(mn-gn),Ao=-yn*Wi,ba=Zr*Zr+$n*$n+Ao*Ao;if(ba===0)jw($,me,0,0,1,N);else{const ne=1/Math.sqrt(ba);jw($,me,Zr*ne,$n*ne,Ao*ne,N)}}++me}}}function M_t(t,e){t.tile.intersectsClippingArea&&(XOe(t),WOe(t,!0),t8(t))}function P_t(t,e){t.tile.intersectsClippingArea&&(qOe(t),t8(t))}function qOe(t,e){t.tile.intersectsClippingArea&&(XOe(t),WOe(t,!1))}function WOe(t,e){const r=t.geometryState,i=r.neighborData,s=t.tile,n=s.surface,o=s.extent,a=r.clippingArea,l=a??wK,c=o[0],h=o[2],p=o[1],f=o[3],m=[f>l[3],h>l[2],p<l[1],c<l[0]],y=t.geometry,_=s.horizontalScale,v=ZOe(n.isWebMercatorOnPlateeCarree,s.ellipsoid.radius,_),b=y.boundingBox,T=y.uvRange[0],x=y.uvRange[1],S=y.uvRange[2],E=y.uvRange[3],A=Math.max(c,l[0]),R=Math.min(h,l[2]),M=Math.max(p,l[1]),D=Math.min(f,l[3]),k=t.localOrigin,$=k[0],N=k[1],H=k[2],Z=r.samplerData;for(let G=0;G<4;++G){const J=G===1||G===3,I=i.edgeResolutions[G];Te(Sw(I));const z=I+1,F=m[G],j=Ib(s,i.edgePeerNeighbors[G]);if(!F&&eRe(s,j,G)){QOe(t,G,j);continue}const W=j!=null&&!F,Y=j?.renderData,te=Y?.geometryState;if(cn&&(Te(!W||j.level===s.level),Te(!W||ey(s,j)<=0),s&&!j&&!n.updatingRootTiles)){const ot=Vf[G],at=s.findNeighborTile(ot,wt=>wt.isLoaded||wt.isLeaf||wt.level===s.level);n.updatingRootTiles||(at?at.intersectsClippingArea&&(Te(!at.isLoaded),Te(!at.isLeaf),Te(at.level===s.level)):Te(n?.rootTiles==null||!s.shouldHaveNeighbor(ot)))}const me=ve(G===1?h:c,A,R),Le=ve(G===0?f:p,M,D),dt=te?.samplerData,st=y.outerEdges[G],Xe=e&&z>3?z-3:1,yt=ve(G===1?1:0,T,S),ge=ve(G===0?1:0,x,E),Ce=W?(ot,at)=>.5*(Yi(ot,at,dt)+Yi(ot,at,Z)):(ot,at)=>Yi(ot,at,Z),bt=(h-c)/I,_e=J?G===1?bt:-bt:0,Be=J?0:G===0?bt:-bt,qe=-_e,ft=-Be;let Se=0,Re=0,pt=0;{const ot=0/I,at=J?me:ve(c*(1-ot)+h*ot,A,R),wt=J?ve(p*(1-ot)+f*ot,M,D):Le,Jt=Ce(at,wt);Se=at*_,Re=v(wt),pt=Jt}let Ut=0,ir=0,gi=0;{const ot=1/I,at=J?me:ve(c*(1-ot)+h*ot,A,R),wt=J?ve(p*(1-ot)+f*ot,M,D):Le,Jt=Ce(at,wt);Ut=at*_,ir=v(wt),gi=Jt}for(let ot=1;ot<z-1;ot+=Xe){const at=ot/I,wt=Ut,Jt=ir,sr=gi;{const Dr=J?yt:ve(at,T,S),ii=J?ve(at,x,E):ge,Xr=wt-$,_r=Jt-N,ci=sr-H;Dh(wt,_r,ci,b),st.setVertexFromValuesRawPositionUV(ot,Xr,_r,ci,Dr,ii)}{const Dr=(ot+1)/I,ii=J?me:ve(c*(1-Dr)+h*Dr,A,R),Xr=J?ve(p*(1-Dr)+f*Dr,M,D):Le,_r=Ce(ii,Xr);Ut=ii*_,ir=v(Xr),gi=_r}const Wr=Ut,yi=gi,Qt=Se,_i=Re,ki=pt;Se=wt,Re=Jt,pt=sr;let jr=0,Er=0,qi=0;if(J){const Dr=ir-Jt,ii=yi-sr,Xr=_i-Jt,_r=ki-sr,ci=ve(p*(1-at)+f*at,M,D),js=me+qe,eo=js*_-wt,to=Yi(js,ci,Z)-sr,mn=G===3?-1:1;if(jr=mn*(-Xr+Dr)*to,Er=mn*eo*(-_r+ii),qi=-mn*eo*(-Xr+Dr),W){const gn=me+_e,Wi=gn*_-wt;jr=(-Xr+Dr)*(to-(Yi(gn,ci,dt)-sr)),Er=(eo-Wi)*(-_r+ii),qi=-(eo-Wi)*(-Xr+Dr)}}else{const Dr=Wr-wt,ii=yi-sr,Xr=Qt-wt,_r=ki-sr,ci=ve(c*(1-at)+h*at,A,R),js=Le+ft,eo=Yi(ci,js,Z)-sr,to=v(js)-Jt,mn=G===2?-1:1;if(jr=mn*to*(-_r+ii),Er=mn*(-Xr+Dr)*eo,qi=-mn*to*(-Xr+Dr),W){const gn=ci,Wi=Le+Be,yn=v(Wi)-Jt;jr=(-to+yn)*(-_r+ii),Er=(-Xr+Dr)*(-eo+(Yi(gn,Wi,dt)-sr)),qi=-(-to+yn)*(-Xr+Dr)}}const xs=1/Math.sqrt(jr*jr+Er*Er+qi*qi);st.setNormalFromValues(ot,jr*xs,Er*xs,qi*xs)}}}function XOe(t,e){KOe(t)}function I_t(t,e){return(Math.PI/2-2*Math.atan(Math.exp(-t/e)))*e}function $_t(t,e){return t*e}function ZOe(t,e,r){return t?i=>I_t(i,e):i=>$_t(i,r)}function YOe(t,e,r,i,s,n){const o=e-1,a=t.vertexAttributes.count,l=2*(Math.min(e-2,i[1])-Math.max(1,i[0]))*(Math.min(e-2,s[1])-Math.max(1,s[0])),c=Vf.map((x,S)=>S===0&&s[1]<e-2||S===1&&i[1]<e-2||S===2&&s[0]>1||S===3&&i[0]>1),h=t.outerEdges.reduce((x,S,E)=>x+(c[E]?0:o-2+S.count-1),0),p=r.reduce((x,S)=>x+o*(2*(S.latitudeResolution-1)+1),0),f=n?2:1,m=3*(l+h+p)*f,y=a>=w_t?new Uint32Array(m):new Uint16Array(m);let _=0;const v=e-2,b=o-2;Te(b>=0);const T=(x,S,E,A,R,M)=>{const D=x*R,k=M[D],$=M[D+1],N=M[D+2],H=S*R,Z=M[H],G=M[H+1],J=M[H+2],I=E*R,z=M[I],F=M[I+1],j=M[I+2],W=A*R,Y=M[W],te=M[W+1],me=M[W+2];return(Z-Y)*(Z-Y)+(G-te)*(G-te)+(J-me)*(J-me)>(k-z)*(k-z)+($-F)*($-F)+(N-j)*(N-j)};if(n){const x=(E,A,R)=>{y[_++]=E,y[_++]=A,y[_++]=A,y[_++]=R,y[_++]=R,y[_++]=E,cn&&(Te(E<a),Te(A<a),Te(R<a),Te(_<=m))};(()=>{for(let E=Math.max(s[0],1)-1;E<Math.min(s[1],e-2)-1;++E){const A=E*v;for(let R=Math.max(i[0],1)-1;R<Math.min(i[1],e-2)-1;++R){const M=E*v+R,D=M+1,k=D+v,$=k-1,N=A+R,H=N+1,Z=H+v,G=Z-1,J=t.vertexAttributes.position.typedBuffer,I=t.vertexAttributes.position.typedBufferStride;T(N,H,Z,G,I,J)?(x(M,D,k),x(k,$,M)):(x(M,D,$),x($,k,D))}}})(),Te(_===3*l*f),(()=>{for(let E=0;E<4;++E){const A=_;if(c[E])continue;const R=t.outerEdges[E],M=t.innerEdges[E];let D=0,k=0;const $=R.count,N=M.count;Te(N===o-1);let H=0;const Z=E===1||E===2?(G,J,I)=>x(G,J,I):(G,J,I)=>x(G,I,J);for(;D<$-1||k<N-1;){const G=M.getVertexIndex(k),J=R.getVertexIndex(D),I=D<$-1,z=k<N-1;I&&(!z||(I?0+o*(D+.5)/($-1):0)<=(z?1+b*(k+.5)/(N-1):0))?(++D,cn&&Te(D<$),Z(G,J,R.getVertexIndex(D)),H++):(++k,cn&&Te(k<N),Z(G,J,M.getVertexIndex(k)),H++)}cn&&(Te(D===$-1),Te(k===N-1),Te(H===$+N-2),Te(H===o-2+R.count-1),Te(_===A+3*H*f))}})(),Te(_===3*(l+h)*f);const S=E=>{const A=t.outerEdges[E.connectedOuterEdgeOffset];let R=A.getVertexIndex(0),M=A.stride;for(let D=0;D<E.latitudeResolution;++D){const k=D===0?E.rowOffset:R+e;for(let $=0;$<o;$++)x(R,R+1,k+$),D<E.latitudeResolution-1&&x(R+1,k+$+1,k+$),R+=M;R=k,M=1}};r.forEach(S)}else{(()=>{const S=Math.max(s[0],1)-1,E=Math.min(s[1],e-2)-1,A=Math.max(i[0],1)-1,R=Math.min(i[1],e-2)-1;for(let M=S;M<E;++M){const D=M*v;for(let k=A;k<R;++k){const $=D+k,N=$+1,H=N+v,Z=H-1,G=t.vertexAttributes.position.typedBuffer,J=t.vertexAttributes.position.typedBufferStride;T($,N,H,Z,J,G)?(y[_]=$,y[_+1]=N,y[_+2]=H,y[_+3]=H,y[_+4]=Z,y[_+5]=$):(y[_]=$,y[_+1]=N,y[_+2]=Z,y[_+3]=Z,y[_+4]=N,y[_+5]=H),_+=6}}})(),Te(_===3*l*f),(()=>{for(let S=0;S<4;++S){if(c[S])continue;const E=t.outerEdges[S],A=t.innerEdges[S];let R=0,M=0;const D=E.count,k=A.count;Te(k===o-1);const $=S===1||S===2,N=$?1:2,H=$?2:1,Z=E.index0,G=E.stride,J=A.index0,I=A.stride;for(;R<D-1||M<k-1;){const z=J+M*I,F=Z+R*G,j=R<D-1,W=M<k-1,Y=j&&(!W||(j?0+o*(R+.5)/(D-1):0)<=(W?1+b*(M+.5)/(k-1):0));Y?++R:++M;const te=Y?F+G:z+I;y[_]=z,y[_+N]=F,y[_+H]=te,_+=3}}})(),Te(_===3*(l+h)*f);const x=S=>{const E=t.outerEdges[S.connectedOuterEdgeOffset];let A=E.getVertexIndex(0),R=E.stride;for(let M=0;M<S.latitudeResolution;++M){const D=M===0?S.rowOffset:A+e;for(let k=0;k<o;k++){const $=D+k;y[_]=A,y[_+1]=A+1,y[_+2]=$,M<S.latitudeResolution-1?(y[_+3]=A+1,y[_+4]=$+1,y[_+5]=$,_+=6):_+=3,A+=R}A=D,R=1}};r.forEach(x)}Te(_===m),t.indices=y,t.indexCount=m}function JOe(t,e){const r=t.localOrigin,i=t.geometry,s=t.geometryState.neighborData.edgeResolutions,n=i.numVerticesPerSide-2,o=i.vertexAttributes;let a=e;for(let l=0;l<4;++l){{const c=l===0||l===2,h=(l===0?n-1:0)*n+(l===1?n-1:0),p=(c?0:1)*n+(c?1:0);i.innerEdges[l]=new iue(o,r,h,p,n)}{const c=a,h=s[l]+1;i.outerEdges[l]=new iue(o,r,c,1,h),a+=h}}}function QOe(t,e,r){const i=(e+2)%4,s=t.geometryState,n=t.tile,o=s.neighborData,a=n.level-r.level,l=e===1||e===3,c=o.edgeResolutions[e];Te(Sw(c));const h=c+1,p=t.geometry,f=p.boundingBox,m=p.outerEdges[e],y=p.uvRange[0],_=p.uvRange[1],v=p.uvRange[2],b=p.uvRange[3],T=ve(e===1?1:0,y,v),x=ve(e===0?1:0,_,b),S=r.renderData,E=S.geometryState,A=S.geometry.outerEdges[i],R=n.getNeighborEdgeStartVertexIndex(e,r)*c,M=c*2**a;Te(E.neighborData.edgeResolutions[i]===M),Te(A.count-1===M);const D=S.localOrigin[0]-t.localOrigin[0],k=S.localOrigin[1]-t.localOrigin[1],$=S.localOrigin[2]-t.localOrigin[2],N=m.attributes,H=m.index0,Z=m.stride,G=N.position.typedBuffer,J=N.position.typedBufferStride,I=N.normalCompressed.typedBuffer,z=N.normalCompressed.typedBufferStride,F=N.uv0,j=A.attributes,W=A.index0,Y=A.stride,te=j.position.typedBuffer,me=j.position.typedBufferStride,Le=j.normalCompressed.typedBuffer,dt=j.normalCompressed.typedBufferStride;for(let st=1;st<h-1;++st){const Xe=H+Z*st,yt=W+Y*(R+st),ge=Xe*J,Ce=yt*me,bt=te[Ce]+D,_e=te[Ce+1]+k,Be=te[Ce+2]+$;G[ge]=bt,G[ge+1]=_e,G[ge+2]=Be,Dh(bt,_e,Be,f);const qe=Xe*z,ft=yt*dt;I[qe]=Le[ft],I[qe+1]=Le[ft+1];const Se=st/c,Re=l?T:ve(Se,y,v),pt=l?ve(Se,_,b):x;yp(F,Xe,Re,pt)}}function KOe(t){const e=t.geometryState,r=e.neighborData,i=t.localOrigin,s=r.cornerNeighborData,n=t.geometry,o=n.outerEdges,a=n.boundingBox,l=t.tile,c=t.tile.surface.view?.viewingMode==="local",h=l.ellipsoid.radius,p=l.extentInRadians,f=l.horizontalScale;let m=0,y=0,_=0;const v=(ge,Ce,bt)=>{const _e=p[Ce===0?1:3],Be=p[ge===0?0:2],qe=Math.cos(_e),ft=Math.sin(_e),Se=Math.sin(Be),Re=Math.cos(Be),pt=h+bt;m=Re*qe*pt,y=Se*qe*pt,_=ft*pt},b=c?(()=>{const ge=t.geometryState.clippingArea,Ce=l.extent,bt=ge!=null&&(Ce[3]>ge[3]||Ce[2]>ge[2]||Ce[1]<ge[1]||Ce[0]<ge[0]),_e=ZOe(l.surface.isWebMercatorOnPlateeCarree,l.ellipsoid.radius,f);return(Be,qe,ft)=>{const Se=Be===0?H[0]:H[2],Re=qe===0?H[1]:H[3],pt=bt?ve(Se,ge[0],ge[2]):Se,Ut=bt?ve(Re,ge[1],ge[3]):Re,ir=ft;m=pt*f,y=_e(Ut),_=ir}})():v;let T=0,x=0,S=0,E=0,A=0,R=0,M=0,D=0,k=0;const $=c&&t.tile.surface.isWebMercatorOnPlateeCarree,N=(ge,Ce,bt,_e,Be)=>{let qe=0,ft=0,Se=0;if(c){const Re=Ce*f,pt=$?(Math.PI/2-2*Math.atan(Math.exp(-bt/h)))*h:bt*f;qe=Re-m,ft=pt-y,Se=_e-_}else{const Re=bK(ge),pt=ge.tile,Ut=pt.extent,ir=pt.extentInRadians,gi=(Ce-Ut[0])/(Ut[2]-Ut[0]),ot=(bt-Ut[1])/(Ut[3]-Ut[1]),at=ir[0]*(1-gi)+ir[2]*gi,wt=Re(ot),Jt=Math.cos(wt),sr=Math.sin(wt),Wr=Math.sin(at),yi=Math.cos(at),Qt=h+_e;qe=yi*Jt*Qt-m,ft=Wr*Jt*Qt-y,Se=sr*Qt-_}switch(Be){case 0:M+=qe,D+=ft,k+=Se;break;case 1:E-=qe,A-=ft,R-=Se;break;case 2:M-=qe,D-=ft,k-=Se;break;case 3:E+=qe,A+=ft,R+=Se}},H=l.extent,Z=e.clippingArea,G=Z??wK,J=H[0],I=H[2],z=H[1],F=H[3],j=[F>G[3],I>G[2],z<G[1],J<G[0]],W=Math.max(J,G[0]),Y=Math.min(I,G[2]),te=Math.max(z,G[1]),me=Math.min(F,G[3]),Le=n.uvRange[0],dt=n.uvRange[1],st=n.uvRange[2],Xe=n.uvRange[3],yt=ge=>{const Ce=s[ge].cornerTiles;T=0,x=0,S=1,E=0,A=0,R=0,M=0,D=0,k=0;let bt=1/0;for(let Re=0;Re<4;++Re)bt=Math.min(bt,Ce[Re]?.level??1/0);for(let Re=0;Re<4;++Re){const pt=Ce[Re];TA[Re]=pt?.level===bt?pt:null}let _e=1,Be=0;for(let Re=0;Re<4;++Re){const pt=TA[Re];pt&&(_e=Math.max(_e,pt?.renderData.geometryState.numVerticesPerSide),Be=pt.extent[2]-pt.extent[0])}const qe=Be,ft=_e;Te(ft>1);const Se=qe/ft;for(let Re=0;Re<4;++Re){const pt=TA[(Re+3)%4],Ut=TA[Re%4];if(!pt&&!Ut)continue;const ir=Re===0?1:Re===1?2:Re===2?3:0,gi=Re===0?2:Re===1?3:Re===2?0:1;if(pt&&Ut){const ot=Rz[Re][0]*Se,at=Rz[Re][1]*Se,wt=pt.extent,Jt=wt[ir===0||ir===1?2:0]+ot,sr=wt[ir===0||ir===3?3:1]+at,Wr=Ut.extent,yi=Wr[gi===0||gi===1?2:0]+ot,Qt=Wr[gi===0||gi===3?3:1]+at,_i=pt.renderData,ki=Ut.renderData,jr=Yi(Jt,sr,_i.geometryState.samplerData),Er=Yi(yi,Qt,ki.geometryState.samplerData);N(_i,Jt,sr,.5*(jr+Er),Re)}else{const ot=pt??Ut,at=pt?ir:gi,wt=ot.extent,Jt=Rz[Re],sr=wt[at===0||at===1?2:0]+Jt[0]*Se,Wr=wt[at===0||at===3?3:1]+Jt[1]*Se,yi=ot.renderData,Qt=Yi(sr,Wr,yi.geometryState.samplerData);N(yi,sr,Wr,Qt,Re)}}if(!c){const Re=Math.sqrt(m*m+y*y+_*_);T=m/Re,x=y/Re,S=_/Re}if(c||S*S<.999){const Re=Math.sqrt(E*E+A*A+R*R);E/=Re,A/=Re,R/=Re;const pt=Math.sqrt(M*M+D*D+k*k);M/=pt,D/=pt,k/=pt,T=R*D-A*k,x=E*k-R*M,S=A*M-E*D;const Ut=1/Math.sqrt(T*T+x*x+S*S);T*=Ut,x*=Ut,S*=Ut}};for(let ge=0;ge<4;++ge){const Ce=ge,bt=(ge+1)%4,_e=ge===0||ge===1?1:0,Be=ge===0||ge===3?1:0,qe=ve(_e,Le,st),ft=ve(Be,dt,Xe),Se=o[Ce],Re=ge===0||ge===3?Se.count-1:0,pt=o[bt],Ut=ge===0||ge===1?pt.count-1:0,ir=s[ge].cornerTiles;let gi=-1;for(let wt=0;wt<4;++wt){const Jt=ir[wt];Jt&&(gi===-1||ey(ir[gi],Jt)>0)&&(gi=wt)}const ot=gi,at=ir[ot];if(at!==l){const wt=l.level-at.level,Jt=2**wt,sr=[at.lij[0]+wt,at.lij[1]*Jt,at.lij[2]*Jt],Wr=[sr[1]+Jt===l.lij[1],ge===0&&(ot===1||ot===0&&at!==ir[3])||ge===1&&(ot===0||ot===1&&at!==ir[2]),sr[1]===l.lij[1]+1,ge===2&&(ot===3||ot===2&&at!==ir[1])||ge===3&&(ot===2||ot===3&&at!==ir[0])],yi=Wr.reduce((Er,qi)=>Er+(qi?1:0),0);Te(yi===1||yi===2);let Qt=-1,_i=-1;const ki=at.renderData;if(yi===1){const Er=Wr.findIndex(xs=>xs);Te(0<=Er&&Er<=3),Qt=(Er+2)%4;const qi=t.geometryState.neighborData.edgeResolutions[Er];_i=l.getNeighborEdgeStartVertexIndex(Er,at)*qi+qi*(Er===0&&ge===0||Er===1&&ge===0||Er===2&&ge===1||Er===3&&ge===3?1:0)}else{Te(Wr[1]||Wr[3]),Qt=Wr[1]?3:1;const Er=ki.geometryState.neighborData.edgeResolutions[Qt];_i=ge===0||ge===3?0:Er}const jr=ki.geometry.outerEdges[Qt];{const Er=Se.index0+Re*Se.stride,qi=pt.index0+Ut*pt.stride,xs=jr.index0+_i*jr.stride;{const Dr=jr.attributes.position,ii=Dr.typedBuffer,Xr=xs*Dr.typedBufferStride,_r=t.localOrigin,ci=jr.localOrigin,js=ii[Xr]+ci[0]-_r[0],eo=ii[Xr+1]+ci[1]-_r[1],to=ii[Xr+2]+ci[2]-_r[2];Dh(js,eo,to,a);{const mn=Se.attributes.position,gn=mn.typedBuffer,Wi=Er*mn.typedBufferStride;gn[Wi]=js,gn[Wi+1]=eo,gn[Wi+2]=to}{const mn=pt.attributes.position,gn=mn.typedBuffer,Wi=qi*mn.typedBufferStride;gn[Wi]=js,gn[Wi+1]=eo,gn[Wi+2]=to}}yp(Se.attributes.uv0,Er,qe,ft),yp(pt.attributes.uv0,qi,qe,ft);{const Dr=jr.attributes.normalCompressed.typedBuffer,ii=xs*jr.attributes.normalCompressed.typedBufferStride;{const Xr=Se.attributes.normalCompressed,_r=Xr.typedBuffer,ci=Er*Xr.typedBufferStride;_r[ci]=Dr[ii],_r[ci+1]=Dr[ii+1]}{const Xr=pt.attributes.normalCompressed,_r=Xr.typedBuffer,ci=qi*Xr.typedBufferStride;_r[ci]=Dr[ii],_r[ci+1]=Dr[ii+1]}}}}else{const wt=j[Ce],Jt=j[bt];let sr;if(wt||Jt){const _i=ve(J*(1-_e)+I*_e,W,Y),ki=ve(z*(1-Be)+F*Be,te,me),jr=e.samplerData;sr=Yi(_i,ki,jr)}else sr=L_t(ir);b(_e,Be,sr),yt(ge);const Wr=m-i[0],yi=y-i[1],Qt=_-i[2];Dh(Wr,yi,Qt,a),Se.setVertexFromValuesRawPositionUVNormal(Re,Wr,yi,Qt,qe,ft,T,x,S),pt.setVertexFromValuesRawPositionUVNormal(Ut,Wr,yi,Qt,qe,ft,T,x,S)}}for(let ge=0;ge<4;++ge)TA[ge]=null}function L_t(t){const e=t.reduce((n,o)=>Math.min(n,o?.level??1/0),1/0);cn&&(Te(!t[0]||!t[2]||uW(t[0],t[2],ct.SOUTH_WEST)),Te(!t[1]||!t[3]||uW(t[1],t[3],ct.NORTH_WEST)));let r=0,i=0;for(let n=0;n<4;++n){const o=t[n];if(o&&o.level===e){const a=n===0||n===1,l=n===0||n===3,c=o.extent,h=c[a?0:2],p=c[l?1:3],f=o.renderData?.geometryState?.samplerData;i+=Yi(h,p,f),r++}}const s=r?i/r:0;return Te(s!=null),s}function t8(t){const e=t.vao,r=t.geometry.vertexAttributes.position.typedBuffer;e.vertexBuffers.geometry.setSubData(r,0,0,r.length)}const Rz=[[0,1],[1,0],[0,-1],[-1,0]],po=new b0t,wK=rZ(-1/0,-1/0,1/0,1/0),TA=[null,null,null,null];function eRe(t,e,r){if(!e)return!1;const i=ey(t,e);return i>0||i===0&&r>=2}let D_t=class extends gK{get horizontalScale(){return this._horizontalScaleFactor}constructor(e,r,i){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=Vt(),e!==void 0&&this.init(e,r,i)}init(e,r,i){super.init(e,r,i);const s=i.view.renderSpatialReference,n=i.spatialReference,o=s!=null&&yR(s)&&n!=null&&n.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=o;const a=this.surface.isWebMercatorOnPlateeCarree,l=this._extentInRenderSR,c=this.extent;if(a){const h=Me(c[0],c[1],0);Zs(h,je.WebMercator,h,je.PlateCarree);const p=Me(c[2],c[3],0);Zs(p,je.WebMercator,p,je.PlateCarree),l[0]=h[0],l[1]=h[1],l[2]=p[0],l[3]=p[1]}else for(let h=0;h<4;++h)l[h]=c[h]*o;this.centerAtSeaLevel[0]=.5*(l[0]+l[2]),this.centerAtSeaLevel[1]=.5*(l[1]+l[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(l[2]-l[0],l[3]-l[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const e=this._extentInRenderSR,r=.5*(e[2]-e[0]),i=.5*(e[3]-e[1]),s=Math.sqrt(r*r+i*i),n=.5*(this.elevationBounds[0]-this.elevationBounds[1]),o=Math.max(s,n);this._center[Vs.MIDDLE][3]=o}_calculateFrustumVisibilityStatus(e){const r=this._aabb(),i=r[0],s=r[1],n=r[2],o=r[3],a=r[4],l=r[5];let c=!0;for(let h=0;h<6;h++){const p=e[h],f=p[0],m=p[1],y=p[2],_=p[3];if(f*(f>0?i:o)+m*(m>0?s:a)+y*(y>0?n:l)+_>=0)return na.OUTSIDE;c=c&&f*(f<0?i:o)+m*(m<0?s:a)+y*(y<0?n:l)+_<=0}return c?na.INSIDE:na.INTERSECTS}_aabb(){const e=this._extentInRenderSR;return I8e(e[0],e[1],this.elevationBounds[0],e[2],e[3],this.elevationBounds[1])}intersectsRay(e,r,i,s){return pL[0]=1/r[0],pL[1]=1/r[1],pL[2]=1/r[2],lQ(this._aabb(),e,pL,i,s)}createGeometry(){O_t(this.renderData,this._horizontalScaleFactor),this.setMemoryDirty()}getDefaultVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){M_t(this.renderData,this._horizontalScaleFactor)}updateEdgeElevations(){P_t(this.renderData,this._horizontalScaleFactor)}};const pL=O();let N_t=class{constructor(){this.extent=Xt(),this.minLevel=0,this.maxLevel=0,this.callback=null}},CN=class extends we{constructor(){super(...arguments),this._queries=new Bt({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new Bt({initialSize:30}),this._queryPool=new Go(N_t)}queryVisibleLevelRange(e,r,i,s){const n=this._queryPool.acquire();Oh(n.extent,e),n.minLevel=r??-Number.MAX_VALUE,n.maxLevel=i??Number.MAX_VALUE,n.callback=s,this._queryQueue.push(n),this.notifyChange("updating")}get updating(){return this._queryQueue.length!==0}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}process(){for(let e=0;e<this._queries.length;e++){const r=this._queries.data[e];this._queryPool.release(r),r.callback(e>=this._queriesInvPtr),r.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(e){const r=e.level;let i=0;for(;i<this._queriesInvPtr;){const s=this._queries.data[i],n=s.extent;r>=s.minLevel&&r<=s.maxLevel&&n[0]<=e.extent[2]&&n[2]>=e.extent[0]&&n[1]<=e.extent[3]&&n[3]>=e.extent[1]?(this._queries.swapElements(i,this._queriesInvPtr-1),this._queriesInvPtr--):i++}}};u([d()],CN.prototype,"updating",null),CN=u([P("esri.views.3d.terrain.ScaleRangeQueries")],CN);let F_t=class extends gK{get convexHull(){return this._convexHull}constructor(e,r,i){super(),this._convexHull=new Array(24),this._boundingSphere=bs(),e!==void 0&&this.init(e,r,i)}init(e,r,i){super.init(e,r,i);const s=this.ellipsoid.radius,n=this.extentInRadians[0],o=this.extentInRadians[1],a=this.extentInRadians[2],l=this.extentInRadians[3],c=e[0],h=St(o,l,.5),p=St(n,a,.5),f=c===0?0:Math.min(Math.abs(o),Math.abs(l));this._edgeLen=(a-n)*Math.cos(f)*s,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=s-Math.sqrt(s*s-this._edgeLen2/4),k1e(this.centerAtSeaLevel,p,h,this.ellipsoid.radius),ye(this.up,this.centerAtSeaLevel),this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const e=this._center;if(this.lij[0]===0)se(e[Vs.MIDDLE],0,0,0),se(e[Vs.TOP],0,0,0),se(e[Vs.BOTTOM],0,0,0),e[Vs.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const r=e[Vs.MIDDLE],i=this.convexHull;let s=0;for(let n=0;n<8;++n)s=Math.max(s,U_t(r,i,3*n));e[Vs.MIDDLE][3]=Math.sqrt(s)}}_calculateFrustumVisibilityStatus(e){if(!D_(e,this._boundingSphere))return na.OUTSIDE;if(this.lij[0]<10)return na.INTERSECTS;const r=this.convexHull,i=this.surface.view.state.camera.near;let s=!0;for(let n=0;n<lC;n++){const o=n===di.NEAR,a=e[n],l=a[0],c=a[1],h=a[2],p=a[3]-(o?i:0);let f=!1;for(let m=0;m<8;++m){const y=3*m;if(l*r[y]+c*r[y+1]+h*r[y+2]+p<0){if(f=!0,!s)break}else s=!1}if(!f)return na.OUTSIDE}return s?na.INSIDE:na.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){x_t(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),cn&&this._checkBVs()}_updateBoundingSphere(){const e=this._boundingSphere,r=e,i=this.elevationBounds,s=this.ellipsoid.radius,n=i[1];if(this.level===0)se(r,0,0,0),e[3]=s+n;else{const o=this.extentInRadians,a=.5*(o[0]+o[2]),l=o[1],c=o[3];g1(yue,a,l,s),g1(_ue,a,c,s),ue(r,yue,_ue);const h=.5*(i[0]+i[1]);ie(r,r,(s+h)/lc(r));const p=this.convexHull;let f=0;const m=(_,v)=>{const b=_[0]-p[3*v],T=_[1]-p[3*v+1],x=_[2]-p[3*v+2];return Math.sqrt(b*b+T*T+x*x)};for(let _=0;_<8;++_){const v=m(r,_);f=Math.max(f,v)}const y=f;e[3]=y+2}}_updateConvexHull(){const e=this.extentInRadians,r=this.ellipsoid.radius;if(this.level===0)return;const i=this.elevationBounds,s=this._getPatchType(),n=this.surface.isWebMercator,o=n&&s===xh.HAS_NORTH_POLE,a=n&&s===xh.HAS_SOUTH_POLE,l=a||o,c=Math.PI/2,h=e[0],p=e[2],f=a?-c:e[1],m=o?c:e[3],y=.5*(h+p),_=i[0],v=r+(l?Math.min(0,_-1):_),b=(J,I,z)=>g1(J,I,z,v),T=O(),x=O(),S=O(),E=O();b(T,h,f),b(x,h,m),b(S,p,m),b(E,p,f);const A=(J,I)=>{for(let z=0;z<3;++z)this._convexHull[3*I+z]=J[z]};A(T,0),A(x,1),A(S,2),A(E,3);const R=i[1],M=r+(l?Math.max(0,R+1):R),D=O(),k=O(),$=O();g1(k,y,m,v),g1($,y,f,v),ue(D,k,$),ye(D,D);const N=O(),H=O(),Z=(J,I)=>{On(H,J,I),ye(H,H);const z=-fe(J,N)/fe(H,N);Te(z>=0),ie(H,H,z),ue(J,J,H)};if(2**this.lij[0]>2*this.lij[1]){const J=$,I=O();ht(I,gue,J),ye(I,I),ht(N,J,I),ye(N,N),Te(Sh(fe(N,J)/lc(J),0)),Z(T,x),Z(E,S),A(T,0),A(E,3)}else if(2**this.lij[0]!==2*this.lij[1]){const J=k,I=O();ht(I,gue,J),ye(I,I),ht(N,I,J),ye(N,N),Z(x,T),Z(S,E),A(x,1),A(S,2)}const G=(J,I)=>{const z=M/fe(I,D);for(let F=0;F<3;++F)this._convexHull[3*J+F]=I[F]*z};G(4,T),G(5,x),G(6,S),G(7,E)}_getPatchType(){const e=this.lij[1],r=e===0,i=e===(1<<this.level)-1;return r?i?xh.HAS_BOTH_POLES:xh.HAS_NORTH_POLE:i?xh.HAS_SOUTH_POLE:xh.REGULAR}intersectsRay(e,r,i,s){const n=this._boundingSphere,o=n[3]+i,a=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],l=n[0]-e[0],c=n[1]-e[1],h=n[2]-e[2],p=(l*r[0]+c*r[1]+h*r[2])/a,f=r[0]*p-l,m=r[1]*p-c,y=r[2]*p-h;return f*f+m*m+y*y<o*o}getDefaultVerticesPerSide(){return this.level<mue.length?mue[this.level]+1:2}updateCornerElevations(){E_t(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){S_t(this.renderData),this._updateBoundingVolumes()}_checkBVs(){if(!cn||this.level<=2)return;const e=this._boundingSphere,r=e[3],i=e,s=O(),n=this.ellipsoid.radius,o=this.elevationBounds;o[1],o[0];const a=n+o[0],l=1,c=0,h=this._center[Vs.MIDDLE][3],p=this.convexHull,f=(_e,Be)=>{for(let qe=0;qe<3;++qe)_e[qe]=p[3*Be+qe]};{const _e=O(),Be=O(),qe=O(),ft=O(),Se=O(),Re=(pt,Ut,ir,gi)=>{f(Be,pt),f(qe,Ut),f(ft,ir),On(Be,Be,qe),On(ft,ft,qe),ht(_e,Be,ft),ye(_e,_e);const ot=fe(_e,qe);f(Se,gi);const at=fe(_e,Se),wt=Math.abs(at-ot);Te(Sh(wt,0),`Non coplanar ${pt},${Ut},${ir},${gi} diff = ${wt}`)};Re(0,1,2,3),Re(4,5,6,7),Re(0,1,4,5),Re(1,2,5,6),Re(2,3,6,7),Re(3,0,7,4)}const m=Ho(24),y=(_e,Be,qe)=>{const ft=4*_e;for(let Se=0;Se<3;++Se)m[ft+Se]=Be[Se];m[ft+3]=qe},_=O(),v=O(),b=O(),T=O(),x=(_e,Be,qe,ft)=>{f(_,Be),f(v,qe),f(b,ft),On(_,_,v),ye(_,_),On(b,b,v),ye(b,b),ht(T,_,b),ye(T,T);const Se=fe(T,v);y(_e,T,Se)};x(0,0,1,2),x(1,1,0,4),x(2,1,5,2),x(3,3,2,6),x(4,4,0,3),x(5,4,6,5);const S=1,E=(_e,Be,qe,ft)=>{const Se=4*_e;return m[Se]*Be+m[Se+1]*qe+m[Se+2]*ft-m[Se+3]},A=(_e,Be,qe,ft)=>E(_e,Be,qe,ft)>=-S,R=(_e,Be)=>A(_e,Be[0],Be[1],Be[2]),M=2**this.lij[0]>2*this.lij[1],D=(_e,Be,qe)=>Math.sqrt(tRe(_e,Be,qe,i[0],i[1],i[2]))<r,k=_e=>D(_e[0],_e[1],_e[2]),$=(_e,Be)=>D(_e[Be],_e[Be+1],_e[Be+2]),N=this.extentInRadians,H=.5*(N[0]+N[2]),Z=N[1],G=N[3],J=O(),I=O();g1(J,H,G,a),g1(I,H,Z,a);const z=M?"Upper":"Lower";let F=!0;for(let _e=0;_e<6;++_e){for(let Be=0;Be<8;++Be){const qe=3*Be,ft=A(_e,p[qe],p[qe+1],p[qe+2]);F&&(F=ft),Te(ft,`Tile[${this.lij}] Convex hull point ${Be} outside of plane ${_e}`)}Te(R(_e,I),`Tile[${this.lij}] (${z}) bottom mid outside of plane ${_e}`),Te(R(_e,J),`Tile[${this.lij}] (${z}) top mid outside of plane ${_e}`)}Te(F,"Not all convex hull points are inside  convex hull polyhedron"),Te(k(I),`Tile[${this.lij}] (${z}) bottom mid outside of bounding sphere`),Te(k(J),`Tile[${this.lij}] (${z}) top mid outside of bounding sphere`);for(let _e=0;_e<8;++_e){const Be=$(p,3*_e);Te(Be,`Tile[${this.lij}] Convex hull point ${_e} outside of bounding sphere`)}for(let _e=0;_e<6;++_e)for(let Be=0;Be<8;++Be){const qe=3*Be;A(_e,p[qe],p[qe+1],p[qe+2])||console.error(`Tile[${this.lij}] Convex hull point ${Be} outside of plane ${_e}`)}const j=this.extentInRadians,W=Math.max(j[2]-j[0],j[3]-j[1]),Y=Math.round(W*n),te=this.renderData;if(!te)return;const{geometry:me,localOrigin:Le}=te,dt=me.vertexAttributes?.position;if(!dt)return;const st=dt.count,Xe=O(),yt=me.numVerticesPerSide-2,ge=yt*yt,Ce=te.geometryState.neighborData,bt=Ce.edgeResolutions.reduce((_e,Be)=>_e+Be+1,0);for(let _e=0;_e<st;++_e){const Be=_e<ge,qe=!Be&&_e<ge+bt;let ft=!1,Se=-1;if(qe){let Qt=ge;for(let _i=0;_i<4;++_i){const ki=Ce.edgeResolutions[_i];if(_e===Qt||_e===Qt+ki-1){ft=!0;break}if(Qt+=ki,_e<Qt){Se=_i;break}}}const Re=qe?Ce.edgePeerNeighbors[Se]:null,pt=qe&&Re&&ey(this,Re)>0;dt.getVec(_e,s),ue(Xe,s,Le);const Ut=lc(Xe)-n;let ir=0,gi=!1;const ot=o[0]-Ut,at=Ut-o[1],wt=ot>l,Jt=at>l,sr=wt||Jt,Wr=()=>{const Qt=Be?"internal":qe&&!ft?"edge":ft?"corner":"pole";return`Tile[${this.lij}].vertex[${_e}]:${Qt}`+(wt?"(below)":Jt?"(above)":"")+(pt?"(Neighbor)":"")},yi=CM(Xe,i);if(yi>=r+c){const Qt=yi-r;sr||(console.error(`${Wr()} is out of the bounding sphere by ${Qt.toFixed(0)} / ${r.toFixed(0)}[tol=${c}] h=${Ut.toFixed(0)} / [${o[0].toFixed(0)}..${o[1].toFixed(0)}] (${(Qt/r).toFixed(0)})`),gi=!0)}for(let Qt=0;Qt<6;++Qt)if(!A(Qt,Xe[0],Xe[1],Xe[2])){const _i=E(Qt,Xe[0],Xe[1],Xe[2]),ki=_e%yt,jr=(_e-ki)/yt;Qt===0&&ot||Qt===5&&at||(console.error(`${Wr()} (${ki},${jr})|${yt}] is out of the bounding trapezoid plane ${Qt} h=${Math.round(Ut)} / [${Math.round(o[0])}..${Math.round(o[1])}] dist=${Math.round(_i)} radii = ${Math.round(r)}/${Math.round(h)}} : maxL = ${Y}`),++ir)}if(gi||ir>0)break}}};const mue=[128,64,64,32,16,8,8,4];function U_t(t,e,r){return tRe(t[0],t[1],t[2],e[r],e[r+1],e[r+2])}function tRe(t,e,r,i,s,n){const o=i-t,a=s-e,l=n-r;return o*o+a*a+l*l}const g1=(t,e,r,i)=>{const s=Math.cos(e),n=Math.sin(e),o=Math.cos(r),a=Math.sin(r);t[0]=i*o*s,t[1]=i*o*n,t[2]=i*a},gue=[0,0,1],yue=O(),_ue=O();let Ld=class extends we{constructor(){super(...arguments),this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}};u([d()],Ld.prototype,"fovX",void 0),u([d()],Ld.prototype,"fovY",void 0),u([d()],Ld.prototype,"relativeWidthLimit",void 0),u([d()],Ld.prototype,"relativeHeightLimit",void 0),u([d()],Ld.prototype,"maxLod",void 0),u([d()],Ld.prototype,"angledSplitBias",void 0),u([d()],Ld.prototype,"aboveGround",void 0),u([d()],Ld.prototype,"frustum",void 0),Ld=u([P("esri.views.3d.terrain.SplitLimits")],Ld);let rRe=class extends va{constructor(){super(...arguments),this.blendMode=Ie.Normal}};u([B({count:Ie.COUNT})],rRe.prototype,"blendMode",void 0);let aR=class extends rRe{constructor(){super(...arguments),this.output=En.Composite,this.baseOpacityMode=up.NotRequired,this.premultipliedSource=Xd.Off}};u([B({count:En.COUNT})],aR.prototype,"output",void 0),u([B({count:up.COUNT})],aR.prototype,"baseOpacityMode",void 0),u([B()],aR.prototype,"premultipliedSource",void 0);var Ww;function k_t(t){const e=new Sr;if(e.include(DOe),t.background===Ww.Only){const r=t.output===En.ColorComposite;return r?e.fragment.uniforms.add(new zt("backgroundColor",i=>i.backgroundColor)):e.fragment.include(mK),e.fragment.code.add(w`
    void main() {
      fragColor = vec4(${r?w`backgroundColor`:w`gridColor(uv)`}, 1.0);
    }
  `),e}return e.include(NOe,t),e.fragment.uniforms.add(new et("tex",r=>r.texture)),e.fragment.uniforms.add(new Pe("opacity",r=>r.opacity)),e.fragment.code.add(w`void main() {
vec4 bgColor = getBackground(uv);
fragColor = blendLayers(bgColor, texture(tex, uv), opacity);
}`),e}(function(t){t[t.BelowLayer=0]="BelowLayer",t[t.Only=1]="Only",t[t.COUNT=2]="COUNT"})(Ww||(Ww={}));const z_t=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return Ww},build:k_t},Symbol.toStringTag,{value:"Module"}));let V_t=class extends LOe{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=Ka}},iRe=class sRe extends Lr{initializeProgram(e){return new Rr(e.rctx,sRe.shader.get().build(this.configuration),Tr)}initializePipeline(){return Mt({blending:Lc(xe.ONE,xe.ONE_MINUS_SRC_ALPHA),colorWrite:Gt})}};iRe.shader=new Or(z_t,()=>ce(()=>import("./BlendLayers.glsl-4c29bb20.js"),[],import.meta.url));let nRe=class extends aR{constructor(){super(...arguments),this.background=Ww.BelowLayer}};u([B()],nRe.prototype,"background",void 0);let Mz=class{constructor(e,r,i,s,n,o){this.texture=e,this.type=r,e.retain(),this.offsetAndScale=Nt(i.offset[0],i.offset[1],i.scale,i.scale),this.opacities=Me(s,n,o)}destroy(){this.texture.release()}};function B_t(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function G_t(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function j_t(t,e,r,i,s,n,o){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t[4]=n,t[5]=o,t}function oRe(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5];let l=r*n-i*s;return l?(l=1/l,t[0]=n*l,t[1]=-i*l,t[2]=-s*l,t[3]=r*l,t[4]=(s*a-n*o)*l,t[5]=(i*o-r*a)*l,t):null}function H_t(t){return t[0]*t[3]-t[1]*t[2]}function aRe(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=r[0],h=r[1],p=r[2],f=r[3],m=r[4],y=r[5];return t[0]=i*c+n*h,t[1]=s*c+o*h,t[2]=i*p+n*f,t[3]=s*p+o*f,t[4]=i*m+n*y+a,t[5]=s*m+o*y+l,t}function xK(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=Math.sin(r),h=Math.cos(r);return t[0]=i*h+n*c,t[1]=s*h+o*c,t[2]=i*-c+n*h,t[3]=s*-c+o*h,t[4]=a,t[5]=l,t}function lRe(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=r[0],h=r[1];return t[0]=i*c,t[1]=s*c,t[2]=n*h,t[3]=o*h,t[4]=a,t[5]=l,t}function TK(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=r[0],h=r[1];return t[0]=i,t[1]=s,t[2]=n,t[3]=o,t[4]=i*c+n*h+a,t[5]=s*c+o*h+l,t}function q_t(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t[4]=0,t[5]=0,t}function W_t(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function SK(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function X_t(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function Z_t(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+1)}function Y_t(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t}function cRe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}function J_t(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t}function Q_t(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t}function K_t(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function evt(t,e){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=e[0],c=e[1],h=e[2],p=e[3],f=e[4],m=e[5],y=sl();return Math.abs(r-l)<=y*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(i-c)<=y*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(s-h)<=y*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(n-p)<=y*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(o-f)<=y*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(a-m)<=y*Math.max(1,Math.abs(a),Math.abs(m))}const tvt=aRe,rvt=cRe;Object.freeze(Object.defineProperty({__proto__:null,add:Y_t,copy:B_t,determinant:H_t,equals:evt,exactEquals:K_t,frob:Z_t,fromRotation:q_t,fromScaling:W_t,fromTranslation:SK,identity:G_t,invert:oRe,mul:tvt,multiply:aRe,multiplyScalar:J_t,multiplyScalarAndAdd:Q_t,rotate:xK,scale:lRe,set:j_t,str:X_t,sub:rvt,subtract:cRe,translate:TK},Symbol.toStringTag,{value:"Module"}));function uRe(){const t=new Float32Array(6);return t[0]=1,t[3]=1,t}function ivt(t){const e=new Float32Array(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function svt(t,e,r,i,s,n){const o=new Float32Array(6);return o[0]=t,o[1]=e,o[2]=r,o[3]=i,o[4]=s,o[5]=n,o}function nvt(t,e){return new Float32Array(t,e,6)}function hRe(t,e,r,i){const s=e[i],n=e[i+1];t[i]=r[0]*s+r[2]*n+r[4],t[i+1]=r[1]*s+r[3]*n+r[5]}function ovt(t,e,r,i=0,s=0,n=2){const o=s||e.length/n;for(let a=i;a<o;a++)hRe(t,e,r,a*n)}Object.freeze(Object.defineProperty({__proto__:null,clone:ivt,create:uRe,createView:nvt,fromValues:svt,transform:hRe,transformMany:ovt},Symbol.toStringTag,{value:"Module"}));function AN(){return[1,0,0,1,0,0]}function avt(t){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function lvt(t,e,r,i,s,n){return[t,e,r,i,s,n]}function cvt(t,e){return new Float64Array(t,e,6)}Object.freeze(Object.defineProperty({__proto__:null,clone:avt,create:AN,createView:cvt,fromValues:lvt},Symbol.toStringTag,{value:"Module"}));function uvt(t){return t instanceof Float32Array&&t.length>=2}function hvt(t){return Array.isArray(t)&&t.length>=2}function Pz(t){return uvt(t)||hvt(t)}const dvt=96,pvt=39.37;function EK(t,e){return e.type?ar(t,e.x,e.y):fn(t,e)}function fvt(t){return _a(t)}function mvt(t,e){const r=t.targetGeometry,i=e.targetGeometry;return r.x=i.x,r.y=i.y,r.spatialReference=i.spatialReference,t.scale=e.scale,t.rotation=e.rotation,t}const gvt=function(){const t=Ge();return function(e,r,i){const s=r.targetGeometry;EK(t,s);const n=.5*r8(r);return e.xmin=t[0]-n*i[0],e.ymin=t[1]-n*i[1],e.xmax=t[0]+n*i[0],e.ymax=t[1]+n*i[1],e.spatialReference=s.spatialReference,e}}();function r8(t){return t.scale*yvt(t.targetGeometry)}function yvt(t){return t!=null&&ua(t.spatialReference)?1/(fvt(t.spatialReference)*pvt*dvt):1}function _vt(t){return q5(t.rotation)||0}const CK=function(){const t=Ge(),e=Ge(),r=Ge();return function(i,s,n,o,a,l){return aJ(t,s),yc(e,n,.5*l),ar(r,1/o*l,-1/o*l),SK(i,e),a&&xK(i,i,a),lRe(i,i,r),TK(i,i,t),i}}(),vvt=function(){const t=Ge();return function(e,r,i,s){const n=r8(r),o=_vt(r);return EK(t,r.targetGeometry),CK(e,t,i,n,o,s)}}(),bvt=function(){const t=Ge();return function(e,r,i,s){const n=r8(r);return EK(t,r.targetGeometry),CK(e,t,i,n,0,s)}}();function wvt(t){const e=Xb(t);return e?e.valid[1]-e.valid[0]:0}function xvt(t,e){return Math.round(wvt(t)/e)}var dW;const qm=[0,0];let K0=dW=class extends le{constructor(t){super(t),this._viewpoint2D={center:Ge(),rotation:0,scale:0,spatialReference:void 0},this.center=[0,0],this.extent=new ur,this.id=0,this.inverseTransform=AN(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=AN(),this.transformNoRotation=AN(),this.displayMat3=$l(),this.displayViewMat3=$l(),this.viewMat3=$l(),this.viewMat2d=uRe(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(t){this._set("pixelRatio",t),this._update()}set size(t){this._set("size",t),this._update()}set viewpoint(t){if(t){const e=this._viewpoint2D,r=t.targetGeometry;e.center[0]=r.x,e.center[1]=r.y,e.rotation=t.rotation,e.scale=t.scale,e.spatialReference=r.spatialReference}this._update()}copy(t){const e=this.size,r=this.viewpoint;return r&&e?(this.viewpoint=mvt(r,t.viewpoint),this._set("size",fn(e,t.size))):(this.viewpoint=t.viewpoint.clone(),this._set("size",[t.size[0],t.size[1]])),this._set("pixelRatio",t.pixelRatio),this}clone(){return new dW({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(t,e,r){return Pz(e)?ib(t,e,this.inverseTransform):(qm[0]=e,qm[1]=r,ib(t,qm,this.inverseTransform))}toScreen(t,e,r){return Pz(e)?ib(t,e,this.transform):(qm[0]=e,qm[1]=r,ib(t,qm,this.transform))}toScreenNoRotation(t,e,r){return Pz(e)?ib(t,e,this.transformNoRotation):(qm[0]=e,qm[1]=r,ib(t,qm,this.transformNoRotation))}getScreenTransform(t,e){const{center:r}=this._viewpoint2D,i=this._get("pixelRatio")||1,s=this._get("size");return CK(t,r,s,e,0,i),t}_update(){const{center:t,spatialReference:e,scale:r,rotation:i}=this._viewpoint2D,s=this._get("pixelRatio")||1,n=this._get("size"),o=new Sp({targetGeometry:new Ke(t[0],t[1],e),scale:r,rotation:i});if(this._set("viewpoint",o),!n||!e||!r)return;this.resolution=r8(o),this.rotation=i,this.scale=r,this.spatialReference=e,fn(this.center,t);const a=n[0]!==0?2/n[0]:0,l=n[1]!==0?-2/n[1]:0;OY(this.displayMat3,a,0,0,0,l,0,-1,1,1);const c=RY(this.viewMat3),h=Th(n[0]/2,n[1]/2),p=Th(-n[0]/2,-n[1]/2),f=q5(i);B4(c,c,h),MY(c,c,f),B4(c,c,p),nE(this.displayViewMat3,this.displayMat3,c);const m=SK(this.viewMat2d,h);return xK(m,m,f),TK(m,m,p),gvt(this.extent,o,n),vvt(this.transform,o,n,s),oRe(this.inverseTransform,this.transform),bvt(this.transformNoRotation,o,n,s),this.worldScreenWidth=xvt(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};u([d({readOnly:!0})],K0.prototype,"id",void 0),u([d({value:1,json:{write:!0}})],K0.prototype,"pixelRatio",null),u([d({json:{write:!0}})],K0.prototype,"size",null),u([d()],K0.prototype,"spatialReference",void 0),u([d({type:Sp,json:{write:!0}})],K0.prototype,"viewpoint",null),K0=dW=u([P("esri.views.2d.ViewState")],K0);const Tvt=K0;var pW,fW,vue,bue,wue,xue,Tue,Sue,Eue,Cue,Aue,Oue,Rue,Mue,Pue,Iue,$ue,Lue,Due,Nue,Fue,Uue,kue,zue,Vue,Bue,Gue,jue,Hue,que,Wue,Xue,Zue,Yue,Jue,Que,Kue,ehe,the,rhe,ihe,she,nhe,ohe,ahe,lhe,che,uhe,hhe,dhe,phe,fhe,mhe,ghe,yhe,_he,vhe,bhe,whe,xhe,The;(function(t){t[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE",t[t.UNKNOWN=4]="UNKNOWN"})(pW||(pW={})),function(t){t[t.BEVEL=0]="BEVEL",t[t.ROUND=1]="ROUND",t[t.MITER=2]="MITER",t[t.UNKNOWN=4]="UNKNOWN"}(fW||(fW={})),function(t){t[t.SCREEN=0]="SCREEN",t[t.MAP=1]="MAP"}(vue||(vue={})),function(t){t[t.Tint=0]="Tint",t[t.Ignore=1]="Ignore",t[t.Multiply=99]="Multiply"}(bue||(bue={})),function(t){t.Both="Both",t.JustBegin="JustBegin",t.JustEnd="JustEnd",t.None="None"}(wue||(wue={})),function(t){t[t.Mosaic=0]="Mosaic",t[t.Centered=1]="Centered"}(xue||(xue={})),function(t){t[t.Normal=0]="Normal",t[t.Superscript=1]="Superscript",t[t.Subscript=2]="Subscript"}(Tue||(Tue={})),function(t){t[t.MSSymbol=0]="MSSymbol",t[t.Unicode=1]="Unicode"}(Sue||(Sue={})),function(t){t[t.Unspecified=0]="Unspecified",t[t.TrueType=1]="TrueType",t[t.PSOpenType=2]="PSOpenType",t[t.TTOpenType=3]="TTOpenType",t[t.Type1=4]="Type1"}(Eue||(Eue={})),function(t){t[t.Display=0]="Display",t[t.Map=1]="Map"}(Cue||(Cue={})),function(t){t.None="None",t.Loop="Loop",t.Oscillate="Oscillate"}(Aue||(Aue={})),function(t){t[t.Z=0]="Z",t[t.X=1]="X",t[t.Y=2]="Y"}(Oue||(Oue={})),function(t){t[t.XYZ=0]="XYZ",t[t.ZXY=1]="ZXY",t[t.YXZ=2]="YXZ"}(Rue||(Rue={})),function(t){t[t.Rectangle=0]="Rectangle",t[t.RoundedRectangle=1]="RoundedRectangle",t[t.Oval=2]="Oval"}(Mue||(Mue={})),function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.Screen=2]="Screen",t[t.Multiply=3]="Multiply",t[t.Add=4]="Add"}(Pue||(Pue={})),function(t){t[t.TTB=0]="TTB",t[t.RTL=1]="RTL",t[t.BTT=2]="BTT"}(Iue||(Iue={})),function(t){t[t.None=0]="None",t[t.SignPost=1]="SignPost",t[t.FaceNearPlane=2]="FaceNearPlane"}($ue||($ue={})),function(t){t[t.Float=0]="Float",t[t.String=1]="String",t[t.Boolean=2]="Boolean"}(Lue||(Lue={})),function(t){t[t.Intersect=0]="Intersect",t[t.Subtract=1]="Subtract"}(Due||(Due={})),function(t){t.OpenEnded="OpenEnded",t.Block="Block",t.Crossed="Crossed"}(Nue||(Nue={})),function(t){t.FullGeometry="FullGeometry",t.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment",t.ReversedFirstSegment="ReversedFirstSegment",t.PerpendicularToSecondSegment="PerpendicularToSecondSegment",t.SecondSegmentWithTicks="SecondSegmentWithTicks",t.DoublePerpendicular="DoublePerpendicular",t.OppositeToFirstSegment="OppositeToFirstSegment",t.TriplePerpendicular="TriplePerpendicular",t.HalfCircleFirstSegment="HalfCircleFirstSegment",t.HalfCircleSecondSegment="HalfCircleSecondSegment",t.HalfCircleExtended="HalfCircleExtended",t.OpenCircle="OpenCircle",t.CoverageEdgesWithTicks="CoverageEdgesWithTicks",t.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks",t.GapExtentMidline="GapExtentMidline",t.Chevron="Chevron",t.PerpendicularWithArc="PerpendicularWithArc",t.ClosedHalfCircle="ClosedHalfCircle",t.TripleParallelExtended="TripleParallelExtended",t.ParallelWithTicks="ParallelWithTicks",t.Parallel="Parallel",t.PerpendicularToFirstSegment="PerpendicularToFirstSegment",t.ParallelOffset="ParallelOffset",t.OffsetOpposite="OffsetOpposite",t.OffsetSame="OffsetSame",t.CircleWithArc="CircleWithArc",t.DoubleJog="DoubleJog",t.PerpendicularOffset="PerpendicularOffset",t.LineExcludingLastSegment="LineExcludingLastSegment",t.MultivertexArrow="MultivertexArrow",t.CrossedArrow="CrossedArrow",t.ChevronArrow="ChevronArrow",t.ChevronArrowOffset="ChevronArrowOffset",t.PartialFirstSegment="PartialFirstSegment",t.Arch="Arch",t.CurvedParallelTicks="CurvedParallelTicks",t.Arc90Degrees="Arc90Degrees"}(Fue||(Fue={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square",t.TrueBuffer="TrueBuffer"}(Uue||(Uue={})),function(t){t.ClosePath="ClosePath",t.ConvexHull="ConvexHull",t.RectangularBox="RectangularBox"}(kue||(kue={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(zue||(zue={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square"}(Vue||(Vue={})),function(t){t.Fast="Fast",t.Accurate="Accurate"}(Bue||(Bue={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(Gue||(Gue={})),function(t){t.Sinus="Sinus",t.Square="Square",t.Triangle="Triangle",t.Random="Random"}(jue||(jue={})),function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Force=2]="Force"}(Hue||(Hue={})),function(t){t[t.Buffered=0]="Buffered",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.AlongLine=3]="AlongLine"}(que||(que={})),function(t){t[t.Linear=0]="Linear",t[t.Rectangular=1]="Rectangular",t[t.Circular=2]="Circular",t[t.Buffered=3]="Buffered"}(Wue||(Wue={})),function(t){t[t.Discrete=0]="Discrete",t[t.Continuous=1]="Continuous"}(Xue||(Xue={})),function(t){t[t.AcrossLine=0]="AcrossLine",t[t.AloneLine=1]="AloneLine"}(Zue||(Zue={})),function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Center=2]="Center",t[t.Justify=3]="Justify"}(Yue||(Yue={})),function(t){t[t.Base=0]="Base",t[t.MidPoint=1]="MidPoint",t[t.ThreePoint=2]="ThreePoint",t[t.FourPoint=3]="FourPoint",t[t.Underline=4]="Underline",t[t.CircularCW=5]="CircularCW",t[t.CircularCCW=6]="CircularCCW"}(Jue||(Jue={})),function(t){t.Butt="Butt",t.Round="Round",t.Square="Square"}(Que||(Que={})),function(t){t.NoConstraint="NoConstraint",t.HalfPattern="HalfPattern",t.HalfGap="HalfGap",t.FullPattern="FullPattern",t.FullGap="FullGap",t.Custom="Custom"}(Kue||(Kue={})),function(t){t[t.None=-1]="None",t[t.Custom=0]="Custom",t[t.Circle=1]="Circle",t[t.OpenArrow=2]="OpenArrow",t[t.ClosedArrow=3]="ClosedArrow",t[t.Diamond=4]="Diamond"}(ehe||(ehe={})),function(t){t[t.ExtraLeading=0]="ExtraLeading",t[t.Multiple=1]="Multiple",t[t.Exact=2]="Exact"}(the||(the={})),function(t){t.Bevel="Bevel",t.Round="Round",t.Miter="Miter"}(rhe||(rhe={})),function(t){t[t.Default=0]="Default",t[t.String=1]="String",t[t.Numeric=2]="Numeric"}(ihe||(ihe={})),function(t){t[t.InsidePolygon=0]="InsidePolygon",t[t.PolygonCenter=1]="PolygonCenter",t[t.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"}(she||(she={})),function(t){t[t.Tint=0]="Tint",t[t.Replace=1]="Replace",t[t.Multiply=2]="Multiply"}(nhe||(nhe={})),function(t){t[t.ClipAtBoundary=0]="ClipAtBoundary",t[t.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary",t[t.DoNotTouchBoundary=2]="DoNotTouchBoundary",t[t.DoNotClip=3]="DoNotClip"}(ohe||(ohe={})),function(t){t.NoConstraint="NoConstraint",t.WithMarkers="WithMarkers",t.WithFullGap="WithFullGap",t.WithHalfGap="WithHalfGap",t.Custom="Custom"}(ahe||(ahe={})),function(t){t.Fixed="Fixed",t.Random="Random",t.RandomFixedQuantity="RandomFixedQuantity"}(lhe||(lhe={})),function(t){t.LineMiddle="LineMiddle",t.LineBeginning="LineBeginning",t.LineEnd="LineEnd",t.SegmentMidpoint="SegmentMidpoint"}(che||(che={})),function(t){t.OnPolygon="OnPolygon",t.CenterOfMass="CenterOfMass",t.BoundingBoxCenter="BoundingBoxCenter"}(uhe||(uhe={})),function(t){t[t.Low=0]="Low",t[t.Medium=1]="Medium",t[t.High=2]="High"}(hhe||(hhe={})),function(t){t[t.MarkerCenter=0]="MarkerCenter",t[t.MarkerBounds=1]="MarkerBounds"}(dhe||(dhe={})),function(t){t[t.None=0]="None",t[t.PropUniform=1]="PropUniform",t[t.PropNonuniform=2]="PropNonuniform",t[t.DifUniform=3]="DifUniform",t[t.DifNonuniform=4]="DifNonuniform"}(phe||(phe={})),function(t){t.Tube="Tube",t.Strip="Strip",t.Wall="Wall"}(fhe||(fhe={})),function(t){t[t.Random=0]="Random",t[t.Increasing=1]="Increasing",t[t.Decreasing=2]="Decreasing",t[t.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"}(mhe||(mhe={})),function(t){t[t.Relative=0]="Relative",t[t.Absolute=1]="Absolute"}(ghe||(ghe={})),function(t){t[t.Normal=0]="Normal",t[t.LowerCase=1]="LowerCase",t[t.Allcaps=2]="Allcaps"}(yhe||(yhe={})),function(t){t[t.LTR=0]="LTR",t[t.RTL=1]="RTL"}(_he||(_he={})),function(t){t.Draft="Draft",t.Picture="Picture",t.Text="Text"}(vhe||(vhe={})),function(t){t[t.Top=0]="Top",t[t.Center=1]="Center",t[t.Baseline=2]="Baseline",t[t.Bottom=3]="Bottom"}(bhe||(bhe={})),function(t){t[t.Right=0]="Right",t[t.Upright=1]="Upright"}(whe||(whe={})),function(t){t[t.Small=0]="Small",t[t.Medium=1]="Medium",t[t.Large=2]="Large"}(xhe||(xhe={})),function(t){t[t.Calm=0]="Calm",t[t.Rippled=1]="Rippled",t[t.Slight=2]="Slight",t[t.Moderate=3]="Moderate"}(The||(The={}));var mW,$b,gW,KF,yW,e5,_W,Lb,vW;(function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(mW||(mW={})),function(t){t[t.VISIBLE=0]="VISIBLE",t[t.NONE=1]="NONE"}($b||($b={})),function(t){t[t.POINT=0]="POINT",t[t.LINE=1]="LINE",t[t.LINE_CENTER=2]="LINE_CENTER"}(gW||(gW={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT",t[t.AUTO=2]="AUTO"}(KF||(KF={})),function(t){t[t.AUTO=0]="AUTO",t[t.LEFT=1]="LEFT",t[t.CENTER=2]="CENTER",t[t.RIGHT=3]="RIGHT"}(yW||(yW={})),function(t){t[t.CENTER=0]="CENTER",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.TOP=3]="TOP",t[t.BOTTOM=4]="BOTTOM",t[t.TOP_LEFT=5]="TOP_LEFT",t[t.TOP_RIGHT=6]="TOP_RIGHT",t[t.BOTTOM_LEFT=7]="BOTTOM_LEFT",t[t.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"}(e5||(e5={})),function(t){t[t.NONE=0]="NONE",t[t.UPPERCASE=1]="UPPERCASE",t[t.LOWERCASE=2]="LOWERCASE"}(_W||(_W={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT"}(Lb||(Lb={})),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(vW||(vW={}));let fd=class{};fd.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:$b.VISIBLE}},fd.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:$b.VISIBLE}},fd.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:$b.VISIBLE},"line-cap":{type:"enum",values:["butt","round","square"],default:pW.BUTT},"line-join":{type:"enum",values:["bevel","round","miter"],default:fW.MITER},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}},fd.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:$b.VISIBLE},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:gW.POINT},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:e5.CENTER},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:KF.AUTO},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:e5.CENTER},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:yW.CENTER},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:KF.AUTO},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:_W.NONE},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[vW.HORIZONTAL]}},fd.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:$b.VISIBLE}},fd.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}},fd.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:Lb.MAP}},fd.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:Lb.MAP},"line-width":{type:"number",minimum:0,default:1}},fd.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:Lb.MAP},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:Lb.MAP}},fd.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}},fd.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:Lb.MAP}};const Svt=.125;let Evt=class{constructor(){this._renderParams={context:null,drawPhase:1,state:new Tvt({viewpoint:new Sp({targetGeometry:new Ke(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null}}dispose(){this._renderParams=null}render(e,r,i,s,n,o,a,l,c,h,p){this._render(e,r,i,s,n,o,a,l,c,h,p)}renderSymbols(e,r,i,s,n,o,a,l,c,h,p){this._render(e,r,i,s,n,o,a,l,c,h,p,mW.SYMBOL)}_render(e,r,i,s,n,o,a,l,c,h,p,f){const m=r[0]-o.getLevelShift(r[0]),y=this._renderParams;y.context=e,y.painter=s,y.glyphMosaic=s.glyphMosaic,y.spriteMosaic=s.spriteMosaic,y.pixelRatio=h*p,y.displayLevel=m,y.requiredLevel=m;const _=o.getScale(r[0]),[v,b]=o.getOffset(r,a*_),T=Svt*a*_/c,x=i.transforms.dvs;x[0]=T,x[4]=-T,x[6]=-1-v-l[0]*a*2,x[7]=1+b+(1-l[1])*a*2-2,y.state.size[0]=c/p,y.state.size[1]=c/p,y.state.pixelRatio=p,i.stage||i.attachWithContext(e),i.triangleCount=0,s.drawTile(y,i,n,f)}},dRe=class pRe extends Lr{initializeProgram(e){return new Rr(e.rctx,pRe.shader.get().build(this.configuration),Tr)}initializePipeline(){return Mt({blending:Lc(xe.ONE,xe.ONE_MINUS_SRC_ALPHA),colorWrite:Gt})}};dRe.shader=new Or(j0t,()=>ce(()=>import("./RasterColorizer.glsl-c937b10e.js"),[],import.meta.url));let eO=class extends aR{constructor(){super(...arguments),this.colorizerType=dw.Stretch,this.stretchType=qw.Noop,this.applyColormap=!0,this.requireBilinearWithNN=!1}};u([B({count:dw.COUNT})],eO.prototype,"colorizerType",void 0),u([B({count:qw.COUNT})],eO.prototype,"stretchType",void 0),u([B()],eO.prototype,"applyColormap",void 0),u([B()],eO.prototype,"requireBilinearWithNN",void 0);let She=class{constructor(e){this._rctx=e,this._fbos=new Map}get(e){return this._getPool(e)}dispose(){this._fbos.forEach(e=>e.dispose()),this._fbos.clear()}_getPool(e){const r=this._fbos.get(e);if(r)return r;const i=new hn(this._rctx,new xr(e),new iF(Ws.DEPTH_COMPONENT16,e));return this._fbos.set(e,i),i}};const Cvt=Q.getLogger("esri.views.3d.terrain");let Avt=class{constructor(e,r){this._rctx=e,this._techniqueRepository=r,this._fbos=[],this._vectorTileHelper=new Evt,this._bindParameters=new iU(null,null,null),this._blendLayersTechniqueConfig=new nRe,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=kl(this._rctx,WM)}dispose(){this._fbos.forEach(Ve),this._fbos=null,this._vtFBO=Ve(this._vtFBO),this._vaoQuad=Ve(this._vaoQuad),this._vectorTileHelper=Ve(this._vectorTileHelper),this._backgroundTechnique=Bi(this._backgroundTechnique),this._applyOpacityTechnique=Bi(this._applyOpacityTechnique),this._blendLayersTechnique=Bi(this._blendLayersTechnique)}_getBlendLayersTechnique(e,r,i,s=Xd.Off,n=Ww.BelowLayer){return this._blendLayersTechniqueConfig.output=r,this._blendLayersTechniqueConfig.blendMode=e,this._blendLayersTechniqueConfig.baseOpacityMode=i,this._blendLayersTechniqueConfig.premultipliedSource=s,this._blendLayersTechniqueConfig.background=n,this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(iRe,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(e,r){const i=this._getBlendLayersTechnique(Ie.Normal,r?En.ColorComposite:En.GridComposite,up.NotRequired,Xd.Off,Ww.Only),s=this._rctx.bindTechnique(i,e,this._bindParameters);this._render(s)}_render(e){this._rctx.bindVAO(this._vaoQuad),e.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(At.TRIANGLE_STRIP,0,zo(this._vaoQuad,"geometry"))}drawGroup(e,r,i,s,n,o=Xd.On){r===En.Composite&&(e.fboTexture=this._fbos[this.getLastOnHoldId()].get(i).colorTexture),e.texture=this.currentFBO(i).colorTexture,this.closeGroup(i);const a=this._getBlendLayersTechnique(s,r,n,o),l=this._rctx.bindTechnique(a,e,this._bindParameters);this._render(l)}drawRasterData(e,r,i,s,n,o=Xd.Off){if(e.texture==null)return;e.fboTexture=r===En.GroupBackgroundComposite||s===Ie.Normal&&n===up.NotRequired&&o===Xd.Off?null:this.switch(i).colorTexture;const a=this._getBlendLayersTechnique(s,r,n,o),l=this._rctx.bindTechnique(a,e,this._bindParameters);this._render(l)}drawImageryTileData(e,r,i,s,n,o){const a=o.sourceLayerInfo.data;if(!a.source||(o.tile.surface.layerViewByIndex(o.layerIndex,rr.MAP).ensureSymbolizerParameters(a),!a.bind(this._rctx)))return;e.fboTexture=s===Ie.Normal&&n===up.NotRequired?null:this.switch(i).colorTexture;const l=this._getRasterColorizerTechnique(a,r,s,n);a.opacity=e.opacity;const c=a.getUniforms();c.scale=o.scale,c.offset=o.offset,c.backgroundColor=e.backgroundColor,c.fboTexture=e.fboTexture,c.baseOpacity=e.baseOpacity;const h=this._rctx.bindTechnique(l,c,null);this._render(h)}_getRasterColorizerTechnique(e,r,i,s){const n=e.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(n.type);return this._rasterColorizerConfig==null&&(this._rasterColorizerConfig=new eO,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=r,this._rasterColorizerConfig.blendMode=i,this._rasterColorizerConfig.baseOpacityMode=s,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!n.colormap,this._rasterColorizerConfig.requireBilinearWithNN=e.isBilinearWithStretchColorRamp,this._rasterColorizerConfig.stretchType=e.hasStretchTypeNone()?qw.Noop:qw.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(dRe,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(e,r,i,s,n,o,a,l,c){const h=this._rctx,p=o.sourceLayerInfo.data,f=o.tile.surface.layerViewByIndex(o.layerIndex,rr.MAP),m=n===up.Required||e.opacity<1||s!==Ie.Normal||r!==En.Composite,y=m?Xd.On:Xd.Off;this._getBlendLayersTechnique(s,r,n,y).bindPipelineState(h);let _=null,v=null;m?(v=this.currentFBO(i),this._vtFBO==null&&(this._vtFBO=new She(this._rctx)),_=this._vtFBO.get(i),h.bindFramebuffer(_),this._clearCurrentFBO()):c&&h.clearSafe(Ti.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.render(h,o.sourceLod,p,f.painter,f.layer.styleRepository,f.schemaHelper,Math.round(1/o.scale),o.offset,l,a,f.contentZoom),o.vtlNeighborInfos.forAll(b=>this._vectorTileHelper.renderSymbols(h,b.sourceLod,b.sourceLayerInfo.data,f.painter,f.layer.styleRepository,f.schemaHelper,1,b.offset,l,a,f.contentZoom))}catch(b){Cvt.warnOnce("A render call containing vector tiles did not resolve correctly.",b)}return _==null||(h.bindFramebuffer(v),e.texture=_.colorTexture,e.offset=Tp,e.scale=1,this.drawRasterData(e,r,i,s,n,y),c)}copyFBOToTexture(e){const r=this._rctx,i=r.bindTexture(e.texture,Ot.TEXTURE_UNIT_FOR_UPDATES),s=e.descriptor;r.gl.copyTexImage2D(as.TEXTURE_2D,0,s.pixelFormat,0,0,s.width,s.height,0),e.generateMipmap(),r.bindTexture(i,Ot.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.clearSafe(Ti.COLOR_BUFFER_BIT|Ti.DEPTH_BUFFER_BIT)}_initFBO(e,r,i){this._rctx.bindFramebuffer(e),i&&(this._rctx.setViewport(0,0,r,r),this._clearCurrentFBO())}ensureBuffer(e){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(e)}bind(e,r=0,i=!0){if(this._current=r,r>=this._fbos.length)for(let s=this._fbos.length;s<=r;s++)this._fbos.push(new She(this._rctx));this._initFBO(this._fbos[r].get(e),e,i)}_bindNextFreeBuffer(e){this._lastUsedIds.length>0?this.bind(e,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(e,this._lastCreatedBufferId))}openGroup(e){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(e)}switch(e){const r=this.currentFBO(e),i=this._current;return this._bindNextFreeBuffer(e),this._lastUsedIds.push(i),r}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(e){const r=this._current;this._bindNextFreeBuffer(e),this._lastUsedIds.push(r),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(e){return this._fbos[this._current].get(e)}},Ovt=class{constructor(){this.sourceLod=[0,0,0],this.offset=[0,0],this.scale=1,this.layerIndex=0,this.vtlNeighborInfos=new Bt({allocator:e=>e||new Rvt})}},Rvt=class{constructor(){this.sourceLayerInfo=null,this.sourceLod=[0,0,0],this.offset=[-1,0]}},Mvt=class{constructor(e,r,i,s){this.start=e,this.end=r,this.blendMode=i,this.opacity=s}},Pvt=class{constructor(e,r,i){this._rctx=e,this.tileSize=r,this._techniqueRepository=i,this._passParameters=new V_t,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._blackTex=null,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._composition=new Avt(this._rctx,this._techniqueRepository),this._blackTex=new SS(xJe(this._rctx,[0,0,0,1])),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=Ve(this._composition),this._backgroundTexture=Bi(this._backgroundTexture),this._blackTex=Bi(this._blackTex)}get backgroundIsGrid(){return this._backgroundColor==null}get backgroundColor(){return this._backgroundColor}updateTileTexture(e,r){if(!e.renderData)return;const i=e.surface,s=i.baseOpacity;let n=0,o=0,a=this.tileSize,l=!1;const c=i.view.state.contentPixelRatio;let h=!1;t5.clear(),TT.length=0;const p=e.layerInfo[rr.MAP];let f=p.length,m=0,y=null;for(;m<p.length;m++){const v=i.layerViewByIndex(m,rr.MAP),b=v.layer.opacity;Ehe[m]=b;const T=v.fullOpacity;if(Che[m]=T,ige(v.layer)&&f>=p.length&&(f=m),XF(v)){Ahe[m]=v.layer.blendMode;let S=v.layer.blendMode!=="normal";if(B2(v.layer.parent)){const E=bW(v.layer.parent);E!=null&&E!==""&&(S=fRe(v.layer.parent)||S)}S&&(h=S,l=!1)}if(b===0&&!h){p[m].pendingUpdates&=~(xt.TEXTURE_NOFADING&xt.TEXTURE_FADING);continue}++o;const x=Iz(e,m);if(x){if(p[m].pendingUpdates&=~(xt.TEXTURE_NOFADING&xt.TEXTURE_FADING),B2(v.layer.parent)){const S=bW(v.layer.parent);S!=null&&S!==""&&mRe(v.layer.parent,m)}nM(v)?a=Math.max(a,this.tileSize*c):s===1&&T===1&&(v.isOpaque||this._dataToTexture(x)&&x.sourceLayerInfo.data.descriptor.isOpaque)&&(l=!0),++n,y===null&&(y=m)}}const _=a/this.tileSize;this._ensureBackgroundTexture(this.tileSize),n!==0&&y!==null?n===1&&!h&&this._useLayerTexture(e,y,f,Che[y])||this._composeMapLayers(e,r,m-1,f,Ehe,Ahe,a,_,!l||h,t5,h):this._useBackgroundTexture(e,o)}_ensureBackgroundTexture(e){this._backgroundTexture==null&&(this._backgroundTexture=this._buildTexture(e),this._backgroundDirty=!0),this._backgroundDirty&&(this._composition.bind(e),this._passParameters.offset=Tp,this._passParameters.scale=1,this._passParameters.opacity=1,this.backgroundColor!=null&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,this.backgroundColor!=null),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.unbind(),this._backgroundDirty=!1)}_useBackgroundTexture(e,r){let i=Kg.Immediate;(e.surface.view.layerViewManager.updating||r>0)&&(i=Kg.Delayed);const s=e.renderData;this._backgroundTexture&&s.textureReference==null&&(i=Kg.Immediate),s.setTextureReference(this._backgroundTexture!=null?new Mz(this._backgroundTexture,on.FADING,Ohe,e.surface.baseOpacity,0,1):null,i)}_useLayerTexture(e,r,i,s){const n=r<i,o=n?1:e.surface.baseOpacity,a=n?e.surface.baseOpacity:1,l=Iz(e,r);return!!this._dataToTexture(l)&&(e.renderData.setTextureReference(new Mz(l.sourceLayerInfo.data,on.FADING,l,o,a,s)),!0)}_composeMapLayers(e,r,i,s,n,o,a,l,c,h,p){this._composition.ensureBuffer(a);const f=e.surface.baseOpacity;let m=!1,y=Rt.LINEAR_MIPMAP_LINEAR,_=!1,v=0;for(let x=i;x>=0;x--){const S=Iz(e,x);if(!S||n[x]===0&&!p)continue;const E=x<s&&f<1&&!m;this._passParameters.baseOpacity=E?f:1;const A=this._passParameters.baseOpacity<1?up.Required:up.NotRequired;E&&(m=!0);let R=!1;h.forEach($=>{$.start===x&&(TT.push($),this._composition.openGroup(a),R=!0)});const M=v===0,D=R?En.GroupBackgroundComposite:c&&M?this.backgroundIsGrid?En.GridComposite:En.ColorComposite:En.Composite,k=cW[o[x]];for(vOe(S)?(this._passParameters.opacity=n[x],_=this._composition.drawVectorData(this._passParameters,D,a,k,A,S,l,this.tileSize,_)):yyt(S)?(this._passParameters.opacity=n[x],this._composition.drawImageryTileData(this._passParameters,D,a,k,A,S),this._hasNearestInterpolation(S)&&(y=Rt.NEAREST)):this._dataToTexture(S)&&(this._passParameters.texture=S.sourceLayerInfo.data.texture,this._passParameters.offset=S.offset,this._passParameters.scale=S.scale,this._passParameters.opacity=n[x],this._composition.drawRasterData(this._passParameters,D,a,k,A));TT.length>0&&TT[TT.length-1].end===x;){const $=TT.pop();this._passParameters.opacity=$.opacity,this._passParameters.offset=Tp,this._passParameters.scale=1;const N=c&&M?this.backgroundIsGrid?En.GridComposite:En.ColorComposite:En.Composite;this._composition.drawGroup(this._passParameters,N,a,cW[$.blendMode],A)}v++}const b=e.renderData,T=b.ensureTexture(a,()=>this._buildTexture(a,y));this._composition.copyFBOToTexture(T),this._composition.unbind(),b.setTextureReference(new Mz(T,r,Ohe,m?1:f,0,1))}_hasNearestInterpolation(e){const r=e.sourceLayerInfo.data;return!!r.source&&r.interpolation==="nearest"}_dataToTexture(e){if(vyt(e)){const r=e.sourceLayerInfo;r.data=this._buildTexture(r.data),e.tile.setMemoryDirty()}return _yt(e)}setBackground(e){this._backgroundColor!==e&&(this._backgroundColor=e,this._backgroundDirty=!0)}_buildTexture(e,r=Rt.LINEAR_MIPMAP_LINEAR){if(e==null)return null;const i=new xr;i.wrapMode=Dt.CLAMP_TO_EDGE,i.samplingMode=r,i.maxAnisotropy=this._maxAnisotropy,i.preMultiplyAlpha=!0,i.flipped=!0,i.hasMipmap=!0;const s=this._rctx;let n;if(typeof e=="number")i.width=i.height=e,n=new SS(new Ot(s,i));else if(e instanceof YU)i.isOpaque=e.isOpaque,n=new SS(new Ot(s,i,e.image)),e.release();else try{i.width=e.width,i.height=e.height,n=new SS(new Ot(s,i,e))}catch{n=new SS(oTe(s)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const o=s.bindTexture(n.texture,Ot.TEXTURE_UNIT_FOR_UPDATES);return n.generateMipmap(),s.bindTexture(o,Ot.TEXTURE_UNIT_FOR_UPDATES),n}get test(){return{backgroundTexture:this._backgroundTexture}}};function Iz(t,e){Ra.layerIndex=e,Ra.vtlNeighborInfos.clear();const r=t.layerInfo[rr.MAP][e];if(r.data)return ar(Ra.offset,0,0),Ra.tile=t,Ra.scale=1,Ra.sourceLod=t.lij,Ra.sourceLayerInfo=r,vOe(Ra)&&t.forEachLoadedNeighbor((s,n)=>{if(s.level!==t.level)return;const o=s.layerInfo[rr.MAP][e];if(!bOe(o)||r.data===o.data)return;const a=Ra.vtlNeighborInfos.pushNew();a.offset=wg[n],a.sourceLod=s.lij,a.sourceLayerInfo=o}),Ra;const i=r.upsampleInfo;if(i){const s=i.tile.layerInfo[rr.MAP][e];return Ra.tile=i.tile,fn(Ra.offset,i.offset),Ra.scale=i.scale,Ra.sourceLod=i.tile.lij,Ra.sourceLayerInfo=s,Ra}return null}function bW(t){return t.get("uid")}function fRe(t){let e=t.blendMode!=="normal";return B2(t.parent)&&(e=fRe(t.parent)||e),e}function mRe(t,e){B2(t.parent)&&mRe(t.parent,e);const r=bW(t);if(r!=null&&r!==""){const i=t5.get(r);i?i.start=e:t5.set(r,new Mvt(e,e,t.blendMode,t.opacity))}}const Ehe=new Array,Che=new Array,Ahe=new Array,t5=new Map,TT=new Array,Ra=new Ovt,Ohe={offset:[0,0],scale:1},wg=new Array;wg[ct.NORTH]=[0,-1],wg[ct.NORTH_EAST]=[-1,-1],wg[ct.EAST]=[-1,0],wg[ct.SOUTH_EAST]=[-1,1],wg[ct.SOUTH]=[0,1],wg[ct.SOUTH_WEST]=[1,1],wg[ct.WEST]=[1,0],wg[ct.NORTH_WEST]=[1,-1];const gRe=200,$z=40,Ivt=.8,$vt=10,tO=1e-6;function Lvt(t,e,r){const i=e,s=r;let n=0,o=1/0;for(let a=0;a<3;++a){{const l=t[a];if(i[a]<l){if(s[a]<=tO)return!1;const c=(l-i[a])/s[a];n=Math.max(n,c)}else if(s[a]<=-tO){const c=(l-i[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}{const l=t[a+3];if(i[a]>l){if(s[a]>=-tO)return!1;const c=(l-i[a])/s[a];n=Math.max(n,c)}else if(s[a]>=tO){const c=(l-i[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}}return!0}let Rhe=class{constructor(e,r,i,s,n){this.aabb=e,this.axis=r,this.d=i,this.midStartIndex=s,this.rightStartIndex=n}},AK=class wW{constructor(e,r,i,s){this.globalTriangleVertexIndices=e,this.firstTriangleIndex=r,this.positionAttribute=s,this._rayDirection=O(),this.bspNodeTree=new Array;const n=i-r,o=n<=yRe?new Uint16Array(n):new Uint32Array(n);this.indices=o;for(let a=0;a<n;++a)o[a]=a;{const a=kvt(e,r,i,s.data,s.stride),l=ve(Math.log2(n/$z),2,$vt),c=(h,p,f)=>{const m=Fvt(o,a,h,p),y=p-h;if(y<=$z){const S=new Rhe(m,void 0,0,h,p);return this.bspNodeTree.push(S),S}const{axis:_,midValue:v}=Uvt(m),b=Nvt(o,a,h,p,_,v),T=(S,E)=>{if(f>l)return;const A=E-S;return A<$z||A>=Ivt*y?void 0:c(S,E,f+1)},x=new Rhe(m,_,v,b.next,b.mid);return this.bspNodeTree.push(x),x.leftNode=T(h,b.next),x.rightNode=T(b.mid,p),x};c(0,n,0),this.triangleVertexIndices=zvt(o,e,r,i)}}intersectRayTriangleRange(e,r){{if(e>=r)return;const i=this.triangleVertexIndices,s=this.positionAttribute.data,n=this.positionAttribute.stride,o=this._rayOrigin,a=o[0],l=o[1],c=o[2],h=this._rayDirection,p=h[0],f=h[1],m=h[2];for(let y=e,_=3*e;y<r;++y){let v=i[_++]*n;const b=s[v++],T=s[v++],x=s[v];v=i[_++]*n;const S=s[v++],E=s[v++],A=s[v];v=i[_++]*n;const R=S-b,M=E-T,D=A-x,k=s[v++]-b,$=s[v++]-T,N=s[v]-x,H=f*N-$*m,Z=m*k-N*p,G=p*$-k*f,J=R*H+M*Z+D*G;if(Math.abs(J)<=Number.EPSILON)continue;const I=a-b,z=l-T,F=c-x,j=I*H+z*Z+F*G;if(J>0){if(j<0||j>J)continue}else if(j>0||j<J)continue;const W=z*D-M*F,Y=F*R-D*I,te=I*M-R*z,me=p*W+f*Y+m*te;if(J>0){if(me<0||j+me>J)continue}else if(me>0||j+me<J)continue;const Le=(k*W+$*Y+N*te)/J;if(Le>=0){const dt=this.indices[y]+this.firstTriangleIndex,st=oQ(R,M,D,k,$,N,Dvt);this._callback(Le,st,dt,!1)}}}wW.numFacesTested+=r-e}intersectRay(e,r){wW.numFacesTested=0;const i=Me(e.r0[0],e.r0[1],e.r0[2]),s=Me(e.r1[0],e.r1[1],e.r1[2]),n=s[0]-i[0],o=s[1]-i[1],a=s[2]-i[2];if(n*n+o*o+a*a<tO)return;this._rayOrigin=i;const l=this._rayDirection;l[0]=n,l[1]=o,l[2]=a;const c=this.triangleVertexIndices.length/3;this._callback=r;const h=this.bspNodeTree[0];this.intersectRayBSP(h,0,c)}intersectRayBSP(e,r,i){const s=this._rayOrigin,n=this._rayDirection;if(!Lvt(e.aabb,s,n))return;const o=e.axis,a=e.d;if(s[o]<a||n[o]<0){const l=r,c=e.midStartIndex;if(l<c){const h=e.leftNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(e.midStartIndex,e.rightStartIndex),s[o]>a||n[o]>0){const l=e.rightStartIndex,c=i;if(l<c){const h=e.rightNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}};AK.numFacesTested=0;const Dvt=O(),ST=[1/0,1/0,1/0],ET=[-1/0,-1/0,-1/0];function Nvt(t,e,r,i,s,n){let o=r,a=i;for(;o<a;){const c=t[o];e[6*c+s+3]<=n?++o:(--a,t[o]=t[a],t[a]=c)}let l=o;for(a=i;l<a;){const c=t[a-1];e[6*c+s]>=n?--a:(t[a-1]=t[l],t[l]=c,++l)}return{next:o,mid:l}}function Fvt(t,e,r,i){if(i<=r)return Ew(NaN,NaN,NaN,NaN,NaN,NaN);{const s=6*t[r];for(let n=0;n<3;++n)ST[n]=e[s+0+n],ET[n]=e[s+3+n]}for(let s=r+1;s<i;++s){const n=6*t[s];for(let o=0;o<3;++o)ST[o]=Math.min(ST[o],e[n+0+o]),ET[o]=Math.max(ET[o],e[n+3+o])}return Ew(ST[0],ST[1],ST[2],ET[0],ET[1],ET[2])}function Uvt(t){const e=t[3]-t[0],r=t[4]-t[1],i=t[5]-t[2],s=e>r?e>i?0:r>i?1:2:r>i?1:i>e?2:0;return{axis:s,midValue:(t[s]+t[s+3])/2}}function kvt(t,e,r,i,s){const n=r-e,o=new Float32Array(6*n);for(let a=0;a<n;++a){const l=3*(a+e),c=t[l]*s,h=t[l+1]*s,p=t[l+2]*s;for(let f=0;f<3;++f){const m=i[c+f],y=i[h+f],_=i[p+f];o[6*a+f]=Math.min(m,y,_),o[6*a+3+f]=Math.max(m,y,_)}}return o}function zvt(t,e,r,i){const s=i-r;let n=0;for(let a=r;a<i;++a)for(let l=0;l<3;++l)n=Math.max(e[3*a+l],n);const o=n<=yRe?new Uint16Array(3*s):new Uint32Array(3*s);for(let a=0;a<s;++a){const l=3*(t[a]+r);for(let c=0;c<3;++c){const h=e[l+c];o[3*a+c]=h}}return o}const yRe=65535;let zs=class extends Vo{constructor(){super(...arguments),this.output=U.Color,this.overlayMode=ty.Disabled,this.tileBlendInput=Bf.LayerOnly,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.invisible=!1,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.pbrMode=lt.Terrain}};u([B({count:U.COUNT})],zs.prototype,"output",void 0),u([B({count:ty.COUNT})],zs.prototype,"overlayMode",void 0),u([B({count:Bf.COUNT})],zs.prototype,"tileBlendInput",void 0),u([B()],zs.prototype,"spherical",void 0),u([B()],zs.prototype,"doublePrecisionRequiresObfuscation",void 0),u([B()],zs.prototype,"receiveShadows",void 0),u([B()],zs.prototype,"hasSlicePlane",void 0),u([B()],zs.prototype,"backfaceCullingEnabled",void 0),u([B()],zs.prototype,"textureFadingEnabled",void 0),u([B()],zs.prototype,"renderOccluded",void 0),u([B()],zs.prototype,"hasScreenSpaceReflections",void 0),u([B()],zs.prototype,"hasCloudsReflections",void 0),u([B()],zs.prototype,"invisible",void 0),u([B()],zs.prototype,"tileBorders",void 0),u([B()],zs.prototype,"visualizeNormals",void 0),u([B()],zs.prototype,"screenSizePerspective",void 0),u([B()],zs.prototype,"receiveAmbientOcclusion",void 0),u([B({count:lt.COUNT})],zs.prototype,"pbrMode",void 0),u([B({constValue:Ir.Compressed})],zs.prototype,"normalType",void 0),u([B({constValue:Ds.Compressed})],zs.prototype,"textureCoordinateType",void 0),u([B({constValue:!1})],zs.prototype,"highStepCount",void 0),u([B({constValue:!1})],zs.prototype,"useCustomDTRExponentForWater",void 0),u([B({constValue:!1})],zs.prototype,"useFillLights",void 0);const Lz=7,Vvt=10,Dz=pn();var xn;(function(t){t[t.Opaque=0]="Opaque",t[t.Semitransparent=1]="Semitransparent",t[t.TransparentWithDraped=2]="TransparentWithDraped",t[t.Empty=3]="Empty"})(xn||(xn={}));let tc=class extends we{get _isGlobal(){return this._stage.viewingMode===Ue.Global}constructor(e){super(e),this.type=Gi.TERRAIN,this.isGround=!0,this._tileSize=256,this._techniqueConfiguration=new zs,this._passParameters=new UOe,this._rctx=null,this._renderDataPool=new Go(v_t),this._patchGroups=new Map,this._patchGroupsDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new ROe,this._highestVisibleLODTile=null,this._visible=!0,this._transparencyState=xn.Opaque,this._castShadows=!0,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.needsHighlight=!1,this.renderOccludedFlags=Di.Occlude}initialize(){const e=[he.OPAQUE_TERRAIN,he.TRANSPARENT_TERRAIN,he.OCCLUDED_TERRAIN];this._stage.addRenderPlugin(e,this)}destroy(){this._stage.removeRenderPlugin(this),_0t()}get canRender(){return this._visible&&!!this._rootTiles&&!this.renderingDisabled}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setDirty()}set transparency(e){this._transparencyState!==e&&(this._techniqueConfiguration.invisible=e===xn.TransparentWithDraped||e===xn.Empty,this._transparencyState=e,this.setNeedsRender())}get transparency(){return this._transparencyState}get needsLinearDepth(){return this._overlayRenderer.hasWater}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return!!this._techniqueConfiguration.visualizeNormals}set visualizeNormals(e){this._techniqueConfiguration.visualizeNormals!==e&&(this._techniqueConfiguration.visualizeNormals=e,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this._setSortingDirty()}get layerUid(){return y_}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}set pbrMode(e){this._techniqueConfiguration.pbrMode!==e&&(this._techniqueConfiguration.pbrMode=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setDirty()}setNeedsHighlight(e){this.needsHighlight=e,this.setNeedsRender()}setRenderOccludedOverlay(e){this.renderOccludedFlags=e?UF:Di.Occlude,this.setNeedsRender()}setStencilEnabledLayerExtents(e){this._stencilEnabledLayerExtents=e,this._setSortingDirty()}setTileSize(e){this._tileSize=e,this._tileRenderer!=null&&(this._tileRenderer.tileSize=e),this.setDirty()}_prepareTileForLoading(e){e.renderData||(e.renderData=this._renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometryState(e),this.updateTileTexture(e,xt.TEXTURE_FADING)}updateTileTexture(e,r){this._tileRenderer!=null&&(this._tileRenderer.updateTileTexture(e,r===xt.TEXTURE_FADING?on.FADING:on.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(r))}updateTileGeometryState(e){for(const i of e.layerInfo[rr.ELEVATION])i.pendingUpdates&=~xt.GEOMETRY;e.resetPendingUpdate(xt.GEOMETRY);const r=e.renderData.updateGeometryState();return r&&this.setDirty(),r}updateGeometryIfNeeded(e){e.isLoaded&&e.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(e){const r=e.renderData;r&&(r.releaseGeometry(),this._renderDataPool.release(r),r.clear(),e.renderData=null,e.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(e){const r=Vvt-Lz,i=Math.max(0,Math.floor((e.level-r)/Lz)*Lz);if(this._isGlobal&&i===0)return Ka;for(;e.parent&&e.level>i;)e=e.parent;return e.centerAtSeaLevel}setVisibility(e){this._visible=e,this.setDirty()}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.setNeedsRender())}setDirty(e=gs.UPDATE){this._patchGroupsDirty=!0,this._context.requestRender(e)}_setSortingDirty(e=gs.UPDATE){this._patchSortingDirty=!0,this._context.requestRender(e)}setNeedsRender(e=gs.UPDATE){this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this._rctx=e.renderContext.rctx,this._techniqueRepository=e.techniqueRepository,this._tileRenderer=new Pvt(this._rctx,this._tileSize,this._techniqueRepository),this.updateTileBackground(),this._emptyTex=oTe(this._rctx)}uninitializeRenderContext(){this._emptyTex=Ve(this._emptyTex),this._tileRenderer=Ve(this._tileRenderer)}intersect(e,r,i,s){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&this.transparency!==xn.Opaque)return;const n=Bvt,o=Gvt;de(n,s,i),se(o,1/n[0],1/n[1],1/n[2]);const a=e.results.min,l=e.results.max,c=e.results.ground,h=e.options.store===wo.MIN,p=!!e.results.ground.target,f=zet(e.verticalOffset),m=e.tolerance;let y,_=h&&a.dist!=null?a.dist:1/0;const v=T=>{const x=T.renderData;if(!x?.vao)return;const S=x.geometry;c6(Dz,S.boundingBox);const E=x.localOrigin;f!=null&&(f.localOrigin=E,f.applyToAabb(Dz));const A=Dz;if(CT[0]=i[0]-E[0],CT[1]=i[1]-E[1],CT[2]=i[2]-E[2],!lQ(A,CT,o,m,_))return;const R=(G,J,I)=>{G.set(this.type,T,J,I,un),_=h&&a.dist!=null?a.dist:1/0},M=(G,J)=>{if(J!=null&&G>=0&&(e.options.backfacesTerrain||fe(J,n)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||r==null||r(i,s,G))){if((c.dist==null||G<c.dist)&&R(c,G,J),e.options.isFiltered)return;e.options.store===wo.ALL&&(y==null?(y=LJ(e.ray),R(y,G,J),e.results.all.push(y)):G<y.dist&&R(y,G,J)),(a.dist==null||G<a.dist)&&R(a,G,J),e.options.store!==wo.MIN&&(l.dist==null||G>l.dist)&&R(l,G,J)}},D=jvt;de(D,s,E);const k=S.indices,$=S.vertexAttributes,N=$.getField(C.POSITION,dn),H=new He(N.typedBuffer,3,!1,$.stride/4),Z=S.indexCount/3;if(!f&&Z>gRe){const G=T.renderData;G.intersectionData==null&&(G.intersectionData=new AK(k,0,Z,H)),G.intersectionData.intersectRay({r0:CT,r1:D},M)}else tP(CT,D,0,Z,k,H,null,f,M)},b=this._rootTiles;b!=null&&(()=>{const T=this._tileIterator;T.reset(b);const x=e.options.invisibleTerrain;for(let S=T.next();S;S=T.next())!(S.visible||x&&S.intersectsClippingArea)||f==null&&!S.intersectsRay(i,n,m,_)||p&&this._useStencilForTile(S)?T.skipSubtree():v(S)})()}processScaleRangeQueries(e,r){if(!r.done)for(this._updatePatchGroups();e.updating&&!r.done;){e.prepare();for(const i of this._patchGroups.values())for(const s of i)s.renderData?.textureReference!=null&&e.queriesForTile(s);e.process(),r.madeProgress()}}prepareTechnique(e){if(e.bindParameters.slot===he.OCCLUDED_TERRAIN){if(!(e.renderOccludedMask&UF))return null}else{const r=this.transparency===xn.Opaque?he.OPAQUE_TERRAIN:he.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==r)return null}switch(e.output){case U.Color:return this.transparency===xn.Empty?null:(this._techniqueConfiguration.hasScreenSpaceReflections=e.bindParameters.ssr.enabled,this._techniqueConfiguration.hasCloudsReflections=e.bindParameters.cloudsFade.data!=null,this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssaoHelper.active,this._techniqueConfiguration.overlayMode=this._overlayRenderer.isEmpty?ty.Disabled:this._overlayRenderer.hasWater?ty.EnabledWithWater:ty.Enabled,this._updateTechnique(U.Color,e.bindParameters.slot===he.OCCLUDED_TERRAIN));case U.Shadow:case U.ShadowExcludeHighlight:return this._castShadows&&e.bindParameters.lighting.globalFactor===1?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(U.Shadow,!1)):null;case U.Depth:return this.transparency===xn.Empty?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(U.Depth,!1));case U.Normal:return this.transparency===xn.Empty?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(U.Normal,!1));case U.ObjectAndLayerIdColor:return this.transparency===xn.Empty?null:this._updateTechnique(U.ObjectAndLayerIdColor,!1);case U.Highlight:return this.transparency!==xn.Empty&&this.needsHighlight?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(U.Highlight,!1)):null}return null}render(e,r){const i=e.bindParameters.lighting.globalFactor===1;switch(this._updatePatchGroups(),r.useStencil=!1,e.output){case U.Color:{const s=e.bindParameters.slot===he.OCCLUDED_TERRAIN?Ha.Occluded:Ha.ColorAndWater;this.transparency===xn.Opaque?this._renderMaterialPass(e,r,s):e.offscreenRenderingHelper.renderToTargets(()=>this._renderMaterialPass(e,r,s),e.offscreenRenderingHelper.tmpColor,e.offscreenRenderingHelper.mainDepth,[0,0,0,0]);break}case U.Depth:case U.Normal:this._renderAuxiliaryPass(e,r,Ha.ColorAndWater);break;case U.Highlight:this.needsHighlight&&this._renderAuxiliaryPass(e,r,Ha.Highlight);break;case U.Shadow:case U.ShadowExcludeHighlight:this._castShadows&&i&&this._renderAuxiliaryPass(e,r,Ha.None);break;case U.ObjectAndLayerIdColor:this._renderAuxiliaryPass(e,r,Ha.ObjectAndLayerIdColor)}}_renderMaterialPass(e,r,i){const{rctx:s}=e;this._passParameters.overlaySource=i,s.bindTechnique(r,this._passParameters,e.bindParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this._renderPatchGroups(e,r,i)}_renderAuxiliaryPass(e,r,i){const s=e.rctx;this._passParameters.overlaySource=i,s.bindTechnique(r,this._passParameters,e.bindParameters),this._renderPatchGroupsAuxiliary(e,r,i)}updateTileBackground(e=null){if(this._tileRenderer==null)return;const r=this._tileRenderer;let i=null;if(e!=null){const s=Ne.toUnitRGBA(e);i=Me(s[0]||0,s[1]||0,s[2]||0)}r.setBackground(i),this._allTiles.forAll(s=>r.updateTileTexture(s,on.FADING)),this._techniqueConfiguration.tileBlendInput=r.backgroundIsGrid?Bf.GridComposite:r.backgroundColor!=null?Bf.ColorComposite:Bf.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchGroupsDirty&&(this._highestVisibleLODTile=null,this._rebuildPatchGroups(),this._patchGroupsDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==PE.NONE){const e=Array.from(this._patchGroups.values()),r=this._stencilEnabledLayerExtents;for(const i of e)MOe(this.renderOrder,i,r);e.sort((i,s)=>POe(i[0],s[0],this.renderOrder)),this._patchGroups=new Map(e.map(i=>[i[0].renderData.localOrigin,i])),this._patchSortingDirty=!1}}_rebuildPatchGroups(){const e=this._rootTiles;if(e!=null){e[0]?.surface.checkAllTilesWaterproofness(),this._patchGroups.clear();for(const r of e)this._rebuildPatchGroupsForRootTile(r)}}_rebuildPatchGroupsForRootTile(e){const r=this._tileIterator;for(r.resetOne(e);!r.done;){const i=r.next(),s=i.renderData;if(!s){this._numTilesCulled++;continue}if(!i.visible){this._numTilesCulled++,r.skipSubtree();continue}const n=s.localOrigin;let o=this._patchGroups.get(n);o||(o=new Array,this._patchGroups.set(n,o)),o.push(i),(!this._highestVisibleLODTile||i.elevationLevel>this._highestVisibleLODTile.elevationLevel)&&(this._highestVisibleLODTile=i),r.skipSubtree()}}_useStencilForTile(e){for(const r of this._stencilEnabledLayerExtents)if(e.intersectsExtent(r))return!0;return!1}_renderPatchGroupsAuxiliary(e,r,i){const s=this._stencilEnabledLayerExtents.length>0;this._patchGroups.forEach(n=>{const o=n[0].renderData.localOrigin;r.program.bindDraw(new Bq(o),e.bindParameters,this._passParameters);for(let a=0;a<n.length;a++)this._renderPatch(e,r,n[a],At.TRIANGLES,s,i)}),e.rctx.bindVAO(null)}_renderPatchGroups(e,r,i){const s=e.bindParameters.camera,n=r.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const p=R2e(this._stage.viewingMode,this._ellipsoidRadius),f=this.pointsOfInterest.centerOnSurfaceFrequent.distance;p.update({distance:f,fovY:s.fovY})}const o=this._stencilEnabledLayerExtents.length>0,a=i===Ha.Occluded;a&&(n.bindTexture("tex",this._emptyTex),n.setUniform3fv("textureOpacities",Ka),n.setUniform4fv("texOffsetAndScale",Wf));const l=this._tileRenderer!=null&&this._tileRenderer.backgroundColor!=null?this._tileRenderer.backgroundColor:Ka;this._techniqueConfiguration.tileBlendInput===Bf.ColorComposite&&n.setUniform3fv("backgroundColor",l);const c=this.wireframe?At.LINES:At.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&n.bindTexture("texNext",this._emptyTex);const h=this._patchGroups;for(const p of h.values()){const f=p[0].renderData.localOrigin;r.program.bindDraw(new Bq(f),e.bindParameters,this._passParameters),this._numOriginsRendered++;for(const m of p){const y=m.renderData,_=y.textureReference;if(_!=null){if(!a){n.setUniform4fv("texOffsetAndScale",_.offsetAndScale),n.bindTexture("tex",_.texture.texture);const v=y.textureFadeFactor,b=v<1?y.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&b!=null&&v<1?(n.setUniform1f("fadeFactor",v),n.setUniform4fv("nextTexOffsetAndScale",b.offsetAndScale),n.setUniform3fv("nextTexOpacities",b.opacities),n.bindTexture("texNext",b.texture.texture)):n.setUniform1f("fadeFactor",1),y.textureIsFading&&this.setNeedsRender(),n.setUniform3fv("textureOpacities",_.opacities)}this._renderPatch(e,r,m,c,o,i),m.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}e.rctx.bindVAO(null)}_renderPatch(e,r,i,s,n,o){const a=i.renderData,l=a.vao,c=l.indexBuffer;if(c==null)return void(cn&&console.error("Rendered tile with no indices: ",i.lij," : ",a));const h=r.program;o===Ha.None||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(h,a.overlay),n&&(r.useStencil=this._useStencilForTile(i),r.bindPipelineState(e.rctx,e.bindParameters.slot));const p=a.geometry.indexCount;e.rctx.bindVAO(l),h.assertCompatibleVertexAttributeLocations(l),e.rctx.drawElements(s,p,c.indexType,0)}_bindOverlayPatchData(e,r){e.setUniform4fv("overlayTexOffset",r.offsets),e.setUniform4fv("overlayTexScale",r.scales)}_updateTechnique(e,r){return this._techniqueConfiguration.output=e,this._techniqueConfiguration.renderOccluded=r,this._shaderTechnique=this._techniqueRepository.releaseAndAcquire(kOe,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){return{tileRenderer:this._tileRenderer}}};u([d({constructOnly:!0})],tc.prototype,"_overlayRenderer",void 0),u([d({constructOnly:!0})],tc.prototype,"_stage",void 0),u([d({readOnly:!0})],tc.prototype,"_isGlobal",null),u([d({constructOnly:!0})],tc.prototype,"_allTiles",void 0),u([d({constructOnly:!0})],tc.prototype,"_ellipsoidRadius",void 0),u([d({value:!1})],tc.prototype,"renderingDisabled",null),u([d()],tc.prototype,"renderPatchBorders",null),u([d()],tc.prototype,"visualizeNormals",null),u([d()],tc.prototype,"cullBackFaces",null),u([d({value:PE.FRONT_TO_BACK})],tc.prototype,"renderOrder",null),u([d()],tc.prototype,"wireframe",null),tc=u([P("esri.views.3d.terrain.TerrainRenderer")],tc);const Bvt=O(),Gvt=O(),CT=O(),jvt=O();let Hvt=class{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}},bf=class extends we{constructor(e){super(e),this._handles=new Ii}initialize(){this._handles.add(this.layers.on("change",()=>this._update())),this._handles.add(ae(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._handles=$e(this._handles),this._waitTask=null,this.layers.destroy()}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(r=>!(!bO(r)||r.isRejected())&&!(r.isFulfilled()&&!qvt(r,this.viewSpatialReference,this.viewingMode))&&(e=r,!(r?.type==="vector-tile"||WF(r)))),e)if(e.isResolved()){const r=QU(e,this.viewSpatialReference,this.viewingMode);if(r!=null){const i=new gc(r.tileInfo);this._lockTilingScheme(i)}}else this._updateWhen(e)}_updateWhen(e){const r=e.when().catch(()=>{}).then(()=>{r!==this._waitTask||this.destroyed||this._update()});this._waitTask=r}_lockTilingScheme(e){if(this.viewingMode===Ue.Global){const r=e.levels.length-1;e.spatialReference.isWebMercator?e=gc.makeWebMercatorAuxiliarySphere(r):tv(e.spatialReference)&&(e=gc.makeGCSWithTileSize(e.spatialReference,e.pixelSize,r))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this._handles.removeAll(),this._handles.add(ae(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===Ue.Global){const e=this.extentHelper.viewSpatialReference,r=tv(e)||vm(e)||bm(e);e.isWebMercator?this.tilingScheme=gc.WebMercatorAuxiliarySphere:r&&(this.tilingScheme=gc.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;e==null||Jb(e,this.extent)||(this.tilingScheme=gc.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function qvt(t,e,r){return QU(t,e,r)!=null}u([d()],bf.prototype,"tilingScheme",void 0),u([d({readOnly:!0})],bf.prototype,"extent",void 0),u([d({value:!1})],bf.prototype,"tilingSchemeLocked",void 0),u([d({constructOnly:!0})],bf.prototype,"viewSpatialReference",void 0),u([d({constructOnly:!0})],bf.prototype,"layers",void 0),u([d({constructOnly:!0})],bf.prototype,"extentHelper",void 0),u([d({constructOnly:!0})],bf.prototype,"viewingMode",void 0),bf=u([P("esri.views.3d.terrain.TilingSchemeLogic")],bf);let Wvt=class{constructor(){this.offset=Ge(),this.scale=0,this.tile=null}init(e,r,i,s){this.tile=e,this.offset[0]=r,this.offset[1]=i,this.scale=s}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}},qt=class extends ws.EventedMixin(we){constructor(e){super(e),this._scaleRangeQueries=new CN,this._iteratorPool=new Go(ROe,r=>r.remove=()=>this._iteratorPool.release(r)),this._postorderIterator=new T0t,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._visibleCached=!1,this._usedMemory=null,this._performanceInfo=new Hvt,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=O(),this._eyePosSurfaceSR=O(),this._splitLimits=new Ld,this._frustum=BR(),this._viewProjectionMatrix=be(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._handles=new Ii,this._watchUpdatingTracking=new Xf,this._frameTask=dE,this._allTiles=new Bt,this._upsampleInfoPool=new Go(Wvt),this._rootTilesExtent=Vt(),this.updatingProgress=.5,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=je.WebMercator,this.visibleElevationBounds=new QS(1/0,-1/0),this.rootTileElevationBounds=new QS(1/0,-1/0),this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this.oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._isWebMercator=!1,this._isWebMercatorOnPlateeCarree=!1,this.overlayManager=new ka({...e,surface:this}),this._isGlobal=!e.view?.state?.isLocal}initialize(){this._lercDecoder=Xyt(this.view.resourceController),this._tilePool=this.view.state.isLocal?new Go(D_t):new Go(F_t);const e=this.view.resourceController.memoryController;this._upsampleMapCache=e.newCache("terrain-upsample",o=>o.unloadMapData()),this._elevationQueryCache=new qyt(e.newCache("elevation-query")),this._handles.add([ae(()=>this.overlayManager.hasHighlights,o=>this._renderer.setNeedsHighlight(o)),ae(()=>this.overlayManager.rendersOccluded,o=>this._renderer.setRenderOccludedOverlay(o)),ae(()=>this.overlayManager.renderer.isEmpty,()=>this._evaluateTransparency())],"overlayManager"),this._renderer=new tc({_overlayRenderer:this.overlayManager.renderer,_ellipsoidRadius:zr(this.view.spatialReference).radius,_stage:this.view._stage,_allTiles:this._allTiles}),this._handles.add([ae(()=>this.baseOpacity,()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?on.UNFADED:on.IMMEDIATE)},Is),ae(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?on.UNFADED:on.IMMEDIATE),Is),ae(()=>this.renderingDisabled,()=>this.view?._stage?.renderer.setParameters({terrainRenderingEnabled:!this.renderingDisabled}),qr),ae(()=>this.backgroundColor,o=>{this._handleLayerViewChanges(),this._renderer.updateTileBackground(o)},Is),ae(()=>this.snapLevel,()=>this._viewChanged=!0,qr),ae(()=>this.view.pointsOfInterest,o=>{this._renderer.pointsOfInterest=o,this._watchUpdatingTracking.removeAll(),o&&this._watchUpdatingTracking.add(()=>o.focus.renderLocation,()=>this._allTilesSorted=!1)}),ae(()=>ai.TERRAIN_TILE_TREE_SHOW_TILES,o=>{o&&!this._treeDebugger?ce(()=>import("./TerrainTileTree3DDebugger-0b56b934.js"),["./TerrainTileTree3DDebugger-0b56b934.js","./TileTreeDebugger-e847dad5.js"],import.meta.url).then(({TerrainTileTree3DDebugger:a})=>{!this._treeDebugger&&ai.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new a({view:this.view}))}):o||(this._treeDebugger=$e(this._treeDebugger))},Pr)]);const{spatialReference:r}=this.view;this._extentHelper=u0t(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:r});const i=new wR({getCollections:()=>this.view?.defaultsFromMap?.mapCollections?.map(({layers:o})=>o),getChildrenFunction:o=>o&&"layers"in o?o.layers:null}),s=new bf({layers:i,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:r});this._set("tilingSchemeLogic",s),this._updateTilingScheme(),this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(Nf.ELEVATION),this._mapDataRequester=this.view.resourceController.createStreamDataRequester(Nf.BASEMAP);const n=this.view.resourceController.scheduler;this._frameTask=n.registerTask(vt.TERRAIN_SURFACE,this),this._handles.add([ae(()=>this._extentHelper.stencilEnabledExtents,o=>this._renderer.setStencilEnabledLayerExtents(o),Pr),ae(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),qr),ae(()=>this.extent,()=>this._updateRootTiles(),Pr),this.view.on("resize",()=>this._viewChangeUpdate()),ae(()=>{const o=this.view,a=o.state;return[this._lodBias,this.lodSnapping,o.resourceController?.memoryController?.memoryFactor,a.camera,a.contentCamera,a.fixedContentCamera]},()=>this._viewChangeUpdate(),Is),ae(()=>this.view.qualitySettings?.tiledSurface?.textureFadeDuration,o=>this._renderer.textureFadingEnabled=o>0,Pr),ae(()=>this.view.qualitySettings?.physicallyBasedRenderingEnabled,o=>this._renderer.pbrMode=o?lt.Terrain:lt.Disabled,Pr),ae(()=>this._userClippingExtent,()=>this._updateClippingExtent(),qr)]),this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges()}destroy(){this._frameTask.remove(),this._handles.destroy(),this._watchUpdatingTracking.destroy(),this._lercDecoder=Bi(this._lercDecoder),this._removeAllTiles(),this._upsampleMapCache=$e(this._upsampleMapCache),this._elevationQueryCache=$e(this._elevationQueryCache),this._set("tilingSchemeLogic",$e(this.tilingSchemeLogic)),this._basemapLayerViewHandles.forEach((e,r)=>this._unregisterTiledLayerView(r)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",$e(this.overlayManager)),this._tilePool=$e(this._tilePool),gK.prune(),this._treeDebugger=$e(this._treeDebugger),this._renderer=$e(this._renderer),this._iteratorPool=$e(this._iteratorPool),this._set("view",null),this._extentHelper=$e(this._extentHelper),this._upsampleInfoPool=$e(this._upsampleInfoPool),n0t(),Q0t()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){if(this.lodSnapping===HO.ON){const e=this.view,r=this.tilingScheme,i=e.pointsOfInterest?.cameraOnSurface?.scale;if(r&&i){const s=e.state.contentCamera;let n=wU(e,s.eye,s.viewForward,s.up).tilt;n>90&&(n=180-n);const o=2*(n/90)**2,a=r.levelAtScale(i)-o,l=Math.min(a,this._splitLimits.maxLod||1/0);return l<=0?null:l}}return null}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?HO.ON:HO.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:e}=this,{clippingArea:r}=this.view;if(r==null||e==null)return null;const i=Vt(),s=cOe(r,i,e)?i:null,n=this._get("extent");return Jb(s,n)?n:s}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const e=uB(this.groundExtent,this._userClippingExtent,Vt()),r=this._get("extent");return Jb(e,r)?r:e}get groundExtent(){return this._tilingSchemeExtent!=null?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){return this.tilingSchemeLogic?.extent}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||this._watchUpdatingTracking?.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||this.overlayManager?.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){return this.view?.map?.ground?.opacity??1}set baseOpacity(e){this.view.map.ground.opacity=e}get viewingMode(){return this.view.state.viewingMode}get ready(){return this._rootTiles!=null}set renderOrder(e){this._renderer.renderOrder=e,this._set("renderOrder",e)}get rootTiles(){return this._rootTiles}get spatialReference(){return this.tilingScheme?.spatialReference??null}get backgroundColor(){return this.view.map.ground.surfaceColor}set backgroundColor(e){this.view.map.ground.surfaceColor=e}set slicePlaneEnabled(e){this._renderer.slicePlaneEnabled=e,this._set("slicePlaneEnabled",e),this._evaluateTransparency()}get tilingSchemeLocked(){return this.tilingSchemeLogic?.tilingSchemeLocked??!1}get wireframe(){return this._renderer?.wireframe}set wireframe(e){e!==this._renderer.wireframe&&(this._renderer.wireframe=e,this._updateAllTileGeometries())}set _visible(e){e!==this._visibleCached&&(this._visibleCached=e,this._renderer.setVisibility(e),this.suspended=!e)}get opaque(){return this._renderer.transparency===xn.Opaque}set suspended(e){this._set("suspended",e),this._viewChangeUpdate()}get textureFadeDuration(){return this.view.qualitySettings.tiledSurface.textureFadeDuration??0}intersect(e,r,i,s){this._renderer.intersect(e,r,i,s)}getElevation(e,r,i,s){const n=this._rootTiles;if(n==null||!n.length||n[0].layerInfo[rr.ELEVATION].length===0)return null;const o=fl;return o[0]=e,o[1]=r,o[2]=i,Zs(o,s,o,this._spatialReference)?Phe(n,o[0],o[1]):(Q.getLogger(this).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null)}getElevations(e,r,i){const s=this._rootTiles,n=s?s[0].layerInfo[rr.ELEVATION].length:0;if(s!=null&&s.length&&n!==0)for(let o=0;o<r;++o){const a=3*o;i(o,Phe(s,e[a],e[a+1]))}else for(let o=0;o<r;++o)i(o,null)}getScale(e){if(!this.tilingScheme)return null;if(!So(e,fl,this.spatialReference))return Q.getLogger(this).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const r=this._rootTiles;if(r!=null){for(const i of r)if(i?.containsPoint(fl)){let s=i;for(;s.children[0]&&!s.rendered;){const n=s.children[0].extent;let o=0;fl[0]>n[2]&&(o+=1),fl[1]<n[1]&&(o+=2),s=s.children[o]}return this._getLodBiasCorrectedScale(s.level)}}return 1/0}getSphereElevationBounds(e,r){if(fl[0]=e[0],fl[1]=e[1],fl[2]=e[2],fl[3]=e[3],!Zs(fl,r,fl,this.tilingScheme?.spatialReference))return Q.getLogger(this).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let i=1/0,s=-1/0;const n=a=>{if(a&&hte(a.extent,fl))if(a.isLeaf||a.rendered)i=Math.min(i,a.elevationBounds[0]),s=Math.max(s,a.elevationBounds[1]);else for(const l of a.children)n(l)},o=this._rootTiles;if(o!=null)for(const a of o)n(a);return{min:i,max:s}}getSphereScale(e,r){if(!this.tilingScheme)return null;if(!So(e,fl,this.spatialReference))return Q.getLogger(this).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;fl[3]=r;let i=null;const s=o=>{if(o&&hte(o.extent,fl)){const a=o.children;if(a[0]&&!o.rendered)for(const l of a)s(l);else{const l=this._getLodBiasCorrectedScale(o.level);i=i==null?l:Math.min(i,l)}}},n=this._rootTiles;if(n!=null)for(const o of n)s(o);return i}queryVisibleScaleRange(e,r,i,s){const n=r?this.tilingScheme.levelAtScale(r):0,o=i?this.tilingScheme.levelAtScale(i):1/0,a=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(e,n+a,o+a,s)}_evaluateTransparency(){const e=this.baseOpacity,r=this.overlayManager.renderer.isEmpty,i=this._renderer.transparency,s=this._allSurfaceLayersTransparent()?r?xn.Empty:xn.TransparentWithDraped:e>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?xn.Opaque:xn.Semitransparent,n=i!==s;return n&&(this._renderer.transparency=s,this.view?._stage?.renderer.setParameters({terrainTransparency:this._renderer.transparency})),n}_updateTilingScheme(){const e=this.tilingSchemeLogic.tilingScheme;if(e===this.tilingScheme)return;Rf(!!e,"tiling scheme cannot be reset to undefined"),this._isGlobal=!this.view?.state?.isLocal,this.tilingScheme&&this._removeAllTiles();const r=e?.spatialReference??je.WebMercator;this._spatialReference=r,this._isWebMercator=!!r?.isWebMercator,this._isWebMercatorOnPlateeCarree=this._isWebMercator&&yR(this.view?.renderSpatialReference),this._set("tilingScheme",e),this._updateClippingExtent(),e&&(this._updateTiledLayers(),this._renderer.setTileSize(e.pixelSize),this.overlayManager.setSpatialReference(e.spatialReference),this._updateRootTiles())}_acquireTile(e,r,i,s){const n=this._tilePool.acquire();return fL[0]=e,fL[1]=r,fL[2]=i,n.init(fL,s,this),n}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:e,tilingScheme:r}=this;if(!r)return;const i=Yvt;let s=r.rootTilesInExtent(e,i,5*zS);if(this._rootTiles!=null){if(s.length>zS)return void Q.getLogger(this).warn(eZe);const n=this._rootTiles.map(a=>a.lij),o=DIe(n,s,Mhe);if(this._updatingRootTiles=!0,o.removed.length>0||o.added.length>0){const a=this._rootTiles.filter(l=>!(o.removed.findIndex(c=>Mhe(c,l.lij))>-1)||(this._purgeTile(l),!1));o.added.forEach(l=>a.push(this._newRootTile(l))),this._setRootTiles(a)}}else this._updatingRootTiles=!0,s.length>zS&&(Q.getLogger(this).warn(tZe),s=r.rootTilesInExtent(e,i,zS)),this._setRootTiles(s.map(n=>this._newRootTile(n)));Jb(i,this._rootTilesExtent)||(this._rootTilesExtent=Vt(i)),this._visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const e=this._allTiles.filter(r=>r.isLoaded&&r.intersectsClippingArea);e.forEach(r=>this._renderer.updateTileGeometryState(r)),e.forEach(r=>r.renderData.updateNeighborData()),this._updateTilesGeometries(e),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(e){if(e.length===0)return;e.sort(ey);const r=this.renderer;e.forEach(i=>r.updateGeometryIfNeeded(i)),e.forEach(i=>this._pendingTilesForElevationUpdateEvent.add(i))}_shouldSplit(e){return e.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===xt.SPLIT}_newRootTile(e){const r=this._acquireTile(0,e[1],e[2],null);return this._shouldSplit(r)&&r.setPendingUpdate(xt.SPLIT),this._loadTile(r),this._markTileToUpdate(r),this._updateRootTileElevationBounds(),r}_setRootTiles(e){if(this._rootTiles=e,this._allTiles.clear(),e!=null){const r=this._iteratorPool.acquire();for(r.reset(e);!r.done;)this._allTiles.push(r.next());r.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(e)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this._visibleCached&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(e){e.updateClippingStatus(this.extent)&&e.resetPendingUpdate(xt.GEOMETRY)&&this._updateTileGeometryState(e)}_updateTilesVisibility(e){if(e==null)return;const r=M0t(e),i=this.visibleElevationBounds;let s=r?i.min:1/0,n=r?i.max:-1/0;const o=this.extent,a=this._viewProjectionMatrix;this.setTileTreeDirty();const l=this._iteratorPool.acquire();for(l.reset(e);!l.done;){const c=l.next();c.updateClippingStatus(o)&&c.resetPendingUpdate(xt.GEOMETRY)&&this._updateTileGeometryState(c),c.setPendingUpdate(xt.RENDERDATA),c.computeVisibility(),c.updateScreenDepth(a),c.renderData&&(s=Math.min(c.elevationBounds[0],s),n=Math.max(c.elevationBounds[1],n))}l.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._batchUpdatePendingTileGeometries(),isFinite(s)&&isFinite(n)&&(i.min!==s||i.max!==n)&&(this.visibleElevationBounds=new QS(s,n))}_updateRootTileElevationBounds(){let e=1/0,r=-1/0;const i=this._rootTiles;i?.forEach(({elevationBounds:n})=>{e=Math.min(e,n[0]),r=Math.max(r,n[1])});const s=this.rootTileElevationBounds;s.min===e&&s.max===r||(this.rootTileElevationBounds=new QS(e,r))}_updateViewDependentParameters(){const{camera:e,contentCamera:r}=this.view.state,i=Math.tan(.5*r.fovX),s=Math.tan(.5*r.fovY),n=this.tilingScheme.pixelSize,o=2**-this._lodBias*e.pixelRatio;this._splitLimits.aboveGround=e.aboveGround,this._splitLimits.fovX=i,this._splitLimits.fovY=s,this._splitLimits.relativeWidthLimit=n/e.width*this.maxTextureScale*o,this._splitLimits.relativeHeightLimit=n/e.height*this.maxTextureScale*o,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?(this._splitLimits.frustum==null&&(this._splitLimits.frustum=BR()),sF(this._splitLimits.frustum,r.frustum)):this._splitLimits.frustum=null,sF(this._frustum,e.frustum),oi(this._viewProjectionMatrix,r.projectionMatrix,r.viewMatrix),re(this._eyePosRenderSR,r.eye),Zs(e.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateRenderData(e){e.rendered&&!e.shouldLoad&&(_Re(e)?this._loadChildren(e):Zvt(e)&&this._loadParent(e))}_updateTileGeometryState(e){e.updateVisibility(),this._renderer.updateTileGeometryState(e)&&this._markTileToUpdate(e),this._usedMemory=null}_markAllTileNeighborsForGeometryUpdate(e){const r=this._pendingTilesToUpdate;e.forEachLoadedNeighbor(i=>{r.add(i)})}_updateTileTexture(e,r){const i=e.resetPendingUpdate(xt.TEXTURE_FADING)?xt.TEXTURE_FADING:!!e.resetPendingUpdate(xt.TEXTURE_NOFADING)&&xt.TEXTURE_NOFADING;i&&(this._renderer.updateTileTexture(e,i),this._usedMemory=null,r.madeProgress())}_emitElevationUpdateEventForTiles(){const e=Fz.extent;Ic(e),this._pendingTilesForElevationUpdateEvent.forEach(r=>V_(e,r.extent,e)),this._pendingTilesForElevationUpdateEvent.clear(),Fz.spatialReference=this.spatialReference,this.emit("elevation-change",Fz)}runTask(e){this._handleLayerViewChanges(e),this._frameTask.processQueue(e),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,e),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(e),this._sortTiles(e);const r=!this.view.state.fixedContentCamera;this._mergeAndSplit(e,r),this._updateElevation(e),this._updateTextures(e),r||this._mergeAndSplit(e,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._batchUpdatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),e.done&&e.hasProgressed&&this.requestUpdate(),this.notifyChange("updatingProgressValue")}_updateAllTilesStatus(e){if(!this._viewChanged||!this._rootTiles||e.done)return;this._viewChanged=!1;const r=this._iteratorPool.acquire();r.reset(this._rootTiles);const i=this.snapLevel,s=this._splitLimits,n=this._eyePosRenderSR;for(;!r.done;){const o=r.next(),a=o.shouldSplit(s,n,i);if(a!==xt.SPLIT){if(o.resetPendingUpdate(xt.SPLIT)&&o.updateAgentSuspension(),a===xt.ELEVATION&&o.updateAgents(rr.ELEVATION),r.skipSubtree(),!o.isLeaf){o.setPendingUpdate(xt.MERGE),o.resetPendingUpdate(xt.SPLIT);const l=this._iteratorPool.acquire();l.resetOne(o);const c=this._viewProjectionMatrix;for(let h=l.next();!l.done;h=l.next())this._updateClippingStatus(h),h.updateVisibility(),h.updateScreenDepth(c);l.remove()}}else o.resetPendingUpdate(xt.MERGE),o.isLeaf&&(o.setPendingUpdate(xt.SPLIT),r.skipSubtree()),o.rendered&&o.setPendingUpdate(xt.RENDERDATA)}r.remove(),this.requestUpdate(),(this.shortBatches||!this.oneBatchPerFrameTask)&&this._batchUpdatePendingTileGeometries(),e.madeProgress()}_sortTiles(e){e.done||this._allTilesSorted||(O0t(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),e.madeProgress())}_markTileToUpdate(e){Te(e.isLoaded),e.intersectsClippingArea&&(this._pendingTilesToUpdate.add(e),this._markAllTileNeighborsForGeometryUpdate(e))}_batchUpdatePendingTileGeometries(){const e=this._pendingTilesToUpdate;if(e.size===0)return;const r=Array.from(this._pendingTilesToUpdate.keys()).filter(n=>n.isLoaded&&n.intersectsClippingArea),i=(n,o)=>{!o?.isLoaded||!o.intersectsClippingArea||o.level<n.level||e.has(o)||(e.add(o),r.push(o),o.renderData.updateNeighborData())};r.sort(ey);const s=r.length;for(let n=0;n<s;++n){const o=r[n];Te(o.isLoaded),Te(o.intersectsClippingArea);const a=o.renderData;a.updateNeighborData();const l=a._dirtyEdgeResolutions,c=a.geometryState.neighborData.cornerPeerNeighbors,h=p=>{const f=aM[p];i(o,c[p]?.findCorner(ZF(f),m=>m.isLoaded))};for(let p=0;p<4;++p)if(l&1<<p){const f=a.geometryState.neighborData.edgePeerNeighbors[p];f&&f?.level>=o.level&&f.forAllSubtreeOnSide(YF(Vf[p]),m=>!(!m.isLoaded||!m.intersectsClippingArea)&&(Te(e.has(m)||ey(o,m)<0),i(o,m),!0)),h((p+1)%4),h(p)}}e.clear(),this._updateTilesGeometries(r),cn&&qF&&this.checkAllTilesWaterproofness()}_mergeAndSplit(e,r){if(this.suspended||e.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let i=!1;const s=this.view.state.fixedContentCamera;let n=!1;for(;!e.done;){n=!0;let o=!1;const a=!this._allTiles.some(l=>{if(!i&&!s&&!l.visible)return e.done;let c=l;if(l.resetPendingUpdate(xt.MERGE)){if(!r)return l.setPendingUpdate(xt.MERGE),e.done;for(;c.parent?.resetPendingUpdate(xt.MERGE);)c=c.parent;this._mergeTile(c),o=!0,e.madeProgress()}else l.resetPendingUpdate(xt.SPLIT)&&(this._splitTile(l),o=!0,e.madeProgress());return!e.done&&c===l&&l.resetPendingUpdate(xt.RENDERDATA)&&(this._updateRenderData(l),e.madeProgress()),e.done});if(o&&(this._allTilesSorted=!1,this._allTilesDirty=!0),a){if(!i){i=!0;continue}if(!o)break}else this._allTilesDirty=!0}n?e.madeProgress():this._allTilesDirty=!0,!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries(),this._sortTiles(e)}_updateElevation(e){e.done||(this._allTiles.some(r=>(r.resetPendingUpdate(xt.GEOMETRY)&&(this._updateTileGeometryState(r),this._updateTileTexture(r,e),this.shortBatches&&this._batchUpdatePendingTileGeometries(),e.madeProgress()),e.done)),!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries())}_updateTextures(e){e.done||this._allTiles.some(r=>(this._updateTileTexture(r,e),e.done))}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(gs.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){const e=this.view.resourceController.memoryController.memoryFactor;return this.view.qualitySettings.tiledSurface.lodBias-(1-e)*QXe}_getLodBiasCorrectedScale(e){const r=this.tilingScheme.levels,i=ve(e-this._lodBias,0,r.length-1),s=i-Math.floor(i);return r[Math.floor(i)].scale*(1-s)+r[Math.ceil(i)].scale*s}_removeAllTiles(){this._rootTiles!=null&&(this._rootTiles.forEach(e=>this._purgeTile(e)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this._visible=!1}_purgeDescendantTiles(e){if(!e.children[0])return!1;let r=!1;for(let i=0;i<4;++i)r=this._purgeTile(e.children[i])||r;return e.unsetChildren(),r}_purgeTile(e){const r=this._purgeDescendantTiles(e)||e.rendered;return this._allTiles.removeUnordered(e),this._unloadTile(e),this._tilePool.release(e),r}_unloadTile(e){this._pendingTilesToUpdate.delete(e),this._pendingTilesForElevationUpdateEvent.delete(e),e.unload(this._renderer)}_splitTile(e){Rf(e.isLeaf,"tile that is already split should not be split again!");const r=e.level+1,i=2*e.lij[1],s=2*e.lij[2];e.setChildren(this._createTile(r,i,s,e),this._createTile(r,i,s+1,e),this._createTile(r,i+1,s,e),this._createTile(r,i+1,s+1,e)),e.setPendingUpdate(xt.RENDERDATA),e.updateAgentSuspension(),this._allTiles.pushArray(e.children),this._allTilesDirty=!0,++this._performanceInfo.numSplit}_emitTileScaleChange(e,r=e.level){mL.spatialReference=this.spatialReference,mL.extent=e.extent,mL.scale=this._getLodBiasCorrectedScale(r),this.emit("scale-change",mL)}_createTile(e,r,i,s){Rf(!!s,"_createTile sanity check");const n=this._acquireTile(e,r,i,s);return n.updateClippingStatus(this.extent),n.updateScreenDepth(this._viewProjectionMatrix),this._shouldSplit(n)&&n.setPendingUpdate(xt.SPLIT),n}get shortBatches(){return this.view.state.mode!==Fr.IDLE}_mergeTile(e){Rf(!e.hasPendingUpdate(xt.SPLIT),"_mergeTile sanity check"),this._purgeDescendantTiles(e)&&(Rf(!e.renderData,"_mergeTile sanity check"),this._loadTile(e),this._markTileToUpdate(e),this._emitTileScaleChange(e),this.shortBatches&&this._batchUpdatePendingTileGeometries()),this._allTilesDirty=!0,++this._performanceInfo.numMerged}_loadChildren(e){Rf(e.rendered,"parent should be rendered"),this._unloadTile(e);const r=e.children;r.forEach(i=>this._loadTile(i)),r.forEach(i=>this._pendingTilesToUpdate.add(i)),this._markAllTileNeighborsForGeometryUpdate(e),this._emitTileScaleChange(e,e.level+1),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_loadParent(e){const r=e.parent;this._unloadChildren(r),this._loadTile(r),this._markTileToUpdate(r),this._emitTileScaleChange(r,r.level),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_unloadChildren(e){const r=e.children;if(r[0])for(let i=0;i<4;++i){const s=r[i];this._unloadChildren(s),this._unloadTile(s)}}_loadTile(e){e.load(),e.setPendingUpdate(xt.RENDERDATA),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(e)}_elevationDataArrived(e,r,i){const s=new l0t(e.lij,e.extent,i);e.dataArrived(r,rr.ELEVATION,s);const n=[e],o=e.level,a=this._iteratorPool.acquire();for(a.reset(n);!a.done;){const l=a.next();l.findElevationBoundsForLayer(r,o),l.computeElevationBounds()}o===0&&this._updateRootTileElevationBounds(),a.remove(),this._updateTilesVisibility(n)}_handleLayerViewChanges(e=Ja){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let r=!1;const i=new Set;let s=-1;for(const n of this.view.allLayerViews.items)if(i.add(n.uid),oM(n)||vA(n))if(this._basemapLayerViewHandles.has(n.uid)&&!vA(n)){const o=this._layerClassFromLayerView(n),a=this._getLayerIdxByUID(o,n.uid);a!=null&&((a<s||s==null)&&(r=!0),s=a)}else this._registerTiledLayerView(n),n.layer.loaded&&(r=!0);this._basemapLayerViewHandles.forEach((n,o)=>{i.has(o)||(this._unregisterTiledLayerView(o),r=!0)}),r&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),e.madeProgress()}_allSurfaceLayersTransparent(){let e=this.view.map?.ground?.opacity===0;for(const r of this.view.allLayerViews.items)if(sW(r)&&!ige(r.layer)&&r.fullOpacity!==0)return e=!1,e;return e}_hasCompositeBlendMode(){for(const e of this.view.allLayerViews.items)if((XF(e)||vA(e))&&N0t(cW[e.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(e){return iW(e)?rr.ELEVATION:rr.MAP}_registerTiledLayerView(e){const r=[];if((XF(e)||vA(e))&&r.push(ae(()=>e.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(on.UNFADED)})),!vA(e)){const i=this._layerClassFromLayerView(e);r.push(ae(()=>e.suspended,()=>this._updateTiledLayers())),r.push(ae(()=>e.fullOpacity,()=>this._updateTileTextures(on.UNFADED))),r.push(ae(()=>"effectiveScaleRange"in e.layer?e.layer.effectiveScaleRange:null,()=>this._restartAllAgents(i))),r.push(e.on("data-changed",()=>{const s=this._getLayerIdxByUID(i,e.uid);s!=null&&this._invalidateLayerData(s,i)}))}this._unregisterTiledLayerView(e.uid),this._basemapLayerViewHandles.set(e.uid,r)}_unregisterTiledLayerView(e){const r=this._basemapLayerViewHandles.get(e);if(r){for(const i of r)i.remove();this._basemapLayerViewHandles.delete(e)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const e=this.view.allLayerViews,r=[[],[]];let i=null;e.forEach(s=>{if(!s.layer||s.suspended||!oM(s)||!s.fullExtent)return;const n=this._layerClassFromLayerView(s);if(n===rr.MAP){const o=s.displayLevelRange.maxLevel;o!==1/0&&(i===null||o>i)&&(i=o)}r[n].push(s)});for(const s of mb){const n=this._layerViews[s],o=r[s];o.reverse();const a=o.length;let l=n.length!==a;const c=new Array(a),h=new Array(n.length);this._layerIndexByUid[s].clear();for(let p=0;p<a;p++){const f=o[p].uid;this._layerIndexByUid[s].set(f,p);const m=n.indexOf(o[p]);c[p]=m,p!==m&&(l=!0),m>-1&&(h[m]=p)}if(l){const p=this._postorderIterator;for(p.reset(this._rootTiles);!p.done;)p.next().modifyLayers(h,c,s);this._layerViews[s]=o,this._restartAllAgents(s),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(i)&&this._viewChangeUpdate()}_restartAllAgents(e){const r=this._postorderIterator;for(r.reset(this._rootTiles);!r.done;){const i=r.next();i.restartAgents(e),e===rr.ELEVATION&&i.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(e,r){return this._layerViews[r][e]}numLayers(e){return this._layerViews[e].length}_updateTileTextures(e){this._allTiles.forAll(r=>{r.updateAgents(rr.MAP),e===on.IMMEDIATE?this.renderer.updateTileTexture(r,xt.TEXTURE_NOFADING):r.updateRenderData(rr.MAP,e)}),this._evaluateTransparency()}_invalidateLayerData(e,r){this._allTiles.forAll(i=>i.removeLayerAgent(e,r)),this._allTiles.forAll(i=>i.invalidateLayerData(e,r))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(e=gs.UPDATE){this.renderer.setNeedsRender(e)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(e,r,i,s){const n=this.layerViewByIndex(r,i),o=n.layer;return!o.tilemapCache||nM(n)?this._requestTileData(e,i,n,s):(++this._asyncWorkItems,o.tilemapCache.fetchAvailability(e.lij[0],e.lij[1],e.lij[2],{...s,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(a=>{throw--this._asyncWorkItems,Yt(s),us(a)||this._dataMissing(e,i,n,{notInTilemap:!0}),a}).then(()=>this._frameTask.schedule(()=>this._requestTileData(e,i,n,s),s.signal)))}_requestTileData(e,r,i,s){return r===rr.ELEVATION?iW(i)?this._requestElevationTileData(e,i,s):Promise.reject():sW(i)?this._requestMapTileData(e,i,s):Promise.reject()}_requestElevationTileData(e,r,i){++this._asyncWorkItems;const s=a=>{if(An(i))return;const l=this._layerIndexByUid[rr.ELEVATION].get(r.uid);l!=null?(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(e,l,a)):Q.getLogger(this).warn("TerrainSurface: received data from unknown layer %d %s",rr.ELEVATION,e.lij.toString())},n=a=>{us(a)||(this._dataMissing(e,rr.ELEVATION,r,a),this.requestUpdate())};if(Hce(r.layer))return r.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],{noDataValue:NR,signal:i.signal}).then(a=>{if(!An(i))return this._frameTask.schedule(()=>s(a),i.signal,n);Q.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.")},n).finally(()=>{--this._asyncWorkItems});const o=r.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);return this._elevationDataRequester.request(o,"binary",i).then(a=>this._lercDecoder.decode(a,{noDataValue:NR},i.signal)).then(a=>{a?s(new Wyt(a)):n(new Error("LERC decoding failed"))},n).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(e,r,i){++this._asyncWorkItems;const s=(h,p)=>{--this._asyncWorkItems,M2(p),An(i)||(this._dataMissing(e,rr.MAP,r,h),this.requestUpdate())},n=h=>p=>s(p,h),o=h=>this._frameTask.schedule(()=>{--this._asyncWorkItems,this.requestUpdate(),An(i)?M2(h):this._mapTileDataArrived(e,r,h)},i.signal,n(h)).catch(n(h)),a=(h,p=null)=>this._frameTask.schedule(()=>s(h,p));if(nM(r)){const h=r.schemaHelper.getLevelRowColumn(e.lij);return r.fetchTile(h[0],h[1],h[2],i).then(o,a)}if(JU(r))return r.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(o,a);if(hK(r)&&Hce(r.layer))return r.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(h=>{if(An(i))return Q.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void a(kr());o(h)},a);let l=r.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);c7e(r.layer)&&r.layer.refreshTimestamp&&(l+=`${l.includes("?")?"&":"?"}_ts=${r.layer.refreshTimestamp}`);const c=r.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(l,c,i).then(o,a)}_mapTileDataArrived(e,r,i){const s=this._getLayerIdxByUID(rr.MAP,r.uid);s!=null?e.dataArrived(s,rr.MAP,i):(M2(i),Q.getLogger(this).warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(e,r){return this._layerIndexByUid[e].get(r)}_dataMissing(e,r,i,s){const n=this._getLayerIdxByUID(r,i.uid);n!=null?e.dataMissing(n,r,s):Q.getLogger(this).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(e){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll(r=>{r.renderData&&this.overlayManager.setTileParameters(r)}),this._renderer.setNeedsRender(e))}get performanceInfo(){const e=this._performanceInfo;return e.numNodes=this._allTiles.length,e.numLeaves=e.numVisible=e.numRendered=e.numLoadedPerLevel.length=e.numRenderedPerLevel.length=0,this._allTiles.forAll(r=>{r.isLeaf&&e.numLeaves++;const i=r.level;r.renderData&&(e.numLoadedPerLevel[i]=(e.numLoadedPerLevel[i]||0)+1),r.visible&&(e.numVisible++,r.rendered&&(e.numRenderedPerLevel[i]=(e.numRenderedPerLevel[i]||0)+1,e.numRendered++))}),e}get usedMemory(){return this.tilingScheme?(this._usedMemory==null&&(this._usedMemory=this._recalculateUsedMemory()),this._usedMemory!=null?this._usedMemory:0):0}_recalculateUsedMemory(){return this.tilingScheme?this._allTiles.reduce((e,r)=>e+r.usedMemory,0):null}getUsedMemoryForLayerView(e){let r=this.overlayManager.gpuMemoryUsage;const i=this._layerClassFromLayerView(e),s=this._getLayerIdxByUID(i,e.uid);return s!=null&&this._allTiles.forAll(n=>r+=n.getUsedMemoryForLayer(i,s)),r}getTile(e){if(e==null||this._rootTiles==null)return null;const r=e.split("/").map(a=>+a);if(r[0]===0)return this._rootTiles.find(a=>a.lij[1]===r[1]&&a.lij[2]===r[2]);const i=2**r[0],s=Math.floor(r[1]/i),n=Math.floor(r[2]/i);let o;if(this._rootTiles.some(a=>a.lij[1]===s&&a.lij[2]===n&&(o=a,!0)),o){let a=1<<r[0]-1;for(;o.lij[0]<r[0];){let l=r[1]&a?2:0;if((r[2]&a)>0&&l++,!o.children[l])return null;o=o.children[l],a>>=1}return Rf(o.lij[0]===r[0]&&o.lij[1]===r[1]&&o.lij[2]===r[2],"not the right tile?"),o}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(e){this._renderer.renderPatchBorders=e}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(e){this._renderer.visualizeNormals=e}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(e){this._renderer.renderingDisabled=e}get test(){const e=this;return{renderer:e._renderer,lercDecoder:e._lercDecoder,forceReload:()=>{e._rootTiles!=null&&e._rootTiles.length>0&&(e._mergeTile(e._rootTiles[0]),e._viewChangeUpdate())},getTiles:()=>e._allTiles.toArray(),getRenderedTiles(){Nz.clear(),e._allTiles.forAll(i=>{i.visible&&i.rendered&&Nz.push(i)});const r=Nz.toArray();return MOe(e.renderOrder,r),r},lockTilingScheme(r,i){e._extentHelper.defaultTiledLayersExtent=i,e.tilingSchemeLogic.test.lockTilingScheme(r)}}}checkAllTilesWaterproofness(){if(!qF)return;const e=this._rootTiles;if(e==null)return;const r=o=>o?.renderData?.geometry?.indices?.length>0,i=(o,a)=>{r(o)&&console.error("Tile[",o.lij,"] has geometry although parent[",a.lij,"] has geom")},s=o=>{if(o.intersectsClippingArea)if(o.renderData&&!o.renderData.geometryState&&console.error("Tile[",o.lij,"] has renderData but not geometryState"),o.renderData&&!o.renderData.geometry&&console.error("Tile[",o.lij,"] has renderData but not geometryInfo"),!o.renderData?.geometry||(o.renderData.geometry.indices?.length??0)>0||console.error("Tile[",o.lij,"] has renderData but no indices - geometryInfo: ",o.renderData.geometry),r(o)){o.checkGeometryWaterproofness();for(const a of o.children)i(a,o)}else if(o.isLeaf)console.error("Tile[",o.lij,"] has no geometry and no children, from root to leaf");else for(const a of o.children)s(a)},n=o=>{const a=o.parent?.visible??!0,l=o.visible;o.computeVisibility();const c=o.visible;if(l!==c&&a&&console.error(" Tile[",o.lij,"] has out of date visibility: ",l," instead of ",c),!o.isLeaf)for(const h of o.children)n(h)};for(const o of e)s(o),n(o)}get isGlobal(){return this._isGlobal}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateeCarree(){return this._isWebMercatorOnPlateeCarree}isEastEndWrap(e){return this.isGlobal&&e[2]===this.lijEastEnd(e[0])-1}isWestEndWrap(e){return this.isGlobal&&e[2]===0}lijEastEnd(e){return 2**(e+(this.spatialReference!=null&&this.spatialReference.isGeographic?1:0))}wrapEastWest(e){const r=this.lijEastEnd(e[0]),i=e[2];if(0<=i&&i<r)return e;if(!this.isGlobal)return null;const s=(i+(i<0?r:0))%r;return[e[0],e[1],s]}enableInternalChecks(e){gyt(e)}enableWaterproofnessChecks(e){myt(e)}};u([d()],qt.prototype,"_renderer",void 0),u([d({constructOnly:!0})],qt.prototype,"_scaleRangeQueries",void 0),u([d({constructOnly:!0})],qt.prototype,"view",void 0),u([d({constructOnly:!0})],qt.prototype,"overlayManager",void 0),u([d()],qt.prototype,"_hasPendingUpdates",void 0),u([d()],qt.prototype,"_asyncWorkItems",void 0),u([d()],qt.prototype,"_allTilesDirty",void 0),u([d()],qt.prototype,"_allTilesSorted",void 0),u([d()],qt.prototype,"_viewChanged",void 0),u([d()],qt.prototype,"_splitLimits",void 0),u([d({readOnly:!0})],qt.prototype,"_watchUpdatingTracking",void 0),u([d()],qt.prototype,"_frameTask",void 0),u([d({readOnly:!0})],qt.prototype,"snapLevel",null),u([d({readOnly:!0})],qt.prototype,"lodSnapping",null),u([d()],qt.prototype,"_userClippingExtent",null),u([d()],qt.prototype,"_rootTilesExtent",void 0),u([d({readOnly:!0})],qt.prototype,"extent",null),u([d({readOnly:!0})],qt.prototype,"groundExtent",null),u([d({readOnly:!0})],qt.prototype,"_tilingSchemeExtent",null),u([d({readOnly:!0})],qt.prototype,"updating",null),u([d({readOnly:!0})],qt.prototype,"running",null),u([d(o0t)],qt.prototype,"updatingProgress",void 0),u([d({readOnly:!0})],qt.prototype,"updatingProgressValue",null),u([d()],qt.prototype,"_maxNumUpdating",void 0),u([d()],qt.prototype,"baseOpacity",null),u([d()],qt.prototype,"hasCompositeBlendMode",void 0),u([d({readOnly:!0})],qt.prototype,"viewingMode",null),u([d()],qt.prototype,"maxTextureScale",void 0),u([d({readOnly:!0})],qt.prototype,"ready",null),u([d({value:PE.FRONT_TO_BACK})],qt.prototype,"renderOrder",null),u([d({readOnly:!0})],qt.prototype,"rootTiles",null),u([d()],qt.prototype,"_rootTiles",void 0),u([d({readOnly:!0})],qt.prototype,"spatialReference",null),u([d({type:Ne})],qt.prototype,"backgroundColor",null),u([d({value:!1})],qt.prototype,"slicePlaneEnabled",null),u([d({readOnly:!0})],qt.prototype,"tilingScheme",void 0),u([d({readOnly:!0})],qt.prototype,"tilingSchemeLocked",null),u([d({readOnly:!0})],qt.prototype,"tilingSchemeLogic",void 0),u([d()],qt.prototype,"wireframe",null),u([d({value:!1})],qt.prototype,"suspended",null),u([d()],qt.prototype,"textureFadeDuration",null),u([d()],qt.prototype,"visibleElevationBounds",void 0),u([d()],qt.prototype,"rootTileElevationBounds",void 0),u([d()],qt.prototype,"_layerViewsDirty",void 0),u([d()],qt.prototype,"renderPatchBorders",null),u([d()],qt.prototype,"visualizeNormals",null),u([d()],qt.prototype,"renderingDisabled",null),qt=u([P("esri.views.3d.terrain.TerrainSurface")],qt);const Xvt=qt;function Mhe(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function _Re(t){const e=t.children;if(!e[0])return!1;for(const r of e)if(r.shouldLoad)return!0;for(const r of e)if(_Re(r))return!0;return!1}function Zvt(t){return t.isLeaf&&(t.parent?.shouldLoad??!1)}const fl=Xt(),Yvt=Vt(),fL=[0,0,0],Nz=new Bt,Fz={spatialReference:null,extent:Vt(),context:"ground"},mL={spatialReference:null,extent:null,scale:0};function Phe(t,e,r){for(const i of t){if(!i.containsPointXY(e,r))continue;let s=i;for(;s&&!s.renderData;){const o=(e>s.extentMidX?1:0)+(r<s.extentMidY?2:0);s=s.children[o]}const n=s?.renderData?.geometryState.samplerData??null;return Yi(e,r,n)}return null}let Jvt=class{constructor(e,r,i){this.operation=e,this.geometry=r,this.states=i}},rO=class extends we{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commitLayer(e,r){const i=this._dirtyGeomRecords.get(e);i&&(i.forEach((s,n)=>{const o=this._ensureGeomRecord(e,n);s.forEach(({geometry:a,operation:l,states:c},h)=>{let p=!1;if(l===Xi.UPDATE){const f=o.get(h);if(f){if(c&Sn.TRANSFORMATION){const m=this.model.getObject(n);this.model.updateRenderGeometryTransformation(m,a,f)&&(p=!0)}p||r.updates.push({renderGeometry:f,updateType:c})}else nt(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(l===Xi.REMOVE||p){const f=o.get(h);f?(r.removes.push(f),o.delete(h)):l===Xi.REMOVE&&nt(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove")}if(l===Xi.ADD||p){const f=this.model.getObject(n);if(f!=null){const m=this.model.getRenderGeometry(f,a);r.adds.push(m),o.set(h,m)}}}),o.size===0&&this._residentGeomRecords.get(e).delete(n)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e),this.dirty=this._hasDirtyGeometryRecords)}getResidentRenderGeometries(e,r){const i=this._residentGeomRecords.get(e);i&&i.forEach(s=>s.forEach(n=>r.push(n)))}_objectStateChanged(e,r){for(const i of r.geometries)this._updateOrCreateDirtyRecord(r,i,null,Xi.UPDATE,e)}visibilityChanged(e){this._objectStateChanged(Sn.VISIBILITY,e)}highlightChanged(e){this._objectStateChanged(Sn.HIGHLIGHT,e)}occlusionChanged(e){this._objectStateChanged(Sn.OCCLUDEE,e)}objectGeometryUpdated(e){this._updateOrCreateDirtyRecord(e.object,e.geometry,null,Xi.UPDATE,Sn.GEOMETRY)}layerAdded(e){e.objects.forAll(r=>this._layerObjectAdded(e,r))}layerRemoved(e){e.objects.forAll(r=>this._layerObjectRemoved(e,r))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,r){const i=e.id;for(const s of r.geometries)this._objectGeometryAdded(r,s,i)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const r of e.objects)this._layerObjectAdded(e.layer,r)}layerObjectsRemoved(e){for(const r of e.objects)this._layerObjectRemoved(e.layer,r)}_layerObjectRemoved(e,r){const i=e.id;for(const s of r.geometries)this._objectGeometryRemoved(r,s,i)}shaderTransformationChanged(e){const r=this._residentGeomRecords.get(e.id);r&&r.forEach((i,s)=>{const n=this.model.getObject(s);n&&n.hasVolativeTransformation()&&i.forEach(o=>o.shaderTransformationChanged())})}objectTransformation(e){const r=this._getParentLayerId(e),i=e.id;this._ensureGeomRecord(r,i).forEach(s=>{this._updateOrCreateDirtyRecord(e,s.geometry,r,Xi.UPDATE,Sn.TRANSFORMATION)})}objectShaderTransformation(){}objectGeometryAdded(e){this._objectGeometryAdded(e.object,e.geometry)}_objectGeometryAdded(e,r,i=null){this._updateOrCreateDirtyRecord(e,r,i,Xi.ADD)}objectGeometryRemoved(e){this._objectGeometryRemoved(e.object,e.geometry)}_objectGeometryRemoved(e,r,i=null){this._updateOrCreateDirtyRecord(e,r,i,Xi.REMOVE)}_updateOrCreateDirtyRecord(e,r,i,s,n=Sn.NONE){i=i??this._getParentLayerId(e);const o=e.id,a=r.id,l=this._ensureDirtyRecord(i,o),c=l.get(a);if(c){const h=c.operation;h===Xi.REMOVE&&s===Xi.ADD&&c.states!==Sn.NONE?c.operation=Xi.UPDATE:h===Xi.REMOVE&&s===Xi.ADD||h===Xi.ADD&&s===Xi.REMOVE?l.delete(a):h!==Xi.UPDATE||s!==Xi.REMOVE&&s!==Xi.UPDATE?(nt((h===Xi.REMOVE||h===Xi.ADD)&&s===Xi.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),c.states|=n):(c.operation=s,c.states|=n)}else l.set(a,new Jvt(s,r,n));this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(e,r){let i=this._residentGeomRecords.get(e);i||(i=new Map,this._residentGeomRecords.set(e,i));let s=i.get(r);return s||(s=new Map,i.set(r,s)),s}get _hasDirtyGeometryRecords(){return ko(this._dirtyGeomRecords,e=>ko(e,r=>r&&r.size>0))}_ensureDirtyRecord(e,r){let i=this._dirtyGeomRecords.get(e);i||(i=new Map,this._dirtyGeomRecords.set(e,i));let s=i.get(r);return s||(s=new Map,i.set(r,s)),s}_getParentLayerId(e){return e.parentLayer?e.parentLayer.id:$$e}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let r="";return this._dirtyGeomRecords.forEach((i,s)=>{i.forEach((n,o)=>{r.length>0&&(r+=`
`),r+=s+"."+o;const a=[];n.forEach(l=>{const c=l.operation;a[c]||(a[c]=[]),a[c].push(l.geometry.id)});for(let l=0;l<a.length;l++)if(a[l]){r+=" "+e[l-1]+": ";for(let c=0;c<a[l].length;c++)r+=a[l][c]+", "}})}),r}get test(){const e=this;return{get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce((r,i)=>r+i.size,0)},commit:r=>e._dirtyGeomRecords.forEach((i,s)=>e.commitLayer(s,r))}}};u([d({constructOnly:!0})],rO.prototype,"model",void 0),u([d()],rO.prototype,"dirty",void 0),rO=u([P("esri.views.3d.webgl-engine.lib.ModelDirtySet")],rO);const Qvt=rO;let ON=class extends we{constructor(){super(...arguments),this.dirtySet=new Qvt({model:this}),this._content=new Map,this._originFactory=new DQ(null)}getObject(e){return this._content.get(e)}add(e){const r=e.id;nt(!this._content.has(r),"Model/Stage already contains object to be added"),this._content.set(r,e),LF(e)&&this.dirtySet.layerAdded(e)}remove(e){nt(this._content.has(e.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(e.id),e.unload(),LF(e)&&this.dirtySet.layerRemoved(e)}addMany(e){for(const r of e)r!=null&&(nt(!this._content.has(r.id),"Model/Stage already contains object to be added"),this._content.set(r.id,r))}removeMany(e){for(const r of e)nt(this._content.has(r.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(r.id),r.unload()}has(e){return this._content.has(e.id)}forEachOfType(e,r){this._content.forEach(i=>{i.type===e&&r(i)})}getRenderGeometry(e,r){const{shaderTransformer:i,localOrigin:s}=r,n=new ME(r,{shaderTransformer:i,castShadow:e.castShadow});return n.updateTransformation(o=>e.getCombinedStaticTransformation(r,o)),n.localOrigin=s??this._originFactory.getOrigin(n.boundingSphere),n}updateRenderGeometryTransformation(e,r,i){if(e==null)return!1;i.updateTransformation(n=>e.getCombinedStaticTransformation(r,n));const s=this._originFactory.getOrigin(i.boundingSphere);return i.localOrigin!==s}getStats(){const e={},r=Array.from(this._content.values());for(let i=0;i<ls.COUNT;++i)e[i]=r.filter(s=>s.type===i).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};u([d({constructOnly:!0})],ON.prototype,"dirtySet",void 0),ON=u([P("esri.views.3d.webgl-engine.parts.Model")],ON);let Kvt=class{constructor(e){this._totalCount=e,this._indexRanges=[0,e]}allVisible(){return this.componentCount()===this._totalCount}allInvisible(){return this._indexRanges.length===0}componentCount(){const e=this._indexRanges;let r=0;for(let i=0;i<e.length;i+=2)r+=e[i+1];return r}reset(e){e==="all"||e.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=e1t(e)}forEachComponent(e){const r=this._indexRanges;for(let i=0;i<r.length;i+=2){const s=r[i],n=s+r[i+1];for(let o=s;o<n;o++)if(!e(o))return!1}return!0}forEachComponentRange(e){const r=this._indexRanges;for(let i=0;i<r.length;i+=2){const s=r[i];if(!e(s,s+r[i+1]))return!1}return!0}computeOffsetRanges(e){const r=new Array(this._indexRanges.length),i=this._indexRanges;for(let s=0;s<i.length;s+=2){const n=i[s],o=n+i[s+1],a=e[n],l=e[o];r[s]=a,r[s+1]=l-a}return r}};function e1t(t){const e=new Array;if(t.length===0)return e;let r=t[0],i=1;for(let s=1;s<t.length;s++){const n=t[s];r+i===n?i+=1:(e.push(r),e.push(i),r=n,i=1)}return e.push(r),e.push(i),e}let t1t=class{constructor(e,r){this.offsets=r,this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null;const i=this.count;this.visibility=new Kvt(i),this.materialDataBuffer=e.getBuffer(i),this.materialDataIndices=new Uint16Array(i);for(let s=0;s<i;s++)this.materialDataIndices[s]=this.materialDataBuffer.acquireIndex()}destroy(){for(let e=0;e<this.count;e++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[e])}get count(){return this.offsets.length-1}get geometryRanges(){return this.cachedGeometryRanges==null&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return this.highlightCounts==null?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return this.highlightCounts==null?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((this.cachedHighlightRanges==null||this.cachedDefaultRanges==null)&&this.highlightCounts!=null){const{highlightRanges:e,defaultRanges:r}=r1t(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=e,this.cachedDefaultRanges=r}}};function r1t(t,e,r){const i=[],s=[];let n=r.length,o=r.length;return e.forEachComponent(a=>(t[a]>0?(n!==a-1&&(i.length&&i.push(r[n+1]-i[i.length-1]),i.push(r[a])),n=a):(o!==a-1&&(s.length&&s.push(r[o+1]-s[s.length-1]),s.push(r[a])),o=a),!0)),i.length&&i.push(r[n+1]-i[i.length-1]),s.length&&s.push(r[o+1]-s[s.length-1]),{highlightRanges:i,defaultRanges:s}}let iO=class extends we{constructor(){super(...arguments),this.visible=I2.Hidden}};var I2;u([d({autoDestroy:!0})],iO.prototype,"renderable",void 0),u([d({autoDestroy:!0})],iO.prototype,"components",void 0),iO=u([P("esri.views.3d.webgl-engine.collections.Component.ComponentObject")],iO),function(t){t[t.Hidden=0]="Hidden",t[t.Visible=1]="Visible"}(I2||(I2={}));function i1t(t,e,r,i){if(r>=e)return t;t==null&&(t=s1t());const s=t.isVisibleBit;let n=t.data;const o=bRe(n),a=r/o|0,l=r-o*a,c=(e-1)/o|0,h=n,p=i===s;if(!(r<h.length*o)&&p){const f=a+1,m=Math.ceil(h.length*M5),y=c+1;let _=Math.max(f,m);_=Math.min(_,y),n=new Uint32Array(_),n.set(h)}return a<n.length&&(n[a]=o1t(n[a],l,p)),t.data=n,t}function vRe(t,e){if(t==null)return!0;const{isVisibleBit:r,data:i}=t,s=bRe(i);return e<i.length*s?n1t(r,i,e,s):!t.isVisibleBit}function s1t(t=!0){return{isVisibleBit:!t,data:new Uint32Array(0)}}function n1t(t,e,r,i){const s=r/i|0,n=r-s*i;return a1t(e[s],n)===t}function bRe(t){return t.BYTES_PER_ELEMENT*8}function o1t(t,e,r){return t&~(1<<e)|(r?1:0)<<e}function a1t(t,e){return(t&1<<e)!=0}let l1t=class{constructor(e,r){this._components=r,this._indices=e.indices!=null?Qf(e.indices):yE(e.positions.length/3),this._positions=e.positions,this._componentIntersectionData=new Array(r.count)}getComponentAabb(e,r){this._perComponentAabbs||(this._perComponentAabbs=this._computePerComponentAabbs());for(let i=0;i<6;i++)r[i]=this._perComponentAabbs[6*e+i];return r}getComponentPositions(e,r){r.indices=this._indices,r.data=this._positions,r.stride=3,r.startIndex=this._components.offsets[e],r.endIndex=this._components.offsets[e+1]}intersect(e,r,i,s,n,o,a){const l=new He(this._positions,3,!1,3),c=this._indices,h=this._components.offsets,p=H2e(e,r,c1t),f=e[2],m=r[2];this._components.visibility.forEachComponent(y=>{if(!vRe(this._components.pickability,y))return!0;const _=this.getComponentAabb(y,u1t);if(o!=null){const x=o[y];n!=null?n.componentOffset=x:(e[2]=f-x,r[2]=m-x)}if(n?.applyToAabb(_),!aQ(_,e,p,i))return!0;const v=h[y]/3,b=h[y+1]/3,T=(x,S,E)=>a(y,x,wc(S,S,s),E);return n==null&&b-v>gRe?(this._componentIntersectionData[y]==null&&(this._componentIntersectionData[y]=new AK(this._indices,v,b,l)),this._componentIntersectionData[y].intersectRay({r0:e,r1:r},T)):tP(e,r,v,b,c,l,void 0,n,T),!0})}_computePerComponentAabbs(){const e=this._components.count,r=Ki(6*e),i=this._indices,s=this._positions,n=this._components.offsets;let o=0;for(let a=0;a<e;a++){const l=n[a],c=n[a+1];let h=1/0,p=1/0,f=1/0,m=-1/0,y=-1/0,_=-1/0;for(let v=l;v<c;v++){const b=3*i[v],T=s[b],x=s[b+1],S=s[b+2];h=Math.min(h,T),p=Math.min(p,x),f=Math.min(f,S),m=Math.max(m,T),y=Math.max(y,x),_=Math.max(_,S)}r[o++]=h,r[o++]=p,r[o++]=f,r[o++]=m,r[o++]=y,r[o++]=_}return r}get positions(){return this._positions}get indices(){return this._indices}};const c1t=O(),u1t=pn();let h1t=class{constructor(e,r,i){this.material=e,this.geometry=r,this.meta=i}destroy(){this.material.dispose(),this.geometry.dispose()}},d1t=class{constructor(e,r,i,s){this.vao=e,this.primitiveType=r,this.parameters=i,this.indexed=s}dispose(){this.vao.dispose()}},p1t=class{constructor(){this.near=Number.MAX_VALUE,this.far=-Number.MAX_VALUE}};function f1t(t,e){return{near:t,far:e}}function mP(t){return t?lM(t,1/0,-1/0):f1t(1/0,-1/0)}function lM(t,e,r){return t.near=e,t.far=r,t}function IE(t,e,r=t){return e!=null&&(r.near=Math.min(t.near,e.near),r.far=Math.max(t.far,e.far)),r}function gL(t,e){return t.near<=e&&e<=t.far}const xW={near:0,far:0};function m1t(t,e){const r=mP(),{eye:i,frustum:s,viewForward:n}=t;e.forAll(o=>{const a=o.offsetObb!=null?o.offsetObb:o.obb,l=fe(On(Jc,a.center,i),n),c=H6(a,n);if(gL(r,l-c)&&gL(r,l+c))return;const h=b1t(a,s);if(h===-1)return;if(h===0)return Wm.far=l+c,Wm.near=l-c,void IE(r,Wm);const p=yL.pushNew();p.near=l-c,p.far=l+c,p.mask=h,p.object=o});for(let o=0;o<yL.length;o++){const a=yL.data[o];if(gL(r,a.near)&&gL(r,a.far))continue;Wm.far=a.far,Wm.near=1/0,v1t(a.object.offsetObb!=null?a.object.offsetObb:a.object.obb,i,g1t,c=>{let h=y1t;for(let p=0;p<wRe&&c.length>0;p++){if(!(a.mask&1<<p))continue;_1t(s[p],c,h);const f=c;c=h,h=f}for(let p=0;p<c.length;p+=3){se(Tl,c.data[p],c.data[p+1],c.data[p+2]);const f=fe(On(Tl,Tl,i),n);Wm.near=Math.min(Wm.near,f)}})===0&&(Wm.near=0),IE(r,Wm)}return yL.length=0,r}const yL=new Bt({allocator:t=>t||{near:1/0,far:-1/0,mask:0,object:null},deallocator:t=>(t.object=UE(t.object),t)}),Wm=mP(),Tl=O(),y1=O(),g1t=new Bt({deallocator:null}),y1t=new Bt({deallocator:null});function _1t(t,e,r){r.length=0;const i=e.length-3;Uz(Tl,e,i);const s=pi(t,Tl);s<=0&&(r.push(Tl[0]),r.push(Tl[1]),r.push(Tl[2]));let n=0,o=s;for(;n<i;n+=3){Uz(y1,e,n);const a=pi(t,y1);o*a<0&&(Hr(Tl,y1,Tl,a/(a-o)),Sl(r,Tl)),a<=0&&Sl(r,y1),o=a,re(Tl,y1)}o*s<0&&(Uz(y1,e,i),Hr(Tl,y1,Tl,s/(s-o)),Sl(r,Tl))}function Uz(t,e,r){return se(t,e.data[r],e.data[r+1],e.data[r+2])}function Sl(t,e){t.push(e[0]),t.push(e[1]),t.push(e[2])}function v1t(t,e,r,i){um($he,t.quaternion),On(Jc,e,t.center),Oc(Jc,Jc,$he);const s=8*((Jc[0]<-t.halfSize[0]?-1:Jc[0]>t.halfSize[0]?1:0)+3*(Jc[1]<-t.halfSize[1]?-1:Jc[1]>t.halfSize[1]?1:0)+9*(Jc[2]<-t.halfSize[2]?-1:Jc[2]>t.halfSize[2]?1:0)+13),n=Ihe[s];if(n===0)return n;F6(_L,t.quaternion),PY(_L,_L,t.halfSize);const o=(a,l)=>{const c=Ihe[s+l+1];return se(a,((1&c)<<1)-1,(2&c)-1,((4&c)>>1)-1),wc(a,a,_L),ue(a,t.center,a)};return r.length=0,Sl(r,o(kz,0)),Sl(r,o(Lhe,1)),Sl(r,o(Jc,2)),Sl(r,o(Dhe,3)),i(r),n===1||(r.length=0,Sl(r,kz),Sl(r,Dhe),Sl(r,o(Jc,4)),Sl(r,o(Nhe,5)),i(r),n===2||(r.length=0,Sl(r,kz),Sl(r,Nhe),Sl(r,o(Jc,6)),Sl(r,Lhe),i(r))),n}const Ihe=(()=>{const t=new Array(216);let e=0;const r=i=>{for(let s=0;s<i.length;s++)t[e+s]=i[s];e+=8};return r([3,0,6,2,3,1,5,4]),r([2,0,2,3,1,5,4,0]),r([3,1,0,2,3,7,5,4]),r([2,0,1,3,2,6,4,0]),r([1,0,1,3,2,0,0,0]),r([2,1,5,7,3,2,0,0]),r([3,2,0,1,3,7,6,4]),r([2,2,0,1,3,7,6,0]),r([3,3,0,1,5,7,6,2]),r([2,0,1,5,4,6,2,0]),r([1,0,1,5,4,0,0,0]),r([2,1,3,7,5,4,0,0]),r([1,0,2,6,4,0,0,0]),r([0,0,0,0,0,0,0,0]),r([1,1,3,7,5,0,0,0]),r([2,2,3,7,6,4,0,0]),r([1,2,3,7,6,0,0,0]),r([2,3,1,5,7,6,2,0]),r([3,4,0,1,5,7,6,2]),r([2,5,7,6,4,0,1,0]),r([3,5,0,1,3,7,6,4]),r([2,4,5,7,6,2,0,0]),r([1,4,5,7,6,0,0,0]),r([2,5,1,3,7,6,4,0]),r([3,6,0,2,3,7,5,4]),r([2,6,2,3,7,5,4,0]),r([3,7,6,2,3,1,5,4]),t})(),wRe=4;function b1t(t,e){let r=0;for(let i=0;i<wRe;i++){const s=K1(t,e[i]);if(s>0)return-1;s===0&&(r|=1<<i)}return r}const _L=Ui(),$he=Xh(),Jc=O(),kz=O(),Lhe=O(),Dhe=O(),Nhe=O();let w1t=class{constructor(e){this._objects=e}submit(e,r){this._objects.preSubmit(r),this._objects.visibleObjects.forAll(i=>i.renderable.material.submit(e,r,i))}queryShadowCasterDepthRange(e){return this._objects.visibleObjects.length?m1t(e,this._objects.visibleObjects):null}};function x1t(t){const e=Hi().vec3f(C.POSITION);return t.normals&&e.vec2i16(C.NORMALCOMPRESSED,{glNormalized:!0}),t.textureCoordinates===Ds.Default?e.vec2f(C.UV0):t.textureCoordinates===Ds.Atlas&&(e.vec2f(C.UV0),e.vec4u16(C.UVREGION,{glNormalized:!0})),t.colors&&e.vec4u8(C.COLOR,{glNormalized:!0}),e}let T1t=class{constructor(){this.externalColor=Xt(),this.externalColorMixMode=Bs.Multiply,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0}},S1t=class extends hs{constructor(e,r){super(e,"int",ei.Draw,(i,s,n)=>i.setUniform1i(e,r(s,n)))}};var tm;(function(t){t[t.Uniform=0]="Uniform",t[t.Varying=1]="Varying",t[t.COUNT=2]="COUNT"})(tm||(tm={}));const OK=429496.7296;function xRe(t,e){YR(t/OK*.5+.5,e)}function E1t(t,e){switch(e.componentData){case tm.Varying:return C1t(t,e);case tm.Uniform:return A1t(t);case tm.COUNT:return;default:e.componentData}}function C1t(t,e){const{vertex:r,fragment:i}=t;r.include(Nc),r.uniforms.add(new Ih("componentColorTex",n=>n.componentParameters.texture.texture)),t.attributes.add(C.COMPONENTINDEX,"float"),t.varyings.add("vExternalColorMixMode","mediump float"),t.varyings.add("vExternalColor","vec4");const s=e.output===U.ObjectAndLayerIdColor;s&&t.varyings.add("vObjectAndLayerIdColor","vec4"),t.include(kAe),r.constants.add("elevationScale","float",2*OK),r.constants.add("stride","float",oe("enable-feature:objectAndLayerId-rendering")?3:2),r.code.add(w`vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
float index = componentIndex * stride + typeOffset;
float texSize = float(textureSize(componentColorTex, 0).x);
float coordX = mod(index, texSize);
float coordY = floor(index / texSize);
return vec2(coordX, coordY) + 0.5;
}`),r.code.add(w`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${s?w`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
          }`:w`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),i.code.add(w`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${s?w`fragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function A1t(t){const{vertex:e,fragment:r}=t;e.uniforms.add(new JF("externalColor",i=>i.componentParameters.externalColor)),r.uniforms.add(new S1t("externalColorMixMode",i=>i.componentParameters.externalColorMixMode)),t.varyings.add("vExternalColor","vec4"),e.code.add(w`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`),r.code.add(w`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}
void outputObjectAndLayerIdColor() {
fragColor = vec4(1.0,0.0,0.0,0.0);
}`)}var Ah;function O1t(t,e){const r=t.vertex;switch(r.code.add(w`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),e.vertexDiscardMode){case Ah.None:r.code.add(w`#define vertexDiscardByOpacity(_opacity_) {}`);break;case Ah.Opaque:r.code.add(w`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case Ah.Transparent:r.code.add(w`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}}(function(t){t[t.None=0]="None",t[t.Transparent=1]="Transparent",t[t.Opaque=2]="Opaque",t[t.COUNT=3]="COUNT"})(Ah||(Ah={}));var rm;function w7t(t){return t&&vm(t)?rm.Mars:t&&bm(t)?rm.Moon:rm.Earth}(function(t){t[t.Earth=1]="Earth",t[t.Mars=2]="Mars",t[t.Moon=3]="Moon",t[t.COUNT=4]="COUNT"})(rm||(rm={}));var hu;(function(t){t[t.None=0]="None",t[t.NoOverlay=1]="NoOverlay",t[t.ColorOverlay=2]="ColorOverlay",t[t.ColorOverlayWithWater=3]="ColorOverlayWithWater",t[t.COUNT=4]="COUNT"})(hu||(hu={}));let pr=class extends va{constructor(){super(...arguments),this.output=U.Color,this.textureCoordinateType=Ds.None,this.componentData=tm.Uniform,this.cullFace=mi.Back,this.vertexDiscardMode=Ah.None,this.doubleSidedMode=es.WindingOrder,this.alphaDiscardMode=Qr.Opaque,this.integratedMeshMode=hu.None,this.transparencyPassType=ut.NONE,this.ellipsoidMode=rm.Earth,this.pbrMode=lt.Disabled,this.normalType=Ir.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasBaseColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.hasCloudsReflections=!0,this.snowCover=!1,this.objectAndLayerIdColor=!1}};u([B({count:U.COUNT})],pr.prototype,"output",void 0),u([B({count:Ds.COUNT})],pr.prototype,"textureCoordinateType",void 0),u([B({count:tm.COUNT})],pr.prototype,"componentData",void 0),u([B({count:mi.COUNT})],pr.prototype,"cullFace",void 0),u([B({count:Ah.COUNT})],pr.prototype,"vertexDiscardMode",void 0),u([B({count:es.COUNT})],pr.prototype,"doubleSidedMode",void 0),u([B({count:Qr.COUNT})],pr.prototype,"alphaDiscardMode",void 0),u([B({count:hu.COUNT})],pr.prototype,"integratedMeshMode",void 0),u([B({count:ut.COUNT})],pr.prototype,"transparencyPassType",void 0),u([B({count:rm.COUNT})],pr.prototype,"ellipsoidMode",void 0),u([B({count:lt.COUNT})],pr.prototype,"pbrMode",void 0),u([B({count:Ir.COUNT})],pr.prototype,"normalType",void 0),u([B()],pr.prototype,"spherical",void 0),u([B()],pr.prototype,"doublePrecisionRequiresObfuscation",void 0),u([B()],pr.prototype,"hasVertexColors",void 0),u([B()],pr.prototype,"hasNormals",void 0),u([B()],pr.prototype,"hasSlicePlane",void 0),u([B()],pr.prototype,"hasBaseColorTexture",void 0),u([B()],pr.prototype,"receiveAmbientOcclusion",void 0),u([B()],pr.prototype,"receiveShadows",void 0),u([B()],pr.prototype,"blendingEnabled",void 0),u([B()],pr.prototype,"hasScreenSpaceReflections",void 0),u([B()],pr.prototype,"hasPolygonOffset",void 0),u([B()],pr.prototype,"hasMetallicRoughnessTexture",void 0),u([B()],pr.prototype,"hasEmissionTexture",void 0),u([B()],pr.prototype,"hasOcclusionTexture",void 0),u([B()],pr.prototype,"hasNormalTexture",void 0),u([B()],pr.prototype,"hasOccludees",void 0),u([B()],pr.prototype,"hasMultipassTerrain",void 0),u([B()],pr.prototype,"cullAboveGround",void 0),u([B()],pr.prototype,"hasCloudsReflections",void 0),u([B()],pr.prototype,"snowCover",void 0),u([B()],pr.prototype,"objectAndLayerIdColor",void 0),u([B({constValue:ei.Draw})],pr.prototype,"pbrTextureBindType",void 0),u([B({constValue:!0})],pr.prototype,"hasSliceHighlight",void 0),u([B({constValue:!1})],pr.prototype,"hasSliceInVertexProgram",void 0),u([B({constValue:!1})],pr.prototype,"useCustomDTRExponentForWater",void 0),u([B({constValue:!1})],pr.prototype,"hasVertexTangents",void 0),u([B({constValue:!0})],pr.prototype,"supportsTextureAtlas",void 0),u([B({constValue:!1})],pr.prototype,"highStepCount",void 0),u([B({constValue:!1})],pr.prototype,"instancedDoublePrecision",void 0),u([B({constValue:!0})],pr.prototype,"useFillLights",void 0),u([B({constValue:!1})],pr.prototype,"objectAndLayerIdColorInstanced",void 0);function Fhe(t,e){t.include(bx,e),t.fragment.include(rM);const r=t.fragment;r.uniforms.add(new JF("baseColor",i=>i.baseColor)),r.uniforms.add(new cw("objectOpacity",i=>i.objectOpacity)),e.hasVertexColors?r.code.add(w`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):r.code.add(w`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),r.code.add(w`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function Uhe(t,e){const r=t.fragment;switch(e.doubleSidedMode){case es.None:r.code.add(w`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case es.View:t.include(b2,e),r.code.add(w`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case es.WindingOrder:r.code.add(w`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:e.doubleSidedMode;case es.COUNT:}switch(e.normalType){case Ir.Attribute:case Ir.Compressed:t.include(UU,e),r.code.add(w`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case Ir.ScreenDerivative:t.include(b2,e),r.code.add(w`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case Ir.Ground:e.spherical?(t.include(b2,e),r.code.add(w`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):r.code.add(w`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),r.code.add(w`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:e.normalType;case Ir.COUNT:}}function R1t(t,e){const r=t.fragment;if(e.hasBaseColorTexture&&(e.output===U.Color||e.alphaDiscardMode!==Qr.Opaque)){t.include(fJ,e);const i=e.textureCoordinateType===Ds.Atlas;r.uniforms.add(new Ih("baseColorTexture",s=>s.texture)),i?(t.include(lTe),r.code.add(w`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, vuv0, vuvRegion);
}`)):r.code.add(w`vec4 readBaseColorTexture() {
return texture(baseColorTexture, vuv0);
}`)}else r.code.add(w`vec4 readBaseColorTexture() { return vec4(1.0); }`)}function M1t(t){const e=new Sr;e.include(b2,t),e.include(UU,t),e.include(bx,t),e.include(Yf,t),e.include(cC,t),e.include(E1t,t),e.include(tut,t),e.include(gnt,t),e.include(R1t,t),e.include(O1t,t);const{vertex:r,fragment:i}=e;t.pbrMode!==lt.Normal&&t.pbrMode!==lt.Schematic||(e.include(gJ,t),t.hasNormalTexture&&e.include(GAe,t));const s=t.output===U.Shadow||t.output===U.ShadowHighlight||t.output===U.ShadowExcludeHighlight;s&&t.componentData===tm.Varying?r.code.add(w`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):r.code.add(w`#define discardShadows(castShadows) {}`);const n=t.integratedMeshMode===hu.ColorOverlay||t.integratedMeshMode===hu.ColorOverlayWithWater,o=n&&t.output===U.Color&&t.pbrMode===lt.WaterOnIntegratedMesh;return n&&(e.include(Hw,t),e.include(u_t,t),t.spherical?r.code.add(w`
      const float invEllipsoidRadius = ${w.float(1/(t.ellipsoidMode===rm.Earth?or.radius:t.ellipsoidMode===rm.Mars?Hf.radius:ny.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):r.code.add(w`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),o&&(e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),e.varyings.add("groundNormal","vec3")),r.code.add(w`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      ${t.output===U.ObjectAndLayerIdColor?w`externalColor.a = 1.0;`:""}

      if (externalColor.a < ${w.float(yo)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${t.output===U.ObjectAndLayerIdColor?w`forwardObjectAndLayerIdColor();`:""}
      ${o?t.spherical?w`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:w`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${n?w`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),t.output===U.Alpha&&(i.include(Ru),e.include(Mu,t),e.include(Fhe,t),n&&i.uniforms.add(new et("ovColorTex",(a,l)=>hW(a,l))),i.code.add(w`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.hasMultipassTerrain?w`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${n?w`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        fragColor = vec4(materialColor.a);
      }
    `)),t.output===U.Color&&(i.include(Ru),e.include(Mu,t),e.include(Fhe,t),e.include(Uhe,t),e.include(Hw,t),t.receiveShadows?(e.include(kU,t),i.code.add(w`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):i.code.add(w`float evaluateShadow() { return 0.0; }`),n&&i.uniforms.add(new et("ovColorTex",(a,l)=>hW(a,l))),i.code.add(w`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.hasMultipassTerrain?w`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${n?w`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),t.pbrMode===lt.Normal||t.pbrMode===lt.Schematic?(Sm(i),i.code.add(w`
        ${t.pbrMode===lt.Normal?w`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),t.hasNormalTexture?i.code.add(w`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):i.code.add(w`vec3 shadingNormal = normalVertex;`),i.code.add(w`${t.spherical?w`vec3 normalGround = normalize(positionWorld());`:w`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),i.code.add(w`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());

        ${t.snowCover?w`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${n?w` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(t.receiveShadows?i.code.add(w`float shadow = evaluateShadow();`):t.spherical?(_C(i),i.code.add(w`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):i.code.add(w`float shadow = 0.0;`),o&&i.uniforms.add(new et("ovNormalTex",(a,l)=>RK(l))),t.snowCover&&i.code.add(w`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`),i.code.add(w`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${n?w` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${o?w`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),i.code.add(w`
        fragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${t.transparencyPassType===ut.Color?"fragColor = premultiplyAlpha(fragColor);":""}
      }
    `)),(t.output===U.Depth||s)&&(e.include(_y,t),i.code.add(w`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),t.output===U.Normal&&(e.include(Uhe,t),i.code.add(w`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${t.normalType===Ir.Ground?"0.0":"1.0"};
        fragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),t.output===U.ObjectAndLayerIdColor&&e.fragment.code.add(w`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${n?w`fragColor = getOverlayColorTexel(vtcOverlay);`:"outputObjectAndLayerIdColor();"}
      }
    `),t.output===U.Highlight&&(e.include(Ly,t),i.code.add(w`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${n?w`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  fragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),e}function RK(t){return t.overlays.length===0?null:t.overlays[Li.INNER].getValidTexture(ns.Water)}const P1t=Object.freeze(Object.defineProperty({__proto__:null,build:M1t,getOverlayNormalTexture:RK},Symbol.toStringTag,{value:"Module"}));let TRe=class SRe extends Lr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Ue.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Rr(e.rctx,SRe.shader.get().build(this.configuration),ERe)}_setPipelineState(e){const r=this.configuration,i=r.integratedMeshMode!==hu.None,s=e===ut.NONE,n=e===ut.FrontFace;return Mt({blending:r.output!==U.Color&&r.output!==U.Alpha||!r.blendingEnabled?null:s?xu:Dy(e),culling:tU(r.cullFace),depthTest:{func:Ov(e)},depthWrite:s||n?Ul:null,colorWrite:Gt,stencilWrite:i||r.hasOccludees?mm:null,stencilTest:i?Nlt(Il.IntegratedMeshMaskExcluded):r.hasOccludees?Rv:null,polygonOffset:s||n?r.hasPolygonOffset?{factor:2,units:2}:null:RU})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};TRe.shader=new Or(P1t,()=>ce(()=>import("./ComponentShader.glsl-2ac81371.js"),[],import.meta.url));const ERe=new Map([[C.POSITION,0],[C.NORMAL,1],[C.NORMALCOMPRESSED,1],[C.COLOR,2],[C.UV0,3],[C.UVREGION,4],[C.COMPONENTINDEX,5]]);let I1t=class extends ri{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const e of this._parameterBlocks)this[e]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const e of this._parameterBlocks)if(this[e].dirty)return!0;return!1}},MK=class{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}};function is(t={}){return(e,r)=>{const i=e._parameterCount??0;if(e._parameterCount=i+1,t.vectorOps){const s=t.vectorOps;Object.defineProperty(e,r,{get(){return this[i]},set(n){const o=this[i];if(o==null)this[i]=n;else{if(s.equals(o,n))return;s.copy(o,n)}this._setDirty()}})}else Object.defineProperty(e,r,{get(){return this[i]},set(s){this[i]!==s&&(t.dispose&&this[i]&&this[i].dispose(),this[i]=s,this._setDirty())}})}}function khe(){return(t,e)=>{const r=t._parameterCount??0;t._parameterCount=r+1,t._parameterBlocks=t._parameterBlocks||[],t._parameterBlocks.push(r),Object.defineProperty(t,e,{get(){return this[r]},set(i){this[r]!==i&&(this[r]=i,this._setDirty())}})}}let i8=class{constructor(e){this._low=O(),this._high=O(),e&&this.set(e)}get low(){return this._low}get high(){return this._high}set(e){re(this._low,re(zhe,e));const r=On(zhe,e,this._low);re(this._high,r)}get(e){return ue(e,this._low,this._high)}getLowScaled(e){return ie(e,this._low,1)}};const zhe=os();let Bn=class extends I1t{constructor(e,r){super(),this.toMapSpace=r,this.baseColor=Nt(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=Wa(VU),this.emissiveFactor=Me(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new RN,this.componentParameters=new lR,this.textureAlphaCutoff=MF,this.alphaDiscardMode=Qr.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=rm.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new pr;const i=new i8(e.position),s=jAe(e.rotationScale);dx(s,s),this.transformNormalGlobalFromModel=gbe(Bh(s,s)),this.transformWorldFromModelTL=i.low,this.transformWorldFromModelTH=i.high,this.transformWorldFromModelRS=e.rotationScale}dispose(){this._technique=Bi(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return this.baseColorTexture!=null?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return this.metallicRoughnessTexture!=null?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return this.emissionTexture!=null?this.emissionTexture.glTexture:null}get textureOcclusion(){return this.occlusionTexture!=null?this.occlusionTexture.glTexture:null}get textureNormal(){return this.normalTexture!=null?this.normalTexture.glTexture:null}prepareTechnique(e,r,i,s){const n=this._techniqueConfiguration;n.hasVertexColors=s.colors,n.hasNormals=s.normals,n.textureCoordinateType=s.textureCoordinates,n.hasMetallicRoughnessTexture=this.metallicRoughnessTexture!=null,n.hasEmissionTexture=this.emissionTexture!=null,n.hasOcclusionTexture=this.occlusionTexture!=null,n.hasNormalTexture=this.normalTexture!=null,n.transparencyPassType=r.identifier===_c.Material&&i.transparencyPassType!=null?i.transparencyPassType:ut.NONE,n.hasMultipassTerrain=r.identifier===_c.Material&&i.multipassTerrain!=null&&i.multipassTerrain.enabled,n.cullAboveGround=r.identifier===_c.Material&&i.multipassTerrain!=null&&i.multipassTerrain.cullAboveGround,n.ellipsoidMode=this.ellipsoidMode,n.componentData=this.componentParameters.type,n.cullFace=this.commonMaterialParameters.cullFace,n.doubleSidedMode=this.commonMaterialParameters.doubleSided?es.View:es.None,n.hasBaseColorTexture=this.baseColorTexture!=null;const o=this._computeWhichMaterialPass();n.blendingEnabled=o===Ba.Transparent||o===Ba.OpaqueAndTransparent,n.alphaDiscardMode=this.alphaDiscardMode,n.integratedMeshMode=this.isIntegratedMesh?L1t(i)?RK(i)?hu.ColorOverlayWithWater:hu.ColorOverlay:hu.NoOverlay:hu.None,n.hasPolygonOffset=this.polygonOffsetEnabled;const a=this.hasParametersFromSource&&this.baseColorTexture==null;if(n.pbrMode=n.integratedMeshMode===hu.ColorOverlayWithWater?lt.WaterOnIntegratedMesh:this.usePBR?a?lt.Schematic:lt.Normal:lt.Disabled,n.normalType=n.integratedMeshMode===hu.None?n.hasNormals?Ir.Compressed:Ir.ScreenDerivative:Ir.Ground,n.hasSlicePlane=i.slicePlane!=null&&this.commonMaterialParameters.hasSlicePlane,r.identifier===_c.ShadowMap)n.output=U.Shadow,n.vertexDiscardMode=Ah.None;else if(r.identifier===_c.Highlight)n.output=U.Highlight,n.vertexDiscardMode=Ah.None;else{switch(this._computeWhichMaterialPass()===Ba.OpaqueAndTransparent?n.vertexDiscardMode=r.transparent?Ah.Opaque:Ah.Transparent:n.vertexDiscardMode=Ah.None,n.output=r.output,n.receiveAmbientOcclusion=!1,n.receiveShadows=!1,r.output){case U.Color:n.receiveAmbientOcclusion=i.ssaoHelper.active,n.hasOccludees=i.hasOccludees,n.receiveShadows=i.shadowMap.ready,n.hasScreenSpaceReflections=i.ssr.enabled,n.hasCloudsReflections=i.cloudsFade.data!=null;break;case U.Alpha:n.hasOccludees=i.hasOccludees;break;case U.ObjectAndLayerIdColor:n.objectAndLayerIdColor=!0}n.snowCover=this.hasSnowCover(i)}return this._technique=e.releaseAndAcquire(TRe,n,this._technique),this._setClean(),this._technique}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}submit(e,r,i){if(this.objectOpacity===0)return;const s=i.renderable.geometry,n=i.components,o=i.renderable.meta.cameraDepthSquared,a=n.geometryRanges,l=n.highlightRanges,c=n.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case Ba.Opaque:e.materialOpaque.submitDraw(this,s,a,o);break;case Ba.Transparent:e.materialTransparent.submitDraw(this,s,a,o);break;case Ba.OpaqueAndTransparent:e.materialOpaque.submitDraw(this,s,a,o),e.materialTransparent.submitDraw(this,s,a,o);break;case Ba.IntegratedMesh:e.materialIntegratedMesh.submitDraw(this,s,a,o),$1t(r)&&e.highlightIntegratedMesh.submitDraw(this,s,a,o)}const h=this.componentParameters.castShadows!==Cn.None;h&&e.shadowMap.submitDraw(this,s,a,o),l!=null&&(e.highlight.submitDraw(this,s,l,o),h&&e.highlightShadowMap.submitDraw(this,s,l,o)),h&&c!=null&&e.defaultShadowMap.submitDraw(this,s,c,o)}_computeWhichMaterialPass(){return this.isIntegratedMesh?Ba.IntegratedMesh:this.objectOpacity<1?Ba.Transparent:this.componentParameters.opaqueOverride===Cn.All?Ba.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===Qr.Blend||this.alphaDiscardMode===Qr.MaskBlend?Ba.Transparent:this.componentParameters.transparent===Cn.None?Ba.Opaque:this.componentParameters.transparent===Cn.All?Ba.Transparent:Ba.OpaqueAndTransparent}};var Ba,Cn;u([is({vectorOps:Tge})],Bn.prototype,"baseColor",void 0),u([is()],Bn.prototype,"usePBR",void 0),u([is()],Bn.prototype,"hasParametersFromSource",void 0),u([is({vectorOps:ste})],Bn.prototype,"mrrFactors",void 0),u([is({vectorOps:ste})],Bn.prototype,"emissiveFactor",void 0),u([is({dispose:!0})],Bn.prototype,"baseColorTexture",void 0),u([is({dispose:!0})],Bn.prototype,"metallicRoughnessTexture",void 0),u([is({dispose:!0})],Bn.prototype,"emissionTexture",void 0),u([is({dispose:!0})],Bn.prototype,"occlusionTexture",void 0),u([is({dispose:!0})],Bn.prototype,"normalTexture",void 0),u([is()],Bn.prototype,"objectOpacity",void 0),u([khe()],Bn.prototype,"commonMaterialParameters",void 0),u([khe()],Bn.prototype,"componentParameters",void 0),u([is()],Bn.prototype,"textureAlphaCutoff",void 0),u([is()],Bn.prototype,"alphaDiscardMode",void 0),u([is()],Bn.prototype,"isIntegratedMesh",void 0),u([is()],Bn.prototype,"polygonOffsetEnabled",void 0),u([is()],Bn.prototype,"ellipsoidMode",void 0),u([is()],Bn.prototype,"hasOccludees",void 0),function(t){t[t.Opaque=0]="Opaque",t[t.Transparent=1]="Transparent",t[t.OpaqueAndTransparent=2]="OpaqueAndTransparent",t[t.IntegratedMesh=3]="IntegratedMesh"}(Ba||(Ba={}));let RN=class extends MK{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=mi.Back,this.hasSlicePlane=!0}};u([is()],RN.prototype,"doubleSided",void 0),u([is()],RN.prototype,"cullFace",void 0),u([is()],RN.prototype,"hasSlicePlane",void 0);let lR=class extends MK{constructor(){super(...arguments),this.externalColor=Nt(1,1,1,1),this.externalColorMixMode=Bs.Multiply,this.castShadows=Cn.All}get transparent(){return this.externalColor[3]<1?Cn.All:Cn.None}get opaqueOverride(){return this.externalColorMixMode===Bs.Replace&&this.externalColor[3]===1?Cn.All:Cn.None}get visible(){return this.externalColor[3]>0?Cn.All:Cn.None}get type(){return tm.Uniform}};u([is({vectorOps:Tge})],lR.prototype,"externalColor",void 0),u([is()],lR.prototype,"externalColorMixMode",void 0),u([is()],lR.prototype,"castShadows",void 0),function(t){t[t.All=0]="All",t[t.Some=1]="Some",t[t.None=2]="None"}(Cn||(Cn={}));let sO=class extends MK{constructor(){super(...arguments),this.texture=null,this.transparent=Cn.None,this.opaqueOverride=Cn.None,this.castShadows=Cn.None}get type(){return tm.Varying}};function $1t(t){return t.overlays.length!==0&&t.overlays[Li.INNER].getValidTexture(ns.Highlight)!=null}function L1t(t){return t.overlays.length!==0&&t.overlays[Li.INNER].getColorTextureNoRasterImage()!=null}u([is()],sO.prototype,"texture",void 0),u([is()],sO.prototype,"transparent",void 0),u([is()],sO.prototype,"opaqueOverride",void 0),u([is()],sO.prototype,"castShadows",void 0);const r5=Hi().vec3f(C.POSITION).u16(C.COMPONENTINDEX).u16(C.U16PADDING),CRe=Hi().vec2u8(C.SIDENESS),D1t=Fc(CRe),ARe=Hi().vec3f(C.POSITION0).vec3f(C.POSITION1).u16(C.COMPONENTINDEX).u8(C.VARIANTOFFSET,{glNormalized:!0}).u8(C.VARIANTSTROKE).u8(C.VARIANTEXTENSION,{glNormalized:!0}).u8(C.U8PADDING,{glPadding:!0}).u16(C.U16PADDING,{glPadding:!0}),TW=ARe.clone().vec3f(C.NORMAL),SW=ARe.clone().vec3f(C.NORMALA).vec3f(C.NORMALB),ORe=new Map([[C.POSITION0,0],[C.POSITION1,1],[C.COMPONENTINDEX,2],[C.VARIANTOFFSET,3],[C.VARIANTSTROKE,4],[C.VARIANTEXTENSION,5],[C.NORMAL,6],[C.NORMALA,6],[C.NORMALB,7],[C.SIDENESS,8]]);function Vhe(t,e,r){const i=e/3,s=new Uint32Array(r+1),n=new Uint32Array(r+1),o=(b,T)=>{b<T?s[b+1]++:n[T+1]++};for(let b=0;b<i;b++){const T=t[3*b],x=t[3*b+1],S=t[3*b+2];o(T,x),o(x,S),o(S,T)}let a=0,l=0;for(let b=0;b<r;b++){const T=s[b+1],x=n[b+1];s[b+1]=a,n[b+1]=l,a+=T,l+=x}const c=new Uint32Array(6*i),h=s[r],p=(b,T,x)=>{if(b<T){const S=s[b+1]++;c[2*S]=T,c[2*S+1]=x}else{const S=n[T+1]++;c[2*h+2*S]=b,c[2*h+2*S+1]=x}};for(let b=0;b<i;b++){const T=t[3*b],x=t[3*b+1],S=t[3*b+2];p(T,x,b),p(x,S,b),p(S,T,b)}const f=(b,T)=>{const x=2*b,S=T-b;for(let E=1;E<S;E++){const A=c[x+2*E],R=c[x+2*E+1];let M=E-1;for(;M>=0&&c[x+2*M]>A;M--)c[x+2*M+2]=c[x+2*M],c[x+2*M+3]=c[x+2*M+1];c[x+2*M+2]=A,c[x+2*M+3]=R}};for(let b=0;b<r;b++)f(s[b],s[b+1]),f(h+n[b],h+n[b+1]);const m=new Int32Array(3*i),y=(b,T)=>b===t[3*T]?0:b===t[3*T+1]?1:b===t[3*T+2]?2:-1,_=(b,T)=>{const x=y(b,T);m[3*T+x]=-1},v=(b,T,x,S)=>{const E=y(b,T);m[3*T+E]=S;const A=y(x,S);m[3*S+A]=T};for(let b=0;b<r;b++){let T=s[b];const x=s[b+1];let S=n[b];const E=n[b+1];for(;T<x&&S<E;){const A=c[2*T],R=c[2*h+2*S];A===R?(v(b,c[2*T+1],R,c[2*h+2*S+1]),T++,S++):A<R?(_(b,c[2*T+1]),T++):(_(R,c[2*h+2*S+1]),S++)}for(;T<x;)_(b,c[2*T+1]),T++;for(;S<E;)_(c[2*h+2*S],c[2*h+2*S+1]),S++}return m}let RRe=class{updateSettings(e){this.settings=e,this._edgeHashFunction=e.reducedPrecision?F1t:N1t}write(e,r,i){const s=this._edgeHashFunction(i);bL.seed=s;const n=bL.getIntRange(0,255),o=bL.getIntRange(0,this.settings.variants-1),a=.7,l=bL.getFloat(),c=255*(.5*U1t(-(1-Math.min(l/a,1))+Math.max(0,l-a)/(1-a),1.2)+.5);e.position0.setVec(r,i.position0),e.position1.setVec(r,i.position1),e.componentIndex.set(r,i.componentIndex),e.variantOffset.set(r,n),e.variantStroke.set(r,o),e.variantExtension.set(r,c)}trim(e,r){return e.slice(0,r)}};const PK=new Float32Array(6),i5=new Uint32Array(PK.buffer),U_=new Uint32Array(1);function N1t(t){const e=PK;e[0]=t.position0[0],e[1]=t.position0[1],e[2]=t.position0[2],e[3]=t.position1[0],e[4]=t.position1[1],e[5]=t.position1[2],U_[0]=5381;for(let r=0;r<i5.length;r++)U_[0]=31*U_[0]+i5[r];return U_[0]}function F1t(t){const e=PK;e[0]=AT(t.position0[0]),e[1]=AT(t.position0[1]),e[2]=AT(t.position0[2]),e[3]=AT(t.position1[0]),e[4]=AT(t.position1[1]),e[5]=AT(t.position1[2]),U_[0]=5381;for(let r=0;r<i5.length;r++)U_[0]=31*U_[0]+i5[r];return U_[0]}const Bhe=1e4;function AT(t){return Math.round(t*Bhe)/Bhe}function U1t(t,e){const r=t<0?-1:1;return Math.abs(t)**e*r}let s5=class{constructor(){this._commonWriter=new RRe}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return TW.createBuffer(e)}write(e,r,i){this._commonWriter.write(e,r,i),ue(vL,i.faceNormal0,i.faceNormal1),ye(vL,vL),e.normal.setVec(r,vL)}trim(e,r){return this._commonWriter.trim(e,r)}};s5.Layout=TW,s5.glLayout=Fc(TW,1);let n5=class{constructor(){this._commonWriter=new RRe}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return SW.createBuffer(e)}write(e,r,i){this._commonWriter.write(e,r,i),e.normalA.setVec(r,i.faceNormal0),e.normalB.setVec(r,i.faceNormal1)}trim(e,r){return this._commonWriter.trim(e,r)}};n5.Layout=SW,n5.glLayout=Fc(SW,1);const vL=O(),bL=new fO,gb=-1;var o5;function k1t(t,e,r,i=H1t){const s=t.vertices.position,n=t.vertices.componentIndex,o=Ft(i.anglePlanar),a=Ft(i.angleSignificantEdge),l=Math.cos(a),c=Math.cos(o),h=EW.edge,p=h.position0,f=h.position1,m=h.faceNormal0,y=h.faceNormal1,_=j1t(t),v=G1t(t),b=v.length/4,T=e.allocate(b);let x=0;const S=b,E=r.allocate(S);let A=0,R=0,M=0;const D=kIe(0,b),k=new Float32Array(b);k.forEach((G,J,I)=>{s.getVec(v[4*J],p),s.getVec(v[4*J+1],f),I[J]=fi(p,f)}),D.sort((G,J)=>k[J]-k[G]);const $=new Array,N=new Array;for(let G=0;G<b;G++){const J=D[G],I=k[J],z=v[4*J],F=v[4*J+1],j=v[4*J+2],W=v[4*J+3],Y=W===gb;if(s.getVec(z,p),s.getVec(F,f),Y)se(m,_[3*j],_[3*j+1],_[3*j+2]),re(y,m),h.componentIndex=n.get(z),h.cosAngle=fe(m,y);else{if(se(m,_[3*j],_[3*j+1],_[3*j+2]),se(y,_[3*W],_[3*W+1],_[3*W+2]),h.componentIndex=n.get(z),h.cosAngle=fe(m,y),V1t(h,c))continue;h.cosAngle<-.9999&&re(y,m)}R+=I,M++,Y||z1t(h,l)?(e.write(T,x++,h),$.push(I)):B1t(h,o)&&(r.write(E,A++,h),N.push(I))}const H=new Float32Array($.reverse()),Z=new Float32Array(N.reverse());return{regular:{instancesData:e.trim(T,x),lodInfo:{lengths:H}},silhouette:{instancesData:r.trim(E,A),lodInfo:{lengths:Z}},averageEdgeLength:R/M}}function z1t(t,e){return t.cosAngle<e}function V1t(t,e){return t.cosAngle>e}function B1t(t,e){const r=In(t.cosAngle),i=EW.fwd,s=EW.ortho;return by(i,t.position1,t.position0),r*(fe(ht(s,t.faceNormal0,t.faceNormal1),i)>0?-1:1)>e}function G1t(t){const e=t.faces.length/3,r=t.faces,i=t.neighbors;let s=0;for(let a=0;a<e;a++){const l=i[3*a],c=i[3*a+1],h=i[3*a+2],p=r[3*a],f=r[3*a+1],m=r[3*a+2];s+=l===gb||p<f?1:0,s+=c===gb||f<m?1:0,s+=h===gb||m<p?1:0}const n=new Int32Array(4*s);let o=0;for(let a=0;a<e;a++){const l=i[3*a],c=i[3*a+1],h=i[3*a+2],p=r[3*a],f=r[3*a+1],m=r[3*a+2];(l===gb||p<f)&&(n[o++]=p,n[o++]=f,n[o++]=a,n[o++]=l),(c===gb||f<m)&&(n[o++]=f,n[o++]=m,n[o++]=a,n[o++]=c),(h===gb||m<p)&&(n[o++]=m,n[o++]=p,n[o++]=a,n[o++]=h)}return n}function j1t(t){const e=t.faces.length/3,r=t.vertices.position,i=t.faces,s=zz.v0,n=zz.v1,o=zz.v2,a=new Float32Array(3*e);for(let l=0;l<e;l++){const c=i[3*l],h=i[3*l+1],p=i[3*l+2];r.getVec(c,s),r.getVec(h,n),r.getVec(p,o),de(n,n,s),de(o,o,s),ht(s,n,o),ye(s,s),a[3*l]=s[0],a[3*l+1]=s[1],a[3*l+2]=s[2]}return a}(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH"})(o5||(o5={}));const EW={edge:{position0:O(),position1:O(),faceNormal0:O(),faceNormal1:O(),componentIndex:0,cosAngle:0},ortho:O(),fwd:O()},zz={v0:O(),v1:O(),v2:O()},H1t={anglePlanar:4,angleSignificantEdge:35};function q1t(t){const e=W1t(t.data,t.skipDeduplicate,t.indices,t.indicesLength);return Ghe.updateSettings(t.writerSettings),jhe.updateSettings(t.writerSettings),k1t(e,Ghe,jhe)}function W1t(t,e,r,i){if(e){const o=Vhe(r,i,t.count);return new X1t(r,i,o,t)}const s=Fq(t.buffer,t.stride/4,{originalIndices:r,originalIndicesLength:i}),n=Vhe(s.indices,i,s.uniqueCount);return{faces:s.indices,facesLength:s.indices.length,neighbors:n,vertices:r5.createView(s.buffer)}}let X1t=class{constructor(e,r,i,s){this.faces=e,this.facesLength=r,this.neighbors=i,this.vertices=s}};const Ghe=new s5,jhe=new n5,L7t=Hi().vec3f(C.POSITION0).vec3f(C.POSITION1),Z1t=Hi().vec3f(C.POSITION0).vec3f(C.POSITION1).u16(C.COMPONENTINDEX).u16(C.U16PADDING,{glPadding:!0});let Y1t=class{constructor(e){this._maxCount=e,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(e){this._recycledIndices.push(e)}},J1t=class{constructor(e,r=1){this._rctx=e,this._fieldCount=r,this.textureWidth=4096,this._dirty=!0;const i=new xr;i.samplingMode=Rt.NEAREST,i.wrapMode=Dt.CLAMP_TO_EDGE,i.width=this.textureWidth,i.height=1,this._texture=new Ot(this._rctx,i),this._data=new ga(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(e,r,i,s,n,o){const a=e*this._fieldCount+r;this._dirty=!0,this._data.set(a,0,i),this._data.set(a,1,s),this._data.set(a,2,n),this._data.set(a,3,o)}setDataElement(e,r,i,s){const n=e*this._fieldCount+r;this._dirty=!0,this._data.set(n,i,s)}getDataElement(e,r,i){const s=e*this._fieldCount+r;return this._dirty=!0,this._data.get(s,i)}resizeToFit(e){const r=(e+1)*this._fieldCount;if(r>this._data.count){const i=Math.ceil(r/this.textureWidth)*this.textureWidth,s=new ga(new ArrayBuffer(4*i));s.typedBuffer.set(this._data.typedBuffer),this._data=s}}updateTexture(){if(!this._dirty)return;const e=this._texture.descriptor.width,r=this._texture.descriptor.height;this._data.count>e*r&&this._texture.resize(e,this._data.count/e),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}};const MRe=65536;let Q1t=class{constructor(e,r=1){this.textureBuffer=new J1t(e,r),this._indexManager=new Y1t(MRe)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const e=this._indexManager.acquire();return this.textureBuffer.resizeToFit(e),e}releaseIndex(e){this._indexManager.release(e)}},PRe=class{constructor(e,r=1){this._rctx=e,this._fieldCount=r,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(e=>e.activeCount!==0||(e.dispose(),!1))}destroy(){this._buffers.forEach(e=>e.dispose()),this._buffers=[]}getBuffer(e){for(const i of this._buffers)if(i.availableCount>=e)return i;if(e>MRe)return null;const r=new Q1t(this._rctx,this._fieldCount);return this._buffers.push(r),r}updateTextures(){for(const e of this._buffers)e.textureBuffer.updateTexture()}};const Hhe=Q.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");let K1t=class{constructor(e,r){this._renderManager=e,this._viewingMode=r,this._objects=[new Bt,new Bt],this._renderSubmit=new w1t(this),this._renderManager.register(this._renderSubmit),this._hasObjectAndLayerId=oe("enable-feature:objectAndLayerId-rendering"),this._componentBufferManager=new PRe(e.rctx,2+(this._hasObjectAndLayerId?1:0))}destroy(){nt(this._objects[I2.Hidden].length===0&&this._objects[I2.Visible].length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy();const e=this._objects.flatMap(r=>r.toArray());for(const r of e)r?.destroy()}createObject(e){const r=new iO;return r.toMapSpace=e.toMapSpace,r.transform=e.transform,r.obb=Hie(e.obb),r.components=new t1t(this._componentBufferManager,Qf(e.geometry.componentOffsets)),r.renderable=this._createRenderable(e,r.components),r.intersectionGeometry=new l1t(e.geometry.positionData,r.components),this._objects[r.visible].push(r),r}destroyObject(e){const r=e;this._objects[r.visible].removeUnordered(r),r.destroy(),this._notifyDirty()}setObjectVisibility(e,r){const i=e;r!==i.visible&&(this._objects[i.visible].removeUnordered(i),this._objects[r].push(i),i.visible=r,this._notifyDirty())}preSubmit(e){const r=e.camera.eye;this.visibleObjects.forAll(i=>i.renderable.meta.cameraDepthSquared=vo(r,i.obb.center))}getMaterial(e){return e.renderable.material}updateMaterial(e,r){const i=e.renderable.material;r(i),i.dirty&&this._notifyDirty()}setAllComponentVisibilities(e,r){const i=e;i.components.visibility.reset(r),i.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(e,r){return e.components.visibility.forEachComponent(r)}getComponentCount(e){const r=e,i=r.components.visibility.componentCount();return{visible:i,invisible:r.components.count-i}}setComponentData(e,r){const i=e,s=i.renderable.material,n=i.components,o=n.materialDataBuffer,a=n.materialDataIndices,l=new T1t,c=o.textureBuffer,h=new Uint8Array(4),p=new Uint32Array(h.buffer);let f=0,m=0,y=0,_=n.verticalOffsets,v=1/0,b=-1/0,T=!1,x=!1,S=0;for(let E=0;E<n.count;E++){r(E,l),f+=+(l.externalColor[3]<1),m+=+(l.externalColorMixMode===Bs.Replace&&l.externalColor[3]===1),y+=+l.castShadows,Dbe(l.externalColor,l.externalColorMixMode,h),h[2]=254&h[2]|+l.castShadows,c.setData(a[E],0,h[0],h[1],h[2],h[3]),T||(T=E>0&&S!==p[0]),S=p[0],x||(x=l.elevationOffset!==0),x&&_==null&&(_=new Array(E).fill(0)),_!=null&&(_[E]=l.elevationOffset),v=Math.min(v,l.elevationOffset),b=Math.max(b,l.elevationOffset),xRe(l.elevationOffset,h),c.setData(a[E],1,h[0],h[1],h[2],h[3]);const A=l.objectAndLayerIdColor;A!=null&&c.setData(a[E],2,A[0],A[1],A[2],A[3]),l.pickable!==vRe(n.pickability,E)&&(n.pickability=i1t(n.pickability,n.count,E,l.pickable))}n.verticalOffsets=x?_:null,i.offsetObb=x?gqe(i.obb,v,b,this._viewingMode,i.offsetObb!=null?i.offsetObb:Hie(i.obb)):null,T||x||this._hasObjectAndLayerId?(s.componentParameters=new sO,s.componentParameters.castShadows=Vz(y,n.count),s.componentParameters.transparent=Vz(f,n.count),s.componentParameters.opaqueOverride=Vz(m,n.count),s.componentParameters.texture=c,c.updateTexture()):(s.componentParameters=new lR,s.componentParameters.castShadows=l.castShadows?Cn.All:Cn.None,s.componentParameters.externalColor=l.externalColor,s.componentParameters.externalColorMixMode=l.externalColorMixMode),this._notifyDirty()}getComponentAabb(e,r,i,s=!1){e.intersectionGeometry.getComponentAabb(r,i);const n=e,o=n.components.verticalOffsets;if(s||o==null)return i;const a=o[r];if(this._viewingMode===Ue.Local||a===0)return i[2]+=a,i[5]+=a,i;const l=ket(a);return l.localOrigin=n.transform.position,l.applyToAabb(i)}getComponentObb(e){return e.obb}getObjectTransform(e){return e.transform}getComponentPositions(e,r,i){return e.intersectionGeometry.getComponentPositions(r,i)}intersect(e,r,i,s,n,o){const a=e;n!=null&&(n.localOrigin=a.transform.position);const l=dx(qhe,a.transform.rotationScale);On(wL,r,a.transform.position),On(xL,i,a.transform.position),wc(wL,wL,l),wc(xL,xL,l);const c=Bh(qhe,l);return a.intersectionGeometry.intersect(wL,xL,s,c,n,a.components.verticalOffsets,o)}addEdges(e,r,i,s){const n=e,{indices:o,positions:a}=n.intersectionGeometry,l=n.components.offsets;return r.addComponentObject(e,n.transform,{center:n.obb.center,radius:mqe(n.obb)},a,o,l,i,s)}async extractEdgeInformation(e,r,i){const s=e,n=s.components.visibility;if(n.allInvisible())return{buffer:Z1t.createBuffer(0),origin:[0,0,0]};const{indices:o,positions:a}=s.intersectionGeometry,l=s.components.offsets,c=r5.createBuffer(a.length/3);fP(c.position.typedBuffer,a,c.position.typedBufferStride,3),zCe(c.position,c.position,s.transform.rotationScale),this._setComponentIndices(c.componentIndex,o,l);const h=c.count,p=this._computeVisibilityIndices(o,n,l,h);return{origin:Fs(s.transform.position),buffer:await r.extractComponentsEdgeLocations({indices:p,indicesLength:p.length,skipDeduplicate:!0,data:c,writerSettings:{reducedPrecision:!1,variants:0}},i)}}_setComponentIndices(e,r,i){let s=0;for(let n=0;n<i.length-1;n++){const o=i[n],a=i[n+1];for(let l=o;l<a;l++){const c=r?r[l]:l;e.set(c,s)}s++}}_computeVisibilityIndices(e,r,i,s){if(e&&r.allVisible())return e;let n=0;r.forEachComponentRange((l,c)=>(n+=i[c]-i[l],!0));const o=vp(e)?new Array(n):e?.BYTES_PER_ELEMENT===2||s<=65536?new Uint16Array(n):new Uint32Array(n);let a=0;return r.forEachComponentRange((l,c)=>{const h=i[l],p=i[c];for(let f=h;f<p;f++)o[a++]=e?e[f]:f;return!0}),o}addComponentHighlight(e,r){const i=e.components;i.highlightCounts==null&&(i.highlightCounts=new Uint32Array(i.count+1)),i.highlightCounts[r]++===0&&(i.highlightsDirty(),this._notifyDirty()),i.highlightCounts[i.count]++}removeComponentHighlight(e,r){const i=e.components;if(i.highlightCounts==null)return void Hhe.warn("Removing non-existing highlight.");const s=i.highlightCounts[r],n=i.highlightCounts[i.count];if(s!==0){if(s>1)return i.highlightCounts[r]=s-1,void(i.highlightCounts[i.count]=n-1);i.highlightCounts[r]=0,i.highlightsDirty(),this._notifyDirty(),n===1?i.highlightCounts=null:i.highlightCounts[i.count]=n-1}else Hhe.warn("Removing non-existing highlight.")}clearHighlights(e){const r=e.components;r.highlightCounts!=null&&(r.highlightCounts=null,r.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(e){return e.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[I2.Visible]}_createRenderable(e,r){const i=this._renderManager.rctx,s=e.geometry,n=s.vertices.layoutParameters,o=Ur.createVertex(i,Cr.STATIC_DRAW,s.vertices.data),a=vc(s.indices,_=>Ur.createIndex(i,Cr.STATIC_DRAW,_)),l=Fc(x1t(n)),c=new Uint16Array(s.vertices.count);for(let _=0;_<r.count;_++){const v=r.offsets[_],b=r.offsets[_+1],T=r.materialDataIndices[_];if(s.indices!=null)for(let x=v;x<b;x++)c[s.indices[x]]=T;else for(let x=v;x<b;x++)c[x]=T}const h=Ur.createVertex(i,Cr.STATIC_DRAW,c.buffer),p=new Bn(e.transform,e.toMapSpace),f=new jh(i,ERe,{data:l,componentIndices:ebt},{data:o,componentIndices:h},a),m=new d1t(f,At.TRIANGLES,n,a!=null),y={cameraDepthSquared:.5,gpuMemoryEstimate:o.byteLength+h.byteLength+(a!=null?a.byteLength:0)};return new h1t(p,m,y)}_notifyDirty(){this._renderManager.notifyDirty()}};const ebt=Fc(Hi().u16(C.COMPONENTINDEX));function Vz(t,e){return t===e?Cn.All:t===0?Cn.None:Cn.Some}const qhe=$l(),wL=O(),xL=O();let IRe=class extends ri{constructor(){super(...arguments),this.scale=Ge()}};function tbt(t){const e=new Sr;e.attributes.add(C.POSITION,"vec2"),e.varyings.add("uv0","vec2"),e.varyings.add("uv1","vec2"),e.vertex.uniforms.add(new Ar("scale",i=>i.scale)),e.vertex.code.add(w`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv0 = position * 0.5 + vec2(0.5);
uv1 = (position * 0.5 + vec2(0.5)) * scale;
}`),e.fragment.uniforms.add(new et("tex",i=>i.texture),new et("depthTexture",i=>i.depthTexture),new Ar("scale",i=>i.scale),new Ar("clampUV",i=>rbt(i)));const r=t.haze;return e.fragment.code.add(w`
    void main() {
      ${r?w`vec4`:w`float`} depthSample = texture(depthTexture, uv0) ${r?"":w`.r`};
      if (depthSample ${r?w`== vec4(0)`:w`!= 1.0`} ) {
          fragColor = vec4(0);
          return;
      }
      fragColor = texture(tex, min(uv1, clampUV));
    }
    `),e}function rbt(t){if(!t.texture)return Whe;const e=ar(Whe,t.texture.descriptor.width,t.texture.descriptor.height),r=nJ(e,e,t.scale),i=Nxe(r,r);return zxe(i,t.scale,i)}const Whe=Ge(),ibt=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:IRe,build:tbt},Symbol.toStringTag,{value:"Module"}));let $Re=class LRe extends Lr{initializeProgram(e){return new Rr(e.rctx,LRe.shader.get().build(this.configuration),Tr)}initializePipeline(){return this.configuration.haze?Mt({blending:Eo(xe.ONE,xe.ZERO,xe.ONE_MINUS_SRC_COLOR,xe.ONE),depthTest:{func:ti.ALWAYS},colorWrite:Gt}):Mt({blending:Lc(xe.SRC_ALPHA,xe.ONE_MINUS_SRC_ALPHA),depthTest:{func:ti.ALWAYS},colorWrite:Gt})}};$Re.shader=new Or(ibt,()=>ce(()=>import("./AtmosphereCompositing.glsl-893529ba.js"),[],import.meta.url));let DRe=class extends ri{constructor(){super(...arguments),this.opacity=1}};function sbt(t){const e=new Sr;return e.include(Zh),e.fragment.uniforms.add(new et("tex",r=>r.texture)),t.hasOpacityFactor&&e.fragment.uniforms.add(new Pe("opacity",r=>r.opacity)),e.fragment.code.add(w`
    void main() {
      fragColor = texture(tex, uv) ${t.hasOpacityFactor?"* opacity":""};
    }`),e}const nbt=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:DRe,build:sbt},Symbol.toStringTag,{value:"Module"}));var ca;(function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.PremultipliedAlpha=2]="PremultipliedAlpha",t[t.COUNT=3]="COUNT"})(ca||(ca={}));let CW=class extends va{constructor(){super(...arguments),this.alphaMode=ca.None,this.hasOpacityFactor=!1}};u([B({count:ca.COUNT})],CW.prototype,"alphaMode",void 0),u([B()],CW.prototype,"hasOpacityFactor",void 0);let NRe=class FRe extends Lr{initializeProgram(e){return new Rr(e.rctx,FRe.shader.get().build(this.configuration),Tr)}initializePipeline(){switch(this.configuration.alphaMode){case ca.None:return Mt({colorWrite:Gt});case ca.Alpha:return Mt({blending:Eo(xe.SRC_ALPHA,xe.ONE,xe.ONE_MINUS_SRC_ALPHA,xe.ONE_MINUS_SRC_ALPHA),colorWrite:Gt});case ca.PremultipliedAlpha:case ca.COUNT:return Mt({blending:Lc(xe.ONE,xe.ONE_MINUS_SRC_ALPHA),colorWrite:Gt})}}};NRe.shader=new Or(nbt,()=>ce(()=>import("./Compositing.glsl-20513685.js"),[],import.meta.url));let URe=class extends ri{};function obt(){const t=new Sr;return t.include(Zh),t.fragment.uniforms.add(new et("tex",e=>e.texture)),t.fragment.code.add(w`void main() {
fragColor = vec4(1.0 - texture(tex, uv).a);
}`),t}const abt=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:URe,build:obt},Symbol.toStringTag,{value:"Module"}));let kRe=class zRe extends Lr{initializeProgram(e){return new Rr(e.rctx,zRe.shader.get().build(),Tr)}initializePipeline(){return Mt({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}};kRe.shader=new Or(abt,()=>ce(()=>import("./HUDCompositing.glsl-2d933277.js"),[],import.meta.url));let VRe=class extends ri{};function lbt(){const t=new Sr;return t.include(Zh),t.fragment.uniforms.add(new et("colorTexture",e=>e.colorTexture),new et("alphaTexture",e=>e.alphaTexture),new et("frontFaceTexture",e=>e.frontFaceTexture)),t.fragment.code.add(w`void main() {
vec4 srcColor = texture(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture(alphaTexture, uv).r;
vec4 frontFace = texture(frontFaceTexture, uv);
fragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`),t}const cbt=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:VRe,build:lbt},Symbol.toStringTag,{value:"Module"}));let BRe=class GRe extends Lr{initializeProgram(e){return new Rr(e.rctx,GRe.shader.get().build(),Tr)}initializePipeline(){return Mt({blending:Eo(xe.SRC_ALPHA,xe.ONE,xe.ONE_MINUS_SRC_ALPHA,xe.ONE_MINUS_SRC_ALPHA),colorWrite:Gt})}};BRe.shader=new Or(cbt,()=>ce(()=>import("./OITCompositing.glsl-ca8e4a18.js"),[],import.meta.url));let jRe=class extends ri{constructor(){super(...arguments),this.overlayIndex=Li.INNER,this.opacity=1}};function ubt(){const t=new Sr;return t.include(Zh),t.fragment.uniforms.add(new et("tex",e=>e.texture)),t.fragment.uniforms.add(new hP("overlayIdx",e=>e.overlayIndex)),t.fragment.uniforms.add(new Pe("opacity",e=>e.opacity)),t.fragment.code.add(w`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;
}`),t}const hbt=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:jRe,build:ubt},Symbol.toStringTag,{value:"Module"}));let HRe=class qRe extends Lr{initializeProgram(e){return new Rr(e.rctx,qRe.shader.get().build(),Tr)}initializePipeline(){return Mt({blending:Lc(xe.ONE,xe.ONE_MINUS_SRC_ALPHA),colorWrite:Gt})}};HRe.shader=new Or(hbt,()=>ce(()=>import("./OverlayCompositing.glsl-12de9e0d.js"),[],import.meta.url));let dbt=class{constructor(e,r){this._rctx=e,this._techniqueRepository=r,this._configuration=new CW,this._atmosphereConfiguration=new rF,this._passParameters=new DRe,this._atmosphereParameters=new IRe,this._oitParameters=new VRe,this._hudParameters=new URe,this._overlayParameters=new jRe}destroy(){this._vao=Ve(this._vao)}compositeOIT(e,r,i,s){this._oitParameters.colorTexture=r,this._oitParameters.alphaTexture=i,this._oitParameters.frontFaceTexture=s;const n=this._rctx,o=this._techniqueRepository.acquire(BRe);n.bindTechnique(o,this._oitParameters,e);const a=this._ensureVAO();n.bindVAO(a),n.drawArrays(At.TRIANGLE_STRIP,0,zo(a,"geometry")),o.release()}compositeHUD(e,r){this._hudParameters.texture=r;const i=this._rctx,s=this._techniqueRepository.acquire(kRe);i.bindTechnique(s,this._hudParameters,e);const n=this._ensureVAO();i.bindVAO(n),i.drawArrays(At.TRIANGLE_STRIP,0,zo(n,"geometry")),s.release()}compositeOverlay(e,r,i,s){this._overlayParameters.texture=r,this._overlayParameters.opacity=i,this._overlayParameters.overlayIndex=s;const n=this._rctx,o=this._techniqueRepository.acquire(HRe);n.bindTechnique(o,this._overlayParameters,e);const a=this._ensureVAO();n.bindVAO(a),n.drawArrays(At.TRIANGLE_STRIP,0,zo(a,"geometry")),o.release()}compositeAtmosphere(e,r,i,s,n){const o=this._rctx;this._atmosphereParameters.texture=r,this._atmosphereParameters.depthTexture=i,this._atmosphereParameters.scale=s,this._atmosphereConfiguration.haze=n;const a=this._techniqueRepository.acquire($Re,this._atmosphereConfiguration);o.bindTechnique(a,this._atmosphereParameters,e);const l=this._ensureVAO();o.bindVAO(l),o.drawArrays(At.TRIANGLE_STRIP,0,zo(l,"geometry")),a.release()}composite(e,r,i=ca.None,s=1){const n=this._rctx;this._configuration.alphaMode=i,this._configuration.hasOpacityFactor=s!==1,this._passParameters.texture=r,this._passParameters.opacity=s;const o=this._techniqueRepository.acquire(NRe,this._configuration);n.bindTechnique(o,this._passParameters,e);const a=this._ensureVAO();n.bindVAO(a),n.drawArrays(At.TRIANGLE_STRIP,0,zo(a,"geometry")),o.release()}_ensureVAO(){return this._vao==null&&(this._vao=kl(this._rctx)),this._vao}};const pbt=1e4,AW=100,fbt=500,mbt=500,gbt=.1;function ybt(t,e,r){return dQ(e,t)*(r[1]-r[0])+r[0]}function _bt(t,e,r){let i=0;if(!e.some(n=>(i+=n.numGeometries,i>=pbt)))return Cbt.compute(t,e);const s=mP();return r.forAll(n=>{n.visible&&IE(s,vbt(t,n))}),s}function vbt(t,e){if(!e.visible)return;const r=mP(),i=e.getSpatialQueryAccelerator();return i!=null?bbt(r,t,i):wbt(r,t,e.objects),r}function bbt(t,e,r){const i=e.eye,s=e.viewForward,n=e.frustum,o=l=>l.visible,a=r.objectCount;if(a<fbt)lM(fh,e.near,Math.min(t.near,e.far)),r.forEachInDepthRange(i,s,lp.DepthOrder.FRONT_TO_BACK,fh,(l,c)=>{OW(t,e,l),fh.far=t.near,c.setRange(fh)},n,o),lM(fh,Math.max(t.far,e.near),e.far),r.forEachInDepthRange(i,s,lp.DepthOrder.BACK_TO_FRONT,fh,(l,c)=>{OW(t,e,l),fh.near=t.far,c.setRange(fh)},n,o);else{const l=Math.max(Math.min(a,mbt),Math.ceil(a*gbt)),c=r.findClosest(s,lp.DepthOrder.FRONT_TO_BACK,n,o,l),h=r.findClosest(s,lp.DepthOrder.BACK_TO_FRONT,n,o,l);c&&h&&(Xhe(t,e,c.boundingVolumeWorldSpace.bounds),Xhe(t,e,h.boundingVolumeWorldSpace.bounds))}}function wbt(t,e,r){OT.clear(),r.forAll(i=>{i.visible&&i.geometries.length!==0&&OT.add(i)}),OT.empty||(OT.sort(e),lM(fh,e.near,Math.min(t.near,e.far)),OT.forEachInDepthRange(fh,lp.DepthOrder.FRONT_TO_BACK,(i,s)=>{s<t.near&&OW(t,e,i)}),lM(fh,Math.max(t.far,e.near),e.far),OT.forEachInDepthRange(fh,lp.DepthOrder.BACK_TO_FRONT,(i,s,n)=>{t.far=Math.max(t.far,n)}))}function OW(t,e,r){if(!r.visible||!D_(e.frustum,r.boundingVolumeWorldSpace.bounds))return;const i=r.transformation,s=Ebt;r.geometries.forEach(n=>{oi(s,i,n.shaderTransformation);const o=lE(s);WRe(t,e,n.boundingInfo,s,o)})}function WRe(t,e,r,i,s){if(r==null)return;Fe(qa,r.center,i);const{eye:n,viewForward:o}=e,a=o[0]*(qa[0]-n[0])+o[1]*(qa[1]-n[1])+o[2]*(qa[2]-n[2]);if(qa[3]=r.radius*s,!(a-qa[3]>t.near&&a+qa[3]<t.far)&&D_(e.frustum,qa))if(r.radius>AW&&r.getChildren())for(const l of r.getChildren())WRe(t,e,l,i,s);else RW.unionDepthRangeWithAABB(t,e.viewProjectionMatrix,i,r.bbMin,r.bbMax)}function Xhe(t,e,r){const i=e.eye,s=e.viewForward,n=(r[0]-i[0])*s[0]+(r[1]-i[1])*s[1]+(r[2]-i[2])*s[2];t.near=Math.min(t.near,n-r[3]),t.far=Math.max(t.far,n+r[3])}let xbt=class{constructor(){this._items=new Bt({allocator:e=>e||{obj:null,distance:0,near:0,far:0},deallocator:e=>(e.obj=null,e.distance=0,e.near=0,e.far=0,e)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(e){this._items.pushNew().obj=e}sort(e){const r=e.eye,i=e.viewForward;this._items.forAll(s=>{const n=s.obj.boundingVolumeWorldSpace.bounds,o=(n[0]-r[0])*i[0]+(n[1]-r[1])*i[1]+(n[2]-r[2])*i[2];s.distance=o,s.near=o-n[3],s.far=o+n[3]}),this._items.sort((s,n)=>s.distance-n.distance)}forEachInDepthRange(e,r,i){if(r===lp.DepthOrder.FRONT_TO_BACK)for(let s=0;s<this._items.length;++s){const n=this._items.data[s];n.far<e.near||n.near>e.far||i(n.obj,n.near,n.far)}else for(let s=this._items.length-1;s>=0;--s){const n=this._items.data[s];n.far<e.near||n.near>e.far||i(n.obj,n.near,n.far)}}},Tbt=class{constructor(){this._view=be(),this._viewProj=be(),this._frustum=BR(),this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange={near:0,far:0}}compute(e,r){this._reset(),Us(this._view,e.viewMatrix),oi(this._viewProj,e.projectionMatrix,this._view),sF(this._frustum,e.frustum);const i=this._view,s=i[2],n=i[6],o=i[10],a=i[14];r.forAll(f=>f.forEachGeometry(m=>{if(!m.visible||!m.castShadow)return;const y=m.boundingSphere,_=s*y[0]+n*y[1]+o*y[2]+a,v=_-y[3],b=_+y[3];this._geometries.push(m),this._near.push(-b),this._far.push(-v)}));const l=new p1t;if(this._geometries.length===0)return l;for(let f=0;f<this._geometries.length;++f)this._near[f]>l.far&&(l.far=this._near[f]),this._near[f]>2&&this._far[f]<l.near&&(l.near=this._far[f]);const c=this._looseRange;c.near=Math.max(.5*l.near,2),c.far=2*l.far;let h=0,p=0;for(let f=0;f<this._geometries.length;++f)this._near[f]<l.near&&(this._near[f]>=c.near?l.near=this._near[f]:this._nearCandidates[h++]=f),this._far[f]>l.far&&(this._far[f]<=c.far?l.far=this._far[f]:this._farCandidates[p++]=f);if(this._nearCandidates.length===0&&this._farCandidates.length===0)return l;this._nearCandidates.sort((f,m)=>this._near[f]<this._near[m]?-1:this._near[f]>this._near[m]?1:0),this._farCandidates.sort((f,m)=>this._far[f]<this._far[m]?1:this._far[f]>this._far[m]?-1:0);for(let f=0;f<this._nearCandidates.length;++f){const m=this._nearCandidates[f];if(this._near[m]<l.near){const y=this._geometries[m],_=y.boundingInfo;this._includeNearBoundingInfoRec(_,y.shaderTransformation,l)}}for(let f=0;f<this._farCandidates.length;++f){const m=this._farCandidates[f];if(this._far[m]>l.far){const y=this._geometries[m],_=y.boundingInfo;this._includeFarBoundingInfoRec(_,y.shaderTransformation,l)}}return this._reset(),l}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_includeNearBoundingInfoRec(e,r,i){if(e==null)return;const s=e.center;Fe(qa,s,r);const n=lE(r),o=qa[0],a=qa[1],l=qa[2],c=e.radius*n,h=this._frustum;if(h[0][0]*o+h[0][1]*a+h[0][2]*l+h[0][3]>c||h[1][0]*o+h[1][1]*a+h[1][2]*l+h[1][3]>c||h[2][0]*o+h[2][1]*a+h[2][2]*l+h[2][3]>c||h[3][0]*o+h[3][1]*a+h[3][2]*l+h[3][3]>c)return;const p=this._view[2]*o+this._view[6]*a+this._view[10]*l+this._view[14],f=p+c;if(!(-(p-c)<2||-f>=i.near))if(-f>this._looseRange.near)i.near=-f;else{if(c>AW){const m=e.getChildren();if(m!==void 0){for(const y of m)this._includeNearBoundingInfoRec(y,r,i);return}}RW.unionDepthRangeWithAABB(i,this._viewProj,r,e.bbMin,e.bbMax)}}_includeFarBoundingInfoRec(e,r,i){if(e==null)return;let s=e.radius;const n=e.center;Fe(qa,n,r);const o=lE(r),a=qa[0],l=qa[1],c=qa[2];s*=o;const h=this._frustum;if(h[0][0]*a+h[0][1]*l+h[0][2]*c+h[0][3]>s||h[1][0]*a+h[1][1]*l+h[1][2]*c+h[1][3]>s||h[2][0]*a+h[2][1]*l+h[2][2]*c+h[2][3]>s||h[3][0]*a+h[3][1]*l+h[3][2]*c+h[3][3]>s)return;const p=this._view[2]*a+this._view[6]*l+this._view[10]*c+this._view[14]-s;if(!(-p<=i.far))if(-p<this._looseRange.far)i.far=-p;else{if(s>AW){const f=e.getChildren();if(f!==void 0){for(const m of f)this._includeFarBoundingInfoRec(m,r,i);return}}RW.unionDepthRangeWithAABB(i,this._viewProj,r,e.bbMin,e.bbMax)}}},Sbt=class{constructor(){this._modelViewProj=be(),this._clipPosition=[Xt(),Xt(),Xt(),Xt(),Xt(),Xt(),Xt(),Xt()]}unionDepthRangeWithAABB(e,r,i,s,n){const o=this._modelViewProj;oi(o,r,i);let a=!1;for(let l=0;l<8;++l){const c=this._clipPosition[l],h=l===0||l===3||l===4||l===7?s[0]:n[0],p=l===0||l===1||l===4||l===5?s[1]:n[1],f=l<4?s[2]:n[2];c[0]=o[0]*h+o[4]*p+o[8]*f+o[12],c[1]=o[1]*h+o[5]*p+o[9]*f+o[13],c[2]=o[2]*h+o[6]*p+o[10]*f+o[14],c[3]=o[3]*h+o[7]*p+o[11]*f+o[15]}for(let l=0;l<12;++l){const c=this._clipPosition[Bz[l][0]],h=this._clipPosition[Bz[l][1]],p=this._clipPosition[Bz[l][2]],f=this._clipTriangle(c,h,p);let m=!0;for(let y=0;y<f.length;++y)if(f[y][3]>=2){m=!1;break}if(!m){a=!0;for(let y=0;y<f.length;++y){const _=f[y][3];Number.isFinite(_)&&(e.near=Math.min(_,e.near),e.far=Math.max(_,e.far))}}}return a}_inside(e,r){return r===0?e[0]>=-e[3]:r===1?e[1]>=-e[3]:r===2?e[0]<=e[3]:r===3?e[1]<=e[3]:void nt(!1)}_intersect(e,r,i){let s=0;return i===0?s=(-e[3]-e[0])/(r[0]-e[0]+r[3]-e[3]):i===1?s=(-e[3]-e[1])/(r[1]-e[1]+r[3]-e[3]):i===2?s=(e[3]-e[0])/(r[0]-e[0]-r[3]+e[3]):i===3&&(s=(e[3]-e[1])/(r[1]-e[1]-r[3]+e[3])),Z5(Xt(),e,r,s)}_clipTriangle(e,r,i){let s=[e,r,i];for(let n=0;n<4;++n){const o=s;s=[];for(let a=0;a<o.length;++a){const l=o[a],c=o[(a+1)%o.length];this._inside(c,n)?(this._inside(l,n)||s.push(this._intersect(l,c,n)),s.push(c)):this._inside(l,n)&&s.push(this._intersect(l,c,n))}}return s}};const Bz=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],qa=bs(),Ebt=be(),fh=mP(),OT=new xbt,Cbt=new Tbt,RW=new Sbt;let Abt=class{},Obt=class extends ri{constructor(){super(...arguments),this.textures=new Abt}};function Rbt(){const t=new Sr;return t.attributes.add(C.POSITION,"vec2"),t.vertex.uniforms.add(new nr("drawPosition",(e,r)=>Mbt(e,r))),t.varyings.add("vUV","vec2"),t.vertex.code.add(w`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),t.fragment.uniforms.add(new et("textureInput",e=>e.textures.input)),t.fragment.uniforms.add(new et("textureMask",e=>e.textures.mask)),t.fragment.uniforms.add(new et("textureOverlay",e=>e.textures.overlay)),t.fragment.uniforms.add(new Jf("maskEnabled",e=>e.magnifier.maskEnabled)),t.fragment.uniforms.add(new Jf("overlayEnabled",e=>e.magnifier.overlayEnabled)),t.fragment.code.add(w`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture(textureMask, vUV).a : 1.0;
vec4 inputColor = texture(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture(textureOverlay, vUV) : vec4(0);
fragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),t}function Mbt(t,e){const r=e.camera.pixelRatio,i=t.magnifier.offset.x*r,s=t.magnifier.offset.y*r;Pf(t.magnifier.position,Zhe);const n=e.camera.screenToRender(Zhe,Pbt),o=Math.ceil(r*t.magnifier.size),a=e.camera.fullWidth,l=e.camera.fullHeight;return xi(Ibt,(n[0]+i)/a*2-1,(n[1]-s)/l*2-1,o/a*2,o/l*2)}const Zhe=Ji(),Pbt=w0e(),Ibt=Xt();async function $bt(t){const e=ce(()=>import("./mask-svg-023bbc42.js"),[],import.meta.url),r=ce(()=>import("./overlay-svg-d62383f3.js"),[],import.meta.url),i=yy((await e).default,{signal:t}),s=yy((await r).default,{signal:t}),n={mask:await i,overlay:await s};return Yt(t),n}let ES=class extends we{constructor(){super(...arguments),this._handles=new Ii,this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this._passParameters=new Obt,this.events=new ws,this.attributeLocations=new Map([[C.POSITION,0]]),this._tmpScreenPoint=Ji(),this._tmpRenderPoint=w0e()}get updating(){return this._imageSources==null&&this._imageLoadTask!=null&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this._handles.removeAll(),this._magnifier=e;const r=()=>{this._updateResourceLoading(),this.events.emit("request-render")};this._magnifier!=null&&this._handles.add(ae(()=>vc(this._magnifier,i=>i.version),r)),r()}get enabled(){return this._validMagnifier!=null}get _validMagnifier(){return this._magnifier!=null&&this._magnifier.visible&&this._magnifier.position!=null&&this._magnifier.size>0?this._magnifier:null}get _factor(){return this._magnifier!=null&&this._magnifier.factor||1}destroy(){this._magnifier=null,this._handles.destroy(),this._imageLoadTask!=null&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources()}render(e,r){const i=this._validMagnifier;if(i==null)return;const s=r.camera.pixelRatio,n=Math.ceil(s*i.size);if(this._updateResources(e,n),this._resources==null)return;const o=this._passParameters.textures,a=Math.ceil(1/this._factor*n);o.input.resize(a,a),Pf(i.position,this._tmpScreenPoint);const l=r.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),c=r.camera.fullWidth,h=r.camera.fullHeight,p=.5*a,f=.5*a;l[0]=ve(l[0],p,c-p-1),l[1]=ve(l[1],f,h-f-1);const m=Math.floor(l[0]-p),y=Math.floor(l[1]-f),_=this._resources.program;_.bindTexture("textureInput",o.input),e.gl.copyTexImage2D(o.input.descriptor.target,0,o.input.descriptor.pixelFormat,m,y,a,a,0),this._passParameters.magnifier=i,e.useProgram(_),_.bindPass(this._passParameters,r),e.bindVAO(this._resources.vao),e.setPipelineState(this._resources.pipelineState),e.drawArrays(At.TRIANGLE_STRIP,0,4)}_updateResourceLoading(){const e=this._validMagnifier;if(e==null)return;const r=e.maskUrl,i=e.overlayUrl;this._imageLoadTask==null||this._imageLoadTask.maskUrl===r&&this._imageLoadTask.overlayUrl===i||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),this._imageSources==null&&this._imageLoadTask==null&&(this._imageLoadTask={maskUrl:r,overlayUrl:i,task:jE(async s=>{const n=r==null||i==null?$bt(s):null,o=r!=null?yy(r,{signal:s}):n.then(l=>l.mask),a=i!=null?yy(i,{signal:s}):n.then(l=>l.overlay);this._imageSources={mask:await o,overlay:await a},this._disposeResources(),this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}_updateResources(e,r){if(!this.enabled)return void this._disposeResources();if(this._resources!=null){if(this._passParameters.textures.size!==r){const s=this._createTextureResources(e,r);if(s==null)return void this._disposeResources();this._disposeTextureResources(this._passParameters.textures),this._passParameters.textures=s}return}const i=this._createTextureResources(e,r);i!=null&&(this._resources={program:this._createProgram(e),vao:kl(e,uJ,this.attributeLocations,0,1),pipelineState:Mt({blending:Lc(xe.ONE,xe.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:Gt})},this._passParameters.textures=i)}_disposeResources(){this._resources!=null&&(this._disposeTextureResources(this._passParameters.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose()}_createTextureResources(e,r){if(this._imageSources==null)return null;this._imageSources.overlay.width=r,this._imageSources.overlay.height=r,this._imageSources.mask.width=r,this._imageSources.mask.height=r;const i=new xr;i.internalFormat=Ct.RGBA,i.wrapMode=Dt.CLAMP_TO_EDGE,i.flipped=!0,i.preMultiplyAlpha=!Ame(this._imageSources.overlay.src)||!e.driverTest.svgPremultipliesAlpha.result;const s=new Ot(e,i,this._imageSources.overlay);i.pixelFormat=i.internalFormat=Ct.ALPHA,i.preMultiplyAlpha=!1;const n=new Ot(e,i,this._imageSources.mask);return i.pixelFormat=i.internalFormat=Ct.RGBA,i.flipped=!1,{input:new Ot(e,i),mask:n,overlay:s,size:r}}_createProgram(e){return new Rr(e,Rbt(),this.attributeLocations)}};u([d()],ES.prototype,"_imageSources",void 0),u([d()],ES.prototype,"_imageLoadTask",void 0),u([d({readOnly:!0})],ES.prototype,"updating",null),ES=u([P("esri/views/3d/webgl-engine/lib/MagnifierHelper")],ES);let Lbt=class{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new ga(new ArrayBuffer(4)),this._uidToRenderColor=new Map,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new Map,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(e,r,i,s,n,o=null,a=null,l=null){if(!(e&&r&&i&&s)||(this._layerUidToId.set(s,i),this._layerUidToPopupEnabled.set(s,n),!n))return;let c=this._layerUidToGraphicsUidToObjectId.get(s);c||(c=new Map,this._layerUidToGraphicsUidToObjectId.set(s,c)),c.set(r,{objectId:e,attributeNodeId:o,attributeIndex:a,subLayerId:l})}getObjectAndLayerIdColor(e){const r=this.getObjectAndLayerIdColorArray(e);return Nt(r.get(0,1),r.get(0,2),r.get(0,3),255)}getObjectAndLayerIdColorArray(e){if(!e.layerUid||!e.graphicUid)return this.colorZero;const r=this._layerUidToPopupEnabled.get(e.layerUid);if(r===void 0)return Q.getLogger(this).warn("popupEnabled is undefined for layerUid "+e.layerUid),this.colorZero;if(r===!1)return this.colorZero;let i=this._uidToRenderColor.get(e.layerUid);i||(i=new Map,this._uidToRenderColor.set(e.layerUid,i));let s=i.get(e.graphicUid);if(!s){for(;!s;){const o=Math.floor(16777214*Math.random())+1;this._colorToUID.has(o)||(s=o)}if(s>16777215)throw new Error("Object ID Overflow");i.set(e.graphicUid,s),this._colorToUID.set(s,e)}const n=new ArrayBuffer(4);return new DataView(n).setUint32(0,s,!1),new ga(n)}getColorToObjectAndLayerIdMapping(){const e=new Map;for(const[r,i]of this._colorToUID.entries()){const s=this._layerUidToGraphicsUidToObjectId.get(i.layerUid);let n=null;s?(n=s.get(i.graphicUid),n||Q.getLogger(this).warn("getColorMapping: no entry found for graphicsId "+i.graphicUid)):Q.getLogger(this).warn("getColorMapping: no entry found for layerUid "+i.layerUid);const o=this._layerUidToId.get(i.layerUid);o||Q.getLogger(this).warn("no layerId found for uid "+i.layerUid),n&&o&&e.set(r,n.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:n.objectId,lid:o,attrId:n.attributeNodeId,attrIdx:n.attributeIndex,subLayerId:n.subLayerId}:{type:"object-and-layer-id",oid:n.objectId,lid:o})}return e}};var cM;(function(t){t[t.FrontToBack=0]="FrontToBack",t[t.BackToFront=1]="BackToFront"})(cM||(cM={}));let v0=class{constructor(e,r,i=cM.FrontToBack){this._rctx=e,this._techniqueRepository=r,this._sorting=i,this._draws=new Bt({initialSize:32,allocator:s=>s||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(e,r,i,s){const n=this._draws.pushNew();n.geometry=r,n.geometryRanges=i,n.material=e,n.depthSquaredHint=s,n.indexType=(r.indexed?r.vao.indexBuffer.indexType:null)??0}prepare(e,r){return this._draws.map(i=>i.material.prepareTechnique(this._techniqueRepository,e,r,i.geometry.parameters))}dispatch(e,r,i){const s=this._rctx;this._previouslyBoundDraw.clear();let n=null;const o=this._draws.length;for(let a=0;a<o;a++){const l=i[a];l===n&&l.configuration.transparencyPassType===ut.NONE||(s.bindTechnique(l,e,r),n=l);const c=this._draws.data[a],h=c.geometry;s.bindVAO(h.vao),this._previouslyBoundDraw.get(l)!==c.material&&(l.program.bindDraw(c.material,r,e),this._previouslyBoundDraw.set(l,c.material));const p=c.geometryRanges,f=p.length;if(c.indexType!==0){const m=MN.get(c.indexType);for(let y=0;y<f;y+=2){const _=p[y],v=p[y+1];s.drawElements(h.primitiveType,v,c.indexType,_*m)}}else for(let m=0;m<f;m+=2){const y=p[m],_=p[m+1];s.drawArrays(h.primitiveType,y,_)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const e=this._sorting===cM.FrontToBack?1:-1;this._draws.sort((r,i)=>{const s=e*(r.depthSquaredHint-i.depthSquaredHint);return s!==0?s:r.geometry.vao.byteSize-i.geometry.vao.byteSize})}get count(){return this._draws.length}};const MN=new Map;MN.set(rt.UNSIGNED_BYTE,1),MN.set(rt.UNSIGNED_SHORT,2),MN.set(rt.UNSIGNED_INT,4);let Dbt=class{constructor(e,r){this.rctx=e,this.shaderTechniqueRepository=r,this.canRender=!0,this._materialPassParameters=new a_t,this._shadowPassParameters=new l_t,this._highlightPassParameters=new c_t,this._systems=new Set,this._passes={materialOpaque:new v0(e,r),materialTransparent:new v0(e,r,cM.BackToFront),materialIntegratedMesh:new v0(e,r),shadowMap:new v0(e,r),highlight:new v0(e,r),highlightIntegratedMesh:new v0(e,r),highlightShadowMap:new v0(e,r),defaultShadowMap:new v0(e,r)}}destroy(){this._context=null,this._systems.clear()}register(e){this._systems.add(e)}prepareRender(e){if(this._systems.size!==0){for(const r of Object.values(this._passes))r.prepareSubmit();this._systems.forEach(r=>r.submit(this._passes,e.bindParameters));for(const r of Object.values(this._passes))r.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}}prepareTechniques(e){return this._systems.size===0?null:(this._configure(e),this._materialPassParameters.output=e.output,this._invoke(e,(r,i)=>r.prepare(i,e.bindParameters)))}render(e,r){this._invoke(e,(i,s)=>i.dispatch(s,e.bindParameters,r))}_invoke(e,r){switch(e.bindParameters.slot){case he.OPAQUE_MATERIAL:switch(e.output){case U.Color:case U.Depth:case U.Normal:case U.ObjectAndLayerIdColor:return r(this._passes.materialOpaque,this._materialPassParameters);case U.Highlight:return r(this._passes.highlight,this._highlightPassParameters);case U.Shadow:return r(this._passes.shadowMap,this._shadowPassParameters);case U.ShadowHighlight:return r(this._passes.highlightShadowMap,this._shadowPassParameters);case U.ShadowExcludeHighlight:return r(this._passes.defaultShadowMap,this._shadowPassParameters)}break;case he.TRANSPARENT_MATERIAL:switch(e.output){case U.Color:case U.Alpha:case U.Depth:case U.Normal:case U.ObjectAndLayerIdColor:return r(this._passes.materialTransparent,this._materialPassParameters)}break;case he.INTEGRATED_MESH:switch(e.output){case U.Color:case U.Depth:case U.Normal:case U.ObjectAndLayerIdColor:return r(this._passes.materialIntegratedMesh,this._materialPassParameters);case U.Highlight:return r(this._passes.highlightIntegratedMesh,this._highlightPassParameters)}}return null}notifyDirty(){this._context.requestRender()}slots(){return[he.OPAQUE_MATERIAL,he.TRANSPARENT_MATERIAL,he.INTEGRATED_MESH]}initializeRenderContext(e){this._context=e}uninitializeRenderContext(){}queryDepthRange(e){const r={near:1/0,far:-1/0};return this._systems.forEach(i=>{const s=i.queryShadowCasterDepthRange(e);s!=null&&IE(r,s,r)}),r}_configure(e){const r=e.output===U.Shadow||e.output===U.ShadowHighlight||e.output===U.ShadowExcludeHighlight?this._shadowPassParameters:e.output===U.Highlight?this._highlightPassParameters:this._materialPassParameters;this._updateParameters(e,r)}_updateParameters(e,r){const i=e.bindParameters.camera,s=i.viewInverseTransposeMatrix;se(Gz,s[3],s[7],s[11]),jz.set(Gz),re(r.transformWorldFromViewTH,jz.high),re(r.transformWorldFromViewTL,jz.low),re(r.slicePlaneLocalOrigin,Gz),Vh(r.transformViewFromCameraRelativeRS,i.viewMatrix),Us(r.transformProjFromView,i.projectionMatrix),r.identifier===_c.Material&&(this._materialPassParameters.transparent=e.bindParameters.slot===he.TRANSPARENT_MATERIAL,this._materialPassParameters.integratedMesh=e.bindParameters.slot===he.INTEGRATED_MESH,Bh(Yhe,r.transformViewFromCameraRelativeRS),dx(r.transformNormalViewFromGlobal,Yhe))}get needsHighlight(){return this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0}get needsTransparentPass(){return this._passes.materialTransparent.count>0}};const Gz=O(),Yhe=Ui(),jz=new i8;let Nbt=class{constructor(){this._step=Khe,this._dilation=1,this._firstIdleTime=0}frame(e,r){if(r?this._firstIdleTime===0&&(this._firstIdleTime=performance.now()):this._firstIdleTime=0,oe("disable-feature:high-quality-idle"))this._dilation=1;else{const s=r?performance.now()-this._firstIdleTime:0;if(s>=Jhe+Ubt)return this._step=1/0,void(this._dilation=1);this._dilation=s>=Jhe?kbt:1}const i=ve(e/Fbt,Khe,Vbt);this._step===1/0?this._step=i:this._step=this._step*Qhe+i*(1-Qhe)}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=0}};const Fbt=.5,Jhe=12e4,Ubt=1e4,kbt=10,Qhe=.9,zbt=30,Khe=1e3/1,Vbt=1e3/zbt,Bbt=8.6,Gbt=.4;function jbt(){const t=new Sr,{vertex:e,fragment:r}=t,i=e.code,s=r.code;return t.attributes.add(C.POSITION,"vec2"),t.varyings.add("uv","vec2"),t.attributes.add(C.UV0,"vec2"),e.uniforms.add(new et("coverageTex",n=>n.coverageTexture)),i.add(w`void main() {
vec4 cov = texture(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),r.uniforms.add(new et("tex",n=>n.blurColorTexture),new et("origin",n=>n.highlightColorTexture),new nr("uColor",n=>n.color),new nr("haloColor",n=>n.haloColor),new nr("opacities",n=>xi(Hbt,n.haloOpacity,n.haloOpacityOccluded,n.fillOpacity,n.fillOpacityOccluded))),r.constants.add("outlineSize","float",Bbt),r.constants.add("blurSize","float",Gbt),s.add(w`void main() {
vec4 blurredHighlightValue = texture(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
fragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),t}const Hbt=Xt(),qbt=Object.freeze(Object.defineProperty({__proto__:null,build:jbt},Symbol.toStringTag,{value:"Module"}));let XRe=class ZRe extends Lr{initializeProgram(e){return new Rr(e.rctx,ZRe.shader.get().build(),Tr)}initializePipeline(){return Mt({blending:Eo(xe.SRC_ALPHA,xe.ONE,xe.ONE_MINUS_SRC_ALPHA,xe.ONE_MINUS_SRC_ALPHA),colorWrite:Gt})}};XRe.shader=new Or(qbt,()=>ce(()=>import("./HighlightApply.glsl-398d2eb2.js"),[],import.meta.url));let YRe=class extends ri{constructor(){super(...arguments),this.blurSize=Ge()}};function Wbt(){const t=new Sr,{vertex:e,fragment:r}=t,i=e.code,s=r.code;return t.attributes.add(C.POSITION,"vec2"),t.attributes.add(C.UV0,"vec2"),t.varyings.add("blurCoordinate","vec3"),e.uniforms.add(new et("coverageTex",n=>n.coverageTexture)),r.uniforms.add(new BQ("blurSize",n=>n.blurSize)),i.add(w`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
}`),r.uniforms.add(new Ih("tex",n=>n.blurInputTexture)),s.add(w`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture(tex, uv);
if (blurCoordinate.z == 1.0) {
fragColor = center;
} else {
vec4 sum = vec4(0.0);
sum += center * 0.204164;
sum += texture(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture(tex, uv - blurSize * 3.294215) * 0.093913;
fragColor = sum;
}
}`),t}const Xbt=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:YRe,build:Wbt},Symbol.toStringTag,{value:"Module"}));let JRe=class QRe extends Lr{initializeProgram(e){return new Rr(e.rctx,QRe.shader.get().build(),Tr)}initializePipeline(){return Mt({colorWrite:Gt})}};JRe.shader=new Or(Xbt,()=>ce(()=>import("./HighlightBlur.glsl-f9356904.js"),[],import.meta.url));let KRe=class extends ri{constructor(){super(...arguments),this.invFramebufferDim=Ge()}};function Zbt(){const t=new Sr,{vertex:e,fragment:r}=t,i=e.code,s=r.code;return t.attributes.add(C.POSITION,"vec2"),i.add(w`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`),r.uniforms.add(new Ih("tex",n=>n.inputTexture)),r.uniforms.add(new BQ("invFramebufferDim",n=>n.invFramebufferDim)),s.add(w`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture(tex, coord);
float mx = floor(max(value.g, value.b));
fragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`),t}const Ybt=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:KRe,build:Zbt},Symbol.toStringTag,{value:"Module"}));let eMe=class tMe extends Lr{initializeProgram(e){return new Rr(e.rctx,tMe.shader.get().build(),Tr)}initializePipeline(){return Mt({colorWrite:Gt})}};eMe.shader=new Or(Ybt,()=>ce(()=>import("./HighlightDownsample.glsl-0f6f4217.js"),[],import.meta.url));let ede=class extends ri{constructor(){super(...arguments),this.color=ym(1,0,1,1),this.haloColor=ym(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.shadowColor=Nt(1,0,1,1),this.shadowOpacity=.15,this.occludedShadowOpacity=.075}};const Jbt=32;let Qbt=class{constructor(e,r){this._techniqueRep=e,this._rctx=r,this._viewportToRestore=Xt(),this._passParameters=new ede,this._downsampleDrawParameters=new KRe,this._blurDrawParameters=new YRe,this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0}}_assertResources(){if(this._quadVAO)return;this._quadVAO=kl(this._rctx);const e=new xr;e.wrapMode=Dt.CLAMP_TO_EDGE,this._blur0Fbo=new hn(this._rctx,e),this._blur1Fbo=new hn(this._rctx,e),this._blurTechnique=this._techniqueRep.acquire(JRe),this._downsampleTechnique=this._techniqueRep.acquire(eMe),this._applyTechnique=this._techniqueRep.acquire(XRe)}dispose(){if(this._blurTechnique=Bi(this._blurTechnique),this._downsampleTechnique=Bi(this._downsampleTechnique),this._applyTechnique=Bi(this._applyTechnique),this._grid.coverageMipmap)for(let e=1;e<this._grid.coverageMipmap.length;e++)this._grid.coverageMipmap[e].dispose();this._grid.vao&&this._grid.vao.dispose(),this._quadVAO&&(this._quadVAO.dispose(),this._quadVAO=null),this._blur0Fbo=Ve(this._blur0Fbo),this._blur1Fbo=Ve(this._blur1Fbo)}setDefaultOptions(e){this._passParameters={...new ede,...e}}render(e,r,i){this._passParameters.highlightColorTexture=r.colorTexture,this._assertResources();const s=e.camera;Oh(this._viewportToRestore,s.fullViewport);const n=s.fullWidth,o=s.fullHeight,a=s.pixelRatio,l=Math.ceil(n/a),c=Math.ceil(o/a);this._blur0Fbo.resize(l,c),this._blur1Fbo.resize(l,c);const h=this._rctx;h.bindVAO(this._quadVAO);let p=null;this._gridUpdateResources(r,Jbt),this._gridComputeMipmap(e),this._passParameters.coverageTexture=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,p=this._grid.vao;const f=h.bindTechnique(this._blurTechnique,this._passParameters,e);h.bindVAO(p),h.bindFramebuffer(this._blur0Fbo),h.setViewport(0,0,l,c),h.setClearColor(0,0,0,0),h.clear(Ti.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=r.colorTexture,ar(this._blurDrawParameters.blurSize,1/l,0),f.bindDraw(this._blurDrawParameters,e,this._passParameters),h.drawArrays(this._blurTechnique.primitiveType,0,zo(p,"geometry")),h.bindFramebuffer(this._blur1Fbo),h.clear(Ti.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=this._blur0Fbo.colorTexture,ar(this._blurDrawParameters.blurSize,0,1/c),f.bindDraw(this._blurDrawParameters,e,this._passParameters),h.drawArrays(this._blurTechnique.primitiveType,0,zo(p,"geometry")),h.bindFramebuffer(i),h.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3]),this._passParameters.blurColorTexture=this._blur1Fbo.colorTexture,h.bindTechnique(this._applyTechnique,this._passParameters,e),h.drawArrays(this._applyTechnique.primitiveType,0,zo(p,"geometry")),h.bindVAO(null)}_gridUpdateResources(e,r){const i=this._rctx,s=this._grid;let n=!1;if(s.coverageMipmap===null&&(s.coverageMipmap=[e],n=!0),s.viewportWidth===e.width&&s.viewportHeight===e.height||(n=!0,s.viewportWidth=e.width,s.viewportHeight=e.height),s.coverageMipmap[0]=e,s.cellPixelSize!==r&&(s.cellPixelSize=r,n=!0),n){for(let l=1;l<s.coverageMipmap.length;l++)s.coverageMipmap[l].dispose();s.mipmapLevels=Math.ceil(Math.log(s.cellPixelSize)*Math.LOG2E),s.coverageMipmap.length=s.mipmapLevels+1;for(let l=0;l<s.mipmapLevels;l++){const c=s.coverageMipmap[l],h=new xr(Math.ceil(c.width/2),Math.ceil(c.height/2));h.pixelFormat=Ct.RGB,h.dataType=Gs.UNSIGNED_SHORT_5_6_5,h.wrapMode=Dt.CLAMP_TO_EDGE,s.coverageMipmap[l+1]=new hn(i,h)}}const o=Math.ceil(e.height/s.cellPixelSize),a=Math.ceil(e.width/s.cellPixelSize);if(!s.vao||s.verticalCellCount!==o||s.horizontalCellCount!==a){s.verticalCellCount=o,s.horizontalCellCount=a;const l=o+1,c=a+1,h=1/o,p=1/a,f=6,m=4,y=new Float32Array(f*m*l*c);let _=0;for(let v=0;v<l;v++)for(let b=0;b<c;b++)y[_]=(b-.5)*p*2-1,y[_+1]=(v-.5)*h*2-1,y[_+2]=b*p,y[_+3]=v*h,y[_+4]=(b+.5)*p*2-1,y[_+5]=(v-.5)*h*2-1,y[_+6]=b*p,y[_+7]=v*h,y[_+8]=(b-.5)*p*2-1,y[_+9]=(v+.5)*h*2-1,y[_+10]=b*p,y[_+11]=v*h,y[_+12]=(b-.5)*p*2-1,y[_+13]=(v+.5)*h*2-1,y[_+14]=b*p,y[_+15]=v*h,y[_+16]=(b+.5)*p*2-1,y[_+17]=(v-.5)*h*2-1,y[_+18]=b*p,y[_+19]=v*h,y[_+20]=(b+.5)*p*2-1,y[_+21]=(v+.5)*h*2-1,y[_+22]=b*p,y[_+23]=v*h,_+=f*m;s.vao&&s.vao.dispose(),s.vao=new Rp(i,Tr,{geometry:WM},{geometry:Ur.createVertex(i,Cr.STATIC_DRAW,y)})}}_gridComputeMipmap(e){const r=this._rctx,i=this._grid,s=r.bindTechnique(this._downsampleTechnique,this._passParameters,e);r.bindVAO(this._quadVAO);for(let n=0;n<i.mipmapLevels;n++){r.bindFramebuffer(i.coverageMipmap[n+1]);const o=i.coverageMipmap[n+1].width,a=i.coverageMipmap[n+1].height;this._downsampleDrawParameters.inputTexture=i.coverageMipmap[n].colorTexture,ar(this._downsampleDrawParameters.invFramebufferDim,1/o,1/a),s.bindDraw(this._downsampleDrawParameters,e,this._passParameters),r.setViewport(0,0,o,a),r.drawArrays(At.TRIANGLE_STRIP,0,zo(this._quadVAO,"geometry"))}}get gpuMemoryUsage(){let e=(this._blur0Fbo!=null?this._blur0Fbo.gpuMemoryUsage:0)+(this._blur1Fbo!=null?this._blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const r of this._grid.coverageMipmap)e+=r.gpuMemoryUsage;return e}get test(){return{coverage:this._grid.coverageMipmap,blur:[this._blur0Fbo,this._blur1Fbo]}}};const Kbt={dataType:Gs.UNSIGNED_BYTE,internalFormat:Ct.RGBA},ewt={};let twt=class{constructor(e){this._rctx=e,this._activeTargets=new Set,this._colorTextures=new Map,this._depthTextures=new Map,this._fbos=new Map}dispose(){this._depthTextures.forEach(e=>e.dispose()),this._depthTextures.clear(),this._colorTextures.forEach(e=>e.dispose()),this._colorTextures.clear(),this._fbos.forEach(e=>e.dispose()),this._fbos.clear(),this._activeTargets.clear()}disposeTargetResource(e){const r=e.id;this._activeTargets.has(r)&&(this._activeTargets.delete(r),this._disposeWithFramebuffers(this._depthTextures,r),this._disposeWithFramebuffers(this._colorTextures,r))}_disposeWithFramebuffers(e,r){const i=e.get(r);i&&(this._fbos.forEach((s,n)=>{s.colorTexture!==i&&s.depthStencilAttachment!==i||(s.detachColorTexture(),s.detachDepthStencilTexture(),s.dispose(),this._fbos.delete(n))}),i.dispose(),e.delete(r))}_getDepthTexture(e,r,i){let s=this._depthTextures.get(e.id);if(!s||s.descriptor.width===r&&s.descriptor.height===i||(s.dispose(),s=null),!s){const n=new xr(r,i);n.pixelFormat=Ct.DEPTH_STENCIL,n.dataType=Gs.UNSIGNED_INT_24_8,n.samplingMode=Rt.NEAREST,n.wrapMode=Dt.CLAMP_TO_EDGE,s=new Ot(this._rctx,n),this._depthTextures.set(e.id,s),this._activeTargets.add(e.id)}return s}getAllocatedDepthTexture(e){return this._depthTextures.get(e.id)}getColorTexture(e,r,i){let s=this._colorTextures.get(e.id);if(s&&(s.descriptor.width===r&&s.descriptor.height===i||(s.dispose(),s=UE())),!s){const n=new xr(r,i);n.internalFormat=e.internalFormat,n.dataType=e.dataType,n.samplingMode=e.samplingMode!=null?e.samplingMode:Rt.LINEAR,n.wrapMode=Dt.CLAMP_TO_EDGE,s=new Ot(this._rctx,n),this._colorTextures.set(e.id,s),this._activeTargets.add(e.id)}return s}getAllocatedColorTexture(e){return this._colorTextures.get(e.id)}registerDepthTarget(e={}){return{id:Cc(),...ewt,...e}}registerColorTarget(e={}){return{id:Cc(),...Kbt,...e}}getFramebuffer(e,r,i,s){const n=this._getKey(i,s);let o=this._fbos.get(n);const a=this.getColorTexture(i,e,r),l=s?this._getDepthTexture(s,e,r):void 0;return o?((o.width!==e||o.height!==r||o.colorTexture!==a||o.depthStencilAttachment!==l)&&(o.detachColorTexture(),o.detachDepthStencilTexture(),o.resize(e,r),o.attachColorTexture(a),o.attachDepthStencil(l)),o):(o=new hn(this._rctx,a,l),this._fbos.set(n,o),o)}_getKey(e,r){return`${e.id}_${r?r.id:"X"}_${e.name}${r?"_"+r.name:""}`}get gpuMemoryUsage(){let e=0;const r=new Set,i=s=>{r.has(s)||(r.add(s),e+=s.gpuMemoryUsage)};return this._colorTextures.forEach(i),this._depthTextures.forEach(i),e}},rwt=class{constructor(e,r){this._rctx=e,this._compositingHelper=r,this._mainColorTarget=0,this.width=4,this.height=4,this._background={type:"color",color:[0,0,0,1]},this._renderTargetHelper=new twt(e);const i=this._renderTargetHelper;this._mainColorTargets=[i.registerColorTarget({name:"mainColorTarget0"}),i.registerColorTarget({name:"mainColorTarget1"})],this.frontFaceTarget=i.registerColorTarget({name:"frontFaceTarget"}),this.colorFloatTarget=i.registerColorTarget({name:"colorFloatTarget",dataType:Gs.HALF_FLOAT,internalFormat:Je.RGBA16F,samplingMode:Rt.NEAREST}),this.alphaFloatTarget=i.registerColorTarget({name:"alphaFloatTarget",dataType:Gs.HALF_FLOAT,internalFormat:Je.R16F,samplingMode:Rt.NEAREST}),this.mainDepth=i.registerDepthTarget({name:"mainDepth"}),this.linearDepth=i.registerColorTarget({name:"linearDepth",samplingMode:Rt.NEAREST}),this.terrainLinearDepth=i.registerColorTarget({name:"terrainLinearDepth"}),this.geometryLinearDepth=i.registerColorTarget({name:"geometryLinearDepth"}),this.normal=i.registerColorTarget({name:"normal"}),this.highlight=i.registerColorTarget({name:"highlight",internalFormat:Je.RGBA4,dataType:Gs.UNSIGNED_SHORT_4_4_4_4}),this.hudVisibility=i.registerColorTarget({name:"hudVisibility",internalFormat:Je.RGBA4,dataType:Gs.UNSIGNED_SHORT_4_4_4_4}),this.tmpColor=i.registerColorTarget({name:"tmpColor"}),this.tmpDepth=i.registerDepthTarget({name:"tmpDepth"}),this.hudColor=i.registerColorTarget({name:"hudColor"})}dispose(){this._renderTargetHelper.dispose()}set background(e){this._background=e}get background(){return this._background}get currentColorTarget(){return this._mainColorTargets[this._mainColorTarget]}get previousColorTarget(){return this._mainColorTargets[1-this._mainColorTarget]}get framebuffer(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}getFramebuffer(e,r){return this._renderTargetHelper.getFramebuffer(this.width,this.height,e,r)}get colorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}get depthTexture(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}get linearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}get terrainLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}get geometryLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}get lastFrameColorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}get normalTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}get highlightTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}get hudVisibilityTexture(){return this._getColorTexture(this.hudVisibility)}get tmpColorTexture(){return this._getColorTexture(this.tmpColor)}get hudColorTexture(){return this._getColorTexture(this.hudColor)}get mainColorTexture(){return this._getColorTexture(this.currentColorTarget)}setupRenderTarget(e){e?this._mainColorTarget=this._mainColorTarget?0:1:(this._mainColorTarget=0,this.disposeTarget(this._mainColorTargets[1]))}initializeFrame(e){const r=this._rctx;this.width=e.fullWidth,this.height=e.fullHeight,jb(this,r.parameters.maxTextureSize),this.bindTarget(this.currentColorTarget,this.mainDepth),r.setClearStencil(0);const i=this._background.color;r.setClearColor(i[0]*i[3],i[1]*i[3],i[2]*i[3],i[3]),r.clearSafe(Ti.COLOR_BUFFER_BIT|Ti.DEPTH_BUFFER_BIT|Ti.STENCIL_BUFFER_BIT)}composite(e){this.colorTexture!=null&&this._compositingHelper.composite(e,this.colorTexture,ca.None)}renderTmpAndCompositeToMain(e,r,i,s=!1){this.renderToTargets(e,this.tmpColor,s?this.tmpDepth:this.mainDepth,iwt),this._compositingHelper.composite(r,this._getColorTexture(this.tmpColor),i)}compositeAtmosphereToMain(e,r,i,s){this.bindTarget(this.currentColorTarget),this._compositingHelper.compositeAtmosphere(e,this._renderTargetHelper.getColorTexture(this.tmpColor,this.width,this.height),i,s,r),this.bindTarget(this.currentColorTarget,this.mainDepth)}renderHUDVisibility(e,r=!1){this.renderToTargets(e,this.hudVisibility,r?this.tmpDepth:this.mainDepth,swt)}compositeTransparentTerrainOntoHUDVisibility(e){this.renderToTargets(()=>this._compositingHelper.compositeHUD(e,this._getColorTexture(this.tmpColor)),this.hudVisibility,this.tmpDepth)}renderOITPass(e,r,i){let s,n;switch(r){case ut.Color:s=this.colorFloatTarget,n=[0,0,0,0];break;case ut.Alpha:s=this.alphaFloatTarget,n=[1,1,1,1];break;case ut.FrontFace:s=this.frontFaceTarget,n=[0,0,0,0];break;case ut.NONE:case ut.COUNT:return}i?this.renderToTargets(e,s,this.tmpDepth,n,!0,!0):this.renderToTargets(e,s,this.mainDepth,n,!1)}compositeTransparentTerrainOntoMain(e){this.bindFramebuffer(),this._compositingHelper.composite(e,this._getColorTexture(this.tmpColor),ca.PremultipliedAlpha)}compositeOccludedOntoMain(e,r){this.bindFramebuffer(),this._compositingHelper.composite(e,this._getColorTexture(this.tmpColor),ca.PremultipliedAlpha,r)}compositeTransparentOntoOpaque(e,r){r?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clearSafe(Ti.COLOR_BUFFER_BIT)):this.bindFramebuffer(),this._compositingHelper.compositeOIT(e,this._getColorTexture(this.colorFloatTarget),this._getColorTexture(this.alphaFloatTarget),this._getColorTexture(this.frontFaceTarget))}bindFramebuffer(){this._rctx.bindFramebuffer(this.framebuffer)}renderDepthDetached(e){this.bindTarget(this.currentColorTarget),e(),this.bindTarget(this.currentColorTarget,this.mainDepth)}disposeTarget(e){this._renderTargetHelper.disposeTargetResource(e)}renderToFBO(e,r,i=!1,s=!1){const n=this._rctx;let o=0;if(r){const l=Math.max(1e-13,r[3]);n.setClearColor(r[0],r[1],r[2],l),o|=Ti.COLOR_BUFFER_BIT}i&&(o|=Ti.DEPTH_BUFFER_BIT),s===!1?s=0:(s===!0&&(s=255),o|=Ti.STENCIL_BUFFER_BIT),o&&n.clearSafe(o,s),e(),n.gl.flush(),this.bindTarget(this.currentColorTarget,this.mainDepth)}renderToTargets(e,r,i,s,n=!1,o=!1){const a=this.bindTarget(r,i);return this.renderToFBO(e,s,n,o),a}bindTarget(e,r){const i=this._renderTargetHelper.getFramebuffer(this.width,this.height,e,r);return this._rctx.bindFramebuffer(i),i}_getColorTexture(e){return this._renderTargetHelper.getColorTexture(e,this.width,this.height)}get gpuMemoryUsage(){let e=0;return this._renderTargetHelper&&(e+=this._renderTargetHelper.gpuMemoryUsage),e}};const iwt=[0,0,0,0],swt=[0,1,0,1];let nO=class extends we{constructor(e){super({}),this._context=e,this._renderPlugins=new Bt,this._slots=[];for(let r=0;r<he.MAX_SLOTS;++r)this._slots[r]=[]}normalizeCtorArgs(){return{}}add(e,r,i){const s=()=>{if(i?.aborted)throw r.uninitializeRenderContext(),kr();this._renderPlugins.push(r);for(const o of e)this._slots[o].push(r);this._context.requestRender()},n=r.initializeRenderContext(this._context,i);if(Iu(n))return n.then(s);s(),this.notifyChange("_renderPlugins")}remove(e){if(this._renderPlugins.removeUnordered(e)!=null){for(let r=0;r<this._slots.length;++r)this._slots[r]=this._slots[r].filter(i=>i!==e);e.uninitializeRenderContext(),this._context.requestRender(),this.notifyChange("_renderPlugins")}}prepareRender(){this._renderPlugins.forAll(e=>{e.prepareRender&&e.prepareRender(this._context.renderContext)})}updateAnimation(e){let r=!1;return this._renderPlugins.forAll(i=>{i.updateAnimation&&(r=i.updateAnimation(e)||r)}),r}prepareSlots(e){for(const r of e)this._context.renderContext.bindParameters.slot=r,this._slots[r].filter(i=>{i.canRender&&(tde(i)&&i.prepareTechnique(this._context.renderContext),rde(i)&&i.prepareTechniques(this._context.renderContext))})}render(){const e=this._slots[this._context.renderContext.bindParameters.slot],r=new Array;e.filter(i=>{if(!i.canRender)return!1;if(tde(i)){const s=i.prepareTechnique(this._context.renderContext);return s!=null&&(r.push(s),!0)}if(rde(i)){const s=i.prepareTechniques(this._context.renderContext);return s!=null&&(r.push(s),!0)}return r.push(null),!0}).forEach((i,s)=>i.render(this._context.renderContext,r[s]))}queryDepthRange(e){const r=nwt;return r.near=1/0,r.far=-1/0,this._renderPlugins.forAll(i=>{if(i.queryDepthRange){const s=i.queryDepthRange(e);s&&IE(r,s,r)}}),r}get updating(){return this._renderPlugins.some(e=>e.running)}get needsTransparentPass(){return this._renderPlugins.some(e=>e.needsTransparentPass)}get needsHighlight(){return this._renderPlugins.some(e=>e.needsHighlight)}get needsLinearDepth(){return this._renderPlugins.some(e=>e.needsLinearDepth)}get needsLaserlineWithContrastControl(){const e=this._slots[he.LASERLINES_CONTRAST_CONTROL];return!!e&&e.length>0}get renderOccludedFlags(){return this._renderPlugins.reduce((e,r)=>e|r.renderOccludedFlags,Di.None)}};function tde(t){return"prepareTechnique"in t}function rde(t){return"prepareTechniques"in t}u([d()],nO.prototype,"_renderPlugins",void 0),u([d({readOnly:!0})],nO.prototype,"updating",null),nO=u([P("esri.views.3d.webgl-engine.lib.RenderPluginManager")],nO);const nwt={near:0,far:0};let rMe=class extends kQ{};const s8=255,owt=1/s8;function awt(t){const e=new Sr,r=e.fragment;return r.include(Nc),r.include(Ru),e.include(zU),e.include(Zh),e.include(kU,t),r.uniforms.add(new et("depthMap",i=>i.linearDepthTexture),new Fi("inverseViewMatrix",(i,s)=>Mn(ide,Fl(ide,s.camera.viewMatrix,s.camera.center))),new Ar("nearFar",(i,s)=>s.camera.nearFar)),r.constants.add("sampleValue","float",owt),r.code.add(w`void main(void) {
float depth = rgba2float(texture(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
fragColor = vec4(sampleValue);
}`),e}const ide=be(),lwt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastAccumulatePassParameters:rMe,ShadowCastMaxSamples:s8,build:awt},Symbol.toStringTag,{value:"Module"}));var Xw;(function(t){t[t.Gradient=0]="Gradient",t[t.Threshold=1]="Threshold",t[t.COUNT=2]="COUNT"})(Xw||(Xw={}));let MW=class extends va{constructor(){super(...arguments),this.visualization=Xw.Gradient,this.bandsEnabled=!1}};u([B({count:Xw.COUNT})],MW.prototype,"visualization",void 0),u([B()],MW.prototype,"bandsEnabled",void 0);let iMe=class extends ri{constructor(e){super(),this._data=e,this.sampleScale=0,this.opacityFromElevation=1,this.color=UM(cwt),this.bandSize=.1,this.threshold=.5}get shadowCastMap(){return this._data.shadowCastTexture}};const cwt=Nt(.01,0,.25,1);function uwt(t){const e=new Sr,r=e.fragment;r.include(Nc),r.include(Ru),e.include(zU),e.include(Zh);const{visualization:i,bandsEnabled:s}=t;r.constants.add("inverseSampleValue","float",s8),r.uniforms.add(new et("shadowCastMap",a=>a.shadowCastMap),new Pe("sampleScale",a=>a.sampleScale),new Pe("opacityFromElevation",a=>a.opacityFromElevation),new nr("uColor",a=>a.color));const n=i===Xw.Gradient,o=i===Xw.Threshold;return n&&s?r.uniforms.add(new Pe("bandSize",a=>a.bandSize)):o&&r.uniforms.add(new Pe("threshold",a=>a.threshold)),r.code.add(w`
      void main(void) {
        vec4 record = texture(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${o?w`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${n&&s?w`strength = ceil(strength / bandSize) * bandSize;`:""}

        fragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${n?w`* strength`:""});
      }
    `),e}const hwt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:iMe,build:uwt},Symbol.toStringTag,{value:"Module"}));let sMe=class nMe extends Lr{constructor(e,r){super(e,r,()=>this.destroy())}initializeProgram(e){return new Rr(e.rctx,nMe.shader.get().build(this.configuration),Tr)}initializePipeline(){return Mt({blending:xu,colorWrite:Gt,depthTest:null,depthWrite:null})}get primitiveType(){return At.TRIANGLE_STRIP}};sMe.shader=new Or(hwt,()=>ce(()=>import("./ShadowCastVisualize.glsl-8adaf2e6.js"),[],import.meta.url));const dwt=4e4,pwt=5e4,oMe=1/512;let PN=class extends we{constructor(e,r,i,s){super({}),this._techniqueRepository=e,this._rctx=r,this._data=i,this._requestRender=s,this._passParameters=new iMe(this._data),this._techniqueConfig=new MW,this._enabled=!1,this._vao=kl(r),this._techniqueConfig.visualization=Xw.Gradient}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=Ve(this._vao),this._techniqueRepository.release(this._technique),this._technique=null}get _visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(sMe,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._showVisualization)return;this._passParameters.sampleScale=1/this._data.computedSamples;const r=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(r,this._passParameters,e),this._rctx.drawArrays(r.primitiveType,0,zo(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&this._data.computedSamples>0&&this.opacityFromElevation>oMe}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const r=this._passParameters.color;a2(e,r)||(Oh(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};u([d()],PN.prototype,"opacityFromElevation",null),PN=u([P("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],PN);let IK=class extends va{constructor(){super(...arguments),this.receiveShadows=!0}};u([B()],IK.prototype,"receiveShadows",void 0);let aMe=class lMe extends Lr{constructor(e){super(e,new IK,()=>this.destroy())}initializeProgram(e){return new Rr(e.rctx,lMe.shader.get().build(this.configuration),Tr)}initializePipeline(){return Mt({blending:Eo(xe.ONE,xe.ONE,xe.ONE,xe.ONE),colorWrite:Gt,depthTest:null,depthWrite:null})}get primitiveType(){return At.TRIANGLE_STRIP}};aMe.shader=new Or(lwt,()=>ce(()=>import("./ShadowCastAccumulate.glsl-b319777b.js"),[],import.meta.url));let wl=class extends we{constructor(e,r,i,s,n,o){super({}),this._rctx=e,this._stage=i,this._prepareForShadowMapPass=s,this._renderToShadowMap=n,this._requestRender=o,this._progress=0,this._sampleCount=0,this._passParameters=new rMe,this._cachedLightDirections=[],this._depthRange=xW,this._previewing=!1,this._handles=new Ii,this._cameraForcedForScreenshot=!1,this._bindParameters=new iU(new FQ(e,i.viewingMode),null,null),this._bindParameters.shadowMap.enabled=!0,this._vao=kl(e),this._accumulationRenderer=new PN(r,e,this,o);const a=this._stage.view.resourceController.scheduler;this._handles.add([a.registerTask(vt.SHADOW_ACCUMULATOR,this),ae(()=>i.renderView,l=>{this._handles.remove(sde),l!=null&&this._handles.add(l.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),sde)},Is),ae(()=>this._previewing,()=>this._requestRenderIfEnabled(),qr)])}normalizeCtorArgs(){return{}}dispose(){this._disable(),this._handles.destroy(),this._accumulationRenderer=Ve(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=Ve(this._fbo),this._vao=Ve(this._vao),this._accumulationTechniqueCached=Bi(this._accumulationTechniqueCached),this._cachedLightDirections.length=0,this._sampleCount=0}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo?.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _accumulationTechnique(){if(this._accumulationTechniqueCached==null){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechniqueCached=new aMe(e)}return this._accumulationTechniqueCached}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._fbo!=null&&this._sampleCount>0}get canAccumulate(){return this._passParameters.linearDepthTexture!==null&&this._depthRange!==xW&&this._opacityFromElevation>oMe}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const r=this._cachedLightDirections;if(ry(r,e,X_))return;const i=Math.min(s8,e.length);r.length=i,this._sampleCount=i;for(let s=0;s<i;++s)r[s]=re(r[s]??O(),e[s]);this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,r,i,s){if(this._depthRange=r,this._updateCamera(i),this._bindParameters.contentCamera=s,this._passParameters.linearDepthTexture=e,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const n=this._cameraForcedForScreenshot?this._sampleCount:Math.min(fwt,this._sampleCount-this._progress);for(let o=0;o<n;++o)this._accumulateShadow();this._cameraForcedForScreenshot=!1,this._requestRender()}render(e){this._accumulationRenderer.render(e)}setOptions(e){if(e.enabled!==void 0){const r=this._fbo!=null;e.enabled!==r&&(e.enabled?this._enable():this._disable())}e.previewing!==void 0&&(this._previewing=e.previewing),e.lightDirections!==void 0&&(this._lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}readAccumulatedShadow(e,r){return!this._isActive||!this._fbo||this._progress<1||e<0||e>=this._fbo.width||r<0||r>=this._fbo.height?0:(this._fbo.readPixels(e,r,1,1,Ct.RGBA,Gs.UNSIGNED_BYTE,nde),nde[0]/this._progress)}_enable(){this._progress=0;const e=new xr;e.wrapMode=Dt.CLAMP_TO_EDGE,this._fbo=new hn(this._rctx,e)}_disable(){this._fbo=Ve(this._fbo)}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(Ti.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._sampleLightDirection(),this._depthRange);const e=this._accumulationTechnique;this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(e,this._passParameters,this._bindParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(e.primitiveType,0,zo(this._vao,"geometry"))}_sampleLightDirection(){return this._progress++,this._lightDirections[this._progress*mwt%this._lightDirections.length]}_updateCamera(e){!e.equals(this._bindParameters.camera)&&this._fbo&&(this._bindParameters.camera.copyFrom(e),this._fbo.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-bR(dwt,pwt,e.relativeElevation))}_requestRenderIfEnabled(){this._fbo&&this._requestRender()}get test(){const e=this;return{lightDirections:this._lightDirections,get isDone(){return e._isDoneAccumulating},get isActive(){return e._isActive}}}};u([d()],wl.prototype,"_progress",void 0),u([d()],wl.prototype,"_sampleCount",void 0),u([d()],wl.prototype,"_fbo",void 0),u([d()],wl.prototype,"_depthRange",void 0),u([d()],wl.prototype,"_previewing",void 0),u([d()],wl.prototype,"_accumulationRenderer",void 0),u([d()],wl.prototype,"_isRefining",null),u([d()],wl.prototype,"_isActive",null),u([d()],wl.prototype,"canAccumulate",null),u([d()],wl.prototype,"_isDoneAccumulating",null),u([d()],wl.prototype,"_opacityFromElevation",null),u([d()],wl.prototype,"running",null),wl=u([P("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],wl);const fwt=6,sde="renderView",mwt=104729,nde=new Uint8Array(4),ode={highlightedThreshold:.99999,selfShadowThreshold:.025};function gwt(t){const e=new Sr;e.include(Gw,t);const r=e.fragment;return r.include(Nc),r.include(Ru),e.include(zU),e.include(Zh),r.uniforms.add(new et("defaultDepthTex",(i,s)=>s.shadowMap.getSnapshot(RE.Default)),new et("highlightDepthTex",(i,s)=>s.shadowMap.getSnapshot(RE.Highlight)),new et("depthMap",(i,s)=>s.linearDepthTexture),new et("highlightMap",(i,s)=>s.highlightColorTexture),new nr("uColor",i=>i.shadowColor),new Ar("nearFar",(i,s)=>s.camera.nearFar),new Pe("opacity",i=>i.shadowOpacity),new Pe("occludedOpacity",i=>i.occludedShadowOpacity),new Pe("terminationFactor",i=>i.opacityElevation*i.dayNightTerminator),new zt("lightingMainDirectionView",(i,s)=>ye(lde,Fe(lde,s.lighting.mainLight.direction,s.camera.viewInverseTransposeMatrix))),new Ar("texelSize",(i,s)=>s.linearDepthTexture!=null?ar(ywt,1/s.linearDepthTexture.descriptor.width,1/s.linearDepthTexture.descriptor.height):Tp),new Fi("inverseViewMatrix",(i,s)=>Mn(ade,Fl(ade,s.camera.viewMatrix,s.camera.center)))),r.constants.add("unoccludedHighlightFlag","vec4",_Ee).add("highlightedThreshold","float",ode.highlightedThreshold).add("selfShadowThreshold","float",ode.selfShadowThreshold),r.code.add(w`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`),r.code.add(w`void main(void) {
vec4 highlightInfo = texture(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
fragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`),e}const ade=be(),lde=O(),ywt=Ge(),_wt=Object.freeze(Object.defineProperty({__proto__:null,build:gwt},Symbol.toStringTag,{value:"Module"}));let vwt=class extends kQ{constructor(){super(...arguments),this.shadowColor=Nt(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}},cMe=class uMe extends Lr{constructor(e){super(e,new IK,()=>this.destroy())}initializeProgram(e){return new Rr(e.rctx,uMe.shader.get().build(this.configuration),Tr)}initializePipeline(){return Mt({blending:Eo(xe.SRC_ALPHA,xe.ONE,xe.ONE_MINUS_SRC_ALPHA,xe.ONE_MINUS_SRC_ALPHA),colorWrite:Gt,depthTest:null,depthWrite:null})}get primitiveType(){return At.TRIANGLE_STRIP}};cMe.shader=new Or(_wt,()=>ce(()=>import("./ShadowHighlight.glsl-30159b3a.js"),[],import.meta.url));const bwt=.001953125,wwt=4e4,xwt=5e4;let Twt=class{constructor(e,r){this._rctx=e,this._viewingMode=r,this._maxOpacity=1,this._passParameters=new vwt,this._drawParameters=new dct,this._vao=kl(this._rctx)}get _technique(){return this._techniqueCached==null&&(this._techniqueCached=new cMe({rctx:this._rctx,viewingMode:this._viewingMode})),this._techniqueCached}render(e,r){if(!e.shadowMap.enabled||!e.linearDepthTexture||!this.isVisible)return;const i=this._technique;this._drawParameters.origin=e.camera.center,this._rctx.bindFramebuffer(r),this._rctx.bindTechnique(i,this._passParameters,e).bindDraw(this._drawParameters,e,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(i.primitiveType,0,zo(this._vao,"geometry"))}get gpuMemoryUsage(){return this._vao?.memoryEstimate??0}setDefaultOptions(e){this._passParameters={...this._passParameters,...e},this._updateMaxOpacity()}updateParameters(e,r){this._passParameters.opacityElevation=1-bR(wwt,xwt,e.relativeElevation);const i=this._viewingMode===Ue.Global?ye(cde,e.center):se(cde,0,0,1),s=fe(i,r);this._passParameters.dayNightTerminator=bR(0,1,ve(30*s,0,1))}dispose(){this._vao=Ve(this._vao),this._techniqueCached=Bi(this._techniqueCached)}get isVisible(){const{opacityElevation:e,dayNightTerminator:r}=this._passParameters;return this._maxOpacity*e*r>=bwt}_updateMaxOpacity(){const e=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=e*this._passParameters.shadowColor[3]}};const cde=O(),ude=Ey();let Swt=class{constructor(){this._plane=Ey()}get isEnabled(){return!Rwe(this.plane,ude)}get plane(){return this._plane}set plane(e){fx(e||ude,this._plane)}},Ewt=class extends ri{};function uM(t){t.uniforms.add(new nr("resolution",e=>{const{descriptor:r}=e.colorTexture,i=r.width,s=r.height;return xi(Cwt,1/i,1/s,i,s)}))}const Cwt=Xt(),RT={maxSearchSteps:8,maxDistanceAreaTex:16};function Awt(){const t=new Sr,{attributes:e,varyings:r,vertex:i,fragment:s}=t;return e.add(C.POSITION,"vec2"),r.add("uv","vec2"),r.add("offsets[2]","vec4"),r.add("maxOffset","vec4"),r.add("pixelCoord","vec2"),uM(i),i.code.add(w`
      void main() {
        uv = position * 0.5 + vec2(0.5);
        gl_Position = vec4(position, 0, 1);

        pixelCoord = uv * resolution.zw;
        offsets[0] = uv.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        offsets[1] = uv.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        maxOffset = vec4( offsets[0].xz, offsets[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${w.int(RT.maxSearchSteps)} );
      }
    `),s.uniforms.add(new et("edgesTexture",n=>n.edges.colorTexture)),s.uniforms.add(new et("areaTexture",n=>n.areaTexture)),s.uniforms.add(new et("searchTexture",n=>n.searchTexture)),uM(s),s.code.add(w`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 sampleLevelZeroOffset(sampler2D tex, vec2 coord, vec2 offset) {
        return texture(tex, coord + offset.x * resolution.xy, 0.0);
      }

      float searchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
        e.r = bias + e.r * scale;
        return 255.0 * texture( searchTex, e, 0.0 ).r;
      }

      float searchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${w.int(RT.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * searchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float searchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${w.int(RT.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * searchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float searchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${w.int(RT.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * searchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float searchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${w.int(RT.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * searchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 getArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${w.int(RT.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture( areaTex, texcoord, 0.0 ).rg;
      }

      void main() {
        ivec4 subsampleIndices = ivec4(0.0);
        vec4 weights = vec4(0.0);
        vec2 e = texture( edgesTexture, uv ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = searchXLeft( edgesTexture, searchTexture, offsets[0].xy, maxOffset.x );
          coords.y = offsets[1].y;
          d.x = coords.x;
          float e1 = texture( edgesTexture, coords, 0.0 ).r;
          coords.x = searchXRight( edgesTexture, searchTexture, offsets[0].zw, maxOffset.y );
          d.y = coords.x;
          d = d * resolution.z - pixelCoord.x;
          vec2 sqrt_d = sqrt( abs(d) );
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = searchYUp( edgesTexture, searchTexture, offsets[1].xy, maxOffset.z );
          coords.x = offsets[0].x;
          d.x = coords.y;
          float e1 = texture( edgesTexture, coords, 0.0 ).g;
          coords.y = searchYDown( edgesTexture, searchTexture, offsets[1].zw, maxOffset.w );
          d.y = coords.y;
          d = d * resolution.w - pixelCoord.y;
          vec2 sqrt_d = sqrt(abs(d));
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2(0.0, 1.0)).g;
          weights.ba = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
        }
        fragColor = weights;
      }
    `),t}const Owt=Object.freeze(Object.defineProperty({__proto__:null,build:Awt},Symbol.toStringTag,{value:"Module"}));let hMe=class dMe extends Lr{initializeProgram(e){return new Rr(e.rctx,dMe.shader.get().build(),Tr)}initializePipeline(){return Mt({colorWrite:Gt})}};hMe.shader=new Or(Owt,()=>ce(()=>import("./BlendWeights.glsl-b938c73f.js"),[],import.meta.url));function Rwt(){const t=new Sr,{attributes:e,varyings:r,vertex:i,fragment:s}=t;return e.add(C.POSITION,"vec2"),r.add("uv","vec2"),r.add("offsets[2]","vec4"),uM(i),i.code.add(w`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}`),s.uniforms.add(new et("blendWeightsTexture",n=>n.blend.colorTexture),new et("colorTexture",n=>n.colorTexture)),uM(s),s.code.add(w`void main() {
vec4 a;
a.rb = texture(blendWeightsTexture, uv).rb;
a.g = texture(blendWeightsTexture, offsets[1].zw).g;
a.a = texture(blendWeightsTexture, offsets[1].xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
fragColor = texture( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture( colorTexture, uv, 0.0 );
vec4 Cop = texture( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
fragColor = mix(C, Cop, s);
}
}`),t}const Mwt=Object.freeze(Object.defineProperty({__proto__:null,build:Rwt},Symbol.toStringTag,{value:"Module"}));let pMe=class fMe extends Lr{initializeProgram(e){return new Rr(e.rctx,fMe.shader.get().build(),Tr)}initializePipeline(){return Mt({colorWrite:Gt})}};pMe.shader=new Or(Mwt,()=>ce(()=>import("./Blur.glsl-1a8d2363.js"),[],import.meta.url));const hde={threshold:.05,localConstrastAdaption:2};function Pwt(){const t=new Sr,{attributes:e,varyings:r,vertex:i,fragment:s}=t;return e.add(C.POSITION,"vec2"),uM(i),r.add("uv","vec2"),r.add("offsets[3]","vec4"),i.code.add(w`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
offsets[2] = uv.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}`),s.uniforms.add(new et("colorTexture",n=>n.colorTexture)),s.code.add(w`
    float absMax3(vec3 v) {
      vec3 t = abs(v);
      return max(max(t.r, t.g), t.b);
    }

    void main() {
      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture(colorTexture, uv).rgb;

      vec3 Cleft = texture(colorTexture, offsets[0].xy).rgb;
      delta.x = absMax3(C - Cleft);

      vec3 Ctop = texture(colorTexture, offsets[0].zw).rgb;
      delta.y = absMax3(C - Ctop);

      vec2 edges = step(vec2(${w.float(hde.threshold)}), delta.xy);

      // discard if there is no edge:
      if (dot(edges, vec2(1.0)) == 0.0) {
        discard;
      }

      // Calculate right and bottom deltas:
      vec3 Cright = texture(colorTexture, offsets[1].xy).rgb;
      delta.z = absMax3(C - Cright);

      vec3 Cbottom  = texture(colorTexture, offsets[1].zw).rgb;
      delta.w = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture(colorTexture, offsets[2].xy).rgb;
      delta.z = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture(colorTexture, offsets[2].zw).rgb;
      delta.w = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, delta.z), delta.w);

      // Local contrast adaptation in action:
      edges.xy *= step(maxDelta, float(${w.float(hde.localConstrastAdaption)}) * delta.xy);

      fragColor = vec4(edges, 0.0, 0.0);
    }
  `),t}const Iwt=Object.freeze(Object.defineProperty({__proto__:null,build:Pwt},Symbol.toStringTag,{value:"Module"}));let mMe=class gMe extends Lr{initializeProgram(e){return new Rr(e.rctx,gMe.shader.get().build(),Tr)}initializePipeline(){return Mt({colorWrite:Gt})}};mMe.shader=new Or(Iwt,()=>ce(()=>import("./EdgeDetect.glsl-ddc54140.js"),[],import.meta.url));let oO=class extends we{constructor(e,r){super({}),this._rctx=e,this._techniqueRep=r,this._passParameters=new Ewt,this._isEnabled=!1}normalizeCtorArgs(){return{}}dispose(){this._abortController=Ll(this._abortController),this.disable()}_loadResources(e){if(this._abortController!=null)return!1;if(this._passParameters.searchTexture!=null)return!0;this._abortController=new AbortController;const r=this._abortController.signal;return ce(()=>import("./SmaaRenderPassData-660b7d34.js"),[],import.meta.url).then(i=>this._loadTextures(i,r)).then(()=>e()).finally(()=>this._abortController=null),!1}_loadTextures(e,r){return Yt(r),Promise.all([this._loadTextureFromBase64(e.areaTexture,Rt.LINEAR,Ct.RGB),this._loadTextureFromBase64(e.searchTexure,Rt.NEAREST,Ct.LUMINANCE)]).then(([i,s])=>{An(r)?(i.dispose(),s.dispose(),Yt(r)):(this._passParameters.areaTexture=i,this._passParameters.searchTexture=s)})}get updating(){return this._abortController!=null}enable(e){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const s=new va;this._edgeDetectTechnique=this._techniqueRep.releaseAndAcquire(mMe,s,this._edgeDetectTechnique),this._blendWeightsTechnique=this._techniqueRep.releaseAndAcquire(hMe,s,this._blendWeightsTechnique),this._blurTechnique=this._techniqueRep.releaseAndAcquire(pMe,s,this._blurTechnique)}if(!this._loadResources(e))return!1;this._vao=wJe(this._rctx);const r=new xr(4,4);r.pixelFormat=Ct.RG,r.internalFormat=Je.RG8,r.wrapMode=Dt.CLAMP_TO_EDGE,this._passParameters.edges=new hn(this._rctx,r);const i=new xr(4,4);return i.pixelFormat=Ct.RGBA,i.wrapMode=Dt.CLAMP_TO_EDGE,this._passParameters.blend=new hn(this._rctx,i),this._isEnabled=!0,!0}disable(){this._isEnabled&&(this._vao=Ve(this._vao),this._passParameters.areaTexture=Ve(this._passParameters.areaTexture),this._passParameters.searchTexture=Ve(this._passParameters.searchTexture),this._passParameters.blend=Ve(this._passParameters.blend),this._passParameters.edges=Ve(this._passParameters.edges),this._isEnabled=!1)}get _validPassParameters(){return this._isEnabled?this._passParameters:null}render(e){const r=this._validPassParameters;if(r==null)return;r.colorTexture=e;const i=this._rctx,s=i.getBoundFramebufferObject(),n=e.descriptor.width,o=e.descriptor.height;i.bindVAO(this._vao),i.setViewport(0,0,n,o),r.edges.resize(n,o),i.bindFramebuffer(r.edges),i.setClearColor(0,0,0,1),i.clear(Ti.COLOR_BUFFER_BIT),i.bindTechnique(this._edgeDetectTechnique,r,null),i.drawArrays(At.TRIANGLES,0,3),r.blend.resize(n,o),i.bindFramebuffer(r.blend),i.setClearColor(0,0,1,1),i.clear(Ti.COLOR_BUFFER_BIT),i.bindTechnique(this._blendWeightsTechnique,r,null),i.drawArrays(At.TRIANGLES,0,3),i.bindFramebuffer(s),i.setClearColor(0,1,0,1),i.clear(Ti.COLOR_BUFFER_BIT),i.bindTechnique(this._blurTechnique,r,null),i.drawArrays(At.TRIANGLES,0,3)}_loadTextureFromBase64(e,r,i){return yy(e).then(s=>{const n=new xr;return n.pixelFormat=i,n.wrapMode=Dt.CLAMP_TO_EDGE,n.width=s.width,n.height=s.height,n.samplingMode=r,new Ot(this._rctx,n,s)})}};u([d()],oO.prototype,"_abortController",void 0),u([d({readOnly:!0})],oO.prototype,"updating",null),oO=u([P("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],oO);function $wt(t,e){const r=-t[0],i=-t[1],s=-t[2],n=e[3],o=e[7],a=e[11],l=e[15];e[0]+=n*r,e[1]+=n*i,e[2]+=n*s,e[4]+=o*r,e[5]+=o*i,e[6]+=o*s,e[8]+=a*r,e[9]+=a*i,e[10]+=a*s,e[12]+=l*r,e[13]+=l*i,e[14]+=l*s}function Lwt(t,e){const r=t[0],i=t[1],s=t[2];e[12]+=r*e[0]+i*e[4]+s*e[8],e[13]+=r*e[1]+i*e[5]+s*e[9],e[14]+=r*e[2]+i*e[6]+s*e[10],e[14]+=r*e[3]+i*e[7]+s*e[11]}let Dwt=class{constructor(e){this._factory=e,this._originData=new Map}acquire(e){return this.register(this._factory.getOrigin(e))}register(e){const r=this._originData.get(e.id)||new Nwt(e);return r.refCount++,this._originData.has(r.origin.id)||this._originData.set(r.origin.id,r),r}release(e){e.refCount--,e.refCount===0&&this._originData.delete(e.origin.id)}updateViewMatrices(e){this._originData.forEach(r=>{Us(r.viewMatrix,e),Lwt(r.origin.vec3,r.viewMatrix)})}},Nwt=class{constructor(e){this.origin=e,this.refCount=0,this.viewMatrix=be()}},Fwt=class extends DTe{constructor(e,r){super(),this.distanceFalloffFactor=e,this.transparency=r,this.transformNormalViewFromGlobal=Ui()}},Uwt=class extends NTe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Ui(),this.slicePlaneLocalOrigin=O(),this.transformNormalGlobalFromModel=Ui()}};function kwt(t){const e=w`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;t.code.add(e)}const zwt=fr(.5,-4e-4);function Vwt(t,e){const r=t.vertex;r.include(kwt),r.constants.add("depthBias","vec2",zwt),r.uniforms.add(new Ar("inverseViewport",(i,s)=>s.inverseViewport)),e.legacy?(r.uniforms.add(new Fi("proj",(i,s)=>s.camera.projectionMatrix)),r.code.add(w`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(r.uniforms.add(new Yh("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal),new Fi("transformProjFromView",i=>i.transformProjFromView)),r.code.add(w`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)),r.code.add(w`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}function Bwt(t,e){const r=t.fragment;r.constants.add("coverageTestThreshold","float",.01),e.antialiasing?r.code.add(w`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):r.code.add(w`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)}function Gwt(t,e){const r=t.vertex;e.silhouette?(r.code.add(w`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),e.legacy?r.code.add(w`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):r.code.add(w`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):r.code.add(w`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)}function jwt(t,e){const r=t.vertex;r.include(Nc),r.uniforms.add(new Pe("distanceFalloffFactor",i=>i.distanceFalloffFactor)),r.code.add(w`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),r.uniforms.add(new Ih("componentDataTex",i=>i.componentDataTexture)),t.attributes.add(C.COMPONENTINDEX,"float"),r.constants.add("componentColorFieldOffset","float",0),r.constants.add("componentOtherFieldOffset","float",1),r.constants.add("componentVerticalOffsetFieldOffset","float",2),r.constants.add("componentFieldCount","float",3),r.constants.add("lineWidthFractionFactor","float",8),r.constants.add("extensionLengthOffset","float",128),r.constants.add("verticalOffsetScale","float",2*OK),r.code.add(w`vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
float texSize = float(textureSize(componentDataTex, 0).x);
float colIndex = mod(fieldIndex, texSize);
float rowIndex = floor(fieldIndex / texSize);
return vec2(colIndex, rowIndex) + 0.5;
}
struct ComponentData {
vec4 color;
float lineWidth;
float extensionLength;
float type;
float verticalOffset;
};
ComponentData readComponentData() {
vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
vec4 colorValue = texelFetch(componentDataTex, ivec2(colorIndex), 0);
vec4 otherValue = texelFetch(componentDataTex, ivec2(otherIndex), 0);
float verticalOffset = (rgba2float(texelFetch(componentDataTex, ivec2(verticalOffsetIndex), 0)) - 0.5) * verticalOffsetScale;
return ComponentData(
vec4(colorValue.rgb, colorValue.a * otherValue.w),
otherValue.x * (255.0 / lineWidthFractionFactor),
otherValue.y * 255.0 - extensionLengthOffset,
-(otherValue.z * 255.0) + 0.5,
verticalOffset
);
}`),e.legacy?r.code.add(w`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(r.uniforms.add(new VR("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel)),r.code.add(w`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),e.silhouette?(t.attributes.add(C.NORMALA,"vec3"),t.attributes.add(C.NORMALB,"vec3"),r.code.add(w`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(t.attributes.add(C.NORMAL,"vec3"),r.code.add(w`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`)),e.legacy?r.code.add(w`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(r.include(oF,e),r.include(oF,e),r.uniforms.add(new Yh("transformViewFromCameraRelativeRS",i=>i.transformViewFromCameraRelativeRS),new VR("transformWorldFromModelRS",i=>i.transformWorldFromModelRS),new wu("transformWorldFromModelTL",i=>i.transformWorldFromModelTL),new wu("transformWorldFromModelTH",i=>i.transformWorldFromModelTH),new zt("transformWorldFromViewTL",i=>i.transformWorldFromViewTL),new zt("transformWorldFromViewTH",i=>i.transformWorldFromViewTH)),r.code.add(w`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${e.spherical?w`normalize(transformWorldFromModelTL + rotatedModelPosition);`:w`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),r.uniforms.add(new Fi("transformProjFromView",(i,s)=>s.camera.projectionMatrix)),r.code.add(w`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),r.code.add(w`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function Hwt(t){return t.mode===ln.SKETCH||t.mode===ln.MIXED}var ln,Db;(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH",t[t.MIXED=2]="MIXED",t[t.COUNT=3]="COUNT"})(ln||(ln={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.SILHOUETTE=1]="SILHOUETTE"}(Db||(Db={}));function $K(t,e){const r=t.vertex;switch(t.attributes.add(C.SIDENESS,"vec2"),e.mode===ln.MIXED?r.code.add(w`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):r.code.add(w`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),e.mode){case ln.MIXED:r.code.add(w`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case ln.SKETCH:r.code.add(w`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case ln.SOLID:r.code.add(w`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case ln.COUNT:break;default:e.mode}}function qwt(t,e){const r=t.vertex;switch(t.include($K,e),e.mode){case ln.SOLID:r.code.add(w`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case ln.SKETCH:r.uniforms.add(new cw("strokesAmplitude",i=>i.strokesTexture.amplitude)),r.code.add(w`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case ln.MIXED:r.uniforms.add(new cw("strokesAmplitude",i=>i.strokesTexture.amplitude)),r.code.add(w`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}}function Wwt(t,e){t.include($K,e);const{vertex:r,fragment:i}=t;switch(Hwt(e)&&(r.uniforms.add(new Ih("strokesTexture",s=>s.strokesTexture.texture)),r.uniforms.add(new cw("strokesLog2Resolution",s=>Math.log2(s.strokesTexture.resolution)),new cw("strokeVariants",s=>s.strokesTexture.variants)),t.varyings.add("vStrokeUV","vec2"),i.uniforms.add(new Ih("strokesTexture",s=>s.strokesTexture.texture),new cw("strokesNormalizationScale",s=>s.strokesTexture.normalizationScale)),r.code.add(w`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) / vec2(textureSize(strokesTexture, 0));
vStrokeUV.x += variantOffset;
}`),t.fragment.include(Nc),i.code.add(w`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),e.mode){case ln.SOLID:r.code.add(w`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),i.code.add(w`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case ln.SKETCH:r.code.add(w`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),i.code.add(w`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case ln.MIXED:t.varyings.add("vType","float"),r.code.add(w`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),i.code.add(w`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}function Xwt(t){const e=new Sr,{vertex:r,fragment:i}=e;return t.legacy&&r.uniforms.add(new dde("model"),new dde("localView")),e.include(Vwt,t),e.include(jwt,t),e.include(qwt,t),e.include($K,t),e.include(Wwt,t),e.include(ys,t),e.include(Gwt,t),e.include(Bwt,t),e.include(Mu,t),e.varyings.add("vColor","vec4"),e.varyings.add("vRadius","float"),e.varyings.add("vPosition","vec3"),e.varyings.add("vWorldPosition","vec3"),e.varyings.add("vViewPos","vec3"),e.varyings.add("vLineLengthPixels","float"),e.varyings.add("vSizeFalloffFactor","float"),r.uniforms.add(new Ar("pixelToNDC",(s,n)=>ar(Zwt,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new nr("viewport",(s,n)=>n.camera.fullViewport),new Pe("pixelRatio",(s,n)=>n.camera.pixelRatio)),e.attributes.add(C.POSITION0,"vec3"),e.attributes.add(C.POSITION1,"vec3"),e.attributes.add(C.VARIANTOFFSET,"float"),e.attributes.add(C.VARIANTSTROKE,"float"),e.attributes.add(C.VARIANTEXTENSION,"float"),r.code.add(w`
    const float opaqueCutoff = 1.0 / 255.0;

    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
      vec2 sideness = unpackedAttributes.sideness;
      vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

      vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;

      vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
      vViewPos = viewPos;

      vec4 projPosV0 = projFromViewPosition(viewPosV0);
      vec4 projPosV1 = projFromViewPosition(viewPosV1);
      vec4 projPos = projFromViewPosition(viewPos);

      vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
      vec2 ndcToPixel = viewport.zw * 0.5;
      vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
      float lineLengthPixels = length(screenSpaceLinePixels);

      float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
      vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;

      float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
      float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;

      float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
      float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;

      vSizeFalloffFactor = falloffFactor;

      float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
      float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;

      ${t.antialiasing?w`
        const float aaPaddingPixels = 1.0;

        // Line size with padding
        float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
        float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;`:w`
        float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
        float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;`}

      // Half line width in NDC including padding for anti aliasing
      vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
      vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
      vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;

      // Compute screen space position of vertex, offsetting for line size and end caps
      vec2 ndcOffset = (
          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
      );

      projPos.xy += ndcOffset * projPos.w;
      projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;

      projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));

      // Line length with end caps
      float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;

      float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;

      // Position in pixels with origin at first vertex of line segment
      vPosition = vec3(
        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
        pixelPositionAlongLine,
        pixelPositionAlongLine / extendedLineLengthPixels
      );

      // The line width radius in pixels
      vRadius = lineWidthPixels * 0.5;
      vLineLengthPixels = extendedLineLengthPixels;

      // discard short edges below a certain length threshold
      ${t.mode===ln.SKETCH?w`
        if (lineLengthPixels <= 3.0) {
          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
          return;
        }`:t.mode===ln.MIXED?w`
        if (lineLengthPixels <= 3.0 && unpackedAttributes.type <= 0.0) {
           gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
           return;
        }`:""}
      gl_Position = projPos;
    }

    void main() {
      ComponentData component = readComponentData();
      UnpackedAttributes unpackedAttributes = unpackAttributes(component);

      vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
      worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
      worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);

      // Component color
      vColor = component.color;

      // Discard fully transparent edges
      if (vColor.a < opaqueCutoff) {
        gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
        return;
      }

      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
        return;
      }

      // General geometric computation for all types of edges
      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);

      // Specific computation for different edge styles
      calculateStyleOutputs(unpackedAttributes);
    }
  `),i.code.add(w`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float positionX = position.x - calculateLineOffset();

      if (radius < 1.0) {
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);
        return vec2(0.5 - min(coverageX, coverageY), 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      fragColor = vec4(vColor.rgb, vColor.a * coverage);
    }
  `),e}const Zwt=Ge();let dde=class extends hs{constructor(e){super(e,"mat4")}};const Ywt=Object.freeze(Object.defineProperty({__proto__:null,build:Xwt},Symbol.toStringTag,{value:"Module"}));let yMe=class _Me extends Lr{initializeProgram(e){return new Rr(e.rctx,_Me.shader.get().build(this.configuration),ORe)}initializePipeline(e){return e.blendMinMax?Mt({blending:Eo(xe.ONE,xe.ONE,xe.ZERO,xe.ONE,dm.ADD,e.blendMinMax.MAX),depthTest:{func:ti.LEQUAL},colorWrite:Gt}):Mt({depthTest:{func:ti.LEQUAL},depthWrite:Ul,colorWrite:Gt})}};yMe.shader=new Or(Ywt,()=>ce(()=>import("./EdgeShader.glsl-6b336ad8.js"),[],import.meta.url));let wf=class extends Vo{constructor(){super(...arguments),this.mode=ln.SOLID,this.hasSlicePlane=!1,this.silhouette=!1,this.legacy=!1,this.antialiasing=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.spherical=!1}};u([B({count:ln.COUNT})],wf.prototype,"mode",void 0),u([B()],wf.prototype,"hasSlicePlane",void 0),u([B()],wf.prototype,"silhouette",void 0),u([B()],wf.prototype,"legacy",void 0),u([B()],wf.prototype,"antialiasing",void 0),u([B()],wf.prototype,"doublePrecisionRequiresObfuscation",void 0),u([B()],wf.prototype,"hasMultipassTerrain",void 0),u([B()],wf.prototype,"cullAboveGround",void 0),u([B()],wf.prototype,"spherical",void 0);const Jwt=8,Hz=128,Qwt={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0},Kwt={solid:ln.SOLID,sketch:ln.SKETCH,uber:ln.MIXED};let qz=class vMe{constructor(e,r,i){this._rctx=e,this._shaderTechniqueRepository=r,this._configuration=new wf,this.refCount=0,this._renderables=new Set,this._sortedRenderables={[Ht.TRANSPARENT]:{[Ht.TRANSPARENT]:new Bt,[Ht.OPAQUE]:new Bt},[Ht.OPAQUE]:{[Ht.TRANSPARENT]:new Bt,[Ht.OPAQUE]:new Bt}},this._renderablesDirty=!1,this._drawParameters=new Uwt,this._settings={...Qwt,...i},this.key=vMe.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);const s=this._settings.strokesTexture.variants;this.writerSettings={variants:s,reducedPrecision:ai.TESTS_DISABLE_OPTIMIZATIONS},this._configuration.legacy=this._settings.legacy,this._configuration.mode=Kwt[this._settings.type],this._configuration.silhouette=!1,this._configuration.antialiasing=!!this._rctx.capabilities.blendMinMax,this._configuration.hasSlicePlane=this._settings.hasSlicePlane,this._configuration.doublePrecisionRequiresObfuscation=e.driverTest.doublePrecisionRequiresObfuscation.result,this._configuration.spherical=i.spherical}dispose(){this._technique=Bi(this._technique)}addRenderable(e){this._renderables.add(e),this._renderablesDirty=!0}removeRenderable(e){this._renderables.delete(e),this._renderablesDirty=!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(e,r){if(this._renderablesDirty&&this._sortRenderables(),r!==Ht.INVISIBLE){const i=this._sortedRenderables[r];i[Ht.TRANSPARENT].forAll(e),i[Ht.OPAQUE].forAll(e)}}updateTechnique(e,r){return this._configuration.hasMultipassTerrain=!!e.multipassTerrain.enabled,this._configuration.cullAboveGround=!!e.multipassTerrain.cullAboveGround,this._configuration.silhouette=r,this._technique=this._shaderTechniqueRepository.releaseAndAcquire(yMe,this._configuration,this._technique),this._technique}bindRegularEdges(e,r){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(r,!1),e,r)}bindSilhouetteEdges(e,r){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(r,!0),e,r)}renderRegularEdges(e,r,i,s,n){this._render(e,r,r.regular.vao,i,s,n)}renderSilhouetteEdges(e,r,i,s,n){this._render(e,r,r.silhouette.vao,i,s,n)}_render(e,r,i,s,n,o){o>0&&(this._bindDraw(e,r,s,n),this._rctx.bindVAO(i),this._rctx.capabilities.instancing.drawArraysInstanced(At.TRIANGLE_FAN,0,4,o))}_bindDraw(e,r,i,s){if(this._drawParameters.componentDataTexture=r.components.buffer.textureBuffer.texture,this._drawParameters.strokesTexture=this._settings.strokesTexture,"origin"in r.transform)this._lastOriginId!==r.transform.origin.origin.id&&(e.setUniformMatrix4fv("localView",r.transform.origin.viewMatrix),this._lastOriginId=r.transform.origin.origin.id),e.setUniformMatrix4fv("model",r.transform.modelMatrix),this._drawParameters.slicePlaneLocalOrigin=r.transform.origin.origin.vec3;else{const n=new i8(r.transform.position),o=Bh(pde,dx(pde,r.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=n.low,this._drawParameters.transformWorldFromModelTH=n.high,this._drawParameters.transformWorldFromModelRS=r.transform.rotationScale,this._drawParameters.transformNormalGlobalFromModel=o;const a=s.camera.viewInverseTransposeMatrix;se(this._drawParameters.slicePlaneLocalOrigin,a[3],a[7],a[11])}e.bindDraw(this._drawParameters,s,i)}_sortRenderables(){this._renderablesDirty=!1,this._sortedRenderables[Ht.TRANSPARENT][Ht.TRANSPARENT].clear(),this._sortedRenderables[Ht.TRANSPARENT][Ht.OPAQUE].clear(),this._sortedRenderables[Ht.OPAQUE][Ht.TRANSPARENT].clear(),this._sortedRenderables[Ht.OPAQUE][Ht.OPAQUE].clear(),this._renderables.forEach(r=>{r.objectTransparency!==Ht.INVISIBLE&&r.edgeTransparency!==Ht.INVISIBLE&&this._sortedRenderables[r.objectTransparency][r.edgeTransparency].push(r)});const e=(r,i)=>"origin"in r.transform?"origin"in i.transform?r.transform.origin.origin.id<i.transform.origin.origin.id?-1:r.transform.origin.origin.id>i.transform.origin.origin.id?1:0:1:0;this._sortedRenderables[Ht.TRANSPARENT][Ht.TRANSPARENT].sort(e),this._sortedRenderables[Ht.TRANSPARENT][Ht.OPAQUE].sort(e),this._sortedRenderables[Ht.OPAQUE][Ht.TRANSPARENT].sort(e),this._sortedRenderables[Ht.OPAQUE][Ht.OPAQUE].sort(e)}static getKey(e,r,i){return`edges-t:${e}:${r}:${i}`}};const pde=$l();function Ajt(t,e){return e.push(t.buffer),{buffer:t.buffer,layout:new RQe(t.layout)}}function TL(t){return new QTe(t.layout).createView(t.buffer)}let ext=class extends wOe{constructor(e){super("EdgeProcessingWorker","extract",{extract:r=>[r.dataBuffer],extractComponentsEdgeLocations:r=>[r.dataBuffer],extractEdgeLocations:r=>[r.dataBuffer]},e)}async process(e,r,i){if(i)return q1t(e);const s=await this.invoke(new Wz(e),r);return this._unpackOutput(s)}async extractEdgeLocations(e,r){const i=await this.invokeMethod("extractEdgeLocations",new Wz(e),r);return TL(i)}async extractComponentsEdgeLocations(e,r){const i=await this.invokeMethod("extractComponentsEdgeLocations",new Wz(e),r);return TL(i)}_unpackOutput(e){return{regular:{instancesData:TL(e.regular.instancesData),lodInfo:{lengths:new Float32Array(e.regular.lodInfo.lengths)}},silhouette:{instancesData:TL(e.silhouette.instancesData),lodInfo:{lengths:new Float32Array(e.silhouette.lodInfo.lengths)}},averageEdgeLength:e.averageEdgeLength}}},Wz=class{constructor(e){this.dataBuffer=e.data.buffer,this.writerSettings=e.writerSettings,this.skipDeduplicate=e.skipDeduplicate,this.indices=vp(e.indices)?e.indices:e.indices.buffer,this.indicesType=vp(e.indices)?"Array":D5(e.indices)?"Uint32Array":"Uint16Array",this.indicesLength=e.indicesLength}};function txt(t){const r=SA.resolution,i=r/2,s=new Uint8Array(4*r*r),n=4*r*i,o=SA.amplitude,a=2*o,l=4*r,c=Math.log2(r)+1,h=SA.strokes.length;let p=(c-1)*h*l;for(const{distance:y,pressure:_}of SA.strokes){let v=y,b=_,T=p;for(let x=0;x<c;x++){x!==0&&(v=fde(v,hM.DISTANCE),b=fde(b,hM.PRESSURE));for(let S=0;S<SA.resolution;S++){const E=.5+(v?v[S%v.length]/a:0),A=b?b[S%b.length]:1;YR(E,s,T),YR(A,s,T+n),T+=4}T-=l*(h+1)}p+=l}const f=new xr;f.width=f.height=r;const m=new Ot(t,f,s);return new ixt(r,a,o,h,m)}function fde(t,e){if(!t)return null;const r=t.length/2,i=rxt*r,s=new Array(r);let n=0;const o=e===hM.PRESSURE;for(let a=0;a<t.length;a+=2){const l=(t[a]+t[a+1])/2;s[n++]=o?Math.min(i,1-(1-l)*mde):Math.min(i,l*mde)}return s}var hM;(function(t){t[t.DISTANCE=0]="DISTANCE",t[t.PRESSURE=1]="PRESSURE"})(hM||(hM={}));const rxt=.1,mde=.5;let ixt=class{constructor(e,r,i,s,n){this.resolution=e,this.normalizationScale=r,this.amplitude=i,this.variants=s,this.texture=n}dispose(){this.texture=Ve(this.texture)}};const SA={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};function gde(t){let e=null;for(const r of t){const i=r.type;if(sxt(r)){if(e==null)e=i;else if(e!==i)return"uber"}}return e??"uber"}function yde(t){let e=Ht.INVISIBLE;for(const{material:r}of t)if(bMe(r)){if(r.color[3]*r.opacity<1)return Ht.TRANSPARENT;e=Ht.OPAQUE}return e}function _de(t){let e=Ht.INVISIBLE;for(const{material:r}of t)if(bMe(r)){switch(r.objectTransparency){case Ht.TRANSPARENT:case Ht.INVISIBLE:return Ht.TRANSPARENT;case Ht.OPAQUE:if(r.opacity<1)return Ht.TRANSPARENT}e=Ht.OPAQUE}return e}function bMe(t){return t.size*t.color[3]*t.opacity>0}function sxt(t){return t.size*t.color[3]>0}function vde(t,e,r,i){for(let s=0;s<t.length;s++){const n=t[s].index,o=e[s],a=e[s+1];if(i)for(let l=o;l<a;l++){const c=i[l];r.set(c,n)}else for(let l=o;l<a;l++)r.set(l,n)}}let Dd=class extends we{constructor(t){super(t),this._updatingHandles=new Xf,this._perObjectData=new Map,this._perObjectDataEvictionCache=new Set,this._renderers=new Map,this._gpuMemoryUsage=0,this._workerAbort=new AbortController,this._tmpModelPosition=O(),this._localOrigins=new Dwt(new DQ(t.renderSR))}initialize(){this._worker=new ext(this.schedule),this._componentColorManager=new PRe(this.rctx,3);const t=CRe.createBuffer(4);for(let e=0;e<4;e++)t.sideness.set(e,0,e===0||e===3?0:1),t.sideness.set(e,1,e===0||e===1?0:1);this._verticesBufferObject=Ur.createVertex(this.rctx,Cr.STATIC_DRAW,t.buffer)}destroy(){this.destroyed||(this._perObjectData.forEach(t=>this._discardObjectEntry(t)),this._perObjectData.clear(),this._strokesTexture=Ve(this._strokesTexture),this._componentColorManager=$e(this._componentColorManager),this._workerAbort.abort(),this._worker.destroy(),this._verticesBufferObject=Ve(this._verticesBufferObject),this._renderers.clear(),this._updatingHandles.destroy(),this._set("schedule",uxt))}get updating(){return this._updatingHandles.updating}get usedMemory(){return this._gpuMemoryUsage}shouldRender(){return this._renderers.size>0}async addComponentObject(t,e,r,i,s,n,o,a){if(this.hasObject(t))return this.getObjectMemoryUsage(t);let l;const c=new wde(new Promise(p=>l=p),r.center,r.radius);this._perObjectData.set(t,c);const h=await this._updatingHandles.addPromise(this._addComponentGeometry(e,c,i,s,n,o,a));return this.setNeedsRender(),l(),h}async addOrUpdateObject3D(t,e,r,i){if(this.destroyed)return void Q.getLogger(this).warn("Attempt to add an object to a destroyed instance");const s=this._perObjectData.get(t);let n;s?.renderables.length>0&&this._perObjectDataEvictionCache.add(s);const o=t.boundingVolumeWorldSpace.bounds,a=new wde(new Promise(c=>n=c),o,qg(o));this._perObjectData.set(t,a);const l=new Array;if(r.mergeGeometries&&t.geometries.length>1&&nxt(t))l.push(this._addObjectMergedGeometries(t,a,e,r,i));else for(let c=0;c<t.geometries.length;c++){const h=t.geometries[c];h.material.supportsEdges&&l.push(this._addGeometry(t,a,h,e[0],r,i))}await this._updatingHandles.addPromise(Promise.all(l)),this._perObjectDataEvictionCache.delete(a),this._discardObjectEntry(s),this.setNeedsRender(),n()}_discardObjectEntry(t){t&&(t.renderables.length&&(t.renderables.forEach(e=>this._removeRenderable(e)),this.setNeedsRender()),t.loaded=null)}hasObject(t){return this._perObjectData.has(t)}async updateAllComponentOpacities(t,e){const r=await this._updatingHandles.addPromise(this._getObjectEntry(t));if(r==null)return;const i=e instanceof Array?s=>e[s]:()=>e;r.renderables.forEach(s=>{const n=s.components.meta.length;for(let o=0;o<n;o++){const a=i(o),l=s.components.meta[o],c=l.index;l.material.opacity=a,s.components.buffer.textureBuffer.setDataElement(c,1,3,255*a)}this._updateTransparency(s)}),this.setNeedsRender()}async getObjectMemoryUsage(t){const e=await this._getObjectEntry(t);return e!=null?e.renderables.reduce((r,i)=>r+i.statistics.gpuMemoryUsage,0):0}async updateAllComponentMaterials(t,e,r,i){const s=t instanceof Ny,n=!!r.hasSlicePlane,o=gde(e),a=qz.getKey(o,n,s),l=await this._updatingHandles.addPromise(this._getObjectEntry(t));l!=null&&(l.renderables.forEach(c=>{if(a!==c.rendererKey){const h=this._renderers.get(c.rendererKey),p=this._acquireRenderer(o,n,s);h.removeRenderable(c),--h.refCount,c.rendererKey=a,p.addRenderable(c)}for(let h=0;h<e.length;h++)c.components.meta[h].material=e[h];i&&this._updateComponentBuffer(c.components),this._updateTransparency(c)}),this.setNeedsRender())}async updateAllVerticalOffsets(t,e){const r=await this._updatingHandles.addPromise(this._getObjectEntry(t));r!=null&&(r.renderables.forEach(i=>{const s=i.components.meta;for(let n=0;n<s.length;n++)i.components.meta[n].verticalOffset=e?.[n]??0;this._updateComponentBuffer(i.components)}),this.setNeedsRender())}async updateObjectVisibility(t,e){const r=await this._updatingHandles.addPromise(this._getObjectEntry(t));r!=null&&(r.renderables.forEach(i=>i.visible=e),this.setNeedsRender())}removeObject(t){const e=this._perObjectData.get(t);e&&(this._perObjectData.delete(t),this._discardObjectEntry(e))}async _getObjectEntry(t){const e=this._perObjectData.get(t);if(!e)throw new Error("no object");return await e.loaded,e.loaded==null?null:e}render(t,e){if(this._componentColorManager==null)return;this._localOrigins.updateViewMatrices(t.camera.viewMatrix);const r=t.camera.viewInverseTransposeMatrix,i=O(),s=new i8;let n=0,o=0;if(this._renderers.forEach(l=>{if(l.refCount===0)this._renderers.delete(l.key),l.dispose();else{let c=!0,h=!0;l.forEachRenderable(p=>{p.visible&&(n+=p.statistics.averageEdgeLength,o++,c&&p.regular&&(l.updateTechnique(t,!1),c=!1),h&&p.silhouette&&(l.updateTechnique(t,!0),h=!1))},e)}}),this._componentColorManager.garbageCollect(),this._componentColorManager.updateTextures(),o===0)return;const a=new Fwt(40*n/o,e);se(i,r[3],r[7],r[11]),s.set(i),re(a.transformWorldFromViewTH,s.high),re(a.transformWorldFromViewTL,s.low),Vh(a.transformViewFromCameraRelativeRS,t.camera.viewMatrix),Bh(Ede,a.transformViewFromCameraRelativeRS),dx(a.transformNormalViewFromGlobal,Ede),a.transformProjFromView=t.camera.projectionMatrix,this._updateObjectCameraDistances(t),this._renderers.forEach(l=>{this._renderRegularEdges(l,t,a),this._renderSilhouetteEdges(l,t,a)})}_updateTransparency(t){const e=yde(t.components.meta),r=_de(t.components.meta);e===t.edgeTransparency&&r===t.objectTransparency||(t.edgeTransparency=e,t.objectTransparency=r,this._renderers.get(t.rendererKey).setRenderablesDirty())}_computeModelTransformWithLocalOrigin(t,e,r){t.getCombinedShaderTransformation(e,r);const i=e.localOrigin!=null?this._localOrigins.register(e.localOrigin):this._localOrigins.acquire(se(this._tmpModelPosition,r[12],r[13],r[14]));return e.localOrigin=i.origin,$wt(i.origin.vec3,r),i}_updateComponentBuffer(t){const{meta:e,buffer:r}=t,i=new Uint8Array(4);for(let s=0;s<e.length;s++){const n=e[s].material,o=e[s].index,a=ve(Math.round(n.size*Jwt),0,255),l=ve(n.extensionLength,-Hz,255-Hz)+Hz,c=n.type==="solid"?o5.SOLID:o5.SKETCH,h=255*n.opacity,p=n.color,f=255*p[0],m=255*p[1],y=255*p[2],_=255*p[3];r.textureBuffer.setData(o,0,f,m,y,_),r.textureBuffer.setData(o,1,a,l,c,h),xRe(e[s].verticalOffset,i),r.textureBuffer.setData(o,2,i[0],i[1],i[2],i[3])}}_createComponentBuffers(t){if(this._componentColorManager==null)return null;const e=new Array,r=this._componentColorManager.getBuffer(t.length);for(let s=0;s<t.length;s++){const n=t[s],o=r.acquireIndex();e.push({index:o,verticalOffset:0,material:n})}const i=new oxt(r,e);return this._updateComponentBuffer(i),i}_extractEdges(t,e,r,i,s,n=s.length){return this._worker.process({data:e,indices:s,indicesLength:n,writerSettings:t,skipDeduplicate:r},this._workerAbort.signal,i)}_createRenderable(t,e,r,i,s){const n=c=>this._verticesBufferObject!=null?new axt(new Rp(this.rctx,ORe,{vertices:D1t,instances:c===Db.REGULAR?s5.glLayout:n5.glLayout},{vertices:this._verticesBufferObject,instances:Ur.createVertex(this.rctx,Cr.STATIC_DRAW,c===Db.REGULAR?t.regular.instancesData.buffer:t.silhouette.instancesData.buffer)}),c===Db.REGULAR?t.regular.lodInfo:t.silhouette.lodInfo):null,o=t.regular.lodInfo.lengths.length>0?n(Db.REGULAR):null,a=t.silhouette.lodInfo.lengths.length>0?n(Db.SILHOUETTE):null,l=(o?.vao.memoryEstimate??0)+(a?.vao.memoryEstimate??0);return new cxt(o,a,{gpuMemoryUsage:l,externalMemoryUsage:s,averageEdgeLength:t.averageEdgeLength},r,yde(e.meta),_de(e.meta),e,i)}async _addGeometry(t,e,r,i,s,n){const o=r.vertexAttributes.get(C.POSITION),a=r.indices.get(C.POSITION),l=be(),c=this._computeModelTransformWithLocalOrigin(t,r,l),h=new Sde(o,a,l,c);return this._addPositionData(e,h,r.edgeIndicesLength,i,s,n)}async _addPositionData(t,e,r,i,s,n=!1){if(t.loaded==null)return;const o=this._createComponentBuffers([i]);if(o==null||r<=0)return;const a=this._acquireRenderer(i.type,!!s.hasSlicePlane,!0),{modelTransform:l,origin:c}=e,h=e.indices,p=e.position,f=p.data.length/p.size,m=r5.createBuffer(f);for(let v=0;v<f;v++)m.position.set(v,0,p.data[v*p.size]),m.position.set(v,1,p.data[v*p.size+1]),m.position.set(v,2,p.data[v*p.size+2]);vde(o.meta,[0,m.componentIndex.count],m.componentIndex);const y=await this._updatingHandles.addPromise(this._extractEdges(a.writerSettings,m,!1,n,h,r));if(t.loaded==null)return;const _=this._createRenderable(y,o,new lxt(l,c),a.key,!1);t.renderables.push(_),a.addRenderable(_),this._gpuMemoryUsage+=_.statistics.gpuMemoryUsage}async _addComponentGeometry(t,e,r,i,s,n,o){if(e.loaded==null)return 0;const a=this._createComponentBuffers(n);if(a==null)return 0;const l=gde(n),c=this._acquireRenderer(l,o.hasSlicePlane||!1,!1),h=r5.createBuffer(r.length/3);fP(h.position.typedBuffer,r,h.position.typedBufferStride,3),vde(a.meta,s,h.componentIndex,i);const p=!0,f=c.writerSettings,m=await this._updatingHandles.addPromise(this._extractEdges(f,h,p,!1,i));if(e.loaded==null)return 0;const y=this._createRenderable(m,a,t,c.key,!0);return e.renderables.push(y),c.addRenderable(y),y.statistics.gpuMemoryUsage}async _addObjectMergedGeometries(t,e,r,i,s){const n=new Map;let o=0,a=null,l=0;for(let b=0;b<t.geometries.length;b++){const T=t.geometries[b];if(!T.material.supportsEdges)continue;!a&&T.localOrigin&&(a=T);const x=T.vertexAttributes.get(C.POSITION);l+=x.data.length/x.size,o+=T.edgeIndicesLength}const c=l>=65536?Uint32Array:Uint16Array,h=o?new c(o):null,p=[];let f=0;for(let b=0;b<t.geometries.length;b++){const T=t.geometries[b];if(!T.material.supportsEdges)continue;const x=T.vertexAttributes.get(C.POSITION),S=T.indices.get(C.POSITION);let E=n.get(x.data);if(E==null){E=p.length/3;for(let A=0;A<x.data.length;A+=x.size)p.push(x.data[A]),p.push(x.data[A+1]),p.push(x.data[A+2]);n.set(x.data,E)}if(S)for(let A=0;A<T.edgeIndicesLength;A++)h[f++]=E+S[A]}const m=a||t.geometries[0],y=be(),_=this._computeModelTransformWithLocalOrigin(t,m,y);for(let b=0;b<t.geometries.length;b++)t.geometries[b].localOrigin=_.origin;const v=new Sde({data:p,size:3},h,y,_);await this._updatingHandles.addPromise(this._addPositionData(e,v,h.length,r[0],i,s))}_acquireRenderer(t,e,r){const i=qz.getKey(t,e,r);let s=this._renderers.get(i);return this._strokesTexture==null&&(this._strokesTexture=txt(this.rctx)),s||(s=new qz(this.rctx,this.techniqueRepository,{type:t,hasSlicePlane:e,strokesTexture:this._strokesTexture,legacy:r,spherical:this.viewingMode===Ue.Global}),this._renderers.set(i,s)),++s.refCount,s}_removeRenderable(t){bde(t.regular),bde(t.silhouette);const e=this._renderers.get(t.rendererKey);if(e){e.removeRenderable(t),--e.refCount,"origin"in t.transform&&this._localOrigins.release(t.transform.origin),this._gpuMemoryUsage-=t.statistics.externalMemoryUsage?0:t.statistics.gpuMemoryUsage;for(const r of t.components.meta)t.components.buffer.releaseIndex(r.index)}}_updateObjectCameraDistances(t){const e=t.camera.eye,r=t.camera.viewForward,i=O(),s=n=>{On(i,n.center,e);const o=fe(i,r),a=n.radius,l=o<-a?1/0:o<a?0:o-a;n.renderables.forEach(c=>c.distanceToCamera=l)};this._perObjectData.forEach(s),this._perObjectDataEvictionCache.forEach(s)}_renderRegularEdges(t,e,r){const i=t.bindRegularEdges(r,e),s=r.transparency,n=e.camera.perScreenPixelRatio;t.forEachRenderable(o=>{if(!xde(o)||!o.visible)return;const a=SL(o.regular.lod.lengths,o.distanceToCamera,n);t.renderRegularEdges(i,o,r,e,a)},s)}_renderSilhouetteEdges(t,e,r){const i=t.bindSilhouetteEdges(r,e),s=r.transparency,n=e.camera.perScreenPixelRatio;t.forEachRenderable(o=>{if(!Tde(o)||!o.visible)return;const a=SL(o.silhouette.lod.lengths,o.distanceToCamera,n);t.renderSilhouetteEdges(i,o,r,e,a)},s)}get test(){return{hasRenderedPrimitives:t=>{let e=!1;const r=t.perScreenPixelRatio,i=(s,n)=>s.forEachRenderable(o=>{o.visible&&!e&&(xde(o)&&(e=SL(o.regular.lod.lengths,o.distanceToCamera,r)>0),!e&&Tde(o)&&(e=SL(o.silhouette.lod.lengths,o.distanceToCamera,r)>0))},n);return this._renderers.forEach(s=>{e||(i(s,Ht.OPAQUE),i(s,Ht.TRANSPARENT))}),e}}}};function bde(t){t!=null&&(t.vao.vertexBuffers.instances.dispose(),t.vao.disposeVAOOnly(),t.vao=null)}function nxt(t){let e=null,r=null;for(let i=0;i<t.geometries.length;i++){const s=t.geometries[i];if(s.material.supportsEdges){if(e){if(!ry(e,s.transformation))return!1}else e=s.transformation;if(r||s.localOrigin==null){if(r&&r.localOrigin!=null&&s.localOrigin!=null&&r.localOrigin.id!==s.localOrigin.id)return!1}else r=s}}return!0}u([d({constructOnly:!0})],Dd.prototype,"rctx",void 0),u([d({constructOnly:!0})],Dd.prototype,"renderSR",void 0),u([d({constructOnly:!0})],Dd.prototype,"viewingMode",void 0),u([d({constructOnly:!0})],Dd.prototype,"techniqueRepository",void 0),u([d({constructOnly:!0})],Dd.prototype,"setNeedsRender",void 0),u([d({constructOnly:!0})],Dd.prototype,"schedule",void 0),u([d({readOnly:!0})],Dd.prototype,"_updatingHandles",void 0),u([d({readOnly:!0})],Dd.prototype,"updating",null),Dd=u([P("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],Dd);class wde{constructor(e,r,i){this.center=r,this.radius=i,this.renderables=new Array,this.loaded=e,this.loaded.then(()=>{this.loaded!=null&&(this.loaded=!0)})}}let oxt=class{constructor(e,r){this.buffer=e,this.meta=r}};class axt{constructor(e,r){this.vao=e,this.lod=r}}class lxt{constructor(e,r){this.modelMatrix=e,this.origin=r}}let cxt=class{constructor(e,r,i,s,n,o,a,l){this.regular=e,this.silhouette=r,this.statistics=i,this.transform=s,this.edgeTransparency=n,this.objectTransparency=o,this.components=a,this.rendererKey=l,this.distanceToCamera=0,this.visible=!0}};function xde(t){return t.regular!=null}function Tde(t){return t.silhouette!=null}function SL(t,e,r){const i=e*r,s=lfe(t,i,!0);return s===-1?i<t[0]?t.length:0:t.length-s}class Sde{constructor(e,r,i,s){this.position=e,this.indices=r,this.modelTransform=i,this.origin=s}}const Ede=Ui(),uxt=()=>Promise.reject();function Ip(t){return window.WebGL2RenderingContext&&t instanceof window.WebGL2RenderingContext}let Cde=class{constructor(e,r,i,s,n,o,a,l,c){this.createQuery=e,this.deleteQuery=r,this.resultAvailable=i,this.getResult=s,this.disjoint=n,this.beginTimeElapsed=o,this.endTimeElapsed=a,this.createTimestamp=l,this.timestampBits=c}},xg=!1;function hxt(t,e){if(e.disjointTimerQuery)return null;let r=t.getExtension("EXT_disjoint_timer_query_webgl2");return r&&Ip(t)?new Cde(()=>t.createQuery(),i=>{t.deleteQuery(i),xg=!1},i=>t.getQueryParameter(i,t.QUERY_RESULT_AVAILABLE),i=>t.getQueryParameter(i,t.QUERY_RESULT),()=>t.getParameter(r.GPU_DISJOINT_EXT),i=>{xg||(xg=!0,t.beginQuery(r.TIME_ELAPSED_EXT,i))},()=>{t.endQuery(r.TIME_ELAPSED_EXT),xg=!1},i=>r.queryCounterEXT(i,r.TIMESTAMP_EXT),()=>t.getQuery(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):(r=t.getExtension("EXT_disjoint_timer_query"),r?new Cde(()=>r.createQueryEXT(),i=>{r.deleteQueryEXT(i),xg=!1},i=>r.getQueryObjectEXT(i,r.QUERY_RESULT_AVAILABLE_EXT),i=>r.getQueryObjectEXT(i,r.QUERY_RESULT_EXT),()=>t.getParameter(r.GPU_DISJOINT_EXT),i=>{xg||(xg=!0,r.beginQueryEXT(r.TIME_ELAPSED_EXT,i))},()=>{r.endQueryEXT(r.TIME_ELAPSED_EXT),xg=!1},i=>r.queryCounterEXT(i,r.TIMESTAMP_EXT),()=>r.getQueryEXT(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):null)}function dxt(t,e){const r=t.capabilities.disjointTimerQuery;return r==null?null:new pxt(r,e)}let pxt=class{constructor(e,r){this._timer=e,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,r.forEach(i=>{const s=this._timer.createQuery(),n=this._timer.createQuery();this._queryPool.push(s,n),this._queryResults.set(i,null)})}start(){xg||(this._currentQuery=this._queryPool.pop(),this._currentQuery!=null&&(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(e){if(this._timer.disjoint()||this._currentQuery==null||!this._queryResults.has(e))return this.abort(),null;this._timer.endTimeElapsed();const r=this._queryResults.get(e);if(r==null)return this._queryResults.set(e,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(r))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const i=this._timer.getResult(r)/1e6;return this._queryPool.unshift(r),this._queryResults.set(e,this._currentQuery),this._currentQuery=null,i}abort(){this._currentQuery!=null&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){this._currentQuery!=null&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach(e=>{this._timer.deleteQuery(e)}),this._queryResults.forEach(e=>{e!=null&&this._timer.deleteQuery(e)})}};var wi;(function(t){t.OVERLAY="overlay",t.PREPARE="prepare",t.SHADOW_MAP="shadow map",t.LINEAR_DEPTH="linear depth",t.ACCUMULATED_SHADOWS="accumulated shadows",t.NORMALS="normals",t.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",t.SSAO="SSAO",t.OPAQUE="opaque",t.OPAQUE_EDGES="opaque edges",t.VOXEL="voxel",t.TRANSPARENT="transparent",t.TRANSPARENT_EDGES="transparent edges",t.HUD_VISIBILITY="HUD visibility",t.TRANSPARENT_TERRAIN="transparent terrain",t.ENVIRONMENT="environment",t.LASER_LINE="laser line",t.OCCLUDED="occluded",t.ANTIALIASING="antialiasing",t.HIGHLIGHTS="highlights",t.HUD="HUD",t.HUD_OCCLUDED="HUD occluded",t.FINISH="finish"})(wi||(wi={}));const Ade="Total";let fxt=class{constructor(e){this._rctx=e,this._startTimeStampCPU=0,this._lastTimeStampCPU=0,this._totalCPUTime=new Ug(Ade),this._cpuTimeSamplers=new Map(Object.values(wi).map(r=>[r,new Ug(r)])),this._enableGPUTimer=0,this._totalGPUTime=new Ug("GPU"),this._gpuTimeSamplers=new Map(Object.values(wi).map(r=>[r,new Ug(r)])),this._totalTime=0,this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return this._gpuTimerPool!=null}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return performance.now()-this._startTimeStampCPU}enableGPUPerformanceInfo(){if(this._gpuTimerPool==null){const e=[...Object.values(wi),Ade];this._gpuTimerPool=dxt(this._rctx,e)}return this._gpuTimerPool==null?{hasGPUTimerSupport:!1,remove:()=>{}}:(++this._enableGPUTimer,{hasGPUTimerSupport:!0,remove:nX(()=>{--this._enableGPUTimer,this._enableGPUTimer===0&&(this._gpuTimerPool=Ve(this._gpuTimerPool))})})}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=performance.now(),this._gpuTimerPool!=null&&this._gpuTimerPool.start()}advance(e){const r=performance.now();if(this._cpuTimeSamplers.get(e).record(r-this._lastTimeStampCPU),this._lastTimeStampCPU=r,this._gpuTimerPool!=null){const i=this._gpuTimerPool.stop(e);this._gpuTimeSamplers.get(e).record(i),this._gpuTimerPool.start()}}finishFrame(){if(this._gpuTimerPool!=null){const r=this._gpuTimerPool.stop(wi.FINISH);this._gpuTimeSamplers.get(wi.FINISH).record(r)}const e=performance.now()-this._startTimeStampCPU;this._totalTime=this._totalTime+e,this._totalCPUTime.record(e),this._gpuTimerPool!=null&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((r,i)=>r+(i.last||0),0)),++this._totalFrameCount}},rc=class extends we{get _bindParameters(){return this._renderContext.bindParameters}updateRenderFeature(t=null,e=!oe("disable-feature:high-quality-idle")){this._renderStateFeatures=Lne(e,t),this.notifyChange("_renderStateFeatures"),this._requestRender()}isFeatureEnabled(t,e=this._state){return this._renderStateFeatures?.get(e,t)??!1}setFeatureEnabled(t,e,r){this._renderStateFeatures?.set(e,t,r),this.notifyChange("_renderStateFeatures"),this._requestRender()}get _antialiasing(){return this._antialiasingEnabled||this.isFeatureEnabled(Xs.Antialiasing)}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(Xs.HighQualityTransparency)}get hasReflections(){return this.hasWater&&(this._ssrEnabled||this.isFeatureEnabled(Xs.WaterReflection))}get hasWater(){return this._hasWater||this._hasOverlayWater}constructor(t,e,r,i,s,n,o,a){super({}),this._stage=t,this._materialRepository=e,this._techniqueRepository=i,this._rctx=s,this._compositingHelper=n,this._magnifierHelper=o,this._requestRender=a,this._materialRenderers=new Bt,this._needsTransparentPass=!1,this._hasHUDElements=!1,this._hasHighlights=!1,this._hasWater=!1,this._hasOverlayWater=!1,this._renderOverlay=l=>{},this._isRendering=!1,this._fallbackDepthStencilTexture=null,this._sliceHelper=new Swt,this._state=Fr.IDLE,this._renderStateFeatures=null,this._antialiasingEnabled=!0,this._highQualityTransparencyEnabled=!0,this._terrainRenderingEnabled=!0,this._terrainTransparency=xn.Opaque,this._ssrEnabled=!1,this._ssaoEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new Nbt,this._handles=new Ii,this._renderHiddenTransparentEdges=()=>{},this._oitUsed=!1,this.updateRenderFeature(t.view.qualityProfile),this._smaaPass=new oO(this._rctx,i),a(),this._offscreen=new rwt(this._rctx,this._compositingHelper),this.performanceInfo=new fxt(this._rctx),this._shadowMap=new FQ(this._rctx,t.viewingMode),this._ssaoHelper=new RAe(t.view,i,this._rctx,a),this._highlight=new Qbt(i,this._rctx),this._shadowHighlight=new Twt(this._rctx,t.viewingMode),this._shadowAccumulator=new wl(this._rctx,i,t,l=>{const c=this.shadowsEnabled;this._shadowMap.enabled=!0,this._prepare(l.camera,l.contentCamera),this._renderPlugins.prepareRender(),this._shadowMap.enabled=c},(l,c,h)=>{l.shadowMap.start(l.camera,c,h,!0,this._stage.view.qualitySettings.maximumPixelRatio),this._renderShadowCascades(U.Shadow,l.shadowMap),l.camera.setGLViewport(this._rctx),this._prepare(l.camera,l.contentCamera)},a),this._renderContext=new qlt(this._rctx,this._offscreen,this._shadowMap,this._ssaoHelper,this._sliceHelper),this._renderPlugins=new nO({renderContext:this._renderContext,techniqueRepository:i,textureRepository:r,materialRepository:this._materialRepository,requestRender:a,controller:t}),this.renderPassManager=new Dbt(this._rctx,this._techniqueRepository),this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager),this._handles.add([ae(()=>this._stage.view.state.camera,()=>a(),Is),ae(()=>ai.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,l=>{this._renderHiddenTransparentEdges=l?()=>this._renderEdges(Ht.TRANSPARENT):()=>{},a()},Pr),ae(()=>this._ssaoEnabled||this.isFeatureEnabled(Xs.SSAO),l=>this._ssaoHelper.enabled=l,Is)])}normalizeCtorArgs(){return{}}destroy(){this._handles.destroy(),this._smaaPass.dispose(),this._gpuTimerHandle=Ni(this._gpuTimerHandle),this._materialRenderers.forAll(t=>t.dispose()),this._materialRenderers.clear(),this._offscreen.dispose(),this._fallbackDepthStencilTexture=Ve(this._fallbackDepthStencilTexture),this._shadowMap.dispose(),this._ssaoHelper.destroy(),this._highlight.dispose(),this._shadowHighlight.dispose(),this._shadowAccumulator.dispose(),this._edgeView=$e(this._edgeView),this.renderPassManager.destroy(),sSe.prune()}disposeOffscreenBuffers(){this._offscreen.dispose(),this._shadowMap.disposeOffscreenBuffers(),this._smaaPass.disable(),this._ssaoHelper.disposeOffscreenBuffers()}get updating(){return this._antialiasing&&this._smaaPass.updating||this._edgeView!=null&&this._edgeView.updating||this._shadowAccumulator.running||this._renderPlugins.updating||!this.isCameraFinal}ensureEdgeView(){if(this._edgeView==null){const t=this._stage.view.resourceController;this._edgeView=new Dd({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniqueRepository:this._techniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:mxt(t)}),this._handles.add(ae(()=>vc(this._edgeView,e=>e.updating),()=>this._requestRender(),qr)),this._requestRender()}return this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return sY(this._bindParameters.ssr.reprojectionMatrix,un)}set _reprojectionMatrix(t){tX(this._bindParameters.ssr.reprojectionMatrix,t)&&this.notifyChange("isCameraFinal")}get shadowsEnabled(){return!!this._shadowMap?.enabled}setParameters(t){const{_shadowMap:e,_bindParameters:r}=this;if(t.qualitySettings?.reflections!==void 0&&this._ssrEnabled!==t.qualitySettings.reflections&&(this._ssrEnabled=t.qualitySettings.reflections,this._requestRender()),t.qualitySettings?.ambientOcclusion!==void 0&&this._ssaoEnabled!==t.qualitySettings.ambientOcclusion&&(this._ssaoEnabled=t.qualitySettings.ambientOcclusion,this._requestRender()),t.shadowMap!==void 0&&this._shadowMap.enabled!==t.shadowMap&&(this._shadowMap.enabled=t.shadowMap,this._requestRender()),t.shadowMapMaxCascades!==void 0&&e.maxCascades!==t.shadowMapMaxCascades&&(e.maxCascades=t.shadowMapMaxCascades,this._requestRender()),t.environment!=null){t.environment.weather!=null&&(this._bindParameters.weather=t.environment.weather,this._bindParameters.weatherVisible=!!t.weatherVisible);const i=t.environment.lighting.type!=="virtual";r.enableFillLights!==i&&(r.enableFillLights=i,this._requestRender())}t.background&&this._offscreen.background!==t.background&&(this._offscreen.background=t.background,this._requestRender()),t.antialiasingEnabled!==void 0&&this._antialiasingEnabled!==t.antialiasingEnabled&&(this._antialiasingEnabled=t.antialiasingEnabled,this._requestRender()),t.highQualityTransparency!==void 0&&this._highQualityTransparencyEnabled!==t.highQualityTransparency&&(this._highQualityTransparencyEnabled=t.highQualityTransparency,this._requestRender()),t.defaultHighlightOptions!==void 0&&(this._highlight.setDefaultOptions(t.defaultHighlightOptions),this._shadowHighlight.setDefaultOptions(t.defaultHighlightOptions),this._requestRender()),t.overlays!==void 0&&this._bindParameters.overlays!==t.overlays&&(this._bindParameters.overlays=t.overlays,this._requestRender()),t.hasOverlayWater!==void 0&&this._hasOverlayWater!==t.hasOverlayWater&&(this._hasOverlayWater=t.hasOverlayWater,this._requestRender()),t.renderOverlay!==void 0&&this._renderOverlay!==t.renderOverlay&&(this._renderOverlay=t.renderOverlay,this._requestRender()),t.slicePlane!==void 0&&this._sliceHelper.plane!==t.slicePlane&&(this._sliceHelper.plane=t.slicePlane,this._requestRender()),t.terrainRenderingEnabled!==void 0&&this._terrainRenderingEnabled!==t.terrainRenderingEnabled&&(this._terrainRenderingEnabled=t.terrainRenderingEnabled,this._requestRender()),t.terrainTransparency!==void 0&&this._terrainTransparency!==t.terrainTransparency&&(this._terrainTransparency=t.terrainTransparency,this._requestRender()),t.shadowCastOptions!==void 0&&this._shadowAccumulator.setOptions(t.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}modify(t,e){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:r,removes:i,updates:s}=t;if(r.length===0&&i.length===0&&s.length===0)return;const n=dAe(t);let o=!1;n.forEach((a,l)=>{if(e.done)return;let c=this._materialRenderers.find(h=>h.material===l);c==null&&a.adds.length>0&&(c=new xAe(this._rctx,this._materialRepository,l),this._materialRenderers.push(c)),c&&(c.modify(a),c.isEmpty&&(o=!0)),a.removes.forEach(h=>t.removes.removeUnordered(h)),a.adds.forEach(h=>t.adds.removeUnordered(h)),a.updates.forEach(h=>t.updates.removeUnordered(h)),e.madeProgress()}),o&&this._materialRenderers.filterInPlace(a=>!a.isEmpty||(a.dispose(),!1)),this._hasHighlights=this._materialRenderers.some(a=>a.hasHighlights),this._bindParameters.hasOccludees=this._materialRenderers.some(a=>a.hasOccludees),this._hasWater=this._materialRenderers.some(a=>a.hasWater),this._hasHUDElements=this._materialRenderers.some(a=>a.requiresSlot(he.LINE_CALLOUTS_HUD_DEPTH,U.Color)||a.requiresSlot(he.HUD_MATERIAL,U.Color)||a.requiresSlot(he.LABEL_MATERIAL,U.Color)),this._requestRender()}updateAnimation(t){const e=this._hasAnimations;return this._hasAnimations=!1,this._materialRenderers.forAll(r=>this._hasAnimations=r.updateAnimation(t)||this._hasAnimations),this._hasAnimations=this._renderPlugins.updateAnimation(t)||this._hasAnimations,this._hasAnimations!==e&&(this._gpuTimerHandle=e?Ni(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}render(t,e,r,i,s){this._isRendering=!0,this._oitUsed=!1,this.performanceInfo.startFrame();const{camera:n,contentCamera:o,mode:a,alignPixelEnabled:l}=r;this._state=a,this._renderOverlay(s),this.performanceInfo.advance(wi.OVERLAY),this._renderContext.time=s,this._bindParameters.transparencyPassType=ut.NONE,this._bindParameters.alignPixelEnabled=l;const c=this._offscreen;c.setupRenderTarget(this.hasReflections);const h=Ey(this._sliceHelper.plane);i===Lw.OFF&&(this._sliceHelper.plane=null),this._rctx.bindFramebuffer(t),n.setGLViewport(this._rctx),this._prepare(n,o),this._renderPlugins.prepareRender(),this.performanceInfo.advance(wi.PREPARE);const p=this._computeDepthRange(n);this._renderShadowMap(t,n,this._bindParameters.lighting.mainLight.direction,p),this.performanceInfo.advance(wi.SHADOW_MAP),c.initializeFrame(n),this._ensureBindParameters(n,o);const f=this._terrainRenderingEnabled&&(this._terrainTransparency===xn.Semitransparent||this._terrainTransparency===xn.TransparentWithDraped),m=this._highQualityTransparency&&f,y=this._needsTransparentPass||this._renderPlugins.needsTransparentPass;this._prepareShaders(m,y),this._renderLinearDepth(),this.performanceInfo.advance(wi.LINEAR_DEPTH),this._accumulateShadows(p,n,o),this.performanceInfo.advance(wi.ACCUMULATED_SHADOWS),this._renderNormal(),this.performanceInfo.advance(wi.NORMALS),this._ensureBindParametersSSR(s),this._renderSSAO(s),this.performanceInfo.advance(wi.SSAO),this._renderContext.output=U.Color,c.bindFramebuffer(),this._renderOpaqueGeometry(),this.performanceInfo.advance(wi.OPAQUE),this._renderTerrainLinearDepth(m),this._setMultipassTerrain(m),this._renderEdges(Ht.OPAQUE),this.performanceInfo.advance(wi.OPAQUE_EDGES),this._offscreen.bindTarget(this._offscreen.currentColorTarget,this._offscreen.mainDepth),this._renderSlot(he.VOXEL),this.performanceInfo.advance(wi.VOXEL),this._renderHiddenTransparentEdges(),y&&(this._oitEnabled?this._renderOITPass(KS.Geometry):this._renderTransparentGeometry()),this.performanceInfo.advance(wi.TRANSPARENT),this._renderGeometryLinearDepth(m);const _=this._renderHUDVisibility(m);m||this._renderInternalSlot(he.LINE_CALLOUTS),this.performanceInfo.advance(wi.HUD_VISIBILITY),this._renderObjectAndLayerIdColor(e),this.performanceInfo.advance(wi.OBJECT_AND_LAYER_ID_COLOR),this._renderEdges(Ht.TRANSPARENT,m),this.performanceInfo.advance(wi.TRANSPARENT_EDGES),this._renderTransparentTerrain(),f&&_&&(m?this._renderLineCallouts(ac.Occluded):c.compositeTransparentTerrainOntoHUDVisibility(this._bindParameters),this._renderHUD(ac.Occluded,c.framebuffer),this.performanceInfo.advance(wi.HUD_OCCLUDED)),this.performanceInfo.advance(wi.TRANSPARENT_TERRAIN),this._setTerrainCulling(!1),f&&(c.compositeTransparentTerrainOntoMain(this._bindParameters),m&&(this._renderEdges(Ht.OPAQUE),this.performanceInfo.advance(wi.OPAQUE_EDGES),y&&(this._oitEnabled?this._renderOITPass(KS.Geometry):this._renderTransparentGeometry()),this.performanceInfo.advance(wi.TRANSPARENT),this._renderEdges(Ht.TRANSPARENT),this.performanceInfo.advance(wi.TRANSPARENT_EDGES))),m&&this._renderLineCallouts(ac.NotOccluded),this._setMultipassEnabled(!1),this._shadowAccumulator.render(this._bindParameters),c.renderToTargets(()=>{this._renderInternalSlot(he.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderSlot(he.POSTPROCESSING_ENVIRONMENT_TRANSPARENT),this._renderSlot(he.LASERLINES)},c.currentColorTarget,c.mainDepth),this.performanceInfo.advance(wi.ENVIRONMENT),this._renderPlugins.needsLaserlineWithContrastControl&&c.renderTmpAndCompositeToMain(()=>this._renderSlot(he.LASERLINES_CONTRAST_CONTROL),this._bindParameters,ca.PremultipliedAlpha),this.performanceInfo.advance(wi.LASER_LINE),this._renderOccluded(),this.performanceInfo.advance(wi.OCCLUDED);const v=i===Lw.ON&&this._magnifierHelper.enabled,b=v&&t==null?this._offscreen.getFramebuffer(this._offscreen.tmpColor,this._offscreen.tmpDepth):t;this._rctx.bindFramebuffer(b);const T=this._offscreen.colorTexture;this._renderAntiAliasing(T)||T==null||this._compositingHelper.composite(this._bindParameters,T,ca.None),this.performanceInfo.advance(wi.ANTIALIASING),this._renderHUD(ac.NotOccluded,b),this.performanceInfo.advance(wi.HUD),this._renderHighlights(b,this._bindParameters),this.performanceInfo.advance(wi.HIGHLIGHTS),v&&this._magnifierHelper.render(this._rctx,this._bindParameters),b!==t&&(this._rctx.bindFramebuffer(t),this._compositingHelper.composite(this._bindParameters,this._offscreen.tmpColorTexture,ca.None)),this._disposeOITBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=h,this._isRendering=!1,this.onPostRender&&this.onPostRender(),this.performanceInfo.finishFrame()}_prepareShaders(t,e){this._renderContext.output=U.Color,this._prepareOpaqueGeometrySlots(),this._setMultipassTerrain(t),this._prepareSlots(he.TRANSPARENT_TERRAIN),this._setMultipassTerrain(!1),t||this._prepareInternalSlots(this._materialRenderers,he.LINE_CALLOUTS),e&&this._prepareTransparencySlots(),this._prepareInternalSlots(this._materialRenderers,he.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._prepareSlots(he.POSTPROCESSING_ENVIRONMENT_TRANSPARENT,he.LASERLINES),this._rctx.gl.flush()}_renderObjectAndLayerIdColor(t){if(t!=null&&oe("enable-feature:objectAndLayerId-rendering")){const e=this._renderContext.output;this._rctx.bindFramebuffer(t),this._offscreen.renderToFBO(()=>this._renderGeometryAndTransparentTerrainPass(U.ObjectAndLayerIdColor),[0,0,0,0],!0,!0),this._rctx.bindFramebuffer(t),this._offscreen.renderToFBO(()=>{this._bindParameters.renderTransparentlyOccludedHUD=ac.NotOccluded,this._renderInternalSlot(he.HUD_MATERIAL)},void 0,!0,!0),this._renderContext.output=e}}finish(t){this._hasAnimations||this._animationTimestep.clear();const e=this.performanceInfo.gpuSamplingEnabled,r=t===gs.BACKGROUND;if(r||e){const i=r?this.performanceInfo.elapsedTime:0,s=e?this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError(),n=Math.max(i,s);this._animationTimestep.frame(n,r)}}readDepthPixels(t,e,r){const i=this._offscreen.bindTarget(this._offscreen.linearDepth,this._offscreen.tmpDepth);if(!this._needsLinearDepth){this._ensureBindParameters(t,t),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const s=Ti.COLOR_BUFFER_BIT|Ti.DEPTH_BUFFER_BIT|Ti.STENCIL_BUFFER_BIT;this._rctx.clearSafe(s),this._renderGeometryAndTransparentTerrainPass(U.Depth)}i.readPixels(e[0],e[1],e[2],e[3],Ct.RGBA,Gs.UNSIGNED_BYTE,r)}readHUDVisibility(t,e,r,i,s){this._offscreen.bindTarget(this._offscreen.hudVisibility).readPixels(t,e,r,i,Ct.RGBA,Gs.UNSIGNED_BYTE,s)}readAccumulatedShadow(t){return this._shadowAccumulator.readAccumulatedShadow(t[0],t[1])}_setMultipassTerrain(t){this._setMultipassEnabled(t),this._setTerrainCulling(t)}_setMultipassEnabled(t){this._bindParameters.multipassTerrain.enabled=this._bindParameters.multipassGeometry.enabled=t}_setTerrainCulling(t){this._bindParameters.multipassTerrain.cullAboveGround=t}_prepareSlots(...t){this._renderPlugins.prepareSlots(t)}_renderSlot(t){this._bindParameters.slot=t,this._renderPlugins.render()}_renderEdges(t,e=!1){const r=this._edgeView;r!=null&&r.shouldRender()&&this._offscreen.renderTmpAndCompositeToMain(()=>r.render(this._bindParameters,t),this._bindParameters,ca.Alpha,e)}_renderShadowMap(t,e,r,i){const s=this._shadowMap;s.enabled&&(s.start(e,r,i,this.isFeatureEnabled(Xs.HighResolutionShadows),this._stage.view.qualitySettings.maximumPixelRatio),this._shadowHighlight.updateParameters(e,r),this._needsShadowHighlight?(this._renderShadowCascades(U.ShadowHighlight,this._shadowMap,n=>s.takeCascadeSnapshotTo(n,RE.Highlight)),s.clear(),this._renderShadowCascades(U.ShadowExcludeHighlight,this._shadowMap,n=>{s.takeCascadeSnapshotTo(n,RE.Default),this._renderGeometryAndTransparentTerrainPass(U.ShadowHighlight)})):this._renderShadowCascades(U.Shadow),s.finish(t),e.setGLViewport(this._rctx))}_renderShadowCascades(t,e=this._shadowMap,r=i=>{}){for(const i of e.cascades)i.camera.setGLViewport(this._rctx),this._prepare(i.camera,i.camera),this._renderGeometryAndTransparentTerrainPass(t),r(i)}get _needsLinearDepth(){return this._ssaoHelper.active||this._renderPlugins.needsLinearDepth||this.hasReflections||this._needsShadowHighlight||this._needsShadowCast}_renderLinearDepth(){this._needsLinearDepth?this._offscreen.renderToTargets(()=>this._renderGeometryAndTransparentTerrainPass(U.Depth),this._offscreen.linearDepth,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.linearDepth),this._bindParameters.linearDepthTexture=this._offscreen.linearDepthTexture}_renderTerrainLinearDepth(t){if(t){const e=this._renderContext.output;this._renderContext.output=U.Depth,this._offscreen.renderToTargets(()=>this._renderTransparentTerrain(),this._offscreen.terrainLinearDepth,this._offscreen.tmpDepth,[-1e10,-1e10,-1e10,1],!0,!0),this._renderContext.output=e}else this._offscreen.disposeTarget(this._offscreen.terrainLinearDepth);this._bindParameters.multipassTerrain.linearDepthTexture=this._offscreen.terrainLinearDepthTexture}_renderGeometryLinearDepth(t){if(t){const e=this._renderContext.output;this._offscreen.renderToTargets(()=>this._renderGeometryPass(U.Depth),this._offscreen.geometryLinearDepth,this._offscreen.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.output=e}else this._offscreen.disposeTarget(this._offscreen.geometryLinearDepth);this._bindParameters.multipassGeometry.linearDepthTexture=this._offscreen.geometryLinearDepthTexture}get _needsNormal(){return this._ssaoHelper.active}_renderNormal(){this._needsNormal?this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(U.Normal)},this._offscreen.normal,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.normal)}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowCast}_computeDepthRange(t){if(!this._needsDepthRange)return xW;const e=_bt(t,this._materialRenderers,this._stage.layers);return IE(e,this.renderPlugins.queryDepthRange(t)),e.near=Math.max(t.near,e.near),e.far=Math.min(t.far,e.far),e}_renderGeometryAndTransparentTerrainPass(t){this._renderContext.output=t,this._prepareSlots(he.TRANSPARENT_TERRAIN),this._renderGeometryPass(t),this._renderTransparentTerrain()}_renderGeometryPass(t){this._renderContext.output=t,this._prepareSlots(he.TRANSPARENT_MATERIAL),this._renderOpaqueGeometry(),this._renderTransparentGeometry()}_renderSSAO(t){this._ssaoHelper.render(this._bindParameters,t,this._offscreen.linearDepthTexture,this._offscreen.normalTexture)}_prepareOpaqueGeometrySlots(){this._prepareSlots(he.INTEGRATED_MESH,he.OPAQUE_TERRAIN,he.OPAQUE_MATERIAL,he.POSTPROCESSING_ENVIRONMENT_OPAQUE),this._prepareInternalSlots(this._materialRenderers,he.OPAQUE_MATERIAL)}_renderOpaqueGeometry(){this._renderSlot(he.INTEGRATED_MESH),this._renderSlot(he.OPAQUE_TERRAIN),this._renderInternalSlot(he.OPAQUE_MATERIAL),this._renderSlot(he.OPAQUE_MATERIAL),this._renderSlot(he.POSTPROCESSING_ENVIRONMENT_OPAQUE)}_renderTransparentGeometry(){this._renderInternalSlot(he.TRANSPARENT_MATERIAL),this._renderSlot(he.TRANSPARENT_MATERIAL)}_renderTransparentTerrain(){this._renderSlot(he.TRANSPARENT_TERRAIN)}_renderHUDVisibility(t){let e=!1;return this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper.hudVisibilityTexture,e=this._renderInternalSlot(he.OCCLUSION_PIXELS)},t),e}_renderLineCallouts(t){this._bindParameters.renderTransparentlyOccludedHUD=t,t===ac.Occluded?this._offscreen.renderToTargets(()=>this._renderInternalSlot(he.LINE_CALLOUTS),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderInternalSlot(he.LINE_CALLOUTS)}_renderHUD(t,e){this._hasHUDElements&&(this._oitEnabled?(this._renderOITPass(KS.HUD,t),this._rctx.bindFramebuffer(e),this._compositingHelper.composite(this._bindParameters,this._offscreen.hudColorTexture,ca.PremultipliedAlpha)):t===ac.Occluded?this._offscreen.renderToTargets(()=>this._renderHUDElements(ac.Occluded),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderHUDElements(t))}_renderHUDElements(t){this._bindParameters.renderTransparentlyOccludedHUD=t,this._prepareInternalSlots(this._materialRenderers,he.LINE_CALLOUTS_HUD_DEPTH,he.HUD_MATERIAL,he.LABEL_MATERIAL),this._renderInternalSlot(he.LINE_CALLOUTS_HUD_DEPTH),this._renderInternalSlot(he.HUD_MATERIAL),this._renderInternalSlot(he.LABEL_MATERIAL)}get _needsHighlight(){return this._hasHighlights||this._renderPlugins.needsHighlight}get _needsShadowHighlight(){return this._shadowMap.enabled&&this._shadowHighlight.isVisible&&this._needsHighlight}_renderHighlights(t,e){if(!this._needsHighlight)return void this._offscreen.disposeTarget(this._offscreen.highlight);const r=this._highlight,i=this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(U.Highlight),this._rctx.clearSafe(Ti.DEPTH_BUFFER_BIT),this._renderHUDElements(ac.Both)},this._offscreen.highlight,this._offscreen.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=i.colorTexture,this._needsShadowHighlight&&this._shadowHighlight.render(e,t),r.render(this._bindParameters,i,t)}get _needsShadowCast(){return this._shadowAccumulator.isAccumulating}_accumulateShadows(t,e,r){this._needsShadowCast&&this._offscreen.linearDepthTexture!=null&&this._shadowAccumulator.renderAccumulation(this._offscreen.linearDepthTexture,t,e,r)}_prepareTransparencySlots(){this._renderContext.output=U.Alpha,this._bindParameters.transparencyPassType=ut.Alpha,this._prepareInternalSlots(this._materialRenderers,he.TRANSPARENT_MATERIAL),this._prepareSlots(he.TRANSPARENT_MATERIAL),this._renderContext.output=U.Color,this._bindParameters.transparencyPassType=ut.Color,this._prepareInternalSlots(this._materialRenderers,he.TRANSPARENT_MATERIAL),this._prepareSlots(he.TRANSPARENT_MATERIAL),this._bindParameters.transparencyPassType=ut.FrontFace,this._prepareInternalSlots(this._materialRenderers,he.TRANSPARENT_MATERIAL),this._prepareSlots(he.TRANSPARENT_MATERIAL),this._bindParameters.transparencyPassType=ut.NONE}_renderOITPass(t,e=ac.Both){const r=t===KS.HUD,i=r?()=>this._renderHUDElements(e):()=>this._renderTransparentGeometry(),s=o=>{this._bindParameters.transparencyPassType=o,this._offscreen.renderOITPass(i,o,r)},n=this._renderContext.output;this._renderContext.output=U.Alpha,s(ut.Alpha),this._renderContext.output=U.Color,s(ut.Color),s(ut.FrontFace),this._offscreen.compositeTransparentOntoOpaque(this._bindParameters,r),this._bindParameters.transparencyPassType=ut.NONE,this._renderContext.output=n,this._oitUsed=!0}_disposeOITBuffers(){this._oitUsed||(this._offscreen.disposeTarget(this._offscreen.alphaFloatTarget),this._offscreen.disposeTarget(this._offscreen.colorFloatTarget),this._offscreen.disposeTarget(this._offscreen.frontFaceTarget))}_renderOccluded(){let t=0;qc.clear(),this._materialRenderers.forAll(n=>{n.material&&n.material.isVisible()&&n.material.renderOccluded===Di.OccludeAndTransparentStencil&&(t|=n.material.renderOccluded,qc.push(n))});const e=this._offscreen,r=(n,o,a,l,c)=>{t&o&&(e.renderToTargets(a,e.tmpColor,e.mainDepth,[0,0,0,0],l,c),e.compositeOccludedOntoMain(this._bindParameters,n))};qc.length!==0&&(this._prepareInternalSlots(qc,he.OCCLUDER_MATERIAL,he.TRANSPARENT_OCCLUDER_MATERIAL),this._renderInternalSlot(he.OCCLUDER_MATERIAL,qc),r(.5,Di.OccludeAndTransparentStencil,()=>this._renderInternalSlot(he.TRANSPARENT_OCCLUDER_MATERIAL,qc),!1,!1)),qc.clear(),this._materialRenderers.forAll(n=>{n.material&&n.material.isVisible()&&(n.material.renderOccluded===Di.OccludeAndTransparent||n.material.renderOccluded===Di.Transparent||n.material.renderOccluded===Di.Opaque)&&(t|=n.material.renderOccluded,qc.push(n))});const i=this._renderPlugins.renderOccludedFlags;if(t|=i,!t)return;const s=n=>{this._renderContext.renderOccludedMask=n,this._prepareInternalSlots(qc,he.OPAQUE_MATERIAL,he.TRANSPARENT_MATERIAL,he.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),i>Di.Occlude&&this._renderSlot(he.OCCLUDED_TERRAIN),this._renderInternalSlot(he.OPAQUE_MATERIAL,qc),this._renderInternalSlot(he.TRANSPARENT_MATERIAL,qc),this._renderInternalSlot(he.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,qc),this._renderContext.resetRenderOccludedMask()};this._renderContext.output=U.Color,r(.5,Di.OccludeAndTransparent,()=>s(Di.OccludeAndTransparent),!0,Il.OutlineVisualElementMask),r(.5,Di.Transparent,()=>s(Di.Transparent),!0,Il.OutlineVisualElementMask),r(1,Di.Opaque,()=>s(Di.Opaque),!0,Il.OutlineVisualElementMask),qc.clear()}_renderAntiAliasing(t){if(this._antialiasing){if(this._smaaPass.enable(()=>this._requestRender())&&t!=null)return this._smaaPass.render(t),!0}else this._smaaPass.disable();return!1}_prepare(t,e){this._needsTransparentPass=this._materialRenderers.some(r=>r.requiresSlot(he.TRANSPARENT_MATERIAL,U.Color)),this._bindParameters.camera=t,this._bindParameters.contentCamera=e}_ensureBindParameters(t,e){this._bindParameters.camera=t,this._bindParameters.contentCamera=e;const r=this._renderContext.offscreenRenderingHelper;this._bindParameters.hudVisibilityTexture=r.hudVisibilityTexture,this._bindParameters.mainColorTexture=r.mainColorTexture,this._bindParameters.highlightDepthTexture=r.depthTexture??this._getFallbackDepthTexture()}_ensureBindParametersSSR(t){if(this._bindParameters.ssr.enabled=this.hasReflections,this._bindParameters.ssr.enabled){this._ssrEnableTime==null&&(this._ssrEnableTime=t),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=un:(Mn(Rde,this._bindParameters.camera.viewMatrix),Mn(Ode,this._bindParameters.camera.projectionMatrix),oi(MT,Rde,Ode),oi(MT,this._renderContext.lastFrameCamera.viewMatrix,MT),oi(MT,this._renderContext.lastFrameCamera.projectionMatrix,MT),this._reprojectionMatrix=MT),this._bindParameters.ssr.lastFrameColorTexture=this._offscreen.lastFrameColorTexture;const e=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=e>0?Math.min(e,t-this._ssrEnableTime)/e:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._reprojectionMatrix=un,this._bindParameters.ssr.lastFrameColorTexture=null,this._ssrEnableTime=null}_prepareInternalSlots(t,...e){for(const r of e)this._bindParameters.slot=r,t.forAll(i=>{i.material.shouldRender(this._renderContext)&&i.prepareTechnique(this._renderContext)})}_renderInternalSlot(t,e=this._materialRenderers){let r=!1;return this._bindParameters.slot=t,e.forAll(i=>{if(i.material.shouldRender(this._renderContext)){const s=i.prepareTechnique(this._renderContext);s!=null&&(i.render(this._renderContext,s),r=!0)}}),r}_getFallbackDepthTexture(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=aTe(this._rctx)),this._fallbackDepthStencilTexture}get gpuMemoryUsage(){return{offscreen:this._offscreen?.gpuMemoryUsage??0,highlights:(this._highlight?.gpuMemoryUsage??0)+(this._shadowHighlight?.gpuMemoryUsage??0),shadows:this._shadowMap?.gpuMemoryUsage??0,ssao:this._ssaoHelper?.gpuMemoryUsage??0}}get test(){const t=this;return{offscreen:this._offscreen,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,weatherIsFading:this._bindParameters.cloudsFade.isFading,resetRenderStateFeatures:()=>{t._renderStateFeatures=Lne()},getFramebufferTexture:e=>{switch(e){case d_.Color:return t._offscreen.colorTexture;case d_.LinearDepth:return t._offscreen.linearDepthTexture;case d_.Normals:return t._offscreen.normalTexture;case d_.ShadowMap:return t._shadowMap.depthTexture;case d_.HudVisibility:return t._offscreen.hudVisibilityTexture;case d_.Highlight:return t._offscreen.highlightTexture}}}}};var KS,d_;u([d()],rc.prototype,"_renderPlugins",void 0),u([d()],rc.prototype,"_shadowAccumulator",void 0),u([d()],rc.prototype,"_state",void 0),u([d()],rc.prototype,"_renderStateFeatures",void 0),u([d()],rc.prototype,"_antialiasingEnabled",void 0),u([d({readOnly:!0})],rc.prototype,"_antialiasing",null),u([d()],rc.prototype,"_ssaoEnabled",void 0),u([d()],rc.prototype,"_smaaPass",void 0),u([d({autoDestroy:!0})],rc.prototype,"_edgeView",void 0),u([d()],rc.prototype,"updating",null),u([d()],rc.prototype,"isCameraFinal",null),rc=u([P("esri.views.3d.webgl-engine.lib.Renderer")],rc),function(t){t[t.Geometry=0]="Geometry",t[t.HUD=1]="HUD"}(KS||(KS={})),function(t){t[t.Color=0]="Color",t[t.LinearDepth=1]="LinearDepth",t[t.Normals=2]="Normals",t[t.ShadowMap=3]="ShadowMap",t[t.HudVisibility=4]="HudVisibility",t[t.Highlight=5]="Highlight"}(d_||(d_={}));const qc=new Bt,Ode=be(),Rde=be(),MT=be();function mxt(t){return e=>t.immediate.schedule(e)}let wMe=class xMe{constructor(e){this._rctx=e,this._indexBuffer=this._createIndexbuffer(),this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:`#version 300 es
    precision highp float;

    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,fragment:`#version 300 es
    precision highp float;

    out vec4 fragColor;

    void main(void) {
      fragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`}}_createHelperProgram(){const e=xMe.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}_createIndexbuffer(){return Ur.createIndex(this._rctx,Cr.STATIC_DRAW,new Uint32Array([0]))}resetIndicesType(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,Tt.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(At.POINTS,1,rt.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}},Mde=class{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:xe.ONE,dstRGB:xe.ZERO,srcAlpha:xe.ONE,dstAlpha:xe.ZERO},this.blendEquation={mode:dm.ADD,modeAlpha:dm.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=ap.BACK,this.frontFace=fE.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=ti.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:ap.FRONT_AND_BACK,func:ti.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:ap.FRONT_AND_BACK,fail:_s.KEEP,zFail:_s.KEEP,zPass:_s.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.uniformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}},gxt=class{constructor(e){this._allocations=new Map,e?Error.stackTraceLimit=1/0:(this.add=()=>{},this.remove=()=>{})}add(e){this._allocations.set(e,new Error().stack)}remove(e){this._allocations.delete(e)}get information(){let e="";if(this._allocations.size>0){e+=`${this._allocations.size} live object allocations:
`;const r=new Map;this._allocations.forEach(i=>{r.set(i,(r.get(i)??0)+1)}),r.forEach((i,s)=>{const n=s.split(`
`);n.shift(),n.shift(),e+=`${i}: ${n.shift()}
`,n.forEach(o=>e+=`   ${o}
`)})}return e}};const yxt={RECORD_ALLOCATIONS:!1};let _xt=class{constructor(){for(this._current=new Array,this._max=new Array,this._allocations=new gxt(yxt.RECORD_ALLOCATIONS);this._current.length<Rn.COUNT;)this._current.push(0),this._max.push(0)}resetMax(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)}increment(e,r){const i=++this._current[e];this._max[e]=Math.max(i,this._max[e]),this._allocations.add(r)}decrement(e,r){--this._current[e],this._allocations.remove(r)}get max(){return this._max}get current(){return this._current}get total(){return this.current.reduce((e,r)=>e+r,0)}get resourceInformation(){let e="";if(this.total>0){e+=`Live objects:
`;for(let r=0;r<Rn.COUNT;++r){const i=this._current[r];i>0&&(e+=`${Rn[r]}: ${i}
`)}}return e+=this._allocations.information,e}},vxt=class{constructor(e,r,i){const s=r.textureFilterAnisotropic,n=i.maxAnisotropy??1/0;this.versionString=e.getParameter(e.VERSION),this.maxVertexTextureImageUnits=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxVertexAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.maxMaxAnisotropy=s?Math.min(e.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY),n):1,this.maxTextureImageUnits=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxRenderbufferSize=e.getParameter(e.MAX_RENDERBUFFER_SIZE),this.maxViewportDims=e.getParameter(e.MAX_VIEWPORT_DIMS),Ip(e)?(this.maxUniformBufferBindings=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS),this.maxVertexUniformBlocks=e.getParameter(e.MAX_VERTEX_UNIFORM_BLOCKS),this.maxFragmentUniformBlocks=e.getParameter(e.MAX_FRAGMENT_UNIFORM_BLOCKS),this.maxUniformBlockSize=e.getParameter(e.MAX_UNIFORM_BLOCK_SIZE),this.uniformBufferOffsetAlignment=e.getParameter(e.UNIFORM_BUFFER_OFFSET_ALIGNMENT),this.maxArrayTextureLayers=e.getParameter(e.MAX_ARRAY_TEXTURE_LAYERS),this.maxSamples=e.getParameter(e.MAX_SAMPLES)):(this.maxUniformBufferBindings=0,this.maxVertexUniformBlocks=0,this.maxFragmentUniformBlocks=0,this.maxUniformBlockSize=0,this.uniformBufferOffsetAlignment=1,this.maxArrayTextureLayers=1,this.maxSamples=1)}};const bxt=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var Pde,TMe={exports:{}};(Pde=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(TMe.exports=Pde);const wxt=VM(TMe.exports);var Ide,PW={exports:{}};PW.exports,Ide=PW,function(t){var e=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];e!==void 0&&(Ide.exports=e)}();const $de=VM(PW.exports);var SMe={exports:{}};(function(t){(function(e){var r=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"]}();r!==void 0&&(t.exports=r)})()})(SMe);const xxt=VM(SMe.exports);var md=999,Lde=9999,Xz=0,Zz=1,Dde=2,Nde=3,Fde=4,EL=5,Txt=6,Sxt=7,Ext=8,Ude=9,Cxt=10,kde=11,Axt=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function Oxt(){var t,e,r,i=0,s=0,n=md,o=[],a=[],l=1,c=0,h=0,p=!1,f=!1,m="";return function(N){return a=[],N!==null?_(N.replace?N.replace(/\r\n/g,`
`):N):v()};function y(N){N.length&&a.push({type:Axt[n],data:N,position:h,line:l,column:c})}function _(N){var H;for(i=0,r=(m+=N).length;t=m[i],i<r;){switch(H=i,n){case Xz:i=E();break;case Zz:i=S();break;case Dde:i=x();break;case Nde:i=A();break;case Fde:i=D();break;case kde:i=M();break;case EL:i=k();break;case Lde:i=$();break;case Ude:i=T();break;case md:i=b()}H!==i&&(m[H]===`
`?(c=0,++l):++c)}return s+=i,m=m.slice(i),a}function v(N){return o.length&&y(o.join("")),n=Cxt,y("(eof)"),a}function b(){return o=o.length?[]:o,e==="/"&&t==="*"?(h=s+i-1,n=Xz,e=t,i+1):e==="/"&&t==="/"?(h=s+i-1,n=Zz,e=t,i+1):t==="#"?(n=Dde,h=s+i,i):/\s/.test(t)?(n=Ude,h=s+i,i):(p=/\d/.test(t),f=/[^\w_]/.test(t),h=s+i,n=p?Fde:f?Nde:Lde,i)}function T(){return/[^\s]/g.test(t)?(y(o.join("")),n=md,i):(o.push(t),e=t,i+1)}function x(){return t!=="\r"&&t!==`
`||e==="\\"?(o.push(t),e=t,i+1):(y(o.join("")),n=md,i)}function S(){return x()}function E(){return t==="/"&&e==="*"?(o.push(t),y(o.join("")),n=md,i+1):(o.push(t),e=t,i+1)}function A(){if(e==="."&&/\d/.test(t))return n=EL,i;if(e==="/"&&t==="*")return n=Xz,i;if(e==="/"&&t==="/")return n=Zz,i;if(t==="."&&o.length){for(;R(o););return n=EL,i}if(t===";"||t===")"||t==="("){if(o.length)for(;R(o););return y(t),n=md,i+1}var N=o.length===2&&t!=="=";if(/[\w_\d\s]/.test(t)||N){for(;R(o););return n=md,i}return o.push(t),e=t,i+1}function R(N){for(var H,Z,G=0;;){if(H=$de.indexOf(N.slice(0,N.length+G).join("")),Z=$de[H],H===-1){if(G--+N.length>0)continue;Z=N.slice(0,1).join("")}return y(Z),h+=Z.length,(o=o.slice(Z.length)).length}}function M(){return/[^a-fA-F0-9]/.test(t)?(y(o.join("")),n=md,i):(o.push(t),e=t,i+1)}function D(){return t==="."||/[eE]/.test(t)?(o.push(t),n=EL,e=t,i+1):t==="x"&&o.length===1&&o[0]==="0"?(n=kde,o.push(t),e=t,i+1):/[^\d]/.test(t)?(y(o.join("")),n=md,i):(o.push(t),e=t,i+1)}function k(){return t==="f"&&(o.push(t),e=t,i+=1),/[eE]/.test(t)||t==="-"&&/[eE]/.test(e)?(o.push(t),e=t,i+1):/[^\d]/.test(t)?(y(o.join("")),n=md,i):(o.push(t),e=t,i+1)}function $(){if(/[^\d\w_]/.test(t)){var N=o.join("");return n=wxt.indexOf(N)>-1?Ext:xxt.indexOf(N)>-1?Sxt:Txt,y(o.join("")),n=md,i}return o.push(t),e=t,i+1}}function Rxt(t){var e=Oxt(),r=[];return r=(r=r.concat(e(t))).concat(e(null))}function Mxt(t){return Rxt(t)}function Pxt(t){return t.map(e=>e.type!=="eof"?e.data:"").join("")}const Yz=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];function Ixt(t,e="100",r="300 es"){const i=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const s of t)if(s.type==="preprocessor"){const n=i.exec(s.data);if(n){const o=n[1].replaceAll(/\s\s+/g," ");if(o===r)return o;if(o===e)return s.data="#version "+r,e;throw new Error("unknown glsl version: "+o)}}return t.splice(0,0,{type:"preprocessor",data:"#version "+r},{type:"whitespace",data:`
`}),null}function $xt(t,e){for(let r=e-1;r>=0;r--){const i=t[r];if(i.type!=="whitespace"&&i.type!=="block-comment"){if(i.type!=="keyword")break;if(i.data==="attribute"||i.data==="in")return!0}}return!1}function aO(t,e,r,i){i=i||r;for(const s of t)if(s.type==="ident"&&s.data===r)return i in e?e[i]++:e[i]=0,aO(t,e,i+"_"+e[i],i);return r}function EMe(t,e,r="afterVersion"){function i(l,c){for(let h=c;h<l.length;h++){const p=l[h];if(p.type==="operator"&&p.data===";")return h}return null}function s(l){let c=-1,h=0,p=-1;for(let f=0;f<l.length;f++){const m=l[f];if(m.type==="preprocessor"&&(/\#(if|ifdef|ifndef)\s+.+/.test(m.data)?++h:/\#endif\s*.*/.test(m.data)&&--h),r!=="afterVersion"&&r!=="afterPrecision"||m.type==="preprocessor"&&/^#version/.test(m.data)&&(p=Math.max(p,f)),r==="afterPrecision"&&m.type==="keyword"&&m.data==="precision"){const y=i(l,f);if(y===null)throw new Error("precision statement not followed by any semicolons!");p=Math.max(p,y)}c<p&&h===0&&(c=f)}return c+1}const n={data:`
`,type:"whitespace"},o=l=>l<t.length&&/[^\r\n]$/.test(t[l].data);let a=s(t);o(a-1)&&t.splice(a++,0,n);for(const l of e)t.splice(a++,0,l);o(a-1)&&o(a)&&t.splice(a,0,n)}function Lxt(t,e,r,i="lowp"){EMe(t,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function Dxt(t,e,r,i,s="lowp"){EMe(t,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:i.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:s},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function Nxt(t,e){let r,i,s=-1;for(let n=e;n<t.length;n++){const o=t[n];if(o.type==="operator"&&(o.data==="["&&(r=n),o.data==="]")){i=n;break}o.type==="integer"&&(s=parseInt(o.data,10))}return r&&i&&t.splice(r,i-r+1),s}function zde(t,e){if(t.startsWith("#version 300"))return t;const r=Mxt(t);if(Ixt(r,"100","300 es")==="300 es")return t;let i=null,s=null;const n={},o={};for(let a=0;a<r.length;++a){const l=r[a];switch(l.type){case"keyword":e===uu.VERTEX_SHADER&&l.data==="attribute"?l.data="in":l.data==="varying"&&(l.data=e===uu.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(l.data.trim())&&(l.data=l.data.replaceAll(/(2D|Cube|EXT)/g,"")),e===uu.FRAGMENT_SHADER&&l.data==="gl_FragColor"&&(i||(i=aO(r,n,"fragColor"),Lxt(r,i,"vec4")),l.data=i),e===uu.FRAGMENT_SHADER&&l.data==="gl_FragData"){const c=Nxt(r,a+1),h=aO(r,n,"fragData");Dxt(r,h,"vec4",c,"mediump"),l.data=h}else e===uu.FRAGMENT_SHADER&&l.data==="gl_FragDepthEXT"&&(s||(s=aO(r,n,"gl_FragDepth")),l.data=s);break;case"ident":if(bxt.includes(l.data)){if(e===uu.VERTEX_SHADER&&$xt(r,a))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");l.data in o||(o[l.data]=aO(r,n,l.data)),l.data=o[l.data]}}}for(let a=r.length-1;a>=0;--a){const l=r[a];if(l.type==="preprocessor"){const c=l.data.match(/\#extension\s+(.*)\:/);if(c&&c[1]&&Yz.includes(c[1].trim())){const f=r[a+1];r.splice(a,f&&f.type==="whitespace"?2:1)}const h=l.data.match(/\#ifdef\s+(.*)/);h&&h[1]&&Yz.includes(h[1].trim())&&(l.data="#if 1");const p=l.data.match(/\#ifndef\s+(.*)/);p&&p[1]&&Yz.includes(p[1].trim())&&(l.data="#if 0")}}return Fxt(t,Pxt(r))}function Fxt(t,e){return e}const Uxt=4294967295;let kxt=class{constructor(e,r,i,s,n=new Map){this._context=e,this._locations=s,this._uniformBlockBindings=n,this._refCount=1,this._compiled=!1,this._nameToUniformLocation={},this._nameToUniform1={},this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,e||console.error("RenderingContext isn't initialized!"),r.length===0&&console.error("Shaders source should not be empty!"),this._context.type===cr.WEBGL2&&(r=zde(r,uu.VERTEX_SHADER),i=zde(i,uu.FRAGMENT_SHADER)),this._vShader=Vde(this._context,uu.VERTEX_SHADER,r),this._fShader=Vde(this._context,uu.FRAGMENT_SHADER,i),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(Rn.Shader,this),uH()&&(this.vertexShader=r,this.fragmentShader=i);const o=this._context.gl,a=o.createProgram();if(o.attachShader(a,this._vShader),o.attachShader(a,this._fShader),this._locations.forEach((l,c)=>o.bindAttribLocation(a,l,c)),o.linkProgram(a),uH()&&!o.getProgramParameter(a,o.LINK_STATUS)&&console.error(`Could not link shader
validated: ${o.getProgramParameter(a,o.VALIDATE_STATUS)}, gl error ${o.getError()}, vertex: ${o.getShaderParameter(this._vShader,o.COMPILE_STATUS)}, fragment: ${o.getShaderParameter(this._fShader,o.COMPILE_STATUS)}, info log: ${o.getProgramInfoLog(a)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`),this._context.type===cr.WEBGL2){const l=o;for(const[c,h]of this._uniformBlockBindings){const p=l.getUniformBlockIndex(a,c);p<Uxt&&l.uniformBlockBinding(a,p,h)}}this._glName=a,this._context.instanceCounter.increment(Rn.Program,this)}get glName(){return this._glName}get hasGLName(){return this._glName!=null}get compiled(){if(this._compiled)return!0;const e=this._context.gl.getExtension("KHR_parallel_shader_compile");return e==null||this.glName==null?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,e.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const e=this._context.gl;this._vShader&&(e.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(Rn.Shader,this)),this._fShader&&(e.deleteShader(this._fShader),this._fShader=null),this._glName&&(e.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(Rn.Program,this))}ref(){++this._refCount}_getUniformLocation(e){return this._nameToUniformLocation[e]===void 0&&this.glName!=null&&(this._nameToUniformLocation[e]=this._context.gl.getUniformLocation(this.glName,e)),this._nameToUniformLocation[e]}hasUniform(e){return this._getUniformLocation(e)!==null}setUniform1i(e,r){const i=this._nameToUniform1[e];i!==void 0&&r===i||(this._context.gl.uniform1i(this._getUniformLocation(e),r),this._nameToUniform1[e]=r)}setUniform1iv(e,r){ef(this._nameToUniform1v,e,r)&&this._context.gl.uniform1iv(this._getUniformLocation(e),r)}setUniform2iv(e,r){ef(this._nameToUniform2,e,r)&&this._context.gl.uniform2iv(this._getUniformLocation(e),r)}setUniform3iv(e,r){ef(this._nameToUniform3,e,r)&&this._context.gl.uniform3iv(this._getUniformLocation(e),r)}setUniform4iv(e,r){ef(this._nameToUniform4,e,r)&&this._context.gl.uniform4iv(this._getUniformLocation(e),r)}setUniform1f(e,r){const i=this._nameToUniform1[e];i!==void 0&&r===i||(this._context.gl.uniform1f(this._getUniformLocation(e),r),this._nameToUniform1[e]=r)}setUniform1fv(e,r){ef(this._nameToUniform1v,e,r)&&this._context.gl.uniform1fv(this._getUniformLocation(e),r)}setUniform2f(e,r,i){const s=this._nameToUniform2.get(e);s===void 0?(this._context.gl.uniform2f(this._getUniformLocation(e),r,i),this._nameToUniform2.set(e,[r,i])):r===s[0]&&i===s[1]||(this._context.gl.uniform2f(this._getUniformLocation(e),r,i),s[0]=r,s[1]=i)}setUniform2fv(e,r){ef(this._nameToUniform2,e,r)&&this._context.gl.uniform2fv(this._getUniformLocation(e),r)}setUniform3f(e,r,i,s){const n=this._nameToUniform3.get(e);n===void 0?(this._context.gl.uniform3f(this._getUniformLocation(e),r,i,s),this._nameToUniform3.set(e,[r,i,s])):r===n[0]&&i===n[1]&&s===n[2]||(this._context.gl.uniform3f(this._getUniformLocation(e),r,i,s),n[0]=r,n[1]=i,n[2]=s)}setUniform3fv(e,r){ef(this._nameToUniform3,e,r)&&this._context.gl.uniform3fv(this._getUniformLocation(e),r)}setUniform4f(e,r,i,s,n){const o=this._nameToUniform4.get(e);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(e),r,i,s,n),this._nameToUniform4.set(e,[r,i,s,n])):o!==void 0&&r===o[0]&&i===o[1]&&s===o[2]&&n===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(e),r,i,s,n),o[0]=r,o[1]=i,o[2]=s,o[3]=n)}setUniform4fv(e,r){ef(this._nameToUniform4,e,r)&&this._context.gl.uniform4fv(this._getUniformLocation(e),r)}setUniformMatrix3fv(e,r,i=!1){ef(this._nameToUniformMatrix3,e,r)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(e),i,r)}setUniformMatrix4fv(e,r,i=!1){ef(this._nameToUniformMatrix4,e,r)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(e),i,r)}stop(){}};function Vde(t,e,r){const i=t.gl,s=i.createShader(e);return i.shaderSource(s,r),i.compileShader(s),uH()&&!i.getShaderParameter(s,i.COMPILE_STATUS)&&(console.error("Compile error in ".concat(e===uu.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(i.getShaderInfoLog(s)),console.error(zxt(r))),s}function zxt(t){let e=2;return t.replaceAll(`
`,()=>`
`+Vxt(e++)+":")}function Vxt(t){return t>=1e3?t.toString():("  "+t).slice(-3)}function ef(t,e,r){const i=t.get(e);return i?tX(i,r):(t.set(e,Array.from(r)),!0)}let Bxt=class{constructor(e){this._rctx=e,this._store=new hC}dispose(){this._store.forEach(e=>e.forEach(r=>r.dispose())),this._store.clear()}acquire(e,r,i,s){const n=this._store.get(e,r);if(n!=null)return n.ref(),n;const o=new kxt(this._rctx,e,r,i,s);return o.ref(),this._store.set(e,r,o),o}get test(){let e=0;return this._store.forEach(r=>r.forEach(i=>e+=i.hasGLName?2:1)),{cachedWebGLObjects:e}}},gP=class{constructor(){this._result=!1}dispose(){this._program=Ve(this._program)}get result(){return this._program!=null&&(this._result=this._test(this._program),this.dispose()),this._result}},Gxt=class extends gP{constructor(e){super(),this._rctx=e,this._helperProgram=null,this._rctx.type===cr.WEBGL2&&oe("mac")&&oe("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){super.dispose(),this._helperProgram?.dispose(),this._helperProgram=null}_test(e){const r=this._rctx;r.resetState();const i=new xr(1);i.wrapMode=Dt.CLAMP_TO_EDGE,i.samplingMode=Rt.NEAREST;const s=new hn(r,i),n=Ur.createIndex(this._rctx,Cr.STATIC_DRAW,new Uint8Array([0]));r.bindFramebuffer(s),r.setViewport(0,0,1,1),r.useProgram(this._helperProgram),r.bindBuffer(n,Tt.ELEMENT_ARRAY_BUFFER),r.drawElements(At.POINTS,1,rt.UNSIGNED_BYTE,0),r.useProgram(e),r.bindVAO(null),r.drawArrays(At.TRIANGLES,0,258);const o=new Uint8Array(4);return s.readPixels(0,0,1,1,Ct.RGBA,Gs.UNSIGNED_BYTE,o),s.dispose(),n.dispose(),o[0]===255}_prepareProgram(){const r=`#version 300 es
    precision highp float;

    out float triangleId;

    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));

    void main(void) {
      triangleId = floor(float(gl_VertexID)/3.0);

      vec3 position = triangleVertices[gl_VertexID % 3];
      float offset = triangleId / ${w.float(85)};
      position.z = 0.5 - offset;

      gl_Position = vec4(position, 1.0);
    }
    `,i=`#version 300 es
    precision highp float;

    in float triangleId;

    out vec4 fragColor;

    void main(void) {
      fragColor = triangleId == ${w.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);
    }
    `;return this._rctx.programCache.acquire(r,i,new Map([]))}_prepareHelperProgram(){const e=wMe.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}},jxt=class extends gP{constructor(e){super(),this._rctx=e,this._program=Bde(this._rctx,!1),this._obfuscated=Bde(this._rctx,!0)}dispose(){super.dispose(),this._obfuscated=Ve(this._obfuscated)}_test(e){if(oe("force-double-precision-obfuscation"))return!0;if(this._obfuscated==null)return!1;const r=this._runProgram(e),i=this._runProgram(this._obfuscated);return r!==0&&(i===0||r/i>5)}_runProgram(e){const r=this._rctx;r.resetState();const i=new xr(1);i.wrapMode=Dt.CLAMP_TO_EDGE,i.samplingMode=Rt.NEAREST;const s=new hn(r,i),n=Ur.createVertex(r,Cr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new jh(r,new Map([["position",0]]),{geometry:[new bo("position",2,rt.UNSIGNED_SHORT,0,4)]},{geometry:n}),a=Me(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),l=Me(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),c=new Float32Array(6);QH(a,c,3);const h=new Float32Array(6);QH(l,h,3),r.useProgram(e),e.setUniform3f("u_highA",c[0],c[2],c[4]),e.setUniform3f("u_lowA",c[1],c[3],c[5]),e.setUniform3f("u_highB",h[0],h[2],h[4]),e.setUniform3f("u_lowB",h[1],h[3],h[5]),r.bindFramebuffer(s),r.setViewport(0,0,1,1),r.bindVAO(o),r.drawArrays(At.TRIANGLE_STRIP,0,4);const p=new Uint8Array(4);s.readPixels(0,0,1,1,Ct.RGBA,Gs.UNSIGNED_BYTE,p),o.dispose(),s.dispose();const f=(a[2]-l[2])/25,m=dQ(p);return Math.abs(f-m)}};function Bde(t,e){const r=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${e?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `,i=`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `;return t.programCache.acquire(r,i,new Map([["position",0]]))}let Hxt=class extends gP{constructor(e){if(super(),this._rctx=e,!e.gl)return;if(e.type===cr.WEBGL1)return void(this._result=!(!e.capabilities.textureFloat?.textureFloat||!e.capabilities.colorBufferFloat?.textureFloat));if(!(e.capabilities.textureFloat?.textureFloat&&e.capabilities.colorBufferFloat?.textureFloat&&e.capabilities.colorBufferFloat?.floatBlend))return;const r=`
    precision highp float;
    attribute vec2 a_pos;

    void main() {
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,i=`
     precision highp float;

     void main() {
      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
     }
    `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}_test(e){const r=this._rctx,i=new xr(1);i.wrapMode=Dt.CLAMP_TO_EDGE,i.dataType=Gs.FLOAT,i.internalFormat=Je.RGBA32F,i.samplingMode=Rt.NEAREST;const s=new hn(r,i),n=Ur.createVertex(r,Cr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new jh(r,new Map([["a_pos",0]]),{geometry:[new bo("a_pos",2,rt.UNSIGNED_SHORT,0,4)]},{geometry:n});r.useProgram(e);const a=r.getBoundFramebufferObject(),{x:l,y:c,width:h,height:p}=r.getViewport();r.bindFramebuffer(s),r.setViewport(0,0,1,1),r.bindVAO(o),r.drawArrays(At.TRIANGLE_STRIP,0,4);const f=Mt({blending:SEe});r.setPipelineState(f),r.drawArrays(At.TRIANGLE_STRIP,0,4);const m=r.gl.getError();return r.setViewport(l,c,h,p),r.bindFramebuffer(a),o.dispose(),s.dispose(),m!==1282||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}},qxt=class extends gP{constructor(e){super(),this._rctx=e;const r=`
      precision highp float;
      attribute vec2 a_pos;
      uniform highp sampler2D u_texture;
      varying vec4 v_color;

      float getBit(in float bitset, in int bitIndex) {
        float offset = pow(2.0, float(bitIndex));
        return mod(floor(bitset / offset), 2.0);
      }

      void main() {
        vec4 value = texture2D(u_texture, vec2(0.0));
        float bit = getBit(value.x * 255.0, 1);

        v_color = bit * vec4(1.0);
        gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
      }
      `,i=`
      precision highp float;
      varying vec4 v_color;

      void main() {
        gl_FragColor = v_color;
      }
      `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}_test(e){const r=this._rctx,i=new xr(1);i.wrapMode=Dt.CLAMP_TO_EDGE,i.samplingMode=Rt.NEAREST;const s=new hn(r,i),n=new Uint8Array(4),o=Ur.createVertex(r,Cr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),a=new jh(r,new Map([["a_position",0]]),{geometry:[new bo("a_position",2,rt.SHORT,0,4)]},{geometry:o});r.useProgram(e);const l=new Ot(r,i,new Uint8Array([2,255,0,0]));e.setUniform1i("u_texture",0),r.bindTexture(l,0);const c=r.getBoundFramebufferObject();r.bindFramebuffer(s),r.useProgram(e);const{x:h,y:p,width:f,height:m}=r.getViewport();r.setViewport(0,0,1,1),r.bindVAO(a),r.drawArrays(At.TRIANGLE_STRIP,0,4),r.setViewport(h,p,f,m),s.readPixels(0,0,1,1,Ct.RGBA,Gs.UNSIGNED_BYTE,n),a.dispose(),s.dispose();const y=n[0]!==255||n[1]!==255||n[2]!==255||n[3]!==255;return y&&Q.getLogger("esri.views.webgl.testSamplerPrecision").warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${n[0]}.${n[1]}.${n[2]}.${n[3]}]`),r.bindFramebuffer(c),y}};new bo("a_pos",2,rt.BYTE,0,2);new bo("a_pos",2,rt.BYTE,0,4),new bo("a_tex",2,rt.BYTE,2,4);const Wxt={geometry:[new bo("a_pos",2,rt.UNSIGNED_SHORT,0,4)]};let Xxt=class extends gP{constructor(e){super(),this._rctx=e;const r=`
    precision highp float;

    attribute vec2 a_pos;
    varying vec2 v_uv;

    void main() {
      v_uv = a_pos;
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,i=`
    precision highp float;

    varying vec2 v_uv;

    uniform sampler2D u_texture;

    void main() {
      gl_FragColor = texture2D(u_texture, v_uv);
    }
    `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(e){const r=this._rctx;if(!r.gl)return e.dispose(),!0;const i=new xr(1);i.wrapMode=Dt.CLAMP_TO_EDGE,i.samplingMode=Rt.NEAREST;const s=new hn(r,i),n=Ur.createVertex(r,Cr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new jh(r,new Map([["a_pos",0]]),Wxt,{geometry:n}),a=new xr;a.samplingMode=Rt.LINEAR,a.wrapMode=Dt.CLAMP_TO_EDGE;const l=new Ot(r,a,lO);r.useProgram(e),r.bindTexture(l,0),e.setUniform1i("u_texture",0);const c=r.getBoundFramebufferObject(),{x:h,y:p,width:f,height:m}=r.getViewport();r.bindFramebuffer(s),r.setViewport(0,0,1,1),r.setClearColor(0,0,0,0),r.setBlendingEnabled(!1),r.clearSafe(Ti.COLOR_BUFFER_BIT),r.bindVAO(o),r.drawArrays(At.TRIANGLE_STRIP,0,4);const y=new Uint8Array(4);return s.readPixels(0,0,1,1,Ct.RGBA,Gs.UNSIGNED_BYTE,y),o.dispose(),s.dispose(),l.dispose(),r.setViewport(h,p,f,m),r.bindFramebuffer(c),y[0]!==255}};const lO=new Image;lO.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",lO.width=5,lO.height=5,lO.decode();let Zxt=class{constructor(e){this.rctx=e,this.floatBufferBlend=new Hxt(e),this.svgPremultipliesAlpha=new Xxt(e),this.doublePrecisionRequiresObfuscation=new jxt(e),this.ignoresSamplerPrecision=new qxt(e),this.drawArraysRequiresIndicesTypeReset=new Gxt(e)}dispose(){this.ignoresSamplerPrecision.dispose(),this.doublePrecisionRequiresObfuscation.dispose(),this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}};function Yxt(t,e){if(e.disjointTimerQuery)return null;if(Ip(t))return{drawBuffers:t.drawBuffers.bind(t),MAX_DRAW_BUFFERS:t.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:t.MAX_COLOR_ATTACHMENTS};if(e.drawBuffers)return null;const r=t.getExtension("WEBGL_draw_buffers");return r?{drawBuffers:r.drawBuffersWEBGL.bind(r),MAX_DRAW_BUFFERS:r.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:r.MAX_COLOR_ATTACHMENTS_WEBGL}:null}function Jxt(t){if(Ip(t))return t;const e=t.getExtension("ANGLE_instanced_arrays");return e?{drawArraysInstanced:e.drawArraysInstancedANGLE.bind(e),drawElementsInstanced:e.drawElementsInstancedANGLE.bind(e),vertexAttribDivisor:e.vertexAttribDivisorANGLE.bind(e)}:null}function Qxt(t,e){if(e.compressedTextureETC)return null;const r=t.getExtension("WEBGL_compressed_texture_etc");return r?{COMPRESSED_R11_EAC:r.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:r.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:r.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:r.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:r.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:r.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function Kxt(t,e){if(e.compressedTextureS3TC)return null;const r=t.getExtension("WEBGL_compressed_texture_s3tc");return r?{COMPRESSED_RGB_S3TC_DXT1:r.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:r.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:r.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:r.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function eTt(t,e){if(Ip(t))return{MIN:t.MIN,MAX:t.MAX};if(e.blendMinMax)return null;{const r=t.getExtension("EXT_blend_minmax");return r?{MIN:r.MIN_EXT,MAX:r.MAX_EXT}:null}}function tTt(t,e){if(e.textureFilterAnisotropic)return null;const r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return r?{MAX_TEXTURE_MAX_ANISOTROPY:r.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:r.TEXTURE_MAX_ANISOTROPY_EXT}:null}function rTt(t,e){if(Ip(t))return{textureFloat:!0,textureFloatLinear:!e.textureFloatLinear&&!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:t.HALF_FLOAT,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F};if(t instanceof WebGLRenderingContext){const r=!e.textureHalfFloat&&t.getExtension("OES_texture_half_float");return{textureFloat:!e.textureFloat&&!!t.getExtension("OES_texture_float"),textureFloatLinear:!e.textureFloatLinear&&!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!!r,textureHalfFloatLinear:!e.textureHalfFloatLinear&&!!t.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:r?r.HALF_FLOAT_OES:void 0}}return null}function iTt(t,e){if(Ip(t)){const r=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float")||!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),i=!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),s=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return r||i||s?{textureFloat:!!i,textureHalfFloat:!!r,floatBlend:!!s,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F}:null}if(t instanceof WebGLRenderingContext){const r=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float"),i=!e.colorBufferFloat&&t.getExtension("WEBGL_color_buffer_float"),s=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return r||i||s?{textureFloat:!!i,textureHalfFloat:!!r,floatBlend:!!s,RGBA16F:r?r.RGBA16F_EXT:void 0,RGB16F:r?r.RGB16F_EXT:void 0,RGBA32F:i?i.RGBA32F_EXT:void 0}:null}return null}function Gde(t,e,r,i,s){if(i&&Ip(t))return!0;if(e[r])return!1;for(const n of s)if(t.getExtension(n))return!0;return!1}function sTt(t,e){if(!Ip(t)||e.textureNorm16)return null;const r=t.getExtension("EXT_texture_norm16");return r?{R16:r.R16_EXT,RG16:r.RG16_EXT,RGB16:r.RGB16_EXT,RGBA16:r.RGBA16_EXT,R16_SNORM:r.R16_SNORM_EXT,RG16_SNORM:r.RG16_SNORM_EXT,RGB16_SNORM:r.RGB16_SNORM_EXT,RGBA16_SNORM:r.RGBA16_SNORM_EXT}:null}function nTt(t,e){const r=e.loseContext&&t.getExtension("WEBGL_lose_context");return r?{loseRenderingContext:()=>r.loseContext()}:null}function oTt(t,e){if(Ip(t))return{createVertexArray:t.createVertexArray.bind(t),deleteVertexArray:t.deleteVertexArray.bind(t),bindVertexArray:t.bindVertexArray.bind(t)};if(e.vao)return null;const r=t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object");return r?{createVertexArray:r.createVertexArrayOES.bind(r),deleteVertexArray:r.deleteVertexArrayOES.bind(r),bindVertexArray:r.bindVertexArrayOES.bind(r)}:null}let aTt=class{constructor(e,r){this._gl=e,this._instancing=null,this._vertexArrayObject=null,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._textureFloat=null,this._colorBufferFloat=null,this._minMaxBlending=null,this._loseContext=null,this._drawBuffers=null,this._textureNorm16=null,this._depthTexture=null,this._textureFloatLinear=null,this._disabledExtensions=r.disabledExtensions||{},this._debugWebGLExtensions=r.debugWebGLExtensions||{}}get drawBuffers(){return this._drawBuffers||(this._drawBuffers=Yxt(this._gl,this._disabledExtensions)),this._drawBuffers}get instancing(){return this._instancing||(this._instancing=Jxt(this._gl)),this._instancing}get vao(){return this._vertexArrayObject||(this._vertexArrayObject=oTt(this._gl,this._disabledExtensions)),this._vertexArrayObject}get compressedTextureETC(){return this._compressedTextureETC||(this._compressedTextureETC=Qxt(this._gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=Kxt(this._gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=tTt(this._gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery||(this._disjointTimerQuery=hxt(this._gl,this._disabledExtensions)),this._disjointTimerQuery}get textureFloat(){return this._textureFloat||(this._textureFloat=rTt(this._gl,this._disabledExtensions)),this._textureFloat}get colorBufferFloat(){return this._colorBufferFloat||(this._colorBufferFloat=iTt(this._gl,this._disabledExtensions)),this._colorBufferFloat}get blendMinMax(){return this._minMaxBlending||(this._minMaxBlending=eTt(this._gl,this._disabledExtensions)),this._minMaxBlending}get depthTexture(){return this._depthTexture===null&&(this._depthTexture=Gde(this._gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}get loseContext(){return this._loseContext||(this._loseContext=nTt(this._gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16||(this._textureNorm16=sTt(this._gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear===null&&(this._textureFloatLinear=Gde(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(e){return this[e]}},lTt=class{constructor(e,r){this.gl=e,this.instanceCounter=new _xt,this.programCache=new Bxt(this),this._state=new Mde,this._numOfDrawCalls=0,this._numOfTriangles=0,this.type=Ip(e)?cr.WEBGL2:cr.WEBGL1,this._loadExtensions(),this.configure(r)}get gl2(){return this.type===cr.WEBGL1?null:this.gl}configure(e){this._capabilities=new aTt(this.gl,e),this._parameters=new vxt(this.gl,this._capabilities,e),Ot.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;const r=this.gl.getParameter(this.gl.VIEWPORT);this._state=new Mde,this._state.viewport={x:r[0],y:r[1],width:r[2],height:r[3]},this._stateTracker=new cJe({setBlending:i=>{if(i){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(i.opRgb,i.opAlpha),this.setBlendFunctionSeparate(i.srcRgb,i.dstRgb,i.srcAlpha,i.dstAlpha);const s=i.color;this.setBlendColor(s.r,s.g,s.b,s.a)}else this.setBlendingEnabled(!1)},setCulling:i=>{i?(this.setFaceCullingEnabled(!0),this.setCullFace(i.face),this.setFrontFace(i.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:i=>{i?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(i.factor,i.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:i=>{i?(this.setDepthTestEnabled(!0),this.setDepthFunction(i.func)):this.setDepthTestEnabled(!1)},setStencilTest:i=>{if(i){this.setStencilTestEnabled(!0);const s=i.function;this.setStencilFunction(s.func,s.ref,s.mask);const n=i.operation;this.setStencilOp(n.fail,n.zFail,n.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:i=>{i?(this.setDepthWriteEnabled(!0),this.setDepthRange(i.zNear,i.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:i=>{i?this.setColorMask(i.r,i.g,i.b,i.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:i=>{i?this.setStencilWriteMask(i.mask):this.setStencilWriteMask(0)}}),this.enforceState(),Ve(this._driverTest),this._driverTest=new Zxt(this)}dispose(){Ve(this._driverTest),this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(Tt.ARRAY_BUFFER),this.unbindBuffer(Tt.ELEMENT_ARRAY_BUFFER),this.type===cr.WEBGL2&&(this.unbindBuffer(Tt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Tt.PIXEL_PACK_BUFFER),this.unbindBuffer(Tt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Tt.COPY_READ_BUFFER),this.unbindBuffer(Tt.COPY_WRITE_BUFFER)),this._state.textureUnitMap.length=0,hh()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._state.blend!==e&&(e===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=e,this._stateTracker.invalidateBlending())}externalProgramUpdate(){this._state.program?.stop(),this._state.program=null}externalTextureUnitUpdate(e,r){for(let i=0;i<e.length;++i)this._state.textureUnitMap[e[i]]=null;r>=0&&(this._state.activeTexture=r)}externalVertexArrayObjectUpdate(){const e=this.capabilities.vao;e&&(e.bindVertexArray(null),this._state.vertexArrayObject=null),this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(e,r,i,s){e===this._state.blendColor.r&&r===this._state.blendColor.g&&i===this._state.blendColor.b&&s===this._state.blendColor.a||(this.gl.blendColor(e,r,i,s),this._state.blendColor.r=e,this._state.blendColor.g=r,this._state.blendColor.b=i,this._state.blendColor.a=s,this._stateTracker.invalidateBlending())}setBlendFunction(e,r){e===this._state.blendFunction.srcRGB&&r===this._state.blendFunction.dstRGB||(this.gl.blendFunc(e,r),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=e,this._state.blendFunction.dstRGB=r,this._state.blendFunction.dstAlpha=r,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,r,i,s){this._state.blendFunction.srcRGB===e&&this._state.blendFunction.srcAlpha===i&&this._state.blendFunction.dstRGB===r&&this._state.blendFunction.dstAlpha===s||(this.gl.blendFuncSeparate(e,r,i,s),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=i,this._state.blendFunction.dstRGB=r,this._state.blendFunction.dstAlpha=s,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._state.blendEquation.mode!==e&&(this.gl.blendEquation(e),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,r){this._state.blendEquation.mode===e&&this._state.blendEquation.modeAlpha===r||(this.gl.blendEquationSeparate(e,r),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=r,this._stateTracker.invalidateBlending())}setColorMask(e,r,i,s){this._state.colorMask.r===e&&this._state.colorMask.g===r&&this._state.colorMask.b===i&&this._state.colorMask.a===s||(this.gl.colorMask(e,r,i,s),this._state.colorMask.r=e,this._state.colorMask.g=r,this._state.colorMask.b=i,this._state.colorMask.a=s,this._stateTracker.invalidateColorWrite())}setClearColor(e,r,i,s){this._state.clearColor.r===e&&this._state.clearColor.g===r&&this._state.clearColor.b===i&&this._state.clearColor.a===s||(this.gl.clearColor(e,r,i,s),this._state.clearColor.r=e,this._state.clearColor.g=r,this._state.clearColor.b=i,this._state.clearColor.a=s)}setFaceCullingEnabled(e){this._state.faceCulling!==e&&(e===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._state.polygonOffsetFill!==e&&(e===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,r){this._state.polygonOffset[0]===e&&this._state.polygonOffset[1]===r||(this._state.polygonOffset[0]=e,this._state.polygonOffset[1]=r,this.gl.polygonOffset(e,r),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._state.cullFace!==e&&(this.gl.cullFace(e),this._state.cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._state.frontFace!==e&&(this.gl.frontFace(e),this._state.frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._state.scissorTest!==e&&(e===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=e)}setScissorRect(e,r,i,s){this._state.scissorRect.x===e&&this._state.scissorRect.y===r&&this._state.scissorRect.width===i&&this._state.scissorRect.height===s||(this.gl.scissor(e,r,i,s),this._state.scissorRect.x=e,this._state.scissorRect.y=r,this._state.scissorRect.width=i,this._state.scissorRect.height=s)}setDepthTestEnabled(e){this._state.depthTest!==e&&(e===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._state.clearDepth!==e&&(this.gl.clearDepth(e),this._state.clearDepth=e)}setDepthFunction(e){this._state.depthFunction!==e&&(this.gl.depthFunc(e),this._state.depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._state.depthWrite!==e&&(this.gl.depthMask(e),this._state.depthWrite=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,r){this._state.depthRange.zNear===e&&this._state.depthRange.zFar===r||(this.gl.depthRange(e,r),this._state.depthRange.zNear=e,this._state.depthRange.zFar=r,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._state.stencilTest!==e&&(e===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._state.clearStencil&&(this.gl.clearStencil(e),this._state.clearStencil=e)}setStencilFunction(e,r,i){this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===i||(this.gl.stencilFunc(e,r,i),this._state.stencilFunction.face=ap.FRONT_AND_BACK,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=i,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,r,i,s){this._state.stencilFunction.face===e&&this._state.stencilFunction.func===r&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===s||(this.gl.stencilFuncSeparate(e,r,i,s),this._state.stencilFunction.face=e,this._state.stencilFunction.func=r,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=s,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._state.stencilWriteMask!==e&&(this.gl.stencilMask(e),this._state.stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,r,i){this._state.stencilOperation.face===ap.FRONT_AND_BACK&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===i||(this.gl.stencilOp(e,r,i),this._state.stencilOperation.face=ap.FRONT_AND_BACK,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=i,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,r,i,s){this._state.stencilOperation.face===e&&this._state.stencilOperation.fail===r&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===s||(this.gl.stencilOpSeparate(e,r,i,s),this._state.stencilOperation.face=e,this._state.stencilOperation.fail=r,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=s,this._stateTracker.invalidateStencilTest())}setActiveTexture(e,r=!1){const i=this._state.activeTexture;return e>=0&&(r||e!==this._state.activeTexture)&&(this.gl.activeTexture(A9+e),this._state.activeTexture=e),i}clear(e){e&&this.gl.clear(e)}clearSafe(e,r=255){e&&(e&Ti.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),e&Ti.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),e&Ti.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(r),this.gl.clear(e))}drawArrays(e,r,i){if(hh()&&(this._numOfDrawCalls++,this._numOfTriangles+=jde(e,i)),this.gl.drawArrays(e,r,i),hh()){const s=Zse(this);s&&console.error("drawArrays:",s)}}drawElements(e,r,i,s){if(hh()&&(this._numOfDrawCalls++,this._numOfTriangles+=jde(e,r)),this.gl.drawElements(e,r,i,s),hh()){const n=Zse(this);if(n){const o=this.getBoundVAO(),a=o?.indexBuffer,l=o?.vertexBuffers,c={indexBuffer:a,vertexBuffers:l},h={mode:e,count:r,type:i,offset:s},p=a?.size??0,f=s+r,m=p<f?`. Buffer is too small. Attempted to draw index ${f} of ${p}`:"";console.error(`drawElements: ${n}${m}`,{args:h,vao:c})}}}logInfo(){hh()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){hh()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(e,r,i,s){i=Math.max(Math.round(i),1),s=Math.max(Math.round(s),1);const n=this._state.viewport;n.x===e&&n.y===r&&n.width===i&&n.height===s||(n.x=e,n.y=r,n.width=i,n.height=s,this.gl.viewport(e,r,i,s))}getViewport(){const e=this._state.viewport;return{x:e.x,y:e.y,width:e.width,height:e.height}}useProgram(e){this._state.program!==e&&(this._state.program?.stop(),this._state.program=e,this.gl.useProgram(e?.glName??null))}bindTexture(e,r,i=!1){(r>=this.parameters.maxTextureImageUnits||r<0)&&console.error("Input texture unit is out of range of available units!");const s=this._state.textureUnitMap[r];return e==null||e.glName==null?(s!=null&&(this.setActiveTexture(r,i),this.gl.bindTexture(s.descriptor.target,null)),this._state.textureUnitMap[r]=null,s):i||s!==e?(this.setActiveTexture(r,i),this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._state.textureUnitMap[r]=e,s):(e.isDirty&&(this.setActiveTexture(r,i),e.applyChanges()),s)}unbindTexture(e){if(e!=null)for(let r=0;r<this.parameters.maxTextureImageUnits;r++)this._state.textureUnitMap[r]===e&&(this.bindTexture(null,r),this._state.textureUnitMap[r]=null)}bindFramebuffer(e,r=!1){if(r||this._state.readFramebuffer!==e||this._state.drawFramebuffer!==e){if(e==null)return this.gl.bindFramebuffer(fo.FRAMEBUFFER,null),this._state.readFramebuffer=null,void(this._state.drawFramebuffer=null);e.initializeAndBind(fo.FRAMEBUFFER),this._state.readFramebuffer=e,this._state.drawFramebuffer=e}}bindFramebufferSeparate(e,r,i=!1){const s=r===fo.READ_FRAMEBUFFER,n=s?this._state.readFramebuffer:this._state.drawFramebuffer;(i||n!==e)&&(e==null?this.gl.bindFramebuffer(r,null):e.initializeAndBind(r),s?this._state.readFramebuffer=e??null:this._state.drawFramebuffer=e??null)}blitFramebuffer(e,r,i=0,s=0,n=e.width,o=e.height,a=0,l=0,c=r.width,h=r.height,p=Ti.COLOR_BUFFER_BIT,f=Rt.NEAREST){this.bindFramebufferSeparate(e,fo.READ_FRAMEBUFFER),this.bindFramebufferSeparate(r,fo.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(i,s,n,o,a,l,c,h,p,f)}bindBuffer(e,r){if(e)switch(r??(r=e.bufferType),r){case Tt.ARRAY_BUFFER:this._state.vertexBuffer=Xl(this.gl,e,r,this._state.vertexBuffer);break;case Tt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=Xl(this.gl,e,r,this._state.indexBuffer);break;case Tt.UNIFORM_BUFFER:this._state.uniformBuffer=Xl(this.gl,e,r,this._state.uniformBuffer);break;case Tt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=Xl(this.gl,e,r,this._state.pixelPackBuffer);break;case Tt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=Xl(this.gl,e,r,this._state.pixelUnpackBuffer);break;case Tt.COPY_READ_BUFFER:this._state.copyReadBuffer=Xl(this.gl,e,r,this._state.copyReadBuffer);break;case Tt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=Xl(this.gl,e,r,this._state.copyWriteBuffer)}}bindRenderbuffer(e){const r=this.gl;e||(r.bindRenderbuffer(r.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==e&&(r.bindRenderbuffer(r.RENDERBUFFER,e.glName),this._state.renderbuffer=e)}_getBufferBinding(e,r){if(r>=this.parameters.maxUniformBufferBindings||r<0)return console.error("Uniform buffer binding point is out of range!"),null;const i=this._state.uniformBufferBindingPoints;let s=i[r];return s==null&&(s={buffer:null,offset:0,size:0},i[r]=s),s}bindBufferBase(e,r,i){const s=this._getBufferBinding(e,r);s!=null&&(s.buffer===i&&s.offset===0&&s.size===0||(this.gl.bindBufferBase(e,r,i?i.glName:null),s.buffer=i,s.offset=0,s.size=0))}bindBufferRange(e,r,i,s,n){const o=this._getBufferBinding(e,r);if(o!=null&&!(o.buffer===i&&o.offset===s&&o.size===n)){if(s%this._parameters.uniformBufferOffsetAlignment!=0)return void console.error("Uniform buffer binding offset is not a multiple of the context offset alignment");this.gl.bindBufferRange(e,r,i.glName,s,n),o.buffer=i,o.offset=s,o.size=n}}bindUBO(e,r,i,s){r!=null?(hh()&&(s??r.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),r.initialize(),i!==void 0&&s!==void 0?this.bindBufferRange(Tt.UNIFORM_BUFFER,e,r.buffer,i,s):this.bindBufferBase(Tt.UNIFORM_BUFFER,e,r.buffer)):this.bindBufferBase(Tt.UNIFORM_BUFFER,e,null)}unbindUBO(e){for(let r=0,i=this._state.uniformBufferBindingPoints.length;r<i;r++){const s=this._state.uniformBufferBindingPoints[r];s!=null&&s.buffer===e.buffer&&this.bindBufferBase(Tt.UNIFORM_BUFFER,r,null)}}unbindBuffer(e){switch(e){case Tt.ARRAY_BUFFER:this._state.vertexBuffer=Xl(this.gl,null,e,this._state.vertexBuffer);break;case Tt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=Xl(this.gl,null,e,this._state.indexBuffer);break;case Tt.UNIFORM_BUFFER:this._state.uniformBuffer=Xl(this.gl,null,e,this._state.uniformBuffer);break;case Tt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=Xl(this.gl,null,e,this._state.pixelPackBuffer);break;case Tt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=Xl(this.gl,null,e,this._state.pixelUnpackBuffer);break;case Tt.COPY_READ_BUFFER:this._state.copyReadBuffer=Xl(this.gl,null,e,this._state.copyReadBuffer);break;case Tt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=Xl(this.gl,null,e,this._state.copyWriteBuffer)}}bindVAO(e=null){e!=null?this._state.vertexArrayObject!==e&&(e.bind(),this._state.vertexArrayObject=e):this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null)}async clientWaitAsync(e=10){const r=this.gl,i=r.fenceSync(cH.SYNC_GPU_COMMANDS_COMPLETE,0);if(!i)throw new Error("Client wait failed, could not create sync object");let s;this.instanceCounter.increment(Rn.Sync,i),r.flush();do await U2(e),s=r.clientWaitSync(i,0,0);while(s===tF.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(Rn.Sync,i),r.deleteSync(i),s===tF.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(e=fo.FRAMEBUFFER){return e===fo.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(Tt.ARRAY_BUFFER),this.unbindBuffer(Tt.ELEMENT_ARRAY_BUFFER),this.type===cr.WEBGL2&&(this.unbindBuffer(Tt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Tt.PIXEL_PACK_BUFFER),this.unbindBuffer(Tt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Tt.COPY_READ_BUFFER),this.unbindBuffer(Tt.COPY_WRITE_BUFFER));for(let e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(xe.ONE,xe.ZERO),this.setBlendEquation(dm.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(ap.BACK),this.setFrontFace(fE.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(ti.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(ti.ALWAYS,0,0),this.setStencilOp(_s.KEEP,_s.KEEP,_s.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){const e=this.capabilities.vao;e&&e.bindVertexArray(null);const{gl:r,gl2:i}=this;for(let n=0;n<this.parameters.maxVertexAttributes;n++)r.disableVertexAttribArray(n);if(this._state.vertexBuffer?r.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):r.bindBuffer(Tt.ARRAY_BUFFER,null),this._state.indexBuffer?r.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):r.bindBuffer(Tt.ELEMENT_ARRAY_BUFFER,null),i!=null){this._state.uniformBuffer?i.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):i.bindBuffer(Tt.UNIFORM_BUFFER,null);for(let n=0;n<this._parameters.maxUniformBufferBindings;n++){const o=this._state.uniformBufferBindingPoints[n];if(o!=null){const{buffer:a,offset:l,size:c}=o;a!==null?l===0&&c===0?i.bindBufferBase(Tt.UNIFORM_BUFFER,n,a.glName):i.bindBufferRange(Tt.UNIFORM_BUFFER,n,a.glName,l,c):i.bindBufferBase(Tt.UNIFORM_BUFFER,n,null)}}this._state.pixelPackBuffer?i.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):i.bindBuffer(Tt.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?i.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):i.bindBuffer(Tt.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?i.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):i.bindBuffer(Tt.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?i.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):i.bindBuffer(Tt.COPY_WRITE_BUFFER,null),i.bindFramebuffer(fo.READ_FRAMEBUFFER,null),i.readBuffer(i.BACK),this._state.readFramebuffer&&(i.bindFramebuffer(fo.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),i.readBuffer(ru.COLOR_ATTACHMENT0)),i.bindFramebuffer(fo.DRAW_FRAMEBUFFER,this._state.drawFramebuffer?.glName??null)}else this._state.readFramebuffer=this._state.drawFramebuffer,r.bindFramebuffer(fo.FRAMEBUFFER,this._state.drawFramebuffer?.glName??null);if(e&&this._state.vertexArrayObject){const n=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(n)}r.useProgram(this._state.program?.glName??null),r.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),r.bindRenderbuffer(r.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null),this._state.blend===!0?r.enable(this.gl.BLEND):r.disable(this.gl.BLEND),r.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),r.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),r.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),r.clearDepth(this._state.clearDepth),r.clearStencil(this._state.clearStencil),r.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),r.cullFace(this._state.cullFace),r.depthFunc(this._state.depthFunction),r.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),r.depthMask(this._state.depthWrite),r.frontFace(this._state.frontFace),r.lineWidth(1),this._state.faceCulling===!0?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),r.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?r.enable(r.POLYGON_OFFSET_FILL):r.disable(r.POLYGON_OFFSET_FILL),r.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?r.enable(r.SCISSOR_TEST):r.disable(r.SCISSOR_TEST),r.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),r.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),r.stencilMask(this._state.stencilWriteMask);for(let n=0;n<this.parameters.maxTextureImageUnits;n++){r.activeTexture(A9+n),r.bindTexture(as.TEXTURE_2D,null),r.bindTexture(as.TEXTURE_CUBE_MAP,null),this.type===cr.WEBGL2&&(r.bindTexture(as.TEXTURE_3D,null),r.bindTexture(as.TEXTURE_2D_ARRAY,null));const o=this._state.textureUnitMap[n];o!=null&&r.bindTexture(o.descriptor.target,o.glName)}r.activeTexture(A9+this._state.activeTexture);const s=this._state.viewport;r.viewport(s.x,s.y,s.width,s.height),this.resetInfo()}_loadExtensions(){this.type===cr.WEBGL1&&this.gl.getExtension("OES_element_index_uint"),this.gl.getExtension("KHR_parallel_shader_compile")}};function Xl(t,e,r,i){return e?i!==e&&t.bindBuffer(r,e.glName):t.bindBuffer(r,null),e}function jde(t,e){switch(t){case At.POINTS:return 2*e;case At.TRIANGLES:return e/3;case At.TRIANGLE_STRIP:case At.TRIANGLE_FAN:return e-2;default:return 0}}let cTt=class extends lTt{constructor(e,r,i){super(e,r),this.newCache=i,this._refCount=1,this._appleAmdDriverHelper=null}destroy(){--this._refCount>0||this.dispose()}ref(){++this._refCount}dispose(){super.dispose(),this._appleAmdDriverHelper?.dispose()}bindTechnique(e,r,i,s){return this.useProgram(e.program),e.bindPipelineState(this,i?.slot,!!s),e.program.bindPass(r,i),e.program}get appleAmdDriverHelper(){return this.driverTest.drawArraysRequiresIndicesTypeReset.result?(this._appleAmdDriverHelper=this._appleAmdDriverHelper??new wMe(this),this._appleAmdDriverHelper):null}get test(){return this.programCache.test}},CS=class extends we{constructor(e,r,i){super({}),this._stage=e,this._techniqueRepository=r,this._rctx=i,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new ws,this._frameTask=e.view.resourceController.scheduler.registerTask(vt.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this._stage.forEachOfType(ls.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return this._textureTechnique==null&&(this._textureTechnique=this._techniqueRepository.acquire(jQ,new HQ)),this._textureTechnique}acquire(e){const r=this._textures.get(e);return r?(r.ref(),r.loadingPromise??r):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(r=>{const i=r.texture.frameUpdate(r.previousToken);i>=0&&i!==r.previousToken&&(r.previousToken=i,e=!0)}),e&&this.events.emit("changed",gs.BACKGROUND)}_createNewRef(e){const r=this._stage.getObject(e);if(r==null)return nt(r!==void 0),null;const i=r.events.on("unloaded",()=>{i.remove(),this._onTextureUnloaded(e)}),s=new uTt(e,()=>{this._frameTask.schedule(()=>{s.isUnreferenced&&r.unload()})});return this._textures.set(e,s),s.ref(),r.glTexture!=null?(this._updateGLTexture(s,r.glTexture),r.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:r,previousToken:-1}),s):(this._loadingCount++,s.loadingPromise=this._stage.schedule(()=>{const n=r.load(this._rctx),o=l=>(this._loadingCount--,s.loadingPromise=null,this._updateGLTexture(s,l),r.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:r,previousToken:-1}),s),a=l=>(this._loadingCount--,s.loadingPromise=null,us(l)||Q.getLogger(this).error(l),null);return Iu(n)?n.then(o,a):o(n)}),s.loadingPromise)}_updateGLTexture(e,r){e.glTexture=r,this.events.emit("changed",gs.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};u([d()],CS.prototype,"_loadingCount",void 0),u([d()],CS.prototype,"_frameTask",void 0),u([d()],CS.prototype,"updating",null),CS=u([P("esri.views.3d.webgl-engine.lib.TextureRepository")],CS);let uTt=class{constructor(e,r){this.id=e,this._release=r,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(Q.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}};function hTt(t,e){return new ZCe(r=>Ilt(r,t),r=>r,e)}let cO=class extends we{constructor(){super(...arguments),this._passParameters=new dTt,this._loading=0}get passParameters(){return this._passParameters}destroy(){this._passParameters.waveNormal=Ve(this._passParameters.waveNormal),this._passParameters.wavePertubation=Ve(this._passParameters.wavePertubation)}get updating(){return this._loading>0}ensureResources(e){if(this._loading>0)return Wg.LOADING;if(this._passParameters.waveNormal!=null&&this._passParameters.wavePertubation!=null)return Wg.LOADED;const r=new xr;return r.samplingMode=Rt.LINEAR_MIPMAP_LINEAR,r.hasMipmap=!0,r.maxAnisotropy=8,++this._loading,yy(Gr("esri/images/materials/water/normals.jpg")).then(i=>this._passParameters.waveNormal=new Ot(e,{...r,width:i.width,height:i.height},i)).catch(i=>Q.getLogger(this).error("Failed to load water material normal texture.",i)).finally(()=>--this._loading),++this._loading,yy(Gr("esri/images/materials/water/perturbation.jpg")).then(i=>this._passParameters.wavePertubation=new Ot(e,{...r,width:i.width,height:i.height},i)).catch(i=>Q.getLogger(this).error("Failed to load water material pertubation texture.",i)).finally(()=>--this._loading),Wg.LOADING}};u([d()],cO.prototype,"_loading",void 0),u([d({type:Boolean,readOnly:!0})],cO.prototype,"updating",null),cO=u([P("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],cO);let dTt=class extends ri{};const Hde=2048,pTt=1.5,fTt=8;function mTt(t,e){const{format:r,quality:i,rotation:s,disableDecorations:n}=t||{},o=LK(t,e.padding),a=xTt(t,{width:e.width-o.left-o.right,height:e.height-o.top-o.bottom}),{width:l,height:c}=wTt(t,a),h=ETt(r),p=MTt[h];return{format:h,quality:ve(i??p,0,100),area:a,width:l,height:c,rotation:s,disableDecorations:!!n,ignoreBackground:!(!t||!t.ignoreBackground),ignorePadding:!(!t||!t.ignorePadding)}}function gTt(t,e){const r=mTt(t,e),i=r.area,s=r.width/i.width,n=LK(r,e.padding),o=n.left+n.right,a=n.top+n.bottom,l=e.width-o,c=e.height-a,h=Math.floor(l*s+o),p=Math.floor(c*s+a),f=t&&t.layers?t.layers:[],m=r.ignoreBackground,y=r.ignorePadding;return{framebufferWidth:h,framebufferHeight:p,region:{x:Math.floor(i.x*s)+n.left,y:Math.floor(i.y*s)+n.top,width:r.width,height:r.height},format:r.format,quality:r.quality,rotation:r.rotation,pixelRatio:s,layers:f,disableDecorations:r.disableDecorations,ignoreBackground:m,ignorePadding:y,objectAndLayerIdColor:!1}}function Jz(t,e,r){const{ctx:i,canvas:s}=CMe(t,r),n=i.getImageData(0,0,t.width,t.height),o=_Tt(s,e);return AMe(s),{dataUrl:o,data:n}}function Qz(t,e){const{ctx:r,canvas:i}=CMe(t,e),s=r.getImageData(0,0,t.width,t.height);return AMe(i),s}function CMe(t,e){const r=yTt();e.premultipliedAlpha&&ATt(t),r.width=t.width,r.height=t.height;const i=r.getContext("2d",{willReadFrequently:!0});return i.putImageData(t,0,0),e.flipY&&CTt(i),{ctx:i,canvas:r}}function AMe(t){t.width=0,t.height=0}function yTt(){return Kz==null&&(Kz=document.createElement("canvas")),Kz}let Kz=null;function _Tt(t,e){const r=OTt[e.format],i=e.quality/100;return t.toDataURL(r,i)}function vTt(t,e,r,i=0,s=0,n=t.width-i,o=t.height-s,a=!1){const{data:l}=t,{width:c,height:h,data:p}=e,f=n/c,m=o/h,y=Math.ceil(f/2),_=Math.ceil(m/2),v=t.width;for(let b=0;b<h;b++)for(let T=0;T<c;T++){const x=4*(T+(a?h-b-1:b)*c);let S=0,E=0,A=0,R=0,M=0,D=0;const k=(b+.5)*m;for(let $=Math.floor(b*m);$<(b+1)*m;$++){const N=Math.abs(k-($+.5))/_,H=(T+.5)*f,Z=N*N;for(let G=Math.floor(T*f);G<(T+1)*f;G++){const J=Math.abs(H-(G+.5))/y,I=Math.sqrt(Z+J*J);if(I>=1)continue;let z=2*I*I*I-3*I*I+1;const F=4*(i+G+(s+$)*v);D+=z*l[F+3],E+=z,!r&&l[F+3]<255&&(z=z*l[F+3]/255),A+=z*l[F],R+=z*l[F+1],M+=z*l[F+2],S+=z}}p[x]=A/S,p[x+1]=R/S,p[x+2]=M/S,p[x+3]=D/E}return e}function bTt(t,e,r){if(!e)return t;const{framebufferWidth:i,framebufferHeight:s,pixelRatio:n,region:o}=t,a=LK(t,r),l=a.left+a.right,c=a.top+a.bottom,h=i-l,p=s-c,f=Math.min(fTt,Math.min((Hde-l)/h,(Hde-c)/p));return f<pTt?t:{...t,framebufferWidth:Math.round(h*f)+l,framebufferHeight:Math.round(p*f)+c,pixelRatio:n*f,resample:{region:{x:Math.round((o.x-a.left)*f)+a.left,y:Math.round((o.y-a.top)*f)+a.top,width:Math.round(o.width*f),height:Math.round(o.height*f)},width:i,height:s}}}function wTt(t,e){if(!t)return e;const r=t.width,i=t.height;if(r!=null&&i!=null)return{width:Math.floor(r),height:Math.floor(i)};if(r==null&&i==null)return e;const s=e.width/e.height;return i==null?{width:Math.floor(r),height:Math.floor(r/s)}:{width:Math.floor(i*s),height:Math.floor(i)}}function xTt(t,e){const r={x:0,y:0,width:e.width,height:e.height};if(t&&t.area){t.area.x!=null&&(r.x=Math.floor(t.area.x)),t.area.y!=null&&(r.y=Math.floor(t.area.y));const i=t.area.width!=null?Math.floor(t.area.width):null,s=t.area.height!=null?Math.floor(t.area.height):null;if(r.width=e.width-r.x,r.height=e.height-r.y,i!=null&&s!=null)r.width=Math.min(r.width,i),r.height=Math.min(r.height,s);else if(i==null&&s!=null){const n=Math.min(r.width,i);r.height=n/r.width*r.height,r.width=n}else if(i!=null&&s==null){const n=Math.min(r.height,s);r.width=n/r.height*r.width,r.height=n}}return TTt(STt(r,t),e)}function TTt(t,e){const r=Math.floor(Math.max(t.x,0)),i=Math.floor(Math.max(t.y,0)),s={x:r,y:i,width:Math.floor(Math.min(t.width,e.width-r)),height:Math.floor(Math.min(t.height,e.height-i))},n=s.width/s.height,o=t.width/t.height;if(o===n)return s;if(o>n){const c=Math.floor(s.width/o),h=s.height-c;return{x:s.x,y:Math.floor(s.y+h/2),width:s.width,height:c}}const a=Math.floor(s.height*o),l=s.width-a;return{x:Math.floor(s.x+l/2),y:s.y,width:a,height:s.height}}function STt(t,e){if(!e||e.width==null||e.height==null)return t;const r=e.width/e.height,i=t.width/t.height;if(i===r)return t;if(i<r){const n=Math.floor(t.height*r);return t.x-=(n-t.width)/2,t.width=n,t}const s=Math.floor(t.width/r);return t.y-=(s-t.height)/2,t.height=s,t}function LK(t,e){return!e||t&&t.ignorePadding?PTt:e}function ETt(t){switch(t){case"png":case"jpg":case"jpeg":return t;default:return RTt}}function CTt(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}function ATt(t){const e=t.data,r=e.length;for(let i=0;i<r;i+=4){const s=e[i+3];if(s!==255&&s>0){const n=255/s;e[i]=e[i]*n,e[i+1]=e[i+1]*n,e[i+2]=e[i+2]*n}}}const OTt={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},qde=98,RTt="png",MTt={png:100,jpg:qde,jpeg:qde},PTt={top:0,right:0,bottom:0,left:0};let ITt=class{constructor(e,r){this.parameters=e,this.frameHasDecorations=r}},$Tt=class{constructor(e,r,i,s){this._rctx=e,this._renderFunctions=r,this._forceCameraHook=i,this._disposeOffscreenBuffers=s,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}async takeScreenshot(e){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene(gs.BACKGROUND);const r=xo();return this._screenshotQueue.push({settings:e,resolver:r}),r.promise}update(e,r){for(const i of this._screenshotQueue){if(this._rctx==null){i.resolver.reject();continue}const s={...i.settings,pixelRatio:i.settings.pixelRatio*e.parameters.camera.pixelRatio},n=this._renderScreenshot(e,s,r);i.resolver(n)}this._screenshotQueue.length=0}_renderScreenshotOverlay(e,r,i){e.width=r.width,e.height=r.height;const s=e.getContext("2d"),n=i.pixelRatio;return s.save(),s.translate(0,r.height),s.scale(1,-1),i.region&&s.translate(-i.region.x,-i.region.y),s.scale(n,n),r=this._renderFunctions.renderOverlay(e,r),s.restore(),r}_readbackScreenshot(e,r){return e.resample?this._readbackScreenshotResampled({...e,resample:e.resample},r):this._readbackScreenshotImmediate(e,r)}_readbackScreenshotResampled(e,r){const{framebufferWidth:i,framebufferHeight:s,region:n,resample:o}=e,a=this._ensureScreenshotEncodeCanvas();let l=Qk(i,s,a);this._rctx.gl.readPixels(0,0,i,s,Ct.RGBA,rt.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),r(),l=this._renderScreenshotOverlay(a,l,{...e,region:void 0});const c=Qk(n.width,n.height,a);return vTt(l,c,!0,o.region.x,s-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(e,r){const{framebufferHeight:i,region:s}=e,n=this._ensureScreenshotEncodeCanvas(),o=Qk(s.width,s.height,n);return this._rctx.gl.readPixels(s.x,i-(s.y+s.height),s.width,s.height,Ct.RGBA,rt.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),r(),this._renderScreenshotOverlay(n,o,e)}_renderScreenshot(e,r,i){let s=null;const n=e.parameters.camera,o={width:r.framebufferWidth,height:r.framebufferHeight};jb(o,Math.min(this._rctx.parameters.maxTextureSize,this._rctx.parameters.maxRenderbufferSize));let a=!1;const l=r.disableDecorations&&e.frameHasDecorations,c=o.width!==n.fullWidth||o.height!==n.fullHeight,h=r.ignorePadding&&n.pixelRatio!==r.pixelRatio,p=c||l||h||r.objectAndLayerIdColor,f=r.objectAndLayerIdColor?new hn(this._rctx,new xr(o.width,o.height),new iF(Ws.DEPTH_STENCIL,o.width,o.height)):null;if(p){const v=n.clone();if(r.ignorePadding){const E=UM(v.padding);for(let A=0;A<4;A++)E[A]=Math.round(E[A]/v.pixelRatio*r.pixelRatio);v.padding=E}v.fullWidth=o.width,v.fullHeight=o.height,v.pixelRatio=r.pixelRatio;const b=n.fovX-v.fovX,T=n.fovY-v.fovY;b<0&&b<T?v.fovX=n.fovX:T<0&&T<b&&(v.fovY=n.fovY);const x={camera:v,contentCamera:v,mode:Fr.IDLE,alignPixelEnabled:!0,contentPixelRatio:v.pixelRatio};this._forceCameraHook(x),a=!0,s=new hn(this._rctx,new xr(o.width,o.height),new iF(Ws.DEPTH_STENCIL,o.width,o.height));const S=r.disableDecorations?Lw.OFF:Lw.ON;this._renderFunctions.renderScene(s,f,x,S,i),this._disposeOffscreenBuffers()}const m=()=>{this._rctx.bindFramebuffer(null),Ve(s)},y=this._readbackScreenshot(r,m);m();let _=null;if(r.objectAndLayerIdColor){const v=()=>{this._rctx.bindFramebuffer(null),Ve(f)};this._rctx.bindFramebuffer(f),_=this._readbackScreenshot(r,v),this._rctx.bindFramebuffer(null),v()}if(p&&!this._rctx.contextAttributes.alpha)for(let v=3;v<y.data.length;v+=4)y.data[v]=255;if(_&&!this._rctx.contextAttributes.alpha)for(let v=3;v<_.data.length;v+=4)_.data[v]=255;return a&&this._forceCameraHook(e.parameters),[y,_]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}},Gn=class extends we{constructor(e){super({}),this.events=new ws,this.waterTextureRepository=new cO,this._magnifierHelper=new ES,this.objectAndLayerIdRenderHelper=oe("enable-feature:objectAndLayerId-rendering")?new Lbt:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode,this._initializeContext(e),this.addHandles([ae(()=>this.waterTextureRepository?.updating,()=>this.requestRender(),Pr),ae(()=>e.view.qualityProfile,s=>this.renderer?.updateRenderFeature(s),Is),this._magnifierHelper.events.on("request-render",()=>this.requestRender())]);const{memoryController:r}=e.view.resourceController;this.stippleTextureRepository=xlt(this._rctx,r),this.markerTextureRepository=hTt(this._rctx,r),this._shaderTechniqueRepository=new GCe({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextureRepository:this.stippleTextureRepository,waterTextureRepository:this.waterTextureRepository,markerTextureRepository:this.markerTextureRepository}),this._textureRepository=new CS(e,this._shaderTechniqueRepository,this._rctx),this.addHandles(this._textureRepository.events.on("changed",s=>this.requestRender(s))),this._materialRepository=new jCe(this._textureRepository,this._shaderTechniqueRepository,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new dbt(this._rctx,this._shaderTechniqueRepository),this.renderer=new rc(e,this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,s=>this.requestRender(s));const i={renderScene:(s,n,o,a,l)=>this.renderer.render(s,n,o,a,l),requestRenderScene:s=>this.requestRender(s),prepareOverlay:()=>e.options.screenshot.prepareOverlay(),renderOverlay:(s,n)=>e.options.screenshot.renderOverlay(s,n)};this._screenshotManager=new $Tt(this._rctx,i,s=>this.events.emit("force-camera-for-screenshot",s),()=>this.renderer.disposeOffscreenBuffers()),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}destroy(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=Ni(this._frameTask),this._shaderTechniqueRepository=$e(this._shaderTechniqueRepository)}requestRender(e=gs.UPDATE){this._needsRender=!0,e===gs.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(e){this._magnifierHelper.magnifier=e}setIdleSuspend(e){this._idleSuspend!==e&&(this._idleSuspend=e,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e).then(r=>r[0])}takeScreenshotWithOID(e){return e.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(e)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(e,r,i,s,n,o=n){const a=s.constrainWindowSize(r,i,n*s.pixelRatio,o*s.pixelRatio),l=this._ensureDepthBuffer(a);this.renderer.readDepthPixels(s,a,l);let c=Number.MAX_VALUE;for(let h=0;h<a[2]*a[3];h++){const p=ybt(4*h,l,s.nearFar);c>p&&p!==s.nearFar[0]&&p!==s.nearFar[1]&&(c=p)}if(e!=null){const h=e.pickDepth(r*s.pixelRatio,i*s.pixelRatio,s);h!=null&&c>h&&h!==s.nearFar[0]&&h!==s.nearFar[1]&&(c=h)}return c===Number.MAX_VALUE?void 0:c}_ensureDepthBuffer(e){const r=4*e[2]*e[3];return(this._tmpDepthBuffer==null||this._tmpDepthBuffer.byteLength<r)&&(this._tmpDepthBuffer=new Uint8Array(r)),this._tmpDepthBuffer}async reloadShaders(){EOe(),await this._shaderTechniqueRepository.reloadAll(),this.requestRender()}_registerFrameTask(e){const r=e.view.state;let i=!1,s=gs.BACKGROUND,n=!1;const o={preRender:({time:a})=>{i=this.updating,s=this._needsUpdate?gs.UPDATE:gs.BACKGROUND,e.commitSyncLayers();const l=a-this._lastAnimationUpdate;if(l>this.renderer.animationTimestep||r.forcedAnimationTime!=null||i||this._needsRender){const c=l/this.renderer.animationTimeDilation,h=new Z2e(r.camera,c,r.forcedAnimationTime);this.renderer.updateAnimation(h)&&this.requestRender(gs.BACKGROUND),this._lastAnimationUpdate=a}},render:({time:a})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&r.camera.fullWidth>0&&r.camera.fullHeight>0){const l=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this.renderer.render(null,null,r,Lw.ON,a),n=!0,l&&this.renderer.hasReflections&&(this.requestRender(gs.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:a})=>{const l=new ITt(r,this.renderer.hasSlicePlane||this._magnifierHelper.enabled);this._textureRepository.update(),this._screenshotManager.update(l,a)},finish:()=>{n&&(this.renderer.finish(r.mode===Fr.IDLE?s:gs.UPDATE),n=!1)}};this._frameTask=k2(o)}_initializeContext(e){const r=e.options;this._canvas=r.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const i={alpha:r.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:r.stencil??!0,powerPreference:"high-performance",preserveDrawingBuffer:r.preserveDrawingBuffer??!1},s=dJe("3d",this._canvas,i);s!=null?(this._rctx=this._newRenderingContext(s,e),this._loadShaderOnlyExtensions(),!r.alpha&&this._rctx.contextAttributes.alpha&&Q.getLogger(this).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&oe("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)):Q.getLogger(this).error("A WebGL2 context could not be created.")}_newRenderingContext(e,r){const i={disabledExtensions:r.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:r.options.debugWebGLExtensions||{},maxAnisotropy:8},s=(n,o)=>r.view.resourceController.memoryController.newCache(n,o);return new cTt(e,i,s)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("textureFloat")}getObjectAndLayerIdColor(e){return this.objectAndLayerIdRenderHelper!=null?this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(e):null}get componentObjectCollection(){return this._componentObjectCollection==null&&(this._componentObjectCollection=new K1t(this.renderer.renderPassManager,this._viewingMode)),this._componentObjectCollection}set componentObjectCollection(e){this._componentObjectCollection=e}};u([d({type:Boolean,readOnly:!0})],Gn.prototype,"updating",null),u([d({autoDestroy:!0})],Gn.prototype,"_rctx",void 0),u([d({autoDestroy:!0})],Gn.prototype,"_container",void 0),u([d({autoDestroy:!0})],Gn.prototype,"_canvas",void 0),u([d({autoDestroy:!0})],Gn.prototype,"stippleTextureRepository",void 0),u([d({autoDestroy:!0})],Gn.prototype,"markerTextureRepository",void 0),u([d({autoDestroy:!0})],Gn.prototype,"waterTextureRepository",void 0),u([d({autoDestroy:!0})],Gn.prototype,"_magnifierHelper",void 0),u([d({readOnly:!0})],Gn.prototype,"objectAndLayerIdRenderHelper",void 0),u([d({autoDestroy:!0})],Gn.prototype,"_textureRepository",void 0),u([d({autoDestroy:!0})],Gn.prototype,"_compositingHelper",void 0),u([d({autoDestroy:!0,readOnly:!0})],Gn.prototype,"renderer",void 0),u([d({autoDestroy:!0})],Gn.prototype,"_screenshotManager",void 0),u([d()],Gn.prototype,"componentObjectCollection",null),u([d({autoDestroy:!0})],Gn.prototype,"_componentObjectCollection",void 0),u([d()],Gn.prototype,"_needsUpdate",void 0),u([d()],Gn.prototype,"_needsWaterReflectionUpdate",void 0),Gn=u([P("esri.views.3d.webgl-engine.parts.RenderView")],Gn);let Qc=class extends we{constructor(e){super(e),this._model=new ON,this._layers=new Bt,this._asyncChangeSet=new Vq,this._syncChangeSet=new Vq,this._layerSyncSet=new Set}initialize(){this._set("renderView",new Gn(this)),this._frameTask=this.view.resourceController.scheduler.registerTask(vt.STAGE,this),this.addHandles(this._frameTask)}destroy(){this.removeAllHandles()}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||this.renderView.updating||this._frameTask.updating}get renderer(){return this.renderView?.renderer}add(e){this._model.add(e),LF(e)&&this._addLayer(e),this.renderView.requestRender()}remove(e){e==null||this.destroyed||(this._model.remove(e),LF(e)&&this._removeLayer(e),this.renderView.requestRender())}addMany(e){e!=null&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){e!=null&&(this._model?.removeMany(e),this.renderView?.requestRender())}async load(e,r){e!=null&&(Array.isArray(e)||(e=[e]),await Promise.all(e.filter(i=>i.glTexture==null).map(i=>this.schedule(()=>this._model.has(i)?i.load(this.renderView.renderingContext):null),r)))}loadImmediate(e){return e.load(this.renderView.renderingContext)}forEachOfType(e,r){this._model.forEachOfType(e,r)}handleEvent(e,r){this.destroyed||(this._model.dirtySet[e](r),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(e){this._frameTask.processQueue(e),this._commit(e)}_commit(e){const r=this._model.dirtySet;this._asyncChangeSet.empty||e.done||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(i=>{if(e.done)return;const s=this._layerSyncSet.has(i.id)||i.updatePolicy===H_.SYNC,n=s?this._syncChangeSet:this._asyncChangeSet;r.commitLayer(i.id,n),this._layerSyncSet.delete(i.id),n.empty||(this.renderer.modify(n,s?Ja:e),this.renderView.requestRender(),e.madeProgress())}),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Ja),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(i=>{e.done||this._layerSyncSet.has(i.id)||i.updatePolicy!==H_.ASYNC||(r.commitLayer(i.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()))}),this._layerSyncSet.clear(),this.notifyChange("running")}commitSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(r=>{(this._layerSyncSet.has(r.id)||r.updatePolicy===H_.SYNC)&&(e.commitLayer(r.id,this._syncChangeSet),this._layerSyncSet.delete(r.id))});for(const r of this._layerSyncSet)e.commitLayer(r,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Ja),this.renderView.requestRender())}_commitLayer(e){this._model.dirtySet.commitLayer(e.id,this._syncChangeSet),this._layerSyncSet.delete(e.id),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Ja),this.renderView.requestRender())}schedule(e,r){return this._frameTask.schedule(e,r)}reschedule(e,r){return this._frameTask.reschedule(e,r)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commitLayer(e),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,Ja))}addRenderPlugin(e,r,i){const s=this.renderer.renderPlugins.add(e,r,i),n=()=>{Dce(r)&&this.view.sceneIntersectionHelper.addIntersectionHandler(r)};if(Iu(s))return s.then(n);n()}removeRenderPlugin(e){this.destroyed||(Dce(e)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderer.renderPlugins.remove(e))}get performanceInfo(){return{renderer:this.renderer.performanceInfo,model:this._model.getStats()}}get test(){const e=this;return{getCount:r=>e._model.test.content.filter(i=>i.type===r).length,model:e._model}}};Qc.DebugSettings={endFrameContentValidation:!1},u([d({constructOnly:!0})],Qc.prototype,"view",void 0),u([d({constructOnly:!0})],Qc.prototype,"options",void 0),u([d({readOnly:!0})],Qc.prototype,"viewingMode",null),u([d({constructOnly:!0})],Qc.prototype,"container",void 0),u([d({readOnly:!0})],Qc.prototype,"updating",null),u([d({constructOnly:!0})],Qc.prototype,"_model",void 0),u([d({autoDestroy:!0})],Qc.prototype,"renderView",void 0),u([d({readOnly:!0})],Qc.prototype,"renderer",null),u([d({readOnly:!0})],Qc.prototype,"running",null),Qc=u([P("esri.views.3d.webgl-engine.Stage")],Qc);let oHt=class extends pU{constructor(e,r,i,s){super(r,i),this.point=e,this.createGraphic=s}};function OMe(t){return Mp(t)&&t.intersector===Gi.PCL&&!!t.target}let lHt=class extends _Se{constructor(e,r,i,s,n){super(e),this.layerUid=e,this.sublayerUid=r,this.nodeIndex=i,this.componentIndex=s,this.triangleNr=n}},uHt=class extends pU{constructor(e,r,i){super(r,null),this.point=e,this.createVoxelGraphic=i}};function n8(t){return Mp(t)&&t.intersector===Gi.I3S&&!!t.target}function RMe(t){return Mp(t)&&t.intersector===Gi.VOXEL&&!!t.target}function Wde(t,e){return fU(t)||mU(t)?dM(t.target?.object,e):Klt(t)?e.map?.ground:OMe(t)||n8(t)||hAe(t)||RMe(t)?dM(t.target,e):null}function dHt(t,e){const r=IW(t,e);return r!=null&&r.type==="graphic"?r.graphic:null}function IW(t,e){if(t==null)return null;if(fU(t)||mU(t))return Xde(t.target?.object,e);if(OMe(t)){const r=t.target.createGraphic();return{type:"graphic",graphic:r,layer:r.layer}}if(RMe(t)){const r=t.target.createVoxelGraphic();return{type:"graphic",graphic:r,layer:r.layer}}return hAe(t)||iK(t)?Xde(t.target,e):n8(t)?LTt(t.target,e):null}function Xde(t,e){if(t==null||t.graphicUid==null)return null;const r=dM(t,e);if(r==null)return null;if(r===e.graphics)return e.graphicsView==null||typeof t.graphicUid!="number"?null:e.graphicsView.getHit(t.graphicUid);const i=e.allLayerViews.find(s=>s.layer===r);return!i||i.suspended||t.graphicUid==null?null:"getHit"in i?i.getHit(t.graphicUid):null}function LTt(t,e){const r=dM(t,e);if(r==null)return null;const i=e.allLayerViews.find(s=>s.layer===r);return i&&!i.suspended&&"getGraphicFromIntersectorTarget"in i?NTt(i.getGraphicFromIntersectorTarget(t)):null}function DTt(t,e){const r=dM(t,e);if(r==null)return null;const i=e.allLayerViews.find(s=>s.layer===r);return i&&!i.suspended&&"getAABBFromIntersectorTarget"in i?i.getAABBFromIntersectorTarget(t):null}function NTt(t){return t!=null?{type:"graphic",graphic:t,layer:t.layer}:null}function dM(t,e){return t&&t.layerUid!=null?e.graphicsView!=null&&t.layerUid===e.graphicsView.processor.layer.id?e.graphics:e.map.findLayerByUid(t.layerUid):null}function pHt(t,e){if(fU(t)||mU(t))return qg(t.target.object.boundingVolumeWorldSpace.bounds);if(iK(t)){Tve(CL,t.transformation);const r=Math.max(CL[0],CL[1],CL[2]);return t.target.baseBoundingSphere.radius*r}return n8(t)?vc(DTt(t.target,e),r=>.5*P0e(r)):null}function fHt(t){return!fU(t)&&!mU(t)&&(iK(t)?t.target.numLodLevels>1:!!n8(t))}const CL=O();async function FTt(t,e){if(t.type==="2d")return t.hitTest(e);const r=await t.hitTest(e);if(r.results.length===0)return r;const i=(r.results[0].distance??0)*(1+UTt),s=r.results.findIndex(n=>(n.distance??0)>i);return s!==-1&&(r.results=r.results.slice(0,s)),r}const UTt=.05;function kTt(t){return t&&typeof t.highlight=="function"}function zTt(t){return t&&typeof t.maskOccludee=="function"}function mHt(t,e,r){return t==null||t>r&&(e===0||t<e)}function gHt(t,e){return t!=null&&t>0||e!=null&&e>0}function yHt(t){const e=t.effectiveScaleRange;return{minScale:e?.minScale??0,maxScale:e?.maxScale??0}}let eV,tV;function VTt(t){const e=iTe(t);for(;e.length>1;){const r=Zde(e.shift());if(r.available)return r}return Zde(e.shift())}function Zde(t){switch(t){case cr.WEBGL1:return BTt();case cr.WEBGL2:return GTt()}}function BTt(){return eV||(eV=qTt()),eV}function GTt(){return tV||(tV=WTt()),tV}let MMe=class{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsElementIndexUint=!1,this.supportsStandardDerivatives=!1,this.supportsInstancedArrays=!1,this.supportsTextureFloat=!1,this.supportsTextureHalfFloat=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}},jTt=class extends MMe{constructor(){super(...arguments),this.type=cr.WEBGL1}},HTt=class extends MMe{constructor(){super(...arguments),this.type=cr.WEBGL2,this.supportsElementIndexUint=!0,this.supportsStandardDerivatives=!0,this.supportsInstancedArrays=!0,this.supportsTextureFloat=!0,this.supportsTextureHalfFloat=!0}};function PMe(t,e){if(t===cr.WEBGL1&&typeof WebGLRenderingContext>"u"||t===cr.WEBGL2&&typeof WebGL2RenderingContext>"u")return null;const r=document.createElement("canvas");if(!r)return null;let i=hH(r,t,{failIfMajorPerformanceCaveat:!0});if(i==null&&(i=hH(r,t),i!=null&&(e.majorPerformanceCaveat=!0)),i==null)return i;if(t===cr.WEBGL1){const n=i.getParameter(i.VERSION),o=n?.match(/^WebGL\s+([\d.]*)/);if(o){const a=parseFloat(o[1]);e.available=a>=.94}}else e.available=!0;e.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),e.supportsVertexShaderSamplers=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const s=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);return s&&(e.supportsHighPrecisionFragment=s.precision>0),i}function qTt(){const t=new jTt,e=PMe(cr.WEBGL1,t);return e==null||(t.supportsElementIndexUint=e.getExtension("OES_element_index_uint")!==null,t.supportsStandardDerivatives=e.getExtension("OES_standard_derivatives")!==null,t.supportsInstancedArrays=e.getExtension("ANGLE_instanced_arrays")!==null,t.supportsTextureFloat=e.getExtension("OES_texture_float")!==null,t.supportsTextureHalfFloat=e.getExtension("OES_texture_half_float")!==null,t.supportsColorBufferFloat=e.getExtension("WEBGL_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=e.getExtension("EXT_color_buffer_half_float")!==null),t}function WTt(){const t=new HTt,e=PMe(cr.WEBGL2,t);return e==null||(t.supportsColorBufferFloat=e.getExtension("EXT_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=t.supportsColorBufferFloat||e.getExtension("EXT_color_buffer_half_float")!==null),t}function XTt(t){const e=VTt(t);if(!e.available)return new V("webgl:required",t==="3d"?"WebGL2 is required but not supported.":"WebGL is required but not supported.",new Error().stack);if(t==="3d"&&e.majorPerformanceCaveat)return new V("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!e.supportsHighPrecisionFragment)return new V("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!e.supportsVertexShaderSamplers)return new V("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(e.type===cr.WEBGL1){if(!e.supportsElementIndexUint)return new V("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!e.supportsStandardDerivatives)return new V("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!e.supportsInstancedArrays)return new V("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null}function ZTt(t){return t&&"nodeType"in t}function YTt(t){return t&&typeof t.render=="function"}const Yde={component:"esri-component"};let yb=class extends we{constructor(){super(...arguments),this.widget=null}destroy(){this.node=null,this.widget?.destroy()}get id(){return this.get("widget.id")||this.get("node.id")}set node(e){const r=this._get("node");e!==r&&(e&&e.classList.add(Yde.component),r&&r.classList.remove(Yde.component),this._set("node",e))}castNode(e){return this.widget?.destroy(),e?typeof e=="string"||ZTt(e)?(this._set("widget",null),q6(e)):(YTt(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};u([d({dependsOn:[]})],yb.prototype,"id",null),u([d()],yb.prototype,"node",null),u([wr("node")],yb.prototype,"castNode",null),u([d({readOnly:!0})],yb.prototype,"widget",void 0),yb=u([P("esri.views.ui.Component")],yb);const IN=yb,IMe="calcite-mode-";function JTt(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-mode-name").replaceAll(/\s|'|"/g,"")}function QTt(){return JTt().startsWith("dark")}function KTt(){return`${IMe}${QTt()?"dark":"light"}`}function eSt(t){tSt(t),t.classList.add(KTt())}function tSt(t){Array.from(t.classList).forEach(e=>{e.startsWith(IMe)&&t.classList.remove(e)})}const rSt={left:0,top:0,bottom:0,right:0},$Me={bottom:30,top:15,right:15,left:15},Xm="esri-ui",Zl={ui:Xm,corner:`${Xm}-corner`,innerContainer:`${Xm}-inner-container`,manualContainer:`${Xm}-manual-container`,cornerContainer:`${Xm}-corner-container`,topLeft:`${Xm}-top-left`,topRight:`${Xm}-top-right`,bottomLeft:`${Xm}-bottom-left`,bottomRight:`${Xm}-bottom-right`};function iSt(t){return t&&!t._started&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}function AL(t){return t===0?"0":`${t}px`}function rV(t){const e=typeof t=="object"&&t!==null&&Object.getPrototypeOf(t);return(e===null||e===Object.prototype)&&("component"in t||"index"in t||"position"in t)?t:null}function iV(t,{top:e,bottom:r,left:i,right:s}){t.style.top=e,t.style.bottom=r,t.style.left=i,t.style.right=s}let xf=class extends ws.EventedAccessor{constructor(t){super(t),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._locale=pp(),this.view=null,this._applyViewPadding=()=>{const e=this.container;e&&iV(e,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const e=this._innerContainer;e&&iV(e,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([ae(()=>[this.view?.padding,this.container],this._applyViewPadding,Pr),ae(()=>this.padding,this._applyUIPadding,Pr),ae(()=>[this.container,this._locale],([t,e])=>{t&&t.setAttribute("lang",e)},Pr),zX(t=>{this._locale=t})])}destroy(){this.container=null;for(const t of this._components)t.destroy();this._components.length=0,this._componentMap.clear()}set container(t){const e=this._get("container");t!==e&&(t&&(t.classList.add(Zl.ui),eSt(t),this._attachContainers(t)),e&&(e.classList.remove(Zl.ui),iV(e,{top:"",bottom:"",left:"",right:""}),vwe(e)),this._set("container",t))}get height(){const t=this.view?.height??0;if(t===0)return t;const e=this._getViewPadding(),{top:r,bottom:i}=e;return Math.max(t-r-i,0)}get padding(){return this._get("padding")}set padding(t){this._overrideIfSome("padding",t)}castPadding(t){return typeof t=="number"?{bottom:t,top:t,right:t,left:t}:{...$Me,...t}}get width(){const t=this.view?.width??0;if(t===0)return t;const e=this._getViewPadding(),{left:r,right:i}=e;return Math.max(t-r-i,0)}add(t,e){let r,i,s;if(Array.isArray(t))return void t.forEach(o=>this.add(o,e));const n=rV(t);n&&({index:r,position:e,component:t,key:i}=n),e&&typeof e=="object"&&({index:r,key:i,position:e,internal:s}=e),!t||e&&!this._isValidPosition(e)||this._add(t,e,r,i,s)}remove(t,e){if(!t)return;if(Array.isArray(t))return t.map(i=>this.remove(i,e));const r=this._find(t);if(r){if(this._componentMap.has(t)&&this._componentMap.get(t)?.key!==e)return;const i=this._components.indexOf(r);return r.node.parentNode?.removeChild(r.node),this._componentMap.delete(t),this._components.splice(i,1)[0]}}empty(t,e={removeInternal:!1}){if(Array.isArray(t)){for(const s of t)this.empty(s,e);return}const r=this._positionNameToContainerLookup[t??"manual"],i=Array.prototype.slice.call(r.children).map(s=>this._findByNode(s)).filter(s=>s==null?!1:!(this._componentMap.get(s)?.internal??!1)||e.removeInternal);for(const s of i)this.remove(s)}move(t,e){if(Array.isArray(t)&&t.forEach(n=>this.move(n,e)),!t)return;let r;const i=rV(t)||rV(e);if(i&&(r=i.index,e=i.position,t=i.component||t),e&&!this._isValidPosition(e))return;const s=this.remove(t);s&&this.add(s,{position:e,index:r})}find(t){if(!t)return null;const e=this._findById(t);return e&&(e.widget||e.node)}getComponents(t,e={includeInternal:!1}){return t?Array.isArray(t)?t.map(r=>this._getComponentsAtPosition(r,e)).flat():this._getComponentsAtPosition(t,e):this._components.filter(r=>e.includeInternal||!this._componentMap.get(r)?.internal).map(({widget:r,node:i})=>r??i)}getPosition(t){for(const e in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[e].contains(t))return e;return null}_add(t,e,r,i,s){t instanceof IN||(t=new IN({node:t})),this._place({component:t,position:e,index:r}),this._components.push(t),this._componentMap.set(t,{key:i,internal:s})}_find(t){return t?t instanceof IN?this._findByComponent(t):typeof t=="string"?this._findById(t):this._findByNode(t.domNode||t):null}_getViewPadding(){return this.view?.padding??rSt}_attachContainers(t){t.appendChild(this._innerContainer),t.appendChild(this._manualContainer)}_initContainers(){const t=document.createElement("div");t.classList.add(Zl.innerContainer,Zl.cornerContainer);const e=document.createElement("div");e.classList.add(Zl.innerContainer,Zl.manualContainer);const r=document.createElement("div");r.classList.add(Zl.topLeft,Zl.corner),t.appendChild(r);const i=document.createElement("div");i.classList.add(Zl.topRight,Zl.corner),t.appendChild(i);const s=document.createElement("div");s.classList.add(Zl.bottomLeft,Zl.corner),t.appendChild(s);const n=document.createElement("div");n.classList.add(Zl.bottomRight,Zl.corner),t.appendChild(n),this._innerContainer=t,this._manualContainer=e;const o=EXe();this._cornerNameToContainerLookup={"top-left":r,"top-right":i,"bottom-left":s,"bottom-right":n,"top-leading":o?i:r,"top-trailing":o?r:i,"bottom-leading":o?n:s,"bottom-trailing":o?s:n},this._positionNameToContainerLookup={manual:e,...this._cornerNameToContainerLookup}}_isValidPosition(t){return!!this._positionNameToContainerLookup[t]}_place(t){const e=t.position??"manual",{component:r,index:i}=t,s=this._positionNameToContainerLookup[e],n=i!=null&&i>-1;if(iSt(r.widget)&&r.widget.startup(),!n)return void s.appendChild(r.node);const o=Array.from(s.children);if(i===0)return void(s.firstChild?Jie(r.node,s.firstChild):s.appendChild(r.node));i>=o.length?s.appendChild(r.node):Jie(r.node,o[i])}_toPixelPosition(t){return{top:AL(t.top),left:AL(t.left),right:AL(t.right),bottom:AL(t.bottom)}}_findByComponent(t){return this._components.find(e=>e===t)??null}_findById(t){return this._components.find(({id:e})=>e===t)??null}_findByNode(t){return this._components.find(({node:e})=>e===t)??null}_getComponentsAtPosition(t,e){const r=this._positionNameToContainerLookup[t];return Array.prototype.slice.call(r.children).map(i=>this._findByNode(i)).filter(jf).filter(i=>e.includeInternal||!this._componentMap.get(i)?.internal).map(({widget:i,node:s})=>i??s)}};u([d()],xf.prototype,"_locale",void 0),u([d()],xf.prototype,"container",null),u([d()],xf.prototype,"height",null),u([d({value:$Me})],xf.prototype,"padding",null),u([wr("padding")],xf.prototype,"castPadding",null),u([d()],xf.prototype,"view",void 0),u([d()],xf.prototype,"width",null),xf=u([P("esri.views.ui.UI")],xf);const sSt=xf,nSt={handleInterceptedEvent:(t,e,r,i)=>(t.scheduleRender(),e.properties[`on${i.type}`].apply(e.properties.bind||r,[i]))},oSt={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,r)=>{t.style[e]=r}},aSt=t=>({...oSt,...t}),lSt=(t,e)=>{const r=[];for(;t&&t!==e;)r.push(t),t=t.parentNode;return r},cSt=(t,e)=>t.find(e),Jde=(t,e,r=!1)=>{let i=t;return e.forEach((s,n)=>{const o=i?.children?cSt(i.children,a=>a.domNode===s):void 0;r&&!o&&n!==e.length-1||(i=o)}),i},uSt=t=>{let e;const r={...nSt,...t},i=aSt(r),s=i.performanceLogger;let n,o=!0,a=!1;const l=[],c=[],h=(f,m,y)=>{let _;i.eventHandlerInterceptor=(b,T,x,S)=>function(E){let A;s("domEvent",E);const R=lSt(E.currentTarget,_.domNode),M=R.some(k=>customElements.get(k?.tagName?.toLowerCase()));if(E.eventPhase===Event.CAPTURING_PHASE||!M)R.reverse(),A=Jde(_.getLastRender(),R);else{const k=E.composedPath(),$=k.slice(k.indexOf(E.currentTarget),k.indexOf(_.domNode)).filter(N=>N.getRootNode()===N.ownerDocument).reverse();A=Jde(_.getLastRender(),$,!0)}let D;return A&&(D=r.handleInterceptedEvent(e,A,this,E)),s("domEventProcessed",E),D},r.postProcessProjectionOptions?.(i);const v=y();_=f(m,v,i),l.push(_),c.push(y),r.afterFirstVNodeRendered&&r.afterFirstVNodeRendered(_,v)};let p=()=>{if(n=void 0,o){o=!1,s("renderStart",void 0);for(let f=0;f<l.length;f++){const m=c[f]();s("rendered",void 0),l[f].update(m),s("patched",void 0)}s("renderDone",void 0),o=!0}};return r.modifyDoRenderImplementation&&(p=r.modifyDoRenderImplementation(p,l,c)),e={renderNow:p,scheduleRender:()=>{n||a||(n=requestAnimationFrame(p))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),a=!0},resume:()=>{a=!1,o=!0,e.scheduleRender()},append:(f,m)=>{h(L_.append,f,m)},insertBefore:(f,m)=>{h(L_.insertBefore,f,m)},merge:(f,m)=>{h(L_.merge,f,m)},replace:(f,m)=>{h(L_.replace,f,m)},detach:f=>{for(let m=0;m<c.length;m++)if(c[m]===f)return c.splice(m,1),l.splice(m,1)[0];throw new Error("renderFunction was not found")}},e},AS={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,safari10:!1,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,cssVarShim:!1,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,dynamicImportShim:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0};let OS,LMe,o8,DMe=!1,a5=!1,DK=!1,au=!1,Qde=null,$W=!1;const hSt=t=>{const e=new URL(t,Xo.$resourcesUrl$);return e.origin!==vP.location.origin?e.href:e.pathname},dSt=t=>Xo.$resourcesUrl$=t,Zw=(t,e="")=>()=>{},Kde="http://www.w3.org/1999/xlink",epe={},pSt="http://www.w3.org/2000/svg",fSt="http://www.w3.org/1999/xhtml",mSt=t=>t!=null,NK=t=>(t=typeof t,t==="object"||t==="function");function gSt(t){var e,r,i;return(i=(r=(e=t.head)===null||e===void 0?void 0:e.querySelector('meta[name="csp-nonce"]'))===null||r===void 0?void 0:r.getAttribute("content"))!==null&&i!==void 0?i:void 0}const NMe=(t,e,...r)=>{let i=null,s=null,n=null,o=!1,a=!1;const l=[],c=p=>{for(let f=0;f<p.length;f++)i=p[f],Array.isArray(i)?c(i):i!=null&&typeof i!="boolean"&&((o=typeof t!="function"&&!NK(i))&&(i=String(i)),o&&a?l[l.length-1].$text$+=i:l.push(o?l5(null,i):i),a=o)};if(c(r),e){e.key&&(s=e.key),e.name&&(n=e.name);{const p=e.className||e.class;p&&(e.class=typeof p!="object"?p:Object.keys(p).filter(f=>p[f]).join(" "))}}if(typeof t=="function")return t(e===null?{}:e,l,vSt);const h=l5(t,null);return h.$attrs$=e,l.length>0&&(h.$children$=l),h.$key$=s,h.$name$=n,h},l5=(t,e)=>{const r={$flags$:0,$tag$:t,$text$:e,$elm$:null,$children$:null};return r.$attrs$=null,r.$key$=null,r.$name$=null,r},ySt={},_St=t=>t&&t.$tag$===ySt,vSt={forEach:(t,e)=>t.map(tpe).forEach(e),map:(t,e)=>t.map(tpe).map(e).map(bSt)},tpe=t=>({vattrs:t.$attrs$,vchildren:t.$children$,vkey:t.$key$,vname:t.$name$,vtag:t.$tag$,vtext:t.$text$}),bSt=t=>{if(typeof t.vtag=="function"){const r=Object.assign({},t.vattrs);return t.vkey&&(r.key=t.vkey),t.vname&&(r.name=t.vname),NMe(t.vtag,r,...t.vchildren||[])}const e=l5(t.vtag,t.vtext);return e.$attrs$=t.vattrs,e.$children$=t.vchildren,e.$key$=t.vkey,e.$name$=t.vname,e},wSt=t=>XSt.map(e=>e(t)).find(e=>!!e),xSt=(t,e)=>t!=null&&!NK(t)?e&4?t==="false"?!1:t===""||!!t:e&2?parseFloat(t):e&1?String(t):t:t,TSt=t=>t,xHt=(t,e,r)=>{const i=TSt(t);return{emit:s=>SSt(i,e,{bubbles:!!(r&4),composed:!!(r&2),cancelable:!!(r&1),detail:s})}},SSt=(t,e,r)=>{const i=Xo.ce(e,r);return t.dispatchEvent(i),i},rpe=new WeakMap,ESt=(t,e,r)=>{let i=u5.get(t);JSt&&r?(i=i||new CSSStyleSheet,typeof i=="string"?i=e:i.replaceSync(e)):i=e,u5.set(t,i)},CSt=(t,e,r,i)=>{var s;let n=FMe(e,r);const o=u5.get(n);if(t=t.nodeType===11?t:_p,o)if(typeof o=="string"){t=t.head||t;let a=rpe.get(t),l;if(a||rpe.set(t,a=new Set),!a.has(n)){{l=_p.createElement("style"),l.innerHTML=o;const c=(s=Xo.$nonce$)!==null&&s!==void 0?s:gSt(_p);c!=null&&l.setAttribute("nonce",c),t.insertBefore(l,t.querySelector("link"))}a&&a.add(n)}}else t.adoptedStyleSheets.includes(o)||(t.adoptedStyleSheets=[...t.adoptedStyleSheets,o]);return n},ASt=t=>{const e=t.$cmpMeta$,r=t.$hostElement$,i=e.$flags$,s=Zw("attachStyles",e.$tagName$),n=CSt(r.shadowRoot?r.shadowRoot:r.getRootNode(),e,t.$modeName$);i&10&&(r["s-sc"]=n,r.classList.add(n+"-h"),i&2&&r.classList.add(n+"-s")),s()},FMe=(t,e)=>"sc-"+(e&&t.$flags$&32?t.$tagName$+"-"+e:t.$tagName$),ipe=(t,e,r,i,s,n)=>{if(r!==i){let o=ape(t,e),a=e.toLowerCase();if(e==="class"){const l=t.classList,c=spe(r),h=spe(i);l.remove(...c.filter(p=>p&&!h.includes(p))),l.add(...h.filter(p=>p&&!c.includes(p)))}else if(e==="style"){for(const l in r)(!i||i[l]==null)&&(l.includes("-")?t.style.removeProperty(l):t.style[l]="");for(const l in i)(!r||i[l]!==r[l])&&(l.includes("-")?t.style.setProperty(l,i[l]):t.style[l]=i[l])}else if(e!=="key")if(e==="ref")i&&i(t);else if(!t.__lookupSetter__(e)&&e[0]==="o"&&e[1]==="n")e[2]==="-"?e=e.slice(3):ape(vP,a)?e=a.slice(2):e=a[2]+e.slice(3),r&&Xo.rel(t,e,r,!1),i&&Xo.ael(t,e,i,!1);else{const l=NK(i);if((o||l&&i!==null)&&!s)try{if(t.tagName.includes("-"))t[e]=i;else{const h=i??"";e==="list"?o=!1:(r==null||t[e]!=h)&&(t[e]=h)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(e=a,c=!0),i==null||i===!1?(i!==!1||t.getAttribute(e)==="")&&(c?t.removeAttributeNS(Kde,e):t.removeAttribute(e)):(!o||n&4||s)&&!l&&(i=i===!0?"":i,c?t.setAttributeNS(Kde,e,i):t.setAttribute(e,i))}}},OSt=/\s/,spe=t=>t?t.split(OSt):[],UMe=(t,e,r,i)=>{const s=e.$elm$.nodeType===11&&e.$elm$.host?e.$elm$.host:e.$elm$,n=t&&t.$attrs$||epe,o=e.$attrs$||epe;for(i in n)i in o||ipe(s,i,n[i],void 0,r,e.$flags$);for(i in o)ipe(s,i,n[i],o[i],r,e.$flags$)},c5=(t,e,r,i)=>{const s=e.$children$[r];let n=0,o,a,l;if(DMe||(DK=!0,s.$tag$==="slot"&&(OS&&i.classList.add(OS+"-s"),s.$flags$|=s.$children$?2:1)),s.$text$!==null)o=s.$elm$=_p.createTextNode(s.$text$);else if(s.$flags$&1)o=s.$elm$=_p.createTextNode("");else{if(au||(au=s.$tag$==="svg"),o=s.$elm$=_p.createElementNS(au?pSt:fSt,s.$flags$&2?"slot-fb":s.$tag$),au&&s.$tag$==="foreignObject"&&(au=!1),UMe(null,s,au),mSt(OS)&&o["s-si"]!==OS&&o.classList.add(o["s-si"]=OS),s.$children$)for(n=0;n<s.$children$.length;++n)a=c5(t,s,n,o),a&&o.appendChild(a);s.$tag$==="svg"?au=!1:o.tagName==="foreignObject"&&(au=!0)}return o["s-hn"]=o8,s.$flags$&3&&(o["s-sr"]=!0,o["s-cr"]=LMe,o["s-sn"]=s.$name$||"",l=t&&t.$children$&&t.$children$[r],l&&l.$tag$===s.$tag$&&t.$elm$&&pM(t.$elm$,!1)),o},pM=(t,e)=>{Xo.$flags$|=1;const r=t.childNodes;for(let i=r.length-1;i>=0;i--){const s=r[i];s["s-hn"]!==o8&&s["s-ol"]&&(VMe(s).insertBefore(s,FK(s)),s["s-ol"].remove(),s["s-ol"]=void 0,DK=!0),e&&pM(s,e)}Xo.$flags$&=-2},kMe=(t,e,r,i,s,n)=>{let o=t["s-cr"]&&t["s-cr"].parentNode||t,a;for(o.shadowRoot&&o.tagName===o8&&(o=o.shadowRoot);s<=n;++s)i[s]&&(a=c5(null,r,s,t),a&&(i[s].$elm$=a,o.insertBefore(a,FK(e))))},zMe=(t,e,r,i,s)=>{for(;e<=r;++e)(i=t[e])&&(s=i.$elm$,jMe(i),a5=!0,s["s-ol"]?s["s-ol"].remove():pM(s,!0),s.remove())},RSt=(t,e,r,i)=>{let s=0,n=0,o=0,a=0,l=e.length-1,c=e[0],h=e[l],p=i.length-1,f=i[0],m=i[p],y,_;for(;s<=l&&n<=p;)if(c==null)c=e[++s];else if(h==null)h=e[--l];else if(f==null)f=i[++n];else if(m==null)m=i[--p];else if(OL(c,f))RS(c,f),c=e[++s],f=i[++n];else if(OL(h,m))RS(h,m),h=e[--l],m=i[--p];else if(OL(c,m))(c.$tag$==="slot"||m.$tag$==="slot")&&pM(c.$elm$.parentNode,!1),RS(c,m),t.insertBefore(c.$elm$,h.$elm$.nextSibling),c=e[++s],m=i[--p];else if(OL(h,f))(c.$tag$==="slot"||m.$tag$==="slot")&&pM(h.$elm$.parentNode,!1),RS(h,f),t.insertBefore(h.$elm$,c.$elm$),h=e[--l],f=i[++n];else{for(o=-1,a=s;a<=l;++a)if(e[a]&&e[a].$key$!==null&&e[a].$key$===f.$key$){o=a;break}o>=0?(_=e[o],_.$tag$!==f.$tag$?y=c5(e&&e[n],r,o,t):(RS(_,f),e[o]=void 0,y=_.$elm$),f=i[++n]):(y=c5(e&&e[n],r,n,t),f=i[++n]),y&&VMe(c.$elm$).insertBefore(y,FK(c.$elm$))}s>l?kMe(t,i[p+1]==null?null:i[p+1].$elm$,r,i,n,p):n>p&&zMe(e,s,l)},OL=(t,e)=>t.$tag$===e.$tag$?t.$tag$==="slot"?t.$name$===e.$name$:t.$key$===e.$key$:!1,FK=t=>t&&t["s-ol"]||t,VMe=t=>(t["s-ol"]?t["s-ol"]:t).parentNode,RS=(t,e)=>{const r=e.$elm$=t.$elm$,i=t.$children$,s=e.$children$,n=e.$tag$,o=e.$text$;let a;o===null?(au=n==="svg"?!0:n==="foreignObject"?!1:au,n==="slot"||UMe(t,e,au),i!==null&&s!==null?RSt(r,i,e,s):s!==null?(t.$text$!==null&&(r.textContent=""),kMe(r,null,e,s,0,s.length-1)):i!==null&&zMe(i,0,i.length-1),au&&n==="svg"&&(au=!1)):(a=r["s-cr"])?a.parentNode.textContent=o:t.$text$!==o&&(r.data=o)},BMe=t=>{const e=t.childNodes;let r,i,s,n,o,a;for(i=0,s=e.length;i<s;i++)if(r=e[i],r.nodeType===1){if(r["s-sr"]){for(o=r["s-sn"],r.hidden=!1,n=0;n<s;n++)if(a=e[n].nodeType,e[n]["s-hn"]!==r["s-hn"]||o!==""){if(a===1&&o===e[n].getAttribute("slot")){r.hidden=!0;break}}else if(a===1||a===3&&e[n].textContent.trim()!==""){r.hidden=!0;break}}BMe(r)}},Qd=[],GMe=t=>{let e,r,i,s,n,o,a=0;const l=t.childNodes,c=l.length;for(;a<c;a++){if(e=l[a],e["s-sr"]&&(r=e["s-cr"])&&r.parentNode)for(i=r.parentNode.childNodes,s=e["s-sn"],o=i.length-1;o>=0;o--)r=i[o],!r["s-cn"]&&!r["s-nr"]&&r["s-hn"]!==e["s-hn"]&&(npe(r,s)?(n=Qd.find(h=>h.$nodeToRelocate$===r),a5=!0,r["s-sn"]=r["s-sn"]||s,n?n.$slotRefNode$=e:Qd.push({$slotRefNode$:e,$nodeToRelocate$:r}),r["s-sr"]&&Qd.map(h=>{npe(h.$nodeToRelocate$,r["s-sn"])&&(n=Qd.find(p=>p.$nodeToRelocate$===r),n&&!h.$slotRefNode$&&(h.$slotRefNode$=n.$slotRefNode$))})):Qd.some(h=>h.$nodeToRelocate$===r)||Qd.push({$nodeToRelocate$:r}));e.nodeType===1&&GMe(e)}},npe=(t,e)=>t.nodeType===1?t.getAttribute("slot")===null&&e===""||t.getAttribute("slot")===e:t["s-sn"]===e?!0:e==="",jMe=t=>{t.$attrs$&&t.$attrs$.ref&&t.$attrs$.ref(null),t.$children$&&t.$children$.map(jMe)},MSt=(t,e)=>{const r=t.$hostElement$,i=t.$cmpMeta$,s=t.$vnode$||l5(null,null),n=_St(e)?e:NMe(null,null,e);o8=r.tagName,i.$attrsToReflect$&&(n.$attrs$=n.$attrs$||{},i.$attrsToReflect$.map(([o,a])=>n.$attrs$[a]=r[o])),n.$tag$=null,n.$flags$|=4,t.$vnode$=n,n.$elm$=s.$elm$=r.shadowRoot||r,OS=r["s-sc"],LMe=r["s-cr"],DMe=(i.$flags$&1)!==0,a5=!1,RS(s,n);{if(Xo.$flags$|=1,DK){GMe(n.$elm$);let o,a,l,c,h,p,f=0;for(;f<Qd.length;f++)o=Qd[f],a=o.$nodeToRelocate$,a["s-ol"]||(l=_p.createTextNode(""),l["s-nr"]=a,a.parentNode.insertBefore(a["s-ol"]=l,a));for(f=0;f<Qd.length;f++)if(o=Qd[f],a=o.$nodeToRelocate$,o.$slotRefNode$){for(c=o.$slotRefNode$.parentNode,h=o.$slotRefNode$.nextSibling,l=a["s-ol"];l=l.previousSibling;)if(p=l["s-nr"],p&&p["s-sn"]===a["s-sn"]&&c===p.parentNode&&(p=p.nextSibling,!p||!p["s-nr"])){h=p;break}(!h&&c!==a.parentNode||a.nextSibling!==h)&&a!==h&&(!a["s-hn"]&&a["s-ol"]&&(a["s-hn"]=a["s-ol"].parentNode.nodeName),c.insertBefore(a,h))}else a.nodeType===1&&(a.hidden=!0)}a5&&BMe(n.$elm$),Xo.$flags$&=-2,Qd.length=0}},PSt=(t,e)=>{},UK=(t,e)=>(t.$flags$|=16,PSt(t,t.$ancestorComponent$),e2t(()=>ISt(t,e))),ISt=(t,e)=>{const r=t.$hostElement$,i=Zw("scheduleUpdate",t.$cmpMeta$.$tagName$),s=r;let n;return e?n=$2(s,"componentWillLoad"):n=$2(s,"componentWillUpdate"),n=ope(n,()=>$2(s,"componentWillRender")),i(),ope(n,()=>$St(t,s,e))},$St=async(t,e,r)=>{const i=t.$hostElement$,s=Zw("update",t.$cmpMeta$.$tagName$);i["s-rc"],r&&ASt(t);const n=Zw("render",t.$cmpMeta$.$tagName$);LSt(t,e,i),n(),s(),DSt(t)},LSt=(t,e,r)=>{try{Qde=e,e=e.render&&e.render(),t.$flags$&=-17,t.$flags$|=2,(AS.hasRenderFn||AS.reflect)&&(AS.vdomRender||AS.reflect)&&(AS.hydrateServerSide||MSt(t,e))}catch(a){_P(a,t.$hostElement$)}return Qde=null,null},DSt=t=>{const e=t.$cmpMeta$.$tagName$,r=t.$hostElement$,i=Zw("postUpdate",e),s=r;t.$ancestorComponent$,$2(s,"componentDidRender"),t.$flags$&64?($2(s,"componentDidUpdate"),i()):(t.$flags$|=64,$2(s,"componentDidLoad"),i())},THt=t=>{{const e=yP(t),r=e.$hostElement$.isConnected;return r&&(e.$flags$&18)===2&&UK(e,!1),r}},$2=(t,e,r)=>{if(t&&t[e])try{return t[e](r)}catch(i){_P(i)}},ope=(t,e)=>t&&t.then?t.then(e):e(),NSt=(t,e)=>yP(t).$instanceValues$.get(e),FSt=(t,e,r,i)=>{const s=yP(t),n=t,o=s.$instanceValues$.get(e),a=s.$flags$,l=n;r=xSt(r,i.$members$[e][0]);const c=Number.isNaN(o)&&Number.isNaN(r);if(r!==o&&!c){s.$instanceValues$.set(e,r);{if(i.$watchers$&&a&128){const p=i.$watchers$[e];p&&p.map(f=>{try{l[f](r,o,e)}catch(m){_P(m,n)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(r,o,e)===!1)return;UK(s,!1)}}}},USt=(t,e,r)=>{if(e.$members$){t.watchers&&(e.$watchers$=t.watchers);const i=Object.entries(e.$members$),s=t.prototype;i.map(([n,[o]])=>{(o&31||o&32)&&Object.defineProperty(s,n,{get(){return NSt(this,n)},set(a){FSt(this,n,a,e)},configurable:!0,enumerable:!0})});{const n=new Map;s.attributeChangedCallback=function(o,a,l){Xo.jmp(()=>{const c=n.get(o);if(this.hasOwnProperty(c))l=this[c],delete this[c];else if(s.hasOwnProperty(c)&&typeof this[c]=="number"&&this[c]==l)return;this[c]=l===null&&typeof this[c]=="boolean"?!1:l})},t.observedAttributes=i.filter(([o,a])=>a[0]&15).map(([o,a])=>{const l=a[1]||o;return n.set(l,o),a[0]&512&&e.$attrsToReflect$.push([o,l]),l})}}return t},kSt=async(t,e,r,i,s)=>{if(!(e.$flags$&32)&&(s=t.constructor,e.$flags$|=32,customElements.whenDefined(r.$tagName$).then(()=>e.$flags$|=128),s.style)){let o=s.style;typeof o!="string"&&(o=o[e.$modeName$=wSt(t)]);const a=FMe(r,e.$modeName$);if(!u5.has(a)){const l=Zw("registerStyles",r.$tagName$);ESt(a,o,!!(r.$flags$&1)),l()}}e.$ancestorComponent$,(()=>UK(e,!0))()},zSt=t=>{},VSt=t=>{if(!(Xo.$flags$&1)){const e=yP(t),r=e.$cmpMeta$,i=Zw("connectedCallback",r.$tagName$);e.$flags$&1?(HMe(t,e,r.$listeners$),zSt(e.$lazyInstance$)):(e.$flags$|=1,r.$flags$&12&&BSt(t),r.$members$&&Object.entries(r.$members$).map(([s,[n]])=>{if(n&31&&t.hasOwnProperty(s)){const o=t[s];delete t[s],t[s]=o}}),kSt(t,e,r)),i()}},BSt=t=>{const e=t["s-cr"]=_p.createComment("");e["s-cn"]=!0,t.insertBefore(e,t.firstChild)},GSt=t=>{if(!(Xo.$flags$&1)){const e=yP(t);e.$rmListeners$&&(e.$rmListeners$.map(r=>r()),e.$rmListeners$=void 0)}},SHt=(t,e)=>{const r={$flags$:e[0],$tagName$:e[1]};r.$members$=e[2],r.$listeners$=e[3],r.$watchers$=t.$watchers$,r.$attrsToReflect$=[];const i=t.prototype.connectedCallback,s=t.prototype.disconnectedCallback;return Object.assign(t.prototype,{__registerHost(){WSt(this,r)},connectedCallback(){VSt(this),i&&i.call(this)},disconnectedCallback(){GSt(this),s&&s.call(this)},__attachShadow(){this.attachShadow({mode:"open",delegatesFocus:!!(r.$flags$&16)})}}),t.is=r.$tagName$,USt(t,r)},EHt=(t,e)=>e,HMe=(t,e,r,i)=>{r&&r.map(([s,n,o])=>{const a=HSt(t,s),l=jSt(e,o),c=qSt(s);Xo.ael(a,n,l,c),(e.$rmListeners$=e.$rmListeners$||[]).push(()=>Xo.rel(a,n,l,c))})},jSt=(t,e)=>r=>{try{AS.lazyLoad||t.$hostElement$[e](r)}catch(i){_P(i)}},HSt=(t,e)=>e&4?_p:e&8?vP:e&16?_p.body:t,qSt=t=>ZSt?{passive:(t&1)!==0,capture:(t&2)!==0}:(t&2)!==0,qMe=new WeakMap,yP=t=>qMe.get(t),WSt=(t,e)=>{const r={$flags$:0,$hostElement$:t,$cmpMeta$:e,$instanceValues$:new Map};return HMe(t,r,e.$listeners$),qMe.set(t,r)},ape=(t,e)=>e in t,_P=(t,e)=>(0,console.error)(t,e),u5=new Map,XSt=[],vP=typeof window<"u"?window:{},_p=vP.document||{head:{}},CHt=vP.HTMLElement||class{},Xo={$flags$:0,$resourcesUrl$:"",jmp:t=>t(),raf:t=>requestAnimationFrame(t),ael:(t,e,r,i)=>t.addEventListener(e,r,i),rel:(t,e,r,i)=>t.removeEventListener(e,r,i),ce:(t,e)=>new CustomEvent(t,e)},ZSt=(()=>{let t=!1;try{_p.addEventListener("e",null,Object.defineProperty({},"passive",{get(){t=!0}}))}catch{}return t})(),YSt=t=>Promise.resolve(t),JSt=(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replaceSync=="function"}catch{}return!1})(),lpe=[],WMe=[],QSt=(t,e)=>r=>{t.push(r),$W||($W=!0,e&&Xo.$flags$&4?KSt(LW):Xo.raf(LW))},cpe=t=>{for(let e=0;e<t.length;e++)try{t[e](performance.now())}catch(r){_P(r)}t.length=0},LW=()=>{cpe(lpe),cpe(WMe),($W=lpe.length>0)&&Xo.raf(LW)},KSt=t=>YSt().then(t),e2t=QSt(WMe,!0);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.4.3
 */const XMe="calcite-mode-auto",ZMe="calcite-mode-dark",t2t="calcite-mode-light",AHt={autoMode:XMe,darkMode:ZMe,lightMode:t2t,rtl:"calcite--rtl",calciteAnimate:"calcite-animate",calciteAnimateIn:"calcite-animate__in",calciteAnimateInUp:"calcite-animate__in-up",calciteAnimateInDown:"calcite-animate__in-down",calciteAnimateInRight:"calcite-animate__in-right",calciteAnimateInLeft:"calcite-animate__in-left",calciteAnimateInScale:"calcite-animate__in-scale"};/*!
* tabbable 6.1.2
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var YMe=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],h5=YMe.join(","),JMe=typeof Element>"u",Yw=JMe?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,d5=!JMe&&Element.prototype.getRootNode?function(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}:function(t){return t?.ownerDocument},p5=function t(e,r){var i;r===void 0&&(r=!0);var s=e==null||(i=e.getAttribute)===null||i===void 0?void 0:i.call(e,"inert"),n=s===""||s==="true",o=n||r&&e&&t(e.parentNode);return o},r2t=function(e){var r,i=e==null||(r=e.getAttribute)===null||r===void 0?void 0:r.call(e,"contenteditable");return i===""||i==="true"},QMe=function(e,r,i){if(p5(e))return[];var s=Array.prototype.slice.apply(e.querySelectorAll(h5));return r&&Yw.call(e,h5)&&s.unshift(e),s=s.filter(i),s},KMe=function t(e,r,i){for(var s=[],n=Array.from(e);n.length;){var o=n.shift();if(!p5(o,!1))if(o.tagName==="SLOT"){var a=o.assignedElements(),l=a.length?a:o.children,c=t(l,!0,i);i.flatten?s.push.apply(s,c):s.push({scopeParent:o,candidates:c})}else{var h=Yw.call(o,h5);h&&i.filter(o)&&(r||!e.includes(o))&&s.push(o);var p=o.shadowRoot||typeof i.getShadowRoot=="function"&&i.getShadowRoot(o),f=!p5(p,!1)&&(!i.shadowRootFilter||i.shadowRootFilter(o));if(p&&f){var m=t(p===!0?o.children:p.children,!0,i);i.flatten?s.push.apply(s,m):s.push({scopeParent:o,candidates:m})}else n.unshift.apply(n,o.children)}}return s},ePe=function(e,r){return e.tabIndex<0&&(r||/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||r2t(e))&&isNaN(parseInt(e.getAttribute("tabindex"),10))?0:e.tabIndex},i2t=function(e,r){return e.tabIndex===r.tabIndex?e.documentOrder-r.documentOrder:e.tabIndex-r.tabIndex},tPe=function(e){return e.tagName==="INPUT"},s2t=function(e){return tPe(e)&&e.type==="hidden"},n2t=function(e){var r=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(i){return i.tagName==="SUMMARY"});return r},o2t=function(e,r){for(var i=0;i<e.length;i++)if(e[i].checked&&e[i].form===r)return e[i]},a2t=function(e){if(!e.name)return!0;var r=e.form||d5(e),i=function(a){return r.querySelectorAll('input[type="radio"][name="'+a+'"]')},s;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")s=i(window.CSS.escape(e.name));else try{s=i(e.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var n=o2t(s,e.form);return!n||n===e},l2t=function(e){return tPe(e)&&e.type==="radio"},c2t=function(e){return l2t(e)&&!a2t(e)},u2t=function(e){var r,i=e&&d5(e),s=(r=i)===null||r===void 0?void 0:r.host,n=!1;if(i&&i!==e){var o,a,l;for(n=!!((o=s)!==null&&o!==void 0&&(a=o.ownerDocument)!==null&&a!==void 0&&a.contains(s)||e!=null&&(l=e.ownerDocument)!==null&&l!==void 0&&l.contains(e));!n&&s;){var c,h,p;i=d5(s),s=(c=i)===null||c===void 0?void 0:c.host,n=!!((h=s)!==null&&h!==void 0&&(p=h.ownerDocument)!==null&&p!==void 0&&p.contains(s))}}return n},upe=function(e){var r=e.getBoundingClientRect(),i=r.width,s=r.height;return i===0&&s===0},h2t=function(e,r){var i=r.displayCheck,s=r.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var n=Yw.call(e,"details>summary:first-of-type"),o=n?e.parentElement:e;if(Yw.call(o,"details:not([open]) *"))return!0;if(!i||i==="full"||i==="legacy-full"){if(typeof s=="function"){for(var a=e;e;){var l=e.parentElement,c=d5(e);if(l&&!l.shadowRoot&&s(l)===!0)return upe(e);e.assignedSlot?e=e.assignedSlot:!l&&c!==e.ownerDocument?e=c.host:e=l}e=a}if(u2t(e))return!e.getClientRects().length;if(i!=="legacy-full")return!0}else if(i==="non-zero-area")return upe(e);return!1},d2t=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var r=e.parentElement;r;){if(r.tagName==="FIELDSET"&&r.disabled){for(var i=0;i<r.children.length;i++){var s=r.children.item(i);if(s.tagName==="LEGEND")return Yw.call(r,"fieldset[disabled] *")?!0:!s.contains(e)}return!0}r=r.parentElement}return!1},f5=function(e,r){return!(r.disabled||p5(r)||s2t(r)||h2t(r,e)||n2t(r)||d2t(r))},DW=function(e,r){return!(c2t(r)||ePe(r)<0||!f5(e,r))},p2t=function(e){var r=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(r)||r>=0)},f2t=function t(e){var r=[],i=[];return e.forEach(function(s,n){var o=!!s.scopeParent,a=o?s.scopeParent:s,l=ePe(a,o),c=o?t(s.candidates):a;l===0?o?r.push.apply(r,c):r.push(a):i.push({documentOrder:n,tabIndex:l,item:s,isScope:o,content:c})}),i.sort(i2t).reduce(function(s,n){return n.isScope?s.push.apply(s,n.content):s.push(n.content),s},[]).concat(r)},m2t=function(e,r){r=r||{};var i;return r.getShadowRoot?i=KMe([e],r.includeContainer,{filter:DW.bind(null,r),flatten:!1,getShadowRoot:r.getShadowRoot,shadowRootFilter:p2t}):i=QMe(e,r.includeContainer,DW.bind(null,r)),f2t(i)},OHt=function(e,r){r=r||{};var i;return r.getShadowRoot?i=KMe([e],r.includeContainer,{filter:f5.bind(null,r),flatten:!0,getShadowRoot:r.getShadowRoot}):i=QMe(e,r.includeContainer,f5.bind(null,r)),i},RHt=function(e,r){if(r=r||{},!e)throw new Error("No node provided");return Yw.call(e,h5)===!1?!1:DW(r,e)},g2t=YMe.concat("iframe").join(","),MHt=function(e,r){if(r=r||{},!e)throw new Error("No node provided");return Yw.call(e,g2t)===!1?!1:f5(r,e)};const y2t={getShadowRoot:!0};function PHt(t){const e="dir",r=`[${e}]`,i=_2t(t,r);return i?i.getAttribute(e):"ltr"}function kK(t){return t.getRootNode()}function IHt(t){const e=kK(t);return"host"in e?e:null}function rPe(t){return t.host||null}function $Ht(t,{selector:e,id:r}){function i(s){if(!s)return null;s.assignedSlot&&(s=s.assignedSlot);const n=kK(s),o=r?"getElementById"in n?n.getElementById(r):null:e?n.querySelector(e):null,a=rPe(n);return o||(a?i(a):null)}return i(t)}function _2t(t,e){function r(i){return i?i.closest(e)||r(rPe(kK(i))):null}return r(t)}function v2t(t,e){return iPe(t,e)}function iPe(t,e){if(!t)return;const r=e(t);if(r!==void 0)return r;const{parentNode:i}=t;return iPe(i instanceof ShadowRoot?i.host:i,e)}function LHt(t,e){return!!v2t(e,r=>r===t?!0:void 0)}function b2t(t){return typeof t?.setFocus=="function"}async function DHt(t){if(t)return b2t(t)?t.setFocus():t.focus()}function NHt(t){t&&(m2t(t,y2t)[0]||t).focus()}const fM=":not([slot])";function FHt(t,e,r){e&&!Array.isArray(e)&&typeof e!="string"&&(r=e,e=null);const i=e?Array.isArray(e)?e.map(s=>`[slot="${s}"]`).join(","):`[slot="${e}"]`:fM;return r?.all?w2t(t,i,r):x2t(t,i,r)}function sPe(t,e){return t?Array.from(t.children||[]).filter(r=>r?.matches(e)):[]}function w2t(t,e,r){let i=e===fM?sPe(t,fM):Array.from(t.querySelectorAll(e));i=r&&r.direct===!1?i:i.filter(n=>n.parentElement===t),i=r?.matches?i.filter(n=>n?.matches(r.matches)):i;const s=r?.selector;return s?i.map(n=>Array.from(n.querySelectorAll(s))).reduce((n,o)=>[...n,...o],[]).filter(n=>!!n):i}function x2t(t,e,r){let i=e===fM?sPe(t,fM)[0]||null:t.querySelector(e);i=r&&r.direct===!1||i?.parentElement===t?i:null,i=r?.matches?i?.matches(r.matches)?i:null:i;const s=r?.selector;return s?i?.querySelector(s):i}function UHt(t,e,r){if(typeof e=="string"&&e!=="")return e;if(e==="")return t[r]}function kHt(t){return(!!t).toString()}function zHt(t){return!!T2t(t).length}function T2t(t){return t.target.assignedElements({flatten:!0})}function VHt(t){return!!(t.isPrimary&&t.button===0)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.4.3
 */function hpe(){const{classList:t}=document.body,e=window.matchMedia("(prefers-color-scheme: dark)").matches,r=()=>t.contains(ZMe)||t.contains(XMe)&&e?"dark":"light",i=o=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:o}})),s=o=>{n!==o&&i(o),n=o};let n=r();i(n),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",o=>s(o.matches?"dark":"light")),new MutationObserver(()=>s(r())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}function S2t(){typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document&&(document.readyState==="interactive"?hpe():document.addEventListener("DOMContentLoaded",()=>hpe(),{once:!0}))}const E2t=S2t;E2t();let nPe;function C2t(){try{hSt(".")}catch{dSt(du(Gr(nPe)))}}function BHt(t){const e=[];for(const r of Object.keys(t))customElements.get(`calcite-${r}`)||e.push(t[r]?.());return Promise.all(e)}nPe="components/assets";const oPe=Symbol("widget"),A2t=Symbol("widget-test-data"),O2t=[],R2t={},m5=new WeakMap;function aPe(t,e){let r=e.children;if(r&&r.length)for(let s=0;s<r.length;++s)r[s]=aPe(t,r[s]);else r=O2t;const i=e.vnodeSelector;if(zK(i)){const s=e.properties||R2t,n=s.key||i;return{vnodeSelector:"div",properties:{key:n,afterCreate:M2t,afterUpdate:P2t,afterRemoved:lPe,parentWidget:t,widgetConstructor:i,widgetProperties:{...s,key:n,children:r}},children:void 0,text:void 0,domNode:null}}return e}function M2t(t,e,r,{parentWidget:i,widgetConstructor:s,widgetProperties:n}){const o=new s(n);o.container=t,m5.set(t,o),o.afterCreate?.(o,t),i._internalHandles.add(el(()=>lPe(t)))}function P2t(t,e,r,{widgetProperties:i}){const s=m5.get(t);s&&(s.set(i),s.afterUpdate?.(s,t))}function lPe(t){const e=m5.get(t);e&&(e.afterRemoved?.(e,t),e.destroy(),m5.delete(t))}function zK(t){return typeof t=="function"&&t[oPe]}const dpe=new Set;function I2t(t){dpe.add(t),t.finally(()=>dpe.delete(t))}var cPe;const $2t="esri.widgets.Widget";let L2t=0;const D2t={widgetIcon:"esri-icon-checkbox-unchecked"};function uPe(t,e){for(const r in e)t[r]!=null&&(typeof t[r]=="object"&&typeof e[r]=="object"?uPe(t[r],e?.[r]):t[r]=e[r]);return t}const N2t=uSt({postProcessProjectionOptions(t){const e=t.eventHandlerInterceptor,r=/capture$/i;t.eventHandlerInterceptor=(i,s,n,o)=>{const a=e?.(i,s,n,o),l=r.test(i);if(!((i=i.replace(r,"")).toLowerCase()in n)||l){const c=i[2].toLowerCase()+i.slice(3),h=m=>a?.call(n,m);n.addEventListener(c,h,l);const p=()=>n.removeEventListener(c,h,l),f=o.afterRemoved;o.afterRemoved=m=>{f?.(m),p()}}return a}},handleInterceptedEvent(t,e,r,i){const{eventPhase:s,type:n}=i,o=s===Event.CAPTURING_PHASE;let a=`on${n}${o?"capture":""}`;const l=e.properties;(l&&a in l||(a=`on${n[0].toUpperCase()}${n.slice(1)}${o?"Capture":""}`,l&&a in l))&&(Jwe(),t.scheduleRender(),l[a].call(l.bind||r,i))}});let sV=!1,jn=class extends B5(ws.EventedAccessor){constructor(e,r){super(e,r),this._attached=!1,this._internalHandles=new Ii,this._projector=N2t,this._readyForTrueRender=!1,this.iconClass=D2t.widgetIcon,this.icon=null,this.key=this,this._loadLocale=cX(async()=>{if(this._messageBundleProps&&this._messageBundleProps.length){const o=await bc(this._messageBundleProps.map(async({bundlePath:a,propertyName:l})=>{if(this.destroyed)return;let c=await GX(a);this.uiStrings&&Object.keys(this.uiStrings)&&(c=uPe(K(c),this.uiStrings)),this[l]=c}));if(this.destroyed)return;for(const a of o)a.error&&Q.getLogger(this).error("widget-intl:locale-error",this.declaredClass,a.error)}await this.loadLocale()}),C2t();const i="esri-widget-uid-"+N6(),s=this.render.bind(this);this._trackingTarget=new k5(()=>this.scheduleRender());const n=()=>{if(!this._readyForTrueRender||this.destroyed)return null;const o=s();let{properties:a}=o;a||(o.properties=a={});const{key:l}=a;l||(a.key=i),this.visible?a.styles||(a.styles={}):(a.class="",a.styles={display:"none"}),a.styles.display||(a.styles.display="");let c=0;return o.children?.forEach(h=>{if(zK(h.vnodeSelector))return;let{properties:p}=h;p||(h.properties=p={}),p.key||(p.key=`${this.id}--${c++}`)}),aPe(this,o)};this.render=()=>{if(sV)return n();let o=_Xe(this)??null;if(o)return o;this._trackingTarget.clear(),sV=!0;try{o=iy(this._trackingTarget,n)}catch(a){throw console.error(a),a}finally{sV=!1}return o&&vXe(this,o),o},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then(()=>{this._readyForTrueRender=!0,this._postInitialize()})),I2t(this._resourcesFetch)}normalizeCtorArgs(e,r){const i={...e};return r&&(i.container=r),i}postInitialize(){}beforeFirstRender(){return Promise.all([this.loadDependencies(),this._loadLocale()]).then(()=>{}).catch(_ee)}async loadDependencies(){}async loadLocale(){}destroy(){this.destroyed||($e(this._trackingTarget),$e(this.viewModel),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null,v9(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return q6(e)}get domNode(){return this.container}set domNode(e){this.container=e}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+L2t++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(cPe=oPe,A2t)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(v9(this),this._projector.scheduleRender())}classes(...e){return SXe.apply(this,e)}renderNow(){v9(this),this._projector.renderNow()}_postInitialize(){if(this.destroyed)return;this.scheduleRender(),this._delegatedEventNames?.length&&this._internalHandles.add(ae(()=>this.viewModel,(r,i)=>{i&&this._internalHandles.remove("delegated-events"),r&&F5(r)&&this._internalHandles.add(this._delegatedEventNames.map(s=>TM(r,s,n=>{this.emit(s,n)})),"delegated-events")},Pr)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(_ee),this.scheduleRender()};this._internalHandles.add([zX(e),ae(()=>this.uiStrings,e),Cu(()=>this.container,r=>{this.destroyed||this._attach(r)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){this._attached&&(this._projector.detach(this.render),this._attached=!1),e?.parentNode?.removeChild(e)}};jn[cPe]=!0,u([d()],jn.prototype,"_readyForTrueRender",void 0),u([d({value:null})],jn.prototype,"container",null),u([wr("container")],jn.prototype,"castContainer",null),u([d()],jn.prototype,"iconClass",void 0),u([d()],jn.prototype,"icon",void 0),u([d()],jn.prototype,"id",null),u([d()],jn.prototype,"label",null),u([d()],jn.prototype,"renderable",null),u([d()],jn.prototype,"uiStrings",void 0),u([d()],jn.prototype,"viewModel",void 0),u([d({value:!0})],jn.prototype,"visible",null),u([d()],jn.prototype,"key",void 0),u([d()],jn.prototype,"children",void 0),u([d()],jn.prototype,"afterCreate",void 0),u([d()],jn.prototype,"afterUpdate",void 0),u([d()],jn.prototype,"afterRemoved",void 0),jn=u([P($2t)],jn);const wx=jn;function ppe(t,e){return t&&"copyright"in t&&(!e||typeof t.originOf=="function"&&t.originOf("copyright")==="user")}function F2t(t,e){return t.length!==e.length||t.some((r,i)=>r.text!==e[i].text)}function RL(t,e,r){!r||!e||t.find(i=>i.layerView===e&&i.text===r)||t.push({text:r,layerView:e})}function U2t(t){return t.type==="bing-maps"}const b0=[];let MS=class extends OR{constructor(t){super(t),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.handles.remove("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new Pt,this.view=null,this._allLayerViewsChange=e=>{this.handles.remove("suspension");const r=this.get("view.allLayerViews");r&&this.handles.add(r.map(i=>ae(()=>[i.suspended,i.layer?.attributionVisible],()=>this._updateAttributionItems())),"suspension"),e&&e.removed&&e.removed.forEach(i=>{this._pendingAttributions.delete(i),this._fetchedAttributionData.delete(i)}),this._updateAttributionItems()},this.handles.add([fa(()=>this.view?.allLayerViews,"change",e=>this._allLayerViewsChange(e),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),Cu(()=>this.view?.stationary===!0,()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const t=this.view,e=t?.allLayerViews;b0.length=0,t&&e?(e.forEach(r=>{if(r.suspended||!r.layer?.attributionVisible)return;const i=r.layer;if(ppe(i,"user"))return void RL(b0,r,i.copyright);if(i.hasAttributionData){if(this._fetchedAttributionData.has(r)){const n=this._fetchedAttributionData.get(r);return void(n?RL(b0,r,this._getDynamicAttribution(n,t,i)):ppe(i)&&RL(b0,r,i.copyright))}return void this._fetchAttributionData(r)}const s=i.get("portalItem.accessInformation");RL(b0,r,s||i.copyright)}),F2t(this.items,b0)&&(this.items.removeAll(),this.items.addMany(b0)),b0.length=0,this.notifyChange("state")):this._clear()}async _fetchAttributionData(t){if(this._pendingAttributions.has(t))return;this._pendingAttributions.add(t);const e=await Eu(t.layer.fetchAttributionData());if(this._pendingAttributions.has(t)){const r=e.ok?this._createContributionIndex(e.value,U2t(t.layer)):null;this._pendingAttributions.delete(t),this._fetchedAttributionData.set(t,r)}this._updateAttributionItems()}_createContributionIndex(t,e){const r=t.contributors,i={};if(!r)return i;for(let s=0;s<r.length;s++){const n=r[s],o=n.coverageAreas;if(!o)return;for(const a of o){const l=a.bbox,c=a.zoomMin-(e&&a.zoomMin?1:0),h=a.zoomMax-(e&&a.zoomMax?1:0),p=new ur({xmin:l[1],ymin:l[0],xmax:l[3],ymax:l[2],spatialReference:je.WGS84}),f={extent:n2(p),attribution:n.attribution||"",score:a.score!=null?a.score:100,id:s};for(let m=c;m<=h;m++)i[m]??(i[m]=[]),i[m].push(f)}}return i.maxKey=Math.max.apply(null,Object.keys(i)),i}_getDynamicAttribution(t,e,r){const{extent:i,scale:s}=e;let n=r.tileInfo?.scaleToZoom(s)??0;if(n=Math.min(t.maxKey??0,Math.round(n)),!i||n==null||n<=-1)return"";const o=t[n],a=rx(i.center.clone().normalize(),e.spatialReference),l=new Set;return o?o.filter(c=>{const h=c.id,p=!l.has(h)&&a&&c.extent&&kX(c.extent,a);return p&&l.add(h),p}).sort((c,h)=>h.score-c.score||c.objectId-h.objectId).map(c=>c.attribution).join(", "):""}};u([d({readOnly:!0,type:Pt})],MS.prototype,"items",void 0),u([d({readOnly:!0})],MS.prototype,"state",null),u([d()],MS.prototype,"view",void 0),MS=u([P("esri.widgets.Attribution.AttributionViewModel")],MS);const hPe=MS;function $E(){return function(t,e){if(!t[e])throw new TypeError(`Cannot auto bind undefined function '${String(e)}'`);return{value:z2t(t[e])}}}function k2t(t){const e=t?.type;return t instanceof KeyboardEvent||e==="keyup"||e==="keydown"||e==="keypress"}function z2t(t){return function(e,...r){k2t(e)?exe(e.key)&&(e.preventDefault(),e.stopPropagation(),e.target.click()):t.call(this,e,...r)}}function Jw(t){return(e,r)=>{e.hasOwnProperty("_messageBundleProps")||(e._messageBundleProps=e._messageBundleProps?e._messageBundleProps.slice():[]),e._messageBundleProps.push({bundlePath:t,propertyName:r})}}var V2t=function(t){return{vnodeSelector:"",properties:void 0,children:void 0,text:t.toString(),domNode:null}},dPe=function(t,e){for(var r=0,i=t.length;r<i;r++){var s=t[r];Array.isArray(s)?dPe(s,e):s!=null&&s!==!1&&(s.hasOwnProperty("vnodeSelector")||(s=V2t(s)),e.push(s))}},B2t=function(t,e){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(r.length===1&&typeof r[0]=="string")return{vnodeSelector:t,properties:e||void 0,children:void 0,text:r[0],domNode:null};var s=[];return dPe(r,s),{vnodeSelector:t,properties:e||void 0,children:s,text:void 0,domNode:null}};function mt(t,e,...r){return typeof t!="function"||zK(t)?B2t(t,e,...r):t(e,...r)}const PT="esri-attribution",w0={base:`${PT} esri-widget`,poweredBy:`${PT}__powered-by`,sources:`${PT}__sources`,open:`${PT}--open`,sourcesOpen:`${PT}__sources--open`,link:`${PT}__link`,widgetIcon:"esri-icon-description",interactive:"esri-interactive"};let za=class extends wx{constructor(e,r){super(e,r),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(i=>i.forEach(({target:s})=>this._checkSourceTextOverflow(s))),this.iconClass=w0.widgetIcon,this.icon=null,this.itemDelimiter=" | ",this.messages=null,this.viewModel=new hPe}initialize(){this.addHandles(fa(()=>this.viewModel?.items,"change",()=>this.scheduleRender()))}destroy(){this._resizeObserver?.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,r)=>(e.includes(r.text)||e.push(r.text),e),[]).join(this.itemDelimiter)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[w0.open]:this._isOpen};return mt("div",{bind:this,class:this.classes(w0.base,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}renderPoweredBy(){return mt("div",{class:w0.poweredBy},"Powered by"," ",mt("a",{class:w0.link,href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}renderSourcesNode(){const e=this._isOpen,r=this._isInteractive,i=r?"0":"",{attributionText:s}=this,n={[w0.sourcesOpen]:e,[w0.interactive]:r};return mt("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(w0.sources,n),innerHTML:s,tabindex:i})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let r=!1;const{clientHeight:i,clientWidth:s,scrollWidth:n}=e,o=n>s,a=this._attributionTextOverflowed!==o;if(this._attributionTextOverflowed=o,a&&(r=!0),this._isOpen){const l=i<this._prevSourceNodeHeight;this._prevSourceNodeHeight=i,l&&(this._isOpen=!1,r=!0)}r&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};u([d()],za.prototype,"_isOpen",void 0),u([d()],za.prototype,"_isInteractive",null),u([d()],za.prototype,"_attributionTextOverflowed",void 0),u([d()],za.prototype,"_prevSourceNodeHeight",void 0),u([d({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],za.prototype,"attributionText",null),u([d()],za.prototype,"iconClass",void 0),u([d()],za.prototype,"icon",void 0),u([d()],za.prototype,"itemDelimiter",void 0),u([d()],za.prototype,"label",null),u([d(),Jw("esri/widgets/Attribution/t9n/Attribution")],za.prototype,"messages",void 0),u([d()],za.prototype,"view",null),u([d({type:hPe})],za.prototype,"viewModel",void 0),u([$E()],za.prototype,"_toggleState",null),za=u([P("esri.widgets.Attribution")],za);const G2t=za,pPe=t=>{let e=class extends t{constructor(...r){super(...r),this.goToOverride=null,this.view=null}callGoTo(r){const{view:i}=this;return R5(i),this.goToOverride?this.goToOverride(i,r):i.goTo(r.target,r.options)}};return u([d()],e.prototype,"goToOverride",void 0),u([d()],e.prototype,"view",void 0),e=u([P("esri.widgets.support.GoTo")],e),e},j2t="esri.widgets.CompassViewModel";let _b=class extends pPe(we){constructor(e){super(e),this._handles=new Ii,this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._handles.add(ae(()=>this.view,this._updateRotationWatcher,Pr))}destroy(){Ni(this._handles),this.view=null}get canShowNorth(){const e=this.get("view.spatialReference");return!(!e||!e.isWebMercator&&!e.isGeographic)}get state(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}reset(){if(!this.get("view.ready"))return;const e={};this.view?.type==="2d"?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){e!=null&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const r=-e.heading;this.orientation={x:0,y:0,z:r}}_updateRotationWatcher(e){this._handles.removeAll(),e&&this._handles.add(e.type==="2d"?ae(()=>e?.rotation,this._updateForRotation,Pr):ae(()=>e?.camera,this._updateForCamera,Pr))}};u([d({readOnly:!0})],_b.prototype,"canShowNorth",null),u([d()],_b.prototype,"orientation",void 0),u([d({readOnly:!0})],_b.prototype,"state",null),u([d()],_b.prototype,"view",void 0),_b=u([P(j2t)],_b);const fPe=_b,x0={base:"esri-compass esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",icon:"esri-compass__icon",rotationIcon:"esri-icon-dial",northIcon:"esri-icon-compass",widgetIcon:"esri-icon-locate-circled",interactive:"esri-interactive",disabled:"esri-disabled"};let Nd=class extends wx{constructor(e,r){super(e,r),this.iconClass=x0.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new fPe}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:r}=this.viewModel,i=r==="disabled",s=(r==="rotation"?"rotation":"compass")=="compass",n=i?-1:0,o={[x0.disabled]:i,[x0.interactive]:!i},a={[x0.northIcon]:s,[x0.rotationIcon]:!s},{messages:l}=this;return mt("div",{bind:this,class:this.classes(x0.base,o),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:n,"aria-label":l.reset,title:l.reset},mt("span",{"aria-hidden":"true",class:this.classes(x0.icon,a),styles:this._toRotationTransform(e)}),mt("span",{class:x0.text},l.reset))}_reset(){this.viewModel.reset()}_toRotationTransform(e){return{transform:`rotateZ(${e.z}deg)`}}};u([d()],Nd.prototype,"goToOverride",null),u([d()],Nd.prototype,"iconClass",void 0),u([d()],Nd.prototype,"icon",void 0),u([d()],Nd.prototype,"label",null),u([d(),Jw("esri/widgets/Compass/t9n/Compass")],Nd.prototype,"messages",void 0),u([d()],Nd.prototype,"view",null),u([d({type:fPe})],Nd.prototype,"viewModel",void 0),u([$E()],Nd.prototype,"_reset",null),Nd=u([P("esri.widgets.Compass")],Nd);const H2t=Nd,IT="esri-navigation-toggle",qu={base:`${IT} esri-widget`,button:`${IT}__button esri-widget--button`,activeButton:`${IT}__button--active`,panButton:`${IT}__button--pan`,rotateButton:`${IT}__button--rotate`,isLayoutHorizontal:`${IT}--horizontal`,rotationIcon:"esri-icon-rotate",panIcon:"esri-icon-pan",widgetIcon:"esri-icon-pan2",disabled:"esri-disabled"};let PS=class extends we{constructor(t){super(t),this.navigationMode="pan",this.view=null}initialize(){this.own(Cu(()=>this.view?.inputManager,()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){return this.get("view.ready")&&this.view?.type==="3d"?"ready":"disabled"}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){this.get("view.inputManager").primaryDragAction=this.navigationMode==="pan"?"pan":"rotate"}};u([d({readOnly:!0})],PS.prototype,"state",null),u([d()],PS.prototype,"navigationMode",void 0),u([d()],PS.prototype,"view",void 0),PS=u([P("esri.widgets.NavigationToggleViewModel")],PS);const mPe=PS;let Fd=class extends wx{constructor(e,r){super(e,r),this.iconClass=qu.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new mPe}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}toggle(){return this.viewModel.toggle()}render(){const e=this.get("viewModel.state")==="disabled",r=this.get("viewModel.navigationMode")==="pan",i={[qu.disabled]:e,[qu.isLayoutHorizontal]:this.layout==="horizontal"},s={[qu.activeButton]:r},n={[qu.activeButton]:!r},o=e?-1:0,a=this.messages.toggle;return mt("div",{bind:this,class:this.classes(qu.base,i),onclick:this._toggle,onkeydown:this._toggle,tabIndex:o,"aria-label":a,title:a},mt("div",{class:this.classes(qu.button,qu.panButton,s)},mt("span",{class:qu.panIcon})),mt("div",{class:this.classes(qu.button,qu.rotateButton,n)},mt("span",{class:qu.rotationIcon})))}_toggle(){this.toggle()}};u([d()],Fd.prototype,"iconClass",void 0),u([d()],Fd.prototype,"icon",void 0),u([d()],Fd.prototype,"label",null),u([d({value:"vertical"})],Fd.prototype,"layout",null),u([d(),Jw("esri/widgets/NavigationToggle/t9n/NavigationToggle")],Fd.prototype,"messages",void 0),u([d()],Fd.prototype,"view",null),u([d({type:mPe})],Fd.prototype,"viewModel",void 0),u([$E()],Fd.prototype,"_toggle",null),Fd=u([P("esri.widgets.NavigationToggle")],Fd);const q2t=Fd,EA={button:"esri-widget--button esri-widget",disabled:"esri-disabled",interactive:"esri-interactive",iconText:"esri-icon-font-fallback-text",icon:"esri-icon"};let Tg=class extends wx{constructor(){super(...arguments),this.enabled=!0,this.iconClass=null,this.icon=null,this.title=""}render(){const e=this.enabled?0:-1,r={[EA.disabled]:!this.enabled,[EA.interactive]:this.enabled};return mt("div",{bind:this,class:this.classes(EA.button,r),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:e,title:this.title},mt("span",{"aria-hidden":"true",role:"presentation",class:this.classes(EA.icon,this.iconClass??"")}),mt("span",{class:EA.iconText},this.title))}_triggerAction(){this.action.call(this)}};u([d()],Tg.prototype,"action",void 0),u([d()],Tg.prototype,"enabled",void 0),u([d()],Tg.prototype,"iconClass",void 0),u([d()],Tg.prototype,"icon",void 0),u([d()],Tg.prototype,"title",void 0),u([$E()],Tg.prototype,"_triggerAction",null),Tg=u([P("esri.widgets.IconButton")],Tg);const fpe=Tg;let IS=class extends we{get canZoomIn(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),r=this.get("view.constraints.effectiveMaxScale");return r===0||e>r}get canZoomOut(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),r=this.get("view.constraints.effectiveMinScale");return r===0||e<r}};u([d({readOnly:!0})],IS.prototype,"canZoomIn",null),u([d({readOnly:!0})],IS.prototype,"canZoomOut",null),u([d()],IS.prototype,"view",void 0),IS=u([P("esri.widgets.Zoom.ZoomConditions2D")],IS);const W2t=IS;let $S=class extends we{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};u([d({readOnly:!0})],$S.prototype,"canZoomIn",null),u([d({readOnly:!0})],$S.prototype,"canZoomOut",null),u([d()],$S.prototype,"view",void 0),$S=u([P("esri.widgets.Zoom.ZoomConditions3D")],$S);const X2t=$S;let e_=class extends we{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return this._zoomConditions!=null&&this._zoomConditions.canZoomIn}get canZoomOut(){return this._zoomConditions!=null&&this._zoomConditions?.canZoomOut}get state(){return this.view?.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new W2t({view:e}):e.type==="3d"&&(this._zoomConditions=new X2t({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():OV(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():OV(e.goTo({zoomFactor:.5}))}};u([d()],e_.prototype,"_zoomConditions",void 0),u([d()],e_.prototype,"canZoomIn",null),u([d()],e_.prototype,"canZoomOut",null),u([d({readOnly:!0})],e_.prototype,"state",null),u([d()],e_.prototype,"view",null),e_=u([P("esri.widgets.Zoom.ZoomViewModel")],e_);const gPe=e_,CA={base:"esri-zoom esri-widget",horizontalLayout:"esri-zoom--horizontal",zoomInIcon:"esri-icon-plus",zoomOutIcon:"esri-icon-minus",widgetIcon:"esri-icon-zoom-in-magnifying-glass"};let Tf=class extends wx{constructor(e,r){super(e,r),this.iconClass=CA.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new gPe}initialize(){this._zoomInButton=new fpe({action:this.zoomIn.bind(this),iconClass:CA.zoomInIcon}),this._zoomOutButton=new fpe({action:this.zoomOut.bind(this),iconClass:CA.zoomOutIcon})}destroy(){this._zoomInButton=$e(this._zoomInButton),this._zoomOutButton=$e(this._zoomOutButton)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){const e=this.viewModel,r={[CA.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:i,canZoomOut:s}=e;this._zoomInButton.enabled=i,this._zoomOutButton.enabled=s;const{zoomIn:n,zoomOut:o}=this.messages;return this._zoomInButton.title=n,this._zoomOutButton.title=o,mt("div",{class:this.classes(CA.base,r)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};u([d()],Tf.prototype,"iconClass",void 0),u([d()],Tf.prototype,"icon",void 0),u([d()],Tf.prototype,"label",null),u([d({value:"vertical"})],Tf.prototype,"layout",null),u([d(),Jw("esri/widgets/Zoom/t9n/Zoom")],Tf.prototype,"messages",void 0),u([d()],Tf.prototype,"view",null),u([d({type:gPe})],Tf.prototype,"viewModel",void 0),Tf=u([P("esri.widgets.Zoom")],Tf);const Z2t=Tf;function Y2t(t){return t?.view!==void 0}let $N=class extends sSt{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[],this._updateViewAwareWidgets=r=>{this.components.forEach(i=>{const s=this._find(i),n=s?.widget;Y2t(n)&&(n.view=r)})},this._componentsWatcher=(r,i)=>{this._removeComponents(i),this._addComponents(r),this._adjustPadding(r)}}initialize(){this.addHandles([ae(()=>this.components,this._componentsWatcher,Pr),ae(()=>this.view,this._updateViewAwareWidgets,Pr)])}_add(e,r,i,s,n){let o=e;if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;o=this._createComponent(e)}super._add(o,r,i,s,n)}_removeComponents(e){e.forEach(r=>{const i=this._find(r);i&&(this.remove(i),i.destroy())})}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:r}=this.padding;this.padding=r}}_addComponents(e){this.constructed&&e.forEach(r=>this.add(this._createComponent(r),this._defaultPositionLookup[r]))}_createComponent(e){const r=this._createWidget(e);return new IN({id:e,node:r})}_createWidget(e){const{view:r}=this;switch(e){case"attribution":return new G2t({view:r});case"compass":return new H2t({view:r});case"navigation-toggle":return new q2t({view:r});case"zoom":return new Z2t({view:r})}}};u([d()],$N.prototype,"components",void 0),$N=u([P("esri.views.ui.DefaultUI")],$N);const yPe=$N;let LN=class extends yPe{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};u([d()],LN.prototype,"components",void 0),LN=u([P("esri.views.ui.3d.DefaultUI3D")],LN);const _Pe=LN;let Ye=class extends EWe(_Ze(jXe(HZe))){constructor(t){super(t),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._defaults={},this._externallySet={environment:!1},this._createGraphicsViewController=null,this._resolveWhenReady=[],this._propertiesPool=new fy({slicePlane:xwe},this),this._resourceController=tyt(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new Pq({view:this}),this.labeler=new db({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new uE,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new Rb,this.environmentManager=new Rd,this.floors=new Pt,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new XZe({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new bgt,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new _Pe,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.highlightOptions=new eW,this.voxelWasm=null,this.voxelWasmPromise=null,dze(),t&&t.environment||(this._defaults.environment=new fS,this.environment=this._defaults.environment);const e=(r=null)=>{r!=null&&r.type===si.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async i=>{try{await i.when()}catch{}this._updatingChanged()}))};this.addHandles([fa(()=>this.map?.allLayers,"after-changes",r=>e(r),{onListenerAdd:()=>e(),onListenerRemove:()=>e(),sync:!0}),this.allLayerViews.on("after-changes",r=>this._updateUpdatingMonitors(r)),ae(()=>this.map,r=>{r&&"load"in r&&r.load&&r.load().catch(()=>{})})]),this.inputManager=new cst({view:this}),this.stateManager=new vn({view:this})}initialize(){this.groundView=new nZe({view:this}),this._updateUpdatingMonitors();const t=()=>this._updateDefaultToMapOptions();this.addHandles(fa(()=>this.map?.allLayers,"after-changes",t,{onListenerAdd:t,onListenerRemove:t})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,e=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=e)},Pr),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,e=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=e)},Pr),this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,e=>O$e(e>0?1e3/Math.ceil(e):0),Pr),this.updatingHandles.add(()=>this.map?.ground,t,Is),this.updatingHandles.add(()=>this.map?.ground?.opacity,()=>this._updateDefaultHitTestOptions(),Is),this.addHandles(ae(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),qr))}destroy(){this.destroyed||(this.updatingHandles.removeAll(),this.removeAllHandles(),this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=$e(this.sharedSymbolResources),this._set("labeler",$e(this.labeler)),this._set("deconflictor",$e(this.deconflictor)),this._resourceController=$e(this._resourceController),this._set("stateManager",$e(this.stateManager)),this._set("inputManager",$e(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.removeHandles("updatingMonitors"),this._set("environmentManager",$e(this.environmentManager)),this.groundView=$e(this.groundView),this._exitBasemapTerrain(),this._stage?.destroy(),this.removeAllHandles(),this.updatingHandles.removeAll(),this.handles.removeAll())}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){return this.basemapTerrain?.spatialReference}get animation(){return this.state?.animation}get camera(){return this.stateManager?.camera}set camera(t){this.stateManager&&(this.stateManager.camera=t)}get contentCamera(){return this.stateManager?.contentCamera}set contentCamera(t){this.stateManager&&(this.stateManager.contentCamera=t)}installContentCameraReset(t={sticky:!1}){return this.stateManager.installContentCameraReset(t)}get center(){return this.stateManager?.center}set center(t){this.stateManager&&(this.stateManager.center=t)}get clippingArea(){if(this.viewingMode==="global")return null;let t=this._userClippingArea||("clippingArea"in this.map?this.map?.clippingArea:void 0);return!this._userClippingArea&&!this.get("map.clippingEnabled")||t==null?(this._clippingArea=null,null):t instanceof ur?this.spatialReference&&(t=ML(t,this.spatialReference),t==null)?(Q.getLogger(this).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(t=t.clone(),t.intersection(this._groundAndLayersExtent)==null&&(t.xmin=t.xmax,t.ymin=t.ymax),t.zmin=void 0,t.zmax=void 0,t.equals(this._clippingArea)||(this._clippingArea=t),this._clippingArea):(Q.getLogger(this).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(t){this.ready&&this.viewingMode==="global"&&t!=null?Q.getLogger(this).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=t}get renderDataExtent(){if(this.state.viewingMode===Ue.Global)return null;const t=this.renderSpatialReference,e=this.dataExtent;return e==null||t==null||e.spatialReference.equals(t)?e:ML(e,t)}get dataExtent(){let t=this._groundAndLayersExtent;const e=this.spatialReference||je.WGS84,r=ML(this.clippingArea,e);r!=null&&(t=t!=null?t.intersection(r):r);const i=this._get("dataExtent");return t!=null&&t.equals(i)?i:t}get _groundAndLayersExtent(){const t=this.spatialReference||je.WGS84;let e;const r=n=>{const o=ML(n,t);o!=null&&(e!=null?e.union(o):e=o.clone())},i=this.basemapTerrain;if(i?.spatialReference){const n=i.groundExtent;r(new ur({xmin:n[0],ymin:n[1],zmin:0,xmax:n[2],ymax:n[3],zmax:0,spatialReference:i.spatialReference}))}if(this.map){const n=o=>{o.fullExtent==null||o.type==="graphics"&&o.internal||r(o.fullExtent)};this.map.allLayers.forEach(o=>n(o))}if(e==null)return null;e.hasZ?(e.zmin=Math.min(0,e.zmin??0),e.zmax=Math.max(0,e.zmax??0)):(e.zmin=0,e.zmax=0);const s=this._get("_groundAndLayersExtent");return e.equals(s)?s:e}set environment(t){t!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",t)}castEnvironment(t){return t?t instanceof fS?t:t instanceof $xe?this.environment!=null?this.environment.cloneWithWebsceneEnvironment(t):fS.fromWebsceneEnvironment(t):vs(fS,t):new fS}get extent(){return this.stateManager?.extent}set extent(t){this.stateManager&&(this.stateManager.extent=t)}get screenCenter(){return this.stateManager?.screenCenter}get frustum(){return this.stateManager?.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||(this.toolViewManager?.interacting??!1)}get stationary(){return!this.animation&&!this.resizing&&(this.state==null||this.state.stationary)}get navigating(){return this.state?.navigating??!1}get padding(){return this.stateManager?.padding}set padding(t){this.stateManager&&(this.stateManager.padding=t)}set qualityProfile(t){bN.isValidProfile(t)&&(bN.apply(t,this.qualitySettings),this._set("qualityProfile",t))}get qualityProfile(){return this._get("qualityProfile")||bN.getDefaultProfile()}set slicePlane(t){if(this._stage!=null&&this._stage.renderer.setParameters({slicePlane:t}),t==null)return void this._set("slicePlane",null);const e=this._propertiesPool.get("slicePlane");fx(t,e),this._set("slicePlane",e)}get typeSpecificPreconditionsReady(){return!!this.viewingMode}get resolution(){return this.spatialReference!=null?Nwe(this.scale,this.spatialReference):0}get scale(){return this.stateManager?.scale}set scale(t){this.stateManager&&(this.stateManager.scale=t)}get heightModelInfo(){const t=this.getDefaultHeightModelInfo();return t!=null?ux.deriveUnitFromSR(t,this.spatialReference):null}get updating(){if(this.destroyed)return!1;let t=0,e=this.layerViewManager.updating,r=e?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(s=>{if(s.isFulfilled()){if(s.updating){if(e=!0,s.suspended||oM(s))return;++r,t+=s.updatingProgress}}else++r});for(const s of this._updatingObjects)s!=null&&s.updating&&(r+=.1,t+=.5*.1);for(const s of this._updatingObjectsWithProgress)s!=null&&s.updating&&(++r,t+=s.updatingProgress);const i=!this.stateManager.test.updatingIgnoreRenderState&&this.state.updating;if(e=!!(e||r>0||this.updatingHandles.updating||!this.ready||!this.stationary||i||this._createGraphicsViewController||this.inputManager?.updating||this.map?.allLayers?.some(s=>!s.isFulfilled())),e?(this._numUpdating=Math.max(r,this._numUpdating),t+=this._numUpdating-r):this._numUpdating=0,this._numUpdating>0?t/=this._numUpdating:t=e?0:1,this._get("updatingProgress")!==t){const s=performance.now();if(t<1){const n=Math.min((s-this._lastUpdateTime)/2e3,1);t=this.updatingProgress*(1-n)+t*n}this._set("updatingProgress",t),this._lastUpdateTime=e&&t<1?s:0}return e}get _updatingObjects(){return[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager]}get _updatingObjectsWithProgress(){return[this.deconflictor,this.labeler,this.basemapTerrain]}get viewingMode(){const t=this._predeterminedViewingMode;if(t!=null)return h9(t);const e=this.spatialReference;return e?this.defaultsFromMap?.viewingMode!=null&&e.equals(this.defaultsFromMap.spatialReference)?h9(this.defaultsFromMap.viewingMode):yq(e,Ue.Global)?"global":"local":"global"}set viewingMode(t){this.ready?Q.getLogger(this).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",t)}get viewpoint(){return this.stateManager?.viewpoint}set viewpoint(t){this.stateManager&&(this.stateManager.viewpoint=t)}get zoom(){return this.stateManager.zoom}set zoom(t){this.stateManager&&(this.stateManager.zoom=t)}get resourceController(){return this._resourceController}get performanceInfo(){return new Ayt(this)}on(t,e,r,i){return this.viewEvents.on(t,e,r,i)||super.on(t,e)}hasEventListener(t){return super.hasEventListener(t)||this.viewEvents.hasHandler(t)}toMap(t,e){if(!this.ready)return Q.getLogger(this).error("#toMap()","Scene view cannot be used before it is ready"),null;const r=e?this.externalToInternalIntersectOptions(e):this._defaultToMapOptions,i=r.graphics!=null&&(r.graphics.include!=null||r.graphics.exclude!=null),s=Ose(t)?Ase(this,t):t,n=Pf(s);r.enableDraped=r.include&&!r.include.has(y_)||r.exclude&&r.exclude.has(y_);const o=this.sceneIntersectionHelper,a=qh(this.state.viewingMode);if(a.options.selectionMode=!0,a.options.store=i?wo.ALL:wo.MIN,o.intersectIntersectorScreen(n,a,r),i){for(const l of a.results.all){const c=IW(l,this);if(c==null)return this._intersectResultToMapPoint(l);if(c.type!=="graphic"||this._testGraphicUidFilter(r.graphics,c.graphic))return this._intersectResultToMapPoint(l)}return null}return this._intersectResultToMapPoint(a.results.min)}toScreen(t){if(!this.ready)return Q.getLogger(this).error("#toScreen()","Scene view cannot be used before it is ready"),null;const e=(t.z==null?kf(this.elevationProvider,t):null)??0;return So(t,$T,this.renderSpatialReference,e),this.state.camera.projectToScreen($T,nV),kh(nV[0],nV[1])}pixelSizeAt(t){return this.ready?t?(So(t,$T,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt($T)):0:(Q.getLogger(this).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(t){const e=this.basemapTerrain.overlayManager;return e?e.overlayPixelSizeInMapUnits(t):1}hitTest(t,e){if(!this.ready)return Q.getLogger(this).error("#hitTest()","Scene view cannot be used before it is ready"),null;const r=Ose(t)?Ase(this,t):t,i=Ji(r.x,r.y),s=e?this.externalToInternalIntersectOptions(e):this._defaultHitTestOptions;s.requiresGroundFeedback=!0,s.enableDraped=!0;const n=qh(this.state.viewingMode);n.options.selectionMode=!0,n.options.store=wo.ALL,this.sceneIntersectionHelper.intersectIntersectorScreen(i,n,s);const o=this._intersectResultsToHits(n.results.all,s.graphics),a=n.results.ground,l=Wde(a,this),c=l!=null&&"type"in l&&l.type==="integrated-mesh"?l:null,h={screenPoint:r,results:o,ground:{mapPoint:this._intersectResultToMapPoint(a),distance:Mp(a)?a.distanceInRenderSpace:0,layer:c}};return ai.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(h.intersector=n),Promise.resolve(h)}async popupHitTest(t){const{results:e,ground:r}=await FTt(this,t);let i=null;return!(e.length===0||Math.abs((e[0].distance??0)-r.distance)<1e-5)||r.layer&&r.layer.type==="integrated-mesh"||(i=r.mapPoint),{results:e,screenPoint:t,mapPoint:i}}goTo(t,e){return this.updatingHandles.addPromise(this.stateManager.goTo(t,e))}async whenAnalysisView(t){if(t.parent==null)throw new V("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:t});switch(t.parent.type){case"line-of-sight":case"dimension":return(await this.whenLayerView(t.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(t)}}whenLayerView(t){return super.whenLayerView(t)}async takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshot(e);return Jz(r,e,this._pixelFormat())}async _takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshot(e);return Qz(r,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshotWithOID(e);return[Qz(r[0],this._pixelFormat()),Qz(r[1],this._pixelFormat())]}_completeSettings(t){const e=gTt(t,this);return e.pixelRatio/=this.state.pixelRatio,bTt(e,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:t=>this._takeScreenshot(t),takeScreenshotWithObjectAndLayerId:t=>this._takeScreenshotWithObjectAndLayerId(t)}}async takeScreenshotWithObjectAndLayerId(t){if(!oe("enable-feature:objectAndLayerId-rendering"))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshotWithOID(e),i=Jz(r[0],e,this._pixelFormat()),s=this._completeSettings(t);return s.format="png",[i,Jz(r[1],s,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){if(this._stage.renderView.objectAndLayerIdRenderHelper==null)throw new Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()}addUpdatingPromise(t){return this.updatingHandles.addPromise(t)}importLayerView(t){return Dse.importLayerView(t)}hasLayerViewModule(t){return Dse.hasLayerViewModule(t)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){return this.map&&"initialViewProperties"in this.map&&this.map?.initialViewProperties?.spatialReference||this.defaultsFromMap?.spatialReference||this.defaultsFromMap?.ready&&this._initialDefaultSpatialReference||null}async validate(){let t=XTt(this.type);const e=oe("safari");if(e&&e<9&&(t=new V("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:e})),t!=null)throw Q.getLogger(this).warn("#validate()",t.message),t}get _predeterminedViewingMode(){const t=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties?.viewingMode:null)??null;return t!=null?kie(t):null}getSpatialReferenceSupport({spatialReference:t,layer:e}){const r=this._predeterminedViewingMode;if(r!=null)return this._validateSpatialReferenceForViewingMode(t,e,r)?{constraints:this._makeSpatialReferenceConstraints(t,e,r)}:null;const i=this._validateSpatialReferenceForViewingMode(t,e,Ue.Local),s=this._validateSpatialReferenceForViewingMode(t,e,Ue.Global);return i||s?i&&s?{constraints:this._makeSpatialReferenceConstraints(t,e,null)}:i?{constraints:this._makeSpatialReferenceConstraints(t,e,Ue.Local)}:{constraints:this._makeSpatialReferenceConstraints(t,e,Ue.Global)}:null}_validateSpatialReferenceForViewingMode(t,e,r){return!!yq(t,r)&&(e==null||!!tte(e)||(!bO(e)||QU(e,t,r)!=null)&&(!ete(e)||r!==Ue.Global))}_makeSpatialReferenceConstraints(t,e,r){if(e==null)return[{spatialReference:t,viewingMode:r}];const i=t.isWebMercator,s=t.isWGS84;return tte(e)&&(i||s)?!s||r===Ue.Local||dK(e.tileInfo,e.fullExtent,t,Ue.Global)===null?[{spatialReference:t,viewingMode:r},{spatialReference:je.WebMercator,viewingMode:r}]:[{spatialReference:i?je.WGS84:je.WebMercator,viewingMode:r}]:bO(e)||ete(e)||!i&&!s?bO(e)&&i&&r!==Ue.Global?[{spatialReference:t,viewingMode:r},{spatialReference:je.WGS84,viewingMode:Ue.Local}]:[{spatialReference:t,viewingMode:r}]:[{spatialReference:t,viewingMode:r},{spatialReference:i?je.WGS84:je.WebMercator,viewingMode:r}]}_validateSpatialReference(t){const e=this.getSpatialReferenceSupport({spatialReference:t})!=null,r=this._predeterminedViewingMode;return e||(r!=null?Q.getLogger(this).warnOnce(`Spatial reference defined on view not supported in ${h9(r)} viewing mode.`):t.isGeographic&&Q.getLogger(this).warnOnce("Spatial reference is geographic but not supported.")),e}whenReady(){return new Promise(t=>{this.ready?t(this):this._resolveWhenReady.push(t)})}computeMapPointFromVec3d(t,e){let r=this.spatialReference||je.WGS84;return Zs(t,this.renderSpatialReference,t,r)||(r=je.WGS84,Zs(t,this.renderSpatialReference,t,r)),e?(e.x=t[0],e.y=t[1],e.z=t[2],e.spatialReference=r):e=new Ke(t,r),e}trackGraphicState(t){if(!t.graphic)return Q.getLogger(this).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const e=this.getViewForGraphic(t.graphic);let r=null,i=!1;const s=n=>{!i&&n!=null&&"processor"in n&&n.processor?.type==="graphics-3d"&&n.processor.graphicsCore&&(r=n.processor.graphicsCore.trackGraphicState(t))};return e!=null?s(e):this.whenViewForGraphic(t.graphic,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{i=!0,r!=null&&(r.remove(),r=null)}}}highlight(t){if(Array.isArray(t))return N2(t.map(r=>this.highlight(r)));if(Pt.isCollection(t))return N2(t.toArray().map(r=>this.highlight(r)));const e=this.getViewForGraphic(t);return e&&"highlight"in e?e.highlight(t):el()}maskOccludee(t){if(!t)return Q.getLogger(this).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const e=this.getViewForGraphic(t);let r=null,i=!1;const s=n=>{!i&&n!=null&&zTt(n)&&(r=n.maskOccludee(t))};return e!=null?s(e):this.whenViewForGraphic(t,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{i=!0,r!=null&&(r.remove(),r=null)}}}getViewForGraphic(t){return t.layer===this.graphics?this.graphicsView:t.layer?this.allLayerViews.find(e=>e.layer===t.layer):null}graphicChanged(t){this.graphicsView!=null&&this.graphicsView.graphicChanged(t)}async whenViewForGraphic(t,e){if(t.layer===this)return await ay(()=>this.graphicsView),this.graphicsView;if(!t.layer||!this.map)throw new V("no-view-for-graphic");return e&&e.waitForLayer&&!this.map.allLayers.includes(t.layer)?new Promise((r,i)=>{const s=this.map.allLayers.on("change",n=>{n.added.includes(t.layer)&&(s.remove(),this.whenLayerView(t.layer).then(r,i))})}):this.whenLayerView(t.layer)}externalToInternalIntersectOptions(t){const e=this._externalToInternalRenderItems(t.include,cR.INCLUDE),r=this._externalToInternalRenderItems(t.exclude,cR.EXCLUDE);return{include:e.layerUids,exclude:r.layerUids,graphics:{include:e.graphicUids,exclude:r.graphicUids}}}_intersectResultToMapPoint(t,e){return t.getIntersectionPoint($T)?(e=this.computeMapPointFromVec3d($T,e),t.intersector===Gi.TERRAIN&&this.basemapTerrain&&(e.z=kf(this.basemapTerrain,e)??0),e):null}_intersectResultsToHits(t,e){const r=new Array;let i=null;for(let s=0;s<t.length;s++){const n=t[s],o=Wde(n,this);if(o!=null&&(o===this.map.ground||"type"in o&&o.type==="integrated-mesh"))break;const a=IW(n,this);if(a==null)continue;if(a.type==="graphic"){if(i==null&&s!==t.length-1&&(i=new Set),i!=null){const h=this._getGraphicFilterUid(a.graphic);if(i.has(h))continue;i.add(h)}if(!this._testGraphicUidFilter(e,a.graphic))continue}const l=this._intersectResultToMapPoint(n),c=n.distanceInRenderSpace;r.push({...a,mapPoint:l,distance:c})}return r}_getGraphicFilterUid(t){const e=t.sourceLayer,r=t.layer,i=e&&"objectIdField"in e?e:r&&"objectIdField"in r?r:e;if(i){const s=i.objectIdField??TWe,n=t.attributes?.[s];if(n)return`o-${i.id}-${n}`}return`u-${t.uid}`}_testGraphicUidFilter(t,e){const r=this._getGraphicFilterUid(e);return t==null||(t.include==null||t.include.has(r))&&(t.exclude==null||!t.exclude.has(r))}_externalToInternalRenderItems(t,e,r={layerUids:void 0,graphicUids:void 0}){if(!t)return r;if(t instanceof Nl)J2t(r,this._getGraphicFilterUid(t)),e===cR.INCLUDE&&(this.graphicsView!=null&&t.layer===this?AA(r,this.graphicsView.processor.layer.id):t.layer&&AA(r,t.layer.uid));else if(xV(t))for(const i of t)i===this.graphics&&this.graphicsView!=null?AA(r,this.graphicsView.processor.layer.id):i===this.map.ground?AA(r,y_):this._externalToInternalRenderItems(i,e,r);else"uid"in t&&AA(r,t.uid);return r}_initBasemapTerrain(){this._set("basemapTerrain",new Xvt({view:this})),this._set("elevationProvider",new Q3({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new xl({view:this})),this._set("featureTiles",new ho({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const t=()=>{const e=this.basemapTerrain?.extent;if(this.clippingArea||e)if(e&&this.basemapTerrain.spatialReference){const r=this.basemapTerrain.extent!=null&&this.basemapTerrain.spatialReference!=null?hx(Q5(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;this.clippingArea!=null?this.featureTiles.filterExtent=this.clippingArea.intersection(r):this.featureTiles.filterExtent=r}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.addHandles([this.updatingHandles.add(()=>ai.FEATURE_TILE_TREE_SHOW_TILES,e=>{e&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(ce(()=>import("./FeatureTileTree3DDebugger-4a7c988d.js"),["./FeatureTileTree3DDebugger-4a7c988d.js","./TileTreeDebugger-e847dad5.js"],import.meta.url)).then(({FeatureTileTree3DDebugger:r})=>{!this._featureTreeDebugger&&ai.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new r({view:this}))}):e||!this._featureTreeDebugger||ai.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},Is),this.updatingHandles.add(()=>this.clippingArea,t,Is),this.updatingHandles.add(()=>this.basemapTerrain.extent,t,Is)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.exit(),this.removeHandles("render-coords-helper"),this.removeHandles("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const t=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(t)||this._set("mapCoordsHelper",new Fgt(this.map,t));const e=this.state.isGlobal,r=bWe(e,t);r!==this.renderSpatialReference&&(this._set("renderCoordsHelper",Vgt.create(this.state.viewingMode,r)),e||this.addHandles(ae(()=>this.basemapTerrain?.extent,i=>{const s=this.renderCoordsHelper.spatialReference;i==null||i[0]===0&&i[1]===0&&i[2]===0&&i[3]===0||!jM(i,this.basemapTerrain.spatialReference,mpe,s)||(this.renderCoordsHelper.extent=mpe)},qr),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(_E/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.removeHandles("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(t=null){t!=null&&t.type===si.MOVE||(this.removeHandles("updatingMonitors"),this.allLayerViews.forEach(e=>{e.destroyed||(this.addHandles(ae(()=>[e.updating,e.updatingProgress],()=>this._updatingChanged(),qr),"updatingMonitors"),e.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(t,e){if(!this.overlay||!this.overlay.hasVisibleItems)return e;const r=t.getContext("2d");return r.putImageData(e,0,0),this.overlay.renderCanvas(t),r.getImageData(0,0,e.width,e.height)}_initStage(){const t={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(s,n)=>this._renderScreenshotOverlay(s,n)}},e=new wgt(this.state.viewingMode,s=>this._stage.layers.forAll(s),this);this._set("sceneIntersectionHelper",e);const r=q6(this.surface);this._stage=new Qc({view:this,options:t,container:r}),this._stage.renderer.setParameters({slicePlane:this.slicePlane}),this.addHandles([this.updatingHandles.add(()=>this.qualitySettings.antialiasingEnabled,()=>this._stage.renderer.setParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled}),Pr),this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,s=>this._stage.renderer.setParameters({highQualityTransparency:s}),Pr),ae(()=>this.magnifier,s=>this._stage.renderView.magnifier=s,Is),this.on("pointer-move",()=>this._stage?.renderer.resetAnimation()),TM(this._stage.renderView.canvas,"webglcontextlost",s=>this.fatalError=new V("webgl-context-lost",s.statusMessage))],"stage");const i=()=>{this._stage.renderer.setParameters({defaultHighlightOptions:eW.toEngineOptions(this.highlightOptions)})};this.addHandles(this.updatingHandles.add(()=>[this.highlightOptions.color,this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference],i),"stage"),i(),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(_E/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage=$e(this._stage),this.removeHandles("stage"),this._set("canvas",null)}_initSurface(t){this._exitSurface(),this.state.init(t,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new Myt({view:this,viewingMode:t,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.removeHandles("graphics-view"),this._createGraphicsViewController=new AbortController;const t=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(t,t),this._updatingChanged()}async _createGraphicsViewAsync(t){const e=(await ce(()=>import("./GraphicsView3D-889470f4.js"),["./GraphicsView3D-889470f4.js","./GraphicsProcessor-1d636e72.js","./Graphics3DObjectStates-df225fb7.js","./optimizedFeatureQueryEngineAdapter-fb0f5985.js","./centroid-3dcadaf5.js","./PooledRBush-46c91161.js","./quickselect-08f30851.js"],import.meta.url)).default;Yt(t),await ay(()=>this.basemapTerrain?.ready,t),this._set("graphicsView",new e({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.removeHandles("graphics-view"),this.graphicsView!=null&&(this.removeHandles(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const t=kie(this.viewingMode);if(t===Ue.Global&&(this._clippingArea=null),this._initSurface(t),this._set("ready",!0),this.addHandles(fa(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){const r=this.get("map.initialViewProperties.environment");r&&(this.environment=r)}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect();const e=this._resolveWhenReady;this._resolveWhenReady=[],e.forEach(r=>r(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.removeHandles("graphics-view"),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(y_);for(const t of this.map.allLayers.items)t.type==="integrated-mesh"&&this._defaultToMapOptions.include.add(t.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(y_);for(const t of this.map.allLayers.items)t.type==="integrated-mesh"&&t.opacity<1&&this._defaultHitTestOptions.exclude.add(t.uid)}}addVoxelLayerViewToWasm(t){return this.voxelWasm==null?(this.voxelWasmPromise==null&&(this.voxelWasmPromise=ce(()=>import("./VoxelWasmPerSceneView-74f6ab78.js"),[],import.meta.url).then(e=>(this.voxelWasm=new e.default(this),this.voxelWasm))),this.voxelWasmPromise.then(e=>e.addVoxelLayer(t))):this.voxelWasm.addVoxelLayer(t)}removeVoxelLayerViewFromWasm(t){this.voxelWasm!=null&&this.voxelWasm.removeVoxelLayer(t)<1&&(this.voxelWasm=null,this.voxelWasmPromise=null)}};function AA(t,e){t.layerUids||(t.layerUids=new Set),t.layerUids.add(e)}function J2t(t,e){t.graphicUids||(t.graphicUids=new Set),t.graphicUids.add(e)}function ML(t,e){return t!=null&&lm(t.spatialReference,e)?hx(t,e):null}var cR;Ye.type="3d",u([d()],Ye.prototype,"_userClippingArea",void 0),u([d()],Ye.prototype,"_resourceController",void 0),u([d()],Ye.prototype,"_stage",void 0),u([d({readOnly:!0})],Ye.prototype,"deconflictor",void 0),u([d({readOnly:!0})],Ye.prototype,"labeler",void 0),u([d(Uj(uE,"analyses"))],Ye.prototype,"analyses",void 0),u([d({type:pE,readOnly:!0})],Ye.prototype,"animation",null),u([d({readOnly:!0})],Ye.prototype,"basemapTerrain",void 0),u([d({readOnly:!0})],Ye.prototype,"elevationProvider",void 0),u([d()],Ye.prototype,"camera",null),u([d({type:Gh})],Ye.prototype,"contentCamera",null),u([d({readOnly:!0})],Ye.prototype,"canvas",void 0),u([d({type:Ke})],Ye.prototype,"center",null),u([d({type:ur})],Ye.prototype,"clippingArea",null),u([d({type:Rb})],Ye.prototype,"constraints",void 0),u([d({type:ur,readOnly:!0})],Ye.prototype,"renderDataExtent",null),u([d({type:ur,readOnly:!0})],Ye.prototype,"dataExtent",null),u([d({type:ur,readOnly:!0})],Ye.prototype,"_groundAndLayersExtent",null),u([d({value:null,type:fS})],Ye.prototype,"environment",null),u([wr("environment")],Ye.prototype,"castEnvironment",null),u([d({readOnly:!0})],Ye.prototype,"environmentManager",void 0),u([d({type:ur})],Ye.prototype,"extent",null),u([d()],Ye.prototype,"floors",void 0),u([d()],Ye.prototype,"screenCenter",null),u([d()],Ye.prototype,"frustum",null),u([d({type:Number,readOnly:!0})],Ye.prototype,"fullOpacity",void 0),u([d({readOnly:!0})],Ye.prototype,"graphicsView",void 0),u([d({readOnly:!0})],Ye.prototype,"analysisViewManager",void 0),u([d()],Ye.prototype,"groundView",void 0),u([d({type:Boolean})],Ye.prototype,"initialExtentRequired",null),u([d()],Ye.prototype,"_defaultsFromMapSettings",null),u([d()],Ye.prototype,"interacting",null),u([d()],Ye.prototype,"stationary",null),u([d()],Ye.prototype,"navigating",null),u([d()],Ye.prototype,"map",void 0),u([d({readOnly:!0})],Ye.prototype,"mapCoordsHelper",void 0),u([d()],Ye.prototype,"padding",null),u([d({type:xl,readOnly:!0})],Ye.prototype,"pointsOfInterest",void 0),u([d({type:ho,readOnly:!0})],Ye.prototype,"featureTiles",void 0),u([d()],Ye.prototype,"_featureTreeDebugger",void 0),u([d({type:Boolean})],Ye.prototype,"screenSizePerspectiveEnabled",void 0),u([d({constructOnly:!0})],Ye.prototype,"deactivatedWebGLExtensions",void 0),u([d({constructOnly:!0})],Ye.prototype,"debugWebGLExtensions",void 0),u([d({constructOnly:!0})],Ye.prototype,"renderCanvas",void 0),u([d({constructOnly:!0})],Ye.prototype,"state",void 0),u([d({readOnly:!0})],Ye.prototype,"inputManager",void 0),u([d({readOnly:!0})],Ye.prototype,"stateManager",void 0),u([d({type:["low","medium","high"]})],Ye.prototype,"qualityProfile",null),u([d({type:Gce,get(){let t=this._get("qualitySettings");return t||(t=new Gce,bN.apply(this.qualityProfile,t)),t}})],Ye.prototype,"qualitySettings",void 0),u([d()],Ye.prototype,"slicePlane",null),u([d({readOnly:!0})],Ye.prototype,"typeSpecificPreconditionsReady",null),u([d({readOnly:!0})],Ye.prototype,"renderCoordsHelper",void 0),u([d({readOnly:!0})],Ye.prototype,"sceneIntersectionHelper",void 0),u([d({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],Ye.prototype,"resolution",null),u([d({type:Number})],Ye.prototype,"scale",null),u([d()],Ye.prototype,"heightModelInfo",null),u([d()],Ye.prototype,"spatialReference",void 0),u([d({type:Boolean,constructOnly:!0})],Ye.prototype,"alphaCompositingEnabled",void 0),u([d({constructOnly:!0})],Ye.prototype,"preserveDrawingBufferEnabled",void 0),u([d({type:Boolean})],Ye.prototype,"supersampleScreenshotsEnabled",void 0),u([d({readOnly:!0})],Ye.prototype,"type",void 0),u([d(),wr(t=>t instanceof yPe?t:mw(_Pe,t))],Ye.prototype,"ui",void 0),u([d({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.updating","toolViewManager.updating","analysisViewManager.updating","state.updating"]})],Ye.prototype,"updating",null),u([d()],Ye.prototype,"_updatingObjects",null),u([d()],Ye.prototype,"_updatingObjectsWithProgress",null),u([d({type:Number,readOnly:!0,dependsOn:["updating"]})],Ye.prototype,"updatingProgress",void 0),u([d({type:["global","local"]})],Ye.prototype,"viewingMode",null),u([d({type:Sp})],Ye.prototype,"viewpoint",null),u([d({type:Number})],Ye.prototype,"zoom",null),u([d({type:eW})],Ye.prototype,"highlightOptions",void 0),Ye=u([P("esri.views.SceneView")],Ye),function(t){t[t.INCLUDE=0]="INCLUDE",t[t.EXCLUDE=1]="EXCLUDE"}(cR||(cR={}));const $T=O(),nV=Ji(),mpe=Vt(),Q2t=Ye;function DN(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function K2t(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function vPe(t){let e,r,i;t.length!==2?(e=DN,r=(a,l)=>DN(t(a),l),i=(a,l)=>t(a)-l):(e=t===DN||t===K2t?t:eEt,r=t,i=t);function s(a,l,c=0,h=a.length){if(c<h){if(e(l,l)!==0)return h;do{const p=c+h>>>1;r(a[p],l)<0?c=p+1:h=p}while(c<h)}return c}function n(a,l,c=0,h=a.length){if(c<h){if(e(l,l)!==0)return h;do{const p=c+h>>>1;r(a[p],l)<=0?c=p+1:h=p}while(c<h)}return c}function o(a,l,c=0,h=a.length){const p=s(a,l,c,h-1);return p>c&&i(a[p-1],l)>-i(a[p],l)?p-1:p}return{left:s,center:o,right:n}}function eEt(){return 0}function tEt(t){return t===null?NaN:+t}const rEt=vPe(DN),iEt=rEt.right;vPe(tEt).center;const sEt=iEt,nEt=Math.sqrt(50),oEt=Math.sqrt(10),aEt=Math.sqrt(2);function g5(t,e,r){const i=(e-t)/Math.max(0,r),s=Math.floor(Math.log10(i)),n=i/Math.pow(10,s),o=n>=nEt?10:n>=oEt?5:n>=aEt?2:1;let a,l,c;return s<0?(c=Math.pow(10,-s)/o,a=Math.round(t*c),l=Math.round(e*c),a/c<t&&++a,l/c>e&&--l,c=-c):(c=Math.pow(10,s)*o,a=Math.round(t/c),l=Math.round(e/c),a*c<t&&++a,l*c>e&&--l),l<a&&.5<=r&&r<2?g5(t,e,r*2):[a,l,c]}function lEt(t,e,r){if(e=+e,t=+t,r=+r,!(r>0))return[];if(t===e)return[t];const i=e<t,[s,n,o]=i?g5(e,t,r):g5(t,e,r);if(!(n>=s))return[];const a=n-s+1,l=new Array(a);if(i)if(o<0)for(let c=0;c<a;++c)l[c]=(n-c)/-o;else for(let c=0;c<a;++c)l[c]=(n-c)*o;else if(o<0)for(let c=0;c<a;++c)l[c]=(s+c)/-o;else for(let c=0;c<a;++c)l[c]=(s+c)*o;return l}function NW(t,e,r){return e=+e,t=+t,r=+r,g5(t,e,r)[2]}function cEt(t,e,r){e=+e,t=+t,r=+r;const i=e<t,s=i?NW(e,t,r):NW(t,e,r);return(i?-1:1)*(s<0?1/-s:s)}function uEt(t){return t}var oV=1,aV=2,gpe=3,uO=4,ype=1e-6;function hEt(t){return"translate("+t+",0)"}function dEt(t){return"translate(0,"+t+")"}function pEt(t){return e=>+t(e)}function fEt(t,e){return e=Math.max(0,t.bandwidth()-e*2)/2,t.round()&&(e=Math.round(e)),r=>+t(r)+e}function mEt(){return!this.__axis}function gEt(t,e){var r=[],i=null,s=null,n=6,o=6,a=3,l=typeof window<"u"&&window.devicePixelRatio>1?0:.5,c=t===oV||t===uO?-1:1,h=t===uO||t===aV?"x":"y",p=t===oV||t===gpe?hEt:dEt;function f(m){var y=i??(e.ticks?e.ticks.apply(e,r):e.domain()),_=s??(e.tickFormat?e.tickFormat.apply(e,r):uEt),v=Math.max(n,0)+a,b=e.range(),T=+b[0]+l,x=+b[b.length-1]+l,S=(e.bandwidth?fEt:pEt)(e.copy(),l),E=m.selection?m.selection():m,A=E.selectAll(".domain").data([null]),R=E.selectAll(".tick").data(y,e).order(),M=R.exit(),D=R.enter().append("g").attr("class","tick"),k=R.select("line"),$=R.select("text");A=A.merge(A.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),R=R.merge(D),k=k.merge(D.append("line").attr("stroke","currentColor").attr(h+"2",c*n)),$=$.merge(D.append("text").attr("fill","currentColor").attr(h,c*v).attr("dy",t===oV?"0em":t===gpe?"0.71em":"0.32em")),m!==E&&(A=A.transition(m),R=R.transition(m),k=k.transition(m),$=$.transition(m),M=M.transition(m).attr("opacity",ype).attr("transform",function(N){return isFinite(N=S(N))?p(N+l):this.getAttribute("transform")}),D.attr("opacity",ype).attr("transform",function(N){var H=this.parentNode.__axis;return p((H&&isFinite(H=H(N))?H:S(N))+l)})),M.remove(),A.attr("d",t===uO||t===aV?o?"M"+c*o+","+T+"H"+l+"V"+x+"H"+c*o:"M"+l+","+T+"V"+x:o?"M"+T+","+c*o+"V"+l+"H"+x+"V"+c*o:"M"+T+","+l+"H"+x),R.attr("opacity",1).attr("transform",function(N){return p(S(N)+l)}),k.attr(h+"2",c*n),$.attr(h,c*v).text(_),E.filter(mEt).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",t===aV?"start":t===uO?"end":"middle"),E.each(function(){this.__axis=S})}return f.scale=function(m){return arguments.length?(e=m,f):e},f.ticks=function(){return r=Array.from(arguments),f},f.tickArguments=function(m){return arguments.length?(r=m==null?[]:Array.from(m),f):r.slice()},f.tickValues=function(m){return arguments.length?(i=m==null?null:Array.from(m),f):i&&i.slice()},f.tickFormat=function(m){return arguments.length?(s=m,f):s},f.tickSize=function(m){return arguments.length?(n=o=+m,f):n},f.tickSizeInner=function(m){return arguments.length?(n=+m,f):n},f.tickSizeOuter=function(m){return arguments.length?(o=+m,f):o},f.tickPadding=function(m){return arguments.length?(a=+m,f):a},f.offset=function(m){return arguments.length?(l=+m,f):l},f}function yEt(t){return gEt(uO,t)}var _Et={value:()=>{}};function VK(){for(var t=0,e=arguments.length,r={},i;t<e;++t){if(!(i=arguments[t]+"")||i in r||/[\s.]/.test(i))throw new Error("illegal type: "+i);r[i]=[]}return new NN(r)}function NN(t){this._=t}function vEt(t,e){return t.trim().split(/^|\s+/).map(function(r){var i="",s=r.indexOf(".");if(s>=0&&(i=r.slice(s+1),r=r.slice(0,s)),r&&!e.hasOwnProperty(r))throw new Error("unknown type: "+r);return{type:r,name:i}})}NN.prototype=VK.prototype={constructor:NN,on:function(t,e){var r=this._,i=vEt(t+"",r),s,n=-1,o=i.length;if(arguments.length<2){for(;++n<o;)if((s=(t=i[n]).type)&&(s=bEt(r[s],t.name)))return s;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++n<o;)if(s=(t=i[n]).type)r[s]=_pe(r[s],t.name,e);else if(e==null)for(s in r)r[s]=_pe(r[s],t.name,null);return this},copy:function(){var t={},e=this._;for(var r in e)t[r]=e[r].slice();return new NN(t)},call:function(t,e){if((s=arguments.length-2)>0)for(var r=new Array(s),i=0,s,n;i<s;++i)r[i]=arguments[i+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(n=this._[t],i=0,s=n.length;i<s;++i)n[i].value.apply(e,r)},apply:function(t,e,r){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],s=0,n=i.length;s<n;++s)i[s].value.apply(e,r)}};function bEt(t,e){for(var r=0,i=t.length,s;r<i;++r)if((s=t[r]).name===e)return s.value}function _pe(t,e,r){for(var i=0,s=t.length;i<s;++i)if(t[i].name===e){t[i]=_Et,t=t.slice(0,i).concat(t.slice(i+1));break}return r!=null&&t.push({name:e,value:r}),t}var FW="http://www.w3.org/1999/xhtml";const vpe={svg:"http://www.w3.org/2000/svg",xhtml:FW,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function a8(t){var e=t+="",r=e.indexOf(":");return r>=0&&(e=t.slice(0,r))!=="xmlns"&&(t=t.slice(r+1)),vpe.hasOwnProperty(e)?{space:vpe[e],local:t}:t}function wEt(t){return function(){var e=this.ownerDocument,r=this.namespaceURI;return r===FW&&e.documentElement.namespaceURI===FW?e.createElement(t):e.createElementNS(r,t)}}function xEt(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function bPe(t){var e=a8(t);return(e.local?xEt:wEt)(e)}function TEt(){}function BK(t){return t==null?TEt:function(){return this.querySelector(t)}}function SEt(t){typeof t!="function"&&(t=BK(t));for(var e=this._groups,r=e.length,i=new Array(r),s=0;s<r;++s)for(var n=e[s],o=n.length,a=i[s]=new Array(o),l,c,h=0;h<o;++h)(l=n[h])&&(c=t.call(l,l.__data__,h,n))&&("__data__"in l&&(c.__data__=l.__data__),a[h]=c);return new Pu(i,this._parents)}function EEt(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function CEt(){return[]}function wPe(t){return t==null?CEt:function(){return this.querySelectorAll(t)}}function AEt(t){return function(){return EEt(t.apply(this,arguments))}}function OEt(t){typeof t=="function"?t=AEt(t):t=wPe(t);for(var e=this._groups,r=e.length,i=[],s=[],n=0;n<r;++n)for(var o=e[n],a=o.length,l,c=0;c<a;++c)(l=o[c])&&(i.push(t.call(l,l.__data__,c,o)),s.push(l));return new Pu(i,s)}function xPe(t){return function(){return this.matches(t)}}function TPe(t){return function(e){return e.matches(t)}}var REt=Array.prototype.find;function MEt(t){return function(){return REt.call(this.children,t)}}function PEt(){return this.firstElementChild}function IEt(t){return this.select(t==null?PEt:MEt(typeof t=="function"?t:TPe(t)))}var $Et=Array.prototype.filter;function LEt(){return Array.from(this.children)}function DEt(t){return function(){return $Et.call(this.children,t)}}function NEt(t){return this.selectAll(t==null?LEt:DEt(typeof t=="function"?t:TPe(t)))}function FEt(t){typeof t!="function"&&(t=xPe(t));for(var e=this._groups,r=e.length,i=new Array(r),s=0;s<r;++s)for(var n=e[s],o=n.length,a=i[s]=[],l,c=0;c<o;++c)(l=n[c])&&t.call(l,l.__data__,c,n)&&a.push(l);return new Pu(i,this._parents)}function SPe(t){return new Array(t.length)}function UEt(){return new Pu(this._enter||this._groups.map(SPe),this._parents)}function y5(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}y5.prototype={constructor:y5,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function kEt(t){return function(){return t}}function zEt(t,e,r,i,s,n){for(var o=0,a,l=e.length,c=n.length;o<c;++o)(a=e[o])?(a.__data__=n[o],i[o]=a):r[o]=new y5(t,n[o]);for(;o<l;++o)(a=e[o])&&(s[o]=a)}function VEt(t,e,r,i,s,n,o){var a,l,c=new Map,h=e.length,p=n.length,f=new Array(h),m;for(a=0;a<h;++a)(l=e[a])&&(f[a]=m=o.call(l,l.__data__,a,e)+"",c.has(m)?s[a]=l:c.set(m,l));for(a=0;a<p;++a)m=o.call(t,n[a],a,n)+"",(l=c.get(m))?(i[a]=l,l.__data__=n[a],c.delete(m)):r[a]=new y5(t,n[a]);for(a=0;a<h;++a)(l=e[a])&&c.get(f[a])===l&&(s[a]=l)}function BEt(t){return t.__data__}function GEt(t,e){if(!arguments.length)return Array.from(this,BEt);var r=e?VEt:zEt,i=this._parents,s=this._groups;typeof t!="function"&&(t=kEt(t));for(var n=s.length,o=new Array(n),a=new Array(n),l=new Array(n),c=0;c<n;++c){var h=i[c],p=s[c],f=p.length,m=jEt(t.call(h,h&&h.__data__,c,i)),y=m.length,_=a[c]=new Array(y),v=o[c]=new Array(y),b=l[c]=new Array(f);r(h,p,_,v,b,m,e);for(var T=0,x=0,S,E;T<y;++T)if(S=_[T]){for(T>=x&&(x=T+1);!(E=v[x])&&++x<y;);S._next=E||null}}return o=new Pu(o,i),o._enter=a,o._exit=l,o}function jEt(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function HEt(){return new Pu(this._exit||this._groups.map(SPe),this._parents)}function qEt(t,e,r){var i=this.enter(),s=this,n=this.exit();return typeof t=="function"?(i=t(i),i&&(i=i.selection())):i=i.append(t+""),e!=null&&(s=e(s),s&&(s=s.selection())),r==null?n.remove():r(n),i&&s?i.merge(s).order():s}function WEt(t){for(var e=t.selection?t.selection():t,r=this._groups,i=e._groups,s=r.length,n=i.length,o=Math.min(s,n),a=new Array(s),l=0;l<o;++l)for(var c=r[l],h=i[l],p=c.length,f=a[l]=new Array(p),m,y=0;y<p;++y)(m=c[y]||h[y])&&(f[y]=m);for(;l<s;++l)a[l]=r[l];return new Pu(a,this._parents)}function XEt(){for(var t=this._groups,e=-1,r=t.length;++e<r;)for(var i=t[e],s=i.length-1,n=i[s],o;--s>=0;)(o=i[s])&&(n&&o.compareDocumentPosition(n)^4&&n.parentNode.insertBefore(o,n),n=o);return this}function ZEt(t){t||(t=YEt);function e(p,f){return p&&f?t(p.__data__,f.__data__):!p-!f}for(var r=this._groups,i=r.length,s=new Array(i),n=0;n<i;++n){for(var o=r[n],a=o.length,l=s[n]=new Array(a),c,h=0;h<a;++h)(c=o[h])&&(l[h]=c);l.sort(e)}return new Pu(s,this._parents).order()}function YEt(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function JEt(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function QEt(){return Array.from(this)}function KEt(){for(var t=this._groups,e=0,r=t.length;e<r;++e)for(var i=t[e],s=0,n=i.length;s<n;++s){var o=i[s];if(o)return o}return null}function eCt(){let t=0;for(const e of this)++t;return t}function tCt(){return!this.node()}function rCt(t){for(var e=this._groups,r=0,i=e.length;r<i;++r)for(var s=e[r],n=0,o=s.length,a;n<o;++n)(a=s[n])&&t.call(a,a.__data__,n,s);return this}function iCt(t){return function(){this.removeAttribute(t)}}function sCt(t){return function(){this.removeAttributeNS(t.space,t.local)}}function nCt(t,e){return function(){this.setAttribute(t,e)}}function oCt(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function aCt(t,e){return function(){var r=e.apply(this,arguments);r==null?this.removeAttribute(t):this.setAttribute(t,r)}}function lCt(t,e){return function(){var r=e.apply(this,arguments);r==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,r)}}function cCt(t,e){var r=a8(t);if(arguments.length<2){var i=this.node();return r.local?i.getAttributeNS(r.space,r.local):i.getAttribute(r)}return this.each((e==null?r.local?sCt:iCt:typeof e=="function"?r.local?lCt:aCt:r.local?oCt:nCt)(r,e))}function EPe(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function uCt(t){return function(){this.style.removeProperty(t)}}function hCt(t,e,r){return function(){this.style.setProperty(t,e,r)}}function dCt(t,e,r){return function(){var i=e.apply(this,arguments);i==null?this.style.removeProperty(t):this.style.setProperty(t,i,r)}}function pCt(t,e,r){return arguments.length>1?this.each((e==null?uCt:typeof e=="function"?dCt:hCt)(t,e,r??"")):LE(this.node(),t)}function LE(t,e){return t.style.getPropertyValue(e)||EPe(t).getComputedStyle(t,null).getPropertyValue(e)}function fCt(t){return function(){delete this[t]}}function mCt(t,e){return function(){this[t]=e}}function gCt(t,e){return function(){var r=e.apply(this,arguments);r==null?delete this[t]:this[t]=r}}function yCt(t,e){return arguments.length>1?this.each((e==null?fCt:typeof e=="function"?gCt:mCt)(t,e)):this.node()[t]}function CPe(t){return t.trim().split(/^|\s+/)}function GK(t){return t.classList||new APe(t)}function APe(t){this._node=t,this._names=CPe(t.getAttribute("class")||"")}APe.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function OPe(t,e){for(var r=GK(t),i=-1,s=e.length;++i<s;)r.add(e[i])}function RPe(t,e){for(var r=GK(t),i=-1,s=e.length;++i<s;)r.remove(e[i])}function _Ct(t){return function(){OPe(this,t)}}function vCt(t){return function(){RPe(this,t)}}function bCt(t,e){return function(){(e.apply(this,arguments)?OPe:RPe)(this,t)}}function wCt(t,e){var r=CPe(t+"");if(arguments.length<2){for(var i=GK(this.node()),s=-1,n=r.length;++s<n;)if(!i.contains(r[s]))return!1;return!0}return this.each((typeof e=="function"?bCt:e?_Ct:vCt)(r,e))}function xCt(){this.textContent=""}function TCt(t){return function(){this.textContent=t}}function SCt(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function ECt(t){return arguments.length?this.each(t==null?xCt:(typeof t=="function"?SCt:TCt)(t)):this.node().textContent}function CCt(){this.innerHTML=""}function ACt(t){return function(){this.innerHTML=t}}function OCt(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function RCt(t){return arguments.length?this.each(t==null?CCt:(typeof t=="function"?OCt:ACt)(t)):this.node().innerHTML}function MCt(){this.nextSibling&&this.parentNode.appendChild(this)}function PCt(){return this.each(MCt)}function ICt(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function $Ct(){return this.each(ICt)}function LCt(t){var e=typeof t=="function"?t:bPe(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function DCt(){return null}function NCt(t,e){var r=typeof t=="function"?t:bPe(t),i=e==null?DCt:typeof e=="function"?e:BK(e);return this.select(function(){return this.insertBefore(r.apply(this,arguments),i.apply(this,arguments)||null)})}function FCt(){var t=this.parentNode;t&&t.removeChild(this)}function UCt(){return this.each(FCt)}function kCt(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function zCt(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function VCt(t){return this.select(t?zCt:kCt)}function BCt(t){return arguments.length?this.property("__data__",t):this.node().__data__}function GCt(t){return function(e){t.call(this,e,this.__data__)}}function jCt(t){return t.trim().split(/^|\s+/).map(function(e){var r="",i=e.indexOf(".");return i>=0&&(r=e.slice(i+1),e=e.slice(0,i)),{type:e,name:r}})}function HCt(t){return function(){var e=this.__on;if(e){for(var r=0,i=-1,s=e.length,n;r<s;++r)n=e[r],(!t.type||n.type===t.type)&&n.name===t.name?this.removeEventListener(n.type,n.listener,n.options):e[++i]=n;++i?e.length=i:delete this.__on}}}function qCt(t,e,r){return function(){var i=this.__on,s,n=GCt(e);if(i){for(var o=0,a=i.length;o<a;++o)if((s=i[o]).type===t.type&&s.name===t.name){this.removeEventListener(s.type,s.listener,s.options),this.addEventListener(s.type,s.listener=n,s.options=r),s.value=e;return}}this.addEventListener(t.type,n,r),s={type:t.type,name:t.name,value:e,listener:n,options:r},i?i.push(s):this.__on=[s]}}function WCt(t,e,r){var i=jCt(t+""),s,n=i.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,c=a.length,h;l<c;++l)for(s=0,h=a[l];s<n;++s)if((o=i[s]).type===h.type&&o.name===h.name)return h.value}return}for(a=e?qCt:HCt,s=0;s<n;++s)this.each(a(i[s],e,r));return this}function MPe(t,e,r){var i=EPe(t),s=i.CustomEvent;typeof s=="function"?s=new s(e,r):(s=i.document.createEvent("Event"),r?(s.initEvent(e,r.bubbles,r.cancelable),s.detail=r.detail):s.initEvent(e,!1,!1)),t.dispatchEvent(s)}function XCt(t,e){return function(){return MPe(this,t,e)}}function ZCt(t,e){return function(){return MPe(this,t,e.apply(this,arguments))}}function YCt(t,e){return this.each((typeof e=="function"?ZCt:XCt)(t,e))}function*JCt(){for(var t=this._groups,e=0,r=t.length;e<r;++e)for(var i=t[e],s=0,n=i.length,o;s<n;++s)(o=i[s])&&(yield o)}var PPe=[null];function Pu(t,e){this._groups=t,this._parents=e}function bP(){return new Pu([[document.documentElement]],PPe)}function QCt(){return this}Pu.prototype=bP.prototype={constructor:Pu,select:SEt,selectAll:OEt,selectChild:IEt,selectChildren:NEt,filter:FEt,data:GEt,enter:UEt,exit:HEt,join:qEt,merge:WEt,selection:QCt,order:XEt,sort:ZEt,call:JEt,nodes:QEt,node:KEt,size:eCt,empty:tCt,each:rCt,attr:cCt,style:pCt,property:yCt,classed:wCt,text:ECt,html:RCt,raise:PCt,lower:$Ct,append:LCt,insert:NCt,remove:UCt,clone:VCt,datum:BCt,on:WCt,dispatch:YCt,[Symbol.iterator]:JCt};function Ng(t){return typeof t=="string"?new Pu([[document.querySelector(t)]],[document.documentElement]):new Pu([[t]],PPe)}function KCt(t){let e;for(;e=t.sourceEvent;)t=e;return t}function bpe(t,e){if(t=KCt(t),e===void 0&&(e=t.currentTarget),e){var r=e.ownerSVGElement||e;if(r.createSVGPoint){var i=r.createSVGPoint();return i.x=t.clientX,i.y=t.clientY,i=i.matrixTransform(e.getScreenCTM().inverse()),[i.x,i.y]}if(e.getBoundingClientRect){var s=e.getBoundingClientRect();return[t.clientX-s.left-e.clientLeft,t.clientY-s.top-e.clientTop]}}return[t.pageX,t.pageY]}const UW={capture:!0,passive:!1};function kW(t){t.preventDefault(),t.stopImmediatePropagation()}function eAt(t){var e=t.document.documentElement,r=Ng(t).on("dragstart.drag",kW,UW);"onselectstart"in e?r.on("selectstart.drag",kW,UW):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function tAt(t,e){var r=t.document.documentElement,i=Ng(t).on("dragstart.drag",null);e&&(i.on("click.drag",kW,UW),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in r?i.on("selectstart.drag",null):(r.style.MozUserSelect=r.__noselect,delete r.__noselect)}function jK(t,e,r){t.prototype=e.prototype=r,r.constructor=t}function IPe(t,e){var r=Object.create(t.prototype);for(var i in e)r[i]=e[i];return r}function wP(){}var mM=.7,_5=1/mM,L2="\\s*([+-]?\\d+)\\s*",gM="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",im="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",rAt=/^#([0-9a-f]{3,8})$/,iAt=new RegExp(`^rgb\\(${L2},${L2},${L2}\\)$`),sAt=new RegExp(`^rgb\\(${im},${im},${im}\\)$`),nAt=new RegExp(`^rgba\\(${L2},${L2},${L2},${gM}\\)$`),oAt=new RegExp(`^rgba\\(${im},${im},${im},${gM}\\)$`),aAt=new RegExp(`^hsl\\(${gM},${im},${im}\\)$`),lAt=new RegExp(`^hsla\\(${gM},${im},${im},${gM}\\)$`),wpe={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};jK(wP,Qw,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:xpe,formatHex:xpe,formatHex8:cAt,formatHsl:uAt,formatRgb:Tpe,toString:Tpe});function xpe(){return this.rgb().formatHex()}function cAt(){return this.rgb().formatHex8()}function uAt(){return $Pe(this).formatHsl()}function Tpe(){return this.rgb().formatRgb()}function Qw(t){var e,r;return t=(t+"").trim().toLowerCase(),(e=rAt.exec(t))?(r=e[1].length,e=parseInt(e[1],16),r===6?Spe(e):r===3?new Ec(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):r===8?PL(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):r===4?PL(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=iAt.exec(t))?new Ec(e[1],e[2],e[3],1):(e=sAt.exec(t))?new Ec(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=nAt.exec(t))?PL(e[1],e[2],e[3],e[4]):(e=oAt.exec(t))?PL(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=aAt.exec(t))?Ape(e[1],e[2]/100,e[3]/100,1):(e=lAt.exec(t))?Ape(e[1],e[2]/100,e[3]/100,e[4]):wpe.hasOwnProperty(t)?Spe(wpe[t]):t==="transparent"?new Ec(NaN,NaN,NaN,0):null}function Spe(t){return new Ec(t>>16&255,t>>8&255,t&255,1)}function PL(t,e,r,i){return i<=0&&(t=e=r=NaN),new Ec(t,e,r,i)}function hAt(t){return t instanceof wP||(t=Qw(t)),t?(t=t.rgb(),new Ec(t.r,t.g,t.b,t.opacity)):new Ec}function zW(t,e,r,i){return arguments.length===1?hAt(t):new Ec(t,e,r,i??1)}function Ec(t,e,r,i){this.r=+t,this.g=+e,this.b=+r,this.opacity=+i}jK(Ec,zW,IPe(wP,{brighter(t){return t=t==null?_5:Math.pow(_5,t),new Ec(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?mM:Math.pow(mM,t),new Ec(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Ec(pw(this.r),pw(this.g),pw(this.b),v5(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Epe,formatHex:Epe,formatHex8:dAt,formatRgb:Cpe,toString:Cpe}));function Epe(){return`#${Wb(this.r)}${Wb(this.g)}${Wb(this.b)}`}function dAt(){return`#${Wb(this.r)}${Wb(this.g)}${Wb(this.b)}${Wb((isNaN(this.opacity)?1:this.opacity)*255)}`}function Cpe(){const t=v5(this.opacity);return`${t===1?"rgb(":"rgba("}${pw(this.r)}, ${pw(this.g)}, ${pw(this.b)}${t===1?")":`, ${t})`}`}function v5(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function pw(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Wb(t){return t=pw(t),(t<16?"0":"")+t.toString(16)}function Ape(t,e,r,i){return i<=0?t=e=r=NaN:r<=0||r>=1?t=e=NaN:e<=0&&(t=NaN),new ep(t,e,r,i)}function $Pe(t){if(t instanceof ep)return new ep(t.h,t.s,t.l,t.opacity);if(t instanceof wP||(t=Qw(t)),!t)return new ep;if(t instanceof ep)return t;t=t.rgb();var e=t.r/255,r=t.g/255,i=t.b/255,s=Math.min(e,r,i),n=Math.max(e,r,i),o=NaN,a=n-s,l=(n+s)/2;return a?(e===n?o=(r-i)/a+(r<i)*6:r===n?o=(i-e)/a+2:o=(e-r)/a+4,a/=l<.5?n+s:2-n-s,o*=60):a=l>0&&l<1?0:o,new ep(o,a,l,t.opacity)}function pAt(t,e,r,i){return arguments.length===1?$Pe(t):new ep(t,e,r,i??1)}function ep(t,e,r,i){this.h=+t,this.s=+e,this.l=+r,this.opacity=+i}jK(ep,pAt,IPe(wP,{brighter(t){return t=t==null?_5:Math.pow(_5,t),new ep(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?mM:Math.pow(mM,t),new ep(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,r=this.l,i=r+(r<.5?r:1-r)*e,s=2*r-i;return new Ec(lV(t>=240?t-240:t+120,s,i),lV(t,s,i),lV(t<120?t+240:t-120,s,i),this.opacity)},clamp(){return new ep(Ope(this.h),IL(this.s),IL(this.l),v5(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=v5(this.opacity);return`${t===1?"hsl(":"hsla("}${Ope(this.h)}, ${IL(this.s)*100}%, ${IL(this.l)*100}%${t===1?")":`, ${t})`}`}}));function Ope(t){return t=(t||0)%360,t<0?t+360:t}function IL(t){return Math.max(0,Math.min(1,t||0))}function lV(t,e,r){return(t<60?e+(r-e)*t/60:t<180?r:t<240?e+(r-e)*(240-t)/60:e)*255}const HK=t=>()=>t;function fAt(t,e){return function(r){return t+r*e}}function mAt(t,e,r){return t=Math.pow(t,r),e=Math.pow(e,r)-t,r=1/r,function(i){return Math.pow(t+i*e,r)}}function gAt(t){return(t=+t)==1?LPe:function(e,r){return r-e?mAt(e,r,t):HK(isNaN(e)?r:e)}}function LPe(t,e){var r=e-t;return r?fAt(t,r):HK(isNaN(t)?e:t)}const b5=function t(e){var r=gAt(e);function i(s,n){var o=r((s=zW(s)).r,(n=zW(n)).r),a=r(s.g,n.g),l=r(s.b,n.b),c=LPe(s.opacity,n.opacity);return function(h){return s.r=o(h),s.g=a(h),s.b=l(h),s.opacity=c(h),s+""}}return i.gamma=t,i}(1);function yAt(t,e){e||(e=[]);var r=t?Math.min(e.length,t.length):0,i=e.slice(),s;return function(n){for(s=0;s<r;++s)i[s]=t[s]*(1-n)+e[s]*n;return i}}function _At(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function vAt(t,e){var r=e?e.length:0,i=t?Math.min(r,t.length):0,s=new Array(i),n=new Array(r),o;for(o=0;o<i;++o)s[o]=l8(t[o],e[o]);for(;o<r;++o)n[o]=e[o];return function(a){for(o=0;o<i;++o)n[o]=s[o](a);return n}}function bAt(t,e){var r=new Date;return t=+t,e=+e,function(i){return r.setTime(t*(1-i)+e*i),r}}function Kd(t,e){return t=+t,e=+e,function(r){return t*(1-r)+e*r}}function wAt(t,e){var r={},i={},s;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(s in e)s in t?r[s]=l8(t[s],e[s]):i[s]=e[s];return function(n){for(s in r)i[s]=r[s](n);return i}}var VW=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,cV=new RegExp(VW.source,"g");function xAt(t){return function(){return t}}function TAt(t){return function(e){return t(e)+""}}function DPe(t,e){var r=VW.lastIndex=cV.lastIndex=0,i,s,n,o=-1,a=[],l=[];for(t=t+"",e=e+"";(i=VW.exec(t))&&(s=cV.exec(e));)(n=s.index)>r&&(n=e.slice(r,n),a[o]?a[o]+=n:a[++o]=n),(i=i[0])===(s=s[0])?a[o]?a[o]+=s:a[++o]=s:(a[++o]=null,l.push({i:o,x:Kd(i,s)})),r=cV.lastIndex;return r<e.length&&(n=e.slice(r),a[o]?a[o]+=n:a[++o]=n),a.length<2?l[0]?TAt(l[0].x):xAt(e):(e=l.length,function(c){for(var h=0,p;h<e;++h)a[(p=l[h]).i]=p.x(c);return a.join("")})}function l8(t,e){var r=typeof e,i;return e==null||r==="boolean"?HK(e):(r==="number"?Kd:r==="string"?(i=Qw(e))?(e=i,b5):DPe:e instanceof Qw?b5:e instanceof Date?bAt:_At(e)?yAt:Array.isArray(e)?vAt:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?wAt:Kd)(t,e)}function SAt(t,e){return t=+t,e=+e,function(r){return Math.round(t*(1-r)+e*r)}}var Rpe=180/Math.PI,BW={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function NPe(t,e,r,i,s,n){var o,a,l;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(l=t*r+e*i)&&(r-=t*l,i-=e*l),(a=Math.sqrt(r*r+i*i))&&(r/=a,i/=a,l/=a),t*i<e*r&&(t=-t,e=-e,l=-l,o=-o),{translateX:s,translateY:n,rotate:Math.atan2(e,t)*Rpe,skewX:Math.atan(l)*Rpe,scaleX:o,scaleY:a}}var $L;function EAt(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?BW:NPe(e.a,e.b,e.c,e.d,e.e,e.f)}function CAt(t){return t==null||($L||($L=document.createElementNS("http://www.w3.org/2000/svg","g")),$L.setAttribute("transform",t),!(t=$L.transform.baseVal.consolidate()))?BW:(t=t.matrix,NPe(t.a,t.b,t.c,t.d,t.e,t.f))}function FPe(t,e,r,i){function s(c){return c.length?c.pop()+" ":""}function n(c,h,p,f,m,y){if(c!==p||h!==f){var _=m.push("translate(",null,e,null,r);y.push({i:_-4,x:Kd(c,p)},{i:_-2,x:Kd(h,f)})}else(p||f)&&m.push("translate("+p+e+f+r)}function o(c,h,p,f){c!==h?(c-h>180?h+=360:h-c>180&&(c+=360),f.push({i:p.push(s(p)+"rotate(",null,i)-2,x:Kd(c,h)})):h&&p.push(s(p)+"rotate("+h+i)}function a(c,h,p,f){c!==h?f.push({i:p.push(s(p)+"skewX(",null,i)-2,x:Kd(c,h)}):h&&p.push(s(p)+"skewX("+h+i)}function l(c,h,p,f,m,y){if(c!==p||h!==f){var _=m.push(s(m)+"scale(",null,",",null,")");y.push({i:_-4,x:Kd(c,p)},{i:_-2,x:Kd(h,f)})}else(p!==1||f!==1)&&m.push(s(m)+"scale("+p+","+f+")")}return function(c,h){var p=[],f=[];return c=t(c),h=t(h),n(c.translateX,c.translateY,h.translateX,h.translateY,p,f),o(c.rotate,h.rotate,p,f),a(c.skewX,h.skewX,p,f),l(c.scaleX,c.scaleY,h.scaleX,h.scaleY,p,f),c=h=null,function(m){for(var y=-1,_=f.length,v;++y<_;)p[(v=f[y]).i]=v.x(m);return p.join("")}}}var AAt=FPe(EAt,"px, ","px)","deg)"),OAt=FPe(CAt,", ",")",")"),DE=0,hO=0,OA=0,UPe=1e3,w5,dO,x5=0,Kw=0,c8=0,yM=typeof performance=="object"&&performance.now?performance:Date,kPe=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function qK(){return Kw||(kPe(RAt),Kw=yM.now()+c8)}function RAt(){Kw=0}function T5(){this._call=this._time=this._next=null}T5.prototype=zPe.prototype={constructor:T5,restart:function(t,e,r){if(typeof t!="function")throw new TypeError("callback is not a function");r=(r==null?qK():+r)+(e==null?0:+e),!this._next&&dO!==this&&(dO?dO._next=this:w5=this,dO=this),this._call=t,this._time=r,GW()},stop:function(){this._call&&(this._call=null,this._time=1/0,GW())}};function zPe(t,e,r){var i=new T5;return i.restart(t,e,r),i}function MAt(){qK(),++DE;for(var t=w5,e;t;)(e=Kw-t._time)>=0&&t._call.call(void 0,e),t=t._next;--DE}function Mpe(){Kw=(x5=yM.now())+c8,DE=hO=0;try{MAt()}finally{DE=0,IAt(),Kw=0}}function PAt(){var t=yM.now(),e=t-x5;e>UPe&&(c8-=e,x5=t)}function IAt(){for(var t,e=w5,r,i=1/0;e;)e._call?(i>e._time&&(i=e._time),t=e,e=e._next):(r=e._next,e._next=null,e=t?t._next=r:w5=r);dO=t,GW(i)}function GW(t){if(!DE){hO&&(hO=clearTimeout(hO));var e=t-Kw;e>24?(t<1/0&&(hO=setTimeout(Mpe,t-yM.now()-c8)),OA&&(OA=clearInterval(OA))):(OA||(x5=yM.now(),OA=setInterval(PAt,UPe)),DE=1,kPe(Mpe))}}function Ppe(t,e,r){var i=new T5;return e=e==null?0:+e,i.restart(s=>{i.stop(),t(s+e)},e,r),i}var $At=VK("start","end","cancel","interrupt"),LAt=[],VPe=0,Ipe=1,jW=2,FN=3,$pe=4,HW=5,UN=6;function u8(t,e,r,i,s,n){var o=t.__transition;if(!o)t.__transition={};else if(r in o)return;DAt(t,r,{name:e,index:i,group:s,on:$At,tween:LAt,time:n.time,delay:n.delay,duration:n.duration,ease:n.ease,timer:null,state:VPe})}function WK(t,e){var r=$p(t,e);if(r.state>VPe)throw new Error("too late; already scheduled");return r}function Om(t,e){var r=$p(t,e);if(r.state>FN)throw new Error("too late; already running");return r}function $p(t,e){var r=t.__transition;if(!r||!(r=r[e]))throw new Error("transition not found");return r}function DAt(t,e,r){var i=t.__transition,s;i[e]=r,r.timer=zPe(n,0,r.time);function n(c){r.state=Ipe,r.timer.restart(o,r.delay,r.time),r.delay<=c&&o(c-r.delay)}function o(c){var h,p,f,m;if(r.state!==Ipe)return l();for(h in i)if(m=i[h],m.name===r.name){if(m.state===FN)return Ppe(o);m.state===$pe?(m.state=UN,m.timer.stop(),m.on.call("interrupt",t,t.__data__,m.index,m.group),delete i[h]):+h<e&&(m.state=UN,m.timer.stop(),m.on.call("cancel",t,t.__data__,m.index,m.group),delete i[h])}if(Ppe(function(){r.state===FN&&(r.state=$pe,r.timer.restart(a,r.delay,r.time),a(c))}),r.state=jW,r.on.call("start",t,t.__data__,r.index,r.group),r.state===jW){for(r.state=FN,s=new Array(f=r.tween.length),h=0,p=-1;h<f;++h)(m=r.tween[h].value.call(t,t.__data__,r.index,r.group))&&(s[++p]=m);s.length=p+1}}function a(c){for(var h=c<r.duration?r.ease.call(null,c/r.duration):(r.timer.restart(l),r.state=HW,1),p=-1,f=s.length;++p<f;)s[p].call(t,h);r.state===HW&&(r.on.call("end",t,t.__data__,r.index,r.group),l())}function l(){r.state=UN,r.timer.stop(),delete i[e];for(var c in i)return;delete t.__transition}}function qW(t,e){var r=t.__transition,i,s,n=!0,o;if(r){e=e==null?null:e+"";for(o in r){if((i=r[o]).name!==e){n=!1;continue}s=i.state>jW&&i.state<HW,i.state=UN,i.timer.stop(),i.on.call(s?"interrupt":"cancel",t,t.__data__,i.index,i.group),delete r[o]}n&&delete t.__transition}}function NAt(t){return this.each(function(){qW(this,t)})}function FAt(t,e){var r,i;return function(){var s=Om(this,t),n=s.tween;if(n!==r){i=r=n;for(var o=0,a=i.length;o<a;++o)if(i[o].name===e){i=i.slice(),i.splice(o,1);break}}s.tween=i}}function UAt(t,e,r){var i,s;if(typeof r!="function")throw new Error;return function(){var n=Om(this,t),o=n.tween;if(o!==i){s=(i=o).slice();for(var a={name:e,value:r},l=0,c=s.length;l<c;++l)if(s[l].name===e){s[l]=a;break}l===c&&s.push(a)}n.tween=s}}function kAt(t,e){var r=this._id;if(t+="",arguments.length<2){for(var i=$p(this.node(),r).tween,s=0,n=i.length,o;s<n;++s)if((o=i[s]).name===t)return o.value;return null}return this.each((e==null?FAt:UAt)(r,t,e))}function XK(t,e,r){var i=t._id;return t.each(function(){var s=Om(this,i);(s.value||(s.value={}))[e]=r.apply(this,arguments)}),function(s){return $p(s,i).value[e]}}function BPe(t,e){var r;return(typeof e=="number"?Kd:e instanceof Qw?b5:(r=Qw(e))?(e=r,b5):DPe)(t,e)}function zAt(t){return function(){this.removeAttribute(t)}}function VAt(t){return function(){this.removeAttributeNS(t.space,t.local)}}function BAt(t,e,r){var i,s=r+"",n;return function(){var o=this.getAttribute(t);return o===s?null:o===i?n:n=e(i=o,r)}}function GAt(t,e,r){var i,s=r+"",n;return function(){var o=this.getAttributeNS(t.space,t.local);return o===s?null:o===i?n:n=e(i=o,r)}}function jAt(t,e,r){var i,s,n;return function(){var o,a=r(this),l;return a==null?void this.removeAttribute(t):(o=this.getAttribute(t),l=a+"",o===l?null:o===i&&l===s?n:(s=l,n=e(i=o,a)))}}function HAt(t,e,r){var i,s,n;return function(){var o,a=r(this),l;return a==null?void this.removeAttributeNS(t.space,t.local):(o=this.getAttributeNS(t.space,t.local),l=a+"",o===l?null:o===i&&l===s?n:(s=l,n=e(i=o,a)))}}function qAt(t,e){var r=a8(t),i=r==="transform"?OAt:BPe;return this.attrTween(t,typeof e=="function"?(r.local?HAt:jAt)(r,i,XK(this,"attr."+t,e)):e==null?(r.local?VAt:zAt)(r):(r.local?GAt:BAt)(r,i,e))}function WAt(t,e){return function(r){this.setAttribute(t,e.call(this,r))}}function XAt(t,e){return function(r){this.setAttributeNS(t.space,t.local,e.call(this,r))}}function ZAt(t,e){var r,i;function s(){var n=e.apply(this,arguments);return n!==i&&(r=(i=n)&&XAt(t,n)),r}return s._value=e,s}function YAt(t,e){var r,i;function s(){var n=e.apply(this,arguments);return n!==i&&(r=(i=n)&&WAt(t,n)),r}return s._value=e,s}function JAt(t,e){var r="attr."+t;if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;var i=a8(t);return this.tween(r,(i.local?ZAt:YAt)(i,e))}function QAt(t,e){return function(){WK(this,t).delay=+e.apply(this,arguments)}}function KAt(t,e){return e=+e,function(){WK(this,t).delay=e}}function e3t(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?QAt:KAt)(e,t)):$p(this.node(),e).delay}function t3t(t,e){return function(){Om(this,t).duration=+e.apply(this,arguments)}}function r3t(t,e){return e=+e,function(){Om(this,t).duration=e}}function i3t(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?t3t:r3t)(e,t)):$p(this.node(),e).duration}function s3t(t,e){if(typeof e!="function")throw new Error;return function(){Om(this,t).ease=e}}function n3t(t){var e=this._id;return arguments.length?this.each(s3t(e,t)):$p(this.node(),e).ease}function o3t(t,e){return function(){var r=e.apply(this,arguments);if(typeof r!="function")throw new Error;Om(this,t).ease=r}}function a3t(t){if(typeof t!="function")throw new Error;return this.each(o3t(this._id,t))}function l3t(t){typeof t!="function"&&(t=xPe(t));for(var e=this._groups,r=e.length,i=new Array(r),s=0;s<r;++s)for(var n=e[s],o=n.length,a=i[s]=[],l,c=0;c<o;++c)(l=n[c])&&t.call(l,l.__data__,c,n)&&a.push(l);return new vy(i,this._parents,this._name,this._id)}function c3t(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,r=t._groups,i=e.length,s=r.length,n=Math.min(i,s),o=new Array(i),a=0;a<n;++a)for(var l=e[a],c=r[a],h=l.length,p=o[a]=new Array(h),f,m=0;m<h;++m)(f=l[m]||c[m])&&(p[m]=f);for(;a<i;++a)o[a]=e[a];return new vy(o,this._parents,this._name,this._id)}function u3t(t){return(t+"").trim().split(/^|\s+/).every(function(e){var r=e.indexOf(".");return r>=0&&(e=e.slice(0,r)),!e||e==="start"})}function h3t(t,e,r){var i,s,n=u3t(e)?WK:Om;return function(){var o=n(this,t),a=o.on;a!==i&&(s=(i=a).copy()).on(e,r),o.on=s}}function d3t(t,e){var r=this._id;return arguments.length<2?$p(this.node(),r).on.on(t):this.each(h3t(r,t,e))}function p3t(t){return function(){var e=this.parentNode;for(var r in this.__transition)if(+r!==t)return;e&&e.removeChild(this)}}function f3t(){return this.on("end.remove",p3t(this._id))}function m3t(t){var e=this._name,r=this._id;typeof t!="function"&&(t=BK(t));for(var i=this._groups,s=i.length,n=new Array(s),o=0;o<s;++o)for(var a=i[o],l=a.length,c=n[o]=new Array(l),h,p,f=0;f<l;++f)(h=a[f])&&(p=t.call(h,h.__data__,f,a))&&("__data__"in h&&(p.__data__=h.__data__),c[f]=p,u8(c[f],e,r,f,c,$p(h,r)));return new vy(n,this._parents,e,r)}function g3t(t){var e=this._name,r=this._id;typeof t!="function"&&(t=wPe(t));for(var i=this._groups,s=i.length,n=[],o=[],a=0;a<s;++a)for(var l=i[a],c=l.length,h,p=0;p<c;++p)if(h=l[p]){for(var f=t.call(h,h.__data__,p,l),m,y=$p(h,r),_=0,v=f.length;_<v;++_)(m=f[_])&&u8(m,e,r,_,f,y);n.push(f),o.push(h)}return new vy(n,o,e,r)}var y3t=bP.prototype.constructor;function _3t(){return new y3t(this._groups,this._parents)}function v3t(t,e){var r,i,s;return function(){var n=LE(this,t),o=(this.style.removeProperty(t),LE(this,t));return n===o?null:n===r&&o===i?s:s=e(r=n,i=o)}}function GPe(t){return function(){this.style.removeProperty(t)}}function b3t(t,e,r){var i,s=r+"",n;return function(){var o=LE(this,t);return o===s?null:o===i?n:n=e(i=o,r)}}function w3t(t,e,r){var i,s,n;return function(){var o=LE(this,t),a=r(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(t),LE(this,t))),o===l?null:o===i&&l===s?n:(s=l,n=e(i=o,a))}}function x3t(t,e){var r,i,s,n="style."+e,o="end."+n,a;return function(){var l=Om(this,t),c=l.on,h=l.value[n]==null?a||(a=GPe(e)):void 0;(c!==r||s!==h)&&(i=(r=c).copy()).on(o,s=h),l.on=i}}function T3t(t,e,r){var i=(t+="")=="transform"?AAt:BPe;return e==null?this.styleTween(t,v3t(t,i)).on("end.style."+t,GPe(t)):typeof e=="function"?this.styleTween(t,w3t(t,i,XK(this,"style."+t,e))).each(x3t(this._id,t)):this.styleTween(t,b3t(t,i,e),r).on("end.style."+t,null)}function S3t(t,e,r){return function(i){this.style.setProperty(t,e.call(this,i),r)}}function E3t(t,e,r){var i,s;function n(){var o=e.apply(this,arguments);return o!==s&&(i=(s=o)&&S3t(t,o,r)),i}return n._value=e,n}function C3t(t,e,r){var i="style."+(t+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;return this.tween(i,E3t(t,e,r??""))}function A3t(t){return function(){this.textContent=t}}function O3t(t){return function(){var e=t(this);this.textContent=e??""}}function R3t(t){return this.tween("text",typeof t=="function"?O3t(XK(this,"text",t)):A3t(t==null?"":t+""))}function M3t(t){return function(e){this.textContent=t.call(this,e)}}function P3t(t){var e,r;function i(){var s=t.apply(this,arguments);return s!==r&&(e=(r=s)&&M3t(s)),e}return i._value=t,i}function I3t(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,P3t(t))}function $3t(){for(var t=this._name,e=this._id,r=jPe(),i=this._groups,s=i.length,n=0;n<s;++n)for(var o=i[n],a=o.length,l,c=0;c<a;++c)if(l=o[c]){var h=$p(l,e);u8(l,t,r,c,o,{time:h.time+h.delay+h.duration,delay:0,duration:h.duration,ease:h.ease})}return new vy(i,this._parents,t,r)}function L3t(){var t,e,r=this,i=r._id,s=r.size();return new Promise(function(n,o){var a={value:o},l={value:function(){--s===0&&n()}};r.each(function(){var c=Om(this,i),h=c.on;h!==t&&(e=(t=h).copy(),e._.cancel.push(a),e._.interrupt.push(a),e._.end.push(l)),c.on=e}),s===0&&n()})}var D3t=0;function vy(t,e,r,i){this._groups=t,this._parents=e,this._name=r,this._id=i}function jPe(){return++D3t}var Zm=bP.prototype;vy.prototype={constructor:vy,select:m3t,selectAll:g3t,selectChild:Zm.selectChild,selectChildren:Zm.selectChildren,filter:l3t,merge:c3t,selection:_3t,transition:$3t,call:Zm.call,nodes:Zm.nodes,node:Zm.node,size:Zm.size,empty:Zm.empty,each:Zm.each,on:d3t,attr:qAt,attrTween:JAt,style:T3t,styleTween:C3t,text:R3t,textTween:I3t,remove:f3t,tween:kAt,delay:e3t,duration:i3t,ease:n3t,easeVarying:a3t,end:L3t,[Symbol.iterator]:Zm[Symbol.iterator]};function N3t(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var F3t={time:null,delay:0,duration:250,ease:N3t};function U3t(t,e){for(var r;!(r=t.__transition)||!(r=r[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return r}function k3t(t){var e,r;t instanceof vy?(e=t._id,t=t._name):(e=jPe(),(r=F3t).time=qK(),t=t==null?null:t+"");for(var i=this._groups,s=i.length,n=0;n<s;++n)for(var o=i[n],a=o.length,l,c=0;c<a;++c)(l=o[c])&&u8(l,t,e,c,o,r||U3t(l,e));return new vy(i,this._parents,t,e)}bP.prototype.interrupt=NAt;bP.prototype.transition=k3t;const uV=t=>()=>t;function z3t(t,{sourceEvent:e,target:r,selection:i,mode:s,dispatch:n}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},selection:{value:i,enumerable:!0,configurable:!0},mode:{value:s,enumerable:!0,configurable:!0},_:{value:n}})}function V3t(t){t.stopImmediatePropagation()}function hV(t){t.preventDefault(),t.stopImmediatePropagation()}var Lpe={name:"drag"},dV={name:"space"},LT={name:"handle"},DT={name:"center"};const{abs:Dpe,max:Ma,min:Pa}=Math;function Npe(t){return[+t[0],+t[1]]}function Fpe(t){return[Npe(t[0]),Npe(t[1])]}var pV={name:"x",handles:["w","e"].map(S5),input:function(t,e){return t==null?null:[[+t[0],e[0][1]],[+t[1],e[1][1]]]},output:function(t){return t&&[t[0][0],t[1][0]]}},kN={name:"y",handles:["n","s"].map(S5),input:function(t,e){return t==null?null:[[e[0][0],+t[0]],[e[1][0],+t[1]]]},output:function(t){return t&&[t[0][1],t[1][1]]}},Ym={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Upe={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},kpe={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},B3t={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},G3t={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};function S5(t){return{type:t}}function j3t(t){return!t.ctrlKey&&!t.button}function H3t(){var t=this.ownerSVGElement||this;return t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]}function q3t(){return navigator.maxTouchPoints||"ontouchstart"in this}function fV(t){for(;!t.__brush;)if(!(t=t.parentNode))return;return t.__brush}function W3t(t){return t[0][0]===t[1][0]||t[0][1]===t[1][1]}function X3t(){return Z3t(kN)}function Z3t(t){var e=H3t,r=j3t,i=q3t,s=!0,n=VK("start","brush","end"),o=6,a;function l(v){var b=v.property("__brush",_).selectAll(".overlay").data([S5("overlay")]);b.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",Ym.overlay).merge(b).each(function(){var x=fV(this).extent;Ng(this).attr("x",x[0][0]).attr("y",x[0][1]).attr("width",x[1][0]-x[0][0]).attr("height",x[1][1]-x[0][1])}),v.selectAll(".selection").data([S5("selection")]).enter().append("rect").attr("class","selection").attr("cursor",Ym.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var T=v.selectAll(".handle").data(t.handles,function(x){return x.type});T.exit().remove(),T.enter().append("rect").attr("class",function(x){return"handle handle--"+x.type}).attr("cursor",function(x){return Ym[x.type]}),v.each(c).attr("fill","none").attr("pointer-events","all").on("mousedown.brush",f).filter(i).on("touchstart.brush",f).on("touchmove.brush",m).on("touchend.brush touchcancel.brush",y).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}l.move=function(v,b,T){v.tween?v.on("start.brush",function(x){h(this,arguments).beforestart().start(x)}).on("interrupt.brush end.brush",function(x){h(this,arguments).end(x)}).tween("brush",function(){var x=this,S=x.__brush,E=h(x,arguments),A=S.selection,R=t.input(typeof b=="function"?b.apply(this,arguments):b,S.extent),M=l8(A,R);function D(k){S.selection=k===1&&R===null?null:M(k),c.call(x),E.brush()}return A!==null&&R!==null?D:D(1)}):v.each(function(){var x=this,S=arguments,E=x.__brush,A=t.input(typeof b=="function"?b.apply(x,S):b,E.extent),R=h(x,S).beforestart();qW(x),E.selection=A===null?null:A,c.call(x),R.start(T).brush(T).end(T)})},l.clear=function(v,b){l.move(v,null,b)};function c(){var v=Ng(this),b=fV(this).selection;b?(v.selectAll(".selection").style("display",null).attr("x",b[0][0]).attr("y",b[0][1]).attr("width",b[1][0]-b[0][0]).attr("height",b[1][1]-b[0][1]),v.selectAll(".handle").style("display",null).attr("x",function(T){return T.type[T.type.length-1]==="e"?b[1][0]-o/2:b[0][0]-o/2}).attr("y",function(T){return T.type[0]==="s"?b[1][1]-o/2:b[0][1]-o/2}).attr("width",function(T){return T.type==="n"||T.type==="s"?b[1][0]-b[0][0]+o:o}).attr("height",function(T){return T.type==="e"||T.type==="w"?b[1][1]-b[0][1]+o:o})):v.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function h(v,b,T){var x=v.__brush.emitter;return x&&(!T||!x.clean)?x:new p(v,b,T)}function p(v,b,T){this.that=v,this.args=b,this.state=v.__brush,this.active=0,this.clean=T}p.prototype={beforestart:function(){return++this.active===1&&(this.state.emitter=this,this.starting=!0),this},start:function(v,b){return this.starting?(this.starting=!1,this.emit("start",v,b)):this.emit("brush",v),this},brush:function(v,b){return this.emit("brush",v,b),this},end:function(v,b){return--this.active===0&&(delete this.state.emitter,this.emit("end",v,b)),this},emit:function(v,b,T){var x=Ng(this.that).datum();n.call(v,this.that,new z3t(v,{sourceEvent:b,target:l,selection:t.output(this.state.selection),mode:T,dispatch:n}),x)}};function f(v){if(a&&!v.touches||!r.apply(this,arguments))return;var b=this,T=v.target.__data__.type,x=(s&&v.metaKey?T="overlay":T)==="selection"?Lpe:s&&v.altKey?DT:LT,S=t===kN?null:B3t[T],E=t===pV?null:G3t[T],A=fV(b),R=A.extent,M=A.selection,D=R[0][0],k,$,N=R[0][1],H,Z,G=R[1][0],J,I,z=R[1][1],F,j,W=0,Y=0,te,me=S&&E&&s&&v.shiftKey,Le,dt,st=Array.from(v.touches||[v],Se=>{const Re=Se.identifier;return Se=bpe(Se,b),Se.point0=Se.slice(),Se.identifier=Re,Se});qW(b);var Xe=h(b,arguments,!0).beforestart();if(T==="overlay"){M&&(te=!0);const Se=[st[0],st[1]||st[0]];A.selection=M=[[k=t===kN?D:Pa(Se[0][0],Se[1][0]),H=t===pV?N:Pa(Se[0][1],Se[1][1])],[J=t===kN?G:Ma(Se[0][0],Se[1][0]),F=t===pV?z:Ma(Se[0][1],Se[1][1])]],st.length>1&&_e(v)}else k=M[0][0],H=M[0][1],J=M[1][0],F=M[1][1];$=k,Z=H,I=J,j=F;var yt=Ng(b).attr("pointer-events","none"),ge=yt.selectAll(".overlay").attr("cursor",Ym[T]);if(v.touches)Xe.moved=bt,Xe.ended=Be;else{var Ce=Ng(v.view).on("mousemove.brush",bt,!0).on("mouseup.brush",Be,!0);s&&Ce.on("keydown.brush",qe,!0).on("keyup.brush",ft,!0),eAt(v.view)}c.call(b),Xe.start(v,x.name);function bt(Se){for(const Re of Se.changedTouches||[Se])for(const pt of st)pt.identifier===Re.identifier&&(pt.cur=bpe(Re,b));if(me&&!Le&&!dt&&st.length===1){const Re=st[0];Dpe(Re.cur[0]-Re[0])>Dpe(Re.cur[1]-Re[1])?dt=!0:Le=!0}for(const Re of st)Re.cur&&(Re[0]=Re.cur[0],Re[1]=Re.cur[1]);te=!0,hV(Se),_e(Se)}function _e(Se){const Re=st[0],pt=Re.point0;var Ut;switch(W=Re[0]-pt[0],Y=Re[1]-pt[1],x){case dV:case Lpe:{S&&(W=Ma(D-k,Pa(G-J,W)),$=k+W,I=J+W),E&&(Y=Ma(N-H,Pa(z-F,Y)),Z=H+Y,j=F+Y);break}case LT:{st[1]?(S&&($=Ma(D,Pa(G,st[0][0])),I=Ma(D,Pa(G,st[1][0])),S=1),E&&(Z=Ma(N,Pa(z,st[0][1])),j=Ma(N,Pa(z,st[1][1])),E=1)):(S<0?(W=Ma(D-k,Pa(G-k,W)),$=k+W,I=J):S>0&&(W=Ma(D-J,Pa(G-J,W)),$=k,I=J+W),E<0?(Y=Ma(N-H,Pa(z-H,Y)),Z=H+Y,j=F):E>0&&(Y=Ma(N-F,Pa(z-F,Y)),Z=H,j=F+Y));break}case DT:{S&&($=Ma(D,Pa(G,k-W*S)),I=Ma(D,Pa(G,J+W*S))),E&&(Z=Ma(N,Pa(z,H-Y*E)),j=Ma(N,Pa(z,F+Y*E)));break}}I<$&&(S*=-1,Ut=k,k=J,J=Ut,Ut=$,$=I,I=Ut,T in Upe&&ge.attr("cursor",Ym[T=Upe[T]])),j<Z&&(E*=-1,Ut=H,H=F,F=Ut,Ut=Z,Z=j,j=Ut,T in kpe&&ge.attr("cursor",Ym[T=kpe[T]])),A.selection&&(M=A.selection),Le&&($=M[0][0],I=M[1][0]),dt&&(Z=M[0][1],j=M[1][1]),(M[0][0]!==$||M[0][1]!==Z||M[1][0]!==I||M[1][1]!==j)&&(A.selection=[[$,Z],[I,j]],c.call(b),Xe.brush(Se,x.name))}function Be(Se){if(V3t(Se),Se.touches){if(Se.touches.length)return;a&&clearTimeout(a),a=setTimeout(function(){a=null},500)}else tAt(Se.view,te),Ce.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);yt.attr("pointer-events","all"),ge.attr("cursor",Ym.overlay),A.selection&&(M=A.selection),W3t(M)&&(A.selection=null,c.call(b)),Xe.end(Se,x.name)}function qe(Se){switch(Se.keyCode){case 16:{me=S&&E;break}case 18:{x===LT&&(S&&(J=I-W*S,k=$+W*S),E&&(F=j-Y*E,H=Z+Y*E),x=DT,_e(Se));break}case 32:{(x===LT||x===DT)&&(S<0?J=I-W:S>0&&(k=$-W),E<0?F=j-Y:E>0&&(H=Z-Y),x=dV,ge.attr("cursor",Ym.selection),_e(Se));break}default:return}hV(Se)}function ft(Se){switch(Se.keyCode){case 16:{me&&(Le=dt=me=!1,_e(Se));break}case 18:{x===DT&&(S<0?J=I:S>0&&(k=$),E<0?F=j:E>0&&(H=Z),x=LT,_e(Se));break}case 32:{x===dV&&(Se.altKey?(S&&(J=I-W*S,k=$+W*S),E&&(F=j-Y*E,H=Z+Y*E),x=DT):(S<0?J=I:S>0&&(k=$),E<0?F=j:E>0&&(H=Z),x=LT),ge.attr("cursor",Ym[T]),_e(Se));break}default:return}hV(Se)}}function m(v){h(this,arguments).moved(v)}function y(v){h(this,arguments).ended(v)}function _(){var v=this.__brush||{selection:null};return v.extent=Fpe(e.apply(this,arguments)),v.dim=t,v}return l.extent=function(v){return arguments.length?(e=typeof v=="function"?v:uV(Fpe(v)),l):e},l.filter=function(v){return arguments.length?(r=typeof v=="function"?v:uV(!!v),l):r},l.touchable=function(v){return arguments.length?(i=typeof v=="function"?v:uV(!!v),l):i},l.handleSize=function(v){return arguments.length?(o=+v,l):o},l.keyModifiers=function(v){return arguments.length?(s=!!v,l):s},l.on=function(){var v=n.on.apply(n,arguments);return v===n?l:v},l}function Y3t(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function E5(t,e){if((r=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var r,i=t.slice(0,r);return[i.length>1?i[0]+i.slice(2):i,+t.slice(r+1)]}function NE(t){return t=E5(Math.abs(t)),t?t[1]:NaN}function J3t(t,e){return function(r,i){for(var s=r.length,n=[],o=0,a=t[0],l=0;s>0&&a>0&&(l+a+1>i&&(a=Math.max(1,i-l)),n.push(r.substring(s-=a,s+a)),!((l+=a+1)>i));)a=t[o=(o+1)%t.length];return n.reverse().join(e)}}function Q3t(t){return function(e){return e.replace(/[0-9]/g,function(r){return t[+r]})}}var K3t=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function C5(t){if(!(e=K3t.exec(t)))throw new Error("invalid format: "+t);var e;return new ZK({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}C5.prototype=ZK.prototype;function ZK(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}ZK.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function eOt(t){e:for(var e=t.length,r=1,i=-1,s;r<e;++r)switch(t[r]){case".":i=s=r;break;case"0":i===0&&(i=r),s=r;break;default:if(!+t[r])break e;i>0&&(i=0);break}return i>0?t.slice(0,i)+t.slice(s+1):t}var HPe;function tOt(t,e){var r=E5(t,e);if(!r)return t+"";var i=r[0],s=r[1],n=s-(HPe=Math.max(-8,Math.min(8,Math.floor(s/3)))*3)+1,o=i.length;return n===o?i:n>o?i+new Array(n-o+1).join("0"):n>0?i.slice(0,n)+"."+i.slice(n):"0."+new Array(1-n).join("0")+E5(t,Math.max(0,e+n-1))[0]}function zpe(t,e){var r=E5(t,e);if(!r)return t+"";var i=r[0],s=r[1];return s<0?"0."+new Array(-s).join("0")+i:i.length>s+1?i.slice(0,s+1)+"."+i.slice(s+1):i+new Array(s-i.length+2).join("0")}const Vpe={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:Y3t,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>zpe(t*100,e),r:zpe,s:tOt,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function Bpe(t){return t}var Gpe=Array.prototype.map,jpe=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function rOt(t){var e=t.grouping===void 0||t.thousands===void 0?Bpe:J3t(Gpe.call(t.grouping,Number),t.thousands+""),r=t.currency===void 0?"":t.currency[0]+"",i=t.currency===void 0?"":t.currency[1]+"",s=t.decimal===void 0?".":t.decimal+"",n=t.numerals===void 0?Bpe:Q3t(Gpe.call(t.numerals,String)),o=t.percent===void 0?"%":t.percent+"",a=t.minus===void 0?"":t.minus+"",l=t.nan===void 0?"NaN":t.nan+"";function c(p){p=C5(p);var f=p.fill,m=p.align,y=p.sign,_=p.symbol,v=p.zero,b=p.width,T=p.comma,x=p.precision,S=p.trim,E=p.type;E==="n"?(T=!0,E="g"):Vpe[E]||(x===void 0&&(x=12),S=!0,E="g"),(v||f==="0"&&m==="=")&&(v=!0,f="0",m="=");var A=_==="$"?r:_==="#"&&/[boxX]/.test(E)?"0"+E.toLowerCase():"",R=_==="$"?i:/[%p]/.test(E)?o:"",M=Vpe[E],D=/[defgprs%]/.test(E);x=x===void 0?6:/[gprs]/.test(E)?Math.max(1,Math.min(21,x)):Math.max(0,Math.min(20,x));function k($){var N=A,H=R,Z,G,J;if(E==="c")H=M($)+H,$="";else{$=+$;var I=$<0||1/$<0;if($=isNaN($)?l:M(Math.abs($),x),S&&($=eOt($)),I&&+$==0&&y!=="+"&&(I=!1),N=(I?y==="("?y:a:y==="-"||y==="("?"":y)+N,H=(E==="s"?jpe[8+HPe/3]:"")+H+(I&&y==="("?")":""),D){for(Z=-1,G=$.length;++Z<G;)if(J=$.charCodeAt(Z),48>J||J>57){H=(J===46?s+$.slice(Z+1):$.slice(Z))+H,$=$.slice(0,Z);break}}}T&&!v&&($=e($,1/0));var z=N.length+$.length+H.length,F=z<b?new Array(b-z+1).join(f):"";switch(T&&v&&($=e(F+$,F.length?b-H.length:1/0),F=""),m){case"<":$=N+$+H+F;break;case"=":$=N+F+$+H;break;case"^":$=F.slice(0,z=F.length>>1)+N+$+H+F.slice(z);break;default:$=F+N+$+H;break}return n($)}return k.toString=function(){return p+""},k}function h(p,f){var m=c((p=C5(p),p.type="f",p)),y=Math.max(-8,Math.min(8,Math.floor(NE(f)/3)))*3,_=Math.pow(10,-y),v=jpe[8+y/3];return function(b){return m(_*b)+v}}return{format:c,formatPrefix:h}}var LL,qPe,WPe;iOt({thousands:",",grouping:[3],currency:["$",""]});function iOt(t){return LL=rOt(t),qPe=LL.format,WPe=LL.formatPrefix,LL}function sOt(t){return Math.max(0,-NE(Math.abs(t)))}function nOt(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(NE(e)/3)))*3-NE(Math.abs(t)))}function oOt(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,NE(e)-NE(t))+1}function aOt(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function lOt(t){return function(){return t}}function cOt(t){return+t}var Hpe=[0,1];function e2(t){return t}function WW(t,e){return(e-=t=+t)?function(r){return(r-t)/e}:lOt(isNaN(e)?NaN:.5)}function uOt(t,e){var r;return t>e&&(r=t,t=e,e=r),function(i){return Math.max(t,Math.min(e,i))}}function hOt(t,e,r){var i=t[0],s=t[1],n=e[0],o=e[1];return s<i?(i=WW(s,i),n=r(o,n)):(i=WW(i,s),n=r(n,o)),function(a){return n(i(a))}}function dOt(t,e,r){var i=Math.min(t.length,e.length)-1,s=new Array(i),n=new Array(i),o=-1;for(t[i]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<i;)s[o]=WW(t[o],t[o+1]),n[o]=r(e[o],e[o+1]);return function(a){var l=sEt(t,a,1,i)-1;return n[l](s[l](a))}}function pOt(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function fOt(){var t=Hpe,e=Hpe,r=l8,i,s,n,o=e2,a,l,c;function h(){var f=Math.min(t.length,e.length);return o!==e2&&(o=uOt(t[0],t[f-1])),a=f>2?dOt:hOt,l=c=null,p}function p(f){return f==null||isNaN(f=+f)?n:(l||(l=a(t.map(i),e,r)))(i(o(f)))}return p.invert=function(f){return o(s((c||(c=a(e,t.map(i),Kd)))(f)))},p.domain=function(f){return arguments.length?(t=Array.from(f,cOt),h()):t.slice()},p.range=function(f){return arguments.length?(e=Array.from(f),h()):e.slice()},p.rangeRound=function(f){return e=Array.from(f),r=SAt,h()},p.clamp=function(f){return arguments.length?(o=f?!0:e2,h()):o!==e2},p.interpolate=function(f){return arguments.length?(r=f,h()):r},p.unknown=function(f){return arguments.length?(n=f,p):n},function(f,m){return i=f,s=m,h()}}function mOt(){return fOt()(e2,e2)}function gOt(t,e,r,i){var s=cEt(t,e,r),n;switch(i=C5(i??",f"),i.type){case"s":{var o=Math.max(Math.abs(t),Math.abs(e));return i.precision==null&&!isNaN(n=nOt(s,o))&&(i.precision=n),WPe(i,o)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(n=oOt(s,Math.max(Math.abs(t),Math.abs(e))))&&(i.precision=n-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(n=sOt(s))&&(i.precision=n-(i.type==="%")*2);break}}return qPe(i)}function yOt(t){var e=t.domain;return t.ticks=function(r){var i=e();return lEt(i[0],i[i.length-1],r??10)},t.tickFormat=function(r,i){var s=e();return gOt(s[0],s[s.length-1],r??10,i)},t.nice=function(r){r==null&&(r=10);var i=e(),s=0,n=i.length-1,o=i[s],a=i[n],l,c,h=10;for(a<o&&(c=o,o=a,a=c,c=s,s=n,n=c);h-- >0;){if(c=NW(o,a,r),c===l)return i[s]=o,i[n]=a,e(i);if(c>0)o=Math.floor(o/c)*c,a=Math.ceil(a/c)*c;else if(c<0)o=Math.ceil(o*c)/c,a=Math.floor(a*c)/c;else break;l=c}return t},t}function XW(){var t=mOt();return t.copy=function(){return pOt(t,XW())},aOt.apply(t,arguments),yOt(t)}function pO(t,e,r){this.k=t,this.x=e,this.y=r}pO.prototype={constructor:pO,scale:function(t){return t===1?this:new pO(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new pO(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};pO.prototype;const Mi={ageClasses:[{minValue:1900,maxValue:1924,color:new Ne([153,167,204])},{minValue:1925,maxValue:1949,color:new Ne([149,184,214])},{minValue:1950,maxValue:1974,color:new Ne([153,204,203])},{minValue:1975,maxValue:1999,color:new Ne([153,204,179])},{minValue:2e3,maxValue:2024,color:new Ne([175,206,152])}],defaultColor:new Ne([230,230,230]),highlightOptions:{color:new Ne([255,255,0]),fillOpacity:.4},buildingOptions:{minHeight:0,maxHeight:1500,minCnstrctYear:1900,maxCnstrctYear:2024},initPeriod:[!0,!0,!0,!0,!0],categories:[{value:"all",text:"Show all buildings"},{value:"info",text:"Only annotated buildings"},{value:"top",text:"Top 20 buildings"}],initCategory:"all",infoPointsUrl:"https://services2.arcgis.com/cFEFS0EWrhfDeVw9/ArcGIS/rest/services/Centroids_Manhattan_Information/FeatureServer/0",buildingsUrl:"https://tiles.arcgis.com/tiles/cFEFS0EWrhfDeVw9/arcgis/rest/services/Buildings_Manhattan/SceneServer",maxPhotoCount:10,maxAttributionLength:50};class _Ot{constructor(e,r,i){this.width=document.getElementById(e).clientWidth,this.height=document.getElementById(e).clientHeight,this.paddingLeft=90,this.paddingTop=20,this.paddingBottom=15;const s=Ng("#"+e).append("svg").attr("height",this.height).attr("width",this.width+2),n=Mi.buildingOptions,o=XW().domain([n.minCnstrctYear-1,n.maxCnstrctYear]).range([this.paddingLeft,this.width]),a=XW().domain([0,n.maxHeight]).range([this.height-this.paddingBottom,this.paddingTop]),l=yEt(a).tickValues([0,500,1e3,1500]).tickFormat(y=>y===1500?y+" ft":y.toString()).tickPadding(10);function c(y,_,v,b){s.append("line").attr("x1",y).attr("y1",a(_)).attr("x2",o(v)).attr("y2",a(b)).style("stroke-dasharray","2, 2").style("stroke","#bbb")}c(this.paddingLeft,1e3,2025,1e3),c(this.paddingLeft,500,2025,500),c(this.paddingLeft,0,2025,0),c(this.paddingLeft,1408,2009,1408),s.append("image").attr("xlink:href","./world-trade-center.png").attr("y",30).attr("x",10).attr("height",this.height-43).attr("width",25);const h=s.append("g");h.append("rect").classed("top",!0).attr("x",o(2020)).attr("y",a(n.maxHeight)-9).attr("width",50).attr("height",6).attr("rx",5).attr("ry",0).attr("cursor","ns-resize").style("fill","#bbb"),h.append("rect").classed("bottom",!0).attr("x",o(2020)).attr("y",a(n.minHeight)-1).attr("width",50).attr("height",6).attr("rx",5).attr("ry",0).attr("cursor","ns-resize").style("fill","#bbb");const p=s.append("g").attr("transform","translate("+this.paddingLeft+", 0)").call(l),f=X3t().extent([[0,this.paddingTop],[this.width,this.height-this.paddingBottom]]);p.call(f).call(f.move,[a(n.maxHeight),a(n.minHeight)]),s.select(".overlay").attr("display","none");const m=s.selectAll("circle").data(r).enter().append("circle").attr("r",4).attr("class",function(y){let _;return Mi.ageClasses.forEach(function(v,b){v.minValue<=y.attributes.cnstrct_yr&&y.attributes.cnstrct_yr<=v.maxValue&&(_=b)}),"construct-"+_}).classed("circle",!0).attr("id",function(y){return"id-"+y.attributes.objectid}).attr("fill",function(y){const v=Mi.ageClasses.filter(function(b){return b.minValue<=y.attributes.cnstrct_yr&&y.attributes.cnstrct_yr<=b.maxValue})[0].color.clone();return v.a=.7,v.toCss()}).attr("cx",function(y){return o(y.attributes.cnstrct_yr)}).attr("cy",function(y){return a(y.attributes.heightroof)}).on("click",function(y,_){i.selectedBuilding=_});s.append("text").attr("x",this.paddingLeft+2).attr("id","upper-indicator"),s.append("text").attr("x",this.paddingLeft+2).attr("id","lower-indicator"),f.on("brush",function(y){h.select("rect.top").attr("y",y.selection[0]-9),h.select("rect.bottom").attr("y",y.selection[1]-1),s.select("#upper-indicator").attr("y",y.selection[0]-5).text(Math.round(a.invert(y.selection[0]))),s.select("#lower-indicator").attr("y",y.selection[1]+15).text(Math.round(a.invert(y.selection[1]))),i.filteredBuildings=[a.invert(y.selection[1]),a.invert(y.selection[0])]}),f.on("end",function(y){s.select("#upper-indicator").text(""),s.select("#lower-indicator").text(""),y.selection||p.call(f).call(f.move,[a(1500),a(0)])}),this.circles=m,this.selectContainer=s.append("g")}select(e){const r=Ng("#id-"+e.attributes.objectid);this.selectContainer.append("circle").attr("class","selectedGraphic").attr("r",8).attr("cx",parseInt(r.attr("cx"),10)).attr("cy",parseInt(r.attr("cy"),10)).attr("stroke-width",4).attr("stroke",Mi.highlightOptions.color.toCss()).attr("fill","none")}deselect(){this.selectContainer.selectAll(".selectedGraphic").remove()}updatePeriod(e){for(let r=0;r<e.length;r++){let i;e[r]?(i=Mi.ageClasses[r].color.clone(),i.a=.8):i=Mi.defaultColor,this.circles.filter(".construct-"+r).attr("fill",i.toCss(!0))}}updateFilter(e){this.circles.attr("display",function(r){return r.attributes.heightroof<e[0]||r.attributes.heightroof>e[1]?"none":"inline"})}applyCategory(e){if(e==="all")this.circles.attr("opacity",1).attr("r",4);else{const r=e==="info"?"wiki":"top20";this.circles.attr("opacity",function(i){return i.attributes[r]===1?1:.2}).attr("r",function(i){return i.attributes[r]===1?4:1})}}}class vOt{constructor(e,r){this.layer=e,this.field=r,this.layer=e,this.field=r}createClassBreakInfos(e){return Mi.ageClasses.map((r,i)=>{const s=e[i]?r.color:Mi.defaultColor;return{minValue:r.minValue,maxValue:r.maxValue,symbol:new J2({symbolLayers:[new Cw({material:{color:s},edges:new x0e({size:1.2,color:[50,50,50,.2]})})]})}})}applyClassBreaksRenderer(e,r){const i=new J2({symbolLayers:[new Cw({material:{color:Mi.defaultColor}})]});this.layer.renderer=new HZ({field:this.field,defaultSymbol:i,classBreakInfos:this.createClassBreakInfos(e)}),this.applyCategory(r.selectedCategory)}applyCategory(e){const r=this.layer.renderer.clone();if(e==="all")r.visualVariables=[];else{const i=e==="info"?"WIKI":"TOP20";r.visualVariables=[new BZ({field:i,stops:[{value:0,opacity:0},{value:1,opacity:1}]})]}this.layer.renderer=r}createUniqueValueRenderer(e,r){return new g6({field:e,uniqueValueInfos:[{value:r.value,symbol:new Uf({symbolLayers:[new Ff({size:18,resource:{href:r.image}})],verticalOffset:{screenLength:80,maxWorldLength:100},callout:{type:"line",size:1,color:[50,50,50],border:{color:[255,255,255]}}})}]})}}var bOt=Object.defineProperty,wOt=Object.getOwnPropertyDescriptor,xP=(t,e,r,i)=>{for(var s=i>1?void 0:i?wOt(e,r):e,n=t.length-1,o;n>=0;n--)(o=t[n])&&(s=(i?o(e,r,s):o(s))||s);return i&&s&&bOt(e,r,s),s};let ex=class extends we{constructor(){super(...arguments),this.selectedPeriod=Mi.initPeriod,this.selectedBuilding=null,this.filteredBuildings=null,this.selectedCategory=Mi.initCategory}};xP([d()],ex.prototype,"selectedPeriod",2);xP([d()],ex.prototype,"selectedBuilding",2);xP([d()],ex.prototype,"filteredBuildings",2);xP([d()],ex.prototype,"selectedCategory",2);ex=xP([P("skyscraper-explorer.State")],ex);class xOt{constructor(e,r){for(let s=0;s<Mi.initPeriod.length;s++){const n=document.createElement("button");n.id="period-"+s,n.innerHTML=Mi.ageClasses[s].minValue+" - "+Mi.ageClasses[s].maxValue,document.getElementById(e).appendChild(n),n.addEventListener("click",i(s))}function i(s){return function(){const n=[];for(let o=0;o<Mi.initPeriod.length;o++)n[o]=o!==s?r.selectedPeriod[o]:!r.selectedPeriod[o];r.selectedPeriod=n}}}update(e){for(let r=0;r<e.length;r++){const i=document.getElementById("period-"+r).style;i.backgroundColor=e[r]?Mi.ageClasses[r].color.toCss():Mi.defaultColor.toCss(),i.color=e[r]?"#fff":"#777"}}}function TOt(t,e){for(let i=0;i<Mi.categories.length;i++){const s=Mi.initCategory===Mi.categories[i].value?"selected":"",n=document.createElement("button");n.id="category-"+Mi.categories[i].value,n.value=Mi.categories[i].value,n.innerHTML=Mi.categories[i].text,n.className=s,n.addEventListener("click",o=>r(o)),document.getElementById(t).appendChild(n)}function r(i){const s=i.target;document.getElementById("category-"+e.selectedCategory).classList.remove("selected"),document.getElementById("category-"+s.value).classList.add("selected"),e.selectedCategory=s.value}}function qpe(t){return t!==null&&typeof t=="object"&&"constructor"in t&&t.constructor===Object}function YK(t,e){t===void 0&&(t={}),e===void 0&&(e={}),Object.keys(e).forEach(r=>{typeof t[r]>"u"?t[r]=e[r]:qpe(e[r])&&qpe(t[r])&&Object.keys(e[r]).length>0&&YK(t[r],e[r])})}const XPe={body:{},addEventListener(){},removeEventListener(){},activeElement:{blur(){},nodeName:""},querySelector(){return null},querySelectorAll(){return[]},getElementById(){return null},createEvent(){return{initEvent(){}}},createElement(){return{children:[],childNodes:[],style:{},setAttribute(){},getElementsByTagName(){return[]}}},createElementNS(){return{}},importNode(){return null},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""}};function xx(){const t=typeof document<"u"?document:{};return YK(t,XPe),t}const SOt={document:XPe,navigator:{userAgent:""},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""},history:{replaceState(){},pushState(){},go(){},back(){}},CustomEvent:function(){return this},addEventListener(){},removeEventListener(){},getComputedStyle(){return{getPropertyValue(){return""}}},Image(){},Date(){},screen:{},setTimeout(){},clearTimeout(){},matchMedia(){return{}},requestAnimationFrame(t){return typeof setTimeout>"u"?(t(),null):setTimeout(t,0)},cancelAnimationFrame(t){typeof setTimeout>"u"||clearTimeout(t)}};function Lu(){const t=typeof window<"u"?window:{};return YK(t,SOt),t}function EOt(t){const e=t;Object.keys(e).forEach(r=>{try{e[r]=null}catch{}try{delete e[r]}catch{}})}function ZW(t,e){return e===void 0&&(e=0),setTimeout(t,e)}function A5(){return Date.now()}function COt(t){const e=Lu();let r;return e.getComputedStyle&&(r=e.getComputedStyle(t,null)),!r&&t.currentStyle&&(r=t.currentStyle),r||(r=t.style),r}function AOt(t,e){e===void 0&&(e="x");const r=Lu();let i,s,n;const o=COt(t);return r.WebKitCSSMatrix?(s=o.transform||o.webkitTransform,s.split(",").length>6&&(s=s.split(", ").map(a=>a.replace(",",".")).join(", ")),n=new r.WebKitCSSMatrix(s==="none"?"":s)):(n=o.MozTransform||o.OTransform||o.MsTransform||o.msTransform||o.transform||o.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,"),i=n.toString().split(",")),e==="x"&&(r.WebKitCSSMatrix?s=n.m41:i.length===16?s=parseFloat(i[12]):s=parseFloat(i[4])),e==="y"&&(r.WebKitCSSMatrix?s=n.m42:i.length===16?s=parseFloat(i[13]):s=parseFloat(i[5])),s||0}function DL(t){return typeof t=="object"&&t!==null&&t.constructor&&Object.prototype.toString.call(t).slice(8,-1)==="Object"}function OOt(t){return typeof window<"u"&&typeof window.HTMLElement<"u"?t instanceof HTMLElement:t&&(t.nodeType===1||t.nodeType===11)}function cu(){const t=Object(arguments.length<=0?void 0:arguments[0]),e=["__proto__","constructor","prototype"];for(let r=1;r<arguments.length;r+=1){const i=r<0||arguments.length<=r?void 0:arguments[r];if(i!=null&&!OOt(i)){const s=Object.keys(Object(i)).filter(n=>e.indexOf(n)<0);for(let n=0,o=s.length;n<o;n+=1){const a=s[n],l=Object.getOwnPropertyDescriptor(i,a);l!==void 0&&l.enumerable&&(DL(t[a])&&DL(i[a])?i[a].__swiper__?t[a]=i[a]:cu(t[a],i[a]):!DL(t[a])&&DL(i[a])?(t[a]={},i[a].__swiper__?t[a]=i[a]:cu(t[a],i[a])):t[a]=i[a])}}}return t}function NL(t,e,r){t.style.setProperty(e,r)}function ZPe(t){let{swiper:e,targetPosition:r,side:i}=t;const s=Lu(),n=-e.translate;let o=null,a;const l=e.params.speed;e.wrapperEl.style.scrollSnapType="none",s.cancelAnimationFrame(e.cssModeFrameID);const c=r>n?"next":"prev",h=(f,m)=>c==="next"&&f>=m||c==="prev"&&f<=m,p=()=>{a=new Date().getTime(),o===null&&(o=a);const f=Math.max(Math.min((a-o)/l,1),0),m=.5-Math.cos(f*Math.PI)/2;let y=n+m*(r-n);if(h(y,r)&&(y=r),e.wrapperEl.scrollTo({[i]:y}),h(y,r)){e.wrapperEl.style.overflow="hidden",e.wrapperEl.style.scrollSnapType="",setTimeout(()=>{e.wrapperEl.style.overflow="",e.wrapperEl.scrollTo({[i]:y})}),s.cancelAnimationFrame(e.cssModeFrameID);return}e.cssModeFrameID=s.requestAnimationFrame(p)};p()}function Gf(t,e){return e===void 0&&(e=""),[...t.children].filter(r=>r.matches(e))}function YPe(t,e){e===void 0&&(e=[]);const r=document.createElement(t);return r.classList.add(...Array.isArray(e)?e:[e]),r}function ROt(t,e){const r=[];for(;t.previousElementSibling;){const i=t.previousElementSibling;e?i.matches(e)&&r.push(i):r.push(i),t=i}return r}function MOt(t,e){const r=[];for(;t.nextElementSibling;){const i=t.nextElementSibling;e?i.matches(e)&&r.push(i):r.push(i),t=i}return r}function k_(t,e){return Lu().getComputedStyle(t,null).getPropertyValue(e)}function Wpe(t){let e=t,r;if(e){for(r=0;(e=e.previousSibling)!==null;)e.nodeType===1&&(r+=1);return r}}function POt(t,e){const r=[];let i=t.parentElement;for(;i;)e?i.matches(e)&&r.push(i):r.push(i),i=i.parentElement;return r}function Xpe(t,e,r){const i=Lu();return r?t[e==="width"?"offsetWidth":"offsetHeight"]+parseFloat(i.getComputedStyle(t,null).getPropertyValue(e==="width"?"margin-right":"margin-top"))+parseFloat(i.getComputedStyle(t,null).getPropertyValue(e==="width"?"margin-left":"margin-bottom")):t.offsetWidth}let mV;function IOt(){const t=Lu(),e=xx();return{smoothScroll:e.documentElement&&e.documentElement.style&&"scrollBehavior"in e.documentElement.style,touch:!!("ontouchstart"in t||t.DocumentTouch&&e instanceof t.DocumentTouch)}}function JPe(){return mV||(mV=IOt()),mV}let gV;function $Ot(t){let{userAgent:e}=t===void 0?{}:t;const r=JPe(),i=Lu(),s=i.navigator.platform,n=e||i.navigator.userAgent,o={ios:!1,android:!1},a=i.screen.width,l=i.screen.height,c=n.match(/(Android);?[\s\/]+([\d.]+)?/);let h=n.match(/(iPad).*OS\s([\d_]+)/);const p=n.match(/(iPod)(.*OS\s([\d_]+))?/),f=!h&&n.match(/(iPhone\sOS|iOS)\s([\d_]+)/),m=s==="Win32";let y=s==="MacIntel";const _=["1024x1366","1366x1024","834x1194","1194x834","834x1112","1112x834","768x1024","1024x768","820x1180","1180x820","810x1080","1080x810"];return!h&&y&&r.touch&&_.indexOf(`${a}x${l}`)>=0&&(h=n.match(/(Version)\/([\d.]+)/),h||(h=[0,1,"13_0_0"]),y=!1),c&&!m&&(o.os="android",o.android=!0),(h||f||p)&&(o.os="ios",o.ios=!0),o}function LOt(t){return t===void 0&&(t={}),gV||(gV=$Ot(t)),gV}let yV;function DOt(){const t=Lu();let e=!1;function r(){const i=t.navigator.userAgent.toLowerCase();return i.indexOf("safari")>=0&&i.indexOf("chrome")<0&&i.indexOf("android")<0}if(r()){const i=String(t.navigator.userAgent);if(i.includes("Version/")){const[s,n]=i.split("Version/")[1].split(" ")[0].split(".").map(o=>Number(o));e=s<16||s===16&&n<2}}return{isSafari:e||r(),needPerspectiveFix:e,isWebView:/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(t.navigator.userAgent)}}function NOt(){return yV||(yV=DOt()),yV}function FOt(t){let{swiper:e,on:r,emit:i}=t;const s=Lu();let n=null,o=null;const a=()=>{!e||e.destroyed||!e.initialized||(i("beforeResize"),i("resize"))},l=()=>{!e||e.destroyed||!e.initialized||(n=new ResizeObserver(p=>{o=s.requestAnimationFrame(()=>{const{width:f,height:m}=e;let y=f,_=m;p.forEach(v=>{let{contentBoxSize:b,contentRect:T,target:x}=v;x&&x!==e.el||(y=T?T.width:(b[0]||b).inlineSize,_=T?T.height:(b[0]||b).blockSize)}),(y!==f||_!==m)&&a()})}),n.observe(e.el))},c=()=>{o&&s.cancelAnimationFrame(o),n&&n.unobserve&&e.el&&(n.unobserve(e.el),n=null)},h=()=>{!e||e.destroyed||!e.initialized||i("orientationchange")};r("init",()=>{if(e.params.resizeObserver&&typeof s.ResizeObserver<"u"){l();return}s.addEventListener("resize",a),s.addEventListener("orientationchange",h)}),r("destroy",()=>{c(),s.removeEventListener("resize",a),s.removeEventListener("orientationchange",h)})}function UOt(t){let{swiper:e,extendParams:r,on:i,emit:s}=t;const n=[],o=Lu(),a=function(h,p){p===void 0&&(p={});const f=o.MutationObserver||o.WebkitMutationObserver,m=new f(y=>{if(e.__preventObserver__)return;if(y.length===1){s("observerUpdate",y[0]);return}const _=function(){s("observerUpdate",y[0])};o.requestAnimationFrame?o.requestAnimationFrame(_):o.setTimeout(_,0)});m.observe(h,{attributes:typeof p.attributes>"u"?!0:p.attributes,childList:typeof p.childList>"u"?!0:p.childList,characterData:typeof p.characterData>"u"?!0:p.characterData}),n.push(m)},l=()=>{if(e.params.observer){if(e.params.observeParents){const h=POt(e.el);for(let p=0;p<h.length;p+=1)a(h[p])}a(e.el,{childList:e.params.observeSlideChildren}),a(e.wrapperEl,{attributes:!1})}},c=()=>{n.forEach(h=>{h.disconnect()}),n.splice(0,n.length)};r({observer:!1,observeParents:!1,observeSlideChildren:!1}),i("init",l),i("destroy",c)}var kOt={on(t,e,r){const i=this;if(!i.eventsListeners||i.destroyed||typeof e!="function")return i;const s=r?"unshift":"push";return t.split(" ").forEach(n=>{i.eventsListeners[n]||(i.eventsListeners[n]=[]),i.eventsListeners[n][s](e)}),i},once(t,e,r){const i=this;if(!i.eventsListeners||i.destroyed||typeof e!="function")return i;function s(){i.off(t,s),s.__emitterProxy&&delete s.__emitterProxy;for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];e.apply(i,o)}return s.__emitterProxy=e,i.on(t,s,r)},onAny(t,e){const r=this;if(!r.eventsListeners||r.destroyed||typeof t!="function")return r;const i=e?"unshift":"push";return r.eventsAnyListeners.indexOf(t)<0&&r.eventsAnyListeners[i](t),r},offAny(t){const e=this;if(!e.eventsListeners||e.destroyed||!e.eventsAnyListeners)return e;const r=e.eventsAnyListeners.indexOf(t);return r>=0&&e.eventsAnyListeners.splice(r,1),e},off(t,e){const r=this;return!r.eventsListeners||r.destroyed||!r.eventsListeners||t.split(" ").forEach(i=>{typeof e>"u"?r.eventsListeners[i]=[]:r.eventsListeners[i]&&r.eventsListeners[i].forEach((s,n)=>{(s===e||s.__emitterProxy&&s.__emitterProxy===e)&&r.eventsListeners[i].splice(n,1)})}),r},emit(){const t=this;if(!t.eventsListeners||t.destroyed||!t.eventsListeners)return t;let e,r,i;for(var s=arguments.length,n=new Array(s),o=0;o<s;o++)n[o]=arguments[o];return typeof n[0]=="string"||Array.isArray(n[0])?(e=n[0],r=n.slice(1,n.length),i=t):(e=n[0].events,r=n[0].data,i=n[0].context||t),r.unshift(i),(Array.isArray(e)?e:e.split(" ")).forEach(l=>{t.eventsAnyListeners&&t.eventsAnyListeners.length&&t.eventsAnyListeners.forEach(c=>{c.apply(i,[l,...r])}),t.eventsListeners&&t.eventsListeners[l]&&t.eventsListeners[l].forEach(c=>{c.apply(i,r)})}),t}};function zOt(){const t=this;let e,r;const i=t.el;typeof t.params.width<"u"&&t.params.width!==null?e=t.params.width:e=i.clientWidth,typeof t.params.height<"u"&&t.params.height!==null?r=t.params.height:r=i.clientHeight,!(e===0&&t.isHorizontal()||r===0&&t.isVertical())&&(e=e-parseInt(k_(i,"padding-left")||0,10)-parseInt(k_(i,"padding-right")||0,10),r=r-parseInt(k_(i,"padding-top")||0,10)-parseInt(k_(i,"padding-bottom")||0,10),Number.isNaN(e)&&(e=0),Number.isNaN(r)&&(r=0),Object.assign(t,{width:e,height:r,size:t.isHorizontal()?e:r}))}function VOt(){const t=this;function e($){return t.isHorizontal()?$:{width:"height","margin-top":"margin-left","margin-bottom ":"margin-right","margin-left":"margin-top","margin-right":"margin-bottom","padding-left":"padding-top","padding-right":"padding-bottom",marginRight:"marginBottom"}[$]}function r($,N){return parseFloat($.getPropertyValue(e(N))||0)}const i=t.params,{wrapperEl:s,slidesEl:n,size:o,rtlTranslate:a,wrongRTL:l}=t,c=t.virtual&&i.virtual.enabled,h=c?t.virtual.slides.length:t.slides.length,p=Gf(n,`.${t.params.slideClass}, swiper-slide`),f=c?t.virtual.slides.length:p.length;let m=[];const y=[],_=[];let v=i.slidesOffsetBefore;typeof v=="function"&&(v=i.slidesOffsetBefore.call(t));let b=i.slidesOffsetAfter;typeof b=="function"&&(b=i.slidesOffsetAfter.call(t));const T=t.snapGrid.length,x=t.slidesGrid.length;let S=i.spaceBetween,E=-v,A=0,R=0;if(typeof o>"u")return;typeof S=="string"&&S.indexOf("%")>=0?S=parseFloat(S.replace("%",""))/100*o:typeof S=="string"&&(S=parseFloat(S)),t.virtualSize=-S,p.forEach($=>{a?$.style.marginLeft="":$.style.marginRight="",$.style.marginBottom="",$.style.marginTop=""}),i.centeredSlides&&i.cssMode&&(NL(s,"--swiper-centered-offset-before",""),NL(s,"--swiper-centered-offset-after",""));const M=i.grid&&i.grid.rows>1&&t.grid;M&&t.grid.initSlides(f);let D;const k=i.slidesPerView==="auto"&&i.breakpoints&&Object.keys(i.breakpoints).filter($=>typeof i.breakpoints[$].slidesPerView<"u").length>0;for(let $=0;$<f;$+=1){D=0;let N;if(p[$]&&(N=p[$]),M&&t.grid.updateSlide($,N,f,e),!(p[$]&&k_(N,"display")==="none")){if(i.slidesPerView==="auto"){k&&(p[$].style[e("width")]="");const H=getComputedStyle(N),Z=N.style.transform,G=N.style.webkitTransform;if(Z&&(N.style.transform="none"),G&&(N.style.webkitTransform="none"),i.roundLengths)D=t.isHorizontal()?Xpe(N,"width",!0):Xpe(N,"height",!0);else{const J=r(H,"width"),I=r(H,"padding-left"),z=r(H,"padding-right"),F=r(H,"margin-left"),j=r(H,"margin-right"),W=H.getPropertyValue("box-sizing");if(W&&W==="border-box")D=J+F+j;else{const{clientWidth:Y,offsetWidth:te}=N;D=J+I+z+F+j+(te-Y)}}Z&&(N.style.transform=Z),G&&(N.style.webkitTransform=G),i.roundLengths&&(D=Math.floor(D))}else D=(o-(i.slidesPerView-1)*S)/i.slidesPerView,i.roundLengths&&(D=Math.floor(D)),p[$]&&(p[$].style[e("width")]=`${D}px`);p[$]&&(p[$].swiperSlideSize=D),_.push(D),i.centeredSlides?(E=E+D/2+A/2+S,A===0&&$!==0&&(E=E-o/2-S),$===0&&(E=E-o/2-S),Math.abs(E)<1/1e3&&(E=0),i.roundLengths&&(E=Math.floor(E)),R%i.slidesPerGroup===0&&m.push(E),y.push(E)):(i.roundLengths&&(E=Math.floor(E)),(R-Math.min(t.params.slidesPerGroupSkip,R))%t.params.slidesPerGroup===0&&m.push(E),y.push(E),E=E+D+S),t.virtualSize+=D+S,A=D,R+=1}}if(t.virtualSize=Math.max(t.virtualSize,o)+b,a&&l&&(i.effect==="slide"||i.effect==="coverflow")&&(s.style.width=`${t.virtualSize+S}px`),i.setWrapperSize&&(s.style[e("width")]=`${t.virtualSize+S}px`),M&&t.grid.updateWrapperSize(D,m,e),!i.centeredSlides){const $=[];for(let N=0;N<m.length;N+=1){let H=m[N];i.roundLengths&&(H=Math.floor(H)),m[N]<=t.virtualSize-o&&$.push(H)}m=$,Math.floor(t.virtualSize-o)-Math.floor(m[m.length-1])>1&&m.push(t.virtualSize-o)}if(c&&i.loop){const $=_[0]+S;if(i.slidesPerGroup>1){const N=Math.ceil((t.virtual.slidesBefore+t.virtual.slidesAfter)/i.slidesPerGroup),H=$*i.slidesPerGroup;for(let Z=0;Z<N;Z+=1)m.push(m[m.length-1]+H)}for(let N=0;N<t.virtual.slidesBefore+t.virtual.slidesAfter;N+=1)i.slidesPerGroup===1&&m.push(m[m.length-1]+$),y.push(y[y.length-1]+$),t.virtualSize+=$}if(m.length===0&&(m=[0]),S!==0){const $=t.isHorizontal()&&a?"marginLeft":e("marginRight");p.filter((N,H)=>!i.cssMode||i.loop?!0:H!==p.length-1).forEach(N=>{N.style[$]=`${S}px`})}if(i.centeredSlides&&i.centeredSlidesBounds){let $=0;_.forEach(H=>{$+=H+(S||0)}),$-=S;const N=$-o;m=m.map(H=>H<=0?-v:H>N?N+b:H)}if(i.centerInsufficientSlides){let $=0;if(_.forEach(N=>{$+=N+(S||0)}),$-=S,$<o){const N=(o-$)/2;m.forEach((H,Z)=>{m[Z]=H-N}),y.forEach((H,Z)=>{y[Z]=H+N})}}if(Object.assign(t,{slides:p,snapGrid:m,slidesGrid:y,slidesSizesGrid:_}),i.centeredSlides&&i.cssMode&&!i.centeredSlidesBounds){NL(s,"--swiper-centered-offset-before",`${-m[0]}px`),NL(s,"--swiper-centered-offset-after",`${t.size/2-_[_.length-1]/2}px`);const $=-t.snapGrid[0],N=-t.slidesGrid[0];t.snapGrid=t.snapGrid.map(H=>H+$),t.slidesGrid=t.slidesGrid.map(H=>H+N)}if(f!==h&&t.emit("slidesLengthChange"),m.length!==T&&(t.params.watchOverflow&&t.checkOverflow(),t.emit("snapGridLengthChange")),y.length!==x&&t.emit("slidesGridLengthChange"),i.watchSlidesProgress&&t.updateSlidesOffset(),!c&&!i.cssMode&&(i.effect==="slide"||i.effect==="fade")){const $=`${i.containerModifierClass}backface-hidden`,N=t.el.classList.contains($);f<=i.maxBackfaceHiddenSlides?N||t.el.classList.add($):N&&t.el.classList.remove($)}}function BOt(t){const e=this,r=[],i=e.virtual&&e.params.virtual.enabled;let s=0,n;typeof t=="number"?e.setTransition(t):t===!0&&e.setTransition(e.params.speed);const o=a=>i?e.slides[e.getSlideIndexByData(a)]:e.slides[a];if(e.params.slidesPerView!=="auto"&&e.params.slidesPerView>1)if(e.params.centeredSlides)(e.visibleSlides||[]).forEach(a=>{r.push(a)});else for(n=0;n<Math.ceil(e.params.slidesPerView);n+=1){const a=e.activeIndex+n;if(a>e.slides.length&&!i)break;r.push(o(a))}else r.push(o(e.activeIndex));for(n=0;n<r.length;n+=1)if(typeof r[n]<"u"){const a=r[n].offsetHeight;s=a>s?a:s}(s||s===0)&&(e.wrapperEl.style.height=`${s}px`)}function GOt(){const t=this,e=t.slides,r=t.isElement?t.isHorizontal()?t.wrapperEl.offsetLeft:t.wrapperEl.offsetTop:0;for(let i=0;i<e.length;i+=1)e[i].swiperSlideOffset=(t.isHorizontal()?e[i].offsetLeft:e[i].offsetTop)-r-t.cssOverflowAdjustment()}function jOt(t){t===void 0&&(t=this&&this.translate||0);const e=this,r=e.params,{slides:i,rtlTranslate:s,snapGrid:n}=e;if(i.length===0)return;typeof i[0].swiperSlideOffset>"u"&&e.updateSlidesOffset();let o=-t;s&&(o=t),i.forEach(l=>{l.classList.remove(r.slideVisibleClass)}),e.visibleSlidesIndexes=[],e.visibleSlides=[];let a=r.spaceBetween;typeof a=="string"&&a.indexOf("%")>=0?a=parseFloat(a.replace("%",""))/100*e.size:typeof a=="string"&&(a=parseFloat(a));for(let l=0;l<i.length;l+=1){const c=i[l];let h=c.swiperSlideOffset;r.cssMode&&r.centeredSlides&&(h-=i[0].swiperSlideOffset);const p=(o+(r.centeredSlides?e.minTranslate():0)-h)/(c.swiperSlideSize+a),f=(o-n[0]+(r.centeredSlides?e.minTranslate():0)-h)/(c.swiperSlideSize+a),m=-(o-h),y=m+e.slidesSizesGrid[l];(m>=0&&m<e.size-1||y>1&&y<=e.size||m<=0&&y>=e.size)&&(e.visibleSlides.push(c),e.visibleSlidesIndexes.push(l),i[l].classList.add(r.slideVisibleClass)),c.progress=s?-p:p,c.originalProgress=s?-f:f}}function HOt(t){const e=this;if(typeof t>"u"){const h=e.rtlTranslate?-1:1;t=e&&e.translate&&e.translate*h||0}const r=e.params,i=e.maxTranslate()-e.minTranslate();let{progress:s,isBeginning:n,isEnd:o,progressLoop:a}=e;const l=n,c=o;if(i===0)s=0,n=!0,o=!0;else{s=(t-e.minTranslate())/i;const h=Math.abs(t-e.minTranslate())<1,p=Math.abs(t-e.maxTranslate())<1;n=h||s<=0,o=p||s>=1,h&&(s=0),p&&(s=1)}if(r.loop){const h=e.getSlideIndexByData(0),p=e.getSlideIndexByData(e.slides.length-1),f=e.slidesGrid[h],m=e.slidesGrid[p],y=e.slidesGrid[e.slidesGrid.length-1],_=Math.abs(t);_>=f?a=(_-f)/y:a=(_+y-m)/y,a>1&&(a-=1)}Object.assign(e,{progress:s,progressLoop:a,isBeginning:n,isEnd:o}),(r.watchSlidesProgress||r.centeredSlides&&r.autoHeight)&&e.updateSlidesProgress(t),n&&!l&&e.emit("reachBeginning toEdge"),o&&!c&&e.emit("reachEnd toEdge"),(l&&!n||c&&!o)&&e.emit("fromEdge"),e.emit("progress",s)}function qOt(){const t=this,{slides:e,params:r,slidesEl:i,activeIndex:s}=t,n=t.virtual&&r.virtual.enabled,o=l=>Gf(i,`.${r.slideClass}${l}, swiper-slide${l}`)[0];e.forEach(l=>{l.classList.remove(r.slideActiveClass,r.slideNextClass,r.slidePrevClass)});let a;if(n)if(r.loop){let l=s-t.virtual.slidesBefore;l<0&&(l=t.virtual.slides.length+l),l>=t.virtual.slides.length&&(l-=t.virtual.slides.length),a=o(`[data-swiper-slide-index="${l}"]`)}else a=o(`[data-swiper-slide-index="${s}"]`);else a=e[s];if(a){a.classList.add(r.slideActiveClass);let l=MOt(a,`.${r.slideClass}, swiper-slide`)[0];r.loop&&!l&&(l=e[0]),l&&l.classList.add(r.slideNextClass);let c=ROt(a,`.${r.slideClass}, swiper-slide`)[0];r.loop&&!c===0&&(c=e[e.length-1]),c&&c.classList.add(r.slidePrevClass)}t.emitSlidesClasses()}const zN=(t,e)=>{if(!t||t.destroyed||!t.params)return;const r=()=>t.isElement?"swiper-slide":`.${t.params.slideClass}`,i=e.closest(r());if(i){const s=i.querySelector(`.${t.params.lazyPreloaderClass}`);s&&s.remove()}},_V=(t,e)=>{if(!t.slides[e])return;const r=t.slides[e].querySelector('[loading="lazy"]');r&&r.removeAttribute("loading")},YW=t=>{if(!t||t.destroyed||!t.params)return;let e=t.params.lazyPreloadPrevNext;const r=t.slides.length;if(!r||!e||e<0)return;e=Math.min(e,r);const i=t.params.slidesPerView==="auto"?t.slidesPerViewDynamic():Math.ceil(t.params.slidesPerView),s=t.activeIndex;if(t.params.grid&&t.params.grid.rows>1){const o=s,a=[o-e];a.push(...Array.from({length:e}).map((l,c)=>o+i+c)),t.slides.forEach((l,c)=>{a.includes(l.column)&&_V(t,c)});return}const n=s+i-1;if(t.params.rewind||t.params.loop)for(let o=s-e;o<=n+e;o+=1){const a=(o%r+r)%r;(a<s||a>n)&&_V(t,a)}else for(let o=Math.max(s-e,0);o<=Math.min(n+e,r-1);o+=1)o!==s&&(o>n||o<s)&&_V(t,o)};function WOt(t){const{slidesGrid:e,params:r}=t,i=t.rtlTranslate?t.translate:-t.translate;let s;for(let n=0;n<e.length;n+=1)typeof e[n+1]<"u"?i>=e[n]&&i<e[n+1]-(e[n+1]-e[n])/2?s=n:i>=e[n]&&i<e[n+1]&&(s=n+1):i>=e[n]&&(s=n);return r.normalizeSlideIndex&&(s<0||typeof s>"u")&&(s=0),s}function XOt(t){const e=this,r=e.rtlTranslate?e.translate:-e.translate,{snapGrid:i,params:s,activeIndex:n,realIndex:o,snapIndex:a}=e;let l=t,c;const h=f=>{let m=f-e.virtual.slidesBefore;return m<0&&(m=e.virtual.slides.length+m),m>=e.virtual.slides.length&&(m-=e.virtual.slides.length),m};if(typeof l>"u"&&(l=WOt(e)),i.indexOf(r)>=0)c=i.indexOf(r);else{const f=Math.min(s.slidesPerGroupSkip,l);c=f+Math.floor((l-f)/s.slidesPerGroup)}if(c>=i.length&&(c=i.length-1),l===n){c!==a&&(e.snapIndex=c,e.emit("snapIndexChange")),e.params.loop&&e.virtual&&e.params.virtual.enabled&&(e.realIndex=h(l));return}let p;e.virtual&&s.virtual.enabled&&s.loop?p=h(l):e.slides[l]?p=parseInt(e.slides[l].getAttribute("data-swiper-slide-index")||l,10):p=l,Object.assign(e,{previousSnapIndex:a,snapIndex:c,previousRealIndex:o,realIndex:p,previousIndex:n,activeIndex:l}),e.initialized&&YW(e),e.emit("activeIndexChange"),e.emit("snapIndexChange"),o!==p&&e.emit("realIndexChange"),(e.initialized||e.params.runCallbacksOnInit)&&e.emit("slideChange")}function ZOt(t){const e=this,r=e.params,i=t.closest(`.${r.slideClass}, swiper-slide`);let s=!1,n;if(i){for(let o=0;o<e.slides.length;o+=1)if(e.slides[o]===i){s=!0,n=o;break}}if(i&&s)e.clickedSlide=i,e.virtual&&e.params.virtual.enabled?e.clickedIndex=parseInt(i.getAttribute("data-swiper-slide-index"),10):e.clickedIndex=n;else{e.clickedSlide=void 0,e.clickedIndex=void 0;return}r.slideToClickedSlide&&e.clickedIndex!==void 0&&e.clickedIndex!==e.activeIndex&&e.slideToClickedSlide()}var YOt={updateSize:zOt,updateSlides:VOt,updateAutoHeight:BOt,updateSlidesOffset:GOt,updateSlidesProgress:jOt,updateProgress:HOt,updateSlidesClasses:qOt,updateActiveIndex:XOt,updateClickedSlide:ZOt};function JOt(t){t===void 0&&(t=this.isHorizontal()?"x":"y");const e=this,{params:r,rtlTranslate:i,translate:s,wrapperEl:n}=e;if(r.virtualTranslate)return i?-s:s;if(r.cssMode)return s;let o=AOt(n,t);return o+=e.cssOverflowAdjustment(),i&&(o=-o),o||0}function QOt(t,e){const r=this,{rtlTranslate:i,params:s,wrapperEl:n,progress:o}=r;let a=0,l=0;const c=0;r.isHorizontal()?a=i?-t:t:l=t,s.roundLengths&&(a=Math.floor(a),l=Math.floor(l)),r.previousTranslate=r.translate,r.translate=r.isHorizontal()?a:l,s.cssMode?n[r.isHorizontal()?"scrollLeft":"scrollTop"]=r.isHorizontal()?-a:-l:s.virtualTranslate||(r.isHorizontal()?a-=r.cssOverflowAdjustment():l-=r.cssOverflowAdjustment(),n.style.transform=`translate3d(${a}px, ${l}px, ${c}px)`);let h;const p=r.maxTranslate()-r.minTranslate();p===0?h=0:h=(t-r.minTranslate())/p,h!==o&&r.updateProgress(t),r.emit("setTranslate",r.translate,e)}function KOt(){return-this.snapGrid[0]}function eRt(){return-this.snapGrid[this.snapGrid.length-1]}function tRt(t,e,r,i,s){t===void 0&&(t=0),e===void 0&&(e=this.params.speed),r===void 0&&(r=!0),i===void 0&&(i=!0);const n=this,{params:o,wrapperEl:a}=n;if(n.animating&&o.preventInteractionOnTransition)return!1;const l=n.minTranslate(),c=n.maxTranslate();let h;if(i&&t>l?h=l:i&&t<c?h=c:h=t,n.updateProgress(h),o.cssMode){const p=n.isHorizontal();if(e===0)a[p?"scrollLeft":"scrollTop"]=-h;else{if(!n.support.smoothScroll)return ZPe({swiper:n,targetPosition:-h,side:p?"left":"top"}),!0;a.scrollTo({[p?"left":"top"]:-h,behavior:"smooth"})}return!0}return e===0?(n.setTransition(0),n.setTranslate(h),r&&(n.emit("beforeTransitionStart",e,s),n.emit("transitionEnd"))):(n.setTransition(e),n.setTranslate(h),r&&(n.emit("beforeTransitionStart",e,s),n.emit("transitionStart")),n.animating||(n.animating=!0,n.onTranslateToWrapperTransitionEnd||(n.onTranslateToWrapperTransitionEnd=function(f){!n||n.destroyed||f.target===this&&(n.wrapperEl.removeEventListener("transitionend",n.onTranslateToWrapperTransitionEnd),n.onTranslateToWrapperTransitionEnd=null,delete n.onTranslateToWrapperTransitionEnd,r&&n.emit("transitionEnd"))}),n.wrapperEl.addEventListener("transitionend",n.onTranslateToWrapperTransitionEnd))),!0}var rRt={getTranslate:JOt,setTranslate:QOt,minTranslate:KOt,maxTranslate:eRt,translateTo:tRt};function iRt(t,e){const r=this;r.params.cssMode||(r.wrapperEl.style.transitionDuration=`${t}ms`),r.emit("setTransition",t,e)}function QPe(t){let{swiper:e,runCallbacks:r,direction:i,step:s}=t;const{activeIndex:n,previousIndex:o}=e;let a=i;if(a||(n>o?a="next":n<o?a="prev":a="reset"),e.emit(`transition${s}`),r&&n!==o){if(a==="reset"){e.emit(`slideResetTransition${s}`);return}e.emit(`slideChangeTransition${s}`),a==="next"?e.emit(`slideNextTransition${s}`):e.emit(`slidePrevTransition${s}`)}}function sRt(t,e){t===void 0&&(t=!0);const r=this,{params:i}=r;i.cssMode||(i.autoHeight&&r.updateAutoHeight(),QPe({swiper:r,runCallbacks:t,direction:e,step:"Start"}))}function nRt(t,e){t===void 0&&(t=!0);const r=this,{params:i}=r;r.animating=!1,!i.cssMode&&(r.setTransition(0),QPe({swiper:r,runCallbacks:t,direction:e,step:"End"}))}var oRt={setTransition:iRt,transitionStart:sRt,transitionEnd:nRt};function aRt(t,e,r,i,s){t===void 0&&(t=0),e===void 0&&(e=this.params.speed),r===void 0&&(r=!0),typeof t=="string"&&(t=parseInt(t,10));const n=this;let o=t;o<0&&(o=0);const{params:a,snapGrid:l,slidesGrid:c,previousIndex:h,activeIndex:p,rtlTranslate:f,wrapperEl:m,enabled:y}=n;if(n.animating&&a.preventInteractionOnTransition||!y&&!i&&!s)return!1;const _=Math.min(n.params.slidesPerGroupSkip,o);let v=_+Math.floor((o-_)/n.params.slidesPerGroup);v>=l.length&&(v=l.length-1);const b=-l[v];if(a.normalizeSlideIndex)for(let x=0;x<c.length;x+=1){const S=-Math.floor(b*100),E=Math.floor(c[x]*100),A=Math.floor(c[x+1]*100);typeof c[x+1]<"u"?S>=E&&S<A-(A-E)/2?o=x:S>=E&&S<A&&(o=x+1):S>=E&&(o=x)}if(n.initialized&&o!==p&&(!n.allowSlideNext&&(f?b>n.translate&&b>n.minTranslate():b<n.translate&&b<n.minTranslate())||!n.allowSlidePrev&&b>n.translate&&b>n.maxTranslate()&&(p||0)!==o))return!1;o!==(h||0)&&r&&n.emit("beforeSlideChangeStart"),n.updateProgress(b);let T;if(o>p?T="next":o<p?T="prev":T="reset",f&&-b===n.translate||!f&&b===n.translate)return n.updateActiveIndex(o),a.autoHeight&&n.updateAutoHeight(),n.updateSlidesClasses(),a.effect!=="slide"&&n.setTranslate(b),T!=="reset"&&(n.transitionStart(r,T),n.transitionEnd(r,T)),!1;if(a.cssMode){const x=n.isHorizontal(),S=f?b:-b;if(e===0){const E=n.virtual&&n.params.virtual.enabled;E&&(n.wrapperEl.style.scrollSnapType="none",n._immediateVirtual=!0),E&&!n._cssModeVirtualInitialSet&&n.params.initialSlide>0?(n._cssModeVirtualInitialSet=!0,requestAnimationFrame(()=>{m[x?"scrollLeft":"scrollTop"]=S})):m[x?"scrollLeft":"scrollTop"]=S,E&&requestAnimationFrame(()=>{n.wrapperEl.style.scrollSnapType="",n._immediateVirtual=!1})}else{if(!n.support.smoothScroll)return ZPe({swiper:n,targetPosition:S,side:x?"left":"top"}),!0;m.scrollTo({[x?"left":"top"]:S,behavior:"smooth"})}return!0}return n.setTransition(e),n.setTranslate(b),n.updateActiveIndex(o),n.updateSlidesClasses(),n.emit("beforeTransitionStart",e,i),n.transitionStart(r,T),e===0?n.transitionEnd(r,T):n.animating||(n.animating=!0,n.onSlideToWrapperTransitionEnd||(n.onSlideToWrapperTransitionEnd=function(S){!n||n.destroyed||S.target===this&&(n.wrapperEl.removeEventListener("transitionend",n.onSlideToWrapperTransitionEnd),n.onSlideToWrapperTransitionEnd=null,delete n.onSlideToWrapperTransitionEnd,n.transitionEnd(r,T))}),n.wrapperEl.addEventListener("transitionend",n.onSlideToWrapperTransitionEnd)),!0}function lRt(t,e,r,i){t===void 0&&(t=0),e===void 0&&(e=this.params.speed),r===void 0&&(r=!0),typeof t=="string"&&(t=parseInt(t,10));const s=this;let n=t;return s.params.loop&&(s.virtual&&s.params.virtual.enabled?n=n+s.virtual.slidesBefore:n=s.getSlideIndexByData(n)),s.slideTo(n,e,r,i)}function cRt(t,e,r){t===void 0&&(t=this.params.speed),e===void 0&&(e=!0);const i=this,{enabled:s,params:n,animating:o}=i;if(!s)return i;let a=n.slidesPerGroup;n.slidesPerView==="auto"&&n.slidesPerGroup===1&&n.slidesPerGroupAuto&&(a=Math.max(i.slidesPerViewDynamic("current",!0),1));const l=i.activeIndex<n.slidesPerGroupSkip?1:a,c=i.virtual&&n.virtual.enabled;if(n.loop){if(o&&!c&&n.loopPreventsSliding)return!1;i.loopFix({direction:"next"}),i._clientLeft=i.wrapperEl.clientLeft}return n.rewind&&i.isEnd?i.slideTo(0,t,e,r):i.slideTo(i.activeIndex+l,t,e,r)}function uRt(t,e,r){t===void 0&&(t=this.params.speed),e===void 0&&(e=!0);const i=this,{params:s,snapGrid:n,slidesGrid:o,rtlTranslate:a,enabled:l,animating:c}=i;if(!l)return i;const h=i.virtual&&s.virtual.enabled;if(s.loop){if(c&&!h&&s.loopPreventsSliding)return!1;i.loopFix({direction:"prev"}),i._clientLeft=i.wrapperEl.clientLeft}const p=a?i.translate:-i.translate;function f(b){return b<0?-Math.floor(Math.abs(b)):Math.floor(b)}const m=f(p),y=n.map(b=>f(b));let _=n[y.indexOf(m)-1];if(typeof _>"u"&&s.cssMode){let b;n.forEach((T,x)=>{m>=T&&(b=x)}),typeof b<"u"&&(_=n[b>0?b-1:b])}let v=0;if(typeof _<"u"&&(v=o.indexOf(_),v<0&&(v=i.activeIndex-1),s.slidesPerView==="auto"&&s.slidesPerGroup===1&&s.slidesPerGroupAuto&&(v=v-i.slidesPerViewDynamic("previous",!0)+1,v=Math.max(v,0))),s.rewind&&i.isBeginning){const b=i.params.virtual&&i.params.virtual.enabled&&i.virtual?i.virtual.slides.length-1:i.slides.length-1;return i.slideTo(b,t,e,r)}return i.slideTo(v,t,e,r)}function hRt(t,e,r){t===void 0&&(t=this.params.speed),e===void 0&&(e=!0);const i=this;return i.slideTo(i.activeIndex,t,e,r)}function dRt(t,e,r,i){t===void 0&&(t=this.params.speed),e===void 0&&(e=!0),i===void 0&&(i=.5);const s=this;let n=s.activeIndex;const o=Math.min(s.params.slidesPerGroupSkip,n),a=o+Math.floor((n-o)/s.params.slidesPerGroup),l=s.rtlTranslate?s.translate:-s.translate;if(l>=s.snapGrid[a]){const c=s.snapGrid[a],h=s.snapGrid[a+1];l-c>(h-c)*i&&(n+=s.params.slidesPerGroup)}else{const c=s.snapGrid[a-1],h=s.snapGrid[a];l-c<=(h-c)*i&&(n-=s.params.slidesPerGroup)}return n=Math.max(n,0),n=Math.min(n,s.slidesGrid.length-1),s.slideTo(n,t,e,r)}function pRt(){const t=this,{params:e,slidesEl:r}=t,i=e.slidesPerView==="auto"?t.slidesPerViewDynamic():e.slidesPerView;let s=t.clickedIndex,n;const o=t.isElement?"swiper-slide":`.${e.slideClass}`;if(e.loop){if(t.animating)return;n=parseInt(t.clickedSlide.getAttribute("data-swiper-slide-index"),10),e.centeredSlides?s<t.loopedSlides-i/2||s>t.slides.length-t.loopedSlides+i/2?(t.loopFix(),s=t.getSlideIndex(Gf(r,`${o}[data-swiper-slide-index="${n}"]`)[0]),ZW(()=>{t.slideTo(s)})):t.slideTo(s):s>t.slides.length-i?(t.loopFix(),s=t.getSlideIndex(Gf(r,`${o}[data-swiper-slide-index="${n}"]`)[0]),ZW(()=>{t.slideTo(s)})):t.slideTo(s)}else t.slideTo(s)}var fRt={slideTo:aRt,slideToLoop:lRt,slideNext:cRt,slidePrev:uRt,slideReset:hRt,slideToClosest:dRt,slideToClickedSlide:pRt};function mRt(t){const e=this,{params:r,slidesEl:i}=e;if(!r.loop||e.virtual&&e.params.virtual.enabled)return;Gf(i,`.${r.slideClass}, swiper-slide`).forEach((n,o)=>{n.setAttribute("data-swiper-slide-index",o)}),e.loopFix({slideRealIndex:t,direction:r.centeredSlides?void 0:"next"})}function gRt(t){let{slideRealIndex:e,slideTo:r=!0,direction:i,setTranslate:s,activeSlideIndex:n,byController:o,byMousewheel:a}=t===void 0?{}:t;const l=this;if(!l.params.loop)return;l.emit("beforeLoopFix");const{slides:c,allowSlidePrev:h,allowSlideNext:p,slidesEl:f,params:m}=l;if(l.allowSlidePrev=!0,l.allowSlideNext=!0,l.virtual&&m.virtual.enabled){r&&(!m.centeredSlides&&l.snapIndex===0?l.slideTo(l.virtual.slides.length,0,!1,!0):m.centeredSlides&&l.snapIndex<m.slidesPerView?l.slideTo(l.virtual.slides.length+l.snapIndex,0,!1,!0):l.snapIndex===l.snapGrid.length-1&&l.slideTo(l.virtual.slidesBefore,0,!1,!0)),l.allowSlidePrev=h,l.allowSlideNext=p,l.emit("loopFix");return}const y=m.slidesPerView==="auto"?l.slidesPerViewDynamic():Math.ceil(parseFloat(m.slidesPerView,10));let _=m.loopedSlides||y;_%m.slidesPerGroup!==0&&(_+=m.slidesPerGroup-_%m.slidesPerGroup),l.loopedSlides=_;const v=[],b=[];let T=l.activeIndex;typeof n>"u"?n=l.getSlideIndex(l.slides.filter(R=>R.classList.contains(m.slideActiveClass))[0]):T=n;const x=i==="next"||!i,S=i==="prev"||!i;let E=0,A=0;if(n<_){E=Math.max(_-n,m.slidesPerGroup);for(let R=0;R<_-n;R+=1){const M=R-Math.floor(R/c.length)*c.length;v.push(c.length-M-1)}}else if(n>l.slides.length-_*2){A=Math.max(n-(l.slides.length-_*2),m.slidesPerGroup);for(let R=0;R<A;R+=1){const M=R-Math.floor(R/c.length)*c.length;b.push(M)}}if(S&&v.forEach(R=>{l.slides[R].swiperLoopMoveDOM=!0,f.prepend(l.slides[R]),l.slides[R].swiperLoopMoveDOM=!1}),x&&b.forEach(R=>{l.slides[R].swiperLoopMoveDOM=!0,f.append(l.slides[R]),l.slides[R].swiperLoopMoveDOM=!1}),l.recalcSlides(),m.slidesPerView==="auto"&&l.updateSlides(),m.watchSlidesProgress&&l.updateSlidesOffset(),r){if(v.length>0&&S)if(typeof e>"u"){const R=l.slidesGrid[T],D=l.slidesGrid[T+E]-R;a?l.setTranslate(l.translate-D):(l.slideTo(T+E,0,!1,!0),s&&(l.touches[l.isHorizontal()?"startX":"startY"]+=D))}else s&&l.slideToLoop(e,0,!1,!0);else if(b.length>0&&x)if(typeof e>"u"){const R=l.slidesGrid[T],D=l.slidesGrid[T-A]-R;a?l.setTranslate(l.translate-D):(l.slideTo(T-A,0,!1,!0),s&&(l.touches[l.isHorizontal()?"startX":"startY"]+=D))}else l.slideToLoop(e,0,!1,!0)}if(l.allowSlidePrev=h,l.allowSlideNext=p,l.controller&&l.controller.control&&!o){const R={slideRealIndex:e,slideTo:!1,direction:i,setTranslate:s,activeSlideIndex:n,byController:!0};Array.isArray(l.controller.control)?l.controller.control.forEach(M=>{!M.destroyed&&M.params.loop&&M.loopFix(R)}):l.controller.control instanceof l.constructor&&l.controller.control.params.loop&&l.controller.control.loopFix(R)}l.emit("loopFix")}function yRt(){const t=this,{params:e,slidesEl:r}=t;if(!e.loop||t.virtual&&t.params.virtual.enabled)return;t.recalcSlides();const i=[];t.slides.forEach(s=>{const n=typeof s.swiperSlideIndex>"u"?s.getAttribute("data-swiper-slide-index")*1:s.swiperSlideIndex;i[n]=s}),t.slides.forEach(s=>{s.removeAttribute("data-swiper-slide-index")}),i.forEach(s=>{r.append(s)}),t.recalcSlides(),t.slideTo(t.realIndex,0)}var _Rt={loopCreate:mRt,loopFix:gRt,loopDestroy:yRt};function vRt(t){const e=this;if(!e.params.simulateTouch||e.params.watchOverflow&&e.isLocked||e.params.cssMode)return;const r=e.params.touchEventsTarget==="container"?e.el:e.wrapperEl;e.isElement&&(e.__preventObserver__=!0),r.style.cursor="move",r.style.cursor=t?"grabbing":"grab",e.isElement&&requestAnimationFrame(()=>{e.__preventObserver__=!1})}function bRt(){const t=this;t.params.watchOverflow&&t.isLocked||t.params.cssMode||(t.isElement&&(t.__preventObserver__=!0),t[t.params.touchEventsTarget==="container"?"el":"wrapperEl"].style.cursor="",t.isElement&&requestAnimationFrame(()=>{t.__preventObserver__=!1}))}var wRt={setGrabCursor:vRt,unsetGrabCursor:bRt};function xRt(t,e){e===void 0&&(e=this);function r(i){if(!i||i===xx()||i===Lu())return null;i.assignedSlot&&(i=i.assignedSlot);const s=i.closest(t);return!s&&!i.getRootNode?null:s||r(i.getRootNode().host)}return r(e)}function TRt(t){const e=this,r=xx(),i=Lu(),s=e.touchEventsData;s.evCache.push(t);const{params:n,touches:o,enabled:a}=e;if(!a||!n.simulateTouch&&t.pointerType==="mouse"||e.animating&&n.preventInteractionOnTransition)return;!e.animating&&n.cssMode&&n.loop&&e.loopFix();let l=t;l.originalEvent&&(l=l.originalEvent);let c=l.target;if(n.touchEventsTarget==="wrapper"&&!e.wrapperEl.contains(c)||"which"in l&&l.which===3||"button"in l&&l.button>0||s.isTouched&&s.isMoved)return;const h=!!n.noSwipingClass&&n.noSwipingClass!=="",p=t.composedPath?t.composedPath():t.path;h&&l.target&&l.target.shadowRoot&&p&&(c=p[0]);const f=n.noSwipingSelector?n.noSwipingSelector:`.${n.noSwipingClass}`,m=!!(l.target&&l.target.shadowRoot);if(n.noSwiping&&(m?xRt(f,c):c.closest(f))){e.allowClick=!0;return}if(n.swipeHandler&&!c.closest(n.swipeHandler))return;o.currentX=l.pageX,o.currentY=l.pageY;const y=o.currentX,_=o.currentY,v=n.edgeSwipeDetection||n.iOSEdgeSwipeDetection,b=n.edgeSwipeThreshold||n.iOSEdgeSwipeThreshold;if(v&&(y<=b||y>=i.innerWidth-b))if(v==="prevent")t.preventDefault();else return;Object.assign(s,{isTouched:!0,isMoved:!1,allowTouchCallbacks:!0,isScrolling:void 0,startMoving:void 0}),o.startX=y,o.startY=_,s.touchStartTime=A5(),e.allowClick=!0,e.updateSize(),e.swipeDirection=void 0,n.threshold>0&&(s.allowThresholdMove=!1);let T=!0;c.matches(s.focusableElements)&&(T=!1,c.nodeName==="SELECT"&&(s.isTouched=!1)),r.activeElement&&r.activeElement.matches(s.focusableElements)&&r.activeElement!==c&&r.activeElement.blur();const x=T&&e.allowTouchMove&&n.touchStartPreventDefault;(n.touchStartForcePreventDefault||x)&&!c.isContentEditable&&l.preventDefault(),n.freeMode&&n.freeMode.enabled&&e.freeMode&&e.animating&&!n.cssMode&&e.freeMode.onTouchStart(),e.emit("touchStart",l)}function SRt(t){const e=xx(),r=this,i=r.touchEventsData,{params:s,touches:n,rtlTranslate:o,enabled:a}=r;if(!a||!s.simulateTouch&&t.pointerType==="mouse")return;let l=t;if(l.originalEvent&&(l=l.originalEvent),!i.isTouched){i.startMoving&&i.isScrolling&&r.emit("touchMoveOpposite",l);return}const c=i.evCache.findIndex(A=>A.pointerId===l.pointerId);c>=0&&(i.evCache[c]=l);const h=i.evCache.length>1?i.evCache[0]:l,p=h.pageX,f=h.pageY;if(l.preventedByNestedSwiper){n.startX=p,n.startY=f;return}if(!r.allowTouchMove){l.target.matches(i.focusableElements)||(r.allowClick=!1),i.isTouched&&(Object.assign(n,{startX:p,startY:f,prevX:r.touches.currentX,prevY:r.touches.currentY,currentX:p,currentY:f}),i.touchStartTime=A5());return}if(s.touchReleaseOnEdges&&!s.loop){if(r.isVertical()){if(f<n.startY&&r.translate<=r.maxTranslate()||f>n.startY&&r.translate>=r.minTranslate()){i.isTouched=!1,i.isMoved=!1;return}}else if(p<n.startX&&r.translate<=r.maxTranslate()||p>n.startX&&r.translate>=r.minTranslate())return}if(e.activeElement&&l.target===e.activeElement&&l.target.matches(i.focusableElements)){i.isMoved=!0,r.allowClick=!1;return}if(i.allowTouchCallbacks&&r.emit("touchMove",l),l.targetTouches&&l.targetTouches.length>1)return;n.currentX=p,n.currentY=f;const m=n.currentX-n.startX,y=n.currentY-n.startY;if(r.params.threshold&&Math.sqrt(m**2+y**2)<r.params.threshold)return;if(typeof i.isScrolling>"u"){let A;r.isHorizontal()&&n.currentY===n.startY||r.isVertical()&&n.currentX===n.startX?i.isScrolling=!1:m*m+y*y>=25&&(A=Math.atan2(Math.abs(y),Math.abs(m))*180/Math.PI,i.isScrolling=r.isHorizontal()?A>s.touchAngle:90-A>s.touchAngle)}if(i.isScrolling&&r.emit("touchMoveOpposite",l),typeof i.startMoving>"u"&&(n.currentX!==n.startX||n.currentY!==n.startY)&&(i.startMoving=!0),i.isScrolling||r.zoom&&r.params.zoom&&r.params.zoom.enabled&&i.evCache.length>1){i.isTouched=!1;return}if(!i.startMoving)return;r.allowClick=!1,!s.cssMode&&l.cancelable&&l.preventDefault(),s.touchMoveStopPropagation&&!s.nested&&l.stopPropagation();let _=r.isHorizontal()?m:y,v=r.isHorizontal()?n.currentX-n.previousX:n.currentY-n.previousY;s.oneWayMovement&&(_=Math.abs(_)*(o?1:-1),v=Math.abs(v)*(o?1:-1)),n.diff=_,_*=s.touchRatio,o&&(_=-_,v=-v);const b=r.touchesDirection;r.swipeDirection=_>0?"prev":"next",r.touchesDirection=v>0?"prev":"next";const T=r.params.loop&&!s.cssMode;if(!i.isMoved){if(T&&r.loopFix({direction:r.swipeDirection}),i.startTranslate=r.getTranslate(),r.setTransition(0),r.animating){const A=new window.CustomEvent("transitionend",{bubbles:!0,cancelable:!0});r.wrapperEl.dispatchEvent(A)}i.allowMomentumBounce=!1,s.grabCursor&&(r.allowSlideNext===!0||r.allowSlidePrev===!0)&&r.setGrabCursor(!0),r.emit("sliderFirstMove",l)}let x;i.isMoved&&b!==r.touchesDirection&&T&&Math.abs(_)>=1&&(r.loopFix({direction:r.swipeDirection,setTranslate:!0}),x=!0),r.emit("sliderMove",l),i.isMoved=!0,i.currentTranslate=_+i.startTranslate;let S=!0,E=s.resistanceRatio;if(s.touchReleaseOnEdges&&(E=0),_>0?(T&&!x&&i.currentTranslate>(s.centeredSlides?r.minTranslate()-r.size/2:r.minTranslate())&&r.loopFix({direction:"prev",setTranslate:!0,activeSlideIndex:0}),i.currentTranslate>r.minTranslate()&&(S=!1,s.resistance&&(i.currentTranslate=r.minTranslate()-1+(-r.minTranslate()+i.startTranslate+_)**E))):_<0&&(T&&!x&&i.currentTranslate<(s.centeredSlides?r.maxTranslate()+r.size/2:r.maxTranslate())&&r.loopFix({direction:"next",setTranslate:!0,activeSlideIndex:r.slides.length-(s.slidesPerView==="auto"?r.slidesPerViewDynamic():Math.ceil(parseFloat(s.slidesPerView,10)))}),i.currentTranslate<r.maxTranslate()&&(S=!1,s.resistance&&(i.currentTranslate=r.maxTranslate()+1-(r.maxTranslate()-i.startTranslate-_)**E))),S&&(l.preventedByNestedSwiper=!0),!r.allowSlideNext&&r.swipeDirection==="next"&&i.currentTranslate<i.startTranslate&&(i.currentTranslate=i.startTranslate),!r.allowSlidePrev&&r.swipeDirection==="prev"&&i.currentTranslate>i.startTranslate&&(i.currentTranslate=i.startTranslate),!r.allowSlidePrev&&!r.allowSlideNext&&(i.currentTranslate=i.startTranslate),s.threshold>0)if(Math.abs(_)>s.threshold||i.allowThresholdMove){if(!i.allowThresholdMove){i.allowThresholdMove=!0,n.startX=n.currentX,n.startY=n.currentY,i.currentTranslate=i.startTranslate,n.diff=r.isHorizontal()?n.currentX-n.startX:n.currentY-n.startY;return}}else{i.currentTranslate=i.startTranslate;return}!s.followFinger||s.cssMode||((s.freeMode&&s.freeMode.enabled&&r.freeMode||s.watchSlidesProgress)&&(r.updateActiveIndex(),r.updateSlidesClasses()),s.freeMode&&s.freeMode.enabled&&r.freeMode&&r.freeMode.onTouchMove(),r.updateProgress(i.currentTranslate),r.setTranslate(i.currentTranslate))}function ERt(t){const e=this,r=e.touchEventsData,i=r.evCache.findIndex(x=>x.pointerId===t.pointerId);if(i>=0&&r.evCache.splice(i,1),["pointercancel","pointerout","pointerleave"].includes(t.type)&&!(t.type==="pointercancel"&&(e.browser.isSafari||e.browser.isWebView)))return;const{params:s,touches:n,rtlTranslate:o,slidesGrid:a,enabled:l}=e;if(!l||!s.simulateTouch&&t.pointerType==="mouse")return;let c=t;if(c.originalEvent&&(c=c.originalEvent),r.allowTouchCallbacks&&e.emit("touchEnd",c),r.allowTouchCallbacks=!1,!r.isTouched){r.isMoved&&s.grabCursor&&e.setGrabCursor(!1),r.isMoved=!1,r.startMoving=!1;return}s.grabCursor&&r.isMoved&&r.isTouched&&(e.allowSlideNext===!0||e.allowSlidePrev===!0)&&e.setGrabCursor(!1);const h=A5(),p=h-r.touchStartTime;if(e.allowClick){const x=c.path||c.composedPath&&c.composedPath();e.updateClickedSlide(x&&x[0]||c.target),e.emit("tap click",c),p<300&&h-r.lastClickTime<300&&e.emit("doubleTap doubleClick",c)}if(r.lastClickTime=A5(),ZW(()=>{e.destroyed||(e.allowClick=!0)}),!r.isTouched||!r.isMoved||!e.swipeDirection||n.diff===0||r.currentTranslate===r.startTranslate){r.isTouched=!1,r.isMoved=!1,r.startMoving=!1;return}r.isTouched=!1,r.isMoved=!1,r.startMoving=!1;let f;if(s.followFinger?f=o?e.translate:-e.translate:f=-r.currentTranslate,s.cssMode)return;if(s.freeMode&&s.freeMode.enabled){e.freeMode.onTouchEnd({currentPos:f});return}let m=0,y=e.slidesSizesGrid[0];for(let x=0;x<a.length;x+=x<s.slidesPerGroupSkip?1:s.slidesPerGroup){const S=x<s.slidesPerGroupSkip-1?1:s.slidesPerGroup;typeof a[x+S]<"u"?f>=a[x]&&f<a[x+S]&&(m=x,y=a[x+S]-a[x]):f>=a[x]&&(m=x,y=a[a.length-1]-a[a.length-2])}let _=null,v=null;s.rewind&&(e.isBeginning?v=s.virtual&&s.virtual.enabled&&e.virtual?e.virtual.slides.length-1:e.slides.length-1:e.isEnd&&(_=0));const b=(f-a[m])/y,T=m<s.slidesPerGroupSkip-1?1:s.slidesPerGroup;if(p>s.longSwipesMs){if(!s.longSwipes){e.slideTo(e.activeIndex);return}e.swipeDirection==="next"&&(b>=s.longSwipesRatio?e.slideTo(s.rewind&&e.isEnd?_:m+T):e.slideTo(m)),e.swipeDirection==="prev"&&(b>1-s.longSwipesRatio?e.slideTo(m+T):v!==null&&b<0&&Math.abs(b)>s.longSwipesRatio?e.slideTo(v):e.slideTo(m))}else{if(!s.shortSwipes){e.slideTo(e.activeIndex);return}e.navigation&&(c.target===e.navigation.nextEl||c.target===e.navigation.prevEl)?c.target===e.navigation.nextEl?e.slideTo(m+T):e.slideTo(m):(e.swipeDirection==="next"&&e.slideTo(_!==null?_:m+T),e.swipeDirection==="prev"&&e.slideTo(v!==null?v:m))}}function Zpe(){const t=this,{params:e,el:r}=t;if(r&&r.offsetWidth===0)return;e.breakpoints&&t.setBreakpoint();const{allowSlideNext:i,allowSlidePrev:s,snapGrid:n}=t,o=t.virtual&&t.params.virtual.enabled;t.allowSlideNext=!0,t.allowSlidePrev=!0,t.updateSize(),t.updateSlides(),t.updateSlidesClasses();const a=o&&e.loop;(e.slidesPerView==="auto"||e.slidesPerView>1)&&t.isEnd&&!t.isBeginning&&!t.params.centeredSlides&&!a?t.slideTo(t.slides.length-1,0,!1,!0):t.params.loop&&!o?t.slideToLoop(t.realIndex,0,!1,!0):t.slideTo(t.activeIndex,0,!1,!0),t.autoplay&&t.autoplay.running&&t.autoplay.paused&&(clearTimeout(t.autoplay.resizeTimeout),t.autoplay.resizeTimeout=setTimeout(()=>{t.autoplay&&t.autoplay.running&&t.autoplay.paused&&t.autoplay.resume()},500)),t.allowSlidePrev=s,t.allowSlideNext=i,t.params.watchOverflow&&n!==t.snapGrid&&t.checkOverflow()}function CRt(t){const e=this;e.enabled&&(e.allowClick||(e.params.preventClicks&&t.preventDefault(),e.params.preventClicksPropagation&&e.animating&&(t.stopPropagation(),t.stopImmediatePropagation())))}function ARt(){const t=this,{wrapperEl:e,rtlTranslate:r,enabled:i}=t;if(!i)return;t.previousTranslate=t.translate,t.isHorizontal()?t.translate=-e.scrollLeft:t.translate=-e.scrollTop,t.translate===0&&(t.translate=0),t.updateActiveIndex(),t.updateSlidesClasses();let s;const n=t.maxTranslate()-t.minTranslate();n===0?s=0:s=(t.translate-t.minTranslate())/n,s!==t.progress&&t.updateProgress(r?-t.translate:t.translate),t.emit("setTranslate",t.translate,!1)}function ORt(t){const e=this;zN(e,t.target),!(e.params.cssMode||e.params.slidesPerView!=="auto"&&!e.params.autoHeight)&&e.update()}let Ype=!1;function RRt(){}const KPe=(t,e)=>{const r=xx(),{params:i,el:s,wrapperEl:n,device:o}=t,a=!!i.nested,l=e==="on"?"addEventListener":"removeEventListener",c=e;s[l]("pointerdown",t.onTouchStart,{passive:!1}),r[l]("pointermove",t.onTouchMove,{passive:!1,capture:a}),r[l]("pointerup",t.onTouchEnd,{passive:!0}),r[l]("pointercancel",t.onTouchEnd,{passive:!0}),r[l]("pointerout",t.onTouchEnd,{passive:!0}),r[l]("pointerleave",t.onTouchEnd,{passive:!0}),(i.preventClicks||i.preventClicksPropagation)&&s[l]("click",t.onClick,!0),i.cssMode&&n[l]("scroll",t.onScroll),i.updateOnWindowResize?t[c](o.ios||o.android?"resize orientationchange observerUpdate":"resize observerUpdate",Zpe,!0):t[c]("observerUpdate",Zpe,!0),s[l]("load",t.onLoad,{capture:!0})};function MRt(){const t=this,e=xx(),{params:r}=t;t.onTouchStart=TRt.bind(t),t.onTouchMove=SRt.bind(t),t.onTouchEnd=ERt.bind(t),r.cssMode&&(t.onScroll=ARt.bind(t)),t.onClick=CRt.bind(t),t.onLoad=ORt.bind(t),Ype||(e.addEventListener("touchstart",RRt),Ype=!0),KPe(t,"on")}function PRt(){KPe(this,"off")}var IRt={attachEvents:MRt,detachEvents:PRt};const Jpe=(t,e)=>t.grid&&e.grid&&e.grid.rows>1;function $Rt(){const t=this,{realIndex:e,initialized:r,params:i,el:s}=t,n=i.breakpoints;if(!n||n&&Object.keys(n).length===0)return;const o=t.getBreakpoint(n,t.params.breakpointsBase,t.el);if(!o||t.currentBreakpoint===o)return;const l=(o in n?n[o]:void 0)||t.originalParams,c=Jpe(t,i),h=Jpe(t,l),p=i.enabled;c&&!h?(s.classList.remove(`${i.containerModifierClass}grid`,`${i.containerModifierClass}grid-column`),t.emitContainerClasses()):!c&&h&&(s.classList.add(`${i.containerModifierClass}grid`),(l.grid.fill&&l.grid.fill==="column"||!l.grid.fill&&i.grid.fill==="column")&&s.classList.add(`${i.containerModifierClass}grid-column`),t.emitContainerClasses()),["navigation","pagination","scrollbar"].forEach(_=>{if(typeof l[_]>"u")return;const v=i[_]&&i[_].enabled,b=l[_]&&l[_].enabled;v&&!b&&t[_].disable(),!v&&b&&t[_].enable()});const f=l.direction&&l.direction!==i.direction,m=i.loop&&(l.slidesPerView!==i.slidesPerView||f);f&&r&&t.changeDirection(),cu(t.params,l);const y=t.params.enabled;Object.assign(t,{allowTouchMove:t.params.allowTouchMove,allowSlideNext:t.params.allowSlideNext,allowSlidePrev:t.params.allowSlidePrev}),p&&!y?t.disable():!p&&y&&t.enable(),t.currentBreakpoint=o,t.emit("_beforeBreakpoint",l),m&&r&&(t.loopDestroy(),t.loopCreate(e),t.updateSlides()),t.emit("breakpoint",l)}function LRt(t,e,r){if(e===void 0&&(e="window"),!t||e==="container"&&!r)return;let i=!1;const s=Lu(),n=e==="window"?s.innerHeight:r.clientHeight,o=Object.keys(t).map(a=>{if(typeof a=="string"&&a.indexOf("@")===0){const l=parseFloat(a.substr(1));return{value:n*l,point:a}}return{value:a,point:a}});o.sort((a,l)=>parseInt(a.value,10)-parseInt(l.value,10));for(let a=0;a<o.length;a+=1){const{point:l,value:c}=o[a];e==="window"?s.matchMedia(`(min-width: ${c}px)`).matches&&(i=l):c<=r.clientWidth&&(i=l)}return i||"max"}var DRt={setBreakpoint:$Rt,getBreakpoint:LRt};function NRt(t,e){const r=[];return t.forEach(i=>{typeof i=="object"?Object.keys(i).forEach(s=>{i[s]&&r.push(e+s)}):typeof i=="string"&&r.push(e+i)}),r}function FRt(){const t=this,{classNames:e,params:r,rtl:i,el:s,device:n}=t,o=NRt(["initialized",r.direction,{"free-mode":t.params.freeMode&&r.freeMode.enabled},{autoheight:r.autoHeight},{rtl:i},{grid:r.grid&&r.grid.rows>1},{"grid-column":r.grid&&r.grid.rows>1&&r.grid.fill==="column"},{android:n.android},{ios:n.ios},{"css-mode":r.cssMode},{centered:r.cssMode&&r.centeredSlides},{"watch-progress":r.watchSlidesProgress}],r.containerModifierClass);e.push(...o),s.classList.add(...e),t.emitContainerClasses()}function URt(){const t=this,{el:e,classNames:r}=t;e.classList.remove(...r),t.emitContainerClasses()}var kRt={addClasses:FRt,removeClasses:URt};function zRt(){const t=this,{isLocked:e,params:r}=t,{slidesOffsetBefore:i}=r;if(i){const s=t.slides.length-1,n=t.slidesGrid[s]+t.slidesSizesGrid[s]+i*2;t.isLocked=t.size>n}else t.isLocked=t.snapGrid.length===1;r.allowSlideNext===!0&&(t.allowSlideNext=!t.isLocked),r.allowSlidePrev===!0&&(t.allowSlidePrev=!t.isLocked),e&&e!==t.isLocked&&(t.isEnd=!1),e!==t.isLocked&&t.emit(t.isLocked?"lock":"unlock")}var VRt={checkOverflow:zRt},Qpe={init:!0,direction:"horizontal",oneWayMovement:!1,touchEventsTarget:"wrapper",initialSlide:0,speed:300,cssMode:!1,updateOnWindowResize:!0,resizeObserver:!0,nested:!1,createElements:!1,enabled:!0,focusableElements:"input, select, option, textarea, button, video, label",width:null,height:null,preventInteractionOnTransition:!1,userAgent:null,url:null,edgeSwipeDetection:!1,edgeSwipeThreshold:20,autoHeight:!1,setWrapperSize:!1,virtualTranslate:!1,effect:"slide",breakpoints:void 0,breakpointsBase:"window",spaceBetween:0,slidesPerView:1,slidesPerGroup:1,slidesPerGroupSkip:0,slidesPerGroupAuto:!1,centeredSlides:!1,centeredSlidesBounds:!1,slidesOffsetBefore:0,slidesOffsetAfter:0,normalizeSlideIndex:!0,centerInsufficientSlides:!1,watchOverflow:!0,roundLengths:!1,touchRatio:1,touchAngle:45,simulateTouch:!0,shortSwipes:!0,longSwipes:!0,longSwipesRatio:.5,longSwipesMs:300,followFinger:!0,allowTouchMove:!0,threshold:5,touchMoveStopPropagation:!1,touchStartPreventDefault:!0,touchStartForcePreventDefault:!1,touchReleaseOnEdges:!1,uniqueNavElements:!0,resistance:!0,resistanceRatio:.85,watchSlidesProgress:!1,grabCursor:!1,preventClicks:!0,preventClicksPropagation:!0,slideToClickedSlide:!1,loop:!1,loopedSlides:null,loopPreventsSliding:!0,rewind:!1,allowSlidePrev:!0,allowSlideNext:!0,swipeHandler:null,noSwiping:!0,noSwipingClass:"swiper-no-swiping",noSwipingSelector:null,passiveListeners:!0,maxBackfaceHiddenSlides:10,containerModifierClass:"swiper-",slideClass:"swiper-slide",slideActiveClass:"swiper-slide-active",slideVisibleClass:"swiper-slide-visible",slideNextClass:"swiper-slide-next",slidePrevClass:"swiper-slide-prev",wrapperClass:"swiper-wrapper",lazyPreloaderClass:"swiper-lazy-preloader",lazyPreloadPrevNext:0,runCallbacksOnInit:!0,_emitClasses:!1};function BRt(t,e){return function(i){i===void 0&&(i={});const s=Object.keys(i)[0],n=i[s];if(typeof n!="object"||n===null){cu(e,i);return}if(["navigation","pagination","scrollbar"].indexOf(s)>=0&&t[s]===!0&&(t[s]={auto:!0}),!(s in t&&"enabled"in n)){cu(e,i);return}t[s]===!0&&(t[s]={enabled:!0}),typeof t[s]=="object"&&!("enabled"in t[s])&&(t[s].enabled=!0),t[s]||(t[s]={enabled:!1}),cu(e,i)}}const vV={eventsEmitter:kOt,update:YOt,translate:rRt,transition:oRt,slide:fRt,loop:_Rt,grabCursor:wRt,events:IRt,breakpoints:DRt,checkOverflow:VRt,classes:kRt},bV={};class mh{constructor(){let e,r;for(var i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];s.length===1&&s[0].constructor&&Object.prototype.toString.call(s[0]).slice(8,-1)==="Object"?r=s[0]:[e,r]=s,r||(r={}),r=cu({},r),e&&!r.el&&(r.el=e);const o=xx();if(r.el&&typeof r.el=="string"&&o.querySelectorAll(r.el).length>1){const h=[];return o.querySelectorAll(r.el).forEach(p=>{const f=cu({},r,{el:p});h.push(new mh(f))}),h}const a=this;a.__swiper__=!0,a.support=JPe(),a.device=LOt({userAgent:r.userAgent}),a.browser=NOt(),a.eventsListeners={},a.eventsAnyListeners=[],a.modules=[...a.__modules__],r.modules&&Array.isArray(r.modules)&&a.modules.push(...r.modules);const l={};a.modules.forEach(h=>{h({params:r,swiper:a,extendParams:BRt(r,l),on:a.on.bind(a),once:a.once.bind(a),off:a.off.bind(a),emit:a.emit.bind(a)})});const c=cu({},Qpe,l);return a.params=cu({},c,bV,r),a.originalParams=cu({},a.params),a.passedParams=cu({},r),a.params&&a.params.on&&Object.keys(a.params.on).forEach(h=>{a.on(h,a.params.on[h])}),a.params&&a.params.onAny&&a.onAny(a.params.onAny),Object.assign(a,{enabled:a.params.enabled,el:e,classNames:[],slides:[],slidesGrid:[],snapGrid:[],slidesSizesGrid:[],isHorizontal(){return a.params.direction==="horizontal"},isVertical(){return a.params.direction==="vertical"},activeIndex:0,realIndex:0,isBeginning:!0,isEnd:!1,translate:0,previousTranslate:0,progress:0,velocity:0,animating:!1,cssOverflowAdjustment(){return Math.trunc(this.translate/2**23)*2**23},allowSlideNext:a.params.allowSlideNext,allowSlidePrev:a.params.allowSlidePrev,touchEventsData:{isTouched:void 0,isMoved:void 0,allowTouchCallbacks:void 0,touchStartTime:void 0,isScrolling:void 0,currentTranslate:void 0,startTranslate:void 0,allowThresholdMove:void 0,focusableElements:a.params.focusableElements,lastClickTime:0,clickTimeout:void 0,velocities:[],allowMomentumBounce:void 0,startMoving:void 0,evCache:[]},allowClick:!0,allowTouchMove:a.params.allowTouchMove,touches:{startX:0,startY:0,currentX:0,currentY:0,diff:0},imagesToLoad:[],imagesLoaded:0}),a.emit("_swiper"),a.params.init&&a.init(),a}getSlideIndex(e){const{slidesEl:r,params:i}=this,s=Gf(r,`.${i.slideClass}, swiper-slide`),n=Wpe(s[0]);return Wpe(e)-n}getSlideIndexByData(e){return this.getSlideIndex(this.slides.filter(r=>r.getAttribute("data-swiper-slide-index")*1===e)[0])}recalcSlides(){const e=this,{slidesEl:r,params:i}=e;e.slides=Gf(r,`.${i.slideClass}, swiper-slide`)}enable(){const e=this;e.enabled||(e.enabled=!0,e.params.grabCursor&&e.setGrabCursor(),e.emit("enable"))}disable(){const e=this;e.enabled&&(e.enabled=!1,e.params.grabCursor&&e.unsetGrabCursor(),e.emit("disable"))}setProgress(e,r){const i=this;e=Math.min(Math.max(e,0),1);const s=i.minTranslate(),o=(i.maxTranslate()-s)*e+s;i.translateTo(o,typeof r>"u"?0:r),i.updateActiveIndex(),i.updateSlidesClasses()}emitContainerClasses(){const e=this;if(!e.params._emitClasses||!e.el)return;const r=e.el.className.split(" ").filter(i=>i.indexOf("swiper")===0||i.indexOf(e.params.containerModifierClass)===0);e.emit("_containerClasses",r.join(" "))}getSlideClasses(e){const r=this;return r.destroyed?"":e.className.split(" ").filter(i=>i.indexOf("swiper-slide")===0||i.indexOf(r.params.slideClass)===0).join(" ")}emitSlidesClasses(){const e=this;if(!e.params._emitClasses||!e.el)return;const r=[];e.slides.forEach(i=>{const s=e.getSlideClasses(i);r.push({slideEl:i,classNames:s}),e.emit("_slideClass",i,s)}),e.emit("_slideClasses",r)}slidesPerViewDynamic(e,r){e===void 0&&(e="current"),r===void 0&&(r=!1);const i=this,{params:s,slides:n,slidesGrid:o,slidesSizesGrid:a,size:l,activeIndex:c}=i;let h=1;if(s.centeredSlides){let p=n[c]?n[c].swiperSlideSize:0,f;for(let m=c+1;m<n.length;m+=1)n[m]&&!f&&(p+=n[m].swiperSlideSize,h+=1,p>l&&(f=!0));for(let m=c-1;m>=0;m-=1)n[m]&&!f&&(p+=n[m].swiperSlideSize,h+=1,p>l&&(f=!0))}else if(e==="current")for(let p=c+1;p<n.length;p+=1)(r?o[p]+a[p]-o[c]<l:o[p]-o[c]<l)&&(h+=1);else for(let p=c-1;p>=0;p-=1)o[c]-o[p]<l&&(h+=1);return h}update(){const e=this;if(!e||e.destroyed)return;const{snapGrid:r,params:i}=e;i.breakpoints&&e.setBreakpoint(),[...e.el.querySelectorAll('[loading="lazy"]')].forEach(o=>{o.complete&&zN(e,o)}),e.updateSize(),e.updateSlides(),e.updateProgress(),e.updateSlidesClasses();function s(){const o=e.rtlTranslate?e.translate*-1:e.translate,a=Math.min(Math.max(o,e.maxTranslate()),e.minTranslate());e.setTranslate(a),e.updateActiveIndex(),e.updateSlidesClasses()}let n;if(i.freeMode&&i.freeMode.enabled&&!i.cssMode)s(),i.autoHeight&&e.updateAutoHeight();else{if((i.slidesPerView==="auto"||i.slidesPerView>1)&&e.isEnd&&!i.centeredSlides){const o=e.virtual&&i.virtual.enabled?e.virtual.slides:e.slides;n=e.slideTo(o.length-1,0,!1,!0)}else n=e.slideTo(e.activeIndex,0,!1,!0);n||s()}i.watchOverflow&&r!==e.snapGrid&&e.checkOverflow(),e.emit("update")}changeDirection(e,r){r===void 0&&(r=!0);const i=this,s=i.params.direction;return e||(e=s==="horizontal"?"vertical":"horizontal"),e===s||e!=="horizontal"&&e!=="vertical"||(i.el.classList.remove(`${i.params.containerModifierClass}${s}`),i.el.classList.add(`${i.params.containerModifierClass}${e}`),i.emitContainerClasses(),i.params.direction=e,i.slides.forEach(n=>{e==="vertical"?n.style.width="":n.style.height=""}),i.emit("changeDirection"),r&&i.update()),i}changeLanguageDirection(e){const r=this;r.rtl&&e==="rtl"||!r.rtl&&e==="ltr"||(r.rtl=e==="rtl",r.rtlTranslate=r.params.direction==="horizontal"&&r.rtl,r.rtl?(r.el.classList.add(`${r.params.containerModifierClass}rtl`),r.el.dir="rtl"):(r.el.classList.remove(`${r.params.containerModifierClass}rtl`),r.el.dir="ltr"),r.update())}mount(e){const r=this;if(r.mounted)return!0;let i=e||r.params.el;if(typeof i=="string"&&(i=document.querySelector(i)),!i)return!1;i.swiper=r,i.parentNode&&i.parentNode.host&&(r.isElement=!0);const s=()=>`.${(r.params.wrapperClass||"").trim().split(" ").join(".")}`;let o=(()=>i&&i.shadowRoot&&i.shadowRoot.querySelector?i.shadowRoot.querySelector(s()):Gf(i,s())[0])();return!o&&r.params.createElements&&(o=YPe("div",r.params.wrapperClass),i.append(o),Gf(i,`.${r.params.slideClass}`).forEach(a=>{o.append(a)})),Object.assign(r,{el:i,wrapperEl:o,slidesEl:r.isElement?i.parentNode.host:o,hostEl:r.isElement?i.parentNode.host:i,mounted:!0,rtl:i.dir.toLowerCase()==="rtl"||k_(i,"direction")==="rtl",rtlTranslate:r.params.direction==="horizontal"&&(i.dir.toLowerCase()==="rtl"||k_(i,"direction")==="rtl"),wrongRTL:k_(o,"display")==="-webkit-box"}),!0}init(e){const r=this;return r.initialized||r.mount(e)===!1||(r.emit("beforeInit"),r.params.breakpoints&&r.setBreakpoint(),r.addClasses(),r.updateSize(),r.updateSlides(),r.params.watchOverflow&&r.checkOverflow(),r.params.grabCursor&&r.enabled&&r.setGrabCursor(),r.params.loop&&r.virtual&&r.params.virtual.enabled?r.slideTo(r.params.initialSlide+r.virtual.slidesBefore,0,r.params.runCallbacksOnInit,!1,!0):r.slideTo(r.params.initialSlide,0,r.params.runCallbacksOnInit,!1,!0),r.params.loop&&r.loopCreate(),r.attachEvents(),[...r.el.querySelectorAll('[loading="lazy"]')].forEach(s=>{s.complete?zN(r,s):s.addEventListener("load",n=>{zN(r,n.target)})}),YW(r),r.initialized=!0,YW(r),r.emit("init"),r.emit("afterInit")),r}destroy(e,r){e===void 0&&(e=!0),r===void 0&&(r=!0);const i=this,{params:s,el:n,wrapperEl:o,slides:a}=i;return typeof i.params>"u"||i.destroyed||(i.emit("beforeDestroy"),i.initialized=!1,i.detachEvents(),s.loop&&i.loopDestroy(),r&&(i.removeClasses(),n.removeAttribute("style"),o.removeAttribute("style"),a&&a.length&&a.forEach(l=>{l.classList.remove(s.slideVisibleClass,s.slideActiveClass,s.slideNextClass,s.slidePrevClass),l.removeAttribute("style"),l.removeAttribute("data-swiper-slide-index")})),i.emit("destroy"),Object.keys(i.eventsListeners).forEach(l=>{i.off(l)}),e!==!1&&(i.el.swiper=null,EOt(i)),i.destroyed=!0),null}static extendDefaults(e){cu(bV,e)}static get extendedDefaults(){return bV}static get defaults(){return Qpe}static installModule(e){mh.prototype.__modules__||(mh.prototype.__modules__=[]);const r=mh.prototype.__modules__;typeof e=="function"&&r.indexOf(e)<0&&r.push(e)}static use(e){return Array.isArray(e)?(e.forEach(r=>mh.installModule(r)),mh):(mh.installModule(e),mh)}}Object.keys(vV).forEach(t=>{Object.keys(vV[t]).forEach(e=>{mh.prototype[e]=vV[t][e]})});mh.use([FOt,UOt]);function GRt(t,e,r,i){return t.params.createElements&&Object.keys(i).forEach(s=>{if(!r[s]&&r.auto===!0){let n=Gf(t.el,`.${i[s]}`)[0];n||(n=YPe("div",i[s]),n.className=i[s],t.el.append(n)),r[s]=n,e[s]=n}}),r}function jRt(t){let{swiper:e,extendParams:r,on:i,emit:s}=t;r({navigation:{nextEl:null,prevEl:null,hideOnClick:!1,disabledClass:"swiper-button-disabled",hiddenClass:"swiper-button-hidden",lockClass:"swiper-button-lock",navigationDisabledClass:"swiper-navigation-disabled"}}),e.navigation={nextEl:null,prevEl:null};const n=_=>(Array.isArray(_)||(_=[_].filter(v=>!!v)),_);function o(_){let v;return _&&typeof _=="string"&&e.isElement&&(v=e.el.querySelector(_),v)?v:(_&&(typeof _=="string"&&(v=[...document.querySelectorAll(_)]),e.params.uniqueNavElements&&typeof _=="string"&&v.length>1&&e.el.querySelectorAll(_).length===1&&(v=e.el.querySelector(_))),_&&!v?_:v)}function a(_,v){const b=e.params.navigation;_=n(_),_.forEach(T=>{T&&(T.classList[v?"add":"remove"](...b.disabledClass.split(" ")),T.tagName==="BUTTON"&&(T.disabled=v),e.params.watchOverflow&&e.enabled&&T.classList[e.isLocked?"add":"remove"](b.lockClass))})}function l(){const{nextEl:_,prevEl:v}=e.navigation;if(e.params.loop){a(v,!1),a(_,!1);return}a(v,e.isBeginning&&!e.params.rewind),a(_,e.isEnd&&!e.params.rewind)}function c(_){_.preventDefault(),!(e.isBeginning&&!e.params.loop&&!e.params.rewind)&&(e.slidePrev(),s("navigationPrev"))}function h(_){_.preventDefault(),!(e.isEnd&&!e.params.loop&&!e.params.rewind)&&(e.slideNext(),s("navigationNext"))}function p(){const _=e.params.navigation;if(e.params.navigation=GRt(e,e.originalParams.navigation,e.params.navigation,{nextEl:"swiper-button-next",prevEl:"swiper-button-prev"}),!(_.nextEl||_.prevEl))return;let v=o(_.nextEl),b=o(_.prevEl);Object.assign(e.navigation,{nextEl:v,prevEl:b}),v=n(v),b=n(b);const T=(x,S)=>{x&&x.addEventListener("click",S==="next"?h:c),!e.enabled&&x&&x.classList.add(..._.lockClass.split(" "))};v.forEach(x=>T(x,"next")),b.forEach(x=>T(x,"prev"))}function f(){let{nextEl:_,prevEl:v}=e.navigation;_=n(_),v=n(v);const b=(T,x)=>{T.removeEventListener("click",x==="next"?h:c),T.classList.remove(...e.params.navigation.disabledClass.split(" "))};_.forEach(T=>b(T,"next")),v.forEach(T=>b(T,"prev"))}i("init",()=>{e.params.navigation.enabled===!1?y():(p(),l())}),i("toEdge fromEdge lock unlock",()=>{l()}),i("destroy",()=>{f()}),i("enable disable",()=>{let{nextEl:_,prevEl:v}=e.navigation;_=n(_),v=n(v),[..._,...v].filter(b=>!!b).forEach(b=>b.classList[e.enabled?"remove":"add"](e.params.navigation.lockClass))}),i("click",(_,v)=>{let{nextEl:b,prevEl:T}=e.navigation;b=n(b),T=n(T);const x=v.target;if(e.params.navigation.hideOnClick&&!T.includes(x)&&!b.includes(x)){if(e.pagination&&e.params.pagination&&e.params.pagination.clickable&&(e.pagination.el===x||e.pagination.el.contains(x)))return;let S;b.length?S=b[0].classList.contains(e.params.navigation.hiddenClass):T.length&&(S=T[0].classList.contains(e.params.navigation.hiddenClass)),s(S===!0?"navigationShow":"navigationHide"),[...b,...T].filter(E=>!!E).forEach(E=>E.classList.toggle(e.params.navigation.hiddenClass))}});const m=()=>{e.el.classList.remove(...e.params.navigation.navigationDisabledClass.split(" ")),p(),l()},y=()=>{e.el.classList.add(...e.params.navigation.navigationDisabledClass.split(" ")),f()};Object.assign(e.navigation,{enable:m,disable:y,update:l,init:p,destroy:f})}async function HRt(t,e,r){r.popup.content="",r.closePopup();const i=e.name.trim()?e.name:"Building";let s=`
<p class='info'>
  <img src="./height.png"> ${Math.round(e.heightroof)} feet
  <img src='./construction.png'> ${e.cnstrct_yr}
</p>`,n;if(i!=="Building"){const f=await c();s+=f.extract??"",n=f.articleUrl}const{gallery:o,photoCount:a}=await h();s+=o??"";const l=document.createElement("div");l.innerHTML=s,await r.openPopup({title:i,content:l,location:t}),p({articleUrl:n,photoCount:a}),WRt(l);async function c(){const f=new URL("https://en.wikipedia.org/w/api.php");f.search=new URLSearchParams({action:"query",list:"search",srsearch:e.name,srwhat:"text",prop:"extracts|pageimages|imageinfo|pageterms|info",exintro:"1",explaintext:"1",exlimit:"20",pilimit:"20",piprop:"original",generator:"geosearch",ggscoord:`${t.latitude}|${t.longitude}`,ggsradius:"200",ggslimit:"20",origin:"*",format:"json"}).toString();const m=await hr(f,{responseType:"json"}),y=m.data.query.pages,_=m.data.query.search;let v=null,b=0;for(;!v&&b<_.length;){for(const S in y)if(y.hasOwnProperty(S)&&_[b].title===y[S].title){v=y[S];break}b++}if(!v)return{};const T=v.extract.length>200?v.extract.substring(0,v.extract.indexOf(".",200)+1):v.extract,x=`http://en.wikipedia.org/wiki/${encodeURIComponent(v.title)}`;return{extract:T,articleUrl:x}}async function h(){const f=new URL("https://api.flickr.com/services/rest/");f.search=new URLSearchParams({method:"flickr.photos.search",api_key:"099473f4030cba02455eb7db33704767",tags:"building",accuracy:"16",has_geo:"true",license:"2,3,4,5,6,7",lat:t.latitude.toString(),lon:t.longitude.toString(),radius:"0.1"}).toString();const y=(await hr(f,{responseType:"xml"})).data.getElementsByTagName("photo"),_=y.length;return _==0?{photoCount:_}:{gallery:qRt(Array.from(y).slice(0,Mi.maxPhotoCount)),photoCount:_}}function p({articleUrl:f,photoCount:m}){const y="wiki-action",_="flickr-action";r.popup.actions.removeAll(),f&&r.popup.actions.push(new HB({title:"Wikipedia",id:y,icon:"article"})),m>0&&r.popup.actions.push(new HB({title:"Photos",id:_,icon:"images"}));const v="info-widget-actions",b=r.popup.on("trigger-action",T=>{switch(T.action.id){case y:{window.open(f,"_blank");break}case _:{const x=new URL("https://www.flickr.com/search/");x.search=new URLSearchParams({tags:"building",accuracy:"16",has_geo:"true",lat:t.latitude.toString(),lon:t.longitude.toString(),radius:"0.1"}).toString(),window.open(x.toString(),"_blank");break}}r.popup.removeHandles(v),r.popup.addHandles(b,v)})}}function qRt(t){return`
<div class="swiper">
  <div class="swiper-wrapper">
    ${t.map(r=>{const i=`https://farm${r.getAttribute("farm")}.staticflickr.com/${r.getAttribute("server")}/${r.getAttribute("id")}_${r.getAttribute("secret")}.jpg`,s=`https://www.flickr.com/photos/${r.getAttribute("owner")}/${r.getAttribute("id")}/`;let n=r.getAttribute("title");return n.length>Mi.maxAttributionLength&&(n=n?.slice(0,Mi.maxAttributionLength-3)+"..."),`<div class="swiper-slide">
<div class="image" style="background-image: url('${i}')"></div>
<a class="attribution" href="${s}" target = "_blank"><b>${n}</b> courtesy of Flickr</a>
</div>`}).join(`
`)}
  </div>
  <div class="swiper-pagination"></div>
  <div class="swiper-button-prev"></div>
  <div class="swiper-button-next"></div>
</div>`}function WRt(t){const e=t.getElementsByClassName("swiper")[0],r=t.getElementsByClassName("swiper-button-prev")[0],i=t.getElementsByClassName("swiper-button-next")[0];new mh(e,{loop:!0,modules:[jRt],navigation:{prevEl:r,nextEl:i}})}function XRt(t,e){hr(t,{responseType:"json"}).then(function(r){const i=[];for(let o=0;o<r.data.features.length;o++){var s=r.data.features[o];i.push({geometry:new Ke({x:s.geometry.coordinates[0],y:s.geometry.coordinates[1],z:0}),attributes:{OBJECTID:s.properties.FID,Name:s.properties.Name}})}const n=new $R({fields:[{name:"OBJECTID",alias:"objectId",type:"oid"},{name:"Name",alias:"Name",type:"string"}],objectIdField:"OBJECTID",geometryType:"point",spatialReference:new je({wkid:4326}),source:i,labelsVisible:!0,labelingInfo:[new sC({labelExpressionInfo:{expression:"$feature.Name"},symbol:new LM({symbolLayers:[new bv({material:{color:"white"},text:s.properties.Name,font:{family:"sans-serif",weight:"bold"},size:12,halo:{color:[50,50,50,.8],size:1}})],verticalOffset:{screenLength:100,maxWorldLength:100},callout:{type:"line",size:2,color:[150,150,150],border:{color:[255,255,255]}}})})],renderer:new kM({symbol:new Uf({symbolLayers:[new Ff({resource:{primitive:"circle"},size:1,material:{color:[255,255,255]}})]})})});e.add(n)})}const Ts="esri-search",Et={base:`${Ts} esri-widget`,loader:"esri-widget__loader",loaderText:"esri-widget__loader-text",loaderAnimation:"esri-widget__loader-animation",esriInput:"esri-input",hasMultipleSources:`${Ts}--multiple-sources`,isLoading:`${Ts}--loading`,isSearching:`${Ts}--searching`,showSuggestions:`${Ts}--show-suggestions`,showSources:`${Ts}--sources`,showWarning:`${Ts}--warning`,container:`${Ts}__container`,input:`${Ts}__input`,inputContainer:`${Ts}__input-container`,form:`${Ts}__form`,submitButton:`${Ts}__submit-button`,sourcesButton:`${Ts}__sources-button`,clearButton:`${Ts}__clear-button`,sourceName:`${Ts}__source-name`,suggestionsMenu:`${Ts}__suggestions-menu`,suggestionList:`${Ts}__suggestions-list`,suggestionListCurrentLocation:`${Ts}__suggestions-list--current-location`,sourcesMenu:`${Ts}__sources-menu`,source:`${Ts}__source`,warningMenu:`${Ts}__warning-menu`,warningMenuBody:`${Ts}__warning-body`,warningMenuHeader:`${Ts}__warning-header`,warningMenuText:`${Ts}__warning-text`,noValueText:`${Ts}__no-value-text`,esriWidgetDisabled:"esri-widget--disabled",button:"esri-widget--button",fallbackText:"esri-icon-font-fallback-text",header:"esri-widget__heading",locate:"esri-icon-locate-circled",menu:"esri-menu",menuList:"esri-menu__list",menuItem:"esri-menu__list-item",menuItemActive:"esri-menu__list-item--active",menuItemFocus:"esri-menu__list-item--focus",menuHeader:"esri-menu__header",loadingIcon:"esri-icon-loading-indicator esri-rotating",searchIcon:"esri-icon-search",dropdownIcon:"esri-icon-down-arrow esri-search__sources-button--down",dropupIcon:"esri-icon-up-arrow esri-search__sources-button--up",clearIcon:"esri-icon-close",noticeIcon:"esri-icon-notice-triangle",widgetIcon:"esri-icon-search",disabled:"esri-disabled"},_1="esri-search-result-renderer",Jm={base:`${_1} esri-widget`,anchor:"esri-widget__anchor",showMoreResults:`${_1}__more-results--show-more-results`,moreResults:`${_1}__more-results`,moreResultsList:`${_1}__more-results-list`,moreResultsHeader:`${_1}__more-results-header`,moreResultsItem:`${_1}__more-results-item`,moreResultsListHeader:`${_1}__more-results-list-header`};let bn=class extends t6(le){constructor(e){super(e),this.autoNavigate=null,this.filter=null,this.getResults=null,this.getSuggestions=null,this.maxResults=null,this.maxSuggestions=null,this.minSuggestCharacters=null,this.outFields=null,this.placeholder="",this.popupEnabled=null,this.popupTemplate=null,this.prefix="",this.resultGraphicEnabled=null,this.resultSymbol=null,this.suggestionsEnabled=null,this.suffix="",this.withinViewEnabled=!1,this.zoomScale=null}};u([d()],bn.prototype,"autoNavigate",void 0),u([d()],bn.prototype,"filter",void 0),u([d()],bn.prototype,"getResults",void 0),u([d()],bn.prototype,"getSuggestions",void 0),u([d()],bn.prototype,"maxResults",void 0),u([d()],bn.prototype,"maxSuggestions",void 0),u([d()],bn.prototype,"minSuggestCharacters",void 0),u([d()],bn.prototype,"outFields",void 0),u([d()],bn.prototype,"placeholder",void 0),u([d()],bn.prototype,"popupEnabled",void 0),u([d()],bn.prototype,"popupTemplate",void 0),u([d()],bn.prototype,"prefix",void 0),u([d()],bn.prototype,"resultGraphicEnabled",void 0),u([d()],bn.prototype,"resultSymbol",void 0),u([d()],bn.prototype,"suggestionsEnabled",void 0),u([d()],bn.prototype,"suffix",void 0),u([d()],bn.prototype,"withinViewEnabled",void 0),u([d()],bn.prototype,"zoomScale",void 0),bn=u([P("esri.widgets.Search.SearchSource")],bn);const JK=bn,Kpe=Q.getLogger("esri.widgets.Search.support.geometryUtils");function ZRt(t,e){if(!e)return Kpe.error("missing-parameter: view is missing."),Promise.reject(new V("searchgeometryutils:missing-parameter","view is missing."));if(!t)return Kpe.error("missing-parameter: point is missing."),Promise.reject(new V("searchgeometryutils:missing-parameter","point is missing."));if(t.hasZ||e.type==="2d")return Promise.resolve(t);const r=e?.map?.ground;return r&&r.layers.length?r.queryElevation(t,{cache:e.basemapTerrain?.elevationQueryCache}).then(i=>i.geometry):Promise.resolve(t)}function efe(t){if(t==null)return null;switch(t.type){case"point":return t;case"extent":return t.center;case"polygon":return t.centroid;case"multipoint":return t.getPoint(0);case"polyline":return t.getPoint(0,0)}return null}function QK(t,e,r){return t==null?null:t.type==="extent"?t:t.type==="multipoint"||t.type==="polygon"||t.type==="polyline"?t.extent:t.type==="point"?eIe(t,e,r):void 0}function JW(t,e,r){return t==null||e==null?null:eIe(t.center,e,r)}function eIe(t,e,r){const i=t.hasZ?t.z:void 0;return e?.map?(r!=null?xWe(e,r):e.extent).clone().centerAt(t).set({zmax:i,zmin:i}):new ur({xmin:t.x-.25,ymin:t.y-.25,xmax:t.x+.25,ymax:t.y+.25,spatialReference:t.spatialReference,zmin:i,zmax:i})}const YRt=/https?:\/\/services.*\.arcgis\.com/i,JRt=/(?:\{([^}]+)\})/g,D2=Q.getLogger("esri.widgets.Search.support.layerSearchUtils");function QRt(t,e){const{exactMatch:r=!1,location:i,maxResults:s,spatialReference:n,source:o,sourceIndex:a,suggestResult:l,view:c}=t,{layer:h,filter:p,zoomScale:f}=o,m=c?.scale,y=tIe(o,c),_=e&&e.signal;return iIe(h).then(()=>{const v=h.popupTemplate;return v?v.getRequiredFields(h.fieldsIndex):null}).then(v=>{const{objectIdField:b,returnZ:T}=h,x=cIe(o);if(!KK(h,x))throw D2.error("invalid-field: displayField is invalid."),new V("getResults():invalid-field","displayField is invalid.");const S=v&&v.length?v:[x],E=o.outFields||S,A=rIe(E);if(E.includes(b)||A||E.push(b),h.floorInfo?.floorField&&E.push(h.floorInfo.floorField),!(A||O5(h,E)))throw D2.error("invalid-field: outField is invalid."),new V("getResults():invalid-field","outField is invalid.");const R=h.createQuery(),{orderByFields:M}=o;if(M&&(R.orderByFields=M),n){R.outSpatialReference=n;const $=1/_a(n);$&&(R.maxAllowableOffset=$)}const D=h.geometryType==="mesh"||h.geometryType==="multipatch",k=h.capabilities?.data?.supportsZ&&!D;if(R.returnZ=k&&T!==!1,R.returnGeometry=!0,R.multipatchOption=D?"xyFootprint":null,E&&(R.outFields=E),i)R.geometry=i;else if(l.key)R.objectIds=[l.key];else{const $=o.searchFields||[x];if(!O5(h,$))throw D2.error("invalid-field: search field is invalid."),new V("getResults():invalid-field","search field is invalid.");if(lIe(h)&&(R.num=s),y&&(R.geometry=y),!l.text?.trim())return[];const H=l.text,{prefix:Z="",suffix:G=""}=o,J=uIe(`${Z}${H}${G}`);aIe(h)&&nIe(h,$)&&!r&&H&&(R.fullText=oIe({text:H,searchFields:$}));const I=hIe({searchTerm:J,layer:h,searchFields:$,filter:p,exactMatch:r,query:R,type:"search"});if(R.where=I,!sIe(R))return[]}return h.queryFeatures(R,{signal:_}).then($=>uMt($,c,o,a,x,m,f))})}function KRt(t,e){const{source:r,spatialReference:i,view:s,suggestTerm:n,maxSuggestions:o,sourceIndex:a,exactMatch:l}=t,{layer:c,filter:h}=r,p=e&&e.signal,f=tIe(r,s);return iIe(c).then(()=>{if(!lIe(c))return[];const m=cIe(r),y=r.searchFields||[m],_=[];r.suggestionTemplate?r.suggestionTemplate.replaceAll(JRt,(k,$)=>(_.push($),k)):_.push(m);const v=rIe(_);_.includes(c.objectIdField)||v||_.push(c.objectIdField);const b=KK(c,m),T=v||O5(c,_),x=O5(c,y);if(!b)throw D2.error("invalid-field: displayField is invalid."),new V("getSuggestions():invalid-field","displayField is invalid.");if(!T)throw D2.error("invalid-field: outField is invalid."),new V("getSuggestions():invalid-field","outField is invalid.");if(!x)throw D2.error("invalid-field: search field is invalid."),new V("getSuggestions():invalid-field","search field is invalid.");const S=c.createQuery(),{orderByFields:E}=r;if(E&&(S.orderByFields=E),S.outSpatialReference=i,S.returnGeometry=!1,S.num=o,S.outFields=_,f&&(S.geometry=f),!n.trim())return[];const{prefix:A="",suffix:R=""}=r,M=uIe(`${A}${n}${R}`);aIe(c)&&nIe(c,y)&&!l&&n&&(S.fullText=oIe({text:n,searchFields:y}));const D=hIe({searchTerm:M,layer:c,searchFields:y,filter:h,exactMatch:l,query:S,type:"suggest"});return S.where=D,sIe(S)?c.queryFeatures(S,{signal:p}).then(k=>lMt(k,r,a,m)):[]})}function tIe(t,e){const{filter:r,withinViewEnabled:i}=t,s=e?.extent;return r?.geometry??(i&&s?s:void 0)}function rIe(t){return t&&t.includes("*")}async function iIe(t){t&&await t.load()}function sIe(t){return!(!t.fullText&&!t.where)}function nIe(t,e){const r=t?.indexes;return!r||!e?.length?!1:r.filter(i=>i.indexType==="FullText").some(i=>{const s=i.fields?.split(",").map(n=>n.trim().toLowerCase())||[];return e.every(n=>s.includes(n.toLowerCase()))})}function oIe({text:t,searchFields:e}){return t.trim().split(" ").filter(r=>!!r.trim()).map(r=>new qve({onFields:e,searchTerm:r,searchType:"prefix"}))}function aIe(t){return t?.capabilities?.query?.supportsFullTextSearch??!1}function lIe(t){return t?.capabilities?.query?.supportsPagination??!1}function eMt(t){return t?.fieldsIndex?.fields?.find(e=>e.type==="string")?.name??""}function cIe(t){return t.displayField||t.layer.displayField||eMt(t.layer)}function O5(t,e){return!(!t||!e?.length)&&e.every(r=>KK(t,r))}function KK(t,e){return!!t.getField(e)}function tMt(t){for(let e=0;e<t.length;e++)if(t.charCodeAt(e)>255)return!0;return!1}function rMt(t,e,r){let i=null;const{codedValues:s}=t;return s&&s.some(n=>{const o=n.name,a=r?o:o.toLowerCase();return(r?e:e.toLowerCase())===a&&(i=n.code.toString(),!0)}),i}function uIe(t){return t.replaceAll("'","''")}function RA(t,e){const r=e?.where;return r?`(${t}) AND (${r})`:t}function iMt({currentTerm:t,field:e,filter:r,exactMatch:i,url:s,type:n}){const o=e?.type,a=e?.name;if(o==="string"||o==="date"||o==="global-id"){const l=YRt.test(s??""),c=l&&tMt(t)?"N":"";return RA(i&&n==="search"?`${a} = ${c}'${t}'`:l?`${a} LIKE ${c}${`'${t}%'`}`:`${`LOWER(${a})`} LIKE ${c}${`'${t.toLowerCase()}%'`}`,r)}if(o==="oid"||o==="small-integer"||o==="integer"||o==="single"||o==="double"){const l=Number(t);return isNaN(l)?null:RA(`${a} = ${l}`,r)}return RA(`${a} = ${t}`,r)}function sMt(t,e){return t?` OR (${e})`:`(${e})`}function hIe({searchTerm:t,layer:e,searchFields:r,filter:i,exactMatch:s,query:n,type:o}){const{definitionExpression:a,url:l}=e;let c="";return!n.fullText&&t&&r&&r.forEach(h=>{const p=e.getField(h),f=typeof e.getFieldDomain=="function"&&e.getFieldDomain(h),m=(f&&f.type==="coded-value"?rMt(f,t,s):null)||t||null;if(m!==null){const y=iMt({currentTerm:m,field:p,filter:i,exactMatch:s,url:l,type:o});y&&(c+=sMt(c,y))}}),a&&c?`(${a}) AND (${c})`:a||c}function nMt(t,e){let r=null;const{codedValues:i}=t;return i&&i.length&&i.some(s=>s.code===e&&(r=s.name,!0)),r}function oMt(t,e){return t[Object.keys(t).find(r=>r.toLowerCase()===e.toLowerCase())]}function dIe(t,e,r){const i=t.sourceLayer,{attributes:s}=t,n=typeof i.getFieldDomain=="function"&&i.getFieldDomain(r);if(e)return nve(e,s);if(r&&s){const o=i.getField(r),a=oMt(s,r);return a==null?"":n&&n.type==="coded-value"?nMt(n,a)??"":o?.type==="date"?cy(new Date(a)):typeof a=="number"?a.toString():typeof a!="string"?"":a.trim()}return""}function aMt(t,e,r,i){const s=t.sourceLayer,{attributes:n}=t,{objectIdField:o}=s,a=o?n[o]:null;return{text:dIe(t,e.suggestionTemplate,i),key:a,sourceIndex:r}}function lMt(t,e,r,i){return t.features.map(s=>aMt(s,e,r,i))}function cMt(t,e,r,i,s,n,o){const a=t.clone(),l=t.sourceLayer,c=l?.objectIdField,h=c?t.attributes[c]:null,p=dIe(t,r.searchTemplate,s),f=QK(a.geometry,e,n),m=typeof o=="number"?JW(K(f),e,o):f,y=t.clone();return m!=null&&(y.geometry=yu.fromExtent(m)),{extent:m,target:y,feature:a,key:h,name:p,sourceIndex:i}}function uMt(t,e,r,i,s,n,o){return t.features.map(a=>cMt(a,e,r,i,s,n,o))}var QW;let Ud=QW=class extends JK{constructor(t){super(t),this.displayField=null,this.exactMatch=null,this.orderByFields=null,this.searchFields=null,this.searchTemplate=null,this.suggestionTemplate=null,this.getResults=(e,r)=>QRt({source:this,...e},r),this.getSuggestions=(e,r)=>KRt({source:this,...e},r)}set layer(t){this._set("layer",t),t&&t.load().catch(()=>{})}get name(){return this._getLayerTitle()??""}set name(t){this._overrideIfSome("name",t)}clone(){return new QW({autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?K(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,displayField:this.displayField,exactMatch:this.exactMatch,layer:this.layer,searchFields:this.searchFields?K(this.searchFields):null,suggestionTemplate:this.suggestionTemplate,zoomScale:this.zoomScale})}_getFirstStringField(){return this.layer.fieldsIndex?.fields.find(t=>t.type==="string")?.name??""}_getDisplayField(){return this.displayField||this.layer.displayField||this._getFirstStringField()}_getSearchFieldsString(){const{layer:t,searchFields:e}=this;return t.loaded?`: ${(e||[this._getDisplayField()]).map(r=>{const i=t.getField(r);return i&&i.alias||r}).join(", ")}`:""}_getLayerTitle(){const{layer:t}=this;if(!t)return;const{title:e}=t;return e?`${e}${this._getSearchFieldsString()}`:void 0}};u([d({json:{read:{source:"field.name"},write:{target:"field.name"}}})],Ud.prototype,"displayField",void 0),u([d({json:{read:{source:"field.exactMatch"},write:{target:"field.exactMatch"}}})],Ud.prototype,"exactMatch",void 0),u([d({value:null})],Ud.prototype,"layer",null),u([d()],Ud.prototype,"name",null),u([d({type:[String],json:{write:!0}})],Ud.prototype,"orderByFields",void 0),u([d()],Ud.prototype,"searchFields",void 0),u([d()],Ud.prototype,"searchTemplate",void 0),u([d()],Ud.prototype,"suggestionTemplate",void 0),Ud=QW=u([P("esri.widgets.Search.LayerSearchSource")],Ud);const Nb=Ud;function hMt(t){return!!t&&typeof t.x=="number"&&typeof t.y=="number"}function dMt(t){return t&&typeof t.xmin=="number"&&typeof t.ymin=="number"&&typeof t.xmax=="number"&&typeof t.ymax=="number"}let t_=class extends le{constructor(e){super(e),this.address=null,this.attributes=null,this.extent=null,this.location=null,this.score=null}};u([d({type:String,json:{write:!0}})],t_.prototype,"address",void 0),u([d({type:Object,json:{write:!0}})],t_.prototype,"attributes",void 0),u([d({type:ur,json:{write:!0}})],t_.prototype,"extent",void 0),u([d({type:Ke,json:{write:!0}})],t_.prototype,"location",void 0),u([d({type:Number,json:{write:!0}})],t_.prototype,"score",void 0),t_=u([P("esri.rest.support.AddressCandidate")],t_);const pIe=t_,eee={type:String,json:{read:{source:"token"},write:{target:"token"}}};let ta=class extends le{constructor(e){super(e),this.address=null,this.apiKey=null,this.categories=null,this.countryCode=null,this.forStorage=null,this.location=null,this.locationType=null,this.magicKey=null,this.maxLocations=null,this.outFields=null,this.outSpatialReference=null,this.searchExtent=null}};u([d({type:Object,json:{write:!0}})],ta.prototype,"address",void 0),u([d(eee)],ta.prototype,"apiKey",void 0),u([d({type:[String],json:{read:{source:"category",reader:t=>t?t.split(","):null},write:{target:"category",writer:(t,e)=>{e.category=t?t.join(","):null}}}})],ta.prototype,"categories",void 0),u([d({type:String,json:{write:!0}})],ta.prototype,"countryCode",void 0),u([d({type:Boolean,json:{write:!0}})],ta.prototype,"forStorage",void 0),u([d({type:Ke,json:{write:{writer:(t,e)=>{e.location=t?t.clone().normalize():null}}}})],ta.prototype,"location",void 0),u([d({type:String,json:{write:!0}})],ta.prototype,"locationType",void 0),u([d({type:String,json:{write:!0}})],ta.prototype,"magicKey",void 0),u([d({type:Number,json:{write:!0}})],ta.prototype,"maxLocations",void 0),u([d({type:[String],json:{write:{writer:(t,e)=>{e.outFields=t?t.join(","):null}}}})],ta.prototype,"outFields",void 0),u([d({type:je,json:{read:{source:"outSR"},write:{target:"outSR"}}})],ta.prototype,"outSpatialReference",void 0),u([d({type:ur,json:{write:{writer:(t,e)=>{const r=t?t.shiftCentralMeridian():null;e.searchExtent=r}}}})],ta.prototype,"searchExtent",void 0),ta=u([P("esri.rest.support.AddressToLocationsParameters")],ta),ta.from=vs(ta);const fIe=ta;async function pMt(t,e,r){e=fIe.from(e);const i=WU(t),{address:s,...n}=e.toJSON(),o={...s,...n,f:"json"},a=XU({...i.query,...o}),l=qU(a,r),c=`${i.path}/findAddressCandidates`;return hr(c,l).then(fMt)}function fMt({data:t}){if(!t)return[];const{candidates:e,spatialReference:r}=t;return e?e.map(i=>{if(!i)return;const{extent:s,location:n}=i,o=!s||dMt(s);return hMt(n)&&o?(s&&(s.spatialReference=r),n&&(n.spatialReference=r),pIe.fromJSON(i)):void 0}):[]}let Sg=class extends le{constructor(e){super(e),this.apiKey=null,this.location=null,this.locationType=null,this.outSpatialReference=null}};u([d(eee)],Sg.prototype,"apiKey",void 0),u([d({type:Ke,json:{write:{writer:(t,e)=>{const r=t?t.clone().normalize():null,i=r!==void 0;e.location=i?r:null}}}})],Sg.prototype,"location",void 0),u([d({type:String,json:{write:!0}})],Sg.prototype,"locationType",void 0),u([d({type:je,json:{read:{source:"outSR"},write:{target:"outSR"}}})],Sg.prototype,"outSpatialReference",void 0),Sg=u([P("esri.rest.support.LocationToAddressParameters")],Sg),Sg.from=vs(Sg);const mIe=Sg;async function mMt(t,e,r){e=mIe.from(e);const i=WU(t),s={...e.toJSON(),f:"json"},n=XU({...i.query,...s}),o=qU(n,r),a=`${i.path}/reverseGeocode`;return hr(a,o).then(gMt)}function gMt({data:t}){if(!t)return;const{address:e,location:r}=t,i=e&&e.Match_addr||"";return pIe.fromJSON({address:i,attributes:e||{},location:r,score:100})}let LS=class extends le{constructor(e){super(e),this.isCollection=null,this.magicKey=null,this.text=null}};u([d({type:Boolean,json:{write:!0}})],LS.prototype,"isCollection",void 0),u([d({type:String,json:{write:!0}})],LS.prototype,"magicKey",void 0),u([d({type:String,json:{write:!0}})],LS.prototype,"text",void 0),LS=u([P("esri.rest.support.SuggestionCandidate")],LS);const yMt=LS;let Kc=class extends le{constructor(e){super(e),this.apiKey=null,this.categories=null,this.countryCode=null,this.location=null,this.maxSuggestions=null,this.outSpatialReference=null,this.searchExtent=null,this.text=null}};u([d(eee)],Kc.prototype,"apiKey",void 0),u([d({type:[String],json:{read:{source:"category",reader:t=>t?t.split(","):null},write:{target:"category",writer:(t,e)=>{e.category=t?t.join(","):null}}}})],Kc.prototype,"categories",void 0),u([d({type:String,json:{write:!0}})],Kc.prototype,"countryCode",void 0),u([d({type:Ke,json:{write:{writer:(t,e)=>{e.location=t?t.clone().normalize():null}}}})],Kc.prototype,"location",void 0),u([d({type:Number,json:{write:!0}})],Kc.prototype,"maxSuggestions",void 0),u([d({type:je,json:{read:{source:"outSR"},write:{target:"outSR"}}})],Kc.prototype,"outSpatialReference",void 0),u([d({type:ur,json:{write:{writer:(t,e)=>{const r=t?t.shiftCentralMeridian():null;e.searchExtent=JSON.stringify(r)}}}})],Kc.prototype,"searchExtent",void 0),u([d({type:String,json:{write:!0}})],Kc.prototype,"text",void 0),Kc=u([P("esri.rest.support.SuggestLocationsParameters")],Kc),Kc.from=vs(Kc);const gIe=Kc;async function _Mt(t,e,r){const i=WU(t),s={...(e=gIe.from(e)).toJSON(),f:"json"},n=XU({...i.query,...s}),o=qU(n,r),a=`${i.path}/suggest`;return hr(a,o).then(vMt)}function vMt(t){const{data:e}=t;if(!e)return[];const{suggestions:r}=e;return r?r.map(i=>new yMt(i)):[]}const bMt="Single Line Input",wMt=3e5;function xMt(t,e){return t.location?AMt(t,e):OMt(t,e)}function yIe(t,e){if(e.localSearchDisabled)return null;const r=t?.scale;return typeof r=="number"&&r<=wMt?t?.extent?.center:null}async function TMt(t,e){const{source:r,spatialReference:i,view:s,suggestTerm:n,maxSuggestions:o,sourceIndex:a}=t,l=new gIe,{apiKey:c,url:h}=r,p=_Ie(r,s),f=e&&e.signal;if(!h)return null;c&&(l.apiKey=c),r.categories&&(l.categories=r.categories),i&&(l.outSpatialReference=i);const m=yIe(s,r);if(m&&(l.location=m),!n.trim())return null;const{prefix:y="",suffix:_=""}=r,v=`${y}${n}${_}`;return l.text=v,p&&(l.searchExtent=p),l.maxSuggestions=o,r.countryCode&&(l.countryCode=r.countryCode),_Mt(h,l,{signal:f}).then(b=>MMt(b,a))}function SMt(t){return!!t&&/(?:geocode\-api\.arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/i.test(t)}function EMt(t){return!!t&&/(?:\/servers\/[\da-z\.-]+\/rest\/services\/world\/geocodeserver).*/i.test(t)}function tfe(t){return!!t&&/(?:arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/i.test(t)}const CMt="https://geocode-api.arcgis.com/arcgis/rest/services/World/GeocodeServer";async function AMt(t,e){const{source:r,spatialReference:i,location:s,sourceIndex:n,view:o}=t,{apiKey:a,url:l,zoomScale:c,defaultZoomScale:h}=r;if(l==null)return[];const p=o?.scale,f=e?.signal,m=new mIe;m.location=s,a&&(m.apiKey=a),i&&(m.outSpatialReference=i);try{return vIe([await mMt(l,m,{signal:f})],{sourceIndex:n,scale:p,view:o,zoomScale:c,defaultZoomScale:h})}catch{return[]}}function _Ie(t,e){const{filter:r,withinViewEnabled:i}=t,s=e&&e.scale,n=e&&e.extent,o=r&&r.geometry;return QK(o,e,s)||(i&&n?n:void 0)}async function OMt(t,e){const{source:r,suggestResult:i,spatialReference:s,view:n,maxResults:o,sourceIndex:a}=t,l=r&&r.zoomScale,c=r&&r.defaultZoomScale;if(!i.text?.trim())return null;const p=!i.key&&r.prefix?r.prefix:"",f=!i.key&&r.suffix?r.suffix:"",m=`${p}${i.text}${f}`,y=new fIe,{apiKey:_,url:v}=r,b=n&&n.scale,T=_Ie(r,n),x=e&&e.signal;if(_&&(y.apiKey=_),!v)return null;r.categories&&(y.categories=r.categories),r.locationType&&(y.locationType=r.locationType),s&&(y.outSpatialReference=s);const S=yIe(n,r);S&&(y.location=S),y.maxLocations=o,T&&(y.searchExtent=T),r.countryCode&&(y.countryCode=r.countryCode);const{key:E}=i,A=`${E}`;return E&&(y.magicKey=A),y.address={},y.address[r.singleLineFieldName||bMt]=m,r.outFields&&(y.outFields=r.outFields),pMt(v,y,{signal:x}).then(R=>vIe(R,{key:A,scale:b,sourceIndex:a,view:n,zoomScale:l,defaultZoomScale:c}))}function RMt(t,e){return{text:t.text,key:t.magicKey,sourceIndex:e}}function MMt(t,e){return t.map(r=>RMt(r,e))}function PMt(t,e){const{key:r,scale:i,sourceIndex:s,view:n,zoomScale:o,defaultZoomScale:a}=e,{attributes:l,extent:c,location:h,address:p}=t,f=new Nl({geometry:h,attributes:l}),m=c||h,y=QK(m,n,i),_=typeof o=="number"?JW(y,n,o):typeof a=="number"&&m?.type==="point"?JW(y,n,a):y,v=h?`${h.x},${h.y}`:"",b=p||v,T=f.clone();return _!=null&&(T.geometry=yu.fromExtent(_)),{extent:_,feature:f,target:T,key:r,name:b,sourceIndex:s}}function vIe(t,e){return t.filter(Boolean).map(r=>PMt(r,e))}var KW;const IMt="esri.widgets.Search.LocatorSearchSource";let Va=KW=class extends JK{constructor(t){super(t),this.apiKey=null,this.categories=null,this.countryCode=null,this.defaultZoomScale=null,this.localSearchDisabled=!1,this.locationType=null,this.name="",this.placeholder="",this.searchTemplate="",this.singleLineFieldName=null,this.suggestionsEnabled=null,this.url=null,this.zoomScale=null,this.getResults=(e,r)=>xMt({source:this,...e},r),this.getSuggestions=(e,r)=>TMt({source:this,...e},r)}clone(){return new KW({apiKey:this.apiKey,autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?K(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,categories:this.categories?K(this.categories):null,countryCode:this.countryCode,locationType:this.locationType,searchTemplate:this.searchTemplate,singleLineFieldName:this.singleLineFieldName,zoomScale:this.zoomScale})}};u([d()],Va.prototype,"apiKey",void 0),u([d()],Va.prototype,"categories",void 0),u([d()],Va.prototype,"countryCode",void 0),u([d({json:{write:!0}})],Va.prototype,"defaultZoomScale",void 0),u([d()],Va.prototype,"localSearchDisabled",void 0),u([d()],Va.prototype,"locationType",void 0),u([d({json:{write:!0}})],Va.prototype,"name",void 0),u([d({json:{write:!0}})],Va.prototype,"placeholder",void 0),u([d()],Va.prototype,"searchTemplate",void 0),u([d({json:{write:!0}})],Va.prototype,"singleLineFieldName",void 0),u([d({json:{read:{source:"suggest"},write:{target:"suggest"}}})],Va.prototype,"suggestionsEnabled",void 0),u([d({json:{write:!0}})],Va.prototype,"url",void 0),u([d({json:{write:!0}})],Va.prototype,"zoomScale",void 0),Va=KW=u([P(IMt)],Va);const bIe=Va,wIe=Q.getLogger("esri.widgets.support.geolocationUtils"),$Mt={maximumAge:0,timeout:15e3,enableHighAccuracy:!0};function LMt(){const t=oe("esri-geolocation");return t||wIe.warn("geolocation-unsupported","Geolocation unsupported."),t}function DMt(){const t=window.isSecureContext;return t||wIe.warn("insecure-context","Geolocation requires a secure origin."),t}function rfe(){return LMt()&&DMt()}function NMt(t){return t||(t=$Mt),new Promise((r,i)=>{setTimeout(()=>i(new V("geolocation:timeout","getting the current geolocation position timed out")),15e3),navigator.geolocation.getCurrentPosition(r,i,t??void 0)})}function FMt(t,e){const{position:r,view:i}=t,s=UMt(r),n=s?.coords;if(!n)throw new V("geometry-service:no-coords","Geolocation has no coordinates");return zMt(kMt(n),i,e)}function UMt(t){const e=t&&t.coords||{},r={accuracy:e.accuracy,altitude:e.altitude,altitudeAccuracy:e.altitudeAccuracy,heading:e.heading,latitude:e.latitude,longitude:e.longitude,speed:e.speed};return t&&{coords:r,timestamp:t.timestamp}}function kMt({longitude:t,latitude:e,altitude:r}){return new Ke({longitude:t,latitude:e,z:r||void 0,spatialReference:{wkid:4326}})}function zMt(t,e,r){if(!e)return Promise.resolve(t);const i=e.spatialReference;return i.isWGS84?Promise.resolve(t):i.isWebMercator?Promise.resolve(n2(t)):VMt(r).then(s=>{if(!s)throw new V("geometry-service:missing-url","Geometry service URL is missing");const n=new ZU({geometries:[t],outSpatialReference:i});return cK(s,n,r).then(o=>o[0])})}function VMt(t){if(Br.geometryServiceUrl)return Promise.resolve(Br.geometryServiceUrl);const e=Js.getDefault();return e.load(t).catch(()=>{}).then(()=>e.get("helperServices.geometry.url"))}function Ia(t,e){return t.hasOwnProperty(e)&&t[e]!=null&&t[e]!==""}const BMt=()=>GX("esri/widgets/Search/t9n/Search"),xIe="esri.widgets.Search.SearchViewModel",Qm=Q.getLogger(xIe),ife="highlight",VN=Pt.ofType({key:t=>t.layer?"layer":"locator",base:JK,typeMap:{layer:Nb,locator:bIe}}),sfe=je.WGS84,GMt="esri/images/search/search-symbol-32.png",jMt=/<(?:.|\s)*?>/g,DS=-1;let gr=class extends pPe(ws.EventedMixin(we)){constructor(t){super(t),this._gotoController=null,this._searching=null,this._updatingPromise=null,this._createdFeatureLayers=[],this.autoNavigate=!0,this.autoSelect=!0,this.defaultPopupTemplate=null,this.defaultSources=new VN,this.defaultSymbols={point:new DM({url:Gr(GMt),size:24,width:24,height:24}),polyline:new $u({color:[130,130,130,1],width:2}),polygon:new wv({color:[235,235,235,.4],outline:{color:[130,130,130,1],width:2}})},this.includeDefaultSources=!0,this.maxInputLength=128,this.maxResults=6,this.maxSuggestions=6,this.messages=null,this.minSuggestCharacters=3,this.popupEnabled=!0,this.popupTemplate=null,this.portal=Js.getDefault(),this.resultCount=null,this.resultGraphicEnabled=!0,this.resultGraphic=null,this.results=null,this.selectedSuggestion=null,this.searchAllEnabled=!0,this.selectedResult=null,this.sources=new VN,this.suggestionDelay=350,this.suggestionCount=null,this.suggestions=null,this.suggestionsEnabled=!0,this.view=null}initialize(){const t=async()=>{const e=await BMt();this.messages=e,this.defaultPopupTemplate=new _v({title:e.searchResult,content:"{Match_addr}"})};t(),this.addHandles([ae(()=>[this.includeDefaultSources,this.view,this.portal],()=>this._update(),Pr),zX(t)])}destroy(){this.removeAllHandles(),this._destroyFeatureLayers(),this._abortGoTo(),this.clearGraphics()}get activeSource(){return this.allSources.at(this.activeSourceIndex)??null}get activeSourceIndex(){return this.allSources.length===1||!this.searchAllEnabled?0:DS}set activeSourceIndex(t){this._overrideIfSome("activeSourceIndex",t)}get allPlaceholder(){return this.messages?.allPlaceholder}set allPlaceholder(t){this._overrideIfSome("allPlaceholder",t)}get allSources(){const{sources:t,defaultSources:e,includeDefaultSources:r}=this,i=typeof r=="function"?r.call(null,{sources:t,defaultSources:e}):r?e.concat(t):t,s=this._get("allSources")||new VN;return s.removeAll(),s.addMany(i.filter(Boolean)),s}get locationEnabled(){return this._get("locationEnabled")||rfe()}set locationEnabled(t){if(t===void 0)return void this._clearOverride("locationEnabled");const e=rfe();if(t&&!e){const r=new V("locationEnabled:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});Qm.error(r)}this._override("locationEnabled",!!t&&e)}get placeholder(){const{allSources:t,activeSourceIndex:e,allPlaceholder:r}=this;return e===DS?r??"":t.at(e)?.placeholder??""}set searchTerm(t){this._set("searchTerm",t||""),this.clearGraphics(),this.selectedSuggestion&&this.selectedSuggestion.text!==t&&this._set("selectedSuggestion",null),t===""&&this._clear()}get searchTerm(){return this._get("searchTerm")||""}get state(){return this._searching?"searching":this.updating?"loading":this.allSources.length===0?"disabled":"ready"}get updating(){return this._updatingPromise!=null}clear(){this.searchTerm=""}clearGraphics(){this._removeHighlight(),this._closePopup();const{view:t,resultGraphic:e}=this;t&&e&&t.graphics.remove(e),this._set("resultGraphic",null)}search(t,e){this.emit("search-start"),this.clearGraphics();const r=this._createSuggestionForSearch(t),i=(async()=>{try{await this.when();const s=await this._getResultsFromSources(r,e);if(e?.signal?.aborted)return null;const n={activeSourceIndex:this.activeSourceIndex,searchTerm:r.text??"",numResults:0,numErrors:0,errors:[],results:[]};this._formatResponse(n,s,r);const o=this._getFirstResult(n.results),a=r.location&&o?o.name:r.text,l=a?.replace(jMt,"");return this._set("searchTerm",l),(r.key&&typeof r.sourceIndex=="number"||r.location)&&this._set("selectedSuggestion",r),this._set("results",n.results),this._set("resultCount",n.results.reduce((c,h)=>c+(h.results?.length??0),0)),this.emit("search-complete",n),await this._selectFirstResult(o),n}finally{this._clearSearching()}})();return this._searching=i,i}async searchNearby(t){if(!this.locationEnabled){const r=new V("searchNearby:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});throw Qm.error(r),r}const e=(async()=>{try{const r=await NMt(),i=await FMt({position:r,view:this.view},t);return await this.search(i,t)}finally{this._clearSearching()}})();return this._searching=e,e}async select(t){if(this.clearGraphics(),!t){const M=new V("select:missing-parameter","Cannot select without a searchResult.",{searchResult:t});throw Qm.error(M),M}const{view:e}=this,r=Ia(t,"sourceIndex")?t.sourceIndex:this._getSourceIndexOfResult(t),i=r!=null?this.allSources.at(r):null;if(!i){const M=new V("select:missing-source","Cannot select without a source.",{source:i});throw Qm.error(M),M}const s=i instanceof Nb?this._getLayerSourcePopupTemplate(i):i.popupTemplate,n=i.resultSymbol||this._getDefaultSymbol(t),o=Ia(i,"resultGraphicEnabled")?i.resultGraphicEnabled:this.resultGraphicEnabled,a=Ia(i,"autoNavigate")?i.autoNavigate:this.autoNavigate,l=(Ia(i,"popupEnabled")?i.popupEnabled:this.popupEnabled)?s||this.popupTemplate||this.defaultPopupTemplate:null,{feature:c}=t;if(!c){const M=new V("select:missing-feature","Cannot select without a feature.",{feature:c});throw Qm.error(M),M}const{attributes:h,geometry:p,layer:f,sourceLayer:m}=c,y=efe(p),_={layerViewQuery:this._getLayerView(c),elevationQuery:e&&y!=null?ZRt(y,e).catch(()=>y):Promise.resolve(y)},v=await bc(_),b=v.layerViewQuery.value,T=v.elevationQuery.value;n instanceof ax&&(n.text=t.name);const x=e&&a?t.target||t.extent:null;await(x!=null?this._goToSearchResult(x):Promise.resolve());const E=b?c:new Nl({geometry:p,symbol:n,attributes:h,layer:f,sourceLayer:m,popupTemplate:l}),A=e?.popup,R=A&&E.getEffectivePopupTemplate(A.defaultPopupTemplateEnabled);return R&&await e.openPopup({features:[E],location:T}),b&&kTt(b)&&!R&&this._highlightFeature({graphic:E,layerView:b}),!b&&o&&e&&e.graphics.push(E),this._setResultFloor(t),this._set("selectedResult",t),this._set("resultGraphic",E),this.emit("select-result",{result:t,source:i,sourceIndex:r}),t}async suggest(t,e,r){const i=t||this.searchTerm;this.emit("suggest-start",{searchTerm:i}),await this._suggestTimer(e,r);const s=await this._suggestImmediate(i,r);return this._set("suggestions",s?.results),this._set("suggestionCount",s?.results.reduce((n,o)=>n+(o.results?.length??0),0)??null),this.emit("suggest-complete",s),s}async when(){await ay(()=>!this.updating)}async _update(){const{portal:t,view:e}=this;if(this.includeDefaultSources){const r=this._updatingPromise=bc([t?.load(),e?.when()]);if(this.destroyed||(await r,r!==this._updatingPromise))return}await ay(()=>this.messages),this.destroyed||this._updateDefaultSources(),this._updatingPromise=null}_clearSearching(){this._searching=null}_convertHelperServices(){const t=this.portal?.helperServices?.geocode;return t?t.map(e=>{if(e.placefinding===!1)return;const r=Br.apiKey&&tfe(e.url)?{url:CMt}:null,i=bIe.fromJSON({...e,...r}),s=i.url;if(tfe(s)||EMt(s)||SMt(s)){const n=i.outFields??["Addr_type","Match_addr","StAddr","City"],o=(i.placeholder||this.messages?.placeholder)??"",a=typeof i.defaultZoomScale=="number"?i.defaultZoomScale:2500;i.singleLineFieldName="SingleLine",i.outFields=n,i.placeholder=o,i.defaultZoomScale=a}return i.singleLineFieldName?i:void 0}).filter(jf):[]}_destroyFeatureLayers(){this._createdFeatureLayers.forEach(t=>t?.destroy()),this._createdFeatureLayers=[]}_getLayerSources(t,e){const r=this.view?.map;return t.map(i=>{const s=r.findLayerById(i.id);if(!s)return;const n=this._getLayerJSON(i),o=Nb.fromJSON(n);return o.placeholder=e,this._getLayer(s,n).then(a=>{o.layer=a}),o}).filter(jf).toArray()}_getTableSources(t,e){const r=this.view?.map;return t.map(i=>{if(!i.id)return;const s=r.findTableById(i.id);if(!s)return;const n=this._getLayerJSON(i),o=Nb.fromJSON(n);return o.placeholder=e,this._getLayer(s,n).then(a=>{o.layer=a}),o}).filter(jf).toArray()}_convertApplicationProperties(){const t=this.view?.map,e=t?.applicationProperties?.viewing?.search;if(!e)return[];const{enabled:r,hintText:i,layers:s,tables:n}=e;return r?[...this._getLayerSources(s,i),...this._getTableSources(n,i)]:[]}async _getSubLayer(t,e){if(await t.load(),!t.allSublayers)throw new Error;const r=t.allSublayers.find(s=>s.id===e.subLayer);if(!r)throw new Error;const i=await r.createFeatureLayer?.();if(!i)throw new Error;return this._createdFeatureLayers.push(i),i}async _getBuildingSubLayer(t,e){await t.load();const r=t.allSublayers.find(i=>i.id===e.subLayer);if(r?.type!=="building-component")throw new Error;if(await r.load(),r.associatedLayer==null)throw new Error;return await r.associatedLayer.load(),r}async _getLayer(t,e){if(t.type==="feature"||t.type==="scene"||t.type==="csv"||t.type==="geojson"||t.type==="ogc-feature")return t;if(t.type==="map-image")try{return await this._getSubLayer(t,e)}catch{const i=new V("search:create-featurelayer","Could not create a FeatureLayer from the MapImageLayer",{layer:t});return Qm.error(i),null}return t.type==="building-scene"?this._getBuildingSubLayer(t,e):null}_getLayerJSON(t){return typeof t.toJSON=="function"?t.toJSON():t}_updateDefaultSources(){const{defaultSources:t,includeDefaultSources:e}=this;this._destroyFeatureLayers(),t.removeAll(),e&&t.addMany([...this._convertApplicationProperties(),...this._convertHelperServices()])}_abortGoTo(){this._gotoController&&this._gotoController.abort(),this._gotoController=null}_clear(){this._abortGoTo(),this._set("resultCount",null),this._set("results",null),this._set("suggestions",null),this._set("suggestionCount",null),this._set("selectedResult",null),this._set("selectedSuggestion",null),this.emit("search-clear")}_closePopup(){const t=this.view?.popup,{resultGraphic:e}=this;if(!t||!e)return;const r="selectedFeature"in t,i=r?t.selectedFeature:null;r&&i&&i===e&&t.close()}_suggestTimer(t,e){const r=t??this.suggestionDelay;return U2(r,null,e&&e.signal)}_createLocationForSearch(t){return t instanceof Nl?efe(t.geometry):t instanceof Ke?t:Array.isArray(t)&&t.length===2?new Ke({longitude:t[0],latitude:t[1]}):null}_createSuggestionForSearch(t){if(t&&Ia(t,"key")&&Ia(t,"text")&&Ia(t,"sourceIndex"))return t;const e=this._createLocationForSearch(t),r=typeof t=="string"?t:this.searchTerm,{selectedSuggestion:i,selectedResult:s}=this,n=!t&&i&&s,o=n&&i.key===s.key&&i.sourceIndex===s.sourceIndex,a=n&&i.location;return o||a?i:{location:e,text:e?"":r,sourceIndex:null,key:null}}_getFirstResult(t){let e=null;return t&&t.some(r=>{const{results:i}=r,s=i?.[0],n=!!s;return n&&(e=s),n}),e}async _selectFirstResult(t){return this.autoSelect&&t?this.select(t):null}async _suggestImmediate(t,e){await this.when();const r=await this._getSuggestionsFromSources(t,e);if(e?.signal?.aborted)return null;const i={activeSourceIndex:this.activeSourceIndex,searchTerm:t??"",numResults:0,numErrors:0,errors:[],results:[]};return this._formatResponse(i,r),i}_formatSourceResponse(t,e,r){const i=e?.value||[],s=e?.error,n=this.allSources.at(r);if(s){const o={sourceIndex:r,source:n,error:s};t.errors.push(o),Qm.error(s),t.numErrors++}else{const o={sourceIndex:r,source:n,results:i};t.results.push(o),t.numResults+=i.length}}_formatResponse(t,e,r){if(e)if(t.activeSourceIndex===DS){const i=r&&Ia(r,"sourceIndex")&&r.sourceIndex!==-1?r.sourceIndex:void 0;e.forEach((s,n)=>{const o=i!==void 0?i:n;this._formatSourceResponse(t,s,o)})}else this._formatSourceResponse(t,e[0],t.activeSourceIndex)}async _getResultsFromSources(t,e){const{allSources:r}=this,i=!t.location&&Ia(t,"sourceIndex")?t.sourceIndex:this.activeSourceIndex,s=[];if(!r.length){const n=new V("search:no-sources-defined","At least one source is required.",{allSources:r});throw Qm.error(n),n}return i===DS?r.forEach((n,o)=>{s.push(this._getResultsFromSource(t,o,e))}):s.push(this._getResultsFromSource(t,i,e)),bc(s)}async _getSuggestionsFromSources(t,e){const{allSources:r,activeSourceIndex:i}=this,s=[];if(!r.length){const n=new V("suggest:no-sources-defined","At least one source is required.",{allSources:r});throw Qm.error(n),n}return i===DS?r.forEach((n,o)=>{s.push(this._getSuggestionsFromSource(t,o,e))}):s.push(this._getSuggestionsFromSource(t,i,e)),bc(s)}async _getResultsFromSource(t,e,r){const i=e!=null?this.allSources.at(e):null;if(!i)return null;const{location:s=null}=t,n=this.view?.spatialReference||sfe,o=Ia(i,"maxResults")?i.maxResults:this.maxResults,a=!!(i instanceof Nb&&Ia(i,"exactMatch"))&&i.exactMatch,{view:l}=this;return i.getResults?.({view:l,sourceIndex:e,location:s,suggestResult:t,spatialReference:n,exactMatch:a,maxResults:o},r)}async _getSuggestionsFromSource(t,e,r){const i=this.allSources.at(e);if(!i)return null;t??(t="");const s=Ia(i,"suggestionsEnabled")?i.suggestionsEnabled:this.suggestionsEnabled,n=t?.length,o=Ia(i,"minSuggestCharacters")?i.minSuggestCharacters:this.minSuggestCharacters;if(s&&t.trim()&&n>=o){const a=this.view?.spatialReference||sfe,l=Ia(i,"maxSuggestions")?i.maxSuggestions:this.maxSuggestions,{view:c}=this,h=!!(i instanceof Nb&&Ia(i,"exactMatch"))&&i.exactMatch;return i.getSuggestions?.({view:c,sourceIndex:e,suggestTerm:t,spatialReference:a,maxSuggestions:l,exactMatch:h},r)}return null}_getLayerSourcePopupTemplate(t){const{layer:e}=t;if(e)return Ia(t,"popupTemplate")?t.popupTemplate:e.popupTemplate}_getSourceIndexOfResult(t){const e=this.results;if(!e)return null;let r=null;return e.some(i=>i.results.some(s=>s===t&&(r=i.sourceIndex,!0))),r}async _goToSearchResult(t){this._abortGoTo();const e=new AbortController;this._gotoController=e;const r={target:{target:t},options:{signal:e.signal}};t||(r.options.animate=!1),await this.callGoTo(r),this._gotoController=null}_getDefaultSymbol(t){const{defaultSymbols:e}=this,r=t.feature?.geometry;if(r==null)return null;switch(r.type){case"point":case"multipoint":return e.point;case"polyline":return e.polyline;case"extent":case"polygon":return e.polygon;default:return null}}_removeHighlight(){this.removeHandles(ife)}async _getLayerView(t){const{view:e}=this;if(!t||!e||t.layer?.type==="building-component"||t.layer?.type==="subtype-sublayer")return null;const{layer:r}=t;return r?(await e.when(),e.whenLayerView(r)):null}_highlightFeature(t){const{graphic:e,layerView:r}=t,{attributes:i,layer:s}=e,{objectIdField:n}=s,o=(n&&i?.[n])??null,a=r.highlight(o??e);this.addHandles(a,ife)}_setResultFloor(t){const{view:e}=this,r=t.feature?.attributes,i=t.feature?.sourceLayer;if(i&&"floorInfo"in i&&i?.floorInfo?.floorField&&r){const s=r[i.floorInfo.floorField];e?.emit("select-result-floor",s)}}};gr.ALL_INDEX=DS,u([d()],gr.prototype,"_searching",void 0),u([d()],gr.prototype,"_updatingPromise",void 0),u([d({readOnly:!0,value:null})],gr.prototype,"activeSource",null),u([d()],gr.prototype,"activeSourceIndex",null),u([d()],gr.prototype,"allPlaceholder",null),u([d({readOnly:!0})],gr.prototype,"allSources",null),u([d()],gr.prototype,"autoNavigate",void 0),u([d()],gr.prototype,"autoSelect",void 0),u([d()],gr.prototype,"defaultPopupTemplate",void 0),u([d({readOnly:!0})],gr.prototype,"defaultSources",void 0),u([d()],gr.prototype,"defaultSymbols",void 0),u([d()],gr.prototype,"includeDefaultSources",void 0),u([d()],gr.prototype,"locationEnabled",null),u([d()],gr.prototype,"maxInputLength",void 0),u([d()],gr.prototype,"maxResults",void 0),u([d()],gr.prototype,"maxSuggestions",void 0),u([d()],gr.prototype,"messages",void 0),u([d()],gr.prototype,"minSuggestCharacters",void 0),u([d({readOnly:!0})],gr.prototype,"placeholder",null),u([d()],gr.prototype,"popupEnabled",void 0),u([d({type:_v})],gr.prototype,"popupTemplate",void 0),u([d({type:Js})],gr.prototype,"portal",void 0),u([d()],gr.prototype,"resultCount",void 0),u([d()],gr.prototype,"resultGraphicEnabled",void 0),u([d({readOnly:!0})],gr.prototype,"resultGraphic",void 0),u([d({readOnly:!0})],gr.prototype,"results",void 0),u([d({readOnly:!0})],gr.prototype,"selectedSuggestion",void 0),u([d()],gr.prototype,"searchAllEnabled",void 0),u([d({readOnly:!0})],gr.prototype,"selectedResult",void 0),u([d()],gr.prototype,"searchTerm",null),u([d({type:VN})],gr.prototype,"sources",void 0),u([d({readOnly:!0})],gr.prototype,"state",null),u([d()],gr.prototype,"suggestionDelay",void 0),u([d()],gr.prototype,"suggestionCount",void 0),u([d({readOnly:!0})],gr.prototype,"suggestions",void 0),u([d()],gr.prototype,"suggestionsEnabled",void 0),u([d({readOnly:!0})],gr.prototype,"updating",null),u([d()],gr.prototype,"view",void 0),u([d()],gr.prototype,"clear",null),gr=u([P(xIe)],gr);const t2=gr;let r_=class extends wx{constructor(t,e){super(t,e),this.messages=null,this.showMoreResultsOpen=!1,this.viewModel=null}destroy(){this.viewModel=null}render(){const t={[Jm.showMoreResults]:this.showMoreResultsOpen};return mt("div",{class:Jm.base},mt("div",{key:"esri-search-renderer__container",class:this.classes(Jm.moreResults,t)},this.renderSearchResultName(),this.renderMoreResults()))}renderMoreResults(){return mt("div",{key:"esri-search-renderer__more-results"},this.renderMoreResultsButton(),this.renderMoreResultsLists())}renderSearchResultName(){const t=this.viewModel?.selectedResult,e=t&&t.name||"";return mt("div",{key:"esri-search-renderer__result-name",class:Jm.moreResultsItem},e)}renderMoreResultsLists(){const{viewModel:t}=this;if(!t)return[];const e=t.results;if((t.resultCount??0)<2)return null;const r=e?.map(i=>this.renderMoreResultsList(i));return mt("div",{key:"esri-search-renderer__more-results-container",class:Jm.moreResultsList},r)}renderMoreResultsButton(){const{messages:t,viewModel:e}=this;return e?(e.resultCount??0)<2?null:mt("div",{key:"esri-search-renderer__more-results-button",class:Jm.moreResultsItem},mt("a",{class:Jm.anchor,href:"#",bind:this,onclick:this._showMoreResultsClick,onkeydown:this._showMoreResultsClick},this.showMoreResultsOpen?t.hideMoreResults:t.showMoreResults)):null}renderMoreResultsHeader(t,e){return mt("div",{key:`esri-search-result-renderer__header-${e}`,class:Jm.moreResultsListHeader},t)}renderMoreResultsList(t){const{results:e}=t,r=e?.length??0,i=r>0,s=this.viewModel?.selectedResult,n=r===1&&e[0]===s,o=this._getSourceName(t.source,t.sourceIndex),a=(this.viewModel?.results?.length??0)>1&&!n?this.renderMoreResultsHeader(o,t.sourceIndex):null,l=i&&e.map((h,p)=>this.renderMoreResultsListItem(h,p)),c=i&&!n?mt("ul",{key:`esri-search-result-renderer__list-${t.sourceIndex}`},l):null;return i?mt("div",{key:`esri-search-result-renderer__results-${t.sourceIndex}`},a,c):null}renderMoreResultsListItem(t,e){return t!==this.get("viewModel.selectedResult")?mt("li",{key:`esri-search-result-renderer__list-item-${e}`},mt("a",{class:Jm.anchor,href:"#",tabindex:"0",bind:this,"data-result":t,onclick:this._selectResultClick,onkeydown:this._selectResultClick},t.name)):null}_showMoreResultsClick(t){t.preventDefault(),this.showMoreResultsOpen=!this.showMoreResultsOpen;const e=this.get("viewModel.view.popup");e&&e.reposition()}_selectResultClick(t){t.preventDefault();const e=t.currentTarget["data-result"];this.viewModel?.select(e)}_getSourceName(t,e){return e===t2.ALL_INDEX?this.messages.all:t.name}};u([d(),Jw("esri/widgets/Search/t9n/Search")],r_.prototype,"messages",void 0),u([d()],r_.prototype,"showMoreResultsOpen",void 0),u([d()],r_.prototype,"viewModel",void 0),u([$E()],r_.prototype,"_showMoreResultsClick",null),u([$E()],r_.prototype,"_selectResultClick",null),r_=u([P("esri.widgets.Search.SearchResultRenderer")],r_);const HMt=r_;function qMt(t){return e=>{e.hasOwnProperty("_delegatedEventNames")||(e._delegatedEventNames=e._delegatedEventNames?e._delegatedEventNames.slice():[]);const r=e._delegatedEventNames,i=Array.isArray(t)?t:WMt(t);r.push(...i)}}function WMt(t){return t.split(",").map(e=>e.trim())}const XMt=/<[a-z/][\s\S]*>/i,ZMt=(t,e)=>{const r=r$e(e).split(/\s/),i=new RegExp(`(${r.join("|")})`,"gi");return t.replace(i,s=>`<strong>${s}</strong>`)};let yr=class extends wx{constructor(t,e){super(t,e),this._activeMenuItemIndex=-1,this._inputNode=null,this._menuItemCount=0,this._sourceMenuButtonNode=null,this._sourceListNode=null,this._suggestionListNode=null,this._searchResultRenderer=new HMt,this._suggestController=null,this._searchController=null,this._locateFailed=!1,this._container=null,this.activeMenu="none",this.disabled=!1,this.iconClass=Et.widgetIcon,this.icon=null,this.messages=null,this.messagesCommon=null,this.viewModel=new t2,this._clearActiveMenu=()=>{this.activeMenu="none"},this._removeActiveMenu=r=>{const i=r.relatedTarget;i&&this._container?.contains(i)||this._clearActiveMenu()},this.addHandles([ae(()=>this.searchTerm,r=>{(r&&this.activeMenu==="warning"||!r&&!this.get("viewModel.selectedSuggestion.location"))&&this._clearActiveMenu()}),fa(()=>this.viewModel?.allSources,"change",()=>this._watchSourceChanges()),ae(()=>this.activeMenu,()=>this._resetActiveMenuItemIndex(),Pr),ae(()=>this.viewModel?.defaultPopupTemplate,r=>{r&&(r.content=this._renderSearchResultsContent.bind(this))},Pr)])}destroy(){this.removeAllHandles(),this._cancelSuggest(),this._cancelSearch(),this._searchResultRenderer=$e(this._searchResultRenderer)}get displayedSearchTerm(){return`${this.viewModel.searchTerm}`.trim()}get inputId(){return this._buildId("input")}get suggestionsMenuId(){return this._buildId("suggest-menu")}get sourceMenuId(){return this._buildId("source-menu")}get sourceMenuButtonId(){return this._buildId("source-menu-button")}get activeSource(){return this.viewModel?.activeSource}get activeSourceIndex(){return this.viewModel.activeSourceIndex}set activeSourceIndex(t){this.viewModel.activeSourceIndex=t}get allPlaceholder(){return this.viewModel.allPlaceholder}set allPlaceholder(t){this.viewModel.allPlaceholder=t}get allSources(){return this.viewModel.allSources}get autoNavigate(){return this.viewModel.autoNavigate}set autoNavigate(t){this.viewModel.autoNavigate=t}get autoSelect(){return this.viewModel.autoSelect}set autoSelect(t){this.viewModel.autoSelect=t}get defaultSources(){return this.viewModel.defaultSources}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(t){this.viewModel.goToOverride=t}get includeDefaultSources(){return this.viewModel.includeDefaultSources}set includeDefaultSources(t){this.viewModel.includeDefaultSources=t}get label(){return this.messages?.widgetLabel??""}set label(t){this._overrideIfSome("label",t)}get locationEnabled(){return this.viewModel.locationEnabled}set locationEnabled(t){this.viewModel.locationEnabled=t}get maxResults(){return this.viewModel.maxResults}set maxResults(t){this.viewModel.maxResults=t}get maxSuggestions(){return this.viewModel.maxSuggestions}set maxSuggestions(t){this.viewModel.maxSuggestions=t}get minSuggestCharacters(){return this.viewModel.minSuggestCharacters}set minSuggestCharacters(t){this.viewModel.minSuggestCharacters=t}get popupEnabled(){return this.viewModel.popupEnabled}set popupEnabled(t){this.viewModel.popupEnabled=t}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(t){this.viewModel.popupTemplate=t}get portal(){return this.viewModel?.portal}set portal(t){this.viewModel&&(this.viewModel.portal=t)}get resultGraphic(){return this.viewModel.resultGraphic}set resultGraphic(t){this.viewModel.resultGraphic=t}get resultGraphicEnabled(){return this.viewModel.resultGraphicEnabled}set resultGraphicEnabled(t){this.viewModel.resultGraphicEnabled=t}get results(){return this.viewModel.results}get searchAllEnabled(){return this.viewModel.searchAllEnabled}set searchAllEnabled(t){this.viewModel.searchAllEnabled=t}get searchTerm(){return this.viewModel.searchTerm}set searchTerm(t){this.viewModel.searchTerm=t}get selectedResult(){return this.viewModel.selectedResult}get sources(){return this.viewModel.sources}set sources(t){this.viewModel.sources=t}get suggestions(){return this.viewModel.suggestions}get suggestionsEnabled(){return this.viewModel.suggestionsEnabled}set suggestionsEnabled(t){this.viewModel.suggestionsEnabled=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}clear(){this.viewModel.clear()}focus(){this._inputNode?.focus(),this.emit("search-focus")}blur(){this._inputNode?.blur(),this.emit("search-blur")}async search(t){this._clearActiveMenu(),this._cancelSuggest(),this._cancelSearch();const e=new AbortController,{signal:r}=e;this._searchController=e;try{const i=await this.viewModel.search(t,{signal:r});return this._searchController!==e?void 0:(this.activeMenu=i?.numResults?"none":"warning",this._searchController=null,i)}catch{return this._searchController!==e?void 0:(this._clearActiveMenu(),void(this._searchController=null))}}async suggest(t){this._cancelSuggest();const e=new AbortController,{signal:r}=e;this._suggestController=e;try{const i=await this.viewModel.suggest(t,null,{signal:r});return this._suggestController!==e?void 0:(this._suggestController=null,i?.numResults&&this._openSuggestionMenu(),this._scrollToTopSuggestion(),i)}catch{return this._suggestController!==e||(this._suggestController=null),null}}render(){const{state:t}=this.viewModel,e={[Et.disabled]:t==="disabled",[Et.esriWidgetDisabled]:this.disabled};return mt("div",{class:this.classes(Et.base,e)},t==="loading"?this.renderLoader():this.renderContainer())}renderSubmitButton(){const{messages:t,disabled:e}=this;return mt("button",{"aria-label":t.searchButtonTitle,bind:this,disabled:e,class:this.classes(Et.submitButton,Et.button),key:"esri-search__submit-button",onclick:this._handleSearchButtonClick,title:t.searchButtonTitle,type:"button"},mt("span",{"aria-hidden":"true",class:Et.searchIcon}))}renderWarningMenu(){return mt("div",{key:"esri-search__error-menu",class:this.classes(Et.menu,Et.warningMenu)},mt("div",{class:Et.warningMenuBody},this.renderWarning()))}renderSourceMenuButton(){const{messages:t,activeMenu:e,sourceMenuId:r,sourceMenuButtonId:i,disabled:s}=this,{activeSourceIndex:n,allSources:o}=this.viewModel;return o.length>1?mt("button",{id:i,key:"esri-search__source-menu-button",bind:this,disabled:s,"aria-label":t.searchIn,title:t.searchIn,"aria-haspopup":"true","aria-expanded":(e==="source").toString(),"aria-controls":r,class:this.classes(Et.sourcesButton,Et.button),onclick:this._handleSourcesMenuToggleClick,onfocus:this._handleSourcesMenuToggleFocus,afterCreate:OI,"data-node-ref":"_sourceMenuButtonNode",type:"button"},mt("span",{"aria-hidden":"true",class:Et.dropdownIcon}),mt("span",{"aria-hidden":"true",class:Et.dropupIcon}),mt("span",{class:Et.sourceName},this._getSourceName(n))):null}renderSourcesList(){const{allSources:t,searchAllEnabled:e}=this.viewModel,{_activeMenuItemIndex:r,activeMenu:i,sourceMenuId:s,sourceMenuButtonId:n}=this,o=i==="source"&&r>-1?this._buildId("source-item",r):null;return t.length>1?mt("ul",{"aria-activedescendant":o,"aria-labelledby":n,id:s,role:"menu",bind:this,afterCreate:OI,onkeydown:this._handleSourceMenuKeydown,onkeyup:this._handleSourceMenuKeyup,"data-node-ref":"_sourceListNode",class:Et.menuList,tabIndex:-1},e?this.renderSource(t2.ALL_INDEX):null,t.map((a,l)=>this.renderSource(l)).toArray()):null}renderSourcesMenu(){const{allSources:t}=this.viewModel;return t.length>1?mt("div",{key:"esri-search__source-menu",class:this.classes(Et.menu,Et.sourcesMenu)},this.renderSourcesList()):null}renderLoader(){const{messages:t,messagesCommon:e,disabled:r}=this;return mt("div",{class:Et.loader,key:"base-loader",tabIndex:r?-1:void 0},mt("span",{"aria-hidden":"true",class:Et.loaderAnimation}),mt("span",{class:Et.fallbackText},t.searchButtonTitle),mt("span",{class:Et.loaderText},e.loading))}renderContainer(){const{allSources:t,state:e}=this.viewModel,{activeMenu:r}=this,i={[Et.hasMultipleSources]:t.length>1,[Et.isLoading]:e==="loading",[Et.isSearching]:e==="searching",[Et.showWarning]:r==="warning",[Et.showSources]:r==="source",[Et.showSuggestions]:r==="suggestion"};return mt("div",{tabIndex:-1,afterCreate:s=>{this._container=s,s.addEventListener("focusout",this._removeActiveMenu)},afterRemoved:s=>{s.removeEventListener("focusout",this._removeActiveMenu)},class:this.classes(i,Et.container),key:"base-container"},this.renderSourceMenuButton(),this.renderSourcesMenu(),this.renderInputContainer(),this.renderSubmitButton(),this.renderWarningMenu())}renderClearButton(){return this.searchTerm?mt("button",{bind:this,disabled:this.disabled,class:this.classes(Et.clearButton,Et.button),key:"esri-search__clear-button",onclick:this._handleClearButtonClick,onfocus:this._clearActiveMenu,title:this.messages.clearButtonTitle,type:"button"},mt("span",{"aria-hidden":"true",class:Et.clearIcon})):null}renderLocationGroup(){const{messages:t,locationEnabled:e,displayedSearchTerm:r}=this,i=e&&!r,s=this.activeMenu==="suggestion"&&this._activeMenuItemIndex===0;return i?mt("ul",{role:"group",key:"esri-search__suggestion-list-current-location",class:this.classes(Et.menuList,Et.suggestionList,Et.suggestionListCurrentLocation)},mt("li",{bind:this,"data-current-location-item":!0,onclick:this._handleUseCurrentLocationClick,id:this._buildId("suggestion-item",0),"aria-selected":(this.activeMenu==="suggestion"&&this._activeMenuItemIndex===0).toString(),role:"option",class:this.classes(Et.menuItem,s?Et.menuItemFocus:null)},mt("span",{"aria-hidden":"true",class:Et.locate})," ",t.useCurrentLocation)):null}renderInput(){const{activeMenu:t,locationEnabled:e,displayedSearchTerm:r,messages:i,suggestionsMenuId:s,inputId:n,_activeMenuItemIndex:o,disabled:a}=this,{maxInputLength:l,placeholder:c,searchTerm:h,suggestionCount:p}=this.viewModel,f=!(!(e&&!r)&&!p),m=t==="suggestion"&&o>-1?this._buildId("suggestion-item",o):null;return mt("input",{"aria-activedescendant":m,"aria-autocomplete":"list","aria-expanded":(f&&t==="suggestion").toString(),"aria-controls":f?s:null,"aria-haspopup":"listbox","aria-label":i.searchButtonTitle,bind:this,disabled:a,placeholder:c,maxlength:l,autocomplete:"off",type:"text",class:this.classes(Et.esriInput,Et.input),value:h,id:n,role:"combobox",onkeyup:this._handleInputKeyup,onclick:this._openSuggestionMenu,oninput:this._handleInputPaste,onpaste:this._handleInputPaste,afterCreate:OI,"data-node-ref":"_inputNode",onfocus:this.focus,onblur:this.blur,title:h?"":c})}renderForm(){return mt("form",{key:"esri-search__form",bind:this,disabled:this.disabled,class:Et.form,onsubmit:this._formSubmit,role:"search"},this.renderInput())}renderSuggestList(t){const{sourceIndex:e}=t,{results:r}=t;return r?.length?mt("ul",{role:"group",key:`esri-search__suggestion-list-${e}`,class:this.classes(Et.menuList,Et.suggestionList)},r?.map(s=>this.renderSuggestion(s,this._menuItemCount++))):null}renderSuggestionsGroup(){const{suggestions:t}=this.viewModel;return t?t.map(e=>[this.renderSuggestionHeader(e),this.renderSuggestList(e)]):[]}renderSuggestionsMenu(){const{displayedSearchTerm:t,locationEnabled:e,suggestionsMenuId:r,inputId:i}=this,{suggestionCount:s}=this.viewModel,n=e&&!t||s;return this._menuItemCount=0,n?mt("div",{id:r,key:"esri-search__suggestions-menu",class:this.classes(Et.menu,Et.suggestionsMenu),role:"listbox","aria-labelledby":i,bind:this,afterCreate:OI,"data-node-ref":"_suggestionListNode"},this.renderLocationGroup(),this.renderSuggestionsGroup()):null}renderInputContainer(){return mt("div",{key:"esri-search__input-container",class:Et.inputContainer},this.renderForm(),this.renderSuggestionsMenu(),this.renderClearButton())}renderSuggestionHeader(t){const{allSources:e,activeSourceIndex:r}=this.viewModel,{sourceIndex:i}=t,s=t.results?.length,n=e.length>1&&r===t2.ALL_INDEX;return s&&n?mt("div",{key:`esri-search__suggestion-header-${i}`,class:Et.menuHeader},this._getSourceName(i)):null}renderSuggestion(t,e){const{_activeMenuItemIndex:r,viewModel:{searchTerm:i}}=this;if(!i)return;const s=this.activeMenu==="suggestion"&&r===e;return mt("li",{bind:this,id:this._buildId("suggestion-item",e),"aria-selected":(this.activeMenu==="suggestion"&&this._activeMenuItemIndex===e).toString(),onclick:this._handleSuggestionClick,key:`esri-search__suggestion_${e}`,"data-suggestion":t,role:"option",innerHTML:this._getSuggestResultHTML(t.text,i),class:this.classes(Et.menuItem,s?Et.menuItemFocus:null)})}renderSource(t){const{activeSourceIndex:e,searchAllEnabled:r}=this.viewModel,i={[Et.menuItemActive]:t===e,[Et.menuItemFocus]:this.activeMenu==="source"&&t===(r?this._activeMenuItemIndex-1:this._activeMenuItemIndex)},s=r?t+1:t;return mt("li",{bind:this,key:`esri-search__source-${t}`,id:this._buildId("source-item",s),"aria-checked":(t===e).toString(),onclick:this._handleSourceClick,"data-source-index":t,role:"menuitemradio",class:this.classes(Et.source,Et.menuItem,i)},this._getSourceName(t))}renderNoResultsWarning(t){const{messages:e}=this,r=t?nve(e.noResultsFoundForValue,{value:`"${t}"`}):e.noResultsFound;return mt("div",{key:"esri-search__no_results"},mt("div",{class:Et.warningMenuHeader},e.noResults),mt("div",{class:Et.warningMenuText},r))}renderEmptySearchWarning(){const{messages:t}=this;return mt("div",{key:"esri-search__empty-search"},mt("span",{"aria-hidden":"true",class:Et.noticeIcon}),mt("span",{class:Et.noValueText},t.emptyValue))}renderLocateWarning(){const{messages:t}=this;return mt("div",{key:"esri-search__locate-error"},mt("span",{"aria-hidden":"true",class:Et.noticeIcon}),mt("span",{class:Et.noValueText},t.locateError))}renderWarning(){const{displayedSearchTerm:t,_locateFailed:e}=this,{viewModel:r}=this;return e?this.renderLocateWarning():r.selectedSuggestion?.location||t?this.renderNoResultsWarning(t):this.renderEmptySearchWarning()}_resetActiveMenuItemIndex(){this._activeMenuItemIndex=-1}_buildId(t,e){return`${this.id}-${t}${e===void 0?"":`-${e}`}`}_watchSourceChanges(){const{viewModel:{allSources:t}}=this,e="sources";this.removeHandles(e),t.forEach(r=>this.addHandles(ae(()=>r.name,()=>this.scheduleRender()),e))}_handleSourcesMenuToggleFocus(){this.activeMenu!=="source"&&this._clearActiveMenu()}_handleSourcesMenuToggleClick(){const t=this.activeMenu==="source";this.activeMenu=t?"none":"source",this.renderNow(),this.activeMenu==="source"&&this._sourceListNode?.focus()}_handleClearButtonClick(){this.viewModel.clear(),this._focus()}_handleSearchButtonClick(){this.search()}_handleSuggestionClick(t){const e=nfe(t.currentTarget);e&&(this._focus(),this.search(e))}_handleUseCurrentLocationClick(){this._useCurrentLocation()}_useCurrentLocation(){this._focus("none"),this._cancelSuggest(),this._cancelSearch();const t=new AbortController,{signal:e}=t;this._searchController=t,(async()=>{try{const r=await this.viewModel.searchNearby({signal:e});this.activeMenu=r?.numResults?"none":"warning"}catch{this._locateFailed=!0,this.activeMenu="warning"}finally{this._searchController=null}})()}_handleSourceClick(t){this._setSourceFromMenuItem(t.currentTarget)}_setSourceFromMenuItem(t){if(!t)return;const e=YMt(t);e!=null&&(this.viewModel.activeSourceIndex=e,this._clearActiveMenu(),this._sourceMenuButtonNode?.focus())}_cancelSuggest(){this._suggestController=Ll(this._suggestController)}_cancelSearch(){this._searchController=Ll(this._searchController),this._locateFailed=!1}_handleInputKeyup(t){const e=VL(t);if(t.ctrlKey||t.metaKey||e==="Copy"||e==="ArrowLeft"||e==="ArrowRight"||e==="Shift")return;if(e==="Tab"||e==="Escape"||t.shiftKey&&e==="Tab")return this._cancelSuggest(),void(e==="Escape"&&this._clearActiveMenu());const r=e==="Home"||e==="End"||e==="ArrowUp"||e==="ArrowDown";if(e==="Enter"&&this._activeMenuItemIndex<0)return void this._cancelSuggest();const i=this._suggestionListNode?.getElementsByTagName("li");if(i?.length){if(this.activeMenu!=="suggestion"&&this._openSuggestionMenu(),r)return t.preventDefault(),this._cancelSuggest(),void this._handleItemNavigation(e,i,this._suggestionListNode);const s=i[this._activeMenuItemIndex];if(e==="Enter"&&s){const n=nfe(s);return void(n?(this._focus(),this.search(n)):JMt(s)&&this._useCurrentLocation())}}this.viewModel.searchTerm&&this.suggest()}_handleItemNavigation(t,e,r){const i=this._activeMenuItemIndex;t==="Home"&&(this._activeMenuItemIndex=0),t==="End"&&(this._activeMenuItemIndex=e.length-1),t==="ArrowUp"&&(this._activeMenuItemIndex=this._activeMenuItemIndex<=0?e.length-1:this._activeMenuItemIndex-1),t==="ArrowDown"&&(this._activeMenuItemIndex=this._activeMenuItemIndex===e.length-1?0:this._activeMenuItemIndex+1),i!==this._activeMenuItemIndex&&r&&RXe(e[this._activeMenuItemIndex],r)}_scrollToTopSuggestion(){this._suggestionListNode&&(this._suggestionListNode.scrollTop=0)}_openSuggestionMenu(){this.activeMenu="suggestion"}_handleInputPaste(t){const e=t.target;this.viewModel.searchTerm!==e.value&&(this.viewModel.searchTerm=e.value),this.viewModel.searchTerm&&this.suggest()}_handleSourceMenuKeydown(t){const e=VL(t);if(exe(e)){t.preventDefault();const r=this._sourceListNode?.getElementsByTagName("li"),i=r?.[this._activeMenuItemIndex];this._setSourceFromMenuItem(i)}else e!=="ArrowUp"&&e!=="ArrowDown"&&e!=="End"&&e!=="Home"||t.preventDefault()}_handleSourceMenuKeyup(t){const e=VL(t),r=e==="ArrowUp"||e==="ArrowDown"||e==="End"||e==="Home";if(r&&t.preventDefault(),e==="Escape")return this._clearActiveMenu(),void this._sourceMenuButtonNode?.focus();const i=this._sourceListNode?.getElementsByTagName("li");return i&&i.length!==0&&r?(this.activeMenu!=="source"&&(this.activeMenu="source"),void this._handleItemNavigation(e,i,this._sourceListNode?.parentElement)):void 0}_focus(t){this.focus(),t&&(this.activeMenu=t)}_formSubmit(t){t.preventDefault(),this._activeMenuItemIndex===-1&&this.search()}_getSourceName(t){const{messages:e}=this,r=this.viewModel,{allSources:i}=r,s=i.at(t);return t===t2.ALL_INDEX?e.all:s&&s.name||e.untitledSource}_getSuggestResultHTML(t,e){return t?XMt.test(t)?t:ZMt(t,e):this.messages.untitledResult}_renderSearchResultsContent(){return this._searchResultRenderer.showMoreResultsOpen=!1,this._searchResultRenderer.viewModel=this.viewModel,this._searchResultRenderer}};function nfe(t){return t?.["data-suggestion"]}function YMt(t){return t?.["data-source-index"]}function JMt(t){return!!t?.["data-current-location-item"]}u([d()],yr.prototype,"_activeMenuItemIndex",void 0),u([d()],yr.prototype,"displayedSearchTerm",null),u([d({readOnly:!0})],yr.prototype,"inputId",null),u([d({readOnly:!0})],yr.prototype,"suggestionsMenuId",null),u([d({readOnly:!0})],yr.prototype,"sourceMenuId",null),u([d({readOnly:!0})],yr.prototype,"sourceMenuButtonId",null),u([d()],yr.prototype,"activeMenu",void 0),u([d({readOnly:!0})],yr.prototype,"activeSource",null),u([d()],yr.prototype,"activeSourceIndex",null),u([d()],yr.prototype,"allPlaceholder",null),u([d({readOnly:!0})],yr.prototype,"allSources",null),u([d()],yr.prototype,"autoNavigate",null),u([d()],yr.prototype,"autoSelect",null),u([d({readOnly:!0})],yr.prototype,"defaultSources",null),u([d()],yr.prototype,"disabled",void 0),u([d()],yr.prototype,"goToOverride",null),u([d()],yr.prototype,"iconClass",void 0),u([d()],yr.prototype,"icon",void 0),u([d()],yr.prototype,"includeDefaultSources",null),u([d()],yr.prototype,"label",null),u([d()],yr.prototype,"locationEnabled",null),u([d()],yr.prototype,"maxResults",null),u([d()],yr.prototype,"maxSuggestions",null),u([d(),Jw("esri/widgets/Search/t9n/Search")],yr.prototype,"messages",void 0),u([d(),Jw("esri/t9n/common")],yr.prototype,"messagesCommon",void 0),u([d()],yr.prototype,"minSuggestCharacters",null),u([d()],yr.prototype,"popupEnabled",null),u([d()],yr.prototype,"popupTemplate",null),u([d()],yr.prototype,"portal",null),u([d()],yr.prototype,"resultGraphic",null),u([d()],yr.prototype,"resultGraphicEnabled",null),u([d({readOnly:!0})],yr.prototype,"results",null),u([d()],yr.prototype,"searchAllEnabled",null),u([d()],yr.prototype,"searchTerm",null),u([d({readOnly:!0})],yr.prototype,"selectedResult",null),u([d()],yr.prototype,"sources",null),u([d({readOnly:!0})],yr.prototype,"suggestions",null),u([d()],yr.prototype,"suggestionsEnabled",null),u([d()],yr.prototype,"view",null),u([qMt(["search-complete","search-clear","search-start","select-result","suggest-start","suggest-complete"]),d({type:t2})],yr.prototype,"viewModel",void 0),yr=u([P("esri.widgets.Search")],yr);const QMt=yr;function TIe(t){const e={};for(const r of Object.keys(t.attributes))e[r.toLowerCase()]=t.attributes[r];t.attributes=e}async function KMt(t){try{return await t}catch(e){if(!us(e))throw e;return}}function ePt(t,e,r,i){const s=new QMt({view:t,sources:[new Nb({layer:e,outFields:["*"],autoNavigate:!0,searchFields:[r],displayField:r,exactMatch:!1,placeholder:"Ex: Empire State Building",popupEnabled:!1})],maxResults:10,resultGraphicEnabled:!1,includeDefaultSources:!1});s.on("select-result",function(n){const o=n.result.feature;TIe(o),i.selectedBuilding=o}),t.ui.add(s,{position:"top-right"})}function tPt(){SIe().style.display="inline"}function rPt(){SIe().style.display="none"}function SIe(){return document.querySelector(".esri-component.esri-search.esri-widget")}const BN={view:"viewDiv",timeline:"timeDiv",heightGraph:"heightDiv",categories:"categoryDiv"},tp=new ex;let eX,FE,ofe,FL=null;const tee=new eye({basemap:"gray-vector",ground:"world-elevation"}),sm=new Q2t({container:BN.view,map:tee,padding:{top:50},camera:{position:{x:-8.2408269778516665e6,y:496775695441402e-8,z:1472.4,spatialReference:new je({wkid:3857})},heading:59,tilt:49},constraints:{tilt:{max:90,mode:"manual"}},highlightOptions:Mi.highlightOptions,popup:{dockEnabled:!0,dockOptions:{buttonEnabled:!1,breakpoint:!1},actions:[],autoOpenEnabled:!1},environment:{lighting:{directShadowsEnabled:!0}}});sm.ui.empty("top-left");const iPt=[Mi.buildingOptions.minHeight,Mi.buildingOptions.maxHeight],sPt=EIe(iPt),h8=new _we({url:Mi.buildingsUrl,popupEnabled:!1,outFields:["*"],definitionExpression:sPt}),ree=new vOt(h8,"CNSTRCT_YR"),tx=new $R({url:Mi.infoPointsUrl,popupEnabled:!1,elevationInfo:{mode:"relative-to-scene"},outFields:["*"],returnZ:!1,featureReduction:{type:"selection"},renderer:ree.createUniqueValueRenderer("WIKI",{value:1,image:"./wiki.png"}),visible:!1});tee.addMany([h8,tx]);XRt("./data/manhattan-boroughs.json",tee);ePt(sm,tx,"NAME",tp);const iee=tx.createQuery();iee.outFields=["OBJECTID","NAME","HEIGHTROOF","CNSTRCT_YR","WIKI","TOP20"];iee.returnGeometry=!0;tx.queryFeatures(iee).then(nPt).catch(console.error);function nPt(t){for(let e=0;e<t.features.length;e++)TIe(t.features[e]);eX=t.features,TOt(BN.categories,tp),FE=new _Ot(BN.heightGraph,eX,tp),ofe=new xOt(BN.timeline,tp),ae(()=>tp.selectedPeriod,e=>{ree.applyClassBreaksRenderer(e,tp),FE.updatePeriod(e),ofe.update(e)},{initial:!0})}sm.whenLayerView(h8).then(t=>{let e;ae(()=>tp.selectedBuilding,r=>{e?.abort(),e=new AbortController;const{signal:i}=e;KMt(oPt(r,t,i))})}).catch(console.error);async function oPt(t,e,r){if(FL&&(FE.deselect(),FL.remove(),FL=null,tPt()),t){rPt(),HRt(t.geometry,t.attributes,sm),FE.select(t),FL=e.highlight([t.attributes.objectid]),await sm.goTo(t.geometry,{duration:1e3,easing:"out-expo",signal:r}),await ay(()=>!e.updating,r);const i=new Ty;i.outFields=["*"],i.objectIds=[t.attributes.objectid];const s=await e.queryExtent(i,{signal:r}),n=o=>{if(r.aborted)return;const a=document.getElementById("loading");o.extent!==null?(a.style.display="none",sm.goTo({target:o.extent.expand(3),tilt:60},{duration:1e3,easing:"out-expo",signal:r})):(a.style.display="inline",e.queryExtent(i,{signal:r}).then(l=>{window.setTimeout(()=>n(l),1e3)}))};n(s)}}Cu(()=>tp.filteredBuildings,function(t){const e=EIe(t);h8.definitionExpression=e,tx.definitionExpression=e,FE.updateFilter(t)});ae(()=>tp.selectedCategory,t=>{ree.applyCategory(t),FE.applyCategory(t),t==="info"?tx.visible=!0:tx.visible=!1});sm.on("click",function(t){sm.hitTest(t).then(function(e){if(e.results.length===0)return;const r=e.results[0],i=r.type==="graphic"?r.graphic:null;if(i&&i.layer.title==="Buildings Manhattan wiki"){const s=aPt(i);s&&(tp.selectedBuilding=s)}})});ae(()=>sm.popup?.visible,t=>{const e=!!sm.popup.content;!t&&e&&(tp.selectedBuilding=null)});function aPt(t){return eX.filter(function(r){return r.attributes.objectid===t.attributes.OBJECTID})[0]}document.getElementById("impressumLink").addEventListener("click",function(){document.getElementById("impressumContainer").style.display="inline"});document.getElementById("close").addEventListener("click",function(){document.getElementById("impressumContainer").style.display="none"});function EIe(t){return"HEIGHTROOF > "+t[0]+" AND HEIGHTROOF < "+t[1]+" AND CNSTRCT_YR >= 1900 AND CNSTRCT_YR <= 2024"}export{Lnt as $,jRe as A,ubt as B,yTe as C,PF as D,NJe as E,put as F,Lct as G,Uct as H,RK as I,GQ as J,k0t as K,U0t as L,e8 as M,z0t as N,DF as O,$lt as P,jbt as Q,YRe as R,zYe as S,Wbt as T,KRe as U,M1t as V,Zbt as W,rMe as X,lut as Y,s8 as Z,UOe as _,fTe as a,gw as a$,awt as a0,gwt as a1,Awt as a2,Rwt as a3,Pwt as a4,_ct as a5,iMe as a6,uwt as a7,Xwt as a8,Dht as a9,Pt as aA,yw as aB,Nl as aC,uFe as aD,hFe as aE,Xf as aF,Ii as aG,Pr as aH,$e as aI,u as aJ,d as aK,yu as aL,P as aM,t6 as aN,mte as aO,we as aP,ce as aQ,Cze as aR,aIt as aS,To as aT,MIt as aU,lm as aV,Cu as aW,H_ as aX,hme as aY,ae as aZ,qr as a_,ddt as aa,Fft as ab,imt as ac,Jft as ad,Q as ae,cX as af,Eie as ag,jX as ah,V as ai,nDt as aj,DIe as ak,$R as al,bc as am,Yb as an,Js as ao,cx as ap,lDt as aq,aDt as ar,r7e as as,PIt as at,ULt as au,FLt as av,xo as aw,K as ax,a4e as ay,n4e as az,FTe as b,cfe as b$,Uq as b0,o0t as b1,Is as b2,jE as b3,Ll as b4,An as b5,JO as b6,el as b7,fa as b8,Q5 as b9,it as bA,le as bB,e6 as bC,je as bD,u2 as bE,Go as bF,wv as bG,Ne as bH,Uf as bI,bv as bJ,ax as bK,St as bL,OR as bM,lke as bN,us as bO,W8t as bP,X8t as bQ,hZ as bR,Eot as bS,my as bT,s8t as bU,Hkt as bV,zw as bW,fv as bX,Bt as bY,pPt as bZ,SV as b_,Xi as ba,N2 as bb,fPt as bc,Iu as bd,Ys as be,C as bf,He as bg,ME as bh,Sn as bi,qQ as bj,_x as bk,Dt as bl,ry as bm,Yt as bn,hr as bo,KBe as bp,eGe as bq,tGe as br,oe as bs,uve as bt,WU as bu,Ty as bv,ji as bw,O as bx,Ke as by,Me as bz,SQe as c,Si as c$,VM as c0,q1e as c1,rbe as c2,LLt as c3,AM as c4,ur as c5,q4 as c6,X2 as c7,N5 as c8,FDe as c9,ZVe as cA,pn as cB,U$t as cC,z8t as cD,Vt as cE,Pn as cF,Ic as cG,Cke as cH,VLt as cI,Dge as cJ,LGe as cK,Xb as cL,_w as cM,lZ as cN,aZ as cO,Qge as cP,cZ as cQ,KIt as cR,HIt as cS,IDt as cT,$ie as cU,PDt as cV,lHe as cW,ywe as cX,u5e as cY,Vqe as cZ,z5e as c_,Do as ca,UDe as cb,kDe as cc,zDe as cd,ve as ce,VZe as cf,ay as cg,S4t as ch,WBt as ci,dK as cj,v6 as ck,B5 as cl,ws as cm,_a as cn,mr as co,rx as cp,Dgt as cq,Nh as cr,qLe as cs,H7e as ct,ke as cu,R1e as cv,Qbe as cw,gLt as cx,si as cy,BL as cz,pKe as d,a5e as d$,Zs as d0,am as d1,ht as d2,ye as d3,se as d4,wR as d5,cNt as d6,TNt as d7,pre as d8,vt as d9,Fo as dA,Wyt as dB,fR as dC,Ae as dD,ux as dE,Zve as dF,ZD as dG,vee as dH,pp as dI,r$e as dJ,q1t as dK,W1t as dL,k1t as dM,Ajt as dN,r5 as dO,L7t as dP,Z1t as dQ,ADe as dR,qZ as dS,bze as dT,E5e as dU,Uat as dV,kat as dW,uZ as dX,UCe as dY,L8t as dZ,$8t as d_,Eqe as da,nNt as db,BVe as dc,I6 as dd,PR as de,hx as df,jf as dg,oj as dh,Os as di,nj as dj,lj as dk,U4 as dl,x1e as dm,IIt as dn,YR as dp,i4e as dq,ls as dr,WCe as ds,Ny as dt,vve as du,f1e as dv,W1e as dw,QZ as dx,Xyt as dy,Bi as dz,TKe as e,xHt as e$,mZ as e0,g$t as e1,y$t as e2,p$t as e3,m$t as e4,ua as e5,oFe as e6,D8t as e7,xat as e8,Tbe as e9,$u as eA,DM as eB,xv as eC,d7e as eD,dve as eE,PVe as eF,Fg as eG,LNt as eH,Tm as eI,vme as eJ,y7e as eK,rE as eL,Qi as eM,Zd as eN,iY as eO,du as eP,wr as eQ,VE as eR,SHt as eS,CHt as eT,THt as eU,NMe as eV,kHt as eW,ySt as eX,PHt as eY,hSt as eZ,lPt as e_,MA as ea,li as eb,Jr as ec,um as ed,Oc as ee,os as ef,k4 as eg,_m as eh,NLt as ei,O_e as ej,BP as ek,F8e as el,iIt as em,bIt as en,uI as eo,zre as ep,Pc as eq,GE as er,MVe as es,u7e as et,J1e as eu,gR as ev,Br as ew,Kve as ex,Yve as ey,Dc as ez,uat as f,T3 as f$,zHt as f0,Vze as f1,re as f2,Fe as f3,be as f4,Dfe as f5,RV as f6,S1e as f7,Gkt as f8,Jge as f9,kr as fA,Hd as fB,cve as fC,Eae as fD,hc as fE,pu as fF,wp as fG,g5t as fH,OM as fI,Ho as fJ,Ki as fK,Jb as fL,G5 as fM,ai as fN,da as fO,oy as fP,Li as fQ,gHt as fR,uB as fS,zLt as fT,vre as fU,O7e as fV,ibe as fW,z7e as fX,mwe as fY,Tb as fZ,th as f_,uR as fa,gv as fb,Z_ as fc,JDe as fd,ave as fe,Pi as ff,b6 as fg,vc as fh,aLt as fi,zM as fj,OE as fk,$r as fl,sy as fm,pze as fn,U2 as fo,tl as fp,Uee as fq,lIt as fr,yDt as fs,zIt as ft,a0t as fu,VNt as fv,R5 as fw,YXe as fx,Eu as fy,dte as fz,wJ as g,Jve as g$,E3 as g0,QVe as g1,H_e as g2,O6 as g3,_v as g4,tbe as g5,_qe as g6,vx as g7,c8t as g8,l8t as g9,fi as gA,ue as gB,bs as gC,LHe as gD,lp as gE,Op as gF,sw as gG,MNt as gH,VHe as gI,Fs as gJ,uPt as gK,fDe as gL,z2 as gM,AX as gN,PIe as gO,Gr as gP,pW as gQ,fW as gR,kIt as gS,hY as gT,h6 as gU,J_ as gV,MGe as gW,CGe as gX,jVe as gY,w4 as gZ,sye as g_,dv as ga,Pp as gb,aP as gc,Y_ as gd,J0t as ge,VTt as gf,GY as gg,yh as gh,gte as gi,ly as gj,br as gk,RM as gl,Qa as gm,rBe as gn,CDe as go,jUt as gp,_o as gq,lLt as gr,tke as gs,NS as gt,pj as gu,XUt as gv,FIt as gw,HUt as gx,Cc as gy,Fb as gz,_Qe as h,MF as h$,R6 as h0,sC as h1,V4 as h2,j7 as h3,y6 as h4,Xve as h5,EY as h6,ebe as h7,QFe as h8,JFe as h9,ap as hA,_s as hB,Qe as hC,di as hD,Vgt as hE,Ue as hF,bWe as hG,v_ as hH,Xs as hI,Ni as hJ,wo as hK,LJ as hL,uHt as hM,WVt as hN,$gt as hO,n2 as hP,$A as hQ,vR as hR,O8t as hS,Sr as hT,Mc as hU,Ml as hV,w as hW,ys as hX,Mu as hY,et as hZ,Pe as h_,wFe as ha,ite as hb,ma as hc,k7e as hd,uy as he,sE as hf,Ew as hg,D$t as hh,NO as hi,Uj as hj,V_ as hk,dB as hl,fte as hm,s2 as hn,nm as ho,hp,AR as hq,pY as hr,tBe as hs,eBe as ht,KVe as hu,U as hv,he as hw,Gi as hx,cr as hy,ti as hz,BCe as i,wOe as i$,Em as i0,ut as i1,Or as i2,Lc as i3,xe as i4,B as i5,mi as i6,Lr as i7,Rr as i8,Tr as i9,R5t as iA,M5t as iB,G4 as iC,One as iD,kze as iE,Mn as iF,Ove as iG,Xh as iH,Ka as iI,un as iJ,sY as iK,u5t as iL,ha as iM,hm as iN,Pl as iO,oi as iP,rv as iQ,ozt as iR,szt as iS,azt as iT,T6 as iU,nzt as iV,edt as iW,idt as iX,Ui as iY,tdt as iZ,rdt as i_,Mt as ia,Dy as ib,tU as ic,Ov as id,Ul as ie,AU as ig,Gt as ih,mm as ii,mv as ij,Rv as ik,MU as il,Vo as im,UQ as io,OU as ip,yC as iq,sct as ir,mJ as is,cQ as it,h5t as iu,Vw as iv,DU as iw,Wa as ix,PKe as iy,G9 as iz,Ww as j,Hve as j$,ko as j0,Oqe as j1,rNt as j2,aNt as j3,VIt as j4,hwe as j5,rSe as j6,TNe as j7,V2 as j8,JUt as j9,Z2 as jA,k$t as jB,vs as jC,vPt as jD,Ow as jE,oDt as jF,n1e as jG,hX as jH,Aw as jI,eS as jJ,oBe as jK,fDt as jL,i1e as jM,mw as jN,qN as jO,eY as jP,BE as jQ,kM as jR,bBe as jS,kke as jT,xy as jU,g6 as jV,HZ as jW,eDt as jX,KLt as jY,QLt as jZ,kBe as j_,S_ as ja,TWe as jb,lfe as jc,Sqe as jd,$F as je,Di as jf,Nt as jg,Oh as jh,de as ji,pce as jj,ZS as jk,_5t as jl,ze as jm,Us as jn,IIe as jo,Su as jp,mPt as jq,FPt as jr,qfe as js,oX as jt,Kr as ju,Uh as jv,w1e as jw,b8 as jx,Hte as jy,t$t as jz,g_t as k,uU as k$,TBe as k0,EBe as k1,gve as k2,aBe as k3,lBe as k4,cBe as k5,hBe as k6,dBe as k7,pBe as k8,fBe as k9,x3e as kA,S3e as kB,Gu as kC,eR as kD,hw as kE,h3e as kF,apt as kG,Kht as kH,Wat as kI,zCe as kJ,NIt as kK,Zat as kL,Fdt as kM,Pdt as kN,Idt as kO,kdt as kP,Ldt as kQ,Ddt as kR,Ep as kS,$dt as kT,ga as kU,Udt as kV,YM as kW,lU as kX,dn as kY,Xat as kZ,Ndt as k_,mBe as ka,gBe as kb,yBe as kc,_Be as kd,vBe as ke,K1e as kf,DLt as kg,FLe as kh,UHt as ki,FHt as kj,ext as kk,qGe as kl,H5 as km,rZ as kn,C8 as ko,zr as kp,sNt as kq,or as kr,wc as ks,IZ as kt,LHt as ku,_2t as kv,$Ht as kw,VHt as kx,IHt as ky,lne as kz,clt as l,Ekt as l$,Hh as l0,Cv as l1,R2 as l2,rl as l3,pT as l4,YUt as l5,GVe as l6,r6 as l7,d$t as l8,l$t as l9,y_ as lA,Ji as lB,L as lC,hIt as lD,wM as lE,Ibe as lF,Bs as lG,UM as lH,Dj as lI,_Pt as lJ,ix as lK,XU as lL,qU as lM,Nwe as lN,QPt as lO,F8t as lP,N8t as lQ,IEe as lR,BUt as lS,Nge as lT,T1e as lU,kf as lV,Jkt as lW,Wq as lX,$Pt as lY,bmt as lZ,JLe as l_,u$t as la,c$t as lb,h$t as lc,xR as ld,_u as le,_$t as lf,qEe as lg,k5 as lh,iy as li,_ee as lj,nW as lk,tDt as ll,Ime as lm,iDt as ln,rDt as lo,ie as lp,$f as lq,zR as lr,jo as ls,Jn as lt,Pf as lu,R$t as lv,DDt as lw,MSe as lx,px as ly,qh as lz,k_t as m,oJ as m$,Ukt as m0,Skt as m1,xkt as m2,FS as m3,kut as m4,Tkt as m5,DHt as m6,y2t as m7,MHt as m8,m2t as m9,rzt as mA,zX as mB,$It as mC,GX as mD,rn as mE,Ft as mF,w0e as mG,s8e as mH,Jw as mI,wx as mJ,mt as mK,nve as mL,OI as mM,pfe as mN,wX as mO,sIt as mP,TM as mQ,YLe as mR,j5 as mS,vIt as mT,yIt as mU,WV as mV,kh as mW,Wd as mX,ar as mY,yc as mZ,aJ as m_,OHt as ma,RHt as mb,NHt as mc,EHt as md,T2t as me,AHt as mf,Ey as mg,Swe as mh,Kqe as mi,Xt as mj,mHt as mk,sa as ml,OV as mm,SZe as mn,FR as mo,So as mp,I1e as mq,Xje as mr,MDt as ms,nr as mt,xu as mu,At as mv,Hi as mw,Av as mx,Ev as my,DIt as mz,IRe as n,ZDt as n$,Hr as n0,zDt as n1,HHe as n2,hfe as n3,Ac as n4,Cme as n5,OX as n6,rIt as n7,Iee as n8,G0e as n9,PNe as nA,yO as nB,z_ as nC,k8t as nD,Sae as nE,V8t as nF,r$t as nG,P8t as nH,LCe as nI,NCe as nJ,ICe as nK,Mae as nL,Jat as nM,GUt as nN,Zge as nO,AFe as nP,WIt as nQ,ONe as nR,DNe as nS,FCe as nT,kX as nU,TIt as nV,A_e as nW,z9e as nX,c6 as nY,Ja as nZ,fe as n_,SX as na,Vh as nb,$y as nc,Ane as nd,Au as ne,O5t as nf,Y8t as ng,Bh as nh,nE as ni,tje as nj,OY as nk,_je as nl,dx as nm,_Ye as nn,wh as no,Ge as np,fr as nq,q5 as nr,i$t as ns,hy as nt,W_ as nu,V0e as nv,Y2 as nw,nIt as nx,N6 as ny,wj as nz,tbt as o,qM as o$,JDt as o0,N$t as o1,M8e as o2,K1 as o3,WDt as o4,Lqe as o5,uF as o6,ri as o7,z$t as o8,xUt as o9,Cr as oA,oHt as oB,TZe as oC,NVt as oD,dNt as oE,pNt as oF,Nf as oG,jM as oH,Fge as oI,X_e as oJ,d3 as oK,swe as oL,yHt as oM,H4 as oN,il as oO,d2 as oP,g9e as oQ,ew as oR,Ru as oS,zU as oT,zt as oU,Fl as oV,Fc as oW,va as oX,Zh as oY,mu as oZ,PNt as o_,F2e as oa,Fi as ob,BQ as oc,Ar as od,wu as oe,nB as of,Nw as og,sU as oh,Nc as oi,Ly as oj,bo as ok,rt as ol,Nr as om,Oe as on,pa as oo,xi as op,I0e as oq,QDt as or,KDt as os,tNt as ot,PZ as ou,la as ov,OHe as ow,Ve as ox,Rp as oy,Ur as oz,DRe as p,yo as p$,rU as p0,W2e as p1,RNt as p2,Rst as p3,kl as p4,WJe as p5,Ou as p6,FFt as p7,DFt as p8,NFt as p9,YV as pA,Qf as pB,dne as pC,c2 as pD,Eo as pE,fn as pF,O7 as pG,mIt as pH,fIt as pI,gt as pJ,Cse as pK,nX as pL,Oot as pM,t8t as pN,jY as pO,A$t as pP,INt as pQ,K4 as pR,E1e as pS,JIt as pT,Ese as pU,xm as pV,D6 as pW,bY as pX,zh as pY,Cp as pZ,wE as p_,qqe as pa,a2 as pb,lnt as pc,EE as pd,rFe as pe,gu as pf,Lot as pg,tq as ph,fQ as pi,kje as pj,wje as pk,vje as pl,kg as pm,rX as pn,Rje as po,oIt as pp,vo as pq,VDt as pr,$1e as ps,AE as pt,tv as pu,Tc as pv,HGe as pw,UDt as px,kDt as py,Iw as pz,sbt as q,VY as q$,RU as q0,B2e as q1,eEe as q2,nt as q3,uQ as q4,sp as q5,F$t as q6,kY as q7,Ule as q8,m5t as q9,eE as qA,Zbe as qB,iWe as qC,py as qD,W6 as qE,Vje as qF,NDt as qG,fne as qH,y5t as qI,xM as qJ,fx as qK,pi as qL,GDt as qM,k2 as qN,Lze as qO,Wf as qP,p1e as qQ,Cx as qR,kVe as qS,D0e as qT,yfe as qU,VIe as qV,LIt as qW,ket as qX,vNt as qY,bNt as qZ,lHt as q_,UR as qa,T0e as qb,V7e as qc,BLt as qd,X_ as qe,FDt as qf,n8 as qg,W4 as qh,Klt as qi,dHt as qj,e8t as qk,dE as ql,fHt as qm,pHt as qn,CM as qo,On as qp,YIt as qq,Sse as qr,ff as qs,LR as qt,HY as qu,tE as qv,O$t as qw,rrt as qx,qY as qy,wve as qz,obt as r,Ns as r$,fNt as r0,uNt as r1,hNt as r2,lNt as r3,eL as r4,rEe as r5,x1t as r6,uHe as r7,bje as r8,YDt as r9,Cw as rA,a1e as rB,x0e as rC,JLt as rD,zmt as rE,bat as rF,_at as rG,y8t as rH,g8t as rI,fy as rJ,j8t as rK,Yn as rL,Bo as rM,BVt as rN,DQ as rO,Wo as rP,VPt as rQ,lu as rR,ZP as rS,KUt as rT,fj as rU,WUt as rV,Jot as rW,LM as rX,lx as rY,Vmt as rZ,_Q as r_,_Nt as ra,hHe as rb,UGe as rc,Hie as rd,I2 as re,d5t as rf,oE as rg,WGe as rh,Ds as ri,cOe as rj,yqe as rk,Gb as rl,yNt as rm,QE as rn,gNt as ro,Ht as rp,__e as rq,v_e as rr,n8t as rs,mNt as rt,oNt as ru,U9e as rv,PC as rw,d6 as rx,NM as ry,J2 as rz,VRe as s,owe as s$,ogt as s0,NAe as s1,m3e as s2,Hme as s3,Jbe as s4,ED as s5,yLt as s6,xNt as s7,wNt as s8,aE as s9,MEe as sA,PEe as sB,wIt as sC,eue as sD,mW as sE,fd as sF,KF as sG,GBt as sH,e5 as sI,fc as sJ,mc as sK,_W as sL,gW as sM,vW as sN,yW as sO,tue as sP,Vbe as sQ,kxe as sR,Z5 as sS,XZ as sT,y4 as sU,pYe as sV,Dxe as sW,by as sX,z6 as sY,LO as sZ,G6 as s_,BHe as sa,Xg as sb,ZQ as sc,VU as sd,Qr as se,w7t as sf,KPt as sg,$Dt as sh,lX as si,IPt as sj,BR as sk,yR as sl,a8t as sm,xTe as sn,gqe as so,eNt as sp,D_ as sq,IHe as sr,Cqe as ss,kie as st,iNt as su,hte as sv,Ggt as sw,V5 as sx,Wt as sy,FIe as sz,URe as t,gN as t$,BDt as t0,wYe as t1,Aze as t2,xot as t3,QIt as t4,yPt as t5,cGt as t6,ZIt as t7,UVe as t8,QUt as t9,Vkt as tA,P9e as tB,Bkt as tC,b_e as tD,I4 as tE,GPt as tF,rp as tG,d_e as tH,AO as tI,T4e as tJ,U6 as tK,f4 as tL,W5 as tM,YDe as tN,ZDe as tO,_It as tP,rLe as tQ,DBt as tR,jBt as tS,jAe as tT,Lb as tU,rue as tV,LBt as tW,FBt as tX,$b as tY,IBt as tZ,Sz as t_,gc as ta,PPt as tb,f9e as tc,eut as td,eu as te,xr as tf,hn as tg,Gs as th,Ot as ti,Ti as tj,zo as tk,nQ as tl,dm as tm,bUt as tn,Rt as to,Ct as tp,Je as tq,oLt as tr,I8t as ts,eee as tt,KE as tu,VZ as tv,c9e as tw,u9e as tx,m6 as ty,m_e as tz,ITe as u,Lge as u$,ym as u0,$l as u1,jh as u2,gCe as u3,Th as u4,wyt as u5,xyt as u6,fO as u7,ake as u8,i5e as u9,Put as uA,YZ as uB,_ke as uC,JZ as uD,B_e as uE,tK as uF,G_e as uG,Odt as uH,Yq as uI,iGe as uJ,sGe as uK,nGe as uL,rht as uM,BIt as uN,Vue as uO,Nue as uP,SFe as uQ,Fue as uR,Kue as uS,Uue as uT,e$t as uU,jue as uV,ahe as uW,lhe as uX,che as uY,qIt as uZ,sZ as u_,P8e as ua,B8t as ub,U8t as uc,Wke as ud,dLt as ue,T7 as uf,Rk as ug,Mk as uh,hPt as ui,dPt as uj,R8t as uk,Eke as ul,K_ as um,_Lt as un,Pge as uo,Tme as up,uRe as uq,q_t as ur,aRe as us,ovt as ut,ib as uu,TK as uv,xK as uw,vue as ux,G_t as uy,wue as uz,CJe as v,M4 as v$,GIt as v0,UFe as v1,RFe as v2,jIt as v3,uhe as v4,XIt as v5,V$t as v6,Ckt as v7,Fkt as v8,Que as v9,Rkt as vA,XAe as vB,Akt as vC,xmt as vD,Dut as vE,pZ as vF,cy as vG,kA as vH,YUe as vI,ZUe as vJ,XUe as vK,V5e as vL,zA as vM,RIt as vN,KUe as vO,BHt as vP,NNt as vQ,EXe as vR,SXe as vS,EZ as vT,AD as vU,kkt as vV,P5 as vW,e8e as vX,QTt as vY,VL as vZ,O4 as v_,rhe as va,$kt as vb,Ikt as vc,_mt as vd,Lkt as ve,Dkt as vf,xle as vg,Sle as vh,Tle as vi,Mkt as vj,Pkt as vk,Iue as vl,Tue as vm,Sue as vn,Eue as vo,Hue as vp,_he as vq,whe as vr,$ue as vs,vhe as vt,u6 as vu,ZAe as vv,Nkt as vw,$ut as vx,Lut as vy,Okt as vz,pTe as w,SR as w0,G5e as w1,bPt as w2,f$t as w3,HB as w4,a8e as w5,use as w6,jkt as w7,zkt as w8,OZ as w9,sDt as wA,gDt as wB,ENt as wC,r8t as wD,Tzt as wE,pPe as wa,kTt as wb,FNt as wc,qMt as wd,$E as we,gIt as wf,pIt as wg,dIt as wh,X5 as wi,Mlt as wj,Egt as wk,B_ as wl,KEe as wm,zxe as wn,C3 as wo,l2 as wp,rB as wq,sl as wr,F2 as ws,sX as wt,g4t as wu,Fht as wv,Bw as ww,Y$t as wx,sLt as wy,qLt as wz,$Je as x,UO as y,lbt as z};
