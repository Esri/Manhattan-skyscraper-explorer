import{bw as Yt,bB as Jt,jo as Qt,aJ as h,aK as d,by as ei,ct as oe,eQ as et,gg as tt,gh as it,aM as ce,bH as y,bs as ti,mF as me,hT as ii,hU as ai,bf as at,hW as st,mt as nt,h_ as si,i2 as ni,aQ as ri,i7 as li,i8 as oi,i9 as hi,ia as ui,pE as ci,i4 as pe,hz as di,ih as pi,o7 as gi,jg as be,io as _i,oX as wi,iq as yi,ir as vi,hv as fi,hw as Pi,my as mi,jf as C,jh as rt,fH as bi,pK as Ce,lt as $t,jm as o,lp as w,f2 as I,qt as Dt,n_ as A,d2 as B,d3 as $,gB as v,on as M,ji as L,qu as Ge,o$ as Ot,q7 as x,qv as Vi,qw as Ue,qx as Mi,qy as Ti,gJ as St,d4 as te,qz as We,iU as Rt,iP as J,qA as It,ov as Ei,q8 as At,jl as ue,pU as q,bx as Q,lU as Ci,hE as xt,l3 as $i,qB as Di,mg as V,qC as Ne,bz as F,jj as ge,i6 as _e,pv as lt,qD as Ve,qE as Oi,ae as Lt,jk as Si,pY as ot,oV as ht,f4 as Re,f1 as ut,qF as ct,qG as dt,qH as pt,qI as Ri,gw as Ii,aP as Ke,aG as Me,bR as gt,aZ as R,qJ as Ai,mW as xi,lz as Li,hK as ki,a_ as Hi,b2 as ze,dz as _t,aI as j,qs as he,qK as b,qL as wt,om as Be,ly as fe,qM as Gi,ne as Ui,f3 as yt,qN as Ni,hJ as vt,lu as ft,lx as zi,lw as Bi,qO as kt,qP as Ht,lB as qi,mA as Fi}from"./index-0199b717.js";import{i as ie,u as Gt,b as ji,c as Wi,r as Ki,a as Xi,e as Zi}from"./LineVisualElement-94455a83.js";import{C as Yi}from"./BuildingComponentSublayer-0e2d1e60.js";import{N as Ji,$ as Ut,e as H,R as Qi,U as ea,a as ta,d as we,D as ia,b as aa,v as sa}from"./analysisViewUtils-3cff21a1.js";import{n as na,l as ra,H as ye}from"./Factory-226bb5ef.js";let k=class extends Yt(Jt){constructor(t){super(t),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}equals(t){return this.heading===t.heading&&this.tilt===t.tilt&&Qt(this.position,t.position)&&this.width===t.width&&this.height===t.height}};h([d({readOnly:!0,json:{read:!1,write:!0}})],k.prototype,"type",void 0),h([d({type:ei}),oe()],k.prototype,"position",void 0),h([d({type:Number,nonNullable:!0,range:{min:0,max:360}}),oe(),et(e=>tt.normalize(it(e),0,!0))],k.prototype,"heading",void 0),h([d({type:Number,nonNullable:!0,range:{min:0,max:360}}),oe(),et(e=>tt.normalize(it(e),0,!0))],k.prototype,"tilt",void 0),h([d({type:Number,nonNullable:!0}),oe()],k.prototype,"width",void 0),h([d({type:Number,nonNullable:!0}),oe()],k.prototype,"height",void 0),k=h([ce("esri.analysis.SlicePlane")],k);const Xe=k;let la=class{constructor(){this.color=ie()}},oa=class{constructor(){this.color=new y([0,0,0,.04]),this.gridColor=ie(.5),this.outlineColor=ie(.7)}},ha=class{constructor(){this.color=ie()}},ua=class{constructor(){this.color=ie(.5),this.contrastColor=Gt()}},ca=class{constructor(){this.color=Gt(),this.outlineColor=ie()}},da=class{constructor(){this.callouts=new la,this.plane=new oa,this.resizeManipulators=new ha,this.rotateManipulators=new ua,this.shiftManipulator=new ca}},P=new da;const Ie=ti("mac")?"Meta":"Control",Ae="Shift",pa=2,ga=1.15,_a=1.15,wa=2500,ya=.02,va=Math.cos(me(45)),Pt=Math.cos(me(5)),fa=.95,Pa=.3,Nt=2,zt=1,ma=3,Bt=11,qe=22.5,Pe=40,mt=48,ba=2.25,Va=4,bt=1,Ma=.3,Ta=6,Ea=4,Vt=1600,Ca=.4;function $a(e){const t=new ii,{vertex:i,fragment:a,attributes:s,varyings:r}=t;return ai(i,e),s.add(at.POSITION,"vec3"),s.add(at.UV0,"vec2"),r.add("vUV","vec2"),i.code.add(st`void main(void) {
vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);
}`),a.uniforms.add(new nt("backgroundColor",n=>n.backgroundColor),new nt("gridColor",n=>n.gridColor),new si("gridWidth",n=>n.gridWidth)),a.code.add(st`void main() {
const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
fragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;
}`),t}const Da=Object.freeze(Object.defineProperty({__proto__:null,build:$a},Symbol.toStringTag,{value:"Module"}));let Oa=class extends gi{constructor(){super(...arguments),this.backgroundColor=be(1,0,0,.5),this.gridColor=be(0,1,0,.5),this.gridWidth=4}};class $e extends li{initializeProgram(t){return new oi(t.rctx,$e.shader.get().build(this.configuration),hi)}initializePipeline(){return ui({blending:ci(pe.ONE,pe.ONE,pe.ONE_MINUS_SRC_ALPHA,pe.ONE_MINUS_SRC_ALPHA),depthTest:{func:di.LESS},colorWrite:pi})}}$e.shader=new ni(Da,()=>ri(()=>import("./SlicePlaneMaterial.glsl-7a87fb20.js"),["./SlicePlaneMaterial.glsl-7a87fb20.js","./index-0199b717.js","./index-a616bda8.css","./LineVisualElement-94455a83.js","./BuildingComponentSublayer-0e2d1e60.js","./analysisViewUtils-3cff21a1.js","./ImageMaterial-6510b823.js","./Factory-226bb5ef.js"],import.meta.url));class Sa extends _i{constructor(t){super(t,new Ia),this._configuration=new wi}createBufferWriter(){return new yi(vi)}requiresSlot(t,i){return i===fi.Color&&t===Pi.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL}createGLMaterial(t){return new Ra(t)}getConfiguration(){return this._configuration}}let Ra=class extends mi{constructor(t){super(t),this.ensureTechnique($e,null)}beginSlot(){return this.technique}},Ia=class extends Oa{constructor(){super(...arguments),this.renderOccluded=C.Occlude}},Aa=class extends ji{constructor(t){super(t),this._material=null,this._renderOccluded=C.OccludeAndTransparent,this._gridWidth=1,this._gridColor=be(1,0,0,1),this._backgroundColor=be(1,0,0,1),this.applyProps(t)}get renderOccluded(){return this._renderOccluded}set renderOccluded(t){t!==this._renderOccluded&&(this._renderOccluded=t,this._updateMaterial())}get gridWidth(){return this._gridWidth}set gridWidth(t){this._gridWidth!==t&&(this._gridWidth=t,this._updateMaterial())}get gridColor(){return this._gridColor}set gridColor(t){rt(this._gridColor,t),this._updateMaterial()}get backgroundColor(){return this._backgroundColor}set backgroundColor(t){rt(this._backgroundColor,t),this._updateMaterial()}createExternalResources(){this._material=new Sa(this._materialParameters)}destroyExternalResources(){this._material=null}forEachExternalMaterial(t){this._material!=null&&t(this._material)}createGeometries(t){if(this._material!=null){const i=bi(this._material);t.addGeometry(i)}}get _materialParameters(){return{backgroundColor:this._backgroundColor,gridWidth:this._gridWidth,gridColor:this._gridColor,renderOccluded:this._renderOccluded}}_updateMaterial(){this._material!=null&&this._material.setParameters(this._materialParameters)}};function xa(e,t,i,a,s,r,n,l){return La(t,n.worldUpAtPosition(e,o.get()),s,r,l.basis1,l.basis2),w(l.basis1,l.basis1,i),w(l.basis2,l.basis2,a),I(l.origin,e),Dt(l.basis2,l.basis1,l.origin,l.plane),l}function La(e,t,i,a,s,r){const n=A(e,t),l=o.get(),c=o.get();switch(a===E.HORIZONTAL_OR_VERTICAL?Math.abs(n)>va?E.HORIZONTAL:E.VERTICAL:a){case E.VERTICAL:{const g=Math.abs(n)<=Pt?e:i.viewUp;B(l,g,t),I(c,t);break}case E.HORIZONTAL:B(l,i.viewUp,t),B(c,t,l);break;case E.TILTED:{const g=Math.abs(n)<=Pt?t:i.viewUp;B(l,g,e),B(c,e,l);break}}const _=B(o.get(),l,c);A(_,i.viewForward)>0&&w(c,c,-1),$(s,l),$(r,c)}function ka(e,t,i){const a=t.worldUpAtPosition(e.origin,o.get()),s=e.basis1,r=Je(e,a),n=Math.round(r/se)*se;return Ne(e,n-r,s,i)}function Ha(e,t,i,a,s,r){const n=I(o.get(),s.origin);v(n,n,w(o.get(),s.basis1,e.direction[0]<0?1:-1)),v(n,n,w(o.get(),s.basis2,e.direction[1]<0?1:-1));const l=M(s.basis1),c=M(s.basis2),_=L(o.get(),i,n),g=L(o.get(),t,n);let p=0,u=0;if(Ye(e)){const O=Fe(s),De=Fe(r);p=l-.5*e.direction[0]*A(s.basis1,g)/l,u=c-.5*e.direction[1]*A(s.basis2,g)/c;const ne=De/O;p*=ne,u*=ne}const D=p+.5*e.direction[0]*A(s.basis1,_)/l,T=u+.5*e.direction[1]*A(s.basis2,_)/c,W=w(o.get(),s.basis1,D/l),U=w(o.get(),s.basis2,T/c);(D<=0||Tt(r.origin,W,a)<=Vt)&&I(W,r.basis1),(T<=0||Tt(r.origin,U,a)<=Vt)&&I(U,r.basis2);const N=I(o.get(),n);return v(N,N,w(o.get(),W,e.direction[0]<0?-1:1)),v(N,N,w(o.get(),U,e.direction[1]<0?-1:1)),Ge(N,W,U,r)}function Ga(e,t){return Ca*Math.min(t.width,t.height)*t.computeRenderPixelSizeAt(e)}function Ua(e,t,i,a){const s=B(o.get(),t,i);return B(s,s,t),Ot(e,s,a)}function qt(e,t){return Ji(e.basis1,e.basis2,e.origin,t)}function Mt(e,t,i,a){const s=t.worldUpAtPosition(e.origin,o.get()),r=o.get();switch(i){case ae.HEADING:I(r,s);break;case ae.TILT:I(r,e.basis1)}return Ot(e.origin,r,a)}function Na(e,t,i,a){const s=Ze(i,G.NEGATIVE_X),r=x.get();Vi(r,t,s.edge*Math.PI/2);const n=$(o.get(),s.basis);let l=w(o.get(),n,s.direction*a.computeScreenPixelSizeAt(s.position)*Pe);v(l,l,s.position);const c=a.projectToRenderScreen(l,Ue(o.get())),_=za(a,c);Mi(a,c,ve),$(ve.direction,ve.direction);const g=o.get();!_&&Ti(i,ve,g)&&(l=g),r[12]=0,r[13]=0,r[14]=0,e.modelTransform=r,e.renderLocation=St(l),_?e.state|=Te:e.state&=~Te}function za(e,t){const[i,a,s,r]=e.viewport,n=Math.min(s,r)/16;let l=!0;return t[0]<i+n?(t[0]=i+n,l=!1):t[0]>i+s-n&&(t[0]=i+s-n,l=!1),t[1]<a+n?(t[1]=a+n,l=!1):t[1]>a+r-n&&(t[1]=a+r-n,l=!1),l}function Ba(e,t,i,a){const s=M(a.basis1),r=M(a.basis2),n=Ft(a),l=Fe(a),c=te(o.get(),0,0,0);v(c,w(o.get(),a.basis1,t.direction[0]),w(o.get(),a.basis2,t.direction[1])),v(c,a.origin,c);let _=0,g=1;if(Ye(t))t.direction[0]===1&&t.direction[1]===-1?_=se:t.direction[0]===1&&t.direction[1]===1?_=Math.PI:t.direction[0]===-1&&t.direction[1]===1&&(_=3*Math.PI/2),g=l;else{const u=t.direction[0]!==0?1:2;_=u===1?se:0,g=(u===1?r:s)-n}const p=We(x.get(),_);Rt(p,p,te(o.get(),g,g,g)),J(p,i,p),p[12]=0,p[13]=0,p[14]=0,e.modelTransform=p,e.renderLocation=c}function qa(e,t,i,a){const s=a.worldUpAtPosition(i.origin,o.get()),r=Ze(i,G.POSITIVE_X),n=We(x.get(),r.edge*Math.PI/2);It(n,n,-Je(i,s)),J(n,t,n),n[12]=0,n[13]=0,n[14]=0,e.modelTransform=n,e.renderLocation=r.position}function Fa(e,t,i){const a=Ze(i,G.POSITIVE_Y),s=We(x.get(),a.edge*Math.PI/2);It(s,s,se),J(s,t,s),s[12]=0,s[13]=0,s[14]=0,e.modelTransform=s,e.renderLocation=a.position}var G;function Ze(e,t){switch(t){case G.POSITIVE_X:return{basis:e.basis1,direction:1,position:v(o.get(),e.origin,e.basis1),edge:t};case G.POSITIVE_Y:return{basis:e.basis2,direction:1,position:v(o.get(),e.origin,e.basis2),edge:t};case G.NEGATIVE_X:return{basis:e.basis1,direction:-1,position:L(o.get(),e.origin,e.basis1),edge:t};case G.NEGATIVE_Y:return{basis:e.basis2,direction:-1,position:L(o.get(),e.origin,e.basis2),edge:t}}}function Tt(e,t,i){const a=i.projectToRenderScreen(v(o.get(),e,t),Ue(o.get())),s=i.projectToRenderScreen(L(o.get(),e,t),Ue(o.get()));return Ei(L(a,a,s))}function Ft(e){const t=M(e.basis1),i=M(e.basis2);return Ma*Math.min(t,i)}function Fe(e){return Ft(e)}function Ye(e){return e.direction[0]!==0&&e.direction[1]!==0}function ja(e,t){const i=t.offsetMode===Ee.CENTER_ON_CALLOUT?Pe:0,a=[F(i,0,-mt/2),F(i,0,mt/2)],s=Za(a,!0),r=(p,u)=>Ka(a,p,u,t),n=r(0,!1),l=r(ba,!0),c=new At({color:y.toUnitRGBA(t.calloutColor),renderOccluded:C.OccludeAndTransparent}),_=ue(c,[[i,0,0],[i-Pe,0,0]]),g=ue(c,[[i,0,0],[i-Pe,0,0]]);return new Ut({view:e,renderObjects:[...n.normal.map(p=>new H(p,q.Unfocused|m)),...l.normal.map(p=>new H(p,q.Unfocused|m)),new H(_,q.Unfocused|m|Te),...n.focused.map(p=>new H(p,q.Focused|m)),...l.focused.map(p=>new H(p,q.Focused|m)),new H(g,q.Focused|m|Te)],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[s]},collisionPriority:1,radius:Bt,state:m})}function Et(e,t){const i=Qi(e,{calloutColor:y.toUnitRGBA(P.callouts.color),customStateMask:m,texture:t});return i.state=m,i}function jt(e){const t=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0],[-1,-1,0]];return new Wi({view:e,attached:!1,color:y.toUnitRGBA(P.plane.outlineColor),width:zt,renderOccluded:C.OccludeAndTransparent,geometry:[t]})}function Wt(e){return new Aa({view:e,attached:!1,backgroundColor:y.toUnitRGBA(P.plane.color),gridColor:y.toUnitRGBA(P.plane.gridColor),gridWidth:4,renderOccluded:C.OccludeAndTransparent})}function Wa(e,t,i){const a=Ye(t),s=a?[F(1,0,0),F(0,0,0),F(0,1,0)]:[F(1,0,0),F(-1,0,0)],r=y.toUnitRGBA(i.color),n=T=>new Si({color:r,width:T,renderOccluded:C.OccludeAndTransparent}),l=()=>new At({color:r,renderOccluded:C.OccludeAndTransparent}),c=a?Va:bt,_=c*pa,g=bt,p=T=>T>1?n(T):l(),u=[new H(ue(p(c),s),q.Unfocused|xe),new H(ue(p(_),s),q.Focused|xe),new H(ue(p(g),s),es)],D=new Ut({view:e,renderObjects:u,collisionType:{type:"line",paths:[s]},radius:a?Ta:Ea,...ea});return D.state=xe,D}function Ka(e,t,i,a){const s=y.blendColors(a.color,a.outlineColor,.4),r=y.blendColors(a.color,a.outlineColor,.14),n=new ge({color:y.toUnitRGBA(a.color),cullFace:_e.Back,renderOccluded:C.Opaque}),l=new ge({color:y.toUnitRGBA(s),cullFace:_e.Back,renderOccluded:C.Opaque}),c=new ge({color:y.toUnitRGBA(r),cullFace:_e.Back,renderOccluded:C.Opaque}),_=new ge({color:y.toUnitRGBA(a.outlineColor),transparent:!0,writeDepth:!1,cullFace:_e.Front,renderOccluded:C.Transparent}),g=p=>{const u=e.slice(0),D=L(o.get(),u[0],u[1]);$(D,D);const T=L(o.get(),u[u.length-1],u[u.length-2]);if($(T,T),t>0){const le=w(Q(),T,-t);u[u.length-1]=v(le,le,u[u.length-1]);const ee=w(Q(),D,-t);u[0]=v(ee,ee,u[0])}const W=p?_a:1,U=qe*W,N=Bt*W,O=ot(x.get());if(t>0){const le=U/4,ee=te(o.get(),0,le,0),de=1+t/le;ht(O,O,ee),Rt(O,O,te(o.get(),de,de,de)),ht(O,O,w(ee,ee,-1/de))}const De=ot(Re()),ne=F(0,1,0),K=ut(Re(),ct(dt.get(),ne,T));K[12]=u[u.length-1][0],K[13]=u[u.length-1][1],K[14]=u[u.length-1][2],J(K,K,O);const Qe=Xa(ma*(p?ga:1)+t,u,i?_:c);Qe.transformation=De;const re=[Qe],Oe=pt(i?_:n,U,N,24,!1,!1,!0);Oe.transformation=K,re.push(Oe);const Se=pt(i?_:l,U,N,24,!1,!0,!1);Se.transformation=K,re.push(Se);const X=ut(Re(),ct(dt.get(),ne,D));return X[12]=u[0][0],X[13]=u[0][1],X[14]=u[0][2],J(X,X,O),re.push(Oe.instantiate({transformation:X})),re.push(Se.instantiate({transformation:X})),re};return{normal:g(!1),focused:g(!0)}}function Xa(e,t,i){const a=[];for(let r=0;r<12;r++){const n=r/12*2*Math.PI;a.push([Math.cos(n)*e,Math.sin(n)*e])}return Ri(i,a,t,[],[],!1)}function Za(e,t){const i=L(Q(),e[e.length-1],e[e.length-2]);if($(i,i),w(i,i,qe),v(i,i,e[e.length-1]),t){const a=L(Q(),e[0],e[1]);return $(a,a),w(a,a,qe),v(a,a,e[0]),[a,...e,i]}return[...e,i]}function Kt(e,t,i,a=new Xe){if(e==null)return null;const{renderCoordsHelper:s}=t,r=s.fromRenderCoords(e.origin,t.spatialReference);if(r==null)return null;const n=Ci(r,i);if(n==null)return null;a.position=n;const l=2*M(e.basis1),c=2*M(e.basis2),_=xt.renderUnitScaleFactor(t.spatialReference,i);a.width=l*_,a.height=c*_;const g=s.worldUpAtPosition(e.origin,o.get());return a.tilt=$i(Je(e,g)),a.heading=s.headingAtPosition(e.origin,e.basis1)-90,a}function Je(e,t){return Di(t,e.basis2,e.basis1)+se}function Ya(e,t,i,a,s,r,n=V()){return r.toRenderCoords(e,n.origin)?(r.worldBasisAtPosition(n.origin,lt.X,n.basis1),r.worldBasisAtPosition(n.origin,lt.Y,n.basis2),Dt(n.basis2,n.basis1,n.origin,n.plane),Ne(n,-me(t),Ve(n),n),Ne(n,me(i),n.basis1,n),w(n.basis1,n.basis1,a/2),w(n.basis2,n.basis2,s/2),Oi(n),n):(Lt.getLogger("esri.views.3d.analysis.Slice.sliceToolUtils").error(`Failed to project slice plane position, projection from ${e.spatialReference.wkid} is not supported`),null)}function Ja(e,t){if(e==null||e.position==null)return null;const i=Ki(e.position,t.spatialReference,t.elevationProvider);if(i==null)return null;const a=xt.renderUnitScaleFactor(e.position.spatialReference,t.spatialReference),s=e.width*a,r=e.height*a;return{position:i,heading:e.heading,tilt:e.tilt,renderWidth:s,renderHeight:r}}function Qa(e,t,i,a=V()){if(e==null)return null;const s=Ya(e.position,e.heading,e.tilt,e.renderWidth,e.renderHeight,t.renderCoordsHelper,a);return i.tiltEnabled||s==null||ka(s,t.renderCoordsHelper,s),s}(function(e){e[e.POSITIVE_X=0]="POSITIVE_X",e[e.POSITIVE_Y=1]="POSITIVE_Y",e[e.NEGATIVE_X=2]="NEGATIVE_X",e[e.NEGATIVE_Y=3]="NEGATIVE_Y"})(G||(G={}));const m=Ce.Custom1;var ae,E;(function(e){e[e.HEADING=1]="HEADING",e[e.TILT=2]="TILT"})(ae||(ae={})),function(e){e[e.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",e[e.HORIZONTAL=1]="HORIZONTAL",e[e.VERTICAL=2]="VERTICAL",e[e.TILTED=3]="TILTED"}(E||(E={}));const Te=Ce.Custom2,ve=$t(),se=Math.PI/2,xe=Ce.Custom1,es=Ce.Custom2;var Ee;function ts(e){return(e.type==="building-scene-3d"?e:null)!=null}(function(e){e[e.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",e[e.CENTER_ON_ARROW=1]="CENTER_ON_ARROW"})(Ee||(Ee={}));function is(e){switch(e.type){case"building-scene":case"csv":case"dimension":case"feature":case"geo-rss":case"geojson":case"graphics":case"group":case"integrated-mesh":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-notes":case"ogc-feature":case"oriented-imagery":case"point-cloud":case"route":case"scene":case"stream":case"voxel":case"subtype-group":case"unknown":case"unsupported":case"wfs":case null:return!1;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"elevation":case"imagery":case"imagery-tile":case"map-image":case"media":case"open-street-map":case"tile":case"vector-tile":case"video":case"wcs":case"web-tile":case"wms":case"wmts":return!0;default:return Ii(e.type),!1}}const Xt="esri.views.3d.analysis.Slice.SliceController",Le=Lt.getLogger(Xt);let Z=class extends Ke{constructor(e){super(e),this._handles=new Me,this._internalChange=!1,this._currentSlicePlane=null}initialize(){this._handles.add(this.analysis.excludedLayers.on("before-add",e=>{const t=e.item;t!=null&&(t instanceof gt||t instanceof Yi)?t instanceof gt&&is(t)?(Le.error("excludedLayers",`Layer '${t.title}, id:${t.id}' of type '${t.type}' can not be individually excluded from slicing. Use 'excludeGroundSurface' instead.`),e.preventDefault()):this.analysis.excludedLayers.includes(t)&&e.preventDefault():(Le.error("excludedLayers","Invalid layer type, layer must derive from Layer or BuildingComponentSublayer"),e.preventDefault())})),ss(this.view,this),this._handles.add([R(()=>this.analysisViewData.plane,()=>{this._internalChange||this._updateSlicePlaneFromBoundedPlane(),this._updateLayerViews()},{sync:!0}),R(()=>this.analysis.excludeGroundSurface,()=>this._updateLayerViews(),{sync:!0}),this.analysis.excludedLayers.on("change",()=>this._updateLayerViews()),R(()=>[this.analysisViewData.active,this.analysisViewData.visible],()=>{this._updateActiveController(),this._updateViewSlicePlane()},{sync:!0}),R(()=>this._allLayerAndSubLayerViews,()=>this._updateLayerViews())]),this._handles.add([R(()=>this.analysis.shape,()=>{this._internalChange||(this._updateBoundedPlaneFromSlicePlane(),this._updateViewSlicePlane())},{sync:!0})],"analysis"),this._updateActiveController(),this._updateBoundedPlaneFromSlicePlane(),this._updateViewSlicePlane()}destroy(){this.analysisViewData.active&&(this.analysisViewData.active=!1,this.view.slicePlane=null),ns(this.view,this),this._handles.destroy(),this.set("view",null)}get _allLayerAndSubLayerViews(){const e=this.view.allLayerViews.items;return e.concat(e.filter(ts).flatMap(({sublayerViews:t})=>t.items))}_updateBoundedPlaneFromSlicePlane(){const e=this.analysis.shape,t=this._currentSlicePlane;if(t==null&&e==null||t!=null&&e!=null&&e.equals(t))return;let i=null,a=null;if(e!=null&&e.position!=null){const s=e.position.spatialReference,r=Ja(e,this.view);r==null&&Xi(this.analysis,s,Le),i=Qa(r,this.view,{tiltEnabled:this.analysis.tiltEnabled},V()),i!=null&&(a={heading:e.heading,tilt:e.tilt,position:e.position,width:e.width,height:e.height})}this._currentSlicePlane=a,this._internalChange=!0,this.analysisViewData.plane=i,this._internalChange=!1}_updateSlicePlaneFromBoundedPlane(){const e=this.analysisViewData.plane,t=Kt(e,this.view,this.view.spatialReference,new Xe);let i=null;t!=null&&(i={heading:t.heading,tilt:t.tilt,position:t.position,width:t.width,height:t.height}),this._currentSlicePlane=i,this._internalChange=!0,this.analysis.shape=t,this._internalChange=!1,this._updateViewSlicePlane()}_updateActiveController(){if(ke)return;const e=Zt(this.view);if(e)if(this.analysisViewData.active)e.activeController!=null&&e.activeController!==this?(ke=!0,e.activeController.analysisViewData.active=!1,ke=!1):e.activeController!=null&&e.activeController,this._updateLayerViews(),e.activeController=this;else{if(e.activeController!=null&&e.activeController!==this)return;e.activeController!=null&&e.activeController===this&&(e.activeController=null,this._updateLayerViews())}}_updateViewSlicePlane(){as(this.view)}_updateLayerViews(){const e=this.analysisViewData.plane!=null&&this.analysisViewData.visible&&this.analysisViewData.active,t=[],i=a=>{"layers"in a?a.layers.forEach(i):t.push(a)};this.analysis.excludedLayers.forEach(i),this.view.allLayerViews.forEach(a=>{a.destroyed||("slicePlaneEnabled"in a&&(a.slicePlaneEnabled=e&&!t.includes(a.layer)),"sublayerViews"in a&&a.sublayerViews.forEach(s=>{s.slicePlaneEnabled=e&&!t.includes(s.sublayer)}))}),this.view.basemapTerrain!=null&&(this.view.basemapTerrain.slicePlaneEnabled=e&&!this.analysis.excludeGroundSurface)}};h([d()],Z.prototype,"view",void 0),h([d()],Z.prototype,"analysis",void 0),h([d()],Z.prototype,"analysisViewData",void 0),h([d()],Z.prototype,"_allLayerAndSubLayerViews",null),Z=h([ce(Xt)],Z);const Y=new Map;let ke=!1;function as(e){const t=Zt(e),i=t?.activeController;i!=null&&i.analysisViewData.plane!=null&&i.analysisViewData.visible?e.slicePlane=i.analysisViewData.plane:e.slicePlane=null}function ss(e,t){Y.has(e)||Y.set(e,{all:[],activeController:null}),Y.get(e)?.all.push(t)}function Zt(e){return Y.get(e)}function ns(e,t){if(!Y.has(e))throw new Error("view expected in global slice register");const i=Y.get(e),a=i?.all.lastIndexOf(t)??-1;if(!i||a===-1)throw new Error("controller expected in global slice register");i.all.splice(a,1),i.all.length===0&&Y.delete(e)}var je;let f=je=class extends ta{constructor(e){super(e),this._clock=Ai,this._previewPlaneOpacity=1,this.removeIncompleteOnCancel=!1,this.layersMode="none",this.shiftManipulator=null,this.rotateHeadingManipulator=null,this.rotateTiltManipulator=null,this.resizeManipulators=null,this._handles=new Me,this._viewHandles=new Me,this._frameTask=null,this._pointerMoveTimerMs=wa,this._prevPointerMoveTimeout=null,this._previewPlaneGridVisualElement=null,this._previewPlaneOutlineVisualElement=null,this._startPlane=V(),this._previewPlane=null,this._activeKeyModifiers={},this._lastCursorPosition=xi(),this._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._intersector=Li(e.view.state.viewingMode),this._intersector.options.store=ki.MIN}initialize(){if(this.analysis==null)throw new Error("SliceTool requires valid analysis, but null was provided.");const e=!this.view._stage?.renderView.renderingContext.driverTest.svgPremultipliesAlpha.result,t={accentColor:P.rotateManipulators.color,contrastColor:P.rotateManipulators.contrastColor,preMultiplyAlpha:e};this._rotateHeadingImage=na(this.view.toolViewManager.textures,t),this._rotateTiltImage=ra(this.view.toolViewManager.textures,t);const i=s=>{this._updateManipulatorsInteractive(s),s.grabbing||(this.analysisViewData.plane!=null&&b(this.analysisViewData.plane,this._startPlane),this.inputState=null)};this.shiftManipulator=ja(this.view,{offsetMode:Ee.CENTER_ON_ARROW,calloutColor:P.callouts.color,color:P.shiftManipulator.color,outlineColor:P.shiftManipulator.outlineColor}),this.manipulators.add(this.shiftManipulator),this.shiftManipulator.events.on("grab-changed",s=>{this._onShiftGrab(s),i(this.shiftManipulator)}),this._handles.add(this._createShiftDragPipeline(this.shiftManipulator)),this.rotateHeadingManipulator=Et(this.view,this._rotateHeadingImage.texture),this.manipulators.add(this.rotateHeadingManipulator),this.rotateHeadingManipulator.events.on("grab-changed",s=>{this._onRotateHeadingGrab(s),i(this.rotateHeadingManipulator)}),this._handles.add(this._createRotateHeadingDragPipeline(this.rotateHeadingManipulator)),this.rotateTiltManipulator=Et(this.view,this._rotateTiltImage.texture),this.manipulators.add(this.rotateTiltManipulator),this.rotateTiltManipulator.events.on("grab-changed",s=>{this._onRotateTiltGrab(s),i(this.rotateTiltManipulator)}),this._handles.add(this._createRotateTiltDragPipeline(this.rotateTiltManipulator)),this.resizeManipulators=this._resizeHandles.map((s,r)=>{const n=Wa(this.view,s,{color:P.resizeManipulators.color});return n.events.on("grab-changed",l=>{this._onResizeGrab(l,r),i(n)}),this._handles.add(this._createResizeDragPipeline(n)),n}),this.manipulators.addMany(this.resizeManipulators),this._previewPlaneGridVisualElement=Wt(this.view),this._previewPlaneOutlineVisualElement=jt(this.view),this._previewPlaneOutlineVisualElement.width=Nt,this._handles.add(R(()=>[this.analysisViewData.plane,this.analysis.tiltEnabled],()=>this._updateManipulators(),Hi));const a=R(()=>this.state,s=>{s==="sliced"&&this.finishToolCreation()},ze);this._handles.add([a,R(()=>this.view.state.camera,()=>this._onCameraChange())])}destroy(){this._rotateHeadingImage=_t(this._rotateHeadingImage),this._rotateTiltImage=_t(this._rotateTiltImage),this._handles=j(this._handles),this._viewHandles=j(this._viewHandles),this._removeFrameTask(),this._clearPointerMoveTimeout(),this._previewPlaneOutlineVisualElement=j(this._previewPlaneOutlineVisualElement),this._previewPlaneGridVisualElement=j(this._previewPlaneGridVisualElement)}get state(){const e=!!this.analysisViewData.plane,t=!!this.inputState;return e?e&&t?"slicing":e&&!t?"sliced":"ready":"ready"}get cursor(){return this._isPlacingSlicePlane||this.layersMode==="exclude"?"crosshair":this._creatingPointerId!=null?"grabbing":null}set analysis(e){if(e==null)throw new Error("SliceTool requires valid analysis, but null was provided.");this._handles.remove("analysis"),this._set("analysis",e)}get inputState(){return this._get("inputState")}set inputState(e){this._set("inputState",e),this.analysisViewData.showGrid=e!=null&&e.type==="resize",this._updateMaterials()}get _isPlacingSlicePlane(){return!this.inputState&&!this.analysisViewData.plane&&this.active}get _creatingPointerId(){return this.inputState!=null&&this.inputState.type==="shift"?this.inputState.creatingPointerId:null}enterExcludeLayerMode(){this.analysisViewData.plane!=null&&(this._set("layersMode","exclude"),this.active||(this.view.activeTool=this))}exitExcludeLayerMode(){this.analysisViewData.plane!=null&&(this._set("layersMode","none"),this.active&&(this.view.activeTool=null))}onDeactivate(){this._set("layersMode","none"),this._updatePreviewPlane(null)}onShow(){this._updateVisibility(!0)}onHide(){this._updateVisibility(!1)}_updateVisibility(e){this._updateManipulators(),e||this._clearPointerMoveTimeout()}onInputEvent(e){switch(e.type){case"pointer-drag":if(!He(e))return;this._isPlacingSlicePlane?this._onClickPlacePlane(e)&&e.stopPropagation():this._onPointerDrag(e)&&e.stopPropagation();break;case"pointer-move":this._onPointerMove(e);break;case"pointer-up":this._onPointerUp(e)&&e.stopPropagation();break;case"immediate-click":if(!He(e))return;this._onClickPlacePlane(e)&&e.stopPropagation();break;case"click":if(!He(e))return;this._onClickExcludeLayer(e)&&e.stopPropagation();break;case"drag":this.inputState&&e.stopPropagation();break;case"key-down":this._onKeyDown(e)&&e.stopPropagation();break;case"key-up":this._onKeyUp(e)&&e.stopPropagation()}}onEditableChange(){this.analysisViewData.editable=this.internallyEditable}_onPointerDrag(e){const t=this.inputState;if(e.pointerId===this._creatingPointerId&&t!=null&&t.type==="shift"){const i=he(e);return this.shiftManipulator.events.emit("drag",{action:t.hasBeenDragged?"update":"start",pointerType:e.pointerType,start:i,screenPoint:i}),t.hasBeenDragged=!0,!0}return!1}_onPointerMove(e){this._lastCursorPosition.x=e.x,this._lastCursorPosition.y=e.y,this._resetPointerMoveTimeout(),e.pointerType!=="touch"&&this._updatePreviewPlane(he(e),this._activeKeyModifiers)}_onCameraChange(){this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),this._updateManipulators()}_onPointerUp(e){if(e.pointerId===this._creatingPointerId&&this.analysisViewData.plane!=null){const t=he(e);return this.shiftManipulator.events.emit("drag",{action:"end",start:t,screenPoint:t}),b(this.analysisViewData.plane,this._startPlane),this.inputState=null,!0}return!1}_onClickPlacePlane(e){if(this.layersMode==="exclude")return!1;if(this._isPlacingSlicePlane){const t=he(e),i=V();if(this._pickPlane(t,!1,this._activeKeyModifiers,i)){if(e.type==="pointer-drag"){const a=this._calculatePickRay(t);this.inputState=Ct(a,e.pointerId,i.origin,i)}return b(i,this._startPlane),this.analysis.shape=Kt(i,this.view,this.view.spatialReference,new Xe),!0}}return!1}_onClickExcludeLayer(e){return!(this.layersMode!=="exclude"||!this.created)&&(this.view.hitTest(he(e)).then(t=>{if(t.results.length){const i=t.results[0],a=i?.type==="graphic"&&i.graphic;if(a){const s=a.sourceLayer||a.layer;s&&this.analysis.excludedLayers.push(s)}}else t.ground.layer?this.analysis.excludedLayers.push(t.ground.layer):this.analysis.excludeGroundSurface=!0}),this._set("layersMode","none"),this.active&&(this.view.activeTool=null),!0)}_onKeyDown(e){return(e.key===Ae||e.key===Ie)&&(this._activeKeyModifiers[e.key]=!0,this._previewPlane!=null&&this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),!0)}_onKeyUp(e){return!(e.key!==Ae&&e.key!==Ie||!this._activeKeyModifiers[e.key])&&(delete this._activeKeyModifiers[e.key],this._previewPlane!=null&&this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),!0)}_onShiftGrab(e){if(e.action!=="start"||this.analysisViewData.plane==null||!e.screenPoint)return;const t=this._calculatePickRay(e.screenPoint);b(this.analysisViewData.plane,this._startPlane),this.inputState=Ct(t,null,this.shiftManipulator.renderLocation,this.analysisViewData.plane)}_createShiftDragPipeline(e){return we(e,(t,i,a)=>{const s=this.inputState;if(s==null||s.type!=="shift")return;const r=this.analysisViewData.plane!=null?b(this.analysisViewData.plane,V()):null;i.next(ye(this.view,s.shiftPlane)).next(this._shiftDragAdjustSensitivity(s)).next(this._shiftDragUpdatePlane(s)),a.next(()=>{r!=null&&this._updateBoundedPlane(r)})})}_shiftDragAdjustSensitivity(e){return t=>{if(this.analysisViewData.plane==null)return null;const i=.001,a=Math.min((1-Math.abs(A(Ve(this.analysisViewData.plane),t.ray.direction)/M(t.ray.direction)))/i,1),s=-wt(this._startPlane.plane,t.renderEnd),r=-wt(this._startPlane.plane,e.startPoint);return e.depth=e.depth*(1-a)+s*a-r,t}}_shiftDragUpdatePlane(e){return()=>{if(this.analysisViewData.plane==null)return;const t=I(o.get(),this._startPlane.origin),i=I(o.get(),Ve(this._startPlane));w(i,i,-e.depth),v(i,i,t);const a=Ge(i,this.analysisViewData.plane.basis1,this.analysisViewData.plane.basis2,V());this._updateBoundedPlane(a)}}_onRotateHeadingGrab(e){if(e.action!=="start"||this.analysisViewData.plane==null||!e.screenPoint)return;const t=Mt(this.analysisViewData.plane,this.view.renderCoordsHelper,ae.HEADING,Be()),i=this._calculatePickRay(e.screenPoint),a=Q();fe(t,i,a)&&(b(this.analysisViewData.plane,this._startPlane),this.inputState={type:"rotate",rotatePlane:t,startPoint:a})}_createRotateHeadingDragPipeline(e){return we(e,(t,i,a)=>{const s=this.inputState;if(s==null||s.type!=="rotate")return;const r=this.analysisViewData.plane!=null?b(this.analysisViewData.plane,V()):null;i.next(ye(this.view,s.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(s)).next(this._rotateDragUpdatePlaneFromRotate()),a.next(()=>{r!=null&&this._updateBoundedPlane(r)})})}_onRotateTiltGrab(e){if(e.action!=="start"||this.analysisViewData.plane==null||!e.screenPoint)return;const t=Mt(this.analysisViewData.plane,this.view.renderCoordsHelper,ae.TILT,Be()),i=this._calculatePickRay(e.screenPoint),a=Q();fe(t,i,a)&&(b(this.analysisViewData.plane,this._startPlane),this.inputState={type:"rotate",rotatePlane:t,startPoint:a})}_createRotateTiltDragPipeline(e){return we(e,(t,i,a)=>{const s=this.inputState;if(s==null||s.type!=="rotate")return;const r=this.analysisViewData.plane!=null?b(this.analysisViewData.plane,V()):null;i.next(ye(this.view,s.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(s)).next(this._rotateDragUpdatePlaneFromRotate()),a.next(()=>{r!=null&&this._updateBoundedPlane(r)})})}_rotateDragRenderPlaneToRotate(e){return t=>{if(this.analysisViewData.plane==null)return null;const i=Gi(e.rotatePlane),a=ia(e.startPoint,t.renderEnd,this.analysisViewData.plane.origin,i);return{...t,rotateAxis:i,rotateAngle:a}}}_rotateDragUpdatePlaneFromRotate(){return e=>{if(this.analysisViewData.plane==null)return;const t=Ui(x.get(),e.rotateAngle,e.rotateAxis);if(t==null)return;const i=yt(o.get(),this._startPlane.basis1,t),a=yt(o.get(),this._startPlane.basis2,t),s=Ge(this.analysisViewData.plane.origin,i,a,V());this._updateBoundedPlane(s)}}_onResizeGrab(e,t){if(e.action!=="start"||this.analysisViewData.plane==null||!e.screenPoint)return;const i=this._calculatePickRay(e.screenPoint),a=o.get();fe(this.analysisViewData.plane.plane,i,a)&&(b(this.analysisViewData.plane,this._startPlane),this.inputState={type:"resize",activeHandleIdx:t,startPoint:St(a)})}_createResizeDragPipeline(e){return we(e,(t,i,a)=>{const s=this.inputState;if(s==null||s.type!=="resize"||this.analysisViewData.plane==null)return;const r=b(this.analysisViewData.plane,V());i.next(ye(this.view,this.analysisViewData.plane.plane)).next(this._resizeDragUpdatePlane(s)),a.next(()=>{this._updateBoundedPlane(r)})})}_resizeDragUpdatePlane(e){return t=>{if(this.analysisViewData.plane==null)return;const i=this._resizeHandles[e.activeHandleIdx],a=Ha(i,e.startPoint,t.renderEnd,this.view.state.camera,this._startPlane,b(this.analysisViewData.plane));this._updateBoundedPlane(a)}}_updateBoundedPlane(e){const t=this.analysisViewData;if(t==null)throw new Error("valid internal object expected");t.plane=e}_updatePreviewPlane(e,t={}){let i=this._previewPlane;if(this._previewPlane=null,e==null)return this._removeFrameTask(),void this._updateManipulators();if(!this.analysisViewData.plane&&this.active){const a=i??V();if(i=i!=null?b(i,rs):null,this._pickPlane(e,!0,t,a)){const s=fa;let r=!1;i!=null&&(r=A(i.plane,a.plane)<s||A($(o.get(),i.basis1),$(o.get(),a.basis1))<s),r&&(this._previewPlaneOpacity=0),this._previewPlane=a}}this._previewPlane!=null&&this._frameTask==null&&this._previewPlaneOpacity===0?this._frameTask=Ni({update:({deltaTime:a})=>{this._previewPlaneOpacity=Math.min(this._previewPlaneOpacity+a/(1e3*Pa),1),this._updateManipulators(),this._previewPlaneOpacity===1&&this._removeFrameTask()}}):this._previewPlane==null&&this._frameTask!=null?this._removeFrameTask():this._previewPlane!=null&&this._updateManipulators()}_removeFrameTask(){this._frameTask=vt(this._frameTask)}_calculatePickRay(e){const t=$t(),i=ft(e,ls);return zi(this.view.state.camera,i,t),$(t.direction,t.direction),t}_pickMinResult(e){const t=ft(e,Bi.get());return this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(t,this._intersector),this._intersector.results.min}_pickPlane(e,t,i,a){const s=this._pickMinResult(e),r=o.get();if(!s.getIntersectionPoint(r))return!1;const n=s.getTransformedNormal(o.get()),l=this.view.state.camera;A(n,l.viewForward)>0&&w(n,n,-1);const c=Ga(r,l),_=(t?1:-1)*c*ya,g=w(o.get(),n,_);v(g,g,r);const p=this.analysis.tiltEnabled?E.TILTED:E.HORIZONTAL_OR_VERTICAL,u=i[Ae]?E.VERTICAL:i[Ie]?E.HORIZONTAL:p;return xa(g,n,c,c,l,u,this.view.renderCoordsHelper,a),!0}_clearPointerMoveTimeout(){this._prevPointerMoveTimeout=vt(this._prevPointerMoveTimeout)}_resetPointerMoveTimeout(){this._clearPointerMoveTimeout(),this.shiftManipulator.state|=m,this.rotateHeadingManipulator.state|=m,this.rotateTiltManipulator.state|=m,this._prevPointerMoveTimeout=this._clock.setTimeout(()=>{this.shiftManipulator.state&=~m,this.rotateHeadingManipulator.state&=~m,this.rotateTiltManipulator.state&=~m},this._pointerMoveTimerMs)}_updateManipulators(){if(je.disableEngineLayers)return;let e,t=!1;if(this.analysisViewData.plane!=null)e=this.analysisViewData.plane,t=!1;else{if(this._previewPlane==null)return this.shiftManipulator.available=!1,this.rotateHeadingManipulator.available=!1,this.rotateTiltManipulator.available=!1,this.resizeManipulators.forEach(n=>n.available=!1),this._previewPlaneOutlineVisualElement.visible=!1,void(this._previewPlaneGridVisualElement.visible=!1);e=this._previewPlane,t=!0}const i=qt(e,x.get());t?(this.shiftManipulator.available=!1,this.rotateHeadingManipulator.available=!1,this.rotateTiltManipulator.available=!1,this.resizeManipulators.forEach(n=>n.available=!1),this._previewPlaneOutlineVisualElement.attached=!0,this._previewPlaneGridVisualElement.attached=!0,this._previewPlaneOutlineVisualElement.visible=!0,this._previewPlaneGridVisualElement.visible=!0):(this.shiftManipulator.available=!0,this.rotateHeadingManipulator.available=!0,this.rotateTiltManipulator.available=this.analysis.tiltEnabled,this.resizeManipulators.forEach(n=>n.available=!0),Na(this.shiftManipulator,i,e,this.view.state.camera),qa(this.rotateHeadingManipulator,i,e,this.view.renderCoordsHelper),Fa(this.rotateTiltManipulator,i,e),this.resizeManipulators.forEach((n,l)=>Ba(n,this._resizeHandles[l],i,e)),this._previewPlaneOutlineVisualElement.visible=!1,this._previewPlaneGridVisualElement.visible=!1);const a=te(o.get(),M(e.basis1),M(e.basis2),1),s=kt(x.get(),a),r=J(s,i,s);this._previewPlaneOutlineVisualElement.transform=r,this._previewPlaneGridVisualElement.transform=r,this._updateMaterials()}_updateMaterials(){const e=y.toUnitRGBA(P.plane.outlineColor);e[3]*=this._previewPlaneOpacity;const t=y.toUnitRGBA(P.plane.color);t[3]*=this._previewPlaneOpacity,this._previewPlaneOutlineVisualElement.color=e,this._previewPlaneGridVisualElement.backgroundColor=t,this._previewPlaneGridVisualElement.gridColor=Ht}_updateManipulatorsInteractive(e){if(!e.grabbing)return this.shiftManipulator.interactive=!0,this.rotateHeadingManipulator.interactive=!0,this.rotateTiltManipulator.interactive=!0,void this.resizeManipulators.forEach(t=>{t.interactive=!0});this.shiftManipulator.interactive=this.shiftManipulator===e,this.rotateHeadingManipulator.interactive=this.rotateHeadingManipulator===e,this.rotateTiltManipulator.interactive=this.rotateTiltManipulator===e,this.resizeManipulators.forEach(t=>{t.interactive=t===e})}testData(){return{plane:this.analysisViewData.plane,setPointerMoveTimerMs:e=>{this._pointerMoveTimerMs=e}}}};function Ct(e,t,i,a){const s=Ua(i,Ve(a),e.direction,Be()),r=Q();return fe(s,e,r)?{type:"shift",creatingPointerId:t,hasBeenDragged:!1,shiftPlane:s,depth:0,startPoint:r}:null}function He(e){return e.pointerType!=="mouse"||e.button===0}f.disableEngineLayers=!1,h([d()],f.prototype,"_clock",void 0),h([d({constructOnly:!0})],f.prototype,"view",void 0),h([d()],f.prototype,"analysisViewData",void 0),h([d({readOnly:!0})],f.prototype,"state",null),h([d({readOnly:!0})],f.prototype,"cursor",null),h([d()],f.prototype,"analysis",null),h([d()],f.prototype,"removeIncompleteOnCancel",void 0),h([d({readOnly:!0})],f.prototype,"layersMode",void 0),h([d({value:null})],f.prototype,"inputState",null),h([d()],f.prototype,"_isPlacingSlicePlane",null),h([d()],f.prototype,"_creatingPointerId",null),f=je=h([ce("esri.views.3d.analysis.Slice.SliceTool")],f);const rs=V(),ls=qi(),os=f;let z=class extends Ke{constructor(e){super(e),this._handles=new Me,this._gridVisualElement=null,this._outlineVisualElement=null,this.showGrid=!1,this.preview=!0}initialize(){const e=this.analysisViewData;if(e==null)throw new Error("expected internal object to be valid");this._gridVisualElement=Wt(this.view),this._outlineVisualElement=jt(this.view),this._handles.add([R(()=>({visible:e.plane!=null&&this.analysisViewData.visible,active:this.analysisViewData.active,preview:this.preview,showGrid:this.showGrid}),t=>this._updateMaterials(t),ze),R(()=>e.plane,t=>this._updatePlane(t),ze)],"internal")}destroy(){this._handles.destroy(),this._gridVisualElement=j(this._gridVisualElement),this._outlineVisualElement=j(this._outlineVisualElement),this.set("view",null)}_updatePlane(e){if(e==null)return;this._gridVisualElement.attached=!0,this._outlineVisualElement.attached=!0;const t=te(o.get(),M(e.basis1),M(e.basis2),1),i=kt(x.get(),t),a=qt(e,x.get()),s=J(i,a,i);this._outlineVisualElement.transform=s,this._gridVisualElement.transform=s}_updateMaterials({visible:e,active:t,preview:i,showGrid:a}){this._outlineVisualElement.color=y.toUnitRGBA(P.plane.outlineColor),this._outlineVisualElement.width=i?Nt:zt,this._outlineVisualElement.stipplePattern=t?null:Fi(5),this._gridVisualElement.backgroundColor=y.toUnitRGBA(P.plane.color),this._gridVisualElement.gridColor=a?y.toUnitRGBA(P.plane.gridColor):Ht,this._gridVisualElement.visible=e,this._outlineVisualElement.visible=e}};h([d()],z.prototype,"view",void 0),h([d()],z.prototype,"analysis",void 0),h([d()],z.prototype,"analysisViewData",void 0),h([d()],z.prototype,"showGrid",void 0),h([d()],z.prototype,"preview",void 0),z=h([ce("esri.views.3d.analysis.Slice.SliceVisualization")],z);let S=class extends Zi(Ke){constructor(e){super(e),this.type="slice-view-3d",this.analysis=null,this.tool=null,this.analysisVisualization=null,this.analysisController=null,this.plane=null,this.active=!0}initialize(){this.analysisVisualization=new z({view:this.view,analysis:this.analysis,analysisViewData:this}),this.analysisController=new Z({view:this.view,analysis:this.analysis,analysisViewData:this}),this.addHandles(aa(this,os))}destroy(){sa(this),this.analysisVisualization=j(this.analysisVisualization),this.analysisController=j(this.analysisController)}get showGrid(){return this.analysisVisualization?.showGrid??!1}set showGrid(e){this.analysisVisualization&&(this.analysisVisualization.showGrid=e)}get editable(){return!this.analysisVisualization.preview}set editable(e){this.analysisVisualization.preview=!e}get testData(){return{visualization:this.analysisVisualization,controller:this.analysisController,tool:this.tool}}};h([d({readOnly:!0})],S.prototype,"type",void 0),h([d({constructOnly:!0,nonNullable:!0})],S.prototype,"analysis",void 0),h([d()],S.prototype,"tool",void 0),h([d()],S.prototype,"plane",void 0),h([d()],S.prototype,"active",void 0),h([d()],S.prototype,"showGrid",null),h([d()],S.prototype,"editable",null),S=h([ce("esri.views.3d.analysis.SliceAnalysisView3D")],S);const hs=S,Es=Object.freeze(Object.defineProperty({__proto__:null,default:hs},Symbol.toStringTag,{value:"Module"}));export{Es as S,$a as t};
